// ==UserScript==
// @name IMPS C&C TA Helper
// @author aszlig
// @description Various extensions to Command & Conquer - Tiberium Alliances
// @namespace https://github.com/imps/cncta
// @include https://prodgame*.alliances.commandandconquer.com/*
// @include http://prodgame*.alliances.commandandconquer.com/*
// @run_at document-end
// @version 0.3.4
// @license BSD3
// ==/UserScript==

// THIS FILE IS AUTOGENERATED, PLEASE DO NOT MODIFY!
// If you want to make changes, please look into the
// UserScript block above to get more information on
// how to obtain the source code or make changes.

(function(){function cncta_userscript__(){function userscript_main_code__(){
var $_,$estr=function(){return js.Boot.__string_rec(this,'');};;function $extend(from,fields){function inherit(){};inherit.prototype=from;var proto=new inherit();for(var name in fields)proto[name]=fields[name];return proto;}
var ArrayHelper=function(){}
ArrayHelper.__name__=["ArrayHelper"];ArrayHelper.remove=function(a,x){return false;}
ArrayHelper.get_iterator=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length;},next:function(){return this.arr[this.cur++];}};}
ArrayHelper.iter=function(it){if(Std["is"](it,Array))return function(){return ArrayHelper.get_iterator(it);};else return FunctionHelper.bind(it.iterator,it);}
ArrayHelper.prototype={__class__:ArrayHelper}
var CNCTA=function(){this.maindata=ClientLib.Data.MainData.GetInstance();this.ui=qx.core.Init.getApplication();var navbar=this.ui.getAppointmentsBar();this.toolbox=new cncta.ui.ToolBox();navbar.add(this.toolbox);{this.chatwin=new cncta.ui.ChatWindow();this.toolbox.add_window_button("Alliance Chat","Open alliance chat",this.chatwin);this.toolbox.add_window_button("Base Builder","Get BaseBuilder URL",new cncta.ui.BaseBuilder());}
var watch_player=new cncta.watchers.PlayerWatch();watch_player.on_watch_ready=FunctionHelper.bind(this.start_xmpp,this);};CNCTA.__name__=["CNCTA"];CNCTA.main=function(){Void;new CNCTA();}
CNCTA.prototype={xmpp:null,maindata:null,ui:null,chatwin:null,toolbox:null,on_new_message:function(msg){this.chatwin.add_message(msg.sender,msg.date,msg.message,msg.myself);},add_chat_handlers:function(){var me=this;this.xmpp.on_groupchat_message=FunctionHelper.bind(this.on_new_message,this);this.chatwin.on_send=($_=this.xmpp,FunctionHelper.bind($_.send,$_));qx.event.Registration.addListener(js.Lib.window,"shutdown",function(e){me.xmpp.conn.disconnect();});},attach2toolbox:function(){this.chatwin=new cncta.ui.ChatWindow();this.toolbox.add_window_button("Alliance Chat","Open alliance chat",this.chatwin);this.toolbox.add_window_button("Base Builder","Get BaseBuilder URL",new cncta.ui.BaseBuilder());},get_alliance_hash:function(){var alliance=this.maindata.get_Alliance();var members=alliance.get_MemberDataAsArray().slice();members.sort(function(m1,m2){if(m1.JoinStep>m2.JoinStep)return-1;if(m1.JoinStep<m2.JoinStep)return 1;return 0;});var first=members.pop();var hash=haxe.SHA1.encode(Std.string(first.JoinStep)+Std.string(first.Id));return hash;},get_channel_name:function(){var clantag=this.maindata.get_Alliance().get_Abbreviation();var world_id=this.maindata.get_Server().get_WorldId();var enc_tag=StringTools.replace(clantag," ","-");var enc_world=Std.string(world_id);return("cncta"+enc_world+"_"+enc_tag).toLowerCase();},start_xmpp:function(){var nick=this.maindata.get_Player().get_Name();var passwd=this.get_alliance_hash();this.xmpp=new cncta.xmpp.Chat(nick,this.get_channel_name(),passwd);this.xmpp.on_joined=FunctionHelper.bind(this.add_chat_handlers,this);this.xmpp.on_enter=($_=this.chatwin,FunctionHelper.bind($_.on_enter,$_));this.xmpp.on_leave=($_=this.chatwin,FunctionHelper.bind($_.on_leave,$_));this.xmpp.connect();},__class__:CNCTA}
var DateTools=function(){}
DateTools.__name__=["DateTools"];DateTools.__format_get=function(d,e){return(function($this){var $r;switch(e){case"%":$r="%";break;case"C":$r=StringTools.lpad(Std.string(d.getFullYear()/100|0),"0",2);break;case"d":$r=StringTools.lpad(Std.string(d.getDate()),"0",2);break;case"D":$r=DateTools.__format(d,"%m/%d/%y");break;case"e":$r=Std.string(d.getDate());break;case"H":case"k":$r=StringTools.lpad(Std.string(d.getHours()),e=="H"?"0":" ",2);break;case"I":case"l":$r=(function($this){var $r;var hour=d.getHours()%12;$r=StringTools.lpad(Std.string(hour==0?12:hour),e=="I"?"0":" ",2);return $r;}($this));break;case"m":$r=StringTools.lpad(Std.string(d.getMonth()+1),"0",2);break;case"M":$r=StringTools.lpad(Std.string(d.getMinutes()),"0",2);break;case"n":$r="\n";break;case"p":$r=d.getHours()>11?"PM":"AM";break;case"r":$r=DateTools.__format(d,"%I:%M:%S %p");break;case"R":$r=DateTools.__format(d,"%H:%M");break;case"s":$r=Std.string(d.getTime()/1000|0);break;case"S":$r=StringTools.lpad(Std.string(d.getSeconds()),"0",2);break;case"t":$r="\t";break;case"T":$r=DateTools.__format(d,"%H:%M:%S");break;case"u":$r=(function($this){var $r;var t=d.getDay();$r=t==0?"7":Std.string(t);return $r;}($this));break;case"w":$r=Std.string(d.getDay());break;case"y":$r=StringTools.lpad(Std.string(d.getFullYear()%100),"0",2);break;case"Y":$r=Std.string(d.getFullYear());break;default:$r=(function($this){var $r;throw"Date.format %"+e+"- not implemented yet.";return $r;}($this));}
return $r;}(this));}
DateTools.__format=function(d,f){var r=new StringBuf();var p=0;while(true){var np=f.indexOf("%",p);if(np<0)break;r.b[r.b.length]=f.substr(p,np-p);r.add(DateTools.__format_get(d,f.substr(np+1,1)));p=np+2;}
r.b[r.b.length]=f.substr(p,f.length-p);return r.b.join("");}
DateTools.format=function(d,f){return DateTools.__format(d,f);}
DateTools.delta=function(d,t){return Date.fromTime(d.getTime()+t);}
DateTools.prototype={__class__:DateTools}
var EReg=function(r,opt){opt=opt.split("u").join("");this.r=new RegExp(r,opt);};EReg.__name__=["EReg"];EReg.prototype={r:null,match:function(s){this.r.m=this.r.exec(s);this.r.s=s;return this.r.m!=null;},matched:function(n){return this.r.m!=null&&n>=0&&n<this.r.m.length?this.r.m[n]:(function($this){var $r;throw"EReg::matched";return $r;}(this));},matchedRight:function(){if(this.r.m==null)throw"No string matched";var sz=this.r.m.index+this.r.m[0].length;return this.r.s.substr(sz,this.r.s.length-sz);},__class__:EReg}
var FunctionHelper=function(){}
FunctionHelper.__name__=["FunctionHelper"];FunctionHelper.bind=function(m,o){var f=function(){return f.method.apply(f.scope,arguments);};f.scope=o;f.method=m;return f;}
FunctionHelper.prototype={__class__:FunctionHelper}
var Hash=function(){this.h={};};Hash.__name__=["Hash"];Hash.prototype={h:null,set:function(key,value){this.h["$"+key]=value;},get:function(key){return this.h["$"+key];},exists:function(key){return this.h.hasOwnProperty("$"+key);},remove:function(key){key="$"+key;if(!this.h.hasOwnProperty(key))return false;delete(this.h[key]);return true;},keys:function(){var a=[];for(var key in this.h){if(this.h.hasOwnProperty(key))a.push(key.substr(1));}
return ArrayHelper.get_iterator(a);},__class__:Hash}
var IntHash=function(){this.h={};};IntHash.__name__=["IntHash"];IntHash.prototype={h:null,set:function(key,value){this.h[key]=value;},get:function(key){return this.h[key];},__class__:IntHash}
var Lambda=function(){}
Lambda.__name__=["Lambda"];Lambda.has=function(it,elt,cmp){if(cmp==null){var $it0=ArrayHelper.iter(it)();while($it0.hasNext()){var x=$it0.next();if(x==elt)return true;}}else{var $it1=ArrayHelper.iter(it)();while($it1.hasNext()){var x=$it1.next();if(cmp(x,elt))return true;}}
return false;}
Lambda.count=function(it,pred){var n=0;if(pred==null){var $it0=ArrayHelper.iter(it)();while($it0.hasNext()){var _=$it0.next();n++;}}else{var $it1=ArrayHelper.iter(it)();while($it1.hasNext()){var x=$it1.next();if(pred(x))n++;}}
return n;}
Lambda.prototype={__class__:Lambda}
var List=function(){this.length=0;};List.__name__=["List"];List.prototype={h:null,length:null,iterator:function(){return{h:this.h,hasNext:function(){return this.h!=null;},next:function(){if(this.h==null)return null;var x=this.h[0];this.h=this.h[1];return x;}};},__class__:List}
var Reflect=function(){}
Reflect.__name__=["Reflect"];Reflect.field=function(o,field){var v=null;try{v=o[field];}catch(e){}
return v;}
Reflect.callMethod=function(o,func,args){return func.apply(o,args);}
Reflect.isFunction=function(f){return typeof(f)=="function"&&f.__name__==null;}
Reflect.prototype={__class__:Reflect}
var Std=function(){}
Std.__name__=["Std"];Std["is"]=function(v,t){return js.Boot.__instanceof(v,t);}
Std.string=function(s){return js.Boot.__string_rec(s,"");}
Std["int"]=function(x){return x|0;}
Std.parseInt=function(x){var v=parseInt(x,10);if(v==0&&StringHelper.charCodeAt(x,1)==120)v=parseInt(x);if(isNaN(v))return null;return v;}
Std.random=function(x){return Math.floor(Math.random()*x);}
Std.prototype={__class__:Std}
var StringBuf=function(){this.b=new Array();};StringBuf.__name__=["StringBuf"];StringBuf.prototype={add:function(x){this.b[this.b.length]=x==null?"null":x;},addSub:function(s,pos,len){this.b[this.b.length]=s.substr(pos,len);},toString:function(){return this.b.join("");},b:null,__class__:StringBuf}
var StringHelper=function(){}
StringHelper.__name__=["StringHelper"];StringHelper.charCodeAt=function(s,i){var x=s.charCodeAt(i);if(x!=x)return undefined;return x;}
StringHelper.prototype={__class__:StringHelper}
var StringTools=function(){}
StringTools.__name__=["StringTools"];StringTools.htmlEscape=function(s){return s.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;");}
StringTools.startsWith=function(s,start){return s.length>=start.length&&s.substr(0,start.length)==start;}
StringTools.isSpace=function(s,pos){var c=StringHelper.charCodeAt(s,pos);return c>=9&&c<=13||c==32;}
StringTools.ltrim=function(s){var l=s.length;var r=0;while(r<l&&StringTools.isSpace(s,r))r++;if(r>0)return s.substr(r,l-r);else return s;}
StringTools.rtrim=function(s){var l=s.length;var r=0;while(r<l&&StringTools.isSpace(s,l-r-1))r++;if(r>0)return s.substr(0,l-r);else return s;}
StringTools.trim=function(s){return StringTools.ltrim(StringTools.rtrim(s));}
StringTools.lpad=function(s,c,l){var ns="";var sl=s.length;if(sl>=l)return s;var cl=c.length;while(sl<l)if(l-sl<cl){ns+=c.substr(0,l-sl);sl=l;}else{ns+=c;sl+=cl;}
return ns+s;}
StringTools.replace=function(s,sub,by){return s.split(sub).join(by);}
StringTools.fastCodeAt=function(s,index){return s.charCodeAt(index);}
StringTools.isEOF=function(c){return c!=c;}
StringTools.prototype={__class__:StringTools}
var ValueType={__ename__:["ValueType"],__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]}
ValueType.TNull=["TNull",0];ValueType.TNull.toString=$estr;ValueType.TNull.__enum__=ValueType;ValueType.TInt=["TInt",1];ValueType.TInt.toString=$estr;ValueType.TInt.__enum__=ValueType;ValueType.TFloat=["TFloat",2];ValueType.TFloat.toString=$estr;ValueType.TFloat.__enum__=ValueType;ValueType.TBool=["TBool",3];ValueType.TBool.toString=$estr;ValueType.TBool.__enum__=ValueType;ValueType.TObject=["TObject",4];ValueType.TObject.toString=$estr;ValueType.TObject.__enum__=ValueType;ValueType.TFunction=["TFunction",5];ValueType.TFunction.toString=$estr;ValueType.TFunction.__enum__=ValueType;ValueType.TClass=function(c){var $x=["TClass",6,c];$x.__enum__=ValueType;$x.toString=$estr;return $x;}
ValueType.TEnum=function(e){var $x=["TEnum",7,e];$x.__enum__=ValueType;$x.toString=$estr;return $x;}
ValueType.TUnknown=["TUnknown",8];ValueType.TUnknown.toString=$estr;ValueType.TUnknown.__enum__=ValueType;var Type=function(){}
Type.__name__=["Type"];Type.createEnum=function(e,constr,params){var f=Reflect.field(e,constr);if(f==null)throw"No such constructor "+constr;if(Reflect.isFunction(f)){if(params==null)throw"Constructor "+constr+" need parameters";return f.apply(e,params);}
if(params!=null&&params.length!=0)throw"Constructor "+constr+" does not need parameters";return f;}
Type.enumConstructor=function(e){return e[0];}
Type.prototype={__class__:Type}
var Xml=function(){};Xml.__name__=["Xml"];Xml.Element=null;Xml.PCData=null;Xml.CData=null;Xml.Comment=null;Xml.DocType=null;Xml.Prolog=null;Xml.Document=null;Xml.parse=function(str){return haxe.xml.Parser.parse(str);}
Xml.createElement=function(name){var r=new Xml();r.nodeType=Xml.Element;r._children=new Array();r._attributes=new Hash();r.setNodeName(name);return r;}
Xml.createPCData=function(data){var r=new Xml();r.nodeType=Xml.PCData;r.setNodeValue(data);return r;}
Xml.createCData=function(data){var r=new Xml();r.nodeType=Xml.CData;r.setNodeValue(data);return r;}
Xml.createComment=function(data){var r=new Xml();r.nodeType=Xml.Comment;r.setNodeValue(data);return r;}
Xml.createDocType=function(data){var r=new Xml();r.nodeType=Xml.DocType;r.setNodeValue(data);return r;}
Xml.createProlog=function(data){var r=new Xml();r.nodeType=Xml.Prolog;r.setNodeValue(data);return r;}
Xml.createDocument=function(){var r=new Xml();r.nodeType=Xml.Document;r._children=new Array();return r;}
Xml.prototype={nodeType:null,nodeName:null,nodeValue:null,_nodeName:null,_nodeValue:null,_attributes:null,_children:null,_parent:null,getNodeName:function(){if(this.nodeType!=Xml.Element)throw"bad nodeType";return this._nodeName;},setNodeName:function(n){if(this.nodeType!=Xml.Element)throw"bad nodeType";return this._nodeName=n;},getNodeValue:function(){if(this.nodeType==Xml.Element||this.nodeType==Xml.Document)throw"bad nodeType";return this._nodeValue;},setNodeValue:function(v){if(this.nodeType==Xml.Element||this.nodeType==Xml.Document)throw"bad nodeType";return this._nodeValue=v;},getParent:function(){return this._parent;},get:function(att){if(this.nodeType!=Xml.Element)throw"bad nodeType";return this._attributes.get(att);},set:function(att,value){if(this.nodeType!=Xml.Element)throw"bad nodeType";this._attributes.set(att,value);},exists:function(att){if(this.nodeType!=Xml.Element)throw"bad nodeType";return this._attributes.exists(att);},iterator:function(){if(this._children==null)throw"bad nodetype";return{cur:0,x:this._children,hasNext:function(){return this.cur<this.x.length;},next:function(){return this.x[this.cur++];}};},elements:function(){if(this._children==null)throw"bad nodetype";return{cur:0,x:this._children,hasNext:function(){var k=this.cur;var l=this.x.length;while(k<l){if(this.x[k].nodeType==Xml.Element)break;k+=1;}
this.cur=k;return k<l;},next:function(){var k=this.cur;var l=this.x.length;while(k<l){var n=this.x[k];k+=1;if(n.nodeType==Xml.Element){this.cur=k;return n;}}
return null;}};},firstChild:function(){if(this._children==null)throw"bad nodetype";return this._children[0];},firstElement:function(){if(this._children==null)throw"bad nodetype";var cur=0;var l=this._children.length;while(cur<l){var n=this._children[cur];if(n.nodeType==Xml.Element)return n;cur++;}
return null;},addChild:function(x){if(this._children==null)throw"bad nodetype";if(x._parent!=null)ArrayHelper.remove(x._parent._children,x);x._parent=this;this._children.push(x);},toString:function(){if(this.nodeType==Xml.PCData)return this._nodeValue;if(this.nodeType==Xml.CData)return"<![CDATA["+this._nodeValue+"]]>";if(this.nodeType==Xml.Comment)return"<!--"+this._nodeValue+"-->";if(this.nodeType==Xml.DocType)return"<!DOCTYPE "+this._nodeValue+">";if(this.nodeType==Xml.Prolog)return"<?"+this._nodeValue+"?>";var s=new StringBuf();if(this.nodeType==Xml.Element){s.b[s.b.length]="<";s.add(this._nodeName);var $it0=this._attributes.keys();while($it0.hasNext()){var k=$it0.next();s.b[s.b.length]=" ";s.b[s.b.length]=k==null?"null":k;s.b[s.b.length]="=\"";s.add(this._attributes.get(k));s.b[s.b.length]="\"";}
if(this._children.length==0){s.b[s.b.length]="/>";return s.b.join("");}
s.b[s.b.length]=">";}
var $it1=ArrayHelper.iter(this)();while($it1.hasNext()){var x=$it1.next();s.add(x.toString());}
if(this.nodeType==Xml.Element){s.b[s.b.length]="</";s.add(this._nodeName);s.b[s.b.length]=">";}
return s.b.join("");},__class__:Xml,__properties__:{set_nodeValue:"setNodeValue",get_nodeValue:"getNodeValue",set_nodeName:"setNodeName",get_nodeName:"getNodeName"}}
var cncta=cncta||{}
if(!cncta.ui)cncta.ui={}
cncta.ui.BaseBuilder=function(){webfrontend.gui.CustomWindow.call(this,"The Base Builder URL for the current base is:");this.set({allowMaximize:false,allowMinimize:false,showMaximize:false,showMinimize:false,showStatusbar:false,resizable:false,movable:true,alwaysOnTop:true,showClose:true});this.setLayout(new qx.ui.layout.VBox(10));this.url_widget=new qx.ui.basic.Label();this.url_widget.set({padding:10,selectable:true,rich:true});this.add(this.url_widget);this.addListener("appear",FunctionHelper.bind(this.on_appear,this));};cncta.ui.BaseBuilder.__name__=["cncta","ui","BaseBuilder"];cncta.ui.BaseBuilder.__super__=webfrontend.gui.CustomWindow;cncta.ui.BaseBuilder.prototype=$extend(webfrontend.gui.CustomWindow.prototype,{url_widget:null,set_bbid:function(id){var url="http://cncbasebuilder.appspot.com/";if(id!=null)url+="#"+id;var link="<a href=\"#\" onClick=\"webfrontend.";link+="gui.Util.openLinkFromInnerHtml(this);\"";link+=" style=\"color:#ffffff\">";link+=url;link+="</a>";this.url_widget.setValue(link);},structure2bb:function(building){var convertmap=new IntHash();convertmap.set(1,"6");convertmap.set(2,"8");convertmap.set(5,"9");convertmap.set(10,"7");convertmap.set(16,"A");convertmap.set(24,"B");convertmap.set(32,"4");convertmap.set(34,"D");convertmap.set(35,"C");convertmap.set(36,"E");convertmap.set(40,"F");convertmap.set(42,"G");convertmap.set(80,"I");convertmap.set(81,"J");convertmap.set(82,"H");convertmap.set(301,"2");convertmap.set(302,"1");convertmap.set(401,"5");convertmap.set(402,"4");var converted=convertmap.get(building);if(converted==null)return"0";return converted;},calculate_bbid:function(){var bbmap=new Array();var main=ClientLib.Data.MainData.GetInstance();var city=main.get_Cities().get_CurrentCity();if(city==null)return null;while(bbmap.length<72){var restype=city.GetResourceType(bbmap.length%9,bbmap.length/9|0);bbmap.push(restype>0?restype+300:0);}
var buildings=city.get_CityBuildingsData();var _g=0,_g1=buildings.m_Buildings.l;while(_g<_g1.length){var building=_g1[_g];++_g;var type=building.get_Type();var x=building.get_CoordX();var y=building.get_CoordY();if(bbmap[y*9+x]>=300){if(type==32)bbmap[y*9+x]+=100;}else bbmap[y*9+x]=type;}
var bbid="";var _g=0;while(_g<bbmap.length){var building=bbmap[_g];++_g;bbid+=this.structure2bb(building);}
return bbid;},on_appear:function(){this.set_bbid(this.calculate_bbid());this.centerPosition();this.bringToFront();},__class__:cncta.ui.BaseBuilder});cncta.ui.ChatWindow=function(){webfrontend.gui.CustomWindow.call(this,"Chat");this.setLayout(new qx.ui.layout.VBox());this.set({allowMaximize:true,allowMinimize:false,showMaximize:true,showMinimize:false,showStatusbar:false,resizable:true,movable:true,alwaysOnTop:false,showClose:true});this.view=new cncta.ui.chat.ChatView();this.input=new cncta.ui.chat.ChatInput();this.add(this.view,{flex:1});this.add(this.input);this.input.on_send=FunctionHelper.bind(this.message_input,this);this.appeared=false;this.addListener("appear",FunctionHelper.bind(this.on_appear,this));this.addListener("mouseover",($_=this.input,FunctionHelper.bind($_.set_focus,$_)));};cncta.ui.ChatWindow.__name__=["cncta","ui","ChatWindow"];cncta.ui.ChatWindow.__super__=webfrontend.gui.CustomWindow;cncta.ui.ChatWindow.prototype=$extend(webfrontend.gui.CustomWindow.prototype,{view:null,input:null,appeared:null,on_enter:function(nick){this.view.roster.add_member(nick,nick);},on_leave:function(nick){this.view.roster.remove_member(nick);},on_appear:function(){this.fireEvent("unflash");this.input.set_focus();if(!this.appeared)this.centerPosition();this.bringToFront();this.appeared=true;},message_input:function(text){this.on_send(text);},on_send:function(text){},add_message:function(nick,date,text,is_me){if(is_me==null)is_me=false;this.view.add_message(nick,date,text,is_me);if(!this.isVisible())this.fireEvent("flash");},__class__:cncta.ui.ChatWindow});cncta.ui.ColorLabel=function(color,text){qx.ui.basic.Label.call(this,text);this.set({textColor:color});};cncta.ui.ColorLabel.__name__=["cncta","ui","ColorLabel"];cncta.ui.ColorLabel.__super__=qx.ui.basic.Label;cncta.ui.ColorLabel.prototype=$extend(qx.ui.basic.Label.prototype,{__class__:cncta.ui.ColorLabel});cncta.ui.ToolBox=function(){qx.ui.container.Composite.call(this,new qx.ui.layout.Canvas());this.buttons=new qx.ui.container.Composite(new qx.ui.layout.VBox(2));this.add(this.buttons,{right:0,top:0});};cncta.ui.ToolBox.__name__=["cncta","ui","ToolBox"];cncta.ui.ToolBox.__super__=qx.ui.container.Composite;cncta.ui.ToolBox.prototype=$extend(qx.ui.container.Composite.prototype,{buttons:null,add_window_button:function(label,tooltip,window){var listener=function(){if(window.isVisible())window.close();else window.open();};var button=this.add_button(label,tooltip,listener);window.addListener("flash",function(){button.setDecorator("button-standard-hovered");button.setIcon("FractionUI/icons/cht_opt_maximize_b.gif");});window.addListener("unflash",function(){button.resetDecorator();button.setIcon("FractionUI/icons/cht_opt_maximize.gif");});},add_button:function(label,tooltip,listener){var icon="FractionUI/icons/cht_opt_maximize.gif";var button=new qx.ui.form.Button(label,icon);button.set({height:24,toolTipText:tooltip,center:false});button.addListener("execute",listener);this.buttons.add(button);return button;},__class__:cncta.ui.ToolBox});if(!cncta.ui.chat)cncta.ui.chat={}
cncta.ui.chat.ChatInput=function(){qx.ui.container.Composite.call(this,new qx.ui.layout.HBox());this.history=new Array();this.history_index=null;this.chatline=new qx.ui.form.TextField();this.chatline.set({appearance:"chat-textfield",allowGrowX:true});this.chatline.addListener("keypress",FunctionHelper.bind(this.on_chatinput,this));this.sendbutton=new qx.ui.form.Button("Send");this.sendbutton.set({appearance:"button-friendlist-scroll"});this.sendbutton.addListener("execute",FunctionHelper.bind(this.on_submit,this));this.add(this.chatline,{flex:1});this.add(this.sendbutton);};cncta.ui.chat.ChatInput.__name__=["cncta","ui","chat","ChatInput"];cncta.ui.chat.ChatInput.__super__=qx.ui.container.Composite;cncta.ui.chat.ChatInput.prototype=$extend(qx.ui.container.Composite.prototype,{chatline:null,sendbutton:null,history:null,history_index:null,original_value:null,set_focus:function(){this.chatline.focus();},history_up:function(){if(this.history_index==null){this.original_value=this.chatline.getValue();this.history_index=this.history.length;}else if(this.history_index<=0)return;this.history_index--;this.push_history();},history_down:function(){if(this.history_index==null)return;if(this.history_index>=this.history.length-1)this.history_index=null;else this.history_index++;this.push_history();},push_history:function(){var value;if(this.history_index==null)value=this.original_value;else value=this.history[this.history_index];this.chatline.setValue(value);},append_history:function(line){this.history.push(line);this.history_index=null;},on_chatinput:function(e){switch(e.getKeyIdentifier()){case"Enter":this.on_submit();break;case"Up":this.history_up();e.stop();break;case"Down":this.history_down();e.stop();break;default:}},on_submit:function(){var line=this.chatline.getValue();this.chatline.setValue("");if(line==null||line.length==0)return;this.append_history(line);this.on_send(line);},on_send:function(input){},__class__:cncta.ui.chat.ChatInput});cncta.ui.chat.ChatLine=function(date,nick,text){qx.ui.container.Composite.call(this,new qx.ui.layout.HBox(5));var time=DateTools.format(date,"%H:%M:%S");var bbtext=webfrontend.gui.Util.convertBBCode(text,true,"#ff9900");var timelabel=new cncta.ui.ColorLabel("#00ff00","["+time+"]");timelabel.set({selectable:true});this.add(timelabel);this.nicklabel=new qx.ui.basic.Label(nick+":");this.nicklabel.set({selectable:true});this.nicklabel.set({textColor:"#66ffff"});this.is_me=false;this.add(this.nicklabel);var style="white-space:pre-wrap;word-wrap:break-word";var wrapped="<span style=\""+style+"\">"+bbtext+"</span>";var textlabel=new cncta.ui.ColorLabel("#ffffff",wrapped);textlabel.set({rich:true,wrap:true,selectable:true,allowGrowY:true});this.add(textlabel,{flex:1});};cncta.ui.chat.ChatLine.__name__=["cncta","ui","chat","ChatLine"];cncta.ui.chat.ChatLine.__super__=qx.ui.container.Composite;cncta.ui.chat.ChatLine.prototype=$extend(qx.ui.container.Composite.prototype,{is_me:null,nicklabel:null,set_is_me:function(v){this.nicklabel.set({textColor:v?"#ff5050":"#66ffff"});return this.is_me=v;},__class__:cncta.ui.chat.ChatLine,__properties__:{set_is_me:"set_is_me"}});cncta.ui.chat.ChatRoster=function(){var layout=new qx.ui.layout.VBox();this.nicklist=new qx.ui.container.Composite(layout);this.nickmap=new Hash();qx.ui.container.Scroll.call(this,this.nicklist);};cncta.ui.chat.ChatRoster.__name__=["cncta","ui","chat","ChatRoster"];cncta.ui.chat.ChatRoster.__super__=qx.ui.container.Scroll;cncta.ui.chat.ChatRoster.prototype=$extend(qx.ui.container.Scroll.prototype,{nicklist:null,nickmap:null,add_member:function(ident,nick){if(this.nickmap.exists(ident))return;var label=new cncta.ui.ColorLabel("#ffff00",nick);this.nickmap.set(ident,label);this.nicklist.add(label);},remove_member:function(ident){var label=this.nickmap.get(ident);if(label!=null){this.nicklist.remove(label);this.nickmap.remove(ident);}},__class__:cncta.ui.chat.ChatRoster});cncta.ui.chat.ChatView=function(){qx.ui.container.Composite.call(this,new qx.ui.layout.HBox(2));this.lines=0;var layout=new qx.ui.layout.VBox(0);this.view=new qx.ui.container.Composite(layout);this.scroller=new qx.ui.container.Scroll(this.view);this.scroller.set({width:400,height:50,minWidth:100,scrollbarY:"on"});this.add(this.scroller,{flex:4});this.roster=new cncta.ui.chat.ChatRoster();this.roster.set({allowShrinkX:true,minWidth:50,maxWidth:200});this.add(this.roster,{flex:1});this.addListener("resize",FunctionHelper.bind(this.scroll_down,this));};cncta.ui.chat.ChatView.__name__=["cncta","ui","chat","ChatView"];cncta.ui.chat.ChatView.__super__=qx.ui.container.Composite;cncta.ui.chat.ChatView.prototype=$extend(qx.ui.container.Composite.prototype,{scroller:null,view:null,lines:null,roster:null,scroll_down:function(){this.scroller.scrollToY(500000);},add_message:function(nick,date,text,is_me){if(is_me==null)is_me=false;var line=new cncta.ui.chat.ChatLine(date,nick,text);line.nicklabel.set({textColor:is_me?"#ff5050":"#66ffff"});line.is_me=is_me;this.view.add(line);if(++this.lines>1000)this.view.removeAt(0);this.scroll_down();},__class__:cncta.ui.chat.ChatView});if(!cncta.watchers)cncta.watchers={}
cncta.watchers.Watch=function(watcher){this._watcher=watcher;this.on_timer();};cncta.watchers.Watch.__name__=["cncta","watchers","Watch"];cncta.watchers.Watch.prototype={_watcher:null,on_timer:function(){if(this._watcher())this.on_watch_ready();else haxe.Timer.delay(FunctionHelper.bind(this.on_timer,this),10);},on_watch_ready:function(){},__class__:cncta.watchers.Watch}
cncta.watchers.PlayerWatch=function(){cncta.watchers.Watch.call(this,FunctionHelper.bind(this.watcher,this));};cncta.watchers.PlayerWatch.__name__=["cncta","watchers","PlayerWatch"];cncta.watchers.PlayerWatch.__super__=cncta.watchers.Watch;cncta.watchers.PlayerWatch.prototype=$extend(cncta.watchers.Watch.prototype,{watcher:function(){var main_data=ClientLib.Data.MainData.GetInstance();return main_data.get_Player().get_Name();},__class__:cncta.watchers.PlayerWatch});var jabber=jabber||{}
if(!jabber.stream)jabber.stream={}
jabber.stream.Connection=function(host,secure,http){if(http==null)http=false;this.setHost(host);this.secure=secure;this.http=http;this.connected=this.secured=false;};jabber.stream.Connection.__name__=["jabber","stream","Connection"];jabber.stream.Connection.prototype={__onConnect:null,__onDisconnect:null,__onData:null,__onString:null,__onSecured:null,host:null,connected:null,secure:null,secured:null,http:null,setHost:function(t){if(this.connected)throw"cannot change hostname on active connection";return this.host=t;},connect:function(){},disconnect:function(){},setSecure:function(){},read:function(yes){if(yes==null)yes=true;return false;},write:function(t){return false;},writeBytes:function(t){return false;},__class__:jabber.stream.Connection,__properties__:{set_host:"setHost"}}
jabber.BOSHConnection=function(host,path,hold,wait,secure,maxConcurrentRequests,timeoutOffset){if(timeoutOffset==null)timeoutOffset=25;if(maxConcurrentRequests==null)maxConcurrentRequests=2;if(secure==null)secure=false;if(wait==null)wait=30;if(hold==null)hold=1;jabber.stream.Connection.call(this,host,false,true);this.path=path;this.hold=hold;this.wait=wait;this.secure=secure;this.maxConcurrentRequests=maxConcurrentRequests;this.timeoutOffset=timeoutOffset;this.initialized=this.pauseEnabled=false;this.pollingEnabled=true;};jabber.BOSHConnection.__name__=["jabber","BOSHConnection"];jabber.BOSHConnection.__super__=jabber.stream.Connection;jabber.BOSHConnection.prototype=$extend(jabber.stream.Connection.prototype,{path:null,hold:null,wait:null,sid:null,maxConcurrentRequests:null,initialized:null,rid:null,requestCount:null,requestQueue:null,responseTimer:null,responseQueue:null,pollingEnabled:null,pauseEnabled:null,inactivity:null,maxPause:null,timeoutTimer:null,timeoutOffset:null,connect:function(){if(this.initialized&&this.connected)this.restart();else{this.initialized=true;this.rid=Math.random()*10000000|0;this.requestCount=0;this.requestQueue=new Array();this.responseQueue=new Array();this.responseTimer=new haxe.Timer(0);var b=Xml.createElement("body");b.set("xmlns",jabber.BOSHConnection.XMLNS);b.set("xml:lang","en");b.set("xmlns:xmpp",jabber.BOSHConnection.XMLNS_XMPP);b.set("xmpp:version","1.0");b.set("ver","1.6");b.set("hold",Std.string(this.hold));b.set("rid",Std.string(this.rid));b.set("wait",Std.string(this.wait));b.set("to",this.host);b.set("secure",Std.string(this.secure));this.sendRequests(b);}},disconnect:function(){if(this.connected){var r=this.createRequest();r.set("type","terminate");r.addChild(new xmpp.Presence(null,null,null,xmpp.PresenceType.unavailable).toXml());this.sendRequests(r);this.cleanup();}},write:function(t){return this.sendQueuedRequests(t);},restart:function(){var r=this.createRequest();r.set("xmlns",jabber.BOSHConnection.XMLNS);r.set("xmpp:restart","true");r.set("xmlns:xmpp",jabber.BOSHConnection.XMLNS_XMPP);r.set("xml:lang","en");r.set("to",this.host);this.sendRequests(r);},sendQueuedRequests:function(t){if(t!=null)this.requestQueue.push(t);else if(this.requestQueue.length==0)return false;return this.sendRequests(null);},sendRequests:function(t,poll){if(poll==null)poll=false;if(this.requestCount>=this.maxConcurrentRequests)return false;this.requestCount++;if(t==null){if(poll)t=this.createRequest();else{var i=0;var tmp=new Array();while(i++<10&&this.requestQueue.length>0)tmp.push(this.requestQueue.shift());t=this.createRequest(tmp);}}
this.createHTTPRequest(t.toString());if(this.timeoutTimer!=null)this.timeoutTimer.stop();this.timeoutTimer=new haxe.Timer(this.wait*1000+this.timeoutOffset*1000);this.timeoutTimer.run=FunctionHelper.bind(this.handleTimeout,this);return true;},createHTTPRequest:function(data){var me=this;var r=new js.XMLHttpRequest();r.open("POST",this.getHTTPPath(),true);r.onreadystatechange=function(){if(r.readyState!=4)return;var s=r.status;if(s!=null&&s>=200&&s<400)me.handleHTTPData(r.responseText);else me.handleHTTPError("Http Error #"+r.status);};r.send(data);},handleTimeout:function(){this.timeoutTimer.stop();this.cleanup();this.__onDisconnect("BOSH timeout");},handleHTTPError:function(e){this.cleanup();this.__onDisconnect(e);},handleHTTPData:function(t){var x=null;try{x=Xml.parse(t).firstElement();}catch(e){return;}
if(x.get("xmlns")!=jabber.BOSHConnection.XMLNS)return;this.requestCount--;if(this.timeoutTimer!=null)this.timeoutTimer.stop();if(this.connected){switch(x.get("type")){case"terminate":this.cleanup();this.__onDisconnect(null);return;case"error":haxe.Log.trace("TODO",{fileName:"BOSHConnection.hx",lineNumber:346,className:"jabber.BOSHConnection",methodName:"handleHTTPData"});return;}
var c=x.firstElement();if(c==null){if(this.requestCount==0)this.poll();else this.sendQueuedRequests();return;}
var $it0=x.elements();while($it0.hasNext()){var e=$it0.next();this.responseQueue.push(e);}
this.resetResponseProcessor();if(this.requestCount==0&&!this.sendQueuedRequests()){if(this.responseQueue.length>0)haxe.Timer.delay(FunctionHelper.bind(this.poll,this),0);else this.poll();}}else{if(!this.initialized)return;this.sid=x.get("sid");if(this.sid==null){this.cleanup();this.__onDisconnect("invalid sid");return;}
this.wait=Std.parseInt(x.get("wait"));var t1=null;t1=x.get("maxpause");if(t1!=null){this.maxPause=Std.parseInt(t1)*1000;this.pauseEnabled=true;}
t1=null;t1=x.get("requests");if(t1!=null)this.maxConcurrentRequests=Std.parseInt(t1);t1=null;t1=x.get("inactivity");if(t1!=null)this.inactivity=Std.parseInt(t1);this.__onConnect();this.connected=true;this.__onString(x.toString());}},processResponse:function(){this.responseTimer.stop();this.__onString(this.responseQueue.shift().toString());this.resetResponseProcessor();},resetResponseProcessor:function(){if(this.responseQueue!=null&&this.responseQueue.length>0){this.responseTimer.stop();this.responseTimer=new haxe.Timer(0);this.responseTimer.run=FunctionHelper.bind(this.processResponse,this);}},poll:function(){if(!this.connected||!this.pollingEnabled||this.requestCount>0||this.sendQueuedRequests())return;this.sendRequests(null,true);},createRequest:function(t){var x=Xml.createElement("body");x.set("xmlns",jabber.BOSHConnection.XMLNS);x.set("xml:lang","en");x.set("rid",Std.string(++this.rid));x.set("sid",this.sid);if(t!=null){var $it0=ArrayHelper.iter(t)();while($it0.hasNext()){var e=$it0.next();x.addChild(Xml.createPCData(e));}}
return x;},getHTTPPath:function(){return"http://"+this.path;},cleanup:function(){this.timeoutTimer.stop();this.responseTimer.stop();this.connected=this.initialized=false;this.sid=null;this.requestCount=0;this.requestQueue=null;this.responseQueue=null;},__class__:jabber.BOSHConnection});if(!cncta.xmpp)cncta.xmpp={}
cncta.xmpp.SecureXMPPConnection=function(host,path,hold,wait,secure,maxConcurrentRequests,timeoutOffset){jabber.BOSHConnection.call(this,host,path,hold,wait,secure,maxConcurrentRequests,timeoutOffset);};cncta.xmpp.SecureXMPPConnection.__name__=["cncta","xmpp","SecureXMPPConnection"];cncta.xmpp.SecureXMPPConnection.__super__=jabber.BOSHConnection;cncta.xmpp.SecureXMPPConnection.prototype=$extend(jabber.BOSHConnection.prototype,{getHTTPPath:function(){return"https://"+this.path;},__class__:cncta.xmpp.SecureXMPPConnection});cncta.xmpp.Chat=function(nick,channel,passwd){this.nick=nick;this.channel=channel;this.passwd=passwd;this.nick_retries=0;};cncta.xmpp.Chat.__name__=["cncta","xmpp","Chat"];cncta.xmpp.Chat.prototype={conn:null,stream:null,room:null,nick:null,channel:null,passwd:null,nick_retries:null,on_joined:function(){},on_groupchat_message:function(m){},on_enter:function(nick){},on_leave:function(nick){},connect:function(){this.xmpp_connect("anonymous.headcounter.org","jabber.headcounter.org/http-bind");},disconnect:function(){this.conn.disconnect();},join_room:function(){var me=this;this.room=new jabber.client.MUChat(this.stream,"conference.headcounter.org",this.channel);this.room.onJoin=function(){if(me.room.affiliation==xmpp.muc.Affiliation.owner)me.configure_room();me.on_enter(me.room.nick);me.on_joined();};this.room.onError=FunctionHelper.bind(this.on_room_error,this);this.room.onPresence=FunctionHelper.bind(this.on_presence,this);this.room.onMessage=FunctionHelper.bind(this.on_message,this);this.room.join(this.nick,this.passwd);},form_field:function(name,value){var field=new xmpp.dataform.Field();field.variable=name;field.values.push(value);return field;},on_message:function(xmpp_from,xmpp_msg){if(xmpp_from==null||xmpp_msg==null)return;var date;var delay=xmpp.Delayed.fromPacket(xmpp_msg);if(delay==null)date=Date.now();else{var tz=Date.now().getTimezoneOffset()*60000;date=DateTools.delta(xmpp.DateTime.toDate(delay.stamp),-tz);}
switch((xmpp_msg.type)[1]){case 3:if(xmpp_from.nick==null||xmpp_msg.body==null)return;var nick=xmpp_from.nick;var body=xmpp_msg.body;var myself=this.room.nick==nick;var msg=new cncta.xmpp.ChatMessage(myself,nick,date,body);this.on_groupchat_message(msg);break;default:return;}},configure_room:function(){var form=new xmpp.DataForm(xmpp.dataform.FormType.submit);var _g=0,_g1=[this.form_field("FORM_TYPE",xmpp.Packet.PROTOCOL+"/muc"+"#roomconfig"),this.form_field("muc#roomconfig_passwordprotectedroom","1"),this.form_field("muc#roomconfig_roomsecret",this.passwd),this.form_field("muc#roomconfig_allowinvites","1"),this.form_field("public_list","0"),this.form_field("muc#roomconfig_publicroom","0"),this.form_field("muc#roomconfig_roomname","alliance name here")];while(_g<_g1.length){var f=_g1[_g];++_g;form.fields.push(f);}
var iq=new xmpp.IQ(xmpp.IQType.set,null,this.room.jid);var query=new xmpp.MUCOwner().toXml();query.addChild(form.toXml());iq.properties.push(query);this.room.stream.sendIQ(iq,function(r){});},get_next_nick:function(){this.nick_retries++;return this.nick+Std.string(this.nick_retries);},on_room_error:function(e){if(e.code==409)this.room.join(this.get_next_nick(),this.passwd);},on_presence:function(member){if(member.presence.status=="unavailable"){if(member.nick==this.nick)this.room.changeNick(this.nick);this.on_leave(member.nick);}else this.on_enter(member.nick);},send:function(text){if(this.room!=null)this.room.speak(StringTools.htmlEscape(StringTools.trim(text)));},on_xmpp_open:function(){var server_mechs=this.stream.server.features.get("mechanisms");var auth=new jabber.client.Authentication(this.stream,[new jabber.sasl.AnonymousMechanism()]);auth.onSuccess=FunctionHelper.bind(this.on_auth_success,this);auth.start(null,null);},on_auth_success:function(){this.stream.sendPresence();this.join_room();},xmpp_connect:function(host,path){this.conn=new cncta.xmpp.SecureXMPPConnection(host,path,null,null,true);this.stream=new jabber.client.Stream(this.conn);this.stream.onOpen=FunctionHelper.bind(this.on_xmpp_open,this);var jid=new jabber.JID(null);jid.domain=host;this.stream.open(jid);},__class__:cncta.xmpp.Chat}
cncta.xmpp.ChatMessage=function(myself,sender,date,msg){this.myself=myself;this.sender=sender;this.date=date;this.message=msg;};cncta.xmpp.ChatMessage.__name__=["cncta","xmpp","ChatMessage"];cncta.xmpp.ChatMessage.prototype={myself:null,sender:null,date:null,message:null,__class__:cncta.xmpp.ChatMessage}
var haxe=haxe||{}
haxe.BaseCode=function(base){var len=base.length;var nbits=1;while(len>1<<nbits)nbits++;if(nbits>8||len!=1<<nbits)throw"BaseCode : base length must be a power of two.";this.base=base;this.nbits=nbits;};haxe.BaseCode.__name__=["haxe","BaseCode"];haxe.BaseCode.prototype={base:null,nbits:null,encodeBytes:function(b){var nbits=this.nbits;var base=this.base;var size=b.length*8/nbits|0;var out=haxe.io.Bytes.alloc(size+(b.length*8%nbits==0?0:1));var buf=0;var curbits=0;var mask=(1<<nbits)-1;var pin=0;var pout=0;while(pout<size){while(curbits<nbits){curbits+=8;buf<<=8;buf|=b.b[pin++];}
curbits-=nbits;out.b[pout++]=base.b[buf>>curbits&mask]&255;}
if(curbits>0)out.b[pout++]=base.b[buf<<nbits-curbits&mask]&255;return out;},encodeString:function(s){return this.encodeBytes(haxe.io.Bytes.ofString(s)).toString();},__class__:haxe.BaseCode}
haxe.Int32=function(){}
haxe.Int32.__name__=["haxe","Int32"];haxe.Int32.ofInt=function(x){return x|0;}
haxe.Int32.clamp=function(x){return x|0;}
haxe.Int32.toInt=function(x){if((x>>30&1)!=x>>>31)throw"Overflow "+x;return x;}
haxe.Int32.add=function(a,b){return a+b|0;}
haxe.Int32.shl=function(a,b){return a<<b;}
haxe.Int32.shr=function(a,b){return a>>b;}
haxe.Int32.ushr=function(a,b){return a>>>b;}
haxe.Int32.and=function(a,b){return a&b;}
haxe.Int32.or=function(a,b){return a|b;}
haxe.Int32.xor=function(a,b){return a^b;}
haxe.Int32.complement=function(a){return~a;}
haxe.Int32.compare=function(a,b){return a-b;}
haxe.Int32.prototype={__class__:haxe.Int32}
haxe.Log=function(){}
haxe.Log.__name__=["haxe","Log"];haxe.Log.trace=function(v,infos){js.Boot.__trace(v,infos);}
haxe.Log.prototype={__class__:haxe.Log}
haxe.SHA1=function(){}
haxe.SHA1.__name__=["haxe","SHA1"];haxe.SHA1.newInt32=function(left,right){var result=left|0;result=result<<16;return result+(right|0)|0;}
haxe.SHA1.encode=function(s){var x=haxe.SHA1.str2blks_SHA1(s);var w=new Array();var a=haxe.SHA1.newInt32(26437,8961);var b=haxe.SHA1.newInt32(61389,43913);var c=haxe.SHA1.newInt32(39098,56574);var d=haxe.SHA1.newInt32(4146,21622);var e=haxe.SHA1.newInt32(50130,57840);var i=0;while(i<x.length){var olda=a;var oldb=b;var oldc=c;var oldd=d;var olde=e;var j=0;while(j<80){if(j<16)w[j]=x[i+j];else w[j]=haxe.SHA1.rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);var t=haxe.SHA1.add(haxe.SHA1.add(haxe.SHA1.rol(a,5),haxe.SHA1.ft(j|0,b,c,d)),haxe.SHA1.add(haxe.SHA1.add(e,w[j]),haxe.SHA1.kt(j|0)));e=d;d=c;c=haxe.SHA1.rol(b,30);b=a;a=t;j++;}
a=haxe.SHA1.add(a,olda);b=haxe.SHA1.add(b,oldb);c=haxe.SHA1.add(c,oldc);d=haxe.SHA1.add(d,oldd);e=haxe.SHA1.add(e,olde);i+=16;}
return haxe.SHA1.hex(a)+haxe.SHA1.hex(b)+haxe.SHA1.hex(c)+haxe.SHA1.hex(d)+haxe.SHA1.hex(e);}
haxe.SHA1.hex=function(num){var str="";var j=7;while(j>=0){str+=haxe.SHA1.hex_chr.charAt(haxe.Int32.toInt(num>>j*4&(15|0)));j--;}
return str;}
haxe.SHA1.str2blks_SHA1=function(s){var nblk=(s.length+8>>6)+1;var blks=new Array();var _g1=0,_g=nblk*16;while(_g1<_g){var i=_g1++;blks[i]=0|0;}
var _g1=0,_g=s.length;while(_g1<_g){var i=_g1++;var p=i>>2;var c=StringHelper.charCodeAt(s,i)|0;blks[p]=blks[p]|c<<24-i%4*8;}
var i=s.length;var p=i>>2;blks[p]=blks[p]|(128|0)<<24-i%4*8;blks[nblk*16-1]=s.length*8|0;return blks;}
haxe.SHA1.add=function(x,y){var lsw=(x&(65535|0))+(y&(65535|0))|0;var msw=((x>>16)+(y>>16)|0)+(lsw>>16)|0;return msw<<16|lsw&(65535|0);}
haxe.SHA1.rol=function(num,cnt){return num<<cnt|num>>>32-cnt;}
haxe.SHA1.ft=function(t,b,c,d){if(t-(20|0)<0)return b&c|~b&d;if(t-(40|0)<0)return b^c^d;if(t-(60|0)<0)return b&c|b&d|c&d;return b^c^d;}
haxe.SHA1.kt=function(t){if(t-(20|0)<0)return haxe.SHA1.newInt32(23170,31129);if(t-(40|0)<0)return haxe.SHA1.newInt32(28377,60321);if(t-(60|0)<0)return haxe.SHA1.newInt32(36635,48348);return haxe.SHA1.newInt32(51810,49622);}
haxe.SHA1.prototype={__class__:haxe.SHA1}
haxe.Timer=function(time_ms){var me=this;this.id=window.setInterval(function(){me.run();},time_ms);};haxe.Timer.__name__=["haxe","Timer"];haxe.Timer.delay=function(f,time_ms){var t=new haxe.Timer(time_ms);t.run=function(){t.stop();f();};return t;}
haxe.Timer.prototype={id:null,stop:function(){if(this.id==null)return;window.clearInterval(this.id);this.id=null;},run:function(){},__class__:haxe.Timer}
if(!haxe.io)haxe.io={}
haxe.io.Bytes=function(length,b){this.length=length;this.b=b;};haxe.io.Bytes.__name__=["haxe","io","Bytes"];haxe.io.Bytes.alloc=function(length){var a=new Array();var _g=0;while(_g<length){var i=_g++;a.push(0);}
return new haxe.io.Bytes(length,a);}
haxe.io.Bytes.ofString=function(s){var a=new Array();var _g1=0,_g=s.length;while(_g1<_g){var i=_g1++;var c=s.charCodeAt(i);if(c<=127)a.push(c);else if(c<=2047){a.push(192|c>>6);a.push(128|c&63);}else if(c<=65535){a.push(224|c>>12);a.push(128|c>>6&63);a.push(128|c&63);}else{a.push(240|c>>18);a.push(128|c>>12&63);a.push(128|c>>6&63);a.push(128|c&63);}}
return new haxe.io.Bytes(a.length,a);}
haxe.io.Bytes.prototype={length:null,b:null,get:function(pos){return this.b[pos];},set:function(pos,v){this.b[pos]=v&255;},readString:function(pos,len){if(pos<0||len<0||pos+len>this.length)throw haxe.io.Error.OutsideBounds;var s="";var b=this.b;var fcc=String.fromCharCode;var i=pos;var max=pos+len;while(i<max){var c=b[i++];if(c<128){if(c==0)break;s+=fcc(c);}else if(c<224)s+=fcc((c&63)<<6|b[i++]&127);else if(c<240){var c2=b[i++];s+=fcc((c&31)<<12|(c2&127)<<6|b[i++]&127);}else{var c2=b[i++];var c3=b[i++];s+=fcc((c&15)<<18|(c2&127)<<12|c3<<6&127|b[i++]&127);}}
return s;},toString:function(){return this.readString(0,this.length);},__class__:haxe.io.Bytes}
haxe.io.Error={__ename__:["haxe","io","Error"],__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]}
haxe.io.Error.Blocked=["Blocked",0];haxe.io.Error.Blocked.toString=$estr;haxe.io.Error.Blocked.__enum__=haxe.io.Error;haxe.io.Error.Overflow=["Overflow",1];haxe.io.Error.Overflow.toString=$estr;haxe.io.Error.Overflow.__enum__=haxe.io.Error;haxe.io.Error.OutsideBounds=["OutsideBounds",2];haxe.io.Error.OutsideBounds.toString=$estr;haxe.io.Error.OutsideBounds.__enum__=haxe.io.Error;haxe.io.Error.Custom=function(e){var $x=["Custom",3,e];$x.__enum__=haxe.io.Error;$x.toString=$estr;return $x;}
if(!haxe.xml)haxe.xml={}
haxe.xml.Parser=function(){}
haxe.xml.Parser.__name__=["haxe","xml","Parser"];haxe.xml.Parser.parse=function(str){var doc=Xml.createDocument();haxe.xml.Parser.doParse(str,0,doc);return doc;}
haxe.xml.Parser.doParse=function(str,p,parent){if(p==null)p=0;var xml=null;var state=1;var next=1;var aname=null;var start=0;var nsubs=0;var nbrackets=0;var c=str.charCodeAt(p);while(!(c!=c)){switch(state){case 0:switch(c){case 10:case 13:case 9:case 32:break;default:state=next;continue;}
break;case 1:switch(c){case 60:state=0;next=2;break;default:start=p;state=13;continue;}
break;case 13:if(c==60){var child=Xml.createPCData(str.substr(start,p-start));parent.addChild(child);nsubs++;state=0;next=2;}
break;case 17:if(c==93&&str.charCodeAt(p+1)==93&&str.charCodeAt(p+2)==62){var child=Xml.createCData(str.substr(start,p-start));parent.addChild(child);nsubs++;p+=2;state=1;}
break;case 2:switch(c){case 33:if(str.charCodeAt(p+1)==91){p+=2;if(str.substr(p,6).toUpperCase()!="CDATA[")throw"Expected <![CDATA[";p+=5;state=17;start=p+1;}else if(str.charCodeAt(p+1)==68||str.charCodeAt(p+1)==100){if(str.substr(p+2,6).toUpperCase()!="OCTYPE")throw"Expected <!DOCTYPE";p+=8;state=16;start=p+1;}else if(str.charCodeAt(p+1)!=45||str.charCodeAt(p+2)!=45)throw"Expected <!--";else{p+=2;state=15;start=p+1;}
break;case 63:state=14;start=p;break;case 47:if(parent==null)throw"Expected node name";start=p+1;state=0;next=10;break;default:state=3;start=p;continue;}
break;case 3:if(!(c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57||c==58||c==46||c==95||c==45)){if(p==start)throw"Expected node name";xml=Xml.createElement(str.substr(start,p-start));parent.addChild(xml);state=0;next=4;continue;}
break;case 4:switch(c){case 47:state=11;nsubs++;break;case 62:state=9;nsubs++;break;default:state=5;start=p;continue;}
break;case 5:if(!(c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57||c==58||c==46||c==95||c==45)){var tmp;if(start==p)throw"Expected attribute name";tmp=str.substr(start,p-start);aname=tmp;if(xml.exists(aname))throw"Duplicate attribute";state=0;next=6;continue;}
break;case 6:switch(c){case 61:state=0;next=7;break;default:throw"Expected =";}
break;case 7:switch(c){case 34:case 39:state=8;start=p;break;default:throw"Expected \"";}
break;case 8:if(c==str.charCodeAt(start)){var val=str.substr(start+1,p-start-1);xml.set(aname,val);state=0;next=4;}
break;case 9:p=haxe.xml.Parser.doParse(str,p,xml);start=p;state=1;break;case 11:switch(c){case 62:state=1;break;default:throw"Expected >";}
break;case 12:switch(c){case 62:if(nsubs==0)parent.addChild(Xml.createPCData(""));return p;default:throw"Expected >";}
break;case 10:if(!(c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57||c==58||c==46||c==95||c==45)){if(start==p)throw"Expected node name";var v=str.substr(start,p-start);if(v!=parent.getNodeName())throw"Expected </"+parent.getNodeName()+">";state=0;next=12;continue;}
break;case 15:if(c==45&&str.charCodeAt(p+1)==45&&str.charCodeAt(p+2)==62){parent.addChild(Xml.createComment(str.substr(start,p-start)));p+=2;state=1;}
break;case 16:if(c==91)nbrackets++;else if(c==93)nbrackets--;else if(c==62&&nbrackets==0){parent.addChild(Xml.createDocType(str.substr(start,p-start)));state=1;}
break;case 14:if(c==63&&str.charCodeAt(p+1)==62){p++;var str1=str.substr(start+1,p-start-2);parent.addChild(Xml.createProlog(str1));state=1;}
break;}
c=str.charCodeAt(++p);}
if(state==1){start=p;state=13;}
if(state==13){if(p!=start||nsubs==0)parent.addChild(Xml.createPCData(str.substr(start,p-start)));return p;}
throw"Unexpected end";}
haxe.xml.Parser.isValidChar=function(c){return c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57||c==58||c==46||c==95||c==45;}
haxe.xml.Parser.prototype={__class__:haxe.xml.Parser}
jabber.JID=function(t){if(t!=null){if(!jabber.JIDUtil.isValid(t))throw"invalid JID ["+t+"]";this.node=t.substr(0,t.indexOf("@"));this.domain=jabber.JIDUtil.domain(t);this.resource=jabber.JIDUtil.resource(t);}};jabber.JID.__name__=["jabber","JID"];jabber.JID.prototype={node:null,domain:null,resource:null,getBare:function(){return this.node==null||this.domain==null?null:this.node+"@"+this.domain;},toString:function(){var j=this.getBare();return j==null?null:this.resource==null?j:j+"/"+this.resource;},__class__:jabber.JID}
jabber.JIDUtil=function(){}
jabber.JIDUtil.__name__=["jabber","JIDUtil"];jabber.JIDUtil.isValid=function(t){if(t==null||t.length<8||t.length>3071)return false;if(!jabber.JIDUtil.EREG.match(t))return false;var _g=0,_g1=jabber.JIDUtil.parts(t);while(_g<_g1.length){var p=_g1[_g];++_g;if(p.length>1023)return false;}
return true;}
jabber.JIDUtil.node=function(t){return t.substr(0,t.indexOf("@"));}
jabber.JIDUtil.domain=function(t){var i1=t.indexOf("@")+1;var i2=t.indexOf("/");return i2==-1?t.substr(i1):t.substr(i1,i2-i1);}
jabber.JIDUtil.resource=function(t){var i=t.indexOf("/");return i==-1?null:t.substr(i+1);}
jabber.JIDUtil.hasResource=function(t){return t.indexOf("/")!=-1;}
jabber.JIDUtil.parts=function(jid){var p=[jid.substr(0,jid.indexOf("@")),jabber.JIDUtil.domain(jid)];if(jid.indexOf("/")!=-1)p.push(jabber.JIDUtil.resource(jid));return p;}
jabber.JIDUtil.prototype={__class__:jabber.JIDUtil}
jabber.Stream=function(cnx,maxBufSize){this.maxBufSize=maxBufSize==null||maxBufSize<1?jabber.Stream.defaultMaxBufSize:maxBufSize;this.cleanup();if(cnx!=null)this.setConnection(cnx);};jabber.Stream.__name__=["jabber","Stream"];jabber.Stream.prototype={onOpen:function(){},onClose:function(error){},status:null,cnx:null,features:null,server:null,id:null,lang:null,jid:null,dataFilters:null,dataInterceptors:null,bufSize:null,maxBufSize:null,buf:null,collectors_id:null,collectors:null,interceptors:null,numPacketsSent:null,setJID:function(j){if(this.status!=jabber.stream.Status.closed)throw"cannot change jid on open xmpp stream";return this.jid=j;},setConnection:function(c){switch((this.status)[1]){case 3:case 1:case 2:this.close(true);this.setConnection(c);this.open(this.jid);break;case 0:if(this.cnx!=null&&this.cnx.connected)this.cnx.disconnect();this.resetBuffer();this.cnx=c;this.cnx.__onConnect=FunctionHelper.bind(this.handleConnect,this);this.cnx.__onDisconnect=FunctionHelper.bind(this.handleDisconnect,this);this.cnx.__onString=FunctionHelper.bind(this.handleString,this);this.cnx.__onData=FunctionHelper.bind(this.handleData,this);break;}
return this.cnx;},nextID:function(){return jabber.util.Base64.random(jabber.Stream.defaultPacketIdLength);},open:function(jid){if(jid!=null)this.setJID(jid);else if(this.jid==null)this.setJID(new jabber.JID(null));if(this.cnx==null)throw"no stream connection set";if(this.cnx.connected)this.handleConnect();else this.cnx.connect();},close:function(disconnect){if(disconnect==null)disconnect=false;if(this.status==jabber.stream.Status.closed)return;if(!this.cnx.http)this.sendData("</stream:stream>");if(disconnect||this.cnx.http)this.cnx.disconnect();this.handleDisconnect(null);},sendPacket:function(p,intercept){if(intercept==null)intercept=true;if(!this.cnx.connected)return null;if(intercept)this.interceptPacket(p);return this.sendData(p.toString())!=null?p:null;},sendData:function(t){if(!this.cnx.connected)return null;if(this.dataInterceptors.length>0){if(this.sendBytes(haxe.io.Bytes.ofString(t+"\n"))==null)return null;}else if(!this.cnx.write(t))return null;this.numPacketsSent++;return t;},sendBytes:function(bytes){var _g=0,_g1=this.dataInterceptors;while(_g<_g1.length){var i=_g1[_g];++_g;bytes=i.interceptData(bytes);}
if(!this.cnx.writeBytes(bytes))return null;return bytes;},sendIQ:function(iq,handler){if(iq.id==null)iq.id=this.nextID();var c=null;if(handler!=null)c=this.addIDCollector(iq.id,handler);var s=this.sendPacket(iq);if(s==null&&handler!=null){ArrayHelper.remove(this.collectors,c);c=null;return null;}
return iq;},sendPresence:function(show,status,priority,type){return this.sendPacket(new xmpp.Presence(show,status,priority,type));},interceptPacket:function(p){var _g=0,_g1=this.interceptors;while(_g<_g1.length){var i=_g1[_g];++_g;i.interceptPacket(p);}
return p;},collect:function(filters,handler,permanent){if(permanent==null)permanent=false;var c=new jabber.stream.PacketCollector(filters,handler,permanent);return this.addCollector(c)?c:null;},addIDCollector:function(id,handler){var c=new jabber.stream.PacketCollector([new xmpp.filter.PacketIDFilter(id)],handler);this.collectors_id.push(c);return c;},addCollector:function(c){if(Lambda.has(this.collectors,c))return false;this.collectors.push(c);return true;},removeCollector:function(c){if(!ArrayHelper.remove(this.collectors,c)){if(!ArrayHelper.remove(this.collectors_id,c))return false;}
return true;},handleData:function(bytes){if(this.status==jabber.stream.Status.closed)return false;var _g=0,_g1=this.dataFilters;while(_g<_g1.length){var f=_g1[_g];++_g;bytes=f.filterData(bytes);}
return this.handleString(bytes.toString());},handleString:function(t){if(this.status==jabber.stream.Status.closed)throw"stream is closed";if(t.charCodeAt(t.length-1)!=62){this.buffer(t);return false;}
if(StringTools.startsWith(t,"</stream:stream")){this.close(this.cnx.connected);return true;}else if(StringTools.startsWith(t,"</stream:error")){this.close(this.cnx.connected);return true;}
this.buffer(t);if(this.bufSize>this.maxBufSize)this.close(false);switch((this.status)[1]){case 0:return false;case 1:if(this.processStreamInit(this.buf.b.join(""))){this.resetBuffer();return true;}else return false;break;case 2:var x=null;try{x=Xml.parse(t).firstElement();}catch(e){this.cnx.disconnect();return true;}
if(x.getNodeName()!="proceed"||x.get("xmlns")!="urn:ietf:params:xml:ns:xmpp-tls"){this.cnx.disconnect();return true;}
var me=this;this.cnx.__onSecured=function(err){if(err!=null)me.handleStreamClose("TLS failed ["+err+"]");me.open(null);};this.cnx.setSecure();return true;case 3:var x=null;try{x=Xml.parse(this.buf.b.join(""));}catch(e){return false;}
this.resetBuffer();this.handleXml(x);return true;}
return true;},handleXml:function(x){var ps=new Array();var $it0=x.elements();while($it0.hasNext()){var e=$it0.next();var p=xmpp.Packet.parse(e);if(p!=null&&this.handlePacket(p))ps.push(p);}
return ps;},handlePacket:function(p){var i=-1;while(++i<this.collectors_id.length){var c=this.collectors_id[i];if(c.accept(p)){this.collectors_id.splice(i,1);c.deliver(p);c=null;return true;}}
var collected=false;i=-1;while(++i<this.collectors.length){var c=this.collectors[i];if(c.accept(p)){collected=true;if(!c.permanent)this.collectors.splice(i,1);c.deliver(p);if(c.block)break;}}
if(!collected){if(p._type==xmpp.PacketType.iq){var q=p;if(q.type!=xmpp.IQType.error){var r=new xmpp.IQ(xmpp.IQType.error,p.id,p.from,p.to);r.errors.push(new xmpp.Error(xmpp.ErrorType.cancel,"feature-not-implemented"));this.sendData(r.toString());}}}
return collected;},buffer:function(t){this.buf.add(t);this.bufSize+=t.length;},resetBuffer:function(){this.buf=new StringBuf();this.bufSize=0;},processStreamInit:function(t){return false;},handleConnect:function(){haxe.Log.trace("connected",{fileName:"Stream.hx",lineNumber:505,className:"jabber.Stream",methodName:"handleConnect",customParams:["info"]});},handleDisconnect:function(e){this.handleStreamClose(e);},handleStreamOpen:function(){this.onOpen();},handleStreamClose:function(e){this.resetBuffer();this.cleanup();this.onClose(e);},cleanup:function(){this.status=jabber.stream.Status.closed;this.server={features:new Hash()};this.features=new jabber._Stream.StreamFeatures();this.collectors=new Array();this.collectors_id=new Array();this.interceptors=new Array();this.dataFilters=new Array();this.dataInterceptors=new Array();this.numPacketsSent=0;},__class__:jabber.Stream,__properties__:{set_jid:"setJID",set_cnx:"setConnection"}}
if(!jabber._Stream)jabber._Stream={}
jabber._Stream.StreamFeatures=function(){this.l=new Array();};jabber._Stream.StreamFeatures.__name__=["jabber","_Stream","StreamFeatures"];jabber._Stream.StreamFeatures.prototype={l:null,add:function(f){if(Lambda.has(this.l,f))return false;this.l.push(f);return true;},__class__:jabber._Stream.StreamFeatures}
var xmpp=xmpp||{}
xmpp.ErrorPacket=function(condition,text,lang,app){this.condition=condition;this.text=text;this.lang=lang;this.app=app;};xmpp.ErrorPacket.__name__=["xmpp","ErrorPacket"];xmpp.ErrorPacket.parseInto=function(p,x,xmlns){var $it0=x.elements();while($it0.hasNext()){var e=$it0.next();var ns=e.get("xmlns");if(ns==null)return false;switch(e.getNodeName()){case"text":if(ns==xmlns){var c=e.firstChild();if(c!=null)p.text=c.getNodeValue();p.lang=e.get("xml:lang");}
break;default:if(ns==xmlns)p.condition=e.getNodeName();else p.app={condition:e.getNodeName(),xmlns:ns};}}
return true;}
xmpp.ErrorPacket.prototype={condition:null,text:null,lang:null,app:null,_toXml:function(p,ns){var x=Xml.createElement(p);var c=Xml.createElement(this.condition);xmpp.XMLUtil.ns(c,ns);x.addChild(c);if(this.text!=null){var t=xmpp.XMLUtil.createElement("text",this.text);t.set("xmlns",ns);if(this.lang!=null)t.set("lang",this.lang);x.addChild(t);}
if(this.app!=null&&this.app.condition!=null&&this.app.xmlns!=null){var a=Xml.createElement(this.app.condition);xmpp.XMLUtil.ns(a,this.app.xmlns);x.addChild(a);}
return x;},__class__:xmpp.ErrorPacket}
xmpp.Error=function(type,condition,code,text,lang,app){xmpp.ErrorPacket.call(this,condition,text,lang,app);this.type=type;this.code=code;};xmpp.Error.__name__=["xmpp","Error"];xmpp.Error.parse=function(x){var p=new xmpp.Error(null,null);if(!xmpp.ErrorPacket.parseInto(p,x,xmpp.Error.XMLNS))return null;try{p.type=Type.createEnum(xmpp.ErrorType,x.get("type").toLowerCase());var v=x.get("code");if(v!=null)p.code=Std.parseInt(v);}catch(e){return null;}
return p;}
xmpp.Error.__super__=xmpp.ErrorPacket;xmpp.Error.prototype=$extend(xmpp.ErrorPacket.prototype,{type:null,code:null,toXml:function(){var x=this._toXml("error",xmpp.Error.XMLNS);x.set("type",this.type[0]);if(this.code!=null)x.set("code",Std.string(this.code));return x;},__class__:xmpp.Error});jabber.XMPPError=function(p){var e=p.errors[0];xmpp.Error.call(this,e.type,e.condition,e.code,e.text);this.from=p.from;};jabber.XMPPError.__name__=["jabber","XMPPError"];jabber.XMPPError.__super__=xmpp.Error;jabber.XMPPError.prototype=$extend(xmpp.Error.prototype,{from:null,__class__:jabber.XMPPError});if(!jabber.client)jabber.client={}
jabber.client.AuthenticationBase=function(s){this.stream=s;};jabber.client.AuthenticationBase.__name__=["jabber","client","AuthenticationBase"];jabber.client.AuthenticationBase.prototype={onSuccess:function(){},onFail:function(info){},resource:null,stream:null,start:function(password,resource){return false;},__class__:jabber.client.AuthenticationBase}
jabber.client.Authentication=function(stream,mechanisms){jabber.client.AuthenticationBase.call(this,stream);var x=stream.server.features.get("mechanisms");if(x==null)throw"server does not support SASL";if(mechanisms==null||Lambda.count(mechanisms)==0)throw"missing SASL mechanisms";this.serverMechanisms=xmpp.SASL.parseMechanisms(x);this.mechanisms=new Array();var $it0=ArrayHelper.iter(mechanisms)();while($it0.hasNext()){var m=$it0.next();this.mechanisms.push(m);}};jabber.client.Authentication.__name__=["jabber","client","Authentication"];jabber.client.Authentication.__super__=jabber.client.AuthenticationBase;jabber.client.Authentication.prototype=$extend(jabber.client.AuthenticationBase.prototype,{onNegotiated:function(){},mechanisms:null,serverMechanisms:null,mechanism:null,onStreamOpenHandler:null,c_challenge:null,c_fail:null,c_success:null,start:function(password,resource){this.resource=resource;if(this.stream.jid!=null&&resource!=null)this.stream.jid.resource=resource;if(this.mechanism==null){var _g=0,_g1=this.serverMechanisms;while(_g<_g1.length){var s_mechs=_g1[_g];++_g;var _g2=0,_g3=this.mechanisms;while(_g2<_g3.length){var m=_g3[_g2];++_g2;if(m.id!=s_mechs)continue;this.mechanism=m;break;}
if(this.mechanism!=null)break;}}
if(this.mechanism==null)return false;this.c_fail=this.stream.collect([new xmpp.filter.PacketNameFilter(xmpp.SASL.EREG_FAILURE)],FunctionHelper.bind(this.handleSASLFailed,this));this.c_success=this.stream.collect([new xmpp.filter.PacketNameFilter(new EReg("success",""))],FunctionHelper.bind(this.handleSASLSuccess,this));this.c_challenge=this.stream.collect([new xmpp.filter.PacketNameFilter(new EReg("challenge",""))],FunctionHelper.bind(this.handleSASLChallenge,this),true);var t=this.mechanism.createAuthenticationText(this.stream.jid.node,this.stream.jid.domain,password,this.stream.jid.resource);if(t!=null)t=jabber.util.Base64.encode(t);return this.stream.sendData(xmpp.SASL.createAuth(this.mechanism.id,t).toString())!=null;},handleSASLFailed:function(p){this.removeSASLCollectors();var info=null;var c=p.toXml().firstChild();if(c!=null)info=c.getNodeName();this.onFail(info);},handleSASLChallenge:function(p){var c=p.toXml().firstChild().getNodeValue();var r=jabber.util.Base64.encode(this.mechanism.createChallengeResponse(c));this.stream.sendData(xmpp.SASL.createResponse(r).toString());},handleSASLSuccess:function(p){this.removeSASLCollectors();this.onStreamOpenHandler=($_=this.stream,FunctionHelper.bind($_.onOpen,$_));this.stream.onOpen=FunctionHelper.bind(this.handleStreamOpen,this);this.onNegotiated();this.stream.open(null);},handleStreamOpen:function(){this.stream.onOpen=this.onStreamOpenHandler;if(this.stream.server.features.exists("bind")){var iq=new xmpp.IQ(xmpp.IQType.set);iq.x=new xmpp.Bind(this.mechanism.id=="ANONYMOUS"?null:this.resource);this.stream.sendIQ(iq,FunctionHelper.bind(this.handleBind,this));}else this.onSuccess();},handleBind:function(iq){switch((iq.type)[1]){case 2:var b=xmpp.Bind.parse(iq.x.toXml());var p=jabber.JIDUtil.parts(b.jid);this.stream.jid.node=p[0];this.stream.jid.domain=p[1];this.stream.jid.resource=p[2];if(this.stream.server.features.exists("session")){var iq1=new xmpp.IQ(xmpp.IQType.set);iq1.x=new xmpp.PlainPacket(Xml.parse("<session xmlns=\"urn:ietf:params:xml:ns:xmpp-session\"/>").firstElement());this.stream.sendIQ(iq1,FunctionHelper.bind(this.handleSession,this));}else this.onSuccess();break;case 3:haxe.Log.trace(iq.errors,{fileName:"Authentication.hx",lineNumber:157,className:"jabber.client.Authentication",methodName:"handleBind"});this.onFail(iq.errors[0].condition);break;default:}},handleSession:function(iq){switch((iq.type)[1]){case 2:this.onSuccess();break;case 3:haxe.Log.trace(iq.errors,{fileName:"Authentication.hx",lineNumber:169,className:"jabber.client.Authentication",methodName:"handleSession"});this.onFail(iq.errors[0].condition);break;default:}},removeSASLCollectors:function(){this.stream.removeCollector(this.c_challenge);this.c_challenge=null;this.stream.removeCollector(this.c_fail);this.c_fail=null;this.stream.removeCollector(this.c_success);this.c_success=null;},__class__:jabber.client.Authentication});jabber.client.MUCOccupant=function(){};jabber.client.MUCOccupant.__name__=["jabber","client","MUCOccupant"];jabber.client.MUCOccupant.prototype={nick:null,jid:null,presence:null,role:null,affiliation:null,__class__:jabber.client.MUCOccupant}
jabber.client.MUChat=function(stream,host,roomName){this.stream=stream;this.jid=roomName+"@"+host;this.room=roomName;stream.features.add(xmpp.Packet.PROTOCOL+"/muc");stream.features.add(xmpp.MUCUser.XMLNS);var f_from=new xmpp.filter.PacketFromContainsFilter(this.jid);this.c_presence=new jabber.stream.PacketCollector([f_from,new xmpp.filter.PacketTypeFilter(xmpp.PacketType.presence)],FunctionHelper.bind(this.handlePresence,this),true);this.c_message=new jabber.stream.PacketCollector([f_from,new xmpp.filter.MessageFilter()],FunctionHelper.bind(this.handleMessage,this),true);this.message=new xmpp.Message(this.jid,null,null,xmpp.MessageType.groupchat,null);this.joined=false;this.occupants=new Array();};jabber.client.MUChat.__name__=["jabber","client","MUChat"];jabber.client.MUChat.prototype={onJoin:function(){},onLeave:function(){},onMessage:function(o,m){},onPresence:function(o){},onSubject:function(t){},onError:function(e){},jid:null,room:null,joined:null,myjid:null,nick:null,password:null,role:null,affiliation:null,occupants:null,subject:null,me:null,stream:null,presence:null,message:null,c_presence:null,c_message:null,getMe:function(){var o=new jabber.client.MUCOccupant();o.role=this.role;o.presence=this.presence;o.nick=this.nick;o.jid=this.myjid;o.affiliation=this.affiliation;return o;},getOccupant:function(nick){var _g=0,_g1=this.occupants;while(_g<_g1.length){var o=_g1[_g];++_g;if(o.nick==nick)return o;}
return null;},join:function(nick,password){if(this.joined||nick==null||nick.length==0)return false;this.stream.addCollector(this.c_presence);this.stream.addCollector(this.c_message);this.nick=nick;this.password=password;this.myjid=this.jid+"/"+nick;return this.sendMyPresence()!=null;},speak:function(t,properties){if(!this.joined)return null;this.message.properties=properties==null?[]:properties;this.message.subject=null;this.message.body=t;return this.stream.sendPacket(this.message);},changeNick:function(t){if(!this.joined)return null;if(t==null||t.length==0)throw"invalid nickname";this.nick=t;this.myjid=this.jid+"/"+this.nick;return this.sendMyPresence();},handleMessage:function(m){switch((m.type)[1]){case 3:var from=this.getOccupantName(m.from);if(m.subject!=null){if(m.subject==this.subject)return;this.onSubject(this.subject=m.subject);return;}
var occupant=this.getOccupant(from);if(occupant==null&&from!=this.jid&&from!=this.nick){this.onMessage(null,m);return;}
if(occupant==null&&from==this.nick)occupant=this.getMe();this.onMessage(occupant,m);break;case 1:haxe.Log.trace("TODO handle muc error",{fileName:"MUChat.hx",lineNumber:263,className:"jabber.client.MUChat",methodName:"handleMessage"});break;default:}},handlePresence:function(p){if(p.type==xmpp.PresenceType.error){this.onError(new jabber.XMPPError(p));return;}
var x_user=null;var _g=0,_g1=p.properties;while(_g<_g1.length){var property=_g1[_g];++_g;if(property.getNodeName()=="x"&&property.get("xmlns")==xmpp.MUCUser.XMLNS)x_user=xmpp.MUCUser.parse(p.properties[0]);}
if(x_user==null)return;switch(p.from){case this.myjid:if(p.type==null){if(!this.joined){if(x_user.item!=null){if(x_user.item.role!=null)this.role=x_user.item.role;if(x_user.item.affiliation!=null)this.affiliation=x_user.item.affiliation;}
if(x_user.item.role==xmpp.muc.Role.moderator&&x_user.status!=null&&x_user.status.code==201){var iq=new xmpp.IQ(xmpp.IQType.set,null,this.jid);var q=new xmpp.MUCOwner().toXml();q.addChild(new xmpp.DataForm(xmpp.dataform.FormType.submit).toXml());iq.properties.push(q);var self=this;this.stream.sendIQ(iq,function(r){if(r.type==xmpp.IQType.result){self.joined=true;self.onJoin();}});}else{this.joined=true;this.onJoin();}}else{this.role=x_user.item.role;this.affiliation=x_user.item.affiliation;this.presence=p;this.onPresence(this.getMe());}
return;}
switch((p.type)[1]){case 4:this.joined=false;this.destroy();break;default:haxe.Log.trace("##############",{fileName:"MUChat.hx",lineNumber:327,className:"jabber.client.MUChat",methodName:"handlePresence"});}
break;case this.jid:haxe.Log.trace("??? process presence from MUC room ???",{fileName:"MUChat.hx",lineNumber:330,className:"jabber.client.MUChat",methodName:"handlePresence"});break;default:var from=this.getOccupantName(p.from);var occupant=this.getOccupant(from);if(occupant!=null){if(p.type==xmpp.PresenceType.unavailable)ArrayHelper.remove(this.occupants,occupant);}else{occupant=new jabber.client.MUCOccupant();occupant.nick=from;this.occupants.push(occupant);}
occupant.presence=p;if(x_user.item!=null){if(x_user.item.role!=null)occupant.role=x_user.item.role;if(x_user.item.affiliation!=null)occupant.affiliation=x_user.item.affiliation;}
this.onPresence(occupant);}},sendMyPresence:function(priority){if(priority==null)priority=5;var x=xmpp.X.create(xmpp.Packet.PROTOCOL+"/muc");if(this.password!=null)x.addChild(xmpp.XMLUtil.createElement("password",this.password));var p=new xmpp.Presence(null,null,priority);p.to=this.myjid;p.properties.push(x);return this.stream.sendPacket(p);},getOccupantName:function(j){return j.substr(j.lastIndexOf("/")+1);},destroy:function(){this.stream.removeCollector(this.c_presence);this.stream.removeCollector(this.c_message);this.occupants=new Array();this.role=null;this.affiliation=null;this.presence=null;this.myjid=null;this.room=null;this.onLeave();},__class__:jabber.client.MUChat,__properties__:{get_me:"getMe"}}
jabber.client.Stream=function(cnx,maxBufSize){jabber.Stream.call(this,cnx,maxBufSize);this.setJID(this.jid);this.version=true;};jabber.client.Stream.__name__=["jabber","client","Stream"];jabber.client.Stream.__super__=jabber.Stream;jabber.client.Stream.prototype=$extend(jabber.Stream.prototype,{version:null,handleConnect:function(){var wasOpen=this.status==jabber.stream.Status.open;this.status=jabber.stream.Status.pending;if(!this.cnx.http){this.sendData(xmpp.Stream.createOpenXml(xmpp.Stream.CLIENT,this.jid.domain,this.version,this.lang));if(!wasOpen)this.cnx.read(true);}else if(this.cnx.connected)this.cnx.connect();},processStreamInit:function(t){if(this.cnx.http){var x=null;try{x=Xml.parse(t).firstElement();}catch(e){return false;}
this.parseServerStreamFeatures(x.getNodeName()=="body"?x.firstElement():x);this.status=jabber.stream.Status.open;this.handleStreamOpen();return true;}else{var r=new EReg("^(<\\?xml) (.)+\\?>","");if(r.match(t))t=r.matchedRight();var sei=t.indexOf(">");if(sei==-1)return false;if(this.id==null){var s=t.substr(0,sei)+" />";var sx=Xml.parse(s).firstElement();this.id=sx.get("id");if(!this.version){this.status=jabber.stream.Status.open;this.handleStreamOpen();return true;}}
if(this.id==null){this.close(true);this.onClose("invalid stream id");return false;}
if(!this.version){this.status=jabber.stream.Status.open;this.handleStreamOpen();return true;}}
var sfi=t.indexOf("<stream:features>");if(sfi!=-1){var sf=t.substr(sfi);var x;try{x=Xml.parse(sf).firstElement();}catch(e){return false;}
this.parseServerStreamFeatures(x);if(this.cnx.secure&&!this.cnx.secured&&this.server.features.get("starttls")!=null){this.status=jabber.stream.Status.starttls;this.sendData("<starttls xmlns=\"urn:ietf:params:xml:ns:xmpp-tls\"/>");}else{this.status=jabber.stream.Status.open;this.handleStreamOpen();}
return true;}
return false;},parseServerStreamFeatures:function(x){var $it0=x.elements();while($it0.hasNext()){var e=$it0.next();this.server.features.set(e.getNodeName(),e);}},__class__:jabber.client.Stream});if(!jabber.sasl)jabber.sasl={}
jabber.sasl.AnonymousMechanism=function(challengeResponse){if(challengeResponse==null)challengeResponse="any";this.id="ANONYMOUS";this.challengeResponse=challengeResponse;};jabber.sasl.AnonymousMechanism.__name__=["jabber","sasl","AnonymousMechanism"];jabber.sasl.AnonymousMechanism.prototype={id:null,challengeResponse:null,createAuthenticationText:function(user,host,pass,resource){return null;},createChallengeResponse:function(c){return this.challengeResponse;},__class__:jabber.sasl.AnonymousMechanism}
jabber.stream.PacketCollector=function(filters,handler,permanent,block){if(block==null)block=false;if(permanent==null)permanent=false;this.handlers=new Array();this.filters=new jabber.stream._PacketCollector.FilterList();var $it0=ArrayHelper.iter(filters)();while($it0.hasNext()){var f=$it0.next();this.filters.push(f);}
if(handler!=null)this.handlers.push(handler);this.permanent=permanent;this.block=block;};jabber.stream.PacketCollector.__name__=["jabber","stream","PacketCollector"];jabber.stream.PacketCollector.prototype={filters:null,handlers:null,permanent:null,block:null,accept:function(p){var $it0=ArrayHelper.iter(this.filters)();while($it0.hasNext()){var f=$it0.next();if(!f.accept(p))return false;}
return true;},deliver:function(p){var _g=0,_g1=this.handlers;while(_g<_g1.length){var h=_g1[_g];++_g;h(p);}},__class__:jabber.stream.PacketCollector}
if(!jabber.stream._PacketCollector)jabber.stream._PacketCollector={}
jabber.stream._PacketCollector.FilterList=function(){this.clear();};jabber.stream._PacketCollector.FilterList.__name__=["jabber","stream","_PacketCollector","FilterList"];jabber.stream._PacketCollector.FilterList.prototype={fid:null,f:null,clear:function(){this.fid=new Array();this.f=new Array();},iterator:function(){return ArrayHelper.get_iterator(this.fid.concat(this.f));},push:function(_f){if(Std["is"](_f,xmpp.filter.PacketIDFilter))this.fid.push(_f);else this.f.push(_f);},__class__:jabber.stream._PacketCollector.FilterList}
jabber.stream.Status={__ename__:["jabber","stream","Status"],__constructs__:["closed","pending","starttls","open"]}
jabber.stream.Status.closed=["closed",0];jabber.stream.Status.closed.toString=$estr;jabber.stream.Status.closed.__enum__=jabber.stream.Status;jabber.stream.Status.pending=["pending",1];jabber.stream.Status.pending.toString=$estr;jabber.stream.Status.pending.__enum__=jabber.stream.Status;jabber.stream.Status.starttls=["starttls",2];jabber.stream.Status.starttls.toString=$estr;jabber.stream.Status.starttls.__enum__=jabber.stream.Status;jabber.stream.Status.open=["open",3];jabber.stream.Status.open.toString=$estr;jabber.stream.Status.open.__enum__=jabber.stream.Status;if(!jabber.util)jabber.util={}
jabber.util.Base64=function(){}
jabber.util.Base64.__name__=["jabber","util","Base64"];jabber.util.Base64.getNullbits=function(s){var n=s.length%3;if(n==0)return"";var r="";var _g=n;while(_g<3){var i=_g++;r+="=";}
return r;}
jabber.util.Base64.removeNullbits=function(s){var p=s.length-1;while(s.charAt(p)=="=")p--;return s.substr(0,p+1);}
jabber.util.Base64.encode=function(s){s=jabber.util.Base64.removeNullbits(s);var p=jabber.util.Base64.getNullbits(s);var r=jabber.util.Base64.bc.encodeString(s);return r+p;}
jabber.util.Base64.random=function(len,chars){if(len==null)len=1;var n=null;if(chars==null){chars=jabber.util.Base64.CHARS;n=jabber.util.Base64.CHARS.length-2;}else n=chars.length;var s="";var _g=0;while(_g<len){var i=_g++;s+=chars.charAt(Std.random(n));}
return s;}
jabber.util.Base64.prototype={__class__:jabber.util.Base64}
var js=js||{}
js.Boot=function(){}
js.Boot.__name__=["js","Boot"];js.Boot.__unhtml=function(s){return s.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;");}
js.Boot.__trace=function(v,i){var msg=i!=null?i.fileName+":"+i.lineNumber+": ":"";msg+=js.Boot.__string_rec(v,"");var d=document.getElementById("haxe:trace");if(d!=null)d.innerHTML+=js.Boot.__unhtml(msg)+"<br/>";else if(typeof(console)!="undefined"&&console.log!=null)console.log(msg);}
js.Boot.__string_rec=function(o,s){if(o==null)return"null";if(s.length>=5)return"<...>";var t=typeof(o);if(t=="function"&&(o.__name__!=null||o.__ename__!=null))t="object";switch(t){case"object":if(o instanceof Array){if(o.__enum__!=null){if(o.length==2)return o[0];var str=o[0]+"(";s+="\t";var _g1=2,_g=o.length;while(_g1<_g){var i=_g1++;if(i!=2)str+=","+js.Boot.__string_rec(o[i],s);else str+=js.Boot.__string_rec(o[i],s);}
return str+")";}
var l=o.length;var i;var str="[";s+="\t";var _g=0;while(_g<l){var i1=_g++;str+=(i1>0?",":"")+js.Boot.__string_rec(o[i1],s);}
str+="]";return str;}
var tostr;try{tostr=o.toString;}catch(e){return"???";}
if(tostr!=null&&tostr!=Object.toString){var s2=o.toString();if(s2!="[object Object]")return s2;}
var k=null;var str="{\n";s+="\t";var hasp=o.hasOwnProperty!=null;for(var k in o){;if(hasp&&!o.hasOwnProperty(k)){continue;}
if(k=="prototype"||k=="__class__"||k=="__super__"||k=="__interfaces__"||k=="__properties__"){continue;}
if(str.length!=2)str+=", \n";str+=s+k+" : "+js.Boot.__string_rec(o[k],s);}
s=s.substring(1);str+="\n"+s+"}";return str;case"function":return"<function>";case"string":return o;default:return String(o);}}
js.Boot.__interfLoop=function(cc,cl){if(cc==null)return false;if(cc==cl)return true;var intf=cc.__interfaces__;if(intf!=null){var _g1=0,_g=intf.length;while(_g1<_g){var i=_g1++;var i1=intf[i];if(i1==cl||js.Boot.__interfLoop(i1,cl))return true;}}
return js.Boot.__interfLoop(cc.__super__,cl);}
js.Boot.__instanceof=function(o,cl){try{if(o instanceof cl){if(cl==Array)return o.__enum__==null;return true;}
if(js.Boot.__interfLoop(o.__class__,cl))return true;}catch(e){if(cl==null)return false;}
switch(cl){case Int:return Math.ceil(o%2147483648.0)===o;case Float:return typeof(o)=="number";case Bool:return o===true||o===false;case String:return typeof(o)=="string";case Dynamic:return true;default:if(o==null)return false;return o.__enum__==cl||cl==Class&&o.__name__!=null||cl==Enum&&o.__ename__!=null;}}
js.Boot.__init=function(){js.Lib.isIE=typeof document!='undefined'&&document.all!=null&&typeof window!='undefined'&&window.opera==null;js.Lib.isOpera=typeof window!='undefined'&&window.opera!=null;}
js.Boot.prototype={__class__:js.Boot}
js.Lib=function(){}
js.Lib.__name__=["js","Lib"];js.Lib.isIE=null;js.Lib.isOpera=null;js.Lib.document=null;js.Lib.window=null;js.Lib.prototype={__class__:js.Lib}
xmpp.Bind=function(resource,jid){this.resource=resource;this.jid=jid;};xmpp.Bind.__name__=["xmpp","Bind"];xmpp.Bind.parse=function(x){var b=new xmpp.Bind();var $it0=x.elements();while($it0.hasNext()){var e=$it0.next();var v=e.firstChild().getNodeValue();switch(e.getNodeName()){case"resource":b.resource=v;break;case"jid":b.jid=v;break;}}
return b;}
xmpp.Bind.prototype={resource:null,jid:null,toXml:function(){var x=Xml.createElement("bind");xmpp.XMLUtil.ns(x,xmpp.Bind.XMLNS);xmpp.XMLUtil.addField(x,this,"jid");xmpp.XMLUtil.addField(x,this,"resource");return x;},__class__:xmpp.Bind}
xmpp.DataForm=function(type){this.type=type;this.fields=new Array();this.items=new Array();};xmpp.DataForm.__name__=["xmpp","DataForm"];xmpp.DataForm.prototype={type:null,fields:null,reported:null,items:null,toXml:function(){var x=Xml.createElement("x");xmpp.XMLUtil.ns(x,xmpp.DataForm.XMLNS);if(this.type!=null)x.set("type",this.type[0]);xmpp.XMLUtil.addField(x,this,"title");xmpp.XMLUtil.addField(x,this,"instructions");var _g=0,_g1=this.fields;while(_g<_g1.length){var f=_g1[_g];++_g;x.addChild(f.toXml());}
if(this.reported!=null)x.addChild(this.reported.toXml());var _g=0,_g1=this.items;while(_g<_g1.length){var i=_g1[_g];++_g;x.addChild(i.toXml());}
return x;},__class__:xmpp.DataForm}
xmpp.DateTime=function(){}
xmpp.DateTime.__name__=["xmpp","DateTime"];xmpp.DateTime.toDate=function(utc,offset){if(offset==null)offset=0;var p=xmpp.DateTime.getParts(utc);return new Date(p[0],p[1],p[2],p[3],p[4],p[5]);}
xmpp.DateTime.getParts=function(utc){var r=xmpp.DateTime.EREG_DATE;if(!r.match(utc))return null;var t=r.matched(4);t=t.substr(1,t.length-2);var time=t.split(":");return[Std.parseInt(r.matched(1)),Std.parseInt(r.matched(2)),Std.parseInt(r.matched(3)),Std.parseInt(time[0]),Std.parseInt(time[1]),Std.parseInt(time[2])];}
xmpp.DateTime.prototype={__class__:xmpp.DateTime}
xmpp.Delayed=function(){}
xmpp.Delayed.__name__=["xmpp","Delayed"];xmpp.Delayed.fromPacket=function(p){var _g=0,_g1=p.properties;while(_g<_g1.length){var e=_g1[_g];++_g;var ns=e.get("xmlns");if(e.getNodeName()=="delay"&&ns==xmpp.Delayed.XMLNS||e.getNodeName()=="x"&&ns=="jabber:x:delay")return xmpp.Delayed.parseDelay(e);}
return null;}
xmpp.Delayed.parseDelay=function(e){return{from:e.get("from"),stamp:e.get("stamp"),description:e.firstChild()!=null?e.firstChild().getNodeValue():null};}
xmpp.Delayed.prototype={__class__:xmpp.Delayed}
xmpp.ErrorType={__ename__:["xmpp","ErrorType"],__constructs__:["auth","cancel","continue_","modify","wait"]}
xmpp.ErrorType.auth=["auth",0];xmpp.ErrorType.auth.toString=$estr;xmpp.ErrorType.auth.__enum__=xmpp.ErrorType;xmpp.ErrorType.cancel=["cancel",1];xmpp.ErrorType.cancel.toString=$estr;xmpp.ErrorType.cancel.__enum__=xmpp.ErrorType;xmpp.ErrorType.continue_=["continue_",2];xmpp.ErrorType.continue_.toString=$estr;xmpp.ErrorType.continue_.__enum__=xmpp.ErrorType;xmpp.ErrorType.modify=["modify",3];xmpp.ErrorType.modify.toString=$estr;xmpp.ErrorType.modify.__enum__=xmpp.ErrorType;xmpp.ErrorType.wait=["wait",4];xmpp.ErrorType.wait.toString=$estr;xmpp.ErrorType.wait.__enum__=xmpp.ErrorType;xmpp.Packet=function(to,from,id,lang){this.to=to;this.from=from;this.id=id;this.lang=lang;this.errors=new Array();this.properties=new Array();};xmpp.Packet.__name__=["xmpp","Packet"];xmpp.Packet.parse=function(x){switch(x.getNodeName()){case"iq":return xmpp.IQ.parse(x);case"message":return xmpp.Message.parse(x);case"presence":return xmpp.Presence.parse(x);default:return new xmpp.PlainPacket(x);}}
xmpp.Packet.parseAttributes=function(p,x){p.to=x.get("to");p.from=x.get("from");p.id=x.get("id");return p;}
xmpp.Packet.prototype={_type:null,to:null,from:null,id:null,lang:null,properties:null,errors:null,toXml:function(){return null;},toString:function(){return this.toXml().toString();},addAttributes:function(x){if(this.to!=null)x.set("to",this.to);if(this.from!=null)x.set("from",this.from);if(this.id!=null)x.set("id",this.id);if(this.lang!=null)x.set("xml:lang",this.lang);var _g=0,_g1=this.properties;while(_g<_g1.length){var p=_g1[_g];++_g;x.addChild(p);}
var _g=0,_g1=this.errors;while(_g<_g1.length){var e=_g1[_g];++_g;if(e==null)continue;x.addChild(e.toXml());}
return x;},__class__:xmpp.Packet}
xmpp.IQ=function(type,id,to,from){xmpp.Packet.call(this,to,from,id);this._type=xmpp.PacketType.iq;this.type=type!=null?type:xmpp.IQType.get;};xmpp.IQ.__name__=["xmpp","IQ"];xmpp.IQ.parse=function(x){var iq=new xmpp.IQ();iq.type=Type.createEnum(xmpp.IQType,x.get("type"));xmpp.Packet.parseAttributes(iq,x);var $it0=x.elements();while($it0.hasNext()){var c=$it0.next();switch(c.getNodeName()){case"error":var e=xmpp.Error.parse(c);if(e!=null)iq.errors.push(e);break;default:iq.properties.push(c);}}
if(iq.properties.length>0)iq.x=new xmpp.PlainPacket(iq.properties.shift());return iq;}
xmpp.IQ.createQueryXml=function(ns,name){if(name==null)name="query";var x=Xml.createElement(name);x.set("xmlns",ns);return x;}
xmpp.IQ.__super__=xmpp.Packet;xmpp.IQ.prototype=$extend(xmpp.Packet.prototype,{type:null,x:null,toXml:function(){var p=xmpp.Packet.prototype.addAttributes.call(this,Xml.createElement("iq"));p.set("type",(this.type==null?xmpp.IQType.get:this.type)[0]);if(this.id!=null)p.set("id",this.id);if(this.x!=null)p.addChild(this.x.toXml());return p;},__class__:xmpp.IQ});xmpp.IQType={__ename__:["xmpp","IQType"],__constructs__:["get","set","result","error"]}
xmpp.IQType.get=["get",0];xmpp.IQType.get.toString=$estr;xmpp.IQType.get.__enum__=xmpp.IQType;xmpp.IQType.set=["set",1];xmpp.IQType.set.toString=$estr;xmpp.IQType.set.__enum__=xmpp.IQType;xmpp.IQType.result=["result",2];xmpp.IQType.result.toString=$estr;xmpp.IQType.result.__enum__=xmpp.IQType;xmpp.IQType.error=["error",3];xmpp.IQType.error.toString=$estr;xmpp.IQType.error.__enum__=xmpp.IQType;xmpp.MUC=function(){}
xmpp.MUC.__name__=["xmpp","MUC"];xmpp.MUC.prototype={__class__:xmpp.MUC}
xmpp.MUCOwner=function(){this.items=new List();};xmpp.MUCOwner.__name__=["xmpp","MUCOwner"];xmpp.MUCOwner.prototype={items:null,toXml:function(){var x=xmpp.IQ.createQueryXml(xmpp.MUCOwner.XMLNS);var $it0=ArrayHelper.iter(this.items)();while($it0.hasNext()){var item=$it0.next();x.addChild(item.toXml());}
return x;},__class__:xmpp.MUCOwner}
xmpp.MUCUser=function(){};xmpp.MUCUser.__name__=["xmpp","MUCUser"];xmpp.MUCUser.parse=function(x){var p=new xmpp.MUCUser();var $it0=x.elements();while($it0.hasNext()){var e=$it0.next();switch(e.getNodeName()){case"item":p.item=xmpp.muc.Item.parse(e);break;case"status":p.status=new xmpp.muc.Status(Std.parseInt(e.get("code")));break;}}
return p;}
xmpp.MUCUser.prototype={item:null,status:null,__class__:xmpp.MUCUser}
xmpp.Message=function(to,body,subject,type,thread,from){this._type=xmpp.PacketType.message;xmpp.Packet.call(this,to,from);this.type=type!=null?type:xmpp.MessageType.chat;this.body=body;this.subject=subject;this.thread=thread;};xmpp.Message.__name__=["xmpp","Message"];xmpp.Message.parse=function(x){var m=new xmpp.Message(null,null,null,x.exists("type")?Type.createEnum(xmpp.MessageType,x.get("type")):null);xmpp.Packet.parseAttributes(m,x);var $it0=x.elements();while($it0.hasNext()){var c=$it0.next();switch(c.getNodeName()){case"subject":m.subject=c.firstChild().getNodeValue();break;case"body":m.body=c.firstChild().getNodeValue();break;case"thread":m.thread=c.firstChild().getNodeValue();break;default:m.properties.push(c);}}
return m;}
xmpp.Message.__super__=xmpp.Packet;xmpp.Message.prototype=$extend(xmpp.Packet.prototype,{type:null,body:null,subject:null,thread:null,toXml:function(){var x=xmpp.Packet.prototype.addAttributes.call(this,Xml.createElement("message"));if(this.type!=null)x.set("type",this.type[0]);if(this.subject!=null)x.addChild(xmpp.XMLUtil.createElement("subject",this.subject));if(this.body!=null)x.addChild(xmpp.XMLUtil.createElement("body",this.body));if(this.thread!=null)x.addChild(xmpp.XMLUtil.createElement("thread",this.thread));var _g=0,_g1=this.properties;while(_g<_g1.length){var p=_g1[_g];++_g;x.addChild(p);}
return x;},__class__:xmpp.Message});xmpp.MessageType={__ename__:["xmpp","MessageType"],__constructs__:["normal","error","chat","groupchat","headline"]}
xmpp.MessageType.normal=["normal",0];xmpp.MessageType.normal.toString=$estr;xmpp.MessageType.normal.__enum__=xmpp.MessageType;xmpp.MessageType.error=["error",1];xmpp.MessageType.error.toString=$estr;xmpp.MessageType.error.__enum__=xmpp.MessageType;xmpp.MessageType.chat=["chat",2];xmpp.MessageType.chat.toString=$estr;xmpp.MessageType.chat.__enum__=xmpp.MessageType;xmpp.MessageType.groupchat=["groupchat",3];xmpp.MessageType.groupchat.toString=$estr;xmpp.MessageType.groupchat.__enum__=xmpp.MessageType;xmpp.MessageType.headline=["headline",4];xmpp.MessageType.headline.toString=$estr;xmpp.MessageType.headline.__enum__=xmpp.MessageType;xmpp.PacketType={__ename__:["xmpp","PacketType"],__constructs__:["iq","message","presence","custom"]}
xmpp.PacketType.iq=["iq",0];xmpp.PacketType.iq.toString=$estr;xmpp.PacketType.iq.__enum__=xmpp.PacketType;xmpp.PacketType.message=["message",1];xmpp.PacketType.message.toString=$estr;xmpp.PacketType.message.__enum__=xmpp.PacketType;xmpp.PacketType.presence=["presence",2];xmpp.PacketType.presence.toString=$estr;xmpp.PacketType.presence.__enum__=xmpp.PacketType;xmpp.PacketType.custom=["custom",3];xmpp.PacketType.custom.toString=$estr;xmpp.PacketType.custom.__enum__=xmpp.PacketType;xmpp.PlainPacket=function(src){xmpp.Packet.call(this);this._type=xmpp.PacketType.custom;this.src=src;};xmpp.PlainPacket.__name__=["xmpp","PlainPacket"];xmpp.PlainPacket.__super__=xmpp.Packet;xmpp.PlainPacket.prototype=$extend(xmpp.Packet.prototype,{src:null,toXml:function(){return this.src;},__class__:xmpp.PlainPacket});xmpp.Presence=function(show,status,priority,type){xmpp.Packet.call(this);this._type=xmpp.PacketType.presence;this.show=show;this.setStatus(status);this.priority=priority;this.type=type;};xmpp.Presence.__name__=["xmpp","Presence"];xmpp.Presence.parse=function(x){var p=new xmpp.Presence(null,x.get("type"));xmpp.Packet.parseAttributes(p,x);if(x.exists("type"))p.type=Type.createEnum(xmpp.PresenceType,x.get("type"));var $it0=x.elements();while($it0.hasNext()){var c=$it0.next();var fc=c.firstChild();switch(c.getNodeName()){case"show":if(fc!=null)p.show=Type.createEnum(xmpp.PresenceShow,fc.getNodeValue());break;case"status":if(fc!=null)p.setStatus(fc.getNodeValue());break;case"priority":if(fc!=null)p.priority=Std.parseInt(fc.getNodeValue());break;case"error":p.errors.push(xmpp.Error.parse(c));break;default:p.properties.push(c);}}
return p;}
xmpp.Presence.__super__=xmpp.Packet;xmpp.Presence.prototype=$extend(xmpp.Packet.prototype,{type:null,show:null,status:null,priority:null,setStatus:function(s){return this.status=s==null||s==""?null:s.length>1023?s.substr(0,1023):s;},toXml:function(){var x=xmpp.Packet.prototype.addAttributes.call(this,Xml.createElement("presence"));if(this.type!=null)x.set("type",this.type[0]);if(this.show!=null)x.addChild(xmpp.XMLUtil.createElement("show",this.show[0]));if(this.status!=null)x.addChild(xmpp.XMLUtil.createElement("status",this.status));if(this.priority!=null)x.addChild(xmpp.XMLUtil.createElement("priority",Std.string(this.priority)));return x;},__class__:xmpp.Presence,__properties__:{set_status:"setStatus"}});xmpp.PresenceShow={__ename__:["xmpp","PresenceShow"],__constructs__:["away","chat","dnd","xa"]}
xmpp.PresenceShow.away=["away",0];xmpp.PresenceShow.away.toString=$estr;xmpp.PresenceShow.away.__enum__=xmpp.PresenceShow;xmpp.PresenceShow.chat=["chat",1];xmpp.PresenceShow.chat.toString=$estr;xmpp.PresenceShow.chat.__enum__=xmpp.PresenceShow;xmpp.PresenceShow.dnd=["dnd",2];xmpp.PresenceShow.dnd.toString=$estr;xmpp.PresenceShow.dnd.__enum__=xmpp.PresenceShow;xmpp.PresenceShow.xa=["xa",3];xmpp.PresenceShow.xa.toString=$estr;xmpp.PresenceShow.xa.__enum__=xmpp.PresenceShow;xmpp.PresenceType={__ename__:["xmpp","PresenceType"],__constructs__:["error","probe","subscribe","subscribed","unavailable","unsubscribe","unsubscribed"]}
xmpp.PresenceType.error=["error",0];xmpp.PresenceType.error.toString=$estr;xmpp.PresenceType.error.__enum__=xmpp.PresenceType;xmpp.PresenceType.probe=["probe",1];xmpp.PresenceType.probe.toString=$estr;xmpp.PresenceType.probe.__enum__=xmpp.PresenceType;xmpp.PresenceType.subscribe=["subscribe",2];xmpp.PresenceType.subscribe.toString=$estr;xmpp.PresenceType.subscribe.__enum__=xmpp.PresenceType;xmpp.PresenceType.subscribed=["subscribed",3];xmpp.PresenceType.subscribed.toString=$estr;xmpp.PresenceType.subscribed.__enum__=xmpp.PresenceType;xmpp.PresenceType.unavailable=["unavailable",4];xmpp.PresenceType.unavailable.toString=$estr;xmpp.PresenceType.unavailable.__enum__=xmpp.PresenceType;xmpp.PresenceType.unsubscribe=["unsubscribe",5];xmpp.PresenceType.unsubscribe.toString=$estr;xmpp.PresenceType.unsubscribe.__enum__=xmpp.PresenceType;xmpp.PresenceType.unsubscribed=["unsubscribed",6];xmpp.PresenceType.unsubscribed.toString=$estr;xmpp.PresenceType.unsubscribed.__enum__=xmpp.PresenceType;xmpp.SASL=function(){}
xmpp.SASL.__name__=["xmpp","SASL"];xmpp.SASL.createAuth=function(mech,text){if(mech==null)return null;var x=text!=null?xmpp.XMLUtil.createElement("auth",text):Xml.createElement("auth");x.set("xmlns",xmpp.SASL.XMLNS);x.set("mechanism",mech);return x;}
xmpp.SASL.createResponse=function(t){if(t==null)return null;var x=xmpp.XMLUtil.createElement("response",t);x.set("xmlns",xmpp.SASL.XMLNS);return x;}
xmpp.SASL.parseMechanisms=function(x){var m=new Array();var $it0=x.elements();while($it0.hasNext()){var e=$it0.next();if(e.getNodeName()!="mechanism")continue;m.push(e.firstChild().getNodeValue());}
return m;}
xmpp.SASL.prototype={__class__:xmpp.SASL}
xmpp.Stream=function(){}
xmpp.Stream.__name__=["xmpp","Stream"];xmpp.Stream.createOpenXml=function(ns,to,version,lang,header){if(header==null)header=true;var b=new StringBuf();b.b[b.b.length]="<stream:stream xmlns=\"";b.b[b.b.length]=ns==null?"null":ns;b.add("\" xmlns:stream=\""+xmpp.Stream.STREAM);if(to!=null){b.b[b.b.length]="\" to=\"";b.b[b.b.length]=to==null?"null":to;}
b.b[b.b.length]="\" xmlns:xml=\"http://www.w3.org/XML/1998/namespace\"";if(version)b.b[b.b.length]=" version=\"1.0\"";if(lang!=null){b.b[b.b.length]=" xml:lang=\"";b.b[b.b.length]=lang==null?"null":lang;b.b[b.b.length]="\"";}
b.b[b.b.length]=">";return header?"<?xml version=\"1.0\" encoding=\"UTF-8\"?>"+b.b.join(""):b.b.join("");}
xmpp.Stream.prototype={__class__:xmpp.Stream}
xmpp.X=function(){}
xmpp.X.__name__=["xmpp","X"];xmpp.X.create=function(ns,childs){var x=Xml.createElement("x");xmpp.XMLUtil.ns(x,ns);if(childs!=null){var $it0=ArrayHelper.iter(childs)();while($it0.hasNext()){var c=$it0.next();x.addChild(c);}}
return x;}
xmpp.X.prototype={__class__:xmpp.X}
xmpp.XMLUtil=function(){}
xmpp.XMLUtil.__name__=["xmpp","XMLUtil"];xmpp.XMLUtil.createElement=function(n,t){var x=Xml.createElement(n);x.addChild(Xml.createPCData(t));return x;}
xmpp.XMLUtil.addElement=function(x,name,content){x.addChild(xmpp.XMLUtil.createElement(name,content));return x;}
xmpp.XMLUtil.addField=function(x,o,n,required){if(required==null)required=false;var v=Reflect.field(o,n);if(v!=null){x.addChild(xmpp.XMLUtil.createElement(n,Std.string(v)));x;}else if(required)throw"required field "+n+" is missing";return x;}
xmpp.XMLUtil.ns=function(x,ns){if(ns==null)return x.get("xmlns");else{x.set("xmlns",ns);return ns;}}
xmpp.XMLUtil.setNamespace=function(x,s){x.set("xmlns",s);}
xmpp.XMLUtil.prototype={__class__:xmpp.XMLUtil}
if(!xmpp.dataform)xmpp.dataform={}
xmpp.dataform.Field=function(type){this.type=type;this.values=new Array();this.options=new Array();this.required=false;};xmpp.dataform.Field.__name__=["xmpp","dataform","Field"];xmpp.dataform.Field.prototype={label:null,type:null,variable:null,desc:null,required:null,values:null,options:null,toXml:function(){var x=Xml.createElement("field");if(this.label!=null)x.set("label",this.label);if(this.type!=null)x.set("type",StringTools.replace(this.type[0],"_","-"));if(this.variable!=null)x.set("var",this.variable);if(this.required)x.addChild(Xml.createElement("required"));if(this.desc!=null)x.addChild(xmpp.XMLUtil.createElement("desc",this.desc));var _g=0,_g1=this.values;while(_g<_g1.length){var value=_g1[_g];++_g;x.addChild(xmpp.XMLUtil.createElement("value",value));}
var _g=0,_g1=this.options;while(_g<_g1.length){var option=_g1[_g];++_g;x.addChild(option.toXml());}
return x;},__class__:xmpp.dataform.Field}
xmpp.dataform.FieldOption=function(){}
xmpp.dataform.FieldOption.__name__=["xmpp","dataform","FieldOption"];xmpp.dataform.FieldOption.prototype={toXml:function(){var x=Xml.createElement("option");xmpp.XMLUtil.addField(x,this,"label");xmpp.XMLUtil.addField(x,this,"value");return x;},__class__:xmpp.dataform.FieldOption}
xmpp.dataform.FieldType={__ename__:["xmpp","dataform","FieldType"],__constructs__:["boolean","fixed","hidden","jid_multi","jid_single","list_multi","list_single","text_multi","text_private","text_single"]}
xmpp.dataform.FieldType["boolean"]=["boolean",0];xmpp.dataform.FieldType["boolean"].toString=$estr;xmpp.dataform.FieldType["boolean"].__enum__=xmpp.dataform.FieldType;xmpp.dataform.FieldType.fixed=["fixed",1];xmpp.dataform.FieldType.fixed.toString=$estr;xmpp.dataform.FieldType.fixed.__enum__=xmpp.dataform.FieldType;xmpp.dataform.FieldType.hidden=["hidden",2];xmpp.dataform.FieldType.hidden.toString=$estr;xmpp.dataform.FieldType.hidden.__enum__=xmpp.dataform.FieldType;xmpp.dataform.FieldType.jid_multi=["jid_multi",3];xmpp.dataform.FieldType.jid_multi.toString=$estr;xmpp.dataform.FieldType.jid_multi.__enum__=xmpp.dataform.FieldType;xmpp.dataform.FieldType.jid_single=["jid_single",4];xmpp.dataform.FieldType.jid_single.toString=$estr;xmpp.dataform.FieldType.jid_single.__enum__=xmpp.dataform.FieldType;xmpp.dataform.FieldType.list_multi=["list_multi",5];xmpp.dataform.FieldType.list_multi.toString=$estr;xmpp.dataform.FieldType.list_multi.__enum__=xmpp.dataform.FieldType;xmpp.dataform.FieldType.list_single=["list_single",6];xmpp.dataform.FieldType.list_single.toString=$estr;xmpp.dataform.FieldType.list_single.__enum__=xmpp.dataform.FieldType;xmpp.dataform.FieldType.text_multi=["text_multi",7];xmpp.dataform.FieldType.text_multi.toString=$estr;xmpp.dataform.FieldType.text_multi.__enum__=xmpp.dataform.FieldType;xmpp.dataform.FieldType.text_private=["text_private",8];xmpp.dataform.FieldType.text_private.toString=$estr;xmpp.dataform.FieldType.text_private.__enum__=xmpp.dataform.FieldType;xmpp.dataform.FieldType.text_single=["text_single",9];xmpp.dataform.FieldType.text_single.toString=$estr;xmpp.dataform.FieldType.text_single.__enum__=xmpp.dataform.FieldType;xmpp.dataform.FormType={__ename__:["xmpp","dataform","FormType"],__constructs__:["cancel","form","result","submit"]}
xmpp.dataform.FormType.cancel=["cancel",0];xmpp.dataform.FormType.cancel.toString=$estr;xmpp.dataform.FormType.cancel.__enum__=xmpp.dataform.FormType;xmpp.dataform.FormType.form=["form",1];xmpp.dataform.FormType.form.toString=$estr;xmpp.dataform.FormType.form.__enum__=xmpp.dataform.FormType;xmpp.dataform.FormType.result=["result",2];xmpp.dataform.FormType.result.toString=$estr;xmpp.dataform.FormType.result.__enum__=xmpp.dataform.FormType;xmpp.dataform.FormType.submit=["submit",3];xmpp.dataform.FormType.submit.toString=$estr;xmpp.dataform.FormType.submit.__enum__=xmpp.dataform.FormType;xmpp.dataform.Item=function(){}
xmpp.dataform.Item.__name__=["xmpp","dataform","Item"];xmpp.dataform.Item.prototype={fields:null,toXml:function(){return this.createXml("item");},createXml:function(n){var x=Xml.createElement(n);var _g=0,_g1=this.fields;while(_g<_g1.length){var f=_g1[_g];++_g;x.addChild(f.toXml());}
return x;},__class__:xmpp.dataform.Item}
xmpp.dataform.Reported=function(){}
xmpp.dataform.Reported.__name__=["xmpp","dataform","Reported"];xmpp.dataform.Reported.__super__=xmpp.dataform.Item;xmpp.dataform.Reported.prototype=$extend(xmpp.dataform.Item.prototype,{toXml:function(){return this.createXml("reported");},__class__:xmpp.dataform.Reported});if(!xmpp.filter)xmpp.filter={}
xmpp.filter.MessageFilter=function(type){this.type=type;};xmpp.filter.MessageFilter.__name__=["xmpp","filter","MessageFilter"];xmpp.filter.MessageFilter.prototype={type:null,accept:function(p){if(p._type!=xmpp.PacketType.message)return false;return this.type==null?true:this.type==p.type;},__class__:xmpp.filter.MessageFilter}
xmpp.filter.PacketFromContainsFilter=function(contains){this.setContains(contains);};xmpp.filter.PacketFromContainsFilter.__name__=["xmpp","filter","PacketFromContainsFilter"];xmpp.filter.PacketFromContainsFilter.prototype={contains:null,ereg:null,setContains:function(t){this.ereg=new EReg(t,"");return this.contains=t;},accept:function(p){if(p.from==null)return false;try{return this.ereg.match(p.from);}catch(e){return false;}},__class__:xmpp.filter.PacketFromContainsFilter,__properties__:{set_contains:"setContains"}}
xmpp.filter.PacketIDFilter=function(id){this.id=id;};xmpp.filter.PacketIDFilter.__name__=["xmpp","filter","PacketIDFilter"];xmpp.filter.PacketIDFilter.prototype={id:null,accept:function(p){return p.id==this.id;},__class__:xmpp.filter.PacketIDFilter}
xmpp.filter.PacketNameFilter=function(expr){this.expr=expr;};xmpp.filter.PacketNameFilter.__name__=["xmpp","filter","PacketNameFilter"];xmpp.filter.PacketNameFilter.prototype={expr:null,accept:function(p){return this.expr.match(p.toXml().getNodeName());},__class__:xmpp.filter.PacketNameFilter}
xmpp.filter.PacketTypeFilter=function(type){this.type=type;};xmpp.filter.PacketTypeFilter.__name__=["xmpp","filter","PacketTypeFilter"];xmpp.filter.PacketTypeFilter.prototype={type:null,accept:function(p){return p._type==this.type;},__class__:xmpp.filter.PacketTypeFilter}
if(!xmpp.muc)xmpp.muc={}
xmpp.muc.Affiliation={__ename__:["xmpp","muc","Affiliation"],__constructs__:["none","owner","admin","member","outcast"]}
xmpp.muc.Affiliation.none=["none",0];xmpp.muc.Affiliation.none.toString=$estr;xmpp.muc.Affiliation.none.__enum__=xmpp.muc.Affiliation;xmpp.muc.Affiliation.owner=["owner",1];xmpp.muc.Affiliation.owner.toString=$estr;xmpp.muc.Affiliation.owner.__enum__=xmpp.muc.Affiliation;xmpp.muc.Affiliation.admin=["admin",2];xmpp.muc.Affiliation.admin.toString=$estr;xmpp.muc.Affiliation.admin.__enum__=xmpp.muc.Affiliation;xmpp.muc.Affiliation.member=["member",3];xmpp.muc.Affiliation.member.toString=$estr;xmpp.muc.Affiliation.member.__enum__=xmpp.muc.Affiliation;xmpp.muc.Affiliation.outcast=["outcast",4];xmpp.muc.Affiliation.outcast.toString=$estr;xmpp.muc.Affiliation.outcast.__enum__=xmpp.muc.Affiliation;xmpp.muc.Item=function(affiliation,role,nick,jid){this.affiliation=affiliation;this.role=role;this.nick=nick;this.jid=jid;};xmpp.muc.Item.__name__=["xmpp","muc","Item"];xmpp.muc.Item.parse=function(x){var p=new xmpp.muc.Item();if(x.exists("affiliation"))p.affiliation=Type.createEnum(xmpp.muc.Affiliation,x.get("affiliation"));if(x.exists("role"))p.role=Type.createEnum(xmpp.muc.Role,x.get("role"));if(x.exists("nick"))p.nick=x.get("nick");if(x.exists("jid"))p.jid=x.get("jid");var $it0=x.elements();while($it0.hasNext()){var e=$it0.next();switch(e.getNodeName()){case"actor":p.actor=e.get("jid");break;case"reason":p.reason=e.firstChild().getNodeValue();break;case"continue":p.continue_=e.get("continue");break;}}
return p;}
xmpp.muc.Item.prototype={affiliation:null,role:null,nick:null,jid:null,actor:null,reason:null,continue_:null,toXml:function(){var x=Xml.createElement("item");if(this.jid!=null)x.set("jid",this.jid);if(this.nick!=null)x.set("nick",this.nick);if(this.role!=null)x.set("role",this.role[0]);if(this.affiliation!=null)x.set("affiliation",this.affiliation[0]);if(this.actor!=null){var e=Xml.createElement("actor");e.set("jid",this.actor);x.addChild(e);}
if(this.reason!=null)x.addChild(xmpp.XMLUtil.createElement("reason",this.reason));if(this.continue_!=null){var e=Xml.createElement("continue");e.set("thread",this.continue_);x.addChild(e);}
return x;},__class__:xmpp.muc.Item}
xmpp.muc.Role={__ename__:["xmpp","muc","Role"],__constructs__:["none","visitor","participant","moderator"]}
xmpp.muc.Role.none=["none",0];xmpp.muc.Role.none.toString=$estr;xmpp.muc.Role.none.__enum__=xmpp.muc.Role;xmpp.muc.Role.visitor=["visitor",1];xmpp.muc.Role.visitor.toString=$estr;xmpp.muc.Role.visitor.__enum__=xmpp.muc.Role;xmpp.muc.Role.participant=["participant",2];xmpp.muc.Role.participant.toString=$estr;xmpp.muc.Role.participant.__enum__=xmpp.muc.Role;xmpp.muc.Role.moderator=["moderator",3];xmpp.muc.Role.moderator.toString=$estr;xmpp.muc.Role.moderator.__enum__=xmpp.muc.Role;xmpp.muc.Status=function(code){this.code=code;};xmpp.muc.Status.__name__=["xmpp","muc","Status"];xmpp.muc.Status.parse=function(x){return new xmpp.muc.Status(Std.parseInt(x.get("code")));}
xmpp.muc.Status.prototype={code:null,__class__:xmpp.muc.Status}
js.Boot.__res={}
js.Boot.__init();ArrayHelper.remove=Array.prototype.indexOf?function(a,x){var idx=a.indexOf(x);if(idx==-1)return false;a.splice(idx,1);return true;}:function(a,x){var i=0;var l=a.length;while(i<l){if(a[i]==x){a.splice(i,1);return true;}
i++;}
return false;};{var d=Date;d.now=function(){return new Date();};d.fromTime=function(t){var d1=new Date();d1["setTime"](t);return d1;};d.fromString=function(s){switch(s.length){case 8:var k=s.split(":");var d1=new Date();d1["setTime"](0);d1["setUTCHours"](k[0]);d1["setUTCMinutes"](k[1]);d1["setUTCSeconds"](k[2]);return d1;case 10:var k=s.split("-");return new Date(k[0],k[1]-1,k[2],0,0,0);case 19:var k=s.split(" ");var y=k[0].split("-");var t=k[1].split(":");return new Date(y[0],y[1]-1,y[2],t[0],t[1],t[2]);default:throw"Invalid date format : "+s;}};d.prototype["toString"]=function(){var date=this;var m=date.getMonth()+1;var d1=date.getDate();var h=date.getHours();var mi=date.getMinutes();var s=date.getSeconds();return date.getFullYear()+"-"+(m<10?"0"+m:""+m)+"-"+(d1<10?"0"+d1:""+d1)+" "+(h<10?"0"+h:""+h)+":"+(mi<10?"0"+mi:""+mi)+":"+(s<10?"0"+s:""+s);};d.prototype.__class__=d;d.__name__=["Date"];}
{Math.__name__=["Math"];Math.NaN=Number["NaN"];Math.NEGATIVE_INFINITY=Number["NEGATIVE_INFINITY"];Math.POSITIVE_INFINITY=Number["POSITIVE_INFINITY"];;Math.isFinite=function(i){return isFinite(i);};Math.isNaN=function(i){return isNaN(i);};}
{;;var Int={__name__:["Int"]};var Dynamic={__name__:["Dynamic"]};var Float=Number;Float.__name__=["Float"];var Bool=Boolean;Bool.__ename__=["Bool"];var Class={__name__:["Class"]};var Enum={};var Void={__ename__:["Void"]};}
{Xml.Element="element";Xml.PCData="pcdata";Xml.CData="cdata";Xml.Comment="comment";Xml.DocType="doctype";Xml.Prolog="prolog";Xml.Document="document";}
{if(typeof document!="undefined")js.Lib.document=document;if(typeof window!="undefined"){js.Lib.window=window;js.Lib.window.onerror=function(msg,url,line){var f=js.Lib.onerror;if(f==null)return false;return f(msg,[url+":"+line]);};}}
js["XMLHttpRequest"]=window.XMLHttpRequest?XMLHttpRequest:window.ActiveXObject?function(){try{return new ActiveXObject("Msxml2.XMLHTTP");}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP");}catch(e1){throw"Unable to create XMLHttpRequest object.";}}}:(function($this){var $r;throw"Unable to create XMLHttpRequest object.";return $r;}(this));jabber.BOSHConnection.INTERVAL=0;jabber.BOSHConnection.BOSH_VERSION="1.6";jabber.BOSHConnection.XMLNS="http://jabber.org/protocol/httpbind";jabber.BOSHConnection.XMLNS_XMPP="urn:xmpp:xbosh";haxe.SHA1.hex_chr="0123456789abcdef";jabber.JIDUtil.MIN_LENGTH=8;jabber.JIDUtil.MAX_PARTSIZE=1023;jabber.JIDUtil.MAX_SIZE=3071;jabber.JIDUtil.EREG=new EReg("([A-Z0-9._%-]+)@([A-Z0-9.-]+\\.[A-Z][A-Z][A-Z]?)(/([A-Z0-9._%-]+))?","i");jabber.Stream.defaultPacketIdLength=5;jabber.Stream.defaultMaxBufSize=524288;xmpp.Error.XMLNS="urn:ietf:params:xml:ns:xmpp-stanzas";jabber.sasl.AnonymousMechanism.NAME="ANONYMOUS";jabber.util.Base64.CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";jabber.util.Base64.bc=new haxe.BaseCode(haxe.io.Bytes.ofString(jabber.util.Base64.CHARS));js.Lib.onerror=null;xmpp.Bind.XMLNS="urn:ietf:params:xml:ns:xmpp-bind";xmpp.DataForm.XMLNS="jabber:x:data";xmpp.DateTime.EREG_DATE=new EReg("^([0-9]{4})-([0-9]{2})-([0-9]{2})(T([0-9]{2}):([0-9]{2}):([0-9]{2})(\\.[0-9]{3})?(Z|(-[0-9]{2}:[0-9]{2}))?)?$","");xmpp.Delayed.XMLNS="urn:xmpp:delay";xmpp.Packet.PROTOCOL="http://jabber.org/protocol";xmpp.MUC.XMLNS=xmpp.Packet.PROTOCOL+"/muc";xmpp.MUCOwner.XMLNS=xmpp.Packet.PROTOCOL+"/muc"+"#owner";xmpp.MUCUser.XMLNS=xmpp.Packet.PROTOCOL+"/muc"+"#user";xmpp.SASL.XMLNS="urn:ietf:params:xml:ns:xmpp-sasl";xmpp.SASL.EREG_FAILURE=new EReg("(^failure$)|(^not-authorized$)|(^aborted$)|(^incorrect-encoding$)|(^invalid-authzid$)|(^invalid-mechanism$)|(^mechanism-too-weak$)|(^temporary-auth-failure$)","");xmpp.Stream.STREAM="http://etherx.jabber.org/streams";xmpp.Stream.CLIENT="jabber:client";xmpp.muc.Status.WAITS_FOR_UNLOCK=201;CNCTA.main()}function watch_timer__(){if(typeof(qx) != 'undefined' && typeof(webfrontend) != 'undefined' && typeof(qx.core.Init.getApplication) != 'undefined' && qx.core.Init.getApplication().initDone == true){userscript_main_code__();} else {window.setTimeout(watch_timer__, 1000);}}window.setTimeout(watch_timer__, 1000);}var inject__ = document.createElement('script');inject__.setAttribute('type', 'text/javascript');inject__.innerHTML = '('+cncta_userscript__.toString()+')()';document.body.appendChild(inject__);document.body.removeChild(inject__);})();
