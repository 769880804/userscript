// ==UserScript==
// @name        b+Script
// @namespace   bPlusScript
// @description Améliore l'éxperience sur le site de rencontre Betolerant...
// @include     http://www.betolerant.fr/*
// @version     0.1
// ==/UserScript==
(function($){var notifsMSG,notifsKISS,notifsVIEWS,title;function addDataId(){$('ul.nav.pull-right li:nth-child( 1 ):first').attr('data-betolerantNotifsId','notifsMSG');$('ul.nav.pull-right li:nth-child( 2 ):first').attr('data-betolerantNotifsId','notifsKISS');$('ul.nav.pull-right li:nth-child( 3 ):first').attr('data-betolerantNotifsId','notifsVIEWS')}function notifs(){$.getJSON('/site/notification.html').done(function(data){notifsMSG=parseInt(data['notifsMSG']);notifsKISS=parseInt(data['notifsKISS']);notifsVIEWS=parseInt(data['notifsVIEWS']);if(($('li[data-betolerantNotifsId="notifsMSG"] strong').length>=1)&&(notifsMSG==0)){$('li[data-betolerantNotifsId="notifsMSG"] strong').remove()}else{if($('li[data-betolerantNotifsId="notifsMSG"] strong').length){$('li[data-betolerantNotifsId="notifsMSG"] strong').html(notifsMSG)}else{if(notifsMSG!=0){$('li[data-betolerantNotifsId="notifsMSG"] a').append(' <strong class="label label-important">'+notifsMSG+'</strong>')}}}if(($('li[data-betolerantNotifsId="notifsKISS"] strong').length>=1)&&(notifsKISS==0)){$('li[data-betolerantNotifsId="notifsKISS"] strong').remove()}else{if($('li[data-betolerantNotifsId="notifsKISS"] strong').length){$('li[data-betolerantNotifsId="notifsKISS"] strong').html(notifsKISS)}else{if(notifsKISS!=0){$('li[data-betolerantNotifsId="notifsKISS"] a').append(' <strong class="label label-important">'+notifsKISS+'</strong>')}}}if(($('li[data-betolerantNotifsId="notifsVIEWS"] strong').length>=1)&&(notifsVIEWS==0)){$('li[data-betolerantNotifsId="notifsVIEWS"] strong').remove()}else{if($('li[data-betolerantNotifsId="notifsVIEWS"] strong').length){$('li[data-betolerantNotifsId="notifsVIEWS"] strong').html(notifsVIEWS)}else{if(notifsVIEWS!=0){$('li[data-betolerantNotifsId="notifsVIEWS"] a').append(' <strong class="label label-important">'+notifsVIEWS+'</strong>')}}}document.title='('+(notifsMSG+notifsKISS+notifsVIEWS)+') - Betolerant - '+title;setTimeout(function(){notifs()},5000)}).fail(function(){setTimeout(function(){notifs()},15000)})}function notifsInit(){title=document.title;addDataId();notifs()}notifsInit()})(jQuery);(function($){$('form#formulaire').each(function(){$(this).removeAttr('onsubmit')});var lastThis,lastDelete=new Array();$('body').append('<div id="textareaScreen" style="position:fixed; left: -5px; bottom: -5px; background: grey; border-radius: 5px; padding: 15px; color: white;">'+'<span class="car"></span> '+'<div class="btn-group dropup">'+'<a class="btn btn-small dropdown-toggle" data-toggle="dropdown" href="#">Options <span class="caret"></span></a>'+'<ul class="dropdown-menu">'+'<li><a href="#" id="delete"><i class="icon-remove"></i> Effacer</a></li>'+'<li><a href="#" id="restore"><i class="icon-backward"></i> Restaurer</a></li>'+'</ul>'+'</div> '+'<button class="btn btn-small btn-danger" onclick="$( \'#textareaScreen\' ).hide( \'slow\' ); $( \'#textareaScreen span.car\' ).text( \'\' ); return false;"><b>X</b></button>'+'</div>');$('textarea, input').click(function(e){$('#textareaScreen').show('slow');$('#textareaScreen span.car').text($(this).val().length+' caractères.');lastThis=this});$('textarea, input').keyup(function(e){$('#textareaScreen').show('slow');$('#textareaScreen span.car').text($(this).val().length+' caractères.');lastThis=this});$('div#textareaScreen a#delete').click(function(e){lastDelete['object']=lastThis;lastDelete['value']=$(lastThis).val();$(lastThis).val('');$('#textareaScreen span.car').text($(this).val().length+' caractères.');return false});$('div#textareaScreen a#restore').click(function(e){$(lastDelete['object']).val(lastDelete['value']);$('#textareaScreen span.car').text($(this).val().length+' caractères.');return false});$('#textareaScreen').hide()})(jQuery);(function($){$('.container2 a[href*="youtu"]').each(function(){var id,match=$(this).attr('href').match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/),url=$(this).attr('href');if(match&&match[7].length==11){id=match[7];$(this).replaceWith('<div class="thumbnail" style="background: white;"><p><a href="'+url+'"><span class="label label-important">YouTube</span></a></p><div class="caption"><iframe width="420" height="315" src="//www.youtube.com/embed/'+id+'" frameborder="0" allowfullscreen></iframe></div></div>')}});$('.container2 a[href*="dailymotion.com"]').each(function(){var id,match=$(this).attr('href').match(/^.+dailymotion.com\/((video|hub)\/([^_]+))?[^#]*(#video=([^_&]+))?/),url=$(this).attr('href');if(match!==null){if(match[5]!==undefined){id=match[5]}else{id=match[3]}$(this).replaceWith('<div class="thumbnail" style="background: white;"><p><a href="'+url+'"><span class="label label-info">DailyMotion</span></a></p><div class="caption"><iframe width="480" height="270" src="//www.dailymotion.com/embed/video/'+id+'" frameborder="0" allowfullscreen></iframe></div></div>')}});$('.container2 a[href*="vimeo.com"]').each(function(){var id,match=$(this).attr('href').match(/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/),url=$(this).attr('href');if(match[5]!==undefined){id=match[5];$(this).replaceWith('<div class="thumbnail" style="background: white;"><p><a href="'+url+'"><span class="label label-success">Vimeo</span></a></p><div class="caption"><iframe width="500" height="281" src="//player.vimeo.com/video/'+id+'" frameborder="0" allowfullscreen></iframe></div></div>')}});$('.container2 a[href$=".mp4"], .container2 a[href$=".ogv"], .container2 a[href$=".webm"]').each(function(){var url=$(this).attr('href');$(this).replaceWith('<div class="thumbnail" style="background: white;"><p><a href="'+url+'"><span class="label label-warning">HTML5 Video</span></a></p><div class="caption"><video width="500" height="281" src="'+url+'" controls="controls" ></video></div></div>')});$('.container2 a[href$=".mp3"], .container2 a[href$=".ogg"]').each(function(){var url=$(this).attr('href');$(this).replaceWith('<div class="thumbnail" style="background: white;"><p><a href="'+url+'"><span class="label label-warning">HTML5 Audio</span></a></p><div class="caption"><audio src="'+url+'" controls="controls" ></audio></div></div>')})})(jQuery);(function($){$('div.comgauche > div.auteur, center table tr td').each(function(){if($(this).find('b:first').text()!='Robot '){var matchId=$(this).find('img:first').attr('src').match(/^.+betolerant.fr\/(.\/)?uploads\/photo1\/([0-9]+)\_([0-9]+)x([0-9]+).jpg/),matchName=$(this).find('a:first').attr('href').match(/^.+betolerant.fr\/profil\/user\/(.+)\.html/);$(this).append('<div class="btn-group dropup">'+'<a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">'+'<i class="icon-th-list"></i> <span class="caret"></span>'+'</a>'+'<ul class="dropdown-menu">'+'</ul>'+'</div>');if(matchId&&matchId[2]!==undefined){id=matchId[2];$(this).find('div.btn-group ul').append('<li><a href="http://www.betolerant.fr/mp/ecrire/'+id+'.html" onclick="Popup2( \'http://www.betolerant.fr/mp/ecrire/'+id+'.html\' ); return false;">Envoyer un MP</a></li>'+'<li><a href="http://www.betolerant.fr/amis/ajout/'+id+'.html" onclick="Popup( \'http://www.betolerant.fr/amis/ajout/'+id+'.html\' ); return false;">Ajouter aux favoris</a></li>'+'<li><a href="http://www.betolerant.fr/uploads/photo1/'+id+'.jpg" onclick="Popup2( \'http://www.betolerant.fr/uploads/photo1/'+id+'.jpg\' ); return false;">Voir les images</a></li>')}if(matchName&&matchName[1]!==undefined){name=matchName[1];$(this).find('div.btn-group ul').append('<li><a href="http://www.betolerant.fr/profil/user/'+name+'.html#message" onclick="Popup2( \'http://www.betolerant.fr/profil/user/'+name+'.html#message\' ); return false;">Écrire sur le mur</a></li>'+'<li><a href="//www.betolerant.fr/profil/Bekiss/'+name+'" onclick="Popup( \'//www.betolerant.fr/profil/Bekiss/'+name+'\' ); return false;">Envoyer un Bekiss</a></li>')}}else{$(this).find('b:first').attr('class','text text-error')}})})(jQuery);(function($){var regex=new RegExp("^.+betolerant.fr\/profil\/user\/",'i');if(regex.test($(location).attr('href'))){$('a[href="http://www.betolerant.fr/s3590/b-script-amp-style/"]:first img[src="https://lh3.googleusercontent.com/-R1XSChEx9xA/UlXI7HQwOUI/AAAAAAAAACA/Ky_5zwUoCUw/s50-no/b+.png"]:first').each(function(){if($(this).attr('data-hideTabs')=="true"){$('ul.nav.nav-tabs').remove()}if(typeof $(this).attr('data-color')!="undefined"){$('div.infoprofil > div.tab-pane').css('color',$(this).attr('data-color'))}if(typeof $(this).attr('data-background')!="undefined"){$('table.profil td').css('background',$(this).attr('data-background'));$('div.infoprofil > div.tab-pane').css('background',$(this).attr('data-background'))}if(typeof $(this).attr('data-background-info')!="undefined"){$('div.infoprofil > div.tab-pane').css('background',$(this).attr('data-background-info'))}$('div#profil-modal:first').modal('show')});var regex=new RegExp('mrgrognon.html','i');if(regex.test($(location).attr('href'))){$('td.big').prepend('<a href="http://www.betolerant.fr/s3590/b-script-amp-style/"><span class="label label-info"><em>Dev</em></span></a>')}}})(jQuery);