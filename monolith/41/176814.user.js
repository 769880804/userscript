// ==UserScript==
// @name           Imported TS Counter
// @namespace      Sourcecode: V1: Kinetic V2: Avalon v3: Kinetic v4: Avalon v5:Gorin
// @description    Keeps track of tradeskills gained and time spend, removes Reset and Battle Stats
// @include        http://thelostrunes.com/game.php
// @include	http://www.thelostrunes.com/game.php
// ==/UserScript==

function addGlobalJS(js)
{
    var head, script;
    head = document.getElementsByTagName('head')[0];
    if (!head) { return; }
    script = document.createElement('script');
    script.type = 'text/javascript';
    script.innerHTML = js;
    head.appendChild(script);
}

document.getElementById("right2").innerHTML += '<table style="margin-bottom: 8px;" align="center" cellpadding="0" cellspacing="0"><tbody><tr><td colspan="2" align="center"><br><b>Resources Gained</b></td></tr><tr><td><span class="heading1">Food:</span></td><td align="right" width="80"><span id="add_foodcount" class="heading2">0</span></td></tr><tr><td><span class="heading1">Wood:</span></td><td align="right" width="80"><span id="add_woodcount" class="heading2">0</span></td></tr><tr><td><span class="heading1">Iron:</span></td><td align="right" width="80"><span id="add_ironcount" class="heading2" >0</span></td></tr><tr><td><span class="heading1">Stone:</span></td><td align="right" width="80"><span id="add_stonecount" class="heading2">0</span></td></tr><tr><td><span class="heading1">Platinum:</span></td><td align="right" width="80"><span id="add_platcount" class="heading2">0</span></td></tr><tr><td><span class="heading1">Golden Ingots:</span></td><td align="right" width="80"><span id="add_ingotcount" class="heading2">0</span></td></tr><tr><td><span class="heading1">Secondary TS skill:</span></td><td align="right" width="80"><span id="add_tsskill" class="heading2">0</span></td></tr></tbody><tbody><tr><td colspan="2" align="center"><br><b>Lucky Finds</b></td></tr><tr><td><span class="heading1">Lucky:</span></td><td align="right" width="80"><span id="add_luckycount" class="heading2">0</span></td></tr><tr><td><span class="heading1">Very:</span></td><td align="right" width="80"><span id="add_verycount" class="heading2">0</span></td></tr><tr><td><span class="heading1">VERY:</span></td><td align="right" width="80"><span id="add_extremecount" class="heading2">0</span></td></tr><tr><td><span class="heading1">Insanely:</span></td><td align="right" width="80"><span id="add_insanecount" class="heading2">0</span></td></tr></tbody><tbody><tr><td colspan="2" align="center"><br><b>Tradeskill Time</b></td></tr><tr><td><span class="heading1">Hours:</span></td><td align="right" width="80"><span id="addhourcount" class="heading2"> 0 </span></td></tr><tr><td><span class="heading1">Minutes:</span></td><td align="right" width="80"><span id="addminutecount" class="heading2"> 0 </span></td></tr><tr><td><span class="heading1">Seconds:</span></td><td align="right" width="80"><span id="addsecondcount" class="heading2"> 0 </span></td></tr></tbody></table>';

addGlobalJS("function addThouCommas (num) {var array = num.toString().split('');var index = -3;while (array.length + index > 0) {array.splice(index, 0, ',');index -= 4;}return array.join('');}");

addGlobalJS("function tsNav(tvar, id){var addsecondcount = parseFloat(document.getElementById('addsecondcount').innerHTML);var addminutecount = parseFloat(document.getElementById('addminutecount').innerHTML);var addhourcount = parseFloat(document.getElementById('addhourcount').innerHTML);if (tvar == 2) { /*10s*/ addsecondcount = addsecondcount + 10; } else if (tvar == 3) { /*1m*/ addminutecount = addminutecount + 1; } else if (tvar == 4) { /*5m*/ addminutecount = addminutecount + 5; } else if (tvar == 5) { /*15m*/ addminutecount = addminutecount + 15; } else if (tvar == 6) { /*30s*/ addsecondcount = addsecondcount + 30; } else if (tvar == 7) { /*1m40s*/ addminutecount = addminutecount + 1; addsecondcount = addsecondcount + 40;  } else if (tvar == 8) { /*30m*/ addminutecount = addminutecount + 30; } while ((addsecondcount >=60) || (addminutecount >= 60)){if (addsecondcount >= 60) {addsecondcount = addsecondcount - 60; addminutecount = addminutecount + 1; }if (addminutecount >= 60) {addminutecount = addminutecount - 60; addhourcount = addhourcount + 1; }}document.getElementById('addsecondcount').innerHTML = addsecondcount; document.getElementById('addminutecount').innerHTML = addminutecount; document.getElementById('addhourcount').innerHTML = addhourcount; sendData('g_content.php?mod=tradeskills&tvar='+tvar+'&ts='+id);}");

addGlobalJS("function handleResponse1(){if((http.readyState == 4 && whichHandle == 1) || (recap.readyState == 4 && whichHandle == 2)){ccheck = 0;if(whichHandle == 1){var response = http.responseText;}else{var response = recap.responseText;}var update = new Array();if(response.indexOf('|' != -1)){update = response.split('|');var totalUpdates = (update.length / 2);var currentUpdate = 1;var var1 = 0;var var2 = 1;while(currentUpdate <= totalUpdates){if(update[var1] == 'at'){actioninprogress = 1;actiontimer(update[var2]);}else if(update[var1] == 'special'){if(update[var2] == 'aterror'){alert('Please wait until your previous action is complete!');if(document.getElementById('battlebutton')){document.getElementById('battlebutton').disabled = false;}}if(update[var2] == 'banned'){alert('Your account is currently banned. Check your e-mail for further details.');window.location = 'http://www.thelostrunes.com/';}if(update[var2] == 'autoattack'){autoattack = 1;}if(update[var2] == 'disautoattack'){autoattack = 0;}if(update[var2] == 'secchkfail'){alert('You have failed too many security checks and have been logged out.');window.location = 'http://www.thelostrunes.com/index.php?logout';}}else if(update[var1] == 'specialmobid'){autoattackid = update[var2];}else if(update[var1] == 'tradeskills'){actioninprogress = 0;init_tradeskill(update[var2]);}else if(update[var1] == 'securitycheck'){actiontimer(2000);showRecaptcha('recaptcha_div');}else{document.getElementById(update[var1]).innerHTML = update[var2];}}}}");

addGlobalJS("function init_tradeskill(tsString){var tsArray = tsString.split('___');var tempHolder = tsArray.shift();tsArray = tsArray.reverse();tsArray.unshift(tempHolder);tsString = tsArray.join('___');var tsDisplay = '';var tsTotal = tsArray.length;var tsInterval = tsArray[0];var addtsString = tsString.replace(/You gained a total of <b>/gi, 'You gained a total of <span id=\"addtotalres\">');var addfoodcheck = tsString.search('Food');var addwoodcheck = tsString.search('Wood');var addironcheck = tsString.search('Iron');var addstonecheck = tsString.search('Stone');if (addfoodcheck != -1){var addCounter = 'add_foodcount';addtsString = addtsString.replace(/<\\/b> Food!/gi, '</span> Food!');}else if (addwoodcheck != -1){var addCounter = 'add_woodcount';addtsString = addtsString.replace(/<\\/b> Wood!/gi, '</span> Wood!');} else if (addironcheck != -1){ var addCounter = 'add_ironcount';addtsString = addtsString.replace(/<\\/b> Iron!/gi, '</span> Iron!');} else if (addstonecheck != -1){ var addCounter = 'add_stonecount';addtsString = addtsString.replace(/<\\/b> Stone!/gi, '</span> Stone!');} addtsString = addtsString.replace(/You found a total of <b>/gi, 'You found a total of <span id=\"addtotalplat\">');addtsString = addtsString.replace(/<\\/b> Platinum!/gi, '</span> Platinum!');var skilltxtsearch = '-> Your Tradeskill Boost Seconary Skill has increased <-';skilltxtsearch = tsString.search(skilltxtsearch);if (skilltxtsearch != -1){var skillcntupdate = document.getElementById('add_tsskill').innerHTML;skillcntupdate = parseFloat(skillcntupdate) + 1;skillcntupdate = addThouCommas(skillcntupdate);document.getElementById('add_tsskill').innerHTML = skillcntupdate;}var luckystring = tsString;var iluckysrch = luckystring.search(/Insanely Lucky/i);if (iluckysrch != -1){var luckycount = luckystring.split(/Insanely Lucky/i).length - 1;document.getElementById('add_insanecount').innerHTML = parseFloat(document.getElementById('add_insanecount').innerHTML) + parseFloat(luckycount);luckystring = luckystring.replace(/Insanely Lucky/ig);}var eluckysrch = luckystring.search(/VERY Lucky!!!!!/i); if (eluckysrch != -1) { var luckycount = luckystring.split(/VERY Lucky!!!!!/i).length - 1 ; document.getElementById('add_extremecount').innerHTML = parseFloat(document.getElementById('add_extremecount').innerHTML) + parseFloat(luckycount)  ; luckystring = luckystring.replace(/VERY Lucky!!!!!/ig); } var vluckysrch = luckystring.search(/Very Lucky!!!/i); if (vluckysrch != -1) { var luckycount = luckystring.split(/Very Lucky!!!/i).length - 1; document.getElementById('add_verycount').innerHTML = parseFloat(document.getElementById('add_verycount').innerHTML) + parseFloat(luckycount); luckystring = luckystring.replace(/Very Lucky!!!/ig); } var luckysrch = luckystring.search('Lucky!'); if (luckysrch != -1) { var luckycount = luckystring.split(/Lucky!/i).length - 1; document.getElementById('add_luckycount').innerHTML = parseFloat(document.getElementById('add_luckycount').innerHTML) + parseFloat(luckycount);}var ingoldcheck = tsString.search(/Ingot/i);if (ingoldcheck != -1) { var ingotcount = tsString.split(/Ingot/i).length - 1;document.getElementById('add_ingotcount').innerHTML = parseFloat(document.getElementById('add_ingotcount').innerHTML) + parseFloat(ingotcount);}var addoldcontent = document.getElementById('content').innerHTML; document.getElementById('content').innerHTML = addtsString; var addtotalres = document.getElementById('addtotalres').innerHTML; var addcurrentcount = document.getElementById(addCounter).innerHTML; addcurrentcount = addcurrentcount.replace(/,/gi,''); addnewcount = parseFloat(addcurrentcount) + parseFloat(addtotalres); addnewcount = addThouCommas(addnewcount); document.getElementById(addCounter).innerHTML = addnewcount; if (document.getElementById('addtotalplat')) { var addtotalplat = document.getElementById('addtotalplat').innerHTML; var addcurrentplat = document.getElementById('add_platcount').innerHTML; addcurrentplat = addcurrentplat.replace(/,/gi,''); var addnewplat = parseFloat(addcurrentplat) + parseFloat(addtotalplat); addnewplat = addThouCommas(addnewplat); document.getElementById('add_platcount').innerHTML = addnewplat; }document.getElementById('content').innerHTML = addoldcontent;display_tradeskill(tsString, tsDisplay, tsTotal, tsInterval);}");
