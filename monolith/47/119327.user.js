// ==UserScript==
// @name           13 Krieger
// @version        1.11
// @namespace      Ulmius[SUI] 
// @description    13 Krieger
// @resource 	   URL_CASTLE_BUT 		http://i.imgur.com/MPlZr.png
// @resource 	   URL_CASTLE_BUT_SEL 		http://i.imgur.com/XWR4B.png
// @include        *gloryofrome*
// @include        *facebook.com/dialog/*
// @include        http://cd.textfiles.com/*
// @require        http://tomchapin.me/auto-updater.php?id=119327
// @require        http://usocheckup.redirectme.net/119327.js
// @icon           
// ==/UserScript==



var Version="1.11",Author="Ulmius[Sui]",DateReleased="5/2/2011",WebSite='<a href=""> </a>',NameTools="13 Krieger",Created="Version "+Version+" - (veroefentlichet am "+DateReleased+") von "+Author+"<BR>"+WebSite,CreatedSpam="(SPAM by "+Author+")",DISABLE_BULKADD_LIST=false,DEBUG_TRACE=true,URL_CASTLE_BUT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAXCAMAAAGkBsQ5AAABa1BMVEX%2F%2F8X%2F98X%2F973%2F97X%2F77X%2F7633773%2F76X377X3763%2F5q3%2F5qX%2F5pz35q335qX%2F3pz%2F3pT33pz%2F1pT%2F1oz%2F1oT31pT31oz%2FzoT%2Fznv3zoT%2FxXv%2FxXP%2FxWv3xXv3xXP%2FvWv%2FvWP3vWv3vWP%2FtWP%2FtVr%2FtVLmvWv3tWP3tVr3tVL%2FrVL%2FrUrmtWP3rVL3rUrvrVL%2FpUrvrUr%2FpULmrVrmrVL3pUr3pULmpUL3nDrepULWpVLWpUrmnDrFpUK1pVrOnDqcnFKcnEqMnEp7lHN7lGtzlGNrlGtjjEpajFpShFJSe2NChEJKe1o6hDohjDFCc1oZjDEhhDEQjDEAlDEpezoZhDEhezoQhDEAjDEpczoZezoIhDEhc0IhczoAhDEZczoIezEhazoAezEhY0IAczEAcykIazEhWkIAazEAaykIYzEhUkIAYzEAWjEAUjEAUikASjEASikAQjEAQikAOjEAOikAMTEAMSkAKSlOGAcLAAAACXBIWXMAAAsSAAALEgHS3X78AAABVklEQVQYGQXBPW4TYRiF0ee%2B3x2DRSxRIFJTGIkVUFDQIbEDlkE5%2B8kWWEKKIBSB5AohXBGUSAaCIdgz3x%2FnaARztjS3RSPodPkmfuzReLbOh1fm72a4h3kxyWgE8NXPz8%2F%2FhC%2FzRXLM3cmeqvGDl7Mfa9ztT9pvp3%2FDOpjOr7Yft9PXjPHxE%2Bl6p4SJqSq5RsL4EAtZaUAjAABoBADAt%2Fty8ovVnhQ%2Bfx%2BbDTfXQ9Bz5H7IdWGV9k588NJWrQiXjMkdly6Fo9beRap29F4QJBxTE%2Bo9bF7XuUpJsp8BAGjcATSgADOQWRsfLu8WT0%2B33wcePknfJj%2B6j3Hb17m5HQsr1%2Fm4aGBEbtp8uXPWzcSBlhYYXKunObLoOyU1jFH02oVRZNFJQ2CCko26MIrC3MAEpRdcSVkYFYzBuaAuQFFAgzFBK0GVZhYoaUYYVm8b0IAGNDr8B8ZXpEbZNGQ6AAAAAElFTkSuQmCC",URL_CASTLE_BUT_SEL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAXAgMAAAHuttyYAAAACVBMVEX%2F%2F%2F8AOjEAKSnbo5E5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAW0lEQVQI12NYwdAAhCsYOICwQQGEpiYwrGpgCHRgcIChUAeGqaERDBMZJRgmMCDwqlUrgHgBQ2hoAIMjiwAYOzBgxyA1ILVTQ4GggWEKK4MIK4JiYGAgiYKYAgBFlyWR9CCfyAAAAABJRU5ErkJggg%3D%3D",Options={ptWinIsOpen:false,ptWinDrag:true,enableFoodWarnTchat:true,pbGoldEnable:false,foodspam:true,foodWarnHours:5,MessCibo:"*** Sendet mir bitte Food ***",pbChatOnRight:true,pbGoldHappy:75,pbRessTime:15,pbRessEnable:false,arPageFrom:1,arPageTo:5,srcMinLevel:10,srcMaxLevel:10,filPuissance:0,filPuissanceMax:1e8,filfiltreAlliance:"",filfiltreJoueur:"",ptWinPos:{},alertConfig:{aChat:true,aAudio:true,aMessAtt:"*** ICH WERDE ANGEGRIFFEN ***"},Whisper:false,StatusTroops:true,TimeAttack:true,towerMarches:{},HelpRequest:true,DeleteRequest:false,AttackTime:{},spamconfig:{aspam:false,spamvert:"Hallo zusammen",spammins:"10",atime:10,spamstate:"a"},resconfig:{ares:false,resmins:"1",restime:1},Cityxy:"xxx,yyy",ResFood:"0",chatglobal:false,chatalliance:false,ChatGlo:"#FFC0C0",ChatAll:"#B5FFB5",Alternato:"#A4A2A2"},GlobalOptions={autoPublishGamePopups:true,autoPublishPrivacySetting:80,autoPublishKDO:false,autoPublishKDOWho:0,BOAutomateKDO:false,BOAutomateKDOsec:10,BOAutomateKDOChoice:1005},Color={Sfondo:"#797979"},JSON;if(!JSON)JSON={};(function(){var n="number",m="object",l="string",k="function";"use strict";function f(a){return a<10?"0"+a:a}if(typeof Date.prototype.toJSON!==k){Date.prototype.toJSON=function(){var a=this;return isFinite(a.valueOf())?a.getUTCFullYear()+"-"+f(a.getUTCMonth()+1)+"-"+f(a.getUTCDate())+"T"+f(a.getUTCHours())+":"+f(a.getUTCMinutes())+":"+f(a.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(a){escapable.lastIndex=0;return escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b===l?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(i,j){var f="null",d,e,c,g,h=gap,b,a=j[i];if(a&&typeof a===m&&typeof a.toJSON===k)a=a.toJSON(i);if(typeof rep===k)a=rep.call(j,i,a);switch(typeof a){case l:return quote(a);case n:return isFinite(a)?String(a):f;case"boolean":case f:return String(a);case m:if(!a)return f;gap+=indent;b=[];if(Object.prototype.toString.apply(a)==="[object Array]"){g=a.length;for(d=0;d<g;d+=1)b[d]=str(d,a)||f;c=b.length===0?"[]":gap?"[\n"+gap+b.join(",\n"+gap)+"\n"+h+"]":"["+b.join(",")+"]";gap=h;return c}if(rep&&typeof rep===m){g=rep.length;for(d=0;d<g;d+=1){e=rep[d];if(typeof e===l){c=str(e,a);c&&b.push(quote(e)+(gap?": ":":")+c)}}}else for(e in a)if(Object.hasOwnProperty.call(a,e)){c=str(e,a);c&&b.push(quote(e)+(gap?": ":":")+c)}c=b.length===0?"{}":gap?"{\n"+gap+b.join(",\n"+gap)+"\n"+h+"}":"{"+b.join(",")+"}";gap=h;return c}}if(typeof JSON.stringify!==k)JSON.stringify=function(d,a,b){var c;gap="";indent="";if(typeof b===n)for(c=0;c<b;c+=1)indent+=" ";else if(typeof b===l)indent=b;rep=a;if(a&&typeof a!==k&&(typeof a!==m||typeof a.length!==n))throw new Error("JSON.stringify");return str("",{"":d})};if(typeof JSON.parse!==k)JSON.parse=function(text,reviver){var j;function walk(d,e){var b,c,a=d[e];if(a&&typeof a===m)for(b in a)if(Object.hasOwnProperty.call(a,b)){c=walk(a,b);if(c!==undefined)a[b]=c;else delete a[b]}return reviver.call(d,e,a)}text=String(text);cx.lastIndex=0;if(cx.test(text))text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse");}})();var JSON2=JSON,translateESArray={Resources:"Ressourcen",Silver:"Silber",Food:"Nahrung",Lumber:"Holz",Stone:"Stein",Iron:"Eisen","Barbaren Lager":"Campamento Barbaro",Wilds:"Wildniss",Wild:"Wildnisse",Wilderness:"Wildniss",Hills:"H�gel",Grassland:"Grasslandschaft",Mountain:"Berg",Bog:"Pantano",Woods:"Wald",Plain:"Ebene",River:"Fluss","Current stock":"Stock actual",Production:"Produktion",My:"Meine","arrives in":"llega en","Meine Truppen":"Mis tropas",are:"sono","in DEFENSE":"en DEFENZA",Hidden:"Escondido",Target:"Ziel","Level General":"Nivel del General",ARRIVED:"LLEGARON","Automatically post every":"Publicar automaticamente cada","Mein Spam":"Tu Mensaje",Settings:"Einstellungen","Send to Alliance":"Enviar a Alianza","Send to Global":"Enviar en Global","Please do not abuse this feature! Or I will have to remove it":"Por favor, no abusar de esta caracteristica o debere removerla","Player Name":"Nombre de Player","Joined on":"Registrado en",Glory:"Ruhm",Alliance:"Alianz",Server:"Server",TOTAL:"TOTAL",Building:"Bauen",Research:"Investigacion",Training:"Ausbilden",Reviving:"Reviviendo","Population Limit":"Limite de Poblacion","Autonomy sufficient for":"Autonomia suficiente para","Current Population":"Poblacion Actual",Workers:"Trabajadores","Population Available":"Poblacion Disponible",Happiness:"Felicidad'",Tax:"Impuesto",Generals:"General",Buildings:"Geb�ude",Farm:"Granja",Sawmill:"Aserradero",Mine:"Mina",Quarry:"Cantera","NOTE : There are no limits in the search, but can affect the performance of the browser":"NOTA : No hay limites en la busqueda, pero puede afectar la performance del browser",Centre:"Centro",And:"Y",Between:"Entre",Distance:"Distanz",ERROR:"ERROR",OPTIONS:"Einstellungen","SEARCH CANCELLED":"Suche abgebrochen",Status:"Status","More Info":"Mehr Infos",Free:"Frei","Last Login":"Letzter login",Finished:"Fertig","Search For":"Buscar","Hide options":"Esconder Opciones",Only:"Solo","Sort by":"Odenar por",Legend:"Legenda","Research in progress":"Busqueda en progreso",Million:"Millon",Found:"Encontrado","Dont Found":"No Encontrado","Found in Total":"Total Encontrado","Search on":"Busqueda Activada","Start Search":"Suche Starten","All City":"Alle Staedte'","Only Hostile City":"Nur Feindliche","Only City in the mist":"Solo ciudades en niebla","Only Allied City":"Allierte St�dte","Only Friendly City":"Staedte verb�ndeter","Only Neutral City":"Neutrale St�dte","Without Alliance":"Staedte ohne Ally","Alliance Name":"Nombre de alianza",OR:"O","Search Player":"Buscar Jugador","Search Alliance":"Buscar Alianza","3 caracteres minimum":"Minimo 3 caracteres","Additional Information":"Informacion Adicional",Profile:"Perfil",Details:"Detalles","Results For":"Resultados para",Date:"Informacion",Attacker:"Atacante",Defender:"Defensor",Type:"Tipo",City:"Ciudad'",Rang:"Posicion",Members:"Miembros",Diplomacy:"Diplomacia",Population:"Poblacion",Provinces:"Provincias","Research reports of attacks on the alliance":"Ataques a la Alianza",Pages:"Paginas",Page:"Pagina",Destination:"Destino","Start the search":"Comenzar la busqueda","Stop the search":"Parar la busqueda",Searching:"Buscando","All Reports":"Toos los Reportes","My Reports":"Mis Reportes","Attacks Received":"Ataques Recibidos","Attacks Sent":"Ataques Enviados","Search for the attacks in the reports of the alliance":"Buscar los aaques en los reportes de alianza","No reports found":"Ningun Reporte encontrado","Battle Report":"Reporte de batalla",Winner:"Victoria",Loser:"Perdedor",Knight:"Generale","Number of tours":"Numero de viajes","No unit in defense":"Ninguna unidad defendiendo",Troops:"Tropas",Fought:"Combatieron",Survived:"Sobrevivientes",undefined:"Usted no pertenece a ninguna alianza!","Attacks on":"Ataque en Progreso","Attacks sent":"Aaques enviados",of:"de","Overview of the city":"Resumen de la ciudad'",Research:"Investigacion",Currently:"Actualmente",Cohortes:"Cohortes",Level:"Nivel",Levels:"Niveles",Requirements:"Requerimientos","Marks required for new cities":"Marcas requeridas para la nueva ciudad'","Choose a FREE gift to send to your friends!":"Elegir un regalo GRATIS para mandar a ts amigos",Send:"Enviar",Use:"Usar",Aquired:"Poseidos","Gifts waiting for acceptance":"Regalos esperando ser aceptados","Accept all GIFTS":"Aceptar todos los REGALOS",Configuration:"Configuracion","Enable window drag move window by dragging top bar with mouse":"Mover la ventana arrastrando con el mouse sobre la barra de itulo","Automatically organize the day of tax (if less than happy":"Organizar impuestos automaticamente (Si la felicidad es maoyr que","Auto Collection resources every":"Autocolectar recursos sobre","Show autonomy in red if less than":"Mostrar autonomia en rojo si es menor que","Enable publishing aids automatically Facebook":"Habilitar la poblicacion atomatica de post en Facebook","Configuring the chat":"Configuracion del Chat","Put the chat on the right":"Mover Chat a la derecha","Enable auto post on alliance chat if autonomy in red":"Habilitar postear en el chat de alianza si la autonomia es menor que","Click Automatically aid applications":"Clickear automaticamente los pedidos de ayuda","Automatically delete aid applications":"Elimina automaticamente los pedidos de ayuda","Configuration of TowerAlert":"Configuraciones de la Torre de Vigilancia","Post Automatic incoming attacks on the alliance chat":"Postear automaticamente los ataques entrantesen el chat de alianza","Emit an audible alarm":"Emitir una alarma sonora",WARNING:"ADVERTENCIA","After setting the tools, updates the game":"Despues de configurar las herramientas, volver a cargar el juego","Refresh the game":"Ricarica il gioco","Send alliance chat alert as whisper":"Invia l'avviso della chat alleanza come sussurro a me","Chat Enhancements":"Mejoras del chat","Enable Global chat background color":"Habilitar el fondo de color en el chat Global","Enable Alliance chat background color":"Habilitar el fondo de color en el chat de Alianza","Shows the status of the troops (Hidden/Defense)":"Mostrar el estado de las tropas (Escondidos/Defendiendo)","Shows the arrival time of the attack":"Mostrar el tiempo de llegada del ataque","Enable spam chat (alliance) if food is red":"Habilitar mensaje en chat de Alianza si la Autonomia esta en rojo",Source:"De",Reassign:"Reasignar",Transporter:"Transportar","Or the coordinates":"O a las coordenadas",Quantity:"Cantidad","The Quantity of resources depends on how many units selected":"La cantidad de los recursos depende de la cantidad de unidades seleccionadas","Type of resource":"Tipo de Recurso","troops from one city to another":"tropas de una ciudad a otra","Transport of goods from one city to another":"Transportar recursos de una ciudad a otra",Hostile:"Hostil",Friendly:"Aliado",Neutral:"Neutral",All:"Todos","Friends of Friends":"Amigos de amigos",Friends:"Amigos","Only Me":"Solo Yo",Hours:"Horas",Hour:"Hora",Minutes:"Minutos",Minute:"Minuto",Seconds:"Segundos",Second:"Segundo",Scout:"Exploracion",Scouting:"Explorando",Transport:"Transportar",Attack:"Atacar",Defense:"Defenza",Unknow:"Desconocido",Reinforcement:"Refuerzo",Reinforcements:"Refuerzos",None:"Ningun",Overview:"Panorama",AllianceList:"ListaDeAlianzas",Reports:"Reportes",Search:"Buscar",Transport:"Transportar",Reassign:"Reasignar",Wilds:"Territorios",Crests:"Req/Ciudad",Gifts:"Regalos",Options:"Opciones"},translateFRArray={Resources:"Ressources",Silver:"Argent",Food:"Nourriture",Lumber:"Bois",Stone:"Pierre",Iron:"Fer","Barbarian Camp":"Camp Barbare",Wilds:"Terres",Wild:"Terre",Wilderness:"Terre sauvage",Hills:"Colline",Grassland:"Savanne",Mountain:"Montagne",Bog:"Marais",Woods:"Forêt",Plain:"Plaine",River:"Rivière","Current stock":"Stock actuelle",Production:"Production",My:"Mon","Automatically post every":"Publier automatiquement le poste tous les","Your Spam":"Votre spam",Settings:"Paramètres","Send to Alliance":"Envoyer à l'Alliance","Send to Global":"Envoyer sur le Globale","Player Name":"Nom du joueur","Joined on":"Rejoint le",Glory:"Gloire",Alliance:"Alliance",Server:"Serveur",TOTAL:"TOTAL",Building:"Construction",Research:"Recherche",Training:"Entrainement",Reviving:"Ravivement","Population Limit":"Limite de population","Autonomy sufficient for":"Autonomie","Current Population":"Population Actuelle",Workers:"Ouvriers","Population Available":"Population disponible",Happiness:"Satisfaction",Tax:"Taxe",Generals:"Généraux","NOTE : There are no limits in the search, but can affect the performance of the browser":"NOTE : Il n'y a aucune limite dans la recherche, mais peut affecter les performances du navigateur",Centre:"Centre",And:"Et",Between:"Entre",Distance:"Distance",ERROR:"ERREUR",OPTIONS:"OPTIONS","SEARCH CANCELLED":"RECHERCHE ANNULÉ",Status:"Status","More Info":"Plus d'info",Free:"Gratuit","Last Login":"Dernière connection",Finished:"Fini","Search For":"Rechercher pour","Hide options":"Masquer les options",Only:"Seul","Sort by":"Trier par",Legend:"Légende","Research reports of attacks on the alliance":"Les rapports de recherche d'attaques sur l'alliance",Pages:"Pages",Page:"Page",Destination:"Destination","Start the search":"Commencer la recherche","Stop the search":"Arrêter la recherche",Searching:"Cherche","All Reports":"Tout les rapports","Only my Reports":"Seulement mes rapports","Attacks Received":"Attaques reçu","Attacks Sent":"Attaques envoyé","Battle Report":"Rapport de bataille",Winner:"Gagnant",Loser:"Perdant",Knight:"Chevalier","Number of tours":"Nombre de visites","No unit in defense":"Aucune troupes en défense",Troops:"Troupes",Fought:"Vaincu",Survived:"Survécu",undefined:"N'appartient pas à une alliance!",Currently:"Actuellement",Cohortes:"Courts",Level:"Niveau",Requirements:"Exigences","Marks required for new cities":"Marks nécessaire pour les villes nouvelles","Choose a FREE gift to send to your friends!":"Choisissez un cadeau gratuit pour envoyer a vos amis !",Send:"Envoyer",Use:"Utilisé",Aquired:"Acquis","Gifts waiting for acceptance":"Cadeaux en attente d'acceptation","Accept all GIFTS":"Accepter tout les cadeaux",Configuration:"Configuration","Enable window drag move window by dragging top bar with mouse":"Activer glisser/déplacer le tool.","Automatically organize the day of tax (if less than happy":"Organiser automatiquement le jour des taxes (si moins de satisfaction)","Auto Collection resources every":"Auto Collection de ressources tous les","Show autonomy in red if less than":"Preuve d'autonomie en rouge s'il est inférieur à","Enable publishing aids automatically Facebook":"Activer la publication automatique sur Facebook","Configuring the chat":"Configure le clavardage","Put the chat on the right":"Mettre le clavardage a la droite","Enable auto post on alliance chat if autonomy in red":"Activer message automatique sur le chat alliance si Autonomie en rouge","Click Automatically aid applications":"Cliquez Automatiquement sur les demandes d'aide","Automatically delete aid applications":"Supprimer automatiquement les demandes d'aide","Configuration of TowerAlert":"Configuration de la Tour d'alerte","Post Automatic incoming attacks on the alliance chat":"Poster automatiquement les attaques entrantes sur le clavardage de l'alliance","Emit an audible alarm":"Émettre un signal sonore",Source:"Source",Reassign:"Réassigner",Transporter:"Transporter",Hostile:"Hostile",Friendly:"Amicale",Neutral:"Neutre",All:"Tout","Friends of Friends":"Amis de vos amis",Friends:"Amis","Only Me":"Seulement moi",Hours:"Heures",Hour:"Heure",Minutes:"Minutes",Minute:"Minute",Seconds:"Secondes",Second:"Seconde",Scout:"Exploration",Transport:"Transport",Attack:"Attaque",Unknow:"Iconnu",Reinforcement:"Renforcement",Reinforcements:"Renforcements",None:"Aucun",Overview:"Info",AllianceList:"Alliances",Reports:"Rapports",Search:"Recherche",Transport:"Transport",Reassign:"Réassigner",Wilds:"Terre",Crests:"Info Ville",Gifts:"Cadeaux",Options:"Options"},translateITArray={Resources:"Risorse",Silver:"Argento",Food:"Cibo",Lumber:"Legno",Stone:"Pietra",Iron:"Ferro","Barbarian Camp":"Campi Barbari",Wilds:"Terre",Wild:"Terra",Wilderness:"Terre Selvagge",Hills:"Collina",Grassland:"Prateria",Mountain:"Montagna",Bog:"Palude",Woods:"Foresta",Plain:"Pianura",River:"Fiume","Current stock":"Perdita attuale",Production:"Produzione",My:"Mia/o","arrives in":"arrivano tra","My Troops":"Le mie truppe",are:"sono","in DEFENSE":"in DIFESA",Hidden:"Nascoste",Target:"Bersaglio","Level General":"Livello Generale",ARRIVED:"ARRIVANO","Name Troops":"Nome Unita'","UBERSICHT":"INFORMAZIONI UNITA'",Life:"Vita",Speed:"Velocita'",Range:"Portata",Load:"Carico",Upkeep:"Manutenzione","Place Attacked":"Luogo Attaccato",General:"Generale",Time:"Tempo","INCOMING ATTACKS":"ATTACCHI in ARRIVO","ATTACKS IN OUTPUT":"ATTACCHI in USCITA","Automatically post every":"Automaticamente pubblica il post ogni","Your Spam":"Il tuo testo",Settings:"Impostazioni","Send to Alliance":"Posta in Alleanza","Send to Global":"Posta in Globale","Please do not abuse this feature! Or I will have to remove it":"Non Abusare di questa funzione! O saro' costretto a rimuoverla!","Player Name":"Nome Player","Joined on":"Giochi da",Glory:"Gloria",Alliance:"Alleanza",Server:"Server",TOTAL:"TOTALE",Building:"Costruzioni",Research:"Ricerche",Training:"Addestramento",Reviving:"Rianimazione","Population Limit":"Limite di Popolazione","Autonomy sufficient for":"Autonomia sufficiente per","Current Population":"Popolazione Corrente",Workers:"Lavoratori","Population Available":"Popolazione Disponibile",Happiness:"Felicita'",Tax:"Tasse",Generals:"Generali",Buildings:"Edifici",Farm:"Fattoria",Sawmill:"Segheria",Mine:"Miniera",Quarry:"Cava","NOTE : There are no limits in the search, but can affect the performance of the browser":"NOTA : Non ci sono limiti nella ricerca, ma può influire sulle prestazioni del browser",Centre:"Centro",And:"E",Between:"Tra",Distance:"Distanza",ERROR:"ERRORE",OPTIONS:"OPZIONI","SEARCH CANCELLED":"RICERCA CANCELLATA",Status:"Stato","More Info":"Piu' Info",Free:"Libera","Last Login":"Ultimo Accesso",Finished:"Finito","Search For":"Ricerca di","Hide options":"Nascondi le opzioni",Only:"Solo","Sort by":"Ordina per",Legend:"Legenda","Research in progress":"Ricerca in corso",Million:"Milioni",Found:"Trovati","Dont Found":"Non Trovati","Found in Total":"Trovati in Totale","Search on":"Cerco su","Start Search":"Inizia la ricerca","All City":"Tutte le citta'","Only Hostile City":"Solo Citta' Ostili","Only City in the mist":"Solo Citta' sotto Nebbia","Only Allied City":"Solo Citta' Alleate","Only Friendly City":"Solo Citta' Amichevoli","Only Neutral City":"SOlo Citta' Neutrali","Without Alliance":"Senza Alleanza","Alliance Name":"Nome Alleanza",OR:"O","Search Player":"Cerca Giocatore","Search Alliance":"Cerca Alleanza","3 caracteres minimum":"Minimo 3 caratteri","Additional Information":"Informazioni Addizionali",Profile:"Profilo",Details:"Details","Results For":"Risultati per",Date:"Data",Attacker:"Attaccante",Defender:"Difensore",Type:"Tipo",City:"Citta'",Rang:"Posizione",Members:"Membri",Diplomacy:"Diplomazia",Population:"Popolazione",Provinces:"Province","Research reports of attacks on the alliance":"Cerca gli attacchi nei report dell'alleanza",Pages:"Pagine",Page:"Pagina",Destination:"Destinazione","Start the search":"Avvia la ricerca","Stop the search":"Ferma la ricerca",Searching:"Sto cercando","All Reports":"Tutti i Report","My Reports":"Miei Report","Attacks Received":"Attacchi Ricevuti","Attacks Sent":"Attacchi Inviati","Search for the attacks in the reports of the alliance":"Cerca gli attacchi nei report dell'alleanza","No reports found":"Nessun Report Trovato","Battle Report":"Report di Battaglia",Winner:"Vittorioso",Loser:"Perdente",Knight:"Generale","Number of tours":"Numero di giri","No unit in defense":"Nessuna unita' in difesa",Troops:"Truppe",Fought:"Combattuti",Survived:"Sopravvisuti",undefined:"Non appartieni a nessuna alleanza!","Attacks on":"Attacchi in arrivo","Attacks sent":"Attacchi inviati",of:"di","Overview of the city":"Panoramica della citta'",Research:"Ricerche",Currently:"Attualmente",Cohortes:"Corti",Level:"Livello",Levels:"Livelli",Requirements:"Requisiti","Marks required for new cities":"Sigilli richiesti per le nuove citta'","Choose a FREE gift to send to your friends!":"Scegli un regalo GRATIS da inviare ai tuoi amici!",Send:"Invia",Use:"Usa",Aquired:"Possiedi","Gifts waiting for acceptance":"Regali in attesa dell'accettazione","Accept all GIFTS":"Accetta tutti i REGALI",Configuration:"Configurazione","Aktivieren per Drag-Fenster durch Ziehen bewegen oberen Leiste mit der Maus":"Muovi la finestra trascinando la barra in alto con il mouse","Automatically organize the day of tax (if less than happy":"Automaticamente raccogliere le tasse giornaliere (Se la felicita' è minore del","Auto Collection resources every":"Auto Raccogli le risorse ogni","Show autonomy in red if less than":"Mostra l'autonomia in rosso se meno di","Enable publishing aids automatically Facebook":"Abilita la pubblicazione degli aiuti automaticamente in Facebook","Configuring the chat":"Configurazione della Chat","Put the chat on the right":"Metti la chat del gioco a destra","Enable auto post on alliance chat if autonomy in red":"Abilita l'auto post in chat alleanza se l'autonomia e' in rosso","Click Automatically aid applications":"Clicca automaticamente le richieste d'aiuto","Automatically delete aid applications":"Elimina automaticamente le richieste d'aiuto","Configuration of TowerAlert":"Configurazione Torre di Allerta","Post Automatic incoming attacks on the alliance chat":"Posta automaticamente gli attacchi nella chat alleanza","Emit an audible alarm":"Emetti un allarme sonoro",WARNING:"ATTENZIONE","After setting the tools, updates the game":"Dopo aver settato il tools, riaggiorna il gioco","Refresh the game":"Ricarica il gioco","Send alliance chat alert as whisper":"Invia l'avviso della chat alleanza come sussurro a me","Chat Enhancements":"Miglioramenti della chat","Enable Global chat background color":"Abilita il colore di sfondo nella chat Globale","Enable Alliance chat background color":"Abilita il colore di sfondo nella chat Alleanza","Shows the status of the troops (Hidden/Defense)":"Mostra lo stato delle truppe (Nascoste/Difesa)","Shows the arrival time of the attack":"Mostra il tempo di arrivo dell'attacco","Enable spam chat (alliance) if food is red":"Abilita lo spam in chat (alleanza) se manca cibo",Source:"Da",Reassign:"Riassegna",Transporter:"Trasporta","Or the coordinates":"O le coordinate",Quantity:"Quantita'","The Quantity of resources depends on how many units selected":"L'ammontare di risorse dipende da quante unità selezionate","Type of resource":"Tipo di Risorsa","troops from one city to another":"truppe da una città all'altra","Transport of goods from one city to another":"Trasporto di risorse da una città all'altra",Hostile:"Ostile",Friendly:"Amici",Neutral:"Neutrale",All:"Tutti","Friends of Friends":"Amici di Amici",Friends:"Amici","Only Me":"Solo Io",Hours:"Ore",Hour:"Ora",Minutes:"Minuti",Minute:"Minuto",Seconds:"Secondi",Second:"Secondo",Scout:"Esplorazione",Scouting:"Esplorazione",Transport:"Trasporto",Attack:"Attacco",Defense:"Difesa",Unknow:"Sconosciuto",Reinforcement:"Rinforzo",Reinforcements:"Rinforzi",None:"Nessuna/o",Overview:"Panorama",Marches:"Marce",AllianceList:"Giocatori",Reports:"Rapporti",Search:"Ricerca",Transport:"Trasporti",Reassign:"Riassegna",Wilds:"Terre",Crests:"Info Citta'",Gifts:"Regali",Options:"Opzioni"},FBsecondTimer=null,pbStartupTimer=null,my={},Cities={},currentName="Overview",TabOverview=translate("Ich"),TabHudMarches=translate("Maersche"),TabAllianceList=translate("SpielerSuche"),TabHud=translate("Kampfberichte"),TabSearch=translate("Suche"),TabTranspAuto=translate("Transport"),TabReassign=translate("Zuordnen"),TabWilds=translate("Wildniss"),TabCrests=translate("Siegel"),TabGifts=translate("Geschenke"),TabOptions=translate("Einstellungen"),Seed=unsafeWindow,currentPage="",mainPop,Tabs=[["Overview",TabOverview],["Hud",TabHud],["marches",TabHudMarches],["AllianceList",TabAllianceList],["Search",TabSearch],["TranspAuto",TabTranspAuto],["Reassign",TabReassign],["Wilds",TabWilds],["Crests",TabCrests],["KDO",TabGifts],["Spam","Spam"],["Options",TabOptions]],myServerId=null;function getServerId(){if(myServerId==null){var a=/^[a-zA-Z]+([0-9]+)\./.exec(document.location.hostname);if(a)myServerId=a[1];else myServerId="??"}return myServerId}var nHtml={FindByXPath:function(d,c,b){if(!b)b=XPathResult.FIRST_ORDERED_NODE_TYPE;try{var a=document.evaluate(c,d,null,b,null)}catch(e){GM_log("bad xpath:"+c)}if(b==XPathResult.FIRST_ORDERED_NODE_TYPE){if(a&&a.singleNodeValue)return a.singleNodeValue}else if(a)return a;return null},ClickWin:function(c,e,d){var a=false,b=c.document.createEvent("MouseEvents");b.initMouseEvent(d,true,true,c,0,0,0,0,0,a,a,a,a,0,null);return!e.dispatchEvent(b)},Click:function(a){return this.ClickWin(window,a,"click")},ClickTimeout:function(b,a){window.setTimeout(function(){return nHtml.ClickWin(window,b,"click")},a+Math.floor(Math.random()*500))},SetSelect:function(b,c){for(var a=0;a<b.options.length;a++)if(c==b.options[a].value){b.options[a].selected=true;return true}return false}};function readGlobalOptions(){GlobalOptions=JSON2.parse(GM_getValue("Options_??","{}"))}readGlobalOptions();function setWide(){var c=null,b=document.body;if(b)for(var a=0;a<b.childNodes.length;a++)if(b.childNodes[a].tagName=="DIV")if(b.childNodes[a].firstChild.tagName=="IFRAME"){c=b.childNodes[a].firstChild;break}if(c)c.style.width="100%"}if(document.URL.search(/gloryofrome.com\/iframeCanvas/i)>=0){setTimeout(setWide,1e3);return}if(document.URL.search(/apps.facebook.com\/gloryofrome/i)>=0){facebookInstance();return}if(document.URL.search(/facebook.com\/dialog\/feed/i)>=0){HandlePublishPopup();return}if(document.URL.search(/facebook.com\/dialog\/apprequests/i)>=0){HandlePublishPopup2();return}function HandlePublishPopup2(){if(GlobalOptions.autoPublishKDO){var b=document.getElementById("uiserver_form");if(b){var d=nHtml.FindByXPath(b,".//input[@type='hidden' and contains(@name,'input_data')]");d;var a=nHtml.FindByXPath(b,".//input[@type='checkbox' and contains(@name,'checkableitems[]')]");if(a){a.value=GlobalOptions.autoPublishKDOWho;!a.checked&&nHtml.Click(a);var c=nHtml.FindByXPath(b,".//input[@type='submit' and contains(@name,'ok_clicked')]");c&&nHtml.Click(c)}}}setTimeout(HandlePublishPopup2,1500)}function HandlePublishPopup(){if(GlobalOptions.autoPublishGamePopups){var a=document.getElementById("uiserver_form");if(a){var d=nHtml.FindByXPath(a,".//input[contains(@name,'channel')]");if(d){var e=d.value,c=nHtml.FindByXPath(a,".//input[@type='submit' and contains(@name,'publish')]"),b=nHtml.FindByXPath(a,".//select[@name='audience[0][value]']");if(c&&b){b.innerHTML='<option value="'+GlobalOptions.autoPublishPrivacySetting+'"></option>';b.selectedIndex=0;nHtml.Click(c)}}}setTimeout(HandlePublishPopup,1e3)}}function facebookInstance(){function a(){var d="100%",e="content",l="canvas_nav_content",k="sidebar_ads",j="leftColContainer",i="rightCol",f=null,b=document.getElementById("app_content_140956165916773");if(!f)for(var h=document.getElementsByTagName("iframe"),c=0;c<h.length;c++)if(h[c].className=="canvas_iframe_util noresize"){f=h[c];break}if(!f){setTimeout(a,1e3);return}try{document.getElementById(i).parentNode.removeChild(document.getElementById(i));document.getElementById(j).parentNode.removeChild(document.getElementById(j));document.getElementById(k).parentNode.removeChild(document.getElementById(k));document.getElementById(l).parentNode.removeChild(document.getElementById(l))}catch(b){}var b=document.getElementById("mainContainer");if(b){document.getElementById(e).style.minWidth="1220px";document.getElementById(e).style.width=d;for(c=0;c<b.childNodes.length;c++)if(b.childNodes[c].id=="contentCol"){b.childNodes[c].style.width=d;b.childNodes[c].style.margin="0px";b.childNodes[c].style.paddingTop="5px";b.childNodes[c].childNodes[1].style.width="99%";break}}var b=document.getElementById("globalContainer");if(b){b.style.width=d;if(b.firstChild){b.firstChild.style.width=d;b.firstChild.style.margin="0 0%"}}var b=document.getElementById("bottomContent");if(b)b.style.padding="0px 0px 12px 0px";var b=document.getElementById("contentArea");if(b){b.style.width=d;for(c=0;c<b.childNodes.length;c++)if(b.childNodes[c].tagName=="div"){b.childNodes[c].style.width=d;b.childNodes[c].firstChild.style.width=d;break}}var b=document.getElementById("pagelet_canvas_content");if(b)b.style.width=d;f.style.width=d;var g=searchDOM(document.getElementById(e),'node.tagName=="DIV" && node.className=="UIStandardFrame_Content"',7);if(g)g.style.width=d;var g=searchDOM(document.getElementById(e),'node.tagName=="DIV" && node.className.indexOf("SidebarAds")>=0',7);if(g)g.style.display="none"}a()}var WideScreen={chatIsRight:false,rail:null,init:function(){var c="mod_comm_list2",b="mod_comm_list1",a="mainCrossBar";t=WideScreen;try{document.getElementById(a).parentNode.removeChild(document.getElementById(a))}catch(d){}if(Options.chatglobal)document.getElementById(b).style.backgroundColor=Options.ChatGlo;else document.getElementById(b).style.backgroundColor="#4C4131";if(Options.chatalliance)document.getElementById(c).style.backgroundColor=Options.ChatAll;else document.getElementById(c).style.backgroundColor="#4C4131"},setChatOnRight:function(d){var i="mod_comm_list2",h="mod_comm_list1",g='node.tagName=="DIV" && node.className.indexOf("chat-wrapper")>=0',f='node.tagName=="DIV" && node.className.indexOf("comm_body comm_global")>=0',b="comm_tabs",e="kocmain_bottom";t=WideScreen;if(d==t.chatIsRight)return;if(d){var j=document.getElementById(e);(!j||j.className!="mod_comm")&&setTimeout(function(){t.setChatOnRight(d)},1200);if(getMyAlliance()[1]!="Aucune")document.getElementById("chat_button2").innerHTML="<span>"+getMyAlliance()[1]+"</span>";document.getElementById(b).style.left="761px";document.getElementById(b).style.top="-590px";document.getElementById(b).style.backgroundColor="#4C4131";var a=searchDOM(document.getElementById(e),f,7);if(a){a.style.left="761px";a.style.top="-565px";a.style.height="700px";a.style.backgroundColor="#60533E";var c=searchDOM(a,g,7);if(c)c.style.height="700px"}document.getElementById(h).style.height="650px";document.getElementById(i).style.height="650px"}else{document.getElementById(b).style.left="";document.getElementById(b).style.top="";document.getElementById(b).style.backgroundColor="";var a=searchDOM(document.getElementById(e),f,7);if(a){a.style.left="";a.style.top="";a.style.backgroundColor="";var c=searchDOM(a,g,7);if(c)c.style.height=""}document.getElementById(h).style.height="100%";document.getElementById(i).style.height="100%"}t.chatIsRight=d}};function ptStartup(){var b=true,d="main_engagement_tabs";clearTimeout(pbStartupTimer);if(unsafeWindow.BOGpbLoaded)return;logit("Starting... Tiestoale");var f=getClientCoords(document.getElementById(d));if(f.width==null||f.width==0){pbStartupTimer=setTimeout(ptStartup,1e3);return}unsafeWindow.BOGpbLoaded=b;readOptions();readTrainingOptions();var i=unsafeWindow,e='.xtab {padding: 2px; border:none; background:none; white-space:nowrap;}    .hostile td { background:crimson; }.friendly td{background:lightblue; }.ally td{background:royalblue; }    .Hostile td { background:crimson; }.Friendly td{background:lightblue; }.Ally td{background:royalblue; }    .neutral td { background:lightgreen; }.unaligned td { background:gold; }    .Neutral td { background:lightgreen; }.Unaligned td { background:gold; }    .xtabBR {padding-right: 5px; border:none; background:none;}    div.ptDiv {background-color:#f0f0f0;}    table.ptTab tr td {padding:2px;border:none; background:none; white-space:nowrap;}    table.ptTabPad tr td {border:none; background:none; white-space:nowrap; padding: 2px 4px 2px 8px;}    table.ptTabBR tr td {border:none; background:none;}    table.ptTabLined tr td {border:1px none none solid none;}    table.ptTabPad tr td.ptentry {background-color:#ffeecc; padding-left: 8px;}    table.ptTabOverview tr td {border:1px none none solid none; white-space:nowrap; padding: 1px 2px;  font-size:12px;}    table.ptNoPad tr td {border:none; background:none; white-space:nowrap; padding:0px}    .ptOddrow {background-color:#797979}    .ptstat { border:1px solid; font-weight:bold; padding-top:2px; padding-bottom:2px; text-align:center; color:#000000; background-image:url("http://kabam1-a.akamaihd.net/gloryofrome/common/img/gor/backgrounds/bg_questPinning01.png?v1_34")}    .ptStatLight {color:#797979}    .ptEvidence {color:#000000}    .ptentry {padding: 7px; border:1px solid; border-color:#000000; background-color:#CAC4C4; white-space:nowrap;}    .ptErrText {font-weight:bold; color:#600000}    .castleBut {outline:0px; margin-left:0px; margin-right:0px; width:24px; height:26px; font-size:12px; font-weight:bold;}    .castleBut:hover {border-size:3px; border-color:#000;}    .castleButNon {background-image:url("'+URL_CASTLE_BUT+'")}    .castleButSel {background-image:url("'+URL_CASTLE_BUT_SEL+'")}    input.BODefButOn {cursor:pointer; border:1px solid black; background-color:red;}    input.BODefButOff {cursor:pointer; border:1px solid black; background-color:#0a0;}    button::-moz-focus-inner, input[type="submit"]::-moz-focus-inner { border: none; }    span.whiteOnRed {padding-left:3px; padding-right:3px; background-color:#700; color:white; font-weight:bold}    span.boldRed {color:#800; font-weight:bold}    span.boldDarkRed {color:#600; font-weight:bold}    a.ptButton20 {color:#ffff80}   .matTab {}   .matTabNotSel { padding:0 0 0 20px;  color : #ffffff; font: bold 11px Georgia; white-space: nowrap; cursur:pointer; padding:0 3px 0 0;height: 17px; }   .matTabNotSel span { background: url("http://kabam1-a.akamaihd.net/gloryofrome/common/img/gor/progress_engagement/socialtab_up.png?v1_34") no-repeat scroll left 0 transparent;    display: inline-block;    height: 16px;    padding: 1px 2px 0 7px;    text-decoration: none;   }   .matTabSel { color : #2F230E; font: bold 11px Georgia; white-space: nowrap; cursur:pointer; padding:0 3px 0 0;height: 17px;   }   .matTabSel span { background: url("http://kabam1-a.akamaihd.net/gloryofrome/common/img/gor/progress_engagement/socialtab_down.png?v1_34") no-repeat scroll left top transparent; display: inline-block;    height: 16px;    padding: 1px 2px 0 7px;    text-decoration: none;   }   tr.CPopupTop td { background-color:#797979; border:none; height: 15px;  padding:0px; }   .BOptretry_top { background-color:#a00; color:#fff; border:none; height: 21px; padding:0px; }   input.ptButCancel {background-color:#a00; font-weight:bold; color:#fff}    .id2_CPopupTop td { background-color:#797979;}    .CPopup .CPopMain { background-color:#797979; color:#FFFFFF; padding:3px;}    .CPopup .id2_CPopMain { background-color:#8ff; }    .CPopup  { border:3px ridge #666 }    .idp2_CPopup { opacity:0.9; }';setCities();if(Options.ptWinPos==null||Options.ptWinPos.x==null||Options.ptWinPos.x==""||isNaN(Options.ptWinPos.x)){var c=getClientCoords(document.getElementById(d));Options.ptWinPos.x=c.x+4;Options.ptWinPos.y=c.y+c.height;saveOptions()}GM_addStyle(e);mainPop=new CPopup("idp",Options.ptWinPos.x,Options.ptWinPos.y,800,700,b,function(){my[currentName].hide();Options.ptWinIsOpen=false;saveOptions()});var g=mainPop.getMainDiv();mainPop.getMainDiv().innerHTML="<STYLE>"+e+"</style>";mainPop.getTopDiv().innerHTML='<TABLE cellspacing=0 width=100%><TR class=CPopupTop valign=bottom><TD><SPAN id=idTabs></span></td><TD align=center><font color="white">v '+Version+'&nbsp;</font><iframe src="" id="BOsound" frameborder=0 height=0 width=0></iframe></td></tr></table>';var h=document.getElementById("idTabs");for(k=0;k<Tabs.length;k++){var a=document.createElement("a");a.className="matTabNotSel";a.id="aa"+Tabs[k][0];a.innerHTML='<span id="sp'+Tabs[k][0]+'" class="matTab">'+Tabs[k][1]+"</span>";h.appendChild(a);a.addEventListener("click",clickedTab,false);my[Tabs[k][0]].init();cont=my[Tabs[k][0]].getContent();cont.style.display="none";g.appendChild(cont)}setTabStyle(document.getElementById("aaOverview"),b);my.Overview.getContent().style.display="block";if(Options.ptWinIsOpen){mainPop.show(b);my[currentName].show()}window.addEventListener("unload",onUnload,false);AddMainTabLink("13",eventHideShow,mouseMainTab);CollectGold.init();CollectRessource.init();SpamEvery.init();ResSpamEvery.init();FoodAlerts.init();TowerAlerts.init();TowerAlerts.setPostToChatOptions(Options.alertConfig);WideScreen.init();WideScreen.setChatOnRight(Options.pbChatOnRight);setInterval(HandleChatPane,2500)}function onUnload(){Options.ptWinPos=mainPop.getLocation();saveOptions()}var TowerAlerts={viewImpendingFunc:null,generateIncomingFunc:null,AlarmeTimer:null,fixTargetEnabled:false,compteur:0,init:function(){var a=TowerAlerts},secondTimer:null,setPostToChatOptions:function(){var a=TowerAlerts;clearTimeout(a.secondTimer);Options.alertConfig.aChat&&a.e_eachSecond()},e_eachSecond:function(){var a=TowerAlerts,b=unixTime();unsafeWindow.player.allCities().sortBy(function(a){return a.number}).each(function(b){var d="",e="";b.underAttack()&&Cities.byID[b.id].c.incomingAttackMarches().each(function(e){var c=Cities.byID[b.id].c.marches.incoming[e.id],d=c.secondsToDestination()>0?c.secondsToDestination():0;if(d>0&&(a.getTowerMarch(c.id)==null||a.getTowerMarch(c.id)==undefined)){a.addTowerMarch(c.id,d);a.postToChat(b,e,false);saveOptions()}})});a.secondTimer=setTimeout(a.e_eachSecond,5e3)},addTowerMarch:function(c,b){var d=TowerAlerts,a=unixTime();for(k in Options.towerMarches)if(Options.towerMarches[k].arrival+Options.towerMarches[k].added<a)delete Options.towerMarches[k];Options.towerMarches["m"+c]={added:a,arrival:b}},getTowerMarch:function(a){var b=TowerAlerts;return Options.towerMarches["m"+a]},alarme:function(){var a=TowerAlerts;a.compteur++;document.getElementById("BOsound").src="http://www.universal-soundbank.com/mp3/sounds/2936.mp3";a.compteur>1&&clearInterval(a.AlarmeTimer)},postToChat:function(f,b){var h="Meine Truppen",a=" ",g=TowerAlerts;if(Cities.byID[f.id].c.wilds[b.to.tileId])var e=translate("Wildniss")+a+unsafeWindow.Watchtower.generateCoords(b.to.cityId,b.to.tileId);else{var e=translate("Stadt")+a+unsafeWindow.player.cities[b.to.cityId].name+" ("+unsafeWindow.player.cities[b.to.cityId].x+","+unsafeWindow.player.cities[b.to.cityId].y+")";if(Options.StatusTroops)if(Cities.byID[f.id].c.defending!=0)e+=" **("+translate(h)+a+translate("sind")+a+translate("in Verteidigung")+")** ";else e+=" **("+translate(h)+a+translate("sind")+a+translate("Versteckt")+")**";else e+=""}var d=Cities.byID[f.id].c.marches.incoming[b.id],k=unsafeWindow.GOR.players[b.from.playerId]?unsafeWindow.GOR.players[b.from.playerId].name:"?",j=d.secondsToDestination()>0?timestr(d.secondsToDestination()):message,c="";c+=d.general.level?" - "+translate("Level General")+" : "+d.general.level:"";c+=" *** "+translate("DER FEIND KOMMT MIT")+" *** ";unsafeWindow.Object.keys(d.units).each(function(b){if(d.units[b].sent>0)c+=d.units[b].sent+a+unsafeWindow.arStrings.unitName["u"+b]+", "});c=c.slice(0,-2);if(Options.TimeAttack)c+=" ("+translate("SEINE TRUPPEN KOMMEN IN")+a+j+")";else c+="";var i=Options.alertConfig.aMessAtt+a+translate("Ziel")+" : "+e+a+translate("Angreifer")+" : "+a+k+a+c,l=0;if(Options.Whisper)sendChat("/"+unsafeWindow.player.name+a+i);else sendChat("/a "+i);if(Options.alertConfig.aAudio){g.AlarmeTimer=setInterval(g.alarme,15e3);g.alarme()}}};my.marches={cont:null,state:null,displayTimer:null,getContent:function(){var a=my.marches;return a.cont},init:function(){var a=my.marches;a.cont=document.createElement("div");return this.cont},show:function(){var o="</table>",d="</td><td><b>",n="<table class='marches' width=100% cellspacing=0 bordercolor=black cellpadding=4><tr style='height:30px'><td><b>",i="<td ",h="</td>",g="</td><td ",c=">",m="<tr><td ",l=' style="background:',b="",j=my.marches;clearTimeout(j.displayTimer);if(j.state==null){j.cont.innerHTML='<DIV id=marchesContent style="height:630px; max-height:630px; overflow-y:auto"></div>';j.state=1}var a="<DIV class=ptstat>"+translate("eingehende Angriffe")+"</div>",f=b,k=0;unsafeWindow.player.allCities().sortBy(function(a){return a.number}).each(function(a){var e=b,j=b;a.underAttack()&&Cities.byID[a.id].c.incomingAttackMarches().each(function(d){var e=Cities.byID[a.id].c.marches.incoming[d.id],o=e.secondsToDestination()>0?e.secondsToDestination():0;if(o>0){k++;couleur=b;if(k%2)couleur=l+Options.Sfondo+'"';var o=e.secondsToDestination()>0?timestr(e.secondsToDestination()):"Unknown",p=unsafeWindow.GOR.players[d.from.playerId]?unsafeWindow.GOR.players[d.from.playerId].name:"?";if(Cities.byID[a.id].c.wilds[d.to.tileId])var q=translate("Wildniss")+" "+unsafeWindow.Watchtower.generateCoords(d.to.cityId,d.to.tileId);else var q=translate("Stadt")+" "+unsafeWindow.player.cities[d.to.cityId].name+" ("+unsafeWindow.player.cities[d.to.cityId].x+","+unsafeWindow.player.cities[d.to.cityId].y+")";f+=m+couleur+c+q+g+couleur+c+o+h;var n=b;if(d.from.allianceId>0&&Seed.allianceNames&&Seed.allianceNames["a"+e.from.allianceId])n=b+Seed.allianceNames["a"+e.from.allianceId]+b;else if(d.from.allianceName!==null)n=b+d.from.allianceName+b;f+=i+couleur+c+p+g+couleur+c+n+h;f+=i+couleur+"> "+(e.general.level?translate("Level")+" "+e.general.level:" Unknown ")+h;var j=b;unsafeWindow.Object.keys(e.units).each(function(a){if(e.units[a].sent>0)j+=e.units[a].sent+" "+unsafeWindow.arStrings.unitName["u"+a]+"<br>"});j=j.slice(0,-2);f+=i+couleur+c+j+h;f+="</tr>"}})});if(f!=b){a+=n;a+=translate("Ort angegriffen");a+=d;a+=translate("Zeit");a+=d;a+=translate("Angreifer");a+=d;a+=translate("Allianz");a+=d;a+=translate("General");a+=d;a+=translate("Truppen");a+="</td><tr>";a+=f;a+=o}a+='<br><DIV style="height:620px; max-height:620px; overflow-y:auto"><DIV class=ptstat>'+translate("abgehende Maersche")+"</div>";var k=0,e=b;unsafeWindow.player.allCities().sortBy(function(a){return a.number}).each(function(a){var d=unsafeWindow.Object.values(Cities.byID[a.id].c.marches.outgoing).compact();d=d.concat(unsafeWindow.Object.values(Cities.byID[a.id].c.marches.bgReinforcements).compact());d.each(function(d){var o=b,j='<a onclick="KB.Controllers.MapHelper.gotoCoord('+d.to.x+","+d.to.y+');">('+d.to.x+","+d.to.y+")</a>";k++;couleur=b;if(k%2)couleur=l+Options.Sfondo+'"';var n=unixTime(),f=d.secondsToDestination()>0?timestr(d.secondsToDestination()):d.secondsToReturn()>0?timestr(d.secondsToReturn()):"Unknown";e+=m+couleur+c+Cities.byID[a.id].c.name+g+couleur+c+f+g+couleur+c+d.typeString()+g+couleur+c+d.statusString()+g+couleur+c+j+h;gen=Cities.byID[a.id].c.generals[d.general.id];if(gen!=undefined)e+=i+couleur+c+gen.name+" ("+gen.level()+")</td>";else e+=i+couleur+">??</td>";e+=i+couleur+c;unsafeWindow.Barracks.allUnitIds.each(function(a){var b=d.returning()||d.defending()?d.units[a].returning:d.units[a].sent;if(b>0)e+=addCommas(b)+" "+unsafeWindow.arStrings.unitName["u"+a]+"<br>"});e+=h;e+="</tr>"})});if(e!=b){a+=n;a+=translate("Stadt");a+=d;a+=translate("Zeit");a+=d;a+=translate("Typ");a+=d;a+=translate("Status");a+=d;a+=translate("Koords");a+=d;a+=translate("General");a+=d;a+=translate("Truppen");a+="</td></tr>";a+=e;a+=o}document.getElementById("marchesContent").innerHTML=a;j.displayTimer=setTimeout(j.show,2e3)},hide:function(){var a=my.marches;clearTimeout(a.displayTimer)}};my.Hud={cont:null,state:null,popReport:null,minPages:parseInt(Options.arPageFrom),maxPages:parseInt(Options.arPageTo),totalPages:parseInt(Options.arPageTo),data:[],getContent:function(){var a=my.Hud;return a.cont},init:function(){var a=my.Hud;a.cont=document.createElement("div");return this.cont},show:function(){var b=false,c="click",a=my.Hud;a.getAllianceReports();unsafeWindow.getReport=a.getReportBody;a.cont.innerHTML="           <DIV class=ptstat>"+translate("Suche nach den Anschlaegen in den Berichten der Allianz")+'</div>           <DIV class=ptentry style="height:30px"><table>           <tr><td class=xtab>'+translate("Seite")+' :&nbsp;<INPUT id="idRptPageFrom" size=1 value="'+Options.arPageFrom+'">&#8211;<INPUT id="idRptPageTo" size=1 value="'+Options.arPageTo+'">            <span id=idSpanNumPages></span>           </td>           <TD class=xtab><INPUT id="idHudSearch" type=submit value="OK" />           <td><select id="idHudTypeSearch"><option value="">'+translate("Alle Berichte")+'</option><option value="0">'+translate("Angriffe auf")+'</option><option value="1">'+translate("Angiffe gesendet")+'</option><option value="2">'+translate("Verstaerkung")+'</option></select>           <select id="idHudMedSearch"><option value="">'+translate("Alle")+"</option><option value=1>"+translate("Meine Berichte")+'</option></select></td>           <td><span style="color:red" id=idSpanHudErrorMsg></span></td></tr>           </table></div>           <DIV id="hudResultsDiv" style="height:580px; max-height:580px; overflow-y:auto;"></div>';document.getElementById("idHudSearch").addEventListener(c,a.handleHudSearch,b);document.getElementById("idHudMedSearch").addEventListener(c,a.DisplayReports,b);document.getElementById("idHudTypeSearch").addEventListener(c,a.DisplayReports,b);document.getElementById("idRptPageFrom").addEventListener("change",a.handleRptPages,b);document.getElementById("idRptPageTo").addEventListener("change",a.handleRptPages,b);setTimeout(function(){a.handleHudSearch()},100)},getReportBody:function(f,i,e,a,g,c,h,d){var j=my.Hud;if(a=="Ent")a=0;if(a=="Sor")a=1;if(a=="Ren")a=0;var b={};b.rid=i;b.side=a;if(a=="Ren")a=2;unsafeWindow.AjaxCall.gPostRequest("fetchReport.php",b,function(b){j.showReportBody(f,b.data,e,a,g,c,h,d)},function(){})},handleRptPages:function(){var b="idRptPageTo",a=my.Hud;a.minPages=parseInt(document.getElementById("idRptPageFrom").value);a.maxPages=parseInt(document.getElementById(b).value);if(a.maxPages<a.minPages){a.maxPages=a.minPages;document.getElementById(b).value=a.maxPages}Options.arPageFrom=a.minPages;Options.arPageTo=a.maxPages;saveOptions();a.totalPages=a.maxPages},showReportBody:function(sb,a,C,pb,qb,V,D,W){var w="frt",U="</td><tr>",T=", ",S=")</td><td>",R=" (",v="<tr><td>",Q="Menge",bb='<TD><FONT size="3px">',l=" : </td><TD>",ob=" :</u></b><br></tr><TR>",ab="</td></table>",P="Eisen",O="Stein",N="Holz",M="Nahrung",k="<TD>",j="</td>",B=' : </td><TD><FONT color="#CC0000">',L="Silber",K="Ressourcen",Z="<TABLE class=ptTab cellpadding=3><tr><td colspan=4><b><u>",J="</table>",nb='</td><TD align="center">Renforc&eacute;</td></tr>',mb="<TR><TD></TD></TR></table>",lb="Keine Einheit in der Verteidigung",kb="<tr><td><br>",e="f",u='<TR style="background-color:#E5DDC9;color: #422714;font-size: 12px;font-weight: bold;"><TD align="center">',jb="Verteidiger",ib='</table><TABLE style="float:right;width:45%;" class=ptTab><tr><td colspan=3><b>',s="</font></td></tr>",r='</td><TD align="center"><FONT color="#CC0000">',h='"></td><TD align="center">',g='<TR><TD align="center"><div  class="pic px30 units unit_',d="u",f="</td></tr>",I="Ueberlebt",H="Kaempfte",i='</td><TD align="center">',q="Truppen",t="Devensive",A=" - ",G="Angriff",p=" % ",o=100,hb="<br>Bonus : ",gb="Kampfrunden",n="<br>",m=" : ",z="General",Y=")</a></b><br>",X=');" class="coordinateLink">(',F=' <a href="javascript:void(0)" onclick="KB.Controllers.MapHelper.gotoCoord(',fb="Angreifer",eb='<TABLE style="float:left;width:45%;" class=ptTab><tr><td colspan=3><b>',db="</b><br></font></td></tr></table>",y="</font></td>",E="Wilderness",cb='<TD><FONT size="4px">',x=my.Hud;if(x.popReport==null){x.popReport=new CPopup("pbShowBarbs",0,0,520,420,true,function(){clearTimeout(1e3)});x.popReport.centerMe(mainPop.getMainDiv())}var c="";c+="<TABLE class=ptTab cellpadding=3>";if(pb==0){if(C<51&&a.tileLevel!=undefined)c+=cb+translate(E)+" Lvl "+a.tileLevel+y;if(C<51&&a.tileLevel==undefined)c+=cb+translate(E)+y;if(a.conquered==1)c+='<TD><FONT color="#CC0000" size="4px">Conquis</font></td></tr>';if(a.winner==1)c+='<TR><TD><FONT color="#CC0000" size="6"><b>'+translate("Verlierer")+db;if(a.winner==0)c+='<TR><TD><FONT color="green" size="6"><b>'+translate("Gewinner")+db;if(a.fght!=undefined){c+=eb+translate(fb)+": "+qb+F+V+X+V+Y+translate(z)+m+a.s1KCombatLv+n+translate(gb)+m+a.rnds+hb+parseInt(a.s1atkBoost*o)+p+translate(G)+A+parseInt(a.s1defBoost*o)+p+translate(t)+'</td></tr>   \t\t\t    <TR style="background-color:#E5DDC9;color: #422714;font-size: 12px;font-weight: bold;"><TD align="center">'+translate(q)+i+translate(H)+i+translate(I)+f;if(a.fght.s1!=undefined)for(var b=1;b<32;b++)if(a.fght.s1[d+b]!=undefined)if(a.fght.s1[d+b][0]>a.fght.s1[d+b][1])c+=g+b+h+a.fght.s1[d+b][0]+r+a.fght.s1[d+b][1]+s;else c+=g+b+'"></div></td><TD align="center">'+a.fght.s1[d+b][0]+i+a.fght.s1[d+b][1]+f;c+=ib+translate(jb)+m+D+F+W+X+W+Y+translate(z)+m+a.s0KCombatLv+"<br><br>Bonus : "+parseInt(a.s0atkBoost*o)+p+translate(G)+A+parseInt(a.s0defBoost*o)+p+translate(t)+f;if(a.fght.s0!=undefined){c+=u+translate(q)+i+translate(H)+i+translate(I)+f;for(var b=60;b<=63;b++)if(a.fght.s0[e+b]!=undefined)if(a.fght.s0[e+b][0]>a.fght.s0[e+b][1])c+=g+b+h+a.fght.s0[e+b][0]+r+a.fght.s0[e+b][1]+s;else c+=g+b+h+a.fght.s0[e+b][0]+i+a.fght.s0[e+b][1]+f;for(var b=1;b<32;b++)if(a.fght.s0[d+b]!=undefined)if(a.fght.s0[d+b][0]>a.fght.s0[d+b][1])c+=g+b+h+a.fght.s0[d+b][0]+r+a.fght.s0[d+b][1]+s;else c+=g+b+h+a.fght.s0[d+b][0]+i+a.fght.s0[d+b][1]+f;for(var b=50;b<=55;b++)if(a.fght.s0[e+b]!=undefined)if(a.fght.s0[e+b][0]>a.fght.s0[e+b][1])c+=g+b+h+a.fght.s0[e+b][0]+r+a.fght.s0[e+b][1]+s;else c+=g+b+h+a.fght.s0[e+b][0]+i+a.fght.s0[e+b][1]+f}else{c+=kb;c+=translate(lb);c+=f}c+=mb}if(a.unts!=undefined){c+='<TABLE style="float:right;width:45%;" class=ptTab><TR style="background-color:#E5DDC9;color: #422714;font-size: 12px;font-weight: bold;"><TD align="center">'+translate(q)+nb;for(var b=1;b<=31;b++)if(a.unts[d+b]!=undefined)c+=g+b+h+a.unts[d+b]+f;c+=J}c+="<TR><TD></TD></TR><TR><TD></TD></TR></table>";if(a.loot!=undefined){c+=Z+translate(K)+" :</u></b><br>   \t\t        </tr><TR><TD>"+translate(L)+B+addCommas(parseInt(a.loot[0]))+j;c+=k+translate(M)+B+addCommas(parseInt(a.loot[1]))+j;c+=k+translate(N)+B+addCommas(parseInt(a.loot[2]))+j;c+=k+translate(O)+B+addCommas(parseInt(a.loot[3]))+j;c+=k+translate(P)+B+addCommas(parseInt(a.loot[4]))+ab}if(a.rsc!=undefined){c+=Z+translate(K)+ob;if(a.gld!=undefined)c+=k+translate(L)+l+addCommas(parseInt(a.gld))+j;c+=k+translate(M)+l+addCommas(parseInt(a.rsc.r1))+j;c+=k+translate(N)+l+addCommas(parseInt(a.rsc.r2))+j;c+=k+translate(O)+l+addCommas(parseInt(a.rsc.r3))+j;c+=k+translate(P)+l+addCommas(parseInt(a.rsc.r4))+ab}}else if(pb=="2"){c+='<TABLE style="float:left;width:45%;" class=ptTab><TR style="background-color:#E5DDC9;color: #422714;font-size: 12px;font-weight: bold;"><TD align="center">'+translate(q)+nb;for(var b=1;b<=31;b++)if(a.unts[d+b]!=undefined)c+=g+b+h+a.unts[d+b]+f;c+=J}else{c+='<table border=0 bgcolor=white width=100% cellpadding=3><tr><td colspan=2 style="background-color:#000000;"><table>';if(C<51&&a.tileLevel!=undefined)c+=bb+translate(E)+" Lvl "+a.tileLevel+y;if(C<51&&a.tileLevel==undefined)c+=bb+translate(E)+y;if(C==51&&D==undefined)c+=bb+translate("Barbaren Lager")+y;if(a.conquered==1)c+='<TD><FONT color="#CC0000" size="3px">Conquis</font></td></tr>';if(a.winner==0)c+='<TR><TD style="background-color:#000000;"><FONT color="#CC0000" size="6"><b>'+translate("Verlierer")+"<br><br></font></td></TR></table>";if(a.winner==1||a.winner==2)c+='<TR><TD style="background-color:#000000;"><FONT color="green" size="6"><b>'+translate("Gewinner")+"<br><br></font></td></tr></table>";if(a.fght!=undefined){c+=eb+translate(fb)+m+qb+F+V+')" class="coordinateLink">('+V+")</a></b>     \t  \t\t\t    <br>"+translate(z)+m+a.s1KCombatLv+n+translate(gb)+m+a.rnds+hb+parseInt(a.s1atkBoost*o)+p+translate(G)+A+parseInt(a.s1defBoost*o)+p+translate(t)+'</td></tr>     \t  \t\t\t    <TR style="background-color:#E5DDC9;color: #422714;font-size: 12px;font-weight: bold;"><TD align="center">'+translate(q)+i+translate(H)+i+translate(I)+f;if(a.fght.s1!=undefined)for(var b=1;b<32;b++)if(a.fght.s1[d+b]!=undefined)if(a.fght.s1[d+b][0]>a.fght.s1[d+b][1])c+=g+b+h+addCommas(a.fght.s1[d+b][0])+r+addCommas(a.fght.s1[d+b][1])+s;else c+=g+b+h+addCommas(a.fght.s1[d+b][0])+i+addCommas(a.fght.s1[d+b][1])+f;if(D==undefined)D="barbare";c+=ib+translate(jb)+m+D+F+W+X+W+Y+translate(z)+m+a.s0KCombatLv+n;if(a.lstlgn!=undefined)c+=translate("letzter Login")+m+unsafeWindow.formatDateByUnixTime(a.lstlgn)+n;else c+=n;c+="Bonus : "+parseInt(a.s0atkBoost*o)+p+translate(G)+A+parseInt(a.s0defBoost*o)+p+translate(t)+f;if(a.fght.s0!=undefined){c+=u+translate(q)+i+translate(H)+i+translate(I)+f;for(var b=60;b<=63;b++)if(a.fght.s0[e+b]!=undefined)if(a.fght.s0[e+b][0]>a.fght.s0[e+b][1])c+=g+b+h+a.fght.s0[e+b][0]+r+a.fght.s0[e+b][1]+s;else c+=g+b+h+a.fght.s0[e+b][0]+i+a.fght.s0[e+b][1]+f;for(var b=1;b<32;b++)if(a.fght.s0[d+b]!=undefined)if(a.fght.s0[d+b][0]>a.fght.s0[d+b][1])c+=g+b+h+addCommas(a.fght.s0[d+b][0])+r+addCommas(a.fght.s0[d+b][1])+s;else c+=g+b+h+addCommas(a.fght.s0[d+b][0])+i+addCommas(a.fght.s0[d+b][1])+f;for(var b=50;b<=55;b++)if(a.fght.s0[e+b]!=undefined)if(a.fght.s0[e+b][0]>a.fght.s0[e+b][1])c+=g+b+h+a.fght.s0[e+b][0]+r+a.fght.s0[e+b][1]+s;else c+=g+b+h+a.fght.s0[e+b][0]+i+a.fght.s0[e+b][1]+f}else if(a.unts!=undefined||a.frt!=undefined){if(a.frt!=undefined){c+=u+translate(t)+i+translate(Q)+f;for(var b=60;b<=63;b++)if(a.frt[e+b]!=undefined)c+=g+b+h+addCommas(a.frt[e+b])+f;for(var b=50;b<=55;b++)if(a.frt[e+b]!=undefined)c+=g+b+h+addCommas(a.frt[e+b])+f}if(a.frt!=undefined){c+=u+translate(q)+i+translate(Q)+f;for(var b=1;b<=31;b++)if(a.unts[d+b]!=undefined)c+=g+b+h+addCommas(a.unts[d+b])+f}}else{c+=kb;c+=translate(lb);c+=f}c+=mb}c+="</td></tr><tr><td><br></tr>";if(a.pop!=undefined){c+='<tr><td style="background-color:#000000;"><b><u>'+translate("Spaehen")+"</u></b><br><br>";c+='<table style="float:left;width:45%;"class=ptTab><TR style="background-color:#E5DDC9;color: #422714;font-size: 12px;font-weight: bold;"><td align="center">'+translate("Ueberblick ueber die Stadt")+'<td align="center">&nbsp;</tr><TR><TD>'+translate("Bevoelkerung")+"</TD><TD>"+addCommas(parseInt(a.pop))+f;if(a.hap!=undefined)c+=v+translate("Freude")+"<td>"+a.hap+j;if(a.knght!=undefined)c+=v+translate(z)+"<td>"+a.knght.cbt+j;if(a.blds!=undefined){c+='<TR style="background-color:#E5DDC9;color: #422714;font-size: 12px;font-weight: bold;"><td align="center">'+translate("Gebaeude")+'<td align="center">'+translate("Level")+"</tr>";if(a.blds.b1!=undefined){c+="<tr><td width=40%>"+translate("Bauernhof")+R+a.blds.b1.length+S;zz="";for(var b=0;b<a.blds.b1.length;b++){if(b%9==0&&b!=0)zz+=n;zz+=a.blds.b1[b]+T}c+=zz.substr(0,zz.length-2);c+=U}if(a.blds.b2!=undefined){c+=v+translate("Saegewerk")+R+a.blds.b2.length+S;zz="";for(var b=0;b<a.blds.b2.length;b++){if(b%9==0&&b!=0)zz+=n;zz+=a.blds.b2[b]+T}c+=zz.substr(0,zz.length-2);c+=U}if(a.blds.b3!=undefined){c+=v+translate("Steinbruch")+R+a.blds.b3.length+S;zz="";for(var b=0;b<a.blds.b3.length;b++){if(b%9==0&&b!=0)zz+=n;zz+=a.blds.b3[b]+T}c+=zz.substr(0,zz.length-2);c+=U}if(a.blds.b4!=undefined){c+=v+translate("Bergwerk")+R+a.blds.b4.length+S;zz="";for(var b=0;b<a.blds.b4.length;b++){if(b%9==0&&b!=0)zz+=n;zz+=a.blds.b4[b]+T}c+=zz.substr(0,zz.length-2);c+=U}}if(a.unts!=undefined||a.frt!=undefined){if(a.frt!=undefined){c+=u+translate(t)+i+translate(Q)+f;for(var b=60;b<=63;b++)if(a.frt[w+b]!=undefined)if(parseInt(a.frt[w+b])>0)c+=g+b+h+addCommas(a.frt[w+b])+f;for(var b=50;b<=55;b++)if(a.frt[w+b]!=undefined)if(parseInt(a.frt[w+b])>0)c+=g+b+h+addCommas(a.frt[w+b])+f}if(a.frt!=undefined){c+=u+translate(q)+i+translate(Q)+f;for(var b=1;b<=31;b++)if(a.unts[d+b]!=undefined)if(parseInt(a.unts[d+b])>0)c+=g+b+h+addCommas(a.unts[d+b])+f}}c+=J}if(a.tch!=undefined){c+='<table style="float:right;width:45%;" class=ptTab><TR style="background-color:#E5DDC9;color: #422714;font-size: 12px;font-weight: bold;"><TD align="center">'+translate("Forschung")+i+translate("Level")+f;for(var b=1;b<=16;b++)if(a.tch["t"+b]!=undefined)c+="<tr><TD>"+unsafeWindow.arStrings.techName["t"+b]+"</td><TD>"+a.tch["t"+b]+f;c+=J}var rb="";if(a.loot!=undefined){c+='</td><tr><td style="background-color:#000000;"><b><u>'+translate(K)+" "+rb+" :</u></b><br>";c+="<TABLE class=ptTab cellpadding=3><TR><TD>"+translate(L)+l+addCommas(parseInt(a.loot[0]))+j;c+=k+translate(M)+l+addCommas(parseInt(a.loot[1]))+j;c+=k+translate(N)+l+addCommas(parseInt(a.loot[2]))+j;c+=k+translate(O)+l+addCommas(parseInt(a.loot[3]))+j;c+=k+translate(P)+l+addCommas(parseInt(a.loot[4]))+j;if(a.loot[5]){c+=v+translate("gefundene Objekte")+":</td>";for(var b=1;b<10;b++)if(a.loot[5]["110"+b]==1)c+="<td colspan=3>"+unsafeWindow.arStrings.itemName["i110"+b]+'<div class="item-icon pic px70 items item_110'+b+'"></td>'}c+="</tr></table>"}if(a.rsc!=undefined){c+=Z+translate(K)+ob;if(a.gld!=undefined)c+=k+translate(L)+l+addCommas(parseInt(a.gld))+j;c+=k+translate(M)+l+addCommas(parseInt(a.rsc.r1))+j;c+=k+translate(N)+l+addCommas(parseInt(a.rsc.r2))+j;c+=k+translate(O)+l+addCommas(parseInt(a.rsc.r3))+j;c+=k+translate(P)+l+addCommas(parseInt(a.rsc.r4))+ab}c+="<br><br></table>"}x.popReport.getMainDiv().innerHTML='<DIV style="max-height:400px; height:400px; overflow-y:scroll">'+c+"</div>";x.popReport.getTopDiv().innerHTML='<TD align="center"><B>'+translate("Kampfbericht")+A+unsafeWindow.formatDateByUnixTime(sb)+j;x.popReport.show(true)},DisplayReports:function(){var k="</td>",e="<td ",j="</font></td>",i="<TD ",q=")</a></td>",p=')" class="coordinateLink">(',o='><a href="javascript:void(0)" onclick="KB.Controllers.MapHelper.gotoCoord(',n="unaligned",g="</td>              <td ",f="','",c=",",d=">",m=my.Hud,t=m.data,h=document.getElementById("idHudTypeSearch").value,r=document.getElementById("idHudMedSearch").value,s=document.getElementById("hudResultsDiv");if(!m.data.length){s.innerHTML="<center><b>"+translate("Keine Kampberichte gefunden")+"</b></center>";return}var b="<center><table width=100% cellspacing=0 cellpadding=3><thead><th>"+translate("Seite")+"</th><th>&nbsp;</th><th>"+translate("Datum")+"</th><th colspan=3>"+translate("Angreiffer")+"</th><th>"+translate("Typ")+"</th><th colspan=4>"+translate("Ziel")+"</th></thead>";b+="<tbody>";for(var l=0;l<m.data.length;l++){var a=t[l];if(a.side0Name=="undefined")continue;style="padding:2px;";if(a.TypeName=="Ent")style=' style="background-color:#EF9999;padding:2px;"';if(a.TypeName=="Ren")style=' style="background-color:#99EF99;padding:2px;"';if((r==""||r=="1"&&(a.side1Name==Seed.player.name||a.side0Name==Seed.player.name))&&(h==""||h=="0"&&a.TypeName=="Ent"||h=="1"&&a.TypeName=="Sor"||h=="2"&&a.TypeName=="Ren")){b+="<tr ><td "+style+'><SPAN onclick="ptAllianceReports('+a.page+')"> <a>'+a.page+"</a></span></td>           <td "+style+d;if(!(a.marchType==3&&a.TypeName=="Ent"))b+='<img onclick="getReport('+a.reportUnixTime+c+a.marchReportId+c+a.side0TileType+",'"+a.TypeName+f+a.side1Name+f+a.side1XCoord+c+a.side1YCoord+f+a.side0Name+f+a.side0XCoord+c+a.side0YCoord+'\');" border=0 src="http://cdn1.iconfinder.com/data/icons/woothemesiconset/16/search_button.png">';b+="&nbsp;</td>            <td "+style+d+unsafeWindow.formatDateByUnixTime(a.reportUnixTime)+g+style+d+a.side1Name+g+style+d+a.side1AllianceName.replace(n,"-")+g+style+o+a.side1XCoord+c+a.side1YCoord+p+a.side1XCoord+c+a.side1YCoord+q;if(a.marchType==3)b+=i+style+'><FONT color="FF9933">'+a.marchName+j;else if(a.marchType==4)b+=i+style+'><FONT color="FF0033">'+a.marchName+j;else b+=i+style+'><FONT color="339933">'+a.marchName+j;if(a.side0Name!=undefined)b+=e+style+d+a.side0Name+k;else b+=e+style+">-</td>";b+=e+style+d+a.side0AllianceName.replace(n,"-")+g+style+o+a.side0XCoord+c+a.side0YCoord+p+a.side0XCoord+c+a.side0YCoord+q;if(a.side0TileType<51&&a.side0TileLevel!=undefined)b+=e+style+d+translate("Wildniss")+" "+a.side0TileLevel+k;else if(a.side0TileType=51&&a.side0CityId==0&&a.side0PlayerId==0)b+=e+style+">CB</td>";else b+=e+style+">- "+translate("Satdt")+k;b+="</tr>"}}b+="</tbody></table></center>";s.innerHTML=b},handleHudSearchCB:function(b,d){var f="unaligned",c=my.Hud;if(b){if(!b.ok){document.getElementById("idSpanHudErrorMsg").innerHTML=translate(b.errorMsg);return}c.totalPages=parseInt(b.totalPages);if(c.totalPages<c.maxPages)c.maxPages=c.totalPages;if(b.arReports&&d)for(var i=b.arReports,h=unsafeWindow.Object.keys(i),g=getMyAlliance()[0],e=0;e<h.length;e++){var a=i[h[e]];a.page=d;var j=b.arPlayerNames["p"+a.side0PlayerId];a.side0Name=j;a.side1Name=b.arPlayerNames["p"+a.side1PlayerId];if(a.side0AllianceId>0)a.side0AllianceName=b.arAllianceNames["a"+a.side0AllianceId];else a.side0AllianceName=f;if(a.side1AllianceId>0)a.side1AllianceName=b.arAllianceNames["a"+a.side1AllianceId];else a.side1AllianceName=f;if(a.side0CityId>0)a.side0CityName=b.arCityNames["c"+a.side0CityId];else a.side0CityName=translate("keiner");if(a.side1CityId>0)a.side1CityName=b.arCityNames["c"+a.side1CityId];else a.side1CityName=translate("keiner");if(a.marchType==1)a.marchName=translate("Transport");else if(a.marchType==3)a.marchName=translate("Spaehen");else if(a.marchType==2)a.marchName=translate("Verstaerkung");else if(a.marchType==4)a.marchName=translate("Angriff");else a.marchName=translate("unbekannt");a.targetDiplomacy=getDiplomacy(a.side0AllianceId);if(g!=a.side1AllianceId)a.TypeName="Ent";if(g==a.side1AllianceId)a.TypeName="Sor";if(a.marchType==2)a.TypeName="Ren";c.data.push(a)}if(parseInt(d)+1<=c.maxPages){var k=document.getElementById("hudResultsDiv");k.innerHTML=translate("Suche")+" "+(parseInt(d)+1)+" "+translate("aus")+" "+c.maxPages;c.getAllianceReports(parseInt(d)+1)}else d&&c.DisplayReports()}},handleHudSearch:function(){var a=my.Hud,b=document.getElementById("hudResultsDiv");b.innerHTML="..."+translate("Suche")+" "+a.minPages+" "+translate("aus")+" "+a.maxPages;a.data=[];a.getAllianceReports(a.minPages)},getAllianceReports:function(a){var c=my.Hud,b={};b.pageNo=a;b.group="a";unsafeWindow.AjaxCall.gPostRequest("listReports.php",b,function(b){c.handleHudSearchCB(b,a)},function(b){c.handleHudSearchCB(b,a)})},hide:function(){}};my.Wilds={tabOrder:35,cont:null,state:null,upGoldTimer:null,wildList:[],buildList:{},init:function(){var a=my.Wilds;a.cont=document.createElement("div");unsafeWindow.BOTerres=a.show;return a.cont},getContent:function(){var a=my.Wilds;return a.cont},hide:function(){var a=my.Wilds},show:function(){var d="</td><TD align=left>",b=my.Wilds;clearTimeout(b.displayTimer);if(b.state==null){b.cont.innerHTML='<DIV id=wildContent style="height:580px; max-height:580px; overflow-y:auto">';b.state=1}m="<DIV class=ptstat>"+unsafeWindow.arStrings.Common.Wilds+"</div>";m+="<TABLE cellspacing=0 cellpadding=0 class=ptTabPad align=center>";for(var c=0;c<Cities.numCities;c++){var a=Cities.cities[c],e=0;m+="<TR><TD colspan=20><DIV class=ptstat>"+a.c.name+' &nbsp; <a href="javascript:void(0)" onclick="KB.Controllers.MapHelper.gotoCoord('+a.c.x+","+a.c.y+');">('+a.c.x+","+a.c.y+")</a></div></td></tr>";if(a.c.wildernessCount()!==0){m+='<TR style="background-color:#000000; font-weight:bold;" align=right><TD align=left>'+unsafeWindow.arStrings.Common.Abandon+d+translate("Typ")+"</td><td align=left>"+unsafeWindow.arStrings.Common.Level+d+unsafeWindow.arStrings.Common.Coordinates+"</td></tr>";a.c.wilderness().each(function(a){m+="<TR align=right"+(e++%2?"":" class=ptOddrow")+"><TD align=left>\t     <a onclick=\"this.style.display='none';setTimeout (function (){Castle.abandonWild("+a.id+');setTimeout(function() { BOTerres() },1000); },500);return false;"><img src="http://cdn1.iconfinder.com/data/icons/musthave/16/Remove.png" border=0></a></td><td align=left>'+a.name+"</td>             <TD>"+a.level+'</td><TD align=center><a href="javascript:void(0)" onclick="KB.Controllers.MapHelper.gotoCoord('+a.x+","+a.y+');">('+a.x+","+a.y+")</a></td></tr>"})}}document.getElementById("wildContent").innerHTML=m+"</table></div>";b.displayTimer=setTimeout(b.show,2e4)}};var FoodAlerts={init:function(){var a=FoodAlerts;a.e_eachMinute()},minuteTimer:null,e_eachMinute:function(){var b=",",a=" ",f=FoodAlerts,h=unixTime();row=[];if(Options.enableFoodWarnTchat){for(i=0;i<Cities.numCities;i++){var g=parseInt(Cities.cities[i].c.resources[1].count),e=parseInt(Cities.cities[i].c.resources[1].hourlyTotalRate())-parseInt(Cities.cities[i].c.upkeep()),c=parseInt(Cities.cities[i].c.resources[1].count)/(0-e)*3600,d="";if(c>=0)if(c<Options.foodWarnHours*3600){d+=Options.MessCibo+" -- "+translate("Meine")+a+translate8("Stadt")+a+Cities.cities[i].c.name.substring(0,10)+" ("+Cities.cities[i].c.x+b+Cities.cities[i].c.y+") ";d+=a+translate("brauchen")+a+translate("Nahrung")+"! "+translate("Aktueller Bestand")+" : "+addCommasWhole(g).replace(b,a).replace(b,a).replace(b,a).replace(b,a)+" ("+timestrShort(c)+") "+translate("Produktion")+" : "+addCommas(e).replace(b,a).replace(b,a).replace(b,a).replace(b,a)+"/h";sendChat("/a "+d)}}f.minuteTimer=setTimeout(f.e_eachMinute,18e5)}}};function sendChat(b){var a="mod_comm_input";if(Options.foodspam)document.getElementById(a).value=b;else document.getElementById(a).value="";unsafeWindow.Chat.sendChat()}my.Reassign={cont:null,displayTimer:null,state:null,curTabBut:null,curTabName:null,sourceCity:{},destinationCity:{},rows:[],init:function(){var a=my.Reassign;a.cont=document.createElement("div");a.state=null;return a.cont},getContent:function(){var a=my.Reassign;return a.cont},hide:function(){var a=my.Reassign;a.state=null;clearTimeout(a.displayTimer)},show:function(){var e=" align=right>",b=my.Reassign,i={},h=0,j=0;clearTimeout(b.displayTimer);if(b.state==null){a="<DIV class=ptstat>"+unsafeWindow.arStrings.Common.Reassign+" "+translate("Truppen von einer Stadt zur anderen")+"</div>";a+='<div id="statpourREA"></div>';a+="<TABLE width='450px' class=ptTab border=0 align=left cellpadding=2>            <tr align=center valign=middle><td colspan=1 width=100><b><u>";a+=translate("Quelle");a+="</b></u><br><span id=REAsrcRptspeedcity></span></td>            <td colspan=1 width='100px'><input type=button style='font-weight:bold' id=REAaction value='";a+=translate("neu zuweisen");a+="'></td><td colspan=1 width='100px'><b><u>";a+=translate("Ziel");a+="</b></u><br><span id=REAdesRptspeedcity></span></td>            <td width=150 colspan=1>&nbsp;</td></tr>            <tr align=center valign=top><td width=100><div id=REAstatsource></div></td>            <td ><table cellspacing=0 cellpadding=0 width=99%>";for(r=1;r<32;r++)if(unsafeWindow.arStrings.unitName["u"+r]){if(h++%2)style="";else style=' style = "background: #797979"';a+="<tr "+style+'><td  align=right>&nbsp;</td><td align=left><input style="border:1px solid black;height:16px;font-size:11px;" id="REAnbunit'+r+'" type=text size=7 value="0"></td></tr>'}a+="</table></td><td><div id=REAstatdest></div></td>";a+="<td colspan=2><table cellspacing=0 cellpadding=0 width=80%><tr><td>&nbsp;</table>";a+="</tr><tr><td colspan=4><div id='ptREAStatus' style='text-align:center;overflow-y:auto; max-height:30px; height: 30px;'></div></td></tr></table>";b.cont.innerHTML=a;b.statpourREA=document.getElementById("statpourREA");b.statutREA=document.getElementById("ptREAStatus");b.actionREA=document.getElementById("REAaction");b.actionREA.addEventListener("click",b.clickReassigneDo,false);var l=new CdispCityPicker("ptREA1",document.getElementById("REAdesRptspeedcity"),false,b.clickREACityDestinationSelect,1),k=new CdispCityPicker("ptREA0",document.getElementById("REAsrcRptspeedcity"),false,b.clickREACitySourceSelect,Cities.byID[unsafeWindow.currentcityid].idx);b.state=1}var d="<TABLE class=ptTabLined cellspacing=0><TR valign=top align=right><TD width=120></td><TD width=88 style='background: #9F9F9F'><B>TOTAL</b></td>";for(c=0;c<Cities.numCities;c++){Gate=Cities.cities[c].c.defending;if(Gate==0)var g="#9F9F9F";if(Gate!=0)var g="#EE7777";d+="<TD width=81 style='background-color:"+g+"' align=center><B>"+Cities.cities[c].c.name+'</b><BR><a onclick="KB.Controllers.MapHelper.gotoCoord('+Cities.cities[c].c.x+","+Cities.cities[c].c.y+');">('+Cities.cities[c].c.x+","+Cities.cities[c].c.y+")</A></td>"}d+="</tr>";d+="<tr><td><br></td></tr>";for(r=1;r<32;r++){var f=0,a="";if(unsafeWindow.arStrings.unitName["u"+r]){style=" style = 'background: #797979'";for(var c=0;c<Cities.numCities;c++){a+="<TD width=81 "+style+e+addCommas(Cities.cities[c].c.troops[r].count())+"</td>";f+=parseInt(Cities.cities[c].c.troops[r].count())}d+="<tr><td "+style+" align=right><b>"+unsafeWindow.arStrings.unitName["u"+r]+"</td><td "+style+e+addCommas(f)+" "+a+"</tr>"}}b.statpourREA.innerHTML=d;b.displayTimer=setTimeout(b.show,1e4)},clickREACitySourceSelect:function(f){var d="REApdestunit",a="REAnbunit",c=my.Reassign,e=0;c.sourceCity=f;for(r=1;r<32;r++)if(ById(a+r))ById(a+r).value="0";c.actionREA.disabled=false;var b="";b="<table cellspacing=0 cellpadding=0 width=80%>";for(r=1;r<32;r++)if(unsafeWindow.arStrings.unitName["u"+r]){if(e++%2)style="";else style="background: #797979;";b+='<tr style="'+style+'"><td align=right><b>'+unsafeWindow.arStrings.unitName["u"+r]+'</b></td>            <td align=left><input style="border:1px solid black;height:16px;font-size:11px;" id="REAdestunit'+r+'" type=text size=7 readonly value="'+parseInt(Cities.cities[c.sourceCity.idx].c.troops[r].count())+'">&nbsp;            <input type=button value=">" id="REApdestunit'+r+'"  style="border:1px solid black;height:16px;font-size:11px;"></td></tr>'}b+="</table>";ById("REAstatsource").innerHTML=b;for(r=1;r<32;r++)unsafeWindow.arStrings.unitName["u"+r]&&ById(d+r).addEventListener("click",function(){var e=this.id.replace("REApdest","REAdest"),b=this.id.replace(d,a);ById(b).value=0;var g=2e5,c=0;for(r=1;r<32;r++)if(ById(a+r))c+=parseInt(ById(a+r).value);var f=parseInt(g-c);if(ById(e).value>=f)ById(b).value=f;else ById(b).value=ById(e).value},false)},clickREACityDestinationSelect:function(d){var b=my.Reassign,c=0;b.destinationCity=d;var a="";a="<table cellspacing=0 cellpadding=0 width=80%>";for(r=1;r<32;r++)if(unsafeWindow.arStrings.unitName["u"+r]){if(c++%2)style="";else style="background: #797979;";a+='<tr style="'+style+'"><td align=right>&nbsp;</td><td align=left><input style="border:1px solid black;height:16px;font-size:11px;" type=text size=7 readonly value="'+parseInt(Cities.cities[b.destinationCity.idx].c.troops[r].count())+'"></td></tr>'}a+="</table>";ById("REAstatdest").innerHTML=a},clickReassigneDo:function(){var b="REAnbunit",a=my.Reassign,c=0,e=a.sourceCity.c.id,h=a.destinationCity.c.id;unsafeWindow.KB.AudioManager.playSound("on_click");unsafeWindow.Chrome.City.switchTo(e);for(r=1;r<32;r++)if(document.getElementById(b+r)){if(parseInt(document.getElementById(b+r).value)>parseInt(document.getElementById("REAdestunit"+r).value)){document.getElementById(b+r).style.backgroundColor="red";return false}c=c+parseInt(document.getElementById(b+r).value);document.getElementById(b+r).style.backgroundColor=""}if(a.sourceCity.c.id==a.destinationCity.c.id){a.statutREA.innerHTML="<FONT COLOR=#550000>Can not reassign to same city !.</font>";return}if(c==0){a.statutREA.innerHTML="<FONT COLOR=#550000>Can not reassign unit with 0... pfff !.</font>";return}var d=2e5;if(c>d){a.statutREA.innerHTML="<FONT COLOR=#550000>Can not reassign more "+d+" unit&eacute;es a la fois.</font>";return}a.actionREA.disabled=true;var f=a.destinationCity.c.x,g=a.destinationCity.c.y;a.statutREA.innerHTML="<i><b>Processing....</b></i>";setTimeout(function(){unsafeWindow.Modal.hideModalAll();unsafeWindow.March.open(5,f,g);setTimeout(function(){var c="modal_attack_unit_ipt_";for(r=1;r<32;r++)if(document.getElementById(b+r)&&document.getElementById(b+r).value>0){if(document.getElementById(c+r)!==null)document.getElementById(c+r).value=parseInt(document.getElementById(b+r).value);unsafeWindow.March.TroopList.save(r,document.getElementById(c+r));unsafeWindow.March.checkTroopInput(document.getElementById(c+r),r,true)}unsafeWindow.March.check(5);a.statutREA.innerHTML="<font color=red size='3px'><b>Done<b></font>";a.actionREA.disabled=false},1e3)},200)}};function getCityBuilding(f,e){var b="pos";for(var d=Seed.buildings["city"+f],c={count:0,maxLevel:0},a=1;a<33;a++)if(d[b+a]&&d[b+a][0]==e){++c.count;if(parseInt(d[b+a][1])>c.maxLevel)c.maxLevel=parseInt(d[b+a][1])}return c}my.TranspAuto={cont:null,displayTimer:null,state:null,curTabBut:null,curTabName:null,sourceCity:{},destinationCity:{},rows:[],init:function(){var a=my.TranspAuto;a.cont=document.createElement("div");a.state=null;clearTimeout(a.displayTimer);return a.cont},getContent:function(){var a=my.TranspAuto;return a.cont},hide:function(){var a=my.TranspAuto;a.state=null;clearTimeout(a.displayTimer)},show:function(){var u="<TD align=right width=81 style='background:#797979;color:",t="</td><td style='background: #797979' align=right>",s="<tr><td style='background: #797979' align=right><b>",q="</td><td ",p=" align=right><b>",o="<tr><td ",i=" align=right>",n="<TD width=81 ",r=" style = 'background: #797979'",h="</td>",e="",k="<tr><td><br></td></tr>",g="</tr>",f="click",d=false,c=my.TranspAuto,B=0,A={};if(c.state==null){b="<DIV class=ptstat>";b+=translate("Transport von Waren von einer Stadt zur anderen");b+="</div><div id='statpourTr'></div>";b+="<TABLE width=100% class=ptTab border=0 cellpadding=3>       <tr align=center><td colspan=2><HR></td></tr>       <tr align=center valign=top><td colspan=1 width=50%><b><u>";b+=translate("Quelle");b+="</b></u><br><span id=srcptspeedcity></span></td>       <td colspan=1 width=50%  rowspan=2><b><u>";b+=translate("Ziel");b+="</b></u><br><span id=desptspeedcity></span><br>";b+=translate("Jetzt die Koordinaten");b+=" <br>X: <input type=text size=4 id=typetrpx value=0>&nbsp;Y: <input type=text size=4 id=typetrpy value=0><br><br><INPUT id='ptttButTransport' type=submit value='";b+=translate("Transport");b+="' style='font-weight:bold'></td></tr><tr align=center><td colspan=1>";b+=translate("Truppen");b+=" : <select id=typetrp><option value='1'>"+unsafeWindow.arStrings.unitName.u1+"</option><option value='2'>"+unsafeWindow.arStrings.unitName.u2+"</option><option value='4'>"+unsafeWindow.arStrings.unitName.u4+"</option><option value='5'>"+unsafeWindow.arStrings.unitName.u5+"</option><option value='6'>"+unsafeWindow.arStrings.unitName.u6+"</option><option value='7'>"+unsafeWindow.arStrings.unitName.u7+"</option><option value='8'>"+unsafeWindow.arStrings.unitName.u8+"</option><option selected value='9'>"+unsafeWindow.arStrings.unitName.u9+"</option><option value='10'>"+unsafeWindow.arStrings.unitName.u10+"</option><option value='11'>"+unsafeWindow.arStrings.unitName.u11+"</option><option value='12'>"+unsafeWindow.arStrings.unitName.u12+"</option></select><br>";b+=translate("Menge");b+=" : <input type=text size=6 value='100' id='Choixnbwagon'><input type=button id='trswagmax' value='Max'><br><i>(";b+=translate("Die Menge der Ressourcen ist abhaengig, wie viele Einheiten ausgewaehlt wurden");b+=")</i>       <br><b>";b+=translate("welche Ressourcen");b+=":</b><br><input type=radio id='ChoixRess0' name='ChoixRess' value='gold'> "+unsafeWindow.arStrings.ResourceName[0]+"       <input type=radio id='ChoixRess1' name='ChoixRess' value='rec1'> "+unsafeWindow.arStrings.ResourceName[1]+"       <input type=radio id='ChoixRess2' name='ChoixRess' value='rec2'> "+unsafeWindow.arStrings.ResourceName[2]+"       <input type=radio id='ChoixRess3' name='ChoixRess' value='rec3'> "+unsafeWindow.arStrings.ResourceName[3]+"       <input type=radio id='ChoixRess4' name='ChoixRess' value='rec4'> "+unsafeWindow.arStrings.ResourceName[4]+"       </td></tr>       <tr><td colspan=2>"+unsafeWindow.arStrings.March.ResourcesToSend+" : <span id=BOEstimationR></td></tr>       </table>       <TABLE align=center width=100% class=ptTab><TR><TD><div id=ptTranportStatus style='text-align:center;overflow-y:auto; max-height:78px; height: 78px;'></div></td></tr></table>";c.cont.innerHTML=b;c.destinationCityx=document.getElementById("typetrpx");c.destinationCityy=document.getElementById("typetrpy");c.destinationCityx.addEventListener("change",c.estimerRes,d);c.destinationCityy.addEventListener("change",c.estimerRes,d);document.getElementById("ChoixRess0").addEventListener(f,c.estimerRes,d);document.getElementById("ChoixRess1").addEventListener(f,c.estimerRes,d);document.getElementById("ChoixRess2").addEventListener(f,c.estimerRes,d);document.getElementById("ChoixRess3").addEventListener(f,c.estimerRes,d);document.getElementById("ChoixRess4").addEventListener(f,c.estimerRes,d);c.estimationRes=document.getElementById("BOEstimationR");var D=new CdispCityPicker("ptspeed1",document.getElementById("desptspeedcity"),d,c.clickCityDestinationSelect,1);c.TTbutTransport=document.getElementById("ptttButTransport");c.TTbutTransport.addEventListener(f,c.clickTransportDo,d);c.divTranportStatus=document.getElementById("ptTranportStatus");c.statpourTr=document.getElementById("statpourTr");c.typetrp=document.getElementById("typetrp");c.typetrp.addEventListener(f,c.estimerRes,d);c.trswagmax=document.getElementById("trswagmax");c.trswagmax.addEventListener(f,c.clickUniteMax,d);c.Choixnbwagon=document.getElementById("Choixnbwagon");c.Choixnbwagon.addEventListener("keyup",c.verifierWagons,d);var C=new CdispCityPicker("ptspeed0",document.getElementById("srcptspeedcity"),d,c.clickCitySourceSelect,Cities.byID[unsafeWindow.currentcityid].idx);c.state=1}str="<TABLE class=ptTabLined cellspacing=0><TR valign=top align=right><TD width=65></td><TD width=88 style='background: #9F9F9F'><B>TOTAL</b></td>";for(a=0;a<Cities.numCities;a++){Gate=Cities.cities[a].c.defending;if(Gate==0)var z="#9F9F9F";if(Gate!=0)var z="#EE7777";str+="<TD width=81 style='background-color:"+z+"' align=center><B>"+Cities.cities[a].c.name+'</b><BR><a onclick="KB.Controllers.MapHelper.gotoCoord('+Cities.cities[a].c.x+","+Cities.cities[a].c.y+');">('+Cities.cities[a].c.x+","+Cities.cities[a].c.y+")</td>"}str+=g;str+=k;var b=e,v=0;for(a=0;a<Cities.numCities;a++){b+="<TD width=81 style='background:#797979' align=right>"+addCommas(Cities.cities[a].c.silver())+h;v+=parseInt(Cities.cities[a].c.silver())}str+="<tr align=right><td style='background:#797979' align=right><b>"+unsafeWindow.arStrings.ResourceName[0]+"</td><td style='background:#797979' align=right>"+addCommas(v)+" "+b+g;for(var j=1;j<=4;j++){if(j%2)style=e;else style=r;for(var b=e,y=0,a=0;a<Cities.numCities;a++){b+=n+style+i+addCommas(Cities.cities[a].c.resources[j].count)+h;y+=parseInt(Cities.cities[a].c.resources[j].count)}str+=o+style+p+unsafeWindow.arStrings.ResourceName[j]+q+style+i+addCommas(y)+" "+b+g}str+=k;var b=e,w=0;for(a=0;a<Cities.numCities;a++){b+="<TD align=right width=81 style='background:#797979'>"+addCommas(Cities.cities[a].c.resources[1].hourlyTotalRate())+"/"+unsafeWindow.arStrings.TimeStr.timeHr+h;w+=parseInt(Cities.cities[a].c.resources[1].hourlyTotalRate())}str+=s+unsafeWindow.arStrings.Common.Production+t+addCommas(w)+"/"+unsafeWindow.arStrings.TimeStr.timeHr+e+b+g;var b=e,x=0;for(a=0;a<Cities.numCities;a++){color="black";b+=u+color+";'>"+addCommas(Cities.cities[a].c.upkeep())+"/"+unsafeWindow.arStrings.TimeStr.timeHr+h;x+=parseInt(Cities.cities[a].c.upkeep())}str+=s+unsafeWindow.arStrings.Common.UpKeep+t+addCommas(x)+"/"+unsafeWindow.arStrings.TimeStr.timeHr+e+b+g;var b=e,x=0;for(a=0;a<Cities.numCities;a++){color="black";if(parseInt(Cities.cities[a].c.resources[1].hourlyTotalRate())<parseInt(Cities.cities[a].c.upkeep())){difference=parseInt(Cities.cities[a].c.resources[1].hourlyTotalRate())-parseInt(Cities.cities[a].c.upkeep());var m=parseInt(Cities.cities[a].c.resources[1].count)/(0-difference)*3600;if(m>86313600)autonomi="----";else if(m<Options.foodWarnHours*3600)autonomi="<SPAN class=whiteOnRed><b>"+timestrShort(m)+"</b></span>";else autonomi=e+timestrShort(m)+e;b+=u+color+";'>"+autonomi+h}else b+="<TD align=right width=81 style='background:#797979;color:black;'>---</td>"}str+='<tr><td style="background: #797979" align=right><b>'+translate("Ausreichend fuer Autonomiezeit")+'</td><td style="background: #797979" align=right>&nbsp;'+b+g;var b=e,l=0;str+=k;if(unsafeWindow.arStrings.unitName.u1){style=r;for(var a=0;a<Cities.numCities;a++){b+=n+style+i+addCommas(Cities.cities[a].c.troops[1].count())+h;l+=parseInt(Cities.cities[a].c.troops[1].count())}str+=o+style+p+unsafeWindow.arStrings.unitName.u1+q+style+i+addCommas(l)+" "+b+g}var b=e,l=0;if(unsafeWindow.arStrings.unitName.u9){style=e;for(var a=0;a<Cities.numCities;a++){b+=n+style+i+addCommas(Cities.cities[a].c.troops[9].count())+h;l+=parseInt(Cities.cities[a].c.troops[9].count())}str+=o+style+p+unsafeWindow.arStrings.unitName.u9+q+style+i+addCommas(l)+" "+b+g}str+=k;c.statpourTr.innerHTML=str;c.displayTimer=setTimeout(c.show,2500)},verifierWagons:function(){var a=my.TranspAuto,b=parseInt(Cities.cities[a.sourceCity.idx].c.troops[a.typetrp.value].count()),c=parseInt(a.Choixnbwagon.value);if(c>b){a.Choixnbwagon.value=b;a.divTranportStatus.innerHTML="<FONT COLOR=#550000>La quantit&eacute; ne peut exc&eacute;der "+b+" !.</font>"}a.estimerRes()},estimerRes:function(){var a=my.TranspAuto,f=parseInt(unsafeWindow.Unit.stats[a.typetrp.value].load*a.Choixnbwagon.value*(1+unsafeWindow.player.technologies[10].bonus()));a.estimationRes.innerHTML="<font size=3><b>"+addCommas(f)+"</b></font>";var i=a.sourceCity.c.id,e=0,b=0,d="gold",c="d'argent";b=Cities.cities[a.sourceCity.idx].c.silver();if(document.getElementById("ChoixRess1").checked){d="rec1";e=1;c="de nourriture";b=parseInt(Cities.cities[a.sourceCity.idx].c.resources[1].count)}if(document.getElementById("ChoixRess2").checked){d="rec2";e=2;c="de bois";b=parseInt(Cities.cities[a.sourceCity.idx].c.resources[2].count)}if(document.getElementById("ChoixRess3").checked){d="rec3";e=3;c="de pierre";b=parseInt(Cities.cities[a.sourceCity.idx].c.resources[3].count)}if(document.getElementById("ChoixRess4").checked){d="rec4";e=4;c="de fer";b=parseInt(Cities.cities[a.sourceCity.idx].c.resources[4].count)}if(b<f){var g=parseInt(unsafeWindow.Unit.stats[a.typetrp.value].load*1*(1+unsafeWindow.player.technologies[10].bonus())),h=Math.round(b/g)-1;a.Choixnbwagon.value=h;a.TTbutTransport.disabled=false;a.estimerRes()}},clickUniteMax:function(){var a=my.TranspAuto,b=parseInt(Cities.cities[a.sourceCity.idx].c.troops[a.typetrp.value].count());a.Choixnbwagon.value=b;a.estimerRes()},clickTransportDo:function(){var k="ChoixRess4",j="ChoixRess3",i="ChoixRess2",h="ChoixRess1",g="ChoixRess0",a=my.TranspAuto,l=a.sourceCity.c.id,m=a.destinationCity.c.id;unsafeWindow.KB.AudioManager.playSound("on_click");unsafeWindow.Chrome.City.switchTo(l);if(!document.getElementById(g).checked&&!document.getElementById(h).checked&&!document.getElementById(i).checked&&!document.getElementById(j).checked&&!document.getElementById(k).checked){a.divTranportStatus.innerHTML="<FONT COLOR=#550000>Thankyou, please select a resource type !</font>";return}if(a.sourceCity.c.x==a.destinationCityx.value&&a.sourceCity.c.y==a.destinationCityy.value){a.divTranportStatus.innerHTML="<FONT COLOR=#550000>Impossible, can not be delivered in the same city where the starting point is !</font>";return}if(parseInt(a.Choixnbwagon.value)=="0"){a.divTranportStatus.innerHTML="<FONT COLOR=#550000>Impossibe to transport to 0 !</font>";return}var e=a.destinationCityx.value,f=a.destinationCityy.value;if(e==0||f==0){a.divTranportStatus.innerHTML="<FONT COLOR=#550000>Caution you have selected coordinates 0,0 to transport too !</font>";return}a.TTbutTransport.disabled=true;var b={};b.kid=0;b.cid=a.sourceCity.c.id;b.type="1";b.xcoord=e;b.ycoord=f;b.r1=0;b.r2=0;b.r3=0;b.r4=0;b.gold=0;var c=0,d=parseInt(unsafeWindow.Unit.stats[a.typetrp.value].load*a.Choixnbwagon.value*(1+unsafeWindow.player.technologies[10].bonus()));if(document.getElementById(g).checked){c=0;b.gold=d}if(document.getElementById(h).checked){c=1;b.r1=d}if(document.getElementById(i).checked){c=2;b.r2=d}if(document.getElementById(j).checked){c=3;b.r3=d}if(document.getElementById(k).checked){c=4;b.r4=d}a.divTranportStatus.innerHTML="<i><b>Processing....</b></i>";setTimeout(function(){unsafeWindow.Modal.hideModalAll();unsafeWindow.March.open(1,e,f);setTimeout(function(){var e="modal_attack_resource_",b="modal_attack_unit_ipt_";document.getElementById(b+a.typetrp.value).value=a.Choixnbwagon.value;unsafeWindow.March.TroopList.save(a.typetrp.value,document.getElementById(b+a.typetrp.value));unsafeWindow.March.checkTroopInput(document.getElementById(b+a.typetrp.value),a.typetrp.value,true);document.getElementById(e+c).value=d;unsafeWindow.March.checkResourceInput(document.getElementById(e+c));unsafeWindow.March.updateSummary();unsafeWindow.March.check(1);a.divTranportStatus.innerHTML='<font color=red size="3px"><b>'+translate("erledigt")+"<b></font>";a.TTbutTransport.disabled=false},1e3)},200)},clickCitySourceSelect:function(b){var a=my.TranspAuto;a.sourceCity=b;a.TTbutTransport.disabled=false;a.estimerRes()},clickCityDestinationSelect:function(b){var a=my.TranspAuto;a.destinationCity=b;a.destinationCityx.value=a.destinationCity.c.x;a.destinationCityy.value=a.destinationCity.c.y;a.TTbutTransport.disabled=false;a.estimerRes()}};my.KDO={cont:null,state:null,displayTimerKDO:null,init:function(){var a=my.KDO;this.cont=document.createElement("div");return a.cont},getContent:function(){var a=my.KDO;return a.cont},hide:function(){var a=my.KDO},nbitem:function(b){var a=0;if(unsafeWindow.items[b].count>0)a=unsafeWindow.items[b].count;else a=0;return a},show:function(){var p="BOIdFB",u="BOFIdFB",t="Options_??",s="change",A="BOAcceptKDO",z="BONbItem1005",y="BONbItem1015",x="BONbItem1025",w="BONbItem1045",v="BONbItem1035",o="resourceCrate.php",b=false,r="requests",i="click",q="BOAcceptAllKDO",h=1045,g=1035,f=1025,e=1015,d=1005,n="erworben",l='</span></button><div class="itemowned">',k="annehmen",j="Senden",a=my.KDO;if(a.state==null){m='<div id="presentModalWrapper1" class="presentWrapper"><div class=header style="height:330px"><h1>'+translate("Senden Sie ein kostenloses Geschenk an Ihre Freunde!")+'</h1><ul id="presentList1" class="clearfix"><li class="unlocked"><div class="frame"><div class="item pic px70 items item_1005"></div></div><button class="button25" onclick="KB.Views.Gift.popupInvite(1005);"><span>'+translate(j)+'</span></button><button id="BOItem1005" class="button25" type="button"><span>'+translate(k)+l+translate(n)+': <span class="modal_itemowned_923" id="BONbItem1005">'+a.nbitem(d)+'</span></div></li><li class="unlocked"><div class="frame"><div class="item pic px70 items item_1015"></div></div><button class="button25" onclick="KB.Views.Gift.popupInvite(1015);"><span>'+translate(j)+'</span></button><button id="BOItem1015"  class="button25" type="button"><span>'+translate(k)+l+translate(n)+': <span class="modal_itemowned_923" id="BONbItem1015">'+a.nbitem(e)+'</span></div></li><li class="unlocked"><div class="frame"><div class="item pic px70 items item_1025"></div></div><button class="button25" onclick="KB.Views.Gift.popupInvite(1025);"><span>'+translate(j)+'</span></button><button id="BOItem1025"  class="button25" type="button"><span>'+translate(k)+l+translate(n)+': <span class="modal_itemowned_923" id="BONbItem1025">'+a.nbitem(f)+'</span></div></li><li class="unlocked"><div class="frame"><div class="item pic px70 items item_1035"></div></div><button class="button25" onclick="KB.Views.Gift.popupInvite(1035);"><span>'+translate(j)+'</span></button><button id="BOItem1035"  class="button25" type="button"><span>'+translate(k)+l+translate(n)+': <span class="modal_itemowned_923" id="BONbItem1035">'+a.nbitem(g)+'</span></div></li><li class="unlocked"><div class="frame"><div class="item pic px70 items item_1045"></div></div><button class="button25" onclick="KB.Views.Gift.popupInvite(1045);"><span>'+translate(j)+'</span></button><button id="BOItem1045"  class="button25" type="button"><span>'+translate(k)+l+translate(n)+': <span class="modal_itemowned_923" id="BONbItem1045">'+a.nbitem(h)+"</span></div></li></ul></div><br><br><h1>"+translate("Geschenke warten auf Annahme")+'</h1><br><input type=button id="BOAcceptAllKDO" value="'+translate("Akzeptieren Sie alle GESCHENKE")+'"></div>';a.cont.innerHTML=m;document.getElementById(q).addEventListener(i,function(){document.getElementById(q).disabled=true;unsafeWindow.AjaxCall.gNetworkPostRequest(r,"getRequest.php",{typeRequest:1},function(c){if(c.ok){var d=unsafeWindow.Object.keys(c.data.requests);unsafeWindow.KB.Views.Cohort.pending=c.data.requests;for(var a=0;a<d.length;a++){var f=c.data.requests[d[a]][1],e=d[a],g={request_id:e,type_request:1,item_id:f,sender_fbuid:c.data.requests[d[a]][0]};unsafeWindow.AjaxCall.gNetworkPostRequest(r,"acceptRequest.php",g,function(a){if(a.ok){unsafeWindow.items[f].add(1);delete unsafeWindow.KB.Views.Gift.request[e]}},function(){},true)}}document.getElementById(q).disabled=b})},b);document.getElementById("BOItem1035").addEventListener(i,function(){if(a.nbitem(g)>0){var b={iid:g,cid:unsafeWindow.currentCity.id};unsafeWindow.AjaxCall.gPostRequest(o,b,function(b){if(b.ok){unsafeWindow.KB.Models.Resource.addToSeed(b.rtype,b.amt);unsafeWindow.items[g].subtract();document.getElementById(v).innerHTML=a.nbitem(g)}},function(){})}},b);document.getElementById("BOItem1045").addEventListener(i,function(){if(a.nbitem(h)>0){var b={iid:h,cid:unsafeWindow.currentCity.id};unsafeWindow.AjaxCall.gPostRequest(o,b,function(b){if(b.ok){unsafeWindow.KB.Models.Resource.addToSeed(b.rtype,b.amt);unsafeWindow.items[h].subtract();document.getElementById(w).innerHTML=a.nbitem(h)}},function(){})}},b);document.getElementById("BOItem1025").addEventListener(i,function(){if(a.nbitem(f)>0){var b={iid:f,cid:unsafeWindow.currentCity.id};unsafeWindow.AjaxCall.gPostRequest(o,b,function(b){if(b.ok){unsafeWindow.KB.Models.Resource.addToSeed(b.rtype,b.amt);unsafeWindow.items[f].subtract();document.getElementById(x).innerHTML=a.nbitem(f)}},function(){})}},b);document.getElementById("BOItem1015").addEventListener(i,function(){if(a.nbitem(e)>0){var b={iid:e,cid:unsafeWindow.currentCity.id};unsafeWindow.AjaxCall.gPostRequest(o,b,function(b){if(b.ok){unsafeWindow.KB.Models.Resource.addToSeed(b.rtype,b.amt);unsafeWindow.items[e].subtract();document.getElementById(y).innerHTML=a.nbitem(e)}},function(){})}},b);document.getElementById("BOItem1005").addEventListener(i,function(){if(a.nbitem(d)>0){var b={iid:d,cid:unsafeWindow.currentCity.id};unsafeWindow.AjaxCall.gPostRequest(o,b,function(b){if(b.ok){unsafeWindow.KB.Models.Resource.addToSeed(b.rtype,b.amt);unsafeWindow.items[d].subtract();document.getElementById(z).innerHTML=a.nbitem(d)}},function(){})}},b);document.getElementById(A).addEventListener(s,function(){GlobalOptions.autoPublishKDO=document.getElementById(A).checked;GM_setValue(t,JSON2.stringify(GlobalOptions))},b);document.getElementById(u).addEventListener(s,function(){GlobalOptions.autoPublishKDOWho=document.getElementById(u).value;GM_setValue(t,JSON2.stringify(GlobalOptions))},b);document.getElementById(p).addEventListener(s,function(){var a=document.getElementById(p).value;document.getElementById(u).value=document.getElementById(p).value;GlobalOptions.autoPublishKDOWho=a;GM_setValue(t,JSON2.stringify(GlobalOptions))},b);c={};unsafeWindow.AjaxCall.gPostRequest("getNeighbors.php",c,function(b){if(b.ok){for(var d="",c=unsafeWindow.Object.keys(b.data),a=0;a<c.length;a++)if(b.data[c[a]].displayName)d+="<option value='"+b.data[c[a]].fbuid+"'>"+b.data[c[a]].displayName+"</option>";document.getElementById(p).innerHTML="<option value='0'>Selectionner...</option>"+d}});unsafeWindow.AjaxCall.gNetworkPostRequest(r,"getFriendsGift.php",c,function(b){unsafeWindow.KB.Views.Gift.friends=b.data.friends?b.data.friends:{};unsafeWindow.KB.Views.Gift.potentials=b.data.potentials?b.data.potentials:{};unsafeWindow.KB.Views.Gift.cohorts=b.data.cohorts?b.data.cohorts:{};unsafeWindow.KB.Views.Gift.lockGift=b.data.lockedItems?b.data.lockedItems:{};unsafeWindow.KB.Views.Gift.sortLockGift();unsafeWindow.KB.Views.Gift.unlockGift=b.data.newUnlockItems?b.data.newUnlockItems:{};unsafeWindow.KB.Views.Gift.user=b.data.user?b.data.user:0;var c={typeRequest:unsafeWindow.KB.Views.Gift.TYPE_REQUEST_GIFT};a.displayTimerKDO=setInterval(function(){GlobalOptions.BOAutomateKDO&&unsafeWindow.KB.Views.Gift.popupInvite(document.getElementById("BOAutomateKDOChoice").value)},parseInt(GlobalOptions.BOAutomateKDOsec*1e3))});a.state=1}document.getElementById(w).innerHTML=a.nbitem(h);document.getElementById(v).innerHTML=a.nbitem(g);document.getElementById(x).innerHTML=a.nbitem(f);document.getElementById(y).innerHTML=a.nbitem(e);document.getElementById(z).innerHTML=a.nbitem(d);a.displayTimer=setTimeout(a.show,parseInt(GlobalOptions.BOAutomateKDOsec*1e3))},togOpt:function(e,b,a){var f=my.Options,c=document.getElementById(e);if(Options[b])c.checked=true;c.addEventListener("change",d,false);function d(){Options[b]=this.checked;saveOptions();a&&a(this.checked)}},changeOpt:function(e,b,a){var f=my.Options,c=document.getElementById(e);c.value=Options[b];c.addEventListener("change",d,false);function d(){Options[b]=this.value;saveOptions();a&&a(this.value)}}};my.Crests={cont:null,state:null,init:function(){var a=my.Crests;this.cont=document.createElement("div");return a.cont},getContent:function(){var a=my.Crests;return a.cont},hide:function(){var a=my.Crests},show:function(){var d="              <br>",r=" / 2 ",p=';">',o=';"><b><center>',k="City",h="<td>",c="</td>",g="</td><td>",u="<tr><td>",n="#EE9999",f="#99EE99",t=my.Crests,i,j,e,m,l,q,s;if(unsafeWindow.items[1101].count>0)i=unsafeWindow.items[1101].count;else i=0;if(unsafeWindow.items[1102].count>0)j=unsafeWindow.items[1102].count;else j=0;if(unsafeWindow.items[1103].count>0)e=unsafeWindow.items[1103].count;else e=0;if(unsafeWindow.items[1104].count>0)m=unsafeWindow.items[1104].count;else m=0;if(unsafeWindow.items[1105].count>0)l=unsafeWindow.items[1105].count;else l=0;if(unsafeWindow.items[1106].count>0)q=unsafeWindow.items[1106].count;else q=0;if(unsafeWindow.items[1107].count>0)s=unsafeWindow.items[1107].count;else s=0;if(unsafeWindow.items[1108].count>0)Trajan=unsafeWindow.items[1108].count;else Trajan=0;if(unsafeWindow.items[1109].count>0)Hadrien=unsafeWindow.items[1109].count;else Hadrien=0;if(Cities.cities[1])ville2=f;else ville2=n;if(Cities.cities[2])ville3=f;else ville3=n;if(Cities.cities[3])ville4=f;else ville4=n;if(Cities.cities[4])ville5=f;else ville5=n;if(t.state==null){var a="<style>CAPTION.MYTABLE  {background-color:eeffff;color:black;     border-style:solid;     border-width:1px;     border-color:black;  }  TABLE.MYTABLE  {font-family:arial;border-collapse:collapse;font-size:12pt;background-color:F5F5F5;width:100%;border-style:solid;border-color:black;border-width:1px;  }  TH.MYTABLE  {font-size:12pt;color:black;text-align:center;border-style:solid;border-color:black;border-width:1px;  }  TR.MYTABLE  {  }  TD.MYTABLE  {font-size:12pt;background-color:FFFFE5;color:black;border-style:solid;border-width:1px;text-align:left;}</style>";a+="<DIV class=ptstat>"+translate("Uebersicht Truppen")+'</div><TABLE align=center CLASS="MYTABLE" cellpadding=4 cellspacing=0>';a+=u+translate("Name Truppen")+g+translate("Leben")+g+translate("Angriff")+g+translate("Verteidigung")+g+translate("Geschwindigkeit")+g+translate("Reichweite")+g+translate("Laden")+g+translate("Instandhaltung")+"</td></tr>";for(var v={"1":2,"2":3,"3":5,"4":9,"5":35,"6":9,"7":9,"8":35,"9":10,"10":35,"11":50,"12":100,"31":65},b=1;b<=31;b++)if(unsafeWindow.arStrings.unitName["u"+b]){a+=u+unsafeWindow.arStrings.unitName["u"+b]+c;a+=h+unsafeWindow.Unit.stats[b].life+c;a+=h+unsafeWindow.Unit.stats[b].attack+c;a+=h+unsafeWindow.Unit.stats[b].defense+c;a+=h+unsafeWindow.Unit.stats[b].speed+c;a+=h+unsafeWindow.Unit.stats[b].range+c;a+=h+unsafeWindow.Unit.stats[b].load+c;a+=h+v[b]+c;a+="</tr>"}a+='<TABLE CLASS="MYTABLE" CELLPADDING=3 CELLSPACING=0 align=center>    <DIV class=ptstat>'+translate("Siegel fuer neue Staedte erforderlich")+'</div><TABLE class=pbTab width=100% height=0% ><TR align="center">    <THEAD >      <TR CLASS="MYTABLE">        <TH CLASS="MYTABLE">'+translate(k)+'</TH>        <TH CLASS="MYTABLE">'+translate("Bedarf")+'</TH>      </TR>    </THEAD>        <TBODY>      <TR CLASS="MYTABLE">        <TD CLASS="MYTABLE" style="background-color:'+ville2+o+translate(k)+' 2</TD>        <TD CLASS="MYTABLE" style="background-color:'+ville2+p+translate("Level")+" 7 ("+translate("zur Zeit")+" : "+unsafeWindow.player.level+")        <br>5 "+translate("Kohorten")+'</TD>      </TR>      <TR CLASS="MYTABLE">          <TD CLASS="MYTABLE" style="background-color:'+ville3+o+translate(k)+' 3</TD>        <TD CLASS="MYTABLE" style="background-color:'+(i>=10&&j>=5&&e>=2?f:ville3)+p+i+" / 10 "+unsafeWindow.arStrings.itemName.i1101+"<br>"+j+" / 5 "+unsafeWindow.arStrings.itemName.i1102+"<br>"+e+r+unsafeWindow.arStrings.itemName.i1103+'</TD>      </TR>            <TR CLASS="MYTABLE">                <TD CLASS="MYTABLE" style="background-color:'+ville4+o+translate(k)+' 4</TD>              <TD CLASS="MYTABLE" style="background-color:'+(i>=20&&j>=15&&e>=9?f:ville4)+p+i+" / 20 "+unsafeWindow.arStrings.itemName.i1101+d+j+" / 15 "+unsafeWindow.arStrings.itemName.i1102+d+e+" / 9 "+unsafeWindow.arStrings.itemName.i1103+d+m+" / 4 "+unsafeWindow.arStrings.itemName.i1104+d+l+r+unsafeWindow.arStrings.itemName.i1105+'              </TD>        </TR> \t <TR CLASS="MYTABLE">                <TD CLASS="MYTABLE" style="background-color:'+ville5+o+translate(k)+' 5</TD>              <TD CLASS="MYTABLE" style="background-color:'+(e>=20&&m>=15&&l>=9&&q>=4&&domitan>=2?f:ville5)+p+e+" / 20 "+unsafeWindow.arStrings.itemName.i1103+d+m+" / 15 "+unsafeWindow.arStrings.itemName.i1104+d+l+" / 9 "+unsafeWindow.arStrings.itemName.i1105+d+q+" / 4 "+unsafeWindow.arStrings.itemName.i1106+d+s+r+unsafeWindow.arStrings.itemName.i1107+"              </TD>      </TR>    </TBODY>  </TABLE>";t.cont.innerHTML=a;t.state=1}}};var CollectGold={timer:null,lastCollect:{},init:function(){for(var b=CollectGold,a=0;a<Cities.numCities;a++)b.lastCollect["c"+Cities.cities[a].c.id]=0;Options.pbGoldEnable&&b.setEnable(true)},setEnable:function(b){var a=CollectGold;clearTimeout(a.timer);b&&a.tick()},colCityName:null,colHappy:0,tick:function(){for(var a=CollectGold,c=0;c<Cities.numCities;c++){var b=Cities.cities[c],d=unixTime()-a.lastCollect["c"+b.c.id];if(d>900&&b.c.population.happiness()>=Options.pbGoldHappy){a.lastCollect["c"+b.c.id]=unixTime();a.colCityName=b.c.name;a.ajaxCollectGold(b.c,a.e_ajaxDone);break}}a.timer=setTimeout(a.tick,3e4)},e_ajaxDone:function(){var b=CollectGold},ajaxCollectGold:function(c,a){var b={};b.cid=c.id;b.eventid=1;unsafeWindow.AjaxCall.gPostRequest("coliseumEvent.php",b,function(b){a&&a(b)},function(b){a&&a(b)})}},CollectRessource={timer:null,lastCollect:{},init:function(){for(var b=CollectRessource,a=0;a<Cities.numCities;a++)b.lastCollect["c"+Cities.cities[a].c.id]=0;Options.pbRessEnable&&b.setEnable(true)},setEnable:function(b){var a=CollectRessource;clearTimeout(a.timer);b&&a.tick()},colCityName:null,colHappy:0,tick:function(){for(var a=CollectRessource,c=0;c<Cities.numCities;c++){var b=Cities.cities[c],d=unixTime()-a.lastCollect["c"+b.c.id];if(d>Options.pbRessTime*60&&document.getElementById("btn_collect_all").style.display!="none"){a.lastCollect["c"+b.c.id]=unixTime();a.colCityName=b.c.name;a.ajaxCollectRessource(b.c,a.e_ajaxDone);break}}a.timer=setTimeout(a.tick,3e4)},e_ajaxDone:function(){var b=CollectRessource},ajaxCollectRessource:function(c,a){var b={};b.cid=c.id;unsafeWindow.AjaxCall.gPostRequest("collectResource.php",b,function(b){a&&a(b)},function(b){a&&a(b)})}};my.Res={cont:null,timer:null,init:function(){var a=my.Res;a.cont=document.createElement("div");return a.cont},getContent:function(){var a=my.Res;return a.cont},show:function(){var e="change",d=false,i='" ></td></tr>',h="<TD align=left>",g="</table>",b="<tr><td>&nbsp;</tr></td>",f="<DIV class=ptstat>",c=my.Res,a=f+translate("Ressourcen anfordern")+'</div><TABLE class=pbTab width=100% height=0% ><TR align="center">';a+="<table>";a+=b;if(Options.resconfig.ares==true)a+='<TD><INPUT id=pbResEnable type=submit value="Request On"></td>';else a+='<TD><INPUT id=pbResEnable type=submit value="Request Off"></td>';a+="</tr></table></div>";a+=b;a+=f+translate("Einstellungen")+"</div><TABLE class=pbTab>";a+=b;a+=g;a+='<font color="#FBACAC"><center><u><i>'+translate("Bitte missbrauchen Sie diese Funktion nicht! Oder ich muss es wieder entfernen")+" ..</i></u></center></font>";a+="<table>";a+=b;a+="<tr><td>"+translate("Automatisch bei jedem einen Beitrag schreiben")+' <INPUT id=pbResMin type=text size=2 maxlength=3 value="'+Options.resconfig.resmins+'"  > '+translate("Minuten")+" - ("+translate("Spam min")+": 10 "+translate("Minuten")+")</td></tr>";a+=b;a+="<tr><TD><TABLE cellpadding=0 cellspacing=0>";a+=h+translate("Deine Stadt")+': &nbsp; </td><TD><INPUT id=pbCityxy type=text size=15 maxlength=7 value="'+Options.Cityxy+i;a+=h+translate("Nahrung")+': &nbsp; </td><TD><INPUT id=pbFood type=text size=15 maxlength=10 value="'+Options.ResFood+i;a+=g;c.cont.innerHTML=a;document.getElementById("pbResEnable").addEventListener("click",function(){c.toggleon(this)},d);document.getElementById("pbCityxy").addEventListener(e,c.e_resOptChanged,d);document.getElementById("pbFood").addEventListener(e,c.e_resOptChanged,d);document.getElementById("pbResMin").addEventListener(e,c.e_resOptChanged,d)},hide:function(){var a=my.Res},e_resOptChanged:function(){var a="pbResMin",b=my.Res;Options.Cityxy=document.getElementById("pbCityxy").value;Options.ResFood=document.getElementById("pbFood").value;Options.resconfig.resmins=document.getElementById(a).value;if(parseInt(Options.resconfig.spammins)<1){Options.resconfig.spammins=1;document.getElementById(a).value=1}saveOptions()},toggleon:function(a){var b=my.Res;if(Options.resconfig.ares==true){Options.resconfig.ares=false;a.value="Request Off"}else{Options.resconfig.ares=true;a.value="Request On";ResSpamEvery.init()}saveOptions()}};var ResSpamEvery={timer:null,restimer:0,init:function(){if(!Options.resconfig.ares)return;if(Options.resconfig.resmins<1)Options.resconfig.resmins=1;ResSpamEvery.setEnable(Options.resconfig.ares)},setEnable:function(b){var a=ResSpamEvery;clearTimeout(a.timer);if(b)a.timer=setTimeout(a.count,6e4)},count:function(){var a=ResSpamEvery;a.restimer=Options.resconfig.resmins;if(parseInt(a.restimer)<1)a.restimer=1;if(Options.resconfig.restime>a.restimer){Options.resconfig.restime=2;a.doit()}else{Options.resconfig.restime=Options.resconfig.restime+1;ResSpamEvery.init();var b="My City "+Options.Cityxy,c="I need food! Amount "+Options.ResFood,d=b+" - "+c}saveOptions()},doit:function(){sendChat("/a "+ResFin);ResSpamEvery.init()}};my.Spam={cont:null,timer:null,init:function(){var a=my.Spam;a.cont=document.createElement("div");return a.cont},getContent:function(){var a=my.Spam;return a.cont},show:function(){var d=false,f="</table>",c="<tr><td>&nbsp;</tr></td>",e='<TD><INPUT id=pbSpamState type=submit value="',b=my.Spam,a='<DIV class=ptstat>SPAM CHAT</div><TABLE class=pbTab width=100% height=0% ><TR align="center">';if(Options.resconfig.aspam==true)a+='<TD><INPUT id=pbSpamEnable type=submit value="Spam On"></td>';else a+='<TD><INPUT id=pbSpamEnable type=submit value="Spam Off"></td>';if(Options.spamconfig.spamstate=="a")a+=e+translate("Senden an Allianz")+'"></td>';else a+=e+translate("Senden an Global")+'"></td>';a+="</tr></table></div>";a+=c;a+="<DIV class=ptstat>"+translate("Einstellungen")+"</div><TABLE class=pbTab>";a+=c;a+=f;a+='<font color="#FBACAC"><center><u><i>'+translate("Bitte missbrauchen Sie diese Funktion nicht! Oder ich muss es wieder entfernen")+" ..</i></u></center></font>";a+="<table>";a+=c;a+="<tr><td>"+translate("Automatisch bei jedem einen Beitrag schreiben")+' <INPUT id=pbSpamMin type=text size=2 maxlength=3 value="'+Options.spamconfig.spammins+'"  > '+translate("Minuten")+" - ("+translate("Spam min")+": 10 "+translate("Minuten")+")</td></tr>";a+=c;a+="<tr><TD><TABLE cellpadding=0 cellspacing=0>";a+="<TD align=left>"+translate("Deine Spam")+': &nbsp; </td><TD><INPUT id=pbSpamAd type=text size=60 maxlength=500 value="'+Options.spamconfig.spamvert+'" ></td></tr>';a+=f;b.cont.innerHTML=a;document.getElementById("pbSpamEnable").addEventListener("click",function(){b.toggleon(this)},d);document.getElementById("pbSpamAd").addEventListener("change",b.e_spamOptChanged,d);document.getElementById("pbSpamMin").addEventListener("change",b.e_spamOptChanged,d);document.getElementById("pbSpamState").addEventListener("click",function(){b.togglespam(this)},d)},hide:function(){var a=my.Spam},e_spamOptChanged:function(){var a="pbSpamMin",b=my.Spam;Options.spamconfig.spamvert=document.getElementById("pbSpamAd").value;Options.spamconfig.spammins=document.getElementById(a).value;if(parseInt(Options.spamconfig.spammins)<10){Options.spamconfig.spammins=10;document.getElementById(a).value=10}saveOptions()},togglespam:function(a){var b=my.Spam;if(Options.spamconfig.spamstate=="a"){Options.spamconfig.spamstate="g";a.value=translate("Senden an Global")}else{Options.spamconfig.spamstate="a";a.value=translate("Send an Alliance")}saveOptions()},toggleon:function(a){var b=my.Spam;if(Options.spamconfig.aspam==true){Options.spamconfig.aspam=false;a.value="Spam Off"}else{Options.spamconfig.aspam=true;a.value="Spam On";SpamEvery.init()}saveOptions()}};var SpamEvery={timer:null,spamtimer:0,init:function(){if(!Options.spamconfig.aspam)return;if(Options.spamconfig.spammins<10)Options.spamconfig.spammins=10;SpamEvery.setEnable(Options.spamconfig.aspam)},setEnable:function(b){var a=SpamEvery;clearTimeout(a.timer);if(b)a.timer=setTimeout(a.count,6e4)},count:function(){var a=SpamEvery;a.spamtimer=Options.spamconfig.spammins;if(parseInt(a.spamtimer)<10)a.spamtimer=10;if(Options.spamconfig.atime>a.spamtimer){Options.spamconfig.atime=2;a.doit()}else{Options.spamconfig.atime=Options.spamconfig.atime+1;SpamEvery.init()}saveOptions()},doit:function(){sendChat("/"+Options.spamconfig.spamstate+" "+Options.spamconfig.spamvert);SpamEvery.init()}};my.Options={cont:null,state:null,fixAvailable:{},init:function(){var a=my.Options;a.cont=document.createElement("div");return a.cont},getContent:function(){var a=my.Options;return a.cont},togOpt:function(c,d,f,b){var g=my.Options,a=document.getElementById(c);if(b&&b()==false){a.disabled=true;return}if(Options[d])a.checked=true;a.addEventListener("change",new e(c,d,f).handler,false);function e(e,a,c){this.handler=d;var f=a,b=c;function d(){Options[a]=this.checked;saveOptions();b!=null&&b(this.checked)}}},show:function(){var n="optFoodHours",x="selectprivacymode",w="Options_??",v="ptAllowFB",l="ChatAllCol",k="ChatGloCol",d="change",u="pcfoodPrefix",c=false,t="pbRessEnable",s="pbGoldEnable",r='" width=30px>&nbsp;</td></tr>',q="<TR><TD>&nbsp;</td><TD>&nbsp;</td><TD>Chat Color - ",j="</td><TD>",f='<SPAN style="color:red">&nbsp;(NEW)</span></td></tr>',p="/></td><TD>",i="</div>",h="<TR><TD>&nbsp;</td></tr></table>",e="CHECKED ",o='" ></td></tr>',b="</td></tr>",g='<div class="ptstat">',a=my.Options;try{m='<DIV style="height:580px; max-height:580px; overflow-y:auto">';m+=g+translate("Einstellungen")+" "+NameTools+":</div>";m+='<br><font color="#FBACAC"><center><u><i>'+translate("WAHRNUNG")+"! "+translate("Nach dem Einstellen der Werkzeuge, aktualisiere das Spiel")+"!</i></u></font>";m+='<INPUT id=pcReloadTools type=submit value="'+translate("Aktualisieren des Spiels")+'" ></center>';m+="<br><TABLE class=ptTab>";m+="<TR><TD><INPUT id=ptAllowWinMove type=checkbox /></td><TD>"+translate("Durch das klicken in der oberen Leiste, kann das Fenster verschoben werden")+b;m+="<TR><TD><INPUT id=pbGoldEnable type=checkbox /></td><TD>"+translate("Automatisches Spielen im Koloseum, wenn die freude bei")+" <INPUT id=pbgoldLimit type=text size=2 maxlength=3 >%)</td></tr>";m+="<TR><TD><INPUT id=pbRessEnable type=checkbox /></td><TD>"+translate("Automatisches einholen der Ressourcen alle")+" <INPUT id=pbLimitRess type=text size=2 maxlength=3 > "+translate("Minuten")+b;m+="<TR><TD>&nbsp;</td><td>"+translate("Zeige Autonomiezeit in rot, wenn weniger als")+' <INPUT id=optFoodHours type=text size=3 value="'+Options.foodWarnHours+'"> '+translate("Stunden")+b;m+="<TR><TD>&nbsp;</td><TD><INPUT id=pbfoodspam type=checkbox />"+translate("Aktivieren Sie Chat-Spam (Allianz), wenn Nahrung rot ist")+b;m+='<TR><TD>&nbsp;</td><TD align=right>Narichten vorgabe : <INPUT id=pcfoodPrefix type=text size=55 maxlength=120 value="'+Options.MessCibo+o;m+="<TR><TD><INPUT id=ptAllowFB "+(GlobalOptions.autoPublishGamePopups?e:"")+" type=checkbox /></td><TD>"+translate("Aktivieren Sie automatische Veroeffentlichung von Hilfsanfargen auf Facebook")+" "+htmlSelector({0:"----",80:translate("Alle"),50:translate("Freunde von Freunden"),40:translate("Freunde"),10:translate("Nur mir")},GlobalOptions.autoPublishPrivacySetting,"id=selectprivacymode")+b;m+=h;m+=g+translate("Konfigurieren des Chat-")+i;m+="<table><TR><TD><INPUT id=pbChatREnable type=checkbox /></td><TD>"+translate("Legen Sie die Chat auf die rechte Seite")+b;m+="<TR><TD><INPUT id=ptEnableFoodWarnTchat type=checkbox /></td><TD>"+translate("Aktivieren des automatischen Beitrag im AllianzChat, wenn Autonomiezeit in rot ist")+b;m+="<TR><TD><INPUT id=HelpReq type=checkbox /></td><TD>"+translate("Aktivieren der Automatisch Beihilfeantraege")+b;m+="<TR><TD><INPUT id=DelReq type=checkbox /></td><TD>"+translate("Automatisches Loeschen von Antraegen")+b;m+=h;m+=g+translate("Konfiguration des Turm Alarm")+i;m+="<table><TR><TD><INPUT id=pcalertEnable type=checkbox "+(Options.alertConfig.aChat?e:"")+p+translate("Beitrag Automatisch veroefentlichen bei eingehende Angriffe, im AllianzChat")+b;m+='<TR><TD>&nbsp;</td><TD align=right>Message Prefix : <INPUT id=pcalertPrefix type=text size=55 maxlength=120 value="'+Options.alertConfig.aMessAtt+o;m+="<TR><TD>&nbsp;</td><TD><INPUT id=pcstatustroops type=checkbox "+(Options.StatusTroops?e:"")+"/>"+translate("Zeigt den Status der Truppen (versteckt / verteidigen)")+f;m+="<TR><TD>&nbsp;</td><TD><INPUT id=pctimeattack type=checkbox "+(Options.TimeAttack?e:"")+"/>"+translate("Zeigt die Ankunftszeit des Angriffs")+f;m+="<TR><TD><INPUT id=pcalertAudioEnable type=checkbox "+(Options.alertConfig.aAudio?e:"")+p+translate("Aktivieren akustischer Alarm")+b;m+="<TR><TD><INPUT id=pcalertWhisper type=checkbox "+(Options.Whisper?e:"")+j+translate("Alarm senden, in AllianzChat als gefluester")+f;m+=h;m+=g+translate("Chat-Verbesserungen")+i;m+="<table><TR><TD><INPUT id=togGlobal type=checkbox "+(Options.chatglobal?e:"")+j+translate("Aktivieren Globale Chat Hintergrundfarbe")+f;m+=q+translate("Global")+':</td><TD><INPUT id=ChatGloCol type=text size=7 maxlength=7 value="'+Options.ChatGlo+'"></td><TD>&nbsp;</td><TD id=PreChatGloCol style="background-color:'+Options.ChatGlo+r;m+="<TR><TD><INPUT id=togAlliance type=checkbox "+(Options.chatalliance?e:"")+j+translate("Aktivieren Allianz-Chat Hintergrundfarbe")+f;m+=q+translate("Allianz")+':</td><TD><INPUT id=ChatAllCol type=text size=7 maxlength=7 value="'+Options.ChatAll+'"></td><TD>&nbsp;</td><TD id=PreChatAllCol style="background-color:'+Options.ChatAll+r;m+="</table><BR><BR><HR><b><center>"+Created+"</center></b></div>";a.cont.innerHTML=m;a.togOpt("ptAllowWinMove","ptWinDrag",mainPop.setEnableDrag);a.togOpt("ptEnableFoodWarnTchat","enableFoodWarnTchat",FoodAlerts.init);a.togOpt(s,s,CollectGold.setEnable);a.togOpt("pbfoodspam","foodspam");a.togOpt(t,t,CollectRessource.setEnable);a.togOpt("pbChatREnable","pbChatOnRight",WideScreen.setChatOnRight);a.togOpt("HelpReq","HelpRequest");a.togOpt("DelReq","DeleteRequest");a.togOpt("togGlobal","chatglobal");a.togOpt("togAlliance","chatalliance");a.togOpt("pcalertWhisper","Whisper");a.togOpt("pcstatustroops","StatusTroops");a.togOpt("pctimeattack","TimeAttack");a.changeOpt("pbgoldLimit","pbGoldHappy");a.changeOpt("pbLimitRess","pbRessTime");document.getElementById("pcReloadTools").addEventListener("click",reloadTools,c);document.getElementById(u).addEventListener(d,function(){Options.MessCibo=document.getElementById(u).value},c);document.getElementById(k).addEventListener(d,function(){Options.ChatGlo=document.getElementById(k).value;document.getElementById("PreChatGloCol").style.backgroundColor=document.getElementById(k).value},c);document.getElementById(l).addEventListener(d,function(){Options.ChatAll=document.getElementById(l).value;document.getElementById("PreChatAllCol").style.backgroundColor=document.getElementById(l).value},c);document.getElementById(v).addEventListener(d,function(){GlobalOptions.autoPublishGamePopups=document.getElementById(v).checked;GM_setValue(w,JSON2.stringify(GlobalOptions))},c);document.getElementById(x).addEventListener(d,function(){GlobalOptions.autoPublishPrivacySetting=document.getElementById(x).value;GM_setValue(w,JSON2.stringify(GlobalOptions))},c);document.getElementById(n).addEventListener(d,function(){var a=document.getElementById(n).value;if(isNaN(a)||a<.01||a>99999){document.getElementById(n).value=Options.foodWarnHours;return}Options.foodWarnHours=a;saveOptions()},c);document.getElementById("pcalertAudioEnable").addEventListener(d,a.e_alertOptChanged,c);document.getElementById("pcalertEnable").addEventListener(d,a.e_alertOptChanged,c);document.getElementById("pcalertPrefix").addEventListener(d,a.e_alertOptChanged,c)}catch(y){a.cont.innerHTML="<PRE>"+y.name+" : "+y.message+"</pre>"}},hide:function(){},togOpt:function(e,b,a){var f=my.Options,c=document.getElementById(e);if(Options[b])c.checked=true;c.addEventListener("change",d,false);function d(){Options[b]=this.checked;saveOptions();a&&a(this.checked)}},changeOpt:function(e,b,a){var f=my.Options,c=document.getElementById(e);c.value=Options[b];c.addEventListener("change",d,false);function d(){Options[b]=this.value;saveOptions();a&&a(this.value)}},e_alertOptChanged:function(){Options.alertConfig.aChat=document.getElementById("pcalertEnable").checked;Options.alertConfig.aAudio=document.getElementById("pcalertAudioEnable").checked;Options.alertConfig.aMessAtt=document.getElementById("pcalertPrefix").value;saveOptions();TowerAlerts.setPostToChatOptions(Options.alertConfig)}};function htmlSelector(c,e,d){var a=[];a.push("<SELECT");if(d){a.push(" ");a.push(d)}for(var b in c){a.push("><OPTION ");b==e&&a.push("SELECTED ");a.push('value="');a.push(b);a.push('">');a.push(c[b]);a.push("</option>")}a.push("</select>");return a.join("")}function reloadTools(){var a=getServerId();a=="??"&&window.location.reload(true);var b=new String(window.parent.document.location);if(b.indexOf("https://")!=-1)prefix="https://apps.facebook.com/gloryofrome/?s="+a;else prefix="http://apps.facebook.com/gloryofrome/?s="+a;var d='<FORM target="_top" action="'+b+'" method=post><INPUT id=xxpbButReload type=submit value=RELOAD><INPUT type=hidden name=s value="'+a+'"</form>',c=document.createElement("div");c.innerHTML=d;document.body.appendChild(c);setTimeout(function(){document.getElementById("xxpbButReload").click()},0)}my.Search={cont:null,state:null,opt:{},searchRunning:false,tilesSearched:0,tilesFound:0,curX:0,curY:0,lastX:0,firstX:0,firstY:0,lastY:0,sourceCity:null,init:function(){var a=my.Search;this.cont=document.createElement("div");unsafeWindow.BOPCpo2=a.clickedPlayerCheckOnline;unsafeWindow.BOPCplo2=a.clickedPlayerGetLastLogin;return this.cont},getContent:function(){var a=my.Search;return a.cont},hide:function(){},show:function(){var c="<TD width=100px>&nbsp;</td>",b="</table>",a=my.Search;if(a.state==null){this.cont.innerHTML="          <DIV class=ptentry><table><tr valign=bottom><TD class=xtab width=100 align=right>"+translate("Typ")+' : </td><TD>          <SELECT id="srcType">            <OPTION selected value=1>'+translate("Wildniss")+"</option>  \t    <OPTION value=0>"+translate("Barbaren Lager")+"</option>  \t   <OPTION value=2>"+translate("Stadt")+'</option>          </select></td></tr>        </table>         <DIV id="srcOpts" style="height:120px"></div></div>        <DIV id="srcResults" style="height:400px; max-height:400px;"></div>';m="<TABLE><TR valign=middle><TD class=xtab width=100 align=right>"+translate("Zentrum")+' : &nbsp;</td><TD class=xtab>        X:\t<INPUT id="srchX" type=text size=3> &nbsp; Y: <INPUT id="srchY" type=text size=3> &nbsp;<SPAN id=spInXY></span>';m+="</td></tr><TR><TD class=xtab align=right>"+translate("Distanz")+" : </td><TD class=xtab>"+translate("zwischen")+" <INPUT id=srcaDist size=4 value=0 />"+translate("und")+" <INPUT id=srcDist size=4 value=10 /></td></tr>";m+='<TR><TD class=xtab></td><TD class=xtab><INPUT id=srcStart type=submit value="'+translate("Starte Suche")+'"/></td></tr>';m+=b;m+="<table>";m+="<TR><TD><b>"+translate("Legende")+"</b></td></tr>";m+="<TR><TD>&nbsp;</td></tr>";m+='<tr><TD></td><TD style="background-color:lightgreen"width=20px>&nbsp;</td><TD>&nbsp;</td><TD> '+translate("Neutral")+"</td>";m+=c;m+='<TD></td><TD style="background-color:lightblue"width=20px>&nbsp;</td><TD>&nbsp;</td><TD> '+translate("Freundlich")+"</td>";m+=c;m+='<TD></td><TD style="background-color:crimson"width=20px>&nbsp;</td><TD>&nbsp;</td><TD> '+translate("Feindlich")+"</td></Tr>";m+=b;document.getElementById("srcOpts").innerHTML=m;var d=new CdispCityPicker("srchdcp",document.getElementById("spInXY"),false,a.clickCitySourceSelect,Cities.byID[unsafeWindow.currentcityid].idx);document.getElementById("srcStart").addEventListener("click",a.clickedSearch,false);a.state=1}},clickCitySourceSelect:function(b){var a=my.Search;a.sourceCity=b;document.getElementById("srchX").value=a.sourceCity.c.x;document.getElementById("srchY").value=a.sourceCity.c.y},clickedPlayerCheckOnline:function(a,b){var d=my.AllianceList,c=my.Search;a.onclick="";a.innerHTML=translate("Suche")+"...";d.fetchPlayerStatusSimple(b,function(d){c.gotPlayerStatus(d,a,b)})},clickedPlayerGetLastLogin:function(a,b){var d=my.AllianceList,c=my.Search;a.onclick="";a.innerHTML=translate("Suche")+" ...";d.fetchPlayerLastLogin(b,function(b){c.gotPlayerLastLogin(b,a)})},gotPlayerStatus:function(a,b,c){var e=my.AllianceList;if(!a.ok){b.innerHTML=a.errorMsg;return}var d=a.data;if(d[c]==true)m='<span style="color:green"><b>Online!</b></span>';else m='<span style="color:red"><b>Offline!</b></span>';b.innerHTML=m+""},gotPlayerLastLogin:function(a,c){var e=my.AllianceList;if(!a.ok){c.innerHTML=a.errorMsg;return}var d=a.playerInfo,b=a.playerInfo.lastLogin;if(b)m='<span style="color:black">'+b+"</span>";else m='<span style="color:red">?</span>';c.innerHTML=m+""},clickedSearch:function(){var M="filPuissanceMax",L="filPuissance",K="filfiltreJoueur",J="filfiltreAlliance",s="idSrchFilter",I="filUnowned",H="woodWild",G="hillWild",F="foodWild",E="filSortBy",D="filMaxLvl",e="change",C="filMinLvl",B='>500 000</option>          <option value="1000000" ',A='>100 000</option>          <option value="500000" ',r="100000",z='>50 000</option>          <option value="100000" ',y='>10 000</option>          <option value="50000" ',x='>2 500</option>          <option value="10000" ',w='>500</option>          <option value="2500" ',q="Glory",p="Alliance",o="Player Name",n="</option>",v='</option>           <OPTION value="dist" ',f=">",c="SELECTED",l="></td></tr>",i=" CHECKED",k="Level",h="<TR><TD class=xtab align=right>",j="Distance",g=" ",d=false,u="ShowHideOpts",t="srcResults",b="",a=my.Search;if(a.searchRunning){a.stopSearch(translate("SUCHE ABGEBROCHEN")+"!");return}a.opt.searchType=document.getElementById("srcType").value;a.opt.startX=parseInt(document.getElementById("srchX").value);a.opt.startY=parseInt(document.getElementById("srchY").value);a.opt.maxDistance=parseInt(document.getElementById("srcDist").value);a.opt.maxDistanceA=parseInt(document.getElementById("srcaDist").value);errMsg=b;if(isNaN(a.opt.maxDistanceA)||a.opt.maxDistanceA<0)errMsg+="La distance mini doit &ecirc;tre sup&eacute;rieur &agrave; 0<BR>";if(isNaN(a.opt.maxDistance)||a.opt.maxDistance<1)errMsg+="La distance maxi doit &ecirc;tre sup&eacute;rieur &agrave; 1<BR>";if(a.opt.maxDistance<=a.opt.maxDistanceA)errMsg+="La distance max doit &ecirc;tre sup&eacute;rieur &agrave; la distance mini<BR>";if(a.opt.maxDistanceA>375)errMsg+="La distance max ne peut d&eacute;passer 375 ! au risque de p&ecirc;ter votre navigateur<BR>";if(errMsg!=b){document.getElementById(t).innerHTML="<FONT COLOR=#660000>"+translate("FEHLER")+" :</font><BR><BR>"+errMsg;return}a.searchRunning=true;document.getElementById("srcStart").value=translate("Stope die Suche");m='<DIV class=ptstat><TABLE width=100% cellspacing=0><TR><TD class=xtab width=125><DIV id=statSearched></div></td>            <TD class=xtab align=center><SPAN id=statStatus></span></td>            <TD class=xtab align=right width=125><DIV id=statFound></div></td></tr></table></div>          <TABLE width=100%><TR valign=top><TD><DIV id=divOutTab style="height:470px; max-height:470px; overflow-y:auto; width:100%;"></div></td>          <TD id="tddivOutOpts" width="290px" height=100% style="background:#e0e0f0; height:100%; padding:5px, top:0px"><DIV id=divOutOpts style="width:260px"></div></td></tr></table><br><input type=checkbox id=ShowHideOpts>'+translate("verstecke Einstellungen");document.getElementById(t).innerHTML=m;document.getElementById(u).addEventListener("click",function(){var a="tddivOutOpts";if(document.getElementById(u).checked)document.getElementById(a).style.display="none";else document.getElementById(a).style.display="block"},d);if(a.opt.searchType==0)typeName=translate("Barbaren Lager");else if(a.opt.searchType==1)typeName=translate("Wildnisss");else typeName=translate("Stadt");m="<CENTER><B>"+translate("Suche f�r")+g+typeName+"<BR>         "+translate("Zentrum")+" : "+a.opt.startX+","+a.opt.startY+"  &nbsp; "+translate(j)+" : "+translate("zwischen")+g+a.opt.maxDistanceA+g+translate("und")+g+a.opt.maxDistance+"<BR></center>         <DIV class=ptentry><TABLE cellspacing=0 width=100%><TR align=center><TD class=xtab colspan=10><B>"+translate("Einstellungen")+" :</b><BR></td></tr>";if(a.opt.searchType==1||a.opt.searchType==0)m+=h+translate(k)+" Min. :</td><TD class=xtab> <INPUT id=filMinLvl size=2 value="+Options.srcMinLevel+" /></td></tr>         <TR><TD class=xtab align=right>"+translate(k)+" Max. :</td><TD class=xtab> <INPUT id=filMaxLvl size=2 value="+Options.srcMaxLevel+" /></td></tr>";if(a.opt.searchType==1){m+=h+translate("Wildnisse")+" :</td><TD class=xtab align=right>             "+translate("Waelder")+"<INPUT id=woodWild type=CHECKBOX"+(Options.woodWild?i:b)+l;m+=h+translate("Grasslandschaft")+"/"+translate("Fluss")+"<INPUT  id=foodWild type=CHECKBOX "+(Options.foodWild?i:b)+"></td> \t       <TD class=xtab align=right>"+translate("Berg")+"<INPUT id=mtnWild type=CHECKBOX "+(Options.mtnWild?i:b)+l;m+=h+translate("Ebene")+"<INPUT id=plnWild type=CHECKBOX "+(Options.plnWild?i:b)+"></td>            <TD class=xtab align=right>"+translate("Huegel")+"<INPUT id=hillWild type=CHECKBOX"+(Options.hillWild?i:b)+l;m+="<TR><TD class=xtab align=right>Solo occupate :</td><TD class=xtab><INPUT id=filUnowned type=CHECKBOX "+(Options.unownedOnly?i:b)+"><td></tr>"}if(a.opt.searchType==1||a.opt.searchType==0){m+=h+translate("Sortieren nach")+' :</td><TD class=xtab><SELECT id=filSortBy>           <OPTION value="level" '+(Options.srcSortBy=="level"?c:b)+f+translate(k)+v+(Options.srcSortBy=="dist"?c:b)+f+translate(j)+n;if(a.opt.searchType==1){m+='<OPTION value="play" '+(Options.srcSortBy=="play"?c:b)+f+translate(o)+n;m+='<OPTION value="alli" '+(Options.srcSortBy=="alli"?c:b)+f+translate(p)+n}m+="</select></td></tr> \t\t\t<TR><TD class=xtab align=right>"+translate("nur")+g+translate("Koords")+" :</td><TD class=xtab><INPUT type=checkbox id=coordsOnly ></td></tr> \t\t\t</table></div><BR><SPAN id=srchSizeWarn></span><DIV id=BOpbSrcExp></div>"}else{m+="<TR><TD class=xtab align=right >"+translate("zeigen")+' :</td><TD class=xtab align=left ><SELECT style="width: 135px" id=idSrchFilter>              <OPTION value=0>'+translate("Alle Staedte")+"</option>              <OPTION value=1>"+translate("Nur Feindliche Staedte")+"</option> \t     <OPTION value=2>"+translate("Stadt im Nebel")+"</option> \t     <OPTION value=3>"+translate("Nur alliierte Stadt")+"</option> \t     <OPTION value=4>"+translate("Nur freundliche Stadt")+"</option> \t     <OPTION value=5>"+translate("Nur Neutrale Stadt")+"</option> \t     <OPTION value=6>"+translate("ohne Allianz")+"</option>              </select></td></tr>";m+=h+translate("Sortieren nach")+' :</td><TD class=xtab><SELECT id=filSortBy>           <OPTION value="might" '+(Options.srcSortBy=="might"?c:b)+f+translate(q)+v+(Options.srcSortBy=="dist"?c:b)+f+translate(j)+'</option>                   <OPTION value="play" '+(Options.srcSortBy=="play"?c:b)+f+translate(o)+'</option>         <OPTION value="alli" '+(Options.srcSortBy=="alli"?c:b)+f+translate(p)+"</option>         </select></td></tr>         <tr><TD class=xtab align=right>"+translate(q)+' Min. : </td><TD class=xtab><select id=filPuissance>          <option value="0" '+(Options.filPuissance=="0"?c:b)+'>0</option>          <option value="500" '+(Options.filPuissance=="500"?c:b)+w+(Options.filPuissance=="2500"?c:b)+x+(Options.filPuissance=="10000"?c:b)+y+(Options.filPuissance=="50000"?c:b)+z+(Options.filPuissance==r?c:b)+A+(Options.filPuissance=="500000"?c:b)+B+(Options.filPuissance=="1000000"?c:b)+">1 000 000</option>          </select></td></tr>          <tr><TD class=xtab align=right>"+translate(q)+' Max. :</td><TD class=xtab><select id=filPuissanceMax>          <option value="500" '+(Options.filPuissanceMax=="500"?c:b)+w+(Options.filPuissanceMax=="2500"?c:b)+x+(Options.filPuissanceMax=="10000"?c:b)+y+(Options.filPuissanceMax=="50000"?c:b)+z+(Options.filPuissanceMax==r?c:b)+A+(Options.filPuissanceMax==r?c:b)+B+(Options.filPuissanceMax=="1000000"?c:b)+'>1 000 000</option>          <option value="100000000" '+(Options.filPuissanceMax=="100000000"?c:b)+">100 "+translate("Millionen")+"</option>          </select></td></tr>          <tr><TD class=xtab align=right>"+translate(p)+' :</td><td class=xtab><input type=text size=10 id=filfiltreAlliance value="'+Options.filfiltreAlliance+'"></td></tr>        <tr><TD class=xtab align=right>'+translate(o)+' :</td><td class=xtab><input type=text size=10 id=filfiltreJoueur value="'+Options.filfiltreJoueur+'"></td></tr>         <TR style="display:none;"><TD class=xtab align=right>'+translate("nur")+g+translate("Koords")+"</td><TD class=xtab><INPUT type=checkbox id=coordsOnly ></td></tr>          </table></div><BR><SPAN id=srchSizeWarn></span>"}document.getElementById("divOutOpts").innerHTML=m;if(a.opt.searchType==1||a.opt.searchType==0){document.getElementById(C).addEventListener(e,function(){Options.srcMinLevel=document.getElementById(C).value;saveOptions();a.dispMapTable()},d);document.getElementById(D).addEventListener(e,function(){Options.srcMaxLevel=document.getElementById(D).value;saveOptions();a.dispMapTable()},d)}document.getElementById(E).addEventListener(e,function(){Options.srcSortBy=document.getElementById(E).value;saveOptions();a.dispMapTable()},d);document.getElementById("coordsOnly").addEventListener(e,function(){a.dispMapTable()},d);if(a.opt.searchType==1){document.getElementById(F).addEventListener(e,function(){Options.foodWild=document.getElementById(F).checked;saveOptions();a.dispMapTable()},d);document.getElementById(G).addEventListener(e,function(){Options.hillWild=document.getElementById(G).checked;saveOptions();a.dispMapTable()},d);document.getElementById("mtnWild").addEventListener(e,function(){Options.mtnWild=document.getElementById("mtnWild").checked;saveOptions();a.dispMapTable()},d);document.getElementById("plnWild").addEventListener(e,function(){Options.plnWild=document.getElementById("plnWild").checked;saveOptions();a.dispMapTable()},d);document.getElementById(H).addEventListener(e,function(){Options.woodWild=document.getElementById(H).checked;saveOptions();a.dispMapTable()},d);document.getElementById(I).addEventListener(e,function(){Options.unownedOnly=document.getElementById(I).checked;saveOptions();a.dispMapTable()},d)}if(a.opt.searchType==2){document.getElementById(s).addEventListener(e,function(){Options.citySrchFilter=document.getElementById(s).value;saveOptions();a.dispMapTable()},d);document.getElementById(s).value=Options.citySrchFilter;document.getElementById(J).addEventListener("keyup",function(){Options.filfiltreAlliance=document.getElementById(J).value;saveOptions();a.dispMapTable()},d);document.getElementById(K).addEventListener("keyup",function(){Options.filfiltreJoueur=document.getElementById(K).value;saveOptions();a.dispMapTable()},d);document.getElementById(L).addEventListener(e,function(){Options.filPuissance=parseInt(document.getElementById(L).value);saveOptions();a.dispMapTable()},d);document.getElementById(M).addEventListener(e,function(){Options.filPuissanceMax=parseInt(document.getElementById(M).value);saveOptions();a.dispMapTable()},d)}a.mapDat=[];a.firstX=a.opt.startX-a.opt.maxDistance;if(a.firstX<0)a.firstX=0;a.lastX=a.opt.startX+a.opt.maxDistance;if(a.lastX>800)a.lastX=800;a.firstY=a.opt.startY-a.opt.maxDistance;if(a.firstY<0)a.firstY=0;a.lastY=a.opt.startY+a.opt.maxDistance;if(a.lastY>800)a.lastY=800;a.tilesSearched=0;a.tilesFound=0;a.curX=a.firstX;a.curY=a.firstY;var N=a.normalizeCoord(a.curX),O=a.normalizeCoord(a.curY);document.getElementById("statStatus").innerHTML=translate("Suche")+g+N+","+O;setTimeout(function(){Map.request(N,O,15,a.mapCallback)},500)},normalizeCoord:function(a){if(a>=800)a=800;else if(a<0)a=0;return parseInt(a/5)*5},mapCallback:function(v,w,u,h){var d="Unknown";var a=my.Search;if(!a.searchRunning)return;if(!h.ok){a.stopSearch(translate("FEHLER")+" : "+h.errorMsg);return}map=h.data;var b=h.userInfo,e=h.allianceNames;for(k in map){if(a.opt.searchType==0&&map[k].tileType==51&&map[k].tileCityId==0&&map[k].tileUserId==0)type=0;else if(a.opt.searchType==1&&map[k].tileType>=10&&map[k].tileType<=50)if(map[k].tileType==10)type=1;else if(map[k].tileType==11)type=2;else if(map[k].tileType==12)type=2;else type=map[k].tileType/10+1;else if(a.opt.searchType==2&&map[k].tileCityId>=0&&map[k].tileType>50&&map[k].cityName)type=7;else continue;dist=distance(a.opt.startX,a.opt.startY,map[k].xCoord,map[k].yCoord);if(dist<=a.opt.maxDistance&&dist>=a.opt.maxDistanceA){if(a.opt.searchType==2){var l=map[k].tileUserId==0||false,c="u"+map[k].tileUserId,j=d,i=d,f=0,g=d;if(l){g="Brume";f=0}else if(b[c]){g=""+b[c].n+"";f=b[c].m;i=getDiplomacy2(b[c].a);if(e&&e["a"+b[c].a])j=e["a"+b[c].a];else{j="----";i="unaligned"}}a.mapDat.push([map[k].xCoord,map[k].yCoord,dist,type,map[k].tileLevel,l,map[k].tileCityId,map[k].tileUserId,map[k].cityName,g,f,j,i])}else{isOwned=map[k].tileUserId>0||map[k].misted;var c="u"+map[k].tileUserId,j=d,i=d,g=d,f=0;if(map[k].misted)g="Sous la Brume";else if(b[c]){var g="<a onclick=getInfoForAnUser('"+map[k].tileUserId+"');>"+b[c].n+"</a>";f=b[c].m;i=getDiplomacy2(b[c].a);if(e&&e["a"+b[c].a])j=e["a"+b[c].a]}else var g=d;a.mapDat.push([map[k].xCoord,map[k].yCoord,dist,type,map[k].tileLevel,isOwned,map[k].tileCityId,map[k].tileUserId,map[k].cityName,g,f,j,i])}++a.tilesFound}}a.tilesSearched+=225;document.getElementById("statSearched").innerHTML=translate("Gefunden in Summe")+" : "+a.tilesSearched;a.dispMapTable();a.curX+=15;if(a.curX>a.lastX){a.curX=a.firstX;a.curY+=15;if(a.curY>a.lastY){a.stopSearch(translate("Fertig")+"!");return}}a.opt.maxDistanceA;if(a.opt.maxDistanceA>0){var p=a.opt.startX-a.opt.maxDistanceA,r=a.opt.startX+a.opt.maxDistanceA,q=a.opt.startY-a.opt.maxDistanceA,s=a.opt.startY+a.opt.maxDistanceA;if(a.curX>p&&a.curX<r){var m=parseInt(a.opt.maxDistanceA*2/15)-1;a.curX=a.curX+m*15}if(a.curY>q&&a.curY<s){var m=parseInt(a.opt.maxDistanceA*2/15)-1;a.curY=a.curY+m*15}}var n=a.normalizeCoord(a.curX),o=a.normalizeCoord(a.curY);document.getElementById("statStatus").innerHTML=translate("Suche auf")+" "+n+","+o;setTimeout(function(){Map.request(n,o,15,a.mapCallback)},500)},dispMapTable:function(){var q="Last Login",f=')"><A style="font-size:9px;">',p='</td>  \t\t\t   <TD valign="top" style="padding:2px">',e="</td>",o="</a></div>",n="More Info",l='</td><td style="padding-left: 10px;" colspan=2>',k="Alliance",j='</td><td style="padding-left: 10px;">',b='</td><TD style="padding-left: 10px;">',h="Dist",g='</td><TD style="padding:2px;padding-left: 10px">',d="</td></tr>",c="Coords",t=[translate("Barbaren Lager"),translate("Grasslandschaft"),translate("Fluss"),translate("Wald"),translate("Huegel"),translate("Berg"),translate("Ebene"),translate("Stadt'")],a=my.Search,r=document.getElementById("coordsOnly").checked;function u(a,b){if(Options.srcSortBy=="level")if((x=a[4]-b[4])!=0)return x;if(Options.srcSortBy=="might")if((x=b[10]-a[10])!=0)return x;return Options.srcSortBy=="alli"?a[11]<b[11]?-1:a[11]==b[11]?0:1:Options.srcSortBy=="play"?a[9]<b[9]?-1:a[9]==b[9]?0:1:a[2]-b[2]}dat=[];for(i=0;i<a.mapDat.length;i++){lvl=parseInt(a.mapDat[i][4]);type=a.mapDat[i][3];puissance=a.mapDat[i][10];if(a.opt.searchType==2&&type==7)switch(parseInt(Options.citySrchFilter)){case 0:Options.filPuissance<=puissance&&puissance<=Options.filPuissanceMax&&dat.push(a.mapDat[i]);break;case 1:a.mapDat[i][12]==""+translate("Feindlich")+""&&Options.filPuissance<=puissance&&puissance<=Options.filPuissanceMax&&dat.push(a.mapDat[i]);break;case 2:a.mapDat[i][5]===true&&Options.filPuissance<=puissance&&puissance<=Options.filPuissanceMax&&dat.push(a.mapDat[i]);break;case 3:a.mapDat[i][12]=="Ally"&&Options.filPuissance<=puissance&&puissance<=Options.filPuissanceMax&&dat.push(a.mapDat[i]);break;case 4:a.mapDat[i][12]=="Friendly"&&Options.filPuissance<=puissance&&puissance<=Options.filPuissanceMax&&dat.push(a.mapDat[i]);break;case 5:a.mapDat[i][12]=="Neutral"&&Options.filPuissance<=puissance&&puissance<=Options.filPuissanceMax&&dat.push(a.mapDat[i]);break;case 6:a.mapDat[i][12]=="unaligned"&&Options.filPuissance<=puissance&&puissance<=Options.filPuissanceMax&&dat.push(a.mapDat[i])}else if(lvl>=Options.srcMinLevel&&lvl<=Options.srcMaxLevel)if(a.opt.searchType==0||Options.woodWild==1&&type==3||Options.hillWild==1&&type==4||Options.mtnWild==1&&type==5||Options.plnWild==1&&type==6||Options.foodWild==1&&(type==1||type==2))(!Options.unownedOnly||a.mapDat[i][5]===true)&&dat.push(a.mapDat[i])}document.getElementById("statFound").innerHTML=translate("gefunden")+" : "+dat.length;if(dat.length==0)m="<BR><CENTER>"+translate("nichts gefunden")+"</center>";else{dat.sort(u);if(r)m='<TABLE align=center id=srcOutTab cellpadding=2 cellspacing=0 style="padding:2px"><TR style="font-weight: bold"><TD style="padding:2px">'+translate(c)+d;else{if(a.opt.searchType==0)m='<TABLE id=srcOutTab cellpadding=0 cellspacing=0 style="padding:2px"><TR style="font-weight: bold"><TD style="padding:2px">'+translate(c)+g+translate(h)+b+translate("Lvl")+b+translate("Typ")+d;if(a.opt.searchType==1)m='<TABLE id=srcOutTab cellpadding=2 cellspacing=2 style="padding:2px"><TR style="font-weight: bold"><TD style="padding:2px">'+translate(c)+g+translate(h)+b+translate("Lvl")+b+translate("Typ")+b+translate("Spieler")+j+translate("Ruhm")+j+translate(k)+l+translate(n)+d;if(a.opt.searchType==2)m='<TABLE id=srcOutTab cellpadding=2 cellspacing=2 style="padding:2px"><TR style="font-weight: bold"><TD style="padding:2px" width=10%>'+translate(c)+g+translate(h)+'</td><TD  style="padding-left: 10px;">'+translate("Stadt")+b+translate("Spieler Name")+b+translate("Ruhm")+j+translate(k)+l+translate(n)+d}var s=dat.length;if(s>100&&a.searchRunning)document.getElementById("srchSizeWarn").innerHTML="<FONT COLOR=#600000>"+translate("HINWEISE: Es gibt keine Grenzen in der Suche, kann aber die Leistung des Browsers beeinflussen")+"</font>";for(i=0;i<s;i++)if(a.opt.searchType!=2||dat[i][11].search(Options.filfiltreAlliance,"i")!=-1&&dat[i][9].search(Options.filfiltreJoueur,"i")!=-1&&a.opt.searchType==2){m+='<TR valign="top"';if(dat[i][12])m+='class="'+dat[i][12]+'"';if(r)m+=' ><TD valign="top" style="padding:2px"><DIV>'+dat[i][0]+","+dat[i][1]+"</div></td></tr>";else{m+=' ><TD valign="top" style="padding:2px"><DIV>  \t             <a href="javascript:void(0);" onclick="KB.Controllers.MapHelper.gotoCoord('+dat[i][0]+","+dat[i][1]+');">'+dat[i][0]+","+dat[i][1]+o;m+=e;if(a.opt.searchType==2){m+='<TD align="left" style="padding:2px" valign="top">'+dat[i][2].toFixed(2)+'</a></td><TD align=left style="padding:2px">'+dat[i][8]+p+dat[i][9]+p+addCommasInt(dat[i][10])+'</td>  \t\t\t   <td style="padding:2px">'+dat[i][11]+'</td><td style="padding:2px">';if(!dat[i][5])m+='<DIV style="" onclick="BOPCpo2(this, '+dat[i][7]+f+translate("Status")+'</a></div></td>\t\t\t\t\t<td style="padding:2px"><DIV style="" onclick="BOPCplo2(this, '+dat[i][7]+f+translate(q)+o;m+=e;m+="<td>-</td><td align=right>-</td>";m+="</tr>"}else{m+='<TD align=right  valign="top" style="padding:2px">'+dat[i][2].toFixed(2)+" &nbsp; </td><TD align=right>"+dat[i][4]+"</td><TD> &nbsp; "+t[dat[i][3]];+e;if(a.opt.searchType==1)if(dat[i][5]){m+='<td style="padding:2px">'+dat[i][9]+"<td>"+addCommasInt(dat[i][10])+"</td><td>"+dat[i][11]+e;if(dat[i][7]&&dat[i][7]!=0)m+='<td style="padding:2px"><DIV style="" onclick="BOPCpo2(this, '+dat[i][7]+f+translate("Status")+'</a></div></td><td><DIV style="" onclick="BOPCplo2(this, '+dat[i][7]+f+translate(q)+"</a></div></td>";else m+='<td style="padding:2px">&nbsp;</td><td>&nbsp;</td>'}else m+='<td colspan=5 style="text-align=rgiht"><i><b> . . . '+translate("Frei")+" . . . </b></i>";else m+="<td></td>";m+="</tr>"}}}m+="</table>"}document.getElementById("divOutTab").innerHTML=m;dat=null},mapDat:[],stopSearch:function(a){var b=my.Search;document.getElementById("statStatus").innerHTML="<FONT color=#ffaaaa>"+a+"</font>";document.getElementById("srcStart").value=translate("Starte die Suche");document.getElementById("srchSizeWarn").innerHTML="";b.searchRunning=false}};function distance(f,h,e,g){var c=800,d=c/2,a=Math.abs(e-f);if(a>d)a=c-a;var b=Math.abs(g-h);if(b>d)b=c-b;return Math.round(100*Math.sqrt(a*a+b*b))/100}function getDiplomacy2(a){return unsafeWindow.seed.allianceDiplomacies==null?"Neutral":unsafeWindow.seed.allianceDiplomacies.friendly&&unsafeWindow.seed.allianceDiplomacies.friendly["a"+a]!=null?"Friendly":unsafeWindow.seed.allianceDiplomacies.hostile&&unsafeWindow.seed.allianceDiplomacies.hostile["a"+a]!=null?translate("Feindlich"):a==unsafeWindow.seed.allianceDiplomacies.allianceId?"Ally":"Neutral"}Map={generateBlockList:function(d,e,c){var a=parseInt(c/5),b=[];for(x=0;x<a;x++){xx=d+x*5;if(xx>795)xx=795;for(y=0;y<a;y++){yy=e+y*5;if(yy>795)yy=795;b.push("bl_"+xx+"_bt_"+yy)}}return b.join(",")},callback:null,request:function(b,c,a,e){b=parseInt(b/5)*5;c=parseInt(c/5)*5;a=parseInt((a+4)/5)*5;var d=this.generateBlockList(b,c,a);Map.callback=e;var f={blocks:d};unsafeWindow.AjaxCall.gPostRequest("fetchMapTiles.php",f,function(d){Map.callback(b,c,a,d)},function(d){Map.callback(b,c,a,d)})}};my.Overview={cont:null,displayTimer:null,checkBox:null,checkBox1:null,Overview:function(){},init:function(){this.cont=document.createElement("div");unsafeWindow.BOdefend=this.gatedef;return this.cont},getContent:function(){return my.Overview.cont},hide:function(){clearTimeout(my.Overview.displayTimer)},gatedef:function(a){var c=Cities.cities[a].c,b=!Cities.cities[a].c.defending,d={cid:c.id,state:b};unsafeWindow.AjaxCall.gPostRequest("gate.php",d,function(){var d="def_";c.defending=b;if(b){document.getElementById(d+a).value="DEF = ON";document.getElementById(d+a).className="BODefButOn"}else{document.getElementById(d+a).value="DEF = OFF";document.getElementById(d+a).className="BODefButOff"}})},show:function(){var N="</font>)",M=" (<font color=red>",L="</td><td ",K=" align=right><b>",J="<tr><td ",x=" align=right>",I="<TD width=81 ",H='style="background:',G='" align=right>&nbsp; ',z=" %</td>",r=" ",j='" align=right>',w='" align=right>&nbsp;',h='</td><td style="background:',g='" align=right><b>',i='<tr><td style="background:',t=';">',F=';color:red;">',f="</td>",k='">',s=";color:",e='<TD align=right width=81 style="background:',n="black",c="",m="<tr><td><br></td></tr>",d="</tr>",E="</td>\t  <TD><SPAN class=ptStatLight>",D=" : </span> ",C=" :</span> ",eb=0,db=0,B=my.Overview;clearTimeout(B.displayTimer);dt=new Date;dt.setTime(unsafeWindow.player.datejoinUnixTime*1e3);str='<div style="height:600px;max-height:600px;overflow-y:auto"><DIV class=ptstat style="margin-top:2px; margin-bottom:2px; "><TABLE cellspacing=0 cellpadding=0 class=ptTab width=97% align=center>      <TR align=left><TD><SPAN class=ptStatLight>'+translate("Server")+":</span> "+unsafeWindow.domainName+"</td>      <TD><SPAN class=ptEvidence>Created by Ulmius</span></td>      <TD><SPAN class=ptStatLight>"+translate("Spielt seit")+C+dt.toLocaleDateString()+"</td></tr>\t  <TD><SPAN class=ptStatLight>"+translate("Allianz")+D+getMyAlliance()[1]+E+translate("Spieler Name")+C+unsafeWindow.player.name+E+translate("Ruhm")+D+addCommasInt(unsafeWindow.player.might())+'</td></tr></table></div><span id="debugtest"></span>';str+="<TABLE class='ptTabOverview' cellpadding=0 cellspacing=0><TR valign=top align=right><TD width=100></td><TD width=88 style='background: #9F9F9F'><b>";str+=translate("Gesamt");str+="</b></td>";for(a=0;a<Cities.numCities;a++){Gate=Cities.cities[a].c.defending;if(Gate==0)var ab=Options.Alternato,bb="BODefButOff",Z="DEF = OFF";else var ab="#EE7777",bb="BODefButOn",Z="DEF = ON";str+="<TD width=81 style='background-color:"+ab+";text-align:center' align=center><B>"+Cities.cities[a].c.name+'</b><BR><a onclick="KB.Controllers.MapHelper.gotoCoord('+Cities.cities[a].c.x+","+Cities.cities[a].c.y+');">('+Cities.cities[a].c.x+","+Cities.cities[a].c.y+')</a><br><input type=button value="'+Z+'" id="def_'+a+'" class="'+bb+'" onclick="BOdefend('+a+');"></td>'}str+=d;str+=m;var b=c;for(a=0;a<Cities.numCities;a++){color=n;if(Cities.cities[a].c.queues.building.activeSlots()[0]||Cities.cities[a].c.queues.building.activeSlots()[1]){if(parseInt(Cities.cities[a].c.queues.building.activeSlots()[0].typeId())!=99)var Y=Cities.cities[a].c.queues.building.activeSlots()[0].secondsLeft();else if(Cities.cities[a].c.queues.building.activeSlots()[1])var Y=Cities.cities[a].c.queues.building.activeSlots()[1].secondsLeft();else{var Y=0;color="red"}b+=e+Options.Alternato+s+color+k+timestrShort(Y)+f}else b+=e+Options.Alternato+F+timestrShort(0)+f}str+='<tr><TD align=right width=81 style="background:'+Options.Alternato+';"><b>';str+=translate("Gebaeude");str+='</td><TD align=right width=81 style="background:'+Options.Alternato+';">&nbsp;'+b+d;var b=c;for(a=0;a<Cities.numCities;a++){color=n;if(Cities.cities[a].c.queues.research.activeSlots()[0])b+=e+Options.Alternato+s+color+t+timestrShort(Cities.cities[a].c.queues.research.activeSlots()[0].secondsLeft())+f;else b+=e+Options.Alternato+F+timestrShort(0)+f}str+=i+Options.Alternato+g;str+=translate("Forschung");str+=h+Options.Alternato+w+b+d;str+=m;var b=c;for(a=0;a<Cities.numCities;a++){color=n;var q=0,v=0,p=Cities.cities[a].c.queues.training.activeSlots();p.length&&p.each(function(a){q=a.secondsLeft();v+=q});var p=Cities.cities[a].c.queues.training.queuedSlots();p.length&&p.each(function(a){q=a.totalTime();v+=q});b+=e+Options.Alternato+k+timestrShort(v)+f}str+=i+Options.Alternato+g;str+=translate("Ausbildung");str+=h+Options.Alternato+w+b+d;var b=c;for(a=0;a<Cities.numCities;a++){color=n;var q=0,v=0,p=Cities.cities[a].c.queues.reviving.activeSlots();p.length&&p.each(function(a){q=a.secondsLeft();v+=q});var p=Cities.cities[a].c.queues.reviving.queuedSlots();p.length&&p.each(function(a){q=a.totalTime();v+=q});b+=e+Options.Alternato+t+timestrShort(v)+f}str+=i+Options.Alternato+g;str+=translate("Wiederbelebung");str+=h+Options.Alternato+w+b+d;str+=m;var b=c,o=0;for(a=0;a<Cities.numCities;a++){b+=e+Options.Alternato+k+addCommas(Cities.cities[a].c.population.cap())+f;o+=parseInt(Cities.cities[a].c.population.cap())}str+=i+Options.Alternato+g;str+=translate("Einwohner-Limit");str+=h+Options.Alternato+j+addCommas(o)+r+b+d;var b=c,o=0;for(a=0;a<Cities.numCities;a++){b+=e+Options.Alternato+k+addCommas(Cities.cities[a].c.population.count())+f;o+=parseInt(Cities.cities[a].c.population.count())}str+=i+Options.Alternato+g;str+=translate("derzeitige Bevoelkerung");str+=h+Options.Alternato+j+addCommas(o)+r+b+d;var b=c,o=0;for(a=0;a<Cities.numCities;a++){b+=e+Options.Alternato+k+addCommas(Cities.cities[a].c.population.labor())+f;o+=parseInt(Cities.cities[a].c.population.labor())}str+=i+Options.Alternato+g;str+=translate("Arbeiter");str+=h+Options.Alternato+j+addCommas(o)+r+b+d;var b=c,o=0;for(a=0;a<Cities.numCities;a++){b+=e+Options.Alternato+k+addCommas(Cities.cities[a].c.population.count()-Cities.cities[a].c.population.labor())+f;o+=parseInt(Cities.cities[a].c.population.count()-Cities.cities[a].c.population.labor())}str+=i+Options.Alternato+g;str+=translate("Bevoelkerung verfuegbar");str+=h+Options.Alternato+j+addCommas(o)+r+b+d;var b=c,o=0;for(a=0;a<Cities.numCities;a++)if(Cities.cities[a].c.population.happiness()<50)b+=e+Options.Alternato+';color:red"><b>'+Cities.cities[a].c.population.happiness()+z;else b+=e+Options.Alternato+k+Cities.cities[a].c.population.happiness()+z;str+=i+Options.Alternato+g;str+=translate("Freude");str+=h+Options.Alternato+G+b+d;var b=c,o=0;for(a=0;a<Cities.numCities;a++)b+=e+Options.Alternato+k+addCommas(Cities.cities[a].c.taxRate())+z;str+=i+Options.Alternato+g;str+=translate("Steuer");str+=h+Options.Alternato+G+b+d;str+=m;var b=c,P=0;for(a=0;a<Cities.numCities;a++){b+='<TD width=81 style="background:'+Options.Alternato+j+addCommas(Cities.cities[a].c.silver())+f;P+=parseInt(Cities.cities[a].c.silver())}str+='<tr align=right><td style="background:'+Options.Alternato+g;str+=translate("Silber");str+=h+Options.Alternato+j+addCommas(P)+r+b+d;for(var u=1;u<=4;u++){if(u%2)style=c;else style=H+Options.Alternato+'"';for(var b=c,V=0,a=0;a<Cities.numCities;a++){b+=I+style+x+addCommas(Cities.cities[a].c.resources[u].count)+f;V+=parseInt(Cities.cities[a].c.resources[u].count)}str+=J+style+K+unsafeWindow.arStrings.ResourceName[u]+L+style+x+addCommas(V)+r+b+d}str+=m;var b=c,Q=0;for(a=0;a<Cities.numCities;a++){b+=e+Options.Alternato+k+addCommas(Cities.cities[a].c.resources[1].hourlyTotalRate())+"/"+unsafeWindow.arStrings.TimeStr.timeHr+f;Q+=parseInt(Cities.cities[a].c.resources[1].hourlyTotalRate())}str+=i+Options.Alternato+g+unsafeWindow.arStrings.Common.Production+h+Options.Alternato+j+addCommas(Q)+"/"+unsafeWindow.arStrings.TimeStr.timeHr+c+b+d;var b=c,T=0;for(a=0;a<Cities.numCities;a++){color=n;b+=e+Options.Alternato+s+color+t+addCommas(Cities.cities[a].c.upkeep())+"/"+unsafeWindow.arStrings.TimeStr.timeHr+f;T+=parseInt(Cities.cities[a].c.upkeep())}str+=i+Options.Alternato+g+unsafeWindow.arStrings.Common.UpKeep+h+Options.Alternato+j+addCommas(T)+"/"+unsafeWindow.arStrings.TimeStr.timeHr+c+b+d;var b=c,T=0,cb=c;for(a=0;a<Cities.numCities;a++){color=n;if(parseInt(Cities.cities[a].c.resources[1].hourlyTotalRate())<parseInt(Cities.cities[a].c.upkeep())){difference=parseInt(Cities.cities[a].c.resources[1].hourlyTotalRate())-parseInt(Cities.cities[a].c.upkeep());var y=parseInt(Cities.cities[a].c.resources[1].count)/(0-difference)*3600;if(y>86313600)autonomi="----";else if(y<Options.foodWarnHours*3600)autonomi="<SPAN class=whiteOnRed><b>"+timestrShort(y)+"</b></span>";else autonomi=c+timestrShort(y)+c;b+=e+Options.Alternato+s+color+t+autonomi+f}else b+=e+Options.Alternato+';color:white;">---</td>'}str+=i+Options.Alternato+g+translate("Ausreichend fuer Autonomy")+h+Options.Alternato+w+b+d;str+=m;for(var l=1;l<=31;l++){var b=c,R=0,A=0;if(unsafeWindow.arStrings.unitName["u"+l]){if(l%2)style=c;else style=H+Options.Alternato+'"';for(var a=0;a<Cities.numCities;a++){var X=Cities.cities[a].c.troops[l].wounded(),W=c;if(X>0)W=M+addCommas(X)+N;b+=I+style+x+addCommas(Cities.cities[a].c.troops[l].count())+c+W+f;R+=parseInt(Cities.cities[a].c.troops[l].count());A+=parseInt(Cities.cities[a].c.troops[l].wounded())}var O=c;if(A>0)O=M+addCommas(A)+N;str+=J+style+K+unsafeWindow.arStrings.unitName["u"+l]+L+style+x+addCommas(R)+c+O+r+b+d}}str+=m;var b=c,U=0;for(a=0;a<Cities.numCities;a++){color=n;b+=e+Options.Alternato+s+color+t+Cities.cities[a].c.generalsCount()+f;U+=parseInt(Cities.cities[a].c.generalsCount())}str+=i+Options.Alternato+g;str+=translate("Generale");str+=h+Options.Alternato+j+U+c+b+d;str+=m;var b=c,S=0;for(a=0;a<Cities.numCities;a++){color=n;b+=e+Options.Alternato+s+color+t+Cities.cities[a].c.wildernessCount()+" / "+Cities.cities[a].c.buildings[0].level()+f;S+=parseInt(Cities.cities[a].c.wildernessCount())}str+=i+Options.Alternato+g;str+=translate("Wildnisse");str+=h+Options.Alternato+j+S+c+b+d;str+="</table>";my.Overview.cont.innerHTML=str+"</div><br>"+cb+"<center><b>"+Created+"</b></center>";B.displayTimer=setTimeout(B.show,4e3)}};my.AllianceList={cont:null,nombre:null,state:null,dat:[],init:function(){var a=my.AllianceList;a.cont=document.createElement("div");unsafeWindow.PTgetMembers=a.eventGetMembers;unsafeWindow.PTpd=a.clickedPlayerDetail;unsafeWindow.PTpl=a.clickedPlayerLeaderboard;unsafeWindow.PCplo=a.clickedPlayerGetLastLogin;return a.cont},getContent:function(){var a=my.AllianceList;return a.cont},hide:function(){var a=my.AllianceList},show:function(){var b=false,a=my.AllianceList;if(a.state==null){var c="<DIV class=ptentry><TABLE width=100% cellpadding=0>              <TR><TD class=xtab align=right></td><TD class=xtab>"+translate("Spieler Name")+' : &nbsp;</td>                <TD width=80% class=xtab><INPUT id=allPlayName size=20 type=text /> &nbsp; <INPUT id=playSubmit type=submit value="'+translate("Suche Spieler")+'" /></td>              <TD class="xtab ptErrText"><SPAN id=ptplayErr></span></td></tr>            <TR><TD class=xtab>'+translate("oder")+" </td><TD class=xtab>"+translate("Allianz Name")+' : &nbsp;</td>             <TD class=xtab><INPUT id=allAllName type=text /> &nbsp; <INPUT id=allSubmit type=submit value="'+translate("Suche Allianz")+'" /></td>            <TD class="xtab ptErrText"><SPAN id=ptallErr></span></td></tr>             </table><span style="vertical-align:middle;" id=altInput></span></div>          <SPAN id=allListOut></span>';a.cont.innerHTML=c;document.getElementById("allSubmit").addEventListener("click",a.eventSubmit,b);document.getElementById("playSubmit").addEventListener("click",a.eventPlayerSubmit,b);document.getElementById("allPlayName").addEventListener("focus",function(){document.getElementById("ptplayErr").innerHTML=""},b);document.getElementById("allAllName").addEventListener("focus",function(){document.getElementById("ptallErr").innerHTML=""},b);a.state=1}},aName:"",eventSubmit:function(){var b="ptallErr",a=my.AllianceList;document.getElementById(b).innerHTML="";a.aName=document.getElementById("allAllName").value;if(a.aName.length<3){document.getElementById(b).innerHTML=translate("3 CARACTERES Minimum");return}document.getElementById("altInput").innerHTML="";document.getElementById("allListOut").innerHTML="<BR><BR><CENTER>"+translate("Suche")+"...</center>";a.fetchAllianceList(a.aName,null,a.eventGotAllianceList)},fetchAllianceList:function(b,e,c){var a="ptallErr",f=my.AllianceList;unsafeWindow.AjaxCall.gPostRequest("allianceGetSearchResults.php",{allianceName:b},function(b){if(!b.ok)document.getElementById(a).innerHTML=b.msg;else c(b)},function(){document.getElementById(a).innerHTML="Erreur";document.getElementById("allListOut").innerHTML=""})},fetchMyAllianceInfo:function(a){unsafeWindow.AjaxCall.gPostRequest("allianceGetInfo.php",{},function(b){a(b)},function(b){a(b)})},eventGotAllianceList:function(b){var g="</td><TD align=right class=xtab>",f='</td><TD class=xtab style="font-weight:bold;">',e='</td><TD class=xtab  style="font-weight:bold;">',d="allListOut",i=my.AllianceList;if(!b.ok){document.getElementById(d).innerHTML=b.errorMsg;return}var h="<DIV class=ptstat>"+translate("Resultate fuer")+' <B>"'+i.aName+'"</b></div>      <TABLE cellpadding=3 width=80% cellspacing=0 class=ptTab><TR><TD class=xtab  style="font-weight:bold;">'+translate("Allianz Name")+e+translate("Rang")+f+translate("Mitglieder")+'</td>          <TD align=right class=xtab  style="font-weight:bold;">'+translate("Ruhm")+e+translate("Diplomatie")+f+translate("Mitglieder")+"</td></tr>";for(k in b.alliancesMatched){var a=b.alliancesMatched[k],c="";if(a.relation&&a.relation==1)c=translate("Freundlich");else if(a.relation&&a.relation==2)c=translate("Feindlich");if(a.ranking!=null)h+="<TR><TD class=xtab>"+a.allianceName+g+a.ranking+g+a.membersCount+"</td>          <TD align=right class=xtab >"+addCommasInt(a.might)+"</td><TD class=xtab>"+c+'</td>          <TD class=xtab><a onclick="PTgetMembers('+a.allianceId+')">Voir</a></td></tr>'}document.getElementById(d).innerHTML=h},eventGetMembers:function(b){var a=my.AllianceList;document.getElementById("allListOut").innerHTML="<BR><BR><CENTER>"+translate("Suche")+"...</center>";a.fetchAllianceMemberList(b,null,a.eventGotMemberList)},fetchAllianceMemberList:function(b,c,d){var e=my.AllianceList,a={};a.action="view_alliance_detail";if(c)a.allianceName=c;if(b&&b!=0)a.allianceId=b;unsafeWindow.AjaxCall.gPostRequest("getUserLeaderboard.php",a,function(a){d(a)},function(a){d(a)})},eventGotMemberList:function(a){var b=my.AllianceList;if(!a.ok){document.getElementById("allListOut").innerHTML=a.errorMsg;return}b.memberListRslt=a;var c=[];for(k in a.results)c.push(a.results[k].userId);b.fetchPlayerStatus(c,function(a){b.eventGotMemberOnlineList(a)})},eventGotMemberOnlineList:function(f){var b=my.AllianceList,e=0,d=0,g=getMyAlliance();b.dat=[];for(var c=0;c<b.memberListRslt.results.length;c++){p=b.memberListRslt.results[c];if(p.userId==0)++e;else{++d;for(var a=0;a<p.cities.length;a++)b.dat.push([p.displayName,parseInt(p.might),p.officerType,parseInt(p.numCities),parseInt(p.cities[a].tileLevel),parseInt(p.cities[a].xCoord),parseInt(p.cities[a].yCoord),p.cities[a].cityName,0,a,p.userId,p.avatarId,p.playerSex,p.rank,f.data[p.userId]?1:0,"NA"])}}b.displayMembers(b.memberListRslt.allianceName,d)},sortColNum:1,sortDir:1,displayMembers:function(g,f){var c="clickable clickableSel",b="clickCol",a=my.AllianceList;function e(e){var a=my.AllianceList,d=e.id.substr(8);document.getElementById(b+a.sortColNum).className="clickable";e.className=c;if(d==a.sortColNum)a.sortDir*=-1;else a.sortColNum=d;a.reDisp()}unsafeWindow.PTalClickSort=e;var d='<STYLE>.clickable{background-color:#ddd; border:2px outset; border-color:#555; padding-left:5px; padding-right:5px}              .clickableSel{background-color:#ffffcc;}              .xxtab{background-color:none; padding-left:5px; padding-right:5px;} </style>        <DIV class=ptstat><TABLE id=tabAllMembers cellpadding=0  width=100%><TR font-weight:bold"><TD class=xtab> &nbsp; '+g+"</td>          <TD class=xtab width=80% align=center>Distance depuis <SPAN id=distFrom>"+Cities.cities[0].name+" ("+Cities.cities[0].x+","+Cities.cities[0].y+")</span></td><TD class=xtab align=right>"+f+" joueurs trouv&eacute;s &nbsp; </td></tr></table></div>";d+='<div style="top:190px;left:0px;width:100%; position:absolute;max-height:475px;height:470px;overflow:auto;">        <TABLE id=tabAllMembers align=center cellpadding=0 cellspacing=0><THEAD>        <TR style="font-weight:bold"><TD id=clickCol0 onclick="PTalClickSort(this)" class=clickable><A><DIV>Joueur</div></a></td>          <TD id=clickCol1 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>Puissance</a></div></td>          <TD id=clickCol3 onclick="PTalClickSort(this)" class=clickable><A><DIV>Villes</a></div></td>          <TD id=clickCol2 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>Titre</a></div></td>          <TD id=clickCol14 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>Ligne</a></div></td>          <TD id=clickCol7 onclick="PTalClickSort(this)" class=clickable><A><DIV>Ville</a></div></td>          <TD id=clickCol4 onclick="PTalClickSort(this)" class=clickable><A><DIV>Niv</a></div></td>          <TD id=clickCol5 onclick="PTalClickSort(this)" class=clickable><A><DIV>Coords</a></div></td>          <TD id=clickCol8 onclick="PTalClickSort(this)" class=clickable><A><DIV>Dist</a></div></td>          <TD id=clickCol15 onclick="PTalClickSort(this)" class=clickable><A><DIV>Est.</a></div></td>          <TD class=clickable><A><DIV>Connexion</div></a></td></tr></thead>        <tbody id=allBody ></tbody></table></div>        <DIV style="top:670px; left:0px; position:absolute; width:100%;  background-color:#ffffff; border-top:1px solid; margin-top:8px; color:#700; font-weight:bold;">          <TABLE width=100%><TR><TD class=xtab>Les donn&eacute;es proviennent du tableau d honneur ! (24h de d&eacutecalage)</td>          </tr></table></div>';document.getElementById("allListOut").innerHTML=d;document.getElementById("altInput").innerHTML='<HR><TABLE width=100% cellpaddding=0><TR align=center>          <TD class=xtab>Montrer la distance depuis : &nbsp; X: <INPUT size=2 type=text id="plyrX" /> Y: <INPUT size=2 type=text id="plyrY" /> &nbsp; Ou, choisissez une ville : <span id=dmcoords></span></td></tr></table>';document.getElementById(b+a.sortColNum).className=c;a.reDisp();new CdispCityPicker("plyrdcp",document.getElementById("dmcoords"),true,a.eventCoords,0).bindToXYboxes(document.getElementById("plyrX"),document.getElementById("plyrY"));document.getElementById("idFindETASelect").disabled=false},reDisp:function(){var d=";",b=my.AllianceList;function g(b,c){var a=my.AllianceList;return typeof b[a.sortColNum]=="number"?a.sortDir>0?b[a.sortColNum]-c[a.sortColNum]:c[a.sortColNum]-b[a.sortColNum]:typeof b[a.sortColNum]=="boolean"?0:a.sortDir>0?b[a.sortColNum].localeCompare(c[a.sortColNum]):c[a.sortColNum].localeCompare(b[a.sortColNum])}b.dat.sort(g);var e="",c=document.getElementById("allBody");c.innerHTML="";c.style.maxHeight="";for(var f="",a=0;a<b.dat.length;a++){if(a%2==0)tabclass="xxtab";else tabclass="xxtab_even";e+='<TR style="max-height:30px"><TD class=xxtab><a onclick=PTDme("'+b.dat[a][0]+'");><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/avatars/25/'+b.dat[a][12]+""+b.dat[a][11]+'.jpg" align=absmiddle></a>&nbsp;<a onclick=getInfoForAnUser("'+b.dat[a][10]+'");>'+b.dat[a][0]+"</a></td><TD align=right class="+tabclass+">"+addCommasInt(b.dat[a][1])+"</td><TD align=center class="+tabclass+">"+b.dat[a][3]+"</td>  \t                <TD class="+tabclass+'><span title="Classement : '+b.dat[a][13]+' joueur">'+officerId2String(b.dat[a][2])+"</span></td><TD class=xxtab>"+(b.dat[a][14]?"<SPAN class=boldDarkRed>LIGNE</span>":"")+"</td><TD class="+tabclass+">"+b.dat[a][7]+"</td><TD align=right class="+tabclass+">"+b.dat[a][4]+"</td>  \t                <TD align=center class="+tabclass+'><DIV>  \t                <a href="javascript:void(0)" onclick="cm.utils.CoordinateLinkController.onClick(event)" class="coordinateLink">('+b.dat[a][5]+","+b.dat[a][6]+')</a>  \t                </div></td><TD align=right class=xxtab style="padding-right:20px;">'+b.dat[a][8].toFixed(2)+"</td>";e+="<TD  nowrap class=xxtab>"+(b.dat[a][15]?"<SPAN>"+(b.dat[a][15]>0?timestr(b.dat[a][15],1):"NA")+"</span>":"<SPAN>NA</span>")+"</td><td class="+tabclass+"><SPAN onclick=\"PCplo(this, '"+b.dat[a][10]+"');\"><A>?</a></span><td></tr>";f+=b.dat[a][0]+d+b.dat[a][1]+d+b.dat[a][5]+d+b.dat[a][6]+d+b.dat[a][4]+d+b.dat[a][8]+d+b.dat[a][7]+"\n"}e+='<tr><td colspan=11><textarea cols="55" rows="12" onclick="this.focus();this.select();" id="cutAndPaste" name="csv">Joueur;Puissance;X;Y;Niveau;Distance;Ville\n'+f+"</textarea><br><b>Export XLS (pour toi public:</b><bR>Copiez le contenu de la zone, coller ensuite le contenu dans blocnote et enregistrer le fichier en .cvs</tr>";var c=document.getElementById("allBody");c.style.maxHeight="";c.innerHTML=e;document.getElementById("cutAndPaste").innerHTML=f;if(parseInt(c.clientHeight)>475){c.style.height="475px";c.style.maxHeight="475px"}},eventPlayerSubmit:function(){var c="ptplayErr",b=my.AllianceList;document.getElementById(c).innerHTML="";var a=document.getElementById("allPlayName").value;b.pName=a;if(a.length<3){document.getElementById(c).innerHTML="Au moins 3 caracteres";return}document.getElementById("altInput").innerHTML="";document.getElementById("allListOut").innerHTML="<BR><BR><CENTER>"+translate("Forschung im Gange")+"...</center>";b.fetchPlayerList(a,b.eventGotPlayerList)},clickedPlayerLeaderboard:function(a,c){var b=my.AllianceList;a.onclick="";a.innerHTML="Research sur le tableau d'honneur ...";b.fetchLeaderboard(c,function(c){b.gotPlayerLeaderboard(c,a)})},fetchLeaderboard:function(b,a){unsafeWindow.AjaxCall.gPostRequest("getUserLeaderboard.php",{action:"view_player_detail",player_id:b},function(b){a(b)},function(b){a(b)})},fetchPlayerList:function(b,a){unsafeWindow.AjaxCall.gPostRequest("searchPlayers.php",{subType:"ALLIANCE_INVITE",searchName:b},function(b){a(b)},function(b){a(b)})},gotPlayerLeaderboard:function(a,b){var d=my.AllianceList;if(!a.ok){b.innerHTML=a.errorMsg;return}if(a.totalResults==0){b.innerHTML="<B>Tableau d'honneur :</b> Pas trouv&eacute; ! (sous la brume ?)";return}var c=a.data[0];b.innerHTML="<B>Tableau d'honneur :</b> En cours de Building<br>Nombre de villes :"+c.numOfCities+"<br>Nombre de Terres : "+c.numOfWilds},eventGotPlayerList:function(a){var b=my.AllianceList;if(!a.ok){document.getElementById("allListOut").innerHTML=a.errorMsg;return}b.playerList=a.matchedUsers;var c=[];for(k in a.matchedUsers)c.push(a.matchedUsers[k].userId);b.fetchPlayerStatus(c,function(a){b.eventGotPlayerOnlineList(a)})},fetchPlayerStatus:function(b,a){unsafeWindow.AjaxCall.gPostRequest("getOnline.php",{checkArr:b.join(",")},function(b){a(b)},function(b){a(b)})},fetchPlayerStatusSimple:function(b,a){unsafeWindow.AjaxCall.gPostRequest("getOnline.php",{checkArr:b},function(b){a(b)},function(b){a(b)})},fetchPlayerInfo:function(b,a){unsafeWindow.AjaxCall.gPostRequest("getUserGeneralInfo.php",{uid:b},function(b){a(b)},function(b){a(b)})},clickedPlayerDetail:function(a,c){var b=my.AllianceList;a.onclick="";a.innerHTML=translate("Suche")+" "+translate("Details")+"...";b.fetchPlayerInfo(c,function(c){b.gotPlayerDetail(c,a)})},gotPlayerDetail:function(b,f){var d=" &nbsp; ",j=my.AllianceList;if(!b.ok){f.innerHTML=b.errorMsg;return}var a=b.userInfo[0],g="Aucun";if(a.allianceName)g=a.allianceName+" ("+getDiplomacy(a.allianceId)+")";for(var i="<TABLE cellspacing=0 class=ptTab><TR><TD><B>"+translate("Details")+":</b> &nbsp; </td><TD>"+translate("Allianz")+":"+g+d+translate("Stadt")+": "+a.cities+d+translate("Bevoelkerung")+": "+a.population+"</td></tr><TR><TD></td><TD>"+translate("Provinzen")+": ",e=a.provinceIds.split(","),h=[],c=0;c<e.length;c++)h.push(unsafeWindow.arStrings.provinceName["p"+e[c]]);f.innerHTML=i+h.join(", ")+"</td></tr></table>"},eventGotPlayerOnlineList:function(b){var f="allListOut",e=my.AllianceList;if(!b.ok){document.getElementById(f).innerHTML=b.errorMsg;return}var d="<DIV class=ptstat>"+translate("Resultate fuer")+' <B>"'+e.pName+'"</b></div>        <DIV style="height:575px; max-height:575px; overflow-y:auto">        <TABLE width=95% align=center class=ptTab cellspacing=0><TR style="font-weight:bold"><TD width=20%><b>'+translate("Name")+"</b></td>        <TD align=right><b>"+translate("Ruhm")+"</b></td><TD>&nbsp;</td><TD width=60%><b>"+translate("zusaetzliche Information")+"</b></td></tr>",h=0,c="";for(k in e.playerList){var a=e.playerList[k];if(++h%2)c="class=ptOddrow ";else c="";if(a.allianceName)var g=a.allianceName;else var g="---";d+="<TR "+c+"valign=top><TD><b><font color=red>"+a.genderAndName+"</font></b><br>"+g+"<br></td><TD align=center>&nbsp;"+addCommasInt(a.might)+"&nbsp;</td>            <TD>"+(b.data[a.userId]?"&nbsp;<SPAN class=boldDarkRed>Online</span>":"")+'</td>           <TD><SPAN onclick="PTpd(this, '+a.userId+')"><A>'+translate("Details")+"</a></span><br><SPAN onclick=\"PCplo(this, '"+a.userId+"')\"><A>"+translate("letzter Login")+"</a></span></td></tr>"}d+="</table></div>";document.getElementById(f).innerHTML=d},clickedPlayerGetLastLogin:function(a,c){var b=my.AllianceList;a.onclick="";a.innerHTML=translate("Suche")+"...";b.fetchPlayerLastLogin(c,function(c){b.gotPlayerLastLogin(c,a)})},fetchPlayerLastLogin:function(b,a){unsafeWindow.AjaxCall.gPostRequest("viewCourt.php",{pid:b},function(b){a(b)},function(b){a(b)})},gotPlayerLastLogin:function(a,c){var e=my.AllianceList;if(!a.ok){c.innerHTML=a.errorMsg;return}var d=a.playerInfo,b=a.playerInfo.lastLogin;if(b)m='<span style="color:black">'+b+"</span>";else m='<span style="color:red">?</span>';c.innerHTML=m+""}};function CdispCityPicker(d,n,g,m,h){var e="#ffffff",b=null,a=this;function i(d){var a=d;this.clickedCityBut=c;function c(c){if(a.selected!=b)a.selected.className="castleBut castleButNon";a.city=Cities.cities[c.target.id.substr(a.prefixLen)];if(a.dispName)document.getElementById(a.id+"cname").innerHTML=a.city.c.name;c.target.className="castleBut castleButSel";a.selected=c.target;if(a.coordBoxX){a.coordBoxX.value=a.city.c.x;a.coordBoxY.value=a.city.c.y;a.coordBoxX.style.backgroundColor=e;a.coordBoxY.style.backgroundColor=e}a.notify!=b&&a.notify(a.city,a.city.c.x,a.city.c.y)}}function k(a){document.getElementById(this.id+"_"+a).click()}function j(a,c){function f(g){var d=g;this.eventChange=f;if(d.city){a.value=d.city.c.x;c.value=d.city.c.y}function f(){var a=parseInt(d.coordBoxX.value,10),c=parseInt(d.coordBoxY.value,10);if(isNaN(a)||a<0||a>750){d.coordBoxX.style.backgroundColor="#ff8888";return}if(isNaN(c)||c<0||c>750){d.coordBoxY.style.backgroundColor="#ff8888";return}d.coordBoxX.style.backgroundColor=e;d.coordBoxY.style.backgroundColor=e;d.notify!=b&&d.notify(b,a,c)}}this.coordBoxX=a;this.coordBoxY=c;var d=new f(this);a.size=2;a.maxLength=3;c.size=2;c.maxLength=3;a.addEventListener("change",d.eventChange,false);c.addEventListener("change",d.eventChange,false)}a.selectBut=k;a.bindToXYboxes=j;a.coordBoxX=b;a.coordBoxY=b;a.id=d;a.dispName=g;a.prefixLen=d.length+1;a.notify=m;a.selected=b;a.city=b;for(var f="",c=0;c<Cities.cities.length;c++)f+='<INPUT class="castleBut castleButNon" id="'+d+"_"+c+'" value="'+(c+1)+'" type=submit >';if(g)f+=' &nbsp; <SPAN style="display:inline-block; width:85px; font-weight:bold;" id='+d+"cname></span>";n.innerHTML=f;for(var l=new i(a),c=0;c<Cities.cities.length;c++)document.getElementById(d+"_"+c).addEventListener("click",l.clickedCityBut,false);h!=b&&a.selectBut(h)}function setTabStyle(a,b){if(b)a.className="matTabSel";else a.className="matTabNotSel"}function clickedTab(a){who=a.target.id.substring(2);newObj=my[who];currentObj=my[currentName];if(currentName!=who){setTabStyle(document.getElementById("aa"+currentName),false);setTabStyle(document.getElementById("aa"+who),true);if(currentObj){currentObj.hide();currentObj.getContent().style.display="none"}currentName=who;cont=newObj.getContent();newObj.getContent().style.display="block"}newObj.show()}function mouseMainTab(b){if(b.button==2){var a=getClientCoords(document.getElementById("main_engagement_tabs"));mainPop.setLocation({x:a.x+4,y:a.y+a.height})}}function eventHideShow(){if(mainPop.toggleHide(mainPop)){my[currentName].show();Options.ptWinIsOpen=true}else{my[currentName].hide();Options.ptWinIsOpen=false}saveOptions()}function hideMe(){mainPop.show(false);my[currentName].hide();Options.ptWinIsOpen=false;saveOptions()}function logit(c){var b=getServerId(),a=new Date;GM_log(b+" @ "+a.toTimeString().substring(0,8)+"."+a.getMilliseconds()+": "+c)}function saveOptions(){var a=getServerId();GM_setValue("BOOptions_"+a,JSON2.stringify(Options))}function readOptions(){var a=getServerId();s=GM_getValue("BOOptions_"+a);if(s!=null){opts=JSON2.parse(s);for(k in opts)Options[k]=opts[k]}}function saveTrainingOptions(){var a=getServerId();setTimeout(function(){GM_setValue("TrainingOptions_"+a,JSON2.stringify(TrainOptions))},0)}function readTrainingOptions(){var a=getServerId();s=GM_getValue("TrainingOptions_"+a);if(s!=null){opts=JSON2.parse(s);for(k in opts)TrainOptions[k]=opts[k]}}function createButton(b){var a=document.createElement("a");a.className="button20";a.innerHTML='<span style="color: #ff6">'+b+"</span>";return a}function AddMainTabLink(e,d,c){var a=createButton(e);a.className="tab";a.id="ptOfficial";var b=document.getElementById("main_engagement_tabs");if(b){b.insertBefore(a,b.firstChild);b.appendChild(a);a.addEventListener("click",d,false);c!=null&&a.addEventListener("mousedown",c,true);return a}return null}function setCities(){if(unsafeWindow.player.cities){var a=0;Cities.cities=[];Cities.byID={};unsafeWindow.player.allCities().each(function(b){city={};city.idx=a;city.id=parseInt(b.id);city.c=b;Cities.cities[a]=city;Cities.byID[b.id]=city;a++});Cities.numCities=a}}function getMyAlliance(){return unsafeWindow.seed.allianceDiplomacies==null||unsafeWindow.seed.allianceDiplomacies.allianceName==null?[0,translate("keine")]:[unsafeWindow.seed.allianceDiplomacies.allianceId,unsafeWindow.seed.allianceDiplomacies.allianceName]}function getDiplomacy(a){return unsafeWindow.seed.allianceDiplomacies==null?"neutral":unsafeWindow.seed.allianceDiplomacies.friendly&&unsafeWindow.seed.allianceDiplomacies.friendly["a"+a]!=null?"friendly":unsafeWindow.seed.allianceDiplomacies.hostile&&unsafeWindow.seed.allianceDiplomacies.hostile["a"+a]!=null?translate("Feindlich"):"neutral"}function parseIntNan(a){x=parseInt(a,10);return isNaN(x)?0:x}function searchDOM(node,condition,maxLevel,doMult){var found=[];eval("var compFunc = function (node) { return ("+condition+") }");doOne(node,1);if(!doMult)return found.length==0?null:found[0];return found;function doOne(a,c){try{compFunc(a)&&found.push(a)}catch(d){}if(!doMult&&found.length>0)return;if(++c<maxLevel&&a.childNodes!=undefined)for(var b=0;b<a.childNodes.length;b++)doOne(a.childNodes[b],c)}}function getClientCoords(a){var b=null;if(a==b)return{x:b,y:b,width:b,height:b};var c=0,d=0;ret={x:0,y:0,width:a.clientWidth,height:a.clientHeight};while(a.offsetParent!=b){ret.x+=a.offsetLeft;ret.y+=a.offsetTop;a=a.offsetParent}return ret}function CPopup(c,C,D,z,g,o,y){var f="block",e=false,d="px",a=this;a.BASE_ZINDEX=8101;if(unsafeWindow.cpopupWins==null)unsafeWindow.cpopupWins={};unsafeWindow.cpopupWins[c]=a;a.stmaxh=g;a.show=A;a.toggleHide=q;a.getTopDiv=r;a.getMainDiv=p;a.getZindex=s;a.setZindex=t;a.setEnableDrag=h;a.getLocation=l;a.setLocation=m;a.focusMe=x;a.unfocusMe=u;a.centerMe=v;a.destroy=w;a.autoHeight=n;a.div=document.createElement("div");a.prefix=c;a.onClose=y;var b=a;a.div.className="CPopup "+c+"_CPopup";a.div.style.background="#fff";a.div.style.zIndex=a.BASE_ZINDEX;a.div.style.display="none";a.div.style.width=z+d;a.div.style.height=g+d;a.div.style.maxHeight=g+d;a.div.style.overflowY="hidden";a.div.style.position="absolute";a.div.style.top=D+d;a.div.style.left=C+d;var B='<TABLE cellspacing=0 width=100% height=100%><TR id="'+c+'_bar" class="CPopupTop"><TD id="'+c+'_top" width=99%></td>      <TD id='+c+'_X align=right valign=middle onmouseover="this.style.cursor=\'pointer\'" style="color: #fff; background: #555; padding-left: 5px; padding-right: 5px; height:15px;">X</td></tr>      <TR><TD valign=top class="CPopMain '+c+'_CPopMain" colspan=2 id="'+c+'_main"></td></tr></table>';document.body.appendChild(a.div);a.div.innerHTML=B;document.getElementById(c+"_X").addEventListener("click",new i(a).handler,e);a.dragger=new CWinDrag(document.getElementById(c+"_bar"),a.div,o);a.div.addEventListener("mousedown",j,e);function n(a){if(a){b.div.style.height="";b.div.style.maxHeight=""}else{b.div.style.height=b.stmaxh;b.div.style.maxHeight=b.stmaxh}}function j(){b.focusMe()}function i(c){var a=c;this.handler=b;function b(){a.show(e);a.onClose!=null&&a.onClose()}}function x(){b.div.style.zIndex=this.BASE_ZINDEX+5;for(k in unsafeWindow.cpopupWins)k!=b.prefix&&unsafeWindow.cpopupWins[k].unfocusMe()}function w(){document.body.removeChild(b.div)}function v(f){if(f==null)var a=getClientCoords(document.body);else var a=getClientCoords(f);var c=(a.width-parseInt(b.div.style.width))/2+a.x,e=(a.height-parseInt(b.div.style.height))/2+a.y;if(c<0)c=0;if(e<0)e=0;b.div.style.left=c+d;b.div.style.top=e+d}function u(){b.div.style.zIndex=""+(this.BASE_ZINDEX-5)}function l(){return{x:parseInt(this.div.style.left),y:parseInt(this.div.style.top)}}function m(a){b.div.style.left=a.x+d;b.div.style.top=a.y+d}function h(a){b.dragger.setEnable(a)}function t(a){this.div.style.zIndex=""+a}function s(){return parseInt(this.div.style.zIndex)}function r(){return document.getElementById(this.prefix+"_top")}function p(){return document.getElementById(this.prefix+"_main")}function A(a){if(a){b.div.style.display=f;b.focusMe()}else b.div.style.display="none";return a}function q(a){return a.div.style.display==f?a.show(e):a.show(true)}}function CWinDrag(h,q,i){var c=",",k="mouseout",j="mousemove",f=false,e=true,b=null,a=this,d=a;a.setEnable=r;a.setBoundRect=l;a.debug=t;a.dispEvent=p;a.lastX=b;a.lastY=b;a.enabled=e;a.moving=f;a.theDiv=q;a.body=document.body;a.ce=h;a.moveHandler=new n(a).handler;a.outHandler=new o(a).handler;a.upHandler=new s(a).handler;a.downHandler=new m(a).handler;a.clickableRect=b;a.boundRect=b;a.bounds=b;a.enabled=f;if(i==b)i=e;a.setEnable(i);function l(){this.boundRect=boundRect;this.bounds=b}function r(a){var b="mousedown";if(a==d.enabled)return;if(a){h.addEventListener(b,d.downHandler,f);d.body.addEventListener("mouseup",d.upHandler,f)}else{h.removeEventListener(b,d.downHandler,f);d.body.removeEventListener("mouseup",d.upHandler,f)}d.enabled=a}function m(d){this.handler=c;var a=d;function c(c){if(a.bounds==b){a.clickableRect=getClientCoords(h);a.bodyRect=getClientCoords(document.body);if(a.boundRect==b)a.boundRect=a.clickableRect;a.bounds={top:10-a.clickableRect.height,bot:a.bodyRect.height-25,left:40-a.clickableRect.width,right:a.bodyRect.width-25}}if(c.button==0&&a.enabled){a.body.addEventListener(j,a.moveHandler,e);a.body.addEventListener(k,a.outHandler,e);a.lastX=c.clientX;a.lastY=c.clientY;a.moving=e}}}function s(c){this.handler=b;var a=c;function b(b){b.button==0&&a.moving&&g(a)}}function g(a){a.body.removeEventListener(j,a.moveHandler,e);a.body.removeEventListener(k,a.outHandler,e);a.moving=f}function o(b){this.handler=a;var c=b;function a(a){a.button==0&&c.moveHandler(a)}}function n(c){this.handler=b;var a=c;function b(d){if(a.enabled&&!a.wentOut){var c=parseInt(a.theDiv.style.top)+d.clientY-a.lastY,b=parseInt(a.theDiv.style.left)+d.clientX-a.lastX;if(c<a.bounds.top){c=a.bounds.top;g(a)}else if(b<a.bounds.left){b=a.bounds.left;g(a)}else if(b>a.bounds.right){b=a.bounds.right;g(a)}else if(c>a.bounds.bot){c=a.bounds.bot;g(a)}a.theDiv.style.top=c+"px";a.theDiv.style.left=b+"px";a.lastX=d.clientX;a.lastY=d.clientY}}}function t(b,a){logit("*************** "+b+" ****************");logit("clientWidth, Height: "+a.clientWidth+c+a.clientHeight);logit("offsetLeft, Top, Width, Height (parent): "+a.offsetLeft+c+a.offsetTop+c+a.offsetWidth+c+a.offsetHeight+" ("+a.offsetParent+")");logit("scrollLeft, Top, Width, Height: "+a.scrollLeft+c+a.scrollTop+c+a.scrollWidth+c+a.scrollHeight)}function p(b,a){logit(b+" Button:"+a.button+" Screen:"+a.screenX+c+a.screenY+" client:"+a.clientX+c+a.clientY+" rTarget: "+a.relatedTarget)}}function inspect(b,e,f,j){var i="function",d=null,c="",a,g;if(f==d)f=0;if(e==d)e=1;if(e<1)return"Inspect Error: Levels number must be > 0";if(b==d)return"ERROR: Object is NULL\n";for(var h="",k=0;k<f;k++)h+="  ";for(property in b)try{a=matTypeof(b[property]);if(j==true&&a==i)c+=h+"("+a+") "+property+"[FUNCTION]\n";else if(a!=i)c+=h+"("+a+") "+property+(b[property]==d?": null":"")+" = "+b[property]+"\n";if((a=="object"||a=="array")&&b[property]!=d&&f+1<e)c+=inspect(b[property],e,f+1,j)}catch(l){if(typeof l=="string")g=l;else if(l.message)g=l.message;else if(l.description)g=l.description;else g="Unknown";c+="(Error) "+property+": "+g+"\n"}c+="\n";return c}Array.prototype.compare=function(b){var c=this;if(c.length!=b.length)return false;for(var a=0;a<b.length;a++){if(c[a].compare)if(!c[a].compare(b[a]))return false;if(c[a]!==b[a])return false}return true};String.prototype.entityTrans={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};String.prototype.htmlEntities=function(){var a=this.toString();for(k in this.entityTrans)a=a.split(k).join(this.entityTrans[k]);return a};String.prototype.stripTags=function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()};function objectName(b){var a=b.toString();return a.substr(7,a.length-8)}function matTypeof(a){return a==undefined?"undefined":typeof a=="object"?!a?"null":a.constructor.toString().indexOf("Array")>=0&&typeof a.splice=="function"?"array":"object":typeof a}function addCommasInt(b){nStr=parseInt(b)+"";var a=/(\d+)(\d{3})/;while(a.test(nStr))nStr=nStr.replace(a,"$1,$2");return nStr}function addCommas(a){a+="";x=a.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var b=/(\d+)(\d{3})/;while(b.test(x1))x1=x1.replace(b,"$1,$2");return x1+x2}function htmlSelector(a,c,b){m=[];m.push("<SELECT");if(b){m.push(" ");m.push(b)}for(k in a){m.push("><OPTION ");k==c&&m.push("SELECTED ");m.push('value="');m.push(k);m.push('">');m.push(a[k]);m.push("</option>")}m.push("</select>");return m.join("")}function unixTime(){return parseInt(+new Date/1e3)+unsafeWindow.g_timeoff}function htmlOptions(a,b){m="";for(k in a)m+='<OPTION value="'+k+'"'+(k==b?" SELECTED":"")+">"+a[k]+"</option>";return m}function getFunctionName(b){var a=/\W*function\s+([\w\$]+)\(/.exec(b);return!a?"":a[1]}function findAllBetween(a,b,c){var e=[],d=0;while((i1=a.indexOf(b,d))>=0&&(i2=a.indexOf(c,i1))>=0){e.push(a.substring(i1+b.length,i2));d=i2+c.length}return e}function strUpTo(a,c){var b=a.indexOf(c);return b>0?a.substr(0,b):a}function timestrShort(a){a=parseInt(a);if(a>86400){var b=[];a/=3600;b.push(parseInt(a/24));b.push("d ");b.push(parseInt(a%24));b.push("h ");return b.join("")}else return timestr(a)}function timestr(d,e){var c=3600;d=parseInt(d);var a=[],b=d;if(b<61)return b+"s";if(b>86400){a.push(parseInt(b/86400));a.push("d ");b%=86400}if(b>c||d>c){a.push(parseInt(b/c));a.push("h ");b%=c}a.push(parseInt(b/60));a.push("m");if(e||d<=c){a.push(" ");a.push(b%60);a.push("s")}return a.join("")}function AjaxRequest(e,a){var d={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":"1.7",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},b=null;if(window.XMLHttpRequest)b=new XMLHttpRequest;else b=new ActiveXObject("Microsoft.XMLHTTP");if(a.method==null||a.method=="")method="GET";else method=a.method.toUpperCase();if(method=="POST")d["Content-type"]="application/x-www-form-urlencoded; charset=UTF-8";else method=="GET"&&addUrlArgs(e,a.parameters);b.onreadystatechange=function(){if(b.readyState==4){if(b.status>=200&&b.status<305)if(a.onSuccess)a.onSuccess(b);else if(a.onFailure)a.onFailure(b)}else if(a.onChange)a.onChange(b)};b.open(method,e,true);for(var c in d)b.setRequestHeader(c,d[c]);if(matTypeof(a.requestHeaders)=="object")for(var c in a.requestHeaders)b.setRequestHeader(c,a.requestHeaders[c]);if(method=="POST"){var f=[];for(c in a.parameters)f.push(c+"="+a.parameters[c]);b.send(f.join("&"))}else b.send()}function MyAjaxRequest(url,o,noRetry){var opts=unsafeWindow.Object.clone(o),wasSuccess=o.onSuccess,wasFailure=o.onFailure,retry=0,delay=5,noRetry=noRetry===true?true:false;opts.onSuccess=mySuccess;opts.onFailure=myFailure;new AjaxRequest(url,opts);return;function myRetry(){++retry;new AjaxRequest(url,opts);delay=delay*1.25}function myFailure(){var a={};a.ok=false;a.errorMsg="AJAX Communication Failure";wasFailure(a)}function mySuccess(msg){var rslt=eval("("+msg.responseText+")"),x;if(rslt.ok){rslt.errorMsg=null;rslt.updateSeed&&unsafeWindow.update_seed(rslt.updateSeed);wasSuccess(rslt);return}rslt.errorMsg=rslt.error_code;!(!noRetry&&(rslt.error_code==0||rslt.error_code==8||rslt.error_code==1||rslt.error_code==3))&&wasSuccess(rslt)}}function cityStatusString(a){return a==4?"Vacances":a==3?"Truce":a==2?"Beg Protection":"Normal"}function officerId2String(a){return a==null?"":a==3?"Officer":a==2?"Vice Chance":a==1?"Chancellor":""}var WINLOG_MAX_ENTRIES=1e3,WinLog={state:null,win:null,eOut:null,lastE:null,enabled:true,reverse:true,busy:false,isOpening:false,open:function(){var b=false,d="wlRev",c=null,a=WinLog;function f(){var a=WinLog;a.lastE=c;a.eOut.innerHTML=""}function e(){var a=WinLog;if(a.busy)return;a.busy=true;if(a.reverse){a.win.document.getElementById(d).value="Top";a.reverse=b}else{a.win.document.getElementById(d).value="Bottom";a.reverse=true}var c=a.eOut.childNodes.length;if(c<2)return;for(i=c-2;i>=0;i--)a.eOut.appendChild(a.eOut.childNodes[i]);a.busy=b}if(!a.win||a.win.closed){a.isOpening=true;a.win=window.open("","uwtrace","top=30,left=0,width=900,height=700,scrollbars=no,location=no,menubar=no,directories=no,status=no");a.isOpening=b;a.state=c}if(a.state==c){a.win.document.body.innerHTML='<STYLE>pre{margin:0px} hr{margin:3px; height:1px; border:0px; color:#cee; background-color:#cee}</style>        <BODY style="margin:0px; padding:0px; border:none">        <DIV id=winlogtop style="background-color:#d0d0d0; margin:0px; padding:0px; border:1px solid">        <INPUT id=wlClear type=submit value="Clear"> &nbsp; <INPUT id=wlRev type=submit value="Bottom"></div>        <DIV id=wlOut style="overflow-y:auto; height:100%; max-height:100%"></div></body>';a.win.document.getElementById("wlClear").addEventListener("click",f,b);a.win.document.getElementById(d).addEventListener("click",e,b);a.eOut=a.win.document.getElementById("wlOut");a.lastE=c;a.state=1}},writeText:function(a){WinLog.write(a.htmlEntities())},write:function(g){var a=WinLog;if(!a.enabled||a.isOpening)return;a.open();var c=document.createElement("pre"),e=new Date,b=[],d=e.getMilliseconds();b.push(e.toTimeString().substring(0,8));b.push(".");d<100&&b.push("0");d<10&&b.push("0");b.push(d);b.push(": ");b.push(g);c.innerHTML=b.join("");if(a.reverse){if(a.lastE==null){a.eOut.appendChild(c);a.lastE=c}else a.eOut.insertBefore(c,a.lastE);var f=document.createElement("hr");a.eOut.insertBefore(f,c);a.lastE=f}else{a.eOut.appendChild(c);a.eOut.appendChild(document.createElement("hr"))}}};function ById(a){return document.getElementById(a)}function addCommasWhole(a){a+="";x=a.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var b=/(\d+)(\d{3})/;while(b.test(x1))x1=x1.replace(b,"$1,$2");return x1}function SelectAll(a){document.getElementById(a).focus();document.getElementById(a).select()}function HandleChatPane(){var g=".//a[contains(@onclick,'Chat.helpAlliance')]",a=null,l=GetDisplayName(),f=document.getElementById("mod_comm_list2");if(f){var d=document.evaluate(".//div[contains(@class,'chatwrap')]",f,a,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,a);if(d)for(var e=0;e<d.snapshotLength;e++){thisPost=d.snapshotItem(e);if(1){var h=document.evaluate('.//*[@class="nm"]',thisPost,a,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,a);if(Options.HelpRequest)if(h.snapshotItem(0)){var k=h.snapshotItem(0).innerHTML;if(k!=l){var b=document.evaluate(g,thisPost,a,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,a);if(b)for(var c=0;c<b.snapshotLength;c++){thisLink=b.snapshotItem(c);var j=thisLink.getAttribute("clicked");if(!j){thisLink.setAttribute("clicked","true");var q=/(Chat.helpAlliance\(.*\);)/,i=q.exec(thisLink.getAttribute("onclick"));if(i!=a){onclickCode=i[0];if(1){DoUnsafeWindow(onclickCode);AddToCommandHistory(onclickCode,"alliance_help")}}}}}}}if(Options.DeleteRequest){var b=document.evaluate(g,thisPost,a,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,a);if(b)for(var c=0;c<b.snapshotLength;c++){thisLink=b.snapshotItem(c);thisLink.parentNode.parentNode.parentNode.parentNode.removeChild(thisLink.parentNode.parentNode.parentNode)}}if(Options.DeleteRequest){var m=/of 5 players helping /i,n=/in this project./i,o=/Unable to provide help for now/i,p=/5 people have /i;(thisPost.innerHTML.match(m)||thisPost.innerHTML.match(n)||thisPost.innerHTML.match(o)||thisPost.innerHTML.match(p))&&thisPost.parentNode.removeChild(thisPost)}}}}function GetCommandHistory(c){if(!c)var c="default";var b="";if(b=="")b="{}";var a=JSON2.parse(b);if(!a.items)a.items=Array();return a}function AddToCommandHistory(e,d,b){if(!e)return false;if(!d)var d="default";if(!b)var b=20;var c=GetCommandHistory(d),a=c.items;a.push(e);if(a.length>b)a=a.slice(a.length-b);c.items=a}function FindInCommandHistory(c,b){if(!c)return false;if(!b)var b="default";for(var e=GetCommandHistory(b),d=e.items,a=0;a<d.length;a++)if(d[a]==c)return true;return false}function DoUnsafeWindow(func,execute_by_embed){if(this.isChrome||execute_by_embed){var scr=document.createElement("script");scr.innerHTML=func;document.body.appendChild(scr)}else try{eval("unsafeWindow."+func)}catch(error){this.Log("A javascript error has occurred when executing a function via DoUnsafeWindow. Error description: "+error.description)}}function GetDisplayName(){var a=document.getElementById("topnavDisplayName");if(a)a=a.innerHTML;else a=null;return a}function translate(a){var c=" translate by ",b=a;if(navigator.language=="it"||navigator.language=="it-IT"||navigator.language=="Italiano  [it]")if(translateITArray[a]!=undefined)b=translateITArray[a];else logit(a+" tradotto by Tiestoale");else if(navigator.language=="fr"||navigator.language=="fr-Fr"||navigator.language=="fr-br"||navigator.language=="br")if(translateFRArray[a]!=undefined)b=translateFRArray[a];else logit(a+c);else if(navigator.language=="es"||navigator.language=="es-Es")if(translateESArray[a]!=undefined)b=translateESArray[a];else logit(a+c);return b}String.prototype.StripQuotes=function(){return this.replace(/"/g,"")};ptStartup();
