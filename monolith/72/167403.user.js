// ==UserScript==
// @name	Timesofmalta.com Paywall Disabler
// @namespace	TOM
// @version	1.0.2
// @description	Disables the paywall on timesofmalta.com for both local and int'l users. Requires the AdBlock plugin to block http://www.timesofmalta.com/min/d.js?v=175 first.
// @match	*://*.timesofmalta.com/*
// ==/UserScript==
// @history   13-may-2013 Release

(function(){
    
 	replaceBlockedScript();
    
})();

/*
 *	Inserts the contents of http://www.timesofmalta.com/min/d.js?v=175, sans the paywall script
 */
function replaceBlockedScript() {
    
    var script = document.createElement('script');
    script.textContent = "(function(){" +
			'var swfobject=function(){var aq="undefined",aD="object",ab="Shockwave Flash",X="ShockwaveFlash.ShockwaveFlash",aE="application/x-shockwave-flash",ac="SWFObjectExprInst",ax="onreadystatechange",af=window,aL=document,aB=navigator,aa=false,Z=[aN],aG=[],ag=[],al=[],aJ,ad,ap,at,ak=false,aU=false,aH,an,aI=true,ah=function(){var a=typeof aL.getElementById!=aq&&typeof aL.getElementsByTagName!=aq&&typeof aL.createElement!=aq,e=aB.userAgent.toLowerCase(),c=aB.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(e),j=c?/mac/.test(c):/mac/.test(e),g=/webkit/.test(e)?parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,d=!+"\v1",f=[0,0,0],k=null;if(typeof aB.plugins!=aq&&typeof aB.plugins[ab]==aD){k=aB.plugins[ab].description;if(k&&!(typeof aB.mimeTypes!=aq&&aB.mimeTypes[aE]&&!aB.mimeTypes[aE].enabledPlugin)){aa=true;d=false;k=k.replace(/^.*\s+(\S+\s+\S+$)/,"$1");f[0]=parseInt(k.replace(/^(.*)\..*$/,"$1"),10);f[1]=parseInt(k.replace(/^.*\.(.*)\s.*$/,"$1"),10);f[2]=/[a-zA-Z]/.test(k)?parseInt(k.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof af.ActiveXObject!=aq){try{var i=new ActiveXObject(X);if(i){k=i.GetVariable("$version");if(k){d=true;k=k.split(" ")[1].split(",");f=[parseInt(k[0],10),parseInt(k[1],10),parseInt(k[2],10)]}}}catch(b){}}}return{w3:a,pv:f,wk:g,ie:d,win:h,mac:j}}(),aK=function(){if(!ah.w3){return}if((typeof aL.readyState!=aq&&aL.readyState=="complete")||(typeof aL.readyState==aq&&(aL.getElementsByTagName("body")[0]||aL.body))){aP()}if(!ak){if(typeof aL.addEventListener!=aq){aL.addEventListener("DOMContentLoaded",aP,false)}if(ah.ie&&ah.win){aL.attachEvent(ax,function(){if(aL.readyState=="complete"){aL.detachEvent(ax,arguments.callee);aP()}});if(af==top){(function(){if(ak){return}try{aL.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}aP()})()}}if(ah.wk){(function(){if(ak){return}if(!/loaded|complete/.test(aL.readyState)){setTimeout(arguments.callee,0);return}aP()})()}aC(aP)}}();function aP(){if(ak){return}try{var b=aL.getElementsByTagName("body")[0].appendChild(ar("span"));b.parentNode.removeChild(b)}catch(a){return}ak=true;var d=Z.length;for(var c=0;c<d;c++){Z[c]()}}function aj(a){if(ak){a()}else{Z[Z.length]=a}}function aC(a){if(typeof af.addEventListener!=aq){af.addEventListener("load",a,false)}else{if(typeof aL.addEventListener!=aq){aL.addEventListener("load",a,false)}else{if(typeof af.attachEvent!=aq){aM(af,"onload",a)}else{if(typeof af.onload=="function"){var b=af.onload;af.onload=function(){b();a()}}else{af.onload=a}}}}}function aN(){if(aa){Y()}else{am()}}function Y(){var d=aL.getElementsByTagName("body")[0];var b=ar(aD);b.setAttribute("type",aE);var a=d.appendChild(b);if(a){var c=0;(function(){if(typeof a.GetVariable!=aq){var e=a.GetVariable("$version");if(e){e=e.split(" ")[1].split(",");ah.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)]}}else{if(c<10){c++;setTimeout(arguments.callee,10);return}}d.removeChild(b);a=null;am()})()}else{am()}}function am(){var g=aG.length;if(g>0){for(var h=0;h<g;h++){var c=aG[h].id;var l=aG[h].callbackFn;var a={success:false,id:c};if(ah.pv[0]>0){var i=aS(c);if(i){if(ao(aG[h].swfVersion)&&!(ah.wk&&ah.wk<312)){ay(c,true);if(l){a.success=true;a.ref=av(c);l(a)}}else{if(aG[h].expressInstall&&au()){var e={};e.data=aG[h].expressInstall;e.width=i.getAttribute("width")||"0";e.height=i.getAttribute("height")||"0";if(i.getAttribute("class")){e.styleclass=i.getAttribute("class")}if(i.getAttribute("align")){e.align=i.getAttribute("align")}var f={};var d=i.getElementsByTagName("param");var k=d.length;for(var j=0;j<k;j++){if(d[j].getAttribute("name").toLowerCase()!="movie"){f[d[j].getAttribute("name")]=d[j].getAttribute("value")}}ae(e,f,c,l)}else{aF(i);if(l){l(a)}}}}}else{ay(c,true);if(l){var b=av(c);if(b&&typeof b.SetVariable!=aq){a.success=true;a.ref=b}l(a)}}}}}function av(b){var d=null;var c=aS(b);if(c&&c.nodeName=="OBJECT"){if(typeof c.SetVariable!=aq){d=c}else{var a=c.getElementsByTagName(aD)[0];if(a){d=a}}}return d}function au(){return !aU&&ao("6.0.65")&&(ah.win||ah.mac)&&!(ah.wk&&ah.wk<312)}function ae(f,d,h,e){aU=true;ap=e||null;at={success:false,id:h};var a=aS(h);if(a){if(a.nodeName=="OBJECT"){aJ=aO(a);ad=null}else{aJ=a;ad=h}f.id=ac;if(typeof f.width==aq||(!/%$/.test(f.width)&&parseInt(f.width,10)<310)){f.width="310"}if(typeof f.height==aq||(!/%$/.test(f.height)&&parseInt(f.height,10)<137)){f.height="137"}aL.title=aL.title.slice(0,47)+" - Flash Player Installation";var b=ah.ie&&ah.win?"ActiveX":"PlugIn",c="MMredirectURL="+af.location.toString().replace(/&/g,"%26")+"&MMplayerType="+b+"&MMdoctitle="+aL.title;if(typeof d.flashvars!=aq){d.flashvars+="&"+c}else{d.flashvars=c}if(ah.ie&&ah.win&&a.readyState!=4){var g=ar("div");h+="SWFObjectNew";g.setAttribute("id",h);a.parentNode.insertBefore(g,a);a.style.display="none";(function(){if(a.readyState==4){a.parentNode.removeChild(a)}else{setTimeout(arguments.callee,10)}})()}aA(f,d,h)}}function aF(a){if(ah.ie&&ah.win&&a.readyState!=4){var b=ar("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(aO(a),b);a.style.display="none";(function(){if(a.readyState==4){a.parentNode.removeChild(a)}else{setTimeout(arguments.callee,10)}})()}else{a.parentNode.replaceChild(aO(a),a)}}function aO(b){var d=ar("div");if(ah.win&&ah.ie){d.innerHTML=b.innerHTML}else{var e=b.getElementsByTagName(aD)[0];if(e){var a=e.childNodes;if(a){var f=a.length;for(var c=0;c<f;c++){if(!(a[c].nodeType==1&&a[c].nodeName=="PARAM")&&!(a[c].nodeType==8)){d.appendChild(a[c].cloneNode(true))}}}}}return d}function aA(e,g,c){var d,a=aS(c);if(ah.wk&&ah.wk<312){return d}if(a){if(typeof e.id==aq){e.id=c}if(ah.ie&&ah.win){var f="";for(var i in e){if(e[i]!=Object.prototype[i]){if(i.toLowerCase()=="data"){g.movie=e[i]}else{if(i.toLowerCase()=="styleclass"){f+=\' class="\'+e[i]+\'"\'}else{if(i.toLowerCase()!="classid"){f+=" "+i+\'="\'+e[i]+\'"\'}}}}}var h="";for(var j in g){if(g[j]!=Object.prototype[j]){h+=\'<param name="\'+j+\'" value="\'+g[j]+\'" />\'}}a.outerHTML=\'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"\'+f+">"+h+"</object>";ag[ag.length]=e.id;d=aS(e.id)}else{var b=ar(aD);b.setAttribute("type",aE);for(var k in e){if(e[k]!=Object.prototype[k]){if(k.toLowerCase()=="styleclass"){b.setAttribute("class",e[k])}else{if(k.toLowerCase()!="classid"){b.setAttribute(k,e[k])}}}}for(var l in g){if(g[l]!=Object.prototype[l]&&l.toLowerCase()!="movie"){aQ(b,l,g[l])}}a.parentNode.replaceChild(b,a);d=b}}return d}function aQ(b,d,c){var a=ar("param");a.setAttribute("name",d);a.setAttribute("value",c);b.appendChild(a)}function aw(a){var b=aS(a);if(b&&b.nodeName=="OBJECT"){if(ah.ie&&ah.win){b.style.display="none";(function(){if(b.readyState==4){aT(a)}else{setTimeout(arguments.callee,10)}})()}else{b.parentNode.removeChild(b)}}}function aT(a){var b=aS(a);if(b){for(var c in b){if(typeof b[c]=="function"){b[c]=null}}b.parentNode.removeChild(b)}}function aS(a){var c=null;try{c=aL.getElementById(a)}catch(b){}return c}function ar(a){return aL.createElement(a)}function aM(a,c,b){a.attachEvent(c,b);al[al.length]=[a,c,b]}function ao(a){var b=ah.pv,c=a.split(".");c[0]=parseInt(c[0],10);c[1]=parseInt(c[1],10)||0;c[2]=parseInt(c[2],10)||0;return(b[0]>c[0]||(b[0]==c[0]&&b[1]>c[1])||(b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]))?true:false}function az(b,f,a,c){if(ah.ie&&ah.mac){return}var e=aL.getElementsByTagName("head")[0];if(!e){return}var g=(a&&typeof a=="string")?a:"screen";if(c){aH=null;an=null}if(!aH||an!=g){var d=ar("style");d.setAttribute("type","text/css");d.setAttribute("media",g);aH=e.appendChild(d);if(ah.ie&&ah.win&&typeof aL.styleSheets!=aq&&aL.styleSheets.length>0){aH=aL.styleSheets[aL.styleSheets.length-1]}an=g}if(ah.ie&&ah.win){if(aH&&typeof aH.addRule==aD){aH.addRule(b,f)}}else{if(aH&&typeof aL.createTextNode!=aq){aH.appendChild(aL.createTextNode(b+" {"+f+"}"))}}}function ay(a,c){if(!aI){return}var b=c?"visible":"hidden";if(ak&&aS(a)){aS(a).style.visibility=b}else{az("#"+a,"visibility:"+b)}}function ai(b){var a=/[\\\"<>\.;]/;var c=a.exec(b)!=null;return c&&typeof encodeURIComponent!=aq?encodeURIComponent(b):b}var aR=function(){if(ah.ie&&ah.win){window.attachEvent("onunload",function(){var a=al.length;for(var b=0;b<a;b++){al[b][0].detachEvent(al[b][1],al[b][2])}var d=ag.length;for(var c=0;c<d;c++){aw(ag[c])}for(var e in ah){ah[e]=null}ah=null;for(var f in swfobject){swfobject[f]=null}swfobject=null})}}();return{registerObject:function(a,e,c,b){if(ah.w3&&a&&e){var d={};d.id=a;d.swfVersion=e;d.expressInstall=c;d.callbackFn=b;aG[aG.length]=d;ay(a,false)}else{if(b){b({success:false,id:a})}}},getObjectById:function(a){if(ah.w3){return av(a)}},embedSWF:function(k,e,h,f,c,a,b,i,g,j){var d={success:false,id:e};if(ah.w3&&!(ah.wk&&ah.wk<312)&&k&&e&&h&&f&&c){ay(e,false);aj(function(){h+="";f+="";var q={};if(g&&typeof g===aD){for(var o in g){q[o]=g[o]}}q.data=k;q.width=h;q.height=f;var n={};if(i&&typeof i===aD){for(var p in i){n[p]=i[p]}}if(b&&typeof b===aD){for(var l in b){if(typeof n.flashvars!=aq){n.flashvars+="&"+l+"="+b[l]}else{n.flashvars=l+"="+b[l]}}}if(ao(c)){var m=aA(q,n,e);if(q.id==e){ay(e,true)}d.success=true;d.ref=m}else{if(a&&au()){q.data=a;ae(q,n,e,j);return}else{ay(e,true)}}if(j){j(d)}})}else{if(j){j(d)}}},switchOffAutoHideShow:function(){aI=false},ua:ah,getFlashPlayerVersion:function(){return{major:ah.pv[0],minor:ah.pv[1],release:ah.pv[2]}},hasFlashPlayerVersion:ao,createSWF:function(a,b,c){if(ah.w3){return aA(a,b,c)}else{return undefined}},showExpressInstall:function(b,a,d,c){if(ah.w3&&au()){ae(b,a,d,c)}},removeSWF:function(a){if(ah.w3){aw(a)}},createCSS:function(b,a,c,d){if(ah.w3){az(b,a,c,d)}},addDomLoadEvent:aj,addLoadEvent:aC,getQueryParamValue:function(b){var a=aL.location.search||aL.location.hash;if(a){if(/\?/.test(a)){a=a.split("?")[1]}if(b==null){return ai(a)}var c=a.split("&");for(var d=0;d<c.length;d++){if(c[d].substring(0,c[d].indexOf("="))==b){return ai(c[d].substring((c[d].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(aU){var a=aS(ac);if(a&&aJ){a.parentNode.replaceChild(aJ,a);if(ad){ay(ad,true);if(ah.ie&&ah.win){aJ.style.display="block"}}if(ap){ap(at)}}aU=false}}}}();
			(function(g){g.fn.adGallery=function(j){var l={loader_image:"loader.gif",start_at_index:0,description_wrapper:false,thumb_opacity:0.7,animate_first_image:false,animation_speed:400,width:false,height:false,display_next_and_prev:true,display_back_and_forward:true,scroll_jump:0,slideshow:{enable:true,autostart:false,speed:5000,start_label:"Start",stop_label:"Stop",stop_on_scroll:true,countdown_prefix:"(",countdown_sufix:")",onStart:false,onStop:false},effect:"slide-hori",enable_keyboard_move:true,cycle:true,callbacks:{init:false,afterImageVisible:false,beforeImageVisible:false}};var k=g.extend(false,l,j);if(j&&j.slideshow){k.slideshow=g.extend(false,l.slideshow,j.slideshow)}if(!k.slideshow.enable){k.slideshow.autostart=false}var i=[];g(this).each(function(){var m=new c(this,k);i[i.length]=m});return i};function f(j,k,l){var m=parseInt(j.css("top"),10);if(k=="left"){var i="-"+this.image_wrapper_height+"px";j.css("top",this.image_wrapper_height+"px")}else{var i=this.image_wrapper_height+"px";j.css("top","-"+this.image_wrapper_height+"px")}if(l){l.css("bottom","-"+l[0].offsetHeight+"px");l.animate({bottom:0},this.settings.animation_speed*2)}if(this.current_description){this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},this.settings.animation_speed*2)}return{old_image:{top:i},new_image:{top:m}}}function e(j,k,m){var l=parseInt(j.css("left"),10);if(k=="left"){var i="-"+this.image_wrapper_width+"px";j.css("left",this.image_wrapper_width+"px")}else{var i=this.image_wrapper_width+"px";j.css("left","-"+this.image_wrapper_width+"px")}if(m){m.css("bottom","-"+m[0].offsetHeight+"px");m.animate({bottom:0},this.settings.animation_speed*2)}if(this.current_description){this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},this.settings.animation_speed*2)}return{old_image:{left:i},new_image:{left:l}}}function d(k,l,n){var j=k.width();var i=k.height();var m=parseInt(k.css("left"),10);var o=parseInt(k.css("top"),10);k.css({width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2});return{old_image:{width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2},new_image:{width:j,height:i,top:o,left:m}}}function b(i,j,k){i.css("opacity",0);return{old_image:{opacity:0},new_image:{opacity:1}}}function h(i,j,k){i.css("opacity",0);return{old_image:{opacity:0},new_image:{opacity:1},speed:0}}function c(j,i){this.init(j,i)}c.prototype={wrapper:false,image_wrapper:false,gallery_info:false,nav:false,loader:false,preloads:false,thumbs_wrapper:false,scroll_back:false,scroll_forward:false,next_link:false,prev_link:false,slideshow:false,image_wrapper_width:0,image_wrapper_height:0,current_index:0,current_image:false,current_description:false,nav_display_width:0,settings:false,images:false,in_transition:false,animations:false,init:function(m,l){var k=this;this.wrapper=g(m);this.settings=l;this.setupElements();this.setupAnimations();if(this.settings.width){this.image_wrapper_width=this.settings.width;this.image_wrapper.width(this.settings.width);this.wrapper.width(this.settings.width)}else{this.image_wrapper_width=this.image_wrapper.width()}if(this.settings.height){this.image_wrapper_height=this.settings.height;this.image_wrapper.height(this.settings.height)}else{this.image_wrapper_height=this.image_wrapper.height()}this.nav_display_width=this.nav.width();this.current_index=0;this.current_image=false;this.current_description=false;this.in_transition=false;this.findImages();if(this.settings.display_next_and_prev){this.initNextAndPrev()}var i=function(n){return k.nextImage(n)};this.slideshow=new a(i,this.settings.slideshow);this.controls.append(this.slideshow.create());if(this.settings.slideshow.enable){this.slideshow.enable()}else{this.slideshow.disable()}if(this.settings.display_back_and_forward){this.initBackAndForward()}if(this.settings.enable_keyboard_move){this.initKeyEvents()}var j=parseInt(this.settings.start_at_index,10);if(window.location.hash&&window.location.hash.indexOf("#ad-image")===0){j=window.location.hash.replace(/[^0-9]+/g,"");if((j*1)!=j){j=this.settings.start_at_index}}this.loading(true);this.showImage(j,function(){if(k.settings.slideshow.autostart){k.preloadImage(j+1);k.slideshow.start()}});this.fireCallback(this.settings.callbacks.init)},setupAnimations:function(){this.animations={"slide-vert":f,"slide-hori":e,resize:d,fade:b,none:h}},setupElements:function(){this.controls=this.wrapper.find(".ad-controls");this.gallery_info=g(\'<p class="ad-info"></p>\');this.controls.append(this.gallery_info);this.image_wrapper=this.wrapper.find(".ad-image-wrapper");this.image_wrapper.empty();this.nav=this.wrapper.find(".ad-nav");this.thumbs_wrapper=this.nav.find(".ad-thumbs");this.preloads=g(\'<div class="ad-preloads"></div>\');this.loader=g(\'<img class="ad-loader" src="\'+this.settings.loader_image+\'">\');this.image_wrapper.append(this.loader);this.loader.hide();g(document.body).append(this.preloads)},loading:function(i){if(i){this.loader.show()}else{this.loader.hide()}},addAnimation:function(i,j){if(g.isFunction(j)){this.animations[i]=j}},findImages:function(){var n=this;this.images=[];var m=0;var l=0;var k=this.thumbs_wrapper.find("a");var j=k.length;if(this.settings.thumb_opacity<1){k.find("img").css("opacity",this.settings.thumb_opacity)}k.each(function(p){var r=g(this);var q=r.attr("href");var o=r.find("img");if(!n.isImageLoaded(o[0])){o.load(function(){m+=this.parentNode.parentNode.offsetWidth;l++})}else{m+=o[0].parentNode.parentNode.offsetWidth;l++}r.addClass("ad-thumb"+p);r.click(function(){n.showImage(p);n.slideshow.stop();return false}).hover(function(){if(!g(this).is(".ad-active")&&n.settings.thumb_opacity<1){g(this).find("img").fadeTo(300,1)}n.preloadImage(p)},function(){if(!g(this).is(".ad-active")&&n.settings.thumb_opacity<1){g(this).find("img").fadeTo(300,n.settings.thumb_opacity)}});var r=false;if(o.data("ad-link")){r=o.data("ad-link")}else{if(o.attr("longdesc")&&o.attr("longdesc").length){r=o.attr("longdesc")}}var t=false;if(o.data("ad-desc")){t=o.data("ad-desc")}else{if(o.attr("alt")&&o.attr("alt").length){t=o.attr("alt")}}var s=false;if(o.data("ad-title")){s=o.data("ad-title")}else{if(o.attr("title")&&o.attr("title").length){s=o.attr("title")}}n.images[p]={thumb:o.attr("src"),image:q,error:false,preloaded:false,desc:t,title:s,size:false,link:r}});var i=setInterval(function(){if(j==l){m-=100;var q=n.nav.find(".ad-thumb-list");q.css("width",m+"px");var p=1;var o=q.height();while(p<201){q.css("width",(m+p)+"px");if(o!=q.height()){break}o=q.height();p++}clearInterval(i)}},100)},initKeyEvents:function(){var i=this;g(document).keydown(function(j){if(j.keyCode==39){i.nextImage();i.slideshow.stop()}else{if(j.keyCode==37){i.prevImage();i.slideshow.stop()}}})},initNextAndPrev:function(){this.next_link=g(\'<div class="ad-next"><div class="ad-next-image"></div></div>\');this.prev_link=g(\'<div class="ad-prev"><div class="ad-prev-image"></div></div>\');this.image_wrapper.append(this.next_link);this.image_wrapper.append(this.prev_link);var i=this;this.prev_link.add(this.next_link).mouseover(function(j){g(this).css("height",i.image_wrapper_height);g(this).find("div").show()}).mouseout(function(j){g(this).find("div").hide()}).click(function(){if(g(this).is(".ad-next")){i.nextImage();i.slideshow.stop()}else{i.prevImage();i.slideshow.stop()}}).find("div").css("opacity",0.7)},initBackAndForward:function(){var k=this;this.scroll_forward=g(\'<div class="ad-forward"></div>\');this.scroll_back=g(\'<div class="ad-back"></div>\');this.nav.append(this.scroll_forward);this.nav.prepend(this.scroll_back);var j=0;var i=false;g(this.scroll_back).add(this.scroll_forward).click(function(){var l=k.nav_display_width-50;if(k.settings.scroll_jump>0){var l=k.settings.scroll_jump}if(g(this).is(".ad-forward")){var m=k.thumbs_wrapper.scrollLeft()+l}else{var m=k.thumbs_wrapper.scrollLeft()-l}if(k.settings.slideshow.stop_on_scroll){k.slideshow.stop()}k.thumbs_wrapper.animate({scrollLeft:m+"px"});return false}).css("opacity",0.6).hover(function(){var l="left";if(g(this).is(".ad-forward")){l="right"}i=setInterval(function(){j++;if(j>30&&k.settings.slideshow.stop_on_scroll){k.slideshow.stop()}var m=k.thumbs_wrapper.scrollLeft()+1;if(l=="left"){m=k.thumbs_wrapper.scrollLeft()-1}k.thumbs_wrapper.scrollLeft(m)},10);g(this).css("opacity",1)},function(){j=0;clearInterval(i);g(this).css("opacity",0.6)})},_afterShow:function(){this.gallery_info.html((this.current_index+1)+" / "+this.images.length);if(!this.settings.cycle){this.prev_link.show().css("height",this.image_wrapper_height);this.next_link.show().css("height",this.image_wrapper_height);if(this.current_index==(this.images.length-1)){this.next_link.hide()}if(this.current_index==0){this.prev_link.hide()}}this.fireCallback(this.settings.callbacks.afterImageVisible)},_getContainedImageSize:function(j,i){if(i>this.image_wrapper_height){var k=j/i;i=this.image_wrapper_height;j=this.image_wrapper_height*k}if(j>this.image_wrapper_width){var k=i/j;j=this.image_wrapper_width;i=this.image_wrapper_width*k}return{width:j,height:i}},_centerImage:function(l,j,i){l.css("top","0px");if(i<this.image_wrapper_height){var k=this.image_wrapper_height-i;l.css("top",(k/2)+"px")}l.css("left","0px");if(j<this.image_wrapper_width){var k=this.image_wrapper_width-j;l.css("left",(k/2)+"px")}},_getDescription:function(i){var k=false;if(i.desc.length||i.title.length){var j="";if(i.title.length){j=\'<strong class="ad-description-title">\'+i.title+"</strong>"}var k="";if(i.desc.length){k="<span>"+i.desc+"</span>"}k=g(\'<p class="ad-image-description">\'+j+k+"</p>")}return k},showImage:function(i,l){if(this.images[i]&&!this.in_transition){var j=this;var k=this.images[i];this.in_transition=true;if(!k.preloaded){this.loading(true);this.preloadImage(i,function(){j.loading(false);j._showWhenLoaded(i,l)})}else{this._showWhenLoaded(i,l)}}},_showWhenLoaded:function(q,w){if(this.images[q]){var j=this;var l=this.images[q];var m=g(document.createElement("div")).addClass("ad-image");var o=g(new Image()).attr("src",l.image);if(l.link){var t=g(\'<a href="\'+l.link+\'" target="_blank"></a>\');t.append(o);m.append(t)}else{m.append(o)}this.image_wrapper.prepend(m);var x=this._getContainedImageSize(l.size.width,l.size.height);o.attr("width",x.width);o.attr("height",x.height);m.css({width:x.width+"px",height:x.height+"px"});this._centerImage(m,x.width,x.height);var p=this._getDescription(l,m);if(p){if(!this.settings.description_wrapper){m.append(p);var i=x.width-parseInt(p.css("padding-left"),10)-parseInt(p.css("padding-right"),10);p.css("width",i+"px")}else{this.settings.description_wrapper.append(p)}}this.highLightThumb(this.nav.find(".ad-thumb"+q));var u="right";if(this.current_index<q){u="left"}this.fireCallback(this.settings.callbacks.beforeImageVisible);if(this.current_image||this.settings.animate_first_image){var v=this.settings.animation_speed;var s="swing";var n=this.animations[this.settings.effect].call(this,m,u,p);if(typeof n.speed!="undefined"){v=n.speed}if(typeof n.easing!="undefined"){s=n.easing}if(this.current_image){var k=this.current_image;var r=this.current_description;k.animate(n.old_image,v,s,function(){k.remove();if(r){r.remove()}})}m.animate(n.new_image,v,s,function(){j.current_index=q;j.current_image=m;j.current_description=p;j.in_transition=false;j._afterShow();j.fireCallback(w)})}else{this.current_index=q;this.current_image=m;j.current_description=p;this.in_transition=false;j._afterShow();this.fireCallback(w)}}},nextIndex:function(){if(this.current_index==(this.images.length-1)){if(!this.settings.cycle){return false}var i=0}else{var i=this.current_index+1}return i},nextImage:function(j){var i=this.nextIndex();if(i===false){return false}this.preloadImage(i+1);this.showImage(i,j);return true},prevIndex:function(){if(this.current_index==0){if(!this.settings.cycle){return false}var i=this.images.length-1}else{var i=this.current_index-1}return i},prevImage:function(j){var i=this.prevIndex();if(i===false){return false}this.preloadImage(i-1);this.showImage(i,j);return true},preloadAll:function(){var k=this;var j=0;function l(){if(j<k.images.length){j++;k.preloadImage(j,l)}}k.preloadImage(j,l)},preloadImage:function(j,m){if(this.images[j]){var l=this.images[j];if(!this.images[j].preloaded){var i=g(new Image());i.attr("src",l.image);if(!this.isImageLoaded(i[0])){this.preloads.append(i);var k=this;i.load(function(){l.preloaded=true;l.size={width:this.width,height:this.height};k.fireCallback(m)}).error(function(){l.error=true;l.preloaded=false;l.size=false})}else{l.preloaded=true;l.size={width:i[0].width,height:i[0].height};this.fireCallback(m)}}else{this.fireCallback(m)}}},isImageLoaded:function(i){if(typeof i.complete!="undefined"&&!i.complete){return false}if(typeof i.naturalWidth!="undefined"&&i.naturalWidth==0){return false}return true},highLightThumb:function(i){this.thumbs_wrapper.find(".ad-active").removeClass("ad-active");i.addClass("ad-active");if(this.settings.thumb_opacity<1){this.thumbs_wrapper.find("a:not(.ad-active) img").fadeTo(300,this.settings.thumb_opacity);i.find("img").fadeTo(300,1)}var j=i[0].parentNode.offsetLeft;j-=(this.nav_display_width/2)-(i[0].offsetWidth/2);this.thumbs_wrapper.animate({scrollLeft:j+"px"})},fireCallback:function(i){if(g.isFunction(i)){i.call(this)}}};function a(i,j){this.init(i,j)}a.prototype={start_link:false,stop_link:false,countdown:false,controls:false,settings:false,nextimage_callback:false,enabled:false,running:false,countdown_interval:false,init:function(i,k){var j=this;this.nextimage_callback=i;this.settings=k},create:function(){this.start_link=g(\'<span class="ad-slideshow-start">\'+this.settings.start_label+"</span>");this.stop_link=g(\'<span class="ad-slideshow-stop">\'+this.settings.stop_label+"</span>");this.countdown=g(\'<span class="ad-slideshow-countdown"></span>\');this.controls=g(\'<div class="ad-slideshow-controls"></div>\');this.controls.append(this.start_link).append(this.stop_link).append(this.countdown);this.countdown.hide();var i=this;this.start_link.click(function(){i.start()});this.stop_link.click(function(){i.stop()});g(document).keydown(function(j){if(j.keyCode==83){if(i.running){i.stop()}else{i.start()}}});return this.controls},disable:function(){this.enabled=false;this.stop();this.controls.hide()},enable:function(){this.enabled=true;this.controls.show()},toggle:function(){if(this.enabled){this.disable()}else{this.enable()}},start:function(){if(this.running||!this.enabled){return false}var i=this;this.running=true;this.controls.addClass("ad-slideshow-running");this._next();this.fireCallback(this.settings.onStart);return true},stop:function(){if(!this.running){return false}this.running=false;this.countdown.hide();this.controls.removeClass("ad-slideshow-running");clearInterval(this.countdown_interval);this.fireCallback(this.settings.onStop);return true},_next:function(){var k=this;var l=this.settings.countdown_prefix;var j=this.settings.countdown_sufix;clearInterval(k.countdown_interval);this.countdown.show().html(l+(this.settings.speed/1000)+j);var i=0;this.countdown_interval=setInterval(function(){i+=1000;if(i>=k.settings.speed){var n=function(){if(k.running){k._next()}i=0};if(!k.nextimage_callback(n)){k.stop()}i=0}var m=parseInt(k.countdown.text().replace(/[^0-9]/g,""),10);m--;if(m>0){k.countdown.html(l+m+j)}},1000)},fireCallback:function(i){if(g.isFunction(i)){i.call(this)}}}})(jQuery);
			/*!
			 * jQuery imagesLoaded plugin v2.0.1
			 * http://github.com/desandro/imagesloaded
			 *
			 * MIT License. by Paul Irish et al.
			 */
			(function(a,b){var c="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";a.fn.imagesLoaded=function(k){var h=this,m=a.isFunction(a.Deferred)?a.Deferred():0,l=a.isFunction(m.notify),e=h.find("img").add(h.filter("img")),f=[],j=[],g=[];function i(){var n=a(j),o=a(g);if(m){if(g.length){m.reject(e,n,o)}else{m.resolve(e)}}if(a.isFunction(k)){k.call(h,e,n,o)}}function d(n,o){if(n.src===c||a.inArray(n,f)!==-1){return}f.push(n);if(o){g.push(n)}else{j.push(n)}a.data(n,"imagesLoaded",{isBroken:o,src:n.src});if(l){m.notifyWith(a(n),[o,e,a(j),a(g)])}if(e.length===f.length){setTimeout(i);e.unbind(".imagesLoaded")}}if(!e.length){i()}else{e.bind("load.imagesLoaded error.imagesLoaded",function(n){d(n.target,n.type==="error")}).each(function(n,p){var q=p.src;var o=a.data(p,"imagesLoaded");if(o&&o.src===q){d(p,o.isBroken);return}if(p.complete&&p.naturalWidth!==b){d(p,p.naturalWidth===0||p.naturalHeight===0);return}if(p.readyState||p.complete){p.src=c;p.src=q}})}return m?m.promise(h):h}})(jQuery);
			TOM.script.require("vendors/jquery.imagesloaded","jQuery.fn.imagesLoaded",false,true);if(null==TOM.videos){TOM.videos={}}TOM.videoAllowFullScreen="true";TOM.videoLivestreamPlayer=TOM.flashUrl+"mediaplayer.4.6.swf";TOM.videoPlayer=TOM.flashUrl+"mediaplayer.swf";TOM.videoAllowedCodecs="avc1.42E01E, mp4a.40.2";(function(a){a.fn.tomVideo=function(){var d,c,b;c=this;d=c.attr("id");if(undefined==TOM.videos||undefined==TOM.videos[d]){return c.hide()}b=TOM.videos[d];a(".video_fallback span",c).hide();a(".video_fallback",c).imagesLoaded(function(){var e=function(){c.tomVideoFlash(b,function(){return c.tomVideoHtml5(b,function(){return c.tomVideoNone()})})};if(b.deferred){a(\'<div class="video_fallback_play">\').click(function(){a(this).unbind("click");a(this).remove();e()}).appendTo(c)}else{e()}});return this}}(jQuery));(function(a){a.fn.tomVideoFlash=function(j,c){var h=this;var d={};d.allowfullscreen=true;d.allowscriptaccess="always";var b=this.width();var i=this.height();var f={};f.width=b;f.height=i;f.displaywidth=b;f.displayHeight=i;f.file=j.url;f.logo=j.overlay;f.image=j.poster;f.frontcolor="0xFFFFFF";f.backcolor="0x000000";f.lightcolor="0x666666";f.linktarget="_blank";f.showicons=true;f.repeat="list";f.shuffle=false;f.autostart=!!j.autoPlay;if(j.livestream){f["livestream.devkey"]=j.livestream_devkey}var e={};e.name=j.id;e.wmode="transparent";var g=j.livestream?TOM.videoLivestreamPlayer:TOM.videoPlayer;a(\'<div><div id="embed_\'+j.id+\'"></div></div>\').css("position","absolute").css("top","0").css("left","0").width(b).height(i).appendTo(this);TOM.script.require("vendors/swfobject","swfobject",function(){swfobject.embedSWF(g,"embed_"+j.id,b,i,TOM.flashMinVersion,TOM.flashExpressInstall,f,d,e,function(k){if(!k.success){return c()}a(".video_fallback img",h).css("opacity",0)})});return this}}(jQuery));(function(a){a.fn.tomVideoHtml5=function(d,c){try{var b=a(\'<video controls="controls">\').attr("poster",d.poster).width("100%").height("100%").css("position","absolute").css("top","0").append(a("<source>").attr("src",d.src))}catch(f){return c()}if(d.autoPlay){b.attr("autoplay","autoplay")}if(!b.get(0).canPlayType||!b.get(0).canPlayType(\'video/mp4; codecs="\'+TOM.videoAllowedCodecs+\'"\').replace(/no/,"")){return c()}this.click(a(".video_fallback img",a(this)).css("opacity",0));b.appendTo(this);return this}}(jQuery));(function(a){a.fn.tomVideoNone=function(){a("noscript",this).remove();a("span.noscript",this).show();if(document.createElement("detect").style.textShadow===undefined){a("span.noscript",this).css("background","navy")}return this}}(jQuery));
			$(function(){if($("#article_single_attachment").length){TOM.script.require("lib/videos","jQuery.fn.tomVideo",function(){$("#article_single_attachment .video_player").each(function(a,b){$(b).tomVideo()})})}else{TOM.overlay.addEvent(function(){TOM.script.requireScripts({"vendors/jquery.ad-gallery.1.2.7":"jQuery.fn.adGallery","lib/videos":"jQuery.fn.tomVideo"},function(){var a=$(".ad-gallery").adGallery({loader_image:TOM.imageUrl+"loader_black.gif",effect:"fade",thumb_opacity:0.8,display_next_and_prev:false,update_window_hash:false,callbacks:{beforeImageVisible:function(){var e=this;$(".ad-image").click(function(){$(this).find(".ad-image-description").hide()});$(".ad-image").delegate("div div","mouseover",function(){$(".ad-image").undelegate("div div");$(this).parent().parent().find(".ad-image-description").hide()});if(undefined==this.videos){this.videos=[];this.thumbs_wrapper.find("a").each(function(f){e.videos[f]=$("div.video_player",this).detach()})}var c=$("div",this.image_wrapper).first();var d=$("img",c).attr("src");$(this.images).each(function(f){if(this.image==d){nextIndex=f}});if(this.videos[nextIndex].length){var b=this.videos[nextIndex].clone();b.width(this.image_wrapper.width()).height(this.image_wrapper.height());c.find("img").replaceWith(b).end().width(this.image_wrapper.width()).height(this.image_wrapper.height()).css("top","0").css("left","0").find("img").css("opacity","1");b.tomVideo()}}}})})})}});
			TOM.prepareComments=function(a){if(!TOM.userId){return}$(".comment_ui",a).show().find(".comment_ui_container").height(0).end().each(function(){TOM.initCommentUI(TOM.getId($(this).attr("id")))})};TOM.initCommentUI=function(d){var a=$("#comment_ui_"+d);var c=$(".comment_ui_handle",a);var b=$(".comment_ui_container",a);c.click(function(){if($("textarea",b).length){b.bounceToggle(20)}else{TOM.commentUI.clone().find("textarea").attr("id","commentComment"+d).end().find(".comment_parent_id").val(d).end().appendTo(b);TOM.applyWYSIWYG("commentComment"+d,function(){b.bounceToggle(20)});TOM.script.require("vendors/jquery.charcount","jQuery.fn.charCount",function(){a.find("textarea").charCount({allowed:TOM.commentMaxLength,warning:20,css:"remaining_characters",counterElement:"span",counterText:"Characters left : "})})}})};TOM.applyWYSIWYG=function(b,a){a();return;var c=$("#"+b);TOM.script.require("vendors/tiny_mce/jquery.tinymce","jQuery.fn.tinymce",function(){c.tinymce({script_url:TOM.jsUrl+"vendors/tiny_mce/tiny_mce.js",mode:"exact",elements:b,remove_trailing_nbsp:true,plugins:"legacyoutput,paste,tomlines",theme_advanced_buttons1:"bold,italic,underline,strikethrough,|,undo,redo",theme_advanced_buttons2:"",theme_advanced_buttons3:"",entity_encoding:"raw",force_p_newlines:false,valid_elements:"br",forced_root_block:false,theme_advanced_resize_horizontal:false,theme_advanced_resizing:true,theme:"advanced",remove_linebreaks:false,theme_advanced_toolbar_align:"left",init_instance_callback:a,paste_text_linebreaktype:"br",paste_preprocess:function(d,e){e.content=e.content.replace(/<br\s*\/>/gi,"<br><br>").replace(/<br>/gi,"<br><br>")}})})};$(function(){if(TOM.userId&&$("#comments textarea").length){TOM.commentUI=$("#comment_ui_0 .comment_ui_content").clone();TOM.applyWYSIWYG("commentComment0",function(){TOM.initCommentUI(0)});$(".report_abuse_link").show();$(".report_abuse_link").click(function(){var a=($("#mobile_logo").length)?true:false;var c=(a)?300:570;var b=$(this).attr("data-comment_id");$("#CommentReportCommentId").val(b);$("#modal_dialog_report").dialog({modal:true,resizable:false,width:c,beforeClose:function(){$(".modal_flash_message").hide()}});$("#sendReportForm").ajaxForm({dataType:"json",success:function(d){if(d){if(d.success){$("#modal_dialog_report").dialog("close");if(d.message){$.jGrowl(d.message,{theme:"info_message",closeTemplate:""})}}else{$(".modal_flash_message").html(\'<div class="auth_message message">\'+d.message+"</div>").fadeIn();setTimeout(function(){$(".modal_flash_message").fadeOut()},5000)}}}});return false})}TOM.prepareComments($("#comment_replies"));if($("#comments textarea").length>0){TOM.script.require("vendors/jquery.charcount","jQuery.fn.charCount",function(){$("#commentComment0").charCount({allowed:TOM.commentMaxLength,warning:20,css:"remaining_characters",counterElement:"span",counterText:"Characters left : "})})}});
			(function(a){a.fn.charCount=function(d){var i={allowed:140,warning:25,css:"counter",counterElement:"span",cssWarning:"warning",cssExceeded:"exceeded",counterText:""};var d=a.extend(i,d);function g(k){var f=a(k).val().length;var j=d.allowed-f;if(j<=d.warning&&j>=0){a(k).next().addClass(d.cssWarning)}else{a(k).next("").removeClass(d.cssWarning)}if(j<0){a(k).next().addClass(d.cssExceeded);return false}else{a(k).next().removeClass(d.cssExceeded)}a(k).next().html(d.counterText+j);return true}this.each(function(){a(this).after("<"+d.counterElement+\' class="\'+d.css+\'">\'+d.counterText+"</"+d.counterElement+">");g(this);a(this).keyup(function(){if(!g(this)){a(this).innerHtml(a(this).val())}});a(this).change(function(){g(this)})});var c,h;var b=a(this);a(this).focus(function(){c=window.setInterval(e,100)});a(this).blur(function(){clearInterval(c);e()});function e(){var j=a(b).val();var f=j.length;if(f>d.allowed){a(b).val(a(b).val().substring(0,d.allowed))}}e()}})(jQuery);
			$(function(){$(".print_button").click(function(){window.print();return false});$(".email_button").click(function(){$("#email_modal_dialog").dialog({modal:true,resizable:false,width:370});return false});$("#EmailForm").ajaxForm({dataType:"json",success:function(a){if(a&&a.success){$("#recipient_email, #email_message").val("");$("#email_modal_dialog").dialog("close");if(a.message){$.jGrowl(a.message,{theme:"info_message",closeTemplate:""})}}else{if(!a){$(".modal_flash_message").html(\'<div class="auth_message message">Unable to send message</div>\').fadeIn();setTimeout(function(){$(".modal_flash_message").fadeOut()},5000)}else{$(".modal_flash_message").html(\'<div class="auth_message message">\'+a.message+"</div>").fadeIn();setTimeout(function(){$(".modal_flash_message").fadeOut()},5000)}}}});$.each(TOM.audio,function(b,a){$("#audio_tag_"+b).replaceWith($("#"+b))});$.each(TOM.videos,function(b,a){$("#video_tag_"+b).replaceWith($("#"+b))});if($("#article_body .video_player").length){TOM.script.require("lib/videos","jQuery.fn.tomVideo",function(){$("#article_body .video_player").each(function(a,b){$(b).tomVideo()})})}});
			$(function(){if(!TOM.livetext_url||!TOM.livetext_since){return}TOM.livetext_refresh_enabled=$(".livetext_refresh").attr("checked");TOM.livetext_refresh=TOM.livetext_refresh?parseInt(TOM.livetext_refresh):30;$(".livetext_refresh").click(function(){TOM.livetext_refresh_enabled=$(this).attr("checked")});if(!TOM.livetext_enabled){if(TOM.livetext_admin){$(".livetext_start").insertBefore("ol.livetext").show()}return}$(".livetext_controls").insertBefore("ol.livetext").show();if(TOM.livetext_admin){$("#livetextAuthor").val(TOM.livetext_author);$(".livetext_admin form.livetext_update").submit(function(b){$(this).disable();$.ajax({url:$(this).attr("action"),context:this,complete:function(){$(this).enableForm()},success:function(d){if(d.success){$("#livetextEvent",this).val("");$("#livetextQuestion",this).val("");$("#livetextQuestionAuthor",this).val("");TOM.refreshLiveText(true);$.jGrowl("Article successfully updated",{theme:"info_message",closeTemplate:""})}else{var c=d.message?d.message:"An unknown error occured";$.jGrowl(c,{theme:"info_warning",closeTemplate:""})}},error:function(c){$.jGrowl("An error occured",{theme:"info_warning",closeTemplate:""})},data:{"data[event]":$("#livetextEvent",this).val(),"data[author]":$("#livetextAuthor",this).val(),"data[question]":$("#livetextQuestion",this).val(),"data[question_author]":$("#livetextQuestionAuthor",this).val()},type:"POST"});return false});$(".livetext_admin form.livetext_stop").submit(function(){return confirm("Are you sure you want to end this event?\n\nAll clients will be disconnected.")});$(".livetext_admin").show();TOM.livetext_refresh_questions=$("#livetext_refresh_questions input[type=checkbox]").attr("checked");if(TOM.livetext_questions){$(".livetext_questions").show();TOM.livetext_questions_since=0;TOM.refreshQuestions(false);if(TOM.livetext_questions){TOM.livetext_questions_interval=setInterval(function(){TOM.refreshQuestions(true)},5*1000)}}$("#livetext_refresh_questions input[type=checkbox]").click(function(){TOM.livetext_refresh_questions=$(this).attr("checked")})}if(TOM.livetext_questions&&!TOM.livetext_admin){if(TOM.userId){var a=parseInt($("#livetext_questions_asked").data("asked"));$("#livetext_ask").submit(function(b){$("form",this).disable();$.ajax({url:$("form",this).attr("action"),context:this,complete:function(){$("form",this).enableForm()},success:function(d){if(d.success){$("#livetextAskQuestion",this).val("");$.jGrowl("Question posted!",{theme:"info_message",closeTemplate:""});a++;$("#livetext_questions_asked span").text(a)}else{var c=d.message?d.message:"An unknown error occured";$.jGrowl(c,{theme:"info_warning",closeTemplate:""})}},error:function(c){$.jGrowl("An error occured",{theme:"info_warning",closeTemplate:""})},data:{"data[question]":$("#livetextAskQuestion",this).val()},type:"POST"});return false});$("#livetext_ask").show()}else{$("#livetext_ask_login").show()}}TOM.livetext_interval=setInterval(function(){TOM.refreshLiveText(false)},TOM.livetext_refresh*1000)});TOM.refreshLiveText=function(a){if(!a&&!TOM.livetext_refresh_enabled){return}$.ajax({url:TOM.livetext_url+"/"+TOM.livetext_since,success:function(d){if(d.success){if(d.since){TOM.livetext_since=d.since}if(!d.enabled){clearInterval(TOM.livetext_interval);if(TOM.livetext_questions){clearInterval(TOM.livetext_questions_interval)}}if(d.events&&TOM.length(d.events)){var b=[];TOM.each(d.events,function(f,e){b.unshift(function(g){$(f).hide().prependTo("ol.livetext").slideDown(null,g)})});var c;(c=function(){var e;if(e=b.shift()){setTimeout(function(){e(c)},1000)}})()}}},type:"GET"})};TOM.refreshQuestions=function(a){if(!TOM.livetext_refresh_questions){return}$.ajax({url:TOM.livetext_questions_url+"/"+TOM.livetext_questions_since,success:function(d){if(d.success){if(d.since){TOM.livetext_questions_since=d.since}if(d.questions&&TOM.length(d.questions)){var b=[];TOM.each(d.questions,function(f,e){b.push(function(h){var g=$(\'<li><div><div class="livetext_question_controls"><a>Answer</a> | <a class="block_user">Block this user</a></div><span>\'+f.display_name+" asks:</span><p>"+f.question+"</p></div></li>");$(".block_user",g).click(function(i){if(confirm("Are you sure you wish to block the user "+g.data("display_name")+"?")){$.ajax({url:TOM.livetext_block_url+"/"+g.data("user_id"),success:function(j){$.jGrowl("Blocked user "+g.data("display_name"),{theme:"info_message",closeTemplate:""})},type:"GET"})}return false});g.click(function(i){$("#livetextQuestion").val($("p",g).html().replace(/<br>/g,"\n"));$("#livetextQuestionAuthor").val(g.data("display_name"))});g.data("user_id",f.user_id).data("display_name",f.display_name).hide().prependTo("ul#livetext_questions");if(a){g.slideDown(null,h)}else{g.show(0,h)}})});var c;(c=function(){var e;if(e=b.shift()){setTimeout(function(){e(c)},a?1000:1)}})()}}},type:"GET"})};
			if(null==TOM.audio){TOM.audio={}}TOM.audioPlayerUrl=TOM.flashUrl+"mediaplayer.4.6.swf";TOM.audioTypes={mp3:"audio/mpeg;",ogg:\'audio/ogg; codecs="vorbis"\',wav:"audio/x-wav;"};(function(a){a.fn.tomAudio=function(){var e,d,c;d=this;e=d.attr("id");if(undefined==TOM.audio||undefined==TOM.audio[e]){return}c=TOM.audio[e];a(".audio_fallback",d).hide();var b=function(){d.tomAudioHtml5(c,function(){d.tomAudioFlash(c,function(){return d.tomAudioNone()})})};b();return this}}(jQuery));(function(a){a.fn.tomAudioFlash=function(f,e){if("mp3"!=f.type){return e()}var d=320;var b=19;var h={};h.allowfullscreen=false;h.allowscriptaccess="always";var g={};g.displaywidth=d;g.displayHeight=b;g.file=f.url;g.repeat="list";g.shuffle=false;g.autostart=!!f.autoPlay;g.frontcolor="0xFFFFFF";g.backcolor="0x000000";g.lightcolor="0x666666";g.linktarget="_blank";g.showicons=true;var c={};c.name=f.id;c.wmode="transparent";this.parent("p").replaceWith(this);a(\'<div><div id="embed_\'+f.id+\'"></div></div>\').width(d).height(b).appendTo(this);TOM.script.require("vendors/swfobject","swfobject",function(){swfobject.embedSWF(TOM.audioPlayerUrl,"embed_"+f.id,d,b,TOM.flashMinVersion,TOM.flashExpressInstall,g,h,c,function(i){if(!i.success){return e()}})});return this}}(jQuery));(function(a){a.fn.tomAudioHtml5=function(f,c){if(undefined==TOM.audioTypes[f.type]){return c()}try{var b=a(\'<audio controls="controls" preload="none">\').attr("id",f.id).append(a("<source>").attr("src",f.url)).attr("type",TOM.audioTypes[f.type])}catch(d){return c()}if(f.autoPlay){b.attr("autoplay","autoplay")}if(!b.get(0).canPlayType||!b.get(0).canPlayType(TOM.audioTypes[f.type]).replace(/no/,"")){return c()}b.appendTo(this);return this}}(jQuery));(function(a){a.fn.tomAudioNone=function(){a(".audio_fallback",this).show();return this}}(jQuery));
			$(function(){TOM.script.require("lib/audioplayer","jQuery.fn.tomAudio",function(){$(".audio_player").each(function(a,b){$(b).tomAudio()})})});' +
        "})();";

	document.body.appendChild(script); 

}