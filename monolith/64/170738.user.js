// ==UserScript==
// @name Requested Counter
// @namespace Kinetic
// @description Keeps track of certain stats gained during battle.
// @include http://thelostrunes.com/game.php
// @include	http://www.thelostrunes.com/game.php
// ==/UserScript==

function addGlobalJS(js)
{
var head, script;
head = document.getElementsByTagName('head')[0];
if (!head) { return; }
script = document.createElement('script');
script.type = 'text/javascript';
script.innerHTML = js;
head.appendChild(script);
}

addGlobalJS("function addCounterReset(n) { if (n == 1) { document.getElementById('add_goldinc').innerHTML = '0'; document.getElementById('add_expinc').innerHTML = '0'; document.getElementById('add_killinc').innerHTML = '0'; document.getElementById('add_deathinc').innerHTML = '0'; document.getElementById('percent_wins').innerHTML = '0'; document.getElementById('add_goldclan').innerHTML = '0'; document.getElementById('add_expclan').innerHTML = '0'; document.getElementById('add_lvlcount').innerHTML = '0'; } else if (n == 2) { document.getElementById('add_foodcount').innerHTML = '0'; document.getElementById('add_woodcount').innerHTML = '0'; document.getElementById('add_ironcount').innerHTML = '0'; document.getElementById('add_stonecount').innerHTML = '0'; document.getElementById('addhourcount').innerHTML = '0'; document.getElementById('addminutecount').innerHTML = '0'; document.getElementById('addsecondcount').innerHTML = '0'; } }");

addGlobalJS("function addThouCommas (num) {var array = num.toString().split('');var index = -3;while (array.length + index > 0) {array.splice(index, 0, ',');index -= 4;}return array.join('');}");

addGlobalJS("function tsNav(tvar, id){var addsecondcount = parseFloat(document.getElementById('addsecondcount').innerHTML);var addminutecount = parseFloat(document.getElementById('addminutecount').innerHTML);var addhourcount = parseFloat(document.getElementById('addhourcount').innerHTML);if (tvar == 2) { /*10s*/ addsecondcount = addsecondcount + 10; } else if (tvar == 3) { /*1m*/ addminutecount = addminutecount + 1; } else if (tvar == 4) { /*5m*/ addminutecount = addminutecount + 5; } else if (tvar == 5) { /*15m*/ addminutecount = addminutecount + 15; } else if (tvar == 6) { /*30s*/ addsecondcount = addsecondcount + 30; } else if (tvar == 7) { /*1m40s*/ addminutecount = addminutecount + 1; addsecondcount = addsecondcount + 40; }while ((addsecondcount >=60) || (addminutecount >= 60)){if (addsecondcount >= 60) { addsecondcount = addsecondcount - 60; addminutecount = addminutecount + 1; }if (addminutecount >= 60) { addminutecount = addminutecount - 60; addhourcount = addhourcount + 1; }}document.getElementById('addsecondcount').innerHTML = addsecondcount; document.getElementById('addminutecount').innerHTML = addminutecount; document.getElementById('addhourcount').innerHTML = addhourcount; sendData('g_content.php?mod=tradeskills&tvar='+tvar+'&ts='+id);}");



addGlobalJS("function handleResponse1(){if((http.readyState == 4 && whichHandle == 1) || (recap.readyState == 4 && whichHandle == 2)){ccheck = 0;if(whichHandle == 1){var response = $.trim(http.responseText);}else{var response = $.trim(recap.responseText);}var update = new Array();if(response.indexOf('|' != -1)){update = response.split('|');var totalUpdates = (update.length / 2);var currentUpdate = 1;var var1 = 0;var var2 = 1;while(currentUpdate <= totalUpdates){if(update[var1] == 'at'){actioninprogress = 1;actiontimer(update[var2]);}else if(update[var1] == 'special'){if(update[var2] == 'aterror'){alert('Please wait until your previous action is complete!');if(document.getElementById('battlebutton')){document.getElementById('battlebutton').disabled = false;}}if(update[var2] == 'banned'){alert('Your account is currently banned. Check your e-mail for further details.');window.location = 'http://www.thelostrunes.com/';}if(update[var2] == 'autoattack'){autoattack = 1;}if(update[var2] == 'disautoattack'){autoattack = 0;}if(update[var2] == 'secchkfail'){alert('You have failed too many security checks and have been logged out.');window.location = 'http://www.thelostrunes.com/index.php?logout';}}else if(update[var1] == 'specialmobid'){autoattackid = update[var2];}else if(update[var1] == 'tradeskills'){actioninprogress = 0;init_tradeskill(update[var2]);}else if(update[var1] == 'securitycheck'){actiontimer(2000);showRecaptcha('recaptcha_div');}else{document.getElementById(update[var1]).innerHTML = update[var2];/*sort counter variables*/var mygoldinc = document.getElementById('add_goldinc').innerHTML;mygoldinc = mygoldinc.replace(/,/gi,'');var mygoldinc_int = parseFloat(mygoldinc);var mygoldclan = document.getElementById('add_goldclan').innerHTML;mygoldclan = mygoldclan.replace(/,/gi,'');var mygoldclan_int = parseFloat(mygoldclan);var myexpinc = document.getElementById('add_expinc').innerHTML;myexpinc = myexpinc.replace(/,/gi,'');var myexpinc_int = parseFloat(myexpinc);var myexpclan = document.getElementById('add_expclan').innerHTML;myexpclan = myexpclan.replace(/,/gi,'');var myexpclan_int = parseFloat(myexpclan);/*check for battle win text*/var mysearchtxt = 'You defeated the';var wheretosearch = update[var2];var mysearchtest = wheretosearch.search(mysearchtxt);if (mysearchtest != -1){/*win, add to kill counter*/var mykillinc = document.getElementById('add_killinc').innerHTML;var mykillinc_int = mykillinc.replace(/,/gi,'');mykillinc_int = parseFloat(mykillinc_int);var mydeathinc = document.getElementById('add_deathinc').innerHTML;var mydeathinc_int = mydeathinc.replace(/,/gi, '');mydeathinc_int = parseFloat(mydeathinc_int);/*get gold/exp*/var newBattleText = wheretosearch.replace('<span style=\"color: #FFCC33;\">', '<span id=\"goldObtained\" style=\"color: #FFCC33;\">');newBattleText = newBattleText.replace('<span style=\"color: #FFCC33;\">', '<span id=\"clanGold\" style=\"color: #FFCC33;\">');newBattleText = newBattleText.replace('<span style=\"color: #FFFFFF;\">', '<span id=\"expObtained\" style=\"color: #FFFFFF;\">');newBattleText = newBattleText.replace('<span style=\"color: #FFFFFF;\">', '<span id=\"clanExp\" style=\"color: #FFFFFF;\">');newBattleText = newBattleText.replace(/ gold<\\/span>/gi, '</span>');newBattleText = newBattleText.replace(/ experience<\\/span>/gi, '</span>');newBattleText = newBattleText.replace(/,/gi, '');document.getElementById('contentmain').innerHTML = newBattleText;var addMyGold = document.getElementById('goldObtained').innerHTML;var addClanGold = document.getElementById('clanGold').innerHTML;var addMyExp = document.getElementById('expObtained').innerHTML;var addClanExp = document.getElementById('clanExp').innerHTML;document.getElementById('contentmain').innerHTML = wheretosearch;document.getElementById('add_killinc').innerHTML = addThouCommas(mykillinc_int + parseFloat(1));var temp_percent_wins = 100 * ((mykillinc_int + 1) / (mykillinc_int + mydeathinc_int + 1));document.getElementById('percent_wins').innerHTML = temp_percent_wins.toFixed(2);document.getElementById('add_goldinc').innerHTML = addThouCommas(mygoldinc_int + parseFloat(addMyGold));document.getElementById('add_goldclan').innerHTML = addThouCommas(mygoldclan_int + parseFloat(addClanGold));document.getElementById('add_expinc').innerHTML = addThouCommas(myexpinc_int + parseFloat(addMyExp));document.getElementById('add_expclan').innerHTML = addThouCommas(myexpclan_int + parseFloat(addClanExp));/*check for lvl up*/var lvltxtsearch = 'you are now level.'; lvltxtsearch = wheretosearch.search(lvltxtsearch); if (lvltxtsearch != -1) { var lvlcntupdate = document.getElementById('add_lvlcount').innerHTML; lvlcntupdate = lvlcntupdate.replace(/,/gi, ''); lvlcntupdate = parseFloat(lvlcntupdate) + 1; lvlcntupdate = addThouCommas(lvlcntupdate); document.getElementById('add_lvlcount').innerHTML = lvlcntupdate; } }/*check for battle defeat text*/mysearchtxt2 = 'You were defeated';var mysearchtest2 = wheretosearch.search(mysearchtxt2);if(mysearchtest2 != -1){/*defeat, add to counter*/var mydeathinc = document.getElementById('add_deathinc').innerHTML;var mydeathinc_int = mydeathinc.replace(/,/gi, '');mydeathinc_int = parseFloat(mydeathinc_int);document.getElementById('add_deathinc').innerHTML = mydeathinc_int + 1;var mykillinc = document.getElementById('add_killinc').innerHTML;var mykillinc_int = mykillinc.replace(/,/gi,'');mykillinc_int = parseFloat(mykillinc_int);var temp_percent_wins = 100 * ((mykillinc_int) / (mykillinc_int + mydeathinc_int + 1));document.getElementById('percent_wins').innerHTML = temp_percent_wins.toFixed(2);}}currentUpdate = currentUpdate + 1;var1 = var1 + 2;var2 = var2 + 2;}if (actioninprogress == 0){document.getElementById('actiontimer').innerHTML = '0.0';}}}}");

addGlobalJS("function init_tradeskill(tsString){var tsArray = tsString.split('___');var tempHolder = tsArray.shift();tsArray = tsArray.reverse();tsArray.unshift(tempHolder);tsString = tsArray.join('___');var tsDisplay = '';var tsTotal = tsArray.length;var tsInterval = tsArray[0];var addtsString = tsString.replace(/You gained a total of <b>/gi, 'You gained a total of <span id=\"addtotalres\">');var addfoodcheck = tsString.search('Food');var addwoodcheck = tsString.search('Wood');var addironcheck = tsString.search('Iron');var addstonecheck = tsString.search('Stone');if (addfoodcheck != -1) { var addCounter = 'add_foodcount'; addtsString = addtsString.replace(/<\\/b> Food!<br \\/><br \\/>/gi, '</span> Food!<br /><br />'); } else if (addwoodcheck != -1) { var addCounter = 'add_woodcount'; addtsString = addtsString.replace(/<\\/b> Wood!<br \\/><br \\/>/gi, '</span> Wood!<br /><br />'); } else if (addironcheck != -1) { var addCounter = 'add_ironcount'; addtsString = addtsString.replace(/<\\/b> Iron!<br \\/><br \\/>/gi, '</span> Iron!<br /><br />'); } else if (addstonecheck != -1) { var addCounter = 'add_stonecount'; addtsString = addtsString.replace(/<\\/b> Stone!<br \\/><br \\/>/gi, '</span> Stone!<br /><br />'); } var addoldcontent = document.getElementById('content').innerHTML; document.getElementById('content').innerHTML = addtsString; var addtotalres = document.getElementById('addtotalres').innerHTML; document.getElementById('content').innerHTML = addoldcontent; var addcurrentcount = document.getElementById(addCounter).innerHTML; addcurrentcount = addcurrentcount.replace(/,/gi,''); addnewcount = parseFloat(addcurrentcount) + parseFloat(addtotalres); addnewcount = addThouCommas(addnewcount); document.getElementById(addCounter).innerHTML = addnewcount; display_tradeskill(tsString, tsDisplay, tsTotal, tsInterval);}");