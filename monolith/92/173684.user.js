// ==UserScript==
// @name            Sofia GUI
// @description     Sofia GUI 
// @namespace       *
// @version         2.5
// @include         http://*sofiawars.com*
// @exclude         http://www.sofiawars.com/chat/*
// @exclude         http://www.sofiawars.com/stash/*
// @run-at          document-end
// ==/UserScript==

function GM_wait(){if(typeof unsafeWindow.jQuery=="undefined"){window.setTimeout(GM_wait,1e3)}else{$=unsafeWindow.jQuery}}function trim13(e){e=e.replace(/^\s+/,"");for(var t=e.length-1;t>=0;t--){if(/\S/.test(e.charAt(t))){e=e.substring(0,t+1);break}}return e}function $p(e,t,n,r){if(t.length>0){$.post(e,t.pop(),function(){n.call();$p(e,t,n,r)})}else{r.call()}}function $t(){var e,t,n,r,i;i=new $g.$e;$(i).css({"max-width":"240px"});r=$g.$b("Importuj");$(r).click(function(){$(".button").addClass("disabled").unbind("click");var e=new Array;var t=$("#players select:first option:selected").val();$("#players input:checkbox").slice(1).each(function(){if($(this).is(":checked")){e.push({info:"",name:$(this).parent().find("a:last").html(),type:t})}});var n=Math.round(100/e.length*100);$p("/phone/contacts/add/",e,function(){var e=$(i).find("div.percent");$(e).css("width",(e[0].style.width.replace(/[^0-9.]*/g,"")*1+n/100).toFixed(2)+"%")},function(){window.location.href="/phone/contacts/"+(t=="enemy"?"enemies":t+"s")})});$("#players").parent().prev("td").append("<HR style='position:relative;top:2px;right:-10px'><P>Wklej:</P>");$("#players").show().prepend("<hr/><select style='background-color:#fff4de;vertical-align:baseline;margin-right:10px'><option value='victim'>Ofiary</option><option value='enemy'>Wrogowie</option><option value='friend'>Przyjaciele</option><option value='black'>Czarna Lista</option></style>",r,"<br/><b style='color:#945903;font:bold 90% Tahoma,sans-serif,Arial'>Ładuję ...:</b>",i,"<hr/>",$("<input type='checkbox' style='padding-right:10px'/>").click(function(){var e=$("#players input:checkbox").slice(1);if($(this).is(":checked")){$(e).attr("checked","checked")}else{$(e).removeAttr("checked")}}),"<br/>").find("span.user").each(function(){$(this).prepend("<input type='checkbox'>")})}function $p(e,t,n){if(t.length>0){$.post(e,t.pop(),function(){n.call();$p(e,t,n)})}else{window.location.reload(true)}}function $c(){var e,t,n;t=new $g.$e;e=new $g.$b("Usuń zaznaczone");$(e).click(function(){$(".button").attr("disabled","disabled").addClass("disabled").unbind("click");var e=new Array;$("table.list-users input:checkbox").slice(1).each(function(){if($(this).is(":checked")){n=$(this).parent().find("span.user a:last");e.push({action:"delete",id:$(n).attr("href").replace(/player|\//g,""),nickname:$(n).html(),type:"contact"})}});var r=Math.round(100/e.length);$p("/phone/contacts/",e,function(){var e=$(t).find("div.percent");$(e).css("width",Number(e[0].style.width.replace(/[^0-9]*/g,""))+r+"%")})});$(".list-users tr").each(function(){n=$(this).find("td:first span.user a:last");$("<input/>").attr({type:"checkbox",value:n.html()}).insertBefore($(this).find("i:first"))});$("<tr />").append($("<td/>").append($("<input />").attr({type:"checkbox"}).click(function(){var e=$("table.list-users input:checkbox").slice(1);if($(this).is(":checked")){$(e).attr("checked","checked")}else{$(e).removeAttr("checked")}})),$("<td/>").css({"text-align":"right","vertical-align":"bottom",padding:"0 5px"}).append($("<b/>").css({color:"#945903"}).html("Postęp:")),$("<td/>").append(e,t)).insertBefore(".list-users tr:first")}function showFullInventory(){$(".object-thumbs").css({height:"auto",overflow:"hidden"})}function buyItemsWindowShow(){if($(".alert.buyItem-loaded").length>0){if($(".alert.buyItem-loaded").is(":visible")){return}else{$(".alert.buyItem-loaded").show()}}else{$("<script/>").attr({type:"text/javascript",src:"https://gist.github.com/raw/4656649/6237f7ba8a7c3678de95ce02e3cdb76dbbcee668/WawaWars%20Sklep"}).appendTo("head")}}var GM_JQ=document.createElement("script");GM_JQ.src="http://jquery.com/src/jquery-latest.js";GM_JQ.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(GM_JQ);GM_wait();$(document).ready(function(){function c(e,t){return"<div onclick=\"document.location.href = '"+t+'\'" class="button"><span class="f"><i class="rl"></i><i class="bl"></i><i class="brc"></i><div class="c">'+e+"</div></span></div>"}function h(e,t){return'<div id="'+t+'" class="button"><span class="f"><i class="rl"></i><i class="bl"></i><i class="brc"></i><div class="c">'+e+"</div></span></div>"}$("#servertime").css({color:"black",top:"335px",background:"#fbe6af",border:"4px solid #fbd290",borderRadius:"10px",width:"70px",padding:"10px 35px 10px 20px",position:"fixed",top:"20px"});$("#servertime").css("font-size","20px");$("#servertime").css("left","20px");$("#servertime").css("font-weight","bold");$("#servertime").css("z-index","3");$("#stats-accordion").css("height","275px");$("#statistics-accordion").css("height","275px");$('center[style="padding-top:3px;"]').css("display","none");$(".inventary .object-thumb").css({width:"53px",height:"64px"});$(".inventary .object-thumb").css("margin","1px 1px 4px 0px");$(".inventary .padding img").css({width:"52px",height:"52px"});$(".inventary .padding").css({padding:"0px",width:"53px"});$(".inventary .padding").css("min-height","53px");$(".equipment-cell .object-thumbs").css("padding","2px 0px 2px 22px");$(".inventary .count").css({color:"black",top:"40px"});$(".inventary .count").css("font-weight","bold");$("#fight-perplayer-results").toggle();$("#personal .wanted").css("font-size","0px");$(".cars-trip-accordion").css({height:"2430px"});$("div.cars-trip-accordion ul").css({width:"660px"});$("i.arrow-right-circle").css({display:"none"});$("i.arrow-left-circle").css({display:"none"});$("div.cars-trip-scroll-bar-container").css({display:"none"});$("ul.jcarousel-list.jcarousel-list-horizontal  li").css("margin-bottom","5px");$(".wallet-4").css({background:"url(http://www.moswar.ru/css/1064/../images/decor/_personal.png) no-repeat 50% -719px",height:"auto",marginTop:"5px"});$(".wallet-4 li").css("width","63px");$(".tugriki-block").html($(".tugriki-block").html().replace("<br>"," "));$(".ruda-block").html($(".ruda-block").html().replace("<br>"," "));$(".neft-block").html($(".neft-block").html().replace("<br>"," "));$(".med-block").html($(".med-block").html().replace("<br>"," "));$(".neft-block").css("margin-top","7px");$(".column-left .neft").css({"float":"left",margin:"0 0 0 6px"});$(".column-left .med").css({"float":"left",margin:"0 0 0 6px"});$(".count:contains('100%')").parent().css({background:"#22c622 url(images/asd.jpg) no-repeat 0 0"});$(".count:contains('100%')").parent().find("img").css({background:"none"});$("#tutorial-pers").css("display","none");var e='<div style="width:140px; position:absolute; top:400px; left:40px;"><a href="/phone/messages/inbox/"><i class="icon icon-messages-new" title="PW" style="position: relative; left: -19px;"></i></a><a href="/phone/messages/clan/"><img class="icon" src="/@/images/obj/clansign15.png" title="Grypsownia" style="position: relative; right: 18px;"></i></a><a href="/phone/logs/"><span class="icon icon-star-filled" title="Logi" style="position: relative; right: 14px;"><i></i></span></a><a href="/phone/duels/"><i class="icon tooth-green " title="Pojedynki" style="position: relative; left: -5px;"></i></i></a><a href="/phone/contacts/"><i class="icon mobila-icon " title="Kontakty" style="position: relative; right: 5px;"></i></a><a href="/petarena/train/"><img src="/@/images/obj/pets/8-4-icon.png" title="Zwierzak" style="position: relative; top: 5px;"/></a><br><br><a href="/metro/"><i class="icon metrotaken-cy1-icon" title="Metro" style="position: relative; left: -18px;"></i></a><a href="/factory/"><span class="petric" title="Fabryka" style="position: relative; right: 14px;"><i></i></span></a><a href="/neft/"><span class="neft" title="Rurociąg" style="position: relative; right: 10px;"><i></i></span></a><a href="/casino/"><span class="fishki" title="Kasyno" style="position: relative; left: -5px; "><i></i></span></a><a href="/huntclub/wanted/"><i class="icon hunting-badge "title="Klub Łowców"></i></i></a><a href="/automobile/"><i class="icon car-icon" title="FAO"style="position: relative; left: 5px; "></i></i></a></div>';$("#personal div.phone").after(e);$("div.wanted").css("cursor","pointer").attr("title","Policja").click(function(){document.location.href="/police/"});var t=encodeURIComponent(window.location);var n="http%3A%2F%2Fwww.wawawars.pl%2Fplayer%2F";if(t===n){window.addEventListener("load",function(){function e(){var e,r,i,s,o,u,a,f,c,h;t();$(".object-thumbs").css({height:"auto",overflow:"hidden"});$(".hint").remove();$("dl#dopings-accordion div.object-thumbs div.object-thumb div.action:not(.disabled)").each(function(){a=/(?!\/player\/use\/)[0-9]+(?=\/';(\n)?)/g.exec(String($(this)[0].getAttribute("onclick")));if(a.length>0){var e=/(?=\/?)[a-zA-Z0-9-]+(?=\.png(\n)?$)/g.exec(String($(this).parents("div.object-thumb").find("img:first").attr("src")))[0];if(e!="drugs5"&&e!="drugs4"){a="unchecked"}else{a=""}c=$("<div />").css({bottom:"1",left:"0",position:"absolute"}).append('<input type="checkbox" class="m4w" '+a+" />");$(this).parents("div.object-thumb").css({height:"64px","margin-bottom":"7px"}).append(c).click(function(e){if(e.target.type!="checkbox")$(":checkbox",this).attr("checked",function(){return!this.checked})})}});f=$("div#content table.inventary td.equipment-cell div[rel='normal'] div.object-thumbs div.object-thumb");f.each(function(){if($(this).find("div.action").length==0||!String($(this).find("div.action:first")[0].getAttribute("onclick")).match(/\/player\/dress\/[0-9]+\/';/g)){$(this).remove()}else{c=$("<div />").css({bottom:"1",left:"0",position:"absolute"}).append('<input type="checkbox" checked="checked" class="m3w" />');$(this).css({height:"64px","margin-bottom":"7px"}).append(c).click(function(e){if(e.target.type!="checkbox")$(":checkbox",this).attr("checked",function(){return!this.checked})})}});$("#content table.layout td.slots-cell ul.slots").find("li").not(".avatar,.slot-pet").each(function(){if($(this).find("img").length>0){e=$("<div />").css({bottom:"0",left:"0",position:"absolute"}).append('<input type="checkbox" checked="checked" class="m1w" />');$(this).append(e).click(function(e){if(e.target.type!="checkbox")$(":checkbox",this).attr("checked",function(){return!this.checked})})}});r=$("<button />").addClass("button").css("margin","0 10px 7px 0").append('<span class="f"><i class="rl"></i><i class="bl"></i><i class="brc"></i><div class="c">Ściągnij wybrane</div></span>');b2=r.clone(true);b3=r.clone(true);b3.click(function(){$(".button").addClass("disabled").unbind("click");h=new Array;$(".m4w:checked").each(function(){l=/\/player\/use\/[0-9]+\/(?=';(\n)?$)/g.exec(String($(this).parents(".object-thumb").find("div.action:first")[0].getAttribute("onclick")));h.push(l[0])});n(h)}).find("div.c").text("Jedz wybrane");b2.click(function(){$(".button").addClass("disabled").unbind("click");h=new Array;$(".m3w:checked").each(function(){l=/\/player\/dress\/[0-9]+\/(?=';(\n)?$)/g.exec(String($(this).parents(".object-thumb").find("div.action:first")[0].getAttribute("onclick")));h.push(l[0])});n(h)}).find("div.c").text("Wybierz ubranie");r.click(function(){$(".button").addClass("disable").unbind("click");h=new Array;$(".m1w:checked").each(function(){u=$(this).parents("li").find("img").attr("src");$(f).find("div.action").each(function(){if($(this).parents("div.padding").find("img").attr("src")==u){l=/\/player\/withdraw\/[0-9]+\/(?=';(\n)?$)/g.exec(String($(this)[0].getAttribute("onclick")));h.push(l[0])}})});n(h)});i=$("<b />").css({color:"#945903",font:"bold 90% Tahoma,sans-serif,Arial"}).html("Postęp:");s=$("<div />").addClass("exp").html("<div class='bar' style='width:100%'><div><div class='percent' style='width:0%' id='m2w'></div></div></div>");o=$("<tr />").append("<td align='center' /><td align='center' /><td class='progress' />");$(o).find("td:nth-child(1)").append(b3).end().find("td:nth-child(2)").append(r,b2).end().find("td:nth-child(3)").append(i,s);$("#content table.layout tbody").append(o)}function t(){var e,t,n,r,i,s;e="dl.vtabs div.object-thumbs";t=function(e){return $(e).parents("div.object-thumb").find("div.count")};$(e).each(function(){$(this).find("div.object-thumb img").each(function(){n=String(/(?=\/)?[a-zA-Z0-9-]+\.png$/g.exec(String($(this).attr("src"))));i=$(e).find("img[src*='"+n+"']");if(i.length>1){r=0;i.each(function(){s=t(this);if(!s.html()){r+=1}else{r+=Number(s.html().replace("#",""))}});if(!t(i[0]).html())$("<div class='count' />").insertAfter($(i[0]));t(i[0]).html("#"+r);i.not(":first").parents("div.object-thumb").remove();return}})})}function n(e){if(e.length>0){var t=Math.round(100/e.length);$.get(e.pop(),function(r){$("#m2w").css("width",t+"%");n(e)})}else{window.location.reload(true)}}b=$("<button />").addClass("button").css("padding","0px 0px 2px 20px").append('<span class="f"><i class="rl"></i><i class="bl"></i><i class="brc"></i><div class="c">Zdejmij<SP> / <SP>Ubierz<SP> / <SP>Jedz</div></span>').click(function(){e()}).insertAfter("dl#statistics-accordion >dd")},false);$("#statistics-accordion > dd").css("height","auto");var r,i,s,o,u,a;r="dl.vtabs div.object-thumbs";i=function(e){return $(e).parents("div.object-thumb").find("div.count")};$(r).each(function(){$(this).find("div.object-thumb img").each(function(){s=String(/(?=\/)?[a-zA-Z0-9-]+\.png$/g.exec(String($(this).attr("src"))));u=$(r).find("img[src*='"+s+"']");if(u.length>1){o=0;u.each(function(){a=i(this);if(!a.html()){o+=1}else{o+=Number(a.html().replace("#",""))}});if(!i(u[0]).html())$("<div class='count' />").insertAfter($(u[0]));i(u[0]).html("#"+o);u.not(":first").parents("div.object-thumb").remove();return}})});$(".inventary .count").css({color:"black",top:"40px"});$(".inventary .count").css("font-weight","bold");var f=parseInt($(".exp .bar .percent").css("width"));$(".exp").append(f-1+"%");$("ul.stats").css("cursor","pointer").attr("title","Siłownia VIP!").click(function(){document.location.href="/trainer/vip/"})}$.get("http://www.wawawars.pl/player/",function(e){if(/([0-9]+)\/([0-9]+)/.test($(e).find(".exp").text())){var t=parseInt(RegExp.$1,10);var n=parseInt(RegExp.$2,10);$(".pers-statistics .bars .exp").append(" <=>  "+(n-t)+"")}});$("div.side-invite").each(function(e,t){$(t).remove();var n=parseInt($(".life .bar .percent").css("width"));$("#personal .life").append(n-1+" % Życia");var n=parseInt($(".bars .life .percent").css("width"));$(".bars .life").append(n-1+" % Życia")});var p=0;$(".stats-cell").find("dd:first").find("div.label").each(function(e,t){p=p+parseInt($(t).find("span").text())});$(".stats-cell").find("dt:first div div").text("Statystyki: "+p);$("div.header").append('<br clear="all"/>');$("div.header").append('<div style="text-align:center;" id="wildwest-menu"></div>');$(".counters").remove();$(".footer").remove();$(".loading-top").remove();var p=new Array;p[0]=0;p[1]=0;$("ul.stats").each(function(e,t){$(t).find("div.label span.num").each(function(t,n){p[e]=parseInt(p[e])+parseInt($(n).text())})});var d=$(".fighter2 span.user a").text();var v=$(".result span.tugriki").text();var m='<br/><br/><br/><br/><form class="contacts-add" id="contactForm" name="contactForm" action="/phone/contacts/add/" method="post"><div class="block-bordered">';m=m+'<input class="name" type="hidden" name="name" value="'+d+'">';m=m+'<input class="comment" type="hidden" name="info" value="'+v+'"></td>';m=m+'<input class="comment" type="hidden" value="victim" name="type"></td>';m=m+'<button class="button" onclick="$(\'#contactForm\').trigger(\'submit\');"><span class="f"><i class="rl"></i><i class="bl"></i><i class="brc"></i><div class="c">Dodaj!</div></span></button></td>';m=m+"</form>";$(".viewanimation").before(c("Idź do Alejek","/alley/"));$(".viewanimation").after(m);var g='<form style="padding-left:5px;padding-right:15px;" action="/clan/profile/" name="massForm" id="massForm" class="clan-rupor" method="post">';g=g+'<input type="hidden" value="clan_message" name="action">';g=g+'<textarea  placeholder="Napisz wiadomość do kamratów" name="text" "></textarea><br/>'+h("Wyślij do wszystkich","button_szhertva")+"</form><br/>";$("#tutorial-pers").before(g);$("#button_szhertva").click(function(){$("#massForm").submit()});var y=parseInt(p[0])-parseInt(p[1])-10;if(y<0){$(".button-fight div.c").text("OSTROŻNIE!!!")}var w=$(".fighter1 span.level").text();var E=$(".fighter2 span.level").text();$(".fighter1 span.level").text(w+" - "+p[0]);$(".fighter2 span.level").text(E+" - "+p[1])});$g={$b:function(e){return $("<button class='button' style='margin-right:5px' />").append('<span class="f"><i class="rl"></i><i class="bl"></i><i class="brc"></i><div class="c">'+e+"</div></span>")},$e:function(){return $("<div />").addClass("exp").append("<div class='bar' style='width:100%'><div><div class='percent' style='width:0%'></div></div></div>")}};$t();if($("div[rel='block_step1']:visible"))$("tr[rel='clan2'] td:nth-child(2) a:last-child").each(function(){$(this).after("<u id='tim"+$(this).attr("href").substr(-6,5)+"'>...</u>");$.get($(this).attr("href"),function(e){var t=e.match(/\/([0-9a-f]+)\/animation/m);var n=e.match(/<br>(\d\d:\d\d:\d\d) \(/m);$("#tim"+t[1]).text(n[1])})});if($("div[rel='block_step2']:visible"))$("tr[rel='clan1'] td:nth-child(3) a:last-child").each(function(){$(this).after("<u id='tim"+$(this).attr("href").substr(-6,5)+"'>...</u>");$.get($(this).attr("href"),function(e){var t=e.match(/\/([0-9a-f]+)\/animation/m);var n=e.match(/<br>(\d\d:\d\d:\d\d) \(/m);$("#tim"+t[1]).text(n[1])})});$g={$b:function(e){return $("<button class='button' style='margin-right:5px' />").append('<span class="f"><i class="rl"></i><i class="bl"></i><i class="brc"></i><div class="c">'+e+"</div></span>")},$e:function(){return $("<div />").addClass("exp").append("<div class='bar' style='width:100%'><div><div class='percent' style='width:0%'></div></div></div>")}};$c();$("#servertime").before("<br><span style='position:absolute;left:1px'> <a href='/shop/'>Sklep</a> <a href='/berezka/'>101</a><a href='/shaurburgers/'>Praca</a><a href='/sovet/'>Rada</a> <a href='/bank/'>Bank</a> <a href='/automobile/ride/'>Wycieczka</a> <a href='/clan/profile/warstats/'>Wojna</a> </span> </span>");var b;window.addEventListener("load",function(){showFullInventory();b=$("<a />").addClass("button").append('<br><br><span class="f"><i class="rl"></i><i class="bl"></i><i class="brc"></i><div class="c">Zakupy</div></span><br>').click(function(){buyItemsWindowShow()}).insertAfter("#personal")},false);var source=function(){var e=parseInt($("span[rel='money']").text().replace(",",""));if(e>=750){var t=Math.floor(e/750);var n=$("input[name='ore']").closest("form").find("button[class='button']");var r='<button style="margin-top: 4px;" class="button" type="button">'+'<span class="f">'+'<i class="rl"></i>'+'<i class="bl"></i>'+'<i class="brc"></i>'+'<div class="c">Kup rudę za wszystkie monety. Dostaniesz  '+t+" rudy.</div>"+"</span>"+"</button>";var i=$(r);i.bind("click",t,function(){var e="Czy jesteś pewien, że chcesz kupić "+t+" rudy za wszystkie monety? Będzie cię to kosztować "+t*750+" syrenek. \n \n WawaWars GUI compilation by dlugi1920";if(window.confirm(e)){$("input[name='ore']").val(t).trigger("keyup");n.trigger("click")}});i.insertAfter("#bank-deposit-robbery")}};source="("+source+")();";var script=document.createElement("script");script.setAttribute("type","application/javascript");script.textContent=source;document.body.appendChild(script);document.body.removeChild(script);var clan_online=$("i.online").length;$("div.clan-members>h3").append(" / Online ("+clan_online+")");$(document).keydown(function(e){switch(e.which){case 117:var t=window.location.href;var n=t.slice(29,50);var r=parseInt(n)-1;var i="http://"+window.location.host+"/fight/"+r;window.location=i;break;case 118:var t=window.location.href;var n=t.slice(29,50);var r=parseInt(n)+1;var i="http://"+window.location.host+"/fight/"+r;window.location=i;break;default:return}e.preventDefault()});$("li.alive span.user i.resident").parent().css("color","#880000").find("a").css("color","#880000");$("li.dead span.user i.resident").parent().css("color","#880000").find("a").css("color","#880000");$("li.alive span.user i.arrived").parent().css("color","#008800").find("a").css("color","#008800");$("li.dead span.user i.arrived").parent().css("color","#008800").find("a").css("color","#008800");$("span.name-resident b").css("color","#880000");$("span.name-arrived b").css("color","#008800");var name=$("li.me.alive span.user a").text();var name2=$("li.me.dead span.user a").text();if($("li.me.alive").length){$("div.text p:contains('"+name+"')").not("p.killed").css("background-color","#FFD699");$("div.text p").find("span:eq(0):contains('"+name+"')").parent().not("p.killed").not("p.bang").css("background-color","#A3FFA3");$("div.text p").find("span:eq(1):contains('"+name+"')").parent().not("p.killed").not("p.bang").css("background-color","#A3FFA3");$("li.me.alive span.user a").css("color","#000099").parent().css("color","#000099");$("span.name-resident b:contains('"+name+"')").css("color","#000099");$("span.name-arrived b:contains('"+name+"')").css("color","#000099")}if($("li.me.dead").length){$("div.text p:contains('"+name2+"')").not("p.killed").css("background-color","#FFD699");$("div.text p").find("span:eq(0):contains('"+name2+"')").parent().not("p.killed").not("p.bang").css("background-color","#A3FFA3");$("div.text p").find("span:eq(1):contains('"+name2+"')").parent().not("p.killed").not("p.bang").css("background-color","#A3FFA3");$("li.me.dead span.user a").css("color","#000099").parent().css("color","#000099");$("span.name-resident b:contains('"+name2+"')").css("color","#000099");$("span.name-arrived b:contains('"+name2+"')").css("color","#000099")}