// ==UserScript==
// @name        Espia FL Chat
// @namespace   Juanix.net
// @description Script especial de Juanix para espiar el chat de FL
// @include     *www.forolockerz.com/*
// @require     http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js
// @version     1.0
// ==/UserScript==

/*
BACKBONE

html2canvas 0.4.0 <http://html2canvas.hertzen.com> 
Copyright (c) 2013 Niklas von Hertzen (@niklasvh) Released under MIT License 
*/
(function(j,l,d){var k={},g,c,h;function b(m){if(k.logging&&j.console&&j.console.log){j.console.log(m)}}k.Util={};k.Util.trimText=(function(m){return function(n){if(m){return m.apply(n)}else{return((n||"")+"").replace(/^\s+|\s+$/g,"")}}})(String.prototype.trim);k.Util.parseBackgroundImage=function(x){var o=" \r\n\t",n,p,u,B,q,s=[],w,t=0,y=0,m,v;var A=function(){if(n){if(p.substr(0,1)==='"'){p=p.substr(1,p.length-2)}if(p){v.push(p)}if(n.substr(0,1)==="-"&&(B=n.indexOf("-",1)+1)>0){u=n.substr(0,B);n=n.substr(B)}s.push({prefix:u,method:n.toLowerCase(),value:q,args:v})}v=[];n=u=p=q=""};A();for(var r=0,z=x.length;r<z;r++){w=x[r];if(t===0&&o.indexOf(w)>-1){continue}switch(w){case'"':if(!m){m=w}else{if(m===w){m=null}}break;case"(":if(m){break}else{if(t===0){t=1;q+=w;continue}else{y++}}break;case")":if(m){break}else{if(t===1){if(y===0){t=0;q+=w;A();continue}else{y--}}}break;case",":if(m){break}else{if(t===0){A();continue}else{if(t===1){if(y===0&&!n.match(/^url$/i)){v.push(p);p="";q+=w;continue}}}}break}q+=w;if(t===0){n+=w}else{p+=w}}A();return s};k.Util.Bounds=function i(m){var o,n={};if(m.getBoundingClientRect){o=m.getBoundingClientRect();n.top=o.top;n.bottom=o.bottom||(o.top+o.height);n.left=o.left;n.width=o.width||(o.right-o.left);n.height=o.height||(o.bottom-o.top);return n}};k.Util.getCSS=function(q,r,n){var s,o=r.match(/^background(Size|Position)$/);function p(v,x){var t=q.runtimeStyle&&q.runtimeStyle[v],w,u=q.style;if(!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(x)&&/^-?\d/.test(x)){w=u.left;if(t){q.runtimeStyle.left=q.currentStyle.left}u.left=v==="fontSize"?"1em":(x||0);x=u.pixelLeft+"px";u.left=w;if(t){q.runtimeStyle.left=t}}if(!/^(thin|medium|thick)$/i.test(x)){return Math.round(parseFloat(x))+"px"}return x}if(g!==q){c=l.defaultView.getComputedStyle(q,null)}s=c[r];if(o){s=(s||"").split(",");s=s[n||0]||s[0]||"auto";s=k.Util.trimText(s).split(" ");if(r==="backgroundSize"&&(!s[0]||s[0].match(/cover|contain|auto/))){}else{s[0]=(s[0].indexOf("%")===-1)?p(r+"X",s[0]):s[0];if(s[1]===d){if(r==="backgroundSize"){s[1]="auto";return s}else{s[1]=s[0]}}s[1]=(s[1].indexOf("%")===-1)?p(r+"Y",s[1]):s[1]}}else{if(/border(Top|Bottom)(Left|Right)Radius/.test(r)){var m=s.split(" ");if(m.length<=1){m[1]=m[0]}m[0]=parseInt(m[0],10);m[1]=parseInt(m[1],10);s=m}}return s};k.Util.resizeBounds=function(r,m,s,t,u){var p=s/t,o=r/m,n,q;if(!u||u==="auto"){n=s;q=t}else{if(p<o^u==="contain"){q=t;n=t*o}else{n=s;q=s/o}}return{width:n,height:q}};function f(n,p,m,t,o,w){var r=k.Util.getCSS(p,n,o),v,s,x,q;if(r.length===1){q=r[0];r=[];r[0]=q;r[1]=q}if(r[0].toString().indexOf("%")!==-1){x=(parseFloat(r[0])/100);s=m.width*x;if(n!=="backgroundSize"){s-=(w||t).width*x}}else{if(n==="backgroundSize"){if(r[0]==="auto"){s=t.width}else{if(r[0].match(/contain|cover/)){var u=k.Util.resizeBounds(t.width,t.height,m.width,m.height,r[0]);s=u.width;v=u.height}else{s=parseInt(r[0],10)}}}else{s=parseInt(r[0],10)}}if(r[1]==="auto"){v=s/t.width*t.height}else{if(r[1].toString().indexOf("%")!==-1){x=(parseFloat(r[1])/100);v=m.height*x;if(n!=="backgroundSize"){v-=(w||t).height*x}}else{v=parseInt(r[1],10)}}return[s,v]}k.Util.BackgroundPosition=function(p,q,r,n,o){var m=f("backgroundPosition",p,q,r,n,o);return{left:m[0],top:m[1]}};k.Util.BackgroundSize=function(o,p,q,n){var m=f("backgroundSize",o,p,q,n);return{width:m[0],height:m[1]}};k.Util.Extend=function(m,o){for(var n in m){if(m.hasOwnProperty(n)){o[n]=m[n]}}return o};k.Util.Children=function(o){var n;try{n=(o.nodeName&&o.nodeName.toUpperCase()==="IFRAME")?o.contentDocument||o.contentWindow.document:(function(q){var p=[];if(q!==null){(function(v,t){var u=v.length,s=0;if(typeof t.length==="number"){for(var r=t.length;s<r;s++){v[u++]=t[s]}}else{while(t[s]!==d){v[u++]=t[s++]}}v.length=u;return v})(p,q)}return p})(o.childNodes)}catch(m){b("html2canvas.Util.Children failed with exception: "+m.message);n=[]}return n};k.Util.Font=(function(){var m={};return function(p,w,t){if(m[p+"-"+w]!==d){return m[p+"-"+w]}var n=t.createElement("div"),q=t.createElement("img"),u=t.createElement("span"),o="Hidden Text",s,v,r;n.style.visibility="hidden";n.style.fontFamily=p;n.style.fontSize=w;n.style.margin=0;n.style.padding=0;t.body.appendChild(n);q.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=";q.width=1;q.height=1;q.style.margin=0;q.style.padding=0;q.style.verticalAlign="baseline";u.style.fontFamily=p;u.style.fontSize=w;u.style.margin=0;u.style.padding=0;u.appendChild(t.createTextNode(o));n.appendChild(u);n.appendChild(q);s=(q.offsetTop-u.offsetTop)+1;n.removeChild(u);n.appendChild(t.createTextNode(o));n.style.lineHeight="normal";q.style.verticalAlign="super";v=(q.offsetTop-n.offsetTop)+1;r={baseline:s,lineWidth:1,middle:v};m[p+"-"+w]=r;t.body.removeChild(n);return r}})();(function(){k.Generate={};var m=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];k.Generate.parseGradient=function(s,n){var w,r,t=m.length,B,v,y,o,q,x,A,u,z,p;for(r=0;r<t;r+=1){B=s.match(m[r]);if(B){break}}if(B){switch(B[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":w={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]};y=B[2].match(/\w+/g);if(y){o=y.length;for(r=0;r<o;r+=1){switch(y[r]){case"top":w.y0=0;w.y1=n.height;break;case"right":w.x0=n.width;w.x1=0;break;case"bottom":w.y0=n.height;w.y1=0;break;case"left":w.x0=0;w.x1=n.width;break}}}if(w.x0===null&&w.x1===null){w.x0=w.x1=n.width/2}if(w.y0===null&&w.y1===null){w.y0=w.y1=n.height/2}y=B[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g);if(y){o=y.length;q=1/Math.max(o-1,1);for(r=0;r<o;r+=1){x=y[r].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/);if(x[2]){v=parseFloat(x[2]);if(x[3]==="%"){v/=100}else{v/=n.width}}else{v=r*q}w.colorStops.push({color:x[1],stop:v})}}break;case"-webkit-gradient":w={type:B[2]==="radial"?"circle":B[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]};y=B[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/);if(y){w.x0=(y[1]*n.width)/100;w.y0=(y[2]*n.height)/100;w.x1=(y[3]*n.width)/100;w.y1=(y[4]*n.height)/100}y=B[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g);if(y){o=y.length;for(r=0;r<o;r+=1){x=y[r].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/);v=parseFloat(x[2]);if(x[1]==="from"){v=0}if(x[1]==="to"){v=1}w.colorStops.push({color:x[3],stop:v})}}break;case"-moz-linear-gradient":w={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]};y=B[2].match(/(\d{1,3})%?\s(\d{1,3})%?/);if(y){w.x0=(y[1]*n.width)/100;w.y0=(y[2]*n.height)/100;w.x1=n.width-w.x0;w.y1=n.height-w.y0}y=B[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g);if(y){o=y.length;q=1/Math.max(o-1,1);for(r=0;r<o;r+=1){x=y[r].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/);if(x[2]){v=parseFloat(x[2]);if(x[3]){v/=100}}else{v=r*q}w.colorStops.push({color:x[1],stop:v})}}break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":w={type:"circle",x0:0,y0:0,x1:n.width,y1:n.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]};y=B[2].match(/(\d{1,3})%?\s(\d{1,3})%?/);if(y){w.cx=(y[1]*n.width)/100;w.cy=(y[2]*n.height)/100}y=B[3].match(/\w+/);x=B[4].match(/[a-z\-]*/);if(y&&x){switch(x[0]){case"farthest-corner":case"cover":case"":A=Math.sqrt(Math.pow(w.cx,2)+Math.pow(w.cy,2));u=Math.sqrt(Math.pow(w.cx,2)+Math.pow(w.y1-w.cy,2));z=Math.sqrt(Math.pow(w.x1-w.cx,2)+Math.pow(w.y1-w.cy,2));p=Math.sqrt(Math.pow(w.x1-w.cx,2)+Math.pow(w.cy,2));w.rx=w.ry=Math.max(A,u,z,p);break;case"closest-corner":A=Math.sqrt(Math.pow(w.cx,2)+Math.pow(w.cy,2));u=Math.sqrt(Math.pow(w.cx,2)+Math.pow(w.y1-w.cy,2));z=Math.sqrt(Math.pow(w.x1-w.cx,2)+Math.pow(w.y1-w.cy,2));p=Math.sqrt(Math.pow(w.x1-w.cx,2)+Math.pow(w.cy,2));w.rx=w.ry=Math.min(A,u,z,p);break;case"farthest-side":if(y[0]==="circle"){w.rx=w.ry=Math.max(w.cx,w.cy,w.x1-w.cx,w.y1-w.cy)}else{w.type=y[0];w.rx=Math.max(w.cx,w.x1-w.cx);w.ry=Math.max(w.cy,w.y1-w.cy)}break;case"closest-side":case"contain":if(y[0]==="circle"){w.rx=w.ry=Math.min(w.cx,w.cy,w.x1-w.cx,w.y1-w.cy)}else{w.type=y[0];w.rx=Math.min(w.cx,w.x1-w.cx);w.ry=Math.min(w.cy,w.y1-w.cy)}break}}y=B[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g);if(y){o=y.length;q=1/Math.max(o-1,1);for(r=0;r<o;r+=1){x=y[r].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/);if(x[2]){v=parseFloat(x[2]);if(x[3]==="%"){v/=100}else{v/=n.width}}else{v=r*q}w.colorStops.push({color:x[1],stop:v})}}break}}return w};k.Generate.Gradient=function(n,o){if(o.width===0||o.height===0){return}var q=l.createElement("canvas"),A=q.getContext("2d"),y,z,s,t;q.width=o.width;q.height=o.height;y=k.Generate.parseGradient(n,o);if(y){if(y.type==="linear"){z=A.createLinearGradient(y.x0,y.y0,y.x1,y.y1);for(s=0,t=y.colorStops.length;s<t;s+=1){try{z.addColorStop(y.colorStops[s].stop,y.colorStops[s].color)}catch(u){b(["failed to add color stop: ",u,"; tried to add: ",y.colorStops[s],"; stop: ",s,"; in: ",n])}}A.fillStyle=z;A.fillRect(0,0,o.width,o.height)}else{if(y.type==="circle"){z=A.createRadialGradient(y.cx,y.cy,0,y.cx,y.cy,y.rx);for(s=0,t=y.colorStops.length;s<t;s+=1){try{z.addColorStop(y.colorStops[s].stop,y.colorStops[s].color)}catch(u){b(["failed to add color stop: ",u,"; tried to add: ",y.colorStops[s],"; stop: ",s,"; in: ",n])}}A.fillStyle=z;A.fillRect(0,0,o.width,o.height)}else{if(y.type==="ellipse"){var r=l.createElement("canvas"),p=r.getContext("2d"),x=Math.max(y.rx,y.ry),w=x*2,v;r.width=r.height=w;z=p.createRadialGradient(y.rx,y.ry,0,y.rx,y.ry,x);for(s=0,t=y.colorStops.length;s<t;s+=1){try{z.addColorStop(y.colorStops[s].stop,y.colorStops[s].color)}catch(u){b(["failed to add color stop: ",u,"; tried to add: ",y.colorStops[s],"; stop: ",s,"; in: ",n])}}p.fillStyle=z;p.fillRect(0,0,w,w);A.fillStyle=y.colorStops[s-1].color;A.fillRect(0,0,q.width,q.height);A.drawImage(r,y.cx-y.rx,y.cy-y.ry,2*y.rx,2*y.ry)}}}}return q};k.Generate.ListAlpha=function(p){var o="",n;do{n=p%26;o=String.fromCharCode((n)+64)+o;p=p/26}while((p*26)>26);return o};k.Generate.ListRoman=function(r){var q=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],o=[1000,900,500,400,100,90,50,40,10,9,5,4,1],s="",p,n=q.length;if(r<=0||r>=4000){return r}for(p=0;p<n;p+=1){while(r>=o[p]){r-=o[p];s+=q[p]}}return s}})();function e(n,m){var o=[];return{storage:o,width:n,height:m,clip:function(){o.push({type:"function",name:"clip","arguments":arguments})},translate:function(){o.push({type:"function",name:"translate","arguments":arguments})},fill:function(){o.push({type:"function",name:"fill","arguments":arguments})},save:function(){o.push({type:"function",name:"save","arguments":arguments})},restore:function(){o.push({type:"function",name:"restore","arguments":arguments})},fillRect:function(){o.push({type:"function",name:"fillRect","arguments":arguments})},createPattern:function(){o.push({type:"function",name:"createPattern","arguments":arguments})},drawShape:function(){var p=[];o.push({type:"function",name:"drawShape","arguments":p});return{moveTo:function(){p.push({name:"moveTo","arguments":arguments})},lineTo:function(){p.push({name:"lineTo","arguments":arguments})},arcTo:function(){p.push({name:"arcTo","arguments":arguments})},bezierCurveTo:function(){p.push({name:"bezierCurveTo","arguments":arguments})},quadraticCurveTo:function(){p.push({name:"quadraticCurveTo","arguments":arguments})}}},drawImage:function(){o.push({type:"function",name:"drawImage","arguments":arguments})},fillText:function(){o.push({type:"function",name:"fillText","arguments":arguments})},setVariable:function(p,q){o.push({type:"variable",name:p,"arguments":q})}}}k.Parse=function(t,Y){j.scroll(0,0);var J=((Y.elements===d)?l.body:Y.elements[0]),u=0,x=J.ownerDocument,ak=k.Util.Support(Y,x),ag=new RegExp("("+Y.ignoreElements+")"),V=x.body,T=k.Util.getCSS,N="___html2canvas___pseudoelement",M=x.createElement("style");M.innerHTML="."+N+'-before:before { content: "" !important; display: none !important; }.'+N+'-after:after { content: "" !important; display: none !important; }';V.appendChild(M);t=t||{};function ai(){return Math.max(Math.max(x.body.scrollWidth,x.documentElement.scrollWidth),Math.max(x.body.offsetWidth,x.documentElement.offsetWidth),Math.max(x.body.clientWidth,x.documentElement.clientWidth))}function H(){return Math.max(Math.max(x.body.scrollHeight,x.documentElement.scrollHeight),Math.max(x.body.offsetHeight,x.documentElement.offsetHeight),Math.max(x.body.clientHeight,x.documentElement.clientHeight))}function U(ax,ay){var az=parseInt(T(ax,ay),10);return(isNaN(az))?0:az}function at(aA,ax,aC,az,aB,ay){if(ay!=="transparent"){aA.setVariable("fillStyle",ay);aA.fillRect(ax,aC,az,aB);u+=1}}function w(ay,ax){switch(ax){case"lowercase":return ay.toLowerCase();case"capitalize":return ay.replace(/(^|\s|:|-|\(|\))([a-z])/g,function(az,aB,aA){if(az.length>0){return aB+aA.toUpperCase()}});case"uppercase":return ay.toUpperCase();default:return ay}}function ae(ax){return(/^(normal|none|0px)$/.test(ax))}function m(az,ax,aA,ay){if(az!==null&&k.Util.trimText(az).length>0){ay.fillText(az,ax,aA);u+=1}}function P(ax,aC,aD,ay){var aE=false,aA=T(aC,"fontWeight"),aB=T(aC,"fontFamily"),az=T(aC,"fontSize");switch(parseInt(aA,10)){case 401:aA="bold";break;case 400:aA="normal";break}ax.setVariable("fillStyle",ay);ax.setVariable("font",[T(aC,"fontStyle"),T(aC,"fontVariant"),aA,az,aB].join(" "));ax.setVariable("textAlign",(aE)?"right":"left");if(aD!=="none"){return k.Util.Font(aB,az,x)}}function K(ax,aB,aA,az,ay){switch(aB){case"underline":at(ax,aA.left,Math.round(aA.top+az.baseline+az.lineWidth),aA.width,1,ay);break;case"overline":at(ax,aA.left,Math.round(aA.top),aA.width,1,ay);break;case"line-through":at(ax,aA.left,Math.ceil(aA.top+az.middle+az.lineWidth),aA.width,1,ay);break}}function aa(aA,aC,aB,az){var ay;if(ak.rangeBounds){if(aB!=="none"||k.Util.trimText(aC).length!==0){ay=Z(aC,aA.node,aA.textOffset)}aA.textOffset+=aC.length}else{if(aA.node&&typeof aA.node.nodeValue==="string"){var ax=(az)?aA.node.splitText(aC.length):null;ay=ad(aA.node);aA.node=ax}}return ay}function Z(aA,az,ay){var ax=x.createRange();ax.setStart(az,ay);ax.setEnd(az,ay+aA.length);return ax.getBoundingClientRect()}function ad(ax){var ay=ax.parentNode,aB=x.createElement("wrapper"),aA=ax.cloneNode(true);aB.appendChild(ax.cloneNode(true));ay.replaceChild(aB,ax);var az=k.Util.Bounds(aB);ay.replaceChild(aA,aB);return az}function aq(az,aA,aE){var aF=aE.ctx,aB=T(az,"color"),aG=T(az,"textDecoration"),ay=T(az,"textAlign"),aD,aC,ax={node:aA,textOffset:0};if(k.Util.trimText(aA.nodeValue).length>0){aA.nodeValue=w(aA.nodeValue,T(az,"textTransform"));ay=ay.replace(["-webkit-auto"],["auto"]);aC=(!Y.letterRendering&&/^(left|right|justify|auto)$/.test(ay)&&ae(T(az,"letterSpacing")))?aA.nodeValue.split(/(\b| )/):aA.nodeValue.split("");aD=P(aF,az,aG,aB);if(Y.chinese){aC.forEach(function(aI,aH){if(/.*[\u4E00-\u9FA5].*$/.test(aI)){aI=aI.split("");aI.unshift(aH,1);aC.splice.apply(aC,aI)}})}aC.forEach(function(aJ,aH){var aI=aa(ax,aJ,aG,(aH<aC.length-1));if(aI){m(aJ,aI.left,aI.bottom,aF);K(aF,aG,aI,aD,aB)}})}}function ac(ax,aB){var aA=x.createElement("boundelement"),ay,az;aA.style.display="inline";ay=ax.style.listStyleType;ax.style.listStyleType="none";aA.appendChild(x.createTextNode(aB));ax.insertBefore(aA,ax.firstChild);az=k.Util.Bounds(aA);ax.removeChild(aA);ax.style.listStyleType=ay;return az}function Q(ay){var ax=-1,az=1,aA=ay.parentNode.childNodes;if(ay.parentNode){while(aA[++ax]!==ay){if(aA[ax].nodeType===1){az++}}return az}else{return -1}}function p(ay,az){var ax=Q(ay),aA;switch(az){case"decimal":aA=ax;break;case"decimal-leading-zero":aA=(ax.toString().length===1)?ax="0"+ax.toString():ax.toString();break;case"upper-roman":aA=k.Generate.ListRoman(ax);break;case"lower-roman":aA=k.Generate.ListRoman(ax).toLowerCase();break;case"lower-alpha":aA=k.Generate.ListAlpha(ax).toLowerCase();break;case"upper-alpha":aA=k.Generate.ListAlpha(ax);break}aA+=". ";return aA}function ah(aA,ay,aD){var ax,aE,az=ay.ctx,aB=T(aA,"listStyleType"),aC;if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(aB)){aE=p(aA,aB);aC=ac(aA,aE);P(az,aA,"none",T(aA,"color"));if(T(aA,"listStylePosition")==="inside"){az.setVariable("textAlign","left");ax=aD.left}else{return}m(aE,ax,aC.bottom,az)}}function S(ay){var ax=t[ay];if(ax&&ax.succeeded===true){return ax.img}else{return false}}function A(aA,aC){var ax=Math.max(aA.left,aC.left),aB=Math.max(aA.top,aC.top),ay=Math.min((aA.left+aA.width),(aC.left+aC.width)),az=Math.min((aA.top+aA.height),(aC.top+aC.height));return{left:ax,top:aB,width:ay-ax,height:az-aB}}function aj(az,ax){var ay;if(!ax){ay=a(0);return ay}if(az!=="auto"){ay=a(az);ax.children.push(ay);return ay}return ax}function R(aF,aC,aB,ax,aD){var aA=U(aC,"paddingLeft"),aE=U(aC,"paddingTop"),az=U(aC,"paddingRight"),ay=U(aC,"paddingBottom");o(aF,aB,0,0,aB.width,aB.height,ax.left+aA+aD[3].width,ax.top+aE+aD[0].width,ax.width-(aD[1].width+aD[3].width+aA+az),ax.height-(aD[0].width+aD[2].width+aE+ay))}function y(ax){return["Top","Right","Bottom","Left"].map(function(ay){return{width:U(ax,"border"+ay+"Width"),color:T(ax,"border"+ay+"Color")}})}function n(ax){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(ay){return T(ax,"border"+ay+"Radius")})}var C=(function(ax){return function(az,aF,aD,aB){var aC=(aD)*ax,aA=(aB)*ax,aE=az+aD,ay=aF+aB;return{topLeft:aw({x:az,y:ay},{x:az,y:ay-aA},{x:aE-aC,y:aF},{x:aE,y:aF}),topRight:aw({x:az,y:aF},{x:az+aC,y:aF},{x:aE,y:ay-aA},{x:aE,y:ay}),bottomRight:aw({x:aE,y:aF},{x:aE,y:aF+aA},{x:az+aC,y:ay},{x:az,y:ay}),bottomLeft:aw({x:aE,y:ay},{x:aE-aC,y:ay},{x:az,y:aF+aA},{x:az,y:aF})}}})(4*((Math.sqrt(2)-1)/3));function aw(aB,aA,az,ax){var ay=function(aD,aC,aE){return{x:aD.x+(aC.x-aD.x)*aE,y:aD.y+(aC.y-aD.y)*aE}};return{start:aB,startControl:aA,endControl:az,end:ax,subdivide:function(aE){var aG=ay(aB,aA,aE),aH=ay(aA,az,aE),aI=ay(az,ax,aE),aF=ay(aG,aH,aE),aC=ay(aH,aI,aE),aD=ay(aF,aC,aE);return[aw(aB,aG,aF,aD),aw(aD,aC,aI,ax)]},curveTo:function(aC){aC.push(["bezierCurve",aA.x,aA.y,az.x,az.y,ax.x,ax.y])},curveToReversed:function(aC){aC.push(["bezierCurve",az.x,az.y,aA.x,aA.y,aB.x,aB.y])}}}function av(aB,aC,aA,az,ay,ax,aD){if(aC[0]>0||aC[1]>0){aB.push(["line",az[0].start.x,az[0].start.y]);az[0].curveTo(aB);az[1].curveTo(aB)}else{aB.push(["line",ax,aD])}if(aA[0]>0||aA[1]>0){aB.push(["line",ay[0].start.x,ay[0].start.y])}}function ao(aD,aB,aA,aE,ay,aC,ax){var az=[];if(aB[0]>0||aB[1]>0){az.push(["line",aE[1].start.x,aE[1].start.y]);aE[1].curveTo(az)}else{az.push(["line",aD.c1[0],aD.c1[1]])}if(aA[0]>0||aA[1]>0){az.push(["line",aC[0].start.x,aC[0].start.y]);aC[0].curveTo(az);az.push(["line",ax[0].end.x,ax[0].end.y]);ax[0].curveToReversed(az)}else{az.push(["line",aD.c2[0],aD.c2[1]]);az.push(["line",aD.c3[0],aD.c3[1]])}if(aB[0]>0||aB[1]>0){az.push(["line",ay[1].end.x,ay[1].end.y]);ay[1].curveToReversed(az)}else{az.push(["line",aD.c4[0],aD.c4[1]])}return az}function s(aA,ax,az){var aE=aA.left,aB=aA.top,aJ=aA.width,aI=aA.height,aK=ax[0][0],aD=ax[0][1],aN=ax[1][0],aG=ax[1][1],aH=ax[2][0],aO=ax[2][1],aM=ax[3][0],aF=ax[3][1],aC=aJ-aN,aP=aI-aH,ay=aJ-aO,aL=aI-aF;return{topLeftOuter:C(aE,aB,aK,aD).topLeft.subdivide(0.5),topLeftInner:C(aE+az[3].width,aB+az[0].width,Math.max(0,aK-az[3].width),Math.max(0,aD-az[0].width)).topLeft.subdivide(0.5),topRightOuter:C(aE+aC,aB,aN,aG).topRight.subdivide(0.5),topRightInner:C(aE+Math.min(aC,aJ+az[3].width),aB+az[0].width,(aC>aJ+az[3].width)?0:aN-az[3].width,aG-az[0].width).topRight.subdivide(0.5),bottomRightOuter:C(aE+ay,aB+aP,aO,aH).bottomRight.subdivide(0.5),bottomRightInner:C(aE+Math.min(ay,aJ+az[3].width),aB+Math.min(aP,aI+az[0].width),Math.max(0,aO-az[1].width),Math.max(0,aH-az[2].width)).bottomRight.subdivide(0.5),bottomLeftOuter:C(aE,aB+aL,aM,aF).bottomLeft.subdivide(0.5),bottomLeftInner:C(aE+az[3].width,aB+aL,Math.max(0,aM-az[3].width),Math.max(0,aF-az[2].width)).bottomLeft.subdivide(0.5)}}function ar(aA,aC,aD,ax,aB){var az=T(aA,"backgroundClip"),ay=[];switch(az){case"content-box":case"padding-box":av(ay,ax[0],ax[1],aC.topLeftInner,aC.topRightInner,aB.left+aD[3].width,aB.top+aD[0].width);av(ay,ax[1],ax[2],aC.topRightInner,aC.bottomRightInner,aB.left+aB.width-aD[1].width,aB.top+aD[0].width);av(ay,ax[2],ax[3],aC.bottomRightInner,aC.bottomLeftInner,aB.left+aB.width-aD[1].width,aB.top+aB.height-aD[2].width);av(ay,ax[3],ax[0],aC.bottomLeftInner,aC.topLeftInner,aB.left+aD[3].width,aB.top+aB.height-aD[2].width);break;default:av(ay,ax[0],ax[1],aC.topLeftOuter,aC.topRightOuter,aB.left,aB.top);av(ay,ax[1],ax[2],aC.topRightOuter,aC.bottomRightOuter,aB.left+aB.width,aB.top);av(ay,ax[2],ax[3],aC.bottomRightOuter,aC.bottomLeftOuter,aB.left+aB.width,aB.top+aB.height);av(ay,ax[3],ax[0],aC.bottomLeftOuter,aC.topLeftOuter,aB.left,aB.top+aB.height);break}return ay}function X(aD,ay,aG){var aK=ay.left,aJ=ay.top,aA=ay.width,aM=ay.height,az,aH,aF,aI,aC,ax,aB=n(aD),aE=s(ay,aB,aG),aL={clip:ar(aD,aE,aG,aB,ay),borders:[]};for(az=0;az<4;az++){if(aG[az].width>0){aH=aK;aF=aJ;aI=aA;aC=aM-(aG[2].width);switch(az){case 0:aC=aG[0].width;ax=ao({c1:[aH,aF],c2:[aH+aI,aF],c3:[aH+aI-aG[1].width,aF+aC],c4:[aH+aG[3].width,aF+aC]},aB[0],aB[1],aE.topLeftOuter,aE.topLeftInner,aE.topRightOuter,aE.topRightInner);break;case 1:aH=aK+aA-(aG[1].width);aI=aG[1].width;ax=ao({c1:[aH+aI,aF],c2:[aH+aI,aF+aC+aG[2].width],c3:[aH,aF+aC],c4:[aH,aF+aG[0].width]},aB[1],aB[2],aE.topRightOuter,aE.topRightInner,aE.bottomRightOuter,aE.bottomRightInner);break;case 2:aF=(aF+aM)-(aG[2].width);aC=aG[2].width;ax=ao({c1:[aH+aI,aF+aC],c2:[aH,aF+aC],c3:[aH+aG[3].width,aF],c4:[aH+aI-aG[2].width,aF]},aB[2],aB[3],aE.bottomRightOuter,aE.bottomRightInner,aE.bottomLeftOuter,aE.bottomLeftInner);break;case 3:aI=aG[3].width;ax=ao({c1:[aH,aF+aC+aG[2].width],c2:[aH,aF],c3:[aH+aI,aF+aG[0].width],c4:[aH+aI,aF+aC]},aB[3],aB[0],aE.bottomLeftOuter,aE.bottomLeftInner,aE.topLeftOuter,aE.topLeftInner);break}aL.borders.push({args:ax,color:aG[az].color})}}return aL}function q(ax,az){var ay=ax.drawShape();az.forEach(function(aB,aA){ay[(aA===0)?"moveTo":aB[0]+"To"].apply(null,aB.slice(1))});return ay}function G(ax,az,ay){if(ay!=="transparent"){ax.setVariable("fillStyle",ay);q(ax,az);ax.fill();u+=1}}function am(aA,aB,ay){var aD=x.createElement("valuewrap"),az=["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"],ax,aC;az.forEach(function(aE){try{aD.style[aE]=T(aA,aE)}catch(aF){b("html2canvas: Parse: Exception caught in renderFormValue: "+aF.message)}});aD.style.borderColor="black";aD.style.borderStyle="solid";aD.style.display="block";aD.style.position="absolute";if(/^(submit|reset|button|text|password)$/.test(aA.type)||aA.nodeName==="SELECT"){aD.style.lineHeight=T(aA,"height")}aD.style.top=aB.top+"px";aD.style.left=aB.left+"px";ax=(aA.nodeName==="SELECT")?(aA.options[aA.selectedIndex]||0).text:aA.value;if(!ax){ax=aA.placeholder}aC=x.createTextNode(ax);aD.appendChild(aC);V.appendChild(aD);aq(aA,aC,ay);V.removeChild(aD)}function o(ax){ax.drawImage.apply(ax,Array.prototype.slice.call(arguments,1));u+=1}function I(az,aC){var ay=j.getComputedStyle(az,aC);if(!ay||!ay.content||ay.content==="none"||ay.content==="-moz-alt-content"){return}var aA=ay.content+"",aB=aA.substr(0,1);if(aB===aA.substr(aA.length-1)&&aB.match(/'|"/)){aA=aA.substr(1,aA.length-2)}var aD=aA.substr(0,3)==="url",ax=l.createElement(aD?"img":"span");ax.className=N+"-before "+N+"-after";Object.keys(ay).filter(D).forEach(function(aF){try{ax.style[aF]=ay[aF]}catch(aE){b(["Tried to assign readonly property ",aF,"Error:",aE])}});if(aD){ax.src=k.Util.parseBackgroundImage(aA)[0].args[0]}else{ax.innerHTML=aA}return ax}function D(ax){return(isNaN(j.parseInt(ax,10)))}function r(ay,ax){var az=I(ay,":before"),aA=I(ay,":after");if(!az&&!aA){return}if(az){ay.className+=" "+N+"-before";ay.parentNode.insertBefore(az,ay);W(az,ax,true);ay.parentNode.removeChild(az);ay.className=ay.className.replace(N+"-before","").trim()}if(aA){ay.className+=" "+N+"-after";ay.appendChild(aA);W(aA,ax,true);ay.removeChild(aA);ay.className=ay.className.replace(N+"-after","").trim()}}function af(ay,aB,az,aA){var ax=Math.round(aA.left+az.left),aC=Math.round(aA.top+az.top);ay.createPattern(aB);ay.translate(ax,aC);ay.fill();ay.translate(-ax,-aC)}function al(aF,aB,az,ax,aA,aD,ay,aE){var aC=[];aC.push(["line",Math.round(aA),Math.round(aD)]);aC.push(["line",Math.round(aA+ay),Math.round(aD)]);aC.push(["line",Math.round(aA+ay),Math.round(aE+aD)]);aC.push(["line",Math.round(aA),Math.round(aE+aD)]);q(aF,aC);aF.save();aF.clip();af(aF,aB,az,ax);aF.restore()}function O(ay,az,ax){at(ay,az.left,az.top,az.width,az.height,ax)}function v(aB,aC,ay,aE,ax){var az=k.Util.BackgroundSize(aB,aC,aE,ax),aA=k.Util.BackgroundPosition(aB,aC,aE,ax,az),aD=T(aB,"backgroundRepeat").split(",").map(function(aF){return aF.trim()});aE=E(aE,az);aD=aD[ax]||aD[0];switch(aD){case"repeat-x":al(ay,aE,aA,aC,aC.left,aC.top+aA.top,99999,aE.height);break;case"repeat-y":al(ay,aE,aA,aC,aC.left+aA.left,aC.top,aE.width,99999);break;case"no-repeat":al(ay,aE,aA,aC,aC.left+aA.left,aC.top+aA.top,aE.width,aE.height);break;default:af(ay,aE,aA,{top:aC.top,left:aC.left,width:aE.width,height:aE.height});break}}function au(aB,aC,az){var aE=T(aB,"backgroundImage"),ay=k.Util.parseBackgroundImage(aE),aD,ax=ay.length;while(ax--){aE=ay[ax];if(!aE.args||aE.args.length===0){continue}var aA=aE.method==="url"?aE.args[0]:aE.value;aD=S(aA);if(aD){v(aB,aC,az,aD,ax)}else{b("html2canvas: Error loading background:",aE)}}}function E(aA,az){if(aA.width===az.width&&aA.height===az.height){return aA}var ax,ay=x.createElement("canvas");ay.width=az.width;ay.height=az.height;ax=ay.getContext("2d");o(ax,aA,0,0,aA.width,aA.height,0,0,az.width,az.height);return ay}function an(ay,aA,ax){var az=T(aA,"opacity")*((ax)?ax.opacity:1);ay.setVariable("globalAlpha",az);return az}function z(aA,ay,aB){var az=e((!ay)?ai():aB.width,(!ay)?H():aB.height),ax={ctx:az,zIndex:aj(T(aA,"zIndex"),(ay)?ay.zIndex:null),opacity:an(az,aA,ay),cssPosition:T(aA,"position"),borders:y(aA),clip:(ay&&ay.clip)?k.Util.Extend({},ay.clip):null};if(Y.useOverflow===true&&/(hidden|scroll|auto)/.test(T(aA,"overflow"))===true&&/(BODY)/i.test(aA.nodeName)===false){ax.clip=(ax.clip)?A(ax.clip,aB):aB}ax.zIndex.children.push(ax);return ax}function B(aA,ay,ax){var az={left:ay.left+aA[3].width,top:ay.top+aA[0].width,width:ay.width-(aA[1].width+aA[3].width),height:ay.height-(aA[0].width+aA[2].width)};if(ax){az=A(az,ax)}return az}function F(aB,aC,aA){var ax=k.Util.Bounds(aB),az,aH=(ag.test(aB.nodeName))?"#efefef":T(aB,"backgroundColor"),aE=z(aB,aC,ax),aD=aE.borders,aG=aE.ctx,ay=B(aD,ax,aE.clip),aF=X(aB,ax,aD);q(aG,aF.clip);aG.save();aG.clip();if(ay.height>0&&ay.width>0){O(aG,ax,aH);au(aB,ay,aG)}aG.restore();aF.borders.forEach(function(aI){G(aG,aI.args,aI.color)});if(!aA){r(aB,aE)}switch(aB.nodeName){case"IMG":if((az=S(aB.getAttribute("src")))){R(aG,aB,az,ax,aD)}else{b("html2canvas: Error loading <img>:"+aB.getAttribute("src"))}break;case"INPUT":if(/^(text|url|email|submit|button|reset)$/.test(aB.type)&&(aB.value||aB.placeholder).length>0){am(aB,ax,aE)}break;case"TEXTAREA":if((aB.value||aB.placeholder||"").length>0){am(aB,ax,aE)}break;case"SELECT":if((aB.options||aB.placeholder||"").length>0){am(aB,ax,aE)}break;case"LI":ah(aB,aE,ay);break;case"CANVAS":R(aG,aB,aB,ax,aD);break}return aE}function ab(ax){return(T(ax,"display")!=="none"&&T(ax,"visibility")!=="hidden"&&!ax.hasAttribute("data-html2canvas-ignore"))}function W(ay,ax,az){if(ab(ay)){ax=F(ay,ax,az)||ax;if(!ag.test(ay.nodeName)){k.Util.Children(ay).forEach(function(aA){if(aA.nodeType===1){W(aA,ax,az)}else{if(aA.nodeType===3){aq(ay,aA,ax)}}})}}}function L(ay,ax){var aA=new Image(),aB=ai(),az=H(),aC="";function aD(aJ){var aI=k.Util.Children(aJ),aF=aI.length,aE,aG,aK,aL,aH;for(aH=0;aH<aF;aH+=1){aL=aI[aH];if(aL.nodeType===3){aC+=aL.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;")}else{if(aL.nodeType===1){if(!/^(script|meta|title)$/.test(aL.nodeName.toLowerCase())){aC+="<"+aL.nodeName.toLowerCase();if(aL.hasAttributes()){aE=aL.attributes;aK=aE.length;for(aG=0;aG<aK;aG+=1){aC+=" "+aE[aG].name+'="'+aE[aG].value+'"'}}aC+=">";aD(aL);aC+="</"+aL.nodeName.toLowerCase()+">"}}}}}aD(ay);aA.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='"+aB+"' height='"+az+"'>","<foreignObject width='"+aB+"' height='"+az+"'>","<html xmlns='http://www.w3.org/1999/xhtml' style='margin:0;'>",aC.replace(/\#/g,"%23"),"</html>","</foreignObject>","</svg>"].join("");aA.onload=function(){ax.svgRender=aA}}function ap(){var ax=F(J,null);if(ak.svgRendering){L(l.documentElement,ax)}Array.prototype.slice.call(J.children,0).forEach(function(ay){W(ay,ax)});ax.backgroundColor=T(l.documentElement,"backgroundColor");V.removeChild(M);return ax}return ap()};function a(m){return{zindex:m,children:[]}}k.Preload=function(p){var x={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:false},F,G,E,r=0,n=p.elements[0]||l.body,I=n.ownerDocument,w=I.images,y=w.length,s=I.createElement("a"),v=(function(J){return(J.crossOrigin!==d)})(new Image()),A;s.href=j.location.href;F=s.protocol+s.host;function H(K){s.href=K;s.href=s.href;var J=s.protocol+s.host;return(J===F)}function q(){b("html2canvas: start: images: "+x.numLoaded+" / "+x.numTotal+" (failed: "+x.numFailed+")");if(!x.firstRun&&x.numLoaded>=x.numTotal){b("Finished loading images: # "+x.numTotal+" (failed: "+x.numFailed+")");if(typeof p.complete==="function"){p.complete(x)}}}function z(M,L,N){var J,O=p.proxy,K;s.href=M;M=s.href;J="html2canvas_"+(r++);N.callbackname=J;if(O.indexOf("?")>-1){O+="&"}else{O+="?"}O+="url="+encodeURIComponent(M)+"&callback="+J;K=I.createElement("script");j[J]=function(P){if(P.substring(0,6)==="error:"){N.succeeded=false;x.numLoaded++;x.numFailed++;q()}else{D(L,N);L.src=P}j[J]=d;try{delete j[J]}catch(Q){}K.parentNode.removeChild(K);K=null;delete N.script;delete N.callbackname};K.setAttribute("type","text/javascript");K.setAttribute("src",O);N.script=K;j.document.body.appendChild(K)}function u(J,L){var K=j.getComputedStyle(J,L),M=K.content;if(M.substr(0,3)==="url"){G.loadImage(k.Util.parseBackgroundImage(M)[0].args[0])}C(K.backgroundImage,J)}function B(J){u(J,":before");u(J,":after")}function o(L,K){var J=k.Generate.Gradient(L,K);if(J!==d){x[L]={img:J,succeeded:true};x.numTotal++;x.numLoaded++;q()}}function m(J){return(J&&J.method&&J.args&&J.args.length>0)}function C(K,J){var L;k.Util.parseBackgroundImage(K).filter(m).forEach(function(M){if(M.method==="url"){G.loadImage(M.args[0])}else{if(M.method.match(/\-?gradient$/)){if(L===d){L=k.Util.Bounds(J)}o(M.value,L)}}})}function t(L){var J=false;try{k.Util.Children(L).forEach(function(N){t(N)})}catch(M){}try{J=L.nodeType}catch(K){J=false;b("html2canvas: failed to access some element's nodeType - Exception: "+K.message)}if(J===1||J===d){B(L);try{C(k.Util.getCSS(L,"backgroundImage"),L)}catch(M){b("html2canvas: failed to get background-image - Exception: "+M.message)}C(L)}}function D(J,K){J.onload=function(){if(K.timer!==d){j.clearTimeout(K.timer)}x.numLoaded++;K.succeeded=true;J.onerror=J.onload=null;q()};J.onerror=function(){if(J.crossOrigin==="anonymous"){j.clearTimeout(K.timer);if(p.proxy){var L=J.src;J=new Image();K.img=J;J.src=L;z(J.src,J,K);return}}x.numLoaded++;x.numFailed++;K.succeeded=false;J.onerror=J.onload=null;q()}}G={loadImage:function(L){var J,K;if(L&&x[L]===d){J=new Image();if(L.match(/data:image\/.*;base64,/i)){J.src=L.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,"");K=x[L]={img:J};x.numTotal++;D(J,K)}else{if(H(L)||p.allowTaint===true){K=x[L]={img:J};x.numTotal++;D(J,K);J.src=L}else{if(v&&!p.allowTaint&&p.useCORS){J.crossOrigin="anonymous";K=x[L]={img:J};x.numTotal++;D(J,K);J.src=L;J.customComplete=function(){if(!this.img.complete){this.timer=j.setTimeout(this.img.customComplete,100)}else{this.img.onerror()}}.bind(K);J.customComplete()}else{if(p.proxy){K=x[L]={img:J};x.numTotal++;z(L,J,K)}}}}}},cleanupDOM:function(L){var J,M;if(!x.cleanupDone){if(L&&typeof L==="string"){b("html2canvas: Cleanup because: "+L)}else{b("html2canvas: Cleanup after timeout: "+p.timeout+" ms.")}for(M in x){if(x.hasOwnProperty(M)){J=x[M];if(typeof J==="object"&&J.callbackname&&J.succeeded===d){j[J.callbackname]=d;try{delete j[J.callbackname]}catch(K){}if(J.script&&J.script.parentNode){J.script.setAttribute("src","about:blank");J.script.parentNode.removeChild(J.script)}x.numLoaded++;x.numFailed++;b("html2canvas: Cleaned up failed img: '"+M+"' Steps: "+x.numLoaded+" / "+x.numTotal)}}}if(j.stop!==d){j.stop()}else{if(l.execCommand!==d){l.execCommand("Stop",false)}}if(l.close!==d){l.close()}x.cleanupDone=true;if(!(L&&typeof L==="string")){q()}}},renderingDone:function(){if(A){j.clearTimeout(A)}}};if(p.timeout>0){A=j.setTimeout(G.cleanupDOM,p.timeout)}b("html2canvas: Preload starts: finding background-images");x.firstRun=true;t(n);b("html2canvas: Preload: Finding images");for(E=0;E<y;E+=1){G.loadImage(w[E].getAttribute("src"))}x.firstRun=false;b("html2canvas: Preload: Done.");if(x.numTotal===x.numLoaded){q()}return G};k.Renderer=function(p,o){function m(r){var q=[];var s=function(v){var t=[],u=[];v.children.forEach(function(w){if(w.children&&w.children.length>0){t.push(w);u.push(w.zindex)}else{q.push(w)}});u.sort(function(x,w){return x-w});u.forEach(function(x){var w;t.some(function(y,z){w=z;return(y.zindex===x)});s(t.splice(w,1)[0])})};s(r.zIndex);return q}function n(q){var r;if(typeof o.renderer==="string"&&k.Renderer[q]!==d){r=k.Renderer[q](o)}else{if(typeof q==="function"){r=q(o)}else{throw new Error("Unknown renderer")}}if(typeof r!=="function"){throw new Error("Invalid renderer defined")}return r}return n(o.renderer)(p,o,l,m(p),k)};k.Util.Support=function(n,p){function m(){var r=new Image(),s=p.createElement("canvas"),q=(s.getContext===d)?false:s.getContext("2d");if(q===false){return false}s.width=s.height=10;r.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{q.drawImage(r,0,0);s.toDataURL()}catch(t){return false}b("html2canvas: Parse: SVG powered rendering available");return true}function o(){var t,v,u,q,s=false;if(p.createRange){t=p.createRange();if(t.getBoundingClientRect){v=p.createElement("boundtest");v.style.height="123px";v.style.display="block";p.body.appendChild(v);t.selectNode(v);u=t.getBoundingClientRect();q=u.height;if(q===123){s=true}p.body.removeChild(v)}}return s}return{rangeBounds:o(),svgRendering:n.svgRendering&&m()}};j.html2canvas=function(q,p){q=(q.length)?q:[q];var m,o,n={logging:false,elements:q,background:"#fff",proxy:null,timeout:0,useCORS:false,allowTaint:false,svgRendering:false,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:true,letterRendering:false,chinese:false,width:null,height:null,taintTest:true,renderer:"Canvas"};n=k.Util.Extend(p,n);k.logging=n.logging;n.complete=function(r){if(typeof n.onpreloaded==="function"){if(n.onpreloaded(r)===false){return}}m=k.Parse(r,n);if(typeof n.onparsed==="function"){if(n.onparsed(m)===false){return}}o=k.Renderer(m,n);if(typeof n.onrendered==="function"){n.onrendered(o)}};j.setTimeout(function(){k.Preload(n)},0);return{render:function(r,s){return k.Renderer(r,k.Util.Extend(s,n))},parse:function(r,s){return k.Parse(r,k.Util.Extend(s,n))},preload:function(r){return k.Preload(k.Util.Extend(r,n))},log:b}};j.html2canvas.log=b;j.html2canvas.Renderer={Canvas:d};k.Renderer.Canvas=function(v){v=v||{};var t=l,q=[],u=l.createElement("canvas"),r=u.getContext("2d"),m=v.canvas||t.createElement("canvas");function o(w,x){w.beginPath();x.forEach(function(y){w[y.name].apply(w,y["arguments"])});w.closePath()}function s(w){if(q.indexOf(w["arguments"][0].src)===-1){r.drawImage(w["arguments"][0],0,0);try{r.getImageData(0,0,1,1)}catch(x){u=t.createElement("canvas");r=u.getContext("2d");return false}q.push(w["arguments"][0].src)}return true}function p(w){return(w==="transparent"||w==="rgba(0, 0, 0, 0)")}function n(w,x){switch(x.type){case"variable":w[x.name]=x["arguments"];break;case"function":if(x.name==="createPattern"){if(x["arguments"][0].width>0&&x["arguments"][0].height>0){try{w.fillStyle=w.createPattern(x["arguments"][0],"repeat")}catch(y){b("html2canvas: Renderer: Error creating pattern",y.message)}}}else{if(x.name==="drawShape"){o(w,x["arguments"])}else{if(x.name==="drawImage"){if(x["arguments"][8]>0&&x["arguments"][7]>0){if(!v.taintTest||(v.taintTest&&s(x))){w.drawImage.apply(w,x["arguments"])}}}else{w[x.name].apply(w,x["arguments"])}}}break}}return function(F,H,E,B,D){var G=m.getContext("2d"),C,A,x,y,w,z;m.width=m.style.width=H.width||F.ctx.width;m.height=m.style.height=H.height||F.ctx.height;z=G.fillStyle;G.fillStyle=(p(F.backgroundColor)&&H.background!==d)?H.background:F.backgroundColor;G.fillRect(0,0,m.width,m.height);G.fillStyle=z;if(H.svgRendering&&F.svgRender!==d){G.drawImage(F.svgRender,0,0)}else{for(A=0,x=B.length;A<x;A+=1){C=B.splice(0,1)[0];C.canvasPosition=C.canvasPosition||{};G.textBaseline="bottom";if(C.clip){G.save();G.beginPath();G.rect(C.clip.left,C.clip.top,C.clip.width,C.clip.height);G.clip()}if(C.ctx.storage){C.ctx.storage.forEach(n.bind(null,G))}if(C.clip){G.restore()}}}b("html2canvas: Renderer: Canvas renderer done - returning canvas obj");x=H.elements.length;if(x===1){if(typeof H.elements[0]==="object"&&H.elements[0].nodeName!=="BODY"){w=D.Util.Bounds(H.elements[0]);y=E.createElement("canvas");y.width=w.width;y.height=w.height;G=y.getContext("2d");G.drawImage(m,w.left,w.top,w.width,w.height,0,0,w.width,w.height);m=null;return y}}return m}}})(window,document);

//Pueden empezar a editar desde aqui :yao
var xat = document.getElementById('shoutbox');

if (!xat) {
    return false;
}
    
var btn = document.createElement('input');

    btn.setAttribute('type', 'button');
    btn.setAttribute('value', 'Tomar captura de pantalla');
    btn.setAttribute('style', 'cursor:pointer');
    btn.addEventListener('click', takeScreenShot, false);

xat.appendChild(btn);


var btn2 = document.createElement('input');

    btn2.setAttribute('type', 'button');
    btn2.setAttribute('value', 'Ejecutar selector');
    btn2.setAttribute('style', 'cursor:pointer');
    btn2.addEventListener('click', highLight, false);

xat.appendChild(btn2);

function highLight() {
    $('#shoutbox_table tr').each(function() {
        $(this).click(function() {
            var txt = $(this).find('span').eq(1);
            
            if (txt.css('background-color') == 'rgb(255, 0, 0)') {
                $(this).css('background-color', '');
                txt.css({
                    'color': 'black',
                    'text-shadow': '',
                    'background-color': '',
                    'padding': ''
                });
            } else {
                $(this).css('background-color', '#000000');
                txt.css({
                    'color': 'white',
                    'text-shadow': '3px 2px 5px #000000',
                    'background-color': 'rgb(255, 0, 0)',
                    'padding': '3px'
                });
            }
            
        }); 
    });
}

function takeScreenShot() {
    html2canvas(xat, {
        onrendered: function(canvas) {
            share(canvas);
        }
    });
}

function share(canvas){
    var img = canvas.toDataURL('image/jpg', 0.5).split(',')[1];

    var w = window.open();
    w.document.write('Subiendo imagen...');
    // upload to imgur using jquery/CORS
    // https://developer.mozilla.org/En/HTTP_access_control
    $.ajax({
        url: 'https://api.imgur.com/3/upload',
        type: 'POST',
        crossDomain: true,
        beforeSend: function(request){
            request.setRequestHeader('Authorization', 'Client-ID fda744cd16b93c0');
        },
        data: {
            type: 'base64',
            name: 'Fl_chat.jpg',
            title: 'test title',
            caption: 'Captura de pantall del chat de FL',
            image: img
        },
        dataType: 'json'
    }).success(function(response) {
        w.location.href = response.data.link;
    }).error(function(jqXHR, textStatus, errorThrown) {
        alert('Un error raro ocurrio, no pudimos subir la imagen :/');
        w.close();
    });
}