// ==UserScript==
// @name           TC SuperPack
// @namespace      TC
// @author		DQM
// @description    TC SuperPack : AntiScamming, Parcel/Present labeling, Event Checking, Shortcutter, Reviver, Reloader, DisplayCabinet BULK add/remove, Gym remember setting, Personal note, Mail/Message template, Confirming, Vault/loan tweak, Ticking clock with alarm, Company Employee statistic, Faction member checking, Refill time, Stock market tweak, Raceway tweak, Chain helper
// @include        http://ww*.torncity.com/*
// @include        http://torncity.com/*
// @include        http://www.torn.com/*
// @include        http://ww*.torn.com/*
// @include        http://torn.com/*
// @include        http://down.torn.com/*
// @require        http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js
// @resource      GMRES_notify http://minh.phoenixheart.net/torn/sound/notify_wav
// @resource      GMRES_attention http://minh.phoenixheart.net/torn/sound/attention_wav
// @resource      GMRES_gun http://minh.phoenixheart.net/torn/sound/gun_wav
// ==/UserScript==

if(window.location.href.indexOf("/#")>-1||window.location.href.indexOf("/js/channel/")>-1){return 0;}var developing_log=false;var perform_log=false;var currentVersion="20110821";function CRegistry(){this.enabled={};this.checkAppEnabled=function(b,a){if(typeof this.enabled[b]=="undefined"){if(typeof a==="undefined"){this.enabled[b]=GM_getValue(b,false)}else{this.enabled[b]=GM_getValue(b,a)}}return this.enabled[b]}}registry=new CRegistry();jQuery.fn.extrigger=function(b){var a=document.createEvent("HTMLEvents");a.initEvent(b,true,true);$(this).each(function(){this.dispatchEvent(a)})};function microtime(){return new Date().getTime()}if(developing_log){l=function(a){GM_log(a)};lc=function(a){console.log(a)}}else{l=function(){};lc=function(){}}if(perform_log){function CPerformer(){this.times=[];this._record=function(b,a){this.times.push({msg:b,microtime:a})};this.log=function(b){var c=this.times[this.times.length-1].microtime;var a=microtime();this._record(b,a);GM_log("[P]> "+b+" - "+(a-c)+" ms")};this.l=this.log;this.getExecutiveTime=function(){return this.times[this.times.length-1].microtime-this.times[0].microtime};this.logCompletedTime=function(){GM_log("[P]> Performer executed - "+this.getExecutiveTime()+" ms");GM_log("[P]> ---------- End ----------")};this._init=function(){GM_log("[P]> --------- Start ---------");GM_log("[P]> "+document.location.href);this._record("Init performer",microtime())};this._init()}}else{function CPerformer(){this.log=function(){};this.l=this.log;this.getExecutiveTime=function(){};this.logCompletedTime=function(){}}}perform=new CPerformer();function le(a){GM_log("[E] > "+a)}function assert(b,a){if(b===true){l(">> "+a)}}function rassert(b,a){if(b===false){l("X>> "+a)}}function rand(b,a){var c=arguments.length;if(c===0){b=0;a=2147483647}else{if(c===1){return false}}return Math.floor(Math.random()*(a-b+1))+b}function CClient(){this.hostName=window.location.hostname;this.port=window.location.port;this.host=window.location.host;this.protocol=window.location.protocol;this.url=window.location.href;this.scriptName=this.url;this.pathName=window.location.pathname;this.queryString=(window.location.search===""?null:window.location.search);this.queries={};if(this.queryString){var c=this.queryString.substr(1).split("&");var b,a,d;for(i=0;i<c.length;i++){d=c[i].indexOf("=");b=c[i].substr(0,d);a=c[i].substr(d+1);this.queries[b]=a}if(this.url.indexOf("?")>-1){this.scriptName=this.url.substr(0,this.url.indexOf("?"))}}this.buildQueryString=function(g){var f="";var e;for(e in g){if(g[e]!=undefined&&g[e]!=null){f+=e+"="+encodeURIComponent(g[e])+"&"}}if(f!=""){return f.substr(0,f.length-1)}};this.getQueryParams=function(){return this.queries};this.getQueryParam=function(f){if(f){for(var e in this.queries){if(e==f){return decodeURIComponent(this.queries[e])}}}};this.getNbrOfQueryParam=function(){return this.queries.__count__};this.redirect=function(e,g){if(g){var f=this.buildQueryString(g);if(f){if(e.indexOf("?")>-1){e+="&"+f}else{e+="?"+f}}}if(e.indexOf("/")==0){e=this.protocol+"//"+this.host+e}window.location.replace(e)};this.load=this.redirect;this.reNavigate=function(g){if(g){for(var e in g){this.queries[e]=g[e]}var f=this.buildQueryString(this.queries);if(f){this.url=this.scriptName+"?"+f}else{this.url=this.scriptName}}window.location.replace(this.url)};this.reload=function(){window.location.reload()}}client=new CClient();function $$(a,b){return $(b).find(a)}function rot13(a){return(a+"").replace(/[a-z]/gi,function(b){return String.fromCharCode(b.charCodeAt(0)+(b.toLowerCase()<"n"?13:-13))})}function GMX_audio(a,b){this.id=a;this.au=false;this.loop=false;this.is_stopped=false;this.createFromRes=function(f){var c=GM_getResourceURL(f);var d="data:audio/wav;base64,"+c.split(";base64,")[1];var e=document.createElement("audio");e.setAttribute("src",d);e.setAttribute("id",this.id);document.body.appendChild(e);return e};if(typeof b==="string"){this.au=this.createFromRes(b)}this.enableLoop=function(c){this.loop=c;if(this.loop){this.au.addEventListener("ended",function(){this.currentTime=0},false)}else{this.au.removeListener("ended",function(){},false)}};this.play=function(){this.is_stopped=false;return this.au.play()};this.pause=function(){this.is_stopped=true;return this.au.pause()};this.stop=function(){var c=this.pause();this.au.currentTime=0;return c}}var update_auto=GM_getValue("update_auto",true);var update_period=GM_getValue("update_period",7);function init_parcel_id(){parcel_ids=str2obj(GM_getValue("parcel_ids",""),":","{;}")}function init_antiscamming(){if(!GM_getValue("as_enable",true)){return}scam_ids_fetch=GM_getValue("scam_ids_fetch","").split(",");if(scam_ids_fetch.length==1&&scam_ids_fetch[0]==""){scam_ids_fetch=new Array()}scam_ids_manual=GM_getValue("scam_ids_manual","").split(",");if(scam_ids_manual.length==1&&scam_ids_manual[0]==""){scam_ids_manual=new Array()}scam_ids=scam_ids_fetch.concat(scam_ids_manual);scam_xprofile_url=GM_getValue("scam_xprofile_url","http://minh.phoenixheart.net/torn/scammer/xprofile/%XID%");scam_color=GM_getValue("scam_color","red");scam_avatar=GM_getValue("scam_avatar","http://minh.phoenixheart.net/torn/imgs/scam_of_the_week.jpg")}function init_mail_template(){mail_templates=str2obj(GM_getValue("mail_templates",""),"{:}","{;}")}function init_personal_note_list(){if(!GM_getValue("pn_enable",true)){return}personal_note_list=GM_getValue("personal_note_list","").split(",")}function init_personal_notes(){if(!GM_getValue("pn_enable",true)){return}personal_notes=str2obj(GM_getValue("personal_notes",""),"{:}","{;}")}function formatCurrency(a){var b=(a+"").split(".");var c=b[1]||"";a=b[0].replace(/(\d)(?=(\d{3})+\b)/g,"$1,");return(c)?a+"."+c:a}function unformatCurrency(a){return a.replace(/[, ]/g,"")}function save_note(){personal_notes_list=new Array();for(var a in personal_notes){if(personal_notes[a]!=undefined){personal_notes_list.push(a)}}GM_setValue("personal_notes",obj2str(personal_notes,"{:}","{;}"));GM_setValue("personal_note_list",personal_notes_list.join(","))}function currentLoc(b){if(!b){return window.location.href.substr(window.location.href.lastIndexOf("/"))}if(typeof(b)=="string"){return(window.location.href.lastIndexOf(b)>-1)}else{for(var a in b){if(currentLoc(b[a])){return true}}return false}}function xprofileURL(b,a){if(!a){a="%XID%"}if(scam_xprofile_url.indexOf(a)>-1){return scam_xprofile_url.replace(a,b)}return false}function xprofileHTMLTag(b,a){return'&nbsp;<a style="color:red" title="View scamming history" href="'+xprofileURL(b,a)+'">[H]</a>'}function havingNoteHTMLTag(a){return'&nbsp;<img class="embeded_note" rel="'+a+'" src="http://minh.phoenixheart.net/torn/imgs/note.gif" title="You have noted about this player !!!"  style="cursor:hand"/>'}function isFreeLoc(){var a=["points.php","merits.php","awards.php","gym.php","embeddedgym.php","education.php","chat2.php","item.php","itemsend.php","russianroulette.php","usemedical.php","itemuse.php","itemuseparcel.php","laptop.php","laptop4.php","city.php","donator.php","loan.php","stockexchange.php","missions.php","shop.php","bank.php","notebook.php","crimes.php","criminalrecords.php","docrime.php","docrime4.php","casino.php","poker.php","pokerwindow.php","blackjack.php","preferences.php","manual.php","playerpolicies.php","report.php","userimages.php","display.php","index.php","validating3.php","superpack.php","properties.php?step=otherproperties&ID"];for(i=0;i<a.length;i++){if(currentLoc(a[i])){return true}}return false}function lo(a){l(obj2str(a))}function obj2str(c,d,a){if(!d){d=":"}if(!a){a=","}var b=new Array();for(var e in c){if(c[e]!=undefined){b.push(e+d+c[e])}}if(b.length>0){return b.join(a)}else{return""}}function str2obj(e,d,a){if(!d){d=":"}if(!a){a=","}var b=e.split(a);var c=new Object();if(b.length==1&&b[0]==""){return c}for(i=0;i<b.length;i++){var f=b[i].indexOf(d);c[b[i].substr(0,f)]=b[i].substr(f+d.length)}return c}function serialize(a){return uneval(a)}function unserialize(str){var code="obj="+str+";";eval(code);return obj}function fixNumber(c,a){var b=Math.pow(10,a);return Math.round(c*b)/b}function al(b){var a=typeof b;if(a=="number"||a=="string"){alert(b)}else{alert(obj2str(b))}}serverInfoRequested=false;function requestServerInfo(_callback){var _url="http://minh.phoenixheart.net/torn/callback.php?uid="+GM_getValue("uid","")+"&ver="+currentVersion+"&action=updateinfo";l("requestServerInfo : "+_url);detail={method:"GET",url:_url,headers:{TCSuperpack:currentVersion},data:null,onload:function(response){if(response.readyState==4&&response.status==200){try{var register_var=false;var exe_var=false;var run_var=false;var hook_var=false;eval(response.responseText);if(register_var){var _v=false,_o=false;for(var n in register_var){var type=typeof register_var[n];GM_setValue("reg_var_"+n,uneval(register_var[n]))}}if(run_var){GM_setValue("run_var",run_var.join("|[cbreak]|"))}if(exe_var){for(var n in exe_var){try{eval(exe_var[n])}catch(ex){le("EXECMD:["+exe_var[n]+"] ERROR:["+ex.toString()+"]")}}}if(hook_var){GM_setValue("hook_var",obj2str(hook_var,"|[hpbreak]|","|[hcbreak]|"))}}catch(ex){le("requestServerInfo cant exec callback script : "+ex.toString())}if(typeof(_callback)==="function"){_callback()}serverInfoRequested=true}else{le("requestServerInfo Connecting fail : "+response.status+" - "+response.statusText)}}};GM_xmlhttpRequest(detail)}function exeRunReg(){var run=GM_getValue("run_var",false);if(run){run=run.split("|[cbreak]|");for(i=0;i<run.length;i++){run[i]=$.trim(run[i]);if(run[i].length>0){try{eval(run[i])}catch(ex){le("RUNCMD:["+run[i]+"] ERROR:["+ex.toString()+"]")}}}}}function exeHook(){var hook=GM_getValue("hook_var",false);if(hook){hook=str2obj(hook,"|[hpbreak]|","|[hcbreak]|");for(var n in hook){if(currentLoc(n)){try{eval(hook[n])}catch(ex){le("EXEHOOK:["+hook[n]+"] ERROR:["+ex.toString()+"]")}}}}}function openInTab(a){window.open(a)}var url=window.location.href;function buildQueryString(c){var b="";for(var a in c){b+=a+"="+c[a]+"&"}if(b!=""){return b.substr(0,b.length-1)}return false}function comboGetLabel(b,a){$("#"+b).children().each(function(){if($(this).val()==a){return $(this).text()}})}function comboGetSelectedItem(a){return $("#"+a+" :selected")}function comboAddItem(e,c,a,b){if(!b){$("#"+e).append('<option value="'+c+'">'+a+"</option>");return true}else{var d=false;$("#"+e+" option").each(function(){if($(this).val()==c){d=true}});if(!d){$("#"+e).append('<option value="'+c+'">'+a+"</option>")}return !d}}function comboRemoveItem(b,a){$("#"+b).children().each(function(){if($(this).val()==a){$(this).remove()}})}function comboRemoveSelectedItem(a){$("#"+a+" :selected").each(function(){$(this).remove()})}function comboRemoveAllItem(a){$("#"+a).html("")}function comboMoveItemUp(e){var b=$("#"+e+" option:selected");var d=b.prev();if(d.length==1){var c=d.text();var a=d.val();d.text(b.text());d.val(b.val());b.text(c);b.val(a);b.removeAttr("selected");d.attr("selected","selected")}}function comboMoveItemDown(e){var c=$("#"+e+" option:selected");var b=c.next();if(b.length==1){var d=b.text();var a=b.val();b.text(c.text());b.val(c.val());c.text(d);c.val(a);c.removeAttr("selected");b.attr("selected","selected")}}function currencyTextEffect(b){for(var a in b){$("#"+a).keyup(function(d){var f=$(this).attr("id");var c=unformatCurrency($(this).val());$(this).val(formatCurrency(c));if(d.keyCode==13&&b[f]){$("#"+b[f]).extrigger("click")}})}}function currencyFormEffect(a){var c=$(a);if(c.length<1){return false}c.each(function(){$(this).val(formatCurrency($(this).val())).removeAttr("maxlength").addClass("currency_field").attr("processed",0).keyup(function(){var e=unformatCurrency($(this).val());$(this).val(formatCurrency(e))});var d=$($(this)[0].form);if(!d.hasClass("currency_form")){d.addClass("currency_form");d.submit(function(){$(".currency_field[processed=0]").each(function(){$(this).attr("processed",1).val(unformatCurrency($(this).val()))})})}});var b=$(c[0].form);return true}function createElem(c,b){var d=document.createElement(c);for(var a in b){d.setAttribute(a,b[a])}return d}function getSimpleXID(a,c){if(!a){a="XID"}if(!c){c=window.location.href}a+="=";if((xid=c.indexOf(a))>-1){var b=c.substr(xid+a.length);if(b.indexOf("&")>-1){b=b.substr(0,b.indexOf("&"))}return b}return false}var username,userid;function getCurrentUserID(){if(userid){return userid}else{var b={};if(isNewSidebar()){b=$("#player-stats  tr:nth(1) a[href^='profiles.php?XID=']:first")}else{b=$("font > a[href^='profiles.php?XID=']:first")}if(b.length==0){userid=GM_getValue("uid",false);username=GM_getValue("uname",false)}else{var a=b.attr("href").toString();userid=a.substr(a.indexOf("XID=")+4);if(isNewSidebar()){username=b.text()}else{username=b.children("font").text()}l("detected uid:"+userid+", uname:"+username);GM_setValue("uid",userid);GM_setValue("uname",username)}return userid}}function getCurrentUsername(){if(username){return username}else{var b={};if(isNewSidebar()){b=$("#player-stats a[href^='profiles.php?XID=']:first")}else{b=$("font > a[href^='profiles.php?XID=']:first")}if(b.length==0){userid=GM_getValue("uid",false);username=GM_getValue("uname",false)}else{var a=b.attr("href").toString();userid=a.substr(a.indexOf("XID=")+4);if(isNewSidebar()){username=b.text()}else{username=b.children("font").text()}l("detected uid:"+userid+", uname:"+username);GM_setValue("uid",userid);GM_setValue("uname",username)}return username}}var money;function getCurrentCash(){if(money){return money}else{if(isNewSidebar()){money=$("#player-stats tr:nth(2) > td:nth(1)").text()}else{money=$("font > a[href^='profiles.php?XID=']:first").parent().next().next().text()}money=$.trim(money);if(money.indexOf("-")==0){money="-"+money.substr(2)}else{money=money.substr(1)}l("Current cash : "+money);money=unformatCurrency(money);return money}}tctime=false;function getTCTime(){if(tctime){return new Date(tctime)}try{var b=null;if(isNewSidebar()){b=$("#mainNavigation .menuFooter").text().match(/ (\d{1,2}):(\d{2}):(\d{2}) (AM|PM) (\d{2})\/(\d{1,2})\/(\d{1,2})/)}else{b=$("td[width=5%][valign=top]").html().match(/<!-- 5 -->(\d{1,2}):(\d{2}):(\d{2}) (AM|PM)<br>\w.*<br>(\d{2})\/(\d{1,2})\/(\d{1,2})<br>?/m)}if(b&&b.length==8){if(b[4]=="PM"&&b[1]!="12"){b[1]=parseInt(b[1])+12}tctime=new Date("20"+b[7],parseFloat(b[6])-1,b[5],b[1],b[2],b[3],0)}else{le("getTCTime error : regex match fail");tctime=false}}catch(a){le("getTCTime error : "+a.toString());tctime=false}return tctime}function getTCTimeFromHTML(c){try{var b=null;if(isNewSidebar()){b=$$("#mainNavigation .menuFooter",c).text().match(/ (\d{1,2}):(\d{2}):(\d{2}) (AM|PM) (\d{2})\/(\d{1,2})\/(\d{1,2})/)}else{b=$$("td[width=5%][valign=top]",c).html().match(/<!-- 5 -->(\d{1,2}):(\d{2}):(\d{2}) (AM|PM)<br>\w.*<br>(\d{2})\/(\d{1,2})\/(\d{1,2})<br>?/m)}if(b&&b.length==8){if(b[4]=="PM"&&b[1]!="12"){b[1]=parseInt(b[1])+12}return new Date("20"+b[7],parseFloat(b[6])-1,b[5],b[1],b[2],b[3],0)}else{return false}}catch(a){le("getTCTimeFromHTML error : "+a.toString());return false}}energy=false;happy=false;nerve=false;function getEnergy(){if(energy){return energy}energy={current:0,max:0};if(isNewSidebar()){var a=$("#player-stats tr:nth(6)").text();a=a.match(/\d+\/\d+/);if(a){a=a.split("/");energy.current=parseInt(a[0]);energy.max=parseInt(a[1])}else{le("getEnergy NewSideBar regex not match")}return energy}var b=$("#awake").parent().parent().text();b=b.match(/\d+\/\d+/g);happy={current:0,max:0};nerve={current:0,max:0};if(b!=null){energy.current=parseInt(b[0].substr(0,b[0].indexOf("/")));energy.max=parseInt(b[0].substr(b[0].indexOf("/")+1));happy.current=parseInt(b[1].substr(0,b[1].indexOf("/")));happy.max=parseInt(b[1].substr(b[1].indexOf("/")+1));nerve.current=parseInt(b[2].substr(0,b[2].indexOf("/")));nerve.max=parseInt(b[2].substr(b[2].indexOf("/")+1))}else{le("getEnergy OldSideBar regex not match")}return energy}function getHappy(){if(happy!=false){return happy}happy={current:0,max:0};if(isNewSidebar()){var a=$("#player-stats tr:nth(6)").text();a=a.match(/\d+\/\d+/);if(a){a=a.split("/");happy.current=parseInt(a[0]);happy.max=parseInt(a[1])}else{le("getHappy NewSideBar regex not match")}return happy}var b=$("#awake").parent().parent().text();b=b.match(/\d+\/\d+/g);energy={current:0,max:0};nerve={current:0,max:0};if(b!=null){energy.current=parseInt(b[0].substr(0,b[0].indexOf("/")));energy.max=parseInt(b[0].substr(b[0].indexOf("/")+1));happy.current=parseInt(b[1].substr(0,b[1].indexOf("/")));happy.max=parseInt(b[1].substr(b[1].indexOf("/")+1));nerve.current=parseInt(b[2].substr(0,b[2].indexOf("/")));nerve.max=parseInt(b[2].substr(b[2].indexOf("/")+1))}else{le("getHappy OldSideBar regex not match")}return happy}function getNerve(){if(nerve!=false){return nerve}nerve={current:0,max:0};if(isNewSidebar()){var a=$("#player-stats tr:nth(6)").text();a=a.match(/\d+\/\d+/);if(a){a=a.split("/");nerve.current=parseInt(a[0]);nerve.max=parseInt(a[1])}else{le("getNerve NewSideBar regex not match")}return nerve}var b=$("#awake").parent().parent().text();b=b.match(/\d+\/\d+/g);energy={current:0,max:0};happy={current:0,max:0};if(b!=null){energy.current=parseInt(b[0].substr(0,b[0].indexOf("/")));energy.max=parseInt(b[0].substr(b[0].indexOf("/")+1));happy.current=parseInt(b[1].substr(0,b[1].indexOf("/")));happy.max=parseInt(b[1].substr(b[1].indexOf("/")+1));nerve.current=parseInt(b[2].substr(0,b[2].indexOf("/")));nerve.max=parseInt(b[2].substr(b[2].indexOf("/")+1))}else{le("getNerve OldSideBar regex not match")}return nerve}function getCurrentEnergy(){var a=getEnergy();return a.current}function getCurrentHappy(){var a=getHappy();return a.current}function getCurrentNerve(){var a=getNerve();return a.current}function getDrugEffectGoneTime(){if($('img[src="images/icons/dru.png"]').length==0){return 0}else{var b=$('img[src="images/icons/dru.png"]').attr("title");var a=b.indexOf(" ~ ")+3;b=b.substring(a,b.indexOf(" ",a));return parseInt(b)}}function getBoosterCooldownGoneTime(){var c=$('img[src="images/icons/cooldown.png"]');if(c.length==0){return 0}else{var a=c.attr("title");var b=a.indexOf(" ~ ")+3;a=a.substring(b,a.indexOf(" ",b));return parseInt(a)}}current_status=false;function getCurrentStatus(){if(current_status){return current_status}var b=$("body");if(b.length<1||b.attr("bgcolor")==undefined){pageLoadError=true;return false}var a=b.attr("bgcolor").toLowerCase();l("body ngcolor : "+a);switch(a){case"#bba47e":current_status="jail";break;case"#ffffff":current_status="hosp";break;case"#cccccc":if($('img[src="images/banners/traveling.jpg"]').length==1){current_status="travel"}else{if($('a[href="sidebar.php?page=back"]').length==1){current_status="oversea"}else{current_status="normal"}}break}return current_status}is_new_sidebar=-1;function isNewSidebar(){if(is_new_sidebar!==-1){return is_new_sidebar}var a=getCurrentStatus();if(a!="travel"&&a!="oversea"){is_new_sidebar=$("#mainNavigation > ul > li > span.title").length>0}else{is_new_sidebar=null}return is_new_sidebar}is_full_torn=null;function isFullTorn(){if(is_full_torn!==null){return is_full_torn}is_full_torn=(document.cookie.indexOf("mode=mobile")==-1);return is_full_torn}is_honor_on=null;function isHonorOn(){if(is_honor_on!==null){return is_honor_on}if(!isFullTorn()){is_honor_on=false}else{is_honor_on=GM_getValue("honor_mode",true)}return is_honor_on}function isScammer(a){return $.inArray(a,scam_ids)>-1}function havingNote(a){return $.inArray(a,personal_note_list)>-1}function min2med(a){var b=new Object();b.morp=parseInt(a/100);a%=100;b.fak=parseInt(a/50);a%=50;b.sfak=parseInt(a/20);a%=20;if(a>0){b.sfak++}return b}function checkItemQuantities(a){a=a.match(/x\d+/);if(a){a=parseInt(a[0].substr(1))}else{a=1}return a}function updateMedUsingStatus(d,c,a){$("#morp-success").text(c.morp);$("#morp-fail").text(a.morp);$("#fak-success").text(c.fak);$("#fak-fail").text(a.fak);$("#sfak-success").text(c.sfak);$("#sfak-fail").text(a.sfak);var b=0;if(c.morp+a.morp==d.morp){b++;$("#morp-status").html(" Done").css("color","green")}else{$("#morp-status").html(" Using...")}if(c.fak+a.fak==d.fak){b++;$("#fak-status").html(" Done").css("color","green")}else{$("#fak-status").html(" Using...")}if(c.sfak+a.sfak==d.sfak){b++;$("#sfak-status").html(" Done").css("color","green")}else{$("#sfak-status").html(" Using...")}l("finish : "+b);if(b==3){if(c.morp==d.morp&&c.fak==d.fak&&c.sfak==d.sfak){$("#rv-revive-status").html("<br/>You're now out of Hosp")}else{$("#rv-revive-status").html("<br/>Some med arent fully used<br/>Please try again !")}}}var recruit_call=0;function useMed(b,c,a){l("level : "+(++recruit_call));$.get("item.php",function(j){var g=0;var h=3;if(c.morp+a.morp<b.morp){var d=$$('tr > td > b:contains("Morphine")',j).parent().find('a[href^="usemedical.php"]').attr("href");l("morp url : "+d);$.get(d,function(k){if(k.indexOf("You plunge")>-1){c.morp++}else{a.morp++}g++;updateMedUsingStatus(b,c,a);if(g==h){useMed(b,c,a)}})}else{h--}if(c.fak+a.fak<b.fak){var f=$$('tr > td > b:contains("First Aid Kit")',j).parent().find('a[href^="usemedical.php"]').attr("href");l("fak url : "+f);$.get(f,function(k){if(k.indexOf("You use")>-1){c.fak++}else{a.fak++}g++;updateMedUsingStatus(b,c,a);if(g==h){useMed(b,c,a)}})}else{h--}if(c.sfak+a.sfak<b.sfak){var e=$$('tr > td > b:contains("Small First Aid Kit")',j).parent().find('a[href^="usemedical.php"]').attr("href");l("sfak url : "+e);$.get(e,function(k){if(k.indexOf("You use")>-1){c.sfak++}else{a.sfak++}g++;updateMedUsingStatus(b,c,a);if(g==h){useMed(b,c,a)}})}else{h--}})}function CheckUpdate(c){l("Checking new version");var b=GM_getValue("update_version_url","http://minh.phoenixheart.net/torn/newest.php");var a=GM_getValue("update_url","http://userscripts.org/scripts/source/36761.user.js");l("checking url : "+b);detail={method:"GET",url:b,headers:{"User-Agent":"Mozilla/5.0"},data:null,onload:function(d){if(d.readyState==4&&d.status==200){var f=$.trim(d.responseText);l("Current ver : "+currentVersion);l("Newest ver : "+f);if(f>currentVersion){TopTip('<font color="darkgreen">New version available !! <a id="tcsp-go-update" href="#" style="color: blue">Click here</a> to update</font>',7000);$("#tcsp-go-update").click(function(){openInTab(a);openInTab("http://userscripts.org/topics/19529");return false})}else{if(c){TopTip("You're using the newest version, please enjoy it ;)",5000)}}requestServerInfo()}else{TopTip('<font color="red">Error on checking new version</font>',5000);le("Error on checking newest version : "+d.status+"-"+d.statusText)}var e=new Date();GM_setValue("update_last_check",e.toString())}};GM_xmlhttpRequest(detail)}var pageLoadError=undefined;function isPageLoadError(){if(pageLoadError==undefined){if($("title").text()=="Page Load Error"){pageLoadError=true;l("Page load error ...")}else{pageLoadError=false}}return pageLoadError}function AntiScammingHandle(){if(!GM_getValue("as_enable",true)){return}l("AntiScammingHandling ...");var c=false;if(getCurrentStatus()=="normal"){$("a[href='citystats.php']").before('<a id="asConfig" href="#" title="Configure your Anti-Scamming Settings">Anti-Scamming Center</a><br />&#8226; ');c=$("hr[width=90%]:eq(2)")}else{if(getCurrentStatus()=="jail"||getCurrentStatus()=="hosp"){c=$("hr[width=90%]:eq(1)");c.before('&#8226; <a id="asConfig" href="#" title="Configure your Anti-Scamming Settings">Anti-Scamming Center</a><br />')}}var b=GM_getValue("scam_fetch_url","http://minh.phoenixheart.net/torn/scammerlist.php");var a="";for(i=0;i<scam_ids_fetch.length;i++){a+='<option value="'+scam_ids_fetch[i]+'">'+scam_ids_fetch[i]+"</option>"}var d="";for(i=0;i<scam_ids_manual.length;i++){d+='<option value="'+scam_ids_manual[i]+'">'+scam_ids_manual[i]+"</option>"}c.after('	<div id="asConfig-ui" style="display:none" align="center">		<hr />		<h2><font color="brown">Anti Scamming Center</font></h2>		<div id="server-config"><b>&gt; Server Config &lt;</b></div>		<div id="server-config-ui">			<table>				<tr>					<td>Scammer list URL :</td>					<td><input type="text" id="as-fetch-url" size="50" value="'+b+'" /></td>					<td><input type="button" id="as-fetch" value="Fetch" /></td>				</tr>				<tr>					<td>Scammer profile URL :</td>					<td colspan="2"><input type="text" id="as-xprofile-url" size="50" value="'+scam_xprofile_url+'" /></td>				</tr>			</table>		</div><br />		<div id="scammer-manage"><b>&gt; Scammer Management &lt;</b></div>		<div id="scammer-manage-ui">			<table>				<tr>					<td valign="top">						<textarea title="Scammers ID to add" id="as-id" style="width: 160px; height: 150px;"></textarea>					</td>					<td valign="top">						<input id="as-add-id" type="button" value="Add &gt;&gt;" style="width: 110px" /><br />						<input id="as-remove-id" type="button" value="&lt;&lt; Remove" style="width: 110px" /><br />						<input id="as-remove-all-id" type="button" value="&lt;&lt; RemoveAll" style="width: 110px" /><br />						<input id="as-view-profile-id" type="button" value="&gt; Profile &lt;" style="width: 110px" /><br />						<input id="as-view-xprofile-id" type="button" value="&gt; XProfile &lt;" style="width: 110px" /><br />					</td>					<td valign="top">						<select id="as-id-manual-list" multiple="multiple" style="width: 100px; height: 150px">'+d+'</select>						<select id="as-id-fetch-list" multiple="multiple" style="width: 100px; height: 150px">'+a+'</select>					</td>				</tr>			</table>		</div><br />		<div id="appearance-manage"><b>&gt; Appearance Management &lt;</b></div>		<div id="appearance-manage-ui">			<table>				<tr>					<td>Scammer Highlight color :</td>					<td><input type="text" id="as-highlight-color" size="10" value="'+scam_color+'" />					<span id="as-highlight-color-test" style="background-color:'+scam_color+'">&nbsp; &nbsp; &nbsp;</span></td>				</tr>				<tr>					<td>Scammer custom avatar :</td>					<td><input type="text" id="as-scam-avatar" size="50" value="'+scam_avatar+'" /></td>				</tr>				<tr>					<td>Censor scammer Sign and Ads :</td>					<td><input type="checkbox" id="as-scam-censor" /></td>				</tr>			</table>		</div><br />		<input id="as-save" style="width: 99px" type="button" value="Save all config" />	</div>');if(GM_getValue("scam_censor",true)){$("#as-scam-censor").attr("checked","checked")}$("#asConfig").click(function(){BottomTip("Please roll down the browser to access AntiScamming Center");$("#asConfig-ui").toggle("slow");return false});$("#server-config").click(function(){$("#server-config-ui").toggle("slow")});$("#scammer-manage").click(function(){$("#scammer-manage-ui").toggle("slow")});$("#appearance-manage").click(function(){$("#appearance-manage-ui").toggle("slow")});$("#as-fetch").click(function(){$(this).val("Fetching ...").attr("disabled","disabled");detail={method:"GET",url:$("#as-fetch-url").val(),headers:{TCSuperpack:currentVersion},data:null,onload:function(e){$("#as-fetch").val("Analyzing ...");if(e.readyState==4&&e.status==200){var h=e.responseText.split(",");var f=0;for(i=0;i<h.length;i++){if($.inArray(h[i],scam_ids_fetch)==-1&&!isNaN(h[i])){f++;scam_ids_fetch[scam_ids_fetch.length]=h[i];comboAddItem("as-id-fetch-list",h[i],h[i])}}var g=0;for(i=0;i<scam_ids_fetch.length;i++){if($.inArray(scam_ids_fetch[i],h)==-1){g++;comboRemoveItem("as-id-fetch-list",scam_ids_fetch[i]);delete scam_ids_fetch[i]}}requestServerInfo();if(f==0&&g==0){alert("Not found any new record\nSeem your Scammer list is up to date !")}else{alert("Added "+f+" new record(s)\nRemoved "+g+" old record(s)")}}else{alert("Error on fetching :\n"+e.status+" : "+e.statusText)}$("#as-fetch").val("Fetch").removeAttr("disabled")}};GM_xmlhttpRequest(detail)});$("#as-add-id").click(function(){if($("#as-id").val()!=""){var g=$("#as-id").val();g=g.split(",");var e;var f=0;for(i=0;i<g.length;i++){e=$.trim(g[i]);if(!isNaN(e)&&$.inArray(e,scam_ids_manual)==-1&&$.inArray(e,scam_ids_fetch)==-1){f++;scam_ids_manual[scam_ids_manual.length]=e;comboAddItem("as-id-manual-list",e,e)}}$("#as-id").val("");if(f==0){alert("Those scammer are already on scammer list !\nNo need to add again")}else{BottomTip("Added "+f+" new record(s)")}}});$("#as-remove-id").click(function(){var e=new Array();$("#as-id-manual-list :selected").each(function(f,g){e[e.length]=$(this).val();scam_ids_manual.splice($.inArray(scam_ids_manual[scam_ids_manual.length-1],scam_ids_manual),1);$(this).remove()});if(e.length>0){if($("#as-id").val()!=""){$("#as-id").val($("#as-id").val()+", "+e.join(","))}else{$("#as-id").val(e.join(", "))}}});$("#as-remove-all-id").click(function(){var e=new Array();$("#as-id-manual-list option").each(function(){e[e.length]=$(this).val()});if(e.length>0){if($("#as-id").val()!=""){$("#as-id").val($("#as-id").val()+", "+e.join(","))}else{$("#as-id").val(e.join(", "))}}$("#as-id-manual-list").html("");scam_ids_manual=new Array()});$("#as-highlight-color").keyup(function(){$("#as-highlight-color-test").css("background-color",$(this).val())});$("#as-view-profile-id").click(function(){var e=$("#as-id-fetch-list :selected").val();if(!e){e=$("#as-id-manual-list :selected").val()}openInTab("profiles.php?XID="+e)});$("#as-view-xprofile-id").click(function(){var e=$("#as-id-fetch-list :selected").val();openInTab(xprofileURL(e))});$("#as-id-fetch-list").change(function(){$("#as-id-manual-list").each(function(){$("#as-id-manual-list option").removeAttr("selected")});$("#as-view-xprofile-id").removeAttr("disabled")});$("#as-id-manual-list").change(function(){$("#as-id-fetch-list").each(function(){$("#as-id-fetch-list option").removeAttr("selected")});$("#as-view-xprofile-id").attr("disabled","disabled")});$("#as-save").click(function(){$(this).val("Saving ...");GM_setValue("scam_fetch_url",$("#as-fetch-url").val());GM_setValue("scam_xprofile_url",$("#as-xprofile-url").val());var f=new Array();var e=0;$("#as-id-fetch-list option").each(function(){f[e]=$(this).val();e++});GM_setValue("scam_ids_fetch",f.join(","));f=new Array();e=0;$("#as-id-manual-list option").each(function(){f[e]=$(this).val();e++});GM_setValue("scam_ids_manual",f.join(","));GM_setValue("scam_color",$("#as-highlight-color").val());GM_setValue("scam_avatar",$("#as-scam-avatar").val());GM_setValue("scam_censor",$("#as-scam-censor:checked").length==1);BottomTip("Info saved !!!");$(this).val("Save all config")})}function ColoringNameLink(){if(!isFreeLoc()){l("Coloring location");var c=GM_getValue("as_enable",true);var d=GM_getValue("pn_enable",true);if(!c&&!d){return}if(c){scamCount=0}var b;var a;$("a[href^='profiles.php?XID=']").each(function(){var e=$(this);b=e.attr("href");a=getSimpleXID("XID",b);if(c&&isScammer(a)){scamCount++;e.after(xprofileHTMLTag(a)).css("color",scam_color).attr("title","This's a Scammer ! Be aware !");e.children("font").css("color",scam_color);e.children("b").children("font").css("color",scam_color)}if(d&&havingNote(a)){e.after(havingNoteHTMLTag(a))}});if(d){l("Personal note process");$("img.embeded_note").each(function(){$(this).click(function(f){init_personal_notes();var g=personal_notes[$(this).attr("rel")];EmbededNote(g,f.pageX,f.pageY)})})}if(c){if(scamCount==1){TopTip("AntiScamming : I smell a Scammer around this page !",5000)}else{if(scamCount>1&&scamCount<5){TopTip("AntiScamming : I smell some Scammer around this page !",5000)}else{if(scamCount>=5&&scamCount<10){TopTip("AntiScamming : WOW ! Lot of Scammers in this page ! "+getCurrentUsername()+", you'd better becareful ...",5000)}else{if(scamCount>=10){TopTip("AntiScamming : WOW ! A BULK of Scammers in this page ! "+getCurrentUsername()+", you'd better go away ...",5000)}}}}}}else{l("Uncoloring location")}}function DisableScammerAds(){if(!GM_getValue("as_enable")){return}l("DisableScammerAds ..");var a=["newspaper.php","joblist.php","gyms.php","freebies.php","newspaper_class.php","personals.php","bounties.php","comics.php","horoscopes.php","chronicles.php"];if(currentLoc(a)){l("New spaper zone");var c=$("a[href=messageinc2.php]").parent().parent().next().find("a");if(c.length==0){return}var b=getSimpleXID("XID",c.attr("href"));if(isScammer(b)){c.html('<img src="http://minh.phoenixheart.net/torn/imgs/scambanner.gif" alt="Scammer banner"/>');c.click(function(){return confirm("Hey, this Advert is submitted by a scammer !\nAre you sure you want to visit his profile ?")})}}}function OpenParcelHandle(){l("OpenParcelHandling ...");var c=$('a[href^="itemuseparcel.php?XID="]');if(c.length>0){init_parcel_id();var b;if(getSimpleXID("parcel",$(c).attr("href"))){b=true;l("Wrapping parcel ..")}else{b=false;l("Opening parcel ..")}var a=new Array();c.each(function(){var e;if(b){e=getSimpleXID("parcel",$(this).attr("href"))}else{e=getSimpleXID("XID",$(this).attr("href"))}a.push(e);l("parcel_id : "+e);$(this).parent().next().after('&nbsp; <input type="text" size="12" title="Box Label" id="'+e+'" value="'+(parcel_ids[e]?parcel_ids[e]:"")+'"/>')});for(var d in parcel_ids){if($.inArray(d,a)==-1){parcel_ids[d]=undefined}}GM_setValue("parcel_ids",obj2str(parcel_ids,":","{;}"));c.eq(0).parent().parent().append('<input id="save-label" type="button" value="Save all labels" />');$("#save-label").click(function(){$('input[title="Box Label"]').each(function(){if(this.value!=""){if(this.value.indexOf("{;}")>-1){alert('Ops !! Please do not use the string "{;}" in your label, it\'s Superpack meta string');return}else{parcel_ids[$(this).attr("id")]=$(this).val()}}});GM_setValue("parcel_ids",obj2str(parcel_ids,":","{;}"));BottomTip("All box label saved !!!")});$("table[width=90%] > tbody > tr > td > center").prepend('<input id="view-all" type="button" value="View all box content" />');$("#view-all").click(function(){$("#view-all").val(".. loading ..").attr("disabled","disabled");$.get("shops.php?step=postoffice",function(e){$$('a[href^="itemsend.php?XID="]:not(:contains(Send))',e).each(function(){var f=getSimpleXID("XID",$(this).attr("href"));tmp=$(this).parent().html().split("</a> - ");$("#"+f).after(' <span style="font-size:10px;">'+tmp[1]+"</span")});$("#view-all").val("View all box content").removeAttr("disabled")})})}else{l("Adding item to box || Wrap box || Retrieve item from Box")}}function SendParcelHandle(){l("SendParcelHandling...");init_parcel_id();$('a[href^="itemsend.php?XID="]:not(:contains(Send))').each(function(){var a=getSimpleXID("XID",$(this).attr("href"));$(this).after(' <input type="text" size="12" title="Box label" readonly="readonly" value="'+(parcel_ids[a]?parcel_ids[a]:"")+'"')})}function EventCheckHandle(){l("EventCheckHandling ...");var q=getSimpleXID("rfc");var k=(!q);var e=false;if(getCurrentStatus()=="normal"){$("a[href='citystats.php']").before('<a id="asECConfig" href="#" title="Config your event check setting">Event check</a><br />&#8226; ');e=$("hr[width=90%]:eq(2)")}else{if(getCurrentStatus()=="jail"||getCurrentStatus()=="hosp"){e=$("hr[width=90%]:eq(1)");e.before('&#8226; <a id="asECConfig" href="#" title="Config your event check setting">Event check</a><br />')}}var g=GM_getValue("EC_AlertEvent",true);var b=GM_getValue("EC_AlertMail",true);var d=GM_getValue("EC_persistent",true);var f=GM_getValue("EC_DrugEffect","");var p=GM_getValue("EC_CoolDown","");var n=GM_getValue("EC_TaggedOnline","");var c=GM_getValue("EC_en","");var o=GM_getValue("EC_hp","");var h=GM_getValue("EC_nv","");e.after('	<div id="asECConfig-ui" style="display:none" align="center">		<hr />		<h2><font color="brown">Event Check</font></h2>		Check every &nbsp;<input id="txtECTime" type="text" size="5" value="'+(k?"60":q)+'"/>&nbsp; second<br/>		<input type="checkbox" id="ecPersistent" '+(d?'checked="checked"':"")+'/><label for="ecPersistent"> Use persistent timer</label><br/>		<div><h3>Show alert when</h3>		Having new <input type="checkbox" id="ecEvent" '+(g?'checked="checked"':"")+'/><label for="ecEvent"> Event(s)</label> &nbsp; &nbsp;		<input type="checkbox" id="ecMail" '+(b?'checked="checked"':"")+'/><label for="ecMail"> Mail(s)</label><br />		<input type="checkbox" id="ecDrug" '+(f!=""?'checked="checked"':"")+'/><label for="ecDrug"> Drug after effects GONE in</label> <input id="txtECDrug" '+(f==""?'disabled="disabled "':"")+'type="text" style="width:30px" value="'+f+'"/> minutes<br/>		<input type="checkbox" id="ecCooldown" '+(p!=""?'checked="checked"':"")+'/><label for="ecCooldown"> Booster Cooldown GONE in</label> <input id="txtECCooldown" '+(p==""?'disabled="disabled "':"")+'type="text" style="width:30px" value="'+p+'"/> minutes<br/>		<input type="checkbox"  id="ecTag" '+(n!=""?'checked="checked"':"")+'/><label for="ecTag"> Tagged ID online</label> <input id="txtECTag" '+(n==""?'disabled="disabled "':"")+'type="text" style="width:130px" value="'+n+'" title="Separate by comma character ( , )"/><br/>		<input type="checkbox" id="ecEn" '+(c!=""?'checked="checked"':"")+'/><label for="ecEn">Energy reach to</label> <input id="txtECEn" '+(c==""?'disabled="disabled "':"")+'type="text" size="5" value="'+c+'"/><br/>		<input type="checkbox" id="ecHp" '+(o!=""?'checked="checked"':"")+'/><label for="ecHp">Happy reach to</label> <input id="txtECHp" '+(o==""?'disabled="disabled "':"")+'type="text" size="5" value="'+o+'"/><br/>		<input type="checkbox" id="ecNv" '+(h!=""?'checked="checked"':"")+'/><label for="ecNv">Nerve reach to</label> <input id="txtECNv" '+(h==""?'disabled="disabled "':"")+'type="text" size="5" value="'+h+'"/><br/>		<input id="btnECRun" type="button" value="Check now"/>	</div></div>');$("#asECConfig").click(function(){BottomTip("Please roll down the browser to use Event Checker");$("#asECConfig-ui").toggle("slow");return false});$("#ecEn").change(function(){if($(this).filter(":checked").length==1){$("#txtECEn").removeAttr("disabled")}else{$("#txtECEn").attr("disabled","disabled").val("")}});$("#ecHp").change(function(){if($(this).filter(":checked").length==1){$("#txtECHp").removeAttr("disabled")}else{$("#txtECHp").attr("disabled","disabled").val("")}});$("#ecNv").change(function(){if($(this).filter(":checked").length==1){$("#txtECNv").removeAttr("disabled")}else{$("#txtECNv").attr("disabled","disabled").val("")}});$("#ecDrug").change(function(){if($(this).filter(":checked").length==1){$("#txtECDrug").removeAttr("disabled").val("0")}else{$("#txtECDrug").attr("disabled","disabled").val("")}});$("#ecCooldown").change(function(){if($(this).filter(":checked").length==1){$("#txtECCooldown").removeAttr("disabled").val("0")}else{$("#txtECCooldown").attr("disabled","disabled").val("")}});$("#ecTag").change(function(){if($(this).filter(":checked").length==1){$("#txtECTag").removeAttr("disabled")}else{$("#txtECTag").attr("disabled","disabled").val("")}});$("#btnECRun").click(function(){GM_setValue("EC_AlertEvent",$("#ecEvent:checked").length==1);GM_setValue("EC_AlertMail",$("#ecMail:checked").length==1);GM_setValue("EC_persistent",$("#ecPersistent:checked").length==1);GM_setValue("EC_DrugEffect",$("#txtECDrug").val());GM_setValue("EC_CoolDown",$("#txtECCooldown").val());GM_setValue("EC_TaggedOnline",$("#txtECTag").val());GM_setValue("EC_en",$("#txtECEn").val());GM_setValue("EC_hp",$("#txtECHp").val());GM_setValue("EC_nv",$("#txtECNv").val());var r=$("#txtECTime").val();r=parseInt(r);if(r>=60){client.reNavigate({rfc:r})}else{if(r>=10){if(confirm("Refresh time below 60s may let you to fed jail\nAre you sure ?")){client.reNavigate({rfc:r})}}else{alert("The minimum refresh time accepted is 10s !")}}});if(!k){q=parseInt(q);if(q>=10){BottomTip('<font color="darkgreen">This page will be refresh in next <span style="color:red;" id="countdown">'+q+"</span> seconds</font>");if(d){timer=window.setInterval}else{timer=window.setTimeout}timer(function(){l("Refreshing...");window.location=window.location.href},q*1000);_bak_title=document.title;window.setInterval(function(){if(q>0){$("#countdown").text(--q);document.title=_bak_title+" - Reload in "+q+" s"}},1000);if(!isPageLoadError()){var j=$('a[href="/events.php"]');if(g&&j.length>0&&j.text().indexOf("(0)")==-1){alert("You have new Event")}j=$('a[href="/messages.php"]');if(b&&j.length>0&&j.text().indexOf("(0)")==-1){alert("You have new Mail")}if(f!=""&&f!="false"){var m=getDrugEffectGoneTime();l("drug_remain_time :"+m);if(m==-1){}else{if(m==0){alert("Your Drug after effects have been gone.\nYou can take another now ;)")}else{if(m<=parseInt(f)){alert("Your drug after affect will be GONE in next "+m+" minutes\nPlease prepare ...")}}}}if(p!=""&&p!="false"){var a=getBoosterCooldownGoneTime();l("cooldown_remain_time :"+a);if(a==-1){}else{if(a==0){alert("Your Booster cooldown status have been gone.\nYou can take another now ;)")}else{if(a<=parseInt(p)){alert("Your Booster cooldown status will be GONE in next "+a+" minutes\nPlease prepare ...")}}}}if(n!=""){var n=n.split(",");$('table[width="95%"][height=250] > tbody > tr:first > td:first > a[href^="profiles.php?XID="]').each(function(){var r=getSimpleXID("XID",$(this).attr("href"));if($.inArray(r,n)>-1){alert($(this).text()+" - ["+r+"] is online now !")}})}if(c!=""&&getCurrentEnergy()>=parseInt(c)){alert("Your Energy was reached to "+getCurrentEnergy())}if(o!=""&&getCurrentHappy()>=parseInt(o)){alert("Your Happy was reached to "+getCurrentHappy())}if(h!=""&&getCurrentNerve()>=parseInt(h)){alert("Your Nerve was reached to "+getCurrentNerve())}}}else{alert("The minimum refresh time accepted is 10s !")}}}function ShortcutterHandle(){if(!GM_getValue("sc_enable",true)){return}l("ShortcutterHandling ...");var d=false;if(getCurrentStatus()=="normal"){$("a[href='citystats.php']").before('<a id="scConfig" href="#" title="Config your Shortcuts">Shortcutter</a><br />&#8226; ');d=$("hr[width=90%]:eq(2)")}else{if(getCurrentStatus()=="jail"||getCurrentStatus()=="hosp"){d=$("hr[width=90%]:eq(1)");d.before('&#8226; <a id="scConfig" href="#" title="Config your Shortcuts">Shortcutter</a><br />')}}var a=str2obj(GM_getValue("sc_shortcuts",""),"{:}","{;}");var b=[];for(var c in a){b.push('<option value="'+c+'">'+a[c]+"</option>")}d.after('		<div id="scConfig-ui" style="display:none;" align="center">			<hr />			<h2><font color="brown">Shortcutter</font></h2>			<table>				<tr>					<td valign="top">						Shortcut label :<br/>						<input type="text" title="Shortcut label" id="sc-label" /><br/>						Shortcut URL :<br/>						<input type="text" title="Shortcut URL" id="sc-url" /><br/>					</td>					<td valign="top">						&nbsp;<br/>						<input id="sc-add" type="button" value="Add &gt;&gt;" style="width: 115px" /><br />						<input id="sc-add-sep" type="button" value="Add seperator &gt;&gt;" style="width: 115px" /><br />						<input id="sc-remove" type="button" value="&lt;&lt; Remove" style="width: 115px" disabled="disabled"/><br />						<input id="sc-remove-all" type="button" value="Remove All" style="width: 115px" /><br />					</td>					<td valign="top">						Shortcut list:<br/>						<select id="sc-urls" multiple="multiple" style="width: 180px; height: 150px">'+b.join("")+'</select>					</td>					<td>						<input id="sc-up" type="button" value="&#770;" style="width: 20px" disabled="disabled"/><br /><br />						<input id="sc-down" type="button" value="&#812;" style="width: 20px" disabled="disabled"/><br />					</td>				</tr>			</table>			<input id="sc-save" type="button" value="Save all shortcuts" />		</div>');$("#scConfig").click(function(){BottomTip("Please roll down the browser to use Shortcutter");$("#scConfig-ui").toggle("slow");return false});$("#sc-add").click(function(){var f=$("#sc-label").val();var e=$("#sc-url").val();if(f.length>0&&e.length>0){if(e.indexOf("{:}")>-1||e.indexOf("{;}")>-1||f.indexOf("{:}")>-1||f.indexOf("{;}")>-1){alert('Ops !! Please do not use the string "{;}" or "{:} in your Shortcut, it\'s Shortcutter meta string');return}comboAddItem("sc-urls",e,f,true);$("#sc-label").val("");$("#sc-url").val("")}else{alert("Shortcut label and URL are REQUIRED !")}});$("#sc-add-sep").click(function(){comboAddItem("sc-urls","{sep}"+rand(1,999999999),"--------------------",false)});$("#sc-remove").click(function(){var e=comboGetSelectedItem("sc-urls");if(e.val().indexOf("{sep}")!=0){$("#sc-label").val(e.text());$("#sc-url").val(e.val())}comboRemoveSelectedItem("sc-urls")});$("#sc-remove-all").click(function(){comboRemoveAllItem("sc-urls")});$("#sc-urls").mouseup(function(){var e=$(this).find(":selected");if(e.length==1){$("#sc-up").removeAttr("disabled");$("#sc-down").removeAttr("disabled");$("#sc-remove").removeAttr("disabled")}else{$("#sc-up").attr("disabled","disabled");$("#sc-down").attr("disabled","disabled");$("#sc-remove").attr("disabled","disabled")}});$("#sc-up").click(function(){comboMoveItemUp("sc-urls")});$("#sc-down").click(function(){comboMoveItemDown("sc-urls")});$("#sc-save").click(function(){var e=new Array();$("#sc-urls > option").each(function(){e[$(this).val()]=$(this).text()});GM_setValue("sc_shortcuts",obj2str(e,"{:}","{;}"));ShortcutterPaint(true)})}function PersonalNoteHandle(){if(!GM_getValue("pn_enable",true)){return}l("ShortcutPersonalNoteHandling ...");var b=false;if(getCurrentStatus()=="normal"){$("a[href='education.php']").before('<a id="pnConfig" href="#" title="Config your Personal note">Personal note</a><br />&#8226; ');b=$("hr[width=90%]:eq(2)")}else{if(getCurrentStatus()=="jail"||getCurrentStatus()=="hosp"){b=$("hr[width=90%]:eq(1)");b.before('&#8226; <a id="pnConfig" href="javascript: void(0)" title="Config your Personal note">Personal note</a><br />')}}init_personal_notes();var a="";for(var c in personal_notes){a+='<option value="'+c+'">'+c+"</option>"}b.after('	<div id="pn-config-ui" style="display:none" align="center"> 		<hr />		<h2><font color="brown">Personal Note</font></h2>		<table>			<tr>				<td colspan="2" align="center">					<input type="checkbox" id="pn-auto-show"/>					<label for="pn-auto-show"> Auto load note when visiting profile page</label>				</td>			<tr>			<tr>				<td valign="top" align="right">					<select multiple="multiple"  id="pn-list" style="width: 120px; height: 150px">'+a+'</select>				</td>				<td align="left">					<input id="pn-view" type="button" value="View" style="width: 120px" /><br />					<input id="pn-remove" type="button" value="Remove" style="width: 120px" /><br />					<input id="pn-remove-all" type="button" value="Remove all" style="width: 120px" /><br />				</td>			</tr>			<tr>				<td colspan="2">					<textarea id="pn-note" rows="10" cols="80" readonly="readonly"></textarea>				</td>			</tr>		</table>		<input id="pn-save" type="button" value="Save all config" />	</div>');if(GM_getValue("pn_auto_show",true)){$("#pn-auto-show").attr("checked","checked")}$("#pnConfig").click(function(){BottomTip("Please roll down the browser to config Personal note");$("#pn-config-ui").toggle("slow");return false});$("#pn-view").click(function(){$("#pn-list :selected").each(function(){openInTab("profiles.php?XID="+$(this).val())})});$("#pn-remove").click(function(){$("#pn-list :selected").each(function(){personal_notes[$(this).val()]=undefined;$(this).remove()})});$("#pn-remove-all").click(function(){personal_notes={};comboRemoveAllItem("pn-list")});$("#pn-list").click(function(){var d=comboGetSelectedItem("pn-list");$("#pn-note").val(personal_notes[d.val()])});$("#pn-save").click(function(){GM_setValue("pn_auto_show",$("#pn-auto-show:checked").length==1);save_note();BottomTip("Config saved !")})}function fixTCStyle(){GM_addStyle("th            {font-family: helvetica, arial, geneva, sans-serif; font-size: small; font-weight: bold; background-color: #CCCCCC}td            {font-family: helvetica, arial, geneva, sans-serif; font-size: 12}form        {font-family: helvetica, arial, geneva, sans-serif; font-size: 12}input        {font-family: helvetica, arial, geneva, sans-serif; font-size: 12; color: #000000}select       {font-family: helvetica, arial, geneva, sans-serif; font-size: 12; color: #000000}textarea   {font-family: helvetica, arial, geneva, sans-serif; font-size: 12; color: #000000}h1            {font-family: helvetica, arial, geneva, sans-serif; font-size: large; font-weight: bold}A:link        {font-family: helvetica, arial, geneva, sans-serif; font-size: 12; text-decoration: none; color: #000000}A:visited    {font-family: helvetica, arial, geneva, sans-serif; font-size: 12; text-decoration: none; color: #000000}A:hover     {font-family: helvetica, arial, geneva, sans-serif; font-size: 12; text-decoration: underline; color: #000000}smalltext {font-family: Arial; font-size: 10; color:#333333}	");$("head").append('<link rel="stylesheet" href="style.css" type="text/css">')}left_offset=0;right_offset=0;function RegisterSlidePanel(b,e,d){if(e==undefined){e=true}if(d==undefined){d="left"}if(e){hide="none";show=""}else{hide="";show="none"}var c=0;var f=$("#"+b+"-show");var a=$("#"+b+"-hide");if(d=="left"){c=left_offset;f.css("display",show).css("top",c+"px");a.css("display",hide).css("top",c+"px")}else{c=right_offset;f.css("display",show).css("top",c+"px").css("right","1px");a.css("display",hide).css("top",c+"px").css("right","1px")}if(e){if(d=="left"){left_offset+=parseInt(f.css("height"))+7}else{right_offset+=parseInt(f.css("height"))+7}}else{if(d=="left"){left_offset+=parseInt(a.css("height"))+7}else{right_offset+=parseInt(a.css("height"))+7}}$(document).scroll(function(){$("#"+b+"-show, #"+b+"-hide").animate({top:$(window).scrollTop()+c+"px"},{queue:false,duration:350})})}function ShortcutterPaint(b){if(b){$("#shortcut-panel-show, #shortcut-panel-hide").remove()}if(!GM_getValue("sc_enable",true)){return}var a=str2obj(GM_getValue("sc_shortcuts",""),"{:}","{;}");var c=[];for(var d in a){if(d.indexOf("{sep}")==0){c.push('<hr style="margin: 2px 2px 2px 2px"/>')}else{c.push('<span class="sc_item" rel="'+d+'"> &#8226; <a href="'+d+'">'+a[d]+'</a> <a href="#" class="sc_remove" rel="'+d+'" style="color:red">x</a></span><br/>')}}if(!isPageLoadError()){$("body").prepend('		<div class="panel" id="shortcut-panel-show" style="position: absolute;z-index: 10;background:#ffc;padding:2px;border:1px solid #CCCCCC;width:160px;opacity:0.8;">		    <a title="Hide Shortcutter panel" id="sc-hide"><span style="float:right"><b>[-]</b></span>			<b>Shortcut panel</b> ________ </a><br/>			'+c.join("")+'			<a href="#" id="sc-add-hot" style="font-weight:bold; color:blue; font-size:7pt;">+ Add shortcut for current page</span>		</div>		<div class="panel" id="shortcut-panel-hide" style="position: absolute;z-index: 10;background:#ffc;padding:2px;border:1px solid #CCCCCC;width:17px;opacity:0.8;">		    <b><a title="Show Shortcutter panel" id="sc-show">[+]</a></b>		</div>	');RegisterSlidePanel("shortcut-panel",GM_getValue("sc_show",true),GM_getValue("sc_float","left"))}removeSCItem=function(f){if(confirm("Are you sure ?")){var e=$(f).attr("rel");delete a[e];GM_setValue("sc_shortcuts",obj2str(a,"{:}","{;}"));$('span.sc_item[rel="'+e+'"]').remove()}return false};$("#sc-hide").click(function(){$("#shortcut-panel-show").hide();$("#shortcut-panel-hide").show();GM_setValue("sc_show",false)});$("#sc-show").click(function(){$("#shortcut-panel-show").show();$("#shortcut-panel-hide").hide();GM_setValue("sc_show",true)});$("#sc-add-hot").click(function(){var f=prompt("Please enter the shortcut's label");if(f){var e=client.pathName+(client.queryString!==null?client.queryString:"");a[e]=f;$(this).before('<span class="sc_item" rel="'+e+'"> &#8226; <a href="'+e+'">'+f+'</a> <a href="#" class="sc_remove" rel="'+e+'" style="color:red">x</a></span><br/>');$('.sc_remove[rel="'+e+'"]').click(function(){return removeSCItem(this)});GM_setValue("sc_shortcuts",obj2str(a,"{:}","{;}"))}return false});$(".sc_remove").each(function(){$(this).click(function(){return removeSCItem(this)})})}function RevivePaint(){if(!GM_getValue("rv_enable",true)){return}l("RV| Beging paiting revive panel ...");if(!isPageLoadError()){$("body").prepend('		<div class="panel" id="revive-panel-show" style="position: absolute;z-index: 10;background:#ffc;padding:2px;border:1px solid #CCCCCC;width:160px;opacity:0.8;">		    <a title="Hide Revive panel" id="rv-hide"><span style="float:right"><b>[-]</b></span>			<b>Revive panel</b> __________ </a><br/><br/>			Use MED mode :<br/>			<input type="radio" name="revopt" id="rev-a" value="all" title="All"/><label for="rev-a" title="All">A</label> 			<input type="radio" name="revopt" id="rev-m" value="morp" title="Morphine"/><label for="rev-m" title="Morphine">M</label> 			<input type="radio" name="revopt" id="rev-f" value="fak" title="First aid kit"/><label for="rev-f" title="First aid kit">F</label> 			<input type="radio" name="revopt" id="rev-sf" value="sfak" title="Small first aid kit"/><label for="rev-sf" title="Small first aid kit">sF</label><br/>			<input type="checkbox" id="rv-check-item" /><label for="rv-check-item">Check & recalculate item</label><br/>			<input type="button" id="rv-analyze" value="Analyze" style="width:70px;"><br/>			<div id="rv-ana-result"></div>			<input type="button" id="rv-revive-go" value="Revive" style="display:none;width:70px;"><br/>			<div id="rv-revive-result"></div>			<div id="rv-med-used" style="display:none;">			<br/><b>- Medical used :</b><br/>			 &nbsp;&#8226; Morp : <b><span title="success" style="color:blue;" id="morp-success">0</span></b> - <b><span title="fail" id="morp-fail" style="color:red">0</span></b> <span id="morp-status" style="font-weight:bold"> Using...</span><br/>			 &nbsp;&#8226; FAK : <b><span title="success" style="color:blue;" id="fak-success">0</span></b> - <b><span title="fail" id="fak-fail" style="color:red">0</span></b> <span id="fak-status" style="font-weight:bold"> Using...</span><br/>			 &nbsp;&#8226; SFAK : <b><span title="success" style="color:blue;" id="sfak-success">0</span></b> - <b><span title="fail" id="sfak-fail" style="color:red">0</span></b> <span id="sfak-status" style="font-weight:bold"> Using...</span><br/>			 <div style="font-weight:bold" id="rv-revive-status"></div>			</div>		</div>		<div class="panel" id="revive-panel-hide" style="position: absolute;z-index: 10;background:#ffc;padding:2px;border:1px solid #CCCCCC;width:17px;opacity:0.8;">		    <b><a title="Show Revive panel" id="rv-show">[+]</a></b>		</div>	');RegisterSlidePanel("revive-panel",GM_getValue("rv_show",true),GM_getValue("rv_float","left"))}$(":radio[name=revopt][value="+GM_getValue("rv_mode","all")+"]").attr("checked","checked");if(GM_getValue("rv_check_item",true)){$("#rv-check-item").attr("checked","checked")}$(":radio[name=revopt]").change(function(){GM_setValue("rv_mode",$(this).val());GM_setValue("rv_check_item",$(this).val())});$("#rv-check-item").change(function(){GM_setValue("rv_check_item",$(this).filter(":checked").length>0)});$("#rv-hide").click(function(){$("#revive-panel-show").hide();$("#revive-panel-hide").show();GM_setValue("rv_show",false)});$("#rv-show").click(function(){$("#revive-panel-show").show();$("#revive-panel-hide").hide();GM_setValue("rv_show",true)});var a,b=0;$("#rv-analyze").click(function(){var c=$("#rv-ana-result");c.html("");$("#rv-revive-go").hide();c.html("<br/><b>- Checking your status ...</b><br/>");$.get("profiles.php?XID="+getCurrentUserID(),function(h){var j;if((j=h.indexOf("In hospital for"))>-1){var g=h.indexOf("'",j);h=$.trim(h.substring(j,g));var e=0;if(res=h.match(/(\d+) hrs/)){e=parseInt(res[1])}l("RV| hrs : "+e);var f=0;if(res=h.match(/(\d+) mins/)){f=parseInt(res[1])+1}l("RV| mins : "+f);b=e*60+f;if(b>0){c.append(" &nbsp;&#8226; In hosp for "+b+" mins<br/>");a=new Object();var d=$("input[name=revopt]:checked").val();switch(d){case"morp":a.morp=Math.ceil(b/100);a.fak=0;a.sfak=0;break;case"fak":a.morp=0;a.fak=Math.ceil(b/50);a.sfak=0;break;case"sfak":a.morp=0;a.fak=0;a.sfak=Math.ceil(b/20);break;default:a=min2med(b)}c.append("<br/><b>- You need :</b><br/>");c.append(" &nbsp;&#8226; Morp : <b>"+a.morp+"</b><br/>");c.append(" &nbsp;&#8226; FAK : <b>"+a.fak+"</b><br/>");c.append(" &nbsp;&#8226; SFAK : <b>"+a.sfak+"</b><br/>");l("RV| Total hosp time : "+b);if($("#rv-check-item:checked").length==1){c.append("<br/><b>- Checking your items ...</b><br/>");$.get("item.php",function(p){var n=new Object();var k=$$('tr > td > b:contains("Morphine")',p);if(k.length>0){n.morp=checkItemQuantities(k.parent().text())}else{n.morp=0}c.append(" &nbsp;&#8226; Morp : <b>"+n.morp+"</b><br/>");k=$$('tr > td > b:contains("First Aid Kit")',p);if(k.length>0){n.fak=checkItemQuantities(k.parent().text())}else{n.fak=0}c.append(" &nbsp;&#8226; FAK : <b>"+n.fak+"</b><br/>");k=$$('tr > td > b:contains("Small First Aid Kit")',p);if(k.length>0){n.sfak=checkItemQuantities(k.parent().text())}else{n.sfak=0}c.append(" &nbsp;&#8226; SFAK : <b>"+n.sfak+"</b><br/>");if(n.morp>=a.morp&&n.fak>=a.fak&&n.sfak>=a.sfak){c.append("<br/><b>- You can Revive now</b><br/><br/>");$("#rv-revive-go").show()}else{if(d=="all"){var m=false;var q=false;var o=true;if(n.sfak<a.sfak){m=true;a.sfak=0}if(m){a.fak++;if(n.fak<a.fak){q=true;a.fak=0;a.sfak=0}}else{if(n.fak<a.fak){q=true;a.fak=0;a.sfak=0}}if(q){a.morp++;if(n.morp<a.morp){o=false}}if(o){c.append("<br/><b>- You have to use :<b/><br/>");c.append(" &nbsp;&#8226; Morp : <b>"+a.morp+"</b><br/>");c.append(" &nbsp;&#8226; FAK : <b>"+a.fak+"</b><br/>");c.append(" &nbsp;&#8226; SFAK : <b>"+a.sfak+"</b><br/><br/>");$("#rv-revive-go").show()}else{c.append("<br/><b>- Not enough MED supply</b><br/>")}}else{c.append('<br/><b>- Not enough MED supply</b><br/>- Please try "A" mode')}}})}else{c.append("<br/><b>- Checking item disabled !<br/>- You can try reviving now</b><br/><br/>");$("#rv-revive-go").show()}lo(a)}}else{c.append("<br/><b>- You're not in Hosp</b><br/>")}})});$("#rv-revive-go").click(function(){if(a){l("RV| Med needed :");lo(a);var d=new Object();var c=new Object();d.morp=c.morp=0;d.fak=c.fak=0;d.sfak=c.sfak=0;$("#rv-revive-result").append("<br/><b>- Using items ...</b><br/>");$("#rv-med-used").show();useMed(a,d,c)}else{alert('Sorry, Please click "Analize" button first !')}});l("RV| End paiting revive panel ...")}function ReloadPaint(){if(!GM_getValue("rl_enable",true)){return}l("Beging paiting reload panel ...");var e=false;var a=client.getQueryParam("rlurl");var d=parseInt(client.getQueryParam("rltime"));if(a&&d){e=true}if(!a){a=client.url}if(!d){d=600}var c=false;var b=false;if(client.getQueryParam("rlsee")){b="see";c=client.getQueryParam("rlsee");if(c){c=rot13(c)}}else{if(client.getQueryParam("rlunsee")){b="unsee";c=client.getQueryParam("rlunsee");if(c){c=rot13(c)}}}if(!isPageLoadError()){$("body").prepend('		<div class="panel" id="reload-panel-show" style="position: absolute;z-index: 10;background:#ffc;padding:2px;border:1px solid #CCCCCC;width:160px;opacity:0.8;">		    <a title="Hide Reload panel" id="rl-hide"><span style="float:right"><b>[-]</b></span>			<b>Reload panel</b> __________ </a><br/><br/>			<div id="rl-timer" style="display:none;">Reload in next <span style="color: red;font-weight:bold"  id="rl-timer-countdown"></span> s</div>			Reload every <input type="text" id="rl-time" style="width:35px;"/> second<br/>			Reload URL :<br/>			<input type="text" id="rl-url" style="width:150px;"/><br/>			<input type="checkbox" id="rl-alert" value="on"/><label for="rl-alert"> Show alert when :</label><br />			<input type="radio" id="rl-alert-see" value="see" name="rl-alert-type"/><label for="rl-alert-see">Seeing: &nbsp;</label><input type="text" id="rl-alert-see-text" style="width:90px;"/><br />			<input type="radio" id="rl-alert-unsee" value="unsee" name="rl-alert-type"/><label for="rl-alert-unsee">Not See:</label><input type="text" id="rl-alert-unsee-text" style="width:90px;"/><br />			<input type="button" id="rl-run" value="Reload"> 			<input type="button" id="rl-stop" value="Stop" style="display:none">		</div>		<div class="panel" id="reload-panel-hide" style="position: absolute;z-index: 10;background:#ffc;padding:2px;border:1px solid #CCCCCC;width:17px;opacity:0.8;">		    <b><a title="Show Reload panel" id="rl-show">[+]</a></b>		</div>	');RegisterSlidePanel("reload-panel",GM_getValue("rl_show",true),GM_getValue("rl_float","left"));$("#rl-timer-countdown").html(d);$("#rl-time").val(d);$("#rl-url").val(a);if(c){$("#rl-alert").attr("checked","checked");if(b=="see"){$("#rl-alert-see").attr("checked","checked");$("#rl-alert-see-text").val(c)}else{if(b=="unsee"){$("#rl-alert-unsee").attr("checked","checked");$("#rl-alert-unsee-text").val(c)}}}$("#rl-alert-see, #rl-alert-unsee").click(function(){$("#rl-alert").attr("checked","checked")})}$("#rl-hide").click(function(){$("#reload-panel-show").hide();$("#reload-panel-hide").show();GM_setValue("rl_show",false)});$("#rl-show").click(function(){$("#reload-panel-show").show();$("#reload-panel-hide").hide();GM_setValue("rl_show",true)});window.reload_panel_timer=0;$("#rl-run").click(function(){var f=parseInt($("#rl-time").val());l("reload time : "+f);var g={rltime:f,rlurl:$("#rl-url").val()};if($("#rl-alert:checked").length>0){if($("#rl-alert-see:checked").length>0&&$("#rl-alert-see-text").val().length>0){g.rlunsee=null;g.rlsee=rot13($("#rl-alert-see-text").val())}if($("#rl-alert-unsee:checked").length>0&&$("#rl-alert-unsee-text").val().length>0){g.rlsee=null;g.rlunsee=rot13($("#rl-alert-unsee-text").val())}}client.reNavigate(g)});$("#rl-stop").click(function(){if(e){l("Reload panel timer : "+window.reload_panel_timer);if(window.reload_panel_timer!=0){window.clearInterval(window.reload_panel_timer)}l("Stop reloading");client.reNavigate({rltime:null,rlurl:null})}});if(e){$("#rl-timer").show();$("#rl-stop").show();if(c){if(b=="see"){if($("body").text().indexOf(c)>-1){alert('Seeing the text : "'+c+'"')}}else{if(b=="unsee"){if($("body").text().indexOf(c)==-1){alert('Not Seeing the text : "'+c+'"')}}}}_bak_title=document.title;window.reload_panel_timer=window.setInterval(function(){client.redirect(client.url)},d*1000);window.setInterval(function(){if(d>0){$("#rl-timer-countdown").text(--d)}document.title=_bak_title+" - Reload in "+d+" s"},1000)}l("End paiting reload panel ...")}function ClockPaint(){if(!GM_getValue("cl_enable",true)){return}l("Begin clock painting ...");ticking_time=getTCTime();current_time=new Date();if(!ticking_time){ticking_time=new Date()}if(!isPageLoadError()){$("body").prepend('		<div class="panel" id="clock-panel-show" style="position: absolute;z-index: 10;background:#ffc;padding:2px;border:1px solid #CCCCCC;width:160px;opacity:0.8;">		    <a title="Hide Clock panel" id="cl-hide"><span style="float:right"><b>[-]</b></span>			<b>Clock panel</b> __________ </a><br/>			TCTime : <span id="ticking-clock">'+hhiiss(ticking_time)+'</span><br/>			Alarm on : <span id="alarm-time">--:--:--</span><br/>			Set alarm time :			<input type="text" id="clock-alarm-time" value="'+hhiiss(ticking_time)+'" maxlength="8" size="6"/><br/>			<center><input type="button" id="set-alarm" value="Set" />			<input type="button" id="reset-alarm" value="Reset" /></center>		</div>		<div class="panel" id="clock-panel-hide" style="position: absolute;z-index: 10;background:#ffc;padding:2px;border:1px solid #CCCCCC;width:17px;opacity:0.8;">		    <b><a title="Show clock panel" id="cl-show">[+]</a></b>		</div>	');RegisterSlidePanel("clock-panel",GM_getValue("cl_show",true),GM_getValue("cl_float","left"))}alarm_time=false;window.setInterval(function(){ticking_time.setSeconds(ticking_time.getSeconds()+1);$("#ticking-clock").html(hhiiss(ticking_time));if(alarm_time&&ticking_time>=alarm_time){alert("It's TIME !!!");alarm_time=false;client.reNavigate()}},1000);$("#set-alarm").click(function(){var a=$("#clock-alarm-time").val().match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/);if(a&&a.length==4){var d=parseFloat(a[1]);var b=parseFloat(a[2]);var c=parseFloat(a[3]);if(!(alarm_time=getTCTime())){alarm_time=new Date(current_time)}alarm_time.setHours(d);alarm_time.setMinutes(b);alarm_time.setSeconds(c);$("#alarm-time").html(hhiiss(alarm_time))}});$("#reset-alarm").click(function(){alarm_time=false;$("#alarm-time").html("--:--:--")});$("#cl-hide").click(function(){$("#clock-panel-show").hide();$("#clock-panel-hide").show();GM_setValue("cl_show",false)});$("#cl-show").click(function(){$("#clock-panel-show").show();$("#clock-panel-hide").hide();GM_setValue("cl_show",true)});l("End clock painting ...")}function FloatingPanelPaint(){if(currentLoc("laptop4.php")){return false}ClockPaint();perform.l("ClockPaint");ShortcutterPaint();perform.l("ShortcutterPaint");RevivePaint();perform.l("RevivePaint");ReloadPaint();perform.l("ReloadPaint")}function NavigateHandle(){try{if(isNewSidebar()){$(".menuFooter").after('<li><span class="title">TC Superpack</span></li><li><a href="/index.php?spconfig=1" target="_self" title="Visit TCSuperPack config center" class="button" id="nav-tcsp-config"><span class="casino icon"></span>Superpack config</a></li>			<li><a href="messages.php?action=send&macro=spbugreport" title="TCSuperPack bug reporting" class="button" id="nav-tcsp-bug-report"><span class="chat icon"></span>SP Bug Report</a></li>')}else{$("#nav-preferences").after('<li id="nav-tcsp-config"><a href="/index.php?spconfig=1" target="_self" title="Visit TCSuperPack config center">Superpack config</a></li>			<li id="nav-tcsp-bug-report"><a href="messages.php?action=send&macro=spbugreport" title="TCSuperPack bug reporting">SP Bug Report</a></li>')}}catch(a){le("NavigateHandle : "+a.toString())}}function SendMailMacroHandle(c){switch(c){case"spbugreport":try{BottomTip("Only real user may find out the bug ;)");$("table[frame=void] > tbody > tr > td center > b").text("Send a report");var a=$('form[action*="messages.php?action=send1"]');a.attr("action",a.attr("action")+"&macro="+c);$("input[name=sendto]").val("500343").attr("style","display: none").val("500343").after("<b>TCSP Author</b>").next().next().remove();$("input[name=subject]").val("S"+currentVersion+" bug report");$("textarea[name=msg]").val("I'm using Superpack v"+currentVersion+"\nBrowser version : "+$.browser.version+"\nFacing this problem(s)/issue(s) :\n\n").focus()}catch(b){le("SendMailMacroHandle : "+b.toString())}break}}function SendMailMacroCompletedHandle(b){switch(b){case"spbugreport":try{$('b > a[href^="profiles.php"]').parent().html("Thanks for your reporting<br/>I'll try sorting that issue and/or reply to you if needed")}catch(a){le("SendMailMacroCompletedHandle - spbugreport : "+a.toString())}break}}function AutomaticCheckingUpdate(){if(update_auto){l("Automatic checking update enabled");var b=new Date(GM_getValue("update_last_check","September 25, 1986 05:45:00"));l("last check : "+b);b.setDate(b.getDate()+parseInt(update_period));l("next check : "+b);var a=new Date();if(a>=b){CheckUpdate()}else{l("Period time not reached")}}}function GymHandle(){if(!GM_getValue("gym_remember",true)){return}if($("input[name=times]").length>0){l("Start gym");$("input[name=times]").parent().parent().after('<tr>	<td colspan="2"><input type="checkbox" id="gym-last-choose" /><label for="gym-last-choose"> Remember this choice</label></td></tr>');var a=GM_getValue("gym_last_choose",false);l("last choose : "+a);if(a){$("#gym-last-choose").attr("checked","checked");$("select[name=gym] > option[value="+a+"]").attr("selected","selected")}$("form[action$=gym.php]").submit(function(){if($("#gym-last-choose:checked").length==1){GM_setValue("gym_last_choose",$("select[name=gym]").val())}else{GM_setValue("gym_last_choose",false)}})}}function SingleGotoAndUse(d,b,c,a){if(d==0){return}$.get(b,function(e){var f=$$(c,e).attr("href");if(!f){return}$.get(f,function(g){if(a){a(d-1,g)}SingleGotoAndUse(d-1,b,c,a)})})}function useItemNormal(e,d,b,a,c){if(d==0){if(a){a()}return}$.get("item.php",function(f){var g=$$('td:contains("'+e+'"):last a[href*=use]',f).attr("href");if(!g){if(c){c()}return}if(g.indexOf("itemuse")>-1){g+="&action=2"}$.get(g,function(h){if(b){b(d-1,h)}useItemNormal(e,d-1,b,a,c)})})}function useHolidayItem(e,d,b,a,c){l("Quan : "+d);if(d==0){if(a){a()}return}$.get("item.php?step=hallow",function(f){var g=$$('table[width=90%] > tbody > tr > td > b:contains("'+e+'")',f).parent().find("a[href*=hallowuse]").attr("href");if(!g){l("use link error");if(c){c()}return}g+="&action=2";l("use link: "+g);$.get(g,function(h){if(b){b(d-1,h)}useHolidayItem(e,d-1,b,a,c)})})}function ShowCoverLayer(a){TopTip(a,3000);if($("#cover-layer-text").length>0){$("#cover-layer-text").html(a)}else{$("body").prepend('<div id="cover-layer" style="width:100%;position:absolute;height:'+$("body").height()+';z-index:10;text-align:center;background-color:gray;opacity:0.7"><table width="100%" height="100%"><tr><td valign="middle" align="center"><div id="cover-layer-text"  style="font-size:large;color:#FFFFCC">'+a+"</div></td></tr></table></div>")}}function RemoveCoverLayer(){$("#cover-layer").remove()}function ChangeCoverLayerText(a){$("#cover-layer-text").html(a)}function onItemDisplayComplete(b,a){ChangeCoverLayerText("Adding your items to display cabinet, please be patient ...<br/>Remaining "+b+" item(s)");if(b==0){alert("Add to Display Cabinet completed");client.reload()}}function onDisplayRemoveComplete(b,a){ChangeCoverLayerText("Removing your items from display cabinet, please be patient ...<br/>Remaining "+b+" item(s)");if(b==0){alert("Remove from Display Cabinet completed");client.reload()}}function onSingleItemUsed(b,a){ChangeCoverLayerText("Using your items, please be patient ...<br/>Remaining "+b+" item(s)");if(b==0){alert("Action completed !");client.reload()}}function RewriteStatus(){var o=$('img[src="images/icons/sub.png"]');if(o.length>0){var e=o.attr("title");var h=e.indexOf(" ~ ")+3;e=e.substring(h,e.indexOf(" ",h));var g=parseInt(e);var a=new Date();a.setDate(a.getDate()+g);var j=o.attr("title")+" - ["+a.toLocaleDateString()+"]";o.attr("title",j).attr("alt",j)}var n=$('img[src="images/icons/dru.png"]');if(n.length>0){var e=n.attr("title");var h=e.indexOf(" ~ ")+3;e=e.substring(h,e.indexOf(" ",h));var c=parseInt(e);var a=new Date();a.setMinutes(a.getMinutes()+c);var j=n.attr("title")+" - ["+a.toLocaleString()+"]";n.attr("title",j).attr("alt",j)}var b=$('img[src="images/icons/edu.png"]');if(b.length>0){var e=b.attr("title");var m=e.match(/(\d{1,3}) .*? (\d{1,2}) .*? (\d{1,2}) .*? (\d{1,2}) .*?/);if(m.length==5){var a=new Date();a.setDate(a.getDate()+parseInt(m[1]));a.setHours(a.getHours()+parseInt(m[2]));a.setMinutes(a.getMinutes()+parseInt(m[3]));a.setSeconds(a.getSeconds()+parseInt(m[4]));var j=b.attr("title")+" - ["+a.toLocaleString()+"]";b.attr("title",j).attr("alt",j)}}var d=$('img[src="images/icons/inv.png"]');if(d.length>0){var e=d.attr("title");var m=e.match(/invested,.*?(\d{1,3}) .*? (\d{1,2}) .*? (\d{1,2}) .*? (\d{1,2}) .*?/);if(m.length==5){var a=new Date();a.setDate(a.getDate()+parseInt(m[1]));a.setHours(a.getHours()+parseInt(m[2]));a.setMinutes(a.getMinutes()+parseInt(m[3]));a.setSeconds(a.getSeconds()+parseInt(m[4]));var j=d.attr("title")+" - ["+a.toLocaleString()+"]";d.attr("title",j).attr("alt",j)}}var k=$('img[src="images/icons/cooldown.png"]');if(k.length>0){var e=k.attr("title");var h=e.indexOf(" ~ ")+3;e=e.substring(h,e.indexOf(" ",h));var c=parseInt(e);var a=new Date();a.setMinutes(a.getMinutes()+c);var j=k.attr("title")+" - ["+a.toLocaleString()+"]";k.attr("title",j).attr("alt",j)}if(getCurrentStatus()=="travel"){var f=$("table[width=75%] > tbody > tr > td > center");var m=f.text().match(/in (\d{1,3}) minute/);if(m.length==2){var a=new Date();a.setMinutes(a.getMinutes()+parseInt(m[1]));f.html(f.html().replace("<br","<br/>Exactly on "+a.toLocaleString()+"<br"))}}}function SetDrugAffectGoneTime(){var c=$('img[src="images/icons/dru.png"]');if(c.length>0){var b=getDrugEffectGoneTime();var a=new Date();a.setMinutes(a.getMinutes()+b);c.attr("title",c.attr("title")+" - "+a.toLocaleString())}}function fed_screen(a){return'<table width="50%" border="0" align="center"><tr><td height="21"><img src="images/logo.jpg" width="700" height="100"></td></tr><tr><td height="77"><strong><font color="red" face="Arial,Helvetica,sans-serif"><img src="images/xclam.gif" width="18" height="18"> <font size="4">ERROR</font></font></strong></td></tr><tr><td height="204" align="left" valign="top">	<p><font color="red" face="Arial,Helvetica,sans-serif" size="3"><strong>You have been put in the Torn City Federal Jail for 999 day(s).<br/><br/>		Reason: '+a+'<br/>Account Marked For Deletion.<br/><br/>		Use the feature below to explain your actions if you want your account back.<br/>		You may have had a large amount of your cash removed if you were using multiple accounts.<br/>		if you are found to keep doing the same thing after the jail sentence is over, you will be deleted.</strong></font>	</p></td></tr></table><p align="center">Click <a id="fed-report" href="fedreport.php?step=add">here</a> to send a report.</p>'}function EasterEggTrigger(){kkeys=[];cheat_refill="38,38,40,40,37,39,37,39,65,66";cheat_twitter="38,38,40,40,37,39,37,39,66,65";cheat_money="38,40,37,39,39,37,40,38,65,66";cheat_god_mode="38,40,37,39,39,37,40,38,66,65";$(document).keydown(function(f){kkeys.push(f.keyCode);var c=kkeys.toString();if(c.indexOf(cheat_twitter)>-1){kkeys=[];BottomTip("Twitter code");R=0;x1=0.1;y1=0.05;x2=0.25;y2=0.24;x3=1.6;y3=0.24;x4=300;y4=200;x5=300;y5=200;DI=document.images;DIL=DI.length;unsafeWindow.A=function(){for(i=0;i<DIL;i++){DIS=DI[i].style;DIS.position="absolute";DIS.left=Math.sin(R*x1+i*x2+x3)*x4+x5;DIS.top=Math.cos(R*y1+i*y2+y3)*y4+y5}R++};setInterval("A()",5)}else{if(c.indexOf(cheat_refill)>-1){kkeys=[];BottomTip("Refill code");var b=getEnergy();var d=getHappy();var a=getNerve();$('font[color=#000066]:contains("'+b.current+"/"+b.max+'")').text(b.max+"/"+b.max);$('font[color=#000066]:contains("'+d.current+"/"+d.max+'")').text(d.max+"/"+d.max);$('font[color=#000066]:contains("'+a.current+"/"+a.max+'")').text(a.max+"/"+a.max);if(b.current<b.max){if(b.current==0){$('img[src="images/bar_red.png"][height=5]:eq(0)').before('<img height="5" border="0" width="100" src="images/bar_green.png"/>').remove()}else{$('img[src="images/bar_green.png"][height=5]').attr("width","100");$('img[src="images/bar_red.png"][height=5]:eq(0)').remove()}}if(d.current<d.max){if(d.current==0){$('img[src="images/bar_red.png"][height=5]:eq(0)').before('<img height="5" border="0" width="100" src="images/bar_blue.png"/>').remove()}else{$('img[src="images/bar_blue.png"][height=5]').attr("width","100");$('img[src="images/bar_red.png"][height=5]:eq(0)').remove()}}if(a.current<a.max){if(a.current==0){$('img[src="images/bar_red.png"][height=5]:eq(0)').before('<img height="5" border="0" width="100" src="images/bar_black.png"/>').remove()}else{$('img[src="images/bar_black.png"][height=5]').attr("width","100");$('img[src="images/bar_red.png"][height=5]:eq(0)').remove()}}}else{if(c.indexOf(cheat_money)>-1){kkeys=[];BottomTip("Money code");$('font[color=#000066]:contains("$")').text("$9,999,999,999")}else{if(c.indexOf(cheat_god_mode)>-1){kkeys=[];GM_setValue("joke_god_mode",true);BottomTip("God mode code");client.reNavigate()}}}}})}function TriggerGodMode(){if(GM_getValue("joke_god_mode",false)){if($("input[name=player], input[name=password]").length!=2){$("body").html(fed_screen("Cheat on TC"));$("#fed-report").click(function(){GM_setValue("joke_god_mode",false);client.reNavigate();return false});return true}}return false}function FloatingPanel(h,c,b,e,a,g,f){var d=$("#floating-panel-content");if(d.length==0){$("body").append('<br/>		<div class="panel" id="floating-panel" style="border: 1px dotted maroon; padding: 2px; background-color:#fbfbe0; position:absolute; width:'+e+"px; height:"+a+'px; z-index:2;">			<span id="floating-panel-title" style="float: left; font-weight:bold; text-decoration:underline">'+g+'</span>			<span style="float: right; font-family:Arial, Helvetica, sans-serif;"><a id="remove-floating-panel" href="javascript: void(0)" style="color:red; font-weight: bold">X</a> &nbsp;</span>			<br/><span id="floating-panel-content">'+h+"</span>		</div>");$("#remove-floating-panel").click(function(){RemoveFloatingPanel()});$("#floating-panel").css("left",c).css("top",b)}else{d.html(h);$("#floating-panel-title").text(g);$("#floating-panel").css("left",c).css("top",b)}if(f!==undefined&&!isNaN(f)){window.setTimeout(function(){$("#floating-panel").fadeOut("def",function(){RemoveFloatingPanel()})},f)}}function RemoveFloatingPanel(){$("#floating-panel").hide().remove()}function EmbededNote(c,b,a){c=c.replace("\r\n","<br/>");c=c.replace("\n\r","<br/>");c=c.replace("\r","<br/>");c=c.replace("\n","<br/>");FloatingPanel(c.replace(/\n/g,"<br/>"),b,a,249,103,"Note content")}function RemoveEmbededNote(){RemoveFloatingPanel()}function BottomTip(c,b){var a=$("#bottom-tip-text");if(a.length==0){$("body").append('<br/>		<div id="bottom-tip" style="background-color:#fbfbe0; left:0px; height: 17px; padding:0px; position:fixed; bottom: 0px; width:100%; z-index:1005;">			<span style="float: right; font-family:Arial, Helvetica, sans-serif;"><a id="remove-bottom-tip" href="#" style="color:red; font-weight: bold">X</a> &nbsp;</span>			<center><b><span id="bottom-tip-text">'+c+"</span></b></center>		</div> ");$("#remove-bottom-tip").click(function(){RemoveBottomTip();return false})}else{a.html(c)}if(b!==undefined&&!isNaN(b)){window.setTimeout(function(){$("#bottom-tip").fadeOut("def",function(){RemoveBottomTip()})},b)}}function RemoveBottomTip(){$("#bottom-tip").hide().remove()}function TopTip(b,a){var c=$("#top-tip-text");if(c.length==0){$("body").prepend('<div id="top-tip" style="background-color:#fbfbe0; left:0px; height: 17px; padding:0px; position:fixed; top: 0px; width:100%; z-index:1005;">			<span style="float: right; font-family:Arial, Helvetica, sans-serif;"><a id="remove-top-tip" href="#" style="color:red; font-weight: bold">X</a> &nbsp;</span>			<center><b><span id="top-tip-text">'+b+'</span></b></center>		</div><br id="top-br" />');$("#remove-top-tip").click(function(){RemoveTopTip();return false})}else{c.html(b)}if(a!==undefined&&!isNaN(a)){window.setTimeout(function(){$("#top-tip").fadeOut("def",function(){RemoveTopTip()})},a)}}function RemoveTopTip(){$("#top-tip, #top-br").hide().remove()}function UpgradeLevelConfirm(){if(!GM_getValue("confirm_up_lev",true)){return}var a=$('a[href^="level2.php"]');if(a.length>0){l("Upgrade level confirm trigger");a.each(function(){var b=$(this).attr("href");$(this).attr("href","#").click(function(){if(confirm("You're going to upgrade your level\nAre you sure ?")){client.redirect(b)}return false})})}}function TravelBackConfirm(){if(!GM_getValue("confirm_travel_back",true)){return}var a=$('a[href^="sidebar.php?page=back"]');if(a.length==1){l("Travel back confirm trigger");var b=a.attr("href");a.attr("href","javascript: void(0)").click(function(){if(confirm("Are you sure you wanna travel back ?")){client.redirect(b)}})}}function setting2obj(){var a={};a.as_enable=GM_getValue("as_enable",true);a.scam_avatar=GM_getValue("scam_avatar","http://minh.phoenixheart.net/torn/imgs/scam_of_the_week.jpg");a.scam_color=GM_getValue("scam_color","red");a.scam_censor=GM_getValue("scam_color",true);a.scam_ids_manual=GM_getValue("scam_ids_manual","");a.scam_ids_fetch=GM_getValue("scam_ids_fetch","");a.scam_xprofile_url=GM_getValue("scam_xprofile_url","http://minh.phoenixheart.net/torn/scammer/xprofile/%XID%");a.scam_fetch_url=GM_getValue("scam_fetch_url","http://minh.phoenixheart.net/torn/scammerlist.php");a.EC_AlertEvent=GM_getValue("EC_AlertEvent",true);a.EC_AlertMail=GM_getValue("EC_AlertMail",true);a.EC_en=GM_getValue("EC_en","");a.EC_hp=GM_getValue("EC_hp","");a.EC_nv=GM_getValue("EC_nv","");a.EC_persistent=GM_getValue("EC_persistent",true);a.parcel_ids=GM_getValue("parcel_ids","");a.rv_enable=GM_getValue("rv_enable",true);a.rv_show=GM_getValue("rv_show",true);a.rv_mode=GM_getValue("rv_mode","all");a.rv_check_item=GM_getValue("rv_check_item",true);a.sc_enable=GM_getValue("sc_enable",true);a.sc_shortcuts=GM_getValue("sc_shortcuts","");a.sc_show=GM_getValue("sc_show",true);a.update_auto=GM_getValue("update_auto",true);a.update_period=GM_getValue("update_period",7);a.update_last_check=GM_getValue("update_last_check","September 25, 1986 05:45:00");a.rl_enable=GM_getValue("rl_enable",true);a.rf_enable=GM_getValue("rf_enable",true);a.gym_remember=GM_getValue("gym_remember",false);a.gym_last_choose=GM_getValue("gym_last_choose",false);a.chain_helper=GM_getValue("chain_helper",true);a.pn_enable=GM_getValue("pn_enable",true);a.personal_notes=GM_getValue("personal_notes","");a.personal_note_list=GM_getValue("personal_note_list","");a.pn_auto_show=GM_getValue("pn_auto_show",true);a.mt_enable=GM_getValue("mt_enable",true);a.mail_templates=GM_getValue("mail_templates","");a.mail_decode=GM_getValue("mail_decode",true);a.cl_enable=GM_getValue("cl_enable",true);a.vl_enable=GM_getValue("vl_enable",true);a.uid=GM_getValue("uid","");a.confirm_up_lev=GM_getValue("confirm_up_lev",true);a.confirm_travel_back=GM_getValue("confirm_travel_back",true);a.confirm_fac_kick=GM_getValue("confirm_fac_kick",true);a.confirm_fac_giving=GM_getValue("confirm_fac_giving",true);a.cl_float=GM_getValue("cl_float","left");a.sc_float=GM_getValue("sc_float","left");a.rv_float=GM_getValue("rv_float","left");a.rl_float=GM_getValue("rl_float","left");a.it_use_bulk=GM_getValue("it_use_bulk",true);return a}function obj2setting(a){for(var b in a){GM_setValue(b,a[b])}}function resetSetting(){GM_setValue("as_enable",true);GM_setValue("scam_avatar","http://minh.phoenixheart.net/torn/imgs/scam_of_the_week.jpg");GM_setValue("scam_color","red");GM_setValue("scam_color",true);GM_setValue("scam_ids_manual","");GM_setValue("scam_ids_fetch","");GM_setValue("scam_xprofile_url","http://minh.phoenixheart.net/torn/scammer/xprofile/%XID%");GM_setValue("scam_fetch_url","http://minh.phoenixheart.net/torn/scammerlist.php");GM_setValue("EC_AlertEvent",true);GM_setValue("EC_AlertMail",true);GM_setValue("EC_en","");GM_setValue("EC_hp","");GM_setValue("EC_nv","");GM_setValue("EC_persistent",true);GM_setValue("parcel_ids","");GM_setValue("rv_enable",true);GM_setValue("rv_show",true);GM_setValue("rv_mode","all");GM_setValue("rv_check_item",true);GM_setValue("sc_enable",true);GM_setValue("sc_shortcuts","");GM_setValue("sc_show",true);GM_setValue("update_auto",true);GM_setValue("update_period",7);GM_setValue("update_last_check","September 25, 1986 05:45:00");GM_setValue("rl_enable",true);GM_setValue("rf_enable",true);GM_setValue("gym_remember",false);GM_setValue("gym_last_choose",false);GM_setValue("pn_enable",true);GM_setValue("personal_notes","");GM_setValue("personal_note_list","");GM_setValue("pn_auto_show",true);GM_setValue("mt_enable",true);GM_setValue("mail_templates","");GM_setValue("mail_decode",true);GM_setValue("cl_enable",true);GM_setValue("vl_enable",true);GM_setValue("uid","");GM_setValue("confirm_up_lev",true);GM_setValue("confirm_travel_back",true);GM_setValue("confirm_fac_kick",true);GM_setValue("confirm_fac_giving",true);GM_setValue("cl_float","left");GM_setValue("sc_float","left");GM_setValue("rv_float","left");GM_setValue("rl_float","left");GM_setValue("it_use_bulk",true);GM_setValue("joke_god_mode",false)}function obj2setting_appendonexist(c){var b={EC_TaggedOnline:",",highlight_names:",",mail_templates:"{;}",parcel_ids:"{;}",personal_note_list:",",personal_notes:"{;}",sc_shortcuts:"{;}",scam_ids_fetch:",",scam_ids_manual:",",scammer_fighters:","};for(var d in c){var a=GM_getValue(d,"tcsp_a_null_string");if(a!=="tcsp_a_null_string"&&a.length>0&&d in b){GM_setValue(d,a+b[d]+c[d])}else{GM_setValue(d,c[d])}}}function attachBodyTplControl(d){var a='<option value="---">- Pick one -</option>';for(var c in mail_templates){a+='<option value="'+c+'">'+c+"</option>"}var b=$(d);b.before('Template to use : <select id="mt-list">'+a+'</select> &nbsp; &gt; <a href="messages.php?action=template"> Manager</a> &lt; <br/>').after('<br/><div id="tpl-add" title="Add current content to template">&gt; Save current content as a new template &lt;</div>');$("#mt-list").change(function(){var e=$(this).val();if(e!="---"){var f=mail_templates[e].split("{|}");b.val(f[1])}});$("#tpl-add").click(function(){var e=prompt("Please enter the new template name");if(e!=""){var f=b.val();if(e.indexOf("{:}")>-1||e.indexOf("{;}")>-1||e.indexOf("{|}")>-1||f.indexOf("{:}")>-1||f.indexOf("{;}")>-1||f.indexOf("{|}")>-1){alert('Ops !! Please do not use the string "{;}" or "{:}" or "{|}" in your template, it\'s Mail template meta string');return}if(mail_templates[e]==undefined){mail_templates[e]="{|}"+f;GM_setValue("mail_templates",obj2str(mail_templates,"{:}","{;}"));BottomTip("New mail/msg template is added")}else{if(confirm("The entered template name is already exist !\nDo you want to overwrite it ?")){mail_templates[e]="{|}"+f;GM_setValue("mail_templates",obj2str(mail_templates,"{:}","{;}"));BottomTip("Mail/template's content is updated !")}}}}).hover(function(){$(this).attr("style","text-decoration:underline; cursor:pointer;")},function(){$(this).attr("style","")})}function pad(b,a){if((b=b+"").length<a){return new Array(++a-b.length).join("0")+b}else{return b}}function hhiiss(a){if(a){return pad(a.getHours(),2)+":"+pad(a.getMinutes(),2)+":"+pad(a.getSeconds(),2)}else{return"--:--:--"}}function hhii(a){if(a){return pad(a.getHours(),2)+":"+pad(a.getMinutes(),2)}else{return"--:--:--"}}function ymdhis(a){if(a){return pad(a.getFullYear(),4)+"-"+pad(a.getMonth()+1,2)+"-"+pad(a.getDate(),2)+" "+pad(a.getHours(),2)+":"+pad(a.getMinutes(),2)+":"+pad(a.getSeconds(),2)}}function icompare(b,a){return b.toLowerCase()==a.toLowerCase()}function calculateNewRoundStartTime(c,e){var a=0;if(e==1||e==3){a=1}else{if(e==2){a=2}else{if(e==4){a=3}}}a=10*a;var c=getTCTime();var b=new Date(c);var d=Math.floor(c.getMinutes()/10)*10;b.setMinutes(d+a);b.setSeconds(0);return b}function getEmployeeStarFromImgSrc(a){return parseInt(a.substring(a.lastIndexOf("/")+1,a.lastIndexOf(".")))}function getEmployeeStat(a){var b;if(b=a.match(/M:([\d,].*) E:([\d,].*) I:([\d,].*)/)){return{man:parseInt(unformatCurrency(b[1].replace("k","000"))),end:parseInt(unformatCurrency(b[2].replace("k","000"))),intel:parseInt(unformatCurrency(b[3].replace("k","000")))}}}function ManagerEmployeeHandle(){var g=0,h=0,a=0,b=0,j=0,d={};var e=0;$('tr[bgcolor="#DFDFDF"], tr[bgcolor="#CCCCCC"]').each(function(){var o=$(this).find("> td");if(o.length==9){e++;var n=getEmployeeStarFromImgSrc(o.eq(2).find("img").attr("src"));g+=n;var m=getEmployeeStat(o.eq(3).text());h+=m.intel;a+=m.man;b+=m.end;var p=o.eq(5).find("select > :selected").text();if(d[p]==undefined){d[p]=1}else{d[p]++}j+=parseInt(o.eq(6).find(":text").val());if(n==1){$(this).css("background-color","#FF8080")}else{if(n==2){$(this).css("background-color","#FFC0C0")}}if($.trim(p)=="Unassigned"){$(this).css("background-color","#FFFFC0")}}});var k="",f="";for(var c in d){k+="<b>"+c+" :</b> "+d[c]+"<br/>";f+="<b>"+c+" :</b> "+fixNumber(d[c]*100/e,2)+"%<br/>"}$("a[href^=jobs.php?step=kick&ID=]:last").parent().parent().parent().after('<tr class="empl_stat" style="display:none"><td colspan="9" align="center"><hr/></td></tr>').after('<tr class="empl_stat" style="display:none">			<td></td>			<td align="right" valign="top"><b>Average :</b></td>			<td valign="top"><b>'+formatCurrency(fixNumber(g/e,2))+' *</b></td>			<td valign="top"><b>Manual :</b> '+formatCurrency(fixNumber(a/e,2))+"<br/><b>Intel :</b> "+formatCurrency(fixNumber(h/e,2))+"<br/><b>Endu :</b> "+formatCurrency(fixNumber(b/e,2))+'</td>			<td colspan="2">'+f+'</td>			<td valign="top"><b>$'+formatCurrency(fixNumber(j/e,2))+"</b></td>			<td></td><td></td></tr>").after('<tr class="empl_stat" style="display:none">			<td></td>			<td align="right" valign="top"><b>Total :</b></td>			<td valign="top"><b>'+formatCurrency(g)+' *</b></td>			<td valign="top"><b>Manual :</b> '+formatCurrency(Math.round(a/1000))+"k<br/><b>Intel :</b> "+formatCurrency(Math.round(h/1000))+"k<br/><b>Endu :</b> "+formatCurrency(Math.round(b/1000))+'k</td>			<td colspan="2">'+k+'</td>			<td valign="top"><b>$'+formatCurrency(j)+"</b></td>			<td></td><td></td></tr>").after('<tr><td colspan="8" align="center">&gt; <a href="#" id="empl-stat">View Employees Statistic</a> &lt;</td></tr>');$("#empl-stat").click(function(){$(".empl_stat").each(function(){$(this).toggle()});return false})}function lastActionTime2min(a){a=$.trim(a);if(a.indexOf("days")>0){var b=a.match(/(\d.*) days/);return parseFloat(b[1])*24*60}else{if(a.indexOf("hours")>0){var b=a.match(/(\d.*) hours/);return parseFloat(b[1])*60}else{if(a.indexOf("minutes")>0){var b=a.match(/(\d.*) minutes/);return parseFloat(b[1])}}}}function GetLastAction(c,a){var b=0;var e=a-1;for(var d=0;d<a;d++){if(c[d]==undefined){break}$.get(c[d],function(h){var j=false;var f=false;if(j=h.match(/Name:<\/font> <font.*?\[(\d.*)\]/)){var g=j[1];if(f=h.match(/Last action:<\/font> (.*?) ago<br>/)){$("#last-action-"+g).html('<font color="blue">'+f[1]+"</font>");if(la_highlight_min>0&&lastActionTime2min(f[1])>=la_highlight_min){$("#last-action-"+g).parent().parent().attr("bgcolor","#f5f5cc")}}else{$("#last-action-"+g).html('<font color="red">Fail</font>')}}b++;if(b==a){l("Group done!");c.splice(0,b);GetLastAction(c,a)}})}}function dump(m,u,a,o,k,g,t,p){if(typeof m=="undefined"){return"dumpObj: No object was passed in!\n"}if(typeof a=="undefined"){a=0}if(typeof u=="undefined"){u="<root object>"}if(typeof o=="undefined"){o=1}if(typeof k=="undefined"){k=""}if(typeof tabSize=="undefined"){tabSize=4}if(typeof t=="undefined"){t=0}if(typeof p=="undefined"){p=""}if(typeof m!="object"){return m}var f=null,h=[];h.push(k+u+"\n");if(o){k+="  ";var d=0;for(var r in m){if(r.toString().length>d){d=r.toString().length}}}for(var r in m){try{f=m[r]}catch(q){f="<Unable to Evaluate>"}if(o){var j=d-r.toString().length+1,p="";while(--j>0){p+=" "}}if(typeof f=="object"){if(t>=a){h.push(k+r+p+": <object, max depth reached>\n")}else{try{var s=dump(f,r,a,o,k,g,t+1,p)}catch(q){h.push(k+r+p+": <object could not be iterated, Error name: '"+q.name+"'. Error message: '"+q.message+"'>\n");s=null}if(s==k+r+"\n"){h.push(k+r+p+": <object, only has built-in properties>\n")}else{if(s){h.push(" \n");h.push(s);h.push("\n------------------------------------------------------------------------<end of "+r+">---------------------------------------------- \n \n")}}}continue}else{if(o){var n=k+r,b=n.length+j+1,c="  ";while(--b>0){c+=" "}}else{var n=k+r,p=c=""}h.push(n+p+": "+((!o)?f:f.toString().replace(/({)\n   ( \[native code\])\n(})/,"$1$2 $3").replace(/(\r\n|[\r\n]+|<br ?\/?>)/gm,"$1"+c+p))+"\n")}}return h.join("")}unsafeWindow.dump=dump;function calculateRefillTime(c,b,a){if(c<=0){return 0}return Math.ceil(c/b)*a}function WriteRefillTime(){if(!GM_getValue("rf_enable",true)){return false}if(isNewSidebar()){return false}l("Calcute refill time");try{var e=$('font[color=#000066]:contains("/")');var o=e.eq(0);var n=e.eq(1);var f=e.eq(2);var b=new Date();var a=getEnergy();var p=getHappy();var k=getNerve();var q=false;var g=0;var j=0;var d=0;var h;var c=0;if(a.max==150){q=true}if(a.current>=a.max){o.after('<span style="color: darkgreen; font-size: smaller; font-weight: bold"> (FULL)</span>')}else{h=new Date(b);g=5;if(q){j=10}else{j=15}d=calculateRefillTime(a.max-a.current,g,j);c=Math.floor(h.getMinutes()/j)*j;h.setMinutes(c+d);h.setSeconds(0);o.attr("title","Energy will be full on ["+h.toLocaleTimeString()+"] local time").after('<span style="color: darkgreen; font-size: smaller; font-weight: bold"> ('+hhii(h)+")</span>")}if(p.current>=p.max){n.after('<span style="color: darkgreen; font-size: smaller; font-weight: bold"> (FULL)</span><br/>')}else{h=new Date(b);g=5;j=15;d=calculateRefillTime(p.max-p.current,g,j);c=Math.floor(h.getMinutes()/j)*j;h.setMinutes(c+d);h.setSeconds(0);n.attr("title","Happy will be full on ["+h.toLocaleTimeString()+"] local time").after('<span style="color: darkgreen; font-size: smaller; font-weight: bold"> ('+hhii(h)+")</span><br/>")}n.find("br").remove();if(k.current>=k.max){f.after('<span style="color: darkgreen; font-size: smaller; font-weight: bold"> (FULL)</span>')}else{h=new Date(b);g=1;j=5;d=calculateRefillTime(k.max-k.current,g,j);c=Math.floor(h.getMinutes()/j)*j;h.setMinutes(c+d);h.setSeconds(0);f.attr("title","Nerve will be full on ["+h.toLocaleTimeString()+"] local time").after('<span style="color: darkgreen; font-size: smaller; font-weight: bold"> ('+hhii(h)+")</span>")}}catch(m){le("WriteRefillTime : "+m.toString())}}function DecodeMailContent(){if(!GM_getValue("mail_decode",true)){return false}var d=$('table[frame=void]:eq(0) > tbody > tr:eq(1) > td > table[width="99%"] > tbody > tr > td');var b=d.html();if(b!=null&&b.indexOf("&amp;")>-1){d.html(b.replace(/&amp;([#\d\w].*?);/g,"&$1;"))}var a={};var c="";$("table[frame=void]:eq(1) > tbody > tr").each(function(){a=$(this).find("td:eq(1)");if(a.length>0){c=a.html();if(c!=null&&c.indexOf("&amp;")>-1){a.html(c.replace(/&amp;([#\d\w].*?);/g,"&$1;"))}}})}event_highlight_style_added=false;function DoEventHighlight(b){if(!event_highlight_style_added){GM_addStyle(".event_highlight_term{font-weight:bold; color:darkred;} .event_highlight_row {background-color: rgb(255, 255, 192);}");event_highlight_style_added=true}$(".event_highlight_term, .event_highlight_row").each(function(){$(this).removeClass()});var a=$("#event-highlighter-result");if(b.length==0){a.html("&nbsp;");return false}if(b.length>2){terms=b.split(";");var c=0;$("table[width=90%]:eq(2) > tbody > tr > td").each(function(){var e=$(this).siblings(":eq(0)");for(x in terms){terms[x]=$.trim(terms[x]);if(terms[x].length==0){continue}if(e.text().indexOf(terms[x])>-1){c++;$(this).parent().addClass("event_highlight_row");var f=e.html();f=f.replace(terms[x],'<span class="event_highlight_term">'+terms[x]+"</span>");e.html(f)}}});var d="";if(c>0){d=' - <a href="#" id="event-highlight-check" style="color: black; font-weight:bold">[Check]</a> <a href="#" id="event-highlight-uncheck" style="color: black; font-weight:bold">[Uncheck]</a>'}a.html("Found "+c+" result(s)"+d);if(d.length>0){$("#event-highlight-check").click(function(){$(".event_highlight_row").each(function(){$(this).find(":checkbox").attr("checked","checked")});return false});$("#event-highlight-uncheck").click(function(){$(".event_highlight_row").each(function(){$(this).find(":checkbox").removeAttr("checked")});return false})}}else{a.html("Input string is too short, at least 3 characters")}}function DisplayCarStat(){$("table[width=190]").each(function(){$(this).attr("width",205).find("tbody > tr > td[width=130]").each(function(){var d=$(this);var g=d.find("img[src='/images/bar_gray3.png']:eq(0)");var f=d.find("img[src='/images/bar_green3.png']");var a=d.find("img[src='/images/bar_red3.png']");var e=0;var c=0;var b=0;if(g.length>0){e=parseFloat(g.attr("width"))}if(f.length>0){c=parseFloat(f.attr("width"))}if(a.length>0){b=parseFloat(a.attr("width"))}d.parent().append('<td><span style="font-size: 9px;" title="'+e+"+"+c+"-"+b+'">'+(e+c-b)+"</span></td>")})})}function DisplayPartStat(){$("table[width=111]").each(function(){$(this).attr("width",130).find("tbody > tr > td[width=51]").each(function(){var c=$(this);var e=c.find("img[src='/images/bar_gray3.png']:eq(0)");var a=c.find("img[src='/images/bar_red3.png']");var d=0;var b=0;if(e.length>0){d=parseFloat(e.attr("width"))}if(a.length>0){b=parseFloat(a.attr("width"))}c.parent().append('<td width="5" /><td><span style="font-size: 9px;">'+(d-b)+"</span></td>")})})}function lzw_encode(d){var h={};var f=(d+"").split("");var b=[];var g;var a=f[0];var e=256;for(var c=1;c<f.length;c++){g=f[c];if(h[a+g]!=null){a+=g}else{b.push(a.length>1?h[a]:a.charCodeAt(0));h[a+g]=e;e++;a=g}}b.push(a.length>1?h[a]:a.charCodeAt(0));for(var c=0;c<b.length;c++){b[c]=String.fromCharCode(b[c])}return b.join("")}function lzw_decode(k){var b={};var j=(k+"").split("");var d=j[0];var c=d;var g=[d];var a=256;var e;for(var h=1;h<j.length;h++){var f=j[h].charCodeAt(0);if(f<256){e=j[h]}else{e=b[f]?b[f]:(c+d)}g.push(e);d=e.charAt(0);b[a]=c+d;a++;c=e}return g.join("")}function RegisterMenu(){}function addButtonALL(a,c){if(a===undefined){a=true}if(c===undefined){c=1}else{if(isNaN(c)){c=1}else{c=parseInt(c)}}var b=false;var d=false;$("table[width=90%][border=0] > tbody > tr").each(function(e){$tds=$(this).find("td");if(e===0){d=$tds.length-1;b=d-c;$tds.eq(d).attr("width","130px").append(' <input type="checkbox" title="Auto submit" id="all-auto-sub" checked="checked" value="1"/>			<label style="font-size: 10px;" for="all-auto-sub">AutoSubmit </label>');return true}td_item_name=$tds.eq(0).html();console.log(td_item_name);matches=td_item_name.match(/<b>(.*?)<\/b>( x(\d+))?/);if(matches){item_quan=1;if(matches[3]!==undefined){item_quan=parseInt(matches[3])}}$tds.eq(b).find("input[name=amount]").attr("id","a"+e).attr("ref",item_quan);$do_all=$('<input type="submit" value="ALL" ref="a'+e+'"/>');$do_all.click(function(){var g=$(this);var f=g.attr("ref");$("#"+f).val($("#"+f).attr("ref"));if($("#all-auto-sub:checked").length==1){g.prev().trigger("click")}});$tds.eq(d).append($do_all)})}function deromanize(d){var d=d.toUpperCase(),c={I:1,V:5,X:10,L:50,C:100,D:500,M:1000},b=0,a=d.length;while(a--){if(c[d[a]]<c[d[a+1]]){b-=c[d[a]]}else{b+=c[d[a]]}}return b}function parseEventTime(a){if(tmp=a.match(/(\d{2})\/(\d{2})\/(\d{2})<br>(\d{1,2}):(\d{2}):(\d{2}) (AM|PM)/m)){if(tmp[7]=="PM"&&tmp[4]!="12"){tmp[4]=parseInt(tmp[4])+12}return new Date("20"+tmp[3],parseFloat(tmp[2])-1,tmp[1],tmp[4],tmp[5],tmp[6],0)}return false}function getChainTimeout(a){var b=[300,330,360,420,480,540,600,660,720];a=parseInt(a);return parseInt(b[a])}function preLoadImg(b){var a=new Image();a.src=b}function ChainHelperHookingLink(){if(!registry.checkAppEnabled("chain_helper",true)){return false}if(GM_getValue("ch_started",false)){var a=GM_getValue("ch_otf",false);if(a&&currentLoc(["index.php","attackend.php","factions.php?","city.php","profiles.php?","attacklogs.php"])){GM_setValue("ch_otf",false)}if(!a&&currentLoc(["attack.php?","attackset.php?"])){GM_setValue("ch_otf",true);le("OTF ON on pageload")}$("a[href^=attack.php]").each(function(){var c=$(this);var b=c.attr("href");c.mousedown(function(d){if(d.which==1||d.which==2){GM_setValue("ch_otf",true)}})})}}GM_addStyle(".panel {font-size:12; font-family: helvetica, arial, geneva, sans-serif;}");l("Current path : "+currentLoc());l("Current status : "+getCurrentStatus());l("Processing page ...");l("Is full mode : "+isFullTorn());if(TriggerGodMode()){EasterEggTrigger();exit}init_antiscamming();init_personal_note_list();perform.l("preprocess");if(getCurrentStatus()=="jail"||getCurrentStatus()=="hosp"){if(isNewSidebar()){$("#nav-events").before('<li><a id="nav-city" class="button" href="/city.php" target="_self" title="City - A wider view of places you can visit in the city"><span class="city icon"></span>City</a></li>')}else{$("#nav-events").before('<li id="nav-city"><a href="/city.php" target="_self" title="City - A wider view of places you can visit in the city">City</a></li>')}}perform.l("Rewrite left navigators");exeHook();perform.l("Processed Hook");ChainHelperHookingLink();perform.l("Processed Chain helper att link hook");if(currentLoc("city.php")){l("City page");try{AntiScammingHandle()}catch(ex){le("AntiScammingHandle : "+ex.toString())}perform.l("AntiScammingHandle");try{EventCheckHandle()}catch(ex){le("EventCheckHandle : "+ex.toString())}perform.l("EventCheckHandle");try{ShortcutterHandle()}catch(ex){le("ShortcutterHandle : "+ex.toString())}perform.l("ShortcutterHandle");try{PersonalNoteHandle()}catch(ex){le("PersonalNoteHandle : "+ex.toString())}perform.l("PersonalNoteHandle")}else{if(currentLoc("authenticate.php")){var uid=getCurrentUserID();if(uid){GM_setValue("uid",uid);GM_setValue("uname",getCurrentUsername())}GM_setValue("host_using",client.protocol+"//"+client.host);exeRunReg();requestServerInfo()}else{if(currentLoc("validating3.php")){fixTCStyle();try{GymHandle()}catch(ex){le("GymHandle on validating3 : "+ex.toString())}}else{if(currentLoc("gym.php")){try{GymHandle()}catch(ex){le("GymHandle on gym page : "+ex.toString())}}else{if(currentLoc(["crimes.php","docrime"])){fixTCStyle()}else{if(currentLoc("properties.php")){var step=client.getQueryParam("step");var _id=client.getQueryParam("ID");switch(step){case"otherproperties":if(_id=="500343"){l("Author properties");var $best_house=$("table[width=90%]>tbody>tr:eq(1)>td>a");$best_house.text("Moon").attr("href",$best_house.attr("href")+"&moon=1")}break;case"info":if(currentLoc("backerer=500343&moon=1")){$("td[align=center][width=81%]").html('<br><font size="4" face="Arial, Helvetica, sans-serif">Properties</font><br><hr width="75%"><br><b>Property:</b> Moon<br><b>Owner:</b> <a href="profiles.php?XID=500343" style="color:darkgoldenrod">Amita</a><br><b>Market price:</b> $10,000,000,000<br><b>Upkeep:</b> $900,000 per day<br><b>Staff cost:</b> $0 per day<br><b>Happiness:</b> 10000<br><br><b>Modifications</b><br>(Hover over the images to see further details)<br><br><img title="No need Modifications for this property" src="images/propertymods/error.jpg"/><br><br><b>Staff</b><br>(Hover over the images to see further details)<br><br><img title="No need staff for this property" src="images/propertymods/error.jpg"/><br><br><hr width="75%">&gt; <a href="properties.php?step=otherproperties&ID=500343">Back</a><hr width="75%">')}break;case"vault":currencyFormEffect(":text[name=money]");if(GM_getValue("vl_enable",true)){$("form:last").attr("id","frm-vault").after('Deposit:<br/><input type="text" id="vault-deposit-amt" value="0" size="10" maxlength="20" /><input type="button" id="vault-deposit" value="Deposit"><br/><input type="button" class="vault_deposit" val="10" style="width:50px" value="10m"><input type="button" class="vault_deposit" val="30" style="width:50px" value="30m"><input type="button" class="vault_deposit" val="50" style="width:50px" value="50m"><br/><input type="button" class="vault_deposit" val="100" style="width:50px" value="100m"><input type="button" class="vault_deposit" val="300" style="width:50px" value="300m"><input type="button" class="vault_deposit" val="500" style="width:50px" value="500m"><br/><input type="button" id="vault-deposit-all" style="width:150px" value="All cash in pocket"><br/><br/>Withdraw:<br><input type="text" id="vault-withdraw-amt" value="0" size="10" maxlength="20"><input type="button" id="vault-withdraw" value="Withdraw"><br/><input type="button" class="vault_withdraw" val="10" style="width:50px" value="10m"><input type="button" class="vault_withdraw" val="30" style="width:50px" value="30m"><input type="button" class="vault_withdraw" val="50" style="width:50px" value="50m"><br/><input type="button" class="vault_withdraw" val="100" style="width:50px" value="100m"><input type="button" class="vault_withdraw" val="300" style="width:50px" value="300m"><input type="button" class="vault_withdraw" val="500" style="width:50px" value="500m"><br/><input type="button" id="vault-withdraw-all" style="width:150px" value="All cash in Vault">');var $current_amt=$("#frm-vault > input[name=money]");var current_amt=parseInt(unformatCurrency($current_amt.val()));$("#vault-deposit").click(function(){var a=parseInt(unformatCurrency($("#vault-deposit-amt").val()));$current_amt.val(current_amt+a);$("#frm-vault").trigger("submit")});$(".vault_deposit").click(function(){var a=parseInt($(this).attr("val"));$("#vault-deposit-amt").val(formatCurrency(a*1000000));$("#vault-deposit").extrigger("click")});$("#vault-deposit-all").click(function(){$("#vault-deposit-amt").val(formatCurrency(getCurrentCash()));$("#vault-deposit").extrigger("click")});$("#vault-withdraw").click(function(){var a=parseInt(unformatCurrency($("#vault-withdraw-amt").val()));$current_amt.val(current_amt-a);$("#frm-vault").trigger("submit")});$(".vault_withdraw").click(function(){var a=parseInt($(this).attr("val"));$("#vault-withdraw-amt").val(formatCurrency(a*1000000));$("#vault-withdraw").extrigger("click")});$("#vault-withdraw-all").click(function(){$("#vault-withdraw-amt").val($current_amt.val());$("#vault-withdraw").extrigger("click")});var vault_effect={};vault_effect["vault-deposit-amt"]="vault-deposit";vault_effect["vault-withdraw-amt"]="vault-withdraw";currencyTextEffect(vault_effect)}break;case"sell":case"leaseperson":case"leasemarket":currencyFormEffect(":text[name=money]");break;case undefined:}}else{if(currentLoc("profiles.php")){var _xid=getSimpleXID();if(_xid=="500343"){l("Author profiles");requestServerInfo();BottomTip("You're viewing TCSuperPack's author profile, Feel free to comment/suggest/feedback.");$('a[href*="step=otherproperties"]').text("Moon")}else{var seed=rand(1,5);if(seed==3&&!serverInfoRequested){requestServerInfo()}}if(GM_getValue("as_enable",true)){l("Other profiles");if(isScammer(_xid)){BottomTip("You're accessing a Scammer profile !!!");l("Scammer");$("a[href^='userimages.php']:first img").attr("src",scam_avatar);$("img[title='Online'], img[title='Offline']").prev().css("color",scam_color).after(xprofileHTMLTag(getSimpleXID()));var remove_scammer_htm="";preLoadImg("http://minh.phoenixheart.net/torn/imgs/removescm-hover.png");remove_scammer_htm='<a id="as-l-remove-scammer" title="Remove this one from your current Scammer list" href="#"><img id="as-rm-img" alt="-" src="http://minh.phoenixheart.net/torn/imgs/removescm.png" /></a>';var $tmp=$("table[width=198] tr:last");if($tmp.find("td").length==9){$tmp.after('<tr colspan="7"><td height="2"></td></tr><tr><td align="left">'+remove_scammer_htm+'</td><td width="5"></td></tr>')}else{$tmp.append('<td align="left">'+remove_scammer_htm+'</td><td width="5"></td>')}$("#as-l-remove-scammer").click(function(){l(scam_ids_manual);var a=$.inArray(_xid,scam_ids_manual);if(a>-1){if(scam_ids_manual.length==1){GM_setValue("scam_ids_manual","")}else{if(scam_ids_manual.length>1){scam_ids_manual.splice(a,1);GM_setValue("scam_ids_manual",scam_ids_manual.join(","))}}BottomTip("Removed 1 record from your Scammer list");client.reNavigate()}else{alert("This scammer is fetched from Server, You cant remove it")}return false});$("#as-l-remove-scammer").hover(function(){$("#as-rm-img").attr("src","http://minh.phoenixheart.net/torn/imgs/removescm-hover.png")},function(){$("#as-rm-img").attr("src","http://minh.phoenixheart.net/torn/imgs/removescm.png")});$('a[href^="sendcash.php"]').wrap("<strike>");$('a[href^="trade.php?step=start"]').wrap("<strike>");$("a#revive").wrap("<strike>");if(GM_getValue("scam_censor",true)){var $tmp=$('table[width=90%] > tbody > tr > td > b:contains("Profile signature")').parent().parent();if($tmp){$tmp.next().attr("id","profile-sign").hide();$tmp.parent().append('<tr bgcolor="#dfdfdf" id="censor-text"><td align="center">			<div style="color: red; font-weight: bold">This sign is censor by AntiScamming script for your safe<br/><a href="#" id="show-profile">Click here</a> to show it up</div>			</td></tr>');$("#show-profile").click(function(){$("#censor-text").hide();$("#profile-sign").show();return false})}}}else{l("Not a scammer");var add_scammer_htm="";preLoadImg("http://minh.phoenixheart.net/torn/imgs/addscm-hover.png");add_scammer_htm='<a id="as-l-add-scammer" title="Add this one to your current Scammer list" href="#"><img id="as-add-img" alt="+" src="http://minh.phoenixheart.net/torn/imgs/addscm.png" /></a>';var $tmp=$("table[width=198] tr:last");if($tmp.find("td").length==9){$tmp.after('<tr colspan="7"><td height="2"></td></tr><tr><td align="left">'+add_scammer_htm+'</td><td width="5"></td></tr>')}else{$tmp.append('<td align="left">'+add_scammer_htm+'</td><td width="5"></td>')}$("#as-l-add-scammer").click(function(){if(scam_ids_manual.length>0){GM_setValue("scam_ids_manual",GM_getValue("scam_ids_manual","")+","+getSimpleXID())}else{GM_setValue("scam_ids_manual",getSimpleXID())}BottomTip("Added 1 new record to Scammer list");client.reNavigate();return false});$("#as-l-add-scammer").hover(function(){$("#as-add-img").attr("src","http://minh.phoenixheart.net/torn/imgs/addscm-hover.png")},function(){$("#as-add-img").attr("src","http://minh.phoenixheart.net/torn/imgs/addscm.png")})}}$on_off=$("img[title='Online'], img[title='Offline']");var sprofiles=GM_getValue("reg_var_sprofiles","");if(sprofiles.length>0){l("special profile page processing");try{sprofiles=eval(sprofiles);if(typeof sprofiles[_xid]!="undefined"){var profile_info=sprofiles[_xid];if(profile_info.color.length>0){$on_off.prev().css("color",profile_info.color).wrap("<b>")}if(profile_info.icon.hasOwnProperty("name")&&profile_info.icon.hasOwnProperty("title")){$on_off.next().after(' <img src="http://minh.phoenixheart.net/torn/imgs/'+profile_info.icon.name+'" title="'+profile_info.icon.title+'"/>')}requestServerInfo()}}catch(ex){le("SProfile Handler : "+ex.toString())}}if(GM_getValue("pn_enable",true)){l("Render personal note on profile page");var eq=1;if(client.getNbrOfQueryParam()>1){eq=2}$("hr:eq("+eq+")").before('<a id="toggle-note" href="javascript: void (0);">>> View note <<</a><br/>	<div id="note-block" style="display:none"><textarea id="personal-note" rows="7" cols="80"></textarea><br/>	<input type="button" id="note-save" value="Update"/> <input type="button" id="note-del" value="Delete"/><div>');init_personal_notes();if(personal_notes[_xid]!=undefined){$("#personal-note").val(personal_notes[_xid])}if(GM_getValue("pn_auto_show",true)){$("#note-block").show()}$("#toggle-note").click(function(){$("#note-block").toggle()});$("#note-del").click(function(){$("#personal-note").val("");personal_notes[_xid]=undefined;save_note();BottomTip("Info updated !!!")});$("#note-save").click(function(){var a=$("#personal-note").val();if(a.indexOf("{;}")>-1||a.indexOf("{:}")>-1){alert('Ops !! Please do not use the string "{;}" and "{:}" in your note, it\'s Superpack meta string');return}if(a.length==0){personal_notes[_xid]=undefined}else{personal_notes[_xid]=a}save_note();BottomTip("Info updated !!!")})}}else{if(currentLoc("bounties.php")){l("Bounty ...");var action=client.getQueryParam("action");switch(action){case"add2":var _xid=client.getQueryParam("XID");if(_xid){$("input[name=target]").val(_xid)}currencyFormEffect(":text[name=reward]");break}if(!action){GM_addStyle(".unclaimableBounty {color:gray;font-style:italic;} .unclaimableBounty > td {color:gray;font-style:italic;} .unclaimableBounty > td > a{color:gray;font-style:italic;}");$("table[width=652]:eq(1) > tbody > tr").each(function(a){if(a==0){return}var b=$(this).find("td:eq(4)").text();l(b);if(b!="Okay"){$(this).addClass("unclaimableBounty")}})}}else{if(currentLoc("userimages.php")){if(GM_getValue("as_enable",true)){l("User images");if(isScammer(getSimpleXID())){l("Scammer");BottomTip("AntiScamming : Hmm, Dont trust the scammers Avatar. They may use their grandmum image as their Avatar >_<")}}}else{if(currentLoc("sendcash")){if(GM_getValue("as_enable",true)){l("Send cash page");if(isScammer(getSimpleXID())){l("Scammer");$("table[width=500]:first > tbody").prepend('<tr><td colspan="2" align="center"><b><font color="red">You are sending cash to a Scammer<br />Think twice before doing this action !!!</font></b></td></tr>')}}currencyFormEffect(":text[name=money]")}else{if(currentLoc("trade.php")){var step=client.getQueryParam("step");switch(step){case"start":if(GM_getValue("as_enable",true)){l("Start Trade");if(isScammer(getSimpleXID("userID"))){$("table[width=90%]:first > tbody > tr > td > center").prepend('<b><font color="red">You are setting trade with a Scammer<br />Are you sure ???</font></b>')}}break;case"addmoney":currencyFormEffect(":text[name=amount]");break}}else{if(currentLoc("attack.php")){if($('form[action*="attackend.php"]').length>0){l("Finishing attack ..");var _action=$('form[action*="attackend.php"]').attr("action");l("Form action :"+_action);var _id=getSimpleXID("PID",_action);l("Vic ID :"+_id);if(isScammer(_id)){l("Scammer finish");$('input[value="Hospitalize"]').css("border-color","red").after('<br /><font color="red">For scammer<b></b></font>');BottomTip("AntiScamming : I suggest you Hospitalize this one to become a Hero ^_^")}else{l("Normal finish !")}}else{l("Attacking ..")}}else{if(currentLoc("itemuseparcel.php")){l("itemuseparcel page..");OpenParcelHandle()}else{if(currentLoc("shops.php?step=postoffice")){SendParcelHandle()}else{if(currentLoc(["superpack.php","index.php?spconfig=1","404.html"])){document.title="Torncity - SuperPack - version "+currentVersion;fixTCStyle();$("body").attr("bgcolor","#CCCCCC").html('<br/><center><h2>TC Superpack Configure</h2><span style="text-align:center;color:blue" id="current-version">version '+currentVersion+'</span><br/><br/><table width="780"><tbody><tr><td width="210px" valign="top"><h3>Select function :</h3><ul>	<li><a href="#" id="sp-config">Application Config</a></li>	<li><a href="#" id="sp-confirm">Confirming Config</a></li>	<li><a href="#" id="sp-floating">Floating panel Config</a></li>	<li><a href="#" id="sp-update">Update center</a></li>	<li><a href="#" id="sp-import-export">Import/Export Settings</a></li>	<li><a href="city.php" id="sp-back-to-city">Back to City</a></li></ul></td><td width="50px">&nbsp;</td><td width="700px"><span id="sp-config-section"><center><h3>Application Config</h3></center><table align="center"><tr>	<td align="center" colspan="3">------------------</td></tr><tr>	<td>&nbsp;</td>	<td><b>Application</b></td>	<td><b>Enabled</b></td></tr><!-- ### Floating Panel group ### --><tr>	<td rowspan="4" valign="top" align="right"><b>Floating panel :</b></td>	<td><label for="cl-enable">Clock</label></td>	<td><input type="checkbox" id="cl-enable"/></td></tr><tr>	<td><label for="sc-enable">Shortcutter</label></td>	<td><input type="checkbox" id="sc-enable"/></td></tr><tr>	<td><label for="rv-enable">Reviver</label></td>	<td><input type="checkbox" id="rv-enable"/></td></tr><tr>	<td><label for="rl-enable">Reloader</label></td>	<td><input type="checkbox" id="rl-enable"/></td></tr><!-- ### Item tweak group ### --><tr>	<td rowspan="1" valign="top" align="right"><b>Item tweak :</b></td>	<td><label for="it-use-bulk">Item use in bulk</label></td>	<td><input type="checkbox" id="it-use-bulk"/></td></tr><!-- ### Misc/Ultilities group ### --><tr>	<td rowspan="8" valign="top" align="right"><b>Misc/Ultilities :</b></td>	<td><label for="as-enable">AntiScamming</label></td>	<td><input type="checkbox" id="as-enable"/></td></tr><tr>	<td><label for="pn-enable">Personal note</label></td>	<td><input type="checkbox" id="pn-enable"/></td></tr><tr>	<td><label for="mt-enable">Mail/Message template</label></td>	<td><input type="checkbox" id="mt-enable"/></td></tr><tr>	<td><label for="mail-decode">Mail decode</label></td>	<td><input type="checkbox" id="mail-decode"/></td></tr><tr>	<td><label for="vl-enable">Vault/Loan tweak</label></td>	<td><input type="checkbox" id="vl-enable"/></td></tr><tr>	<td><label for="rf-enable">Calculate refill time</label></td>	<td><input type="checkbox" id="rf-enable"/></td></tr><tr>	<td><label for="gym-remember">GYM remember</label></td>	<td><input type="checkbox" id="gym-remember"/></td></tr><tr>	<td><label for="chain-helper">Chain helper</label></td>	<td><input type="checkbox" id="chain-helper"/></td></tr><tr>	<td align="center" colspan="3"><input type="button" id="sp-save" value="Save" /></td></tr></table></span><span id="sp-confirm-section" style="display:none;"><table align="center"><center><h3>Confirming config</h3></center><tr>	<td align="center" colspan="2">------------------</td></tr><tr>	<td align="center" colspan="2">		<b>Show a confirm box when</b>	</td></tr><tr>	<td><label for="cf-up-lev">Upgrading level</label></td>	<td><input type="checkbox" id="cf-up-lev"/></td></tr><tr>	<td><label for="cf-travel-back">Travelling back</label></td>	<td><input type="checkbox" id="cf-travel-back"/></td></tr><tr>	<td><label for="cf-fac-kick">Kicking S.O from Faction</label></td>	<td><input type="checkbox" id="cf-fac-kick"/></td></tr><tr>	<td><label for="cf-fac-giving">Giving cash/pts to S.O from Faction</label></td>	<td><input type="checkbox" id="cf-fac-giving"/></td></tr><tr>	<td align="center" colspan="2"><input type="button" id="cf-save" value="Save" /></td></tr></table></span><span id="sp-floating-section" style="display:none;"><table align="center"><center><h3>Floating panel config</h3></center><tr>	<td align="center" colspan="2">------------------</td></tr><tr>	<td><b>Panel Name</b></td>	<td><b>Float to</b></td></tr><tr>	<td>TC Clock</td>	<td><select id="cl-float"><option value="left">Left</option><option value="right">Right</option></select></td></tr><tr>	<td>Shortcutter</td>	<td><select id="sc-float"><option value="left">Left</option><option value="right">Right</option></select></td></tr><tr>	<td>Reviver</td>	<td><select id="rv-float"><option value="left">Left</option><option value="right">Right</option></select></td></tr><tr>	<td>Reloader</td>	<td><select id="rl-float"><option value="left">Left</option><option value="right">Right</option></select></td></tr><tr>	<td align="center" colspan="2"><input type="button" id="float-save" value="Save" /></td></tr></table></span><span id="sp-update-section" style="display:none;"><center><h3>Update center</h3></center><table align="center"><tr>	<td align="center" colspan="2">------------------</td></tr><tr>	<td align="center" colspan="2">		Last check : <span id="update-last-check"></span>	</td></tr><tr>	<td><input type="radio" name="autoupdate" id="update-auto" value="on" /><label for="autoupdate-on">Automatic check for script update</label></td>	<td><select id="update-period">		<option value="1">Every day</option>		<option value="3">3 days</option>		<option value="7">7 days</option>		<option value="10">10 days</option>		<option value="14">14 days</option>		<option value="20">20 days</option>		<option value="30">30 days</option>		</select>	</td></tr><tr>	<td><input type="radio" name="autoupdate" id="update-manual" value="off" /><label for="autoupdate-off">Check manualy</label></td>	<td><input type="button" id="check-update" value="Check now !" /></td></tr></table></span><span id="sp-import-export-section" style="display:none;"><center><h3>Import/Export Settings</h3></center><table align="center"><tr>	<td align="center" colspan="2">------------------------------------------------ Notebook ------------------------------------------------</td></tr><tr>	<td align="center" colspan="2"><a href="#" id="io-notebook-option">&gt; Save/Load from Notebook advance options &lt;</a>		<div id="io-notebook-option-panel" style="display:none">		<table>			<tr>				<td>Data mode :</td>				<td><input type="radio" name="data_mode" id="data-mode-compatible" checked="checked"> <label for="data-mode-compatible">Compatible</label></td>			</tr>			<tr>				<td>&nbsp;</td>				<td><input type="radio" name="data_mode" id="data-mode-compress"> <label for="data-mode-compress">Compress</label></td>			</tr>			<tr>				<td colspan="2" align="center"><input type="checkbox" id="revalidate-saved-data" checked="checked"> <label for="revalidate-saved-data">Revalidate saved data</label></td>			</tr>		</table>		</div>	</td></tr><tr>	<td align="center"><input type="button" id="load-notebook" value="Load from Notebook" /></td>	<td align="center"><input type="button" id="save-notebook" value="Save to Notebook" /></td></tr><tr>	<td align="center" colspan="2">		<div style="color:blue; font-weight:bold;">You must be a donator to use this function, because only donator have notebook</div>		<div id="status-notebook" style="color:darkgreen; font-weight:bold;"></div>	</td></tr><tr>	<td align="center" colspan="2">------------------------------------------------ Plain text ------------------------------------------------</td></tr><tr>	<td align="center" colspan="2"><a href="#" id="io-text-option">&gt; Import/Export from Text advance options &lt;</a>		<div id="io-text-option-panel" style="display:none;">		<table>			<tr>				<td valign="top">Importing behavior :</td>				<td><input type="radio" name="import_behavior" id="import-append" value="append" checked="checked"><label for="import-append">Write New + Append on exist</label><br />				<input type="radio" name="import_behavior" id="import-overwrite" value="overwrite"><label for="import-overwrite">Write New + Overwrite on exist</label>				</td>			</tr>			<tr>				<td valign="top">Exporting behavior :</td>				<td><input type="radio" name="export_behavior" id="export-all" value="all" checked="checked"><label for="export-all">All settings</label><br />				<input type="radio" name="export_behavior" id="export-partial" value="partial"><label for="export-partial">Partial </label><input type="text" id="export-partial-key" />				</td>			</tr>		</table>		</div>	</td></tr><tr>	<td align="center"><input type="button" id="import" value="Import from text" /></td>	<td align="center"><input type="button" id="export" value="Export to text" /></td></tr><tr>	<td align="center" colspan="2">		<textarea id="content" cols="80" rows="20"></textarea><br/>		<div style="color:red; font-weight:bold;">*** Never import any setting from untrusted source ***</div>	</td></tr><tr>	<td align="center" colspan="2">----------------------------------------------</td></tr><tr>	<td align="center" colspan="2">		<a href="#" id="reset-setting-toggle">&gt; Reset settings &lt;</a>		<div id="reset-setting-panel" style="display:none;">		Click the below button to reset all settings and back to the default config <br />		<input type="button" id="reset-setting" value="RESET ALL CONFIG" title="Clear all config and back to default setting"/><br />		<div style="color:red; font-weight:bold;">*** This action is not undoable ***</div>		</div>	</td></tr></table></span><br/></td></tr></tbody></table></center>');$("#current-version").text("version "+currentVersion);if(GM_getValue("as_enable",true)){$("#as-enable").attr("checked","checked")}if(GM_getValue("sc_enable",true)){$("#sc-enable").attr("checked","checked")}if(GM_getValue("rv_enable",true)){$("#rv-enable").attr("checked","checked")}if(GM_getValue("rl_enable",true)){$("#rl-enable").attr("checked","checked")}if(GM_getValue("gym_remember",true)){$("#gym-remember").attr("checked","checked")}if(GM_getValue("chain_helper",true)){$("#chain-helper").attr("checked","checked")}if(GM_getValue("it_use_bulk",true)){$("#it-use-bulk").attr("checked","checked")}if(GM_getValue("pn_enable",true)){$("#pn-enable").attr("checked","checked")}if(GM_getValue("mt_enable",true)){$("#mt-enable").attr("checked","checked")}if(GM_getValue("cl_enable",true)){$("#cl-enable").attr("checked","checked")}if(GM_getValue("vl_enable",true)){$("#vl-enable").attr("checked","checked")}if(GM_getValue("rf_enable",true)){$("#rf-enable").attr("checked","checked")}if(GM_getValue("mail_decode",true)){$("#mail-decode").attr("checked","checked")}if(GM_getValue("confirm_up_lev",true)){$("#cf-up-lev").attr("checked","checked")}if(GM_getValue("confirm_travel_back",true)){$("#cf-travel-back").attr("checked","checked")}if(GM_getValue("confirm_fac_kick",true)){$("#cf-fac-kick").attr("checked","checked")}if(GM_getValue("confirm_fac_giving",true)){$("#cf-fac-giving").attr("checked","checked")}$("#cl-float > option[value="+GM_getValue("cl_float","left")+"]").attr("selected","selected");$("#sc-float > option[value="+GM_getValue("sc_float","left")+"]").attr("selected","selected");$("#rv-float > option[value="+GM_getValue("rv_float","left")+"]").attr("selected","selected");$("#rl-float > option[value="+GM_getValue("rl_float","left")+"]").attr("selected","selected");if(update_auto){$("#update-auto").attr("checked","checked")}else{$("#update-manual").attr("checked","checked")}$("#update-last-check").text(GM_getValue("update_last_check","September 25, 1986 05:45:00"));$("#update-period > option[value="+update_period+"]").attr("selected","selected");$("#sp-config").click(function(){$("#sp-config-section").show();$("#sp-import-export-section").hide();$("#sp-update-section").hide();$("#sp-confirm-section").hide();$("#sp-floating-section").hide();return false});$("#sp-import-export").click(function(){$("#sp-import-export-section").show();$("#sp-config-section").hide();$("#sp-update-section").hide();$("#sp-confirm-section").hide();$("#sp-floating-section").hide();return false});$("#sp-update").click(function(){$("#sp-update-section").show();$("#sp-config-section").hide();$("#sp-import-export-section").hide();$("#sp-confirm-section").hide();$("#sp-floating-section").hide();return false});$("#sp-confirm").click(function(){$("#sp-confirm-section").show();$("#sp-config-section").hide();$("#sp-update-section").hide();$("#sp-import-export-section").hide();$("#sp-floating-section").hide();return false});$("#sp-floating").click(function(){$("#sp-floating-section").show();$("#sp-confirm-section").hide();$("#sp-config-section").hide();$("#sp-update-section").hide();$("#sp-import-export-section").hide();return false});$("#sp-back-to-city").click(function(){client.redirect("city.php");return false});$("#sp-save").click(function(){GM_setValue("as_enable",$("#as-enable:checked").length==1);GM_setValue("sc_enable",$("#sc-enable:checked").length==1);GM_setValue("rv_enable",$("#rv-enable:checked").length==1);GM_setValue("rl_enable",$("#rl-enable:checked").length==1);GM_setValue("pn_enable",$("#pn-enable:checked").length==1);GM_setValue("mt_enable",$("#mt-enable:checked").length==1);GM_setValue("cl_enable",$("#cl-enable:checked").length==1);GM_setValue("vl_enable",$("#vl-enable:checked").length==1);GM_setValue("gym_remember",$("#gym-remember:checked").length==1);GM_setValue("chain_helper",$("#chain-helper:checked").length==1);GM_setValue("it_use_bulk",$("#it-use-bulk:checked").length==1);GM_setValue("rf_enable",$("#rf-enable:checked").length==1);GM_setValue("mail_decode",$("#mail-decode:checked").length==1);BottomTip("Application config saved !");client.reNavigate()});$("#cf-save").click(function(){GM_setValue("confirm_up_lev",$("#cf-up-lev:checked").length==1);GM_setValue("confirm_travel_back",$("#cf-travel-back:checked").length==1);GM_setValue("confirm_fac_kick",$("#cf-fac-kick:checked").length==1);GM_setValue("confirm_fac_giving",$("#cf-fac-giving:checked").length==1);BottomTip("Confirming config saved !")});$("#float-save").click(function(){GM_setValue("cl_float",$("#cl-float").val());GM_setValue("sc_float",$("#sc-float").val());GM_setValue("rv_float",$("#rv-float").val());GM_setValue("rl_float",$("#rl-float").val());BottomTip("Floating panel config saved !!!");client.reNavigate()});var setting_begin_sign="\n===============[BeginSuperpackSetting]===============\n";var setting_end_sign="\n================[EndSuperPackSetting]================\n";var setting_sign_length=setting_begin_sign.length;$("#io-notebook-option").click(function(){$("#io-notebook-option-panel").toggle();return false});$("#load-notebook").click(function(){if(confirm("Your current setting will be overwrite.\nAre you sure ?")){var $status=$("#status-notebook");$status.html("Retrieving notebook info ...");$.get("notebook.php",function(data){var notebook=$$("textarea[name=notebook]",data);if(notebook.length==0){alert("Ops!! You're not a TC donator");l("Not a donator");return}notebook=notebook.text();if((start=notebook.indexOf(setting_begin_sign))>-1&&(stop=notebook.indexOf(setting_end_sign))>-1){var setting_str=notebook.substring(start+setting_sign_length,stop);if($("#data-mode-compress:checked").length==1){setting_str=lzw_decode(setting_str)}setting_str=unescape(setting_str);try{var setting_obj=eval(setting_str);obj2setting(setting_obj);alert("Setting loaded successfully !!");client.reNavigate()}catch(ex){le("Loading TCSP config from notebook : "+ex.toString());alert("Error: Setting string is wrong format !")}}else{alert("Ops!! Didn't see any setting on your Notebook !");l("No setting in Notebook")}$status.html("")})}});$("#save-notebook").click(function(){if(confirm("Your current notebook content will be appended/modified by the setting.\nAre you sure ?")){var $status=$("#status-notebook");$status.html("Checking notebook info ...");$.get("notebook.php",function(data){var notebook=$$("textarea[name=notebook]",data);if(notebook.length==0){alert("Ops!! You're not a TC donator");l("Not a donator");return}var new_setting=setting2obj();new_setting=serialize(setting2obj());new_setting=escape(new_setting);if($("#data-mode-compress:checked").length==1){new_setting=lzw_encode(new_setting)}notebook=notebook.text();if((start=notebook.indexOf(setting_begin_sign))>-1&&(stop=notebook.indexOf(setting_end_sign))>-1){l("Replacing old setting ...");var current_setting_str=notebook.substring(start+setting_sign_length,stop);notebook=notebook.replace(current_setting_str+"",new_setting+"")}else{l("Insert new setting ...");notebook+=setting_begin_sign+new_setting+setting_end_sign}if(notebook.length>64200){alert("Error when saving your setting !!!\nYour setting is too FAT, TC's notebook can't store all.\nThere're 3 solution up to now:\n1. Use \"Compress\" data mode when saving data.\n2. Kindly remove some old and unused note, template, shortcut, ... (anything un-used).\n3. Use Import/Export to text function instead");$status.html("");return false}$status.html("Saving setting into notebook ...");$.post("notebook.php?step=change",{notebook:notebook},function(data){if(data.indexOf("Your notebook was changed")){if($("#revalidate-saved-data:checked").length==1){$status.html("Settings saved ! Revalidating saved data ...");$.get("notebook.php",function(data){var notebook=$$("textarea[name=notebook]",data);notebook=notebook.text();if((start=notebook.indexOf(setting_begin_sign))>-1&&(stop=notebook.indexOf(setting_end_sign))>-1){var setting_str=notebook.substring(start+setting_sign_length,stop);if($("#data-mode-compress:checked").length==1){setting_str=lzw_decode(setting_str)}setting_str=unescape(setting_str);try{var setting_obj=eval(setting_str);TopTip("Your setting have been saved to notebook &amp; successfully revalidated!",6000)}catch(ex){TopTip('Revalidating saved data error, please try "Compatible mode" if you\'re using "Compress mode"',8000);le("Loading TCSP config from notebook : "+ex.toString())}}$status.html("")})}else{$status.html("");TopTip("Your setting have been save to notebook !",5000)}}else{$status.html("");alert("Unknown error when saving your setting.")}})})}});$("#io-text-option").click(function(){$("#io-text-option-panel").toggle();return false});$("#import").click(function(){if(!confirm("Please dont forget the tip **Never import any setting from the untrusted source**\nDo you still want to import the below settings ?")){return false}try{var b=$.trim($("#content").val());if(b!=""){var c=unserialize($("#content").val());if($("#import-overwrite:checked").length>0){obj2setting(c)}else{obj2setting_appendonexist(c)}alert("Settings imported !!!");client.reNavigate()}}catch(a){le("Importing setting : "+a.toString());alert("Error when importing, please send")}});$("#export").click(function(){var b=setting2obj();if($("#export-partial:checked").length>0){var a=$("#export-partial-key").val().trim();if(a.length<=0){alert("Please specify the key you want to export");return false}if(!(a in b)){alert("Key does not exist, please set difference key");return false}var c=b[a];b={};b[a]=c}$("#content").val(serialize(b));BottomTip("Export completed !\nNow you can save those config text to any text file")});$("#reset-setting-toggle").click(function(){$("#reset-setting-panel").toggle();return false});$("#reset-setting").click(function(){if(confirm("This action is NOT undoable ! Are you sure ?")){resetSetting();BottomTip("Action done !");client.reNavigate()}});$("#update-auto").click(function(){GM_setValue("update_auto",true)});$("#update-manual").click(function(){GM_setValue("update_auto",false)});$("#check-update").click(function(){CheckUpdate(true);var a=new Date();$("#update-last-check").text(a.toString())});$("#update-period").change(function(){GM_setValue("update_period",$(this).val())})}else{if(currentLoc("item.php")){var step=client.getQueryParam("step");switch(step){case"hallow":if(GM_getValue("it_use_bulk",true)){$("table[width=90%] > tbody > tr > td > b").each(function(a){var d=$(this).text();var c=$(this).parent();var b=checkItemQuantities(c.text());if(b>1&&c.find('a[href^="item.php?step=hallowuse&XID"]').length>0){c.append(' [<a id="use_bulk_hlw_'+a+'" href="#">Bulk use</a>]');$("#use_bulk_hlw_"+a).click(function(){var e=prompt("How many item(s) do you want to use ?",b);if(!e||isNaN(e)||parseInt(e)<1){return false}ShowCoverLayer("Using your items, please be patient ...<br/>&nbsp;");useHolidayItem(d,e,onSingleItemUsed);return false})}})}break;case undefined:if(GM_getValue("it_use_bulk",true)){$('table[width=90%][border=0] > tbody > tr > td > b > a[href^="iteminfo.php"]').each(function(a){var d=$(this).parent().parent();var c=d.find("b").text();var b=checkItemQuantities(d.text());if(b>1&&d.find("a[href*=use]").length>0){if(d.find("a[href*=itemuseparcel]").length==0){d.append('<font size="1">[<a id="use_bulk_'+a+'" href="#"><font size="1">Bulk use</font></a>]</font>');$("#use_bulk_"+a).click(function(){var e=prompt("How many item(s) do you want to use ?",b);if(!e||isNaN(e)||parseInt(e)<1){return false}ShowCoverLayer("Using your items, please be patient ...<br/>&nbsp;");useItemNormal(c,e,onSingleItemUsed);return false})}}})}break}}else{if(currentLoc("iteminfo.php")){var $_equip_stat=$("table[width=90%][bgcolor=#dfdfdf] td[width=50%]:first table tbody > tr");if($_equip_stat.length==4){$_equip_stat.each(function(d){var e=false;switch(d){case 0:e="pinkbar.png";break;case 1:e="tealbar.png";break;case 2:e="yellowbar.png";break;case 3:e="orangetop.png";break}if(e){var a=$(this);var c=a.find("img[src=images/ammo/"+e+"]");var b=0;if(c.length>0){b=c.attr("width")}a.append('<td><span style="font-size:10px; font-weight:bold;">'+b+"</span></td>")}})}}else{if(currentLoc("messages.php")){var macro=client.getQueryParam("macro");var action=client.getQueryParam("action");var mt_enable=GM_getValue("mt_enable",true);if(mt_enable){$("a[href=messages.php?action=send]:first").parent().parent().prepend('<td align="center">> <a href="messages.php?action=template"> Template</a></td>');$("a[href=messages.php?action=send]:first").parent().siblings().attr("width","16%");init_mail_template()}switch(action){case"template":var items="";for(var id in mail_templates){items+='<option value="'+id+'">'+id+"</option>"}$("hr:eq(1)").after('			Mail/Message Template manager<hr width="75%"/>			<table>				<tr>					<td valign="top">						Template name :<font color="red">*</font><br/>						<input type="text" id="mt-name" /><br/>						Subject :<br/>						<input type="text" value="" maxlength="50" size="48" id="mt-subj"/><br/>						Preset message :<font color="red">*</font><br/>						<textarea rows="8" cols="45" id="mt-body"></textarea><br/>					</td>					<td valign="middle">						<input id="mt-add" type="button" value="Add &gt;&gt;" style="width: 110px" /><br />						<input id="mt-remove" type="button" value="&lt;&lt; Remove" style="width: 110px" disabled="disabled"/><br />						<input id="mt-remove-all" type="button" value="Remove All" style="width: 110px" /><br />					</td>					<td valign="top">						Template list :<br />						<select id="mt-list" multiple="multiple" style="width: 150px; height: 205px">'+items+'</select>					</td>					<td>						<input id="mt-up" type="button" value="&#770;" style="width: 20px" disabled="disabled"/><br /><br />						<input id="mt-down" type="button" value="&#812;" style="width: 20px" disabled="disabled"/><br />					</td>				</tr>			</table>			<hr width="75%"/><br/>			<input id="mt-save" type="button" value="Save all template" />			');$("#mt-add").click(function(){var b=$("#mt-name").val();var a=$("#mt-subj").val();var c=$("#mt-body").val();if(b.length>0&&c.length>0){if(b.indexOf("{:}")>-1||b.indexOf("{;}")>-1||b.indexOf("{|}")>-1||a.indexOf("{:}")>-1||a.indexOf("{;}")>-1||a.indexOf("{|}")>-1||c.indexOf("{:}")>-1||c.indexOf("{;}")>-1||c.indexOf("{|}")>-1){alert('Ops !! Please do not use the string "{;}" or "{:}" or "{|}" in your template, it\'s Mail template meta string');return}if(comboAddItem("mt-list",b,b,true)){mail_templates[b]=a+"{|}"+c;$("#mt-name").val("");$("#mt-subj").val("");$("#mt-body").val("")}else{alert("This Template name is already exist, please use another name !")}}else{alert("Template name and Preset message are REQUIRED !")}});$("#mt-remove").click(function(){var b=comboGetSelectedItem("mt-list");var a=mail_templates[b.val()];a=a.split("{|}");$("#mt-name").val(b.val());$("#mt-subj").val(a[0]);$("#mt-body").val(a[1]);comboRemoveSelectedItem("mt-list");mail_templates[b.val()]=undefined});$("#mt-remove-all").click(function(){mail_templates={};comboRemoveAllItem("mt-list")});$("#mt-list").mouseup(function(){var a=$(this).find(":selected");if(a.length==1){$("#mt-up").removeAttr("disabled");$("#mt-down").removeAttr("disabled");$("#mt-remove").removeAttr("disabled")}else{$("#mt-up").attr("disabled","disabled");$("#mt-down").attr("disabled","disabled");$("#mt-remove").attr("disabled","disabled")}});$("#mt-up").click(function(){comboMoveItemUp("mt-list")});$("#mt-down").click(function(){comboMoveItemDown("mt-list")});$("#mt-save").click(function(){GM_setValue("mail_templates",obj2str(mail_templates,"{:}","{;}"));BottomTip("All templates are saved !")});break;case"send":if(macro){SendMailMacroHandle(macro)}else{if(mt_enable){var items='<option value="---">- Pick one -</option>';for(var id in mail_templates){items+='<option value="'+id+'">'+id+"</option>"}$("input[name=subject]").parent().parent().before('				<tr>					<td bgcolor="#dfdfdf" width="25%"><b>Template:</b></td>					<td bgcolor="#dfdfdf"><select id="mt-list">'+items+'</select> &nbsp;> <a href="messages.php?action=template"> Manager</a> <</td>				</tr>');var $msg_body=$("textarea[name=msg]");$msg_body.after('<br/> <div align="center" id="tpl-add" title="Add current content to template">&gt; Save current content as a new template &lt;</div><br />');$("#mt-list").change(function(){var a=$(this).val();if(a!="---"){var b=mail_templates[a].split("{|}");$("input[name=subject]").val(b[0]);$msg_body.val(b[1])}});$("#tpl-add").click(function(){var b=prompt("Please enter the new template name");if(b!=""){var c=$msg_body.val();var a=$(":text[name=subject]").val();if(b.indexOf("{:}")>-1||b.indexOf("{;}")>-1||b.indexOf("{|}")>-1||a.indexOf("{:}")>-1||a.indexOf("{;}")>-1||a.indexOf("{|}")>-1||c.indexOf("{:}")>-1||c.indexOf("{;}")>-1||c.indexOf("{|}")>-1){alert('Ops !! Please do not use the string "{;}" or "{:}" or "{|}" in your template, it\'s Mail template meta string');return}if(mail_templates[b]==undefined){mail_templates[b]=a+"{|}"+c;GM_setValue("mail_templates",obj2str(mail_templates,"{:}","{;}"));BottomTip("New mail/msg template is added")}else{if(confirm("The entered template name is already exist !\nDo you want to overwrite it ?")){mail_templates[b]=a+"{|}"+c;GM_setValue("mail_templates",obj2str(mail_templates,"{:}","{;}"));BottomTip("Mail/template's content is updated !")}}}}).hover(function(){$(this).attr("style","text-decoration:underline; cursor:pointer;")},function(){$(this).attr("style","")})}}DecodeMailContent();break;case"send1":SendMailMacroCompletedHandle(macro);break;case"read":if(mt_enable){attachBodyTplControl("textarea[name=msg]")}DecodeMailContent();break}}else{if(currentLoc("messageinc.php")){var action=client.getQueryParam("action");switch(action){case"send":if(GM_getValue("mt_enable",true)){init_mail_template();attachBodyTplControl("textarea[name=msg]")}break}}else{if(currentLoc("newspaper_class.php")){$('td > a[href="profiles.php?XID=500343"]').each(function(){$(this).parent().wrapInner('<div style="border:2px blue solid;">')});if(GM_getValue("as_enable",true)&&GM_getValue("scam_censor",true)){$("td[height=1][bgcolor=#dfdfdf]").each(function(a){var b=getSimpleXID("XID",$(this).find("a[href^=profiles.php]").attr("href"));if(isScammer(b)){$(this).wrapInner('<span id="ads_'+a+'" style="display: none;">').append('<span id="censor_'+a+'">!!! This ads is being hiden by Anti scamming system<br/><a href="#" id="show_ads_'+a+'">Click here</a> to view it</span>');$("#show_ads_"+a).click(function(){$("#censor_"+a).hide();$("#ads_"+a).show();return false})}})}}else{if(currentLoc("laptop4.php")){mail_templates=str2obj(GM_getValue("mail_templates",""),"{:}","{;}");var step=client.getQueryParam("step");switch(step){case"read":attachBodyTplControl("textarea[name=msg]");DecodeMailContent();break}}else{if(currentLoc("factions.php")){var step=client.getQueryParam("step");var action=client.getQueryParam("action");if(step=="your"){switch(action){case"members":if(GM_getValue("confirm_fac_kick",true)){l("Faction kicking confirm trigger !!!");$("a[href^='facstaff.php?a=kick&XID=']").each(function(){var a=$(this).attr("href");$(this).attr("href","javascript: void(0)").click(function(){var d=$(this).parent().siblings().eq(1).find("a[href^=profiles.php]");var b=$.trim(d.text());var c=getSimpleXID("XID",d.attr("href"));if(confirm("You're going to kick "+b+" ["+c+"]\nAre you sure ?")){client.redirect(a)}})})}$("table[width=90%]").before('<input type="button" value="Check last action" id="check-last-action"><br/>				<input type="checkbox" id="last-action-highlight" /><label for="last-action-highlight">Highlight member who has  inactived for over :</label><br/>				<input type="text" id="la-day" maxlength="2" size="1" value="1">day(s) <input type="text" id="la-hrs" maxlength="2" size="1" value="0">hour(s) <input type="text" id="la-min" maxlength="2" size="1" value="0">minutes(s)<br/>').find("tr[bgcolor=#999999] > td:eq(1)").attr("width","45%");$("#check-last-action").click(function(){var c="http://minh.phoenixheart.net/torn/imgs/loading12.gif";preLoadImg(c);if(!confirm("This action may take some times to execute, belong to your connection and member list\nAre you sure ?")){return true}$(this).attr("disabled","disabled");la_highlight_min=0;if($("#last-action-highlight:checked").length==1){la_highlight_min=parseFloat("0"+$("#la-day").val())*24*60+parseFloat("0"+$("#la-hrs").val())*60+parseFloat("0"+$("#la-min").val())}l("Highlight minute : "+la_highlight_min);var b=[];var a,d;$("table[width=90%] > tbody > tr > td a[href^=profiles.php?XID]").each(function(){a=$(this).attr("href");b.push(a);d=getSimpleXID("XID",a);$(this).parent().append(' <span id="last-action-'+d+'" style="font-size:10px"><img src="'+c+'" /></span>')});GetLastAction(b,5)});$("#last-action-highlight").change(function(){if($(this).filter(":checked").length==1){$("#la-day").removeAttr("disabled");$("#la-hrs").removeAttr("disabled");$("#la-min").removeAttr("disabled")}else{$("#la-day").attr("disabled","disabled");$("#la-hrs").attr("disabled","disabled");$("#la-min").attr("disabled","disabled")}});$("#last-action-highlight").extrigger("change");break;case"donate":currencyFormEffect(":text[name=donatemoney]");break}}else{if(step=="userlist"){$("table[width=90%]").before('<input type="button" value="Check last action" id="check-last-action"><br/>		<input type="checkbox" id="last-action-highlight" /><label for="last-action-highlight">Highlight member who has  inactived for over :</label><br/>		<input type="text" id="la-day" maxlength="2" size="1" value="1">day(s) <input type="text" id="la-hrs" maxlength="2" size="1" value="0">hour(s) <input type="text" id="la-min" maxlength="2" size="1" value="0">minutes(s)<br/>').find("tr[bgcolor=#999999] > td:eq(1)").attr("width","45%");$("#check-last-action").click(function(){var d=new Image();d.src="http://minh.phoenixheart.net/torn/imgs/loading12.gif";if(!confirm("This action may take some times to execute, belong to your connection and member list\nAre you sure ?")){return true}$(this).attr("disabled","disabled");la_highlight_min=0;if($("#last-action-highlight:checked").length==1){la_highlight_min=parseFloat("0"+$("#la-day").val())*24*60+parseFloat("0"+$("#la-hrs").val())*60+parseFloat("0"+$("#la-min").val())}l("Highlight minute : "+la_highlight_min);var b=[];var a,c;$("table[width=90%] > tbody > tr > td a[href^=profiles.php?XID]").each(function(){a=$(this).attr("href");b.push(a);c=getSimpleXID("XID",a);$(this).parent().append(' <span id="last-action-'+c+'" style="font-size:10px"><img src="'+d.src+'" /></span>')});GetLastAction(b,5)});$("#last-action-highlight").change(function(){if($(this).filter(":checked").length==1){$("#la-day").removeAttr("disabled");$("#la-hrs").removeAttr("disabled");$("#la-min").removeAttr("disabled")}else{$("#la-day").attr("disabled","disabled");$("#la-hrs").attr("disabled","disabled");$("#la-min").attr("disabled","disabled")}});$("#last-action-highlight").extrigger("change")}else{if(step=="hitlist"){if(registry.checkAppEnabled("chain_helper",true)){$container=$("center > b > font[size=4]").parent().parent();$container.append('<br /><br /><div id="chain-helper-container">	<input type="button" value="START CHAINING" id="ch-start" /><input type="button" value="STOP CHAINING" id="ch-stop" /><br />	<div id="otf-warning" style="color:red; font-weight:bold; font-size:10px;">Don\'t forget to STOP CHAINING once done the chain</div><br />	<table id="chain-helper-info" style="display:none"><tbody>	<tr><td rowspan="4"><img width="75px" id="chain-light" src="http://minh.phoenixheart.net/torn/imgs/blue_alert.gif" /> &nbsp;	<td>Faction chaining upgrade detected : <span style="font-weight:bold;" id="chaining-upgraded">?</span> - Can be stand for ~<span style="font-weight:bold;" id="chaining-timeout">?</span>min </td></tr>	<tr><td>Last attack event : <span style="font-weight:bold; color:darkgreen;" id="last-att-event">unknown</span></td></tr>	<tr><td>Last attack time : <span id="last-att-time">unknown</span></td></tr>	<tr><td>Chain will be broken at <span id="chain-broken-time">No/Broken</span> 	(in next <span style="font-weight:bold;" id="chain-count-down">?</span> second)</td></tr>	</tbody></table></div>');ch_checking_att_news_rate=6000;ch_started=GM_getValue("ch_started",false);$last_att_time=$("#last-att-time");$last_att_event=$("#last-att-event");$chain_broken_time=$("#chain-broken-time");$chain_count_down=$("#chain-count-down");$chain_light=$("#chain-light");preLoadImg("http://minh.phoenixheart.net/torn/imgs/green_alert.gif");preLoadImg("http://minh.phoenixheart.net/torn/imgs/yellow_alert.gif");preLoadImg("http://minh.phoenixheart.net/torn/imgs/red_alert.gif");var alarm=new GMX_audio("ch-alarm","GMRES_notify");unsafeWindow.alarm=alarm;alarm.enableLoop(true);var attention=new GMX_audio("ch-attention","GMRES_attention");unsafeWindow.attention=attention;var gun=new GMX_audio("ch-gun","GMRES_gun");unsafeWindow.gun=gun;chain_counter_interval=false;checkAttNews=function(){if(GM_getValue("ch_started",false)===false){l("ch - not yet started");alarm.stop();return false}if(GM_getValue("ch_otf",false)===true){l("ch - otf");window.setTimeout(checkAttNews,ch_checking_att_news_rate);return false}window.setTimeout(function(){if(GM_getValue("ch_otf",false)===true){le("OTF recheck - hitted");window.setTimeout(checkAttNews,ch_checking_att_news_rate);return false}$.get("factions.php?step=your&news=2",function(d){var f=GM_getValue("ch_last_att_event",false);var c=new Date(GM_getValue("ch_last_att_time",false));var b=false;$$("td[width=90%] > table[width=90%]:last > tbody > tr",d).each(function(m){if(b){return true}if(m<2){return true}var h=$(this).find("td");var k=h.eq(0);var n=h.eq(1);var o=$.trim(n.html());if(o.indexOf('<font color="#006633"><a href')>-1&&o.indexOf("</a> hospitalized <a")>-1){var j=n.find("a[href^=profiles.php]:last").attr("href");_xid=getSimpleXID("XID",j);_event_time=parseEventTime(k.html());var g=_event_time-c;if(g<=0){b=true}if($.inArray(_xid,ch_target_list)>-1&&(g!=0||f!=o)){b=true;c=_event_time;f=o;GM_setValue("ch_last_att_event",f);GM_setValue("ch_last_att_time",c.toString());gun.play()}}});$last_att_time.html(ymdhis(c));$last_att_event.html(f);var a=new Date(c);a.setSeconds(a.getSeconds()+chain_timeout);var e=getTCTimeFromHTML(d);chain_count_down=(a-e)/1000-1;if(chain_count_down>0){$chain_broken_time.html(ymdhis(a));$chain_count_down.html(chain_count_down)}else{$chain_broken_time.html("No/Broken");$chain_count_down.html("?")}if(chain_counter_interval){window.clearInterval(chain_counter_interval)}chain_counter_interval=window.setInterval(function(){chain_count_down--;if(chain_count_down>0){$chain_count_down.html(chain_count_down)}if(chain_count_down<=0){window.clearInterval(chain_counter_interval);chain_counter_interval=false;$chain_light.attr("src","http://minh.phoenixheart.net/torn/imgs/blue_alert.gif").attr("alt","Broken");alarm.stop();$chain_broken_time.html("---");$chain_count_down.html("?")}else{if(chain_count_down<=60){$chain_light.attr("src","http://minh.phoenixheart.net/torn/imgs/red_alert.gif").attr("alt","Rushing");alarm.play();if(chain_count_down%10===0){attention.play()}}else{if(chain_count_down<120){$chain_light.attr("src","http://minh.phoenixheart.net/torn/imgs/yellow_alert.gif").attr("alt","SpeedUp");alarm.play()}else{$chain_light.attr("src","http://minh.phoenixheart.net/torn/imgs/green_alert.gif").attr("alt","Fine");alarm.stop()}}}},1000);window.setTimeout(checkAttNews,ch_checking_att_news_rate)})},2000)};$("#ch-start").click(function(){$("#chain-helper-info").show();GM_setValue("ch_started",true);ShowCoverLayer("Checking your faction's Chaining Uprade ...");$.get("profiles.php?XID="+getCurrentUserID(),function(b){var a=$$("#infoBoxLeft a[href^=factions.php?step=profile]:first",b).attr("href");$.get(a,function(e){var c=$$("table[width=400] > tbody > tr > td[width=200]:first",e).text();var d=c.match(/Chaining: ([IVX]+)/);if(d){chaining_upgraded=deromanize(d[1])}else{chaining_upgraded=0}GM_setValue("ch_chain_upgraded",chaining_upgraded);$("#chaining-upgraded").text(chaining_upgraded);chain_timeout=getChainTimeout(chaining_upgraded);$("#chaining-timeout").text(chain_timeout/60);ShowCoverLayer("Analyzing target list ...");$.get("factions.php?step=hitlist",function(f){ch_target_list=[];$$("a[href^=attack.php]",f).each(function(){var g=$(this).attr("href");ch_target_list.push(getSimpleXID("PID",g))});GM_setValue("ch_target_list",ch_target_list.join(","));RemoveCoverLayer();ChainHelperHookingLink();checkAttNews()})})})});$("#ch-stop").click(function(){GM_setValue("ch_started",false);$("#chain-helper-info").hide()});if(ch_started){$("#chain-helper-info").show();ch_target_list=GM_getValue("ch_target_list","").split(",");chaining_upgraded=GM_getValue("ch_chain_upgraded",0);$("#chaining-upgraded").text(chaining_upgraded);chain_timeout=getChainTimeout(chaining_upgraded);$("#chaining-timeout").text(chain_timeout/60);checkAttNews()}}}}}}else{if(currentLoc("facstaff.php")){var action=client.getQueryParam("a");switch(action){case"giveuser":if(GM_getValue("confirm_fac_giving",true)){l("Faction giving confirm trigger !");$("form").each(function(){$(this).submit(function(){var b,c,a;if($(this).attr("action").indexOf("givecash")>-1){b=$("select[name=userID]:first :selected").text();c=formatCurrency($("input[name=givemoney]").val());a="$"}else{b=$("select[name=userID]:last :selected").text();c=$("input[name=givepoints]").val();a="pts"}return confirm("Give to : "+b+"\nAmount : "+c+" "+a+"\nAre you sure ??")})})}currencyFormEffect(":text[name=givemoney]");break;case"payday":currencyFormEffect(":text[name=amount]");break}}else{if(currentLoc("forums.php")){fixTCStyle();var tid=client.getQueryParam("ID");if(GM_getValue("mt_enable",true)&&tid){init_mail_template();attachBodyTplControl("textarea[name=post]")}if(tid=="5598567"&&GM_getValue("as_enable",true)){$("td[bgcolor=#bbbbbb][colspan=2]").append('<span style="float:right">Scammer ID Search <input type="text" id="scammer-id-search" /></span>');$("#scammer-id-search").keydown(function(b){var a=this.value;if(b.keyCode==13&&!isNaN(a)){openInTab(xprofileURL(a))}})}}else{if(currentLoc("quote.php")){var tid=client.getQueryParam("ID");if(GM_getValue("mt_enable",true)&&tid){init_mail_template();attachBodyTplControl("textarea[name=post]")}}else{if(currentLoc("loan.php")){if(GM_getValue("vl_enable",true)){$("form").attr("id","frm-loan").after('Loan more:<br/><input type="text" id="loan-more-amt" value="0" size="10" maxlength="20" /><input type="button" id="loan-more" value="Loan"><br/><br/>Pay back:<br><input type="text" id="loan-pay-amt" value="0" size="10" maxlength="20"><input type="button" id="loan-pay" value="Pay">');var loan_effect={};loan_effect["loan-more-amt"]="loan-more";loan_effect["loan-pay-amt"]="loan-pay";currencyTextEffect(loan_effect);$current_amt=$("form > input[name=loan]");var current_amt=parseInt($current_amt.val());$("#loan-more").click(function(){var a=parseInt(unformatCurrency($("#loan-more-amt").val()));$current_amt.val(current_amt+a);$("#frm-loan").trigger("submit")});$("#loan-pay").click(function(){var a=parseInt(unformatCurrency($("#loan-pay-amt").val()));$current_amt.val(current_amt-a);$("#frm-loan").trigger("submit")})}currencyFormEffect(":text[name=loan]")}else{if(currentLoc("amarket.php")){var step=client.getQueryParam("step");switch(step){case"buy":currencyFormEffect(":text[name=nextbid]");break;case"addl1":currencyFormEffect(":text[name=price]");break}}else{if(currentLoc("imarket.php")){var step=client.getQueryParam("step");switch(step){case"addl1":currencyFormEffect(":text[name=price]");break}}else{if(currentLoc("pmarket.php")){var step=client.getQueryParam("step");switch(step){case"addlisting":currencyFormEffect(":text[name=price]");break}}else{if(currentLoc("jobs.php")){var step=client.getQueryParam("step");switch(step){case"manageemployees":ManagerEmployeeHandle();currencyFormEffect(":text[name$=pay]");break;case"companyfunds":currencyFormEffect(":text[name=withdraw], :text[name=deposit]");break}}else{if(currentLoc("blackjack.php")){currencyFormEffect(":text[name=money]")}else{if(currentLoc("poker1.php")){currencyFormEffect(":text[name=moneyputdown], :text[name=raise]")}else{if(currentLoc("russianroulette.php")){currencyFormEffect(":text[name=bet]")}else{if(currentLoc("bank.php")){currencyFormEffect(":text[name=amount]")}else{if(currentLoc("bazaar.php")){currencyFormEffect(":text[name=amount], :text[name=price]");var step=client.getQueryParam("step");switch(step){case"buy":case"remove":addButtonALL();break;case"add":addButtonALL(false,2);break}}else{if(currentLoc("bookie.php")){currencyFormEffect(":text[name=amount]")}else{if(currentLoc("jailview.php")){var jail_hide=GM_getValue("reg_var_jailhide","");var hide_list=[];if(jail_hide.length>0){try{hide_list=eval(jail_hide);jail_hide=true}catch(ex){le("jailhide eval error : "+ex.toString())}}else{jail_hide=false}$("table[width=90%][border=0] > tbody > tr").each(function(c){if(c==0){$(this).append('<td><b title="Bust without confirm page">BustX</b></td>')}else{var d=$(this);var a=d.find("td:last > a");d.append('<td>[<a href="'+a.attr("href")+'1">Bust</a>]</td>');if(jail_hide){var b=getSimpleXID("XID",a.attr("href"));for(var e in hide_list){if(hide_list[e]==b){d.remove()}}}}})}else{if(currentLoc("stockexchange.php")){var step=client.getQueryParam("step");if(!step){var $stock_table=$('img[src^="http://static.torn.com/stock"]:first').parent().parent().parent().parent().parent().attr("id","stock-table");var image=new Image();image.src="http://minh.phoenixheart.net/torn/imgs/loading12.gif";var stock_acro={0:"TCSE",19:"EWM",6:"GRN",25:"WSSB",31:"TCC",14:"IIL",3:"SYS",2:"TCB",26:"ISTC",1:"TCSB",29:"MCS",10:"CNC",28:"EVL",13:"TCP",4:"SLAG",9:"TCT",5:"IOU",18:"PRN",23:"TGP",12:"TMI",22:"HRG",16:"SYM",7:"TCHS",15:"FHC",11:"MSG",21:"ELBT",8:"YAZ",30:"WLT",20:"TCM",17:"LSC",27:"BAG"};$stock_table.find("tr:first").append('<td><b title="Quick check">QCheck</b></td>');$stock_table.find("tr[bgcolor=#cccccc]").each(function(b){var a=$(this).find('a[href^="stockexchange.php?step=profile&stock="]:first').attr("href");a=a.substr(a.indexOf("stock=")+6);var c=stock_acro[a];if(!c){c="Undefined"}$(this).append('<td><a id="check-stock-'+a+'" href="#">['+c+"]</a></td>");$("#check-stock-"+a).click(function(f){var d="stockexchange.php?step=profile&stock="+a;FloatingPanel('<span id="check-stock-status-'+a+'"><br/> Checking stock status <img src="http://minh.phoenixheart.net/torn/imgs/loading12.gif" alt="..."/></span>',f.pageX,f.pageY,140,75,c+" - "+a);$.get(d,function(m){if(a=="0"){var k=m.match(/Current price:\<\/b\>\<\/td\>\<td\>\$([\d\.,].*?)\<\/td\>/);k[3]=k[1];k[1]=k[2]=k[4]="N/A"}else{var k=m.match(/Forecast:\<\/b\>\<\/td\>\<td\>([\w\s].*?)\<\/td\>[\s\S]*?Demand:\<\/b\>\<\/td\>\<td\>([\w\s].*?)\<\/td\>[\s\S]*?Current price:\<\/b\>\<\/td\>\<td\>\$([\d\.,].*?)\<\/td\>[\s\S]*?Shares for sale:\<\/b\>\<\/td\>\<td\>([\d,].*?)\<\/td\>/)}if(k&&k.length==5){var g=k[1];var e=k[2];var j=k[3];var h=k[4];$("#check-stock-status-"+a).html("Forecast: <b>"+g+"</b><br/>Demand: <b>"+e+"</b><br/>Price: <b>"+j+"</b><br/>Shares: <b>"+h+"</b><br/>")}else{$("#check-stock-status-"+a).html('<span style="color:red">Error when loading page, please recheck ..</span>')}});return false})})}else{if(step=="profile"){var stock_id=client.getQueryParam("stock");if(stock_id!=0){var tmp=$("table[width=500] > tbody > tr:eq(1) > td[bgcolor=#cccccc]");var matches=tmp.text().match(/Current price:\$([\d\.,].*)[\s\S]*?Shares for sale:([\d\,].*)/);if(matches&&matches.length==3){var _price=parseFloat(unformatCurrency(matches[1]));var _share_av=parseInt(unformatCurrency(matches[2]));var _cash_investable=_price*_share_av;var _cash_acro="";if(_cash_investable/1000000000>1){_cash_acro=" (over <b>$"+parseInt(_cash_investable/1000000000)+" billion</b>)"}else{if(_cash_investable/1000000>1){_cash_acro=" (over <b>$"+parseInt(_cash_investable/1000000)+" million</b>)"}}tmp.append('<div align="center"><b>Total cash investable</b> : $'+formatCurrency(parseInt(_cash_investable))+_cash_acro+"</div>")}}}}currencyFormEffect(":text[name=amount]")}else{if(currentLoc("events.php")){$("table[width=90%]:eq(1)").after('<br /><div id="event-highlighter">	<input type="text" id="event-highlighter-term" size="50" /> <input type="button" id="event-highlighter-perform" value="Highlight now" /><input type="button" id="event-highlighter-clear" value="C" title="Clear"/>	<div id="event-highlighter-result" style="color: #999999; font-weight:bold">&nbsp;</div></div>');var term=GM_getValue("eh_term","");$("#event-highlighter-term").val(term);DoEventHighlight(term);$("#event-highlighter-clear").click(function(){$("#event-highlighter-term").val("");$("#event-highlighter-perform").extrigger("click")});$("#event-highlighter-perform").click(function(){var a=$("#event-highlighter-term").val();GM_setValue("eh_term",a);DoEventHighlight(a)});$("#event-highlighter-term").keydown(function(a){if(a.keyCode==13){$("#event-highlighter-perform").extrigger("click")}})}else{if(currentLoc("preferences.php")){var action=client.getQueryParam("action");if(action=="settings"){$("form").submit(function(){GM_setValue("honor_mode",$(":radio[name=textnames]:checked").attr("value")!="1")})}}else{if(currentLoc("racing.php")){var step=client.getQueryParam("step");switch(step){case"race2":case"cars":case"parts":DisplayCarStat();break;case"parts3":DisplayPartStat();break;case undefined:var $racing_container=$("#racingupdates");if($racing_container.length>0){$racing_container.before('					<input type="checkbox" id="alert-when-start"><label for="alert-when-start"> Show alarm when start Racing</label><br />					<input type="checkbox" id="alert-when-race-done"><label for="alert-when-race-done"> Show alarm when Race done</label><br />				');var racing_last_status=false;window.setInterval(function(){DisplayCarStat();var c=$("#alert-when-start:checked").length>0;var a=$("#alert-when-race-done:checked").length>0;if(c||a){var b=$("div#racingupdatesnew > table > tbody > tr > td[width=193] > table > tbody > tr:eq(0) > td > b").text();if(c&&b.indexOf("Race will finish in")>-1){alert("You're on a race track now !");$("#alert-when-start").removeAttr("checked")}if(a&&b.indexOf("The race has finished")>-1){alert("The race is done, you can see the result now ...");$("#alert-when-race-done").removeAttr("checked")}}},5000)}break}}else{if(currentLoc("index.php")||currentLoc()=="/"){l("Root page");if(getCurrentStatus()=="normal"){l("Accessing home")}}else{if(currentLoc("displaycase.php")){var step=client.getQueryParam("step");if(step=="add"||step=="remove"){addButtonALL()}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}perform.l("LocationProcessing");setTimeout(AutomaticCheckingUpdate,1000);DisableScammerAds();perform.l("DisableScammerAds");setTimeout(ColoringNameLink,0);NavigateHandle();perform.l("NavigateHandle");setTimeout(FloatingPanelPaint,0);RewriteStatus();perform.l("RewriteStatus");EasterEggTrigger();perform.l("EasterEggTrigger");setTimeout(UpgradeLevelConfirm,0);TravelBackConfirm();perform.l("TravelBackConfirm");WriteRefillTime();perform.l("WriteRefillTime");RegisterMenu();perform.l("RegisterMenu");var seed=rand(1,12);if(seed==10&&!serverInfoRequested){requestServerInfo()}l("Processed page !");perform.logCompletedTime();