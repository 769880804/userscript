// ==UserScript==
// @name       Одежда и фулдоп
// @namespace  
// @version    0.1
// @description  enter something useful
// @include    http://*moswar.ru/player/*
// @copyright  2011+, You
// ==/UserScript==

function $c(){var d,b,t,e,r,m,o,p,n,a;playerShowInventory('normal');$dD();$(".object-thumbs").css({height:"auto",overflow:"hidden"});$(".hint").remove();$("dl#dopings-accordion div.object-thumbs div.object-thumb div.action:not(.disabled)").each(function(){o=(/(?!\/player\/use\/)[0-9]+(?=\/';(\n)?)/g).exec(String($(this)[0].getAttribute("onclick")));if(o.length>0){var a=(/(?=\/?)[a-zA-Z0-9-]+(?=\.png(\n)?$)/g).exec(String($(this).parents("div.object-thumb").find("img:first").attr("src")))[0];if(a!="drugs5"&&a!="drugs4"){o="checked"}else{o=""}n=$("<div />").css({bottom:"0",left:"0",position:"absolute"}).append("<input type=\"checkbox\" class=\"m4w\" "+o+" />");$(this).parents("div.object-thumb").css({"height":"64px","margin-bottom":"22px"}).append(n).click(function(e){if(e.target.type!='checkbox')$(':checkbox',this).attr('checked',function(){return!this.checked})})}});p=$("div#content table.inventary td.equipment-cell div[rel='normal'] div.object-thumbs div.object-thumb");p.each(function(){if($(this).find("div.action").length==0||!String($(this).find("div.action:first")[0].getAttribute("onclick")).match(/\/player\/dress\/[0-9]+\/';/g)){$(this).remove()}else{n=$("<div />").css({bottom:"0",left:"0",position:"absolute"}).append("<input type=\"checkbox\" checked=\"checked\" class=\"m3w\" />");$(this).css({"height":"64px","margin-bottom":"22px"}).append(n).click(function(e){if(e.target.type!='checkbox')$(':checkbox',this).attr('checked',function(){return!this.checked})})}});$("#content table.layout td.slots-cell ul.slots").find("li").not(".avatar,.slot-pet").each(function(){if($(this).find("img").length>0){d=$("<div />").css({bottom:"0",left:"0",position:"absolute"}).append("<input type=\"checkbox\" checked=\"checked\" class=\"m1w\" />");$(this).append(d).click(function(e){if(e.target.type!='checkbox')$(':checkbox',this).attr('checked',function(){return!this.checked})})}});b=$("<button />").addClass("button").css("margin","0 10px 7px 0").append("<span class=\"f\"><i class=\"rl\"></i><i class=\"bl\"></i><i class=\"brc\"></i><div class=\"c\">Снять выбранное</div></span>");b2=b.clone(true);b3=b.clone(true);b3.click(function(){$(".button").addClass("disabled").unbind('click');a=new Array();$(".m4w:checked").each(function(){l=(/\/player\/use\/[0-9]+\/(?=';(\n)?$)/g).exec(String($(this).parents(".object-thumb").find("div.action:first")[0].getAttribute("onclick")));a.push(l[0])});$mt(a)}).find("div.c").text("Съесть выбранное");b2.click(function(){$(".button").addClass("disabled").unbind('click');a=new Array();$(".m3w:checked").each(function(){l=(/\/player\/dress\/[0-9]+\/(?=';(\n)?$)/g).exec(String($(this).parents(".object-thumb").find("div.action:first")[0].getAttribute("onclick")));a.push(l[0])});$mt(a)}).find("div.c").text("Одеть выбранное");b.click(function(){$(".button").addClass("disabled").unbind('click');a=new Array();$(".m1w:checked").each(function(){m=$(this).parents("li").find("img").attr("src");$(p).find("div.action").each(function(){if($(this).parents("div.padding").find("img").attr("src")==m){l=(/\/player\/withdraw\/[0-9]+\/(?=';(\n)?$)/g).exec(String($(this)[0].getAttribute("onclick")));a.push(l[0])}})});$mt(a)});t=$("<b />").css({"color":"#945903","font":"bold 90% Tahoma,sans-serif,Arial"}).html("Выполнено");e=$("<div />").addClass("exp").html("<div class='bar' style='width:100%'><div><div class='percent' style='width:0%' id='m2w'></div></div></div>");r=$("<tr />").append("<td align='center' /><td align='center' /><td class='progress' />");$(r).find("td:nth-child(1)").append(b3).end().find("td:nth-child(2)").append(b,b2).end().find("td:nth-child(3)").append(t,e);$("#content table.layout tbody").append(r)}function $dD(){var v,h,s,c,i,a;v="dl.vtabs div.object-thumbs";h=function(e){return $(e).parents("div.object-thumb").find("div.count")};$(v).each(function(){$(this).find("div.object-thumb img").each(function(){s=String(/(?=\/)?[a-zA-Z0-9-]+\.png$/g.exec(String($(this).attr("src"))));i=$(v).find("img[src*='"+s+"']");if(i.length>1){c=0;i.each(function(){a=h(this);if(!a.html()){c+=1}else{c+=Number(a.html().replace("#",""))}});if(!h(i[0]).html())$("<div class='count' />").insertAfter($(i[0]));h(i[0]).html("#"+c);i.not(":first").parents("div.object-thumb").remove();return}})})}function $mt(a){if(a.length>0){var p=Math.round(100/a.length);$.get(a.pop(),function(d){$("#m2w").css("width",p+"%");$mt(a)})}else{window.location.reload(true)}}$c();
 
                            