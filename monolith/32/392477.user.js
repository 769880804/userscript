// ==UserScript==
// @name       WaniKani Substitute Audio
// @namespace  http://use.i.E.your.homepage/
// @version    1.0
// @description  substitutes audio
// @match      *://www.wanikani.com/review/session
// ==/UserScript==

this.additionalContent.audio=e=function(t){var n,r,i,s;i=$.jStorage.get("currentItem"),s=$.jStorage.get("questionType"),$("audio").remove();if(i.aud){if(s==="reading")return r=$("#option-audio"),n=r.find("button"),t=t,$("#answer-form fieldset").hasClass("correct")||(t=!1),n.removeAttr("disabled"),e=$("<audio></audio>",{autoplay:t}).appendTo(r.removeClass("disabled").children("span")),$("<source></source>",{src:"http://s3.wanikani.com/audio/"+i.aud,type:"audio/mpeg"}).appendTo(e),$("<source></source>",{src:"http://s3.wanikani.com/audio/"+i.aud.replace(".mp3",".ogg"),type:"audio/ogg"}).appendTo(e),e[0].addEventListener("play",function(){return n.removeClass("audio-idle").addClass("audio-play")}),e[0].addEventListener("ended",function(){return n.removeClass("audio-play").addClass("audio-idle")}),n.off("click"),n.on("click",function(){return e[0].play()}),r.off("click"),r.on("click",function(){if($("#user-response").is(":disabled"))return $("audio").trigger("play"),!1})}else{if(i.voc&&s==="reading")return r=$("#option-audio"),n=r.find("button"),t=t,$("#answer-form fieldset").hasClass("correct")||(t=!1),n.removeAttr("disabled"),e=$("<audio></audio>",{autoplay:t}).appendTo(r.removeClass("disabled").children("span")),$("<source></source>",{src:"http://assets.languagepod101.com/dictionary/japanese/audiomp3.php?kana=" + encodeURI(i.kana[0]) + "&kanji=" + encodeURI(i.voc),type:"audio/mpeg"}).appendTo(e),e[0].addEventListener("play",function(){return n.removeClass("audio-idle").addClass("audio-play")}),e[0].addEventListener("ended",function(){return n.removeClass("audio-play").addClass("audio-idle")}),n.off("click"),n.on("click",function(){return e[0].play()}),r.off("click"),r.on("click",function(){if($("#user-response").is(":disabled"))return $("audio").trigger("play"),!1})}}