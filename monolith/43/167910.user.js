// ==UserScript==
// @copyright    2013 Atheismplus.com
// @description  Zaps Twitter accounts that you choose or that are on the Atheismplus.com block list
// @downloadURL  http://userscripts.org/scripts/source/167910.user.js
// @icon         http://theblockbot.com/images/zapped!_48x48.gif
// @match        http://twitter.com/*
// @match        https://twitter.com/*
// @match        http://mobile.twitter.com/*
// @match        https://mobile.twitter.com/*
// @name         The Zapper
// @namespace    http://theblockbot.com/
// @updateURL    http://userscripts.org/scripts/source/167910.user.js
// @version      1.2.1
// ==/UserScript==

var zapper=function(){var G,p,m,s,O,P,H,g,Q,y,l,R,z,S,e,T,A,U,h,v,B,w,x,C,J,D,K,V,W,r,E,X,I,L,t,Y,Z,$,aa,F,u,M,ba,ca,N;ba=function(){localStorage.zapper_state||(localStorage.zapper_state="running");return localStorage.zapper_state};M=function(b){u=localStorage.zapper_state=b};Y=function(){localStorage.zapper_noGlowState||(localStorage.zapper_noGlowState="true");return"true"===localStorage.zapper_noGlowState?!0:!1};Z=function(b){b?(localStorage.zapper_noGlowState="true",t=!0):(localStorage.zapper_noGlowState=
"false",t=!1)};O=function(){localStorage.zapper_zapLevel||(localStorage.zapper_zapLevel="1");return localStorage.zapper_zapLevel};P=function(b){0<=b&&4>=b&&(m=b,localStorage.zapper_zapLevel=b)};T=function(){localStorage.zapper_zapListLevel1&&/^(\w+\|)*\w+$/.test(localStorage.zapper_zapListLevel1)||(localStorage.zapper_zapListLevel1="");localStorage.zapper_zapListLevel2&&/^(\w+\|)*\w+$/.test(localStorage.zapper_zapListLevel2)||(localStorage.zapper_zapListLevel2="");localStorage.zapper_zapListLevel3&&
/^(\w+\|)*\w+$/.test(localStorage.zapper_zapListLevel3)||(localStorage.zapper_zapListLevel3="");localStorage.zapper_zapListLevel4&&/^(\w+\|)*\w+$/.test(localStorage.zapper_zapListLevel4)||(localStorage.zapper_zapListLevel4="");return{level1:localStorage.zapper_zapListLevel1,level2:localStorage.zapper_zapListLevel2,level3:localStorage.zapper_zapListLevel3,level4:localStorage.zapper_zapListLevel4}};A=function(b,a){0<b.length&&/^(\w+\|)*\w+$/.test(b)?(localStorage["zapper_zapListLevel"+a]=b,e["level"+
a]=b):e["level"+a]=localStorage["zapper_zapListLevel"+a]};h=function(b,a){var c,d;if(0<b.length&&0<a.length)for(c=0;c<a.length;c++)d=b.indexOf(a[c]),-1!==d&&(b=b.slice(0,d).concat(b.slice(d+1)));return b};B=function(){var b,a;a=[];for(b=1;b<=m;b++)0<e["level"+b].length&&(a=a.concat(e["level"+b].split("|")));a=h(a,g.split("|"));a=h(a,l.split("|"));0!==g.length&&(a=a.concat(g.split("|")));0===a.length&&a.push("#");return RegExp("\\b("+a.join("|")+")\\b")};Q=function(){localStorage.zapper_myZaps&&/^(\w+\|)*\w+$/.test(localStorage.zapper_myZaps)||
(localStorage.zapper_myZaps="");return localStorage.zapper_myZaps};y=function(b){g=b;localStorage.zapper_myZaps=g};R=function(){localStorage.zapper_myShows&&/^(\w+\|)*\w+$/.test(localStorage.zapper_myShows)||(localStorage.zapper_myShows="");return localStorage.zapper_myShows};z=function(b){l=b;localStorage.zapper_myShows=l};r=function(b){var a,c,d;a=document.createElement("optgroup");d=[];switch(b){case 0:a.label="LEVEL 0 (Custom):";0<g.length&&(d=g.split("|"));break;case 1:a.label="LEVEL 1 (Lowest Level): ";
0<e.level1.length&&0<m&&(h(e.level1.split("|"),g.split("|")),d=h(e.level1.split("|"),l.split("|")));break;case 2:a.label="LEVEL 2 (Medium Level): ";0<e.level2.length&&1<m&&(h(e.level2.split("|"),g.split("|")),d=h(e.level2.split("|"),l.split("|")));break;case 3:a.label="LEVEL 3 (Highest Level): ";0<e.level3.length&&2<m&&(h(e.level3.split("|"),g.split("|")),d=h(e.level3.split("|"),l.split("|")));break;case 4:a.label="LEVEL 4 (Previously Blocked): ",0<e.level4.length&&3<m&&(h(e.level4.split("|"),g.split("|")),
d=h(e.level4.split("|"),l.split("|")))}for(b=0;b<d.length;b++)c=document.createElement("option"),c.text="@"+d[b],c.value=d[b],a.appendChild(c);0===d.length&&(c=document.createElement("option"),c.text="---",a.appendChild(c),a.disabled="disabled");return a};E=function(){for(var b,a=document.getElementById("zapper-show-select");a.firstChild;)a.removeChild(a.firstChild);b=document.createElement("option");b.text="Show tweets by...";b.value="";a.appendChild(b);a.appendChild(r(0));a.appendChild(r(4));a.appendChild(r(3));
a.appendChild(r(2));a.appendChild(r(1))};V=function(){var b,a,c,d,e,g,l,h,n,q,f,k,p;c=document.createElement("div");c.className="module zapper";c.id="zapper";d=document.createElement("div");d.className="flex-module";e=document.createElement("div");e.className="flex-module-inner";g=document.createElement("div");g.className="flex-module-header";a=document.createElement("h3");a.title="Version 1.2.1 by Atheismplus.com";a.appendChild(document.createTextNode("The Zapper"));g.appendChild(a);a=document.createElement("img");
a.className="avatar";a.src=Math.round(Math.random())?"http://theblockbot.com/images/slug-zap_48x48.gif":"http://theblockbot.com/images/zapped!_48x48.gif";a.style.cssFloat="right";a.style.position="absolute";a.style.right="11px";a.style.top="5px";g.appendChild(a);l=document.createElement("fieldset");h=document.createElement("legend");h.style.marginBottom="0px";h.style.lineHeight="16px";a=document.createElement("small");a.className="metadata";a.appendChild(document.createTextNode("Zap Level"));h.appendChild(a);
n=document.createElement("form");n.name="levelForm";q=document.createElement("ul");q.className="clearfix";for(b=0;4>=b;b++){f=document.createElement("input");f.type="radio";f.name="levelSelect";f.value=b;m===b&&(f.checked="checked");a=document.createElement("li");a.style.listStyleType="none";a.style.cssFloat="left";a.style.paddingRight="8px";switch(b){case 0:k="Level 0 ";a.title="Level 0: Custom blocks.";break;case 1:k="1 ";a.title="Level 1: Mostly unpleasantly abusive and bigoted tweeps, some doxxers, stalkers and tweeps that are fakes of real accounts. (Plus you will zap Level 0)";
break;case 2:k="2 ";a.title="Level 2: Some abusive, but most are unapologetically wedded to MRA, anti-feminist or TERf/SWERf ideology (Plus you will zap Levels 0 & 1)";break;case 3:k="3 ";a.title="Level 3: The least hostile. Lacking in knowledge about and openness to feminist, trans*, anti-racist, etc. issues. (Plus you will zap Levels 0-2)";break;case 4:k="4 ",a.title="Level 4: Previously blocked accounts. (Plus you will zap Levels 0-3)"}a.appendChild(document.createTextNode(k));a.appendChild(f);
q.appendChild(a)}f=document.createElement("input");f.type="button";f.name="pause";f.id="zapper-pause-button";f.style.padding="1px 6px";switch(u){case "running":f.value=String.fromCharCode(10073)+String.fromCharCode(10073);f.title="Pause Zapper";break;case "paused":f.value=String.fromCharCode(9658),f.title="Start Zapper"}a=document.createElement("li");a.style.listStyleType="none";a.style.cssFloat="right";a.appendChild(f);q.appendChild(a);n.appendChild(q);l.appendChild(h);l.appendChild(n);h=document.createElement("fieldset");
k=document.createElement("legend");k.style.marginBottom="0px";k.style.lineHeight="16px";a=document.createElement("small");a.className="metadata";a.appendChild(document.createTextNode("Current number of zapped tweets"));k.appendChild(a);b=document.createElement("form");b.name="counterForm";a=document.createElement("span");a.id="zapper-counter-box";b.appendChild(a);f=document.createElement("input");f.type="checkbox";f.name="glow";f.id="zapper-glow-checkbox";f.checked=!t;a=document.createElement("li");
a.name="glowItem";a.title="Give zapped tweets a radioactive glow.";a.style.listStyleType="none";a.style.cssFloat="right";a.appendChild(document.createTextNode("Glow? "));a.appendChild(f);b.appendChild(a);h.appendChild(k);h.appendChild(b);f=document.createElement("fieldset");a=document.createElement("legend");a.style.marginBottom="0px";a.style.lineHeight="16px";k=document.createElement("small");k.className="metadata";k.appendChild(document.createTextNode("Enter @username to zap"));a.appendChild(k);
k=document.createElement("form");k.name="zapForm";b=document.createElement("input");b.id="zapper-zap-box";b.type="text";b.size="40";n=document.createElement("input");n.type="button";n.name="zapButton";n.id="zapper-zap-button";n.value="Zap";k.appendChild(b);k.appendChild(n);f.appendChild(a);f.appendChild(k);k=document.createElement("fieldset");b=document.createElement("legend");b.style.marginBottom="0px";b.style.lineHeight="16px";a=document.createElement("small");a.className="metadata";a.appendChild(document.createTextNode("Select @username to show"));
b.appendChild(a);n=document.createElement("form");n.name="showForm";q=document.createElement("select");q.id="zapper-show-select";p=document.createElement("input");p.type="button";p.name="showButton";p.id="zapper-show-button";p.value="Show";a=document.createElement("option");a.text="Show tweets by...";a.value="";q.appendChild(a);q.appendChild(r(0));q.appendChild(r(4));q.appendChild(r(3));q.appendChild(r(2));q.appendChild(r(1));n.appendChild(q);n.appendChild(p);k.appendChild(b);k.appendChild(n);e.appendChild(l);
e.appendChild(h);e.appendChild(f);e.appendChild(k);d.appendChild(g);d.appendChild(e);c.appendChild(d);return c};S=function(){var b,a,c;b=document.getElementById("zapper-show-select");if(a=b.options[b.selectedIndex].value.toLowerCase()){c=RegExp("\\b"+a+"\\b");0<g.length&&y(h(g.split("|"),a.split()).join("|"));for(b=1;b<=m&&!c.test(e["level"+b]);b++);b<=m?c.test(l)||(0<l.length?z((l+"|"+a).split("|").sort().join("|")):z(a)):0<l.length&&z(h(l.split("|"),a.split()).join("|"));v=B();p={};x=s=-1;E()}};
U=function(){var b,a,c;a=document.getElementById("zapper-zap-box").value.toLowerCase();a=a.replace(/^\s+|\s+$/g,"").replace(/^@/,"");if(/^\w{1,15}$/.test(a)){document.getElementById("zapper-zap-box").value="";c=RegExp("\\b"+a+"\\b");0<l.length&&z(h(l.split("|"),a.split()).join("|"));for(b=1;b<=m&&!c.test(e["level"+b]);b++);b<=m?0<g.length&&y(h(g.split("|"),a.split()).join("|")):c.test(g)?document.getElementById("zapper-zap-box").value="Error: Already zapped.":0<g.length?y((g+"|"+a).split("|").sort().join("|")):
y(a);v=B();p={};x=s=-1;E()}else document.getElementById("zapper-zap-box").value="Error: Not a valid @username."};H=function(){var b,a;a=document.forms.namedItem("levelForm").elements.namedItem("levelSelect");for(b=0;4>=b&&!a[b].checked;b++);4<b?a[m].checked="checked":b!==m&&(P(b),p={},x=-1,v=B(),E())};aa=function(){document.getElementById("zapper-glow-checkbox").checked=!t};$=function(b){Z(!b.checked);s=-1};C=function(){var b;if(b=document.getElementById("zapper-counter-box")){for(;b.hasChildNodes()&&
"glowItem"!==b.firstChild.name;)b.removeChild(b.firstChild);"paused"===u?b.insertBefore(document.createTextNode("Paused"),b.firstChild):b.insertBefore(document.createTextNode(w),b.firstChild)}};W=function(){var b;document.getElementById("zapper")||(b=V(),document.getElementsByClassName("dashboard")[0].insertBefore(b,document.getElementsByClassName("wtf-module")[0]),C(),H());x!==w&&(x=w,C());if(K!==window.location.href){K=window.location.href;b=document.getElementById("zapper-pause-button");switch(u){case "running":b.value=
String.fromCharCode(10073)+String.fromCharCode(10073);b.title="Pause Zapper";break;case "paused":b.value=String.fromCharCode(9658),b.title="Start Zapper"}C();H();E();aa()}};L=function(b){b.style.backgroundColor="rgb(190,255,120)";b.style.color="rgb(80,200,10)";/^a$/i.test(b.nodeName)?b.style.display="inline":b.style.display="block"};I=function(b,a){"none"!==b.style.display&&255>a?(b.style.backgroundColor="rgb("+Math.floor(255-a)+", 255, "+Math.floor(255-a)+")",b.style.color="rgb("+Math.floor(255-
a)+", 255, "+Math.floor(255-a)+")",a+=25,window.setTimeout(function(){I(b,a)},20)):b.style.display="none"};F=function(){var b,a,c,d;c=document.getElementsByClassName("js-actionable-tweet");if(J!==c.length||s!==m||D!==window.location.href){J=c.length;s=m;D=window.location.href;for(b=w=0;b<c.length;b++)if(d=c[b],(a=d.getAttribute("data-screen-name"))&&(a=a.toLowerCase()),a&&(p[a]||v.test(a)))p[a]=!0,w++,t?I(d,1):L(d);else if("none"===d.style.display||d.style.color)d.style.display="block",d.style.color=
"",d.style.backgroundColor="";if(-1!==D.search(/\/connect/i))for(c=document.getElementsByClassName("js-user-profile-link"),b=0;b<c.length;b++)if(d=c[b],/img/i.test(d.nodeName)&&(d=c[b].parentNode),(a=d.getAttribute("href"))&&(a=a.slice(1).toLowerCase()),a&&(p[a]||v.test(a)))t?I(d,1):L(d);else if("none"===d.style.display||d.style.color)d.style.display="inline",d.style.color="",d.style.backgroundColor="";if(-1!==D.search(/\/search/i)){c=document.getElementsByClassName("photo-list");if(0<c.length)for(b=
0;b<c.length;b++)c[b].style.display="none";c=document.getElementsByClassName("js-story-item");0<c.length&&(c[0].style.display="none")}}};ca=function(b){"running"===u?(M("paused"),window.clearInterval(N),b.title="Start Zapper",b.value=String.fromCharCode(9658)):(M("running"),s=-1,F(),b.title="Pause Zapper",b.value=String.fromCharCode(10073)+String.fromCharCode(10073),N=window.setInterval(function(){F()},1E3));C()};X=function(b){if(b)switch(b.target.name){case "levelSelect":H();break;case "showButton":S();
break;case "zapButton":U();break;case "pause":ca(b.target);break;case "glow":$(b.target)}};G=function(b){var a;localStorage.zapper_version||(localStorage.zapper_version="",localStorage.myShows&&(/^#(,\w+)*$/.test(localStorage.myShows)?localStorage.zapper_myShows=localStorage.myShows.split(",").slice(1).join("|"):localStorage.zapper_myShows=localStorage.myShows),delete localStorage.myShows,localStorage.myZaps&&(/^#(,\w+)*$/.test(localStorage.myZaps)?localStorage.zapper_myZaps=localStorage.myZaps.split(",").slice(1).join("|"):
localStorage.zapper_myZaps=localStorage.myZaps),delete localStorage.myZaps,localStorage.lastZapListUpdateTime&&(localStorage.zapper_lastZapListUpdateTime=localStorage.lastZapListUpdateTime),delete localStorage.lastZapListUpdateTime,localStorage.zapperNoGlowState&&(localStorage.zapper_noGlowState=localStorage.zapperNoGlowState),delete localStorage.zapperNoGlowState,localStorage.zapperState&&(localStorage.zapper_state=localStorage.zapperState),delete localStorage.zapperState,localStorage.zapLevel&&
/^1|2|3|4$/.test(localStorage.zapLevel)&&(localStorage.zapper_zapLevel=localStorage.zapLevel),delete localStorage.zapLevel,localStorage.zapListLevel1&&(localStorage.zapper_zapListLevel1=localStorage.zapListLevel1),delete localStorage.zapListLevel1,localStorage.zapListLevel2&&(localStorage.zapper_zapListLevel2=localStorage.zapListLevel2),delete localStorage.zapListLevel2,localStorage.zapListLevel3&&(localStorage.zapper_zapListLevel3=localStorage.zapListLevel3),delete localStorage.zapListLevel3);/^1\.2\.1$/.test(localStorage.zapper_version)||
(localStorage.zapper_version="1.2.1");p={};e={};e=T();l=R();g=Q();m=s=O();w=0;x=-1;J=0;u=ba();t=Y();K=D=window.location.href;if(b&&b.responseText&&200===b.status){b=b.responseText.split(",");e.level1=[];e.level2=[];e.level3=[];e.level4=[];for(a=0;a<b.length;a+=2)b[a]&&/^\w{1,15}$/.test(b[a])&&b[a+1]&&/^(1|2|3|4)$/.test(b[a+1])&&e["level"+b[a+1]].push(b[a]);A(e.level1.sort().join("|"),1);A(e.level2.sort().join("|"),2);A(e.level3.sort().join("|"),3);A(e.level4.sort().join("|"),4)}v=B();"running"===
u&&(F(),N=window.setInterval(function(){F()},1E3));window.setInterval(function(){W()},1E3);document.body.addEventListener("click",X,!1)};return{go:function(){!localStorage.zapper_zapListLevel1||!localStorage.zapper_lastZapListUpdateTime||9E5<Date.now()-localStorage.zapper_lastZapListUpdateTime?(localStorage.zapper_lastZapListUpdateTime=Date.now(),GM_xmlhttpRequest({method:"GET",url:"http://theblockbot.com/sign_up/followthefollowers/blocks.csv",timeout:1E3,onload:G,ontimeout:G})):G()}}}();zapper.go();