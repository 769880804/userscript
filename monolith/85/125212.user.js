// ==UserScript==
// @author         Skydestroyer
// @name           eRepublik Hits calc
// @description    counts hits needed
// @version        1.0
// @include        http://www.erepublik.com/*
// @include        http://economy.erepublik.com/*
// @include        http://static.erepublik.com/*
// @require        http://sizzlemctwizzle.com/updater.php?id=80226&days=1&show
// @require        https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js
// @require        http://jquery-json.googlecode.com/files/jquery.json-2.2.min.js
// @require        https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.11/jquery-ui.min.js
// @require        http://www.bramstein.com/projects/text-overflow/jquery.text-overflow.min.js
// ==/UserScript==
// ===============================================================================
function improveBattlefield(){if(!1!=eRAopt.battlefield){var a=document.createElement("script");a.type="text/javascript";a.text="function globalTick() { }";document.getElementsByTagName("head")[0].appendChild(a);var b=parseFloat($(".eday strong").html().replace(/,/gi,"")),a=id_country[fixString2(citizenMain)];readSettings("influence");readSettings("natural");if(void 0==eRAinflu[b]||"NaN"==eRAinflu[b].Influence)eRAinflu[b]={},eRAinflu[b].Hits=0,eRAinflu[b].Kills=0,eRAinflu[b].Influence=0,eRAinflu[b].Rank=
0,writeSettings(era.characterId+".Influence",eRAinflu);var c=$("#pvp_header h2:eq(0)").text(),d=findElement(c.replace(/\./gi,""),region_link);$("#pvp_header h2:eq(0)").replaceWith('<a class="regionLink" title="'+d+'" href="http://www.erepublik.com/'+era.hostLang+"/region/"+region_link[d]+'" target="_blank"><h2 style="color: #3C8FA7 !important;">'+c+"</h2></a>");c=$('div[class*="country left_side"] h3').html();d=$('div[class*="country right_side"] h3').html();-1==c.indexOf("Resistance")&&-1==d.indexOf("Resistance")&&
c==a&&d==eRAne.Enemy&&$('div[class*="country right_side"] a img').after('<img alt="" title="Natural enemy" src="'+neIcon+'" style="margin-top: -2px; position: absolute; margin-left: -9px;">');$("#blue_domination").css("opacity","0");$("#red_domination").css("opacity","0");$(".progress").each(function(){$(this).css({"text-align":"center",overflow:"visible"})});$("#player_loss").css("top","-25px");$("#enemy_loss").css("top","-25px");if($("#player_life").length){var g=$("#player_life").attr("title").split(" ")[2],
a=mathRound(parseFloat($("#pvp_battle_area .player.left_side .info #fighter_skill").text().replace(/,/gi,"")),0).toFixed(0),c=mathRound(parseFloat($("#pvp_battle_area .player.right_side .info #enemy_skill").text().replace(/,/gi,"")),0).toFixed(0),d=20*parseFloat($("#scroller div span img").attr("src").split("/")[5].split("_q")[1].split(".")[0]),j=20*parseFloat($("#enemy_weapon").attr("src").split("/")[5].split("_q")[1].split(".")[0]),l=0==$("#enemy_life").attr("title").split(" ")[2].length?$("#enemy_life").attr("original-title").split(" ")[2]:
$("#enemy_life").attr("title").split(" ")[2];$("#player_life").after('<div id="playerHealth" class="battleHealth">'+parseFloat(g).toFixed(2)+"</div>");$("#enemy_life").after('<div id="enemyHealth" class="battleHealth">'+parseFloat(l).toFixed(2)+"</div>");a=Math.ceil(parseFloat(l)/Math.round((60+(a-c)/10)*(1+(d-j)/400)/2));$("#pvp_battle_area .player.right_side").prepend('<div class="hitsNeededHolder"><div class="hitsNeededTitle">Hits needed</div><div id="hitsNeeded" class="hitsNeededNumber">'+a+"</div></div>");
$("#player_life, #enemy_life").attrChange(function(){g=void 0!=$("#player_life").attr("original-title")?$("#player_life").attr("original-title").split(" ")[2]:$("#player_life").attr("title").split(" ")[2];l=void 0!=$("#enemy_life").attr("original-title")?$("#enemy_life").attr("original-title").split(" ")[2]:$("#enemy_life").attr("title").split(" ")[2];$("#playerHealth").animate({opacity:"0"},"fast").text(parseFloat(g).toFixed(2)).animate({opacity:"1"},"fast");$("#enemyHealth").animate({opacity:"0"},
"fast").text(parseFloat(l).toFixed(2)).animate({opacity:"1"},"fast")})}setTimeout(function(){$(".domibar").prepend('<strong id="blue_domination_f" class="left_side"></strong><strong id="red_domination_f" class="right_side"></strong>');exactDomination=parseFloat($(".domibar").css("background-position"));$("#blue_domination_f").text(mathRound(100-exactDomination,2).toFixed(2)+"%");$("#red_domination_f").text(mathRound(exactDomination,2).toFixed(2)+"%");$("#blue_domination_f").css("opacity","0").animate({opacity:"1"},
"fast");$("#red_domination_f").css("opacity","0").animate({opacity:"1"},"fast")},1E3);$(".domibar").cssChange(function(){exactDomination=parseFloat($(".domibar").css("background-position"));$("#blue_domination_f").text(mathRound(100-exactDomination,2).toFixed(2)+"%");$("#red_domination_f").text(mathRound(exactDomination,2).toFixed(2)+"%")});$("#collection_complete").after('<div id="era_influence" style="display: none;"></div>');loadInfluScript();$("#era_influence").contentChange(function(){readSettings("influence");
var a=parseInt($("#era_influence").html().split("|")[0]),c=parseInt($("#era_influence").html().split("|")[1]),d=parseInt($("#era_influence").html().split("|")[2]);eRAinflu[b].Hits=parseFloat(eRAinflu[b].Hits)+c+"";eRAinflu[b].Kills=parseFloat(eRAinflu[b].Kills)+1+"";eRAinflu[b].Influence=parseFloat(eRAinflu[b].Influence)+a+"";eRAinflu[b].Rank=parseFloat(eRAinflu[b].Rank)+d+"";writeSettings(era.characterId+".Influence",eRAinflu);updateDailyTracker()})}}
function influScript(){$=window.jQuery;$("#add_damage_btn").ajaxSuccess(function(a,b,c){if(null!=c.url.match(/ht-sh/gi))if(null!=b.responseText.match(/my_ki/gi)){var d=$.parseJSON(b.responseText),a=parseFloat(d.user.skill),b=parseFloat(d.user.weaponDamage),c=parseFloat(d.enemy.health),g=parseFloat(d.enemy.skill.replace(",","")),j=parseFloat(d.enemy.damage),l=d.user.givenDamage,q=d.user.earnedXp,d=d.user.earnedRankPoints;$("#era_influence").html(l+"|"+q+"|"+d+"|"+Math.random());a=Math.ceil(c/Math.round((60+
(a-g)/10)*(1+(b-j)/400)/2));$("#hitsNeeded").html(a)}else null!=b.responseText.match(/my_at/gi)&&(j=$.parseJSON(b.responseText),a=parseFloat(j.user.skill),b=parseFloat(j.user.weaponDamage),c=parseFloat(j.enemy.health),g=parseFloat(j.enemy.skill.replace(",","")),j=parseFloat(j.enemy.damage),a=Math.ceil(c/Math.round((60+(a-g)/10)*(1+(b-j)/400)/2)),$("#hitsNeeded").html(a))})}
function loadInfluScript(){if(!document.getElementById("eRACatchInfluScript")){var a=document.getElementsByTagName("head")[0];script=document.createElement("script");script.id="eRACatchInfluScript";script.type="text/javascript";script.appendChild(document.createTextNode("("+influScript+")();"));a.appendChild(script)}}
function prepareInventory(){document.countries=[];$("#market_licenses_select .ml_repeat li").each(function(){var a=$(this).find("img").attr("src").split("/")[6].split(".")[0];document.countries.push(a)});getInvExchange();betterInventory()}
