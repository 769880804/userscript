// ==UserScript==
// @id             Drag Search Script
// @name           Search Images By Drag
// @version        0.01
// @namespace      dragSearch
// @author         Herrington Darkholme
// @description    Use your mouse gesture to initiate image search. Right click on images while pressing down ctrl
// @include        /https?:.*/
// @run-at         document-end
// ==/UserScript==

function addClass(a,b){var c=a.className.split(" ");-1===c.indexOf(b)?c.push(b):null,a.className=c.join(" ")}function hasClass(a,b){return-1!==a.className.split(" ").indexOf(b)}function removeClass(a,b){var c;hasClass(a,b)&&(c=a.className.split(" "),c.splice(c.indexOf(b),1),a.className=c.join(" "))}function removeAllSpanClass(a){for(var b in spans)spans.hasOwnProperty(b)&&removeClass(spans[b],a)}function grabSearch(a){x=a.pageX,y=a.pageY,url=this.src,3===a.which&&a.ctrlKey&&(isSearch=!0,document.body.oncontextmenu=function(){return!1},drag_container.style.top=y-50+"px",drag_container.style.left=x-50+"px",drag_container.style.display="block")}function activateButton(a){var b;isSearch?(deltaX=a.pageX-x,deltaY=a.pageY-y,absDeltaX=Math.abs(deltaX),absDeltaY=Math.abs(deltaY),absDeltaX+absDeltaY>50?(b=absDeltaX>absDeltaY?deltaX>0?"sauce":"iqdb":0>deltaY?"goo":"bg",absDeltaX+absDeltaY>250?hasClass(spans[b],"_drag_remote")||(removeAllSpanClass("_drag_remote"),addClass(spans[b],"_drag_remote")):removeAllSpanClass("_drag_remote"),hasClass(spans[b],"_drag_active")||(removeAllSpanClass("_drag_active"),addClass(spans[b],"_drag_active"))):removeAllSpanClass("_drag_active")):document.body.oncontextmenu=function(){return!0}}function search(a){var b,c={};if(isSearch)if(deltaX=a.pageX-x,deltaY=a.pageY-y,absDeltaX=Math.abs(deltaX),absDeltaY=Math.abs(deltaY),absDeltaX+absDeltaY>50){switch(a.stopPropagation(),a.preventDefault(),isSearch=!1,removeAllSpanClass("_drag_active"),drag_container.style.display="none",b=absDeltaX>absDeltaY?deltaX>0?"saucenao":"iqdb":0>deltaY?"google":"google-background",251>absDeltaX+absDeltaY&&(c.active=!1),b){case"saucenao":c.url="http://saucenao.com/search.php?db=999&url="+encodeURIComponent(url);break;case"iqdb":c.url="http://iqdb.org/?url="+encodeURIComponent(url);break;case"google":c.url="http://www.google.com/searchbyimage?sbisrc=cr_1_3_2&image_url="+encodeURIComponent(url);break;default:/https{0,1}:\/\/lh\d\.googleusercontent\.com/.test(url)&&(url=url.split("/"),url[url.length-2]="s0",url=url.join("/")),c.url=url}window.open(c.url)}else drag_container.style.display="none",isSearch=!1,document.body.oncontextmenu=function(){return!0}}var css=document.createElement("style");css.type="text/css",css.innerHTML='# drag_container_UNIQUE {position: absolute!important;display: none;}# drag_container_UNIQUE._drag_button {width: 50px!important;height: 50px!important;border - left: 1px solid # c9c9c9;border - bottom: 1px solid # c9c9c9;background - image: radial - gradient(circle at left bottom, rgba(200, 205, 210, 0.8), # c9c9c9);position: absolute!important;border - radius: 5px 50px 5px 0!important;z - index: 9998!important; - webkit - transition: all ease.1s;box - shadow: inset 0 1px 5px 0 rgba(0, 0, 0, 0.2),inset 0 1px 2px 0 rgba(255, 255, 255, 0.8),0 1px 20px 0 rgba(0, 0, 0, 0.3);}# drag_container_UNIQUE p {position: absolute!important;color: #333!important;text-shadow: # fff 0 1px 5px!important;z - index: 9999!important;font - size: 16px!important;margin: 0!important;padding: 0!important;word -break: normal!important;white - space: nowrap!important; - webkit - transition: all ease.1s;font - family: "Segoe UI Light",Tahoma,arial,sans - serif!IMPORTANT;}div._drag_goo {-webkit - transform: rotate(-45deg)!important;transform: rotate(-45deg)!important;top: -6px!important;left: 32px!important;}p._drag_goo {left: 42px!important;top: 10px!important;}div._drag_sauce {-webkit - transform: rotate(45deg)!important;transform: rotate(45deg)!important;top: 31px!important;left: 70px!important;}p._drag_sauce {left: 75px!important;top: 45px!important;}div._drag_iqdb {-webkit - transform: rotate(225deg)!important;transform: rotate(225deg)!important;top: 32px!important;left: -6px!important;}p._drag_iqdb {top: 45px!important;left: 10px!important;}div._drag_bg {-webkit - transform: rotate(135deg)!important;transform: rotate(135deg)!important;top: 68px!important;left: 32px!important;}p._drag_bg {left: 42px!important;top: 78px!important;}# drag_container_UNIQUE > ._drag_active > div._drag_button {background - image: radial - gradient(circle at left bottom, rgba(200, 205, 210, 0.8), rgba(11, 158, 251, 0.8))!important; - webkit - transition: all ease.1s;}# drag_container_UNIQUE > ._drag_active._drag_remote > div._drag_button {background - image: radial - gradient(circle at left bottom, rgba(200, 205, 210, 0.8), rgba(0, 188, 0, 0.9))!important; - webkit - transition: all ease.1s;}._drag_active > p {text - shadow: # fff 0 2px 5px!important; - webkit - transition: all ease.1s;}',document.body.appendChild(css);var drag_container=document.createElement("div");drag_container.id="drag_container_UNIQUE",drag_container.innerHTML='<span> <p class="_drag_goo">goo</p> <div class="_drag_button _drag_goo"></div> </span> <span> <p class="_drag_sauce">sau</p> <div class="_drag_button _drag_sauce"></div> </span> <span> <p class="_drag_iqdb">iqdb</p> <div class="_drag_button _drag_iqdb"></div> </span> <span> <p class="_drag_bg">back</p> <div class="_drag_button _drag_bg"></div> </span>';for(var spanNames=["goo","sauce","iqdb","bg"],spans={},spanEnitities=drag_container.getElementsByTagName("span"),i=0;4>i;i++)spans[spanNames[i]]=spanEnitities[i];spanNames=spanEnitities=null,document.body.appendChild(drag_container);var x,y,url,deltaX,deltaY,isSearch=!1;document.body.addEventListener("mousedown",function(a){"IMG"===a.target.tagName&&grabSearch.call(a.target,a)}),document.body.addEventListener("mousemove",activateButton),document.body.addEventListener("mouseup",search);