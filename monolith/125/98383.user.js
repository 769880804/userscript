// ==UserScript==
// @name        MachineCodes
// @namespace   http://www.blah.com/
// @description Translate selected text from binary, hex, or octal to strings.
// @version 0.1 - 2010-09-19
// @include *
// ==/UserScript==
var infoBox=document.createElement("div");infoBox.setAttribute("id","machinecodes_infobox");infoBox.setAttribute("style","display: none; z-index: 1000; font-size: 8pt; font-family: Verdana,sans-serif; text-decoration: none; line-height: 1.1em; position: fixed; top: 0px; right: 0px; width: 300px; background: white; border-left: solid 1px #555; border-bottom: solid 1px #555; color: #222; text-align: center; padding: 3px;");document.body.appendChild(infoBox);
var translateOct=function(a){matched=a.match(/(?:0[0-7]{3})+/i);if(null!=matched&&matched[0].length==a.length)a=a.replace(/0([0-7]{3})/g,"$1");for(var b=[],c=0,f=[],d=0,e=0;e<a.length;e++){f[d++]=a[e];if((e+1)%3==0){b[c++]=String.fromCharCode(parseInt(f.join(""),8));f=[];d=0}}return b.join("")},translateHex=function(a){a=a.replace(/0x|:/g,"");for(var b=[],c=0,f=[],d=0,e=0;e<a.length;e++){f[d++]=a[e];if((e+1)%2==0){b[c++]=String.fromCharCode(parseInt(f.join(""),16));f=[];d=0}}return b.join("")},translateBin=
function(a){for(var b=[],c=0,f=[],d=0,e=0;e<a.length;e++){f[d++]=a[e];if((e+1)%8==0){b[c++]=String.fromCharCode(parseInt(f.join(""),2));f=[];d=0}}return b.join("")},identifySystem=function(a){var b=a.match(/(?:0x[0-9a-f]{2})+/i);if(b&&b[0].length==a.length)return"hex";b=a.match(/(?:[01]{8})+/);if(null!=b&&b[0].length==a.length)return"bin";if(a.length%3==0&&a.length%2!=0)return a.search(/[^0-7]/i)>=0?"invalid":"oct";b=a.match(/(?:[0-9a-f]{2}:)+[0-9a-f]{2}/i);if(null!=b&&b[0].length==a.length)return"hex";
b=a.match(/(?:0[0-7]{3})+/i);if(null!=b&&b[0].length==a.length)return"oct";if((b=a.match(/(?:[0-9a-f])+/i))&&b[0].length==a.length)if(a.search(/[8-9a-f]/i)>=0)return"hex";else{for(var c=[],f=0,d=b=0;d<a.length;d++){c[f++]=a[d];if((d+1)%2==0){c=parseInt(c.join(""),16);if(c>=65&&c<=90||c>=97&&c<=122)b++;c=[];f=0}}var e=0;for(d=0;d<a.length;d++){c[f++]=a[d];if((d+1)%3==0){c=parseInt(c.join(""),8);if(c>=65&&c<=90||c>=97&&c<=122)e++;c=[];f=0}}return e>b?"oct":"hex"}return"invalid"},selectionEvent=function(){if(infoBox){var a=
window.getSelection();if(a>""){a=String(a);a=a.replace(/\s+/g,"").replace(/"/g,"'").replace(/>/g,"&gt").replace(/</g,"&lt");var b=identifySystem(a);a=b=="oct"?translateOct(a):b=="hex"?translateHex(a):b=="bin"?translateBin(a):"";if(a.length<=0)infoBox.style.display="none";else{b=infoBox.childNodes;for(i in b)b[i].nodeType&&infoBox.removeChild(b[i]);a=document.createTextNode(a);infoBox.appendChild(a);infoBox.style.display="block"}}else infoBox.style.display="none"}else{clearInterval(window.intervalEvent);
document.removeEventListener("mouseup",window.selectionEvent,false)}};document.addEventListener("mouseup",selectionEvent,false);window.intervalEvent=setInterval(selectionEvent,2E3);
