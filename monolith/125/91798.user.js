{\rtf1\adeflang1025\ansi\ansicpg1252\uc1\adeff0\deff0\stshfdbch0\stshfloch0\stshfhich0\stshfbi0\deflang1033\deflangfe1033\themelang1033\themelangfe0\themelangcs0{\fonttbl{\f0\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\f1\fbidi \fswiss\fcharset0\fprq2{\*\panose 020b0604020202020204}Arial;}
{\f2\fbidi \fmodern\fcharset0\fprq1{\*\panose 02070309020205020404}Courier New;}{\f3\fbidi \froman\fcharset2\fprq2{\*\panose 05050102010706020507}Symbol;}{\f4\fbidi \fswiss\fcharset0\fprq2{\*\panose 020b0604020202020204}Helvetica;}
{\f5\fbidi \fmodern\fcharset0\fprq1{\*\panose 02070409020205020404}Courier;}{\f6\fbidi \froman\fcharset0\fprq2{\*\panose 02020603040505020304}Tms Rmn;}{\f7\fbidi \fswiss\fcharset0\fprq2{\*\panose 020b0604020202030204}Helv;}
{\f8\fbidi \froman\fcharset0\fprq2{\*\panose 02040503060506020304}New York;}{\f9\fbidi \fswiss\fcharset0\fprq2{\*\panose 00000000000000000000}System;}{\f10\fbidi \fnil\fcharset2\fprq2{\*\panose 05000000000000000000}Wingdings;}
{\f11\fbidi \fmodern\fcharset128\fprq1{\*\panose 02020609040205080304}MS Mincho{\*\falt ?l?r ??\'81\'66c};}{\f12\fbidi \froman\fcharset129\fprq2{\*\panose 02030600000101010101}Batang{\*\falt \'a9\'f6UAA};}
{\f13\fbidi \fnil\fcharset134\fprq2{\*\panose 02010600030101010101}SimSun{\*\falt ??\'a8\'ac?};}{\f14\fbidi \froman\fcharset136\fprq2{\*\panose 02020500000000000000}PMingLiU{\*\falt \'a1\'50s2OcuAe};}
{\f15\fbidi \fmodern\fcharset128\fprq1{\*\panose 020b0609070205080204}MS Gothic{\*\falt ?l?r ?S?V?b?N};}{\f16\fbidi \fswiss\fcharset129\fprq2{\*\panose 020b0600000101010101}Dotum{\*\falt \'a5\'ec\'a2\'ac\'a2\'afo};}
{\f17\fbidi \fmodern\fcharset134\fprq1{\*\panose 02010609060101010101}SimHei{\*\falt o\'a8\'b2\'a8\'ac?};}{\f18\fbidi \fmodern\fcharset136\fprq1{\*\panose 02020509000000000000}MingLiU{\*\falt 2OcuAe};}
{\f19\fbidi \froman\fcharset128\fprq1{\*\panose 02020609040305080305}Mincho{\*\falt ??\'81\'66c};}{\f20\fbidi \fswiss\fcharset129\fprq2{\*\panose 020b0600000101010101}Gulim{\*\falt \'a1\'be\'a8\'f9\'a2\'ac\'a9\'f7};}
{\f21\fbidi \froman\fcharset0\fprq2{\*\panose 02040604050505020304}Century;}{\f22\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Angsana New;}{\f23\fbidi \fswiss\fcharset0\fprq2{\*\panose 020b0304020202020204}Cordia New;}
{\f24\fbidi \froman\fcharset0\fprq2{\*\panose 02040503050203030202}Mangal;}{\f25\fbidi \fswiss\fcharset0\fprq2{\*\panose 020b0604020202020204}Latha;}{\f26\fbidi \froman\fcharset0\fprq2{\*\panose 010a0502050306030303}Sylfaen;}
{\f27\fbidi \fswiss\fcharset0\fprq2{\*\panose 01010600010101010101}Vrinda;}{\f28\fbidi \fswiss\fcharset0\fprq2{\*\panose 02000500000000000000}Raavi;}{\f29\fbidi \fswiss\fcharset0\fprq2{\*\panose 020b0604020202020204}Shruti;}
{\f30\fbidi \froman\fcharset1\fprq2{\*\panose 00000400000000000000}Sendnya;}{\f31\fbidi \fswiss\fcharset0\fprq2{\*\panose 02000500000000000000}Gautami;}{\f32\fbidi \fswiss\fcharset0\fprq2{\*\panose 00000400000000000000}Tunga;}
{\f33\fbidi \froman\fcharset1\fprq2{\*\panose 03080600000000000000}Estrangelo Edessa;}{\f34\fbidi \froman\fcharset1\fprq2{\*\panose 02040503050406030204}Cambria Math;}{\f35\fbidi \fswiss\fcharset128\fprq2{\*\panose 020b0604020202020204}Arial Unicode MS;}
{\f36\fbidi \froman\fcharset0\fprq2{\*\panose 02040503050406030204}Cambria;}{\f37\fbidi \fswiss\fcharset0\fprq2{\*\panose 020f0502020204030204}Calibri;}{\f38\fbidi \fswiss\fcharset0\fprq2{\*\panose 020b0604030504040204}Tahoma;}
{\f39\fbidi \froman\fcharset0\fprq2{\*\panose 00000000000000000000}Estrangella Edessa;}{\flomajor\f31500\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}
{\fdbmajor\f31501\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\fhimajor\f31502\fbidi \froman\fcharset0\fprq2{\*\panose 02040503050406030204}Cambria;}
{\fbimajor\f31503\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\flominor\f31504\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}
{\fdbminor\f31505\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\fhiminor\f31506\fbidi \fswiss\fcharset0\fprq2{\*\panose 020f0502020204030204}Calibri;}
{\fbiminor\f31507\fbidi \froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\f40\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\f41\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}
{\f43\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}{\f44\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\f45\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\f46\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}
{\f47\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\f48\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}{\f50\fbidi \fswiss\fcharset238\fprq2 Arial CE;}{\f51\fbidi \fswiss\fcharset204\fprq2 Arial Cyr;}
{\f53\fbidi \fswiss\fcharset161\fprq2 Arial Greek;}{\f54\fbidi \fswiss\fcharset162\fprq2 Arial Tur;}{\f55\fbidi \fswiss\fcharset177\fprq2 Arial (Hebrew);}{\f56\fbidi \fswiss\fcharset178\fprq2 Arial (Arabic);}
{\f57\fbidi \fswiss\fcharset186\fprq2 Arial Baltic;}{\f58\fbidi \fswiss\fcharset163\fprq2 Arial (Vietnamese);}{\f60\fbidi \fmodern\fcharset238\fprq1 Courier New CE;}{\f61\fbidi \fmodern\fcharset204\fprq1 Courier New Cyr;}
{\f63\fbidi \fmodern\fcharset161\fprq1 Courier New Greek;}{\f64\fbidi \fmodern\fcharset162\fprq1 Courier New Tur;}{\f65\fbidi \fmodern\fcharset177\fprq1 Courier New (Hebrew);}{\f66\fbidi \fmodern\fcharset178\fprq1 Courier New (Arabic);}
{\f67\fbidi \fmodern\fcharset186\fprq1 Courier New Baltic;}{\f68\fbidi \fmodern\fcharset163\fprq1 Courier New (Vietnamese);}{\f80\fbidi \fswiss\fcharset238\fprq2 Helvetica CE;}{\f81\fbidi \fswiss\fcharset204\fprq2 Helvetica Cyr;}
{\f83\fbidi \fswiss\fcharset161\fprq2 Helvetica Greek;}{\f84\fbidi \fswiss\fcharset162\fprq2 Helvetica Tur;}{\f85\fbidi \fswiss\fcharset177\fprq2 Helvetica (Hebrew);}{\f86\fbidi \fswiss\fcharset178\fprq2 Helvetica (Arabic);}
{\f87\fbidi \fswiss\fcharset186\fprq2 Helvetica Baltic;}{\f88\fbidi \fswiss\fcharset163\fprq2 Helvetica (Vietnamese);}{\f152\fbidi \fmodern\fcharset0\fprq1 MS Mincho Western{\*\falt ?l?r ??\'81\'66c};}
{\f150\fbidi \fmodern\fcharset238\fprq1 MS Mincho CE{\*\falt ?l?r ??\'81\'66c};}{\f151\fbidi \fmodern\fcharset204\fprq1 MS Mincho Cyr{\*\falt ?l?r ??\'81\'66c};}{\f153\fbidi \fmodern\fcharset161\fprq1 MS Mincho Greek{\*\falt ?l?r ??\'81\'66c};}
{\f154\fbidi \fmodern\fcharset162\fprq1 MS Mincho Tur{\*\falt ?l?r ??\'81\'66c};}{\f157\fbidi \fmodern\fcharset186\fprq1 MS Mincho Baltic{\*\falt ?l?r ??\'81\'66c};}{\f162\fbidi \froman\fcharset0\fprq2 Batang Western{\*\falt \'a9\'f6UAA};}
{\f160\fbidi \froman\fcharset238\fprq2 Batang CE{\*\falt \'a9\'f6UAA};}{\f161\fbidi \froman\fcharset204\fprq2 Batang Cyr{\*\falt \'a9\'f6UAA};}{\f163\fbidi \froman\fcharset161\fprq2 Batang Greek{\*\falt \'a9\'f6UAA};}
{\f164\fbidi \froman\fcharset162\fprq2 Batang Tur{\*\falt \'a9\'f6UAA};}{\f167\fbidi \froman\fcharset186\fprq2 Batang Baltic{\*\falt \'a9\'f6UAA};}{\f172\fbidi \fnil\fcharset0\fprq2 SimSun Western{\*\falt ??\'a8\'ac?};}
{\f182\fbidi \froman\fcharset0\fprq2 PMingLiU Western{\*\falt \'a1\'50s2OcuAe};}{\f192\fbidi \fmodern\fcharset0\fprq1 MS Gothic Western{\*\falt ?l?r ?S?V?b?N};}{\f190\fbidi \fmodern\fcharset238\fprq1 MS Gothic CE{\*\falt ?l?r ?S?V?b?N};}
{\f191\fbidi \fmodern\fcharset204\fprq1 MS Gothic Cyr{\*\falt ?l?r ?S?V?b?N};}{\f193\fbidi \fmodern\fcharset161\fprq1 MS Gothic Greek{\*\falt ?l?r ?S?V?b?N};}{\f194\fbidi \fmodern\fcharset162\fprq1 MS Gothic Tur{\*\falt ?l?r ?S?V?b?N};}
{\f197\fbidi \fmodern\fcharset186\fprq1 MS Gothic Baltic{\*\falt ?l?r ?S?V?b?N};}{\f202\fbidi \fswiss\fcharset0\fprq2 Dotum Western{\*\falt \'a5\'ec\'a2\'ac\'a2\'afo};}{\f200\fbidi \fswiss\fcharset238\fprq2 Dotum CE{\*\falt \'a5\'ec\'a2\'ac\'a2\'afo};}
{\f201\fbidi \fswiss\fcharset204\fprq2 Dotum Cyr{\*\falt \'a5\'ec\'a2\'ac\'a2\'afo};}{\f203\fbidi \fswiss\fcharset161\fprq2 Dotum Greek{\*\falt \'a5\'ec\'a2\'ac\'a2\'afo};}
{\f204\fbidi \fswiss\fcharset162\fprq2 Dotum Tur{\*\falt \'a5\'ec\'a2\'ac\'a2\'afo};}{\f207\fbidi \fswiss\fcharset186\fprq2 Dotum Baltic{\*\falt \'a5\'ec\'a2\'ac\'a2\'afo};}{\f212\fbidi \fmodern\fcharset0\fprq1 SimHei Western{\*\falt o\'a8\'b2\'a8\'ac?};}
{\f222\fbidi \fmodern\fcharset0\fprq1 MingLiU Western{\*\falt 2OcuAe};}{\f242\fbidi \fswiss\fcharset0\fprq2 Gulim Western{\*\falt \'a1\'be\'a8\'f9\'a2\'ac\'a9\'f7};}
{\f240\fbidi \fswiss\fcharset238\fprq2 Gulim CE{\*\falt \'a1\'be\'a8\'f9\'a2\'ac\'a9\'f7};}{\f241\fbidi \fswiss\fcharset204\fprq2 Gulim Cyr{\*\falt \'a1\'be\'a8\'f9\'a2\'ac\'a9\'f7};}
{\f243\fbidi \fswiss\fcharset161\fprq2 Gulim Greek{\*\falt \'a1\'be\'a8\'f9\'a2\'ac\'a9\'f7};}{\f244\fbidi \fswiss\fcharset162\fprq2 Gulim Tur{\*\falt \'a1\'be\'a8\'f9\'a2\'ac\'a9\'f7};}
{\f247\fbidi \fswiss\fcharset186\fprq2 Gulim Baltic{\*\falt \'a1\'be\'a8\'f9\'a2\'ac\'a9\'f7};}{\f250\fbidi \froman\fcharset238\fprq2 Century CE;}{\f251\fbidi \froman\fcharset204\fprq2 Century Cyr;}{\f253\fbidi \froman\fcharset161\fprq2 Century Greek;}
{\f254\fbidi \froman\fcharset162\fprq2 Century Tur;}{\f257\fbidi \froman\fcharset186\fprq2 Century Baltic;}{\f269\fbidi \froman\fcharset222\fprq2 Angsana New (Thai);}{\f279\fbidi \fswiss\fcharset222\fprq2 Cordia New (Thai);}
{\f300\fbidi \froman\fcharset238\fprq2 Sylfaen CE;}{\f301\fbidi \froman\fcharset204\fprq2 Sylfaen Cyr;}{\f303\fbidi \froman\fcharset161\fprq2 Sylfaen Greek;}{\f304\fbidi \froman\fcharset162\fprq2 Sylfaen Tur;}
{\f307\fbidi \froman\fcharset186\fprq2 Sylfaen Baltic;}{\f392\fbidi \fswiss\fcharset0\fprq2 Arial Unicode MS Western;}{\f390\fbidi \fswiss\fcharset238\fprq2 Arial Unicode MS CE;}{\f391\fbidi \fswiss\fcharset204\fprq2 Arial Unicode MS Cyr;}
{\f393\fbidi \fswiss\fcharset161\fprq2 Arial Unicode MS Greek;}{\f394\fbidi \fswiss\fcharset162\fprq2 Arial Unicode MS Tur;}{\f395\fbidi \fswiss\fcharset177\fprq2 Arial Unicode MS (Hebrew);}
{\f396\fbidi \fswiss\fcharset178\fprq2 Arial Unicode MS (Arabic);}{\f397\fbidi \fswiss\fcharset186\fprq2 Arial Unicode MS Baltic;}{\f398\fbidi \fswiss\fcharset163\fprq2 Arial Unicode MS (Vietnamese);}
{\f399\fbidi \fswiss\fcharset222\fprq2 Arial Unicode MS (Thai);}{\f400\fbidi \froman\fcharset238\fprq2 Cambria CE;}{\f401\fbidi \froman\fcharset204\fprq2 Cambria Cyr;}{\f403\fbidi \froman\fcharset161\fprq2 Cambria Greek;}
{\f404\fbidi \froman\fcharset162\fprq2 Cambria Tur;}{\f407\fbidi \froman\fcharset186\fprq2 Cambria Baltic;}{\f408\fbidi \froman\fcharset163\fprq2 Cambria (Vietnamese);}{\f410\fbidi \fswiss\fcharset238\fprq2 Calibri CE;}
{\f411\fbidi \fswiss\fcharset204\fprq2 Calibri Cyr;}{\f413\fbidi \fswiss\fcharset161\fprq2 Calibri Greek;}{\f414\fbidi \fswiss\fcharset162\fprq2 Calibri Tur;}{\f417\fbidi \fswiss\fcharset186\fprq2 Calibri Baltic;}
{\f418\fbidi \fswiss\fcharset163\fprq2 Calibri (Vietnamese);}{\f420\fbidi \fswiss\fcharset238\fprq2 Tahoma CE;}{\f421\fbidi \fswiss\fcharset204\fprq2 Tahoma Cyr;}{\f423\fbidi \fswiss\fcharset161\fprq2 Tahoma Greek;}
{\f424\fbidi \fswiss\fcharset162\fprq2 Tahoma Tur;}{\f425\fbidi \fswiss\fcharset177\fprq2 Tahoma (Hebrew);}{\f426\fbidi \fswiss\fcharset178\fprq2 Tahoma (Arabic);}{\f427\fbidi \fswiss\fcharset186\fprq2 Tahoma Baltic;}
{\f428\fbidi \fswiss\fcharset163\fprq2 Tahoma (Vietnamese);}{\f429\fbidi \fswiss\fcharset222\fprq2 Tahoma (Thai);}{\flomajor\f31508\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\flomajor\f31509\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}
{\flomajor\f31511\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}{\flomajor\f31512\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\flomajor\f31513\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}
{\flomajor\f31514\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}{\flomajor\f31515\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\flomajor\f31516\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}
{\fdbmajor\f31518\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\fdbmajor\f31519\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}{\fdbmajor\f31521\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}
{\fdbmajor\f31522\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\fdbmajor\f31523\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\fdbmajor\f31524\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}
{\fdbmajor\f31525\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\fdbmajor\f31526\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}{\fhimajor\f31528\fbidi \froman\fcharset238\fprq2 Cambria CE;}
{\fhimajor\f31529\fbidi \froman\fcharset204\fprq2 Cambria Cyr;}{\fhimajor\f31531\fbidi \froman\fcharset161\fprq2 Cambria Greek;}{\fhimajor\f31532\fbidi \froman\fcharset162\fprq2 Cambria Tur;}
{\fhimajor\f31535\fbidi \froman\fcharset186\fprq2 Cambria Baltic;}{\fhimajor\f31536\fbidi \froman\fcharset163\fprq2 Cambria (Vietnamese);}{\fbimajor\f31538\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}
{\fbimajor\f31539\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}{\fbimajor\f31541\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}{\fbimajor\f31542\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}
{\fbimajor\f31543\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\fbimajor\f31544\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}{\fbimajor\f31545\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}
{\fbimajor\f31546\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}{\flominor\f31548\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\flominor\f31549\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}
{\flominor\f31551\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}{\flominor\f31552\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\flominor\f31553\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}
{\flominor\f31554\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}{\flominor\f31555\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\flominor\f31556\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}
{\fdbminor\f31558\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}{\fdbminor\f31559\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}{\fdbminor\f31561\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}
{\fdbminor\f31562\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}{\fdbminor\f31563\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\fdbminor\f31564\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}
{\fdbminor\f31565\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}{\fdbminor\f31566\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}{\fhiminor\f31568\fbidi \fswiss\fcharset238\fprq2 Calibri CE;}
{\fhiminor\f31569\fbidi \fswiss\fcharset204\fprq2 Calibri Cyr;}{\fhiminor\f31571\fbidi \fswiss\fcharset161\fprq2 Calibri Greek;}{\fhiminor\f31572\fbidi \fswiss\fcharset162\fprq2 Calibri Tur;}
{\fhiminor\f31575\fbidi \fswiss\fcharset186\fprq2 Calibri Baltic;}{\fhiminor\f31576\fbidi \fswiss\fcharset163\fprq2 Calibri (Vietnamese);}{\fbiminor\f31578\fbidi \froman\fcharset238\fprq2 Times New Roman CE;}
{\fbiminor\f31579\fbidi \froman\fcharset204\fprq2 Times New Roman Cyr;}{\fbiminor\f31581\fbidi \froman\fcharset161\fprq2 Times New Roman Greek;}{\fbiminor\f31582\fbidi \froman\fcharset162\fprq2 Times New Roman Tur;}
{\fbiminor\f31583\fbidi \froman\fcharset177\fprq2 Times New Roman (Hebrew);}{\fbiminor\f31584\fbidi \froman\fcharset178\fprq2 Times New Roman (Arabic);}{\fbiminor\f31585\fbidi \froman\fcharset186\fprq2 Times New Roman Baltic;}
{\fbiminor\f31586\fbidi \froman\fcharset163\fprq2 Times New Roman (Vietnamese);}}{\colortbl;\red0\green0\blue0;\red0\green0\blue255;\red0\green255\blue255;\red0\green255\blue0;\red255\green0\blue255;\red255\green0\blue0;\red255\green255\blue0;
\red255\green255\blue255;\red0\green0\blue128;\red0\green128\blue128;\red0\green128\blue0;\red128\green0\blue128;\red128\green0\blue0;\red128\green128\blue0;\red128\green128\blue128;\red192\green192\blue192;}{\*\defchp \fs22 }{\*\defpap 
\ql \li0\ri0\sa200\sl276\slmult1\widctlpar\wrapdefault\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 }\noqfpromote {\stylesheet{\ql \li0\ri0\widctlpar\wrapdefault\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \rtlch\fcs1 \af0\afs24\alang1025 
\ltrch\fcs0 \fs24\lang1033\langfe1033\cgrid\langnp1033\langfenp1033 \snext0 \sqformat \spriority0 Normal;}{\*\cs10 \additive \ssemihidden Default Paragraph Font;}{\*
\ts11\tsrowd\trftsWidthB3\trpaddl108\trpaddr108\trpaddfl3\trpaddft3\trpaddfb3\trpaddfr3\trcbpat1\trcfpat1\tblind0\tblindtype3\tsvertalt\tsbrdrt\tsbrdrl\tsbrdrb\tsbrdrr\tsbrdrdgl\tsbrdrdgr\tsbrdrh\tsbrdrv \ql \li0\ri0\sa200\sl276\slmult1
\widctlpar\wrapdefault\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \rtlch\fcs1 \af0\afs22\alang1025 \ltrch\fcs0 \fs22\lang1033\langfe1033\cgrid\langnp1033\langfenp1033 \snext11 \ssemihidden \sunhideused Normal Table;}}{\*\revtbl {Unknown;}}{\*\rsidtbl \rsid4013925
\rsid4355438}{\mmathPr\mmathFont34\mbrkBin0\mbrkBinSub0\msmallFrac0\mdispDef1\mlMargin0\mrMargin0\mdefJc1\mwrapIndent1440\mintLim0\mnaryLim1}{\info{\author Ray}{\operator Ray}{\creatim\yr2010\mo12\dy2\hr21\min13}{\revtim\yr2010\mo12\dy2\hr21\min13}
{\version2}{\edmins0}{\nofpages226}{\nofwords41598}{\nofchars237115}{\nofcharsws278157}{\vern49255}}{\*\xmlnstbl {\xmlns1 http://schemas.microsoft.com/office/word/2003/wordml}}
\paperw12240\paperh15840\margl1800\margr1800\margt1440\margb1440\gutter0\ltrsect 
\widowctrl\ftnbj\aenddoc\trackmoves0\trackformatting1\donotembedsysfont0\relyonvml0\donotembedlingdata1\grfdocevents0\validatexml0\showplaceholdtext0\ignoremixedcontent0\saveinvalidxml0\showxmlerrors0\noxlattoyen
\expshrtn\noultrlspc\dntblnsbdb\nospaceforul\horzdoc\dghspace120\dgvspace120\dghorigin1701\dgvorigin1984\dghshow0\dgvshow3\jcompress\viewkind1\viewscale90\nolnhtadjtbl\rsidroot4013925 \fet0{\*\wgrffmtfilter 013f}\ilfomacatclnup0\ltrpar \sectd \ltrsect
\linex0\sectdefaultcl\sftnbj {\*\pnseclvl1\pnucrm\pnstart1\pnindent720\pnhang {\pntxta .}}{\*\pnseclvl2\pnucltr\pnstart1\pnindent720\pnhang {\pntxta .}}{\*\pnseclvl3\pndec\pnstart1\pnindent720\pnhang {\pntxta .}}{\*\pnseclvl4
\pnlcltr\pnstart1\pnindent720\pnhang {\pntxta )}}{\*\pnseclvl5\pndec\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}{\*\pnseclvl6\pnlcltr\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}{\*\pnseclvl7\pnlcrm\pnstart1\pnindent720\pnhang {\pntxtb (}
{\pntxta )}}{\*\pnseclvl8\pnlcltr\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}{\*\pnseclvl9\pnlcrm\pnstart1\pnindent720\pnhang {\pntxtb (}{\pntxta )}}\pard\plain \ltrpar\ql \li0\ri0\sa200\sl276\slmult1
\nowidctlpar\wrapdefault\faauto\rin0\lin0\itap0 \rtlch\fcs1 \af0\afs24\alang1025 \ltrch\fcs0 \fs24\lang1033\langfe1033\cgrid\langnp1033\langfenp1033 {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 // ==UserScript==

\par // @name           KOC Power Tools
\par // @namespace      mat
\par // @include        }{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "http://*.kingdomsofcamelot.com/*main_src.php*"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 
00d0c9ea79f9bace118c8200aa004ba90b0200000003000000e0c9ea79f9bace118c8200aa004ba90b7400000068007400740070003a002f002f002a002e006b0069006e00670064006f006d0073006f006600630061006d0065006c006f0074002e0063006f006d002f002a006d00610069006e005f007300720063002e00
7000680070002a000000795881f43b1d7f48af2c825dc485276300000000a5ab0000ff}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 http://*.kingdomsofcamelot.com/*main_src.php*}}}\sectd \ltrsect
\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 
\par // @include        }{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "http://apps.facebook.com/kingdomsofcamelot/*"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 
00d0c9ea79f9bace118c8200aa004ba90b0200000003000000e0c9ea79f9bace118c8200aa004ba90b7200000068007400740070003a002f002f0061007000700073002e00660061006300650062006f006f006b002e0063006f006d002f006b0069006e00670064006f006d0073006f006600630061006d0065006c006f00
74002f002a000000795881f43b1d7f48af2c825dc485276300000000a5ab000080}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 http://apps.facebook.com/kingdomsofcamelot/*}}}\sectd \ltrsect
\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 
\par // @include        }{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "http://localhost/gmscript/mat/*"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 
00d0c9ea79f9bace118c8200aa004ba90b0200000003000000e0c9ea79f9bace118c8200aa004ba90b5800000068007400740070003a002f002f006c006f00630061006c0068006f00730074002f0067006d007300630072006900700074002f006d00610074002f002a000000795881f43b1d7f48af2c825dc48527630000
0000a5ab000000}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 http://localhost/gmscript/mat/*}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 
\par // ==/UserScript==
\par 
\par 
\par /*** 20101123a
\par *) Added: 'Select target' city picker to attack screen
\par *) Added: coords are clickable in Search results
\par *) Added: Message forward button
\par *) Added: 'all officers' button in msg compose
\par *) Added: 'ALL' to search wild types
\par *) Improved 'speed tab' cancel training errors
\par *) Fixed problem with speed training catapults
\par 
\par // TODO: Power button OUTSIDE of KOC's DOM (under ad frame?) - change label back to Power
\par // next version? TODO: enhance report/list page navigation and 'back' button
\par ***/
\par 
\par 
\par var DEBUG_BUTTON = true;
\par var DEBUG_TRACE = false;
\par var DEBUG_TRACE_CTRAIN = false;
\par var Version = '20101123a';
\par var MAP_DELAY = 1500;
\par var CANCEL_TRAINING_DELAY = 1500;   // without a delay, some (recoverable) 'something has gone wrong' errors occur. The server is probably delaying SQL updates on cancels.
\par var ENABLE_TEST_TAB = true; //TC \endash  changed to true to see the test tab capabilities
\par 
\par var Options = \{
\par   includeMarching:true,
\par   encRemaining : true,
\par   maxIdlePop   : false,
\par   srcSortBy    : 'level',
\par   srcMinLevel  : 1,
\par   srcMaxLevel  : 7,
\par   wildType     : 1,
\par   unownedOnly  : true,
\par   fixTower     : true,
\par   fixTower2    : true,
\par   fixMapDistance: true,
\par   fixMsgCount  : true,
\par   enhanceARpts : true,
\par   allowAlterAR : true,
\par   enhanceMsging : true,
\par   alertConfig  : \{aChat:false, aPrefix:'*** Automated message: TOWER ALERT! ***', scouting:false, wilds:false, minTroops:10000, spamLimit:10 \},
\par \};
\par unsafeWindow.pt_Options=Options;  
\par 
\par // TODO: continue testing 4x
\par // TODO: Dismiss button for retry popup ?
\par // TODO: Force KOC to update training queues, marches, etc for non-current city ?  (fix 'waiting for reports', lingering tower alerts, etc)
\par 
\par 
\par if(!this.JSON2)\{JSON2=\{\};\}
\par (function()\{function f(n)\{return n<10?'0'+n:n;\}
\par if(typeof Date.prototype.toJSON!=='function')\{Date.prototype.toJSON=function(key)\{return this.getUTCFullYear()+'-'+
\par f(this.getUTCMonth()+1)+'-'+
\par f(this.getUTCDate())+'T'+
\par f(this.getUTCHours())+':'+
\par f(this.getUTCMinutes())+':'+
\par f(this.getUTCSeconds())+'Z';\};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key)\{return this.valueOf();\};\}
\par var cx=/[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,escapable=/[\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\
u206f\\ufeff\\ufff0-\\uffff]/g,gap,indent,meta=\{'\\b':'\\\\b','\\t':'\\\\t','\\n':'\\\\n','\\f':'\\\\f','\\r':'\\\\r','"':'\\\\"','\\\\':'\\\\\\\\'\},rep;function quote(string)\{
escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a)\{var c=meta[a];return typeof c==='string'?c:'\\\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);\})+'"':'"'+string+'"';\}
\par function str(key,holder)\{var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function')\{value=value.toJSON(key);\}
\par if(typeof rep==='function')\{value=rep.call(holder,key,value);\}
\par switch(typeof value)\{case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value)\{return'null';\}
\par gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]')\{length=value.length;for(i=0;i<length;i+=1)\{partial[i]=str(i,value)||'null';\}
\par v=partial.length===0?'[]':gap?'[\\n'+gap+
\par partial.join(',\\n'+gap)+'\\n'+
\par mind+']':'['+partial.join(',')+']';gap=mind;return v;\}
\par if(rep&&typeof rep==='object')\{length=rep.length;for(i=0;i<length;i+=1)\{k=rep[i];if(typeof k==='string')\{v=str(k,value);if(v)\{partial.push(quote(k)+(gap?': ':':')+v);\}\}\}\}else\{for(k in value)\{if(Object.hasOwnProperty.call(value,k))\{
v=str(k,value);if(v)\{partial.push(quote(k)+(gap?': ':':')+v);\}\}\}\}
\par v=partial.length===0?'\{\}':gap?'\{\\n'+gap+partial.join(',\\n'+gap)+'\\n'+
\par mind+'\}':'\{'+partial.join(',')+'\}';gap=mind;return v;\}\}
\par if(typeof JSON2.stringify!=='function')\{JSON2.stringify=function(value,replacer,space)\{var i;gap='';indent='';if(typeof space==='number')\{for(i=0;i<space;i+=1)\{indent+=' ';\}\}else if(typeof space==='string')\{indent=space;\}
\par rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number'))\{throw new Error('JSON.stringify');\}
\par return str('',\{'':value\});\};\}
\par if(typeof JSON2.parse!=='function')\{JSON2.parse=function(text,reviver)\{var j;function walk(holder,key)\{var k,v,value=holder[key];if(value&&typeof value==='object')\{for(k in value)\{if(Object.hasOwnProperty.call(value,k))\{
v=walk(value,k);if(v!==undefined)\{value[k]=v;\}else\{delete value[k];\}\}\}\}
\par return reviver.call(holder,key,value);\}
\par cx.lastIndex=0;if(cx.test(text))\{text=text.replace(cx,function(a)\{return'\\\\u'+
\par ('0000'+a.charCodeAt(0).toString(16)).slice(-4);\});\}
\par if(/^[\\],:\{\}\\s]*$/.test(text.replace(/\\\\(?:["\\\\\\/bfnrt]|u[0-9a-fA-F]\{4\})/g,'@').replace(/"[^"\\\\\\n\\r]*"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g,']').replace(/(?:^|:|,)(?:\\s*\\[)+/g,'')))\{
j=eval('('+text+')');return typeof reviver==='function'?walk(\{'':j\},''):j;\}
\par throw new SyntaxError('JSON.parse');\};\}\})();
\par 
\par 
\par var Cities = \{\};
\par var Seed = unsafeWindow.seed;
\par var my = \{\};
\par var currentName = 'Overview';
\par var mainDiv;
\par var Tabs = [
\par   ['Overview', 'Overview'],
\par   ['Encamped', 'Encamped'],
\par   ['Search', 'Search'],
\par   ['Train4x' , 'Speed'],
\par   ['Info' , 'Info'],
\par   ['AllianceList' , 'Players'],
\par   ['Options' , 'Options'],
\par ];
\par 
\par if (ENABLE_TEST_TAB)
\par   Tabs.push (['Test', 'Test']);  
\par   
\par   
\par setTimeout (startup, 500);
\par 
\par function startup ()\{
\par //logit ('g_timeoff: '+ unsafeWindow.g_timeoff);
\par   Seed = unsafeWindow.seed;
\par   GM_addStyle ('.xtab \{padding-right: 5px; border:none; background:none; white-space:nowrap;\}\\
\par                 .xtabBR \{padding-right: 5px; border:none; background:none;\}\\
\par                 .ptstat \{border:1px solid; border-color:#ffffff; font-weight:bold; padding-top:2px; padding-bottom:2px; text-align:center; color:#ffffff; background-color:#357\}\\
\par                 .ptentry \{padding: 7px; border:1px solid; border-color:#000000; background-color:#ffeecc; white-space:nowrap;\}\\
\par                 .ptErrText \{font-weight:bold; color:#600000\}\\
\par                 .castleBut \{outline:0px; margin-left:0px; margin-right:0px; width:24px; height:26px; font-size:12px; font-weight:bold;\}\\
\par                 .castleBut:hover \{border-size:3px; border-color:#000;\}\\
\par                 button::-moz-focus-inner, input[type="submit"]::-moz-focus-inner \{ border: none; \}\\
\par                 .castleButNon \{background-image:url("http://kocpower.googlecode.com/files/CastleBut2.png")\}\\
\par                 .castleButSel \{background-image:url("http://kocpower.googlecode.com/files/CastleBut3.png")\}\\
\par                 a.ptButton20 \{color:#ffff80\}');
\par   window.name = 'GMSCRIPT';
\par   logit ("* KOCpowerTools v"+ Version +" Loaded");
\par   readOptions();
\par   AddMainTabLink('POWER', eventHideShow);
\par   setCities();
\par   
\par   mainContent = "<STYLE>\\
\par       .mTopBar \{background: #ccc; border: none; height: 21px; padding-left: 8px\}\\
\par       .matTab \{\}\\
\par       .matTabSel \{font-size: 13px; color: #000; border: 1px; border-style: solid solid none solid; margin:6px; padding-left:8px; padding-right:8px; background: #f6f3fc; font-weight: 'bold'\}\\
\par       .matTabNotSel \{font-size: 13px; color: #fff; border: 1px; border-style: solid solid none solid; border-color: #000; margin:6px; padding-left:8px; padding-right:8px; background: #888; font-weight: 'normal'\}</style>\\
\par       <TABLE style='border: none' cellspacing=0 cellpadding=0 width=100% height=100%>\\
\par       <TR class='mTopBar' valign=bottom>\\
\par       <TD class='mTopBar' align=left><DIV id=idButs></div></td>\\
\par       <TD class='mTopBar' align=right>"+ Version +"&nbsp;</td>\\
\par       <TD valign=middle onmouseover='this.style.cursor=\\"pointer\\"' style='color: #fff; background: #555; padding-left: 5px; padding-right: 5px;' id=xClose width=10 align=right><B>X</td></tr>\\
\par     <TR><TD style='border: none; padding: 10px;' id=tdContent height=100% valign=top colspan=3>\\
\par     </td></tr></table></div>";
\par   
\par   mainDiv = createPopup (mainContent);
\par   window.document.getElementById ('xClose').addEventListener('click',eventHideShow, false);
\par   td = document.getElementById('tdContent');
\par   for (k=0; k<Tabs.length; k++)\{
\par     addTab (Tabs[k][1], Tabs[k][0]);
\par     my[Tabs[k][0]].init();
\par     cont = my[Tabs[k][0]].getContent();
\par     cont.style.display = 'none';
\par     td.appendChild(cont);
\par   \}
\par   setTabStyle (document.getElementById ('aaOverview'), true);
\par   my.Overview.getContent().style.display = 'block';
\par   setupTowerAlert ();
\par   eachSecond ();
\par   AllianceReports.init ();
\par   attackTargetPicker.init();
\par   messageNav.init();
\par //addUwFunction (MYupdate_seed_ajax);
\par \}
\par 
\par function eachSecond ()\{
\par   if (Options.alertConfig.aChat)
\par     checkTower ();  
\par   setTimeout (eachSecond, 1000);  
\par \}
\par 
\par /****************************************************************************************/
\par // returns: 'neutral', 'friendly', or 'hostile'
\par function getDiplomacy (aid) \{
\par   if (Seed.allianceDiplomacies == null)
\par     return 'neutral';
\par   if (Seed.allianceDiplomacies.friendly && Seed.allianceDiplomacies.friendly['a'+aid] != null)
\par     return 'friendly';
\par   if (Seed.allianceDiplomacies.hostile && Seed.allianceDiplomacies.hostile['a'+aid] != null)
\par     return 'hostile';
\par   return 'neutral';
\par \};
\par 
\par 
\par 
\par var messageNav = \{
\par   old_modal_messages : unsafeWindow.modal_messages,
\par   old_modal_messages_send : unsafeWindow.modal_messages_send,
\par   
\par   init : function ()\{  
\par     alterUwFunction ('modal_messages', [[/\}\\s*$/, 'setTimeout(messageNav_hook,0); \}']]); 
\par     alterUwFunction ('modal_messages_send', [[/\{\\s*var params/i, '\{\\nif (modal_messages_send_hook()) return;\\nvar params']]); 
\par     unsafeWindow.messageNav_hook = messageNav.hook;
\par     unsafeWindow.modal_messages_send_hook = messageNav.msgSendHook;
\par   \},
\par 
\par   enable : function (tf)\{
\par     t = messageNav;
\par     Options.enhanceMsging = tf;
\par     saveOptions();
\par     unsafeWindow.modal_messages = t.old_modal_messages;
\par     unsafeWindow.modal_messages_send = t.old_modal_messages_send;
\par     if (tf)\{
\par       alterUwFunction ('modal_messages', [[/\}\\s*$/, 'setTimeout(messageNav_hook,0); \}']]); 
\par       alterUwFunction ('modal_messages_send', [[/\{\\s*var params/i, '\{\\nif (modal_messages_send_hook()) return;\\nvar params']]); 
\par     \}
\par   \},
\par     
\par   hook : function ()\{
\par     var div = document.getElementById('modal_msg_view_actions');
\par     var but = makeButton20('Forward');
\par     div.appendChild (but);
\par     but.addEventListener ('click', messageNav.eventForward, false);
\par     div = document.getElementById('modal_msg_write_to').parentNode;
\par     div.innerHTML = '<TABLE><TR><TD class=xtab><b>To:</b> <INPUT type=text id=modal_msg_write_to></td><TD class=xtab><SPAN id=ptfwdbut></span></td></tr></table>';
\par     var button = makeButton20('All Officers');
\par     document.getElementById('ptfwdbut').appendChild (button);
\par     button.addEventListener ('click', function ()\{document.getElementById("modal_msg_write_to").value = "<officers>"\}, false);
\par   \},  
\par   
\par   eventForward : function ()\{
\par     document.getElementById('modal_msg_write_subj').value = "fwd: " + document.getElementById('modal_msg_view_subj').innerHTML.toString().stripTags();
\par     document.getElementById('modal_msg_write_to').value = '';
\par     var from = document.getElementById('modal_msg_view_from').children[0].innerHTML;
\par     var body = document.getElementById('modal_msg_view_body').innerHTML.replace(/\\n/g, '').replace(/<br>/gi, '\\n').stripTags().replace (/back$/i, '');
\par     document.getElementById('modal_msg_write_txt').value = '[Original message from '+ from +' follows:]\\n'+ body;
\par     unsafeWindow.modal_messages_compose();
\par   \},
\par 
\par   msgSendHook : function ()\{
\par     var to = document.getElementById("modal_msg_write_to").value.trim();
\par     if (to.toLowerCase() != '<officers>' || getMyAlliance()[0]==0)
\par       return false;
\par     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     params.toIds = getMyAlliance()[0]; 
\par     params.subject = document.getElementById("modal_msg_write_subj").value +' [Sent to all officers]';
\par     params.message = document.getElementById("modal_msg_write_txt").value;
\par     params.type = 'alliance';  
\par     new Ajax.Request(unsafeWindow.g_ajaxpath + "ajax/sendMessage.php" + unsafeWindow.g_ajaxsuffix, \{
\par         method: "post",
\par         parameters: params,
\par         onSuccess: function (message) \{
\par             var rslt = eval("(" + message.responseText + ")");
\par             if (rslt.ok) \{
\par                 unsafeWindow.Modal.showAlert(unsafeWindow.g_js_strings.modal_messages_send.msgsent);
\par                 document.getElementById('modal_msg_write_to').value = "";
\par                 document.getElementById('modal_msg_write_subj').value = "";
\par                 document.getElementById('modal_msg_write_txt').value = ""
\par             \} else \{
\par                 unsafeWindow.Modal.showAlert(unsafeWindow.g_js_strings.modal_messages_send.enterexistingname)
\par             \}
\par         \},
\par         onFailure: function () \{
\par           unsafeWindow.Modal.showAlert(unsafeWindow.g_js_strings.modal_messages_send.oopscompose)
\par         \},
\par     \});
\par     return true;  
\par   \},  
\par \}
\par 
\par function makeButtonXX (label)\{
\par   var but = document.createElement('input');
\par   but.type='submit';
\par   but.value=label;
\par   but.style.width='inherit';
\par   return but;
\par \}
\par 
\par function makeButton20 (label)\{
\par   var a = document.createElement('a');
\par   a.className = "button20 ptButton20";
\par   var s = document.createElement('span');
\par   s.innerHTML = label;
\par   a.appendChild (s);
\par   return a;
\par \}
\par 
\par 
\par var attackTargetPicker = \{
\par   init : function ()\{
\par     alterUwFunction ('modal_attack', [['attack_checkOverMarch()', 'attack_checkOverMarch(); setTimeout(attackTargetPicker_hook,0)']]); 
\par     unsafeWindow.attackTargetPicker_hook = attackTargetPicker.hook;
\par   \},
\par 
\par   hook : function ()\{
\par     var div = document.getElementById('modal_attack_target_numflag');
\par     div.parentNode.innerHTML += ' &nbsp; <SPAN id=modal_attack_citybuts></span>'; 
\par     new CdispCityPicker ('ptatp', document.getElementById('modal_attack_citybuts'), false, attackTargetPicker.evtButtonClicked);
\par     var cityIdx = Cities.byID[unsafeWindow.currentcityid].idx;
\par     thisCityBut = document.getElementById('ptatp_'+ cityIdx);        
\par     thisCityBut.style.opacity = '0.5';    
\par     thisCityBut.disabled = true;
\par   \},
\par   
\par   evtButtonClicked : function (city)\{
\par     document.getElementById('modal_attack_target_coords_x').value = city.x;
\par     document.getElementById('modal_attack_target_coords_y').value = city.y;
\par   \},
\par \};
\par 
\par 
\par 
\par // onClick (city\{name, id, x, y\}, x, y)   city may be null!
\par function CdispCityPicker (id, span, dispName, notify, selbut)\{
\par   function CcityButHandler (t)\{
\par     var that = t;
\par     this.clickedCityBut = clickedCityBut;  
\par     function clickedCityBut (e)\{
\par       if (that.selected != null)
\par         that.selected.className = "castleBut castleButNon";
\par       that.city = Cities.cities[e.target.id.substr(that.prefixLen)];
\par       if (that.dispName)
\par         document.getElementById(that.id+'cname').innerHTML = that.city.name;
\par       e.target.className = "castleBut castleButSel";
\par       that.selected = e.target;
\par       if (that.coordBoxX)\{
\par         that.coordBoxX.value = that.city.x;  
\par         that.coordBoxY.value = that.city.y;  
\par         that.coordBoxX.style.backgroundColor = '#ffffff';
\par         that.coordBoxY.style.backgroundColor = '#ffffff';
\par       \}
\par       if (that.notify != null)
\par         that.notify(that.city, that.city.x, that.city.y);
\par     \}
\par   \}
\par   
\par   function selectBut (idx)\{
\par     document.getElementById(this.id+'_'+idx).click();   
\par   \}
\par   
\par   function bindToXYboxes (eX, eY)\{
\par     function CboxHandler (t)\{
\par       var that = t;
\par       this.eventChange = eventChange;  
\par       if (that.city)\{
\par         eX.value = that.city.x;
\par         eY.value = that.city.y;
\par       \}
\par       function eventChange ()\{
\par         var x = parseInt(that.coordBoxX.value);
\par         var y = parseInt(that.coordBoxY.value);
\par         if (isNaN(x) || x<0 || x>750)\{
\par           that.coordBoxX.style.backgroundColor = '#ff8888';
\par           return; 
\par         \}
\par         if (isNaN(y) || y<0 || y>750)\{
\par           that.coordBoxY.style.backgroundColor = '#ff8888';
\par           return; 
\par         \}
\par         that.coordBoxX.style.backgroundColor = '#ffffff';
\par         that.coordBoxY.style.backgroundColor = '#ffffff';
\par         if (that.notify != null)
\par           that.notify (null, x, y);
\par       \}
\par     \}
\par     this.coordBoxX = eX;
\par     this.coordBoxY = eY;
\par     var bh = new CboxHandler(this);
\par     eX.size=2;
\par     eX.maxLength=3;    
\par     eY.size=2;
\par     eY.maxLength=3;    
\par     eX.addEventListener('change', bh.eventChange, false);
\par     eY.addEventListener('change', bh.eventChange, false);
\par   \}    
\par   
\par   this.selectBut = selectBut;
\par   this.bindToXYboxes = bindToXYboxes;
\par   this.coordBoxX = null;
\par   this.coordBoxY = null;
\par   this.id = id;
\par   this.dispName = dispName;
\par   this.prefixLen = id.length+1;
\par   this.notify = notify;
\par   this.selected = null;  
\par   this.city = null;
\par   var m = '';
\par   for (var i=0; i<Cities.cities.length; i++)
\par     m += '<INPUT class="castleBut castleButNon" id="'+ id +'_'+ i +'" value="'+ (i+1) +'" type=submit \\>';
\par   if (dispName)
\par     m += ' &nbsp; <SPAN style="display:inline-block; width:85px; font-weight:bold;" id='+ id +'cname' +'></span>'; 
\par   span.innerHTML = m;
\par   var handler = new CcityButHandler(this);
\par   for (var i=0; i<Cities.cities.length; i++)
\par     document.getElementById (id+'_'+i).addEventListener('click', handler.clickedCityBut, false);
\par   if (selbut != null)
\par     this.selectBut(selbut);
\par \};
\par 
\par 
\par 
\par   
\par var AllianceReports = \{
\par   checkPeriod : 300,
\par   allianceNames : [],  
\par   saveArfunc : unsafeWindow.allianceReports,
\par       
\par   init : function ()\{
\par     t = AllianceReports;
\par //    t.periodical (); 
\par     t.enable (Options.enhanceARpts);
\par //logit ( inspect (Seed.allianceDiplomacies, 8, 1));  
\par   \},  
\par   
\par 
\par   enable : function (tf)\{
\par     t = AllianceReports;
\par     if (tf)
\par       unsafeWindow.allianceReports = t.myAllianceReports;
\par     else
\par       unsafeWindow.allianceReports = t.saveArfunc;
\par   \},
\par 
\par   myAllianceReports : function (pageNum)\{
\par     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     if (pageNum)
\par       params.pageNo = pageNum;
\par     params.group = "a";
\par     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/listReports.php" + unsafeWindow.g_ajaxsuffix, \{
\par       method: "post",
\par       parameters: params,
\par       onSuccess: function (rslt) \{
\par         displayReports (rslt.arReports, rslt.arPlayerNames, rslt.arAllianceNames, rslt.arCityNames, rslt.totalPages);
\par       \},    
\par       onFailure: function (rslt) \{
\par       \}, 
\par     \}, false);  
\par     
\par     function displayReports (ar, playerNames, allianceNames, cityNames, totalPages)\{
\par       var msg = new Array();
\par       var myAllianceId = getMyAlliance()[0];
\par       msg.push ("<STYLE>.msgviewtable tbody .myCol div \{margin-left:5px; overflow:hidden; white-space:nowrap; color:#000\}\\
\par             .msgviewtable tbody .myHostile div \{font-weight:600; color:#600\}\\
\par             .msgviewtable tbody .myGray div \{color:#666\}\\
\par             .msgviewtable tbody .myWarn div \{font-weight:600; color:#442200\}\\
\par             </style>");
\par       msg.push("<div class='modal_msg_reports'>");
\par       var rptkeys = Object.keys(ar);
\par       if (matTypeof(ar) != 'array') \{
\par         if (Options.allowAlterAR)
\par           msg.push("<div id='modal_alliance_reports_tablediv' class='modal_msg_list'><table width=675 cellpadding='0' cellspacing='0' class='msgviewtable reportviewtable alliancetable'>");
\par         else
\par           msg.push("<div id='modal_alliance_reports_tabledivNKA' class='modal_msg_list'><table width=675 cellpadding='0' cellspacing='0' class='msgviewtable reportviewtable alliancetable'>");
\par         msg.push("<thead><tr><td width=105>Date</td><td width=40>Type</td><td width=150>Attacker</td><td>Target</td><td>View</td></tr></thead><tbody>");
\par         for (var i = 0; i < rptkeys.length; i++) \{
\par           var rpt = ar[rptkeys[i]];
\par           var colClass = '"myCol"';
\par           rpt.side0AllianceId = parseInt(rpt.side0AllianceId);
\par           var targetDiplomacy = getDiplomacy (rpt.side0AllianceId);
\par           if (rpt.side1AllianceId != myAllianceId)\{
\par             colClass = '"myCol myHostile"';  
\par           \} else \{
\par             if (parseInt(rpt.side0TileType) < 50)\{          // if wild
\par               if (parseInt(rpt.side0PlayerId) == 0)
\par                 colClass = '"myCol myGray"';          
\par               else
\par                 colClass = '"myCol myWarn"';          
\par             \} else if (parseInt(rpt.side0PlayerId) == 0) \{   // barb
\par               colClass = '"myCol myGray"';          
\par             \} else \{
\par               if (targetDiplomacy == 'friendly')  
\par                 colClass = '"myCol myWarn"';          
\par             \}
\par           \}
\par           
\par           msg.push ('<tr valign=top');
\par           if (i%2 == 0)
\par             msg.push(" class=stripe");
\par           msg.push("><TD class="+ colClass +"><div>");
\par           msg.push(unsafeWindow.formatDateByUnixTime(rpt.reportUnixTime));
\par           msg.push("</div></td><TD class="+ colClass  +"><div>");
\par           rpt.marchType = parseInt(rpt.marchType);
\par           if (rpt.marchType == 1)
\par             msg.push (unsafeWindow.g_js_strings.commonstr.transport);
\par           else if (rpt.marchType == 3)
\par             msg.push (unsafeWindow.g_js_strings.commonstr.scout);
\par           else
\par             msg.push (unsafeWindow.g_js_strings.commonstr.attack);
\par           
\par           // attacker ...
\par           msg.push ("</div></td><TD class="+ colClass +"><div>");
\par           if (parseInt(rpt.side1PlayerId) != 0)
\par             msg.push(escape(playerNames["p" + rpt.side1PlayerId]))
\par           else
\par             msg.push ('?Unknown?');
\par           msg.push (' (');
\par           msg.push (rpt.side1XCoord);
\par           msg.push (',');
\par           msg.push (rpt.side1YCoord);
\par           msg.push (')<BR>');            
\par           if (rpt.side1AllianceId != myAllianceId)\{
\par             msg.push (allianceNames['a'+rpt.side1AllianceId]);            
\par             msg.push (' (');
\par             msg.push (getDiplomacy(rpt.side1AllianceId));            
\par             msg.push (')');
\par           \} else \{
\par             msg.push ('<BR>');
\par           \}
\par           msg.push ('</div></td>');
\par           
\par           // target ...
\par           msg.push ("<TD class="+ colClass  +"><DIV>");
\par           var type = parseInt(rpt.side0TileType);
\par                     
\par           if (type < 50)\{                              // wild
\par             msg.push(unsafeWindow.g_mapObject.types[type].capitalize());
\par             msg.push(" Lvl " + rpt.side0TileLevel)
\par             if (parseInt(rpt.side0PlayerId) != 0) \{   // IF OWNED, show owner ...  
\par               msg.push (' [');
\par               msg.push (escape(playerNames["p" + rpt.side0PlayerId]));
\par               msg.push ('] ');
\par             \}  
\par           \} else \{
\par             if (parseInt(rpt.side0PlayerId) == 0) \{   //  barb
\par               msg.push(unsafeWindow.g_js_strings.commonstr.barbariancamp);
\par               msg.push(" Lvl " + rpt.side0TileLevel)
\par             \} else \{        // city
\par               msg.push (escape(playerNames["p" + rpt.side0PlayerId]));
\par               msg.push (' - ');
\par               msg.push (cityNames['c'+ rpt.side0CityId]);
\par             \}            
\par           \}
\par           msg.push (' (');
\par           msg.push (rpt.side0XCoord);
\par           msg.push (',');
\par           msg.push (rpt.side0YCoord);
\par           msg.push (')');
\par 
\par           if (rpt.side0AllianceId!=0 && rpt.side0AllianceId!=myAllianceId)\{
\par             msg.push ('<BR>');            
\par             msg.push (allianceNames['a'+rpt.side0AllianceId]);            
\par             msg.push (' (');
\par             msg.push (targetDiplomacy);            
\par             msg.push (')');
\par           \}          
\par           
\par           // 'view report' link ...  
\par           if (Options.allowAlterAR)
\par             msg.push("</div></td><TD class="+ colClass  +"><div><a onclick=' modal_alliance_report_view(\\"");   // ONCLICK ???
\par           else        
\par             msg.push("</div></td><TD class="+ colClass  +"><div><a onclick=' $(\\"modal_alliance_reports_tabledivNKA\\").id=\\"modal_alliance_reports_tablediv\\"; modal_alliance_report_view(\\"");   // ONCLICK ???
\par           msg.push(rpt.marchReportId);
\par           msg.push('",');
\par           if (parseInt(rpt.side1AllianceId) == parseInt(Seed.allianceDiplomacies.allianceId)) 
\par             msg.push(1);
\par           else
\par             msg.push(0);
\par           msg.push(",");
\par           msg.push(rpt.side0TileType);
\par           msg.push(",");
\par           msg.push(rpt.side0TileLevel);
\par           msg.push(",");
\par           msg.push(rpt.side0PlayerId);
\par           msg.push(',"');
\par           if (parseInt(rpt.side0PlayerId) != 0)
\par             msg.push(escape(playerNames["p" + rpt.side0PlayerId]));
\par           else
\par             msg.push(unsafeWindow.g_js_strings.commonstr.enemy);
\par           msg.push('","');
\par           if (parseInt(rpt.side0PlayerId) != 0)
\par             msg.push(escape(playerNames["g" + rpt.side0PlayerId]));
\par           else
\par             msg.push(0)
\par           msg.push('","');
\par           if (parseInt(rpt.side1PlayerId) > 0)
\par             msg.push(escape(playerNames["p" + rpt.side1PlayerId]));
\par           msg.push('","');
\par           if (parseInt(rpt.side1PlayerId) != 0)
\par             msg.push(escape(playerNames["g" + rpt.side1PlayerId]));
\par           msg.push('",');
\par           msg.push(rpt.marchType);
\par           msg.push(",");
\par           msg.push(rpt.side0XCoord);
\par           msg.push(",");
\par           msg.push(rpt.side0YCoord);
\par           msg.push(",");
\par           msg.push(rpt.reportUnixTime);
\par           msg.push(",");
\par           if (parseInt(rpt.reportStatus) == 2)
\par             msg.push(1);
\par           else
\par             msg.push(0);
\par           if (rpt.side1XCoord) \{
\par             msg.push(",");
\par             msg.push(rpt.side1XCoord);
\par             msg.push(",");
\par             msg.push(rpt.side1YCoord)
\par           \} else \{
\par             msg.push(",,");
\par           \}
\par           msg.push(");return false;'>View</a></div></td></tr>");
\par         \}          
\par         msg.push("</tbody></table></div>");
\par       \}
\par       msg.push("</div><div id='modal_report_list_pagination'></div>");
\par       document.getElementById('allianceContent').innerHTML = msg.join("");
\par       if (pageNum) \{
\par         unsafeWindow.ctrlPagination("modal_report_list_pagination", totalPages, "allianceReports", pageNum)
\par       \} else \{
\par         unsafeWindow.ctrlPagination("modal_report_list_pagination", totalPages, "allianceReports")
\par       \}
\par     \}    
\par   \},    
\par   
\par   periodical : function ()\{
\par     t = AllianceReports;
\par     t.fetchNames();
\par     setTimeout (t.periodical,  t.checkPeriod);   
\par   \},
\par   
\par   getNames : function ()\{
\par     t = AllianceReports;
\par     return t.allianceNames;
\par   \},
\par   
\par   fetchPage : function (pageNum)\{   // untested
\par     t = AllianceReports;
\par     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     params.pageNo = pageNum;
\par     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetMembersInfo.php" + unsafeWindow.g_ajaxsuffix, \{
\par       method: "post",
\par       parameters: params,
\par       onSuccess: function (rslt) \{
\par       \},    
\par       onFailure: function (rslt) \{
\par       \}, 
\par     \}, true);  
\par   \},
\par   
\par   fetchNames : function ()\{
\par     t = AllianceReports;
\par     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetMemberNames.php" + unsafeWindow.g_ajaxsuffix, \{
\par       method: "post",
\par       parameters: params,
\par       onSuccess: function (rslt) \{
\par         if (rslt.ok)\{
\par           t.allianceNames = null;
\par           for (k in rslt.allianceMembers)
\par             t.allianceNames.push( rslt.allianceMembers[k].displayName );
\par         \}
\par       \},    
\par       onFailure: function (rslt) \{
\par       \},    
\par     \}, true);
\par   \},
\par   
\par   fetchAllianceReports : function (pageNum)\{
\par     t = AllianceReports;
\par     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     params.group = "a";
\par     params.pageNo = pageNum;
\par     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/listReports.php" + unsafeWindow.g_ajaxsuffix, \{
\par       method: "post",
\par       parameters: params,
\par       onSuccess: function (rslt) \{
\par         if (rslt.ok)\{
\par         \}      
\par       \},    
\par       onFailure: function (rslt) \{
\par       \},    
\par     \}, true);
\par   \},  
\par \}   // end AllianceReports singleton
\par 
\par 
\par 
\par 
\par 
\par 
\par // TODO: Make all tower alert stuff a JSON object
\par 
\par var towerAlerts = \{
\par 
\par     
\par \}
\par 
\par 
\par 
\par function setupTowerAlert ()\{
\par   if ( !alterUwFunction ('attack_viewimpending_view', [['Modal.showModal', 'eventViewingImpending(a, e); Modal.showModal']]))\{
\par     logit ("Unable to hook to view tower alert function!");
\par     return;
\par   \}
\par   addMyFunction (eventViewingImpending);
\par \}
\par 
\par // called from unsafeWindow.attack_viewimpending_view() ...
\par function eventViewingImpending(march, e)\{
\par   if (!march.marchType || march.arrivalTime<unixTime())
\par     return;
\par   e.pop();
\par   e.push ('<div><BR><TABLE><TR><TD><a id=towerPostToChat class=button20><span>Post to Alliance Chat</span></a></td></tr></table></div>');  
\par   e.push ('</div>');
\par   setTimeout (function ()\{ document.getElementById('towerPostToChat').addEventListener('click', function ()\{eventPostToAllianceChat(march)\}, false)\}, 0);
\par \}
\par 
\par function eventPostToAllianceChat (march)\{
\par   newMarch (march, true);
\par   unsafeWindow.Modal.hideModal();
\par \}
\par 
\par 
\par // todo: this.marches cleanup / combine with towerMarches?
\par function checkTower ()\{
\par   if (this.marches == null)
\par     this.marches = \{\};
\par   if (matTypeof(Seed.queue_atkinc) != 'array')\{
\par     var newMarches = \{\};
\par     for (var k in Seed.queue_atkinc)\{
\par       newMarches[k] = true;
\par       if (this.marches[k] == null)
\par         newMarch (Seed.queue_atkinc[k], false);
\par     \}
\par     this.marches = newMarches;
\par   \}  
\par \}
\par 
\par 
\par var towerMarches = \{\};    // track all marches that have been posted to alliance chat
\par var s = GM_getValue ('towerMarches_'+GetServerId());
\par if (s != null)
\par   towerMarches = JSON2.parse (s);
\par 
\par function addTowerMarch (m)\{
\par   var now = unixTime();
\par   for (k in towerMarches)\{
\par     if (towerMarches[k].arrival < now)
\par       delete towerMarches[k];  
\par   \}
\par   towerMarches['m'+m.mid] = \{added:now, arrival:m.arrivalTime \};
\par   GM_setValue ('towerMarches_'+GetServerId(), JSON2.stringify(towerMarches) );
\par \}
\par 
\par function getTowerMarch (mid)\{
\par   return towerMarches['m'+ mid];
\par \}
\par 
\par   
\par function newMarch (m, force)\{
\par if (DEBUG_TRACE) logit ("checkTower(): INCOMING at "+ unixTime()  +": \\n"+ inspect (m, 8, 1));
\par   if (m.marchType == null)      // bogus march (returning scouts)
\par     return;   
\par 
\par if (ENABLE_TEST_TAB) my.Test.addDiv ("Incoming!<BR><PRE>" + inspect (m, 8, 1) +'</pre>');
\par     
\par   if (m.marchType == 3)\{
\par     if (!Options.alertConfig.scouting && !force)
\par       return; 
\par     atkType = 'scouted';
\par   \} else if (m.marchType == 4)\{
\par     atkType = 'attacked';
\par   \} else \{
\par     return;
\par   \}
\par   if ((getTowerMarch(m.mid)!=null) && !force)\{   // already posted
\par logit ("Tower report (m"+ m.mid +") already posted, ignoring!");
\par     return;
\par   \}          
\par 
\par   var target, atkType, who;
\par   var city = Cities.byID[m.toCityId];
\par   if ( city.tileId == m.toTileId )
\par     target = 'city at '+ city.x +','+ city.y;
\par   else \{
\par     if (!Options.alertConfig.wilds && !force)
\par       return;
\par     target = 'wilderness';
\par     for (k in Seed.wilderness['city'+m.toCityId])\{
\par       if (Seed.wilderness['city'+m.toCityId][k].tileId == m.toTileId)\{
\par         target += ' at '+ Seed.wilderness['city'+m.toCityId][k].xCoord +','+ Seed.wilderness['city'+m.toCityId][k].yCoord;
\par         break; 
\par       \}
\par     \} 
\par   \}  
\par   if (Seed.players['u'+m.pid]) 
\par     who = Seed.players['u'+m.pid].n;
\par   else if (m.players && m.players['u'+m.pid]) 
\par     who = m.players['u'+m.pid].n;
\par   else
\par     who = 'Unknown';
\par 
\par   if (m.fromXCoord)
\par     who += ' at '+ m.fromXCoord +','+ m.fromYCoord;    
\par     
\par   var msg = '';
\par   if (!force)
\par     msg = Options.alertConfig.aPrefix +' ';        
\par   msg += 'My '+ target +' is being '+ atkType  +' by '+ who +'. Incoming Troops (arriving in '+ 
\par       unsafeWindow.timestr(parseInt(m.arrivalTime - unixTime())) +') : ';
\par   var totTroops = 0;
\par   for (k in m.unts)\{
\par     var uid = parseInt(k.substr (1)); 
\par     msg += m.unts[k] +' '+ unsafeWindow.unitcost['unt'+uid][0] +', ';
\par     totTroops += m.unts[k];
\par   \}
\par   if ((totTroops < Options.alertConfig.minTroops) && !force)
\par     return;
\par   msg = msg.slice (0, -2);
\par   msg += '.';
\par   if ( city.tileId == m.toTileId )\{
\par     var emb = getCityBuilding(m.toCityId, 8);
\par     if (emb.count > 0)\{
\par       var availSlots = emb.maxLevel;
\par       for (k in Seed.queue_atkinc)\{
\par         if (Seed.queue_atkinc[k].marchType==2 && Cities.byID[Seed.queue_atkinc[k].fromCityId]==null)\{
\par           --availSlots;
\par         \}
\par       \}
\par       msg += ' My embassy has '+ availSlots +' of '+ emb.maxLevel +' slots available.';
\par     \}
\par   \}
\par 
\par if (ENABLE_TEST_TAB) my.Test.addDiv (msg);
\par   addTowerMarch (m);
\par //  sendChat ("/"+ Seed.player.name +' '+ msg);    // Whisper to myself
\par   sendChat ("/a "+  msg);                        // Alliance chat
\par \}  
\par 
\par /*********************************** Players TAB ***********************************/
\par 
\par function officerId2String (oid)\{
\par   if (oid==null)
\par     return '';
\par   else if (oid==3)
\par     return 'Officer';
\par   else if (oid==2)
\par     return 'Vice Chance';
\par   else if (oid==1)
\par     return 'Chancellor';
\par   return '';
\par \}
\par 
\par 
\par my.AllianceList = \{
\par   cont : null,
\par   state : null,
\par   dat : [],
\par     
\par   init : function ()\{
\par     var t = my.AllianceList;
\par     t.cont = document.createElement('div');
\par     unsafeWindow.PTgetMembers = t.eventGetMembers;
\par     unsafeWindow.PTgotoMap = t.gotoMap;
\par     unsafeWindow.PTpd = t.clickedPlayerDetail;
\par     return t.cont;
\par   \},
\par 
\par   getContent : function ()\{
\par     var t = my.AllianceList;
\par     return t.cont;
\par   \},
\par 
\par   hide : function ()\{
\par     var t = my.AllianceList;
\par   \},
\par   
\par   show : function ()\{
\par     var t = my.AllianceList;
\par     if (t.state == null)\{
\par       if (getMyAlliance()[0] == 0) \{
\par         t.cont.innerHTML = '<BR><BR><CENTER>You need to be in an alliance to use this feature.</center>';
\par         t.state = 1;
\par         return;
\par       \}
\par       var m = '<DIV class=ptentry><TABLE width=100% cellpadding=0>\\
\par           <TR><TD class=xtab align=right></td><TD class=xtab>Enter all or part of a player name: &nbsp;</td>\\
\par             <TD width=80% class=xtab><INPUT id=allPlayName size=20 type=text /> &nbsp; <INPUT id=playSubmit type=submit value="Find Player" /></td>\\
\par             <TD class="xtab ptErrText"><SPAN id=ptplayErr></span></td></tr>\\
\par           <TR><TD class=xtab>OR: </td><TD class=xtab> Enter all or part of an alliance name: &nbsp;</td>\\
\par             <TD class=xtab><INPUT id=allAllName type=text /> &nbsp; <INPUT id=allSubmit type=submit value="Find Alliance" /></td>\\
\par             <TD class="xtab ptErrText"><SPAN id=ptallErr></span></td></tr>\\
\par           </table><span style="vertical-align:middle;" id=altInput></span></div>\\
\par           <SPAN id=allListOut></span>';
\par       t.cont.innerHTML = m;
\par       document.getElementById('allSubmit').addEventListener ('click', t.eventSubmit, false);
\par       document.getElementById('playSubmit').addEventListener ('click', t.eventPlayerSubmit, false);
\par       document.getElementById('allAllName').addEventListener ('focus', function ()\{document.getElementById('ptallErr').innerHTML='';\}, false);
\par       document.getElementById('allPlayName').addEventListener ('focus', function ()\{document.getElementById('ptplayErr').innerHTML='';\}, false);
\par       t.state = 1;
\par     \}
\par   \},
\par     
\par   pName : '',
\par   eventPlayerSubmit : function ()\{
\par     var t = my.AllianceList;
\par     document.getElementById('ptplayErr').innerHTML='';
\par     var name = document.getElementById('allPlayName').value;
\par     t.pName = name;
\par     if (name.length < 3)\{
\par       document.getElementById('ptplayErr').innerHTML = 'Enter at least 3 characters';
\par       return; 
\par     \}
\par     document.getElementById('altInput').innerHTML = '';
\par     document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>Searching ...</center>';
\par     t.fetchPlayerList (name, t.eventGotPlayerList); 
\par   \},
\par   
\par   eventGotPlayerList : function (rslt)\{
\par     var t = my.AllianceList;
\par     if (!rslt.ok)\{
\par       document.getElementById('allListOut').innerHTML = rslt.errorMsg;
\par       return;
\par     \}  
\par     var m = '<DIV class=ptstat>Showing players matching <B>"'+ t.pName +'"</b></div>\\
\par       <DIV style="height:520px; max-height:520px; overflow-y:auto">\\
\par       <TABLE cellpadding=0><TR style="font-weight:bold"><TD class=xtab>Name</td><TD class=xtab width=20></td>\\
\par       <TD align=right class=xtab>Might</td><TD class=xtab>Facebook &nbsp; </td><TD class=xtab>Details &nbsp; &nbsp; </td></tr>';
\par     for (k in rslt.matchedUsers)\{
\par       var u = rslt.matchedUsers[k];
\par       m += '<TR valign=top><TD>'+ u.genderAndName +'</td><TD></td><TD align=right>'+ addCommasInt(u.might) +'</td>\\
\par           <TD align=center><A target="_tab" href="http://www.facebook.com/profile.php?id='+ u.fbuid +'">profile</a></td>\\
\par           <TD><DIV onclick="PTpd(this, '+ u.userId +')"><A>details</a></div></td></tr>';
\par     \}
\par     m += '</table></div>';
\par     document.getElementById('allListOut').innerHTML = m;
\par   \},
\par 
\par   pdDiv : null,  
\par   clickedPlayerDetail : function (div, uid)\{
\par     var t = my.AllianceList;
\par     div.innerHTML = "fetching details ..."; 
\par     t.pdDiv = div;
\par     t.fetchPlayerInfo (uid, t.gotPlayerDetail);
\par   \},
\par    
\par   gotPlayerDetail : function (rslt)\{
\par     var t = my.AllianceList;
\par     if (!rslt.ok)\{
\par       t.pdDiv.innerHTML = rslt.errorMsg;
\par       return;
\par     \}
\par     var u = rslt.userInfo[0];
\par     var a = 'None';
\par     if (u.allianceName)
\par       a = u.allianceName +' ('+ getDiplomacy(u.allianceId) + ')';
\par     var m = '<B>Alliance:</b> '+ a +' &nbsp; <B>Cities:</b> '+ u.cities +' &nbsp; <B>Population:</b> '+ u.population +'<BR><B>Provinces:</b> ';
\par     t.pdDiv.onclick = "";
\par     var pids = u.provinceIds.split (',');
\par     var p = [];
\par     for (var i=0; i<pids.length; i++)
\par       p.push(unsafeWindow.provincenames['p'+pids[i]]);
\par     t.pdDiv.innerHTML = m + p.join (', ');;   
\par   \},
\par   
\par   aName : '',
\par   eventSubmit : function ()\{
\par     var t = my.AllianceList;
\par     document.getElementById('ptallErr').innerHTML='';
\par     t.aName = document.getElementById('allAllName').value;
\par     if (t.aName.length < 3)\{
\par       document.getElementById('ptallErr').innerHTML = 'Enter at least 3 characters';
\par       return; 
\par     \}
\par     var myA = getMyAlliance ();
\par     document.getElementById('altInput').innerHTML = '';
\par     document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>Searching ...</center>';
\par     if (myA[0]!=0 && myA[1].toLowerCase().indexOf(t.aName.toLowerCase())>=0 )
\par       t.fetchAllianceList (t.aName, myA[0], t.eventGotAllianceList); 
\par     else
\par       t.fetchAllianceList (t.aName, null, t.eventGotAllianceList); 
\par   \},
\par 
\par   eventGotAllianceList : function (rslt)\{
\par     var t = my.AllianceList;
\par     if (!rslt.ok)\{
\par       document.getElementById('allListOut').innerHTML = rslt.errorMsg;
\par       return;
\par     \}  
\par     var m = '<DIV class=ptstat>Showing alliances matching <B>"'+ t.aName +'"</b></div>\\
\par     <TABLE><TR style="font-weight:bold"><TD class=xtab>Alliance Name</td><TD class=xtab>Rank</td><TD class=xtab>Members</td>\\
\par         <TD align=right class=xtab>Might</td><TD class=xtab>Diplomacy</td><TD class=xtab></td></tr>';
\par     for (k in rslt.alliancesMatched)\{
\par       var all = rslt.alliancesMatched[k];
\par       var dip = '';
\par       if (all.relation && all.relation==1)
\par         dip = 'Friendly';
\par       else if (all.relation && all.relation==2)
\par         dip = 'Hostile';
\par       m += '<TR><TD class=xtab>'+ all.allianceName +'</td><TD align=right class=xtab>'+ all.ranking +'</td><TD align=right class=xtab>'+ all.membersCount +'</td>\\
\par        <TD align=right class=xtab>'+ addCommasInt(all.might) +'</td><TD class=xtab>'+ dip +'</td>\\
\par        <TD class=xtab><a onclick="PTgetMembers('+ all.allianceId +')">View Members</a></td></tr>';
\par     \}
\par     document.getElementById('allListOut').innerHTML = m;
\par   \},
\par   
\par   gotoMap : function (e)\{
\par     coords = e.children[0].innerHTML.split(',');
\par     hideMe (); 
\par     document.getElementById('mapXCoor').value = coords[0];
\par     document.getElementById('mapYCoor').value = coords[1];
\par     unsafeWindow.reCenterMapWithCoor();
\par     unsafeWindow.changeview_map(document.getElementById('mod_views_map')); 
\par //    unsafeWindow.track_chrome_btn('Map_Flag');
\par   \},
\par   
\par   eventGotMemberList : function (rslt)\{
\par     var t = my.AllianceList;
\par     if (!rslt.ok)\{
\par       document.getElementById('allListOut').innerHTML = rslt.errorMsg;
\par       return;
\par     \}  
\par     var numInvalid = 0;
\par     var numPlayers = 0;
\par     t.dat = [];
\par     for (var i=0; i<rslt.results.length; i++)\{
\par       p = rslt.results[i];
\par       if (p.userId == 0)\{
\par         ++numInvalid;
\par       \} else \{
\par         ++numPlayers;
\par         for (var c=0; c<p.cities.length; c++)\{
\par           t.dat.push ([p.displayName, parseInt(p.might), p.officerType, parseInt(p.numCities), parseInt(p.cities[c].tileLevel),
\par                parseInt(p.cities[c].xCoord), parseInt(p.cities[c].yCoord), p.cities[c].cityName, 0]); 
\par         \}
\par       \}
\par     \}
\par     t.setDistances (Cities.cities[0].x, Cities.cities[0].y);
\par     t.displayMembers (rslt.allianceName, numPlayers);
\par   \},
\par 
\par 
\par   // sort and display
\par   reDisp : function ()\{
\par     var t = my.AllianceList;
\par     function sortFunc (a, b)\{   
\par       var t = my.AllianceList;
\par       if (typeof(a[t.sortColNum]) == 'number')\{
\par         if (t.sortDir > 0)
\par           return a[t.sortColNum] - b[t.sortColNum];
\par         else  
\par           return b[t.sortColNum] - a[t.sortColNum];
\par       \} else \{
\par         if (t.sortDir > 0)
\par           return a[t.sortColNum].localeCompare(b[t.sortColNum]);
\par         else
\par           return b[t.sortColNum].localeCompare(a[t.sortColNum]);
\par       \}
\par     \}
\par     t.dat.sort (sortFunc);
\par     var m = '';
\par     for (var i=0; i<t.dat.length; i++)\{
\par       m += '<TR style="max-height:30px"><TD class=xxtab>'+ t.dat[i][0] +'</td><TD align=right class=xxtab>'+ addCommasInt(t.dat[i][1]) +'</td><TD align=center class=xxtab>'+ t.dat[i][3] +'</td>\\
\par             <TD class=xxtab>'+ officerId2String(t.dat[i][2]) +'</td><TD class=xxtab>'+ t.dat[i][7] +'</td><TD align=right class=xxtab>'+ t.dat[i][4] +'</td>\\
\par             <TD align=center class=xxtab><DIV onclick="PTgotoMap(this)"><A>'+ t.dat[i][5] +','+ t.dat[i][6] +'</a></div></td>\\
\par             <TD align=right class=xxtab style="padding-right:20px;">'+ t.dat[i][8].toFixed(2) +'</td></tr>';
\par     \}
\par     var tbody = document.getElementById('allBody');
\par     tbody.style.maxHeight = '';  
\par     tbody.innerHTML = m;
\par     if (parseInt(tbody.clientHeight) > 475)\{
\par       tbody.style.height = '475px';    
\par       tbody.style.maxHeight = '475px';    
\par     \} 
\par //new CtableToText('tabAllMembers').toText();     
\par   \},
\par   
\par     
\par   setDistances : function (x, y)\{
\par     var t = my.AllianceList;
\par     for (var i=0; i<t.dat.length; i++)
\par       t.dat[i][8] = distance (x, y, t.dat[i][5], t.dat[i][6]);
\par   \},
\par       
\par   sortColNum : 8,
\par   sortDir : 1,
\par 
\par   displayMembers : function (allName, numPlayers)\{
\par     var t = my.AllianceList;
\par     function alClickSort (e)\{
\par       var t = my.AllianceList;
\par       var newColNum = e.id.substr(8); 
\par       document.getElementById('clickCol'+t.sortColNum).className = 'clickable';
\par       e.className='clickable clickableSel';
\par       if (newColNum == t.sortColNum)
\par         t.sortDir *= -1;
\par       else
\par         t.sortColNum = newColNum;
\par       t.reDisp();
\par     \}        
\par     unsafeWindow.PTalClickSort = alClickSort;
\par     
\par     var m = '<STYLE>.clickable\{background-color:#ddd; border:2px outset; border-color:#555; padding-left:5px; padding-right:5px\}\\
\par             .clickableSel\{background-color:#ffffcc;\}\\
\par             .xxtab\{background-color:none; padding-left:5px; padding-right:5px;\} </style>\\
\par       <DIV class=ptstat><TABLE id=tabAllMembers cellpadding=0  width=100%><TR font-weight:bold"><TD class=xtab> &nbsp; '+ allName +'</td>\\
\par   
      <TD class=xtab width=80% align=center>Distance is from <SPAN id=distFrom>'+ Cities.cities[0].name +' ('+ Cities.cities[0].x +','+ Cities.cities[0].y +')</span></td><TD class=xtab align=right>'+ numPlayers +' players found &nbsp; </td></tr></table></
div>\\
\par       <TABLE id=tabAllMembers align=center cellpadding=0 cellspacing=0><THEAD>\\
\par       <TR style="font-weight:bold"><TD id=clickCol0 onclick="PTalClickSort(this)" class=clickable><A><DIV>Player</div></a></td>\\
\par         <TD id=clickCol1 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>Might</a></div></td>\\
\par         <TD id=clickCol3 onclick="PTalClickSort(this)" class=clickable><A><DIV>Cities</a></div></td>\\
\par         <TD id=clickCol2 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>Rank</a></div></td>\\
\par         <TD id=clickCol7 onclick="PTalClickSort(this)" class=clickable><A><DIV>City Name</a></div></td>\\
\par         <TD id=clickCol4 onclick="PTalClickSort(this)" class=clickable><A><DIV>Lvl</a></div></td>\\
\par         <TD id=clickCol5 onclick="PTalClickSort(this)" class=clickable><A><DIV>Coords</a></div></td>\\
\par         <TD id=clickCol8 onclick="PTalClickSort(this)" class=clickable><A><DIV>Distance</a></div></td></tr></thead>\\
\par       <TBODY id=allBody style="background-color:#ffffff; overflow-y:auto; overflow-x:hidden;"></tbody></table>\\
\par       <DIV style="top:670px; left:0px; position:absolute; width:100%;  background-color:#ffffff; border-top:1px solid; margin-top:8px; color:#700; font-weight:bold;">\\
\par         <TABLE width=100%><TR><TD class=xtab>Data is from the leaderboard and may be up to 24 hours old!</td>\\
\par           <TD class=xtab align=right>Click on column headers to sort</td></tr></table></div>';
\par     document.getElementById('allListOut').innerHTML = m;
\par     document.getElementById('altInput').innerHTML = '<HR><TABLE width=100% cellpaddding=0><TR align=center>\\
\par         <TD class=xtab>Show distance from: &nbsp; X: <INPUT size=2 type=text id=plyrX /> Y: <INPUT size=2 type=text id=plyrY /> &nbsp; Or, choose city: <span id=dmcoords></span></td></tr></table>';
\par     document.getElementById('clickCol'+t.sortColNum).className = 'clickable clickableSel';
\par     t.reDisp();
\par     new CdispCityPicker ('plyrdcp', document.getElementById ('dmcoords'), true, t.eventCoords, 0).bindToXYboxes(document.getElementById('plyrX'), document.getElementById('plyrY')); 
\par   \},
\par       
\par   eventCoords : function (city, x, y)\{
\par     var t = my.AllianceList;
\par     var m = '';
\par     if (city != null)
\par       m = city.name +' ('+ city.x +','+ city.y +')'; 
\par     else
\par       m = x +','+ y;
\par     document.getElementById('distFrom').innerHTML = m;
\par     t.setDistances(x,y);   
\par     t.reDisp();
\par   \},
\par   
\par   eventGetMembers : function (aid)\{
\par     var t = my.AllianceList;
\par     document.getElementById('allListOut').innerHTML = '<BR><BR><CENTER>Searching ...</center>';
\par     t.fetchAllianceMemberList (aid, null, t.eventGotMemberList);
\par   \},
\par       
\par   fetchAllianceMemberList : function (allianceId, allianceName, notify) \{
\par     var t = my.AllianceList;
\par     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     params.perPage = 100;
\par     if (allianceName)
\par       params.allianceName = allianceName;
\par     if (allianceId && allianceId != 0)
\par       params.allianceId = allianceId;
\par     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserLeaderboard.php" + unsafeWindow.g_ajaxsuffix, \{
\par       method: "post",
\par       parameters: params,
\par       onSuccess: function (rslt) \{
\par         notify (rslt);
\par       \},
\par       onFailure: function (rslt) \{
\par         notify (rslt);
\par       \},
\par     \});
\par   \},
\par   
\par   fetchAllianceList : function (allianceName, myAid, notify) \{   // at least 3 chars :)
\par     var t = my.AllianceList;
\par     function combineResults (rsltA, rsltM, notify)\{
\par       if (!rsltA.ok)\{ 
\par         if (rsltA.msg.indexOf("No alliance found under")!=0 || !rsltM.ok)\{
\par           notify (rsltA);
\par           return;
\par         \}
\par         rsltA.ok = true;
\par         rsltA.count = 0;
\par         rsltA.alliancesMatched = \{\};
\par       \}  
\par       if (rsltM.ok)\{
\par         rsltA.alliancesMatched['a'+rsltM.allianceInfo.allianceId] = \{allianceId: rsltM.allianceInfo.allianceId, allianceName: rsltM.allianceInfo.allianceName, 
\par               membersCount: rsltM.allianceInfo.members, relation: null, might: rsltM.allianceInfo.might, ranking: rsltM.allianceInfo.ranking\};    
\par         ++rsltA.count;    
\par       \}
\par       notify (rsltA);
\par     \}
\par     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     params.allianceName = allianceName;
\par     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetSearchResults.php" + unsafeWindow.g_ajaxsuffix, \{
\par       method: "post",
\par       parameters: params,
\par       onSuccess: function (rslt) \{
\par         if (myAid!=null && myAid>0)
\par           t.fetchMyAllianceInfo  (function (r)\{ combineResults (rslt, r, notify)\});       
\par         else
\par           notify (rslt);
\par       \},
\par       onFailure: function (rslt) \{
\par         notify (rslt);
\par       \},
\par     \});
\par   \},
\par   
\par   fetchOtherAllianceInfo : function (pageNum, notify)\{    // as in alliance list, sorted by rank, 10 per page
\par     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     params.pageNo = pageNum;
\par     params.cityId = unsafeWindow.currentcityid;
\par     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetOtherInfo.php" + unsafeWindow.g_ajaxsuffix, \{
\par       method: "post",
\par       parameters: params,
\par       onSuccess: function (rslt) \{
\par         notify (rslt);
\par       \},    
\par       onSuccess: function (rslt) \{
\par         notify (rslt);
\par       \},   
\par     \});
\par   \},
\par   
\par   fetchMyAllianceInfo : function (notify)\{
\par     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetInfo.php" + unsafeWindow.g_ajaxsuffix, \{
\par       method: "post",
\par       parameters: params,
\par       onSuccess: function (rslt) \{
\par         notify (rslt);
\par       \},    
\par       onSuccess: function (rslt) \{
\par         notify (rslt);
\par       \},   
\par     \});
\par   \},
\par 
\par   fetchPlayerList : function (name, notify)\{  // at least 3 chars!!     UNTESTED
\par     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     params.searchName = name;
\par     params.subType = "ALLIANCE_INVITE"; 
\par     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/searchPlayers.php" + unsafeWindow.g_ajaxsuffix, \{
\par       method: "post",
\par       parameters: params,
\par       onSuccess: function (rslt) \{
\par         notify (rslt);
\par       \},    
\par       onSuccess: function (rslt) \{
\par         notify (rslt);
\par       \},   
\par     \});
\par   \}, 
\par 
\par   fetchPlayerInfo : function (uid, notify)\{  
\par     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     params.uid = uid;
\par     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserGeneralInfo.php" + unsafeWindow.g_ajaxsuffix, \{
\par       method: "post",
\par       parameters: params,
\par       onSuccess: function (rslt) \{
\par         notify (rslt);
\par       \},    
\par       onSuccess: function (rslt) \{
\par         notify (rslt);
\par       \},   
\par     \});
\par   \}, 
\par \};  
\par 
\par 
\par 
\par /*********************************** Test TAB ***********************************/
\par 
\par my.Test = \{
\par   cont : null,
\par   state : null,
\par     
\par   init : function ()\{
\par     var t = my.Test;
\par     t.cont = document.createElement('div');
\par     return t.cont;
\par   \},
\par 
\par   getContent : function ()\{
\par     var t = my.Test;
\par     return t.cont;
\par   \},
\par 
\par   hide : function ()\{
\par     var t = my.Test;
\par   \},
\par   
\par   show : function ()\{
\par     function xyNotify(city, x, y)\{
\par       var m = '[ Notified: '+ (city?city.name:'null') +', x='+ x +', y='+ y +' ]';
\par       document.getElementById('testNotify').innerHTML = m;
\par     \}    
\par     var t = my.Test;
\par     if (t.state == null)\{
\par       var m = '<TABLE><TR><TD align=right>Scout: </td><TD><INPUT type=checkbox id=fakeIsScout></td></tr>\\
\par           <TR><TD align=right>Wild: </td><TD><INPUT type=checkbox id=fakeIsWild></td></tr>\\
\par           <TR><TD align=right>Seconds: </td><TD><INPUT type=text size=4 value=300 id=fakeSeconds></td></tr>\\
\par           <TR><TD align=right># of Militia: </td><TD><INPUT type=text size=6 value=5000 id=fakeMilitia></td></tr>\\
\par           <TR><TD colspan=2 align=center><INPUT id=testSendMarch type=submit value="Fake Attack" \\></td></tr></table>\\
\par           <BR><INPUT id="subGifts" type=submit value="Gifts" \\>\\
\par           <BR>X: <INPUT id=testXbox  type=text /> Y: <INPUT id=testYbox type=text /> Or, choose city: <SPAN id=testcsel></span>\\
\par            &nbsp; &nbsp; &nbsp; <SPAN id=testNotify></span>\\
\par           <BR><DIV id=testDiv style="background-color:#ffffff; maxwidth:675; maxheight:400px; height:400px; overflow-y:auto;"></div>';
\par       t.cont.innerHTML = m;
\par       document.getElementById('testSendMarch').addEventListener ('click', t.clickFakeAttack, false);
\par       document.getElementById('subGifts').addEventListener ('click', t.clickGifts, false);
\par       new CdispCityPicker ('testdcp', document.getElementById('testcsel'), true, xyNotify, 0).bindToXYboxes (document.getElementById('testXbox'), document.getElementById('testYbox'));
\par       t.state = 1; 
\par     \}
\par   \},
\par 
\par   clickGifts : function ()\{
\par     var t = my.Test;
\par     document.getElementById('testDiv').innerHTML = 'fetching facebook gifts page ...';
\par     t.fetchFBreqs(t.gotGiftsPage);
\par   \},
\par   
\par   gotGiftsPage : function (rslt)\{
\par     var t = my.Test;
\par //logit (inspect (rslt, 8, 1));    
\par     var gifts = t.parseGiftsPage(rslt.responseText);  
\par //logit (inspect (gifts, 8, 1));
\par 
\par     var m = '<TABLE>';
\par     for (var i=0; i<gifts.length; i++)\{
\par       m += '<TR><TD>'+ gifts[i].gift +'</td><TD>'+ gifts[i].name +'</td></tr>'
\par     \}
\par     m += '</table>';
\par     document.getElementById('testDiv').innerHTML = m;
\par   \},  
\par     
\par   parseGiftsPage : function (p)\{
\par     var t = my.Test;
\par     var m = findAllBetween (p, '<div id="app_130402594779_0_', 'actions[reject');
\par     var ret = [];
\par logit (p);    
\par     for (var i=0; i<m.length; i++)\{
\par       mm = m[i].match( /profile.php\\?id=[0-9]*">(.*)<\\/a><\\/strong>.*(?:a gift of (.*)in <b>|here is a(.*)you can use).*Accept and play.*actions\\[(.*)\\]/im );    
\par logit (inspect (mm, 8, 1));      
\par       if (mm != null)\{
\par         ret.push (\{name:mm[1], url:mm[4], gift:mm[2]?mm[2]:mm[3] \});
\par       \}
\par     \}
\par     return ret;
\par   \},
\par 
\par  
\par   
\par   fetchFBreqs : function (notify)\{
\par     GM_xmlhttpRequest(\{
\par       url : '}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "http://www.facebook.com/reqs.php#confirm_130402594779_0"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 
00d0c9ea79f9bace118c8200aa004ba90b020000000b000000e0c9ea79f9bace118c8200aa004ba90b5a00000068007400740070003a002f002f007700770077002e00660061006300650062006f006f006b002e0063006f006d002f0072006500710073002e007000680070000000795881f43b1d7f48af2c825dc4852763
00000000a5ab00001700000063006f006e006600690072006d005f003100330030003400300032003500390034003700370039005f003000000000}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 
http://www.facebook.com/reqs.php#confirm_130402594779_0}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ',
\par       method: 'get',
\par       onload: function (r)\{
\par         notify (r);
\par       \}, 
\par       onerror: function (r)\{
\par         notify ('FAIL!');
\par       \}, 
\par     \});
\par   \},   
\par   
\par    
\par   writeDiv : function (msg)\{
\par     var t = my.Test;
\par     if (t.state != null)
\par       document.getElementById('testDiv').innerHTML = msg;
\par   \},
\par   
\par   addDiv : function (msg)\{
\par     var t = my.Test;
\par     if (t.state != null)
\par       document.getElementById('testDiv').innerHTML += msg;
\par   \},
\par   
\par   createFakeAttack : function (cityNum, isScout, isWild, secs, numMilitia)\{
\par     var marchId = 'm'+ (88888 + Math.floor(Math.random()*11111));
\par     var march = \{\};
\par     if (matTypeof(Seed.queue_atkinc)=='array')
\par       Seed.queue_atkinc = \{\};
\par     if (isScout)
\par       march.marchType = 3; 
\par     else
\par       march.marchType = 4; 
\par     march.toCityId = Cities.cities[cityNum].id;
\par     if (isWild) \{
\par       keys = Object.keys(Seed.wilderness['city'+Cities.cities[cityNum].id]); 
\par       march.toTileId = Seed.wilderness['city'+Cities.cities[cityNum].id][keys[0]].tileId;
\par     \} else \{
\par       march.toTileId = Cities.cities[cityNum].tileId;
\par     \}
\par     secs = parseInt(secs);
\par     march.arrivalTime = unixTime() + secs; 
\par     march.departureTime = unixTime() - 20; 
\par     march.unts = \{\}
\par     march.unts.u3 = 1
\par     march.unts.u2 = numMilitia
\par     march.pid = 1234567
\par     march.score = 9
\par     march.mid = marchId;
\par     march.players = \{\}
\par     march.players.u1234567 = \{\}
\par     march.players.u1234567.n = 'Fred Flintstone';
\par     march.players.u1234567.t = 60
\par     march.players.u1234567.m = 5441192
\par     march.players.u1234567.s = 'M';
\par     march.players.u1234567.w = 1
\par     march.players.u1234567.a = 1
\par     march.players.u1234567.i = 5
\par     Seed.queue_atkinc[marchId] = march;  
\par     Seed.players.u1234567 = march.players.u1234567;
\par // add a false report too:
\par //Seed.queue_atkinc.m77777 = \{\};      
\par   \},
\par   
\par   clickFakeAttack : function ()\{
\par     var t = my.Test;
\par     var isScout = document.getElementById('fakeIsScout').checked;
\par     var isWild = document.getElementById('fakeIsWild').checked;
\par     var secs = parseInt(document.getElementById('fakeSeconds').value);
\par     var mil = parseInt(document.getElementById('fakeMilitia').value);
\par     t.createFakeAttack (0, isScout, isWild, secs, mil);
\par   \},  
\par \}
\par 
\par function findAllBetween (txt, find1, find2)\{
\par   var m = [];
\par   var last = 0;
\par   while ( (i1=txt.indexOf(find1, last))>=0 && (i2=txt.indexOf (find2, i1))>=0 ) \{
\par     m.push (txt.substring(i1+find1.length, i2));
\par     last = i2 + find2.length;
\par   \}
\par   return m;
\par \}
\par 
\par function strUpTo (s, find)\{
\par   var i = s.indexOf(find);
\par   if (i > 0)
\par     return s.substr(0, i);
\par   return s;
\par \}
\par 
\par /*********************************** Info tab ***********************************/
\par 
\par my.Info = \{
\par   cont : null,
\par   state : null,
\par     
\par   init : function ()\{
\par     var t = my.Info;
\par     t.cont = document.createElement('div');
\par     return t.cont;
\par   \},
\par 
\par   getContent : function ()\{
\par     var t = my.Info;
\par     return t.cont;
\par   \},
\par 
\par   hide : function ()\{
\par     var t = my.Info;
\par   \},
\par 
\par   show : function ()\{
\par     fortmight = \{
\par       u53: "4",
\par       u55: "7",
\par       u60: "1",
\par       u61: "2",
\par       u62: "3",
\par     \};
\par     var t = my.Info;
\par     rownum = 0;
\par     if (t.state == null)\{
\par       m = '<STYLE>.xtabH \{background:#ffffe8; border:none; padding-right: 5px; padding-left: 5px; margin-left:10px; \}\\
\par               .xtabHL \{ background:#ffffe8; border-width: 1px; border-style: none none none solid; padding-right:5px; padding-left:5px; margin-left:10px; \}\\
\par               .xtabL \{ background:none; border-width: 1px; border-style: none none none solid; padding-right:5px; padding-left: 5px; margin-left:10px; \}\\
\par               .xtabLine \{ padding:0px; spacing:0px; height:1px; border-color:black; border-width: 1px; border-style: none none solid none \}</style>\\
\par           <DIV class=ptstat>UNIT INFORMATION</div><TABLE align=center cellpadding=1 cellspacing=0>\\
\par           <TR align=center><TD class=xtab></td><TD class=xtabHL colspan=5><B>COST TO BUILD</b></td><TD class=xtabHL colspan=7><B>STATS</b></td><TD class=xtabHL><B>Upkeep</b></td></tr>\\
\par           <TR valign=bottom align=right><TD class=xtab></td><TD class=xtabHL>Food</td><TD class=xtabH>Wood</td><TD class=xtabH>Stone</td>\\
\par           <TD class=xtabH>Ore</td><TD class=xtabH>Pop</td><TD class=xtabHL>Might</td><TD class=xtabH>Life</td><TD class=xtabH>Atk</td><TD class=xtabH>Def</td><TD class=xtabH>Speed</td><TD class=xtabH>Range</td><TD class=xtabH>Load</td>\\
\par           <TD class=xtabHL>Food</td></tr>\\
\par           <TR style="height:1px;"><TD style="padding:0px; spacing:0px; height:1px; border-color:black; border-width: 1px; border-style: none none solid none" colspan=14></td></tr>';             
\par       for (ui=1; ui<13; ui++)\{       
\par         if (++rownum % 2)
\par           rsty = '';
\par         else
\par           rsty = ' style="background: #e8e8e8" ';
\par         cost = unsafeWindow.unitcost['unt'+ui];     //  NAME, Food, Wood, Stone, Ore, ?, IdlePop, Time
\par         stats = unsafeWindow.unitstats['unt'+ui];   //  Life, Attack, Defense, Speed, Range, Load
\par         food = unsafeWindow.unitupkeeps[ui];       
\par         might = unsafeWindow.unitmight['u'+ui];  
\par         m += '<TR '+ rsty +'align=right><TD class=xtab align=left><B>'+ cost[0] +'</b></td><TD class=xtabL>'+ cost[1] +'</td><TD class=xtab>'+ cost[2] +'</td>\\
\par             <TD class=xtab>'+ cost[3] +'</td><TD class=xtab>'+ cost[4] +'</td><TD class=xtab>'+ cost[6] +'</td><TD class=xtabL>'+ might +'</td>\\
\par             <TD class=xtab>'+ stats[0] +'</td><TD class=xtab>'+ stats[1] +'</td><TD class=xtab>'+ stats[2] +'</td><TD class=xtab>'+ stats[3] +'</td>\\
\par             <TD class=xtab>'+ stats[4] +'</td><TD class=xtab>'+ stats[5] +'</td><TD class=xtabL>'+ food +'</td></tr>';        
\par         
\par       \}     
\par       m += '<TR class=xtabLine><TD colspan=14 class=xtabLine></td></tr>';             
\par       for (k in unsafeWindow.fortcost)\{       
\par         if (++rownum % 2)
\par           rsty = '';
\par         else
\par           rsty = ' style="background: #e8e8e8" ';
\par         cost = unsafeWindow.fortcost[k];     //  NAME, Food, Wood, Stone, Ore, ?, IdlePop, Time
\par         fi = k.substring(3);
\par         stats = unsafeWindow.fortstats['unt'+fi];   //  Life, Attack, Defense, Speed, Range, Load
\par         food = 0;       
\par         might = fortmight['u'+fi]; 
\par         name = cost[0].replace ('Defensive',''); 
\par         name = name.replace ('Wall-Mounted',''); 
\par         m += '<TR '+ rsty +'align=right><TD align=left class=xtab><B>'+ name +'</b></td><TD class=xtabL>'+ cost[1] +'</td><TD class=xtab>'+ cost[2] +'</td>\\
\par             <TD class=xtab>'+ cost[3] +'</td><TD class=xtab>'+ cost[4] +'</td><TD class=xtab>'+ cost[6] +'</td><TD class=xtabL>'+ might +'</td>\\
\par             <TD class=xtab>'+ stats[0] +'</td><TD class=xtab>'+ stats[1] +'</td><TD class=xtab>'+ stats[2] +'</td><TD class=xtab>'+ stats[3] +'</td>\\
\par             <TD class=xtab>'+ stats[4] +'</td><TD class=xtab>'+ stats[5] +'</td><TD class=xtabL>'+ food +'</td></tr>';        
\par       \}     
\par       m += '<TR class=xtabLine><TD colspan=14 class=xtabLine></td></tr>';             
\par       m += '</table>';
\par       m += '<BR><DIV class=ptstat>DISTANCE CALCULATOR</div><DIV class=ptentry><TABLE align=center cellpadding=1 cellspacing=0>\\
\par         <TR><TD class=xtab align=right><B>First Location: </b></td><TD  class=xtab> X: <INPUT id=calcX type=text\\> Y: <INPUT id=calcY type=text\\> Or, choose city: <SPAN id=ptloc1></span></td></tr>\\
\par         <TR><TD class=xtab><B>Second Location: </b></td><TD class=xtab> X: <INPUT id=calcX2 type=text\\> Y: <INPUT id=calcY2 type=text\\> Or, choose city: <SPAN id=ptloc2></span></td></tr></table></div>\\
\par         <CENTER><SPAN style="margin-top:10px" id=ptdistout></span></center>';
\par       t.cont.innerHTML = m;       
\par       new CdispCityPicker ('ptloc1', document.getElementById('ptloc1'), true, t.eventLocChanged, 0).bindToXYboxes(document.getElementById('calcX'), document.getElementById('calcY'));  
\par       new CdispCityPicker ('ptloc2', document.getElementById('ptloc2'), true, t.eventLocChanged, 0).bindToXYboxes(document.getElementById('calcX2'), document.getElementById('calcY2'));  
\par       t.state = 1; 
\par     \}
\par   \},
\par   
\par   eventLocChanged : function (city, x, y)\{
\par     var x1 = parseInt(document.getElementById('calcX').value);
\par     var x2 = parseInt(document.getElementById('calcX2').value);
\par     if (isNaN(x2))
\par       return;
\par     var y1 = parseInt(document.getElementById('calcY').value);
\par     var y2 = parseInt(document.getElementById('calcY2').value);
\par     var m = 'The distance from '+ x1 +','+ y1 +' to '+ x2 +','+ y2 +' is: &nbsp;<B>'+ distance (x1, y1, x2, y2).toFixed(2) +'</b>';
\par     document.getElementById('ptdistout').innerHTML = m;
\par   \},
\par \}
\par 
\par 
\par /*********************************** Options Tab ***********************************/
\par function getFunctionName (func)\{
\par   var name=/\\W*function\\s+([\\w\\$]+)\\(/.exec(func);
\par   if (!name)
\par     return '';
\par   return name[1];
\par \}
\par 
\par function TESTalterUwFunction (f, r)\{
\par   funcText = unsafeWindow.MapObject.prototype.populateSlots.toString();
\par   if (funcText.indexOf(f) < 0)
\par     return false;
\par   rt = funcText.replace ('function populateSlots', 'function');
\par   rt = rt.replace(f, r);
\par   js = 'MapObject.prototype.populateSlots' +' = '+ rt;
\par \tab var scr=document.createElement('script');
\par \tab scr.innerHTML=js;
\par \tab document.body.appendChild(scr);
\par \tab return true;
\par \}
\par 
\par // ***** TODO:  Change 'bug fixes' to alter/restore code in unsafeWindow when each is enabled/disabled i/o the code looking at Options.fixXXX
\par 
\par my.Options = \{
\par   cont : null,
\par   state : null,
\par   fixAvailable : \{\},
\par 
\par   init : function ()\{
\par     var t = my.Options;
\par     
\par     function msgCount_hook (a)\{
\par       if (!pt_Options.fixMsgCount)\{
\par         $("chrome_messages_notify").innerHTML = a;
\par         $("chrome_messages_notify").show();
\par         $("chrome_messages_notifyL").hide();
\par         return;
\par       \}
\par       if (parseInt(seed.newMailCount) > 0) \{
\par         $("chrome_messages_notifyL").innerHTML = parseInt(seed.newMailCount);
\par         $("chrome_messages_notifyL").show();
\par       \} else \{
\par         $("chrome_messages_notifyL").hide();
\par       \}
\par       reports = parseInt(seed.newTradeReports) + parseInt(seed.newReportCount);
\par       if (reports < 1)
\par         $("chrome_messages_notify").hide();
\par       else \{
\par         $("chrome_messages_notify").innerHTML = reports;
\par         $("chrome_messages_notify").show();
\par       \}
\par     \}
\par     function setupMsgCountFix (checkboxId)\{
\par       e = document.getElementById('chrome_messages_notify');
\par       span = document.createElement('span');
\par       span.className='notify';
\par       span.style.display='none';
\par       span.id = 'chrome_messages_notifyL';
\par       span.style.left = '6px';
\par       e.parentNode.insertBefore (span, e);
\par       if ( ! alterUwFunction ('messages_notify_bug', [
\par             ['$("chrome_messages_notify").innerHTML = a;', 'msgCount_hook(a);'],
\par             ['$("chrome_messages_notify").show();', ''],
\par             ['$("chrome_messages_notify").hide();', '$("chrome_messages_notify").hide(); $("chrome_messages_notifyL").hide();']  ]))
\par         return false;
\par       addUwFunction (msgCount_hook);
\par       return true;
\par     \}
\par 
\par     function towerFix_hook (atkinc, e)\{
\par       var city = Cities.byID[atkinc.toCityId];
\par       if (!city)\{  // FALSE TOWER REPORT ???
\par         e.push ('<B>FALSE REPORT!</b>');
\par         return;
\par       \}
\par       if (!Options.fixTower)\{
\par         e.push (city.name);
\par         return;
\par       \}
\par       if (city.tileId == atkinc.toTileId)\{
\par         e.push(city.name + ' ('+ city.x + ','+ city.y +')');
\par         return;
\par       \}
\par       wilds = Seed.wilderness['city'+atkinc.toCityId];
\par       m = '';
\par       for (k in wilds)\{
\par         if (wilds[k].tileId == atkinc.toTileId)\{
\par           m = ' at '+ wilds[k].xCoord + ','+ wilds[k].yCoord;
\par           break;
\par         \}
\par       \}
\par       e.push(city.name + ', <B>WILD'+ m +'</b>');
\par     \}
\par     function setupTowerFix ()\{
\par       if ( !alterUwFunction ('attack_viewimpending_view', [['e.push(attack_cityidtoname(a.toCityId))', 'towerFix_hook(a, e)']]))
\par         return false;
\par       addMyFunction (towerFix_hook);
\par       return true;
\par     \}
\par 
\par     function towerFix2_hook1 ()\{
\par       if (Options.fixTower2)
\par         return false;
\par       else
\par         return true;
\par     \}
\par     function setupTowerFix2 ()\{
\par       if ( !alterUwFunction ('attack_generateincoming', [[/.*\} else \{\\s*e = true;\\s*\}/im, '\} else \{ e = towerFix2_hook1(); \}']]))
\par         return false;
\par       if ( !alterUwFunction ('attack_viewimpending', [[/.*\} else \{/im, '\} else if (!pt_Options.fixTower2) \{']]))
\par         return false;
\par       addMyFunction (towerFix2_hook1);
\par       return true;
\par     \}
\par     
\par     function fixMapDistance_hook(cityX, cityY, tileX, tileY)\{
\par       city = Cities.byID[unsafeWindow.currentcityid];
\par       if (Options.fixMapDistance)
\par         return distance (city.x, city.y, tileX, tileY);
\par       else
\par         return distance (cityX, cityY, tileX, tileY);
\par     \}
\par     function setupDistanceFix ()\{
\par       if ( ! TESTalterUwFunction ('this.distance', 'fixMapDistance_hook'))
\par         return false;
\par       addMyFunction (fixMapDistance_hook);
\par       return true;
\par     \}
\par 
\par     t.fixAvailable.fixTower = setupTowerFix ();
\par     t.fixAvailable.fixMapDistance = setupDistanceFix ();
\par     t.fixAvailable.fixMsgCount = setupMsgCountFix ();
\par     t.fixAvailable.fixTower2 = setupTowerFix2();
\par     t.cont = document.createElement('div');
\par     return t.cont;
\par   \},
\par 
\par   
\par   getContent : function ()\{
\par     var t = my.Options;
\par     return t.cont;
\par   \},
\par 
\par   hide : function ()\{
\par     var t = my.Options;
\par   \},
\par 
\par   
\par   show : function ()\{
\par     var t = my.Options;
\par     if (t.state != 1)\{
\par       m = '<BR><TABLE>\\
\par         <TR><TD class=xtab colspan=2><B>FEATURES:</b></td></tr>\\
\par         <TR><TD class=xtab><INPUT id=togMsgCountFix type=checkbox /></td><TD class=xtab>Show number of new messages separately from number of reports on Messages icon.</td></tr>\\
\par         <TR><TD class=xtab><INPUT id=alertEnable type=checkbox '+ (Options.alertConfig.aChat?'CHECKED ':'') +'/></td><TD class=xtab>Automatically post incoming attacks to alliance chat.</td></tr>\\
\par         <TR><TD class=xtab></td><TD class=xtab><TABLE cellpadding=0 cellspacing=0>\\
\par             <TR><TD class=xtab align=right>Message Prefix: &nbsp; </td><TD class=xtab><INPUT id=alertPrefix type=text size=60 maxlength=120 value="'+ Options.alertConfig.aPrefix +'" \\></td></tr>\\
\par             <TR><TD class=xtab align=right>Alert on scouting: &nbsp; </td><TD class=xtab><INPUT id=alertScout type=checkbox '+ (Options.alertConfig.scouting?'CHECKED ':'') +'/></td></tr>\\
\par             <TR><TD class=xtab align=right>Alert on wild attack: &nbsp; </td><TD class=xtab><INPUT id=alertWild type=checkbox '+ (Options.alertConfig.wilds?'CHECKED ':'') +'/></td></tr>\\
\par             <TR><TD class=xtab align=right>Minimum # of troops: &nbsp; </td><TD class=xtab><INPUT id=alertTroops type=text size=7 value="'+ Options.alertConfig.minTroops +'" \\> &nbsp; &nbsp; <span id=alerterr></span></td></tr>\\
\par         </table></td></tr>\\
\par         <TR><TD class=xtab><INPUT id=togAllRpts type=checkbox /></td><TD class=xtab>Enable enhanced Alliance Reports.</td></tr>\\
\par         <TR><TD class=xtab><INPUT id=togAllowAlter type=checkbox /></td><TD class=xtab>Allow other scripts to change format of Alliance Reports.</td></tr>\\
\par         <TR><TD class=xtab><INPUT id=togEnhanceMsging type=checkbox /></td><TD class=xtab>Enable enhanced messaging ("forward" and "all officers" buttons).</td></tr>\\
\par         <TR><TD class=xtab colspan=2><BR><BR><B>Kingdoms of Camelot BUG FIXES:</b></td></tr>\\
\par         <TR><TD class=xtab><INPUT id=togTowerFix type=checkbox /></td><TD class=xtab>Fix tower report to show exact target (city, wild or invalid)</td></tr>\\
\par         <TR><TD class=xtab><INPUT id=togMapDistFix type=checkbox /></td><TD class=xtab>Fix map to show distances from currently selected city, instead of always the first city.</td></tr>\\
\par         <TR><TD class=xtab><INPUT id=togTowerFix2 type=checkbox /></td><TD class=xtab>Fix false attack alerts created from scouting missions.</td></tr>\\
\par         </table><BR><BR><HR>Note that if a checkbox is greyed out there has probably been a change of KofC\\'s code, rendering the option inoperable.';
\par       t.cont.innerHTML = m;
\par       
\par       document.getElementById('alertEnable').addEventListener ('change', function () \{Options.alertConfig.aChat=document.getElementById('alertEnable').checked; saveOptions()\}, false);      
\par       document.getElementById('alertPrefix').addEventListener ('change', function () \{Options.alertConfig.aPrefix=document.getElementById('alertPrefix').value; saveOptions()\}, false);      
\par       document.getElementById('alertScout').addEventListener ('change', function () \{Options.alertConfig.scouting=document.getElementById('alertScout').checked; saveOptions()\}, false);      
\par       document.getElementById('alertWild').addEventListener ('change', function () \{Options.alertConfig.wilds=document.getElementById('alertWild').checked; saveOptions()\}, false);      
\par 
\par       document.getElementById('alertTroops').addEventListener ('change', function () \{
\par         var mt = parseInt(document.getElementById('alertTroops').value);
\par         if (mt<1 || mt>100000)\{
\par           document.getElementById('alertTroops').value = Options.alertConfig.minTroops;
\par           document.getElementById('alerterr').innerHTML = '<font color=#600000><B>INVALID</b></font>';
\par           setTimeout (function ()\{document.getElementById('alerterr').innerHTML =''\}, 2000);
\par         \} else \{
\par           Options.alertConfig.minTroops = mt; 
\par           saveOptions();
\par         \}
\par       \}, false);      
\par     
\par       var checkbox = document.getElementById('togEnhanceMsging');
\par        if (Options.enhanceMsging)
\par          checkbox.checked = true;
\par        checkbox.addEventListener ('change', function ()\{messageNav.enable(document.getElementById('togEnhanceMsging').checked)\}, false);
\par        
\par       var checkbox = document.getElementById('togAllowAlter');
\par        if (Options.allowAlterAR)
\par          checkbox.checked = true;
\par        checkbox.addEventListener ('change', function() \{Options.allowAlterAR=document.getElementById('togAllowAlter').checked; saveOptions();\}, false);
\par       
\par       var checkbox = document.getElementById('togAllRpts');
\par        if (Options.enhanceARpts)
\par          checkbox.checked = true;
\par        checkbox.addEventListener ('change', function() \{Options.enhanceARpts=document.getElementById('togAllRpts').checked; saveOptions(); AllianceReports.enable(Options.enhanceARpts);\}, false);
\par             
\par       var checkbox = document.getElementById('togTowerFix');
\par       if (!t.fixAvailable.fixTower)\{
\par         checkbox.disabled = true;
\par       \} else \{
\par        if (Options.fixTower)
\par          checkbox.checked = true;
\par        checkbox.addEventListener ('change', function() \{Options.fixTower=document.getElementById('togTowerFix').checked; saveOptions();\}, false);
\par       \}
\par       checkbox = document.getElementById('togTowerFix2');
\par       if (!t.fixAvailable.fixTower2)\{
\par         checkbox.disabled = true;
\par       \} else \{
\par        if (Options.fixTower2)
\par          checkbox.checked = true;
\par        checkbox.addEventListener ('change', function() \{Options.fixTower2=document.getElementById('togTowerFix2').checked; saveOptions();\}, false);
\par       \}
\par       checkbox = document.getElementById('togMapDistFix');
\par       if (!t.fixAvailable.fixMapDistance)\{
\par         checkbox.disabled = true;
\par       \} else \{
\par        if (Options.fixMapDistance)
\par          checkbox.checked = true;
\par        checkbox.addEventListener ('change', function() \{Options.fixMapDistance=document.getElementById('togMapDistFix').checked; saveOptions();\}, false);
\par       \}
\par       checkbox = document.getElementById('togMsgCountFix');
\par       if (!t.fixAvailable.fixMsgCount)\{
\par         checkbox.disabled = true;
\par       \} else \{
\par        if (Options.fixMsgCount)
\par          checkbox.checked = true;
\par        checkbox.addEventListener ('change', function() \{Options.fixMsgCount=document.getElementById('togMsgCountFix').checked; saveOptions(); unsafeWindow.messages_notify_bug();\}, false);
\par       \}
\par       t.state = 1;
\par     \}
\par   \},
\par \}
\par 
\par 
\par /********************************* Search Tab *************************************/
\par /*** exported from KOCattack
\par expDat = '\{"attack_150_40,498":"\{\\"type\\":0,\\"comment\\":\\"\\",\\"time\\":1288419704.762,\\"troops\\":[null,0,0,0,0,0,0,0,33333,0,0,0,0]\}","Options_150":"\{\\"attackDelay\\":15,\\"attackTypeCamp\\":true,\\"attackOrder\\":\\"closest\\",\\
"autoRemoveReports\\":true,\\"attackSecsSinceLastCity\\":43200,\\"attackSecsSinceLastCamp\\":3600,\\"attackSecsSinceLastWild\\":3600,\\"attackSecsSinceLastTransport\\":60,\\"randomPercent\\":20,\\"keepReports\\":10,\\"attackMaxDistance\\":60,\\
"waitAfterCitiesDone\\":15,\\"autoAttackCitiesDoneMax\\":3,\\"changeCitySecs\\":15,\\"retryMarch\\":true,\\"noViewReports\\":false,\\"chromeKeepReports\\":2,\\"percentOfPopToTrain\\":100,\\"autoGoldHappiness\\":99,\\"okCities\\
":[1,true,true,true,false,false,false,false,false,1],\\"impendingAttackUrl\\":\\"\\",\\"attackTypeCity\\":false,\\"attackTypeWild\\":false,\\"attackTypeTransport\\":false,\\"lockAttackFromCity\\":false\}","attack_150_38,494":"\{\\"type\\":0,\\"comment\\":
\\"\\",\\"time\\":1288419693.014,\\"troops\\":[null,0,0,0,0,0,16666,0,0,0,0,0,0]\}"\}';
\par obj = JSON2.parse (expDat);
\par logit ("OBJ: "+ inspect (obj, 8, 1));
\par return;
\par ***/
\par function htmlOptions (a, curVal)\{
\par   m = '';
\par   for (k in a)
\par     m += '<OPTION value="'+ k +'"'+ (k==curVal?' SELECTED':'')  +'>'+ a[k] +'</option>';
\par   return m;
\par \}
\par 
\par function distance (d, f, c, e) \{
\par   var a = 750;
\par   var g = a / 2;
\par   var b = Math.abs(c - d);
\par   if (b > g)
\par     b = a - b;
\par   var h = Math.abs(e - f);
\par   if (h > g)
\par     h = a - h;
\par   return Math.round(100 * Math.sqrt(b * b + h * h)) / 100;
\par \};
\par 
\par my.Search = \{
\par   cont:null,
\par   state : null,
\par 
\par   init : function ()\{
\par     var t = my.Search;
\par     this.cont = document.createElement('div');
\par     unsafeWindow.PTgotoMap2 = t.gotoMap;
\par     return this.cont;
\par   \},
\par 
\par   getContent : function ()\{
\par     var t = my.Search;
\par     return t.cont;
\par   \},
\par 
\par   hide : function ()\{
\par   \},
\par 
\par   show : function (cont)\{
\par     var t = my.Search;
\par     if (t.state == null)\{
\par       this.cont.innerHTML = '\\
\par         <DIV class=ptentry><TABLE><TR valign=bottom><TD class=xtab width=100 align=right>Search for: </td><TD>\\
\par         <SELECT id="srcType">\\
\par           <OPTION value=0>Barb Camp</option>\\
\par           <OPTION value=1>Wilderness</option>\\
\par         </select></td></tr>\\
\par         </table>\\
\par         <DIV id="srcOpts" style="height:100px"></div></div>\\
\par         <DIV id="srcResults" style="height:470px; max-height:470px;"></div>';
\par       var psearch = document.getElementById ("srcType");
\par       m = '<TABLE><TR valign=middle><TD class=xtab width=100 align=right>Center: &nbsp; X: </td><TD class=xtab>\\
\par         <INPUT id=srchX type=text\\> &nbsp; Y: <INPUT id=srchY type=text\\> &nbsp; <SPAN id=spInXY></span>\\
\par         </td></tr><TR><TD class=xtab align=right>Max. Distance: </td><TD class=xtab><INPUT id=srcDist size=4 value=10 /></td></tr>';
\par       m += '<TR><TD class=xtab></td><TD class=xtab><INPUT id=srcStart type=submit value="Start Search"/></td></tr>';
\par       m += '</table>';
\par       document.getElementById ('srcOpts').innerHTML = m;
\par       new CdispCityPicker ('srchdcp', document.getElementById ('spInXY'), true).bindToXYboxes(document.getElementById ('srchX'), document.getElementById ('srchY'));
\par       document.getElementById ('srcStart').addEventListener ('click', t.clickedSearch, false);
\par       t.state = 1;
\par     \}
\par   \},
\par 
\par   opt : \{\},
\par 
\par   searchRunning : false,
\par   tilesSearched : 0,
\par   tilesFound : 0,
\par   curX : 0,
\par   curY : 0,
\par   lastX : 0,
\par   firstX : 0,
\par   firstY : 0,
\par   lastY : 0,
\par 
\par   normalizeCoord : function (x)\{
\par     if ( x >= 750)
\par       x -= 750;
\par     else if (x < 0)
\par       x += 750;
\par     return parseInt (x/5) * 5;
\par   \},
\par 
\par   clickedSearch : function ()\{
\par     var t = my.Search;
\par 
\par     if (t.searchRunning)\{
\par       t.stopSearch ('SEARCH CANCELLED!');
\par       return;
\par     \}
\par     t.opt.searchType = document.getElementById ('srcType').value;
\par     t.opt.startX = parseInt(document.getElementById ('srchX').value);
\par     t.opt.startY = parseInt(document.getElementById ('srchY').value);
\par     t.opt.maxDistance = parseInt(document.getElementById ('srcDist').value);
\par     errMsg = '';
\par   
\par     if (isNaN (t.opt.startX) ||t.opt.startX<0 || t.opt.startX>749)
\par       errMsg = "X must be between 0 and 749<BR>";
\par     if (isNaN (t.opt.startY) ||t.opt.startY<0 || t.opt.startY>749)
\par       errMsg += "Y must be between 0 and 749<BR>";
\par     if (isNaN (t.opt.maxDistance) ||t.opt.maxDistance<1 || t.opt.maxDistance>75)
\par       errMsg += "Max Distance must be between 1 and 75<BR>";
\par     if (errMsg != '')\{
\par       document.getElementById('srcResults').innerHTML = '<FONT COLOR=#660000>ERROR:</font><BR><BR>'+ errMsg;
\par       return;
\par     \}
\par 
\par     t.searchRunning = true;
\par     document.getElementById ('srcStart').value = 'Stop Search';
\par     m = '<DIV class=ptstat><TABLE width=100% cellspacing=0><TR><TD class=xtab width=125><DIV id=statSearched></div></td>\\
\par         <TD class=xtab align=center><SPAN id=statStatus></span></td>\\
\par         <TD class=xtab align=right width=125><DIV id=statFound></div></td></tr></table></div>\\
\par       <TABLE width=100%><TR><TD><DIV id=divOutTab style="width:400px; height:470px; max-height:470px; overflow-y:auto;"></div></td>\\
\par       <TD width=100% height=100%><DIV id=divOutOpts style="background:#e0e0f0; height:450px; padding:10px"></div></td></table>';
\par     document.getElementById('srcResults').innerHTML = m;
\par     if (t.opt.searchType == 0)
\par       typeName = 'Barbarians';
\par     else
\par       typeName = 'Wildernesses';
\par       
\par     m = '<CENTER><B>Search for '+ typeName +'<BR>\\
\par         Center: '+ t.opt.startX +','+ t.opt.startY +'  &nbsp; Distance: '+ t.opt.maxDistance +'<BR></center>\\
\par         <DIV class=ptentry><TABLE cellspacing=0 width=100%><TR align=center><TD class=xtab colspan=10><B>LIST OPTIONS:</b><BR></td></tr>\\
\par         <TR><TD class=xtab align=right>Min. level to show:</td><TD class=xtab> <INPUT id=filMinLvl size=2 value='+ Options.srcMinLevel +' /></td></tr>\\
\par         <TR><TD class=xtab align=right>Max. level to show:</td><TD class=xtab> <INPUT id=filMaxLvl size=2 value='+ Options.srcMaxLevel +' /></td></tr>';
\par     if (t.opt.searchType == 1)\{
\par       m += '<TR><TD class=xtab align=right>Wilderness Type:</td><TD class=xtab><SELECT id=filWildType>';
\par       m += htmlOptions ( \{1:'Glassland/Lake', 3:'Woodlands', 4:'Hills', 5:'Mountain', 6:'Plain', 0:'ALL'\}, Options.wildType );
\par       m += '</select></td></tr><TR><TD class=xtab align=right>Unowned Only:</td><TD class=xtab><INPUT id=filUnowned type=CHECKBOX '+ (Options.unownedOnly?' CHECKED':'') +'\\><td></tr>';
\par     \}
\par     m+= '<TR><TD class=xtab align=right>Sort By:</td><TD class=xtab><SELECT id=filSortBy>\\
\par           <OPTION value="level" '+ (Options.srcSortBy=='level'?'SELECTED':'')  +'>Level</option>\\
\par           <OPTION value="dist" '+ (Options.srcSortBy=='dist'?'SELECTED':'')  +'>Distance</option>\\
\par         </select></td></tr>\\
\par         <TR><TD class=xtab align=right>Show coordinates only:</td><TD class=xtab><INPUT type=checkbox id=coordsOnly \\></td></tr>\\
\par         </table></div><BR><SPAN id=srchSizeWarn></span>';
\par         
\par     document.getElementById('divOutOpts').innerHTML = m;
\par     document.getElementById('filMinLvl').addEventListener ('change', function ()\{
\par       Options.srcMinLevel = document.getElementById('filMinLvl').value;
\par       saveOptions();
\par       t.dispMapTable ();
\par       \}, false);
\par     document.getElementById('filMaxLvl').addEventListener ('change', function ()\{
\par       Options.srcMaxLevel = document.getElementById('filMaxLvl').value;
\par       saveOptions();
\par       t.dispMapTable ();
\par       \}, false);
\par     document.getElementById('filSortBy').addEventListener ('change', function ()\{
\par       Options.srcSortBy = document.getElementById('filSortBy').value;
\par       saveOptions();
\par       t.dispMapTable ();
\par       \}, false);
\par     document.getElementById('coordsOnly').addEventListener ('change', function ()\{ t.dispMapTable (); \}, false);
\par     if (t.opt.searchType == 1)\{
\par       document.getElementById('filWildType').addEventListener ('change', function ()\{
\par         Options.wildType = document.getElementById('filWildType').value;
\par         saveOptions();
\par         t.dispMapTable ();
\par         \}, false);
\par       document.getElementById('filUnowned').addEventListener ('change', function ()\{
\par         Options.unownedOnly = (document.getElementById('filUnowned').checked);
\par         saveOptions();
\par         t.dispMapTable ();
\par         \}, false);
\par     \}
\par 
\par     t.mapDat = [];
\par     t.firstX =  t.opt.startX - t.opt.maxDistance;
\par     t.lastX = t.opt.startX + t.opt.maxDistance;
\par     t.firstY =  t.opt.startY - t.opt.maxDistance;
\par     t.lastY = t.opt.startY + t.opt.maxDistance;
\par     t.tilesSearched = 0;
\par     t.tilesFound = 0;
\par     t.curX = t.firstX;
\par     t.curY = t.firstY;
\par     var xxx = t.normalizeCoord(t.curX);
\par     var yyy = t.normalizeCoord(t.curY);
\par     document.getElementById ('statStatus').innerHTML = 'Searching at '+ xxx +','+ yyy;
\par if (DEBUG_TRACE) logit (" 0 clickedSearch()... setTimeout ..:" + xxx +' , '+ yyy +' , '+ t.mapCallback.name);    
\par     setTimeout (function()\{Map.request (xxx, yyy, 15, t.mapCallback)\}, MAP_DELAY);
\par   \},
\par 
\par   dispMapTable : function ()\{
\par     var tileNames = ['Barb Camp', 'Grassland', 'Lake', 'Woodlands', 'Hills', 'Mountain', 'Plain' ];
\par     var t = my.Search;
\par     var coordsOnly = document.getElementById('coordsOnly').checked;
\par if (DEBUG_TRACE) DebugTimer.start();
\par     function mySort(a, b)\{
\par       if (Options.srcSortBy == 'level')\{
\par         if ((x = a[4] - b[4]) != 0)
\par           return x;
\par       \}
\par       return a[2] - b[2];
\par     \}
\par 
\par     dat = [];
\par     for (i=0; i<t.mapDat.length; i++)\{
\par       lvl = parseInt (t.mapDat[i][4]);
\par       type = t.mapDat[i][3];
\par       if (lvl>=Options.srcMinLevel && lvl<=Options.srcMaxLevel)\{
\par         if (t.opt.searchType==0 || Options.wildType==0
\par         ||  (Options.wildType==1 && (type==1 || type==2))
\par         ||  (Options.wildType == type))\{
\par           if (!Options.unownedOnly || t.mapDat[i][5]===false)
\par             dat.push (t.mapDat[i]);
\par         \}
\par       \}
\par     \}
\par if (DEBUG_TRACE) DebugTimer.display('SEACHdraw: FILTER');
\par     
\par     document.getElementById('statFound').innerHTML = 'Found: '+ dat.length;
\par     if (dat.length == 0)\{
\par       m = '<BR><CENTER>None found</center>';
\par     \} else \{
\par       dat.sort(mySort);
\par if (DEBUG_TRACE) DebugTimer.display('SEACHdraw: SORT');
\par       if (coordsOnly)
\par         m = '<TABLE align=center id=srcOutTab cellpadding=0 cellspacing=0><TR style="font-weight: bold"><TD>Location</td></tr>';
\par       else
\par         m = '<TABLE id=srcOutTab cellpadding=0 cellspacing=0><TR style="font-weight: bold"><TD>Location</td><TD style="padding-left: 10px">Distance</td><TD style="padding-left: 10px;">Lvl</td><TD width=80%> &nbsp; Type
</td><TD style="padding-left: 10px;"></td></tr>';
\par       var numRows = dat.length;
\par       if (numRows > 500 && t.searchRunning)\{
\par         numRows = 500;        
\par         document.getElementById('srchSizeWarn').innerHTML = '<FONT COLOR=#600000>NOTE: Table only shows 500 of '+ dat.length +' results until search is complete.</font>';        
\par       \}  
\par       for (i=0; i<numRows; i++)\{
\par         m += '<TR><TD><DIV onclick="PTgotoMap(this)"><A>'+ dat[i][0] +','+ dat[i][1] +'</a></div></td>';
\par         if (coordsOnly)
\par           m += '</tr>';
\par         else
\par           m += '<TD align=right>'+ dat[i][2].toFixed(2) +' &nbsp; </td><TD align=right>'+ dat[i][4] +'</td><TD> &nbsp; '+ tileNames[dat[i][3]]
\par             +'</td><TD>'+ (dat[i][5]?' OWNED':'') +'</td></tr>';
\par        \}
\par       m += '</table>';
\par     \}
\par     document.getElementById('divOutTab').innerHTML = m;
\par     dat = null;
\par if (DEBUG_TRACE) DebugTimer.display('SEACHdraw: DRAW');
\par   \},
\par 
\par   mapDat : [],
\par 
\par   gotoMap : function (e)\{
\par     coords = e.children[0].innerHTML.split(',');
\par     hideMe (); 
\par     document.getElementById('mapXCoor').value = coords[0];
\par     document.getElementById('mapYCoor').value = coords[1];
\par     unsafeWindow.reCenterMapWithCoor();
\par     unsafeWindow.changeview_map(document.getElementById('mod_views_map')); 
\par   \},
\par 
\par   stopSearch : function (msg)\{
\par     var t = my.Search;
\par     document.getElementById ('statStatus').innerHTML = '<FONT color=#ffaaaa>'+ msg +'</font>';
\par     document.getElementById ('srcStart').value = 'Start Search';
\par     document.getElementById('srchSizeWarn').innerHTML = '';
\par     t.searchRunning = false;
\par   \},
\par 
\par 
\par /** mapdata.userInfo:
\par (object) u4127810 = [object Object]
\par     (string) n = George2gh02    (name)
\par     (string) t = 1              (title code)
\par     (string) m = 55             (might)
\par     (string) s = M              (sex)
\par     (string) w = 2              (mode: 1=normal, 2=begprotect, 3=truce, 4=vacation )
\par     (string) a = 0              (alliance)
\par     (string) i = 1              (avatar code)
\par *****/
\par 
\par   mapCallback : function (left, top, width, rslt)\{
\par     function insertRow (x, y, msg)\{
\par       row = document.getElementById('srcOutTab').insertRow(-1);
\par       row.insertCell(0).innerHTML = x +','+ y;
\par       row.insertCell(1).innerHTML = distance (t.opt.startX, t.opt.startY, x, y);
\par       row.insertCell(2).innerHTML = msg;
\par     \}
\par if (DEBUG_TRACE) logit (" 3 mapCallback()");
\par     var t = my.Search;
\par     if (!t.searchRunning)
\par       return;
\par     if (!rslt.ok)\{
\par       t.stopSearch ('ERROR: '+ rslt.errorMsg);
\par       return;
\par     \}
\par 
\par     map = rslt.data;
\par 
\par     for (k in map)\{
\par       if (t.opt.searchType==0 && map[k].tileType==51 && !map[k].tileCityId ) \{  // if barb
\par         type = 0;
\par       \} else if (t.opt.searchType==1 && map[k].tileType>=10 &&  map[k].tileType<=50) \{
\par         if (map[k].tileType == 10)
\par           type = 1;
\par         else if (map[k].tileType == 11)
\par           type = 2;
\par         else
\par           type = (map[k].tileType/10) + 1;
\par       \} else
\par         continue;
\par       dist = distance (t.opt.startX, t.opt.startY, map[k].xCoord, map[k].yCoord);
\par       if (dist <= t.opt.maxDistance)\{
\par         isOwned = map[k].tileUserId>0 || map[k].misted;
\par         t.mapDat.push ([map[k].xCoord, map[k].yCoord, dist, type, map[k].tileLevel, isOwned]);
\par         ++t.tilesFound;
\par       \}
\par     \}
\par     t.tilesSearched += (15*15);
\par     document.getElementById('statSearched').innerHTML = 'Searched: '+ t.tilesSearched;
\par     t.dispMapTable();
\par 
\par     t.curX += 15;
\par     if (t.curX > t.lastX)\{
\par       t.curX = t.firstX;
\par       t.curY += 15;
\par       if (t.curY > t.lastY)\{
\par         t.stopSearch ('Done!');
\par         return;
\par       \}
\par     \}
\par 
\par     var x = t.normalizeCoord(t.curX);
\par     var y = t.normalizeCoord(t.curY);
\par     document.getElementById ('statStatus').innerHTML = 'Searching at '+ x +','+ y;
\par if (DEBUG_TRACE) logit (" 0 mapCallback()... setTimeout ..:" + x +' , '+ y +' , '+ t.mapCallback.toString().substr (0,50));    
\par     setTimeout (function()\{Map.request (x, y, 15, t.mapCallback)\}, MAP_DELAY);
\par   \},
\par \};
\par 
\par 
\par /*******************   KOC Map interface ****************/
\par 
\par 
\par Map = \{
\par /***
\par  0: bog
\par 10: grassland
\par 11: lake
\par 20: woods
\par 30: hills
\par 40: mountain
\par 50: plain
\par 51: city / barb
\par 53: misted city
\par ***/
\par   generateBlockList : function(left, top, width) \{
\par     var width5 = parseInt(width / 5);
\par     var bl = [];
\par 
\par     for (x=0; x<width5; x++)\{
\par       xx = left + (x*5);
\par       if (xx > 745)
\par         xx -= 750;
\par       for (y=0; y<width5; y++)\{
\par         yy = top + (y*5);
\par         if (yy > 745)
\par           yy -= 750;
\par         bl.push ('bl_'+ xx +'_bt_'+ yy);
\par       \}
\par     \}
\par     return bl.join(",");
\par   \},
\par 
\par   callback : null,
\par   request : function (left, top, width, cb) \{
\par if (DEBUG_TRACE) logit (" 1 Map.request(): "+ left +' , '+ top +' , '+ width);
\par     left = parseInt(left / 5) * 5;
\par     top = parseInt(top / 5) * 5;
\par     width = parseInt((width+4) / 5) * 5;
\par     var blockString = this.generateBlockList(left, top, width);
\par     Map.callback = cb;
\par     //logit (left +','+ top + "  :"+ blockString);
\par 
\par     if (unsafeWindow.SANDBOX)
\par       return RequestMAPTEST(left, top, width, callback);
\par 
\par     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     params.blocks = blockString;
\par     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, \{
\par       method: "post",
\par       parameters: params,
\par       onSuccess: function (rslt) \{
\par if (DEBUG_TRACE) logit (" 2 Map.request  Map = "+ inspect (Map, 2, 1, 2));
\par         Map.callback(left, top, width, rslt);
\par       \},
\par       onFailure: function (rslt) \{
\par         Map.callback(left, top, width, rslt);
\par       \}
\par     \});
\par   \},
\par \};
\par 
\par 
\par 
\par /*************************************** Speed Tab ***********************************************/
\par 
\par my.Train4x = \{
\par   cont : null,
\par   timer : null,
\par   state : null,
\par   stats : \{\},
\par   selectedCity : null,
\par 
\par   init : function ()\{
\par     var t = my.Train4x;
\par     t.cont = document.createElement('div');
\par     return t.cont;
\par   \},
\par 
\par   getContent : function ()\{
\par     var t = my.Train4x;
\par     return t.cont;
\par   \},
\par 
\par   hide : function ()\{
\par     var t = my.Train4x;
\par     clearTimeout (t.timer);
\par   \},
\par 
\par   show : function ()\{
\par     var t = my.Train4x;
\par     clearTimeout (t.timer);
\par     if (t.state == null)\{
\par       s = "<DIV id=trainTopSelect style='height: 148px;'>\\
\par         <DIV class=ptstat>This screen takes advantage of a bug in KofC that lets you train FASTer!</div>\\
\par         <TABLE width=100%><TR><TD class=xtab align=right>Training Speed:</td><TD class=xtab width=2></td><TD width=300 class=xtab>\\
\par         <SELECT id=selTrainSpeed>\\
\par           <option value='2'>2x</option>\\
\par           <option value='3'>3x</option>\\
\par           <option value='4' SELECTED>4x</option>\\
\par           <option value='5'>5x</option>\\
\par           <option value='6'>6x</option>\\
\par           <option value='7'>7x</option>\\
\par           <option value='8'>8x</option>\\
\par           <option value='9'>9x</option>\\
\par           <option value='10'>10x</option>\\
\par         </select></td><TD class=xtabBR rowspan=2><INPUT type=CHECKBOX id=chkPop"+ (Options.maxIdlePop?' CHECKED ':'') +">\\
\par         Set workers to idle. &nbsp; (Allows you to train more troops. May temporarily set idle population negative.)</td></tr>\\
\par         <TR><TD class=xtab align=right>City:</td><TD class=xtab></td><TD class=xtab><SPAN id=ptspeedcity></span></td>";
\par       s += "</select></td>\\
\par         </tr><TR><TD class=xtab align=right>Troop Type:</td><TD class=xtab></td><TD class=xtab>\\
\par         <SELECT id=selTroopType>\\
\par           <option value='1'>Supply Troop</option>\\
\par           <option value='2'>Militiaman</option>\\
\par           <option value='3'>Scout</option>\\
\par           <option value='4'>Pikeman</option>\\
\par           <option value='5'>Swordsman</option>\\
\par           <option value='6'>Archer</option>\\
\par           <option value='7'>Cavalry</option>\\
\par           <option value='8'>Heavy Cavalry</option>\\
\par           <option value='9'>Supply Wagon</option>\\
\par           <option value='10'>Ballista</option>\\
\par           <option value='11'>Battering Ram</option>\\
\par           <option value='12'>Catapult</option>\\
\par         </select></td></tr>\\
\par         <TR><TD class=xtab align=right># to train:</td><TD class=xtab></td>\\
\par         <TD class=xtab><INPUT id='trainNum' size=5 type='text' value='0'\\>\\
\par         &nbsp; <INPUT id='trainMax' type=submit value='max'\\>\\
\par         &nbsp; &nbsp; (max <span id=spanMaxTroops>0</span>)</td><TD class=xtab>\\
\par         <INPUT id='trainDo' type=submit value='Train Troops'\\>\\
\par         </td></tr></table><BR></div>\\
\par         <TABLE align=center width=425><TR><TD><div id=trainStatus style='overflow-y:auto; max-height:210px; height: 210px;'></div></td></tr></table>\\
\par         <div id=divCityStats style='height: 290px; background: #ffb'></div>";
\par       t.cont.innerHTML = s;
\par             
\par       var dcp = new CdispCityPicker ('ptspeed', document.getElementById('ptspeedcity'), true, t.clickCitySelect, 0);   
\par       e = document.getElementById ('selTroopType');
\par       e.addEventListener ('change', t.clickTroopSelect, false);
\par       e = document.getElementById ('chkPop');
\par       e.addEventListener ('change', t.clickCheckIdlePop, false);
\par       e = document.getElementById ('trainDo');
\par       e.addEventListener ('click', t.clickDoTrain, false);
\par       e = document.getElementById ('trainMax');
\par       e.addEventListener ('click', t.clickMax, false);
\par       t.state = 1;
\par     \}
\par     t.displayCityStats();
\par     t.clickTroopSelect();
\par     t.timer = setTimeout (t.show, 1000);
\par   \},
\par 
\par   
\par   clickCheckIdlePop : function ()\{
\par     var t = my.Train4x;
\par     if (document.getElementById ('chkPop').checked)
\par       Options.maxIdlePop = true;
\par     else
\par       Options.maxIdlePop = false;
\par     saveOptions ();
\par     t.displayCityStats ();
\par     t.clickTroopSelect ();
\par   \},
\par 
\par   clickDoTrain : function ()\{
\par     var t = my.Train4x;
\par     cityId = t.selectedCity.id;
\par     unitId = document.getElementById ('selTroopType').value;
\par     numUnits = document.getElementById ('trainNum').value;
\par     trainSpeed = parseInt(document.getElementById ('selTrainSpeed').value);
\par     t.displayCityStats ();
\par t.trainSpeed = trainSpeed;    // for debug trace
\par     if (t.stats.barracks < trainSpeed*2)\{
\par       document.getElementById ('trainStatus').innerHTML = "<FONT COLOR=#550000>You need at least "+ (trainSpeed*2) +" barracks in this city to train at "+ trainSpeed +"x speed.</font>";
\par       return;
\par     \}
\par     if (isNaN(numUnits) || numUnits<200 || numUnits>t.stats.MaxTrain)\{
\par       if (t.stats.MaxTrain < 200)
\par         document.getElementById ('trainStatus').innerHTML = "<FONT COLOR=#550000>Can't train units right now (max = "+ t.stats.MaxTrain +")</font>";
\par       else
\par         document.getElementById ('trainStatus').innerHTML = "<FONT COLOR=#550000>Can't train "+ numUnits +" units! &nbsp; (Enter a number between 200 and "+ t.stats.MaxTrain +")</font>";
\par       return;
\par     \}
\par     if (t.stats.queued > 0)\{
\par       document.getElementById ('trainStatus').innerHTML = "<FONT COLOR=#550000>Can't train units until training queue is empty!</font>";
\par       return;
\par     \}
\par     document.getElementById('trainDo').disabled = true;
\par     perSlot = parseInt (numUnits/trainSpeed);
\par     que = [];
\par /**/
\par     que.push (['T', unitId, perSlot]);
\par     for (i=0; i<trainSpeed; i++)
\par       que.push (['T', 2, 1]);
\par     for (i=1; i<trainSpeed; i++)
\par       que.push (['T', unitId, perSlot]);
\par     for (i=trainSpeed; i>1; i--)
\par       que.push (['C', i]);
\par     document.getElementById ('trainStatus').innerHTML = '';
\par /**/
\par     t.doQueue (cityId, que);
\par   \},
\par 
\par   clickTroopSelect : function ()\{
\par     var t = my.Train4x;
\par     // unitcost: NAME, Food, Wood, Stone, Ore, Gold, Pop, ?
\par     id = document.getElementById ('selTroopType').value;
\par     uc = unsafeWindow.unitcost['unt'+id];
\par     max = 9999999999;
\par     if ( (t.stats.food / uc[1]) < max)
\par       max = t.stats.food / uc[1];
\par     if ( (t.stats.wood / uc[2]) < max)
\par       max = t.stats.wood / uc[2];
\par     if ( (t.stats.stone / uc[3]) < max)
\par       max = t.stats.stone / uc[3];
\par     if ( (t.stats.ore / uc[4]) < max)
\par       max = t.stats.ore / uc[4];
\par     if ( (t.stats.idlePop / uc[6]) < max)
\par       max = t.stats.idlePop / uc[6];
\par     t.stats.MaxTrain = parseInt (max) - 25;
\par     if (t.stats.MaxTrain < 0)
\par       t.stats.MaxTrain = 0;
\par     if (matTypeof(uc[8]) == 'object')\{
\par       for (k in uc[8])\{  // check building requirement
\par         var b = getCityBuilding (cityId, k.substr(1));
\par         if (b.maxLevel < uc[8][k][1])\{
\par           t.stats.MaxTrain = 0;
\par           break;
\par         \}
\par       \}
\par     \}    
\par     if (matTypeof(uc[9]) == 'object')\{
\par       for (k in uc[9])\{    // check tech requirement
\par         if (parseInt(Seed.tech['tch'+k.substr(1)]) < uc[9][k][1])\{
\par           t.stats.MaxTrain = 0;
\par           break;
\par         \}
\par       \}
\par     \}    
\par     document.getElementById('spanMaxTroops').innerHTML = t.stats.MaxTrain;
\par   \},
\par 
\par   clickMax : function ()\{
\par     var t = my.Train4x;
\par     document.getElementById('trainNum').value = t.stats.MaxTrain;
\par   \},
\par 
\par   clickCitySelect : function (city)\{
\par     var t = my.Train4x;
\par     document.getElementById('trainNum').value = '';
\par     t.selectedCity = city;
\par     t.displayCityStats ();
\par     t.clickTroopSelect();
\par     maxSpeed = parseInt(t.stats.barracks/2);
\par     if (maxSpeed > 10)
\par       maxSpeed = 10;
\par     document.getElementById('selTrainSpeed').value = maxSpeed;
\par   \},
\par 
\par 
\par   displayCityStats : function ()\{
\par     var t = my.Train4x;
\par     cityId = t.selectedCity.id;
\par     div = document.getElementById ('divCityStats');
\par     t.stats.food = parseInt (Seed.resources['city'+cityId].rec1[0]/3600);
\par     t.stats.wood = parseInt (Seed.resources['city'+cityId].rec2[0]/3600);
\par     t.stats.stone = parseInt (Seed.resources['city'+cityId].rec3[0]/3600);
\par     t.stats.ore = parseInt (Seed.resources['city'+cityId].rec4[0]/3600);
\par     t.stats.gold = Seed.citystats['city'+cityId].gold[0];
\par     if (Options.maxIdlePop)
\par       t.stats.idlePop = parseInt(Seed.citystats['city'+cityId].pop[0]);
\par     else
\par       t.stats.idlePop = parseInt(Seed.citystats['city'+cityId].pop[0]) - parseInt(Seed.citystats['city'+cityId].pop[3]);
\par     t.stats.barracks = getCityBuilding (cityId, 13).count;
\par     m = '<CENTER><B>'+ Cities.byID[cityId].name +' &nbsp; ('+ Cities.byID[cityId].x +','+ Cities.byID[cityId].y +')</b></center><HR>';
\par     m += '<TABLE width=100%><TR align=center>\\
\par       <TD class=xtab width=18%><B>Food:</b></td>\\
\par       <TD class=xtab width=16%><B>Wood:</b></td>\\
\par       <TD class=xtab width=16%><B>Stone:</b></td>\\
\par       <TD class=xtab width=16%><B>Ore:</b></td>\\
\par       <TD class=xtab width=16%><B>Gold:</b></td>\\
\par       <TD class=xtab width=16%><B>Idle Pop:</b></td></tr>\\
\par       <TR align=center><TD class=xtab>'+ addCommasInt(t.stats.food) +'</td>\\
\par       <TD class=xtab>'+ addCommasInt(t.stats.wood) +'</td>\\
\par       <TD class=xtab>'+ addCommasInt(t.stats.stone) +'</td>\\
\par       <TD class=xtab>'+ addCommasInt(t.stats.ore) +'</td>\\
\par       <TD class=xtab>'+ addCommasInt(t.stats.gold) +'</td>\\
\par       <TD class=xtab>'+ addCommasInt(t.stats.idlePop) +'</td>\\
\par       </tr></table><BR>\\
\par       <DIV style="overflow-y: auto; height:210px; max-height:210px"><table align=center><TR><TD class=xtab align=center colspan=4><B>Training Queue &nbsp; ('+ t.stats.barracks +' barracks)</b><BR><HR></td></tr>';
\par 
\par     t.stats.queued = 0;
\par     q = Seed.queue_unt['city'+cityId];
\par     if (q!=null && q.length > 0 )\{
\par       t.stats.queued = q.length;
\par       now = unixTime();
\par       first = true;
\par       for (i=0; i<q.length; i++)\{
\par         start = q[i][2];
\par         end = q[i][3];
\par         if (first)\{
\par           actual = end - now;
\par           first = false;
\par         \} else \{
\par           actual = end - lastEnd;
\par         \}
\par         if (actual < 0)
\par           actual = 0;
\par         m+= '<TR valign=top><TD class=xtab>'+ q[i][1] +' '+ unsafeWindow.unitcost['unt'+q[i][0]][0]
\par             +'</td><TD width=30 class=xtab></td><TD class=xtab>'+  unsafeWindow.timestr(end - start)
\par             +'</td><TD class=xtab> &nbsp; &nbsp; (Actual: '+ unsafeWindow.timestr(actual) +')</td></tr>'
\par         lastEnd = end;
\par       \}
\par     \}
\par     m += '</table></div>';
\par     div.innerHTML = m;
\par   \},
\par 
\par 
\par   dispTrainStatus : function (msg)\{
\par     div = document.getElementById ('trainStatus');
\par     div.innerHTML = msg + div.innerHTML;
\par   \},
\par 
\par   doQueue : function (cityId, que, errMsg)\{
\par     var t = my.Train4x;
\par     try \{
\par       t.displayCityStats();
\par       if (errMsg)\{
\par         if (errMsg == "Cancellation can not be done at this time")\{
\par           t.dispTrainStatus ('<font color=#550000><B>ERROR: '+ errMsg +'</b></font><BR>');
\par         \} else \{
\par           logit ("4x.doQueue ERROR: "+ errMsg);
\par           t.dispTrainStatus ('<font color=#550000><B>ERROR: '+ errMsg +'</b></font><BR>');
\par           document.getElementById('trainDo').disabled = false;
\par           return;
\par         \}
\par       \}
\par       cmd = que.shift();
\par       if (!cmd)\{
\par         t.dispTrainStatus ('<HR><B>Done queueing troops.</b> &nbsp; &nbsp; Refresh KofC a minute after the first group of troops is done training\\
\par               , and the rest will be done! (You may have to refresh twice)<HR>');
\par         document.getElementById('trainDo').disabled = false;
\par         return;
\par       \}
\par       if (cmd[0] == 'T')\{
\par         t.dispTrainStatus ('Training '+ cmd[2] +' '+  unsafeWindow.unitcost['unt'+cmd[1]][0] +'<BR>');
\par         doTrain (cityId, cmd[1], cmd[2], function(errMsg)\{my.Train4x.doQueue(cityId, que, errMsg);\} );
\par       \} else if (cmd[0] == 'C')\{
\par         t.dispTrainStatus ('Cancelling Slot #'+ (cmd[1]+1) +'<BR>');
\par         doCancelTrain (cityId, cmd[1], function(errMsg)\{my.Train4x.doQueue(cityId, que, errMsg);\});
\par       \}
\par     \} catch (err) \{
\par logit (inspect (err, 8, 1));
\par       t.dispTrainStatus ('<font color=#550000>PROGRAM ERROR: '+ err.message +'</font><BR>');
\par       document.getElementById('trainDo').disabled = false;
\par     \}
\par   \},
\par \}
\par 
\par 
\par /*************************************** OVERVIEW TAB ************************************************/
\par /***
\par function update_resource() \{
\par   var d = unixtime();
\par   var l = d - citylist["city" + currentcityid];
\par   citylist["city" + currentcityid] = d;
\par   var b = [0, 0, 0, 0, 0];
\par   if (!Object.isArray(seed.wilderness["city" + currentcityid])) \{
\par     var o = Object.keys(seed.wilderness["city" + currentcityid]);
\par     for (var h = 0; h < o.length; h++) \{
\par       var p = 0;
\par       switch (parseInt(seed.wilderness["city" + currentcityid][o[h]].tileType)) \{
\par       case 10:
\par         p = 1;
\par         break;
\par       case 11:
\par         p = 1;
\par         break;
\par       case 20:
\par         p = 2;
\par         break;
\par       case 30:
\par         p = 3;
\par         break;
\par       case 40:
\par         p = 4;
\par         break
\par       \}
\par       b[p] += parseInt(seed.wilderness["city" + currentcityid][o[h]].tileLevel)
\par     \}
\par   \}
\par   for (var h = 1; h < 5; h++) \{
\par     var f = seed.resources["city" + currentcityid]["rec" + h];
\par     var m = 1;
\par     var g = parseInt(seed.citystats["city" + currentcityid]["pop"][0]);
\par     var a = parseInt(seed.citystats["city" + currentcityid]["pop"][3]);
\par     if (a > g) \{
\par       m = g / a
\par     \}
\par     var j = 0;
\par     var q = seed.knights["city" + currentcityid];
\par     if (q) \{
\par       q = q["knt" + seed.leaders["city" + currentcityid].resourcefulnessKnightId];
\par       if (q) \{
\par         j = parseInt(q.resourcefulness);
\par         var n = new Date;
\par         if (q.resourcefulnessBoostExpireUnixtime > parseInt(n.getTime() / 1000)) \{
\par           j *= 1.25
\par         \}
\par       \}
\par     \}
\par     var c = 0;
\par     if (parseInt(seed.playerEffects["r" + h + "BstExp"]) > unixtime()) \{
\par       c = 0.25
\par     \}
\par     var e = (f[2] * (1 + seed.tech["tch" + h] / 10 + j / 100 + c + 0.05 * b[h]) * m + 100) - parseInt(f[3]);
\par     if (f[0] < f[1]) \{
\par       f[0] += e * l;
\par       if (f[0] > f[1]) \{
\par         f[0] = f[1]
\par       \} else \{
\par         if (f[0] < 0) \{
\par           f[0] = 0
\par         \}
\par       \}
\par     \} else \{
\par       if (e < 0) \{
\par         f[0] += e * l
\par       \}
\par     \}
\par     $("stat_rec" + h + "_num").innerHTML = addCommas(parseInt(f[0] / 3600));
\par     $("stat_rec" + h + "_bar_num").innerHTML = addCommas(parseInt(f[0] / 3600));
\par     $("stat_rec" + h + "_grw").innerHTML = addCommas(parseInt(e))
\par   \}
\par \}
\par ***/
\par 
\par my.Overview = \{
\par   cont : null,
\par   displayTimer : null,
\par   checkBox:null,
\par 
\par   Overview : function ()\{
\par   \},
\par 
\par   init : function ()\{
\par     this.cont = document.createElement('div');
\par     return this.cont;
\par   \},
\par 
\par   getContent : function ()\{
\par     return my.Overview.cont;
\par   \},
\par 
\par   hide : function ()\{
\par     clearTimeout (my.Overview.displayTimer);
\par   \},
\par 
\par   show : function ()\{
\par     var rownum = 0;
\par     var t = my.Overview;
\par 
\par     clearTimeout (t.displayTimer);
\par 
\par     if (Options.includeMarching)
\par       march = getMarchInfo ();
\par 
\par     function clickEnableMarch ()\{
\par       var t = my.Overview;
\par       if (checkBox.checked)
\par         Options.includeMarching = true;
\par       else
\par         Options.includeMarching = false;
\par       t.show ();
\par     \}
\par 
\par     function _row (name, row, noTotal)\{
\par       if (rownum++ % 2)
\par         style = '';
\par       else
\par         style = ' style = "background: #e8e8e8"';
\par       var tot = 0;
\par       var str = '<TR style="background: #fff" align=right'+ style +'><TD'+ style +'><B>'+ name +' &nbsp; </td>';
\par       if (noTotal)\{
\par         str += '<TD'+ style +'> &nbsp;</td>';
\par       \} else \{
\par         for (i=0; i<row.length; i++)
\par           tot += row[i];
\par         str += '<TD style="background: #ffc">'+ addCommas(tot) +'</td>';
\par       \}
\par       for (i=0; i<row.length; i++)
\par         str += '<TD'+ style +'>'+ addCommas(row[i]) +'</td>';
\par       return str +'</tr>';
\par     \}
\par 
\par //    if (div.style.display == 'none')
\par //      return;
\par 
\par     str = "<TABLE cellspacing=0><TR valign=top align=right><TD width=72></td><TD width=95 style='background: #ffc'><B>TOTAL</b></td>";
\par     for(i=0; i<Cities.numCities; i++) \{
\par       str += "<TD width=85><B>"+ Cities.cities[i].name.substring(0,10) +'</b><BR>('+
\par           Cities.cities[i].x +','+ Cities.cities[i].y  +")</td>";
\par     \}
\par 
\par     if (Options.includeMarching)
\par       str += '<TD width=85><B>Marching</b></td>';
\par 
\par     str += "</tr>";
\par 
\par     rows = [];
\par     rows[0] = [];
\par     for(i=0; i<Cities.numCities; i++) \{
\par       cityID = 'city'+ Cities.cities[i].id;
\par       rows[0][i] = parseInt(Seed.citystats[cityID].gold[0]);
\par     \}
\par 
\par     for (r=1; r<5; r++)\{
\par       rows[r] = [];
\par       for(i=0; i<Cities.numCities; i++) \{
\par         cityID = 'city'+ Cities.cities[i].id;
\par         rows[r][i] = parseInt(Seed.resources[cityID]['rec'+r][0] / 3600);
\par       \}
\par     \}
\par 
\par     if (Options.includeMarching)\{
\par       for (var i=0; i<5; i++)
\par         rows[i][Cities.numCities] = march.resources[i];
\par     \}
\par 
\par     str += _row ('Gold', rows[0]);
\par     str += _row ('Food', rows[1]);
\par     str += _row ('Wood', rows[2]);
\par     str += _row ('Stone', rows[3]);
\par     str += _row ('Ore', rows[4]);
\par     str += '<TR><TD><BR></td></tr>';
\par 
\par // TODO: food +/- ??
\par 
\par     for (r=1; r<13; r++)\{
\par       rows[r] = [];
\par       for(i=0; i<Cities.numCities; i++) \{
\par         cityID = 'city'+ Cities.cities[i].id;
\par         rows[r][i] = parseInt(Seed.units[cityID]['unt'+r]);
\par       \}
\par     \}
\par     if (Options.includeMarching)\{
\par       for (var i=0; i<13; i++)
\par         rows[i][Cities.numCities] = march.marchUnits[i];
\par     \}
\par 
\par     rownum = 0;
\par     str += _row ('SupTrp', rows[1]);
\par     str += _row ('Militia', rows[2]);
\par     str += _row ('Scout', rows[3]);
\par     str += _row ('Pike', rows[4]);
\par     str += _row ('Sword', rows[5]);
\par     str += _row ('Archer', rows[6]);
\par     str += _row ('Cavalry', rows[7]);
\par     str += _row ('Heavy', rows[8]);
\par     str += _row ('Wagon', rows[9]);
\par     str += _row ('Ballista', rows[10]);
\par     str += _row ('Ram', rows[11]);
\par     str += _row ('Catapult', rows[12]);
\par     str += '<TR><TD><BR></td></tr>';
\par 
\par     row = [];
\par     for(i=0; i<Cities.numCities; i++) \{
\par       var totWilds = 0;
\par       dat = Seed.wilderness['city'+ Cities.cities[i].id];
\par       if (dat!=null && matTypeof(dat)=='object')
\par         for (k in dat)
\par           ++totWilds;
\par       castle = parseInt(Seed.buildings['city'+ Cities.cities[i].id].pos0[1]);
\par       if (totWilds < castle)
\par         row[i] = '<SPAN style="color: #600"><B>'+ totWilds +'/'+ castle +'</b></span>';
\par       else
\par         row[i] = totWilds +'/'+ castle;
\par     \}
\par     str += _row ('# Wilds', row, true);
\par 
\par     row = [];
\par     for(i=0; i<Cities.numCities; i++) \{
\par       totKnights = 0;
\par       dat = Seed.knights['city'+ Cities.cities[i].id];
\par       for (k in dat)
\par         ++totKnights;
\par       row[i] = totKnights;
\par     \}
\par     str += _row ('# Knights', row, true);
\par 
\par     var now = unixTime();
\par     var row = [];
\par     for(i=0; i<Cities.numCities; i++) \{
\par       var totTrain = 0;
\par       cityID = 'city'+ Cities.cities[i].id;
\par       for (ii=0; ii<20; ii++)\{
\par         if (!Seed.queue_unt[cityID][ii])
\par           break;
\par         if (ii==0 && Seed.queue_unt[cityID][ii][2]<now)\{
\par           if (Seed.queue_unt[cityID][ii][3] < now)
\par             trainTime = 0;
\par           else
\par             trainTime = Seed.queue_unt[cityID][ii][3] - now;
\par         \} else \{
\par           trainTime = (Seed.queue_unt[cityID][ii][3] - Seed.queue_unt[cityID][ii][2]);
\par         \}
\par         totTrain += trainTime;
\par       \}
\par       row[i] = unsafeWindow.timestr(totTrain);
\par     \}
\par     rownum = 0;
\par     str += _row ('Training', row, true);
\par 
\par     str += '<TR><TD></td><TD colspan=4><BR><INPUT type=CHECKBOX id=idCheck'+ (Options.includeMarching?' CHECKED':'') +'>Include Marching Troops/Resources</td></tr>';
\par     str += '<TR><TD></td><TD colspan=4>Include Queued Troops (coming soon!)</td></tr>';
\par     str += "</table>";
\par     dt = new Date ();
\par     dt.setTime (Seed.player.datejoinUnixTime * 1000);
\par     str += '<BR>You have been playing since '+ dt.toLocaleDateString() +'<BR>';
\par     str += 'Might: ' + addCommas(Seed.player.might) +'<BR>';
\par     str += 'Alliance: ' + getMyAlliance()[1] +' &nbsp; Domain: '+ unsafeWindow.domainName +'<BR>';
\par 
\par     if (DEBUG_BUTTON)
\par       str += '<BR><BR><INPUT id=subSeed type=submit name="SEED" value="DEBUG">';
\par     my.Overview.cont.innerHTML = str;
\par     checkBox = document.getElementById('idCheck');
\par     checkBox.addEventListener('click', clickEnableMarch, false);
\par     if (DEBUG_BUTTON)\{
\par       subSeed = document.getElementById('subSeed');
\par       subSeed.addEventListener('click', clickDebug, false);
\par     \}
\par     t.displayTimer = setTimeout (t.show, 5000);
\par   \},
\par \};
\par 
\par /*************************************** ENCAMPED ************************************************/
\par 
\par my.Encamped = \{
\par   cont:null,
\par   displayTimer:null,
\par   
\par   init : function ()\{
\par     var t = my.Encamped;
\par     t.cont = document.createElement('div');
\par     return t.cont;
\par   \},
\par 
\par   getContent : function ()\{
\par     return my.Encamped.cont;
\par   \},
\par 
\par   hide : function ()\{
\par     clearTimeout (my.Encamped.displayTimer);
\par   \},
\par 
\par   show : function (cont)\{
\par     var rownum = 0;
\par     var names = ['Supply', 'Mil', 'Scout', 'Pike', 'Sword', 'Archer', 'Cav', 'Heavy', 'Wagon', 'Balli', 'Ram', 'Cat'];
\par     var t = my.Encamped;
\par     if (t.displayTimer != null)
\par       clearTimeout (t.displayTimer);
\par     function clickShowRemaining ()\{
\par       checkBox = document.getElementById('idCheck2');
\par       if (checkBox.checked)
\par         Options.encRemaining = false;
\par       else
\par         Options.encRemaining = true;
\par       t.show ();
\par     \}
\par     enc = \{\};
\par     numSlots = 0;
\par     if (matTypeof(Seed.queue_atkinc) != 'array')\{
\par       for (k in Seed.queue_atkinc)\{
\par         march = Seed.queue_atkinc[k];
\par         if (march.marchType == 2)\{
\par           ++numSlots;
\par           city = march.toCityId;
\par           from = march.fromPlayerId;
\par           if (!enc[city])
\par             enc[city] = \{\};
\par           if (!enc[city][from])
\par             enc[city][from] = [];
\par           s = [];
\par           s[0] = parseInt (march.knightCombat);
\par           for (i=1; i<13; i++)\{
\par             if (Options.encRemaining)
\par               s[i] = parseInt (march['unit'+ i +'Return']);
\par             else
\par               s[i] = parseInt (march['unit'+ i +'Count']);
\par           \}
\par           enc[city][from].push (s);
\par         \}
\par       \}
\par     \}
\par 
\par     s = '<div class=ptstat>Showing all of the troops encamped at each of your embassies.</div><BR>';
\par     if (numSlots == 0)\{
\par       s += '<BR><CENTER><B>No troops encamped.</b></center>';
\par     \} else \{
\par       s += '<STYLE> .tot\{background:#f0e0f8;\} .city\{background:#ffffaa;\}</style>';
\par       s += '<TABLE cellspacing=0 width=100%><TR align=right><TD align=left width=16%><B>Player (knight)</b></td>';
\par 
\par       for (k=0; k<names.length; k++)
\par         s += '<TD width=7%><B>' + names[k] + '</b></td>';
\par       s += '</tr>';
\par 
\par       tot = [];
\par       for (i=0; i<13; i++)
\par         tot[i] = 0;
\par       for (c in Cities.cities)\{
\par         dest = Cities.cities[c].id;
\par         if (enc[dest])\{
\par //logit (inspect (enc, 8,1, 2));
\par           s+= '<TR><TD class=xtab><BR></td></tr>';
\par           s+= '<TR><TD class="city" colspan=13 align=center><B>'+ Cities.cities[c].name +'</b></td></tr>';
\par           for (p in enc[dest])\{
\par             try \{
\par               player = Seed.players['u'+p].n;
\par             \} catch (err)\{
\par               player = '???';
\par             \}
\par             for (m=0; m<enc[dest][p].length; m++)\{
\par               knight = '';
\par               if (enc[dest][p][m][0] > 0)
\par                 knight = ' ('+ enc[dest][p][m][0] +')';
\par               s += '<TR align=right><TD align=left>'+ player + knight +'</td>'
\par               for (i=1; i<13; i++)\{
\par                 num = enc[dest][p][m][i];
\par                 s += '<TD>'+ num  +'</td>';
\par                 tot[i] += num;
\par               \}
\par               s += '</tr>';
\par 
\par             \}
\par           \}
\par         \}
\par       \}
\par       s += '<TR><TD colspan=13><BR><BR></td></tr><TR align=right><TD class="tot" align=left><B>TOTALS:</b></td>';
\par       for (i=1; i<13; i++)
\par         s+= '<TD class="tot">'+ tot[i] +'</td>';
\par       s += '</tr></table>';
\par     \}
\par 
\par     s += '<BR><BR><INPUT type=CHECKBOX id=idCheck2 '+ (Options.encRemaining?'':' CHECKED ') +'> Show Original Troops';
\par     s += '<BR><BR><DIV style="font-size: 10px">NOTE: You will need to refresh KofC to show new encampments or remaining troops after a battle.</div>';
\par     t.cont.innerHTML = s;
\par     checkBox = document.getElementById('idCheck2');
\par     checkBox.addEventListener('click', clickShowRemaining, false);
\par     t.displayTimer = setTimeout (t.show, 10000);
\par //logit ('encamped: '+ inspect (enc, 8, 1));
\par   \},
\par \};
\par 
\par 
\par /*****************************************************************
\par *****************************************************************/
\par 
\par 
\par function setTabStyle (e, selected)\{
\par   if (selected)\{
\par     e.className = 'matTabSel';
\par   \} else \{
\par     e.className = 'matTabNotSel';
\par   \}
\par \}
\par 
\par 
\par function clickedTab (e)\{
\par   td = document.getElementById('tdContent');
\par   who = e.target.id.substring(2);
\par   newObj = my[who];
\par   currentObj = my[currentName];
\par 
\par   if (currentName != who)\{
\par     setTabStyle (document.getElementById ('aa'+currentName), false);
\par     setTabStyle (document.getElementById ('aa'+who), true);
\par     if (currentObj)\{
\par       currentObj.hide ();
\par       currentObj.getContent().style.display = 'none';
\par     \}
\par     currentName = who;
\par     cont = newObj.getContent();
\par     newObj.getContent().style.display = 'block';
\par   \}
\par   newObj.show();
\par \}
\par 
\par 
\par function eventHideShow ()\{
\par   if (mainDiv.style.display == 'block')\{
\par     mainDiv.style.display = 'none';
\par     my[currentName].hide();
\par   \} else \{
\par     mainDiv.style.display = 'block';
\par     my[currentName].show();
\par   \}
\par \}
\par 
\par function hideMe ()\{
\par   mainDiv.style.display = 'none';
\par   my[currentName].hide();
\par \}
\par 
\par 
\par function addMyFunction (func)\{      // add function to run in our own scope
\par   unsafeWindow[func.name] = func;
\par \}
\par 
\par function addUwFunction (func)\{      // add function to run in unsafeWindow's scope
\par   scr = document.createElement('script');
\par \tab scr.innerHTML = func.toString();
\par \tab document.body.appendChild(scr);
\par \}
\par 
\par function alterUwFunction (funcName, frArray)\{
\par   try \{
\par     funcText = unsafeWindow[funcName].toString();
\par     rt = funcText.replace ('function '+funcName, 'function');
\par     for (i=0; i<frArray.length; i++)\{
\par       x = rt.replace(frArray[i][0], frArray[i][1]);
\par       if (x == rt)
\par         return false;
\par       rt = x;
\par     \}
\par     js = funcName +' = '+ rt;
\par   \tab var scr=document.createElement('script');
\par   \tab scr.innerHTML=js;
\par   \tab document.body.appendChild(scr);
\par   \tab return true;
\par   \} catch (err) \{
\par     return false;
\par   \}
\par \}
\par 
\par 
\par function addTab (label, id)\{
\par   var buts=document.getElementById('idButs');
\par   var a=document.createElement('a');
\par   a.className='matTabNotSel';
\par   a.id = 'aa'+id;
\par   a.innerHTML='<span id="sp'+ id +'" class="matTab">'+label+'</span>';
\par   buts.appendChild(a);
\par   a.addEventListener('click', clickedTab, false);
\par   return a;
\par \}
\par 
\par function setCities()\{
\par   Cities.numCities = Seed.cities.length;
\par //  Cities.curCityID = unsafeWindow.currentcityid;
\par   Cities.cities = [];
\par   Cities.byID = \{\};
\par   for (i=0; i<Cities.numCities; i++)\{
\par     city = \{\};
\par     city.idx = i;
\par     city.id = Seed.cities[i][0];
\par     city.name = Seed.cities[i][1];
\par     city.x = Seed.cities[i][2];
\par     city.y = Seed.cities[i][3];
\par     city.tileId = Seed.cities[i][5];
\par     Cities.cities[i] = city;
\par     Cities.byID[Seed.cities[i][0]] = city;
\par   \}
\par \}
\par 
\par 
\par function officerId2String (oid)\{
\par   if (oid==null)
\par     return '';
\par   else if (oid==3)
\par     return 'Officer';
\par   else if (oid==2)
\par     return 'Vice Chance';
\par   else if (oid==1)
\par     return 'Chancellor';
\par   return '';
\par \}
\par 
\par 
\par function DialogRetry (errMsg, seconds, onRetry, onCancel)\{
\par   seconds = parseInt(seconds);
\par   rdiv = document.getElementById ('RetryDialog');
\par   if (!rdiv)\{
\par     rdiv = document.createElement('div');
\par     kochead = unsafeWindow.document.getElementById('kochead');
\par     kochead.appendChild(rdiv);
\par     rdiv.id = 'RetryDialog';
\par     rdiv.style.background = "#fee";
\par     rdiv.style.border = "3px ridge #666";
\par     rdiv.style.zIndex = '200100';
\par     rdiv.style.width = '500px';
\par     rdiv.style.height = '200px';
\par     rdiv.style.position = "absolute";
\par     rdiv.style.top = "50px";
\par     rdiv.style.left = "115px";
\par     rdiv.innerHTML = '<DIV style="background: #cccccc"><CENTER>KOC Power Tools</div>\\
\par       <CENTER><BR><FONT COLOR=#550000><B>An error has ocurred:</b></font><BR><BR><DIV id=retryErrMsg></div>\\
\par       <BR><BR><B>Automatically retrying in <SPAN id=retrySeconds></b></span> seconds ...<BR><BR><INPUT id=retryCancel type=submit value="CANCEL Retry" \\>';
\par     document.getElementById('retryCancel').addEventListener ('click', doCancel, false);
\par   \}
\par   rdiv.style.display = 'block';
\par   document.getElementById('retryErrMsg').innerHTML = errMsg;
\par   document.getElementById('retrySeconds').innerHTML = seconds;
\par   rTimer = setTimeout (doRetry, seconds*1000);
\par   countdown ();
\par 
\par   function countdown ()\{
\par     document.getElementById('retrySeconds').innerHTML = seconds--;
\par     if (seconds > 0)
\par       cdTimer = setTimeout (countdown, 1000);
\par   \}
\par   function doCancel()\{
\par     clearTimeout (rTimer);
\par     clearTimeout (cdTimer);
\par     rdiv.style.display = 'none';
\par     onCancel ();
\par   \}
\par   function doRetry ()\{
\par     clearTimeout (rTimer);
\par     clearTimeout (cdTimer);
\par     rdiv.style.display = 'none';
\par     onRetry();
\par   \}
\par \}
\par 
\par function MyAjaxRequest (url, o, noRetryX)\{
\par if (DEBUG_TRACE) logit (" 0 myAjaxRequest: "+ url +"\\n" + inspect (o, 2, 1));
\par   var opts = Object.clone(o);       
\par //  var opts = unsafeWindow.Object.clone(o);        // ???
\par   var wasSuccess = o.onSuccess;
\par   var wasFailure = o.onFailure;
\par   var retry = 0;
\par   var delay = 5;
\par   var noRetry = noRetry===true?true:false;
\par   opts.onSuccess = mySuccess;
\par   opts.onFailure = myFailure;
\par   
\par if (DEBUG_TRACE) logit (" 1a myAjaxRequest: "+ url +"\\n" + inspect (o, 2, 1));
\par   new Ajax.Request(url, opts);
\par   return;
\par 
\par   function myRetry()\{
\par     ++retry;
\par     new Ajax.Request(url, opts);
\par     delay = delay * 1.25;
\par   \}
\par 
\par   function myFailure()\{
\par     var o = \{\};
\par if (DEBUG_TRACE) logit ("myAjaxRequest.myFailure(): "+ inspect(rslt, 1, 1));
\par     o.ok = false;
\par     o.errorMsg = "AJAX Communication Failure";
\par     wasFailure (o);
\par   \}
\par 
\par   function mySuccess (msg)\{
\par     var rslt = eval("(" + msg.responseText + ")");
\par     var x;
\par     if (rslt.updateSeed)
\par       unsafeWindow.update_seed(rslt.updateSeed);
\par     if (rslt.ok)\{
\par if (DEBUG_TRACE) logit (" 1b myAjaxRequest.mySuccess(): "+ inspect(rslt, 1, 1));
\par       wasSuccess (rslt);
\par       return;
\par     \}
\par if (DEBUG_TRACE) logit (" 1b myAjaxRequest.mySuccess() !ok : "+ inspect(rslt, 3, 1));
\par     rslt.errorMsg = unsafeWindow.printLocalError((rslt.error_code || null), (rslt.msg || null), (rslt.feedback || null));
\par     if ( (x = rslt.errorMsg.indexOf ('<br><br>')) > 0)
\par       rslt.errorMsg = rslt.errorMsg.substr (0, x-1);
\par     if (!noRetry && (rslt.error_code==0 ||rslt.error_code==8 || rslt.error_code==1 || rslt.error_code==3))\{
\par       DialogRetry (rslt.errorMsg, delay, function()\{myRetry()\}, function()\{wasSuccess (rslt)\});
\par     \} else \{
\par       wasSuccess (rslt);
\par     \}
\par   \}
\par \}
\par 
\par function getMyAlliance ()\{
\par   if (Seed.allianceDiplomacies==null || Seed.allianceDiplomacies.allianceName==null)
\par     return [0, 'None'];
\par   else
\par     return [Seed.allianceDiplomacies.allianceId, Seed.allianceDiplomacies.allianceName];
\par \}
\par 
\par function unixTime ()\{
\par   return parseInt (new Date().getTime() / 1000) + unsafeWindow.g_timeoff;
\par \}
\par 
\par 
\par /***
\par marchtype:  1: transport
\par             2: reinforce
\par             3: scout
\par             4: attack
\par             5: reassign
\par 
\par marchstatus 1: marching
\par             2: defending
\par             8: returning
\par             9: aborting
\par 
\par ***/
\par 
\par // TODO: Check times for expired marches !?!?!
\par // note: unselected city has outdated info
\par 
\par function getMarchInfo ()\{
\par   var ret = \{\};
\par 
\par   ret.marchUnits = [];
\par   ret.returnUnits = [];
\par   ret.resources = [];
\par   for (i=0; i<13; i++)\{
\par     ret.marchUnits[i] = 0;
\par     ret.returnUnits[i] = 0;
\par   \}
\par   for (i=0; i<5; i++)\{
\par     ret.resources[i] = 0;
\par   \}
\par 
\par   var now = unixTime();
\par 
\par   for(i=0; i<Cities.numCities; i++) \{   // each city
\par     cityID = 'city'+ Cities.cities[i].id;
\par     for (k in Seed.queue_atkp[cityID])\{   // each march
\par       march = Seed.queue_atkp[cityID][k];
\par       if (typeof (march) == 'object')\{
\par         for (ii=0; ii<13; ii++)\{
\par           ret.marchUnits[ii] += parseInt (march['unit'+ ii +'Count']);
\par           ret.returnUnits[ii] += parseInt (march['unit'+ ii +'Return']);
\par         \}
\par         for (ii=1; ii<5; ii++)\{
\par           ret.resources[ii] += parseInt (march['resource'+ ii]);
\par         \}
\par           ret.resources[0] += parseInt (march['gold']);
\par       \}
\par 
\par // TODO: fixup completed marches
\par // TODO: Assume transport is complete ?
\par 
\par     \}
\par   \}
\par   return ret;
\par \}
\par 
\par 
\par // returns \{count, maxlevel\}  
\par function getCityBuilding (cityId, buildingId)\{
\par   var b = Seed.buildings['city'+cityId];
\par   var ret = \{count:0, maxLevel:0\};  
\par   for (var i=1; i<33; i++)\{
\par     if (b['pos'+i] && b['pos'+i][0] == buildingId)\{
\par       ++ret.count;
\par       if (parseInt(b['pos'+i][1]) > ret.maxLevel)
\par         ret.maxLevel = parseInt(b['pos'+i][1]);
\par     \}
\par   \}
\par   return ret;
\par \}
\par 
\par function clickDebug()\{
\par   debugWin();
\par   var myseed = unsafeWindow.Object.clone (Seed);
\par   delete myseed.tech;
\par   delete myseed.tutorial;
\par   delete myseed.items;
\par   delete myseed.quests;
\par   delete myseed.wilderness;
\par   delete myseed.wildDef;
\par   delete myseed.buildings;
\par   delete myseed.knights;
\par   delete myseed.allianceDiplomacies;
\par   delete myseed.appFriends;
\par   delete myseed.players;
\par   debugTA.innerHTML = "seed @ "+ unixTime()  +" ("+ now +")\\n\\n"+ inspect (myseed, 8, 1);
\par   myseed=null;
\par \}
\par 
\par 
\par function addCommasInt(n)\{
\par   nStr = parseInt(n) + '';
\par   var rgx = /(\\d+)(\\d\{3\})/;
\par   while (rgx.test(nStr)) \{
\par     nStr = nStr.replace(rgx, '$1' + ',' + '$2');
\par   \}
\par   return nStr;
\par \}
\par 
\par function addCommas(nStr)\{
\par   nStr += '';
\par   x = nStr.split('.');
\par   x1 = x[0];
\par   x2 = x.length > 1 ? '.' + x[1] : '';
\par   var rgx = /(\\d+)(\\d\{3\})/;
\par   while (rgx.test(x1)) \{
\par     x1 = x1.replace(rgx, '$1' + ',' + '$2');
\par   \}
\par   return x1 + x2;
\par \}
\par 
\par 
\par function createPopup (content)\{
\par   div = document.createElement('div');
\par   var kochead = unsafeWindow.document.getElementById('kochead');
\par   kochead.appendChild(div);
\par   div.style.background = "#ffc";
\par   div.style.border = "3px ridge #666";
\par   div.style.zIndex = "200000";        // KOC modal is 100210 ?
\par   div.style.display = 'none';
\par   div.style.width = '720px';
\par   div.style.height = '700px';
\par   div.style.position = "relative";
\par   div.style.top = "0px";
\par   div.style.left = "15px";
\par   div.innerHTML = content;
\par   return div;
\par \}
\par 
\par 
\par function createPopup2 (content, width, height, zIndex)\{
\par   div = document.createElement('div');
\par   var kochead = unsafeWindow.document.getElementById('kochead');
\par   kochead.appendChild(div);
\par   div.style.background = "#ffc";
\par   div.style.border = "3px ridge #666";
\par   div.style.zIndex = zIndex+'';
\par   div.style.display = 'none';
\par   div.style.width = width+'px';
\par   div.style.height = height+'px';
\par   div.innerHTML = content;
\par   return div;
\par \}
\par 
\par 
\par // example: }{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "http://www150.kingdomsofcamelot.com"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 
00d0c9ea79f9bace118c8200aa004ba90b0200000003000000e0c9ea79f9bace118c8200aa004ba90b6200000068007400740070003a002f002f007700770077003100350030002e006b0069006e00670064006f006d0073006f006600630061006d0065006c006f0074002e0063006f006d002f000000795881f43b1d7f48
af2c825dc485276300000000a5ab000000}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 http://www150.kingdomsofcamelot.com}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 
\ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 
\par function GetServerId() \{
\par   var m=/^[a-zA-Z]+([0-9]+)\\./.exec(document.location.hostname);
\par   if(m)
\par     return m[1];
\par   return '';
\par \}
\par 
\par function logit (msg)\{
\par   var serverID = GetServerId();
\par   var now = new Date();
\par   GM_log (serverID +' @ '+ now.toTimeString().substring (0,8) +'.' + now.getMilliseconds() +': '+  msg);
\par \}
\par 
\par function createWindow (url, name, width, height) \{
\par   w = window.open(url, name, 'width='+width+',height='+height);
\par   return w;
\par \}
\par 
\par var winDebug = null;
\par var debugTA = null;
\par function debugWin()\{
\par   if (!winDebug || winDebug.closed)\{
\par     winDebug = createWindow ('', 'debug', 900, 700);
\par     winDebug.document.write ('<BR><TEXTAREA readonly id=debugTA cols=100 rows=40></textarea><BR>');
\par     debugTA = winDebug.document.getElementById ('debugTA');
\par   \}
\par   winDebug.focus();
\par \}
\par 
\par function saveOptions ()\{
\par   var serverID = GetServerId();
\par   GM_setValue ('Options_'+serverID, JSON2.stringify(Options));
\par \}
\par 
\par function readOptions ()\{
\par   var serverID = GetServerId();
\par   s = GM_getValue ('Options_'+serverID);
\par   if (s != null)\{
\par     opts = JSON2.parse (s);
\par     for (k in opts)
\par       Options[k] = opts[k];
\par   \}
\par \}
\par 
\par DebugTimer = \{
\par   startTime : 0,
\par   start : function ()\{
\par     now = new Date();
\par     this.startTime = now.getTime();
\par   \},
\par   display : function (label, noReset)\{
\par     now = new Date();
\par     elapsed = now.getTime() - this.startTime;
\par     logit (label +": "+ elapsed/1000);
\par     if (noReset===null || !noReset)
\par       this.startTime = now.getTime();
\par   \},
\par \};
\par 
\par 
\par 
\par 
\par 
\par function matTypeof (v)\{
\par   if (typeof (v) == 'object')\{
\par     if (!v)
\par       return 'null';
\par     else if (Object.prototype.toString.apply(v) === '[object Array]')
\par       return 'array';
\par     else return 'object';
\par   \}
\par   return typeof (v);
\par \}
\par 
\par function createButton (label)\{
\par   var a=document.createElement('a');
\par   a.className='button20';
\par   a.innerHTML='<span style="color: #ff6">'+ label +'</span>';
\par   return a; 
\par \}
\par 
\par function AddMainTabLink(text, eventListener) \{
\par   var a = createButton (text);
\par   a.className='tab';
\par   var tabs=document.getElementById('main_engagement_tabs');
\par   if(!tabs) \{
\par     tabs=document.getElementById('topnav_msg');
\par     if (tabs) 
\par       tabs=tabs.parentNode;
\par   \}
\par // TODO: Fit 'POW' button in main div if there's room (make room by shortening 'Invite Friends' to 'Invite' ?)
\par   if(tabs) \{
\par     var eNew = document.getElementById('gmTabs');
\par     if (eNew == null)\{
\par       eNew = document.createElement('div');
\par       eNew.className='tabs_engagement';
\par       eNew.style.background='#ca5';
\par       tabs.parentNode.insertBefore (eNew, tabs);
\par       eNew.id = 'gmTabs';
\par       eNew.style.whiteSpace='nowrap';
\par       eNew.style.width='735px';
\par     \}
\par     eNew.appendChild(a);
\par     a.addEventListener('click',eventListener, false);
\par     return a;
\par   \}
\par   window.setTimeout ( function ()\{AddMainTabLink (text, eventListener)\}, 2000);
\par   return null;
\par \}
\par 
\par function inspect(obj, maxLevels, level, doFunctions)\{
\par   var str = '', type, msg;
\par   if(level == null)  level = 0;
\par   if(maxLevels == null) maxLevels = 1;
\par   if(maxLevels < 1)
\par       return 'Inspect Error: Levels number must be > 0';
\par   if(obj == null)
\par     return 'ERROR: Object is NULL\\n';
\par   var indent = '';
\par   for (var i=0; i<level; i++)
\par     indent += '  ';
\par   for(property in obj) \{
\par     try \{
\par         type =  matTypeof(obj[property]);
\par         if (doFunctions==true && (type == 'function'))\{
\par           str += indent + '(' + type + ') ' + property + "[FUNCTION]\\n";
\par         \} else if (type != 'function') \{
\par           str += indent + '(' + type + ') ' + property + ( (obj[property]==null)?(': null'):('')) +' = '+ obj[property] +"\\n";
\par         \}
\par         if((type=='object' || type=='array') && (obj[property] != null) && (level+1 < maxLevels))
\par           str += inspect(obj[property], maxLevels, level+1, doFunctions);  // recurse
\par     \}
\par     catch(err) \{
\par       // Is there some properties in obj we can't access? Print it red.
\par       if(typeof(err) == 'string') msg = err;
\par       else if(err.message)        msg = err.message;
\par       else if(err.description)    msg = err.description;
\par       else                        msg = 'Unknown';
\par       str += '(Error) ' + property + ': ' + msg +"\\n";
\par     \}
\par   \}
\par   str += "\\n";
\par   return str;
\par \}
\par 
\par 
\par /**********************************************************************************/
\par 
\par // Simple method, as if it were typed in thru DOM
\par function sendChat (msg)\{
\par   document.getElementById ("mod_comm_input").value = msg;
\par   unsafeWindow.Chat.sendChat ();
\par \}
\par 
\par // works well, but message is not echoed back to local client
\par Chat = \{
\par   params : null,
\par       
\par   sendWhisper : function (msg, who, notify)\{
\par     this.params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     this.params.ctype = 3;
\par     this.params.name = who;
\par     this._sendit (msg, notify);
\par   \},
\par   
\par   sendGlobal : function (msg, notify)\{
\par     this.params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     this.params.ctype = 1;
\par     this._sendit (msg, notify);
\par   \},
\par   
\par   sendAlliance : function (msg, notify)\{
\par     this.params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par     this.params.ctype = 2;
\par     this._sendit (msg, notify);
\par   \},
\par   
\par   _sendit : function (msg, notify)\{  
\par     function strip(s) \{
\par        return s.replace(/^\\s+/, '').replace(/\\s+$/, '');
\par     \}
\par     this.params.comment = strip (msg);
\par     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/sendChat.php" + unsafeWindow.g_ajaxsuffix, \{
\par       method: "post",
\par       parameters: this.params,
\par       onSuccess: function(transport) \{
\par         if (notify)
\par           notify ();
\par       \},  
\par       onFailure: function(transport) \{
\par         if (notify)
\par           notify ();
\par       \}  
\par     \});
\par   \},
\par \}
\par 
\par function doTrain (cityId, unitId, num, notify)\{
\par   var time = unsafeWindow.modal_barracks_traintime(unitId, num);
\par   var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par   params.cid = cityId;
\par   params.type = unitId;
\par   params.quant = num;
\par   params.items = 0;
\par 
\par   new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/train.php" + unsafeWindow.g_ajaxsuffix, \{
\par     method: "post",
\par     parameters: params,
\par     onSuccess: function(rslt) \{
\par       if (rslt.ok) \{
\par //logit (inspect (rslt, 8, 1));        
\par         for (var i = 1; i < 5; i++) \{
\par           unsafeWindow.seed.resources["city" + cityId]["rec" + i][0] = parseInt(unsafeWindow.seed.resources["city" + cityId]["rec" + i][0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][i]) * 3600 * parseInt(num)
\par         \}
\par         unsafeWindow.seed.citystats["city" + cityId].gold[0] = parseInt(unsafeWindow.seed.citystats["city" + cityId].gold[0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][5]) * parseInt(num);
\par         unsafeWindow.seed.citystats["city" + cityId].pop[0] = parseInt(unsafeWindow.seed.citystats["city" + cityId].pop[0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][6]) * parseInt(num);
\par         unsafeWindow.seed.queue_unt["city" + cityId].push([unitId, num, rslt.initTS, parseInt(rslt.initTS) + time, 0, time, null]);
\par         if (notify != null)
\par           setTimeout (function ()\{notify(null);\}, 500);
\par       \} else \{
\par         if (notify != null)\{
\par           setTimeout (function ()\{notify(null);\}, 500);
\par         \}
\par       \}
\par     \},
\par     onFailure: function(o) \{
\par       if (notify != null)
\par         notify(rslt.errorMsg);
\par     \}
\par   \})
\par \}
\par 
\par 
\par 
\par /***********************************************************************************************************
\par function MYupdate_seed_ajax(marchForceUpdateFlag, updateSeedDoneCallback) \{
\par     if (g_update_seed_ajax_do) \{
\par         return false
\par     \}
\par     g_update_seed_ajax_do = true;
\par     var params = Object.clone(g_ajaxparams);
\par     if (marchForceUpdateFlag) \{
\par         params.forceUpdate = true
\par     \} else \{
\par         params.forceUpdate = false
\par     \}
\par     new Ajax.Request(g_ajaxpath + "ajax/updateSeed.php" + g_ajaxsuffix, \{
\par         method: "post",
\par         parameters: params,
\par         onSuccess: function (message) \{
\par             g_update_seed_ajax_do = false;
\par             var rslt = eval("(" + message.responseText + ")");
\par             if (rslt.ok) \{
\par                 if (rslt.victoryTokenId) \{
\par                     pop_treasure_chest_modal(rslt.victoryTokenId.m)
\par                 \}
\par                 if (rslt.updateMarch) \{
\par                     update_march(rslt.updateMarch)
\par                 \}
\par                 if (rslt.updateInventory) \{
\par                     update_inventory(rslt.updateInventory)
\par                 \}
\par                 if (rslt.updateWildDef) \{
\par                     update_wild_def(rslt.updateWildDef)
\par                 \}
\par                 if (rslt.updateSeed) \{
\par                     update_seed(rslt.updateSeed)
\par                 \}
\par                 var msgbug = false;
\par                 if (rslt.additionalNewTradeReportCnt) \{
\par                     seed.newTradeReports = parseInt(seed.newTradeReports) + parseInt(rslt.additionalNewTradeReportCnt);
\par                     msgbug = true
\par                 \}
\par                 if (rslt.newReportCount) \{
\par                     seed.newReportCount = parseInt(rslt.newReportCount);
\par                     seed.newDisasterReportCount = parseInt(rslt.newDisasterReportCount);
\par                     msgbug = true
\par                 \}
\par                 if (rslt.newMailCount) \{
\par                     seed.newMailCount = parseInt(rslt.newMailCount);
\par                     msgbug = true
\par                 \}
\par                 if (msgbug) \{
\par                     messages_notify_bug()
\par                 \}
\par                 if (rslt.updateHelpConstruct) \{
\par                     update_help_construct(rslt.updateHelpConstruct)
\par                 \}
\par                 if (rslt.updateHelpResearch) \{
\par                     update_help_research(rslt.updateHelpResearch)
\par                 \}
\par                 if (rslt.allianceDiplomacies) \{
\par                     seed.allianceDiplomacies = rslt.allianceDiplomacies
\par                 \}
\par                 if (rslt.updateMight) \{
\par                     seed.player.might = parseInt(rslt.updateMight);
\par                     update_might()
\par                 \}
\par                 if (rslt.updateCityUnits) \{
\par                     update_cityUnits(rslt.updateCityUnits)
\par                 \}
\par                 if (updateSeedDoneCallback) \{
\par                     updateSeedDoneCallback()
\par                 \}
\par             \}
\par             arthurCheck(rslt.arthurCheckArray)
\par         \},
\par         onFailure: function () \{
\par             g_update_seed_ajax_do = false
\par         \}
\par     \})
\par \}
\par ******************************************************************************************************************/
\par 
\par 
\par 
\par 
\par function doCancelTrain (cityId, queIndex, notify)\{
\par //logit ("doCancelTrain(): "+ queIndex);
\par   var q = unsafeWindow.seed.queue_unt["city" + cityId][queIndex];
\par   typetrn = q[0];
\par   numtrptrn = q[1];
\par   trnETA= q[3];
\par   trnTmp= q[2];
\par   trnNeeded = q[5];
\par   var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
\par   params.requestType = "CANCEL_TRAINING";
\par   params.cityId = cityId;
\par   params.typetrn = typetrn;
\par   params.numtrptrn = numtrptrn;
\par   params.trnETA = trnETA;
\par   params.trnTmp = trnTmp;
\par   params.trnNeeded = trnNeeded;
\par 
\par if (DEBUG_TRACE_CTRAIN) logit ("doCancelTrain ("+ queIndex +"):\\n"+ inspect (unsafeWindow.seed.queue_unt["city" + cityId], 2, 1));
\par 
\par   ajaxURL = unsafeWindow.g_ajaxpath + "ajax/cancelTraining.php" + unsafeWindow.g_ajaxsuffix;
\par   ajaxObj = \{
\par     method: "post",
\par     parameters: params,
\par     onSuccess: function(rslt) \{
\par       if (rslt.ok || rslt.error_code==131 ) \{       // OR ERROR 131 ?????
\par         
\par if (DEBUG_TRACE_CTRAIN) logit ("RESULT: "+ inspect (rslt, 8, 1));        
\par         
\par         unsafeWindow.update_seed_ajax(true, function() \{
\par //        unsafeWindow.MYupdate_seed_ajax(true, function() \{
\par if (DEBUG_TRACE_CTRAIN) logit ("BACK FROM  MYupdate_seed_ajax");         
\par           var k = 0;
\par           for (var j = 0; j < unsafeWindow.seed.queue_unt["city" + cityId].length; j++) \{
\par             if (j > queIndex) \{
\par               unsafeWindow.seed.queue_unt["city" + cityId][j][2] = parseInt(rslt.dateTraining[k]["start"]);
\par               unsafeWindow.seed.queue_unt["city" + cityId][j][3] = parseInt(rslt.dateTraining[k]["end"]);
\par               k++
\par             \}
\par           \}
\par           unsafeWindow.seed.queue_unt["city" + cityId].splice(queIndex, 1);
\par if (DEBUG_TRACE_CTRAIN) logit ("After Splice ("+ queIndex +"):\\n"+ inspect (unsafeWindow.seed.queue_unt["city" + cityId], 2, 1));
\par           for (var i = 1; i < 5; i++) \{
\par             var totalReturn = parseInt(unsafeWindow.unitcost["unt" + typetrn][i]) * parseInt(numtrptrn) * 3600 / 2;
\par             unsafeWindow.seed.resources["city" + cityId]["rec" + i][0] = parseInt(unsafeWindow.seed.resources["city" + cityId]["rec" + i][0]) + totalReturn
\par           \}
\par         \});
\par         
\par         if (notify != null)
\par           setTimeout (function ()\{notify(null);\}, CANCEL_TRAINING_DELAY);
\par       \} else \{
\par logit ("********  COPY THIS MESSAGE FOR George Jetson!  *******\\nqueueIndex: "+ queIndex +"  City: "+ cityId +"  Speed: "+  my.Train4x.trainSpeed +"\\n"+ inspect (rslt, 2, 1) + inspect (unsafeWindow.seed.queue_unt["city" + cityId], 2, 1));
\par         if (notify != null)\{
\par           if (rslt.error_code == 131)        // Ignore error 131 ???  ("Cancellation can not be done at this time")
\par             setTimeout (function ()\{notify(null);\}, CANCEL_TRAINING_DELAY);
\par           else
\par             notify(rslt.errorMsg);
\par         \} 
\par       \}
\par     \},
\par     onFailure: function(eMsg) \{
\par       if (notify != null)
\par         notify(rslt.errorMsg);
\par     \}
\par   \};
\par 
\par   new MyAjaxRequest (ajaxURL, ajaxObj);
\par \}
\par 
\par 
\par 
\par 
\par 
\par /*  Prototype JavaScript framework, version 1.6.1
\par  *  (c) 2005-2009 Sam Stephenson
\par  *
\par  *  Prototype is freely distributable under the terms of an MIT-style license.
\par  *  For details, see the Prototype web site: }{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "http://www.prototypejs.org/"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 
00d0c9ea79f9bace118c8200aa004ba90b0200000003000000e0c9ea79f9bace118c8200aa004ba90b5000000068007400740070003a002f002f007700770077002e00700072006f0074006f0074007900700065006a0073002e006f00720067002f000000795881f43b1d7f48af2c825dc485276300000000a5ab000002}}
}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 http://www.prototypejs.org/}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 
\par  *
\par  *--------------------------------------------------------------------------*/
\par 
\par var Prototype = \{
\par   Version: '1.6.1',
\par 
\par   Browser: (function()\{
\par     var ua = navigator.userAgent;
\par     var isOpera = Object.prototype.toString.call(window.opera) == '[object Opera]';
\par     return \{
\par       IE:             !!window.attachEvent && !isOpera,
\par       Opera:          isOpera,
\par       WebKit:         ua.indexOf('AppleWebKit/') > -1,
\par       Gecko:          ua.indexOf('Gecko') > -1 && ua.indexOf('KHTML') === -1,
\par       MobileSafari:   /Apple.*Mobile.*Safari/.test(ua)
\par     \}
\par   \})(),
\par 
\par   BrowserFeatures: \{
\par     XPath: !!document.evaluate,
\par     SelectorsAPI: !!document.querySelector,
\par     ElementExtensions: (function() \{
\par       var constructor = window.Element || window.HTMLElement;
\par       return !!(constructor && constructor.prototype);
\par     \})(),
\par     SpecificElementExtensions: (function() \{
\par       if (typeof window.HTMLDivElement !== 'undefined')
\par         return true;
\par 
\par       var div = document.createElement('div');
\par       var form = document.createElement('form');
\par       var isSupported = false;
\par 
\par       if (div['__proto__'] && (div['__proto__'] !== form['__proto__'])) \{
\par         isSupported = true;
\par       \}
\par 
\par       div = form = null;
\par 
\par       return isSupported;
\par     \})()
\par   \},
\par 
\par   ScriptFragment: '<script[^>]*>([\\\\S\\\\s]*?)<\\/script>',
\par   JSONFilter: /^\\/\\*-secure-([\\s\\S]*)\\*\\/\\s*$/,
\par 
\par   emptyFunction: function() \{ \},
\par   K: function(x) \{ return x \}
\par \};
\par 
\par if (Prototype.Browser.MobileSafari)
\par   Prototype.BrowserFeatures.SpecificElementExtensions = false;
\par 
\par 
\par var Abstract = \{ \};
\par 
\par 
\par var Try = \{
\par   these: function() \{
\par     var returnValue;
\par 
\par     for (var i = 0, length = arguments.length; i < length; i++) \{
\par       var lambda = arguments[i];
\par       try \{
\par         returnValue = lambda();
\par         break;
\par       \} catch (e) \{ \}
\par     \}
\par 
\par     return returnValue;
\par   \}
\par \};
\par 
\par /* Based on Alex Arnell's inheritance implementation. */
\par 
\par var Class = (function() \{
\par   function subclass() \{\};
\par   function create() \{
\par     var parent = null, properties = $A(arguments);
\par     if (Object.isFunction(properties[0]))
\par       parent = properties.shift();
\par 
\par     function klass() \{
\par       this.initialize.apply(this, arguments);
\par     \}
\par 
\par     Object.extend(klass, Class.Methods);
\par     klass.superclass = parent;
\par     klass.subclasses = [];
\par 
\par     if (parent) \{
\par       subclass.prototype = parent.prototype;
\par       klass.prototype = new subclass;
\par       parent.subclasses.push(klass);
\par     \}
\par 
\par     for (var i = 0; i < properties.length; i++)
\par       klass.addMethods(properties[i]);
\par 
\par     if (!klass.prototype.initialize)
\par       klass.prototype.initialize = Prototype.emptyFunction;
\par 
\par     klass.prototype.constructor = klass;
\par     return klass;
\par   \}
\par 
\par   function addMethods(source) \{
\par     var ancestor   = this.superclass && this.superclass.prototype;
\par     var properties = Object.keys(source);
\par 
\par     if (!Object.keys(\{ toString: true \}).length) \{
\par       if (source.toString != Object.prototype.toString)
\par         properties.push("toString");
\par       if (source.valueOf != Object.prototype.valueOf)
\par         properties.push("valueOf");
\par     \}
\par 
\par     for (var i = 0, length = properties.length; i < length; i++) \{
\par       var property = properties[i], value = source[property];
\par       if (ancestor && Object.isFunction(value) &&
\par           value.argumentNames().first() == "$super") \{
\par         var method = value;
\par         value = (function(m) \{
\par           return function() \{ return ancestor[m].apply(this, arguments); \};
\par         \})(property).wrap(method);
\par 
\par         value.valueOf = method.valueOf.bind(method);
\par         value.toString = method.toString.bind(method);
\par       \}
\par       this.prototype[property] = value;
\par     \}
\par 
\par     return this;
\par   \}
\par 
\par   return \{
\par     create: create,
\par     Methods: \{
\par       addMethods: addMethods
\par     \}
\par   \};
\par \})();
\par (function() \{
\par 
\par   var _toString = Object.prototype.toString;
\par 
\par   function extend(destination, source) \{
\par     for (var property in source)\{
\par     \tab destination[property] = source[property];
\par     \}
\par     return destination;
\par   \}
\par 
\par   function inspect(object) \{
\par     try \{
\par       if (isUndefined(object)) return 'undefined';
\par       if (object === null) return 'null';
\par       return object.inspect ? object.inspect() : String(object);
\par     \} catch (e) \{
\par       if (e instanceof RangeError) return '...';
\par       throw e;
\par     \}
\par   \}
\par 
\par   function toJSON(object) \{
\par     var type = typeof object;
\par     switch (type) \{
\par       case 'undefined':
\par       case 'function':
\par       case 'unknown': return;
\par       case 'boolean': return object.toString();
\par     \}
\par 
\par     if (object === null) return 'null';
\par     if (object.toJSON) return object.toJSON();
\par     if (isElement(object)) return;
\par 
\par     var results = [];
\par     for (var property in object) \{
\par       var value = toJSON(object[property]);
\par       if (!isUndefined(value))
\par         results.push(property.toJSON() + ': ' + value);
\par     \}
\par 
\par     return '\{' + results.join(', ') + '\}';
\par   \}
\par 
\par   function toQueryString(object) \{
\par     return $H(object).toQueryString();
\par   \}
\par 
\par   function toHTML(object) \{
\par     return object && object.toHTML ? object.toHTML() : String.interpret(object);
\par   \}
\par 
\par   function keys(object) \{
\par     var results = [];
\par     for (var property in object)
\par       results.push(property);
\par     return results;
\par   \}
\par 
\par   function values(object) \{
\par     var results = [];
\par     for (var property in object)
\par       results.push(object[property]);
\par     return results;
\par   \}
\par 
\par   function clone(object) \{
\par     return extend(\{ \}, object);
\par   \}
\par 
\par   //Changed 5/10/2010 to accomodate feeds at Level 2
\par   function cloneFeed(sourceObj) \{
\par   \tab var returnObject = \{\};
\par   \tab for (var i in sourceObj) \{
\par   \tab \tab if (Object.isArray(sourceObj[i])) \{
\par   \tab \tab \tab returnObject[i] = new Array();
\par   \tab \tab \tab for (var j=0;j<sourceObj[i].length;j++) \{
\par   \tab \tab \tab \tab returnObject[i].push(Object.clone(sourceObj[i][j]));
\par   \tab \tab \tab \}
\par   \tab \tab \} else if (typeof sourceObj[i]=='object') \{
\par   \tab \tab \tab returnObject[i] = Object.clone(sourceObj[i]);
\par   \tab \tab \} else \{
\par   \tab \tab \tab returnObject[i] = sourceObj[i];
\par   \tab \tab \}
\par   \tab \}
\par   \tab return returnObject;
\par   \}
\par 
\par   function isElement(object) \{
\par     return !!(object && object.nodeType == 1);
\par   \}
\par 
\par   function isArray(object) \{
\par     return _toString.call(object) == "[object Array]";
\par   \}
\par 
\par 
\par   function isHash(object) \{
\par     return object instanceof Hash;
\par   \}
\par 
\par   function isFunction(object) \{
\par     return typeof object === "function";
\par   \}
\par 
\par   function isString(object) \{
\par     return _toString.call(object) == "[object String]";
\par   \}
\par 
\par   function isNumber(object) \{
\par     return _toString.call(object) == "[object Number]";
\par   \}
\par 
\par   function isUndefined(object) \{
\par     return typeof object === "undefined";
\par   \}
\par 
\par   extend(Object, \{
\par     extend:        extend,
\par     inspect:       inspect,
\par     toJSON:        toJSON,
\par     toQueryString: toQueryString,
\par     toHTML:        toHTML,
\par     keys:          keys,
\par     values:        values,
\par     clone:         clone,
\par     cloneFeed:     cloneFeed,
\par     isElement:     isElement,
\par     isArray:       isArray,
\par     isHash:        isHash,
\par     isFunction:    isFunction,
\par     isString:      isString,
\par     isNumber:      isNumber,
\par     isUndefined:   isUndefined
\par   \});
\par \})();
\par Object.extend(Function.prototype, (function() \{
\par   var slice = Array.prototype.slice;
\par 
\par   function update(array, args) \{
\par     var arrayLength = array.length, length = args.length;
\par     while (length--) array[arrayLength + length] = args[length];
\par     return array;
\par   \}
\par 
\par   function merge(array, args) \{
\par     array = slice.call(array, 0);
\par     return update(array, args);
\par   \}
\par 
\par   function argumentNames() \{
\par     var names = this.toString().match(/^[\\s\\(]*function[^(]*\\(([^)]*)\\)/)[1]
\par       .replace(/\\/\\/.*?[\\r\\n]|\\/\\*(?:.|[\\r\\n])*?\\*\\//g, '')
\par       .replace(/\\s+/g, '').split(',');
\par     return names.length == 1 && !names[0] ? [] : names;
\par   \}
\par 
\par   function bind(context) \{
\par     if (arguments.length < 2 && Object.isUndefined(arguments[0])) return this;
\par     var __method = this, args = slice.call(arguments, 1);
\par     return function() \{
\par       var a = merge(args, arguments);
\par       return __method.apply(context, a);
\par     \}
\par   \}
\par 
\par   function bindAsEventListener(context) \{
\par     var __method = this, args = slice.call(arguments, 1);
\par     return function(event) \{
\par       var a = update([event || window.event], args);
\par       return __method.apply(context, a);
\par     \}
\par   \}
\par 
\par   function curry() \{
\par     if (!arguments.length) return this;
\par     var __method = this, args = slice.call(arguments, 0);
\par     return function() \{
\par       var a = merge(args, arguments);
\par       return __method.apply(this, a);
\par     \}
\par   \}
\par 
\par   function delay(timeout) \{
\par     var __method = this, args = slice.call(arguments, 1);
\par     timeout = timeout * 1000
\par     return window.setTimeout(function() \{
\par       return __method.apply(__method, args);
\par     \}, timeout);
\par   \}
\par 
\par   function defer() \{
\par     var args = update([0.01], arguments);
\par     return this.delay.apply(this, args);
\par   \}
\par 
\par   function wrap(wrapper) \{
\par     var __method = this;
\par     return function() \{
\par       var a = update([__method.bind(this)], arguments);
\par       return wrapper.apply(this, a);
\par     \}
\par   \}
\par 
\par   function methodize() \{
\par     if (this._methodized) return this._methodized;
\par     var __method = this;
\par     return this._methodized = function() \{
\par       var a = update([this], arguments);
\par       return __method.apply(null, a);
\par     \};
\par   \}
\par 
\par   return \{
\par     argumentNames:       argumentNames,
\par     bind:                bind,
\par     bindAsEventListener: bindAsEventListener,
\par     curry:               curry,
\par     delay:               delay,
\par     defer:               defer,
\par     wrap:                wrap,
\par     methodize:           methodize
\par   \}
\par \})());
\par 
\par 
\par Date.prototype.toJSON = function() \{
\par   return '"' + this.getUTCFullYear() + '-' +
\par     (this.getUTCMonth() + 1).toPaddedString(2) + '-' +
\par     this.getUTCDate().toPaddedString(2) + 'T' +
\par     this.getUTCHours().toPaddedString(2) + ':' +
\par     this.getUTCMinutes().toPaddedString(2) + ':' +
\par     this.getUTCSeconds().toPaddedString(2) + 'Z"';
\par \};
\par 
\par 
\par RegExp.prototype.match = RegExp.prototype.test;
\par 
\par RegExp.escape = function(str) \{
\par   return String(str).replace(/([.*+?^=!:$\{\}()|[\\]\\/\\\\])/g, '}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\$1"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000050000005c005c0024003100000006}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\$1}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ');
\par \};
\par var PeriodicalExecuter = Class.create(\{
\par   initialize: function(callback, frequency) \{
\par     this.callback = callback;
\par     this.frequency = frequency;
\par     this.currentlyExecuting = false;
\par 
\par     this.registerCallback();
\par   \},
\par 
\par   registerCallback: function() \{
\par     this.timer = setInterval(this.onTimerEvent.bind(this), this.frequency * 1000);
\par   \},
\par 
\par   execute: function() \{
\par     this.callback(this);
\par   \},
\par 
\par   stop: function() \{
\par     if (!this.timer) return;
\par     clearInterval(this.timer);
\par     this.timer = null;
\par   \},
\par 
\par   onTimerEvent: function() \{
\par     if (!this.currentlyExecuting) \{
\par       try \{
\par         this.currentlyExecuting = true;
\par         this.execute();
\par         this.currentlyExecuting = false;
\par       \} catch(e) \{
\par         this.currentlyExecuting = false;
\par         throw e;
\par       \}
\par     \}
\par   \}
\par \});
\par Object.extend(String, \{
\par   interpret: function(value) \{
\par     return value == null ? '' : String(value);
\par   \},
\par   specialChar: \{
\par     '\\b': '}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\b"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 
{\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000040000005c005c006200000000}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\b}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {
\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ',
\par     '\\t': '}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\t"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 
{\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000040000005c005c007400000000}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\t}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {
\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ',
\par     '\\n': '}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\n"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 
{\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000040000005c005c006e00000001}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\n}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {
\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ',
\par     '\\f': '}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\f"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 
{\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000040000005c005c006600000000}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\f}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {
\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ',
\par     '\\r': '}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\r"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 
{\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000040000005c005c0072000000ff}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\r}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {
\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ',
\par     '\\\\': '}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\\\\\\\\\"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 
{\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000050000005c005c005c005c00000036}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\\\\\}}}\sectd \ltrsect
\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 '
\par   \}
\par \});
\par 
\par Object.extend(String.prototype, (function() \{
\par 
\par   function prepareReplacement(replacement) \{
\par     if (Object.isFunction(replacement)) return replacement;
\par     var template = new Template(replacement);
\par     return function(match) \{ return template.evaluate(match) \};
\par   \}
\par 
\par   function gsub(pattern, replacement) \{
\par     var result = '', source = this, match;
\par     replacement = prepareReplacement(replacement);
\par 
\par     if (Object.isString(pattern))
\par       pattern = RegExp.escape(pattern);
\par 
\par     if (!(pattern.length || pattern.source)) \{
\par       replacement = replacement('');
\par       return replacement + source.split('').join(replacement) + replacement;
\par     \}
\par 
\par     while (source.length > 0) \{
\par       if (match = source.match(pattern)) \{
\par         result += source.slice(0, match.index);
\par         result += String.interpret(replacement(match));
\par         source  = source.slice(match.index + match[0].length);
\par       \} else \{
\par         result += source, source = '';
\par       \}
\par     \}
\par     return result;
\par   \}
\par 
\par   function sub(pattern, replacement, count) \{
\par     replacement = prepareReplacement(replacement);
\par     count = Object.isUndefined(count) ? 1 : count;
\par 
\par     return this.gsub(pattern, function(match) \{
\par       if (--count < 0) return match[0];
\par       return replacement(match);
\par     \});
\par   \}
\par 
\par   function scan(pattern, iterator) \{
\par     this.gsub(pattern, iterator);
\par     return String(this);
\par   \}
\par 
\par   function truncate(length, truncation) \{
\par     length = length || 30;
\par     truncation = Object.isUndefined(truncation) ? '...' : truncation;
\par     return this.length > length ?
\par       this.slice(0, length - truncation.length) + truncation : String(this);
\par   \}
\par 
\par   function strip() \{
\par     return this.replace(/^\\s+/, '').replace(/\\s+$/, '');
\par   \}
\par 
\par   function stripTags() \{
\par     return this.replace(/<\\w+(\\s+("[^"]*"|'[^']*'|[^>])+)?>|<\\/\\w+>/gi, '');
\par   \}
\par 
\par   function stripScripts() \{
\par     return this.replace(new RegExp(Prototype.ScriptFragment, 'img'), '');
\par   \}
\par 
\par   function extractScripts() \{
\par     var matchAll = new RegExp(Prototype.ScriptFragment, 'img');
\par     var matchOne = new RegExp(Prototype.ScriptFragment, 'im');
\par     return (this.match(matchAll) || []).map(function(scriptTag) \{
\par       return (scriptTag.match(matchOne) || ['', ''])[1];
\par     \});
\par   \}
\par 
\par   function evalScripts() \{
\par     return this.extractScripts().map(function(script) \{ return eval(script) \});
\par   \}
\par 
\par   function escapeHTML() \{
\par     return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
\par   \}
\par 
\par   function unescapeHTML() \{
\par     return this.stripTags().replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&');
\par   \}
\par 
\par 
\par   function toQueryParams(separator) \{
\par     var match = this.strip().match(/([^?#]*)(#.*)?$/);
\par     if (!match) return \{ \};
\par 
\par     return match[1].split(separator || '&').inject(\{ \}, function(hash, pair) \{
\par       if ((pair = pair.split('='))[0]) \{
\par         var key = decodeURIComponent(pair.shift());
\par         var value = pair.length > 1 ? pair.join('=') : pair[0];
\par         if (value != undefined) value = decodeURIComponent(value);
\par 
\par         if (key in hash) \{
\par           if (!Object.isArray(hash[key])) hash[key] = [hash[key]];
\par           hash[key].push(value);
\par         \}
\par         else hash[key] = value;
\par       \}
\par       return hash;
\par     \});
\par   \}
\par 
\par   function toArray() \{
\par     return this.split('');
\par   \}
\par 
\par   function succ() \{
\par     return this.slice(0, this.length - 1) +
\par       String.fromCharCode(this.charCodeAt(this.length - 1) + 1);
\par   \}
\par 
\par   function times(count) \{
\par     return count < 1 ? '' : new Array(count + 1).join(this);
\par   \}
\par 
\par   function camelize() \{
\par     var parts = this.split('-'), len = parts.length;
\par     if (len == 1) return parts[0];
\par 
\par     var camelized = this.charAt(0) == '-'
\par       ? parts[0].charAt(0).toUpperCase() + parts[0].substring(1)
\par       : parts[0];
\par 
\par     for (var i = 1; i < len; i++)
\par       camelized += parts[i].charAt(0).toUpperCase() + parts[i].substring(1);
\par 
\par     return camelized;
\par   \}
\par 
\par   function capitalize() \{
\par     return this.charAt(0).toUpperCase() + this.substring(1).toLowerCase();
\par   \}
\par 
\par   function underscore() \{
\par     return this.replace(/::/g, '/')
\par                .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')
\par                .replace(/([a-z\\d])([A-Z])/g, '$1_$2')
\par                .replace(/-/g, '_')
\par                .toLowerCase();
\par   \}
\par 
\par   function dasherize() \{
\par     return this.replace(/_/g, '-');
\par   \}
\par 
\par   function inspect(useDoubleQuotes) \{
\par     var escapedString = this.replace(/[\\x00-\\x1f\\\\]/g, function(character) \{
\par       if (character in String.specialChar) \{
\par         return String.specialChar[character];
\par       \}
\par       return '}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\u00"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 
{\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000060000005c005c00750030003000000001}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\u00}}}\sectd \ltrsect
\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ' + character.charCodeAt().toPaddedString(2, 16);
\par     \});
\par     if (useDoubleQuotes) return '"' + escapedString.replace(/"/g, '}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\""}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000030000005c005c00000000}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\"}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ') + '"';
\par     return "'" + escapedString.replace(/'/g, '}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\\\\\'"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000050000005c005c005c002700000006}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\\\'}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ') + "'";
\par   \}
\par 
\par   function toJSON() \{
\par     return this.inspect(true);
\par   \}
\par 
\par   function unfilterJSON(filter) \{
\par     return this.replace(filter || Prototype.JSONFilter, '$1');
\par   \}
\par 
\par   function isJSON() \{
\par     var str = this;
\par     if (str.blank()) return false;
\par     str = this.replace(/\\\\./g, '@').replace(/"[^"\\\\\\n\\r]*"/g, '');
\par     return (/^[,:\{\}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t]*$/).test(str);
\par   \}
\par 
\par   function evalJSON(sanitize) \{
\par     var json = this.unfilterJSON();
\par     try \{
\par       if (!sanitize || json.isJSON()) return eval('(' + json + ')');
\par     \} catch (e) \{ \}
\par     throw new SyntaxError('Badly formed JSON string: ' + this.inspect());
\par   \}
\par 
\par   function include(pattern) \{
\par     return this.indexOf(pattern) > -1;
\par   \}
\par 
\par   function startsWith(pattern) \{
\par     return this.indexOf(pattern) === 0;
\par   \}
\par 
\par   function endsWith(pattern) \{
\par     var d = this.length - pattern.length;
\par     return d >= 0 && this.lastIndexOf(pattern) === d;
\par   \}
\par 
\par   function empty() \{
\par     return this == '';
\par   \}
\par 
\par   function blank() \{
\par     return /^\\s*$/.test(this);
\par   \}
\par 
\par   function interpolate(object, pattern) \{
\par     return new Template(this, pattern).evaluate(object);
\par   \}
\par 
\par   return \{
\par     gsub:           gsub,
\par     sub:            sub,
\par     scan:           scan,
\par     truncate:       truncate,
\par     strip:          String.prototype.trim ? String.prototype.trim : strip,
\par     stripTags:      stripTags,
\par     stripScripts:   stripScripts,
\par     extractScripts: extractScripts,
\par     evalScripts:    evalScripts,
\par     escapeHTML:     escapeHTML,
\par     unescapeHTML:   unescapeHTML,
\par     toQueryParams:  toQueryParams,
\par     parseQuery:     toQueryParams,
\par     toArray:        toArray,
\par     succ:           succ,
\par     times:          times,
\par     camelize:       camelize,
\par     capitalize:     capitalize,
\par     underscore:     underscore,
\par     dasherize:      dasherize,
\par     inspect:        inspect,
\par     toJSON:         toJSON,
\par     unfilterJSON:   unfilterJSON,
\par     isJSON:         isJSON,
\par     evalJSON:       evalJSON,
\par     include:        include,
\par     startsWith:     startsWith,
\par     endsWith:       endsWith,
\par     empty:          empty,
\par     blank:          blank,
\par     interpolate:    interpolate
\par   \};
\par \})());
\par 
\par var Template = Class.create(\{
\par   initialize: function(template, pattern) \{
\par     this.template = template.toString();
\par     this.pattern = pattern || Template.Pattern;
\par   \},
\par 
\par   evaluate: function(object) \{
\par     if (object && Object.isFunction(object.toTemplateReplacements))
\par       object = object.toTemplateReplacements();
\par 
\par     return this.template.gsub(this.pattern, function(match) \{
\par       if (object == null) return (match[1] + '');
\par 
\par       var before = match[1] || '';
\par       if (before == '\\\\') return match[2];
\par 
\par       var ctx = object, expr = match[3];
\par       var pattern = /^([^.[]+|\\[((?:.*?[^\\\\])?)\\])(\\.|\\[|$)/;
\par       match = pattern.exec(expr);
\par       if (match == null) return before;
\par 
\par       while (match != null) \{
\par         var comp = match[1].startsWith('[') ? match[2].replace(/\\\\\\\\]/g, ']') : match[1];
\par         ctx = ctx[comp];
\par         if (null == ctx || '' == match[3]) break;
\par         expr = expr.substring('[' == match[3] ? match[1].length : match[0].length);
\par         match = pattern.exec(expr);
\par       \}
\par 
\par       return before + String.interpret(ctx);
\par     \});
\par   \}
\par \});
\par Template.Pattern = /(^|.|\\r|\\n)(#\\\{(.*?)\\\})/;
\par 
\par var $break = \{ \};
\par 
\par var Enumerable = (function() \{
\par   function each(iterator, context) \{
\par     var index = 0;
\par     try \{
\par       this._each(function(value) \{
\par         iterator.call(context, value, index++);
\par       \});
\par     \} catch (e) \{
\par       if (e != $break) throw e;
\par     \}
\par     return this;
\par   \}
\par 
\par   function eachSlice(number, iterator, context) \{
\par     var index = -number, slices = [], array = this.toArray();
\par     if (number < 1) return array;
\par     while ((index += number) < array.length)
\par       slices.push(array.slice(index, index+number));
\par     return slices.collect(iterator, context);
\par   \}
\par 
\par   function all(iterator, context) \{
\par     iterator = iterator || Prototype.K;
\par     var result = true;
\par     this.each(function(value, index) \{
\par       result = result && !!iterator.call(context, value, index);
\par       if (!result) throw $break;
\par     \});
\par     return result;
\par   \}
\par 
\par   function any(iterator, context) \{
\par     iterator = iterator || Prototype.K;
\par     var result = false;
\par     this.each(function(value, index) \{
\par       if (result = !!iterator.call(context, value, index))
\par         throw $break;
\par     \});
\par     return result;
\par   \}
\par 
\par   function collect(iterator, context) \{
\par     iterator = iterator || Prototype.K;
\par     var results = [];
\par     this.each(function(value, index) \{
\par       results.push(iterator.call(context, value, index));
\par     \});
\par     return results;
\par   \}
\par 
\par   function detect(iterator, context) \{
\par     var result;
\par     this.each(function(value, index) \{
\par       if (iterator.call(context, value, index)) \{
\par         result = value;
\par         throw $break;
\par       \}
\par     \});
\par     return result;
\par   \}
\par 
\par   function findAll(iterator, context) \{
\par     var results = [];
\par     this.each(function(value, index) \{
\par       if (iterator.call(context, value, index))
\par         results.push(value);
\par     \});
\par     return results;
\par   \}
\par 
\par   function grep(filter, iterator, context) \{
\par     iterator = iterator || Prototype.K;
\par     var results = [];
\par 
\par     if (Object.isString(filter))
\par       filter = new RegExp(RegExp.escape(filter));
\par 
\par     this.each(function(value, index) \{
\par       if (filter.match(value))
\par         results.push(iterator.call(context, value, index));
\par     \});
\par     return results;
\par   \}
\par 
\par   function include(object) \{
\par     if (Object.isFunction(this.indexOf))
\par       if (this.indexOf(object) != -1) return true;
\par 
\par     var found = false;
\par     this.each(function(value) \{
\par       if (value == object) \{
\par         found = true;
\par         throw $break;
\par       \}
\par     \});
\par     return found;
\par   \}
\par 
\par   function inGroupsOf(number, fillWith) \{
\par     fillWith = Object.isUndefined(fillWith) ? null : fillWith;
\par     return this.eachSlice(number, function(slice) \{
\par       while(slice.length < number) slice.push(fillWith);
\par       return slice;
\par     \});
\par   \}
\par 
\par   function inject(memo, iterator, context) \{
\par     this.each(function(value, index) \{
\par       memo = iterator.call(context, memo, value, index);
\par     \});
\par     return memo;
\par   \}
\par 
\par   function invoke(method) \{
\par     var args = $A(arguments).slice(1);
\par     return this.map(function(value) \{
\par       return value[method].apply(value, args);
\par     \});
\par   \}
\par 
\par   function max(iterator, context) \{
\par     iterator = iterator || Prototype.K;
\par     var result;
\par     this.each(function(value, index) \{
\par       value = iterator.call(context, value, index);
\par       if (result == null || value >= result)
\par         result = value;
\par     \});
\par     return result;
\par   \}
\par 
\par   function min(iterator, context) \{
\par     iterator = iterator || Prototype.K;
\par     var result;
\par     this.each(function(value, index) \{
\par       value = iterator.call(context, value, index);
\par       if (result == null || value < result)
\par         result = value;
\par     \});
\par     return result;
\par   \}
\par 
\par   function partition(iterator, context) \{
\par     iterator = iterator || Prototype.K;
\par     var trues = [], falses = [];
\par     this.each(function(value, index) \{
\par       (iterator.call(context, value, index) ?
\par         trues : falses).push(value);
\par     \});
\par     return [trues, falses];
\par   \}
\par 
\par   function pluck(property) \{
\par     var results = [];
\par     this.each(function(value) \{
\par       results.push(value[property]);
\par     \});
\par     return results;
\par   \}
\par 
\par   function reject(iterator, context) \{
\par     var results = [];
\par     this.each(function(value, index) \{
\par       if (!iterator.call(context, value, index))
\par         results.push(value);
\par     \});
\par     return results;
\par   \}
\par 
\par   function sortBy(iterator, context) \{
\par     return this.map(function(value, index) \{
\par       return \{
\par         value: value,
\par         criteria: iterator.call(context, value, index)
\par       \};
\par     \}).sort(function(left, right) \{
\par       var a = left.criteria, b = right.criteria;
\par       return a < b ? -1 : a > b ? 1 : 0;
\par     \}).pluck('value');
\par   \}
\par 
\par   function toArray() \{
\par     return this.map();
\par   \}
\par 
\par   function zip() \{
\par     var iterator = Prototype.K, args = $A(arguments);
\par     if (Object.isFunction(args.last()))
\par       iterator = args.pop();
\par 
\par     var collections = [this].concat(args).map($A);
\par     return this.map(function(value, index) \{
\par       return iterator(collections.pluck(index));
\par     \});
\par   \}
\par 
\par   function size() \{
\par     return this.toArray().length;
\par   \}
\par 
\par   function inspect() \{
\par     return '#<Enumerable:' + this.toArray().inspect() + '>';
\par   \}
\par 
\par 
\par 
\par 
\par 
\par 
\par 
\par 
\par 
\par   return \{
\par     each:       each,
\par     eachSlice:  eachSlice,
\par     all:        all,
\par     every:      all,
\par     any:        any,
\par     some:       any,
\par     collect:    collect,
\par     map:        collect,
\par     detect:     detect,
\par     findAll:    findAll,
\par     select:     findAll,
\par     filter:     findAll,
\par     grep:       grep,
\par     include:    include,
\par     member:     include,
\par     inGroupsOf: inGroupsOf,
\par     inject:     inject,
\par     invoke:     invoke,
\par     max:        max,
\par     min:        min,
\par     partition:  partition,
\par     pluck:      pluck,
\par     reject:     reject,
\par     sortBy:     sortBy,
\par     toArray:    toArray,
\par     entries:    toArray,
\par     zip:        zip,
\par     size:       size,
\par     inspect:    inspect,
\par     find:       detect
\par   \};
\par \})();
\par function $A(iterable) \{
\par   if (!iterable) return [];
\par   if ('toArray' in Object(iterable)) return iterable.toArray();
\par   var length = iterable.length || 0, results = new Array(length);
\par   while (length--) results[length] = iterable[length];
\par   return results;
\par \}
\par 
\par function $w(string) \{
\par   if (!Object.isString(string)) return [];
\par   string = string.strip();
\par   return string ? string.split(/\\s+/) : [];
\par \}
\par 
\par Array.from = $A;
\par 
\par 
\par (function() \{
\par   var arrayProto = Array.prototype,
\par       slice = arrayProto.slice,
\par       _each = arrayProto.forEach; // use native browser JS 1.6 implementation if available
\par 
\par   function each(iterator) \{
\par     for (var i = 0, length = this.length; i < length; i++)
\par       iterator(this[i]);
\par   \}
\par   if (!_each) _each = each;
\par 
\par   function clear() \{
\par     this.length = 0;
\par     return this;
\par   \}
\par 
\par   function first() \{
\par     return this[0];
\par   \}
\par 
\par   function last() \{
\par     return this[this.length - 1];
\par   \}
\par 
\par   function compact() \{
\par     return this.select(function(value) \{
\par       return value != null;
\par     \});
\par   \}
\par 
\par   function flatten() \{
\par     return this.inject([], function(array, value) \{
\par       if (Object.isArray(value))
\par         return array.concat(value.flatten());
\par       array.push(value);
\par       return array;
\par     \});
\par   \}
\par 
\par   function without() \{
\par     var values = slice.call(arguments, 0);
\par     return this.select(function(value) \{
\par       return !values.include(value);
\par     \});
\par   \}
\par 
\par   function reverse(inline) \{
\par     return (inline !== false ? this : this.toArray())._reverse();
\par   \}
\par 
\par   function uniq(sorted) \{
\par     return this.inject([], function(array, value, index) \{
\par       if (0 == index || (sorted ? array.last() != value : !array.include(value)))
\par         array.push(value);
\par       return array;
\par     \});
\par   \}
\par 
\par   function intersect(array) \{
\par     return this.uniq().findAll(function(item) \{
\par       return array.detect(function(value) \{ return item === value \});
\par     \});
\par   \}
\par 
\par 
\par   function clone() \{
\par     return slice.call(this, 0);
\par   \}
\par 
\par   function size() \{
\par     return this.length;
\par   \}
\par 
\par   function inspect() \{
\par     return '[' + this.map(Object.inspect).join(', ') + ']';
\par   \}
\par 
\par   function toJSON() \{
\par     var results = [];
\par     this.each(function(object) \{
\par       var value = Object.toJSON(object);
\par       if (!Object.isUndefined(value)) results.push(value);
\par     \});
\par     return '[' + results.join(', ') + ']';
\par   \}
\par 
\par   function indexOf(item, i) \{
\par     i || (i = 0);
\par     var length = this.length;
\par     if (i < 0) i = length + i;
\par     for (; i < length; i++)
\par       if (this[i] === item) return i;
\par     return -1;
\par   \}
\par 
\par   function lastIndexOf(item, i) \{
\par     i = isNaN(i) ? this.length : (i < 0 ? this.length + i : i) + 1;
\par     var n = this.slice(0, i).reverse().indexOf(item);
\par     return (n < 0) ? n : i - n - 1;
\par   \}
\par 
\par   function concat() \{
\par     var array = slice.call(this, 0), item;
\par     for (var i = 0, length = arguments.length; i < length; i++) \{
\par       item = arguments[i];
\par       if (Object.isArray(item) && !('callee' in item)) \{
\par         for (var j = 0, arrayLength = item.length; j < arrayLength; j++)
\par           array.push(item[j]);
\par       \} else \{
\par         array.push(item);
\par       \}
\par     \}
\par     return array;
\par   \}
\par 
\par   Object.extend(arrayProto, Enumerable);
\par 
\par   if (!arrayProto._reverse)
\par     arrayProto._reverse = arrayProto.reverse;
\par 
\par   Object.extend(arrayProto, \{
\par     _each:     _each,
\par     clear:     clear,
\par     first:     first,
\par     last:      last,
\par     compact:   compact,
\par     flatten:   flatten,
\par     without:   without,
\par     reverse:   reverse,
\par     uniq:      uniq,
\par     intersect: intersect,
\par     clone:     clone,
\par     toArray:   clone,
\par     size:      size,
\par     inspect:   inspect,
\par     toJSON:    toJSON
\par   \});
\par 
\par   var CONCAT_ARGUMENTS_BUGGY = (function() \{
\par     return [].concat(arguments)[0][0] !== 1;
\par   \})(1,2)
\par 
\par   if (CONCAT_ARGUMENTS_BUGGY) arrayProto.concat = concat;
\par 
\par   if (!arrayProto.indexOf) arrayProto.indexOf = indexOf;
\par   if (!arrayProto.lastIndexOf) arrayProto.lastIndexOf = lastIndexOf;
\par \})();
\par function $H(object) \{
\par   return new Hash(object);
\par \};
\par 
\par var Hash = Class.create(Enumerable, (function() \{
\par   function initialize(object) \{
\par     this._object = Object.isHash(object) ? object.toObject() : Object.clone(object);
\par   \}
\par 
\par   function _each(iterator) \{
\par     for (var key in this._object) \{
\par       var value = this._object[key], pair = [key, value];
\par       pair.key = key;
\par       pair.value = value;
\par       iterator(pair);
\par     \}
\par   \}
\par 
\par   function set(key, value) \{
\par     return this._object[key] = value;
\par   \}
\par 
\par   function get(key) \{
\par     if (this._object[key] !== Object.prototype[key])
\par       return this._object[key];
\par   \}
\par 
\par   function unset(key) \{
\par     var value = this._object[key];
\par     delete this._object[key];
\par     return value;
\par   \}
\par 
\par   function toObject() \{
\par     return Object.clone(this._object);
\par   \}
\par 
\par   function keys() \{
\par     return this.pluck('key');
\par   \}
\par 
\par   function values() \{
\par     return this.pluck('value');
\par   \}
\par 
\par   function index(value) \{
\par     var match = this.detect(function(pair) \{
\par       return pair.value === value;
\par     \});
\par     return match && match.key;
\par   \}
\par 
\par   function merge(object) \{
\par     return this.clone().update(object);
\par   \}
\par 
\par   function update(object) \{
\par     return new Hash(object).inject(this, function(result, pair) \{
\par       result.set(pair.key, pair.value);
\par       return result;
\par     \});
\par   \}
\par 
\par   function toQueryPair(key, value) \{
\par     if (Object.isUndefined(value)) return key;
\par     return key + '=' + encodeURIComponent(String.interpret(value));
\par   \}
\par 
\par   function toQueryString() \{
\par     return this.inject([], function(results, pair) \{
\par       var key = encodeURIComponent(pair.key), values = pair.value;
\par 
\par       if (values && typeof values == 'object') \{
\par         if (Object.isArray(values))
\par           return results.concat(values.map(toQueryPair.curry(key)));
\par       \} else results.push(toQueryPair(key, values));
\par       return results;
\par     \}).join('&');
\par   \}
\par 
\par   function inspect() \{
\par     return '#<Hash:\{' + this.map(function(pair) \{
\par       return pair.map(Object.inspect).join(': ');
\par     \}).join(', ') + '\}>';
\par   \}
\par 
\par   function toJSON() \{
\par     return Object.toJSON(this.toObject());
\par   \}
\par 
\par   function clone() \{
\par     return new Hash(this);
\par   \}
\par 
\par   return \{
\par     initialize:             initialize,
\par     _each:                  _each,
\par     set:                    set,
\par     get:                    get,
\par     unset:                  unset,
\par     toObject:               toObject,
\par     toTemplateReplacements: toObject,
\par     keys:                   keys,
\par     values:                 values,
\par     index:                  index,
\par     merge:                  merge,
\par     update:                 update,
\par     toQueryString:          toQueryString,
\par     inspect:                inspect,
\par     toJSON:                 toJSON,
\par     clone:                  clone
\par   \};
\par \})());
\par 
\par Hash.from = $H;
\par Object.extend(Number.prototype, (function() \{
\par   function toColorPart() \{
\par     return this.toPaddedString(2, 16);
\par   \}
\par 
\par   function succ() \{
\par     return this + 1;
\par   \}
\par 
\par   function times(iterator, context) \{
\par     $R(0, this, true).each(iterator, context);
\par     return this;
\par   \}
\par 
\par   function toPaddedString(length, radix) \{
\par     var string = this.toString(radix || 10);
\par     return '0'.times(length - string.length) + string;
\par   \}
\par 
\par   function toJSON() \{
\par     return isFinite(this) ? this.toString() : 'null';
\par   \}
\par 
\par   function abs() \{
\par     return Math.abs(this);
\par   \}
\par 
\par   function round() \{
\par     return Math.round(this);
\par   \}
\par 
\par   function ceil() \{
\par     return Math.ceil(this);
\par   \}
\par 
\par   function floor() \{
\par     return Math.floor(this);
\par   \}
\par 
\par   return \{
\par     toColorPart:    toColorPart,
\par     succ:           succ,
\par     times:          times,
\par     toPaddedString: toPaddedString,
\par     toJSON:         toJSON,
\par     abs:            abs,
\par     round:          round,
\par     ceil:           ceil,
\par     floor:          floor
\par   \};
\par \})());
\par 
\par function $R(start, end, exclusive) \{
\par   return new ObjectRange(start, end, exclusive);
\par \}
\par 
\par var ObjectRange = Class.create(Enumerable, (function() \{
\par   function initialize(start, end, exclusive) \{
\par     this.start = start;
\par     this.end = end;
\par     this.exclusive = exclusive;
\par   \}
\par 
\par   function _each(iterator) \{
\par     var value = this.start;
\par     while (this.include(value)) \{
\par       iterator(value);
\par       value = value.succ();
\par     \}
\par   \}
\par 
\par   function include(value) \{
\par     if (value < this.start)
\par       return false;
\par     if (this.exclusive)
\par       return value < this.end;
\par     return value <= this.end;
\par   \}
\par 
\par   return \{
\par     initialize: initialize,
\par     _each:      _each,
\par     include:    include
\par   \};
\par \})());
\par 
\par 
\par 
\par var Ajax = \{
\par   getTransport: function() \{
\par     return Try.these(
\par       function() \{return new XMLHttpRequest()\},
\par       function() \{return new ActiveXObject('Msxml2.XMLHTTP')\},
\par       function() \{return new ActiveXObject('Microsoft.XMLHTTP')\}
\par     ) || false;
\par   \},
\par 
\par   activeRequestCount: 0
\par \};
\par 
\par Ajax.Responders = \{
\par   responders: [],
\par 
\par   _each: function(iterator) \{
\par     this.responders._each(iterator);
\par   \},
\par 
\par   register: function(responder) \{
\par     if (!this.include(responder))
\par       this.responders.push(responder);
\par   \},
\par 
\par   unregister: function(responder) \{
\par     this.responders = this.responders.without(responder);
\par   \},
\par 
\par   dispatch: function(callback, request, transport, json) \{
\par     this.each(function(responder) \{
\par       if (Object.isFunction(responder[callback])) \{
\par         try \{
\par           responder[callback].apply(responder, [request, transport, json]);
\par         \} catch (e) \{ \}
\par       \}
\par     \});
\par   \}
\par \};
\par 
\par Object.extend(Ajax.Responders, Enumerable);
\par 
\par Ajax.Responders.register(\{
\par   onCreate:   function() \{ Ajax.activeRequestCount++ \},
\par   onComplete: function() \{ Ajax.activeRequestCount-- \}
\par \});
\par Ajax.Base = Class.create(\{
\par   initialize: function(options) \{
\par     this.options = \{
\par       method:       'post',
\par       asynchronous: true,
\par       contentType:  'application/x-www-form-urlencoded',
\par       encoding:     'UTF-8',
\par       parameters:   '',
\par       evalJSON:     true,
\par       evalJS:       true
\par     \};
\par     Object.extend(this.options, options || \{ \});
\par 
\par     this.options.method = this.options.method.toLowerCase();
\par 
\par     if (Object.isString(this.options.parameters))
\par       this.options.parameters = this.options.parameters.toQueryParams();
\par     else if (Object.isHash(this.options.parameters))
\par       this.options.parameters = this.options.parameters.toObject();
\par   \}
\par \});
\par Ajax.Request = Class.create(Ajax.Base, \{
\par   _complete: false,
\par 
\par   initialize: function($super, url, options) \{
\par     $super(options);
\par     this.transport = Ajax.getTransport();
\par     this.request(url);
\par   \},
\par 
\par   request: function(url) \{
\par     this.url = url;
\par     this.method = this.options.method;
\par     var params = Object.clone(this.options.parameters);
\par 
\par     if (!['get', 'post'].include(this.method)) \{
\par       params['_method'] = this.method;
\par       this.method = 'post';
\par     \}
\par 
\par     this.parameters = params;
\par 
\par     if (params = Object.toQueryString(params)) \{
\par       if (this.method == 'get')
\par         this.url += (this.url.include('?') ? '&' : '?') + params;
\par       else if (/Konqueror|Safari|KHTML/.test(navigator.userAgent))
\par         params += '&_=';
\par     \}
\par 
\par     try \{
\par       var response = new Ajax.Response(this);
\par       if (this.options.onCreate) this.options.onCreate(response);
\par       Ajax.Responders.dispatch('onCreate', this, response);
\par 
\par       this.transport.open(this.method.toUpperCase(), this.url,
\par         this.options.asynchronous);
\par 
\par       if (this.options.asynchronous) this.respondToReadyState.bind(this).defer(1);
\par 
\par       this.transport.onreadystatechange = this.onStateChange.bind(this);
\par       this.setRequestHeaders();
\par 
\par       this.body = this.method == 'post' ? (this.options.postBody || params) : null;
\par       this.transport.send(this.body);
\par 
\par       /* Force Firefox to handle ready state 4 for synchronous requests */
\par       if (!this.options.asynchronous && this.transport.overrideMimeType)
\par         this.onStateChange();
\par 
\par     \}
\par     catch (e) \{
\par       this.dispatchException(e);
\par     \}
\par   \},
\par 
\par   onStateChange: function() \{
\par     var readyState = this.transport.readyState;
\par     if (readyState > 1 && !((readyState == 4) && this._complete))
\par       this.respondToReadyState(this.transport.readyState);
\par   \},
\par 
\par   setRequestHeaders: function() \{
\par     var headers = \{
\par       'X-Requested-With': 'XMLHttpRequest',
\par       'X-Prototype-Version': Prototype.Version,
\par       'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
\par     \};
\par 
\par     if (this.method == 'post') \{
\par       headers['Content-type'] = this.options.contentType +
\par         (this.options.encoding ? '; charset=' + this.options.encoding : '');
\par 
\par       /* Force "Connection: close" for older Mozilla browsers to work
\par        * around a bug where XMLHttpRequest sends an incorrect
\par        * Content-length header. See Mozilla Bugzilla #246651.
\par        */
\par       if (this.transport.overrideMimeType &&
\par           (navigator.userAgent.match(/Gecko\\/(\\d\{4\})/) || [0,2005])[1] < 2005)
\par             headers['Connection'] = 'close';
\par     \}
\par 
\par     if (typeof this.options.requestHeaders == 'object') \{
\par       var extras = this.options.requestHeaders;
\par 
\par       if (Object.isFunction(extras.push))
\par         for (var i = 0, length = extras.length; i < length; i += 2)
\par           headers[extras[i]] = extras[i+1];
\par       else
\par         $H(extras).each(function(pair) \{ headers[pair.key] = pair.value \});
\par     \}
\par 
\par     for (var name in headers)
\par       this.transport.setRequestHeader(name, headers[name]);
\par   \},
\par 
\par   success: function() \{
\par     var status = this.getStatus();
\par     return !status || (status >= 200 && status < 300);
\par   \},
\par 
\par   getStatus: function() \{
\par     try \{
\par       return this.transport.status || 0;
\par     \} catch (e) \{ return 0 \}
\par   \},
\par 
\par   respondToReadyState: function(readyState) \{
\par     var state = Ajax.Request.Events[readyState], response = new Ajax.Response(this);
\par 
\par     if (state == 'Complete') \{
\par       try \{
\par         this._complete = true;
\par         (this.options['on' + response.status]
\par          || this.options['on' + (this.success() ? 'Success' : 'Failure')]
\par          || Prototype.emptyFunction)(response, response.headerJSON);
\par       \} catch (e) \{
\par         this.dispatchException(e);
\par       \}
\par 
\par       var contentType = response.getHeader('Content-type');
\par       if (this.options.evalJS == 'force'
\par           || (this.options.evalJS && this.isSameOrigin() && contentType
\par           && contentType.match(/^\\s*(text|application)\\/(x-)?(java|ecma)script(;.*)?\\s*$/i)))
\par         this.evalResponse();
\par     \}
\par 
\par     try \{
\par       (this.options['on' + state] || Prototype.emptyFunction)(response, response.headerJSON);
\par       Ajax.Responders.dispatch('on' + state, this, response, response.headerJSON);
\par     \} catch (e) \{
\par       this.dispatchException(e);
\par     \}
\par 
\par     if (state == 'Complete') \{
\par       this.transport.onreadystatechange = Prototype.emptyFunction;
\par     \}
\par   \},
\par 
\par   isSameOrigin: function() \{
\par     var m = this.url.match(/^\\s*https?:\\/\\/[^\\/]*/);
\par     return !m || (m[0] == '#\{protocol\}//#\{domain\}#\{port\}'.interpolate(\{
\par       protocol: location.protocol,
\par       domain: document.domain,
\par       port: location.port ? ':' + location.port : ''
\par     \}));
\par   \},
\par 
\par   getHeader: function(name) \{
\par     try \{
\par       return this.transport.getResponseHeader(name) || null;
\par     \} catch (e) \{ return null; \}
\par   \},
\par 
\par   evalResponse: function() \{
\par     try \{
\par       return eval((this.transport.responseText || '').unfilterJSON());
\par     \} catch (e) \{
\par       this.dispatchException(e);
\par     \}
\par   \},
\par 
\par   dispatchException: function(exception) \{
\par     (this.options.onException || Prototype.emptyFunction)(this, exception);
\par     Ajax.Responders.dispatch('onException', this, exception);
\par   \}
\par \});
\par 
\par Ajax.Request.Events =
\par   ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete'];
\par 
\par 
\par Ajax.Response = Class.create(\{
\par   initialize: function(request)\{
\par     this.request = request;
\par     var transport  = this.transport  = request.transport,
\par         readyState = this.readyState = transport.readyState;
\par 
\par     if((readyState > 2 && !Prototype.Browser.IE) || readyState == 4) \{
\par       this.status       = this.getStatus();
\par       this.statusText   = this.getStatusText();
\par       this.responseText = String.interpret(transport.responseText);
\par       this.headerJSON   = this._getHeaderJSON();
\par     \}
\par 
\par     if(readyState == 4) \{
\par       var xml = transport.responseXML;
\par       this.responseXML  = Object.isUndefined(xml) ? null : xml;
\par       this.responseJSON = this._getResponseJSON();
\par     \}
\par   \},
\par 
\par   status:      0,
\par 
\par   statusText: '',
\par 
\par   getStatus: Ajax.Request.prototype.getStatus,
\par 
\par   getStatusText: function() \{
\par     try \{
\par       return this.transport.statusText || '';
\par     \} catch (e) \{ return '' \}
\par   \},
\par 
\par   getHeader: Ajax.Request.prototype.getHeader,
\par 
\par   getAllHeaders: function() \{
\par     try \{
\par       return this.getAllResponseHeaders();
\par     \} catch (e) \{ return null \}
\par   \},
\par 
\par   getResponseHeader: function(name) \{
\par     return this.transport.getResponseHeader(name);
\par   \},
\par 
\par   getAllResponseHeaders: function() \{
\par     return this.transport.getAllResponseHeaders();
\par   \},
\par 
\par   _getHeaderJSON: function() \{
\par     var json = this.getHeader('X-JSON');
\par     if (!json) return null;
\par     json = decodeURIComponent(escape(json));
\par     try \{
\par       return json.evalJSON(this.request.options.sanitizeJSON ||
\par         !this.request.isSameOrigin());
\par     \} catch (e) \{
\par       this.request.dispatchException(e);
\par     \}
\par   \},
\par 
\par   _getResponseJSON: function() \{
\par     var options = this.request.options;
\par     if (!options.evalJSON || (options.evalJSON != 'force' &&
\par       !(this.getHeader('Content-type') || '').include('application/json')) ||
\par         this.responseText.blank())
\par           return null;
\par     try \{
\par       return this.responseText.evalJSON(options.sanitizeJSON ||
\par         !this.request.isSameOrigin());
\par     \} catch (e) \{
\par       this.request.dispatchException(e);
\par     \}
\par   \}
\par \});
\par 
\par Ajax.Updater = Class.create(Ajax.Request, \{
\par   initialize: function($super, container, url, options) \{
\par     this.container = \{
\par       success: (container.success || container),
\par       failure: (container.failure || (container.success ? null : container))
\par     \};
\par 
\par     options = Object.clone(options);
\par     var onComplete = options.onComplete;
\par     options.onComplete = (function(response, json) \{
\par       this.updateContent(response.responseText);
\par       if (Object.isFunction(onComplete)) onComplete(response, json);
\par     \}).bind(this);
\par 
\par     $super(url, options);
\par   \},
\par 
\par   updateContent: function(responseText) \{
\par     var receiver = this.container[this.success() ? 'success' : 'failure'],
\par         options = this.options;
\par 
\par     if (!options.evalScripts) responseText = responseText.stripScripts();
\par 
\par     if (receiver = $(receiver)) \{
\par       if (options.insertion) \{
\par         if (Object.isString(options.insertion)) \{
\par           var insertion = \{ \}; insertion[options.insertion] = responseText;
\par           receiver.insert(insertion);
\par         \}
\par         else options.insertion(receiver, responseText);
\par       \}
\par       else receiver.update(responseText);
\par     \}
\par   \}
\par \});
\par 
\par Ajax.PeriodicalUpdater = Class.create(Ajax.Base, \{
\par   initialize: function($super, container, url, options) \{
\par     $super(options);
\par     this.onComplete = this.options.onComplete;
\par 
\par     this.frequency = (this.options.frequency || 2);
\par     this.decay = (this.options.decay || 1);
\par 
\par     this.updater = \{ \};
\par     this.container = container;
\par     this.url = url;
\par 
\par     this.start();
\par   \},
\par 
\par   start: function() \{
\par     this.options.onComplete = this.updateComplete.bind(this);
\par     this.onTimerEvent();
\par   \},
\par 
\par   stop: function() \{
\par     this.updater.options.onComplete = undefined;
\par     clearTimeout(this.timer);
\par     (this.onComplete || Prototype.emptyFunction).apply(this, arguments);
\par   \},
\par 
\par   updateComplete: function(response) \{
\par     if (this.options.decay) \{
\par       this.decay = (response.responseText == this.lastText ?
\par         this.decay * this.options.decay : 1);
\par 
\par       this.lastText = response.responseText;
\par     \}
\par     this.timer = this.onTimerEvent.bind(this).delay(this.decay * this.frequency);
\par   \},
\par 
\par   onTimerEvent: function() \{
\par     this.updater = new Ajax.Updater(this.container, this.url, this.options);
\par   \}
\par \});
\par 
\par 
\par 
\par function $(element) \{
\par   if (arguments.length > 1) \{
\par     for (var i = 0, elements = [], length = arguments.length; i < length; i++)
\par       elements.push($(arguments[i]));
\par     return elements;
\par   \}
\par   if (Object.isString(element))
\par     element = document.getElementById(element);
\par   return Element.extend(element);
\par \}
\par 
\par if (Prototype.BrowserFeatures.XPath) \{
\par   document._getElementsByXPath = function(expression, parentElement) \{
\par     var results = [];
\par     var query = document.evaluate(expression, $(parentElement) || document,
\par       null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
\par     for (var i = 0, length = query.snapshotLength; i < length; i++)
\par       results.push(Element.extend(query.snapshotItem(i)));
\par     return results;
\par   \};
\par \}
\par 
\par /*--------------------------------------------------------------------------*/
\par 
\par if (!window.Node) var Node = \{ \};
\par 
\par if (!Node.ELEMENT_NODE) \{
\par   Object.extend(Node, \{
\par     ELEMENT_NODE: 1,
\par     ATTRIBUTE_NODE: 2,
\par     TEXT_NODE: 3,
\par     CDATA_SECTION_NODE: 4,
\par     ENTITY_REFERENCE_NODE: 5,
\par     ENTITY_NODE: 6,
\par     PROCESSING_INSTRUCTION_NODE: 7,
\par     COMMENT_NODE: 8,
\par     DOCUMENT_NODE: 9,
\par     DOCUMENT_TYPE_NODE: 10,
\par     DOCUMENT_FRAGMENT_NODE: 11,
\par     NOTATION_NODE: 12
\par   \});
\par \}
\par 
\par 
\par (function(global) \{
\par 
\par   var SETATTRIBUTE_IGNORES_NAME = (function()\{
\par     var elForm = document.createElement("form");
\par     var elInput = document.createElement("input");
\par     var root = document.documentElement;
\par     elInput.setAttribute("name", "test");
\par     elForm.appendChild(elInput);
\par     root.appendChild(elForm);
\par     var isBuggy = elForm.elements
\par       ? (typeof elForm.elements.test == "undefined")
\par       : null;
\par     root.removeChild(elForm);
\par     elForm = elInput = null;
\par     return isBuggy;
\par   \})();
\par 
\par   var element = global.Element;
\par   global.Element = function(tagName, attributes) \{
\par     attributes = attributes || \{ \};
\par     tagName = tagName.toLowerCase();
\par     var cache = Element.cache;
\par     if (SETATTRIBUTE_IGNORES_NAME && attributes.name) \{
\par       tagName = '<' + tagName + ' name="' + attributes.name + '">';
\par       delete attributes.name;
\par       return Element.writeAttribute(document.createElement(tagName), attributes);
\par     \}
\par     if (!cache[tagName]) cache[tagName] = Element.extend(document.createElement(tagName));
\par     return Element.writeAttribute(cache[tagName].cloneNode(false), attributes);
\par   \};
\par   Object.extend(global.Element, element || \{ \});
\par   if (element) global.Element.prototype = element.prototype;
\par \})(this);
\par 
\par Element.cache = \{ \};
\par Element.idCounter = 1;
\par 
\par Element.Methods = \{
\par   visible: function(element) \{
\par     return $(element).style.display != 'none';
\par   \},
\par 
\par   toggle: function(element) \{
\par     element = $(element);
\par     Element[Element.visible(element) ? 'hide' : 'show'](element);
\par     return element;
\par   \},
\par 
\par 
\par   hide: function(element) \{
\par     element = $(element);
\par     element.style.display = 'none';
\par     return element;
\par   \},
\par 
\par   show: function(element) \{
\par     element = $(element);
\par     element.style.display = '';
\par     return element;
\par   \},
\par 
\par   remove: function(element) \{
\par     element = $(element);
\par     element.parentNode.removeChild(element);
\par     return element;
\par   \},
\par 
\par   update: (function()\{
\par 
\par     var SELECT_ELEMENT_INNERHTML_BUGGY = (function()\{
\par       var el = document.createElement("select"),
\par           isBuggy = true;
\par       el.innerHTML = "<option value=\\"test\\">test</option>";
\par       if (el.options && el.options[0]) \{
\par         isBuggy = el.options[0].nodeName.toUpperCase() !== "OPTION";
\par       \}
\par       el = null;
\par       return isBuggy;
\par     \})();
\par 
\par     var TABLE_ELEMENT_INNERHTML_BUGGY = (function()\{
\par       try \{
\par         var el = document.createElement("table");
\par         if (el && el.tBodies) \{
\par           el.innerHTML = "<tbody><tr><td>test</td></tr></tbody>";
\par           var isBuggy = typeof el.tBodies[0] == "undefined";
\par           el = null;
\par           return isBuggy;
\par         \}
\par       \} catch (e) \{
\par         return true;
\par       \}
\par     \})();
\par 
\par     var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING = (function () \{
\par       var s = document.createElement("script"),
\par           isBuggy = false;
\par       try \{
\par         s.appendChild(document.createTextNode(""));
\par         isBuggy = !s.firstChild ||
\par           s.firstChild && s.firstChild.nodeType !== 3;
\par       \} catch (e) \{
\par         isBuggy = true;
\par       \}
\par       s = null;
\par       return isBuggy;
\par     \})();
\par 
\par     function update(element, content) \{
\par       element = $(element);
\par 
\par       if (content && content.toElement)
\par         content = content.toElement();
\par 
\par       if (Object.isElement(content))
\par         return element.update().insert(content);
\par 
\par       content = Object.toHTML(content);
\par 
\par       var tagName = element.tagName.toUpperCase();
\par 
\par       if (tagName === 'SCRIPT' && SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING) \{
\par         element.text = content;
\par         return element;
\par       \}
\par 
\par       if (SELECT_ELEMENT_INNERHTML_BUGGY || TABLE_ELEMENT_INNERHTML_BUGGY) \{
\par         if (tagName in Element._insertionTranslations.tags) \{
\par           while (element.firstChild) \{
\par             element.removeChild(element.firstChild);
\par           \}
\par           Element._getContentFromAnonymousElement(tagName, content.stripScripts())
\par             .each(function(node) \{
\par               element.appendChild(node)
\par             \});
\par         \}
\par         else \{
\par           element.innerHTML = content.stripScripts();
\par         \}
\par       \}
\par       else \{
\par         element.innerHTML = content.stripScripts();
\par       \}
\par 
\par       content.evalScripts.bind(content).defer();
\par       return element;
\par     \}
\par 
\par     return update;
\par   \})(),
\par 
\par   replace: function(element, content) \{
\par     element = $(element);
\par     if (content && content.toElement) content = content.toElement();
\par     else if (!Object.isElement(content)) \{
\par       content = Object.toHTML(content);
\par       var range = element.ownerDocument.createRange();
\par       range.selectNode(element);
\par       content.evalScripts.bind(content).defer();
\par       content = range.createContextualFragment(content.stripScripts());
\par     \}
\par     element.parentNode.replaceChild(content, element);
\par     return element;
\par   \},
\par 
\par   insert: function(element, insertions) \{
\par     element = $(element);
\par 
\par     if (Object.isString(insertions) || Object.isNumber(insertions) ||
\par         Object.isElement(insertions) || (insertions && (insertions.toElement || insertions.toHTML)))
\par           insertions = \{bottom:insertions\};
\par 
\par     var content, insert, tagName, childNodes;
\par 
\par     for (var position in insertions) \{
\par       content  = insertions[position];
\par       position = position.toLowerCase();
\par       insert = Element._insertionTranslations[position];
\par 
\par       if (content && content.toElement) content = content.toElement();
\par       if (Object.isElement(content)) \{
\par         insert(element, content);
\par         continue;
\par       \}
\par 
\par       content = Object.toHTML(content);
\par 
\par       tagName = ((position == 'before' || position == 'after')
\par         ? element.parentNode : element).tagName.toUpperCase();
\par 
\par       childNodes = Element._getContentFromAnonymousElement(tagName, content.stripScripts());
\par 
\par       if (position == 'top' || position == 'after') childNodes.reverse();
\par       childNodes.each(insert.curry(element));
\par 
\par       content.evalScripts.bind(content).defer();
\par     \}
\par 
\par     return element;
\par   \},
\par 
\par   wrap: function(element, wrapper, attributes) \{
\par     element = $(element);
\par     if (Object.isElement(wrapper))
\par       $(wrapper).writeAttribute(attributes || \{ \});
\par     else if (Object.isString(wrapper)) wrapper = new Element(wrapper, attributes);
\par     else wrapper = new Element('div', wrapper);
\par     if (element.parentNode)
\par       element.parentNode.replaceChild(wrapper, element);
\par     wrapper.appendChild(element);
\par     return wrapper;
\par   \},
\par 
\par   inspect: function(element) \{
\par     element = $(element);
\par     var result = '<' + element.tagName.toLowerCase();
\par     $H(\{'id': 'id', 'className': 'class'\}).each(function(pair) \{
\par       var property = pair.first(), attribute = pair.last();
\par       var value = (element[property] || '').toString();
\par       if (value) result += ' ' + attribute + '=' + value.inspect(true);
\par     \});
\par     return result + '>';
\par   \},
\par 
\par   recursivelyCollect: function(element, property) \{
\par     element = $(element);
\par     var elements = [];
\par     while (element = element[property])
\par       if (element.nodeType == 1)
\par         elements.push(Element.extend(element));
\par     return elements;
\par   \},
\par 
\par   ancestors: function(element) \{
\par     return Element.recursivelyCollect(element, 'parentNode');
\par   \},
\par 
\par   descendants: function(element) \{
\par     return Element.select(element, "*");
\par   \},
\par 
\par   firstDescendant: function(element) \{
\par     element = $(element).firstChild;
\par     while (element && element.nodeType != 1) element = element.nextSibling;
\par     return $(element);
\par   \},
\par 
\par   immediateDescendants: function(element) \{
\par     if (!(element = $(element).firstChild)) return [];
\par     while (element && element.nodeType != 1) element = element.nextSibling;
\par     if (element) return [element].concat($(element).nextSiblings());
\par     return [];
\par   \},
\par 
\par   previousSiblings: function(element) \{
\par     return Element.recursivelyCollect(element, 'previousSibling');
\par   \},
\par 
\par   nextSiblings: function(element) \{
\par     return Element.recursivelyCollect(element, 'nextSibling');
\par   \},
\par 
\par   siblings: function(element) \{
\par     element = $(element);
\par     return Element.previousSiblings(element).reverse()
\par       .concat(Element.nextSiblings(element));
\par   \},
\par 
\par   match: function(element, selector) \{
\par     if (Object.isString(selector))
\par       selector = new Selector(selector);
\par     return selector.match($(element));
\par   \},
\par 
\par   up: function(element, expression, index) \{
\par     element = $(element);
\par     if (arguments.length == 1) return $(element.parentNode);
\par     var ancestors = Element.ancestors(element);
\par     return Object.isNumber(expression) ? ancestors[expression] :
\par       Selector.findElement(ancestors, expression, index);
\par   \},
\par 
\par   down: function(element, expression, index) \{
\par     element = $(element);
\par     if (arguments.length == 1) return Element.firstDescendant(element);
\par     return Object.isNumber(expression) ? Element.descendants(element)[expression] :
\par       Element.select(element, expression)[index || 0];
\par   \},
\par 
\par   previous: function(element, expression, index) \{
\par     element = $(element);
\par     if (arguments.length == 1) return $(Selector.handlers.previousElementSibling(element));
\par     var previousSiblings = Element.previousSiblings(element);
\par     return Object.isNumber(expression) ? previousSiblings[expression] :
\par       Selector.findElement(previousSiblings, expression, index);
\par   \},
\par 
\par   next: function(element, expression, index) \{
\par     element = $(element);
\par     if (arguments.length == 1) return $(Selector.handlers.nextElementSibling(element));
\par     var nextSiblings = Element.nextSiblings(element);
\par     return Object.isNumber(expression) ? nextSiblings[expression] :
\par       Selector.findElement(nextSiblings, expression, index);
\par   \},
\par 
\par 
\par   select: function(element) \{
\par     var args = Array.prototype.slice.call(arguments, 1);
\par     return Selector.findChildElements(element, args);
\par   \},
\par 
\par   adjacent: function(element) \{
\par     var args = Array.prototype.slice.call(arguments, 1);
\par     return Selector.findChildElements(element.parentNode, args).without(element);
\par   \},
\par 
\par   identify: function(element) \{
\par     element = $(element);
\par     var id = Element.readAttribute(element, 'id');
\par     if (id) return id;
\par     do \{ id = 'anonymous_element_' + Element.idCounter++ \} while ($(id));
\par     Element.writeAttribute(element, 'id', id);
\par     return id;
\par   \},
\par 
\par   readAttribute: function(element, name) \{
\par     element = $(element);
\par     if (Prototype.Browser.IE) \{
\par       var t = Element._attributeTranslations.read;
\par       if (t.values[name]) return t.values[name](element, name);
\par       if (t.names[name]) name = t.names[name];
\par       if (name.include(':')) \{
\par         return (!element.attributes || !element.attributes[name]) ? null :
\par          element.attributes[name].value;
\par       \}
\par     \}
\par     return element.getAttribute(name);
\par   \},
\par 
\par   writeAttribute: function(element, name, value) \{
\par     element = $(element);
\par     var attributes = \{ \}, t = Element._attributeTranslations.write;
\par 
\par     if (typeof name == 'object') attributes = name;
\par     else attributes[name] = Object.isUndefined(value) ? true : value;
\par 
\par     for (var attr in attributes) \{
\par       name = t.names[attr] || attr;
\par       value = attributes[attr];
\par       if (t.values[attr]) name = t.values[attr](element, value);
\par       if (value === false || value === null)
\par         element.removeAttribute(name);
\par       else if (value === true)
\par         element.setAttribute(name, name);
\par       else element.setAttribute(name, value);
\par     \}
\par     return element;
\par   \},
\par 
\par   getHeight: function(element) \{
\par     return Element.getDimensions(element).height;
\par   \},
\par 
\par   getWidth: function(element) \{
\par     return Element.getDimensions(element).width;
\par   \},
\par 
\par   classNames: function(element) \{
\par     return new Element.ClassNames(element);
\par   \},
\par 
\par   hasClassName: function(element, className) \{
\par     if (!(element = $(element))) return;
\par     var elementClassName = element.className;
\par     return (elementClassName.length > 0 && (elementClassName == className ||
\par       new RegExp("(^|\\\\s)" + className + "(}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\s|$)").test(elementClassName))"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000070000005c005c0073007c0024002900000000}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\s|$)").test(elementClassName))}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 );
\par   \},
\par 
\par   addClassName: function(element, className) \{
\par     if (!(element = $(element))) return;
\par     if (!Element.hasClassName(element, className))
\par       element.className += (element.className ? ' ' : '') + className;
\par     return element;
\par   \},
\par 
\par   removeClassName: function(element, className) \{
\par     if (!(element = $(element))) return;
\par     element.className = element.className.replace(
\par       new RegExp("(^|\\\\s+)" + className + "(}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\s+|$)""}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000080000005c005c0073002b007c0024002900000000}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\s+|$)"}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ), ' ').strip();
\par     return element;
\par   \},
\par 
\par   toggleClassName: function(element, className) \{
\par     if (!(element = $(element))) return;
\par     return Element[Element.hasClassName(element, className) ?
\par       'removeClassName' : 'addClassName'](element, className);
\par   \},
\par 
\par   cleanWhitespace: function(element) \{
\par     element = $(element);
\par     var node = element.firstChild;
\par     while (node) \{
\par       var nextNode = node.nextSibling;
\par       if (node.nodeType == 3 && !/\\S/.test(node.nodeValue))
\par         element.removeChild(node);
\par       node = nextNode;
\par     \}
\par     return element;
\par   \},
\par 
\par   empty: function(element) \{
\par     return $(element).innerHTML.blank();
\par   \},
\par 
\par   descendantOf: function(element, ancestor) \{
\par     element = $(element), ancestor = $(ancestor);
\par 
\par     if (element.compareDocumentPosition)
\par       return (element.compareDocumentPosition(ancestor) & 8) === 8;
\par 
\par     if (ancestor.contains)
\par       return ancestor.contains(element) && ancestor !== element;
\par 
\par     while (element = element.parentNode)
\par       if (element == ancestor) return true;
\par 
\par     return false;
\par   \},
\par 
\par   scrollTo: function(element) \{
\par     element = $(element);
\par     var pos = Element.cumulativeOffset(element);
\par     window.scrollTo(pos[0], pos[1]);
\par     return element;
\par   \},
\par 
\par   getStyle: function(element, style) \{
\par     element = $(element);
\par     style = style == 'float' ? 'cssFloat' : style.camelize();
\par     var value = element.style[style];
\par     if (!value || value == 'auto') \{
\par       var css = document.defaultView.getComputedStyle(element, null);
\par       value = css ? css[style] : null;
\par     \}
\par     if (style == 'opacity') return value ? parseFloat(value) : 1.0;
\par     return value == 'auto' ? null : value;
\par   \},
\par 
\par   getOpacity: function(element) \{
\par     return $(element).getStyle('opacity');
\par   \},
\par 
\par   setStyle: function(element, styles) \{
\par     element = $(element);
\par     var elementStyle = element.style, match;
\par     if (Object.isString(styles)) \{
\par       element.style.cssText += ';' + styles;
\par       return styles.include('opacity') ?
\par         element.setOpacity(styles.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1]) : element;
\par     \}
\par     for (var property in styles)
\par       if (property == 'opacity') element.setOpacity(styles[property]);
\par       else
\par         elementStyle[(property == 'float' || property == 'cssFloat') ?
\par           (Object.isUndefined(elementStyle.styleFloat) ? 'cssFloat' : 'styleFloat') :
\par             property] = styles[property];
\par 
\par     return element;
\par   \},
\par 
\par   setOpacity: function(element, value) \{
\par     element = $(element);
\par     element.style.opacity = (value == 1 || value === '') ? '' :
\par       (value < 0.00001) ? 0 : value;
\par     return element;
\par   \},
\par 
\par   getDimensions: function(element) \{
\par     element = $(element);
\par     var display = Element.getStyle(element, 'display');
\par     if (display != 'none' && display != null) // Safari bug
\par       return \{width: element.offsetWidth, height: element.offsetHeight\};
\par 
\par     var els = element.style;
\par     var originalVisibility = els.visibility;
\par     var originalPosition = els.position;
\par     var originalDisplay = els.display;
\par     els.visibility = 'hidden';
\par     if (originalPosition != 'fixed') // Switching fixed to absolute causes issues in Safari
\par       els.position = 'absolute';
\par     els.display = 'block';
\par     var originalWidth = element.clientWidth;
\par     var originalHeight = element.clientHeight;
\par     els.display = originalDisplay;
\par     els.position = originalPosition;
\par     els.visibility = originalVisibility;
\par     return \{width: originalWidth, height: originalHeight\};
\par   \},
\par 
\par   makePositioned: function(element) \{
\par     element = $(element);
\par     var pos = Element.getStyle(element, 'position');
\par     if (pos == 'static' || !pos) \{
\par       element._madePositioned = true;
\par       element.style.position = 'relative';
\par       if (Prototype.Browser.Opera) \{
\par         element.style.top = 0;
\par         element.style.left = 0;
\par       \}
\par     \}
\par     return element;
\par   \},
\par 
\par   undoPositioned: function(element) \{
\par     element = $(element);
\par     if (element._madePositioned) \{
\par       element._madePositioned = undefined;
\par       element.style.position =
\par         element.style.top =
\par         element.style.left =
\par         element.style.bottom =
\par         element.style.right = '';
\par     \}
\par     return element;
\par   \},
\par 
\par   makeClipping: function(element) \{
\par     element = $(element);
\par     if (element._overflow) return element;
\par     element._overflow = Element.getStyle(element, 'overflow') || 'auto';
\par     if (element._overflow !== 'hidden')
\par       element.style.overflow = 'hidden';
\par     return element;
\par   \},
\par 
\par   undoClipping: function(element) \{
\par     element = $(element);
\par     if (!element._overflow) return element;
\par     element.style.overflow = element._overflow == 'auto' ? '' : element._overflow;
\par     element._overflow = null;
\par     return element;
\par   \},
\par 
\par   cumulativeOffset: function(element) \{
\par     var valueT = 0, valueL = 0;
\par     do \{
\par       valueT += element.offsetTop  || 0;
\par       valueL += element.offsetLeft || 0;
\par       element = element.offsetParent;
\par     \} while (element);
\par     return Element._returnOffset(valueL, valueT);
\par   \},
\par 
\par   positionedOffset: function(element) \{
\par     var valueT = 0, valueL = 0;
\par     do \{
\par       valueT += element.offsetTop  || 0;
\par       valueL += element.offsetLeft || 0;
\par       element = element.offsetParent;
\par       if (element) \{
\par         if (element.tagName.toUpperCase() == 'BODY') break;
\par         var p = Element.getStyle(element, 'position');
\par         if (p !== 'static') break;
\par       \}
\par     \} while (element);
\par     return Element._returnOffset(valueL, valueT);
\par   \},
\par 
\par   absolutize: function(element) \{
\par     element = $(element);
\par     if (Element.getStyle(element, 'position') == 'absolute') return element;
\par 
\par     var offsets = Element.positionedOffset(element);
\par     var top     = offsets[1];
\par     var left    = offsets[0];
\par     var width   = element.clientWidth;
\par     var height  = element.clientHeight;
\par 
\par     element._originalLeft   = left - parseFloat(element.style.left  || 0);
\par     element._originalTop    = top  - parseFloat(element.style.top || 0);
\par     element._originalWidth  = element.style.width;
\par     element._originalHeight = element.style.height;
\par 
\par     element.style.position = 'absolute';
\par     element.style.top    = top + 'px';
\par     element.style.left   = left + 'px';
\par     element.style.width  = width + 'px';
\par     element.style.height = height + 'px';
\par     return element;
\par   \},
\par 
\par   relativize: function(element) \{
\par     element = $(element);
\par     if (Element.getStyle(element, 'position') == 'relative') return element;
\par 
\par     element.style.position = 'relative';
\par     var top  = parseFloat(element.style.top  || 0) - (element._originalTop || 0);
\par     var left = parseFloat(element.style.left || 0) - (element._originalLeft || 0);
\par 
\par     element.style.top    = top + 'px';
\par     element.style.left   = left + 'px';
\par     element.style.height = element._originalHeight;
\par     element.style.width  = element._originalWidth;
\par     return element;
\par   \},
\par 
\par   cumulativeScrollOffset: function(element) \{
\par     var valueT = 0, valueL = 0;
\par     do \{
\par       valueT += element.scrollTop  || 0;
\par       valueL += element.scrollLeft || 0;
\par       element = element.parentNode;
\par     \} while (element);
\par     return Element._returnOffset(valueL, valueT);
\par   \},
\par 
\par   getOffsetParent: function(element) \{
\par     if (element.offsetParent) return $(element.offsetParent);
\par     if (element == document.body) return $(element);
\par 
\par     while ((element = element.parentNode) && element != document.body)
\par       if (Element.getStyle(element, 'position') != 'static')
\par         return $(element);
\par 
\par     return $(document.body);
\par   \},
\par 
\par   viewportOffset: function(forElement) \{
\par     var valueT = 0, valueL = 0;
\par 
\par     var element = forElement;
\par     do \{
\par       valueT += element.offsetTop  || 0;
\par       valueL += element.offsetLeft || 0;
\par 
\par       if (element.offsetParent == document.body &&
\par         Element.getStyle(element, 'position') == 'absolute') break;
\par 
\par     \} while (element = element.offsetParent);
\par 
\par     element = forElement;
\par     do \{
\par       if (!Prototype.Browser.Opera || (element.tagName && (element.tagName.toUpperCase() == 'BODY'))) \{
\par         valueT -= element.scrollTop  || 0;
\par         valueL -= element.scrollLeft || 0;
\par       \}
\par     \} while (element = element.parentNode);
\par 
\par     return Element._returnOffset(valueL, valueT);
\par   \},
\par 
\par   clonePosition: function(element, source) \{
\par     var options = Object.extend(\{
\par       setLeft:    true,
\par       setTop:     true,
\par       setWidth:   true,
\par       setHeight:  true,
\par       offsetTop:  0,
\par       offsetLeft: 0
\par     \}, arguments[2] || \{ \});
\par 
\par     source = $(source);
\par     var p = Element.viewportOffset(source);
\par 
\par     element = $(element);
\par     var delta = [0, 0];
\par     var parent = null;
\par     if (Element.getStyle(element, 'position') == 'absolute') \{
\par       parent = Element.getOffsetParent(element);
\par       delta = Element.viewportOffset(parent);
\par     \}
\par 
\par     if (parent == document.body) \{
\par       delta[0] -= document.body.offsetLeft;
\par       delta[1] -= document.body.offsetTop;
\par     \}
\par 
\par     if (options.setLeft)   element.style.left  = (p[0] - delta[0] + options.offsetLeft) + 'px';
\par     if (options.setTop)    element.style.top   = (p[1] - delta[1] + options.offsetTop) + 'px';
\par     if (options.setWidth)  element.style.width = source.offsetWidth + 'px';
\par     if (options.setHeight) element.style.height = source.offsetHeight + 'px';
\par     return element;
\par   \}
\par \};
\par 
\par Object.extend(Element.Methods, \{
\par   getElementsBySelector: Element.Methods.select,
\par 
\par   childElements: Element.Methods.immediateDescendants
\par \});
\par 
\par Element._attributeTranslations = \{
\par   write: \{
\par     names: \{
\par       className: 'class',
\par       htmlFor:   'for'
\par     \},
\par     values: \{ \}
\par   \}
\par \};
\par 
\par if (Prototype.Browser.Opera) \{
\par   Element.Methods.getStyle = Element.Methods.getStyle.wrap(
\par     function(proceed, element, style) \{
\par       switch (style) \{
\par         case 'left': case 'top': case 'right': case 'bottom':
\par           if (proceed(element, 'position') === 'static') return null;
\par         case 'height': case 'width':
\par           if (!Element.visible(element)) return null;
\par 
\par           var dim = parseInt(proceed(element, style), 10);
\par 
\par           if (dim !== element['offset' + style.capitalize()])
\par             return dim + 'px';
\par 
\par           var properties;
\par           if (style === 'height') \{
\par             properties = ['border-top-width', 'padding-top',
\par              'padding-bottom', 'border-bottom-width'];
\par           \}
\par           else \{
\par             properties = ['border-left-width', 'padding-left',
\par              'padding-right', 'border-right-width'];
\par           \}
\par           return properties.inject(dim, function(memo, property) \{
\par             var val = proceed(element, property);
\par             return val === null ? memo : memo - parseInt(val, 10);
\par           \}) + 'px';
\par         default: return proceed(element, style);
\par       \}
\par     \}
\par   );
\par 
\par   Element.Methods.readAttribute = Element.Methods.readAttribute.wrap(
\par     function(proceed, element, attribute) \{
\par       if (attribute === 'title') return element.title;
\par       return proceed(element, attribute);
\par     \}
\par   );
\par \}
\par 
\par else if (Prototype.Browser.IE) \{
\par   Element.Methods.getOffsetParent = Element.Methods.getOffsetParent.wrap(
\par     function(proceed, element) \{
\par       element = $(element);
\par       try \{ element.offsetParent \}
\par       catch(e) \{ return $(document.body) \}
\par       var position = element.getStyle('position');
\par       if (position !== 'static') return proceed(element);
\par       element.setStyle(\{ position: 'relative' \});
\par       var value = proceed(element);
\par       element.setStyle(\{ position: position \});
\par       return value;
\par     \}
\par   );
\par 
\par   $w('positionedOffset viewportOffset').each(function(method) \{
\par     Element.Methods[method] = Element.Methods[method].wrap(
\par       function(proceed, element) \{
\par         element = $(element);
\par         try \{ element.offsetParent \}
\par         catch(e) \{ return Element._returnOffset(0,0) \}
\par         var position = element.getStyle('position');
\par         if (position !== 'static') return proceed(element);
\par         var offsetParent = element.getOffsetParent();
\par         if (offsetParent && offsetParent.getStyle('position') === 'fixed')
\par           offsetParent.setStyle(\{ zoom: 1 \});
\par         element.setStyle(\{ position: 'relative' \});
\par         var value = proceed(element);
\par         element.setStyle(\{ position: position \});
\par         return value;
\par       \}
\par     );
\par   \});
\par 
\par   Element.Methods.cumulativeOffset = Element.Methods.cumulativeOffset.wrap(
\par     function(proceed, element) \{
\par       try \{ element.offsetParent \}
\par       catch(e) \{ return Element._returnOffset(0,0) \}
\par       return proceed(element);
\par     \}
\par   );
\par 
\par   Element.Methods.getStyle = function(element, style) \{
\par     element = $(element);
\par     style = (style == 'float' || style == 'cssFloat') ? 'styleFloat' : style.camelize();
\par     var value = element.style[style];
\par     if (!value && element.currentStyle) value = element.currentStyle[style];
\par 
\par     if (style == 'opacity') \{
\par       if (value = (element.getStyle('filter') || '').match(/alpha\\(opacity=(.*)\\)/))
\par         if (value[1]) return parseFloat(value[1]) / 100;
\par       return 1.0;
\par     \}
\par 
\par     if (value == 'auto') \{
\par       if ((style == 'width' || style == 'height') && (element.getStyle('display') != 'none'))
\par         return element['offset' + style.capitalize()] + 'px';
\par       return null;
\par     \}
\par     return value;
\par   \};
\par 
\par   Element.Methods.setOpacity = function(element, value) \{
\par     function stripAlpha(filter)\{
\par       return filter.replace(/alpha\\([^\\)]*\\)/gi,'');
\par     \}
\par     element = $(element);
\par     var currentStyle = element.currentStyle;
\par     if ((currentStyle && !currentStyle.hasLayout) ||
\par       (!currentStyle && element.style.zoom == 'normal'))
\par         element.style.zoom = 1;
\par 
\par     var filter = element.getStyle('filter'), style = element.style;
\par     if (value == 1 || value === '') \{
\par       (filter = stripAlpha(filter)) ?
\par         style.filter = filter : style.removeAttribute('filter');
\par       return element;
\par     \} else if (value < 0.00001) value = 0;
\par     style.filter = stripAlpha(filter) +
\par       'alpha(opacity=' + (value * 100) + ')';
\par     return element;
\par   \};
\par 
\par   Element._attributeTranslations = (function()\{
\par 
\par     var classProp = 'className';
\par     var forProp = 'for';
\par 
\par     var el = document.createElement('div');
\par 
\par     el.setAttribute(classProp, 'x');
\par 
\par     if (el.className !== 'x') \{
\par       el.setAttribute('class', 'x');
\par       if (el.className === 'x') \{
\par         classProp = 'class';
\par       \}
\par     \}
\par     el = null;
\par 
\par     el = document.createElement('label');
\par     el.setAttribute(forProp, 'x');
\par     if (el.htmlFor !== 'x') \{
\par       el.setAttribute('htmlFor', 'x');
\par       if (el.htmlFor === 'x') \{
\par         forProp = 'htmlFor';
\par       \}
\par     \}
\par     el = null;
\par 
\par     return \{
\par       read: \{
\par         names: \{
\par           'class':      classProp,
\par           'className':  classProp,
\par           'for':        forProp,
\par           'htmlFor':    forProp
\par         \},
\par         values: \{
\par           _getAttr: function(element, attribute) \{
\par             return element.getAttribute(attribute);
\par           \},
\par           _getAttr2: function(element, attribute) \{
\par             return element.getAttribute(attribute, 2);
\par           \},
\par           _getAttrNode: function(element, attribute) \{
\par             var node = element.getAttributeNode(attribute);
\par             return node ? node.value : "";
\par           \},
\par           _getEv: (function()\{
\par 
\par             var el = document.createElement('div');
\par             el.onclick = Prototype.emptyFunction;
\par             var value = el.getAttribute('onclick');
\par             var f;
\par 
\par             if (String(value).indexOf('\{') > -1) \{
\par               f = function(element, attribute) \{
\par                 attribute = element.getAttribute(attribute);
\par                 if (!attribute) return null;
\par                 attribute = attribute.toString();
\par                 attribute = attribute.split('\{')[1];
\par                 attribute = attribute.split('\}')[0];
\par                 return attribute.strip();
\par               \};
\par             \}
\par             else if (value === '') \{
\par               f = function(element, attribute) \{
\par                 attribute = element.getAttribute(attribute);
\par                 if (!attribute) return null;
\par                 return attribute.strip();
\par               \};
\par             \}
\par             el = null;
\par             return f;
\par           \})(),
\par           _flag: function(element, attribute) \{
\par             return $(element).hasAttribute(attribute) ? attribute : null;
\par           \},
\par           style: function(element) \{
\par             return element.style.cssText.toLowerCase();
\par           \},
\par           title: function(element) \{
\par             return element.title;
\par           \}
\par         \}
\par       \}
\par     \}
\par   \})();
\par 
\par   Element._attributeTranslations.write = \{
\par     names: Object.extend(\{
\par       cellpadding: 'cellPadding',
\par       cellspacing: 'cellSpacing'
\par     \}, Element._attributeTranslations.read.names),
\par     values: \{
\par       checked: function(element, value) \{
\par         element.checked = !!value;
\par       \},
\par 
\par       style: function(element, value) \{
\par         element.style.cssText = value ? value : '';
\par       \}
\par     \}
\par   \};
\par 
\par   Element._attributeTranslations.has = \{\};
\par 
\par   $w('colSpan rowSpan vAlign dateTime accessKey tabIndex ' +
\par       'encType maxLength readOnly longDesc frameBorder').each(function(attr) \{
\par     Element._attributeTranslations.write.names[attr.toLowerCase()] = attr;
\par     Element._attributeTranslations.has[attr.toLowerCase()] = attr;
\par   \});
\par 
\par   (function(v) \{
\par     Object.extend(v, \{
\par       href:        v._getAttr2,
\par       src:         v._getAttr2,
\par       type:        v._getAttr,
\par       action:      v._getAttrNode,
\par       disabled:    v._flag,
\par       checked:     v._flag,
\par       readonly:    v._flag,
\par       multiple:    v._flag,
\par       onload:      v._getEv,
\par       onunload:    v._getEv,
\par       onclick:     v._getEv,
\par       ondblclick:  v._getEv,
\par       onmousedown: v._getEv,
\par       onmouseup:   v._getEv,
\par       onmouseover: v._getEv,
\par       onmousemove: v._getEv,
\par       onmouseout:  v._getEv,
\par       onfocus:     v._getEv,
\par       onblur:      v._getEv,
\par       onkeypress:  v._getEv,
\par       onkeydown:   v._getEv,
\par       onkeyup:     v._getEv,
\par       onsubmit:    v._getEv,
\par       onreset:     v._getEv,
\par       onselect:    v._getEv,
\par       onchange:    v._getEv
\par     \});
\par   \})(Element._attributeTranslations.read.values);
\par 
\par   if (Prototype.BrowserFeatures.ElementExtensions) \{
\par     (function() \{
\par       function _descendants(element) \{
\par         var nodes = element.getElementsByTagName('*'), results = [];
\par         for (var i = 0, node; node = nodes[i]; i++)
\par           if (node.tagName !== "!") // Filter out comment nodes.
\par             results.push(node);
\par         return results;
\par       \}
\par 
\par       Element.Methods.down = function(element, expression, index) \{
\par         element = $(element);
\par         if (arguments.length == 1) return element.firstDescendant();
\par         return Object.isNumber(expression) ? _descendants(element)[expression] :
\par           Element.select(element, expression)[index || 0];
\par       \}
\par     \})();
\par   \}
\par 
\par \}
\par 
\par else if (Prototype.Browser.Gecko && /rv:1\\.8\\.0/.test(navigator.userAgent)) \{
\par   Element.Methods.setOpacity = function(element, value) \{
\par     element = $(element);
\par     element.style.opacity = (value == 1) ? 0.999999 :
\par       (value === '') ? '' : (value < 0.00001) ? 0 : value;
\par     return element;
\par   \};
\par \}
\par 
\par else if (Prototype.Browser.WebKit) \{
\par   Element.Methods.setOpacity = function(element, value) \{
\par     element = $(element);
\par     element.style.opacity = (value == 1 || value === '') ? '' :
\par       (value < 0.00001) ? 0 : value;
\par 
\par     if (value == 1)
\par       if(element.tagName.toUpperCase() == 'IMG' && element.width) \{
\par         element.width++; element.width--;
\par       \} else try \{
\par         var n = document.createTextNode(' ');
\par         element.appendChild(n);
\par         element.removeChild(n);
\par       \} catch (e) \{ \}
\par 
\par     return element;
\par   \};
\par 
\par   Element.Methods.cumulativeOffset = function(element) \{
\par     var valueT = 0, valueL = 0;
\par     do \{
\par       valueT += element.offsetTop  || 0;
\par       valueL += element.offsetLeft || 0;
\par       if (element.offsetParent == document.body)
\par         if (Element.getStyle(element, 'position') == 'absolute') break;
\par 
\par       element = element.offsetParent;
\par     \} while (element);
\par 
\par     return Element._returnOffset(valueL, valueT);
\par   \};
\par \}
\par 
\par if ('outerHTML' in document.documentElement) \{
\par   Element.Methods.replace = function(element, content) \{
\par     element = $(element);
\par 
\par     if (content && content.toElement) content = content.toElement();
\par     if (Object.isElement(content)) \{
\par       element.parentNode.replaceChild(content, element);
\par       return element;
\par     \}
\par 
\par     content = Object.toHTML(content);
\par     var parent = element.parentNode, tagName = parent.tagName.toUpperCase();
\par 
\par     if (Element._insertionTranslations.tags[tagName]) \{
\par       var nextSibling = element.next();
\par       var fragments = Element._getContentFromAnonymousElement(tagName, content.stripScripts());
\par       parent.removeChild(element);
\par       if (nextSibling)
\par         fragments.each(function(node) \{ parent.insertBefore(node, nextSibling) \});
\par       else
\par         fragments.each(function(node) \{ parent.appendChild(node) \});
\par     \}
\par     else element.outerHTML = content.stripScripts();
\par 
\par     content.evalScripts.bind(content).defer();
\par     return element;
\par   \};
\par \}
\par 
\par Element._returnOffset = function(l, t) \{
\par   var result = [l, t];
\par   result.left = l;
\par   result.top = t;
\par   return result;
\par \};
\par 
\par Element._getContentFromAnonymousElement = function(tagName, html) \{
\par   var div = new Element('div'), t = Element._insertionTranslations.tags[tagName];
\par   if (t) \{
\par     div.innerHTML = t[0] + html + t[1];
\par     t[2].times(function() \{ div = div.firstChild \});
\par   \} else div.innerHTML = html;
\par   return $A(div.childNodes);
\par \};
\par 
\par Element._insertionTranslations = \{
\par   before: function(element, node) \{
\par     element.parentNode.insertBefore(node, element);
\par   \},
\par   top: function(element, node) \{
\par     element.insertBefore(node, element.firstChild);
\par   \},
\par   bottom: function(element, node) \{
\par     element.appendChild(node);
\par   \},
\par   after: function(element, node) \{
\par     element.parentNode.insertBefore(node, element.nextSibling);
\par   \},
\par   tags: \{
\par     TABLE:  ['<table>',                '</table>',                   1],
\par     TBODY:  ['<table><tbody>',         '</tbody></table>',           2],
\par     TR:     ['<table><tbody><tr>',     '</tr></tbody></table>',      3],
\par     TD:     ['<table><tbody><tr><td>', '</td></tr></tbody></table>', 4],
\par     SELECT: ['<select>',               '</select>',                  1]
\par   \}
\par \};
\par 
\par (function() \{
\par   var tags = Element._insertionTranslations.tags;
\par   Object.extend(tags, \{
\par     THEAD: tags.TBODY,
\par     TFOOT: tags.TBODY,
\par     TH:    tags.TD
\par   \});
\par \})();
\par 
\par Element.Methods.Simulated = \{
\par   hasAttribute: function(element, attribute) \{
\par     attribute = Element._attributeTranslations.has[attribute] || attribute;
\par     var node = $(element).getAttributeNode(attribute);
\par     return !!(node && node.specified);
\par   \}
\par \};
\par 
\par Element.Methods.ByTag = \{ \};
\par 
\par Object.extend(Element, Element.Methods);
\par 
\par (function(div) \{
\par 
\par   if (!Prototype.BrowserFeatures.ElementExtensions && div['__proto__']) \{
\par     window.HTMLElement = \{ \};
\par     window.HTMLElement.prototype = div['__proto__'];
\par     Prototype.BrowserFeatures.ElementExtensions = true;
\par   \}
\par 
\par   div = null;
\par 
\par \})(document.createElement('div'))
\par 
\par Element.extend = (function() \{
\par 
\par   function checkDeficiency(tagName) \{
\par     if (typeof window.Element != 'undefined') \{
\par       var proto = window.Element.prototype;
\par       if (proto) \{
\par         var id = '_' + (Math.random()+'').slice(2);
\par         var el = document.createElement(tagName);
\par         proto[id] = 'x';
\par         var isBuggy = (el[id] !== 'x');
\par         delete proto[id];
\par         el = null;
\par         return isBuggy;
\par       \}
\par     \}
\par     return false;
\par   \}
\par 
\par   function extendElementWith(element, methods) \{
\par     for (var property in methods) \{
\par       var value = methods[property];
\par       if (Object.isFunction(value) && !(property in element))
\par         element[property] = value.methodize();
\par     \}
\par   \}
\par 
\par   var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY = checkDeficiency('object');
\par 
\par   if (Prototype.BrowserFeatures.SpecificElementExtensions) \{
\par     if (HTMLOBJECTELEMENT_PROTOTYPE_BUGGY) \{
\par       return function(element) \{
\par         if (element && typeof element._extendedByPrototype == 'undefined') \{
\par           var t = element.tagName;
\par           if (t && (/^(?:object|applet|embed)$/i.test(t))) \{
\par             extendElementWith(element, Element.Methods);
\par             extendElementWith(element, Element.Methods.Simulated);
\par             extendElementWith(element, Element.Methods.ByTag[t.toUpperCase()]);
\par           \}
\par         \}
\par         return element;
\par       \}
\par     \}
\par     return Prototype.K;
\par   \}
\par 
\par   var Methods = \{ \}, ByTag = Element.Methods.ByTag;
\par 
\par   var extend = Object.extend(function(element) \{
\par     if (!element || typeof element._extendedByPrototype != 'undefined' ||
\par         element.nodeType != 1 || element == window) return element;
\par 
\par     var methods = Object.clone(Methods),
\par         tagName = element.tagName.toUpperCase();
\par 
\par     if (ByTag[tagName]) Object.extend(methods, ByTag[tagName]);
\par 
\par     extendElementWith(element, methods);
\par 
\par     element._extendedByPrototype = Prototype.emptyFunction;
\par     return element;
\par 
\par   \}, \{
\par     refresh: function() \{
\par       if (!Prototype.BrowserFeatures.ElementExtensions) \{
\par         Object.extend(Methods, Element.Methods);
\par         Object.extend(Methods, Element.Methods.Simulated);
\par       \}
\par     \}
\par   \});
\par 
\par   extend.refresh();
\par   return extend;
\par \})();
\par 
\par Element.hasAttribute = function(element, attribute) \{
\par   if (element.hasAttribute) return element.hasAttribute(attribute);
\par   return Element.Methods.Simulated.hasAttribute(element, attribute);
\par \};
\par 
\par Element.addMethods = function(methods) \{
\par   var F = Prototype.BrowserFeatures, T = Element.Methods.ByTag;
\par 
\par   if (!methods) \{
\par     Object.extend(Form, Form.Methods);
\par     Object.extend(Form.Element, Form.Element.Methods);
\par     Object.extend(Element.Methods.ByTag, \{
\par       "FORM":     Object.clone(Form.Methods),
\par       "INPUT":    Object.clone(Form.Element.Methods),
\par       "SELECT":   Object.clone(Form.Element.Methods),
\par       "TEXTAREA": Object.clone(Form.Element.Methods)
\par     \});
\par   \}
\par 
\par   if (arguments.length == 2) \{
\par     var tagName = methods;
\par     methods = arguments[1];
\par   \}
\par 
\par   if (!tagName) Object.extend(Element.Methods, methods || \{ \});
\par   else \{
\par     if (Object.isArray(tagName)) tagName.each(extend);
\par     else extend(tagName);
\par   \}
\par 
\par   function extend(tagName) \{
\par     tagName = tagName.toUpperCase();
\par     if (!Element.Methods.ByTag[tagName])
\par       Element.Methods.ByTag[tagName] = \{ \};
\par     Object.extend(Element.Methods.ByTag[tagName], methods);
\par   \}
\par 
\par   function copy(methods, destination, onlyIfAbsent) \{
\par     onlyIfAbsent = onlyIfAbsent || false;
\par     for (var property in methods) \{
\par       var value = methods[property];
\par       if (!Object.isFunction(value)) continue;
\par       if (!onlyIfAbsent || !(property in destination))
\par         destination[property] = value.methodize();
\par     \}
\par   \}
\par 
\par   function findDOMClass(tagName) \{
\par     var klass;
\par     var trans = \{
\par       "OPTGROUP": "OptGroup", "TEXTAREA": "TextArea", "P": "Paragraph",
\par       "FIELDSET": "FieldSet", "UL": "UList", "OL": "OList", "DL": "DList",
\par       "DIR": "Directory", "H1": "Heading", "H2": "Heading", "H3": "Heading",
\par       "H4": "Heading", "H5": "Heading", "H6": "Heading", "Q": "Quote",
\par       "INS": "Mod", "DEL": "Mod", "A": "Anchor", "IMG": "Image", "CAPTION":
\par       "TableCaption", "COL": "TableCol", "COLGROUP": "TableCol", "THEAD":
\par       "TableSection", "TFOOT": "TableSection", "TBODY": "TableSection", "TR":
\par       "TableRow", "TH": "TableCell", "TD": "TableCell", "FRAMESET":
\par       "FrameSet", "IFRAME": "IFrame"
\par     \};
\par     if (trans[tagName]) klass = 'HTML' + trans[tagName] + 'Element';
\par     if (window[klass]) return window[klass];
\par     klass = 'HTML' + tagName + 'Element';
\par     if (window[klass]) return window[klass];
\par     klass = 'HTML' + tagName.capitalize() + 'Element';
\par     if (window[klass]) return window[klass];
\par 
\par     var element = document.createElement(tagName);
\par     var proto = element['__proto__'] || element.constructor.prototype;
\par     element = null;
\par     return proto;
\par   \}
\par 
\par   var elementPrototype = window.HTMLElement ? HTMLElement.prototype :
\par    Element.prototype;
\par 
\par   if (F.ElementExtensions) \{
\par     copy(Element.Methods, elementPrototype);
\par     copy(Element.Methods.Simulated, elementPrototype, true);
\par   \}
\par 
\par   if (F.SpecificElementExtensions) \{
\par     for (var tag in Element.Methods.ByTag) \{
\par       var klass = findDOMClass(tag);
\par       if (Object.isUndefined(klass)) continue;
\par       copy(T[tag], klass.prototype);
\par     \}
\par   \}
\par 
\par   Object.extend(Element, Element.Methods);
\par   delete Element.ByTag;
\par 
\par   if (Element.extend.refresh) Element.extend.refresh();
\par   Element.cache = \{ \};
\par \};
\par 
\par 
\par document.viewport = \{
\par 
\par   getDimensions: function() \{
\par     return \{ width: this.getWidth(), height: this.getHeight() \};
\par   \},
\par 
\par   getScrollOffsets: function() \{
\par     return Element._returnOffset(
\par       window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft,
\par       window.pageYOffset || document.documentElement.scrollTop  || document.body.scrollTop);
\par   \}
\par \};
\par 
\par (function(viewport) \{
\par   var B = Prototype.Browser, doc = document, element, property = \{\};
\par 
\par   function getRootElement() \{
\par     if (B.WebKit && !doc.evaluate)
\par       return document;
\par 
\par     if (B.Opera && window.parseFloat(window.opera.version()) < 9.5)
\par       return document.body;
\par 
\par     return document.documentElement;
\par   \}
\par 
\par   function define(D) \{
\par     if (!element) element = getRootElement();
\par 
\par     property[D] = 'client' + D;
\par 
\par     viewport['get' + D] = function() \{ return element[property[D]] \};
\par     return viewport['get' + D]();
\par   \}
\par 
\par   viewport.getWidth  = define.curry('Width');
\par 
\par   viewport.getHeight = define.curry('Height');
\par \})(document.viewport);
\par 
\par 
\par Element.Storage = \{
\par   UID: 1
\par \};
\par 
\par Element.addMethods(\{
\par   getStorage: function(element) \{
\par     if (!(element = $(element))) return;
\par 
\par     var uid;
\par     if (element === window) \{
\par       uid = 0;
\par     \} else \{
\par       if (typeof element._prototypeUID === "undefined")
\par         element._prototypeUID = [Element.Storage.UID++];
\par       uid = element._prototypeUID[0];
\par     \}
\par 
\par     if (!Element.Storage[uid])
\par       Element.Storage[uid] = $H();
\par 
\par     return Element.Storage[uid];
\par   \},
\par 
\par   store: function(element, key, value) \{
\par     if (!(element = $(element))) return;
\par 
\par     if (arguments.length === 2) \{
\par       Element.getStorage(element).update(key);
\par     \} else \{
\par       Element.getStorage(element).set(key, value);
\par     \}
\par 
\par     return element;
\par   \},
\par 
\par   retrieve: function(element, key, defaultValue) \{
\par     if (!(element = $(element))) return;
\par     var hash = Element.getStorage(element), value = hash.get(key);
\par 
\par     if (Object.isUndefined(value)) \{
\par       hash.set(key, defaultValue);
\par       value = defaultValue;
\par     \}
\par 
\par     return value;
\par   \},
\par 
\par   clone: function(element, deep) \{
\par     if (!(element = $(element))) return;
\par     var clone = element.cloneNode(deep);
\par     clone._prototypeUID = void 0;
\par     if (deep) \{
\par       var descendants = Element.select(clone, '*'),
\par           i = descendants.length;
\par       while (i--) \{
\par         descendants[i]._prototypeUID = void 0;
\par       \}
\par     \}
\par     return Element.extend(clone);
\par   \}
\par \});
\par /* Portions of the Selector class are derived from Jack Slocum's DomQuery,
\par  * part of YUI-Ext version 0.40, distributed under the terms of an MIT-style
\par  * license.  Please see }{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "http://www.yui-ext.com/"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 
00d0c9ea79f9bace118c8200aa004ba90b0200000003000000e0c9ea79f9bace118c8200aa004ba90b4800000068007400740070003a002f002f007700770077002e007900750069002d006500780074002e0063006f006d002f000000795881f43b1d7f48af2c825dc485276300000000a5ab000000}}}{\fldrslt {
\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 http://www.yui-ext.com/}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 
 for more information. */
\par 
\par var Selector = Class.create(\{
\par   initialize: function(expression) \{
\par     this.expression = expression.strip();
\par 
\par     if (this.shouldUseSelectorsAPI()) \{
\par       this.mode = 'selectorsAPI';
\par     \} else if (this.shouldUseXPath()) \{
\par       this.mode = 'xpath';
\par       this.compileXPathMatcher();
\par     \} else \{
\par       this.mode = "normal";
\par       this.compileMatcher();
\par     \}
\par 
\par   \},
\par 
\par   shouldUseXPath: (function() \{
\par 
\par     var IS_DESCENDANT_SELECTOR_BUGGY = (function()\{
\par       var isBuggy = false;
\par       if (document.evaluate && window.XPathResult) \{
\par         var el = document.createElement('div');
\par         el.innerHTML = '<ul><li></li></ul><div><ul><li></li></ul></div>';
\par 
\par         var xpath = ".//*[local-name()='ul' or local-name()='UL']" +
\par           "//*[local-name()='li' or local-name()='LI']";
\par 
\par         var result = document.evaluate(xpath, el, null,
\par           XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
\par 
\par         isBuggy = (result.snapshotLength !== 2);
\par         el = null;
\par       \}
\par       return isBuggy;
\par     \})();
\par 
\par     return function() \{
\par       if (!Prototype.BrowserFeatures.XPath) return false;
\par 
\par       var e = this.expression;
\par 
\par       if (Prototype.Browser.WebKit &&
\par        (e.include("-of-type") || e.include(":empty")))
\par         return false;
\par 
\par       if ((/(\\[[\\w-]*?:|:checked)/).test(e))
\par         return false;
\par 
\par       if (IS_DESCENDANT_SELECTOR_BUGGY) return false;
\par 
\par       return true;
\par     \}
\par 
\par   \})(),
\par 
\par   shouldUseSelectorsAPI: function() \{
\par     if (!Prototype.BrowserFeatures.SelectorsAPI) return false;
\par 
\par     if (Selector.CASE_INSENSITIVE_CLASS_NAMES) return false;
\par 
\par     if (!Selector._div) Selector._div = new Element('div');
\par 
\par     try \{
\par       Selector._div.querySelector(this.expression);
\par     \} catch(e) \{
\par       return false;
\par     \}
\par 
\par     return true;
\par   \},
\par 
\par   compileMatcher: function() \{
\par     var e = this.expression, ps = Selector.patterns, h = Selector.handlers,
\par         c = Selector.criteria, le, p, m, len = ps.length, name;
\par 
\par     if (Selector._cache[e]) \{
\par       this.matcher = Selector._cache[e];
\par       return;
\par     \}
\par 
\par     this.matcher = ["this.matcher = function(root) \{",
\par                     "var r = root, h = Selector.handlers, c = false, n;"];
\par 
\par     while (e && le != e && (/\\S/).test(e)) \{
\par       le = e;
\par       for (var i = 0; i<len; i++) \{
\par         p = ps[i].re;
\par         name = ps[i].name;
\par         if (m = e.match(p)) \{
\par           this.matcher.push(Object.isFunction(c[name]) ? c[name](m) :
\par             new Template(c[name]).evaluate(m));
\par           e = e.replace(m[0], '');
\par           break;
\par         \}
\par       \}
\par     \}
\par 
\par     this.matcher.push("return h.unique(n);\\n\}");
\par     eval(this.matcher.join('\\n'));
\par     Selector._cache[this.expression] = this.matcher;
\par   \},
\par 
\par   compileXPathMatcher: function() \{
\par     var e = this.expression, ps = Selector.patterns,
\par         x = Selector.xpath, le, m, len = ps.length, name;
\par 
\par     if (Selector._cache[e]) \{
\par       this.xpath = Selector._cache[e]; return;
\par     \}
\par 
\par     this.matcher = ['.//*'];
\par     while (e && le != e && (/\\S/).test(e)) \{
\par       le = e;
\par       for (var i = 0; i<len; i++) \{
\par         name = ps[i].name;
\par         if (m = e.match(ps[i].re)) \{
\par           this.matcher.push(Object.isFunction(x[name]) ? x[name](m) :
\par             new Template(x[name]).evaluate(m));
\par           e = e.replace(m[0], '');
\par           break;
\par         \}
\par       \}
\par     \}
\par 
\par     this.xpath = this.matcher.join('');
\par     Selector._cache[this.expression] = this.xpath;
\par   \},
\par 
\par   findElements: function(root) \{
\par     root = root || document;
\par     var e = this.expression, results;
\par 
\par     switch (this.mode) \{
\par       case 'selectorsAPI':
\par         if (root !== document) \{
\par           var oldId = root.id, id = $(root).identify();
\par           id = id.replace(/([\\.:])/g, "}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\$1"}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000050000005c005c0024003100000000}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\$1}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ");
\par           e = "#" + id + " " + e;
\par         \}
\par 
\par         results = $A(root.querySelectorAll(e)).map(Element.extend);
\par         root.id = oldId;
\par 
\par         return results;
\par       case 'xpath':
\par         return document._getElementsByXPath(this.xpath, root);
\par       default:
\par        return this.matcher(root);
\par     \}
\par   \},
\par 
\par   match: function(element) \{
\par     this.tokens = [];
\par 
\par     var e = this.expression, ps = Selector.patterns, as = Selector.assertions;
\par     var le, p, m, len = ps.length, name;
\par 
\par     while (e && le !== e && (/\\S/).test(e)) \{
\par       le = e;
\par       for (var i = 0; i<len; i++) \{
\par         p = ps[i].re;
\par         name = ps[i].name;
\par         if (m = e.match(p)) \{
\par           if (as[name]) \{
\par             this.tokens.push([name, Object.clone(m)]);
\par             e = e.replace(m[0], '');
\par           \} else \{
\par             return this.findElements(document).include(element);
\par           \}
\par         \}
\par       \}
\par     \}
\par 
\par     var match = true, name, matches;
\par     for (var i = 0, token; token = this.tokens[i]; i++) \{
\par       name = token[0], matches = token[1];
\par       if (!Selector.assertions[name](element, matches)) \{
\par         match = false; break;
\par       \}
\par     \}
\par 
\par     return match;
\par   \},
\par 
\par   toString: function() \{
\par     return this.expression;
\par   \},
\par 
\par   inspect: function() \{
\par     return "#<Selector:" + this.expression.inspect() + ">";
\par   \}
\par \});
\par 
\par if (Prototype.BrowserFeatures.SelectorsAPI &&
\par  document.compatMode === 'BackCompat') \{
\par   Selector.CASE_INSENSITIVE_CLASS_NAMES = (function()\{
\par     var div = document.createElement('div'),
\par      span = document.createElement('span');
\par 
\par     div.id = "prototype_test_id";
\par     span.className = 'Test';
\par     div.appendChild(span);
\par     var isIgnored = (div.querySelector('#prototype_test_id .test') !== null);
\par     div = span = null;
\par     return isIgnored;
\par   \})();
\par \}
\par 
\par Object.extend(Selector, \{
\par   _cache: \{ \},
\par 
\par   xpath: \{
\par     descendant:   "//*",
\par     child:        "/*",
\par     adjacent:     "/following-sibling::*[1]",
\par     laterSibling: '/following-sibling::*',
\par     tagName:      function(m) \{
\par       if (m[1] == '*') return '';
\par       return "[local-name()='" + m[1].toLowerCase() +
\par              "' or local-name()='" + m[1].toUpperCase() + "']";
\par     \},
\par     className:    "[contains(concat(' ', @class, ' '), ' #\{1\} ')]",
\par     id:           "[@id='#\{1\}']",
\par     attrPresence: function(m) \{
\par       m[1] = m[1].toLowerCase();
\par       return new Template("[@#\{1\}]").evaluate(m);
\par     \},
\par     attr: function(m) \{
\par       m[1] = m[1].toLowerCase();
\par       m[3] = m[5] || m[6];
\par       return new Template(Selector.xpath.operators[m[2]]).evaluate(m);
\par     \},
\par     pseudo: function(m) \{
\par       var h = Selector.xpath.pseudos[m[1]];
\par       if (!h) return '';
\par       if (Object.isFunction(h)) return h(m);
\par       return new Template(Selector.xpath.pseudos[m[1]]).evaluate(m);
\par     \},
\par     operators: \{
\par       '=':  "[@#\{1\}='#\{3\}']",
\par       '!=': "[@#\{1\}!='#\{3\}']",
\par       '^=': "[starts-with(@#\{1\}, '#\{3\}')]",
\par       '$=': "[substring(@#\{1\}, (string-length(@#\{1\}) - string-length('#\{3\}') + 1))='#\{3\}']",
\par       '*=': "[contains(@#\{1\}, '#\{3\}')]",
\par       '~=': "[contains(concat(' ', @#\{1\}, ' '), ' #\{3\} ')]",
\par       '|=': "[contains(concat('-', @#\{1\}, '-'), '-#\{3\}-')]"
\par     \},
\par     pseudos: \{
\par       'first-child': '[not(preceding-sibling::*)]',
\par       'last-child':  '[not(following-sibling::*)]',
\par       'only-child':  '[not(preceding-sibling::* or following-sibling::*)]',
\par       'empty':       "[count(*) = 0 and (count(text()) = 0)]",
\par       'checked':     "[@checked]",
\par       'disabled':    "[(@disabled) and (@type!='hidden')]",
\par       'enabled':     "[not(@disabled) and (@type!='hidden')]",
\par       'not': function(m) \{
\par         var e = m[6], p = Selector.patterns,
\par             x = Selector.xpath, le, v, len = p.length, name;
\par 
\par         var exclusion = [];
\par         while (e && le != e && (/\\S/).test(e)) \{
\par           le = e;
\par           for (var i = 0; i<len; i++) \{
\par             name = p[i].name
\par             if (m = e.match(p[i].re)) \{
\par               v = Object.isFunction(x[name]) ? x[name](m) : new Template(x[name]).evaluate(m);
\par               exclusion.push("(" + v.substring(1, v.length - 1) + ")");
\par               e = e.replace(m[0], '');
\par               break;
\par             \}
\par           \}
\par         \}
\par         return "[not(" + exclusion.join(" and ") + ")]";
\par       \},
\par       'nth-child':      function(m) \{
\par         return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ", m);
\par       \},
\par       'nth-last-child': function(m) \{
\par         return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ", m);
\par       \},
\par       'nth-of-type':    function(m) \{
\par         return Selector.xpath.pseudos.nth("position() ", m);
\par       \},
\par       'nth-last-of-type': function(m) \{
\par         return Selector.xpath.pseudos.nth("(last() + 1 - position()) ", m);
\par       \},
\par       'first-of-type':  function(m) \{
\par         m[6] = "1"; return Selector.xpath.pseudos['nth-of-type'](m);
\par       \},
\par       'last-of-type':   function(m) \{
\par         m[6] = "1"; return Selector.xpath.pseudos['nth-last-of-type'](m);
\par       \},
\par       'only-of-type':   function(m) \{
\par         var p = Selector.xpath.pseudos; return p['first-of-type'](m) + p['last-of-type'](m);
\par       \},
\par       nth: function(fragment, m) \{
\par         var mm, formula = m[6], predicate;
\par         if (formula == 'even') formula = '2n+0';
\par         if (formula == 'odd')  formula = '2n+1';
\par         if (mm = formula.match(/^(\\d+)$/)) // digit only
\par           return '[' + fragment + "= " + mm[1] + ']';
\par         if (mm = formula.match(/^(-?\\d*)?n(([+-])(\\d+))?/)) \{ // an+b
\par           if (mm[1] == "-") mm[1] = -1;
\par           var a = mm[1] ? Number(mm[1]) : 1;
\par           var b = mm[2] ? Number(mm[2]) : 0;
\par           predicate = "[((#\{fragment\} - #\{b\}) mod #\{a\} = 0) and " +
\par           "((#\{fragment\} - #\{b\}) div #\{a\} >= 0)]";
\par           return new Template(predicate).evaluate(\{
\par             fragment: fragment, a: a, b: b \});
\par         \}
\par       \}
\par     \}
\par   \},
\par 
\par   criteria: \{
\par     tagName:      'n = h.tagName(n, r, "#\{1\}", c);      c = false;',
\par     className:    'n = h.className(n, r, "#\{1\}", c);    c = false;',
\par     id:           'n = h.id(n, r, "#\{1\}", c);           c = false;',
\par     attrPresence: 'n = h.attrPresence(n, r, "#\{1\}", c); c = false;',
\par     attr: function(m) \{
\par       m[3] = (m[5] || m[6]);
\par       return new Template('n = h.attr(n, r, "#\{1\}", "#\{3\}", "#\{2\}", c); c = false;').evaluate(m);
\par     \},
\par     pseudo: function(m) \{
\par       if (m[6]) m[6] = m[6].replace(/"/g, '}{\field{\*\fldinst {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 HYPERLINK "\\\\\\\\""}{\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\lang9\langfe1033\langnp9\insrsid4013925\charrsid4013925 {\*\datafield 00d0c9ea79f9bace118c8200aa004ba90b0200000003010000030000005c005c00000000}}}{\fldrslt {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 
\f37\fs22\ul\cf2\lang9\langfe1033\langnp9\insrsid4013925 \\\\"}}}\sectd \ltrsect\linex0\sectdefaultcl\sftnbj {\rtlch\fcs1 \af37\afs22 \ltrch\fcs0 \f37\fs22\lang9\langfe1033\langnp9\insrsid4013925 ');
\par       return new Template('n = h.pseudo(n, "#\{1\}", "#\{6\}", r, c); c = false;').evaluate(m);
\par     \},
\par     descendant:   'c = "descendant";',
\par     child:        'c = "child";',
\par     adjacent:     'c = "adjacent";',
\par     laterSibling: 'c = "laterSibling";'
\par   \},
\par 
\par   patterns: [
\par     \{ name: 'laterSibling', re: /^\\s*~\\s*/ \},
\par     \{ name: 'child',        re: /^\\s*>\\s*/ \},
\par     \{ name: 'adjacent',     re: /^\\s*\\+\\s*/ \},
\par     \{ name: 'descendant',   re: /^\\s/ \},
\par 
\par     \{ name: 'tagName',      re: /^\\s*(\\*|[\\w\\-]+)(\\b|$)?/ \},
\par     \{ name: 'id',           re: /^#([\\w\\-\\*]+)(\\b|$)/ \},
\par     \{ name: 'className',    re: /^\\.([\\w\\-\\*]+)(\\b|$)/ \},
\par     \{ name: 'pseudo',       re: /^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\\((.*?)\\))?(\\b|$|(?=\\s|[:+~>]))/ \},
\par     \{ name: 'attrPresence', re: /^\\[((?:[\\w-]+:)?[\\w-]+)\\]/ \},
\par     \{ name: 'attr',         re: /\\[((?:[\\w-]*:)?[\\w-]+)\\s*(?:([!^$*~|]?=)\\s*((['"])([^\\4]*?)\\4|([^'"][^\\]]*?)))?\\]/ \}
\par   ],
\par 
\par   assertions: \{
\par     tagName: function(element, matches) \{
\par       return matches[1].toUpperCase() == element.tagName.toUpperCase();
\par     \},
\par 
\par     className: function(element, matches) \{
\par       return Element.hasClassName(element, matches[1]);
\par     \},
\par 
\par     id: function(element, matches) \{
\par       return element.id === matches[1];
\par     \},
\par 
\par     attrPresence: function(element, matches) \{
\par       return Element.hasAttribute(element, matches[1]);
\par     \},
\par 
\par     attr: function(element, matches) \{
\par       var nodeValue = Element.readAttribute(element, matches[1]);
\par       return nodeValue && Selector.operators[matches[2]](nodeValue, matches[5] || matches[6]);
\par     \}
\par   \},
\par 
\par   handlers: \{
\par     concat: function(a, b) \{
\par       for (var i = 0, node; node = b[i]; i++)
\par         a.push(node);
\par       return a;
\par     \},
\par 
\par     mark: function(nodes) \{
\par       var _true = Prototype.emptyFunction;
\par       for (var i = 0, node; node = nodes[i]; i++)
\par         node._countedByPrototype = _true;
\par       return nodes;
\par     \},
\par 
\par     unmark: (function()\{
\par 
\par       var PROPERTIES_ATTRIBUTES_MAP = (function()\{
\par         var el = document.createElement('div'),
\par             isBuggy = false,
\par             propName = '_countedByPrototype',
\par             value = 'x'
\par         el[propName] = value;
\par         isBuggy = (el.getAttribute(propName) === value);
\par         el = null;
\par         return isBuggy;
\par       \})();
\par 
\par       return PROPERTIES_ATTRIBUTES_MAP ?
\par         function(nodes) \{
\par           for (var i = 0, node; node = nodes[i]; i++)
\par             node.removeAttribute('_countedByPrototype');
\par           return nodes;
\par         \} :
\par         function(nodes) \{
\par           for (var i = 0, node; node = nodes[i]; i++)
\par             node._countedByPrototype = void 0;
\par           return nodes;
\par         \}
\par     \})(),
\par 
\par     index: function(parentNode, reverse, ofType) \{
\par       parentNode._countedByPrototype = Prototype.emptyFunction;
\par       if (reverse) \{
\par         for (var nodes = parentNode.childNodes, i = nodes.length - 1, j = 1; i >= 0; i--) \{
\par           var node = nodes[i];
\par           if (node.nodeType == 1 && (!ofType || node._countedByPrototype)) node.nodeIndex = j++;
\par         \}
\par       \} else \{
\par         for (var i = 0, j = 1, nodes = parentNode.childNodes; node = nodes[i]; i++)
\par           if (node.nodeType == 1 && (!ofType || node._countedByPrototype)) node.nodeIndex = j++;
\par       \}
\par     \},
\par 
\par     unique: function(nodes) \{
\par       if (nodes.length == 0) return nodes;
\par       var results = [], n;
\par       for (var i = 0, l = nodes.length; i < l; i++)
\par         if (typeof (n = nodes[i])._countedByPrototype == 'undefined') \{
\par           n._countedByPrototype = Prototype.emptyFunction;
\par           results.push(Element.extend(n));
\par         \}
\par       return Selector.handlers.unmark(results);
\par     \},
\par 
\par     descendant: function(nodes) \{
\par       var h = Selector.handlers;
\par       for (var i = 0, results = [], node; node = nodes[i]; i++)
\par         h.concat(results, node.getElementsByTagName('*'));
\par       return results;
\par     \},
\par 
\par     child: function(nodes) \{
\par       var h = Selector.handlers;
\par       for (var i = 0, results = [], node; node = nodes[i]; i++) \{
\par         for (var j = 0, child; child = node.childNodes[j]; j++)
\par           if (child.nodeType == 1 && child.tagName != '!') results.push(child);
\par       \}
\par       return results;
\par     \},
\par 
\par     adjacent: function(nodes) \{
\par       for (var i = 0, results = [], node; node = nodes[i]; i++) \{
\par         var next = this.nextElementSibling(node);
\par         if (next) results.push(next);
\par       \}
\par       return results;
\par     \},
\par 
\par     laterSibling: function(nodes) \{
\par       var h = Selector.handlers;
\par       for (var i = 0, results = [], node; node = nodes[i]; i++)
\par         h.concat(results, Element.nextSiblings(node));
\par       return results;
\par     \},
\par 
\par     nextElementSibling: function(node) \{
\par       while (node = node.nextSibling)
\par         if (node.nodeType == 1) return node;
\par       return null;
\par     \},
\par 
\par     previousElementSibling: function(node) \{
\par       while (node = node.previousSibling)
\par         if (node.nodeType == 1) return node;
\par       return null;
\par     \},
\par 
\par     tagName: function(nodes, root, tagName, combinator) \{
\par       var uTagName = tagName.toUpperCase();
\par       var results = [], h = Selector.handlers;
\par       if (nodes) \{
\par         if (combinator) \{
\par           if (combinator == "descendant") \{
\par             for (var i = 0, node; node = nodes[i]; i++)
\par               h.concat(results, node.getElementsByTagName(tagName));
\par             return results;
\par           \} else nodes = this[combinator](nodes);
\par           if (tagName == "*") return nodes;
\par         \}
\par         for (var i = 0, node; node = nodes[i]; i++)
\par           if (node.tagName.toUpperCase() === uTagName) results.push(node);
\par         return results;
\par       \} else return root.getElementsByTagName(tagName);
\par     \},
\par 
\par     id: function(nodes, root, id, combinator) \{
\par       var targetNode = $(id), h = Selector.handlers;
\par 
\par       if (root == document) \{
\par         if (!targetNode) return [];
\par         if (!nodes) return [targetNode];
\par       \} else \{
\par         if (!root.sourceIndex || root.sourceIndex < 1) \{
\par           var nodes = root.getElementsByTagName('*');
\par           for (var j = 0, node; node = nodes[j]; j++) \{
\par             if (node.id === id) return [node];
\par           \}
\par         \}
\par       \}
\par 
\par       if (nodes) \{
\par         if (combinator) \{
\par           if (combinator == 'child') \{
\par             for (var i = 0, node; node = nodes[i]; i++)
\par               if (targetNode.parentNode == node) return [targetNode];
\par           \} else if (combinator == 'descendant') \{
\par             for (var i = 0, node; node = nodes[i]; i++)
\par               if (Element.descendantOf(targetNode, node)) return [targetNode];
\par           \} else if (combinator == 'adjacent') \{
\par             for (var i = 0, node; node = nodes[i]; i++)
\par               if (Selector.handlers.previousElementSibling(targetNode) == node)
\par                 return [targetNode];
\par           \} else nodes = h[combinator](nodes);
\par         \}
\par         for (var i = 0, node; node = nodes[i]; i++)
\par           if (node == targetNode) return [targetNode];
\par         return [];
\par       \}
\par       return (targetNode && Element.descendantOf(targetNode, root)) ? [targetNode] : [];
\par     \},
\par 
\par     className: function(nodes, root, className, combinator) \{
\par       if (nodes && combinator) nodes = this[combinator](nodes);
\par       return Selector.handlers.byClassName(nodes, root, className);
\par     \},
\par 
\par     byClassName: function(nodes, root, className) \{
\par       if (!nodes) nodes = Selector.handlers.descendant([root]);
\par       var needle = ' ' + className + ' ';
\par       for (var i = 0, results = [], node, nodeClassName; node = nodes[i]; i++) \{
\par         nodeClassName = node.className;
\par         if (nodeClassName.length == 0) continue;
\par         if (nodeClassName == className || (' ' + nodeClassName + ' ').include(needle))
\par           results.push(node);
\par       \}
\par       return results;
\par     \},
\par 
\par     attrPresence: function(nodes, root, attr, combinator) \{
\par       if (!nodes) nodes = root.getElementsByTagName("*");
\par       if (nodes && combinator) nodes = this[combinator](nodes);
\par       var results = [];
\par       for (var i = 0, node; node = nodes[i]; i++)
\par         if (Element.hasAttribute(node, attr)) results.push(node);
\par       return results;
\par     \},
\par 
\par     attr: function(nodes, root, attr, value, operator, combinator) \{
\par       if (!nodes) nodes = root.getElementsByTagName("*");
\par       if (nodes && combinator) nodes = this[combinator](nodes);
\par       var handler = Selector.operators[operator], results = [];
\par       for (var i = 0, node; node = nodes[i]; i++) \{
\par         var nodeValue = Element.readAttribute(node, attr);
\par         if (nodeValue === null) continue;
\par         if (handler(nodeValue, value)) results.push(node);
\par       \}
\par       return results;
\par     \},
\par 
\par     pseudo: function(nodes, name, value, root, combinator) \{
\par       if (nodes && combinator) nodes = this[combinator](nodes);
\par       if (!nodes) nodes = root.getElementsByTagName("*");
\par       return Selector.pseudos[name](nodes, value, root);
\par     \}
\par   \},
\par 
\par   pseudos: \{
\par     'first-child': function(nodes, value, root) \{
\par       for (var i = 0, results = [], node; node = nodes[i]; i++) \{
\par         if (Selector.handlers.previousElementSibling(node)) continue;
\par           results.push(node);
\par       \}
\par       return results;
\par     \},
\par     'last-child': function(nodes, value, root) \{
\par       for (var i = 0, results = [], node; node = nodes[i]; i++) \{
\par         if (Selector.handlers.nextElementSibling(node)) continue;
\par           results.push(node);
\par       \}
\par       return results;
\par     \},
\par     'only-child': function(nodes, value, root) \{
\par       var h = Selector.handlers;
\par       for (var i = 0, results = [], node; node = nodes[i]; i++)
\par         if (!h.previousElementSibling(node) && !h.nextElementSibling(node))
\par           results.push(node);
\par       return results;
\par     \},
\par     'nth-child':        function(nodes, formula, root) \{
\par       return Selector.pseudos.nth(nodes, formula, root);
\par     \},
\par     'nth-last-child':   function(nodes, formula, root) \{
\par       return Selector.pseudos.nth(nodes, formula, root, true);
\par     \},
\par     'nth-of-type':      function(nodes, formula, root) \{
\par       return Selector.pseudos.nth(nodes, formula, root, false, true);
\par     \},
\par     'nth-last-of-type': function(nodes, formula, root) \{
\par       return Selector.pseudos.nth(nodes, formula, root, true, true);
\par     \},
\par     'first-of-type':    function(nodes, formula, root) \{
\par       return Selector.pseudos.nth(nodes, "1", root, false, true);
\par     \},
\par     'last-of-type':     function(nodes, formula, root) \{
\par       return Selector.pseudos.nth(nodes, "1", root, true, true);
\par     \},
\par     'only-of-type':     function(nodes, formula, root) \{
\par       var p = Selector.pseudos;
\par       return p['last-of-type'](p['first-of-type'](nodes, formula, root), formula, root);
\par     \},
\par 
\par     getIndices: function(a, b, total) \{
\par       if (a == 0) return b > 0 ? [b] : [];
\par       return $R(1, total).inject([], function(memo, i) \{
\par         if (0 == (i - b) % a && (i - b) / a >= 0) memo.push(i);
\par         return memo;
\par       \});
\par     \},
\par 
\par     nth: function(nodes, formula, root, reverse, ofType) \{
\par       if (nodes.length == 0) return [];
\par       if (formula == 'even') formula = '2n+0';
\par       if (formula == 'odd')  formula = '2n+1';
\par       var h = Selector.handlers, results = [], indexed = [], m;
\par       h.mark(nodes);
\par       for (var i = 0, node; node = nodes[i]; i++) \{
\par         if (!node.parentNode._countedByPrototype) \{
\par           h.index(node.parentNode, reverse, ofType);
\par           indexed.push(node.parentNode);
\par         \}
\par       \}
\par       if (formula.match(/^\\d+$/)) \{ // just a number
\par         formula = Number(formula);
\par         for (var i = 0, node; node = nodes[i]; i++)
\par           if (node.nodeIndex == formula) results.push(node);
\par       \} else if (m = formula.match(/^(-?\\d*)?n(([+-])(\\d+))?/)) \{ // an+b
\par         if (m[1] == "-") m[1] = -1;
\par         var a = m[1] ? Number(m[1]) : 1;
\par         var b = m[2] ? Number(m[2]) : 0;
\par         var indices = Selector.pseudos.getIndices(a, b, nodes.length);
\par         for (var i = 0, node, l = indices.length; node = nodes[i]; i++) \{
\par           for (var j = 0; j < l; j++)
\par             if (node.nodeIndex == indices[j]) results.push(node);
\par         \}
\par       \}
\par       h.unmark(nodes);
\par       h.unmark(indexed);
\par       return results;
\par     \},
\par 
\par     'empty': function(nodes, value, root) \{
\par       for (var i = 0, results = [], node; node = nodes[i]; i++) \{
\par         if (node.tagName == '!' || node.firstChild) continue;
\par         results.push(node);
\par       \}
\par       return results;
\par     \},
\par 
\par     'not': function(nodes, selector, root) \{
\par       var h = Selector.handlers, selectorType, m;
\par       var exclusions = new Selector(selector).findElements(root);
\par       h.mark(exclusions);
\par       for (var i = 0, results = [], node; node = nodes[i]; i++)
\par         if (!node._countedByPrototype) results.push(node);
\par       h.unmark(exclusions);
\par       return results;
\par     \},
\par 
\par     'enabled': function(nodes, value, root) \{
\par       for (var i = 0, results = [], node; node = nodes[i]; i++)
\par         if (!node.disabled && (!node.type || node.type !== 'hidden'))
\par           results.push(node);
\par       return results;
\par     \},
\par 
\par     'disabled': function(nodes, value, root) \{
\par       for (var i = 0, results = [], node; node = nodes[i]; i++)
\par         if (node.disabled) results.push(node);
\par       return results;
\par     \},
\par 
\par     'checked': function(nodes, value, root) \{
\par       for (var i = 0, results = [], node; node = nodes[i]; i++)
\par         if (node.checked) results.push(node);
\par       return results;
\par     \}
\par   \},
\par 
\par   operators: \{
\par     '=':  function(nv, v) \{ return nv == v; \},
\par     '!=': function(nv, v) \{ return nv != v; \},
\par     '^=': function(nv, v) \{ return nv == v || nv && nv.startsWith(v); \},
\par     '$=': function(nv, v) \{ return nv == v || nv && nv.endsWith(v); \},
\par     '*=': function(nv, v) \{ return nv == v || nv && nv.include(v); \},
\par     '~=': function(nv, v) \{ return (' ' + nv + ' ').include(' ' + v + ' '); \},
\par     '|=': function(nv, v) \{ return ('-' + (nv || "").toUpperCase() +
\par      '-').include('-' + (v || "").toUpperCase() + '-'); \}
\par   \},
\par 
\par   split: function(expression) \{
\par     var expressions = [];
\par     expression.scan(/(([\\w#:.~>+()\\s-]+|\\*|\\[.*?\\])+)\\s*(,|$)/, function(m) \{
\par       expressions.push(m[1].strip());
\par     \});
\par     return expressions;
\par   \},
\par 
\par   matchElements: function(elements, expression) \{
\par     var matches = $$(expression), h = Selector.handlers;
\par     h.mark(matches);
\par     for (var i = 0, results = [], element; element = elements[i]; i++)
\par       if (element._countedByPrototype) results.push(element);
\par     h.unmark(matches);
\par     return results;
\par   \},
\par 
\par   findElement: function(elements, expression, index) \{
\par     if (Object.isNumber(expression)) \{
\par       index = expression; expression = false;
\par     \}
\par     return Selector.matchElements(elements, expression || '*')[index || 0];
\par   \},
\par 
\par   findChildElements: function(element, expressions) \{
\par     expressions = Selector.split(expressions.join(','));
\par     var results = [], h = Selector.handlers;
\par     for (var i = 0, l = expressions.length, selector; i < l; i++) \{
\par       selector = new Selector(expressions[i].strip());
\par       h.concat(results, selector.findElements(element));
\par     \}
\par     return (l > 1) ? h.unique(results) : results;
\par   \}
\par \});
\par 
\par if (Prototype.Browser.IE) \{
\par   Object.extend(Selector.handlers, \{
\par     concat: function(a, b) \{
\par       for (var i = 0, node; node = b[i]; i++)
\par         if (node.tagName !== "!") a.push(node);
\par       return a;
\par     \}
\par   \});
\par \}
\par 
\par function $$() \{
\par   return Selector.findChildElements(document, $A(arguments));
\par \}
\par 
\par var Form = \{
\par   reset: function(form) \{
\par     form = $(form);
\par     form.reset();
\par     return form;
\par   \},
\par 
\par   serializeElements: function(elements, options) \{
\par     if (typeof options != 'object') options = \{ hash: !!options \};
\par     else if (Object.isUndefined(options.hash)) options.hash = true;
\par     var key, value, submitted = false, submit = options.submit;
\par 
\par     var data = elements.inject(\{ \}, function(result, element) \{
\par       if (!element.disabled && element.name) \{
\par         key = element.name; value = $(element).getValue();
\par         if (value != null && element.type != 'file' && (element.type != 'submit' || (!submitted &&
\par             submit !== false && (!submit || key == submit) && (submitted = true)))) \{
\par           if (key in result) \{
\par             if (!Object.isArray(result[key])) result[key] = [result[key]];
\par             result[key].push(value);
\par           \}
\par           else result[key] = value;
\par         \}
\par       \}
\par       return result;
\par     \});
\par 
\par     return options.hash ? data : Object.toQueryString(data);
\par   \}
\par \};
\par 
\par Form.Methods = \{
\par   serialize: function(form, options) \{
\par     return Form.serializeElements(Form.getElements(form), options);
\par   \},
\par 
\par   getElements: function(form) \{
\par     var elements = $(form).getElementsByTagName('*'),
\par         element,
\par         arr = [ ],
\par         serializers = Form.Element.Serializers;
\par     for (var i = 0; element = elements[i]; i++) \{
\par       arr.push(element);
\par     \}
\par     return arr.inject([], function(elements, child) \{
\par       if (serializers[child.tagName.toLowerCase()])
\par         elements.push(Element.extend(child));
\par       return elements;
\par     \})
\par   \},
\par 
\par   getInputs: function(form, typeName, name) \{
\par     form = $(form);
\par     var inputs = form.getElementsByTagName('input');
\par 
\par     if (!typeName && !name) return $A(inputs).map(Element.extend);
\par 
\par     for (var i = 0, matchingInputs = [], length = inputs.length; i < length; i++) \{
\par       var input = inputs[i];
\par       if ((typeName && input.type != typeName) || (name && input.name != name))
\par         continue;
\par       matchingInputs.push(Element.extend(input));
\par     \}
\par 
\par     return matchingInputs;
\par   \},
\par 
\par   disable: function(form) \{
\par     form = $(form);
\par     Form.getElements(form).invoke('disable');
\par     return form;
\par   \},
\par 
\par   enable: function(form) \{
\par     form = $(form);
\par     Form.getElements(form).invoke('enable');
\par     return form;
\par   \},
\par 
\par   findFirstElement: function(form) \{
\par     var elements = $(form).getElements().findAll(function(element) \{
\par       return 'hidden' != element.type && !element.disabled;
\par     \});
\par     var firstByIndex = elements.findAll(function(element) \{
\par       return element.hasAttribute('tabIndex') && element.tabIndex >= 0;
\par     \}).sortBy(function(element) \{ return element.tabIndex \}).first();
\par 
\par     return firstByIndex ? firstByIndex : elements.find(function(element) \{
\par       return /^(?:input|select|textarea)$/i.test(element.tagName);
\par     \});
\par   \},
\par 
\par   focusFirstElement: function(form) \{
\par     form = $(form);
\par     form.findFirstElement().activate();
\par     return form;
\par   \},
\par 
\par   request: function(form, options) \{
\par     form = $(form), options = Object.clone(options || \{ \});
\par 
\par     var params = options.parameters, action = form.readAttribute('action') || '';
\par     if (action.blank()) action = window.location.href;
\par     options.parameters = form.serialize(true);
\par 
\par     if (params) \{
\par       if (Object.isString(params)) params = params.toQueryParams();
\par       Object.extend(options.parameters, params);
\par     \}
\par 
\par     if (form.hasAttribute('method') && !options.method)
\par       options.method = form.method;
\par 
\par     return new Ajax.Request(action, options);
\par   \}
\par \};
\par 
\par /*--------------------------------------------------------------------------*/
\par 
\par 
\par Form.Element = \{
\par   focus: function(element) \{
\par     $(element).focus();
\par     return element;
\par   \},
\par 
\par   select: function(element) \{
\par     $(element).select();
\par     return element;
\par   \}
\par \};
\par 
\par Form.Element.Methods = \{
\par 
\par   serialize: function(element) \{
\par     element = $(element);
\par     if (!element.disabled && element.name) \{
\par       var value = element.getValue();
\par       if (value != undefined) \{
\par         var pair = \{ \};
\par         pair[element.name] = value;
\par         return Object.toQueryString(pair);
\par       \}
\par     \}
\par     return '';
\par   \},
\par 
\par   getValue: function(element) \{
\par     element = $(element);
\par     var method = element.tagName.toLowerCase();
\par     return Form.Element.Serializers[method](element);
\par   \},
\par 
\par   setValue: function(element, value) \{
\par     element = $(element);
\par     var method = element.tagName.toLowerCase();
\par     Form.Element.Serializers[method](element, value);
\par     return element;
\par   \},
\par 
\par   clear: function(element) \{
\par     $(element).value = '';
\par     return element;
\par   \},
\par 
\par   present: function(element) \{
\par     return $(element).value != '';
\par   \},
\par 
\par   activate: function(element) \{
\par     element = $(element);
\par     try \{
\par       element.focus();
\par       if (element.select && (element.tagName.toLowerCase() != 'input' ||
\par           !(/^(?:button|reset|submit)$/i.test(element.type))))
\par         element.select();
\par     \} catch (e) \{ \}
\par     return element;
\par   \},
\par 
\par   disable: function(element) \{
\par     element = $(element);
\par     element.disabled = true;
\par     return element;
\par   \},
\par 
\par   enable: function(element) \{
\par     element = $(element);
\par     element.disabled = false;
\par     return element;
\par   \}
\par \};
\par 
\par /*--------------------------------------------------------------------------*/
\par 
\par var Field = Form.Element;
\par 
\par var $F = Form.Element.Methods.getValue;
\par 
\par /*--------------------------------------------------------------------------*/
\par 
\par Form.Element.Serializers = \{
\par   input: function(element, value) \{
\par     switch (element.type.toLowerCase()) \{
\par       case 'checkbox':
\par       case 'radio':
\par         return Form.Element.Serializers.inputSelector(element, value);
\par       default:
\par         return Form.Element.Serializers.textarea(element, value);
\par     \}
\par   \},
\par 
\par   inputSelector: function(element, value) \{
\par     if (Object.isUndefined(value)) return element.checked ? element.value : null;
\par     else element.checked = !!value;
\par   \},
\par 
\par   textarea: function(element, value) \{
\par     if (Object.isUndefined(value)) return element.value;
\par     else element.value = value;
\par   \},
\par 
\par   select: function(element, value) \{
\par     if (Object.isUndefined(value))
\par       return this[element.type == 'select-one' ?
\par         'selectOne' : 'selectMany'](element);
\par     else \{
\par       var opt, currentValue, single = !Object.isArray(value);
\par       for (var i = 0, length = element.length; i < length; i++) \{
\par         opt = element.options[i];
\par         currentValue = this.optionValue(opt);
\par         if (single) \{
\par           if (currentValue == value) \{
\par             opt.selected = true;
\par             return;
\par           \}
\par         \}
\par         else opt.selected = value.include(currentValue);
\par       \}
\par     \}
\par   \},
\par 
\par   selectOne: function(element) \{
\par     var index = element.selectedIndex;
\par     return index >= 0 ? this.optionValue(element.options[index]) : null;
\par   \},
\par 
\par   selectMany: function(element) \{
\par     var values, length = element.length;
\par     if (!length) return null;
\par 
\par     for (var i = 0, values = []; i < length; i++) \{
\par       var opt = element.options[i];
\par       if (opt.selected) values.push(this.optionValue(opt));
\par     \}
\par     return values;
\par   \},
\par 
\par   optionValue: function(opt) \{
\par     return Element.extend(opt).hasAttribute('value') ? opt.value : opt.text;
\par   \}
\par \};
\par 
\par /*--------------------------------------------------------------------------*/
\par 
\par 
\par Abstract.TimedObserver = Class.create(PeriodicalExecuter, \{
\par   initialize: function($super, element, frequency, callback) \{
\par     $super(callback, frequency);
\par     this.element   = $(element);
\par     this.lastValue = this.getValue();
\par   \},
\par 
\par   execute: function() \{
\par     var value = this.getValue();
\par     if (Object.isString(this.lastValue) && Object.isString(value) ?
\par         this.lastValue != value : String(this.lastValue) != String(value)) \{
\par       this.callback(this.element, value);
\par       this.lastValue = value;
\par     \}
\par   \}
\par \});
\par 
\par Form.Element.Observer = Class.create(Abstract.TimedObserver, \{
\par   getValue: function() \{
\par     return Form.Element.getValue(this.element);
\par   \}
\par \});
\par 
\par Form.Observer = Class.create(Abstract.TimedObserver, \{
\par   getValue: function() \{
\par     return Form.serialize(this.element);
\par   \}
\par \});
\par 
\par /*--------------------------------------------------------------------------*/
\par 
\par Abstract.EventObserver = Class.create(\{
\par   initialize: function(element, callback) \{
\par     this.element  = $(element);
\par     this.callback = callback;
\par 
\par     this.lastValue = this.getValue();
\par     if (this.element.tagName.toLowerCase() == 'form')
\par       this.registerFormCallbacks();
\par     else
\par       this.registerCallback(this.element);
\par   \},
\par 
\par   onElementEvent: function() \{
\par     var value = this.getValue();
\par     if (this.lastValue != value) \{
\par       this.callback(this.element, value);
\par       this.lastValue = value;
\par     \}
\par   \},
\par 
\par   registerFormCallbacks: function() \{
\par     Form.getElements(this.element).each(this.registerCallback, this);
\par   \},
\par 
\par   registerCallback: function(element) \{
\par     if (element.type) \{
\par       switch (element.type.toLowerCase()) \{
\par         case 'checkbox':
\par         case 'radio':
\par           Event.observe(element, 'click', this.onElementEvent.bind(this));
\par           break;
\par         default:
\par           Event.observe(element, 'change', this.onElementEvent.bind(this));
\par           break;
\par       \}
\par     \}
\par   \}
\par \});
\par 
\par Form.Element.EventObserver = Class.create(Abstract.EventObserver, \{
\par   getValue: function() \{
\par     return Form.Element.getValue(this.element);
\par   \}
\par \});
\par 
\par Form.EventObserver = Class.create(Abstract.EventObserver, \{
\par   getValue: function() \{
\par     return Form.serialize(this.element);
\par   \}
\par \});
\par (function() \{
\par 
\par   var Event = \{
\par     KEY_BACKSPACE: 8,
\par     KEY_TAB:       9,
\par     KEY_RETURN:   13,
\par     KEY_ESC:      27,
\par     KEY_LEFT:     37,
\par     KEY_UP:       38,
\par     KEY_RIGHT:    39,
\par     KEY_DOWN:     40,
\par     KEY_DELETE:   46,
\par     KEY_HOME:     36,
\par     KEY_END:      35,
\par     KEY_PAGEUP:   33,
\par     KEY_PAGEDOWN: 34,
\par     KEY_INSERT:   45,
\par 
\par     cache: \{\}
\par   \};
\par 
\par   var docEl = document.documentElement;
\par   var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED = 'onmouseenter' in docEl
\par     && 'onmouseleave' in docEl;
\par 
\par   var _isButton;
\par   if (Prototype.Browser.IE) \{
\par     var buttonMap = \{ 0: 1, 1: 4, 2: 2 \};
\par     _isButton = function(event, code) \{
\par       return event.button === buttonMap[code];
\par     \};
\par   \} else if (Prototype.Browser.WebKit) \{
\par     _isButton = function(event, code) \{
\par       switch (code) \{
\par         case 0: return event.which == 1 && !event.metaKey;
\par         case 1: return event.which == 1 && event.metaKey;
\par         default: return false;
\par       \}
\par     \};
\par   \} else \{
\par     _isButton = function(event, code) \{
\par       return event.which ? (event.which === code + 1) : (event.button === code);
\par     \};
\par   \}
\par 
\par   function isLeftClick(event)   \{ return _isButton(event, 0) \}
\par 
\par   function isMiddleClick(event) \{ return _isButton(event, 1) \}
\par 
\par   function isRightClick(event)  \{ return _isButton(event, 2) \}
\par 
\par   function element(event) \{
\par     event = Event.extend(event);
\par 
\par     var node = event.target, type = event.type,
\par      currentTarget = event.currentTarget;
\par 
\par     if (currentTarget && currentTarget.tagName) \{
\par       if (type === 'load' || type === 'error' ||
\par         (type === 'click' && currentTarget.tagName.toLowerCase() === 'input'
\par           && currentTarget.type === 'radio'))
\par             node = currentTarget;
\par     \}
\par 
\par     if (node.nodeType == Node.TEXT_NODE)
\par       node = node.parentNode;
\par 
\par     return Element.extend(node);
\par   \}
\par 
\par   function findElement(event, expression) \{
\par     var element = Event.element(event);
\par     if (!expression) return element;
\par     var elements = [element].concat(element.ancestors());
\par     return Selector.findElement(elements, expression, 0);
\par   \}
\par 
\par   function pointer(event) \{
\par     return \{ x: pointerX(event), y: pointerY(event) \};
\par   \}
\par 
\par   function pointerX(event) \{
\par     var docElement = document.documentElement,
\par      body = document.body || \{ scrollLeft: 0 \};
\par 
\par     return event.pageX || (event.clientX +
\par       (docElement.scrollLeft || body.scrollLeft) -
\par       (docElement.clientLeft || 0));
\par   \}
\par 
\par   function pointerY(event) \{
\par     var docElement = document.documentElement,
\par      body = document.body || \{ scrollTop: 0 \};
\par 
\par     return  event.pageY || (event.clientY +
\par        (docElement.scrollTop || body.scrollTop) -
\par        (docElement.clientTop || 0));
\par   \}
\par 
\par 
\par   function stop(event) \{
\par     Event.extend(event);
\par     event.preventDefault();
\par     event.stopPropagation();
\par 
\par     event.stopped = true;
\par   \}
\par 
\par   Event.Methods = \{
\par     isLeftClick: isLeftClick,
\par     isMiddleClick: isMiddleClick,
\par     isRightClick: isRightClick,
\par 
\par     element: element,
\par     findElement: findElement,
\par 
\par     pointer: pointer,
\par     pointerX: pointerX,
\par     pointerY: pointerY,
\par 
\par     stop: stop
\par   \};
\par 
\par 
\par   var methods = Object.keys(Event.Methods).inject(\{ \}, function(m, name) \{
\par     m[name] = Event.Methods[name].methodize();
\par     return m;
\par   \});
\par 
\par   if (Prototype.Browser.IE) \{
\par     function _relatedTarget(event) \{
\par       var element;
\par       switch (event.type) \{
\par         case 'mouseover': element = event.fromElement; break;
\par         case 'mouseout':  element = event.toElement;   break;
\par         default: return null;
\par       \}
\par       return Element.extend(element);
\par     \}
\par 
\par     Object.extend(methods, \{
\par       stopPropagation: function() \{ this.cancelBubble = true \},
\par       preventDefault:  function() \{ this.returnValue = false \},
\par       inspect: function() \{ return '[object Event]' \}
\par     \});
\par 
\par     Event.extend = function(event, element) \{
\par       if (!event) return false;
\par       if (event._extendedByPrototype) return event;
\par 
\par       event._extendedByPrototype = Prototype.emptyFunction;
\par       var pointer = Event.pointer(event);
\par 
\par       Object.extend(event, \{
\par         target: event.srcElement || element,
\par         relatedTarget: _relatedTarget(event),
\par         pageX:  pointer.x,
\par         pageY:  pointer.y
\par       \});
\par 
\par       return Object.extend(event, methods);
\par     \};
\par   \} else \{
\par     Event.prototype = window.Event.prototype || document.createEvent('HTMLEvents').__proto__;
\par     Object.extend(Event.prototype, methods);
\par     Event.extend = Prototype.K;
\par   \}
\par 
\par   function _createResponder(element, eventName, handler) \{
\par     var registry = Element.retrieve(element, 'prototype_event_registry');
\par 
\par     if (Object.isUndefined(registry)) \{
\par       CACHE.push(element);
\par       registry = Element.retrieve(element, 'prototype_event_registry', $H());
\par     \}
\par 
\par     var respondersForEvent = registry.get(eventName);
\par     if (Object.isUndefined(respondersForEvent)) \{
\par       respondersForEvent = [];
\par       registry.set(eventName, respondersForEvent);
\par     \}
\par 
\par     if (respondersForEvent.pluck('handler').include(handler)) return false;
\par 
\par     var responder;
\par     if (eventName.include(":")) \{
\par       responder = function(event) \{
\par         if (Object.isUndefined(event.eventName))
\par           return false;
\par 
\par         if (event.eventName !== eventName)
\par           return false;
\par 
\par         Event.extend(event, element);
\par         handler.call(element, event);
\par       \};
\par     \} else \{
\par       if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED &&
\par        (eventName === "mouseenter" || eventName === "mouseleave")) \{
\par         if (eventName === "mouseenter" || eventName === "mouseleave") \{
\par           responder = function(event) \{
\par             Event.extend(event, element);
\par 
\par             var parent = event.relatedTarget;
\par             while (parent && parent !== element) \{
\par               try \{ parent = parent.parentNode; \}
\par               catch(e) \{ parent = element; \}
\par             \}
\par 
\par             if (parent === element) return;
\par 
\par             handler.call(element, event);
\par           \};
\par         \}
\par       \} else \{
\par         responder = function(event) \{
\par           Event.extend(event, element);
\par           handler.call(element, event);
\par         \};
\par       \}
\par     \}
\par 
\par     responder.handler = handler;
\par     respondersForEvent.push(responder);
\par     return responder;
\par   \}
\par 
\par   function _destroyCache() \{
\par     for (var i = 0, length = CACHE.length; i < length; i++) \{
\par       Event.stopObserving(CACHE[i]);
\par       CACHE[i] = null;
\par     \}
\par   \}
\par 
\par   var CACHE = [];
\par 
\par   if (Prototype.Browser.IE)
\par     window.attachEvent('onunload', _destroyCache);
\par 
\par   if (Prototype.Browser.WebKit)
\par     window.addEventListener('unload', Prototype.emptyFunction, false);
\par 
\par 
\par   var _getDOMEventName = Prototype.K;
\par 
\par   if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED) \{
\par     _getDOMEventName = function(eventName) \{
\par       var translations = \{ mouseenter: "mouseover", mouseleave: "mouseout" \};
\par       return eventName in translations ? translations[eventName] : eventName;
\par     \};
\par   \}
\par 
\par   function observe(element, eventName, handler) \{
\par     element = $(element);
\par 
\par     var responder = _createResponder(element, eventName, handler);
\par 
\par     if (!responder) return element;
\par 
\par     if (eventName.include(':')) \{
\par       if (element.addEventListener)
\par         element.addEventListener("dataavailable", responder, false);
\par       else \{
\par         element.attachEvent("ondataavailable", responder);
\par         element.attachEvent("onfilterchange", responder);
\par       \}
\par     \} else \{
\par       var actualEventName = _getDOMEventName(eventName);
\par 
\par       if (element.addEventListener)
\par         element.addEventListener(actualEventName, responder, false);
\par       else
\par         element.attachEvent("on" + actualEventName, responder);
\par     \}
\par 
\par     return element;
\par   \}
\par 
\par   function stopObserving(element, eventName, handler) \{
\par     element = $(element);
\par 
\par     var registry = Element.retrieve(element, 'prototype_event_registry');
\par 
\par     if (Object.isUndefined(registry)) return element;
\par 
\par     if (eventName && !handler) \{
\par       var responders = registry.get(eventName);
\par 
\par       if (Object.isUndefined(responders)) return element;
\par 
\par       responders.each( function(r) \{
\par         Element.stopObserving(element, eventName, r.handler);
\par       \});
\par       return element;
\par     \} else if (!eventName) \{
\par       registry.each( function(pair) \{
\par         var eventName = pair.key, responders = pair.value;
\par 
\par         responders.each( function(r) \{
\par           Element.stopObserving(element, eventName, r.handler);
\par         \});
\par       \});
\par       return element;
\par     \}
\par 
\par     var responders = registry.get(eventName);
\par 
\par     if (!responders) return;
\par 
\par     var responder = responders.find( function(r) \{ return r.handler === handler; \});
\par     if (!responder) return element;
\par 
\par     var actualEventName = _getDOMEventName(eventName);
\par 
\par     if (eventName.include(':')) \{
\par       if (element.removeEventListener)
\par         element.removeEventListener("dataavailable", responder, false);
\par       else \{
\par         element.detachEvent("ondataavailable", responder);
\par         element.detachEvent("onfilterchange",  responder);
\par       \}
\par     \} else \{
\par       if (element.removeEventListener)
\par         element.removeEventListener(actualEventName, responder, false);
\par       else
\par         element.detachEvent('on' + actualEventName, responder);
\par     \}
\par 
\par     registry.set(eventName, responders.without(responder));
\par 
\par     return element;
\par   \}
\par 
\par   function fire(element, eventName, memo, bubble) \{
\par     element = $(element);
\par 
\par     if (Object.isUndefined(bubble))
\par       bubble = true;
\par 
\par     if (element == document && document.createEvent && !element.dispatchEvent)
\par       element = document.documentElement;
\par 
\par     var event;
\par     if (document.createEvent) \{
\par       event = document.createEvent('HTMLEvents');
\par       event.initEvent('dataavailable', true, true);
\par     \} else \{
\par       event = document.createEventObject();
\par       event.eventType = bubble ? 'ondataavailable' : 'onfilterchange';
\par     \}
\par 
\par     event.eventName = eventName;
\par     event.memo = memo || \{ \};
\par 
\par     if (document.createEvent)
\par       element.dispatchEvent(event);
\par     else
\par       element.fireEvent(event.eventType, event);
\par 
\par     return Event.extend(event);
\par   \}
\par 
\par 
\par   Object.extend(Event, Event.Methods);
\par 
\par   Object.extend(Event, \{
\par     fire:          fire,
\par     observe:       observe,
\par     stopObserving: stopObserving
\par   \});
\par 
\par   Element.addMethods(\{
\par     fire:          fire,
\par 
\par     observe:       observe,
\par 
\par     stopObserving: stopObserving
\par   \});
\par 
\par   Object.extend(document, \{
\par     fire:          fire.methodize(),
\par 
\par     observe:       observe.methodize(),
\par 
\par     stopObserving: stopObserving.methodize(),
\par 
\par     loaded:        false
\par   \});
\par 
\par   if (window.Event) Object.extend(window.Event, Event);
\par   else window.Event = Event;
\par \})();
\par 
\par (function() \{
\par   /* Support for the DOMContentLoaded event is based on work by Dan Webb,
\par      Matthias Miller, Dean Edwards, John Resig, and Diego Perini. */
\par 
\par   var timer;
\par 
\par   function fireContentLoadedEvent() \{
\par     if (document.loaded) return;
\par     if (timer) window.clearTimeout(timer);
\par     document.loaded = true;
\par     document.fire('dom:loaded');
\par   \}
\par 
\par   function checkReadyState() \{
\par     if (document.readyState === 'complete') \{
\par       document.stopObserving('readystatechange', checkReadyState);
\par       fireContentLoadedEvent();
\par     \}
\par   \}
\par 
\par   function pollDoScroll() \{
\par     try \{ document.documentElement.doScroll('left'); \}
\par     catch(e) \{
\par       timer = pollDoScroll.defer();
\par       return;
\par     \}
\par     fireContentLoadedEvent();
\par   \}
\par 
\par   if (document.addEventListener) \{
\par     document.addEventListener('DOMContentLoaded', fireContentLoadedEvent, false);
\par   \} else \{
\par     document.observe('readystatechange', checkReadyState);
\par     if (window == top)
\par       timer = pollDoScroll.defer();
\par   \}
\par 
\par   Event.observe(window, 'load', fireContentLoadedEvent);
\par \})();
\par 
\par Element.addMethods();
\par 
\par /*------------------------------- DEPRECATED -------------------------------*/
\par 
\par Hash.toQueryString = Object.toQueryString;
\par 
\par var Toggle = \{ display: Element.toggle \};
\par 
\par Element.Methods.childOf = Element.Methods.descendantOf;
\par 
\par var Insertion = \{
\par   Before: function(element, content) \{
\par     return Element.insert(element, \{before:content\});
\par   \},
\par 
\par   Top: function(element, content) \{
\par     return Element.insert(element, \{top:content\});
\par   \},
\par 
\par   Bottom: function(element, content) \{
\par     return Element.insert(element, \{bottom:content\});
\par   \},
\par 
\par   After: function(element, content) \{
\par     return Element.insert(element, \{after:content\});
\par   \}
\par \};
\par 
\par var $continue = new Error('"throw $continue" is deprecated, use "return" instead');
\par 
\par var Position = \{
\par   includeScrollOffsets: false,
\par 
\par   prepare: function() \{
\par     this.deltaX =  window.pageXOffset
\par                 || document.documentElement.scrollLeft
\par                 || document.body.scrollLeft
\par                 || 0;
\par     this.deltaY =  window.pageYOffset
\par                 || document.documentElement.scrollTop
\par                 || document.body.scrollTop
\par                 || 0;
\par   \},
\par 
\par   within: function(element, x, y) \{
\par     if (this.includeScrollOffsets)
\par       return this.withinIncludingScrolloffsets(element, x, y);
\par     this.xcomp = x;
\par     this.ycomp = y;
\par     this.offset = Element.cumulativeOffset(element);
\par 
\par     return (y >= this.offset[1] &&
\par             y <  this.offset[1] + element.offsetHeight &&
\par             x >= this.offset[0] &&
\par             x <  this.offset[0] + element.offsetWidth);
\par   \},
\par 
\par   withinIncludingScrolloffsets: function(element, x, y) \{
\par     var offsetcache = Element.cumulativeScrollOffset(element);
\par 
\par     this.xcomp = x + offsetcache[0] - this.deltaX;
\par     this.ycomp = y + offsetcache[1] - this.deltaY;
\par     this.offset = Element.cumulativeOffset(element);
\par 
\par     return (this.ycomp >= this.offset[1] &&
\par             this.ycomp <  this.offset[1] + element.offsetHeight &&
\par             this.xcomp >= this.offset[0] &&
\par             this.xcomp <  this.offset[0] + element.offsetWidth);
\par   \},
\par 
\par   overlap: function(mode, element) \{
\par     if (!mode) return 0;
\par     if (mode == 'vertical')
\par       return ((this.offset[1] + element.offsetHeight) - this.ycomp) /
\par         element.offsetHeight;
\par     if (mode == 'horizontal')
\par       return ((this.offset[0] + element.offsetWidth) - this.xcomp) /
\par         element.offsetWidth;
\par   \},
\par 
\par 
\par   cumulativeOffset: Element.Methods.cumulativeOffset,
\par 
\par   positionedOffset: Element.Methods.positionedOffset,
\par 
\par   absolutize: function(element) \{
\par     Position.prepare();
\par     return Element.absolutize(element);
\par   \},
\par 
\par   relativize: function(element) \{
\par     Position.prepare();
\par     return Element.relativize(element);
\par   \},
\par 
\par   realOffset: Element.Methods.cumulativeScrollOffset,
\par 
\par   offsetParent: Element.Methods.getOffsetParent,
\par 
\par   page: Element.Methods.viewportOffset,
\par 
\par   clone: function(source, target, options) \{
\par     options = options || \{ \};
\par     return Element.clonePosition(target, source, options);
\par   \}
\par \};
\par 
\par /*--------------------------------------------------------------------------*/
\par 
\par if (!document.getElementsByClassName) document.getElementsByClassName = function(instanceMethods)\{
\par   function iter(name) \{
\par     return name.blank() ? null : "[contains(concat(' ', @class, ' '), ' " + name + " ')]";
\par   \}
\par 
\par   instanceMethods.getElementsByClassName = Prototype.BrowserFeatures.XPath ?
\par   function(element, className) \{
\par     className = className.toString().strip();
\par     var cond = /\\s/.test(className) ? $w(className).map(iter).join('') : iter(className);
\par     return cond ? document._getElementsByXPath('.//*' + cond, element) : [];
\par   \} : function(element, className) \{
\par     className = className.toString().strip();
\par     var elements = [], classNames = (/\\s/.test(className) ? $w(className) : null);
\par     if (!classNames && !className) return elements;
\par 
\par     var nodes = $(element).getElementsByTagName('*');
\par     className = ' ' + className + ' ';
\par 
\par     for (var i = 0, child, cn; child = nodes[i]; i++) \{
\par       if (child.className && (cn = ' ' + child.className + ' ') && (cn.include(className) ||
\par           (classNames && classNames.all(function(name) \{
\par             return !name.toString().blank() && cn.include(' ' + name + ' ');
\par           \}))))
\par         elements.push(Element.extend(child));
\par     \}
\par     return elements;
\par   \};
\par 
\par   return function(className, parentElement) \{
\par     return $(parentElement || document.body).getElementsByClassName(className);
\par   \};
\par \}(Element.Methods);
\par 
\par /*--------------------------------------------------------------------------*/
\par 
\par Element.ClassNames = Class.create();
\par Element.ClassNames.prototype = \{
\par   initialize: function(element) \{
\par     this.element = $(element);
\par   \},
\par 
\par   _each: function(iterator) \{
\par     this.element.className.split(/\\s+/).select(function(name) \{
\par       return name.length > 0;
\par     \})._each(iterator);
\par   \},
\par 
\par   set: function(className) \{
\par     this.element.className = className;
\par   \},
\par 
\par   add: function(classNameToAdd) \{
\par     if (this.include(classNameToAdd)) return;
\par     this.set($A(this).concat(classNameToAdd).join(' '));
\par   \},
\par 
\par   remove: function(classNameToRemove) \{
\par     if (!this.include(classNameToRemove)) return;
\par     this.set($A(this).without(classNameToRemove).join(' '));
\par   \},
\par 
\par   toString: function() \{
\par     return $A(this).join(' ');
\par   \}
\par \};
\par 
\par Object.extend(Element.ClassNames.prototype, Enumerable);
\par 
\par /*--------------------------------------------------------------------------*/
\par /** KofC bug reports :   
\par *) "whenever I hit a barb camp, I have to refresh every time they return otherwise the food is not deposited. 
\par     I wrote them four times about it. They said it could take weeks to fix. 
\par     I hit over over three hundred barb camps and cannot be refreshing every second"
\par 
\par *) Encamped troops sometimes return on attack
\par 
\par *) tower alerts limited to 10 unless refreshed ??
\par 
\par 
\par Feature ideas:
\par *) Next button when reading messages
\par *) Delete button when reading messages / reports
\par *) Message 'from' field should include alliance name
\par *) Prevent 0,0 attacks
\par *) Bypass 'collected x gold' dialog
\par 
\par ***/
\par }{\*\themedata 504b030414000600080000002100e9de0fbfff0000001c020000130000005b436f6e74656e745f54797065735d2e786d6cac91cb4ec3301045f748fc83e52d4a
9cb2400825e982c78ec7a27cc0c8992416c9d8b2a755fbf74cd25442a820166c2cd933f79e3be372bd1f07b5c3989ca74aaff2422b24eb1b475da5df374fd9ad
5689811a183c61a50f98f4babebc2837878049899a52a57be670674cb23d8e90721f90a4d2fa3802cb35762680fd800ecd7551dc18eb899138e3c943d7e503b6
b01d583deee5f99824e290b4ba3f364eac4a430883b3c092d4eca8f946c916422ecab927f52ea42b89a1cd59c254f919b0e85e6535d135a8de20f20b8c12c3b0
0c895fcf6720192de6bf3b9e89ecdbd6596cbcdd8eb28e7c365ecc4ec1ff1460f53fe813d3cc7f5b7f020000ffff0300504b030414000600080000002100a5d6
a7e7c0000000360100000b0000005f72656c732f2e72656c73848fcf6ac3300c87ef85bd83d17d51d2c31825762fa590432fa37d00e1287f68221bdb1bebdb4f
c7060abb0884a4eff7a93dfeae8bf9e194e720169aaa06c3e2433fcb68e1763dbf7f82c985a4a725085b787086a37bdbb55fbc50d1a33ccd311ba548b6309512
0f88d94fbc52ae4264d1c910d24a45db3462247fa791715fd71f989e19e0364cd3f51652d73760ae8fa8c9ffb3c330cc9e4fc17faf2ce545046e37944c69e462
a1a82fe353bd90a865aad41ed0b5b8f9d6fd010000ffff0300504b0304140006000800000021006b799616830000008a0000001c0000007468656d652f746865
6d652f7468656d654d616e616765722e786d6c0ccc4d0ac3201040e17da17790d93763bb284562b2cbaebbf600439c1a41c7a0d29fdbd7e5e38337cedf14d59b
4b0d592c9c070d8a65cd2e88b7f07c2ca71ba8da481cc52c6ce1c715e6e97818c9b48d13df49c873517d23d59085adb5dd20d6b52bd521ef2cdd5eb9246a3d8b
4757e8d3f729e245eb2b260a0238fd010000ffff0300504b03041400060008000000210030dd4329a8060000a41b0000160000007468656d652f7468656d652f
7468656d65312e786d6cec594f6fdb3614bf0fd87720746f6327761a07758ad8b19b2d4d1bc46e871e698996d850a240d2497d1bdae38001c3ba618715d86d87
615b8116d8a5fb34d93a6c1dd0afb0475292c5585e9236d88aad3e2412f9e3fbff1e1fa9abd7eec70c1d1221294fda5efd72cd4324f1794093b0eddd1ef62fad
79482a9c0498f184b4bd2991deb58df7dfbb8ad755446282607d22d771db8b944ad79796a40fc3585ee62949606ecc458c15bc8a702910f808e8c66c69b9565b
5d8a314d3c94e018c8de1a8fa94fd05093f43672e23d06af89927ac06762a049136785c10607758d9053d965021d62d6f6804fc08f86e4bef210c352c144dbab
999fb7b4717509af678b985ab0b6b4ae6f7ed9ba6c4170b06c788a705430adf71bad2b5b057d03606a1ed7ebf5babd7a41cf00b0ef83a6569632cd467faddec9
699640f6719e76b7d6ac355c7c89feca9cccad4ea7d36c65b258a206641f1b73f8b5da6a6373d9c11b90c537e7f08dce66b7bbeae00dc8e257e7f0fd2badd586
8b37a088d1e4600ead1ddaef67d40bc898b3ed4af81ac0d76a197c86826828a24bb318f3442d8ab518dfe3a20f000d6458d104a9694ac6d88728eee2782428d6
0cf03ac1a5193be4cbb921cd0b495fd054b5bd0f530c1931a3f7eaf9f7af9e3f45c70f9e1d3ff8e9f8e1c3e3073f5a42ceaa6d9c84e5552fbffdeccfc71fa33f
9e7ef3f2d117d57859c6fffac327bffcfc793510d26726ce8b2f9ffcf6ecc98baf3efdfdbb4715f04d814765f890c644a29be408edf3181433567125272371be
15c308d3f28acd249438c19a4b05fd9e8a1cf4cd296699771c393ac4b5e01d01e5a30a787d72cf1178108989a2159c77a2d801ee72ce3a5c545a6147f32a9979
3849c26ae66252c6ed637c58c5bb8b13c7bfbd490a75330f4b47f16e441c31f7184e140e494214d273fc80900aedee52ead87597fa824b3e56e82e451d4c2b4d
32a423279a668bb6690c7e9956e90cfe766cb37b077538abd27a8b1cba48c80acc2a841f12e698f13a9e281c57911ce298950d7e03aba84ac8c154f8655c4f2a
f074481847bd804859b5e696007d4b4edfc150b12addbecba6b18b148a1e54d1bc81392f23b7f84137c2715a851dd0242a633f900710a218ed715505dfe56e86
e877f0034e16bafb0e258ebb4faf06b769e888340b103d331115bebc4eb813bf83291b63624a0d1475a756c734f9bbc2cd28546ecbe1e20a3794ca175f3fae90
fb6d2dd99bb07b55e5ccf68942bd0877b23c77b908e8db5f9db7f024d9239010f35bd4bbe2fcae387bfff9e2bc289f2fbe24cfaa301468dd8bd846dbb4ddf1c2
ae7b4c191ba8292337a469bc25ec3d411f06f53a73e224c5292c8de0516732307070a1c0660d125c7d44553488700a4d7bddd3444299910e254ab984c3a219ae
a4adf1d0f82b7bd46cea4388ad1c12ab5d1ed8e1153d9c9f350a3246aad01c6873462b9ac05999ad5cc988826eafc3acae853a33b7ba11cd1445875ba1b236b1
399483c90bd560b0b0263435085a21b0f22a9cf9356b38ec6046026d77eba3dc2dc60b17e92219e180643ed27acffba86e9c94c7ca9c225a0f1b0cfae0788ad5
4adc5a9aec1b703b8b93caec1a0bd8e5de7b132fe5113cf312503b998e2c2927274bd051db6b35979b1ef271daf6c6704e86c73805af4bdd476216c26593af84
0dfb5393d964f9cc9bad5c313709ea70f561ed3ea7b053075221d51696910d0d339585004b34272bff7213cc7a510a5454a3b349b1b206c1f0af490176745d4b
c663e2abb2b34b23da76f6352ba57ca2881844c1111ab189d8c7e07e1daaa04f40255c77988aa05fe06e4e5bdb4cb9c5394bbaf28d98c1d971ccd20867e556a7
689ec9166e0a522183792b8907ba55ca6e943bbf2a26e52f48957218ffcf54d1fb09dc3eac04da033e5c0d0b8c74a6b43d2e54c4a10aa511f5fb021a07533b20
5ae07e17a621a8e082dafc17e450ffb739676998b48643a4daa7211214f623150942f6a02c99e83b85583ddbbb2c4996113211551257a656ec1139246ca86be0
aadedb3d1441a89b6a929501833b197fee7b9641a3503739e57c732a59b1f7da1cf8a73b1f9bcca0945b874d4393dbbf10b1680f66bbaa5d6f96e77b6f59113d
316bb31a795600b3d256d0cad2fe354538e7566b2bd69cc6cbcd5c38f0e2bcc63058344429dc2121fd07f63f2a7c66bf76e80d75c8f7a1b622f878a18941d840
545fb28d07d205d20e8ea071b283369834296bdaac75d256cb37eb0bee740bbe278cad253b8bbfcf69eca23973d939b97891c6ce2cecd8da8e2d343578f6648a
c2d0383fc818c798cf64e52f597c740f1cbd05df0c264c49134cf09d4a60e8a107260f20f92d47b374e32f000000ffff0300504b030414000600080000002100
0dd1909fb60000001b010000270000007468656d652f7468656d652f5f72656c732f7468656d654d616e616765722e786d6c2e72656c73848f4d0ac2301484f7
8277086f6fd3ba109126dd88d0add40384e4350d363f2451eced0dae2c082e8761be9969bb979dc9136332de3168aa1a083ae995719ac16db8ec8e4052164e89
d93b64b060828e6f37ed1567914b284d262452282e3198720e274a939cd08a54f980ae38a38f56e422a3a641c8bbd048f7757da0f19b017cc524bd62107bd500
1996509affb3fd381a89672f1f165dfe514173d9850528a2c6cce0239baa4c04ca5bbabac4df000000ffff0300504b01022d0014000600080000002100e9de0f
bfff0000001c0200001300000000000000000000000000000000005b436f6e74656e745f54797065735d2e786d6c504b01022d0014000600080000002100a5d6
a7e7c0000000360100000b00000000000000000000000000300100005f72656c732f2e72656c73504b01022d00140006000800000021006b799616830000008a
0000001c00000000000000000000000000190200007468656d652f7468656d652f7468656d654d616e616765722e786d6c504b01022d00140006000800000021
0030dd4329a8060000a41b00001600000000000000000000000000d60200007468656d652f7468656d652f7468656d65312e786d6c504b01022d001400060008
00000021000dd1909fb60000001b0100002700000000000000000000000000b20900007468656d652f7468656d652f5f72656c732f7468656d654d616e616765722e786d6c2e72656c73504b050600000000050005005d010000ad0a00000000}
{\*\colorschememapping 3c3f786d6c2076657273696f6e3d22312e302220656e636f64696e673d225554462d3822207374616e64616c6f6e653d22796573223f3e0d0a3c613a636c724d
617020786d6c6e733a613d22687474703a2f2f736368656d61732e6f70656e786d6c666f726d6174732e6f72672f64726177696e676d6c2f323030362f6d6169
6e22206267313d226c743122207478313d22646b3122206267323d226c743222207478323d22646b322220616363656e74313d22616363656e74312220616363
656e74323d22616363656e74322220616363656e74333d22616363656e74332220616363656e74343d22616363656e74342220616363656e74353d22616363656e74352220616363656e74363d22616363656e74362220686c696e6b3d22686c696e6b2220666f6c486c696e6b3d22666f6c486c696e6b222f3e}
{\*\latentstyles\lsdstimax267\lsdlockeddef0\lsdsemihiddendef1\lsdunhideuseddef1\lsdqformatdef0\lsdprioritydef99{\lsdlockedexcept \lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority0 \lsdlocked0 Normal;
\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority9 \lsdlocked0 heading 1;\lsdqformat1 \lsdpriority9 \lsdlocked0 heading 2;\lsdqformat1 \lsdpriority9 \lsdlocked0 heading 3;\lsdqformat1 \lsdpriority9 \lsdlocked0 heading 4;
\lsdqformat1 \lsdpriority9 \lsdlocked0 heading 5;\lsdqformat1 \lsdpriority9 \lsdlocked0 heading 6;\lsdqformat1 \lsdpriority9 \lsdlocked0 heading 7;\lsdqformat1 \lsdpriority9 \lsdlocked0 heading 8;\lsdqformat1 \lsdpriority9 \lsdlocked0 heading 9;
\lsdpriority39 \lsdlocked0 toc 1;\lsdpriority39 \lsdlocked0 toc 2;\lsdpriority39 \lsdlocked0 toc 3;\lsdpriority39 \lsdlocked0 toc 4;\lsdpriority39 \lsdlocked0 toc 5;\lsdpriority39 \lsdlocked0 toc 6;\lsdpriority39 \lsdlocked0 toc 7;
\lsdpriority39 \lsdlocked0 toc 8;\lsdpriority39 \lsdlocked0 toc 9;\lsdqformat1 \lsdpriority35 \lsdlocked0 caption;\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority10 \lsdlocked0 Title;\lsdunhideused0 \lsdlocked0 Default Paragraph Font;
\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority11 \lsdlocked0 Subtitle;\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority22 \lsdlocked0 Strong;\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority20 \lsdlocked0 Emphasis;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority59 \lsdlocked0 Table Grid;\lsdunhideused0 \lsdlocked0 Placeholder Text;\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority1 \lsdlocked0 No Spacing;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority60 \lsdlocked0 Light Shading;\lsdsemihidden0 \lsdunhideused0 \lsdpriority61 \lsdlocked0 Light List;\lsdsemihidden0 \lsdunhideused0 \lsdpriority62 \lsdlocked0 Light Grid;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority63 \lsdlocked0 Medium Shading 1;\lsdsemihidden0 \lsdunhideused0 \lsdpriority64 \lsdlocked0 Medium Shading 2;\lsdsemihidden0 \lsdunhideused0 \lsdpriority65 \lsdlocked0 Medium List 1;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority66 \lsdlocked0 Medium List 2;\lsdsemihidden0 \lsdunhideused0 \lsdpriority67 \lsdlocked0 Medium Grid 1;\lsdsemihidden0 \lsdunhideused0 \lsdpriority68 \lsdlocked0 Medium Grid 2;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority69 \lsdlocked0 Medium Grid 3;\lsdsemihidden0 \lsdunhideused0 \lsdpriority70 \lsdlocked0 Dark List;\lsdsemihidden0 \lsdunhideused0 \lsdpriority71 \lsdlocked0 Colorful Shading;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority72 \lsdlocked0 Colorful List;\lsdsemihidden0 \lsdunhideused0 \lsdpriority73 \lsdlocked0 Colorful Grid;\lsdsemihidden0 \lsdunhideused0 \lsdpriority60 \lsdlocked0 Light Shading Accent 1;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority61 \lsdlocked0 Light List Accent 1;\lsdsemihidden0 \lsdunhideused0 \lsdpriority62 \lsdlocked0 Light Grid Accent 1;\lsdsemihidden0 \lsdunhideused0 \lsdpriority63 \lsdlocked0 Medium Shading 1 Accent 1;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority64 \lsdlocked0 Medium Shading 2 Accent 1;\lsdsemihidden0 \lsdunhideused0 \lsdpriority65 \lsdlocked0 Medium List 1 Accent 1;\lsdunhideused0 \lsdlocked0 Revision;
\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority34 \lsdlocked0 List Paragraph;\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority29 \lsdlocked0 Quote;\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority30 \lsdlocked0 Intense Quote;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority66 \lsdlocked0 Medium List 2 Accent 1;\lsdsemihidden0 \lsdunhideused0 \lsdpriority67 \lsdlocked0 Medium Grid 1 Accent 1;\lsdsemihidden0 \lsdunhideused0 \lsdpriority68 \lsdlocked0 Medium Grid 2 Accent 1;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority69 \lsdlocked0 Medium Grid 3 Accent 1;\lsdsemihidden0 \lsdunhideused0 \lsdpriority70 \lsdlocked0 Dark List Accent 1;\lsdsemihidden0 \lsdunhideused0 \lsdpriority71 \lsdlocked0 Colorful Shading Accent 1;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority72 \lsdlocked0 Colorful List Accent 1;\lsdsemihidden0 \lsdunhideused0 \lsdpriority73 \lsdlocked0 Colorful Grid Accent 1;\lsdsemihidden0 \lsdunhideused0 \lsdpriority60 \lsdlocked0 Light Shading Accent 2;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority61 \lsdlocked0 Light List Accent 2;\lsdsemihidden0 \lsdunhideused0 \lsdpriority62 \lsdlocked0 Light Grid Accent 2;\lsdsemihidden0 \lsdunhideused0 \lsdpriority63 \lsdlocked0 Medium Shading 1 Accent 2;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority64 \lsdlocked0 Medium Shading 2 Accent 2;\lsdsemihidden0 \lsdunhideused0 \lsdpriority65 \lsdlocked0 Medium List 1 Accent 2;\lsdsemihidden0 \lsdunhideused0 \lsdpriority66 \lsdlocked0 Medium List 2 Accent 2;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority67 \lsdlocked0 Medium Grid 1 Accent 2;\lsdsemihidden0 \lsdunhideused0 \lsdpriority68 \lsdlocked0 Medium Grid 2 Accent 2;\lsdsemihidden0 \lsdunhideused0 \lsdpriority69 \lsdlocked0 Medium Grid 3 Accent 2;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority70 \lsdlocked0 Dark List Accent 2;\lsdsemihidden0 \lsdunhideused0 \lsdpriority71 \lsdlocked0 Colorful Shading Accent 2;\lsdsemihidden0 \lsdunhideused0 \lsdpriority72 \lsdlocked0 Colorful List Accent 2;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority73 \lsdlocked0 Colorful Grid Accent 2;\lsdsemihidden0 \lsdunhideused0 \lsdpriority60 \lsdlocked0 Light Shading Accent 3;\lsdsemihidden0 \lsdunhideused0 \lsdpriority61 \lsdlocked0 Light List Accent 3;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority62 \lsdlocked0 Light Grid Accent 3;\lsdsemihidden0 \lsdunhideused0 \lsdpriority63 \lsdlocked0 Medium Shading 1 Accent 3;\lsdsemihidden0 \lsdunhideused0 \lsdpriority64 \lsdlocked0 Medium Shading 2 Accent 3;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority65 \lsdlocked0 Medium List 1 Accent 3;\lsdsemihidden0 \lsdunhideused0 \lsdpriority66 \lsdlocked0 Medium List 2 Accent 3;\lsdsemihidden0 \lsdunhideused0 \lsdpriority67 \lsdlocked0 Medium Grid 1 Accent 3;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority68 \lsdlocked0 Medium Grid 2 Accent 3;\lsdsemihidden0 \lsdunhideused0 \lsdpriority69 \lsdlocked0 Medium Grid 3 Accent 3;\lsdsemihidden0 \lsdunhideused0 \lsdpriority70 \lsdlocked0 Dark List Accent 3;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority71 \lsdlocked0 Colorful Shading Accent 3;\lsdsemihidden0 \lsdunhideused0 \lsdpriority72 \lsdlocked0 Colorful List Accent 3;\lsdsemihidden0 \lsdunhideused0 \lsdpriority73 \lsdlocked0 Colorful Grid Accent 3;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority60 \lsdlocked0 Light Shading Accent 4;\lsdsemihidden0 \lsdunhideused0 \lsdpriority61 \lsdlocked0 Light List Accent 4;\lsdsemihidden0 \lsdunhideused0 \lsdpriority62 \lsdlocked0 Light Grid Accent 4;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority63 \lsdlocked0 Medium Shading 1 Accent 4;\lsdsemihidden0 \lsdunhideused0 \lsdpriority64 \lsdlocked0 Medium Shading 2 Accent 4;\lsdsemihidden0 \lsdunhideused0 \lsdpriority65 \lsdlocked0 Medium List 1 Accent 4;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority66 \lsdlocked0 Medium List 2 Accent 4;\lsdsemihidden0 \lsdunhideused0 \lsdpriority67 \lsdlocked0 Medium Grid 1 Accent 4;\lsdsemihidden0 \lsdunhideused0 \lsdpriority68 \lsdlocked0 Medium Grid 2 Accent 4;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority69 \lsdlocked0 Medium Grid 3 Accent 4;\lsdsemihidden0 \lsdunhideused0 \lsdpriority70 \lsdlocked0 Dark List Accent 4;\lsdsemihidden0 \lsdunhideused0 \lsdpriority71 \lsdlocked0 Colorful Shading Accent 4;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority72 \lsdlocked0 Colorful List Accent 4;\lsdsemihidden0 \lsdunhideused0 \lsdpriority73 \lsdlocked0 Colorful Grid Accent 4;\lsdsemihidden0 \lsdunhideused0 \lsdpriority60 \lsdlocked0 Light Shading Accent 5;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority61 \lsdlocked0 Light List Accent 5;\lsdsemihidden0 \lsdunhideused0 \lsdpriority62 \lsdlocked0 Light Grid Accent 5;\lsdsemihidden0 \lsdunhideused0 \lsdpriority63 \lsdlocked0 Medium Shading 1 Accent 5;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority64 \lsdlocked0 Medium Shading 2 Accent 5;\lsdsemihidden0 \lsdunhideused0 \lsdpriority65 \lsdlocked0 Medium List 1 Accent 5;\lsdsemihidden0 \lsdunhideused0 \lsdpriority66 \lsdlocked0 Medium List 2 Accent 5;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority67 \lsdlocked0 Medium Grid 1 Accent 5;\lsdsemihidden0 \lsdunhideused0 \lsdpriority68 \lsdlocked0 Medium Grid 2 Accent 5;\lsdsemihidden0 \lsdunhideused0 \lsdpriority69 \lsdlocked0 Medium Grid 3 Accent 5;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority70 \lsdlocked0 Dark List Accent 5;\lsdsemihidden0 \lsdunhideused0 \lsdpriority71 \lsdlocked0 Colorful Shading Accent 5;\lsdsemihidden0 \lsdunhideused0 \lsdpriority72 \lsdlocked0 Colorful List Accent 5;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority73 \lsdlocked0 Colorful Grid Accent 5;\lsdsemihidden0 \lsdunhideused0 \lsdpriority60 \lsdlocked0 Light Shading Accent 6;\lsdsemihidden0 \lsdunhideused0 \lsdpriority61 \lsdlocked0 Light List Accent 6;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority62 \lsdlocked0 Light Grid Accent 6;\lsdsemihidden0 \lsdunhideused0 \lsdpriority63 \lsdlocked0 Medium Shading 1 Accent 6;\lsdsemihidden0 \lsdunhideused0 \lsdpriority64 \lsdlocked0 Medium Shading 2 Accent 6;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority65 \lsdlocked0 Medium List 1 Accent 6;\lsdsemihidden0 \lsdunhideused0 \lsdpriority66 \lsdlocked0 Medium List 2 Accent 6;\lsdsemihidden0 \lsdunhideused0 \lsdpriority67 \lsdlocked0 Medium Grid 1 Accent 6;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority68 \lsdlocked0 Medium Grid 2 Accent 6;\lsdsemihidden0 \lsdunhideused0 \lsdpriority69 \lsdlocked0 Medium Grid 3 Accent 6;\lsdsemihidden0 \lsdunhideused0 \lsdpriority70 \lsdlocked0 Dark List Accent 6;
\lsdsemihidden0 \lsdunhideused0 \lsdpriority71 \lsdlocked0 Colorful Shading Accent 6;\lsdsemihidden0 \lsdunhideused0 \lsdpriority72 \lsdlocked0 Colorful List Accent 6;\lsdsemihidden0 \lsdunhideused0 \lsdpriority73 \lsdlocked0 Colorful Grid Accent 6;
\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority19 \lsdlocked0 Subtle Emphasis;\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority21 \lsdlocked0 Intense Emphasis;
\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority31 \lsdlocked0 Subtle Reference;\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority32 \lsdlocked0 Intense Reference;
\lsdsemihidden0 \lsdunhideused0 \lsdqformat1 \lsdpriority33 \lsdlocked0 Book Title;\lsdpriority37 \lsdlocked0 Bibliography;\lsdqformat1 \lsdpriority39 \lsdlocked0 TOC Heading;}}{\*\datastore 010500000200000018000000
4d73786d6c322e534158584d4c5265616465722e362e3000000000000000000000060000
d0cf11e0a1b11ae1000000000000000000000000000000003e000300feff090006000000000000000000000001000000010000000000000000100000feffffff00000000feffffff0000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
fffffffffffffffffdfffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffff52006f006f007400200045006e00740072007900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016000500ffffffffffffffffffffffff0c6ad98892f1d411a65f0040963251e5000000000000000000000000e078
09a98f92cb01feffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000105000000000000}}