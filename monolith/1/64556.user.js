// ==UserScript==
// @name			PennerGame Profile
// @description		Zeigt schlaues Zeug im Profil an (Pennergame Profile Script fuer pennergame 4.0)
// @namespace		http://userscripts.org/scripts/show/64556
// @version			3.5.9
// @include			http://*.pennergame.de/*
// @include			http://*.pennerzone.de/*
// @exclude			http://board.pennergame.de/*
// @exclude			http://*.pennergame.de/logout/*
// @exclude			http://*.pennergame.de/login/*
// @exclude			http://*.pennergame.de/do_register/*
// @exclude			http://*.pennergame.de/activate_account/*
// @exclude			http://*.pennergame.de/
// @exclude			http://dontknow.me/*
// ==/UserScript==
function f(a,b){GM_setValue("pgp_"+a+pgp_location,b)}function h(a,b){return GM_getValue("pgp_"+a+pgp_location,b)}function j(a,b){document.URL.href==k(a)?b(document.documentElement.innerHTML):GM_xmlhttpRequest({method:"GET",url:k(a),headers:{"Cache-Control":"no-cache"},onload:function(c){b(c)}})}function n(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")}
function o(a,b,c){a.innerHTML="<td>"+b+"</td><td>"+c+'</td><td style="cursor:pointer;" id="pgp_hideTR_'+pgp_IDcount+'">X</td>';document.getElementById("pgp_hideTR_"+pgp_IDcount).addEventListener("click",p,false);pgp_IDcount++}function r(a,b,c,d){if(arguments.length<4)d=false;var e=a.indexOf(b)+b.length;if(arguments.length<3)var i=a.length-1;else{i=a.indexOf(c,e);if(d)i+=c.length}if(d)e-=b.length;return a.substring(e,i)}
function t(a){var b=document.getElementById("pgp_SpanLay");if(b.className=="pgp_dragclass"){pgp_movedragok=true;pgp_moved=b;pgp_movedx=parseInt(b.style.left+0);pgp_movedy=parseInt(b.style.top+0);pgp_movex=a.clientX;pgp_movey=a.clientY;document.addEventListener("mousemove",u,false);return false}}function v(){pgp_movedragok=false;document.removeEventListener("mousemove",u,false);f("layTop",parseInt(pgp_moved.style.top));f("layLeft",parseInt(pgp_moved.style.left))}
function u(a){if(!a)a=window.event;if(pgp_movedragok){pgp_moved.style.top=pgp_movedy+a.clientY-pgp_movey+"px";pgp_moved.style.left=pgp_movedx+a.clientX-pgp_movex+"px";return false}}function x(){if(h("SPANcollapse",true)){f("SPANcollapse",false);var a="collapse"}else{f("SPANcollapse",true);a="visible"}for(var b=0;b<pgp_aTRs.length;b++)if(h(pgp_aTRs[b],true))document.getElementById("pgp_"+pgp_aTRs[b]).style.visibility=a}function y(){for(var a=0;a<pgp_aTRs.length;a++)f(pgp_aTRs[a],true);z()}
function A(a){if(h(a,true)&&h("SPANcollapse",true))document.getElementById("pgp_"+a).style.visibility="visible"}function p(a){var b;if(!a)a=window.event;if(a.target)b=a.target;else if(a.srcElement)b=a.srcElement;b=b.parentNode;b.style.visibility="collapse";a=b.id.replace("pgp_","");f(a,false)}function k(a){return"http://"+(pgp_urlShort+".pennergame.de/"+a+"/").replace("//","/")}
function B(){parseInt(h("UpdateTime",-1))<(new Date).getTime()-864E5&&GM_xmlhttpRequest({method:"GET",url:"http://userscripts.org/scripts/source/"+pgp_userscripts+".meta.js?"+(new Date).getTime(),headers:{"Cache-Control":"no-cache"},onload:function(a){var b=parseInt(h("Version",-1));a=parseInt(/@uso:version\s*(.*?)\s*$/m.exec(a.responseText)[1]);f("UpdateTime",(new Date).getTime().toString());if(b<0)f("Version",a);else if(b<a){f("Version",a);top.location.href="http://userscripts.org/scripts/source/"+
pgp_userscripts+".user.js"}f("UpdateTime",(new Date).getTime().toString())}})}
function C(a){var b=r(a.responseText,"/profil/bande:","/");for(var c=0,d=0,e=0;e<b.length;e++)c+=parseInt(b.charAt(e));for(e=0;e<b.length;e++)d+=b.charCodeAt(e);c*=d;b=c==5833&&pgp_location=="_H"?true:c==2980&&pgp_location=="_B"?true:false;if(!b&&pgp_DEV.length!=11)return false;if(a.responseText.indexOf("Wirtschaftswunder ist aktiv!")!=-1){a=document.getElementById("pgp_THinfo");a.style.backgroundColor="#000055";a.innerHTML="WiWu aktiv!"}document.getElementById("pgp_SpanLay").style.display=""}
function D(a){var b=a.finalUrl.match(/\d+\/$/).toString().match(/\d+/);b=parseInt(b);if(pgp_page_urlType=="gang"){var c=r(a.responseText,"<td><strong>Shoutbox:</strong></td>");c=r(c,"<td>",'<a href="/gang/1/"><strong>1</strong></a>');c=c.substring(0,c.lastIndexOf("</p>")+4)}else if(pgp_page_urlType=="gang_forum"){c=r(a.responseText,'<td align="left" height="15" valign="top" width="500"><span class="tiername">Bandenforum '+String.fromCharCode(220)+"bersicht</span></td>");c=r(c,"<hr");c=r(c,"<td>",
'<a href="/gang/forum/1/"><strong>1</strong></a>');c=c.substring(0,c.lastIndexOf("</td>"))}else if(pgp_page_urlType=="gang_forum_viewthread"){c=a.responseText.substring(a.responseText.search(/<br *\/*>Views: \d+ \| Antworten: \d+/));c=r(c,"<hr");c=r(c,"<td>",'<a href="/'+pgp_page_urlBase+'/1/"><strong>1</strong></a>');c=c.substring(0,c.lastIndexOf("</td>"))}a=pgp_TRclone.cloneNode(true);if(b==parseInt(pgp_iPage)+1)a.getElementsByTagName("td")[0].innerHTML="<br"+c;else a.getElementsByTagName("td")[0].innerHTML=
c;c=document.getElementById("pgp_SpanPageinator_"+pgp_page_urlType);c.parentNode.removeChild(c);c.style.visibility="visible";b<pgp_iPageMax&&a.getElementsByTagName("td")[0].appendChild(c);c=document.getElementsByName("pgp_aPageinator_"+b);for(var d=0;d<c.length;d++){c[d].style.textDecoration="none";c[d].style.color="yellow"}if(!document.getElementById("pgp_SelPageinator_"+b)){a.id="pgp_SelPageinator_"+b;pgp_TRcloneParent.appendChild(a);a=parseInt(b)+1;document.getElementById("pgp_SelPageinator_"+
a)||b<pgp_iPageEnd&&j(pgp_page_urlBase+"/"+a,D)}}
function E(){var a=document.URL,b=a.match(/\d+/g);pgp_iPageEnd=pgp_iPage=null;pgp_iPageMax=0;pgp_TRclone=pgp_iShowPages=pgp_page_urlType=pgp_page_urlBase=null;if(a.indexOf(k("gang/forum/viewthread"))==0){pgp_page_urlType="gang_forum_viewthread";if(b&&b.length>0){pgp_page_urlBase="gang/forum/viewthread/"+b[0];pgp_iPage=b.length>1?b[1]:1}}else if(a.indexOf(k("gang/forum"))==0){pgp_page_urlType="gang_forum";pgp_page_urlBase="gang/forum";pgp_iPage=b&&b.length>0?b[0]:1}else if((new RegExp("^"+k("gang")+
"(\\d+/)?$")).test(a)){pgp_page_urlBase=pgp_page_urlType="gang";pgp_iPage=b&&b.length>0?b[0]:1}if(pgp_iPage&&pgp_page_urlBase&&pgp_page_urlType){a=document.getElementsByTagName("a");b=new RegExp("^"+k(pgp_page_urlBase)+"\\d+/$");var c=k(pgp_page_urlBase+"/"+pgp_iPage),d;for(var e in a)if(b.test(a[e].href)){pgp_iPageMax++;a[e].name="pgp_aPageinator_"+pgp_iPageMax;if(a[e].href==c)d=e}else if(d)break;a[d].style.textDecoration="none";a[d].style.color="red";pgp_iShowPages=h("SelPageinator_"+pgp_page_urlType,
"1");pgp_iPageEnd=parseInt(pgp_iPage)+parseInt(pgp_iShowPages)-1;pgp_iPageEnd=pgp_iPageEnd>pgp_iPageMax?pgp_iPageMax:pgp_iPageEnd;c="1,2,3,4,5,10".split(",");b="Zeige&nbsp;";b+='<select name="pgp_SelPageinator_'+pgp_page_urlType+'">';for(e=0;e<c.length;e++){b+="<option";if(c[e]==pgp_iShowPages)b+=" selected";if(c[e]>5)b+=' style="background-color:red;"';else if(c[e]>3)b+=' style="background-color:yellow;"';b+=">"+c[e]+"</option>"}b+="</select>";b+="&nbsp;Seiten.&nbsp;";c=document.createElement("form");
c.innerHTML+=b;c.style.display="inline";a[d].parentNode.insertBefore(c,a[d].parentNode.firstChild);if(pgp_page_urlType=="gang"){b=a[d].parentNode.parentNode;d=b.removeChild(a[d].parentNode);b.insertBefore(d,b.firstChild)}else{b=a[d].parentNode.parentNode.parentNode;d=b.removeChild(a[d].parentNode.parentNode);b.insertBefore(d,b.firstChild.nextSibling)}if(pgp_page_urlType=="gang"){pgp_TRclone=document.getElementsByName("pgp_SelPageinator_"+pgp_page_urlType)[0].parentNode.parentNode.parentNode.parentNode.cloneNode(true);
pgp_TRcloneParent=document.getElementsByName("pgp_SelPageinator_"+pgp_page_urlType)[0].parentNode.parentNode.parentNode.parentNode.parentNode}else{pgp_TRclone=document.getElementsByName("pgp_SelPageinator_"+pgp_page_urlType)[0].parentNode.parentNode.parentNode.cloneNode(true);pgp_TRcloneParent=document.getElementsByName("pgp_SelPageinator_"+pgp_page_urlType)[0].parentNode.parentNode.parentNode.parentNode}pgp_TRclone.getElementsByTagName("td")[0].innerHTML="";a=function(i){var g=pgp_iPageEnd;f("SelPageinator_"+
pgp_page_urlType,i.target.value<=3?i.target.value:3);pgp_iShowPages=i.target.value;pgp_iPageEnd=parseInt(pgp_iPage)+parseInt(pgp_iShowPages)-1;pgp_iPageEnd=pgp_iPageEnd>pgp_iPageMax?pgp_iPageMax:pgp_iPageEnd;if(g<pgp_iPageEnd){g=parseInt(g)+1;j(pgp_page_urlBase+"/"+g,D)}g=document.getElementsByName("pgp_SelPageinator_"+pgp_page_urlType);for(var q in g)g[q].selectedIndex=i.target.selectedIndex};d=document.getElementsByName("pgp_SelPageinator_"+pgp_page_urlType);for(e in d)d[e].addEventListener("change",
a,false);if(pgp_iPage<pgp_iPageMax){e=document.createElement("span");e.style.cursor="pointer";e.style.textDecoration="underline";e.style.fontWeight="bold";e.id="pgp_SpanPageinator_"+pgp_page_urlType;e.innerHTML="&gt;Weiter";d=document.getElementsByName("pgp_SelPageinator_"+pgp_page_urlType);d[d.length-1].parentNode.appendChild(e);document.getElementById("pgp_SpanPageinator_"+pgp_page_urlType).addEventListener("click",function(i){i.target.style.visibility="collapse";if(pgp_iPageEnd<pgp_iPageMax){pgp_iPageEnd=
parseInt(pgp_iPageEnd)+1;j(pgp_page_urlBase+"/"+pgp_iPageEnd,D)}},false)}if(pgp_iPage<pgp_iPageEnd){e=parseInt(pgp_iPage)+1;j(pgp_page_urlBase+"/"+e,D)}}}
function F(a){var b=G(a.responseText);if(h("TRoverviewSauber",true)){o(document.getElementById("pgp_TRoverviewSauber"),"Sauberkeit:",b+"%");A("TRoverviewSauber")}h("TRoverviewClean",true)&&H(b);if(h("TRoverviewSpenden",true)){b=r(a.responseText,"Du hast heute");var c=parseInt(r(b," "," Spenden"));b=parseInt(r(b,"noch "," Spenden"))+c;o(document.getElementById("pgp_TRoverviewSpenden"),"Spenden:",c+"/"+b);A("TRoverviewSpenden")}if(h("TRoverviewWaffe",true)){b=r(a.responseText,"<h4>Deine Waffe</h4>");
c=r(b,"<li>","</li>");b=r(b,"<span");b=r(b,">","</span>");o(document.getElementById("pgp_TRoverviewWaffe"),c+":","ATT"+b);A("TRoverviewWaffe")}if(h("TRoverviewEH",true)){b=r(a.responseText,"<h4>Dein Eigenheim</h4>");c=r(b,"<li>","</li>");b=r(b,"<span");b=r(b,">","</span>");o(document.getElementById("pgp_TRoverviewEH"),c+":","DEF"+b);A("TRoverviewEH")}if(h("TRoverviewAttDef",true)){var d=parseInt(h("maxATT",0)),e=parseInt(h("maxDEF",0));c=parseInt(h("maxATTDEFTotal",0));b=r(a.responseText,"ATT:");
b=r(b,">");b=r(b,">");var i=parseInt(r(b,">","<"));b=r(b,"DEF:");b=r(b,">");b=r(b,">");b=parseInt(r(b,">","<"));var g=i+b;!isNaN(i)&&i>d&&f("maxATT",i);!isNaN(b)&&b>e&&f("maxDEF",b);if(!isNaN(g)&&g>c){f("maxATTDEFTotal",g);c=g}d=c>0?(g/c*100).toFixed(0):"-";o(document.getElementById("pgp_TRoverviewAttDef"),'<img height="10" src="http://media.pennergame.de/img/att.png">+<img height="10" src="http://media.pennergame.de/img/def.png"/>:',i+"&nbsp;+&nbsp;"+b+"&nbsp;("+g+")&nbsp;=&nbsp;"+d+"%&nbsp;Max.");
A("TRoverviewAttDef");b=(256*(g/c)-1).toFixed(0).toString();b="rgb(255,"+b+","+b+")";document.getElementById("pgp_TRoverviewAttDef").getElementsByTagName("td")[1].style.backgroundColor=b}if(h("TRoverviewTier",true)){b=r(a.responseText,"<h4>Freunde zum Pennergame einladen</h4>");a=r(b,"<h4>","</h4>");b=r(b,"<img");c='<img src="'+r(b,'src="','"')+'" width="45" />';b=r(b,"<ul");b="<ul>"+r(b,">","</ul>")+"</ul>";o(document.getElementById("pgp_TRoverviewTier"),c,'<span style="text-decoration:underline;">'+
a+"</span>"+b);A("TRoverviewTier")}}
function H(a){if(a<100){o(document.getElementById("pgp_TRoverviewClean"),"Dreck:",'<span id="pgp_Aclean" style="cursor:pointer">Abwaschen</span>');document.getElementById("pgp_Aclean").addEventListener("click",function(b){b.target.style.visibility="collapse";pgp_cash||(pgp_cash=I());b=Math.ceil((100-a)/20);var c=b*6,d=1;if(b*6>25){c=25;d=2}if(c>pgp_cash){b="Du hast nicht genug Geld!\n\n"+c+" Euro w"+String.fromCharCode(228)+"ren notwendig zum S"+String.fromCharCode(228)+"ubern.\n"+pgp_cash+" Euro sind verf"+
String.fromCharCode(252)+"gbar.\n\nWillst Du Flaschen verkaufen?";if(confirm(b))top.location.href=k("stock/bottle");else document.getElementById("pgp_Aclean").style.visibility="visible"}else{b="id="+d+"&submitForm=";GM_xmlhttpRequest({method:"post",url:k("city/washhouse/buy"),headers:{"Content-type":"application/x-www-form-urlencoded"},data:encodeURI(b),onload:J})}},false);A("TRoverviewClean")}}
function K(a){var b=G(a.responseText);a=I(a.responseText);var c=Math.ceil((100-b)/20)*6;if(b<100&&a>c)GM_xmlhttpRequest({method:"post",url:k("city/washhouse/buy"),headers:{"Content-type":"application/x-www-form-urlencoded"},data:encodeURI("id=1&submitForm="),onload:J});else top.location.href=document.URL}function J(){GM_xmlhttpRequest({method:"GET",url:k("overview"),headers:{"Cache-Control":"no-cache"},onload:K})}function L(a){return a.indexOf("Du hast keinen Plunder angelegt.")==-1?false:true}
function M(a){if(L(a.responseText))return false;var b=r(a.responseText,"<h3>Angelegt</h3>"),c=r(b,"<h4>","</h4>");c=c.split("> ");var d=c[0]+">";c=n(c[1]);b=r(b,"</h4>");b="<ul>"+r(b,">","</ul>")+"</ul>";if(h("TRplunder",true)){o(document.getElementById("pgp_TRplunder"),d,'<span style="text-decoration:underline;">'+c+"</span>"+b);A("TRplunder")}d=h("listPlunder","");d=d.length?d.split("|"):[];d.unshift(c);for(b=1;b<d.length;b++)if(d[b]==c){d.splice(b,1);break}d=d.slice(0,12);f("listPlunder",d.join("|"));
if(h("TRplunderChange",true)&&d.length>1){var e=a.responseText.match(new RegExp("<a href=\"javascript:change_stuff\\('\\d+'\\)\">[^<]+</a>","g"));a={};for(b=0;b<e.length;b++){var i=(new RegExp("<a href=\"javascript:change_stuff\\('(\\d+)'\\)\">([^<]+)</a>","g")).exec(e[b]);a[i[2]]=i[1]}a[c]||(a[c]=-1);c='<form id="pgp_FormChangePlunder" method="get">';c+='<select id="pgp_SelChangePlunder">';for(b=0;b<d.length;b++)if(a[d[b]])c+='<option value="'+a[d[b]]+'">'+d[b]+"</option>";c+="</select>";c+="</form>";
o(document.getElementById("pgp_TRplunderChange"),"Wechseln:",c);document.getElementById("pgp_SelChangePlunder").addEventListener("change",function(g){if(g.target.selectedIndex!=0){g.target.style.visibility="collapse";GM_xmlhttpRequest({method:"post",url:k("stock/plunder/change"),headers:{"Content-type":"application/x-www-form-urlencoded"},data:encodeURI("f_plunder="+g.target.value),onload:function(){top.location.href=document.URL}})}},false);A("TRplunderChange")}}
function N(a){if(h("TRoverviewSammeln",true)){a=r(a.responseText,"Pfandflaschen sammeln:");a=r(a,"<form","</form>");if(a.indexOf('name="cancel"')==-1){a=r(a,"<select");a=r(a,"<option","</option>",true);a='<form id="pgp_FormSammeln" method="get"><select id="pgp_SelSammeln">'+a+"</select>";a+='<span style="cursor:pointer;" id="pgp_GoSammeln">GO</span></form>';o(document.getElementById("pgp_TRoverviewSammeln"),"Sammeln:",a);document.getElementById("pgp_GoSammeln").addEventListener("click",O,false);A("TRoverviewSammeln")}}}
function O(){if(document.URL.indexOf(k("activities"))==-1){f("doSammeln",true);top.location.href=k("activities")}else{f("doSammeln",false);document.getElementsByName("Submit2")[0].click()}}function P(){var a=document.getElementsByName("f_toid")[0];if(Q())f("LastAttackTarget","");else{var b=a.value,c=h("LastAttackTarget","");if(c.length&&!b.length)a.value=c;a.form.addEventListener("submit",function(){f("LastAttackTarget",document.getElementsByName("f_toid")[0].value)},false)}}
function R(){plunderMounted=r(document.documentElement.innerHTML,"<h3>Angelegt</h3>");if(L(plunderMounted))return false;plunderMounted=r(plunderMounted,"<h4>","</h4>");plunderMounted=plunderMounted.split("> ");plunderMounted=n(plunderMounted[1]);function a(m){m=m.target.parentNode.id.replace("plunderAuse_","");if(confirm("Plunder wirklich benutzen?"))top.location.href=k("stock/plunder/use/"+m);return false}function b(m){m.target.style.visibility="hidden";m=m.target.id;m=m.replace("plunderSpan_","");
m=m.replace("_","");var s=m.match(/\d+/);m=m.replace(s,"");s=oPlunderData.b[s];for(var l=0;l<aPlunderStock.length;l++)if(aPlunderStock[l]==s){var w=l;break}switch(m){case "top":l=0;break;case "up":l=w-1;break;case "down":l=w+1;break;case "bottom":l=aPlunderStock.length-1;break;default:l=-1;break}if(aPlunderStock[l]==plunderMounted&&!oPlunderData.a[plunderMounted])if(m=="top"||m=="up")l--;else l++;l=l<0?0:l;l=l>aPlunderStock.length-1?aPlunderStock.length-1:l;aPlunderStock.splice(w,1);aPlunderStock.splice(l,
0,s);f("listPlunderStock",aPlunderStock.join("|"));S()}aPlunderStock=h("listPlunderStock","");aPlunderStock=aPlunderStock.length?aPlunderStock.split("|"):[];oPlunderData={};oDIVplunder=document.getElementById("plunder");oPlunderData.id=[];oPlunderData.name=[];oPlunderData.c=[];oPlunderData.d=[];oPlunderData.a={};oPlunderData.b={};var c=oDIVplunder.getElementsByTagName("tr"),d=c[0].getElementsByTagName("th"),e="&nbsp;\u2193";d[1].style.cursor="pointer";d[1].firstChild.innerHTML+=e;d[1].addEventListener("click",
function(){aPlunderStock=aPlunderStock.sort();f("listPlunderStock",aPlunderStock.join("|"));S()},false);for(d=1;d<c.length;d++){var i=c[d].getElementsByTagName("td");e=(new RegExp("<a href=\"javascript:change_stuff\\('(\\d+)'\\)\">([^<]+)</a>","g")).exec(i[1].innerHTML);var g=e[1].toString();e=e[2].toString();oPlunderData.id.push(g);oPlunderData.name.push(e);oPlunderData.a[e]=g;oPlunderData.b[g]=e;e=i[2].innerHTML.match(/\d+/);e=parseInt(e);oPlunderData.c.push(e);e=i[3].innerHTML.match(/\d+,\d+/);
e=e.toString();oPlunderData.d.push(e);e="<br />";e+='<span id="plunderSpan_'+g+'" style="font-weight:bold;">';e+='<span id="plunderSpan_top_'+g+'" style="cursor:pointer;">';e+="\u21d1";e+="</span>";e+="&nbsp;";e+='<span id="plunderSpan_up_'+g+'" style="cursor:pointer;visibility:hidden;">';e+="\u2191";e+="</span>";e+="&nbsp;";e+='<span id="plunderSpan_down_'+g+'" style="cursor:pointer;">';e+="\u2193";e+="</span>";e+="&nbsp;";e+='<span id="plunderSpan_bottom_'+g+'" style="cursor:pointer;">';e+="\u21d3";
e+="</span>";e+="</span>";i[2].innerHTML+=e;e=document.getElementById("plunderSpan_"+g).getElementsByTagName("span");for(var q=0;q<e.length;q++)e[q].addEventListener("click",b,false);e=i[4].innerHTML;if(e.indexOf("<a href=")!=-1){e=e.replace('<a href="/stock/plunder/use/'+g+'/">',"");e=n(e);e='<a id="plunderAuse_'+g+'">'+e;i[4].innerHTML=e;i[4].getElementsByTagName("a")[0].addEventListener("click",a,false)}c[d].id="plunder_"+g}lPlunderStock="|"+aPlunderStock.join("|")+"|";for(d=oPlunderData.name.length-
1;d>-1;d--)lPlunderStock.indexOf("|"+oPlunderData.name[d]+"|")==-1&&aPlunderStock.unshift(oPlunderData.name[d]);for(d=0;d<aPlunderStock.length;d++)if(!oPlunderData.a[aPlunderStock[d]]&&plunderMounted!=aPlunderStock[d]){aPlunderStock.splice(d,1);d--}if("|"+aPlunderStock.join("|")+"|"!=lPlunderStock){f("listPlunderStock",aPlunderStock.join("|"));lPlunderStock="|"+aPlunderStock.join("|")+"|"}S()}
function S(){for(var a=oDIVplunder.getElementsByTagName("tr"),b=[],c=a[1].parentNode,d=1;d<a.length;d=d){a[d].style.visibility="hidden";var e=a[d].id.replace("plunder_","");b[e]=c.removeChild(a[d])}for(d=0;d<aPlunderStock.length;d++)if(oPlunderData.a[aPlunderStock[d]]){e=oPlunderData.a[aPlunderStock[d]];a=b[e];a.className=d%2==0?"even ztip trhover":"odd ztip trhover";c.appendChild(a);document.getElementById("plunderSpan_top_"+e).style.visibility=d>0?"visible":"hidden";document.getElementById("plunderSpan_up_"+
e).style.visibility=d>0?"visible":"hidden";document.getElementById("plunderSpan_down_"+e).style.visibility=d<aPlunderStock.length-1?"visible":"hidden";document.getElementById("plunderSpan_bottom_"+e).style.visibility=d<aPlunderStock.length-1?"visible":"hidden";a.style.visibility="visible"}}
function T(){pgp_cash=I();pgp_perMill=U();if(h("TRoverviewSoberUp",true)&&pgp_perMill>0){o(document.getElementById("pgp_TRoverviewSoberUp"),"Essen:",'<span id="pgp_AsoberUp" style="cursor:pointer">Ausn'+String.fromCharCode(252)+"chtern</span>");document.getElementById("pgp_AsoberUp").addEventListener("click",function(b){b.target.style.visibility="collapse";j("stock/foodstuffs/food",function(c){var d=U(c.responseText),e=0;if(c.responseText.indexOf('<input type="hidden" name="item" value="Brot">')<
0)c=0;else{content=r(c.responseText,'<input type="hidden" name="item" value="Brot">',"</form>");c=content.match(/id="lager_Brot" value="(\d+)"/);c=parseInt(c[1]);var i="Brot",g=content.match(/name="promille" value="(-?\d+)"/)[1];g=parseInt(g);var q=content.match(/name="id" value="(\d+)"/)[1]}if(d<=pgp_perMill){e=c==0?0:Math.ceil(-d/g*100);if(c==0||e>c){d="Du hast nicht genug Essen!\nWillst Du Essen kaufen gehen?";if(c>0)d=e+" notwendig zum Ausn"+String.fromCharCode(252)+"chtern.\n"+c+" sind im Lager.\n\n"+
d;if(confirm(d))top.location.href=k("city/supermarket/food");else document.getElementById("pgp_AsoberUp").style.visibility="visible"}else{e="item="+i+"&promille="+g+"&id="+q+"&menge="+e;GM_xmlhttpRequest({method:"post",url:k("stock/foodstuffs/use"),headers:{"Content-type":"application/x-www-form-urlencoded"},data:encodeURI(e),onload:function(){top.location.href=document.URL}})}}})},false);A("TRoverviewSoberUp")}if(h("TReinzahlenBK",true)&&parseInt(pgp_cash)>0){o(document.getElementById("pgp_TReinzahlenBK"),
"B-Kasse:",'<span id="pgp_AeinzahlenBK" style="cursor:pointer">'+parseInt(pgp_cash)+" einzahlen</span>");document.getElementById("pgp_AeinzahlenBK").addEventListener("click",V,false);A("TReinzahlenBK")}Q()&&f("LastAttackTarget","");var a=document.documentElement.innerHTML.match(/<span class="el1">Punkte:<\/span><span class="el2">(\d+)<\/span>/)[1];f("UserPoints",parseInt(a))}
function Q(){return!/<span id="counter\d+"> -\/-<\/span>/.test(r(document.documentElement.innerHTML,'<a href="/fight/"',"</a>"))}function G(a){a=a?a:document.documentElement.innerHTML;a=r(a,"Sauberkeit: ","%");return parseInt(a)}
function I(a){a=a?a:document.documentElement.innerHTML;a=r(a,"Klicke hier, um zur Finanz"+String.fromCharCode(252)+"bersicht zu kommen");a=r(a,">","<");a=a.match(/[\u20ac(&euro;)]\s*\d+(\.\d*)?(,\d*)?/)[0];a=a.replace(/[\u20ac(&euro;)\s*\.]/g,"");a=a.replace(/,/g,".");return a=parseFloat(a)}
function U(a){a=a?a:document.documentElement.innerHTML;a=r(a,'<a href="/stock/" class="ttip" rel="Klicke hier, um etwas zu trinken">');a=a.match(/\d+(\.\d*)?\s*\u2030/)[0];a=a.replace(/[\u2030\s*]/g,"");return a=parseFloat(a)}function V(){var a=I();GM_xmlhttpRequest({method:"post",url:k("gang/cash/add"),headers:{"Content-type":"application/x-www-form-urlencoded"},data:encodeURI("f_money="+parseInt(a)+"&f_comment=&Submit=Einzahlen"),onload:function(){top.location.href=document.URL}})}
function z(){var a=h("layTop","0"),b=h("layLeft","0");a='<span id="pgp_SpanLay" class="pgp_dragclass" style="z-index:999;display:none;position:absolute;top:'+a+"px;left:"+b+'px;width:250px;font-size:x-small;-moz-border-radius:20px;opacity:2;border:0px solid black; background-color:#FFFFFF;padding:5px 5px 0px 5px;">';a+='<table style="width:100%;">';a+='<tr id="pgp_TRheader">';a+='<th id="pgp_THinfo" colspan="2" style="cursor:move;background-color:#EEEEEE;color:white;">&nbsp;</th>';a+='<th id="pgp_THsettings" style="background-color:#EEEEEE;color:grey;width:10%;">';
a+='<span id="pgp_SPANcollapse" style="cursor:pointer;">&plusmn;</span>';a+='&nbsp;<span id="pgp_SPANshowAll" style="cursor:pointer;">&dArr;</span>';a+="</th>";a+="</tr>";for(b=0;b<pgp_aTRs.length;b++)a+='<tr style="visibility:collapse;" id="pgp_'+pgp_aTRs[b]+'"/>';a+="</table>";a+="</span>";pgp_layDiv=document.createElement("div");pgp_layDiv.innerHTML+=a;document.body.appendChild(pgp_layDiv);document.getElementById("pgp_THinfo").addEventListener("mousedown",t,false);document.getElementById("pgp_THinfo").addEventListener("mouseup",
v,false);document.getElementById("pgp_SPANcollapse").addEventListener("click",x,false);document.getElementById("pgp_SPANshowAll").addEventListener("click",y,false);j("gang",C);T();j("overview",F);j("stock/plunder",M);j("activities",N);h("doSammeln",false)&&O()}
if(/http:\/\/(\w+)\.pennerzone\.de\/highscore/.test(document.URL)){pgp_urlShort=document.URL.match(/http:\/\/(\w+)\.pennerzone\.de\/highscore/)[1];pgp_location="_H";if(pgp_urlShort=="berlin")pgp_location="_B";var W=parseInt(h("UserPoints",0));if(W>0){var X=parseInt(W*0.8),Y=parseInt(W*1.5);if(document.getElementById("points_max").value==""){document.getElementById("points_max").value=Y;document.getElementById("points_min").value=X}}}else{pgp_DEV="pgp_DEV";pgp_userscripts=64556;pgp_movedragok=false;
pgp_movedx=pgp_movedy=pgp_moved=pgp_movex=pgp_movey=null;pgp_aTRs="TRoverviewSauber,TRoverviewClean,TRoverviewSoberUp,TRoverviewSammeln,TReinzahlenBK,TRoverviewSpenden,TRoverviewAttDef,TRoverviewWaffe,TRoverviewEH,TRoverviewTier,TRplunder,TRplunderChange".split(",");pgp_IDcount=0;pgp_urlShort=document.URL.match(/\/\w+\./).toString();pgp_urlShort=pgp_urlShort.substr(1,pgp_urlShort.length-2).toLowerCase();pgp_location="_H";if(pgp_urlShort=="berlin")pgp_location="_B";if(document.URL.indexOf(k("redirect"))==
0){var Z=document.documentElement.innerHTML;Z=r(Z,'http-equiv="refresh"');Z=r(Z,"URL=",'"').toLowerCase();if(/^http:\/\/\w+\.pennergame\.de\//.test(Z))top.location.href=Z}else if(!(document.URL.indexOf(k("change_please"))==0&&window.history.length==1)){z();document.URL.indexOf(k("gang"))==0&&E();document.URL.indexOf(k("fight"))==0&&P();document.URL.indexOf(k("stock/plunder"))==0&&R()}}B();
