// ==UserScript==
// @name            Gintama Smile Plurk v.19.0
// @include         http://www.plurk.com/*
// @大會報告：噗浪改版，已經無法安裝腳本，請勿安裝
// @description     Plurk Smiles＋銀魂＋彎彎＋白熊咖啡廳＋洋蔥頭＋悠嘻猴＋APH＋兔斯基＋搞笑日和＋荒川＋黑執事II＋海賊王＋綜合＋動態字（＠2012/05/02）
// modified log:    




// ********** Main Script ***********
var smileData = [];



smileData.push([
	'萬事屋',
	'https://dl.dropbox.com/u/12620377/G1/',
	[
        '1.gif','2.gif','3.gif','4.jpg','5.jpg','5a.jpg','6.gif','7.gif','7a.jpg','7b.jpg','8.gif','9.gif','10.gif',

        '11.gif','12.jpg','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif',
        '20.gif','21.gif','22.gif','23.gif','24.gif','25.gif','26.gif','27.gif','28.gif',
        '29.gif','30.gif','31.gif','31a.jpg','32.gif','33.gif','34.gif','35.gif','36.gif','37.gif','38.gif','39.gif','40.gif','40a.jpg','41.gif','42.jpg','43.jpg','44.gif','45.gif','46.gif','47.gif','48.gif','49.gif','50.jpg','51.gif','52.gif','53.jpg','54.jpg','55.gif','56.jpg','57.jpg','58.jpg','59.jpg','60.gif',
	]
]);


smileData.push([
	'真選攘夷',
	'https://dl.dropbox.com/u/12620377/G2/',
	[
        '1.gif','2.gif','3.jpg','4.jpg','5.gif','5a.jpg','6.gif','7.gif','8.gif','9.gif','9a.jpg','10.gif',

        '11.gif','12.gif','12a.jpg','13.jpg','13a.jpg','14.gif','15.gif','16.gif','16a.jpg','17.jpg','18.gif','18a.jpg','19.gif',
        '20.gif','21.gif','22.gif','22a.jpg','23.gif','24.gif','25.gif','26.gif','26a.jpg','27.gif','28.gif',
        '29.gif','30.gif','31.gif','31a.jpg','32.gif','33.gif','34.gif','35.gif','36.gif','37.gif','37a.jpg','38.gif','39.gif',
'40.gif','41.gif','42.gif','43.gif','44.gif','45.gif','46.gif','47.gif','48.jpg','49.gif','50.gif','51.jpg','52.gif','53.gif','54.gif','55.gif','56.gif','57.jpg','58.jpg','59.jpg','60.jpg',
]
]);



smileData.push([
	'銀魂綜合',
	'https://dl.dropbox.com/u/12620377/G3/',
	[
        '1.gif','2.gif','2a.jpg','3.gif','4.gif','5.gif','6.gif','7.jpg','8.gif','9.gif','9a.jpg','10.gif',

        '11.gif','11a.jpg','12.gif','13.gif','13a.jpg','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif',
        '20.gif','21.gif','22.gif','23.jpg','24.jpg','25.jpg','26.jpg','27.jpg','29.jpg','30.jpg','31.gif','32.jpg',
	]
]);





smileData.push([
	'彎彎', 
	'https://dl.dropbox.com/u/12620377/11/',
	[
		'1.jpg','2.jpg','3.jpg','4.jpg','5.jpg','6.gif','7.gif','8.gif','9.jpg','10.jpg',

        '11.jpg','12.jpg','13.jpg','14.gif','15.jpg','16.jpg','17.jpg','18.jpg','19.jpg',
        '20.gif','21.jpg','22.jpg','23.gif','24.gif','25.gif','26.gif','27.gif','28.jpg',
        '29.jpg','30.jpg','31.jpg','32.gif','33.jpg','34.gif','35.jpg','36.gif','37.gif','38.gif','39.gif','40.jpg','41.jpg','42.jpg','43.jpg','44.gif','45.gif','46.gif',


        ]
]);






smileData.push([
	'洋蔥頭',
	'http://jiayun.org/onion/',
	[
        '001.gif','002.gif','003.gif','004.gif','005.gif',  '006.gif','007.gif','008.gif','009.gif','010.gif',
        '011.gif','012.gif','013.gif','014.gif','015.gif',  '016.gif','017.gif','018.gif','019.gif','020.gif',
        '021.gif','022.gif','023.gif','024.gif','025.gif',  '026.gif','027.gif','028.gif','029.gif','030.gif',
        '031.gif','032.gif','033.gif','034.gif','035.gif',  '036.gif','037.gif','038.gif','039.gif','040.gif',
        '041.gif','042.gif','043.gif','044.gif','045.gif',  '046.gif','047.gif','048.gif','049.gif','050.gif',
        '051.gif','052.gif','053.gif','054.gif','055.gif',  '056.gif','057.gif','058.gif','059.gif','060.gif',
        '061.gif','062.gif','063.gif','064.gif','065.gif',  '066.gif','067.gif','068.gif','069.gif','070.gif',
        '071.gif','072.gif','073.gif','074.gif','075.gif',  '076.gif','077.gif','078.gif','079.gif','080.gif',
        '081.gif','082.gif','083.gif','084.gif','085.gif',  '086.gif','087.gif','088.gif','089.gif','090.gif',
        '091.gif','092.gif','093.gif','094.gif','095.gif',  '096.gif','097.gif','098.gif','099.gif','100.gif',
        '101.gif','102.gif','103.gif','104.gif','105.gif',  '106.gif','107.gif','108.gif','109.gif','110.gif',
        '111.gif','112.gif','113.gif','114.gif','115.gif',  '116.gif','117.gif','118.gif','119.gif','120.gif',
        '121.gif','122.gif','123.gif','124.gif','125.gif',  '126.gif','127.gif','128.gif','129.gif','130.gif',
	]
]);




smileData.push([
	'悠嘻猴',
	'https://dl.dropbox.com/u/12620377/MK/',
	[
        '1.gif','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',
        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif',
        '20.gif','21.gif','22.gif','23.gif','24.gif','25.gif','26.gif','27.gif','28.gif','29.gif','30.gif',
	]
]);




smileData.push([
	'兔斯基',
	'https://dl.dropbox.com/u/12620377/TS/',
	[
	'1.gif','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif',
        '20.gif','21.gif','22.gif','23.gif','24.gif','25.gif',


        
        ]
]);



smileData.push([
	'GY表情',
	'https://dl.dropbox.com/u/12620377/GY/',
	[
        '1.jpg','2.jpg','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif','20.gif','21.gif','22.jpg','23.gif','24.gif','25.gif','26.gif','27.gif','28.gif','29.gif','30.jpg','31.jpg','32.jpg','33.gif','34.gif','35.gif','36.gif',

        ]
]);



smileData.push([
	'白熊CAFE',
	'https://dl.dropbox.com/u/12620377/CF/',
	[
        '1.jpg','1a.jpg','2.jpg','3.jpg','4.jpg','5.jpg','6.jpg','7.gif','8.jpg','9.jpg',
'10.gif','11.gif','12.jpg','13.jpg','14.jpg','15.jpg','16.jpg','17.gif','18.jpg','19.jpg','20.jpg','21.jpg','22.jpg','23.jpg','24.jpg','25.jpg','26.jpg','27.jpg','28.jpg','29.jpg','30.jpg','31.gif','32.jpg','33.jpg','34.gif','35.gif','36.gif','37.gif','38.gif','39.gif','40.gif','41.gif','42.gif','43.jpg','44.jpg','45.jpg','46.jpg','47.jpg','48.jpg','49.jpg','50.jpg',
	]
]);





smileData.push([
	'火影小李',
	'https://dl.dropbox.com/u/12620377/LE/',
	[
        '1.gif','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif','20.gif','21.gif',
	]
]);










smileData.push([
	'男高生',
	'https://dl.dropbox.com/u/12620377/NJ/',
	[
        '1.gif','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif','20.gif','21.gif','22.gif','23.gif','24.gif','25.gif','26.gif','27.gif','28.gif','29.gif','30.gif','31.gif','32.gif','33.gif','34.gif','35.gif','36.gif','37.gif','38.gif','39.gif','40.gif','41.gif','42.gif','43.gif','44.gif','45.gif','46.gif','47.gif','48.gif','49.gif','50.gif',
	]
]);







smileData.push([
	'召喚惡魔',
	'https://dl.dropbox.com/u/12620377/AS/',
	[
        '1.gif','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif','20.gif','21.gif','22.gif','23.gif',

        ]
]);






smileData.push([
	'日和',
	'https://dl.dropbox.com/u/12620377/GM/',
	[
        '1.gif','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif',
        '20.gif','21.gif','22.gif','23.gif','24.gif',


        ]
]);







smileData.push([
	'荒川',
	'https://dl.dropbox.com/u/12620377/UB/',
	[
        '1.gif','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif',
        '20.gif','21.gif','22.gif',
	]
]);








smileData.push([
	'APH',
	'https://dl.dropbox.com/u/12620377/AP/',
	[
        '01.gif','1.gif','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif',

'20.gif','21.gif','22.gif','23.gif','24.gif','25.gif','26.gif','27.gif','28.gif','29.gif','30.gif','31.gif','32.gif','33.gif',
        ]
]);









smileData.push([
	'黑執事II',
	'https://dl.dropbox.com/u/12620377/KS/',
	[
        '1.gif','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif',
        '20.gif','21.gif','22.gif','23.gif','24.gif','25.gif',
	]
]);











smileData.push([
	'海賊王',
	'https://dl.dropbox.com/u/12620377/OP/',
	[
        '1.gif','2.gif','3.gif','4.jpg','5.gif','6.gif','7.gif','8.jpg','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif',

'20.gif','21.gif','22.gif','23.gif','23a.jpg','24.gif','25.gif','26.gif','27.gif',

        ]
]);






smileData.push([
	'兔包',
	'https://dl.dropbox.com/u/12620377/TB/',
	[
'1.gif','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif',
        '20.gif','21.gif','22.gif','23.gif','24.gif',


        ]
]);



smileData.push([
	'噗通',
	'https://dl.dropbox.com/u/12620377/PT/',
	[
        'a1.gif','a2.gif','1.gif','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif',

'20.gif','21.gif','22.gif','23.gif','24.gif','25.gif','26.gif','27.gif','28.gif','29.gif','30.gif','31.gif','32.gif','33.png','34.png','35.png','36.png','37.png','38.png','39.png','40.png',

        ]
        
]);










smileData.push([
	'動漫綜合',
	'https://dl.dropbox.com/u/12620377/TT/',
	[
        '1.gif','1a.jpg','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif','11.gif','12.gif','13.bmp','13a.gif','14.gif','15.gif','19.jpg','20.jpg','21.jpg','22.jpg','23.jpg','24.jpg','25.jpg','26.gif','27.gif','28.gif','29.gif','30.gif','31.gif','32.gif',

	]
]);





smileData.push([
	'動態字',
	'https://dl.dropbox.com/u/12620377/WD/',
	[
'1.gif','1a.jpg','2.gif','3.gif','4.gif','5.gif','6.gif','7.gif','8.gif','9.gif','10.gif',

        '11.gif','12.gif','13.gif','14.gif','15.gif','16.gif','17.gif','18.gif','19.gif','20.gif','21.gif','22.gif','23.gif','24.gif','25.gif','26.gif','27.gif','28.gif','29.gif','30.gif','31.gif',
        


        ]
]);




var isinit = false;
var currInput = null;
var rplreg = /\[(\d+) (\d+)\]/g;
var pageState = location.href.split('/')[3];

window.addEventListener('click', function()
{
	isinit || setTimeout(init, 0);
},false);

// init
function init()
{

    isinit = true;
    // init contents
    for(var i=0; i<smileData.length; i++)
    {
        addTab(i, smileData[i]);
    }
    // init css
    getById('emoticons_show').style.width  = '100%';
    getById('emoticons_show').style.height = '200px';
    getById('emoticons_show').style.overflow = 'auto';
    getById('emoticons_tabs').style.width  = '100%';
    getById('emoticons_tabs').style.height = 'auto';

	getById('input_big').addEventListener('focus', function()
    {
        	getById('currentField').value= 'input_big';
    }, false);

	getById('input_small').addEventListener('focus', function()
    {
        	getById('currentField').value= 'input_small';
    }, false);

}

function replaceSmile()
{
    if(rplreg.test(this.value))
        this.value = this.value.replace(rplreg, doReplace);
}

function doReplace(str, datid, smileid)
{
    arr = smileData[datid];
    if (typeof(arr) != 'undefined')
    {
        if(typeof(arr[2][smileid]) != 'undefined')
            str = ' ' + smileData[datid][1] + smileData[datid][2][smileid] + ' ';
    }
    return str;
}

function addTab(id, data)
{
    var myli = document.createElement('li');
    myli.className = 'emoticon_selecter';

	if(id==0)
	{
		myli.innerHTML = '<input type=hidden id=currentField value="input_big"><input 

type=hidden id=myIconAdded value="1"><a href="#">'+data[0]+'</a>';
	}
	else
	{
    	myli.innerHTML = '<a href="#">'+data[0]+'</a>';
    }
    myli.addEventListener('click', function()
    {
        addImages(this, id);
    }, false);

    getById('emoticons_tabs').getElementsByTagName('ul')[0].appendChild(myli);
}

function addImages(obj, ind)
{
    var showDiv = getById('emoticons_show');
    var lis = getById('emoticons_tabs').getElementsByTagName('li');
    for(var i=0; i<lis.length; i++)
        lis[i].className = 'emoticon_selecter';

    obj.className += ' current';

    var data = smileData[ind];
    var baseUrl = data[1];
    var str = '<div>';
    for(var i=0, dat = data[2], _url; i<dat.length; i++)
    {
        _url = baseUrl + dat[i];
        str += '<a class="a_emoticon" href="#"><img style="max-width: 40px; max-height: 40px;" src="'+_url+'" 

alt="'+dat[i]+'" /></a>';

    }
    str += '</div>';
    showDiv.innerHTML = str;
    
    var imgs = showDiv.getElementsByTagName('img');
    for(var i=0; i<imgs.length; i++)
    {
        imgs[i].addEventListener('click', function()
        {
        	getById(getById('currentField').value).value += ' ' + this.src + ' ';
        	getById(getById('currentField').value).focus();
        }, false);
    }
}

function getById(oid)
{
    return document.getElementById(oid);
}

//== RE ==//
var GM_JQ = document.createElement('script');
GM_JQ.src = 'http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js';
GM_JQ.type = 'text/javascript';
document.getElementsByTagName('head')[0].appendChild(GM_JQ);

function GM_wait() {
	if(typeof unsafeWindow.jQuery == 'undefined') {
		setTimeout(GM_wait,100);
	} else {
		$ = unsafeWindow.jQuery.noConflict(true);
	}
}
var uw = unsafeWindow;
var p = uw.Plurks;
var o_expand;

GM_wait();

if(p) {

	var uw = unsafeWindow;

	o_expand = p.expand;
	p.expand = function(div) {
		o_expand(div);

		var ib = $('#input_big').get(0);

		if(ib) {

			var plurk = uw.getPD(div).obj;
			var link = 'http://plurk.com/p/' + (plurk.plurk_id).toString(36);
			var raw = plurk.content_raw;
			var owner_id = plurk.owner_id;

			var info_box = $(uw.$dp.info_box);
			var pp = info_box.children(".perma_link");

/*			if(!getById('myIconAdded'))
			{
				setTimeout(init(),5000);
			}*/

			if(info_box.children("#RePlurk").length == 0) {
				var rp = $('<a href="#" id="RePlurk">轉貼此噗</a>').css

('float','right').css('right-padding','4px').click(function(){
					doRePlurk(owner_id,raw,link);
				});

				pp.after(rp);
			}

		}
	}
}


function doRePlurk(owner_id,raw,link){
	var nick = uw.SiteState.getUserById(owner_id).nick_name;

	$('#input_big').val(link + ' ([原噗]) ' + ((nick) ? ( ' by ' + '@' + nick + ': ') : '') + raw);
	p._removeExpand();
	uw.MaxChar.updateBig();
}







// ==/UserScript==