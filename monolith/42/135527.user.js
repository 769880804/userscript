// ==UserScript==
// @name         Campfire Emoticons.
// @namespace    https://weebuild.campfirenow.com
// @include      *.campfirenow.com/room/*
// @author       Shawn Holman
// @description  Adds emoticons to campfire.
// @require      http://code.jquery.com/jquery-latest.min.js
// @version      2.0
// ==/UserScript==
var developer = {
    init: 'true',//Turn emoticons off and on in the code.
    options: {
        smileys: {
            mainRun: true,//If you turn this off(false), when you load the site the emoticons wont change
            running: true //If you turn this off(false), the emoticons you send wont work.
        },
        smileyBox: {
            mainConfig: true,//When set to true, smileyBox will be on
            instantSend: false //When you click on a smiley in the smileyBox the smiley and everything inside the textarea will be send.
        },
        emoticonBar: true,//Turn the emoticons bar off(false) and on(true)
        fancyNumbers: {
            mainRun: true,//If you turn this off(false), when you load the site the numbers wont change to fancy numbers
            running: true,//If you turn this off(false), the fancy numbers you send, wont actually turn fancy
            style: {
                textColor: '#fff',//Change the text color of the fancy numbers
                backgroundColor: '#E01B1B' //Change the background colors of the fancy numbers
            }
        }
    }
};
if(developer.init=="true"){var main={emoticons:{'<(")':{position:"-350px 0px","class":"pen"},":|]":{position:"-387px 0px","class":"robo"},":putnam:":{position:"-368px 0px","class":"putnam"},"(^^^)":{position:"-403px 0px","class":"shark"},"3:)":{position:"-176px 0px","class":"devil"},">:O":{position:"-288px 0px","class":"ahh"},"3:D":{position:"-176px 0px","class":"devil2"},">:(":{position:"-128px 0px","class":"grr"},"O:)":{position:"-192px 0px","class":"angel"},":)":{position:"0px 0px","class":"smile"},"(:":{position:"0px 0px","class":"smile2"},":(":{position:"-16px 0px","class":"frown"},"):":{position:"-16px 0px","class":"frown2"},":P":{position:"-32px 0px","class":"tongue"},":D":{position:"-48px 0px","class":"grin"},":O":{position:"-64px 0px","class":"gasp"},";)":{position:"-80px 0px","class":"wink"},"(;":{position:"-80px 0px","class":"wink2"},"B-)":{position:"-96px 0px","class":"glasses"},"8-)":{position:"-96px 0px","class":"glasses2"},"B-|":{position:"-112px 0px","class":"sunglasses"},"8-|":{position:"-112px 0px","class":"sunglasses2"},":/":{position:"-144px 0px","class":"unsure"},"/:":{position:"-144px 0px","class":"unsure2"},":'(":{position:"-160px 0px","class":"cry"},":*":{position:"-208px 0px","class":"kiss"},"<3":{position:"-224px 0px","class":"heart"},"^_^":{position:"-240px 0px","class":"kiki"},"-_-":{position:"-256px 0px","class":"sqint"},"o.O":{position:"-272px 0px","class":"confuse"},"O.o":{position:"-272px 0px","class":"confuse2"},">.<":{position:"-288px 0px","class":"ahh2"},":v":{position:"-304px 0px","class":"pacman"},":V":{position:"-304px 0px","class":"pacman2"},":3":{position:"-320px 0px","class":"cat"},"(y)":{position:"-336px 0px","class":"like"}},escape:function(a){return a.replace(/[-[\]{}()*+?.,;&\\^$|#\s]/g,"\\$&")},replace:function(a,b,c){var d=a,e=d.text(),f=d.html(),g=d.parent().parent().hasClass("paste"),h=d.parent().parent().hasClass("upload_message"),i=d.find(".image").length;if(g==false&&i<1&&h==false){var j=new RegExp("(\\s|^):[0-9]+:(?!\\S)","g");if(j.test(f)){var k=$(d).html().split(" ");var l=0;for(var m=0;m<k.length;m++){var n=k[m].replace(/\:[0-9]+\:/g,function(a){l=a.substring(1,a.length-1);if(developer.options.fancyNumbers.style==false||b==false){k[m]=k[m].replace(/\:[0-9]+\:/g,l)}else{k[m]=k[m].replace(/\:[0-9]+\:/g,'<span class="special" style="padding:0px 3px 0px 3px;font-size:12px;color:'+developer.options.fancyNumbers.style.textColor+";background-color:"+developer.options.fancyNumbers.style.backgroundColor+";-webkit-border-radius:2px;-moz-border-radius:2px;text-shadow:0 0 1px "+developer.options.fancyNumbers.style.textColor+';">'+(a.length<10?l.substr(0,1)==0&&l!=0?l.substr(1,l.length):l:l.substr(0,7))+"</span>")}$(d).html(k.join(" "))})}}if(c==true){$.each(main.emoticons,function(a,b){var c=new RegExp("(\\s|^)"+main.escape(a.replace(/\>/,">").replace(/\</,"<"))+"(?!\\S)","g"),g=14,h=f;if(a==":/"){h=e}if(c.test(h)){if(a=="<3"||a=="O:)"||a=="(^^^)"){g=15}else if(a==":putnam:"||a=='<(")'){g=16}var i=$(d).html();var j="<span "+(a=='<(")'?"title='"+a+"'":'title="'+a+'"')+' class="emote '+b["class"]+'" style="width: '+g+"px;background-position:"+b["position"]+'"></span>';$(d).html(i.replace(c," "+j))}})}}},cursor:function(a){if(typeof a.selectionStart=="number"){a.selectionStart=a.selectionEnd=a.value.length}else if(typeof a.createTextRange!="undefined"){a.focus();var b=a.createTextRange();b.collapse(false);b.select()}},setCookie:function(a,b,c){var d=new Date;d.setTime(d.getTime()+c*60*1e3);document.cookie=a+"="+escape(b)+(c==null?"":";expires="+d.toGMTString())},getCookie:function(a){var b,c,d,e=document.cookie.split(";");for(b=0;b<e.length;b++){c=e[b].substr(0,e[b].indexOf("="));d=e[b].substr(e[b].indexOf("=")+1);c=c.replace(/^\s+|\s+$/g,"");if(c==a){return unescape(d)}}},use:function(a){if(a=="mainOn"||a=="on"){emoOn=true;if(emoOn===true){$(".paste_message").addClass("paste");if(a=="mainOn"){$("div.body").backEach(function(a){main.replace(a,developer.options.fancyNumbers.mainRun,developer.options.smileys.mainRun)})}else if(a=="on"){var b=$("div.body").size(),c=developer.options.fancyNumbers.running,d=developer.options.smileys.running;for(var e=b;e>b-(c==false||d==false?2:6);e--){main.replace($("div.body").eq(e),c,d)}}}}else if(a=="off"){emoOn=false;if(emoOn===false){$("div.body").each(function(){var a=$(this).parent().parent().hasClass("paste");var b=$(this).parent().parent().hasClass("time");var c=$(this).find("a").length;if(a==false&&c<1&&b==false){$.each(main.emoticons,function(a,b){$("."+b["class"]).removeAttr("style").html(a)})}});$(".emote").css("background-image","none")}}}};$.fn.backEach=function(a){var b={work:a};for(var c=$(this).length;c>=0;c--){b.work($($(this)[c]))}};var tested=false;var emoOn=true;$(document).ready(function(){if(developer.options.emoticonBar==true)$(".participants").after('<br><div id="emote" style="display:none;margin-bottom:-25px"><h3><span class="room_actions"><a href="javascript:void(0)" class="on b">On</a> | <a href="javascript:void(0)" class="off p">Off</a></span>Emoticons</h3></div><br>');if(developer.options.smileyBox.mainConfig==true){if(localStorage.getItem("emoticons")=="on"){$("#send").after('<div id="smiley" style="background-image: url(https://dl.dropbox.com/u/25819920/happy.png);width:28px;height:26px;position:relative;"><div class="emoList" style="display:none;"> <table style="margin-top:-14px" class="table"> <tr> <th><div class="emote smiley" symbol=":)" title=":)" style="background-position:0 0;width:15px"></div></th> <th><div class="emote smiley" symbol=":(" title=":(" style="background-position:-16px 0;width:15px"></div></th> <th><div class="emote smiley" symbol=":P" title=":P" style="background-position:-32px 0;width:15px"></div></th> <th><div class="emote smiley" symbol=":D" title=":D" style="background-position:-48px 0;width:15px"></div></th> <th><div class="emote smiley" symbol=":O" title=":O" style="background-position:-64px 0;width:15px"></div></th> <th><div class="emote smiley" symbol=";)" title=";)" style="background-position:-80px 0;width:15px"></div></th> </tr> <tr> <th><div class="emote smiley" symbol="B-)" title="B-)" style="background-position:-96px 0;width:15px"></div></th> <th><div class="emote smiley" symbol="B-|" title="B-|" style="background-position:-112px 0;width:15px"></div></th> <th><div class="emote smiley" symbol=">:(" title=">:(" style="background-position:-128px 0;width:15px"></div></th> <th><div class="emote smiley" symbol=":/" title=":/" style="background-position:-144px 0;width:15px"></div></th> <th><div class="emote smiley" symbol=":%(" title="'+":'("+'" style="background-position:-160px 0;width:15px"></div></th> <th><div class="emote smiley" symbol="3:D" title="3:D" style="background-position:-176px 0;width:15px"></div></th> </tr> <tr> <th><div class="emote smiley" symbol="O:)" title="O:)" style="background-position:-192px 0;width:15px"></div></th> <th><div class="emote smiley" symbol=":*" title=":*" style="background-position:-208px 0;width:15px"></div></th> <th><div class="emote smiley" symbol="<3" title="<3" style="background-position:-224px 0;width:15px"></div></th> <th><div class="emote smiley" symbol="^_^" title="^_^" style="background-position:-240px 0;width:15px"></div></th> <th><div class="emote smiley" symbol="-_-" title="-_-" style="background-position:-256px 0;width:15px"></div></th> <th><div class="emote smiley" symbol="o.O" title="o.O" style="background-position:-272px 0;width:15px"></div></th> </tr> <tr> <th><div class="emote smiley" symbol=">.<" title=">.<" style="background-position:-288px 0;width:15px"></div></th> <th><div class="emote smiley" symbol=":V" title=":V" style="background-position:-304px 0;width:15px"></div></th> <th><div class="emote smiley" symbol=":3" title=":3" style="background-position:-320px 0;width:15px"></div></th> <th><div class="emote smiley" symbol="(y)" title="(y)" style="background-position:-336px 0;width:14px"></div></th> <th><div class="emote smiley" symbol="(^^^)" title="(^^^)" style="background-position:-403px 0;width:15px"></div></th> <th><div class="emote smiley" symbol=":putnam:" title=":putnam:" style="background-position:-368px 0;width:16px"></div></th></tr><tr><th><div class="emote smiley" symbol="<(+)" title='+(""+'<(")'+"")+' style="background-position:-350px 0;width:16px"></div></th><th><div class="emote smiley" symbol=":|]" title=":|]" style="background-position:-387px 0;width:14px"></div></th></tr>​</table> <div class="down"></div> </div>​​​​​​​​​​​​​​​​​​​​​​​​​​​​</div>')}}$("#MainTabs li a[href='https://weebuild.campfirenow.com/files+transcripts']").after('<span class="error" style="color:red;font-size:15px"></span>');$("head").append('<style type="text/css">@import url(https://fonts.googleapis.com/css?family=Marko+One); .p{cursor:pointer}.b{font-weight:bold}.special{font-family: "Marko One", serif;} .emote { height: 15px;display: inline-block; background-image: url(https://dl.dropbox.com/u/25819920/sprite2.png); }.smiley{cursor:pointer} th{padding:2px;width:15px}.emoList{-moz-border-radius:6px;background-color: beige;-webkit-border-radius:6px;-webkit-box-shadow:0 0 10px #000;border:1px solid #000;left:-22px;padding:3px;position:absolute;top:-115px;width:115px}.down{border-left:12px solid transparent;border-right:12px solid transparent;border-top:12px solid #000;bottom:-13px;height:0;left:23px;position:absolute;width:0}</style>')});$(function(){$(".off").live("click","span",function(){if(!$(this).hasClass("b")){main.use("off");localStorage.setItem("emoticons","off");$(".off").removeClass("p").addClass("b");$(".on").removeClass("b").addClass("p");$("#smiley").hide()}});var a=0;$(".smiley").click(function(){var b=main.getCookie("hash_4DEnCaOvqc0kk48TTYAvRTaKHiZiM6KxYSxnMce5");if(a>5&&b!=="block"){var c=new Date;$(".error").html("     Spamming this is not allowed. InstantSend is now disabled for 10 minutes.");setTimeout(function(){$(".error").text("")},4e3);main.setCookie("hash_4DEnCaOvqc0kk48TTYAvRTaKHiZiM6KxYSxnMce5","block",10);main.setCookie("hash_4DEnCaOvqc0kk48TTYAvRTaKHiZiM6KxYSxnMce5setTime",c.getHours()+":"+c.getMinutes(),10);a=0}else{$("#input").focus().val($("#input").val()+($.trim($("#input").val())==""?"":" ")+$(this).attr("symbol").replace("%","'").replace("+",'"'));if(developer.options.smileyBox.instantSend==true){if(b!=="block"){$("#send").click()}else{var d=main.getCookie("hash_4DEnCaOvqc0kk48TTYAvRTaKHiZiM6KxYSxnMce5setTime").split(":");var e=10-Math.floor((new Date-new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate(),d[0],d[1],0,0,0))/6e4);$(".error").html("     InstantSend is disabled for "+(e===0?1:e)+" minute"+(e===0||e===1?"":"s")+" because of misuse");setTimeout(function(){$(".error").text("")},4e3)}}else{main.cursor(document.getElementById("input"));window.setTimeout(function(){main.cursor(document.getElementById("input"))},1)}a++}});setInterval(function(){a=0},9e3);var b;$("#smiley").live("hover",function(){$(".emoList").fadeIn()}).live("mouseover",function(){clearTimeout(b);$(".emoList").show()}).live("mouseout",function(){b=setTimeout(function(){$(".emoList").fadeOut()},500)});$(".on").live("click","span",function(){if(!$(this).hasClass("b")){$(".on").removeClass("p").addClass("b");$(".off").removeClass("b").addClass("p");location.reload(true);localStorage.setItem("emoticons","on")}});var c;$(window).blur(function(){c=true;if(c===true){emoOn=false;emoOff=true}});$(window).focus(function(){c=false;if(c===false){if(localStorage.getItem("emoticons")=="on"){main.use("on")}}});if(localStorage.getItem("emoticons")=="on"){main.use("mainOn");var c=$("#chat").text();setInterval(function(){if(emoOn==true){if(c!==$("#chat").text()){main.use("on")}}c=$("#chat").text()},10)}else{$(".off").removeClass("p").addClass("b");$(".on").removeClass("b").addClass("p");main.use("off")}$("#emote").slideDown(1245)})}