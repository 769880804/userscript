// ==UserScript==
// @name           Google News Link
// @namespace      BeenJammin.Greasemonkey.UserScripts
// @version        1.5
// @include        http*://google.com/*
// @include        http*://google.ae/*
// @include        http*://google.com.af/*
// @include        http*://google.com.ag/*
// @include        http*://google.off.ai/*
// @include        http*://google.am/*
// @include        http*://google.com.ar/*
// @include        http*://google.as/*
// @include        http*://google.at/*
// @include        http*://google.com.au/*
// @include        http*://google.az/*
// @include        http*://google.ba/*
// @include        http*://google.com.bd/*
// @include        http*://google.be/*
// @include        http*://google.bg/*
// @include        http*://google.bi/*
// @include        http*://google.com.bo/*
// @include        http*://google.com.br/*
// @include        http*://google.bs/*
// @include        http*://google.co.bw/*
// @include        http*://google.com.bz/*
// @include        http*://google.ca/*
// @include        http*://google.cd/*
// @include        http*://google.cg/*
// @include        http*://google.ch/*
// @include        http*://google.ci/*
// @include        http*://google.co.ck/*
// @include        http*://google.cl/*
// @include        http*://google.com.co/*
// @include        http*://google.co.cr/*
// @include        http*://google.com.cu/*
// @include        http*://google.de/*
// @include        http*://google.dj/*
// @include        http*://google.dk/*
// @include        http*://google.dm/*
// @include        http*://google.com.do/*
// @include        http*://google.com.ec/*
// @include        http*://google.es/*
// @include        http*://google.com.et/*
// @include        http*://google.fi/*
// @include        http*://google.com.fj/*
// @include        http*://google.fm/*
// @include        http*://google.fr/*
// @include        http*://google.gg/*
// @include        http*://google.com.gi/*
// @include        http*://google.gl/*
// @include        http*://google.gm/*
// @include        http*://google.gr/*
// @include        http*://google.com.gt/*
// @include        http*://google.com.hk/*
// @include        http*://google.hn/*
// @include        http*://google.hr/*
// @include        http*://google.co.hu/*
// @include        http*://google.co.id/*
// @include        http*://google.ie/*
// @include        http*://google.co.il/*
// @include        http*://google.co.im/*
// @include        http*://google.co.in/*
// @include        http*://google.is/*
// @include        http*://google.it/*
// @include        http*://google.co.je/*
// @include        http*://google.com.jm/*
// @include        http*://google.jo/*
// @include        http*://google.co.jp/*
// @include        http*://google.co.ke/*
// @include        http*://google.kg/*
// @include        http*://google.co.kr/*
// @include        http*://google.kz/*
// @include        http*://google.li/*
// @include        http*://google.lk/*
// @include        http*://google.co.ls/*
// @include        http*://google.lt/*
// @include        http*://google.lu/*
// @include        http*://google.lv/*
// @include        http*://google.com.ly/*
// @include        http*://google.mn/*
// @include        http*://google.ms/*
// @include        http*://google.com.mt/*
// @include        http*://google.mu/*
// @include        http*://google.mw/*
// @include        http*://google.com.mx/*
// @include        http*://google.com.my/*
// @include        http*://google.com.na/*
// @include        http*://google.com.nf/*
// @include        http*://google.com.ni/*
// @include        http*://google.nl/*
// @include        http*://google.no/*
// @include        http*://google.com.np/*
// @include        http*://google.nr/*
// @include        http*://google.nu/*
// @include        http*://google.co.nz/*
// @include        http*://google.com.om/*
// @include        http*://google.com.pa/*
// @include        http*://google.com.pe/*
// @include        http*://google.com.ph/*
// @include        http*://google.com.pk/*
// @include        http*://google.pl/*
// @include        http*://google.pn/*
// @include        http*://google.com.pr/*
// @include        http*://google.pt/*
// @include        http*://google.com.py/*
// @include        http*://google.ro/*
// @include        http*://google.ru/*
// @include        http*://google.rw/*
// @include        http*://google.com.sa/*
// @include        http*://google.com.sb/*
// @include        http*://google.sc/*
// @include        http*://google.se/*
// @include        http*://google.com.sg/*
// @include        http*://google.sh/*
// @include        http*://google.sk/*
// @include        http*://google.sn/*
// @include        http*://google.sm/*
// @include        http*://google.com.sv/*
// @include        http*://google.co.th/*
// @include        http*://google.com.tj/*
// @include        http*://google.tm/*
// @include        http*://google.to/*
// @include        http*://google.tp/*
// @include        http*://google.com.tr/*
// @include        http*://google.tt/*
// @include        http*://google.com.tw/*
// @include        http*://google.com.ua/*
// @include        http*://google.co.ug/*
// @include        http*://google.co.uk/*
// @include        http*://google.com.uy/*
// @include        http*://google.uz/*
// @include        http*://google.com.vc/*
// @include        http*://google.co.ve/*
// @include        http*://google.vg/*
// @include        http*://google.co.vi/*
// @include        http*://google.com.vn/*
// @include        http*://google.vu/*
// @include        http*://google.ws/*
// @include        http*://google.co.za/*
// @include        http*://google.co.zm/*
// @include        http*://www.google.com/*
// @include        http*://www.google.ae/*
// @include        http*://www.google.com.af/*
// @include        http*://www.google.com.ag/*
// @include        http*://www.google.off.ai/*
// @include        http*://www.google.am/*
// @include        http*://www.google.com.ar/*
// @include        http*://www.google.as/*
// @include        http*://www.google.at/*
// @include        http*://www.google.com.au/*
// @include        http*://www.google.az/*
// @include        http*://www.google.ba/*
// @include        http*://www.google.com.bd/*
// @include        http*://www.google.be/*
// @include        http*://www.google.bg/*
// @include        http*://www.google.bi/*
// @include        http*://www.google.com.bo/*
// @include        http*://www.google.com.br/*
// @include        http*://www.google.bs/*
// @include        http*://www.google.co.bw/*
// @include        http*://www.google.com.bz/*
// @include        http*://www.google.ca/*
// @include        http*://www.google.cd/*
// @include        http*://www.google.cg/*
// @include        http*://www.google.ch/*
// @include        http*://www.google.ci/*
// @include        http*://www.google.co.ck/*
// @include        http*://www.google.cl/*
// @include        http*://www.google.com.co/*
// @include        http*://www.google.co.cr/*
// @include        http*://www.google.com.cu/*
// @include        http*://www.google.de/*
// @include        http*://www.google.dj/*
// @include        http*://www.google.dk/*
// @include        http*://www.google.dm/*
// @include        http*://www.google.com.do/*
// @include        http*://www.google.com.ec/*
// @include        http*://www.google.es/*
// @include        http*://www.google.com.et/*
// @include        http*://www.google.fi/*
// @include        http*://www.google.com.fj/*
// @include        http*://www.google.fm/*
// @include        http*://www.google.fr/*
// @include        http*://www.google.gg/*
// @include        http*://www.google.com.gi/*
// @include        http*://www.google.gl/*
// @include        http*://www.google.gm/*
// @include        http*://www.google.gr/*
// @include        http*://www.google.com.gt/*
// @include        http*://www.google.com.hk/*
// @include        http*://www.google.hn/*
// @include        http*://www.google.hr/*
// @include        http*://www.google.co.hu/*
// @include        http*://www.google.co.id/*
// @include        http*://www.google.ie/*
// @include        http*://www.google.co.il/*
// @include        http*://www.google.co.im/*
// @include        http*://www.google.co.in/*
// @include        http*://www.google.is/*
// @include        http*://www.google.it/*
// @include        http*://www.google.co.je/*
// @include        http*://www.google.com.jm/*
// @include        http*://www.google.jo/*
// @include        http*://www.google.co.jp/*
// @include        http*://www.google.co.ke/*
// @include        http*://www.google.kg/*
// @include        http*://www.google.co.kr/*
// @include        http*://www.google.kz/*
// @include        http*://www.google.li/*
// @include        http*://www.google.lk/*
// @include        http*://www.google.co.ls/*
// @include        http*://www.google.lt/*
// @include        http*://www.google.lu/*
// @include        http*://www.google.lv/*
// @include        http*://www.google.com.ly/*
// @include        http*://www.google.mn/*
// @include        http*://www.google.ms/*
// @include        http*://www.google.com.mt/*
// @include        http*://www.google.mu/*
// @include        http*://www.google.mw/*
// @include        http*://www.google.com.mx/*
// @include        http*://www.google.com.my/*
// @include        http*://www.google.com.na/*
// @include        http*://www.google.com.nf/*
// @include        http*://www.google.com.ni/*
// @include        http*://www.google.nl/*
// @include        http*://www.google.no/*
// @include        http*://www.google.com.np/*
// @include        http*://www.google.nr/*
// @include        http*://www.google.nu/*
// @include        http*://www.google.co.nz/*
// @include        http*://www.google.com.om/*
// @include        http*://www.google.com.pa/*
// @include        http*://www.google.com.pe/*
// @include        http*://www.google.com.ph/*
// @include        http*://www.google.com.pk/*
// @include        http*://www.google.pl/*
// @include        http*://www.google.pn/*
// @include        http*://www.google.com.pr/*
// @include        http*://www.google.pt/*
// @include        http*://www.google.com.py/*
// @include        http*://www.google.ro/*
// @include        http*://www.google.ru/*
// @include        http*://www.google.rw/*
// @include        http*://www.google.com.sa/*
// @include        http*://www.google.com.sb/*
// @include        http*://www.google.sc/*
// @include        http*://www.google.se/*
// @include        http*://www.google.com.sg/*
// @include        http*://www.google.sh/*
// @include        http*://www.google.sk/*
// @include        http*://www.google.sn/*
// @include        http*://www.google.sm/*
// @include        http*://www.google.com.sv/*
// @include        http*://www.google.co.th/*
// @include        http*://www.google.com.tj/*
// @include        http*://www.google.tm/*
// @include        http*://www.google.to/*
// @include        http*://www.google.tp/*
// @include        http*://www.google.com.tr/*
// @include        http*://www.google.tt/*
// @include        http*://www.google.com.tw/*
// @include        http*://www.google.com.ua/*
// @include        http*://www.google.co.ug/*
// @include        http*://www.google.co.uk/*
// @include        http*://www.google.com.uy/*
// @include        http*://www.google.uz/*
// @include        http*://www.google.com.vc/*
// @include        http*://www.google.co.ve/*
// @include        http*://www.google.vg/*
// @include        http*://www.google.co.vi/*
// @include        http*://www.google.com.vn/*
// @include        http*://www.google.vu/*
// @include        http*://www.google.ws/*
// @include        http*://www.google.co.za/*
// @include        http*://www.google.co.zm/*
// @require        http://code.jquery.com/jquery-latest.min.js
// ==/UserScript==

if (navigator.userAgent.toLowerCase().indexOf('chrome') > -1) {

	function addJQuery(callback) {
	  var script = document.createElement("script");
	  script.setAttribute("src", "http://code.jquery.com/jquery-latest.min.js");
	  script.addEventListener('load', function() {
		var script = document.createElement("script");
		script.textContent = "(" + callback.toString() + ")();";
		document.body.appendChild(script);
	  }, false);
	  document.body.appendChild(script);
	}

	// the guts of this userscript
	function main() {
		jQuery.noConflict();
		(function($) {
			$("#gb_5").click(function() {
				var searchTerm = "";
				if ($("#gbqfq").val() !== undefined) {
					searchTerm = $("#gbqfq").val().replace(/ /g, "+");
				}
				else if ($("#brs .med em").length > 0) {
					searchTerm = $("#tbpi").attr("href").split("?q=")[1].split("&hl=")[0];
				}
				else if ($("table.gssb_m > tbody > tr:first-child > td span").length > 0) {
					searchTerm = $("table.gssb_m > tbody > tr:first-child > td span").html().split("<b>")[0].replace(/ /g, "+").replace(/&nbsp;/g, "+");
				}
				else if ($("table.gssb_m > tbody > tr:first-child > td div.gspr_a").length > 0) {
					searchTerm = $("table.gssb_m > tbody > tr:first-child > td div.gspr_a").html().replace(/<b>.*?<\/b>/g, " ").trim().replace(/ /g, "+").replace(/&nbsp;/g, "+");
				}
				var linkUrl = $(this).attr("href");
				window.location = linkUrl + "&q=" + searchTerm;
				return false;
			});
		})(jQuery);
	}

	// load jQuery and execute the main function
	addJQuery(main);
}
else {
	jQuery.noConflict();
	(function($) {
		$("#gb_5").click(function() {
			var searchTerm = "";
			if ($("#gbqfq").val() !== undefined) {
				searchTerm = $("#gbqfq").val().replace(/ /g, "+");
			}
			else if ($("#brs .med em").length > 0) {
				searchTerm = $("#tbpi").attr("href").split("?q=")[1].split("&hl=")[0];
			}
			else if ($("table.gssb_m > tbody > tr:first-child > td span").length > 0) {
				searchTerm = $("table.gssb_m > tbody > tr:first-child > td span").html().split("<b>")[0].replace(/ /g, "+").replace(/&nbsp;/g, "+");
			}
			else if ($("table.gssb_m > tbody > tr:first-child > td div.gspr_a").length > 0) {
				searchTerm = $("table.gssb_m > tbody > tr:first-child > td div.gspr_a").html().replace(/<b>.*?<\/b>/g, " ").trim().replace(/ /g, "+").replace(/&nbsp;/g, "+");
			}
			var linkUrl = $(this).attr("href");
			window.location = linkUrl + "&q=" + searchTerm;
			return false;
		});
	})(jQuery);
}