// ==UserScript==
// @name        Mandiner.hu komment szűrő
// @description Egyszerű komment szűrő szkript a Mandiner.hu webhelyhez.
// @namespace   http://mandiner.hu
// @include     *://mandiner.hu/*
// @include     *://*.mandiner.hu/*
// @require     http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js
// @grant       GM_getValue
// @grant       GM_setValue
// @version     1.0.1
// ==/UserScript==

jQuery.noConflict();(function(h){var l=200;var b=0.4;var m=["Komment elrejtése","Komment megjelenítése"];var c=["Felhasználó tiltása","Felhasználó engedélyezése"];var d=["[-]","[+]"];var f=function(){return h("#header div.right a[href*=my_account]").text()};var i={Brave:["1d4279","bdc9db","e9edf3"],Butter:["b09000","ede3b3","f9f6e6"],Dust:["684c30","d6ccc3","f1eeeb"],Human:["b95300","f0ceb3","faefe6"],Noble:["53305c","cec3d1","efebf0"],Wine:["930000","e4b3b3","f6e6e6"],Wise:["49691b","cbd6bc","eef1e9"]};var n=function(p,r){var q=i[p];var o=i[r];out="";out+="div.mndnrCommentOwn div.grey { background-color: #"+q[2]+" !important; }";out+="div.mndnrCommentOwn div.grey a { color: #"+q[0]+"; }";out+="div.mndnrCommentOwn div.grey .commentlike a { background-color: #"+q[1]+" !important; color: #000; }";out+="div.mndnrCommentReply div.grey { background-color: #"+o[2]+" !important; }";out+="div.mndnrCommentReply div.grey a { color: #"+o[0]+"; }";out+="div.mndnrCommentReply div.grey .commentlike a { background-color: #"+o[1]+" !important; color: #000; }";
out+="div.mndnrShowHideWrapper { padding: 5px; text-align: center; font-weight: bold; }";return h('<style id="mndnrHeadStyle" type="text/css">'+out+"</style>")};var j=function(o){out="";for(k in i){color=i[k][0];out+='<option value="'+k+'" style="font-weight:bold;padding:2px 5px 0 5px;background-color:#'+color+';color:#fff;"';if(o==k){out+=' selected="selected"'}out+=">"+k+"</option>"}return out};var g=function(o){o=h.unique(o);out='<option value="" style="font-weight:bold;padding:2px 5px 0 5px;">- Kiválasztás -</option>';for(k in o){if(o[k]){out+='<option value="'+o[k]+'" style="font-weight:bold;padding:2px 5px 0 5px;">'+o[k]+"</option>"}}return out};var e=function(){var t=h('<div style="padding:10px;text-align:left;background-color:#fff;border:4px solid #0089B5;position:absolute;box-shadow: 0 0 5px #666;right:0;top:0;z-index:200;"></div>');var s=h('<h3 style="margin:0 0 10px 0;padding:0;">Komment beállítások</h3>');var y=h('<a href="#" style="color:#999;float:right;text-decoration:none;" title="Beállítások panel bezárása mentés nélkül">x</a>');
y.bind("click",function(E){t.show().fadeOut(l,function(){h(this).remove()});E.preventDefault()});s.append(y);t.append(s);var z=h("<table><tbody></tbody></table>");var q=function(E,F){var G=h('<tr><td style="padding:2px 15px 2px 2px;white-space:nowrap;"><label></label></td><td class="item" style="white-space:nowrap;"></td></tr>');h("label",G).text(E);h(".item",G).append(F);return G};var A=function(F){var E=h('<tr><td style="padding:2px;font-size:.8em;text-align:center;" colspan="2">'+F+"</td></tr>");return E};var B=h('<select style="padding:1px;border:1px inset #999;background-color:#ddd;">'+j(GM_getValue("mndnrMyComment","Butter"))+"</select>");z.append(q("Saját kommentjeim háttérszíne",B));z.append(A("A kiválasztott színben fognak megjelenni a saját kommentek."));var r=h('<select style="padding:1px;border:1px inset #999;background-color:#ddd;">'+j(GM_getValue("mndnrReplyComment","Wine"))+"</select>");z.append(q("Válasz kommentek háttérszíne",r));z.append(A("A kiválasztott színben fognak megjelenni a saját kommentekre érkezett válaszok."));
var v=GM_getValue("mndnrDenyList","");var x=v?JSON.parse(v):[];var D=h('<select id="mndnrDenyList" style="padding:1px;border:1px inset #999;background-color:#ddd;">'+g(x)+"</select>");var o=h('<a href="#" style="font-weight:bold;margin-left:8px;text-decoration:none;font-size:.8em;" title="Kiválasztott felhasználó eltávolítása a listáról">eltávolítás</a>');o.bind("click",function(E){var F=D.val();if(F){h('option[value="'+F+'"]',D).remove()}E.preventDefault()});D.after(o);z.append(q("Letiltott felhasználók listája",D));z.append(A("A kiválasztott letiltott felhasználó az „eltávolítás” feliratú hivatkozásra kattintva lesz törölve a listáról."));var w=h('<input maxlength="64" type="text" style="padding:3px;border:1px inset #999;background-color:#ddd;"/>');var C=h('<a href="#" style="font-weight:bold;margin-left:8px;text-decoration:none;font-size:.8em;" title="Megadott felhasználó hozzáadása a listához">hozzáadás</a>');w.after(C);z.append(q("Felhasználó letiltása",w));z.append(A("Felhasználót a tiltott listára a név megadása után a „hozzáadás” feliratú hivatkozásra kattintva lehet felvenni."));
C.bind("click",function(E){var F=w.val();if(F){if(h('option[value="'+F+'"]',D).attr("value")){alert("A felhasználó már szerepel a listán: "+F)}else{if(F==f()){alert("A saját felhasználót nem lehet felvenni a listára: "+F)}else{h("#mndnrDenyList").append('<option style="font-weight:bold;padding:2px 5px 0 5px;" value="'+F+'" selected="selected">'+F+"</option>");w.val("");alert("A felhasználó felvéve a listára: "+F)}}}E.preventDefault()});t.append(z);var u=h('<a href="#" style="text-decoration:none;font-weight:bold;font-size:1.2em;" title="Módosított bellítások mentése és panel bezárása">Mentés</a>');var p=h('<div style="padding-top:5px;text-align:center;"></div>');p.append(u);t.append(p);u.bind("click",function(F){GM_setValue("mndnrMyComment",B.val());GM_setValue("mndnrReplyComment",r.val());var E=new Array();h("option",D).each(function(){var G=h(this).val();if(G){E=h.merge(E,[G])}});E=JSON.stringify(h.unique(E));GM_setValue("mndnrDenyList",E);t.show().fadeOut(l,function(){h(this).remove()});h("head style#mndnrHeadStyle").remove();
a();F.preventDefault()});return t};h.fn.mndnrAddRemoveLink=function(){var p=h(this);var o=p.attr("rel");p.bind("click",function(s){var r=GM_getValue("mndnrDenyList","");var q=r?JSON.parse(r):[];if(p.text()==d[0]){q=h.merge(q,[o]);p.text(d[1]);p.attr("title",c[1])}else{q=jQuery.grep(q,function(t){return t!=o});p.text(d[0]);p.attr("title",c[0])}q=JSON.stringify(h.unique(q));GM_setValue("mndnrDenyList",q);a();s.preventDefault()})};var a=function(){var p=GM_getValue("mndnrMyComment","Butter");var r=GM_getValue("mndnrReplyComment","Wine");var q=GM_getValue("mndnrDenyList","");var o=q?JSON.parse(q):[];h("head").append(n(p,r));h("#comments div.comment").each(function(){var v=h(this);userName=h("div.info strong",v);replyTo=h("div.grey div.commentlike + div a",v);commentText=h("div.grey p.text",v);if(userName.text()==f()&&!v.hasClass("mndnrCommentOwn")){v.addClass("mndnrCommentOwn")}if(replyTo.text().replace("@","")==f()&&!v.hasClass("mndnrCommentReply")&&!v.hasClass("mndnrCommentOwn")){v.addClass("mndnrCommentReply")}if(userName.text()!=f()){if(userName.hasClass("mndnrAddRemoveProcessed")){var t=h("a.mndnrAddRemoveLink",v)
}else{var t=h('<a class="mndnrAddRemoveLink" style="text-decoration:none;margin-right:5px;color:#666;font-weight:bold;" href="#" rel="'+userName.text()+'"></a>');t.text(d[0]);t.attr("title",c[0]);h("div.info",v).prepend(t);userName.addClass("mndnrAddRemoveProcessed");t.mndnrAddRemoveLink()}}if(h.inArray(userName.text(),o)>-1){if(!v.hasClass("mndnrCommentDisabled")){v.addClass("mndnrCommentDisabled");t.text(d[1]);t.attr("title",c[1]);var s=h('<div class="mndnrShowHideWrapper"></div>');var u=h('<a href="#"></a>');u.data("commentDiv",v);u.text(m[1]);s.append(u);h("div.grey",v).prepend(s);v.css("opacity",b);h("div.grey div.commentlike, div.grey div.commentlike + div, div.grey div.replies, div.grey p.text",v).hide();u.bind("click",function(w){v=h(this).data("commentDiv");commentLike=h("div.grey div.commentlike",v);replyTo=h("div.grey div.commentlike + div",v);commentText=h("div.grey p.text",v);replies=h("div.grey div.replies",v);if(commentText.is(":visible")){commentLike.show().fadeOut(l);replyTo.show().fadeOut(l);
commentText.show().fadeOut(l);replies.show().fadeOut(l);u.text(m[1]);v.animate({opacity:b},l)}else{commentLike.hide().fadeIn(l);replyTo.hide().fadeIn(l);commentText.hide().fadeIn(l);replies.hide().fadeIn(l);u.text(m[0]);v.animate({opacity:1},l)}w.preventDefault()})}}else{if(v.hasClass("mndnrCommentDisabled")){v.removeClass("mndnrCommentDisabled");t.text(d[0]);t.attr("title",c[0]);h("div.mndnrShowHideWrapper",v).remove();v.css("opacity",1);h("div.grey div.commentlike, div.grey div.commentlike + div, div.grey div.replies, div.grey p.text",v).show()}}})};h(document).ready(function(){if(!f()){return}var q=h("#header div.right p");q.css({position:"relative","text-align":"right"});var p=h('<a href="#" title="Egyedi komment beállítások szerkesztése">Komment beállítások</a>');var o=h('<div style="padding-top:5px;font-weight:bold;"></div>');o.append(p);q.append(o);p.click(function(r){e().hide().appendTo(q).fadeIn(l);r.preventDefault()});a()})})(jQuery);