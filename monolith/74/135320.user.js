// ==UserScript==
// @name         War of Ninja - Forums Enhancer
// @namespace    http://userscripts.org/users/438737
// @version		 1.0
// @include      http://forums.warofninja.com/*
// @include      http://forums.warofninja.com
// @include      forums.warofninja.com/*
// @include      forums.warofninja.com
// @include      http://www.warofninja.com/private-messages/send*
// @include      www.warofninja.com/private-messages/send*
// @author       Sand_Spirit
// @description  Enables some new features for WoN forums.
// ==/UserScript==
//
// 
// CHANGE LOG:
// 
// version 1.0
//
// 1. Preview option is enabled on forums and on private messages page.
// 2. 'cancel' button on send PM page is replaced with 'clear PM' button which clears the textarea content instead of going to PM page.
// 3. Avatars are zoomed-in on double click.
// 4. Live updates are enabled for all users of this script.
//

var gm_win = (function(){var a;try {a = unsafeWindow === window ? false : unsafeWindow;} finally {return a || (function(){var e = document.createElement('p');e.setAttribute('onclick', 'return window;');return e.onclick();}());}}());gm_win.$(document).ajaxSuccess(function(e, xhr) {rerunsOnAction();});function rerunsOnAction() {function addJQuery(callback) {  var script = document.createElement("script");  script.setAttribute("src", "http://code.jquery.com/jquery-latest.js");script.addEventListener('load', function() {    var script = document.createElement("script");script.textContent = "(" + callback.toString() + ")();";document.body.appendChild(script);}, false);document.body.appendChild(script);}var plugin = document.createElement('script');plugin.src = 'http://sandspirit.netii.net/warofninja/userscripts/CookieReadWrite.js';plugin.type = 'text/javascript';document.getElementsByTagName('head')[0].appendChild(plugin);var BB2htmlScript = document.createElement("script");BB2htmlScript.src = 'http://sandspirit.netii.net/warofninja/userscripts/Enhancer/bb_converter.js';BB2htmlScript.type = 'text/javascript';document.head.appendChild(BB2htmlScript);var ReplaceScript = document.createElement("script");ReplaceScript.src = 'http://sandspirit.netii.net/warofninja/userscripts/Enhancer/replace.js';ReplaceScript.type = 'text/javascript';document.head.appendChild(ReplaceScript);function main(){jQuery.noConflict();$.cookie('us_enhancer_v', '1', { expires: 777777, path: '/', domain: 'warofninja.com' });var assets = Math.floor(Math.random()*8);var split_path = window.location.href.split("/");if ($('#previewPM').length == '0' && split_path[4] == 'send'){$('<a class="button" href="#" style="margin-left:130px" id="previewPM">Preview Message</a>').insertAfter('#messageSend form input[type="submit"]');$('<article id="zzzArticle" style="display:none;"><div class="text" id="zzzMessage"></div></article>').insertAfter('#messageSend form');$('#zzzMessage').css('margin-top',"-10px");$('#messageSend a[href="/private-messages"]').html('Clear Message').attr('id','clearPM').attr('href','#');}$('#previewPM').click(function(){if ($('#zzzArticle').css('display') == 'none' && $('#input').val() !== ''){	$('#zzzArticle').slideDown('slow');	$('#zzzMessage').css('padding-top','15px');}var textarea = $('textarea.bbcode');textarea.attr('id','input');var postdiv = document.getElementById("zzzPost");document.getElementById("zzzMessage").innerHTML = bb_converter.filter(document.getElementById("input").value);document.getElementById('zzzMessage').innerHTML = replaceNewLine(document.getElementById('zzzMessage').innerHTML);ReplaceEmoticons2();	$('#zzzMessage').html($('#zzzMessage').html().split('[i]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[/i]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[u]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[/u]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[b]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[/b]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[url=]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[/url]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[spoiler]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[/spoiler]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[quote]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[/quote]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[img]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[/img]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[center]').join(''));$('#zzzMessage').html($('#zzzMessage').html().split('[/center]').join(''));});$('#clearPM').click(function(){$('#input').focus();$('#input').val('');$('#zzzArticle').slideUp('slow');});if ($('[zzz="previewPost"]').length == '0' && split_path[4]!=='newtopic' && split_path[6] !== 'edittopic'){$('<a class="button submitButton" autocomplete="off" style="margin-left:30px;margin-top:10px;float:left" zzz="previewPost" href="#">Preview</a>').insertBefore('[type="reset"]:last');$('input.submitButton:first').css("margin-left","20px");$('input.clearButton').css("margin-left","30px");if (split_path[4]!=='newtopic'){$('<div class="forumHeader" style="display:none;margin-top:15px;" zzz="header"><img src="http://img717.imageshack.us/img717/4120/searchforum.png" alt="" style="height:18px;width:18px">&nbsp;<span>Post Preview</span></div><div class="forumPostContainer" zzz="postcontainer" style="height: auto; display:none"><div class="poster"></div><div class="post" style="height: auto; " zzz="post" id="zzzPost"></div></div><div class="forumContainer topicFooter" style="display:none" zzz="footer"></div>').insertAfter($('div.forumContainer.topicFooter:last'));}}$('[zzz="previewPost"]').click(function(){if ($('[zzz="postcontainer"]').css('display') == 'none' && $('textarea.bbcode').val() !== '' ){$('[zzz="header"]').slideDown("slow");$('[zzz="postcontainer"]').slideDown("slow");$('[zzz="footer"]').slideDown("slow");}var textarea = $('textarea.bbcode');textarea.attr("id","input");var postdiv = document.getElementById("zzzPost");document.getElementById("zzzPost").innerHTML = bb_converter.filter(document.getElementById("input").value);function replaceNewLine(myString){var newline = /\r\n|\r|\n/g;var br = '<br />';return myString.replace(newline, br);}function TransferNewLine(){document.getElementById('zzzPost').innerHTML = replaceNewLine(document.getElementById('zzzPost').innerHTML);}TransferNewLine();ReplaceEmoticons();$('#zzzPost').html($('#zzzPost').html().split('[i]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[/i]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[u]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[/u]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[b]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[/b]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[url=]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[/url]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[spoiler]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[/spoiler]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[quote]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[/quote]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[img]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[/img]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[center]').join(''));$('#zzzPost').html($('#zzzPost').html().split('[/center]').join(''));var txt = textarea.val();});$('[type="reset"]').click(function(){$('#input').focus();$('textarea').val("");$('[zzz="header"]').slideUp("slow");$('[zzz="postcontainer"]').slideUp("slow");$('[zzz="footer"]').slideUp("slow");$('div.postNumber:last').html('0/15');$('div.postNumber:last').css('margin-right',$('div.postNumber:last').html().length*3+'px');});var textarea = $('textarea.bbcode');textarea.attr("id","input");if ($('#input').length == '1' && $('[zzz="charcounter"]').length == '0'){$('<div class="postNumber" zzz="charcounter">0/15</div>').insertAfter('div.postedOn:last');$('[zzz="charcounter"]').css('margin-right',$('[zzz="charcounter"]').html().length*3+'px');var cchar;var maxchar;cchar = textarea.val().length;maxchar = '15';$('[zzz="charcounter"]').html(cchar + '/' + maxchar);}$('input.forumButton').click(function(){counter();});$('div.bbcode img').click(function(){counter();});$('#input').keydown(function(){ counter();});$('#input').keyup(function(){ counter();});$('#input').focus(function(){counter();});function counter(){var cchar;var maxchar;cchar = textarea.val().length;if (cchar >= '15'){maxchar = '20000';$('[zzz="charcounter"]').css('margin-right',$('[zzz="charcounter"]').html().length*3+'px');}else if (cchar < '15'){maxchar = '15';$('[zzz="charcounter"]').css('margin-right',$('[zzz="charcounter"]').html().length*3+'px');	}$('[zzz="charcounter"]').html(cchar + '/' + maxchar);}$("div.poster img").dblclick(function(){$(this).animate({width:150,height:150},'1000');});$("div.poster img").mouseout(function(){$(this).animate({width:75,height:75},'1000');});}addJQuery(main);}rerunsOnAction();