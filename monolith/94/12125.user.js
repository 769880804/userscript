// ==UserScript==
// @name          TribalWars Navigation Toolbar v0.7
// @namespace     http://diveintogreasemonkey.org/download/
// @description   (Much needed) TribalWars interface improvements. dutch version
// @include       http://*.tribalwars.nl/game.php*
// ==/UserScript==

/*
 * jQuery 1.1.1 (jquery.com)
 * Copyright (c) 2006 John Resig
 * Licensed under the MIT License:
 *   http://www.opensource.org/licenses/mit-license.php
 * Edited for greasemonkey -- sunsean
 * translatet by geert
 */
eval(function(p,a,c,k,e,d){e=function(c){return(c<a?"":e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('l(1v 1z.6=="Q"){1z.Q=1z.Q;u 6=k(a,c){l(1z==7)q 1i 6(a,c);a=a||1a;l(6.1o(a))q 1i 6(1a)[6.C.35?"35":"2Z"](a);l(1v a=="1Y"){u m=/^[^<]*(<(.|\\n)+>)[^>]*$/.2v(a);l(m)a=6.3O([m[1]]);H q 1i 6(c).2g(a)}q 7.4G(a.1f==2r&&a||(a.3v||a.G&&a!=1z&&!a.1W&&a[0]!=Q&&a[0].1W)&&6.3A(a)||[a])};l(1v $!="Q")6.2J$=$;u $=6;6.C=6.8d={3v:"1.1.1",8j:k(){q 7.G},G:0,2c:k(1M){q 1M==Q?6.3A(7):7[1M]},2e:k(a){u J=6(7);J.5Q=7;q J.4G(a)},4G:k(a){7.G=0;[].1g.W(7,a);q 7},I:k(C,1u){q 6.I(7,C,1u)},27:k(17){u 4P=-1;7.I(k(i){l(7==17)4P=i});q 4P},1F:k(1U,P,v){u 17=1U;l(1U.1f==3g)l(P==Q)q 7.G&&6[v||"1F"](7[0],1U)||Q;H{17={};17[1U]=P}q 7.I(k(27){N(u F 1B 17)6.1F(v?7.1m:7,F,6.F(7,17[F],v,27,F))})},1h:k(1U,P){q 7.1F(1U,P,"34")},2z:k(e){l(1v e=="1Y")q 7.3d().3l(1a.80(e));u t="";6.I(e||7,k(){6.I(7.31,k(){l(7.1W!=8)t+=7.1W!=1?7.53:6.C.2z([7])})});q t},2y:k(){u a=6.3O(1q);q 7.I(k(){u b=a[0].3S(T);7.U.2Q(b,7);20(b.16)b=b.16;b.4t(7)})},3l:k(){q 7.33(1q,T,1,k(a){7.4t(a)})},59:k(){q 7.33(1q,T,-1,k(a){7.2Q(a,7.16)})},5a:k(){q 7.33(1q,10,1,k(a){7.U.2Q(a,7)})},5b:k(){q 7.33(1q,10,-1,k(a){7.U.2Q(a,7.28)})},4C:k(){q 7.5Q||6([])},2g:k(t){q 7.2e(6.2K(7,k(a){q 6.2g(t,a)}))},4p:k(4D){q 7.2e(6.2K(7,k(a){q a.3S(4D!=Q?4D:T)}))},1x:k(t){q 7.2e(6.1o(t)&&6.2l(7,k(2H,27){q t.W(2H,[27])})||6.3y(t,7))},26:k(t){q 7.2e(t.1f==3g&&6.3y(t,7,T)||6.2l(7,k(a){l(t.1f==2r||t.3v)q 6.3z(t,a)<0;H q a!=t}))},1N:k(t){q 7.2e(6.2m(7.2c(),t.1f==3g?6(t).2c():t.G!=Q&&!t.1p?t:[t]))},4S:k(1k){q 1k?6.1x(1k,7).r.G>0:10},15:k(15){q 15==Q?(7.G?7[0].P:1d):7.1F("P",15)},4M:k(15){q 15==Q?(7.G?7[0].2t:1d):7.3d().3l(15)},33:k(1u,1O,3x,C){u 4p=7.G>1;u a=6.3O(1u);l(3x<0)a.8p();q 7.I(k(){u 17=7;l(1O&&6.1p(7,"1O")&&6.1p(a[0],"3Q"))17=7.5B("1Z")[0]||7.4t(1a.62("1Z"));6.I(a,k(){C.W(17,[4p?7.3S(T):7])})})}};6.1w=6.C.1w=k(){u 1P=1q[0],a=1;l(1q.G==1){1P=7;a=0}u F;20(F=1q[a++])N(u i 1B F)1P[i]=F[i];q 1P};6.1w({8s:k(){l(6.2J$)$=6.2J$;q 6},1o:k(C){q!!C&&1v C!="1Y"&&1v C[0]=="Q"&&/k/i.1r(C+"")},1p:k(B,Y){q B.1p&&B.1p.3w()==Y.3w()},I:k(17,C,1u){l(17.G==Q)N(u i 1B 17)C.W(17[i],1u||[i,17[i]]);H N(u i=0,6e=17.G;i<6e;i++)l(C.W(17[i],1u||[i,17[i]])===10)4q;q 17},F:k(B,P,v,27,F){l(6.1o(P))q P.3X(B,[27]);u 6h=/z-?27|8u-?8v|19|5X|8w-?21/i;l(P.1f==3G&&v=="34"&&!6h.1r(F))q P+"4a";q P},12:{1N:k(B,c){6.I(c.3m(/\\s+/),k(i,M){l(!6.12.2M(B.12,M))B.12+=(B.12?" ":"")+M})},2a:k(B,c){B.12=c?6.2l(B.12.3m(/\\s+/),k(M){q!6.12.2M(c,M)}).6g(" "):""},2M:k(t,c){t=t.12||t;q t&&1i 4n("(^|\\\\s)"+c+"(\\\\s|$)").1r(t)}},40:k(e,o,f){N(u i 1B o){e.1m["1H"+i]=e.1m[i];e.1m[i]=o[i]}f.W(e,[]);N(u i 1B o)e.1m[i]=e.1m["1H"+i]},1h:k(e,p){l(p=="21"||p=="39"){u 1H={},3W,3a,d=["7C","6j","6k","6l"];6.I(d,k(){1H["6m"+7]=0;1H["6n"+7+"6o"]=0});6.40(e,1H,k(){l(6.1h(e,"1c")!="1X"){3W=e.6z;3a=e.6p}H{e=6(e.3S(T)).2g(":47").5d("2R").4C().1h({4e:"1A",3U:"6q",1c:"2n",7v:"0",6r:"0"}).5e(e.U)[0];u 36=6.1h(e.U,"3U");l(36==""||36=="4R")e.U.1m.3U="6s";3W=e.6t;3a=e.6v;l(36==""||36=="4R")e.U.1m.3U="4R";e.U.3j(e)}});q p=="21"?3W:3a}q 6.34(e,p)},34:k(B,F,4X){u J;l(F=="19"&&6.14.1t)q 6.1F(B.1m,"19");l(F=="4H"||F=="2C")F=6.14.1t?"3H":"2C";l(!4X&&B.1m[F])J=B.1m[F];H l(1a.3R&&1a.3R.41){l(F=="2C"||F=="3H")F="4H";F=F.1V(/([A-Z])/g,"-$1").4Q();u M=1a.3R.41(B,1d);l(M)J=M.4Z(F);H l(F=="1c")J="1X";H 6.40(B,{1c:"2n"},k(){u c=1a.3R.41(7,"");J=c&&c.4Z(F)||""})}H l(B.43){u 50=F.1V(/\\-(\\w)/g,k(m,c){q c.3w()});J=B.43[F]||B.43[50]}q J},3O:k(a){u r=[];6.I(a,k(i,1J){l(!1J)q;l(1J.1f==3G)1J=1J.6A();l(1v 1J=="1Y"){u s=6.2X(1J),1S=1a.62("1S"),2d=[];u 2y=!s.11("<1j")&&[1,"<3J>","</3J>"]||(!s.11("<6B")||!s.11("<1Z")||!s.11("<89"))&&[1,"<1O>","</1O>"]||!s.11("<3Q")&&[2,"<1O><1Z>","</1Z></1O>"]||(!s.11("<88")||!s.11("<6E"))&&[3,"<1O><1Z><3Q>","</3Q></1Z></1O>"]||[0,"",""];1S.2t=2y[1]+s+2y[2];20(2y[0]--)1S=1S.16;l(6.14.1t){l(!s.11("<1O")&&s.11("<1Z")<0)2d=1S.16&&1S.16.31;H l(2y[1]=="<1O>"&&s.11("<1Z")<0)2d=1S.31;N(u n=2d.G-1;n>=0;--n)l(6.1p(2d[n],"1Z")&&!2d[n].31.G)2d[n].U.3j(2d[n])}1J=1S.31}l(1J.G===0)q;l(1J[0]==Q)r.1g(1J);H r=6.2m(r,1J)});q r},1F:k(B,Y,P){u 2j={"N":"6I","6J":"12","4H":6.14.1t?"3H":"2C",2C:6.14.1t?"3H":"2C",2t:"2t",12:"12",P:"P",2T:"2T",2R:"2R",6L:"7T",2O:"2O"};l(Y=="19"&&6.14.1t&&P!=Q){B.5X=1;q B.1x=B.1x.1V(/4z\\([^\\)]*\\)/6O,"")+(P==1?"":"4z(19="+P*5R+")")}H l(Y=="19"&&6.14.1t)q B.1x?48(B.1x.6P(/4z\\(19=(.*)\\)/)[1])/5R:1;l(Y=="19"&&6.14.3M&&P==1)P=0.7N;l(2j[Y]){l(P!=Q)B[2j[Y]]=P;q B[2j[Y]]}H l(P==Q&&6.14.1t&&6.1p(B,"6d")&&(Y=="7M"||Y=="6U"))q B.6V(Y).53;H l(B.6W){l(P!=Q)B.7H(Y,P);q B.3V(Y)}H{Y=Y.1V(/-([a-z])/6Y,k(z,b){q b.3w()});l(P!=Q)B[Y]=P;q B[Y]}},2X:k(t){q t.1V(/^\\s+|\\s+$/g,"")},3A:k(a){u r=[];l(a.1f!=2r)N(u i=0,2F=a.G;i<2F;i++)r.1g(a[i]);H r=a.3E(0);q r},3z:k(b,a){N(u i=0,2F=a.G;i<2F;i++)l(a[i]==b)q i;q-1},2m:k(2q,3u){u r=[].3E.3X(2q,0);N(u i=0,56=3u.G;i<56;i++)l(6.3z(3u[i],r)==-1)2q.1g(3u[i]);q 2q},2l:k(1L,C,49){l(1v C=="1Y")C=1i 45("a","i","q "+C);u 1b=[];N(u i=0,2H=1L.G;i<2H;i++)l(!49&&C(1L[i],i)||49&&!C(1L[i],i))1b.1g(1L[i]);q 1b},2K:k(1L,C){l(1v C=="1Y")C=1i 45("a","q "+C);u 1b=[],r=[];N(u i=0,2H=1L.G;i<2H;i++){u 15=C(1L[i],i);l(15!==1d&&15!=Q){l(15.1f!=2r)15=[15];1b=1b.70(15)}}u r=1b.G?[1b[0]]:[];57:N(u i=1,5z=1b.G;i<5z;i++){N(u j=0;j<i;j++)l(1b[i]==r[j])5x 57;r.1g(1b[i])}q r}});1i k(){u b=7x.72.4Q();6.14={32:/5p/.1r(b),3N:/3N/.1r(b),1t:/1t/.1r(b)&&!/3N/.1r(b),3M:/3M/.1r(b)&&!/(74|5p)/.1r(b)};6.75=!6.14.1t||1a.76=="7r"};6.I({5m:"a.U",4F:"6.4F(a)",78:"6.23(a,2,\'28\')",79:"6.23(a,2,\'5k\')",7a:"6.2x(a.U.16,a)",7b:"6.2x(a.16)"},k(i,n){6.C[i]=k(a){u J=6.2K(7,n);l(a&&1v a=="1Y")J=6.3y(a,J);q 7.2e(J)}});6.I({5e:"3l",7e:"59",2Q:"5a",7f:"5b"},k(i,n){6.C[i]=k(){u a=1q;q 7.I(k(){N(u j=0,2F=a.G;j<2F;j++)6(a[j])[n](7)})}});6.I({5d:k(1U){6.1F(7,1U,"");7.7h(1U)},7i:k(c){6.12.1N(7,c)},7j:k(c){6.12.2a(7,c)},7l:k(c){6.12[6.12.2M(7,c)?"2a":"1N"](7,c)},2a:k(a){l(!a||6.1x(a,[7]).r.G)7.U.3j(7)},3d:k(){20(7.16)7.3j(7.16)}},k(i,n){6.C[i]=k(){q 7.I(n,1q)}});6.I(["5h","55","5g","5n"],k(i,n){6.C[n]=k(1M,C){q 7.1x(":"+n+"("+1M+")",C)}});6.I(["21","39"],k(i,n){6.C[n]=k(h){q h==Q?(7.G?6.1h(7[0],n):1d):7.1h(n,h.1f==3g?h:h+"4a")}});6.1w({1k:{"":"m[2]==\'*\'||6.1p(a,m[2])","#":"a.3V(\'4K\')==m[2]",":":{55:"i<m[3]-0",5g:"i>m[3]-0",23:"m[3]-0==i",5h:"m[3]-0==i",2q:"i==0",2P:"i==r.G-1",5K:"i%2==0",5L:"i%2","23-3n":"6.23(a.U.16,m[3],\'28\',a)==a","2q-3n":"6.23(a.U.16,1,\'28\')==a","2P-3n":"6.23(a.U.7n,1,\'5k\')==a","7o-3n":"6.2x(a.U.16).G==1",5m:"a.16",3d:"!a.16",5n:"6.C.2z.W([a]).11(m[3])>=0",37:\'a.v!="1A"&&6.1h(a,"1c")!="1X"&&6.1h(a,"4e")!="1A"\',1A:\'a.v=="1A"||6.1h(a,"1c")=="1X"||6.1h(a,"4e")=="1A"\',7s:"!a.2T",2T:"a.2T",2R:"a.2R",2O:"a.2O||6.1F(a,\'2O\')",2z:"a.v==\'2z\'",47:"a.v==\'47\'",5q:"a.v==\'5q\'",4T:"a.v==\'4T\'",52:"a.v==\'52\'",4E:"a.v==\'4E\'",5r:"a.v==\'5r\'",5t:"a.v==\'5t\'",3o:\'a.v=="3o"||6.1p(a,"3o")\',5u:"/5u|3J|7u|3o/i.1r(a.1p)"},".":"6.12.2M(a,m[2])","@":{"=":"z==m[4]","!=":"z!=m[4]","^=":"z&&!z.11(m[4])","$=":"z&&z.2L(z.G - m[4].G,m[4].G)==m[4]","*=":"z&&z.11(m[4])>=0","":"z",4m:k(m){q["",m[1],m[3],m[2],m[5]]},5E:"z=a[m[3]]||6.1F(a,m[3]);"},"[":"6.2g(m[2],a).G"},5D:[/^\\[ *(@)([a-2f-3r-]*) *([!*$^=]*) *(\'?"?)(.*?)\\4 *\\]/i,/^(\\[)\\s*(.*?(\\[.*?\\])?[^[]*?)\\s*\\]/,/^(:)([a-2f-3r-]*)\\("?\'?(.*?(\\(.*?\\))?[^(]*?)"?\'?\\)/i,/^([:.#]*)([a-2f-3r*-]*)/i],1Q:[/^(\\/?\\.\\.)/,"a.U",/^(>|\\/)/,"6.2x(a.16)",/^(\\+)/,"6.23(a,2,\'28\')",/^(~)/,k(a){u s=6.2x(a.U.16);q s.3E(0,6.3z(a,s))}],3y:k(1k,1L,26){u 1H,M=[];20(1k&&1k!=1H){1H=1k;u f=6.1x(1k,1L,26);1k=f.t.1V(/^\\s*,\\s*/,"");M=26?1L=f.r:6.2m(M,f.r)}q M},2g:k(t,1y){l(1v t!="1Y")q[t];l(1y&&!1y.1W)1y=1d;1y=1y||1a;l(!t.11("//")){1y=1y.4g;t=t.2L(2,t.G)}H l(!t.11("/")){1y=1y.4g;t=t.2L(1,t.G);l(t.11("/")>=1)t=t.2L(t.11("/"),t.G)}u J=[1y],2b=[],2P=1d;20(t&&2P!=t){u r=[];2P=t;t=6.2X(t).1V(/^\\/\\//i,"");u 3q=10;u 1D=/^[\\/>]\\s*([a-2f-9*-]+)/i;u m=1D.2v(t);l(m){6.I(J,k(){N(u c=7.16;c;c=c.28)l(c.1W==1&&(6.1p(c,m[1])||m[1]=="*"))r.1g(c)});J=r;t=t.1V(1D,"");l(t.11(" ")==0)5x;3q=T}H{N(u i=0;i<6.1Q.G;i+=2){u 1D=6.1Q[i];u m=1D.2v(t);l(m){r=J=6.2K(J,6.1o(6.1Q[i+1])?6.1Q[i+1]:k(a){q 3D(6.1Q[i+1])});t=6.2X(t.1V(1D,""));3q=T;4q}}}l(t&&!3q){l(!t.11(",")){l(J[0]==1y)J.4u();6.2m(2b,J);r=J=[1y];t=" "+t.2L(1,t.G)}H{u 2W=/^([a-2f-3r-]+)(#)([a-2f-9\\\\*2J-]*)/i;u m=2W.2v(t);l(m){m=[0,m[2],m[3],m[1]]}H{2W=/^([#.]?)([a-2f-9\\\\*2J-]*)/i;m=2W.2v(t)}l(m[1]=="#"&&J[J.G-1].5y){u 3s=J[J.G-1].5y(m[2]);J=r=3s&&(!m[3]||6.1p(3s,m[3]))?[3s]:[]}H{l(m[1]==".")u 3Y=1i 4n("(^|\\\\s)"+m[2]+"(\\\\s|$)");6.I(J,k(){u 38=m[1]!=""||m[0]==""?"*":m[2];l(6.1p(7,"7z")&&38=="*")38="2V";6.2m(r,m[1]!=""&&J.G!=1?6.4r(7,[],m[1],m[2],3Y):7.5B(38))});l(m[1]=="."&&J.G==1)r=6.2l(r,k(e){q 3Y.1r(e.12)});l(m[1]=="#"&&J.G==1){u 5C=r;r=[];6.I(5C,k(){l(7.3V("4K")==m[2]){r=[7];q 10}})}J=r}t=t.1V(2W,"")}}l(t){u 15=6.1x(t,r);J=r=15.r;t=6.2X(15.t)}}l(J&&J[0]==1y)J.4u();6.2m(2b,J);q 2b},1x:k(t,r,26){20(t&&/^[a-z[({<*:.#]/i.1r(t)){u p=6.5D,m;6.I(p,k(i,1D){m=1D.2v(t);l(m){t=t.7A(m[0].G);l(6.1k[m[1]].4m)m=6.1k[m[1]].4m(m);q 10}});l(m[1]==":"&&m[2]=="26")r=6.1x(m[3],r,T).r;H l(m[1]=="."){u 1D=1i 4n("(^|\\\\s)"+m[2]+"(\\\\s|$)");r=6.2l(r,k(e){q 1D.1r(e.12||"")},26)}H{u f=6.1k[m[1]];l(1v f!="1Y")f=6.1k[m[1]][m[2]];3D("f = k(a,i){"+(6.1k[m[1]].5E||"")+"q "+f+"}");r=6.2l(r,f,26)}}q{r:r,t:t}},4r:k(o,r,1Q,Y,1D){N(u s=o.16;s;s=s.28)l(s.1W==1){u 1N=T;l(1Q==".")1N=s.12&&1D.1r(s.12);H l(1Q=="#")1N=s.3V("4K")==Y;l(1N)r.1g(s);l(1Q=="#"&&r.G)4q;l(s.16)6.4r(s,r,1Q,Y,1D)}q r},4F:k(B){u 4s=[];u M=B.U;20(M&&M!=1a){4s.1g(M);M=M.U}q 4s},23:k(M,1b,3x,B){1b=1b||1;u 1M=0;N(;M;M=M[3x]){l(M.1W==1)1M++;l(1M==1b||1b=="5K"&&1M%2==0&&1M>1&&M==B||1b=="5L"&&1M%2==1&&M==B)q M}},2x:k(n,B){u r=[];N(;n;n=n.28){l(n.1W==1&&(!B||n!=B))r.1g(n)}q r}});6.E={1N:k(R,v,1n,D){l(6.14.1t&&R.5l!=Q)R=1z;l(D)1n.D=D;l(!1n.2i)1n.2i=7.2i++;l(!R.1I)R.1I={};u 30=R.1I[v];l(!30){30=R.1I[v]={};l(R["3B"+v])30[0]=R["3B"+v]}30[1n.2i]=1n;R["3B"+v]=7.5M;l(!7.1e[v])7.1e[v]=[];7.1e[v].1g(R)},2i:1,1e:{},2a:k(R,v,1n){l(R.1I)l(v&&v.v)4v R.1I[v.v][v.1n.2i];H l(v&&R.1I[v])l(1n)4v R.1I[v][1n.2i];H N(u i 1B R.1I[v])4v R.1I[v][i];H N(u j 1B R.1I)7.2a(R,j)},1K:k(v,D,R){D=6.3A(D||[]);l(!R)6.I(7.1e[v]||[],k(){6.E.1K(v,D,7)});H{u 1n=R["3B"+v],15,C=6.1o(R[v]);l(1n){D.5N(7.2j({v:v,1P:R}));l((15=1n.W(R,D))!==10)7.4y=T}l(C&&15!==10)R[v]();7.4y=10}},5M:k(E){l(1v 6=="Q"||6.E.4y)q;E=6.E.2j(E||1z.E||{});u 3i;u c=7.1I[E.v];u 1u=[].3E.3X(1q,1);1u.5N(E);N(u j 1B c){1u[0].1n=c[j];1u[0].D=c[j].D;l(c[j].W(7,1u)===10){E.2k();E.2B();3i=10}}l(6.14.1t)E.1P=E.2k=E.2B=E.1n=E.D=1d;q 3i},2j:k(E){l(!E.1P&&E.5P)E.1P=E.5P;l(E.5S==Q&&E.5T!=Q){u e=1a.4g,b=1a.7L;E.5S=E.5T+(e.5V||b.5V);E.7O=E.7Q+(e.5Z||b.5Z)}l(6.14.32&&E.1P.1W==3){u 2S=E;E=6.1w({},2S);E.1P=2S.1P.U;E.2k=k(){q 2S.2k()};E.2B=k(){q 2S.2B()}}l(!E.2k)E.2k=k(){7.3i=10};l(!E.2B)E.2B=k(){7.7U=T};q E}};6.C.1w({3K:k(v,D,C){q 7.I(k(){6.E.1N(7,v,C||D,D)})},6f:k(v,D,C){q 7.I(k(){6.E.1N(7,v,k(E){6(7).60(E);q(C||D).W(7,1q)},D)})},60:k(v,C){q 7.I(k(){6.E.2a(7,v,C)})},1K:k(v,D){q 7.I(k(){6.E.1K(v,D,7)})},3P:k(){u a=1q;q 7.66(k(e){7.4J=7.4J==0?1:0;e.2k();q a[7.4J].W(7,[e])||10})},7V:k(f,g){k 4L(e){u p=(e.v=="3T"?e.7W:e.7X)||e.7Y;20(p&&p!=7)2G{p=p.U}2p(e){p=7};l(p==7)q 10;q(e.v=="3T"?f:g).W(7,[e])}q 7.3T(4L).6b(4L)},35:k(f){l(6.3L)f.W(1a,[6]);H{6.2N.1g(k(){q f.W(7,[6])})}q 7}});6.1w({3L:10,2N:[],35:k(){l(!6.3L){6.3L=T;l(6.2N){6.I(6.2N,k(){7.W(1a)});6.2N=1d}l(6.14.3M||6.14.3N)1a.83("84",6.35,10)}}});1i k(){6.I(("85,86,2Z,87,8b,4i,66,8e,"+"8f,8g,8h,3T,6b,8k,3J,"+"4E,8n,8q,8r,2D").3m(","),k(i,o){6.C[o]=k(f){q f?7.3K(o,f):7.1K(o)}})};l(6.14.1t)6(1z).6f("4i",k(){u 1e=6.E.1e;N(u v 1B 1e){u 4c=1e[v],i=4c.G;l(i&&v!=\'4i\')8x 6.E.2a(4c[i-1],v);20(--i)}});6.C.1w({1G:k(O,K){u 1A=7.1x(":1A");O?1A.24({21:"1G",39:"1G",19:"1G"},O,K):1A.I(k(){7.1m.1c=7.2I?7.2I:"";l(6.1h(7,"1c")=="1X")7.1m.1c="2n"});q 7},1E:k(O,K){u 37=7.1x(":37");O?37.24({21:"1E",39:"1E",19:"1E"},O,K):37.I(k(){7.2I=7.2I||6.1h(7,"1c");l(7.2I=="1X")7.2I="2n";7.1m.1c="1X"});q 7},4W:6.C.3P,3P:k(C,3Z){u 1u=1q;q 6.1o(C)&&6.1o(3Z)?7.4W(C,3Z):7.I(k(){6(7)[6(7).4S(":1A")?"1G":"1E"].W(6(7),1u)})},6w:k(O,K){q 7.24({21:"1G"},O,K)},6x:k(O,K){q 7.24({21:"1E"},O,K)},6y:k(O,K){q 7.I(k(){u 67=6(7).4S(":1A")?"1G":"1E";6(7).24({21:67},O,K)})},6C:k(O,K){q 7.24({19:"1G"},O,K)},6D:k(O,K){q 7.24({19:"1E"},O,K)},6F:k(O,3h,K){q 7.24({19:3h},O,K)},24:k(F,O,1l,K){q 7.1C(k(){7.2u=6.1w({},F);u 1j=6.O(O,1l,K);N(u p 1B F){u e=1i 6.2U(7,1j,p);l(F[p].1f==3G)e.2o(e.M(),F[p]);H e[F[p]](F)}})},1C:k(v,C){l(!C){C=v;v="2U"}q 7.I(k(){l(!7.1C)7.1C={};l(!7.1C[v])7.1C[v]=[];7.1C[v].1g(C);l(7.1C[v].G==1)C.W(7)})}});6.1w({O:k(O,1l,C){u 1j=O&&O.1f==6H?O:{29:C||!C&&1l||6.1o(O)&&O,25:O,1l:C&&1l||1l&&1l.1f!=45&&1l};1j.25=(1j.25&&1j.25.1f==3G?1j.25:{6N:6Q,6R:4U}[1j.25])||6S;1j.1H=1j.29;1j.29=k(){6.5H(7,"2U");l(6.1o(1j.1H))1j.1H.W(7)};q 1j},1l:{},1C:{},5H:k(B,v){v=v||"2U";l(B.1C&&B.1C[v]){B.1C[v].4u();u f=B.1C[v][0];l(f)f.W(B)}},2U:k(B,18,F){u z=7;u y=B.1m;u 4f=6.1h(B,"1c");y.1c="2n";y.5o="1A";z.a=k(){l(18.3e)18.3e.W(B,[z.2h]);l(F=="19")6.1F(y,"19",z.2h);H l(6i(z.2h))y[F]=6i(z.2h)+"4a"};z.58=k(){q 48(6.1h(B,F))};z.M=k(){u r=48(6.34(B,F));q r&&r>-7c?r:z.58()};z.2o=k(4b,3h){z.4l=(1i 5i()).5j();z.2h=4b;z.a();z.46=5l(k(){z.3e(4b,3h)},13)};z.1G=k(){l(!B.1s)B.1s={};B.1s[F]=7.M();18.1G=T;z.2o(0,B.1s[F]);l(F!="19")y[F]="5f"};z.1E=k(){l(!B.1s)B.1s={};B.1s[F]=7.M();18.1E=T;z.2o(B.1s[F],0)};z.3P=k(){l(!B.1s)B.1s={};B.1s[F]=7.M();l(4f=="1X"){18.1G=T;l(F!="19")y[F]="5f";z.2o(0,B.1s[F])}H{18.1E=T;z.2o(B.1s[F],0)}};z.3e=k(2Y,3F){u t=(1i 5i()).5j();l(t>18.25+z.4l){7p(z.46);z.46=1d;z.2h=3F;z.a();l(B.2u)B.2u[F]=T;u 2b=T;N(u i 1B B.2u)l(B.2u[i]!==T)2b=10;l(2b){y.5o="";y.1c=4f;l(6.1h(B,"1c")=="1X")y.1c="2n";l(18.1E)y.1c="1X";l(18.1E||18.1G)N(u p 1B B.2u)l(p=="19")6.1F(y,p,B.1s[p]);H y[p]=""}l(2b&&6.1o(18.29))18.29.W(B)}H{u n=t-7.4l;u p=n/18.25;z.2h=18.1l&&6.1l[18.1l]?6.1l[18.1l](p,n,2Y,(3F-2Y),18.25):((-5F.7B(p*5F.7D)/2)+0.5)*(3F-2Y)+2Y;z.a()}}}});6.C.1w({7F:k(S,1T,K){7.2Z(S,1T,K,1)},2Z:k(S,1T,K,1R){l(6.1o(S))q 7.3K("2Z",S);K=K||k(){};u v="6a";l(1T)l(6.1o(1T)){K=1T;1T=1d}H{1T=6.2V(1T);v="63"}u 4w=7;6.3p({S:S,v:v,D:1T,1R:1R,29:k(2w,V){l(V=="2E"||!1R&&V=="5A")4w.1F("2t",2w.3C).4O().I(K,[2w.3C,V,2w]);H K.W(4w,[2w.3C,V,2w])}});q 7},7I:k(){q 6.2V(7)},4O:k(){q 7.2g("4A").I(k(){l(7.5O)6.61(7.5O);H 6.42(7.2z||7.7K||7.2t||"")}).4C()}});l(!1z.3k)3k=k(){q 1i 7P("7R.7S")};6.I("64,5J,5I,65,5G,5v".3m(","),k(i,o){6.C[o]=k(f){q 7.3K(o,f)}});6.1w({2c:k(S,D,K,v,1R){l(6.1o(D)){K=D;D=1d}q 6.3p({S:S,D:D,2E:K,4o:v,1R:1R})},7Z:k(S,D,K,v){q 6.2c(S,D,K,v,1)},61:k(S,K){q 6.2c(S,1d,K,"4A")},81:k(S,D,K){q 6.2c(S,D,K,"5W")},82:k(S,D,K,v){l(6.1o(D)){K=D;D={}}q 6.3p({v:"63",S:S,D:D,2E:K,4o:v})},8a:k(22){6.3b.22=22},8c:k(68){6.1w(6.3b,68)},3b:{1e:T,v:"6a",22:0,5Y:"8i/x-8m-6d-8t",4V:T,4B:T,D:1d},3f:{},3p:k(s){s=6.1w({},6.3b,s);l(s.D){l(s.4V&&1v s.D!="1Y")s.D=6.2V(s.D);l(s.v.4Q()=="2c")s.S+=((s.S.11("?")>-1)?"&":"?")+s.D}l(s.1e&&!6.4N++)6.E.1K("64");u 4x=10;u L=1i 3k();L.6G(s.v,s.S,s.4B);l(s.D)L.3c("6K-6M",s.5Y);l(s.1R)L.3c("6T-44-6X",6.3f[s.S]||"6Z, 71 73 77 4d:4d:4d 7d");L.3c("X-7g-7k","3k");l(L.7m)L.3c("7q","7t");l(s.5s)s.5s(L);l(s.1e)6.E.1K("5v",[L,s]);u 2A=k(4j){l(L&&(L.7w==4||4j=="22")){4x=T;u V;2G{V=6.69(L)&&4j!="22"?s.1R&&6.4Y(L,s.S)?"5A":"2E":"2D";l(V!="2D"){u 3t;2G{3t=L.4h("51-44")}2p(e){}l(s.1R&&3t)6.3f[s.S]=3t;u D=6.5w(L,s.4o);l(s.2E)s.2E(D,V);l(s.1e)6.E.1K("5G",[L,s])}H 6.3I(s,L,V)}2p(e){V="2D";6.3I(s,L,V,e)}l(s.1e)6.E.1K("5I",[L,s]);l(s.1e&&!--6.4N)6.E.1K("5J");l(s.29)s.29(L,V);L.2A=k(){};L=1d}};L.2A=2A;l(s.22>0)6c(k(){l(L){L.7G();l(!4x)2A("22")}},s.22);u 4I=L;2G{4I.7J(s.D)}2p(e){6.3I(s,L,1d,e)}l(!s.4B)2A();q 4I},3I:k(s,L,V,e){l(s.2D)s.2D(L,V,e);l(s.1e)6.E.1K("65",[L,s,e])},4N:0,69:k(r){2G{q!r.V&&8l.8o=="4T:"||(r.V>=4U&&r.V<6u)||r.V==5U||6.14.32&&r.V==Q}2p(e){}q 10},4Y:k(L,S){2G{u 54=L.4h("51-44");q L.V==5U||54==6.3f[S]||6.14.32&&L.V==Q}2p(e){}q 10},5w:k(r,v){u 4k=r.4h("7y-v");u D=!v&&4k&&4k.11("L")>=0;D=v=="L"||D?r.7E:r.3C;l(v=="4A")6.42(D);l(v=="5W")3D("D = "+D);l(v=="4M")6("<1S>").4M(D).4O();q D},2V:k(a){u s=[];l(a.1f==2r||a.3v)6.I(a,k(){s.1g(2s(7.Y)+"="+2s(7.P))});H N(u j 1B a)l(a[j]&&a[j].1f==2r)6.I(a[j],k(){s.1g(2s(j)+"="+2s(7))});H s.1g(2s(j)+"="+2s(a[j]));q s.6g("&")},42:k(D){l(1z.5c)1z.5c(D);H l(6.14.32)1z.6c(D,0);H 3D.3X(1z,D)}})}',62,530,'||||||jQuery|this|||||||||||||function|if|||||return||||var|type||||||elem|fn|data|event|prop|length|else|each|ret|callback|xml|cur|for|speed|value|undefined|element|url|true|parentNode|status|apply||name||false|indexOf|className||browser|val|firstChild|obj|options|opacity|document|result|display|null|global|constructor|push|css|new|opt|expr|easing|style|handler|isFunction|nodeName|arguments|test|orig|msie|args|typeof|extend|filter|context|window|hidden|in|queue|re|hide|attr|show|old|events|arg|trigger|elems|num|add|table|target|token|ifModified|div|params|key|replace|nodeType|none|string|tbody|while|height|timeout|nth|animate|duration|not|index|nextSibling|complete|remove|done|get|tb|pushStack|z0|find|now|guid|fix|preventDefault|grep|merge|block|custom|catch|first|Array|encodeURIComponent|innerHTML|curAnim|exec|res|sibling|wrap|text|onreadystatechange|stopPropagation|cssFloat|error|success|al|try|el|oldblock|_|map|substr|has|readyList|selected|last|insertBefore|checked|originalEvent|disabled|fx|param|re2|trim|firstNum|load|handlers|childNodes|safari|domManip|curCSS|ready|parPos|visible|tag|width|oWidth|ajaxSettings|setRequestHeader|empty|step|lastModified|String|to|returnValue|removeChild|XMLHttpRequest|append|split|child|button|ajax|foundToken|9_|oid|modRes|second|jquery|toUpperCase|dir|multiFilter|inArray|makeArray|on|responseText|eval|slice|lastNum|Number|styleFloat|handleError|select|bind|isReady|mozilla|opera|clean|toggle|tr|defaultView|cloneNode|mouseover|position|getAttribute|oHeight|call|rec|fn2|swap|getComputedStyle|globalEval|currentStyle|Modified|Function|timer|radio|parseFloat|inv|px|from|els|00|visibility|oldDisplay|documentElement|getResponseHeader|unload|isTimeout|ct|startTime|_resort|RegExp|dataType|clone|break|getAll|matched|appendChild|shift|delete|self|requestDone|triggered|alpha|script|async|end|deep|submit|parents|setArray|float|xml2|lastToggle|id|handleHover|html|active|evalScripts|pos|toLowerCase|static|is|file|200|processData|_toggle|force|httpNotModified|getPropertyValue|newProp|Last|password|nodeValue|xmlRes|lt|sl|check|max|prepend|before|after|execScript|removeAttr|appendTo|1px|gt|eq|Date|getTime|previousSibling|setInterval|parent|contains|overflow|webkit|checkbox|image|beforeSend|reset|input|ajaxSend|httpData|continue|getElementById|rl|notmodified|getElementsByTagName|tmp|parse|_prefix|Math|ajaxSuccess|dequeue|ajaxComplete|ajaxStop|even|odd|handle|unshift|src|srcElement|prevObject|100|pageX|clientX|304|scrollLeft|json|zoom|contentType|scrollTop|unbind|getScript|createElement|POST|ajaxStart|ajaxError|click|state|settings|httpSuccess|GET|mouseout|setTimeout|form|ol|one|join|exclude|parseInt|Bottom|Right|Left|padding|border|Width|offsetWidth|absolute|left|relative|clientHeight|300|clientWidth|slideDown|slideUp|slideToggle|offsetHeight|toString|thead|fadeIn|fadeOut|th|fadeTo|open|Object|htmlFor|class|Content|readonly|Type|slow|gi|match|600|fast|400|If|method|getAttributeNode|tagName|Since|ig|Thu|concat|01|userAgent|Jan|compatible|boxModel|compatMode|1970|next|prev|siblings|children|10000|GMT|prependTo|insertAfter|Requested|removeAttribute|addClass|removeClass|With|toggleClass|overrideMimeType|lastChild|only|clearInterval|Connection|CSS1Compat|enabled|close|textarea|right|readyState|navigator|content|object|substring|cos|Top|PI|responseXML|loadIfModified|abort|setAttribute|serialize|send|textContent|body|action|9999|pageY|ActiveXObject|clientY|Microsoft|XMLHTTP|readOnly|cancelBubble|hover|fromElement|toElement|relatedTarget|getIfModified|createTextNode|getJSON|post|removeEventListener|DOMContentLoaded|blur|focus|resize|td|tfoot|ajaxTimeout|scroll|ajaxSetup|prototype|dblclick|mousedown|mouseup|mousemove|application|size|change|location|www|keydown|protocol|reverse|keypress|keyup|noConflict|urlencoded|font|weight|line|do'.split('|'),0,{}))

Array.prototype.compareArrays = function(arr) {
  if (this.length != arr.length) return false;
  for (var i = 0; i < arr.length; i++) {
    if (this[i].compareArrays) {
      if (!this[i].compareArrays(arr[i])) return false;
      else continue;
    }
    if (this[i] != arr[i]) return false;
  }
  return true;
}

//Adds CSS styles to the page
function addGlobalStyle(css) {
    var head, style;
    head = document.getElementsByTagName('head')[0];
    if (!head) { return; }
    style = document.createElement('style');
    style.type = 'text/css';
    style.innerHTML = css;
    head.appendChild(style);
}

//Adds global JS
function addGlobalJS(js) {
    var head, jscript;
    head = document.getElementsByTagName('head')[0];
    if (!head) { return; }
    jscript = document.createElement('script');
    jscript.type = 'text/javascript';
    jscript.innerHTML = js;
    head.appendChild(jscript);
}

//Retrieves URL parameters
function getParam(name) {
  if (name == 'GETURL') {
    var regexS = "(.*)/(.*)";
    var regex = new RegExp( regexS );
    var tmpURL = window.location.href;
    var results = regex.exec( tmpURL );
  } else {
    var regexS = "[\\?&]"+name+"=([^&#]*)";
    var regex = new RegExp( regexS );
    var tmpURL = window.location.href;
    var results = regex.exec( tmpURL );
  }
  if( results == null )
    return "";
  else
    return results[1];
}

//Adds new rows to tables
function addTableRow(oTable, id, colSpan, text, pos) {
  if (pos == null)
    pos = oTable.rows.length;
    
  var row = oTable.insertRow(pos);
  var newCell = row.insertCell(0);
  newCell.id = id;
  newCell.colSpan = colSpan;
  var textNode = document.createTextNode('');
  newCell.appendChild(textNode);
  document.getElementById(id).innerHTML = text;
}

function warnBotProtection() {
  alert('The bot protection screen has been detected.  Disable greasemonkey, reload the page, then click within the broken circle.');
}

//Current URL
var baseURL = getParam('GETURL');

//Village ID
var vID = getParam('village');

//Super duper game URL
var gameURL = baseURL+'/game.php?village='+vID;

//The speed of this world.  Perhaps useful one day
var worldSpeeds = new Array(0, 1, 1.5, 1, 1.5, 1);

//The number of the current world
var nWorld = baseURL.substring(9, 10);

//Throwaway variable
var tmp = '';
var pTable = '';

//Base reference to document tables
var allTables = document.getElementsByTagName('TABLE');
//var allTables = parent.frames['main'].document.getElementsByTagName('TABLE');


/* Get Current Village Coordinates */
if (allTables[1] != null) {
  tmp = allTables[1].tBodies[0].rows[0].cells[0].innerHTML;
  tmp = tmp.match(/\(([\s\S]+)\|([\s\S]+)\)/);
  var myCoords = new Array(tmp[1], tmp[2]);
} else {
  var myCoords = new Array();
}

var topCell = document.body.childNodes[1].rows[0].cells[0];
tmp = topCell.innerHTML.match(/;h=([\S]+)"/);
var myHash = tmp[1];

tmp = topCell.innerHTML.match(/\(([\s\S]+)\|([\s\S]+)\)/);
var myRank = new Array(tmp[1], tmp[2]);

function updateMap() {
  var mapx = (parseInt(document.forms[2].elements[0].value)-7);
  var mapy = (parseInt(document.forms[2].elements[1].value)-7);

  $.get(gameURL+'&screen=map&xml&start_x='+mapx+'&start_y='+mapy+'&size_x=14&size_y=14',
    { village: vID, screen: "map" },
    function(data) {
      document.getElementById('topoRect').style.width = '68px';
      document.getElementById('topoRect').style.height = '68px';

      var oMap = document.getElementById('map');
      oMap.style.width="742px";
      oMap.style.height="532px";
  
      newJS  = 'ajaxMapInit('+mapx+', '+mapy+', 14, "'+gameURL+'&screen=map&xml", 1, 1);';
      addGlobalJS(newJS);
      
      //Topo Map square
      var tRect = document.getElementById('topoRect');
      
      var tRectTop = tRect.style.top;
      tRectTop = tRectTop.substring(0, tRectTop.length - 2);
      tRectTop = parseInt(tRectTop) - 19;
      
      var tRectLeft = tRect.style.left;
      tRectLeft = tRectLeft.substring(0, tRectLeft.length - 2);
      tRectLeft = parseInt(tRectLeft) - 18;
      
      tRect.style.top = tRectTop+"px";
      tRect.style.left = tRectLeft+"px";

      document.getElementById('mapOld').innerHTML = data;
    });
/* DOESN'T WORK
 * The whole map would have to be rebuilt row by row and I'm much too lazy
 
      var xAxis = document.getElementById('map_x_axis');
      var yAxis = document.getElementById('mapCoords');
      var newCell = '';
      var newRow = '';
      var xBounds = new Array(myCoords[0], parseInt(myCoords[0])+7);
      var yBounds = new Array(myCoords[1], parseInt(myCoords[1])+7);
      oMap.colSpan = '14';
      for (x = xBounds[0]; x < xBounds[1]; x++) {
        newCell = xAxis.insertCell(xAxis.childNodes.length);
        newCell.innerHTML = x;
      }
      for (x = yBounds[0]; x < yBounds[1]; x++) {
        newRow = yAxis.insertRow(yAxis.childNodes.length + 1);
        newCell = newRow.insertCell(0);
        newCell.innerHTML = x;
      }
      
      
*/
}


function setVillageDropdown() {
  var altVillages = '';
  var setVars = '';
  
  GM_setValue('villageDropdown', '');
  
  //if (GM_getValue('villageDropdown') == null) {
    /* Village Selector */
    $.get(gameURL,
      { village: vID, screen: "overview_villages" },
      function(data) {
        //If it's a bot protection page, don't generate the list
        if (data.indexOf('captcha.php') >= 0) {
          warnBotProtection();
          return false;
        }
        
        /* List of Villages */
        var dStart = '<tr><th>dorp</th><th>punten</th><th>vooraden</th><th>opslagplaats</th><th>boerderrij</th>';
        var dEnd = '</table>';
        data = data.substring(data.indexOf(dStart) + dStart.length + 7);
        data = data.substring(0, data.indexOf(dEnd));
        altVillages = data.split('</tr>');
        
        var tmp2 = '';

        var v = altVillages.length - 1;
        var points = '';
        var def = '';
        var sDropDown = '<select onchange="window.location.href=\''+baseURL+'/game.php?village=\'+this.value+\'&screen=overview\';">';
        
        for (x=0; x < v; x++) {
          
          tmp = altVillages[x].match(/<a href="([\s\S]+)">([\s\S]+)<\/a>/);

          //Extract village ID
          tmp2 = tmp[1].match(/village=([0-9]+)&/);
          
          //Switch tmp[1] with ID
          tmp[1] = tmp2[1];
          
          points = altVillages[x].substring((altVillages[x].indexOf(tmp[0]) + tmp[0].length + 6));
          points = points.substring(5, points.indexOf('</td>'));
          
          points = points.replace(/<span class="grey">.<\/span>/g, ',');

          sDropDown += '<option value="'+tmp[1]+'"'+((tmp[1] == vID) ? ' SELECTED' : '')+'>'+tmp[2]+' ('+points+'pts)</option>';
        }

        pTable = allTables[1].tBodies[0].rows[0].cells[0];
        pTable.innerHTML = sDropDown + '</select> - <a href="'+gameURL+'&screen=overview_villages">Dorpen overzicht</a> - <a href="'+gameURL+'&screen=map">kaart</a> - <a href="'+gameURL+'&screen=overview">Dorp overzicht</a>';
      }
    );
  //}
}

/* MenuBar Styles */
var newStyles = '';
newStyles += '.menu {font: 12px arial; width:800px; position:relative; margin:0px 0 0px 0; z-index:100;}';
newStyles += '.menu ul li a, .menu ul li a:visited {display:block; text-decoration:none; color:#000;width:80px; height:20px; text-align:center; color:#000; border:none; border-left: 0px; border-right: 0px; background:none; line-height:20px; padding: 4px; overflow:hidden;}';
newStyles += '.menu ul {padding:0; margin:0;list-style-type: none; }';
newStyles += '.menu ul li {float:left; margin-right:0px; position:relative;}';
newStyles += '.menu ul li ul {display: none}';
newStyles += '.menu ul li:hover a {color:#fff; background:#804000;}';
newStyles += '.menu ul li:hover ul {display:block; position:absolute; top:29px; left:0; width:105px;}';
newStyles += '.menu ul li:hover ul li a.hide {background:#804000; color:#fff}';
newStyles += '.menu ul li:hover ul li:hover a.hide {color:#000; background:#804000;}';
newStyles += '.menu ul li:hover ul li ul {display: none;}';
newStyles += '.menu ul li:hover ul li a {display:block; background:#DED3B9; border: 1px solid #DED3B9; border-top: 0; color:#000;}';
newStyles += '.menu ul li:hover ul li a:hover {color:#000; background:#804000;}';
newStyles += '.menu ul li:hover ul li:hover ul {display:block; position:absolute; left:105px; top:0;}';
newStyles += '.menu ul li:hover ul li:hover ul.left {left:-105px;}';

if (getParam('screen') == 'map') {
  newStyles += '#mapCoords { width: 742px; height: 532px; }';
  newStyles += '#map{ width: 742px; height: 532px; }';
  newStyles += '.map{ width: 742px; height: 532px; }';
  newStyles += '#topoRect{ width: 68px; height 68px; }';
}

addGlobalStyle(newStyles);

var menuBarTop = '';
menuBarTop += '<div class="menu" style="z-index: 999999">';
menuBarTop += '  <ul>';
/* Logout */
menuBarTop += '    <li style="border-left:2px solid #DED3B9"><a class="hide" href="http://www.tribalwars.nl">loguit</a></li>';

/* Forum */
menuBarTop += '    <li><a class="hide" href="http://forum.tribalwars.nl/index.php">Forum</a></li>';

/* Chat */
menuBarTop += '    <li><a class="hide" href="chat.php">Chat</a></li>';

/* Settings */
menuBarTop += '    <li><a class="hide" href="'+gameURL+'&screen=settings">instellingen</a>';
menuBarTop += '     <ul>';
menuBarTop += '       <li><a href="help2.php">Hulp</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=settings&mode=profile">Profiel</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=settings&mode=email">Email adres</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=settings&mode=settings">Instellingen</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=settings&mode=move">Opnieuw beginnen</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=settings&mode=delete">Account wissen</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=settings&mode=share">Internet delen</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=settings&mode=vacation">Vakantie</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=settings&mode=logins">Aanmeldingen</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=settings&mode=change_passwd">Ww wijzigen</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=settings&mode=poll">Rondvragen</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=settings&mode=ref">Spelers werven</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=settings">Support</a></li>';
menuBarTop += '      </ul>';
menuBarTop += '    </li>';

/* Ranking */
menuBarTop += '    <li><a class="hide" href="'+gameURL+'&screen=ranking">Ranglijst</a>';
menuBarTop += '     <ul>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=ranking&mode=ally">Stammen</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=ranking&mode=player">Speler</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=ranking&mode=con_ally">Cont stam</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=ranking&mode=con_player">tegenstanders</a></li>';
menuBarTop += '      </ul>';
menuBarTop += '    </li>';

var newPost = '';
if (topCell.innerHTML.indexOf('ally_forum.png') > 0) {
  newPost = '<img src="http://ds3.die-staemme.de/graphic/ally_forum.png" title="New post in private forum" alt="">&nbsp;';
}

/* Tribe */
menuBarTop += '    <li><a class="hide" href="'+gameURL+'&screen=ally">'+newPost+'stam</a>';
menuBarTop += '     <ul>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=ally&mode=overview">Overzicht</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=ally&mode=profile">Profiel</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=ally&mode=members">Medeleden</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=ally&mode=contracts">Diplomatie</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=ally&mode=invite">uitnodigingen</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=ally&mode=forum">forum</a></li>';
menuBarTop += '      </ul>';
menuBarTop += '    </li>';

/* Reports */
var newReport = '';
if (topCell.innerHTML.indexOf('new_report.png') > 0) {
  newReport = '<img src="http://ds3.die-staemme.de/graphic/new_report.png">&nbsp;';
}

menuBarTop += '    <li><a class="hide" href="'+gameURL+'&screen=report">'+newReport+'Berichten</a>';
menuBarTop += '     <ul>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=report&mode=all">Alle</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=report&mode=attack">Aanval</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=report&mode=defense">Verdediging</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=report&mode=support">Ondersteuning</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=report&mode=trade">Handel</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=report&mode=other">Andere</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=report&mode=forwarded">Doorsturen</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=report&mode=filter">Filter</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=report&mode=block">Afz blokken</a></li>';
menuBarTop += '      </ul>';
menuBarTop += '    </li>';


/* Mail */
var newMail = '';
if (topCell.innerHTML.indexOf('new_mail.png') > 0) {
  newMail = '<img src="http://ds3.die-staemme.de/graphic/new_mail.png">&nbsp;';
}

menuBarTop += '    <li><a class="hide" href="'+gameURL+'&screen=mail">'+newMail+'Mededelingen</a>';
menuBarTop += '     <ul>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=mail&mode=in">Mededelingen</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=mail&mode=mass_out">Rondschrijven</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=mail&mode=new">schrijven</a></li>';
menuBarTop += '         <li><a href="'+gameURL+'&screen=mail&mode=block">Afz blokken</a></li>';
menuBarTop += '      </ul>';
menuBarTop += '    </li>';

menuBarTop += '    <li style="border-right:2px solid #DED3B9"><a class="hide" href="'+gameURL+'&screen=buddies">vrienden</a>';
menuBarTop += '    </li>';

menuBarTop += '  </ul>';
menuBarTop += '</div>';

var navbarTop = document.createElement("div");
navbarTop.innerHTML = '<center>'+menuBarTop+'</center>';

topCell.innerHTML = navbarTop.innerHTML;



/* MenuBar Content */
var menuBar = '';
menuBar += '<div class="menu">';
menuBar += '  <ul>';
/* HQ */
menuBar += '    <li style="border-left:2px solid #DED3B9"><a class="hide" href="'+gameURL+'&screen=main"><img src="'+baseURL+'/graphic/buildings/main.png" border="0">HQ</a>';
menuBar += '        <ul>';
menuBar += '        <li><a href="'+gameURL+'&screen=main&mode=build">bouwen</a></li>';
menuBar += '        <li><a href="'+gameURL+'&screen=main&mode=destroy">afbreeken</a></li>';
menuBar += '      </ul>';
menuBar += '    </li>';

/* Barracks */
menuBar += '    <li><a class="hide" href="'+gameURL+'&screen=barracks"><img src="'+baseURL+'/graphic/buildings/barracks.png" border="0">Kazerne</a></li>';

/* Stable */
menuBar += '    <li><a class="hide" href="'+gameURL+'&screen=stable"><img src="'+baseURL+'/graphic/buildings/stable.png" border="0">Stal</a></li>';

/* Workshop */
menuBar += '    <li><a class="hide" href="'+gameURL+'&screen=garage"><img src="'+baseURL+'/graphic/buildings/garage.png" border="0">Werkplaat</a></li>';

/* Academy */
menuBar += '    <li><a class="hide" href="'+gameURL+'&screen=snob"><img src="'+baseURL+'/graphic/buildings/snob.png" border="0">Adelshoev</a>';
menuBar += '        <ul>';
menuBar += '        <li><a href="'+gameURL+'&screen=snob&mode=fetch">Fetch Pkts</a></li>';
menuBar += '      </ul>';
menuBar += '    </li>';

/* Smithy */
menuBar += '    <li><a class="hide" href="'+gameURL+'&screen=smith"><img src="'+baseURL+'/graphic/buildings/smith.png" border="0">Smederij</a></li>';

/* Rally Point */
menuBar += '    <li><a class="hide" href="'+gameURL+'&screen=place"><img src="'+baseURL+'/graphic/buildings/place.png" border="0">Verzamel</a>';
menuBar += '        <ul>';
menuBar += '        <li><a href="'+gameURL+'&screen=place&mode=command">Bevelen</a></li>';
menuBar += '        <li><a href="'+gameURL+'&screen=place&mode=units">Troepen</a></li>';
menuBar += '        <li><a href="'+gameURL+'&screen=place&mode=sim">Simulator</a></li>';
menuBar += '      </ul>';
menuBar += '    </li>';

/* Market */
menuBar += '    <li style="border-right:2px solid #DED3B9"><a class="hide" href="'+gameURL+'&screen=market"><img src="'+baseURL+'/graphic/buildings/market.png" border="0">Marktplaat</a>';
menuBar += '        <ul>';
menuBar += '        <li><a href="'+gameURL+'&screen=market&mode=send">versturen</a></li>';
menuBar += '        <li><a href="'+gameURL+'&screen=market&mode=own_offer">Eigen aan biedingen</a></li>';
menuBar += '        <li><a href="'+gameURL+'&screen=market&mode=other_offer">Andere aanbiedingen</a></li>';
menuBar += '        <li><a href="'+gameURL+'&screen=market&mode=traders">Handelaren</a></li>';
menuBar += '      </ul>';
menuBar += '    </li>';
menuBar += '  </ul>';
menuBar += '</div>';

var navbar = document.createElement("div");
navbar.innerHTML = '<center>'+menuBar+'</center><br><br><br>';

//Insert the menu bar
document.body.insertBefore(navbar, document.body.childNodes[4]);

/* Current Village Overview page modifications */
if (getParam('screen') == 'overview') {

  //If that Premium account ad is there, move down
  if (window.location.href.indexOf('&intro') < 0) {
    pTable = allTables[6].tBodies[0].rows[0].cells[1];
  } else {
    pTable = allTables[7].tBodies[0].rows[0].cells[1];
  }

  var raw;

  var wood = pTable.childNodes[0].tBodies[0].rows[1].cells[1];
  raw = wood.innerHTML;
  var woodAmt = raw.match(/<strong>([\s\S]+)<\/strong>/);
  woodAmt = parseInt(woodAmt[1]);

  var clay = pTable.childNodes[0].tBodies[0].rows[2].cells[1];
  raw = clay.innerHTML;
  var clayAmt = raw.match(/<strong>([\s\S]+)<\/strong>/);
  clayAmt = parseInt(clayAmt[1]);

  var iron = pTable.childNodes[0].tBodies[0].rows[3].cells[1];
  raw = iron.innerHTML;
  var ironAmt = raw.match(/<strong>([\s\S]+)<\/strong>/);
  ironAmt = parseInt(ironAmt[1]);

  wood.innerHTML = wood.innerHTML + ' / <strong>' + (woodAmt * 24) + '</strong> per dag';
  clay.innerHTML = clay.innerHTML + ' / <strong>' + (clayAmt * 24) + '</strong> per dag';
  iron.innerHTML = iron.innerHTML + ' / <strong>' + (ironAmt * 24) + '</strong> per dag';

/* Enemy/Ally Village Overview page modifications */
} else if (getParam('screen') == 'info_village') {
  pTable = allTables[5].tBodies[0].rows[0].cells[0].childNodes[2];
  
  
  //Get enemy coordinates
  var enemyVID = getParam('id');
  
  var enemyID = pTable.rows[3].innerHTML;
  enemyID = enemyID.match(/screen=info_player&amp;id=([\d]+)/);

  enemyID = enemyID[1];
  
  var enemyCoords = pTable.rows[1].innerHTML;
  tmp = enemyCoords.match(/<td>([\d]+)\|([\d]+)<\/td>/);
  enemyCoords = new Array(tmp[1], tmp[2]);
  
  var enemyTribe = pTable.rows[4].innerHTML;
  tmp = enemyTribe.match(/id=([\d]+)"/);
  enemyTribe = tmp[1];

  var playerProgress = '<img src="http://twplus.org/tools/chart.php?w='+nWorld+'&pid='+enemyID+'">';
  var villageProgress = '<img src="http://twplus.org/tools/chart.php?w='+nWorld+'&vid='+enemyVID+'">';
  var tribeProgress = '<img src="http://twplus.org/tools/chart.php?w='+nWorld+'&aid='+enemyTribe+'">';
  
  addTableRow(pTable, 'villageProgress', '2', villageProgress, 1);
  
  if (enemyID > 0)
    addTableRow(pTable, 'playerProgress', '2', playerProgress, 5);
    
  if (enemyTribe > 0)
    addTableRow(pTable, 'tribeProgress', '2', tribeProgress, 7);
  
  var trDuration = '<a href="http://w'+nWorld+'.twplus.org/index.php?tool=durations&mode=calculator&start='+myCoords[0]+'%7C'+myCoords[1]+'&destination='+enemyCoords[0]+'%7C'+enemyCoords[1]+'" target="_BLANK">&raquo; Duration Calculator</a>';

  //Add the link to the duration table
  addTableRow(pTable, 'duration', '2', trDuration);
  
/* Enemy/Ally Overview page modifications */
} else if (getParam('screen') == 'info_player') {
  var table1 = allTables[5].tBodies[0].rows[0].cells[0].childNodes[2].rows[0].cells[0].childNodes[1];

  //Get enemy coordinates
  var enemyID = getParam('id');

  var playerProgress = '<img src="http://twplus.org/tools/chart.php?w='+nWorld+'&pid='+enemyID+'">';

  if (enemyID > 0)
    addTableRow(table1, 'playerProgress', '2', playerProgress);
/* Enemy/Ally Overview page modifications */
} else if (getParam('screen') == 'info_ally') {
  var table1 = allTables[5].tBodies[0].rows[0].cells[0].childNodes[2].rows[0].cells[0].childNodes[1];

  //Get enemy coordinates
  var tribeID = getParam('id');

  var tribeProgress = '<img src="http://twplus.org/tools/chart.php?w='+nWorld+'&aid='+tribeID+'">';

  if (tribeID > 0)
    addTableRow(table1, 'tribeProgress', '2', tribeProgress);

/* Map Page modifications */
} else if (getParam('screen') == 'map') {
  pTable = allTables[5].tBodies[0].rows[0].cells[0].childNodes[1];
  var tOutput = '';
  tOutput  = '<br /><br /><fieldset style="font: 11px verdana">';
  tOutput += '<legend style="font-weight: bold; font-size: 14px">Find New Farms</legend>';
  tOutput += '<form method="GET" action="http://w'+nWorld+'.twplus.org/index.php"><input type="hidden" name="tool" value="durations"><input type="hidden" name="mode" value="locator"><input type="hidden" name="village" value="'+myCoords[0]+'|'+myCoords[1]+'"><input type="hidden" name="player" value="0">';
  tOutput += 'Point range: <input type="text" name="min" style="width: 40px"> to <input type="text" name="max" style="width: 40px">&nbsp;&nbsp;&nbsp;&nbsp;';
  tOutput += '<input type="submit" name="submit" value="Search"></form>';
  tOutput += '</fieldset>';
  
  pTable.innerHTML += tOutput;
  updateMap();
}

if (document.body.innerHTML.indexOf('captcha.php') < 0)
  setVillageDropdown();