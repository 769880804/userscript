// ==UserScript==

// @name          PageInit code

// @namespace     http://www.sovas.lv

// @description   Tool to make quick page Init codes per sites. They run as native codes and no need to make Grease for every page separately

// @include      *

// ==/UserScript==


/* mousetrap v1.2.2 craig.is/killing/mice */
(function(){function q(a,c,b){a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent("on"+c,b)}function x(a){return"keypress"==a.type?String.fromCharCode(a.which):h[a.which]?h[a.which]:y[a.which]?y[a.which]:String.fromCharCode(a.which).toLowerCase()}function r(a,c){var a=a||{},b=!1,d;for(d in l)a[d]&&l[d]>c?b=!0:l[d]=0;b||(n=!1)}function z(a,c,b,d,F){var g,e,f=[],j=b.type;if(!k[a])return[];"keyup"==j&&s(a)&&(c=[a]);for(g=0;g<k[a].length;++g)if(e=k[a][g],!(e.seq&&l[e.seq]!=e.level)&&j==e.action&&
("keypress"==j&&!b.metaKey&&!b.ctrlKey||c.sort().join(",")===e.modifiers.sort().join(",")))d&&e.combo==F&&k[a].splice(g,1),f.push(e);return f}function t(a,c,b){if(!u.stopCallback(c,c.target||c.srcElement,b)&&!1===a(c,b))c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation(),c.returnValue=!1,c.cancelBubble=!0}function v(a){"number"!==typeof a.which&&(a.which=a.keyCode);var c=x(a);if(c)if("keyup"==a.type&&w==c)w=!1;else{var b=[];a.shiftKey&&b.push("shift");a.altKey&&b.push("alt");
a.ctrlKey&&b.push("ctrl");a.metaKey&&b.push("meta");var b=z(c,b,a),d,f={},g=0,e=!1;for(d=0;d<b.length;++d)b[d].seq?(e=!0,g=Math.max(g,b[d].level),f[b[d].seq]=1,t(b[d].callback,a,b[d].combo)):!e&&!n&&t(b[d].callback,a,b[d].combo);a.type==n&&!s(c)&&r(f,g)}}function s(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function A(a,c,b){if(!b){if(!p){p={};for(var d in h)95<d&&112>d||h.hasOwnProperty(d)&&(p[h[d]]=d)}b=p[a]?"keydown":"keypress"}"keypress"==b&&c.length&&(b="keydown");return b}function B(a,
c,b,d,f){var a=a.replace(/\s+/g," "),g=a.split(" "),e,h,j=[];if(1<g.length){var i=a,m=b;l[i]=0;m||(m=A(g[0],[]));a=function(){n=m;++l[i];clearTimeout(C);C=setTimeout(r,1E3)};b=function(a){t(c,a,i);"keyup"!==m&&(w=x(a));setTimeout(r,10)};for(d=0;d<g.length;++d)B(g[d],d<g.length-1?a:b,m,i,d)}else{h="+"===a?["+"]:a.split("+");for(g=0;g<h.length;++g)e=h[g],D[e]&&(e=D[e]),b&&("keypress"!=b&&E[e])&&(e=E[e],j.push("shift")),s(e)&&j.push(e);b=A(e,j,b);k[e]||(k[e]=[]);z(e,j,{type:b},!d,a);k[e][d?"unshift":
"push"]({callback:c,modifiers:j,action:b,seq:d,level:f,combo:a})}}for(var h={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},y={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},E={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7",
"*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},D={option:"alt",command:"meta","return":"enter",escape:"esc"},p,k={},i={},l={},C,w=!1,n=!1,f=1;20>f;++f)h[111+f]="f"+f;for(f=0;9>=f;++f)h[f+96]=f;q(document,"keypress",v);q(document,"keydown",v);q(document,"keyup",v);var u={bind:function(a,c,b){for(var d=a instanceof Array?a:[a],f=0;f<d.length;++f)B(d[f],c,b);i[a+":"+b]=c;return this},unbind:function(a,c){i[a+":"+c]&&(delete i[a+":"+c],this.bind(a,function(){},
c));return this},trigger:function(a,c){i[a+":"+c]();return this},reset:function(){k={};i={};return this},stopCallback:function(a,c){return-1<(" "+c.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==c.tagName||"SELECT"==c.tagName||"TEXTAREA"==c.tagName||c.contentEditable&&"true"==c.contentEditable}};window.Mousetrap=u;"function"===typeof define&&define.amd&&define(u)})();

//beautyFyer from https://github.com/einars/js-beautify/blob/master/js/lib/beautify.js
(function(){function a(a,c){"use strict";var d=new b(a,c);return d.beautify()}function b(a,b){"use strict";function D(a,b){return{mode:b,last_text:a?a.last_text:"",last_word:a?a.last_word:"",var_line:!1,var_line_tainted:!1,var_line_reindented:!1,in_html_comment:!1,multiline_array:!1,if_block:!1,do_block:!1,do_while:!1,in_case_statement:!1,in_case:!1,case_body:!1,indentation_level:a?a.indentation_level+(a.var_line&&a.var_line_reindented?1:0):0,ternary_depth:0}}function E(a){for(a=void 0===a?!1:a;d.length&&(" "===d[d.length-1]||d[d.length-1]===i||d[d.length-1]===C||a&&("\n"===d[d.length-1]||"\r"===d[d.length-1]));)d.pop()}function F(a){return a.replace(/^\s\s*|\s\s*$/,"")}function G(a){a=a.replace(/\x0d/g,"");for(var b=[],c=a.indexOf("\n");-1!==c;)b.push(a.substring(0,c)),a=a.substring(c+1),c=a.indexOf("\n");return a.length&&b.push(a),b}function H(){return d.length&&"\n"===d[d.length-1]}function I(a,b){var c=a.length-1;for(0>c&&(c+=a.length),c>a.length-1&&(c=a.length-1),c++;c-->0;)if(c in a&&a[c]===b)return c;return-1}function J(a){if(a=void 0===a?!1:a,B.wrap_line_length&&!a){var b="",c=0,f=I(d,"\n")+1;d.length>f&&(b=d.slice(f).join(""),c=b.length+e.length+(w?1:0),c>=B.wrap_line_length&&(a=!0))}(B.preserve_newlines&&t||a)&&!H()&&(K(!1,!0),v=!0,t=!1)}function K(a,b){if(v=!1,w=!1,!b&&";"!==j.last_text)for(;j.mode===A.Statement&&!j.if_block;)T();j.mode===A.ArrayLiteral&&(j.multiline_array=!0),d.length&&(a||!H())&&d.push("\n")}function L(){H()&&(B.keep_array_indentation&&R(j.mode)&&x.length?d.push(x.join("")+""):(C&&d.push(C),M(j.indentation_level),M(j.var_line&&j.var_line_reindented),M(v)))}function M(a){if(void 0===a?a=1:"number"!=typeof a&&(a=a?1:0),""!==j.last_text)for(var b=0;a>b;b+=1)d.push(i)}function N(){if(w&&d.length){var a=d[d.length-1];H()||" "===a||a===i||d.push(" ")}}function O(a){a=a||e,L(),v=!1,N(),w=!1,d.push(a)}function P(){j.indentation_level+=1}function Q(a){j?(l.push(j),k=j):k=D(null,a),j=D(k,a)}function R(a){return a===A.ArrayLiteral}function S(a){return X(a,[A.ArrayLiteral,A.Expression,A.ForInitializer,A.Conditional])}function T(){l.length>0&&(k=j,j=l.pop())}function U(){return"do"===j.last_text||"else"===j.last_text&&"if"!==e||"TK_END_EXPR"===g&&(k.mode===A.ForInitializer||k.mode===A.Conditional)?(J(),Q(A.Statement),P(),v=!1,!0):!1}function V(a,b){for(var c=0;a.length>c;c++){var d=F(a[c]);if(d.charAt(0)!==b)return!1}return!0}function W(a){return X(a,["case","return","do","if","throw","else"])}function X(a,b){for(var c=0;b.length>c;c+=1)if(b[c]===a)return!0;return!1}function Y(a){for(var g,b=!1,c="",d=0,e="",f=0;b||a.length>d;)if(g=a.charAt(d),d++,b){if(b=!1,"x"===g)e=a.substr(d,2),d+=2;else{if("u"!==g){c+="\\"+g;continue}e=a.substr(d,4),d+=4}if(!e.match(/^[0123456789abcdefABCDEF]+$/))return a;if(f=parseInt(e,16),f>=0&&32>f){c+="x"===g?"\\x"+e:"\\u"+e;continue}if(34===f||39===f||92===f)c+="\\"+String.fromCharCode(f);else{if("x"===g&&f>126&&255>=f)return a;c+=String.fromCharCode(f)}}else"\\"===g?b=!0:c+=g;return c}function Z(a){for(var b=p,d=c.charAt(b);X(d,m)&&d!==a;){if(b++,b>=y)return!1;d=c.charAt(b)}return d===a}function $(){var b;if(u=0,p>=y)return["","TK_EOF"];t=!1,x=[];var e=c.charAt(p);for(p+=1;X(e,m);){if("\n"===e?(u+=1,x=[]):u&&(e===i?x.push(i):"\r"!==e&&x.push(" ")),p>=y)return["","TK_EOF"];e=c.charAt(p),p+=1}if(X(e,n)){if(y>p)for(;X(c.charAt(p),n)&&(e+=c.charAt(p),p+=1,p!==y););if(p!==y&&e.match(/^[0-9]+[Ee]$/)&&("-"===c.charAt(p)||"+"===c.charAt(p))){var f=c.charAt(p);p+=1;var h=$();return e+=f+h[0],[e,"TK_WORD"]}return"in"===e?[e,"TK_OPERATOR"]:[e,"TK_WORD"]}if("("===e||"["===e)return[e,"TK_START_EXPR"];if(")"===e||"]"===e)return[e,"TK_END_EXPR"];if("{"===e)return[e,"TK_START_BLOCK"];if("}"===e)return[e,"TK_END_BLOCK"];if(";"===e)return[e,"TK_SEMICOLON"];if("/"===e){var l="",q=!0;if("*"===c.charAt(p)){if(p+=1,y>p)for(;y>p&&("*"!==c.charAt(p)||!c.charAt(p+1)||"/"!==c.charAt(p+1))&&(e=c.charAt(p),l+=e,("\n"===e||"\r"===e)&&(q=!1),p+=1,!(p>=y)););return p+=2,q&&0===u?["/*"+l+"*/","TK_INLINE_COMMENT"]:["/*"+l+"*/","TK_BLOCK_COMMENT"]}if("/"===c.charAt(p)){for(l=e;"\r"!==c.charAt(p)&&"\n"!==c.charAt(p)&&(l+=c.charAt(p),p+=1,!(p>=y)););return[l,"TK_COMMENT"]}}if("'"===e||'"'===e||"/"===e&&("TK_WORD"===g&&W(j.last_text)||"TK_END_EXPR"===g&&X(k.mode,[A.Conditional,A.ForInitializer])||X(g,["TK_COMMENT","TK_START_EXPR","TK_START_BLOCK","TK_END_BLOCK","TK_OPERATOR","TK_EQUALS","TK_EOF","TK_SEMICOLON","TK_COMMA"]))){var s=e,v=!1,w=!1;if(b=e,y>p)if("/"===s){for(var z=!1;v||z||c.charAt(p)!==s;)if(b+=c.charAt(p),v?v=!1:(v="\\"===c.charAt(p),"["===c.charAt(p)?z=!0:"]"===c.charAt(p)&&(z=!1)),p+=1,p>=y)return[b,"TK_STRING"]}else for(;v||c.charAt(p)!==s;)if(b+=c.charAt(p),v?(("x"===c.charAt(p)||"u"===c.charAt(p))&&(w=!0),v=!1):v="\\"===c.charAt(p),p+=1,p>=y)return[b,"TK_STRING"];if(p+=1,b+=s,w&&B.unescape_strings&&(b=Y(b)),"/"===s)for(;y>p&&X(c.charAt(p),n);)b+=c.charAt(p),p+=1;return[b,"TK_STRING"]}if("#"===e){if(0===d.length&&"!"===c.charAt(p)){for(b=e;y>p&&"\n"!==e;)e=c.charAt(p),b+=e,p+=1;return[F(b)+"\n","TK_UNKNOWN"]}var C="#";if(y>p&&X(c.charAt(p),r)){do e=c.charAt(p),C+=e,p+=1;while(y>p&&"#"!==e&&"="!==e);return"#"===e||("["===c.charAt(p)&&"]"===c.charAt(p+1)?(C+="[]",p+=2):"{"===c.charAt(p)&&"}"===c.charAt(p+1)&&(C+="{}",p+=2)),[C,"TK_WORD"]}}if("<"===e&&"<!--"===c.substring(p-1,p+3)){for(p+=3,e="<!--";"\n"!==c.charAt(p)&&y>p;)e+=c.charAt(p),p++;return j.in_html_comment=!0,[e,"TK_COMMENT"]}if("-"===e&&j.in_html_comment&&"-->"===c.substring(p-1,p+2))return j.in_html_comment=!1,p+=2,["-->","TK_COMMENT"];if("."===e)return[e,"TK_DOT"];if(X(e,o)){for(;y>p&&X(e+c.charAt(p),o)&&(e+=c.charAt(p),p+=1,!(p>=y)););return","===e?[e,"TK_COMMA"]:"="===e?[e,"TK_EQUALS"]:[e,"TK_OPERATOR"]}return[e,"TK_UNKNOWN"]}function _(){if(U(),"["===e){if("TK_WORD"===g||")"===j.last_text)return X(j.last_text,q)&&(w=!0),Q(A.Expression),O(),void 0;R(j.mode)&&("["===j.last_text||"]"===h&&","===j.last_text)&&(B.keep_array_indentation||K())}else"for"===j.last_text?Q(A.ForInitializer):X(j.last_text,["if","while"])?Q(A.Conditional):Q(A.Expression);";"===j.last_text||"TK_START_BLOCK"===g?K():"TK_END_EXPR"===g||"TK_START_EXPR"===g||"TK_END_BLOCK"===g||"."===j.last_text?t&&K():"TK_WORD"!==g&&"TK_OPERATOR"!==g?w=!0:"function"===j.last_word||"typeof"===j.last_word?B.jslint_happy&&(w=!0):(X(j.last_text,q)||"catch"===j.last_text)&&B.space_before_conditional&&(w=!0),"("===e&&("TK_EQUALS"===g||"TK_OPERATOR"===g)&&j.mode!==A.ObjectLiteral&&J(),O(),"["===e&&(Q(A.ArrayLiteral),P())}function ab(){for(;j.mode===A.Statement;)T();"]"===e&&R(j.mode)&&j.multiline_array&&!B.keep_array_indentation&&K(),T(),O(),j.do_while&&k.mode===A.Conditional&&(k.mode=A.Expression,j.do_block=!1,j.do_while=!1)}function bb(){Q(A.BlockStatement);var a=Z("}");"expand-strict"===B.brace_style?a||K():"expand"===B.brace_style?"TK_OPERATOR"!==g&&("TK_EQUALS"===g||W(j.last_text)&&"else"!==j.last_text?w=!0:K()):"TK_OPERATOR"!==g&&"TK_START_EXPR"!==g?"TK_START_BLOCK"===g?K():w=!0:R(k.mode)&&","===j.last_text&&("}"===h?w=!0:K()),O(),P()}function cb(){for(;j.mode===A.Statement;)T();T(),"expand"===B.brace_style||"expand-strict"===B.brace_style?"TK_START_BLOCK"!==g&&K():"TK_START_BLOCK"!==g&&(R(j.mode)&&B.keep_array_indentation?(B.keep_array_indentation=!1,K(),B.keep_array_indentation=!0):K()),O()}function db(){if(U()||!t||S(j.mode)||"TK_OPERATOR"===g&&"--"!==j.last_text&&"++"!==j.last_text||"TK_EQUALS"===g||!B.preserve_newlines&&"var"===j.last_text||K(),j.do_block&&!j.do_while){if("while"===e)return w=!0,O(),w=!0,j.do_while=!0,void 0;K(),j.do_block=!1}if(j.if_block&&"else"!==e){for(;j.mode===A.Statement;)T();j.if_block=!1}if("function"===e){if(j.var_line&&"TK_EQUALS"!==g&&(j.var_line_reindented=!0),(H()||";"===j.last_text)&&"{"!==j.last_text&&"TK_BLOCK_COMMENT"!==g&&"TK_COMMENT"!==g){u=H()?u:0,B.preserve_newlines||(u=1);for(var a=0;2-u>a;a++)K(!0)}return"TK_WORD"===g?"get"===j.last_text||"set"===j.last_text||"new"===j.last_text||"return"===j.last_text?w=!0:K():"TK_OPERATOR"===g||"="===j.last_text?w=!0:S(j.mode)||K(),O(),j.last_word=e,void 0}return"case"===e||"default"===e&&j.in_case_statement?(K(),(j.case_body||B.jslint_happy)&&(j.indentation_level--,j.case_body=!1),O(),j.in_case=!0,j.in_case_statement=!0,void 0):(s="NONE","TK_END_BLOCK"===g?X(e,["else","catch","finally"])?"expand"===B.brace_style||"end-expand"===B.brace_style||"expand-strict"===B.brace_style?s="NEWLINE":(s="SPACE",w=!0):s="NEWLINE":"TK_SEMICOLON"===g&&j.mode===A.BlockStatement?s="NEWLINE":"TK_SEMICOLON"===g&&S(j.mode)?s="SPACE":"TK_STRING"===g?s="NEWLINE":"TK_WORD"===g?s="SPACE":"TK_START_BLOCK"===g?s="NEWLINE":"TK_END_EXPR"===g&&(w=!0,s="NEWLINE"),X(e,q)&&")"!==j.last_text&&(s="else"===j.last_text?"SPACE":"NEWLINE"),("TK_COMMA"===g||"TK_START_EXPR"===g||"TK_EQUALS"===g||"TK_OPERATOR"===g)&&j.mode!==A.ObjectLiteral&&J(),X(e,["else","catch","finally"])?"TK_END_BLOCK"!==g||"expand"===B.brace_style||"end-expand"===B.brace_style||"expand-strict"===B.brace_style?K():(E(!0),"}"!==d[d.length-1]&&K(),w=!0):"NEWLINE"===s?W(j.last_text)?w=!0:"TK_END_EXPR"!==g?"TK_START_EXPR"===g&&"var"===e||":"===j.last_text||("if"===e&&"else"===j.last_word&&"{"!==j.last_text?w=!0:(j.var_line=!1,j.var_line_reindented=!1,K())):X(e,q)&&")"!==j.last_text&&(j.var_line=!1,j.var_line_reindented=!1,K()):R(j.mode)&&","===j.last_text&&"}"===h?K():"SPACE"===s&&(w=!0),O(),j.last_word=e,"var"===e&&(j.var_line=!0,j.var_line_reindented=!1,j.var_line_tainted=!1),"do"===e&&(j.do_block=!0),"if"===e&&(j.if_block=!0),void 0)}function eb(){for(;j.mode===A.Statement&&!j.if_block;)T();O(),j.var_line=!1,j.var_line_reindented=!1,j.mode===A.ObjectLiteral&&(j.mode=A.BlockStatement)}function fb(){U()?w=!0:"TK_WORD"===g?w=!0:"TK_COMMA"===g||"TK_START_EXPR"===g||"TK_EQUALS"===g||"TK_OPERATOR"===g?j.mode!==A.ObjectLiteral&&J():K(),O()}function gb(){j.var_line&&(j.var_line_tainted=!0),w=!0,O(),w=!0}function hb(){return j.var_line?((S(j.mode)||"TK_END_BLOCK"===g)&&(j.var_line_tainted=!1),j.var_line&&(j.var_line_reindented=!0),O(),j.var_line_tainted?(j.var_line_tainted=!1,K()):w=!0,void 0):("TK_END_BLOCK"===g&&j.mode!==A.Expression?(O(),j.mode===A.ObjectLiteral&&"}"===j.last_text?K():w=!0):j.mode===A.ObjectLiteral?(O(),K()):(O(),w=!0),void 0)}function ib(){var a=!0,b=!0;return W(j.last_text)?(w=!0,O(),void 0):"*"!==e||"TK_DOT"!==g||h.match(/^\d+$/)?":"===e&&j.in_case?(j.case_body=!0,P(),O(),K(),j.in_case=!1,void 0):"::"===e?(O(),void 0):(!t||"--"!==e&&"++"!==e||K(),X(e,["--","++","!"])||X(e,["-","+"])&&(X(g,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||X(j.last_text,q)||","===j.last_text)?(a=!1,b=!1,";"===j.last_text&&S(j.mode)&&(a=!0),"TK_WORD"===g&&X(j.last_text,q)&&(a=!0),j.mode!==A.BlockStatement&&j.mode!==A.Statement||"{"!==j.last_text&&";"!==j.last_text||K()):":"===e?0===j.ternary_depth?(j.mode===A.BlockStatement&&(j.mode=A.ObjectLiteral),a=!1):j.ternary_depth-=1:"?"===e&&(j.ternary_depth+=1),w=w||a,O(),w=b,void 0):(O(),void 0)}function jb(){var b,a=G(e);if(V(a.slice(1),"*"))for(K(!1,!0),O(a[0]),b=1;a.length>b;b++)K(!1,!0),O(" "+F(a[b]));else for(a.length>1?K(!1,!0):"TK_END_BLOCK"===g?K(!1,!0):w=!0,O(a[0]),d.push("\n"),b=1;a.length>b;b++)d.push(a[b]),d.push("\n");Z("\n")||K(!1,!0)}function kb(){w=!0,O(),w=!0}function lb(){t&&K(!1,!0),","!==j.last_text||t||E(!0),w=!0,O(),K(!1,!0)}function mb(){W(j.last_text)?w=!0:J(")"===j.last_text&&B.break_chained_methods),O()}function nb(){O(),"\n"===e[e.length-1]&&K()}var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C="";for(m="\n\r	 ".split(""),n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split(""),r="0123456789".split(""),o="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::",o+=" <%= <% %> <?= <? ?>",o=o.split(" "),q="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(","),A={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",ForInitializer:"ForInitializer",Conditional:"Conditional",Expression:"Expression"},z={TK_START_EXPR:_,TK_END_EXPR:ab,TK_START_BLOCK:bb,TK_END_BLOCK:cb,TK_WORD:db,TK_SEMICOLON:eb,TK_STRING:fb,TK_EQUALS:gb,TK_OPERATOR:ib,TK_COMMA:hb,TK_BLOCK_COMMENT:jb,TK_INLINE_COMMENT:kb,TK_COMMENT:lb,TK_DOT:mb,TK_UNKNOWN:nb},b=b?b:{},B={},void 0!==b.space_after_anon_function&&void 0===b.jslint_happy&&(b.jslint_happy=b.space_after_anon_function),void 0!==b.braces_on_own_line&&(B.brace_style=b.braces_on_own_line?"expand":"collapse"),B.brace_style=b.brace_style?b.brace_style:B.brace_style?B.brace_style:"collapse",B.indent_size=b.indent_size?parseInt(b.indent_size,10):4,B.indent_char=b.indent_char?b.indent_char:" ",B.preserve_newlines=void 0===b.preserve_newlines?!0:b.preserve_newlines,B.break_chained_methods=void 0===b.break_chained_methods?!1:b.break_chained_methods,B.max_preserve_newlines=void 0===b.max_preserve_newlines?0:parseInt(b.max_preserve_newlines,10),B.jslint_happy=void 0===b.jslint_happy?!1:b.jslint_happy,B.keep_array_indentation=void 0===b.keep_array_indentation?!1:b.keep_array_indentation,B.space_before_conditional=void 0===b.space_before_conditional?!0:b.space_before_conditional,B.unescape_strings=void 0===b.unescape_strings?!1:b.unescape_strings,B.wrap_line_length=void 0===b.wrap_line_length?0:parseInt(b.wrap_line_length,10),i="";B.indent_size>0;)i+=B.indent_char,B.indent_size-=1;for(;a&&(" "===a.charAt(0)||"	"===a.charAt(0));)C+=a.charAt(0),a=a.substring(1);c=a,y=a.length,g="TK_START_BLOCK",h="",d=[],v=!1,w=!1,x=[],l=[],Q(A.BlockStatement),p=0,this.beautify=function(){for(var a,b,c,i;;){if(a=$(),e=a[0],f=a[1],"TK_EOF"===f)break;if(c=B.keep_array_indentation&&R(j.mode))for(b=0;u>b;b+=1)K(!0);else if(t=u>0,B.max_preserve_newlines&&u>B.max_preserve_newlines&&(u=B.max_preserve_newlines),B.preserve_newlines&&u>1)for(K(),b=1;u>b;b+=1)K(!0);z[f](),"TK_INLINE_COMMENT"!==f&&"TK_COMMENT"!==f&&"TK_UNKNOWN"!==f&&(h=j.last_text,g=f,j.last_text=e)}return i=C+d.join("").replace(/[\r\n ]+$/,"")}}"function"==typeof define?define(function(b,c){c.js_beautify=a}):"undefined"!=typeof exports?exports.js_beautify=a:"undefined"!=typeof window&&(window.js_beautify=a)})();

function stripSave(html){
        var tmp = document.createElement("DIV");
        tmp.innerHTML = html;
        return tmp.textContent || tmp.innerText;
}

if (window == window.top ){

	var initScript = GM_getValue(window.location.host + "_startupCode");

	if (typeof initScript != 'undefined'){
		var script = document.createElement('script');
		script.type = "text/javascript";
		script.textContent = initScript;
		document.body.appendChild(script);
	}
}

Mousetrap.bind('i n c o d e', function(e) {     
		unsafeWindow.localStorage._startupCode_save = false;
		if (typeof GM_getValue(window.location.host + "_startupCode") != 'undefined'){
			startCode = GM_getValue(window.location.host + "_startupCode");
		}else{
			startCode = "console.log('My code Here');";
		}
		
		var innerH = '<pre>' + js_beautify(startCode) + '</pre>';
		
		unsafeWindow.saveStartupCode = function(){
			localStorage._startupCode_save = true;
			console.log('Save Requested');
		};
		
		document.getElementsByTagName("html")[0].innerHTML = innerH;
		document.getElementsByTagName("html")[0].setAttribute("contenteditable","");
		console.log('Save with saveStartupCode();');
		
		GM_wait_save_opp();
});

function GM_wait_save_opp() {
	if (unsafeWindow.localStorage._startupCode_save == 'true') {
		try{
			console.log('Do Save');
			GM_setValue(window.location.host + "_startupCode" , stripSave(document.getElementsByTagName("pre")[0].innerHTML));
			location.reload(); 
	   }catch(err){
	  //Handle errors here
			console.log(err);
	   }
	} else {
		window.setTimeout(GM_wait_save_opp, 1000);
	}
}