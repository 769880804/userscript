
// ==UserScript==
// @name           Thalboite 
// @version        1.0
// @namespace      Thalboite
// @description    Thal MOd Baobot
// @include        *kingdomsofcamelot.com/*main_src.php*
// @include        *kingdomsofcamelot.com/*fbLoginButton.php*
// @include        *kingdomsofcamelot.com/*standAlone.php*
// @include        *kingdomsofcamelot.com/*acceptToken_src.php*
// @include	       *kingdomsofcamelot.com/*helpFriend_src.php*
// @include        *apps.facebook.com/kingdomsofcamelot/*
// @include        *facebook.com/connect/uiserver.php*
// @include        *facebook.com/dialog/feed*
// @include	   	   *kabam.com/*
// @icon           http://ddflux.org/bao/bao/BAO.jpg
// @resource       avatars http://ddflux.org/bao/bao/avatars.js
// @resource       smileys http://ddflux.org/bao/bao/smileys.js
// @require        https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js
// @require        https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.21/jquery-ui.min.js
// ==/UserScript==
var Version = '3.84';
var nomonglet = "Bo&icirc;te";
var MAP_DELAY = 1400;
var DETECT_LEVEL_FS = false;
var URL_CASTLE_BUT = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAXCAYAAADk3wSdAAAACXBIWXMAAAsSAAALEgHS3X78AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA+NJREFUeNqclc9uFEcQxn9d3TuzeG3DLiaIOAcT2wdjgeESKeIQ5ZIokXmPXCLlTSLllEeBByCEIBMrlyzkAFxZC7P2zt/+Uznseo0NkZKUNFOlUvXXX898VW2++uaeLvR6ZFkHKxZjDP/VVJWYIm3rKYsC9/G1a/zw/XdYew5QlaSzkGlgZm9jeG9zVSWlyI8//Yzb2Fin9R6J6UyhqqKq8xjOAhljPlAf2dhYx93Y2iLGSErKgwcPMMagquzu7s7yifv3788Bdnd3SSmdyZ/Up6Tc2NrCbW6u09QlqrC4uIiIAZRLl5aoqgrvPRcvLiEipJTo95epqooQAktLixhjiDGxtLRE01Rsbq7jrly5wsHoNQCDwQDnLKqRXq+HCHjvWFkZYK0lxtN8CIHLlweIOEIILCwsAMryxT6uKAoWFhYQEfr9PnneIaVAnneAnCyzrKxMNwshzvJdYowMBgOsdbStJ89zVCNFUeB+3/+Du59/hjGG5eVlut0MSOzv7xFjwFphMFjGuSmj/f0nhKBY26Hf72OMpWkasmy67vGTX3EPf3nEl1/cxRjhwoUL9Hrd2bEzYmzpdIQ8z+ag3W6O94q1GVmWE6MiIlhrca7Dw18e4YbDZ3N5iAhZluGcpdvNUPVYq2SZxVohhA6dTk6MBmM6GCN4H6nrBmMM1sJw+Az34uUrYowYo6SUAHDO4ZwDHNYmrAVjmDGClASwhKB4H+cSC0F58fIV7vDwDW3rMcYQQiDGBCjGCCJ21j1p5hVjLCKGlGbtGSMhBEIIeN9yePgGZ8VSliUiQtM01HVDltnZ4oRIQlVnJxFSOvEJ7yNN09I0DW3bUlU1VixudXWVsixQhaqq6HY7OAcpOUQUa6eA01Y0pGSIceqbJlCWBVVV0TQNZVmwurqK297eYjweI2IpioIsc4hAShnWKnDynI6UlIQQlKYJFEVBURTUdc1kMmF7ewt35/YOR0dHiFjK8hQ0xhYRUD0dGO8OkBihrj2TyRS0qiqOjyfcub2D27l1k7+e/4mIZTR6TdPUlGWPTse9w/C8TcHrumUyKRiPj3n79i2j0YidWzdxa9fX+O3xIwDG4zGqibZtEJH5yHsPcqZr7wNFUXJ8PKEsCyaTY9aur+G6eT7XZwhhJi/5V6AxRrwPM51Odd7Nc9zo4ICUprLxPlDXDarM5+SHhvQJaEqJtm3x3qM6bYDRwQFuOHyOs1NWG59e56OrV+n1FqeXiCrnyZ78K2PkTL4oS1KMDIfPcXt7T/nk2mVSShgRjo6OKMvilKHqWUGdu0ZOLISIiGFv7ynm62/v/dOn+19mDPw9AD29Ua4OIbBVAAAAAElFTkSuQmCC";
var URL_CASTLE_BUT_SEL = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAXAgMAAAHuttyYAAAACVBMVEX%2F%2F%2F8AOjEAKSnbo5E5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAW0lEQVQI12NYwdAAhCsYOICwQQGEpiYwrGpgCHRgcIChUAeGqaERDBMZJRgmMCDwqlUrgHgBQ2hoAIMjiwAYOzBgxyA1ILVTQ4GggWEKK4MIK4JiYGAgiYKYAgBFlyWR9CCfyAAAAABJRU5ErkJggg%3D%3D";
var URL_HOSPITAL ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAC7mlDQ1BJQ0MgUHJvZmlsZQAAeAGFVM9rE0EU/jZuqdAiCFprDrJ4kCJJWatoRdQ2/RFiawzbH7ZFkGQzSdZuNuvuJrWliOTi0SreRe2hB/+AHnrwZC9KhVpFKN6rKGKhFy3xzW5MtqXqwM5+8943731vdt8ADXLSNPWABOQNx1KiEWlsfEJq/IgAjqIJQTQlVdvsTiQGQYNz+Xvn2HoPgVtWw3v7d7J3rZrStpoHhP1A4Eea2Sqw7xdxClkSAog836Epx3QI3+PY8uyPOU55eMG1Dys9xFkifEA1Lc5/TbhTzSXTQINIOJT1cVI+nNeLlNcdB2luZsbIEL1PkKa7zO6rYqGcTvYOkL2d9H5Os94+wiHCCxmtP0a4jZ71jNU/4mHhpObEhj0cGDX0+GAVtxqp+DXCFF8QTSeiVHHZLg3xmK79VvJKgnCQOMpkYYBzWkhP10xu+LqHBX0m1xOv4ndWUeF5jxNn3tTd70XaAq8wDh0MGgyaDUhQEEUEYZiwUECGPBoxNLJyPyOrBhuTezJ1JGq7dGJEsUF7Ntw9t1Gk3Tz+KCJxlEO1CJL8Qf4qr8lP5Xn5y1yw2Fb3lK2bmrry4DvF5Zm5Gh7X08jjc01efJXUdpNXR5aseXq8muwaP+xXlzHmgjWPxHOw+/EtX5XMlymMFMXjVfPqS4R1WjE3359sfzs94i7PLrXWc62JizdWm5dn/WpI++6qvJPmVflPXvXx/GfNxGPiKTEmdornIYmXxS7xkthLqwviYG3HCJ2VhinSbZH6JNVgYJq89S9dP1t4vUZ/DPVRlBnM0lSJ93/CKmQ0nbkOb/qP28f8F+T3iuefKAIvbODImbptU3HvEKFlpW5zrgIXv9F98LZua6N+OPwEWDyrFq1SNZ8gvAEcdod6HugpmNOWls05Uocsn5O66cpiUsxQ20NSUtcl12VLFrOZVWLpdtiZ0x1uHKE5QvfEp0plk/qv8RGw/bBS+fmsUtl+ThrWgZf6b8C8/UXAeIuJAAAACXBIWXMAAC4jAAAuIwF4pT92AAAEm0lEQVRIDa1WTWhcVRQ+9703/zMd82PijBFMbZuSqBEMKFRswV9K1aJ1YUGpriwIoiiCuogghS51ZUL8ASPSILrQjQQrYgMuurAouBCKJB0SOs1Pk+m8TOa9ez3fve/OvEnSheCBO+/l/J/vnHNfhBofd8T4uFw/e3qo/stfE/THwuGgcoOEK6hFUhLhbCfBOq7b5ioikXbIGS1Xk3cPvtk9MTMNofZUffnoMXlhfjrVWyw6zzxFTs8AkQqNWCk2TJHIZpjHXiwhQBCQXK+xF5sQeA1qXpglNXeJGgd6PinNzp0WC+++dG/h20tzycP355NnP1RusSS0MxjCKT9ldZnCf+aJEol2IK5M5LLkHdxvw5on8hCS/K+nwvSZSfdaufA+VZ888uvqoYdVUKtKBWoGfJr6yLqvWbWPJtUCuaqSHlAVt19VEiV1hQrq6ugRLVeNRsvG2AZKMvkfvKeqB0YuO+Gf8w+5Tx8lN9crKGCIPMbY8/QRCX4isUKenGyZnHI/n9vM6SmR6OvVcqvfejqCARDCffY4hUoMeuFSXbld5QjUGObG3Pwqbnoz0D1AH8hx+L1JFKJvu1DUI7f/TpK+IAchb+J6F+v/yBLsnk0iPCJjZBsnZA3oQq4kqrUtjgYDDFudFWJgMCSRjQliS0EP4HQ7uQyP1WnJmGFHFzaA0JId9cjGI8ZbpJKk6j7Vp74ksafQXjyMKTd967eLJDLpNh9OvATJ1TXyp2dINbbaATmw8jfJGx6i5Nh9bMN7VhG3qq6ZT8m9o0xXH3yAnEzZlG+zglIuo4N1bD2qYHgRqFURbHg6pb9M2RMvUPfMFC2VRrgnwA0Zp1LkpHk8S32dQWCIKwV9iZPG3dNjHWfra2aZ+d3F1jIzXKyCQDBC4+2odlje5A9rExdz5cZHOylTCZQQCM2zJ24IZzi7UbzhkFt7XkhLphJE4G1XzQ1StXwnXHDO4wg4dwRiGFW9bn2ZJ/dE3WA/3HzbK66EA/DmiuIeSoyOkYOrwm4yAvB44oKUlUUOxqNqK0IfMxny7hluTx3C8NWveBjcfYOksD9MHphyo0be/r3Ud3FWO9US/ETLWP/sK1p79W0zFOgZQ4IKvJGD1Dv7jQkShw2JcPLy2oqets7NwwQ57Ya1RtZm34qOF2Ae9QnTFyfoxz5mnUGw2fGM7Dsg3UEIEPGhZ3Wh10rKJOHoynY4+L8YnATH8ZwM4xs2tNdYbp1R+DbV5QMC7AGydrfdV50Wxp+/QZRUfNUP961uzf3MzICEAyeML8rjo+CQSfk+yU2esOVVPivmrCyTun5dy61+6xlNVXPuJ1IJ5Xupkb3vJM//Prn53bkwdfwkrxA+a8ZWoEdM3tA+yp04SaKLrwqMN6voS/CuQaOIymzfkJwe+8vNxMS5hJtP/6jdLT526PPu+fVT6rnHlXvqFeH03M7OeFRhiAsymyaRzxqojFsj44zl2no7ALKTTWqe/4Gcj7+glc3agvv82KP4KnJeJJeOPfF68PeVt7xADMhNfKOtN34Ctu1jCjGUomq1NtDFv2HZsC6Lhe9vee2RN3Ivnln8FzE/DMpJfihKAAAAAElFTkSuQmCC";
var CHAT_BG_IMAGE = "data:image/gif;base64,R0lGODlhagHQAvcAAP%2F%2F5v%2F%2F1v%2F33v%2F31vf35v%2F3zvf33v%2F3xff31vf3zv%2Fv3u%2F33v%2Fv1v%2Fvzvfv1vfvzvfvxffvvffmzu%2Fmvebmvffere%2Feve%2Fete%2Fere%2Fepebevebeteberd7evd7ete%2FWpebWtd7Wtd7Wrd7WpdbWrd7Ord7OpdbOrdbOpdbFpc7FtdbFnM7FnMXFrc7FlM69rc69nM69lM69jMW9nMW9lMW9jL29nL29lM61jMW1nMW1lMW1jL21nMW1hL21lL21jMWtlLW1lL2tnL2tlL2thL2te7WthL2le72lc7WlhL2la7Wle7Wlc7Wla62le62lc7Wce7Wcc62chLWca6WcjK2cc6WchK2ca62cY6Wcc6Wca6WUhK2Ua6WUa6WUY5yUY5yMa5yMY5yMWpSMa5SMY5SMWoyMY5SEa5SEY4SEe4yEY4yEWoyEUpx7Uox7Wox7UoR7WoR7UoRzUntzY4RzSntzUntzSnNzSntrSmtrY3NrSmtjOhlrzmNaSjpjhBljxRljvRljtRlarRlapRlSnBlSlBlKjBlKhBlKexlCexlCcxlCa0o6CCE6Uhk6Yxk6WkopAEIpADopABAxQjEpEDEpCCEpMRkpMTohADEhACkhCDEZACkZACEZCCEZACEQABkQABkIABAIABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAagHQAgAI%2FgB1NGgAB02XJUaWKFziZEmShRAVOplIcSIUKA4fLsG4EUqVj1kqNpQosmJEJ1VGSvx4saXLlwxLTvxYReFHmSgnkqRJkabPn0CrvGypE2fFlEZLCl3I8SJEKCirZJmKNGlJIxRJjoza0CREq0eVBq0KNqdIpFo7ehQ61OVYLTSnZoGbUUoSJ0yeNJlR4EGdOGsCC37jRvAaN4gDI37DuDHjOI3dOHYcR46cyZgzI94cmfMby6BBZ34Tp7Tp0ocZFx79GPNp03LsjLZcGjRk1ZJZE278%2Bvbj3qZVH0482rQdO8DjbEZ8OnHwNaU9q9ZNOvnpzryTvzEcuLRr4MWt%2Fgev%2FpoOHdPm0zOWszkOm%2Fc3HjxY42QGChQmRNw%2FQaL%2FiRP7%2FYeCCAT%2BR6B%2B9yUYoIAKmuCgCSVEWMKDD5aAH4UOXkghCvz15yEJCoYoIgoT3gehCSRieKKEEkIogoQj3pcChx7%2Bx99%2FH%2F7H4o4RoohCCjNyaOOCAIb4YX8xJriCggDqGGGRIloo4oYaVgjjiBnGmGWSCdqIoopbhljhg1yWaeYKQJZwwoEjjHBDAgmoYcQGfRVg550DFJCnnQP0ead88tkJ56AJCEoonAUMpOiddiraAKOQRsrooZQOmqiji17qqKaLYurpp54WUGilk3IKaqiMNuAnpIiuKiqi%2F68W2uhAktYKKa13nqorpolemmukj9p6a6278kqqsH8%2B8CcEyhZwwAGMPgCBnQI1sIYRIDQAQbGbcmqqow%2BAGm64npKL6bjncituA%2BiiO1C77MYL77i5BtuXueqCqum37ALq77%2F%2B5vvuv%2F0GPLDBBhfbLr6KAkxwwacCKnC6706M67f1OhtBBBAcwOwADjgwA7tygJGEDjrkoPLKKvuwsg8w5wCzD0MMMXMOKKO8MhApsywzD0AHLfTQQc88NMxBDwHE0kwD4fPLM0dtdNRAU0200DPXXDPNWnettNc8s8yz1DPPYHYOVZNt9NE%2B6KB0z27rvDLKRa9dddBo86C21f5D5%2B3D1XjnMMPKgO8NeN12H6643joA0TXPTXstueQ%2FDPFDD5gXofkPlQuRgwQSwOGGGmecAcbpqIOxhRVWSCEF663DLrsVW9Re%2B%2By45667FVTsrvvrwPsu%2FPC2F7867Lfvfjztt9vOfPLD0%2F588dFXb73yy%2Bee%2FfXcd8%2B98eCHD%2F4ZcMxRRx1zwHHGEkQwQQcj8O%2FRRx8vMOBAHX2Iov%2F%2B%2FPfv%2F%2F8ADKAAB0jAAhrwgAhMoAIXyMAGOvCBEIygAxmhhyUUgQ3wy%2BALDKCAOeRPgiAMoQhHSMISmvCEKEzh%2Fxixhh6IIYOMaIEBDOBBFdrwhjjMoQ53yEMJsrAK7%2F6DXwsIQIAa9vCISEyiEpfIRAMyogtV2AP8XkBEIzbxiljMoha3%2BMA9ZGENU1RABz%2FIxTKa8YxoZCIZjBDGMYLijXCMoxznSMc62vGOeMyjHvfIxz768Y%2BADKQgB0nIQhrykG%2FcQxQZ8QIxehCRkIykJCdJyUpa8pKYzCQoGMGFNjByho%2FUpChHScpSmvKUqBRkF7gQQ0f2IZWwjKUsZ0nLWuIxCzuIIQdDacte%2BvKXwAwmIHGpSzcK85jITKYyY0nMFrhymdCMpjSnWchmPpOa2MymNrNpTWNu85vgDGcvs9CDVnpTnOhMpzozmQUimNODnYinPOdJz3ra8574zP%2BnPvfJz376858ADahAB0rQghr0oAhNqDzJ%2Bc4%2BKPShEI2oRCdK0Ypa9KIYjWc34ZnRjnr0oyANqUhHStCNOpSkKE2pSlfK0pbmk6HOHKNLZ0rTmtr0piUtZyNlitOe%2BvSnQE0pQ3fK0aAa9ahITWpBh%2BpKpTr1qVCFKlN5GtWqWvWqM4UpKE%2BK1a569asZbacuachVsJr1rGgtqTtlSFZNuPWtcI2rXOdK17ra9a54zate98rXvvr1r4ANrGAHS9jCGvatYmWrBw%2FL2MY69rGQjaxkJ0vZyro1C0Uo5mIty9nOevazoA2taAOLWc32YbSoTa1qV8va1t61CkdoqGv%2BZ0vb2tr2toGFrWxxy9ve%2Bva3qdUtUU8L3OIa97jIHaxwXZnc5jr3uc9d7hihS93qWre20t3sdbfL3e5aVrcx9SAlxkve8pr3vOhNr3rXy972uve98I2vfOdL3%2Fra9774za9%2B90veKhQBEuHVA38HTOACG%2FjACE6wghfM4PFC4QgAdqSAG0zhClv4whjOsIbt%2B%2BAIj3HDIA6xiEdM4hKztwpIgIQKXNmISbj4xTCOsYxnTOMa2%2FjGOM6xjnfM4x77%2BMdADrKQh0zkIhf5EpagxBVSTNQ88OHJUI6ylKdM5Spb%2BcpYzrKWt8zlLnv5y2AOs5jHTOYym%2FnMUH5Cilv%2BsIAF5CEPf4iznOdM5zrb%2Bc54zrOe98znPvv5z4AOtKAHTehCG%2FrQiE60nO0CCRsgwM1%2BAISkJ03pSlv60pjOtKY3zelOe%2FrToA61qEdN6lKb%2BtSoTrWqJ22FJEBiBgPoYKRXTeta2%2FrWuM61rnfN614DwgpLgAQMBCDrQBj72MhOtrKXzexmO%2FvZ0I62tKdN7Wpb%2B9rYzra2t83tbnv72A2BxE7T4AdBmPvc6E63utfN7na7%2B93wjre8503vetv73vjOt773ze9%2B%2B%2FvcRoiCh8n974Ib%2FOAIT7jCF87whjvc3EaA8LjzMIiKW%2FziGM%2B4xjfO8Y57%2FOMgD7nIR07%2F8pKb%2FOQoT7nKV87ylls8CRIXYxryQIia2%2FzmOM%2B5znfO8577%2FOdAD7rQh070ohv96EhPutKXzvSm2zzi4pY5zZ1O9apb%2FepYz7rWt871rhPCCEyWeiHGTvaym%2F3saE%2B72tfO9ra7%2Fe1wj7vc5073utv97njPu973TnawR10BMzeE4AdP%2BMIb%2FvCIT7ziF8%2F4xjv%2B8ZCPvOQnT%2FnKW%2F7ymM%2B85gcP9Q12MA%2BbD73oR0%2F60pv%2B9KhPveoFnxAAgzIPh4i97GdP%2B9rb%2Fva4z73ud8%2F73vv%2B98APvvCHT%2FziG%2F%2F4yE%2B%2B7I3ABNfTMA%2BIiL70p0%2F96lv%2F%2BtjPvva3z%2F3u%2Fnv%2F%2B%2BAPv%2FjHT%2F7ym%2F%2F86E%2B%2F9Jn%2F9znkIRHwj7%2F850%2F%2F%2Btv%2F%2FvjPv%2F73z%2F%2F%2B%2B%2F%2F%2FABiAAjiABFiABniACBh%2FftdICOB%2BivCAEBiBEjiBFFiBFniBGJiBGriBHNiBHviBIBiCIjiCJFiCJniCEAhzABYy7rcILviCMBiDMjiDNFiDNniDOJiDOriDPNiDPviDQBiEQjiERFiERviCKtgCDtCAeXCETviEUBiFUjiFVFiFVniFLpgEUKBibeZ%2BjvCFYBiGYjiGZFiGZniGaJiGariGbNiGbviGcBiHcjiHdFiHdniHYPgDUBAJKvB6j%2FCHgBiIgjiIhFiIhniIiJiI%2F4q4iIzYiI74iJAYiZI4iZRYiZZ4iYAoBcHGAyEDB1SgAgAQiqI4iqRYiqZ4iqiYiqq4iqzYiq74irAYi7I4i7RYi7Z4i7iIix1gA1kQASk2AwLQAHjQBSeQi8Z4jMiYjMq4jMzYjM74jKi4i13wASmWAwMgjGggAtC4jdzYjd74jeAYjrlIAjfgBRmgBJDgA9qCB2WgjeL4jvAYj%2FI4j%2FTIiiJQA1iQAVMACT8gLXZABu5YjwI5kARZkAZJixsQA1dQAQLnAwnwAHZQBiNwkBRZkRZ5kfOYkAspcDdQABAQkROJkSI5kiRZkre4ATRwBR8gcDXgkSBpkjAZkzI5k%2F%2F3yAUfsI80wAASgAfZOJM%2B%2BZNAWZAj0ANecJOvNgA72ZNBuZRM2ZTcOJRFuY868AAMwJMo4JRYmZVaeYscIAMqmWJTWZVkcJVbWZZmeZameAEKuZKQMJXCOJZoGZdyqZVqqZINuS14AJdzuZd86ZMXgAM2KXA7gJdlQJZ9eZiIiZEbsAM2mWKD%2BZaGmZiSOZkCuZhXgAGOuS3%2FGJmU2ZmeCY4b4JUVkJkNsJmfeZqouY0XIJoC9wN98Y8BmZqyOZu5CAIxEJjp%2BJpKSZu82ZuxaJt2mZsPgAdrEJu%2BeZzIaYq2iZs%2B0BfEaZzJGZ3IqZFs2ZzDWZzSmZ3JqZEY0JD%2Fzomd2hmevAmc3RkJ1mkHagCd4rmenUmeU2Ce8mEHu8me9EmZ7mme7FIHYxAC9dmfk8kBMeAF5amOfrGf%2Fnmgh9mVRRkF%2BFmg%2FImgECqXobmgkfAD%2BUkGDxqhGlqWCrqSFXqhGbqhIuqUAEqhBKqfITqiKgqUtimgDHqiBrqiMvqTLZoBL5qfMTqjOgqTCUmhNCAfepCjOzqkIjmhHvqjDxCkKUqkTHqQG1ADPgqkQtqkVEqQTxqlSTqlVbqlGQmlRxoueKClXDqm4nil1BgJPyqMYkqmbNqNZsoEaAqma9qmdOqMZsqgaaqkdbqn3Gik7%2BkD8lEHGMqnhGqnNaCS%2F3AKqH7RjoXaqMr4pJeZqIHKqI5aqbm4mpEKn4uqnpbaqa%2BIqQM6qZzqqaSqiqD6oqJaqqrqihdwqB6qqHVAqas6q6jYqpkKq7JKq7o6ipCKmXGapAC5q8IqipD6AXCKpHoQrMMqrMV6rECqrMuqq72KBL%2Bal6MarZ36pFXgq0iKB19wrdhaqdNard8arrRqmRjgrMJYrua6qugKpyOzruDaroTKATuAqJFQLYLqAfSqqnV5k%2Fk6ELHKr%2F1KqnWZrgHbAPtasAarkAirr2RAsAxrqdwJpxArsRPrqKGZqRebsZYKqhYrsBHrsZW6mlpgrAm7sCTbqKtZlCFbmuy6sv%2BEOgEKmQEvawcxK7N7SrOXSa3Vogc5q7N0agEOC5bycQfQKrRDW7Rt%2BazzqrRMSrQ927TASgJQW6dS66tTWbVXS6c8251Um6xP27U6%2BrUNKaVWS7ZkSp4phqxzqrZDSp4Cl6ZhuqRwy6Ry%2B6t6erdbmrdua7d8u6PciafSsreB26SDG6cQYLiHS6TcSa0zIKWA27gr%2Brjm6ZxqMLmUO6IJ2ZiXO5yZu7mOe5u%2Bap14ELqiK7gxoAUIa7qom7ozapusm6jscrqaC7sQ2qKtW7uvi7sq2qMoS6C267syCry0C7q3S7z9abyaKqjJq7z0Camj2ZYgCr2ce6ijGbB%2BMaj%2F1ruh4yoQftG73Yug38su6Pm846ud5QuR4pu%2B%2FWmrZwq%2BddC%2B7kuftqq11Vu%2FB2oBh4qZ1Mu%2B6Ku%2F0xkDWOC%2F4Hu%2BAuyfPWrA5ku%2FCay%2BAUqN%2F4vADxy9AcrAAFzBFlzAYLmODqzB26mQ0ysQEDC8ICyeGjnC67gGAXzCqZmQHBy23OvC2QnD3PqsLUzDn2nDbRsujKvDAxzDefq2QCybC9zDDfDDRdybwEutQ5zDSyyZTay3MxzFTHzBPQysUGzFh5nCEAarVczFsjkB9zi1YLzFYjyXE8AB%2FUutZ5zGvLmxpRuoYQzHp3mwbkzHaGzHaInHzVvHfNyZfvzGgYya%2F3Kcx9u7x4W8lZYbuUmKBsW4yJ%2FJtvkqpSUgyZNctNVKxJg8l8CZAZAruZ3cnjUbylmqyKPMlJ%2FsxOFiB5ycyme5ynFammCAyrDMogQMyrPsyrZ8yz5pm%2FnIysJYy76MmBqZAU0QCY6sxMUcl5%2BczMsMyM0cy7mczG47ttPclC36AdYspdiczUsJAl4KzU4Lzp4cwaycpd9szjQawd08zL3MziIpuyi7tc4rz2gpzldgs9p7z%2Fhslvp8pCIbz%2F9ckeIcmGiavwWtlQHtxAq90FhJyfJrBgQN0QWZuDSQnxRt0VkJAl5ZnjTQF3Ww0RztlPpcno7MyyVt0hHMoCn9yv8rTZK669LxCdMxPc%2BkS9MQadM3fZHLidI1XdE9HY%2FbbMrMPNQmOcXLzNNI7aTorMyi3NQzCcM2qrdMLdVWGsHOOpxXjdUCuc3kPJzE7NUwCdZQLdZCTdbdaNaRC89qbZJmTbdj%2FdYjuc3vKddpTdfPaNezXLd6XdcBqo%2Bfi6J%2FjdPm%2BKci3dWFHY4g4AKHPdiKvdjfuAErkI%2BI7aCSbZGUbdmf%2B495ndnISNn7fNevKc2gTY%2BiLdjN%2BZGmfdrymNqJWtqf7dq4uAEscKv%2B%2BMG0DY8aoMnn2dq7LY4akJKlm9izHdy0ONw9C9nHjdyyqAH9G9uJ7Nz1CN24Pd3UPY%2F%2Fyl3cmJ3d8tjby92cDSAHY6AB3i2PX%2BvGieLX5w2PNLut6p3Ekd3eufjecyzfzU3fqmjfeYzf%2Bi2O%2FA2f%2Fv3f4Njb8C3gR03gzjjc2xrbA67g3bjdDs7eEM6Nyo2yIY3dFb6Ntm2OxyrSwL3hx6gBLCCg8GrcIr6NJG7iaAri%2BZ3iALDiCJvh%2FgzjzagBMODhv1rjNr6MOK7jNB7iPV6LP87PND7fQ66KRe7EiY2xST7iKWnkKP7kyajcUr7TL57iF%2F7hrJ3lIq4BOoCvId3lVF7lYQ6wGa7SZQ7lKkna3b3muWjl76kDTQ7nxsjgGDDnIrvOdo6KFZuwsNnntU0D%2F6yLqhCZq4I%2Bi4m7tYGe6LXYqwyaA%2BYr5I7u5%2FeKsCMDkSNb6Yp%2B6ccqsk7O6ax6qPwMsXwu6gBgAV7pofK76aj%2BqQ4rcK0e6q9uqrFOvQrr6rXOinLMoLO%2B6664sVWNpCoL7KuolgiNpDh76qJOtDa51XcQtMZ%2BijyL4a0s7dNeiuldyVqc7aqYtT7LLneA5IkO7pEg6afs7alo7pK%2BuJQO7H%2Fe7smatupuitQZsu5O7%2FVOiouuLfO%2B7%2FYe69r77wDP7wIv6Q0w7vpe8ACQtyRM8Awfig5fuO%2B%2B6xPv7l6%2B4f2O8RFPrJpMwp7d8aFouSCv296et6ttByws8g2%2Flv%2Fqjbwsn7ium%2FEVLvOYS%2FMQ3rkDevMxf5uvqps4r%2BBG%2BqKyHfMyIKAvz%2BMMH5oczNws35ULmWKE3PHTmo7%2BiAZBT%2BBPGsxWX8Imn%2B1bD8q5%2BZFYH%2FP4qMvnWfYiP67WqfQFb7m%2FnfX%2F%2FbhdL59yr98JybpSLx88eff0fcRW%2F8h%2B396Ar6h6oPZUj8WBf%2FiDf94pvPeC3%2FNRv%2FiIH%2FE6n8WM3%2FNcANJ9kflrT7pSbycJru6Xn5sFMPreXviJgvpg%2F9TWmayN792de6YZ7vkdj8eQMOZ9L%2FkYAGFjHvIdv8arHvrbuwEiL%2FxmHNRP75W6TOzkLugc4AL7jMhqTvXSP8f%2BWB7z18%2Fk2f%2F5y92tz9%2FncF%2B4lb%2F0mvyji4sGl%2Bz92M%2F60265f8v7Rh3%2Bdg7%2Fchr72Q2ctN%2FKcx3x%2Bg8QTCL5eNDADpgQABQuZNjQ4UOIESVOpFjR4kWMGTVu5NjR40eQIUNuiHEFg0AaDx7gGZNQ5EuYMWXOpFnT5k2cEEmaRBJphko9LXMOJVrU6FGkSUXuPOnzAQQ9alwqpVrV6lWsWSmCiKHlg0CCD4JO1VrW7Fm0aTly9fI1UsqVZMiqpVvX7l2qIGi0FTijgFi5eAUPJlw4pN62Pf0CnmvY8WPIhdl%2B6AnXjtDImTVvPssVS4YpA1VebszZ9GnUNtmCFv3%2BgHRq2LFlg0ScAWXBOphn7%2Bbd2yGIHV5sv8Wt2%2Fdx5KmBf65cvHRy6NEly2BOvEHu59K1b08LgjqG5g%2BwcydfHq33z02Iizdu3v17pOhZ%2F2SfHf59%2FDHlh6Y%2FPv9%2FAGGSTz368EAoQAQTXCuGz%2FhTyUD7FJRwQgBWc3Cl9ijUcMLJLmQpwg1DvK9Dp8TKUEQU8SNJuAvHSvHF%2F0j6TIn1giIBRhzhm4xGuGzM8cfydizRRSCLlM7CEj80csnkJiPwwROZlFK5GNpSz7Iop9RyMxLDem1LME9DMiz%2FwjQzszH%2FKvNMNg1Ls74245SsStbIzFJOPM0CYYUGW1szT0D%2Fz9qAzzoTgDNQRM3SYIUrWLvB0D8TlZSqRRsNzQdI75x005yYAms0TTkVlSamesIUAjvQAHFUVl%2FSoCTwInkU1cBatdWmV0361LVQb%2FV1Iw1oaDS8L381NqRgG72N11WPdVaiYLUYzsten7XWoWinBbXZa7sFIFtTcTvQW3KhFTaDygq4btxy222IAliXLdZdeieId7156W3XXl1by1ffcoVtilpuAb412YG3NdjdZIfDsuCFWW2YCUkIjrjcbCl%2B%2BGJyX5UWJXUj5fhYj9H1KeQxQBi5Ww1g%2BPgtNatdmdOWX4ZL5JkPdtlhlXDOuVWPP7gyZoh%2FDjRat2gg2miS%2FmnwCuRDmfZ1YpijltpWhJeto9arbd2ghn5TorXortvcYIewn7KD67JH%2FdqkKNbbmuy2zXwbg7hvlrlus2moAu%2BKC5Jjb77PJOnvuAm6ju3CJT0cbz%2FVEKFxTrmCeyAIXCNjcson1QvuwHnlvPNEP4c8pesIJ31K0%2FN2bvXSBXadWdgRvXv2f2s3G%2BzTQd1Ad0DP7jcsPBgHnk3hYw1Lj82Px3MDGrhQ%2FsHmnY8z1%2Bmttt5M7MOrowsPtm%2Bz%2B6q%2FD1%2F8M8lXWnv0tWyZp6qLH739Ld9vav2o5qd%2FSg1Y0LViNanhfPtzHwu0cL%2B%2F4EEqBKyfAREoljXQjYET6t8B%2FqGWvwnyz4HLwmAGmUQSCxKHAfLz4AerdL8HjHAM%2BithjjyGQhWysIUw6t%2F%2FlNaAoMhwhimqIQZCc0Mi7dCFLmuKXxqgJCEOUTi3OaLqkvifV7Xlh0Bx4hPxE8UPTNFEErTie7CoRQh18UVR9OF6wihGFLXMC2WkQQNoh0YRRZE1bXwjHDf0RXxV0Y7kwaMOFLZHDckxNH7EEBcBKZ0X%2FtCNxTPkIaFjvx%2F%2BRQ%2BqciQFiRhJsVCykgoq2RQksT47LHCTCULS%2BuogylEGqJRqMl4qR9SVpPWsla58DwhjyT5aerEkPHsAHPSYS97k6pa%2BbCQwY2OBXS6LmMbEDzLT%2FsYAXw6Qme5xZqxSAs0x%2FG6a76lmeJa5TWrCypu%2FBCdq1KeSb5aTj%2BJcDxzYpc7tvLA5DXBnMeGJpr1YswENcEMXtHlP7dSmJzpwYz0Bup3JoKQBEIgDOQ8amRVl0ScLbeiNHhqdFc3HjRW9KEbpNEh1NdSeHSUMkgjaSzBIk6S9QVIOGPCAhqp0pbvJaGhcisuZxqamJfJZTlGzAf8NZwb77KlPTQNUZUkiB0R1qFHvUsGvKJWpI3WqWqCq0NRRtapoqZlbTlqHd27VnC6L6lfBJ9bYXFUSOghZFjSAVtj0MFwFgIMRKADX1MhTVgkogBuMgNe8wpJifinAGn4A%2F1hzClYShDUsYk8TNI09oABqOKxjOWO%2FKGBCaZOtrGU1g1lMDJWznt0MZhfbgNGSNjP2G%2BwABkBZ1a42Bn9DwmJdC9vYQuZVfzvCWhvAANzm1jHY6y1BgNtZ4RaGuIFrQHCTW1JYFbcgavDBc90UXeZS17pzOqB0m1vd7Q4mBF0BzyehpNXw3oRqFkvvU88VLoM0tb05oRpckDhfujQsPPfFb1r06y%2F59rcmyaKMaNaFXgHDJFcmA2WAEyyTc9bxwWaJAROyl7sJW4VfCZNwhrGy4XB12MNWIR97R4wV7MnLwSf%2BCPa0iGEWH8XFeURwjDWy4L4szcZVqZnJZjAA9v6obMeU2hnUijpk9cJAWXJbMZIxAlm5zdLJOIGyKaU8ZVw5LWk6xnJR%2FmvKJnd5IvVFWY3FDJGsle%2FKZ46JBnSwZKWNjc1DcTOc1bbmOYvkcxm4Us%2FCnOeG7NmTYDYzoBXiYgA2YHCFNrTlMKAeH6hLDng2tEcc3WfxVK%2FSM5mxlzS9af0IzJMmBrWARG2dI5f6xueKZFZVrZ8385nGr1Ywq2dNa5EgbIrxZTSg68xhRuJazzTAQvaCLWzaCCxctNIhsp98Lzv1Os8pto4cwursG%2B9SMWXGtkcWvG0Rd%2Fsi9lMM9aQ9Z9ZGggdADuW52VzBk0hi3eJBpbgzAm%2BK6f%2BA3fW297g3ONGV8LvfFcH3kCQ38Hv%2Fmz5RKQHCn71GJvLX4WOmU2QLAOOJN0QDLrCgeZvo7jMXHHUSzzia%2F31DkpccW0TMMQ7%2FvOmaFVFdQVQ5mqt0S5rXHFs312LOdc4QPNIgc3q49s8PfcIpourllQ76QjFec0G%2BxelLN3TQ1UZ1X%2FM8En5UOsjF3MenpNzondy6G5nn9S73WJGMMfpDYo5JBaIdy1w54KD%2F0u62%2F6Yrc7y7wNtOd4laWe5TrjIrB%2B9kYS5r0XnXeEluKVLGAz2Z64F85I%2B%2B5KHScwxvtfy32DnUXo5Bpm0nH%2Bhj2nnPw48%2Blbd8hFkf%2BQhHE%2FX%2Bem0jPVM6e%2FJWZp%2FuHL3REaPPB%2FTz8EgOwV4cVtAuDH%2FIiEkaRVeI%2Boj2xfkWtfxOTT8G6kd%2BRWzcaNF9%2F9Gyw9T7P1%2BNQmGK9TwjqT%2Fon7Mty%2B3qzu%2FENh5PdcaROn9C1n%2FiSC3wV9nPZv7TPfEYP52zpXxzI7BSvh3bACUrKwQkQKjzn%2F5DwCzovZ8jt7KjpyS4q87DQIIqLOSCvQYcLNRqLNy7gqiCgX0ywQ4cwdNKrRZEwSnAhA90LtiDlRkULRtkvBSzrdcaAtRLPcoIrdsCwhMsrx8DLiPsQHGyLSUMwuXKAQf4riB0tN7igekCr86zwuzSQsvjQsXRLtT%2FA0OVEMMtzD0DM8MvJKKB2ic1FEGesC1%2BCkEeVDIkBDI4oMO8AwE7rK0f6yU9%2FLsm%2FMM8DMLxOqDaWh83CMTvsyE3ekPG24kPyCw6gsS8sxfE0ay%2FsMS2u4DZwoAl%2BKRH9MLIE4EeaItQrERSZDxTbIvMqsEgCMLbwQQfQC01iEXU44DgmERatEVG%2FLkNkAG40SzJKkTUu4AaWKMoMK8BMMb4%2B7yCcMbqc7wlcAp6wsVnRMFQpA84wMbqkwGvWMafuEZZrIEDyqyfaEZv1D5zvAB0fAB1lEVYoUR43MG8E4EY4AJeTInX%2BkWdczTXGQC%2FksfLQZ2BHMN8xBtiFMi%2F%2F0JIfQxINWjIM3zIhbTHtsNHiuRHizQ6jNxHN%2FTHmsNIDDgCqXuAjfw5DkjIuCGkk9S5lJSeVyxDkFS5l1RIlpzJkqvJmDTJdWQ8naTBMuzJvHtJXjwpTuTIZNzHv3CDJfzCpJxBRWzKyAOBp%2FykpZRKxvMOKbLK4MNJ%2B%2BM5rlxEedxKRfTK%2FeM5TezKscyitBRL6EPLG3LLM4Q4WlQJufxCGeCLulRL1BOBpGQCWlxKs3Q4fEwMTZzDKrw5wIxLrNzDE1pMdWHKxFwjJDhMyXxL4UjEqwxCXRSDD1iCwETMXNwBzwTNSJtDzrM8ESDNzwzNuyxF1jyCwOTLzltNz%2F%2FsrbIMQlO8zbYcTIQzgR64TasUzc4zgSJggw%2FAzcj0zYEzzjf4ACJgrtdkvBVggufsgdCZzrxjFDr4ABwYTu00ugngTu%2B0yr5iTnsbzyugAxP4zs0Kz58bTyxgz%2B9UHPjUOXvxAjxoz7okzsizlzDYA%2F6sRRA8xhUQAwHFgUw4qfusOQuQgTIQ0BhY0BVET3GzANLczxjoTxb8T9IUUBnoxeay0G6zFwRtTwqFwcjzxBPFARr0ReiTgRMlgkwgrKP8x%2BBkzyjYBBV8ADQgUWy7ACJgAzEwATTgBKF7AMNKzT1EgSVggyX4ADz4BKGjwi80gTBYgxUoAUag0gIoADT%2F8AEmFU8Q0IEw%2BIEUAANK%2BIQfgAAIIIMf4EDfmAA6nYCFkFOlsFOQwFOLqFM0G1OGoAAK8NNA1QA%2BfQhBTVRFTdQJGFRH1QANaFRJHdQ6pVMLoABIrdRK1QALsFM6hVRQBdVP5VRStQBOtQBUTVUL2IANUFVVnYBVvQBX7dRU%2FR0LAIENAAEQmAANKNMu0IESAIMuDYU4WwMjQIEQCIENSNZk1VVdDQERiFYRSFZpZdZoBQForVYR8ABu9QBWZVVmZVUPCIFxZVZzzVVsNVdqldZrRddv3QB2lVYTmFcUMAER4AARGIFoJddu7dZ1jdYSiFd2RQGCZdcSKIETSNgT%2FwhYaT1YEyBYFDhYhEXYhD3YhIVYjI3YEkCBFOhYjyXYj%2BXYFMDYjgVZjz3ZkBXZEzDZjIXYlDVZFkBZj2UBmk0BmqVZkGWBnG1ZnkWBFViBjP1ZoR3ZkSXYFWCBo%2F3ZjhVapm1ap3Xam41apG3am12BGNiBGtiBHTjaGXCCJAABH2CEURgFYj2AwjICGmCBGVBbGqCBGYABuIWBGJjbuW1bu73ZGUhbFoABqbVbv50BwM1btw1cwSXcuIUBv01cxU3cGsharM3aHugBIpjcHtDayn1cv%2FUBzfWBHfgBzyUCz%2FVcrd2BySUCIzAC0C3d0j1dI%2FjcH1DdJYhd1k0C1P9VXda9XdpFXSOIXd693SXI3dPlXd6lXeEt3iW4Xd8V3t29XSdoXuSd3SQwXuXd3eMN3ue93uuN3SLY3uKNXtml3iUogvAN3u%2BV3uIVX%2FE93iIwgvU13fXdXvgVXid4Ai3ogi8Igy5Ygh8Agx9omT4IhU8YBVEQugDwq%2BbNAgRO4CyogirIAi3QAgZ%2B4C54YC1QYASm4ApG4Al%2BYAvuYA%2F%2BYAZWYAzuAhIm4REmYS%2FQAi8IAzEQgzB4YS%2BI4RKeYfv9Ahv%2BAjLIYR0mgxfu4TAggzIoAx8eYiJ%2B4RwO4iDeYSLO4R5mYiPeYR5u4ij%2B4SLugiLGXxrO4hKuXy3eYAxTzuAvpuAJXmAHDmEEroLmfYInaF42doIqUOM1ZmM4nmMGZmMGvuM7hmM3ZmA1xmM%2F5uM5juM1ll8n4F04jmArLoM1YIMyWGMYGIAf6NKxFQVRCAgAOw%3D%3D";
var JSON;if(!JSON){JSON={}}(function(){function str(a,b){var c,d,e,f,g=gap,h,i=b[a];if(i&&typeof i==="object"&&typeof i.toJSON==="function"){i=i.toJSON(a)}if(typeof rep==="function"){i=rep.call(b,a,i)}switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i){return"null"}gap+=indent;h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1){h[c]=str(c,i)||"null"}e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]";gap=g;return e}if(rep&&typeof rep==="object"){f=rep.length;for(c=0;c<f;c+=1){if(typeof rep[c]==="string"){d=rep[c];e=str(d,i);if(e){h.push(quote(d)+(gap?": ":":")+e)}}}}else{for(d in i){if(Object.prototype.hasOwnProperty.call(i,d)){e=str(d,i);if(e){h.push(quote(d)+(gap?": ":":")+e)}}}}e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}";gap=g;return e}}function quote(a){escapable.lastIndex=0;return escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a){return a<10?"0"+a:a}"use strict";if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;if(typeof JSON.stringify!=="function"){JSON.stringify=function(a,b,c){var d;gap="";indent="";if(typeof c==="number"){for(d=0;d<c;d+=1){indent+=" "}}else if(typeof c==="string"){indent=c}rep=b;if(b&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":a})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e==="object"){for(c in e){if(Object.prototype.hasOwnProperty.call(e,c)){d=walk(e,c);if(d!==undefined){e[c]=d}else{delete e[c]}}}}return reviver.call(a,b,e)}var j;text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})()
var JSON2 = JSON;
var TABLE_SCALE =0.65;
var butON='<img align=absmiddle src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAACB0RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgTVi7kSokAAAAFnRFWHRDcmVhdGlvbiBUaW1lADExLzA1LzA33bqJ2wAAAq1JREFUeJxlk09oVFcUxn/3vskkqZoJGRMXTgQpCga0qZkUChEtFjFg6giuVDAgbaQroV2WGgUXXQiudJlVyDJpKRVKwYR0YXVqtNrUP1SSOMYRJpjJjJn3Zubc08Uzk4n94HDh8N1zzvcdjlFV6rHn75P7oqbhkqc26WET4oTAlTOBq6QDV774oufmX/V8U1+ge/bUuGdsaiHI8kYKCAKAh2UzzcS1hYqrTix8cvPEhgLfZq41TRXuPctVlxNz5cVawVZvCwDLUqjl4rKFZolmtr9t23X78zHfAvy2cmes/nOq9RAAM12jzOwZBbeeW/IKFE0p8W9TdgyA5OyZ3v2zp5V0j5Lu0ZHcT6qqyvTHugZ+3quqqiPZH2u8rVMHte3WgV7ru/KVhSBb6zwYHwhnXaqsO1UNfRrc9gWpyAEAilGfipErttk0dr15p/Fs/BgAFx7+AMBceZG51VDWhRdXQ07HAJQcQUQwFe0yyUdnNO3/A4D2pEPzfvmU/CafWCwGr8vkq0Vi29tY7p4Mnf/1I4g3sDkXISJOeB8GAx945KUIbQDRMLeGkgNA1GGrTl56WAAmC3+GY3YeXyfbMNbkTebuvts/iJOX3qavdh4VdR8GVJgrLzIYH+Dotj7y/gqPK/M02UbOt5/kWuc3oZEz3zEvWaz1UHF/mN3p48mqyt3n5hUAFzu+ZLhz6H+yAIYfX+fSkxvQ3kAkr4iTXqOq7LjTP76Kn1rywm0ctN0Mdw5xaGtvbezhJ9eZyqWhJYLFoL5MuP4HJ4yqcnj6XNPTSOZZ0ZQSyw2rYbvAwYqEL0CjhRYPG4CuSkbnS7v066f+hmNq//2zcZymilGfICKo0ZphxgdbEAQ34fofbDymesSm+/YiellFk1p1CVGHIBkxLu2Mfu+O3H9Yz/8PLFlkbIqvT3MAAAAASUVORK5CYII%3D" alt="ON">';
var butOFF='<img align=absmiddle src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAACB0RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgTVi7kSokAAAAFnRFWHRDcmVhdGlvbiBUaW1lADExLzA1LzA33bqJ2wAAAsFJREFUeJxlk09oVFcUxn/3zR9HaoJKgphMFGtCrH9alUTqRgWhJtDFjBRsNybURVWwFCqUUmgyghTcaKlLQXeiopOVIEhtNaDjaNVYiNXYjHGeDmhokpcw89677x4XL5lM7AeXezn3O98957scJSLU4unBzz+2PliSUdF4h0RjSaN9ghmnqGem75mZqb5PLuaGavmqVuD50a+yKhpPTT/K4dqjiO+FpGiMSMNKrJa1GLc8sPXC7fQCgUrhaeL1mRPPKoV/ks79wapgpG4pAIEzUY1ZLa2Y+uXFYMO2tu2Z3yoWgH2673xt8rLdKQA2Zh+wMfuAQOZj5uUIMl5Kcvf6eQD+/enrzuc/7JfcOiS3Dnlz5ayIiFxrQ+ZwZnV4ti+frfIGP2uXm7tbOy3tTByffpSrvtyQ7gVgxJ03yp21qWlvL/7OsBJrvIS45eNWpH75etceBaAh3QPAYOa7MNEu4BQLAIz9Esaa0j1MBGCVHbRlrbeMMc1zbs/1+eTSOVri8Hd6MwPdm1mk4E32HABr9qR4q0EZQ6B1c9Ron/ehlKIhAoEzSasACQBVvZ8Iwt34Gst4rq2iMQCm7v4BQPsXPfNfqcLVONuefSfkiFIY7dmRb9oau0TrtWZ6Etcu0JjuZdWuLqYmJzGjT7AWJVjx5UFW/XgKgN+/74XXL6iLxwkCk1NDB7o6As/Ne/kboZGH+/jwSP//2gLIn+wnfypDewL8+GK0DjqViPDXvu1Z89/blHk5AoC3ZSdrvu2n+dNd1bLzJ/t5dedPmmJQn4jjBjLQPeyllYjw8NdMwrt19ZmMl5KqNAaAY+CVD86sYXURaIqBisUpB1Icq5i2Q6O6smCYbnd/lDVGUtZ4CavsoIypGuZZMWZUBNF6oHvYWzhMtRjc0bLJoI4FYjq0MUnja/DdItq/h/Z/3jPsP67lvwOjGG1S8vVScQAAAABJRU5ErkJggg%3D%3D" alt="OFF">';
var ResetAll=false,deleting=false;
var sitesupport="http://koc-bao.com";
var sitepub="http://ddflux.org/bao/pub/google.php";
var URL_PROVINCE_MAP = "data:image/gif;base64,R0lGODlhxgLEAvcAAP%2F%2F%2F%2Ff%2F%2F%2Fv%2F8%2Ff3%2F%2Ff39%2Ff37%2F%2F%2Fpe%2F39%2F%2F%2FnO%2F37%2F%2F%2FlPf%2FnPf%2FlPHv9%2B%2Fv7%2F%2F3lO%2Fv5ubv7%2Ff3lPf3jO%2Fm7%2B%2F3jO%2F0lPfvlObm7%2Bb3jObm5u%2FvjN7m5ubvlObvjN7e5t3whN7e3ubmjObmhNbe1tbb3t7mjN7mhNbmhNbW1t7ehM7W1tTfe9TchM7O1s7OztbWe8XOzsXOxc7We8XWesXFzsXFxc7Oe73FxcXOe8XOc73Oc7XFtb69xdHYAL29vbW9vb3Fc7bGa7XFc7W1vbW1tbXSALW9a6rCY629a6yurq3KALXFAJjCWq21Y6uza6W1Y7W9AJy1Y6Okpa29AJ%2BtY621CJytWq21AJq9AKWwG5ucnJylWpSlWo2oUoylWpytAJSUlHyrSoyUlI%2BcWoycUoyUc4SeUoStAIyMlIyMjIyUUoSMjI2gAYSUUoSUSoSEjHuUSoSEhICEe3OhAHuEhHuMSoSUAHKOQnOMSmKYNHuUAHl7fHOEQmuSAGuEQnOMAHJzc3OEAGt7Omh7Qnt8AGN7Ompralp7Omt7AGNzOlpzOltzMVJ3MmN3AF9rOmFiY2trAEp6AFJrMUpsMSx%2BG1JrGVlbWmdjACh%2FAkprCEpjMUprAEpjKUJjKUJdQkpjCFBRU0hjAEJbOkJjCEJaKUdSRTpaOkJaGTpaKUJSOjpaIUpKSjpSOkJKSjFfBUJKQgB3ADpSITFSMR9eGDFSIQhrCAhrAEBBQzFQGTFSCClSGQBrADFSADFKIRlbBAhjAClKISlKGTg8OQBjAAhdCClKCCBLGAhaAEI6AClCGQBaABtKCCFCIQhSCCFCGSlBBwhSACFCEBlCISFCCCFCAC8xMgBSABlCEAhKCCA5GSE6EANKABk6EAhCCCkxABE7CBA6ECcpKQBCCAFAAAg6CBIwEAA6CBAxCCEhKQgxCB4hIQAxCAIxAAgpCAgpABkZIQApCBkZGQApABAZGQAhCAAhABAQGRAQEAAZAAgQEAgIEAgICAAICAAACAAAACwAAAAAxgLEAgAI%2FgABCBxIsKDBgwBCHAqlhgDChxAhFglEkY8DACkWhnEYsSNBG6xeCCSwJdShFCNLnvTIUuAhOQOnUAw0x%2BELSKG2tOyoQU4oSD9GjjFZQijRnRGLXArF5iKALTPlOLSBcwrSg0qWWhVINdRWAF2%2FXjXIgU%2BoQBoEpph5SKQDn2jHQpwSqiiAH5cuKRmIV6%2FchxouqRH4YmYglA7M8onw16AaiofCCFR6KejkvJb%2FEngc6JBOAmwg6wSQtXLjggTC%2FBQJQEOgUHKcuobt9DRXnBsBEJADeStdSDZsC1RyyLBIhQw5Im%2FYmLhhlBMrXswYKrfwgQ6GyWPFj8%2F1iJf4%2Fq2DJ06DA2vwuMO8%2FsIaP8th%2BLlaVx5A%2FPn1hRMI5C%2FUQFfiyWONAxqIkw4u%2FEhmGwGs6BOKOPj0AIAc%2FLACzzAXUciKPBgKpwQ%2F1nAHiUDD7LMOhwSEQB%2BCYl314TAsYkQeLvvslcKM%2FOxlW3b0hHIPLg085Y88J%2B51iD6s3MMKR8LdiI9IL9BjzTD4BPXCPVNW%2BR0Ah%2FwzIgBsDHliUJfgwwo%2Bl1ynATz4nJjmD%2FgMYw0%2BwcEpJ52NaSBPm%2FSMqCefIxahj5z0sGYbJA6us44GDNLDyj6H6OaKo5BeZ4OUrvwzWAr40LMOPYEAMAU%2FuIizDkq28eHpOvi8R4B2%2F9x5l9123TUWyKqtBhfeeOWdlx4%2F631XRD%2BSsbJObVsSRIA1oTjQwEVK9KNTqcj%2BFQY9ewa17DCk9WPVlN2OdloIVKIpkAPpQNLAs0%2F1s9eUTP5VQjqh2tAdAeLg0m4R%2BOq7hbvCHSJOCACEIk8Eegay7kVquJpvYyURoAE9aVJogwPrsDIhPxdnLFwIXgEQCD8oHbJOCM9KLE%2BadXB8HYP6yCNSIPikoGeaNNu88ndK4KNPpABcUl7KnEZ6SM3C2aDPFgQ4cBEk9GhQNABQS40P0HL1sM8Uz16k9RRNX3SJPFLrE6ptL5gNViAh2AvT2A64HTTZwo2dVh1WFcFPEf4pA8BKOgTIvaDTL6wT6bDFrkMA4n6nU%2B1OYb8AT6jLNstutNOK83hjDQcViD6GJjtQCBxewjYAfLh8NKqnvURhUKSnuQI%2BaO38Au1Js1JEOv4BMDsul%2FCR1upzp7WjQ0TwM0YIV4PFjxrMRyr4aQ0wBkCpgZt5SWxB00OwsZvvpAEc9%2Bhk9%2FXiEHA%2Btd%2F1AONF80EC3F3AhnudGutA8mTjF1ljDYOOA4D%2F4vUXDaQrf7oZhjjkJ5JoSeZfOjrNFvYRikvkRk66yder%2FtevxoSBghYMgH0cZEHdgAtjGrPNFp6nhtxAcGMveKHFbNOAfCmBD8GZEJouoRMHPOxmW%2F4SWFrY8B6R1axzIgPdoTSXkNKdrmXBId53Uhec1ElIdASBE7Pi5IDPzYwfodOMfYo4tRJczYyR4tSXTuMQjPVOCfsYRijwgQsCQOIeRdEf62wTAmss6gX78A4g%2BfCCWsVAbd%2BRQz9gskJchIKCBAjFogpGt8bI4R%2FDSAv4%2FLYoY2kSHsbj4zqWBgAfruNBhWKc3gaDNnpMIQz7U6BDqCWnICkwSLa5xDBU5Kd18G48KZiCt0QlLeF8jhUICgS%2BuLWt8zBzgH85EjJrJU0E8aGDNeSWbdRgIlzQo44NKwIA1NCPH4yBH0AY595sUyApzWkvZQrFMJ7nAHj4RwMeY%2F8PPhTEh31UEYxURJ3LGqO00WhxjhjyYhLDeJqABhSL2LnYOP1RBD4oMRD7YKi1yIiPERWNeR7t6HcwcMpzSZQP%2FejB0fKID7vwcU7iVFqoYhBIQNYLkcJR5CXaaAOHHAKMlwAlJUMpFw38QBxL2iT4PMlJ6y1oLVUKwAsIprRDAEF5AFglDXGBi55U6VXpA4ACsyMOW4b1NFPAhxJCAI9LOIAAU6VfHaJlFWGKK0%2BsmU8fn4khcG2LgDsJgUgIgItjCVY3hQ3Bw3yozdOowR%2BhEqYS4iNOcv6AsuoU52kMeLIGgOuwnrWGijS2phQas5IOBSMUUefP1k2ylBJ97A3%2BL6rE74ShH%2BmUIkRLSbCs%2BmMKDQsO1HornPgEBYiArIMDbBfIkZaUtwKZgj9mKxJJErWA2kknANBIvzBooHk%2FeN79%2BLFGB3xAIGko59EIxj65HJZq%2BNAAJOiGwfmmRU6AvYoDYnCRQl5TA0G6WSFhIswWjaWQ9ICHPOhBjx9Isn%2Fc2iS4bBOKfpyIHmhKkUOiF17J3FazmzWeHrGHQvQ1LZ9FFbH3NGC8S9CjBBisZ%2B%2FQ6g%2FJFDIM0dpLP4MJsH5qFCnLsoZAHkQg4xmrj%2FoKwT3WyEZmDeScQVmvcbmEtL%2F4ME3n6m0R%2FLGF%2BEjojsRNGj%2FQAs3dPmUfYXDAT1%2F%2B0IPuFGgY%2BZXLlK%2BXjhCQU5y4qPOdnds7NehjCg4oUwiiBT0UNyaS%2FDiEDX6QgiBrIKD%2Be%2FRAT1MEfIijCD%2F4AQH4gI8iOGBDGvjXFlKws7%2B42AZ9TN9tpxClEa261WI%2BRE9%2BSzpIOGBUasBYV%2FXITjXIAQ5zPEQIKFQEG%2BCO2MY%2B22mUIAc58IFDSjD2IRxw2y3oKRQaMFiY%2FyLJqQ7wcz3QG0zALe7G%2FC0Fih1GA0KRDnSLA85Hs8GHWHmaEjhKA3dOgT4goQHs6Zvf7W2dPoqg2CXhQrQp8JiLeXzXxnCK3vYis5AjroEyyyVtCnqKPtK8ZnsJD15bsmPM8GH%2FYNH1Wx%2Bj9I76Rh5B4ajhH5Ypgjzk4SCHyJzmoYjzWK4tEHK1CR8wWXfM5JGZxoRXH%2Frgxz8ilVZ57AMSDmn603W%2BE1z0o1X9iFoKIMQqyTgAF51aRw7lYoN04GPBVuk3Pu6xDpGone0%2FBvIh9gEPCl4Eo6xixUVg6XRl368fKOkjPiwd%2BDkRfksO6JNuICEeB2UoZvoI1ml%2BMPOZi3PrgxctRiCED83%2F5ebygEdQQC%2F6zQ8%2Bk%2FeD%2FE6TuCcFfW5PDf9LCuYU%2BqBM4R4zFztYPkXH8F2lCP%2BIoMj3ZJXhk3zZwR%2FIyVOum0uwXHQEUIIaxm7mUgI3M9FXQwySVQIl%2FoTyBWMA9EDAL%2F7vLG7sGgDu2G89hrgjZdBKiL8SWBMDNSiBSfW%2F%2F3WAIH8l8Ks1W5AG6%2FdKe%2BReXcY6DnCA2KGAwmJ%2FTPIDalB%2BANADagBi35ECSiAbXUZcoRYG27YgRcAai%2BOAfFGBW5ICYRAGrPMBYWBto9OC1zUWKKiCAzGDrBMCMLglFKh%2Fk6EGRVcEPrglHcg6L9CCxIWCW%2BB7V6EB3qcs0jd22Ud97tWE2HF9AxGF1ZeFWriFXNiFXviFYBiGYjiGZFiGZniGaJiGariGbNiGbviGcBiHcjiHdIhFXQSGKSB5XKgG7rdbwvOFd%2FiFU9Bye9iHEPWHXvgC%2F%2FTWhfEHhnz4hY8GhoMGhjYghVsYCEoIUZiohRpgWl1oA1jmhUABhqwQg1nYiY6YcV04il%2FICh%2BYhUXAZHu4iFzIil0YAp7IhT8gi1uoBrSohQySiVhUigsyBZERPqj4hVQBhrbYhdgGiLnYi6rIhYdQdFwYCq9YfT%2BANV2YgmBYjV8IMmC4jWDojV4YjK1oikiROtagD6tnEMnohcv4hc14jepoZp%2BWit9ojVuIjV9Ijl9ojl4Ijl4ojv%2FIjVwokFyIjl5IjHkiDzk3MpbYGtGohfMoivyohc%2Fohfn4hS20j2Doj14IkF4YBmogAAIwkBlZfQY5kgi5hQq5hQzZhf8O%2BRfhBROYcxAdmYi8qIWKRor3uFs72Y3TuIWHcEVeuJFdSJJE%2BY1IyYXZBoYqVY5FqYWsgEs0GZQeoQQ1llX1UwJFEJZhOQXDIANmeZZomZZquZZsuZZb8AltGZdyOZcywEN0eZd4KQOPwAN52ZdtyQOt4JeCqZaBwAeDeZhmSQhbgJiHeQpFwJiCGQaXAJmCaQZmQJl%2BaUGYmZdKcAqbmZeS%2BZl4SRGieZetwJelKZewoJUdwZWSUW5FcAiyOZvdoA62eZu4mZu6uZu8uZvecAvu0JvCOZzD6Q7A4A3EmZzKiZtMYAzBuZzQ2ZvlwAvRWZ276Q7I4AzPaZ3cGQ%2F%2FYAAK8cCd4qkOvFAO48md2UAM23meyxkPgAAI4cme0Gmc2SCf0Tmd9gmd8UAKbRCf%2BUmc7uAM2vmfykmdBJqczSCMEXGT3VKVABAM6oAOEjqhFFqhFnqhGGqh3mALGdqhHvqh6AAM2QCiJEqiERoFxhChJbqiGVoOt8CiMIqhxeAMMVqjE%2BqdmuAONmqjt1AOO1qj2QAMPxqj7gmfQwqjInqkLOqiSrqi7qAJYBAPTVqixVAMU1qiPXqlH6oOCTouELlpk0YQCdAMKqqlHbqhZvqhSZqmHYqiZcqmFcqkcCqjNDqnFuoOYJCjdmqhWbqnFBqkfkqhRSqlgSqha1qo%2F3JaqE8KBjpaqOggoI4qoX0aqFyqoBExMu34jgUxpm%2Fqp2gaqYdaqG7qqIlaqDMaqXiqp446qYEKqI46qKA6oqT6oo66qI1aqJAaqay6p5W6IFsACbmGEJwaqZ%2FqqKEaqKOKqLTqqKdaq3l6q4G6q3vqqoUKq8Yqq8qKqlAKrX6aq6vqo4Xaq1k4rI5arIV6rH6arIFaqoHarIr6rLoKroVKrYFqreeKreu6rIFqq5HqrYUqrXMqrtVHroVqroGKrnuqrn7Krn7qrvsKr98aqfTqp%2FZ6sPi6sPrqp%2FzqqP4arfLqpwJrZgQbqAbrpwhrpwq7pwy7pw6rsRD7rx%2Frp%2F8Tu6cVa7IXq7IZu6cbi6t1GrHh2qXjSqbEyqGxGqnokLJ2urJ22rI6%2B7IeK7FC%2BqrvSaj3GqlKC6c7G6gd66cAC6chu1sj66lEe61Gi7RzerVwyrR2mqrcuqddC6cza6c1u6cnC6dom6ZZ2609C7OO%2BrUQFbZ7WrJ0e7MJm6KzarRqO6dsG69QG6lza6d1y6Z3a6Z5u6db67Yxa6d%2Bi0WAa6eCC7mEi7KGm62RmrhY67Rcm7l2Grdz%2BrhzGrlpOrlaWrl2erl2%2BrZpurmi07lz%2BrmvG7pzarZ2m7Msu7cuq6p866isC6euC6ewa6aye6W0O6e2O6e4a6a6myy8C6f%2Fvuu8wAunwiu5xLu0xtu0yPu0yhu11Tq1RXu4tbqt%2FVq%2BmNu3QDuwQluuY1u1kRq%2BsTu%2Bc2q6bLq4Pjuv6luv7Eu27quo8Mux8nu7quu19Suy91uw%2BWuxZTu6%2BYq4DXy655u6jSu1RorApKvAjBq%2FRnu9Wpq9W7K9bNq9bPq8Zsq%2F0Ou%2FabvBAYy685u%2BjnvA%2BjvC%2B7rAPHvCD8ymKvwdLJymLpymMKylMqyl0XulAIy3OOzAH7y%2BIdzDGfy%2BJczAQky%2FlnoaR2ymSWymS3ylTXylTzylUUy5U2y9Q8ymy8umzfvC39u%2F2rrFQcy44RoMCaCFYaylY6ylZTylZzyl%2F2ncpGs8u20MpyispXGcpnOsxHU8w3fctrVrw2zayFOqDnzsxxNMshVssxfcqUlLw2yayNK7yJn8xmn6yGYayWQ8yU5sypQLxFqLyWmqyU3KyV%2FcGH98pYF8pYPcpIXcpIespKg8pQKcvAS8w1dswQn8w3h8y138s738F788pcE8pcOspMWspMd8pMncpMuMvs0MwlQLzT6ssbast9VMqREMtp8stkbbzUf6zUcazkM6zkpazh6sw%2Bjcvuuss%2B1subhsprqspEV8HdncpNvcpPY8pPg8pPr8o%2Fx8pP6cw%2BdsxeksytHMztPsznoMz9csFw2tpA%2BtpBH9oxP9oxW9o%2F8XPaQZTcUAzdECncUkbMnUe9BamtBHutDCcdJHmtJHutI72tI7%2BtI2GtM%2FOtNuXMUG%2FMwePdBrW9CX%2FM4gG89%2FO8%2BBG8qDO8of3bA8rcyqnMusbKaurKWwLMiyjMa0PLtWvdNYzatazblc7bleDbpgTdXki6pljdBn7cgFTLE8rM44Lc06DafVy8iBvcnBUNJjIdRDStRDatQ2itQ2qtQ1ytQ76tSMDdWELdVfHdZVHdIGPdeaW9e7e9e9m9e%2Fu9eH3a5jTc5%2F3dONPaVpfaVrLcxtbchvLb1xrdiz3aQ%2BPaRAbRuS%2FaOU%2FaOWXaOYXaOaHaOcbaOevcqgTbOFPdX%2FsU3Qpn3VI53VkH0Vyb2jy72jzR2jzx2j0Q2j012j1W3W1y232T3afI21wc2mi23d1uzJpIzX9dzbhIzBGKvBft3BGt2qg43doq3XpK24952m%2BQ3f%2Bx20%2Fd3a%2Fw3bA166w43RtX2lxT2kuT2lu83NAA7Ov63MD26mEQ7YXszfQ3vh%2ByvgOEvgzmrgNL3RUd3R9L3dpZ3Y%2BL3hR%2FrhO8rJfUzhL37TyCrjpUzj72rjT13TOY7kM67FPg7hQD6kQm6jxw3GrM29ru29GD7lzHrlnd3hU5rlNhriTTriEF3i%2BXzi5JziWrritt3iRo6%2FMO6o6Q2j682i7R2j783iUB7a%2FzrO4PUdwHJ%2BpXTu4bet0J0MZAQQ6QTBKA8x3jZa3jZ63jC650sK54hM5tRt5sTd6Eqq5krK5irt5hTt6Rid6FO66GdO6sat2g8BY%2F4jDlYBMgJigWLa5S385XQc5kuu4QVe5YKO44Qu5cOe0yb83XR9zR%2FiSK4AT%2FjABtaQDqZo6TWK6TWq6SzK6Sva5yv65zAa6HU%2B6Ape6K%2Fd4Pbd3XLt7Kl9zXJAD40mEEAkWQdBAL6OxMAuycJ%2BtqwuzqDu3qKupGgOpAku3wu%2B7oeOt67epLA%2B6nbeEmUiDuJwTWnjHeE1GGHjNAQCoeUQ8iI%2F8iRf8iZ%2F8iSPDtnAoSjf8v8u7%2FLoYAsj%2BvI0X%2FMi35zqYPM67%2FI9uvM%2BX%2FLoUKXo8PNEH%2FLqkKc5X%2FREfwveoPQ%2Fr%2FIs7%2FQ7zw7vyQ5Sv%2FMxP%2FNXb%2FO%2FufU6rw5QmvRe%2F%2FJBb6VjX%2FM9f%2FYuv%2BW6IU9hAAnE4l%2FOMweiwgp2f%2Fe2wAu3sPd83%2Fd%2B%2F%2FeAH%2Fh%2FHwuxIPiGf%2FiIfwuEn%2FiMz%2Fh6bwSZoPeNP%2FmCzwuFT%2FmYD%2FiLn%2Fmcv%2Fe8kAWSIPmdn%2FmbP%2FqYX%2FqmP%2Fm8QAd0IPqp3%2Fio%2F%2FqJH%2Fuyf%2Fi8IAlZ4Pq1f%2Fi0v%2FuCHwu67%2FuAzwuVUOSQU0oZUwP6oPH1E%2BnOLzEQKrH9HstGi%2FPsnrb%2BVtq3SK%2Br3hDfc0r1gMAOyt67Af%2BjYA8GFY79kQoOBw%2BjvLwTDRBtGeSKikdXB6HtMcrtMertKwruJQoQ5W6hI1jQ4EGECRUmLOZs4UOIEd2B0eQu4kWMBW%2BVy9gRYjZgHkUmjAcIULyRKQsCy6ZSpUCXKd1pAmMxpkhnDm%2BK3Lizo7pmDgAMJVrUKAAH4tL9UMNPDQBc64qEkhfiKIAEzdT57OjNFteOLMFmjGJs61iIMNFGbLgW4sSKbh%2F2lKsQZF2FJU%2FiTSiW70G1fwvOrCnYYE7DBukaBir06mMARcThuwepAYAa1vTJC%2FM469nEXhOvbDkaXVnQggMnbjv%2BGq7NxIsN3x2tF%2BVov4lXCyYM2zBi07L%2FNoYM2YGNFEWPW%2FWs1bRo07kTox69W3DrxK%2BDcxxNO7Ht6KV1D3RN07dg4KOF8yVe3P17op%2Bffw1v%2BrTZ6uRHYzesXT33xLwzDDzcxDPMOr56My292AAUrD34ImwuNcGgK9A%2B6sazjz%2FeKDrvr%2FX4ElAwAhOTTjX9%2BjNvQZ3%2BGw1CCWOMz7nRLDTRQMMyPDBFwzj8y78GTRvxrxINO%2FEvBPFScDQGDQuxLhhljFG%2BGum70DQdUdywxf483E7IkGoz6bYbTUuyriUTa1KwJ%2BWKUsoIqQzNyjKxxE9D03xM0EsXuwvzuzH%2F68vPtDR%2F49JJB4cLCk4p5TTMRiNxFCxLl9RxJx5M4%2FmQoDPr0vOgS%2BM5K1QKMwISUTBNKxIjUlM6kq9O3SoUvUPZTJS9RRmdksY57XuVL0plEiaPKq64goxN1Ck1Vrc%2BLUgdO6qoohR3uumiWGFKvejUtTKFrc2EtF2oVYOGfNatVSPqpgxsxYXo17qYRWvWkdTJVFN3CVozIXJvEq7fsd7UtThHb1L2YIQRRscbYtzJN9yY4D1I4ZuCFckdQ0RAYGOOg1jlPHnRcpYgdWYwwIA%2F4nlGAgMQkOVhhbgdqxs3yCBjkbPANcjSbjJSxxCbJ0nNXHTcCSecbgP1uZsN%2Flr2BOa%2BJIWVxx9XVMnSWuKwmYw%2BglF2oX13ppmMM7CBOiLZfra5lLM9EnjgCblyp48cgrD77rtzICOcJGgIIluMlK0lYqkRcmeTHHK4YieLO3LnD44RkCDyE55JLeSxRkZHnRw2JkTlDRBQoJa2DZJZ7k02NkCEbrbSmWSagzCH1SNOLoNMdIZU1pAZAB8r3YfU6UZjBNgeyS%2Bo81X%2BLOu%2BXqh0fq2uFx03Jo%2Fcgi7CETfsZ6WxoOVUoFco7RxOTnmtt%2BE%2BqmCX4rmi5cgjNyCHcDzY2JNNEVInmCNmIHxbQ5xsBuJDSOMClwrriaBrmzgCx64AG3WwgxfuoGBq%2Fi7lMAo6zF6islQGSYYpCGIKNBS8hk4ueMFndQ4Bn3tG6EZHwNP5xB1ViNwiLPI6ddSiBQZogamcsDE34G5EwmugBHwHFuA9b3gbM97OPPisJwLDGyhpnahMV0EK9sxhOxNVFVNjL%2BF1g4KBuVQ4uhGOCnJReJYiYNGkNxIacsx6CDBAFfLHPZJhw34ICN9OyGc%2B3HElfeorCvtUEo8uiE4BCuCYAhjAyCCEo2kIwF9E1LGJ7%2FnPJRIbjCE2NsCK3UkmUNiYCGoxDzYGoWUt6FnRuoEIMTzBDZvQHkHCsYg%2FEEIYf4DCH7CxiT%2F48hmEgEIZNrG5ZwRzESTzRDCb%2FohLPdDCYZuwwxN6SYnNbU6FLHQh6UYSQ4O1MHJBcB2ALAVC0MxjEp%2Bk4BU1tUWCuOOHCAgiydxBjmWksWjC2JgFnmFFJCotcEssngUXkYQncAFpm%2FPEE56QPXQQgxZu0IEJgtAFWdhEHWdwaCkmkYQT5MANrSPZM8gQhBMEIQ7P0KgwTnqCExwhDtjgRTw3UYUZnKAFUEBELZFJ0Zi6wXLffGNH4pEHjt1gEbX4wwk4RgkIXvAa1wAVFjGlx42lQlP4mhgFuQpFDaqDF%2B2A58%2B60IWnQRGdlcoVIQnGq3DWQq6TsF4f5FoLYZgDEXowhOU26DAOAnQei%2Fgkpuxp%2F5OvHrZolloGOaK6FX1i7JNtNIgBLSlOes5jMKWYpTBItokWxG8GtXCYMBjQshmobhNJaBkZRAA%2FBNhRGAowgBGVpUoDkDOHdGQALcyRhPgh4Aja45znQCc6b16MT2iJRx82xkjJka4nypJFH6T1B09sTh2pSCQCTGCItG5lE8SapU%2FlCUSUqAMbk%2FBCE8qwiFw4LBh5YIDk%2BrAIswV0L0sjXhPj6QmOUQsd8ajCyZJAQT3sUY5u2ErJWqYC2nJMB0hzxyqcGjkTpMJhviAebFlQid0tgI6whUKDa6GC%2BKkguY4r6kAvPIRwiGoetbDAxrpgE3c8YxFkqEI0tyi8Rf4YYhPPsAOypLHHVKTCDV1YBElJFo5JxKELhhCGRmthCEPU4pZN%2BMIkfOqJRSzCd%2B4QBiKuZYhg5O8ig3QrVuBqMGXFIxjWmwQqlRWOOHihDFUWxlkJgY0%2BJEFvGf3ZEDbmgS64QXvhIAROZ8CFPEjjLOoIhyGgMIM9K6IJXRDa5roR6BlUgRC1lCwCQBkTy0JEHbmw3iZ808EGI5BjClYBn2tMOXTMs5S35qM7grAxQ6hsjx6QRjwIsbEdcKPAhw7dxmxY3BUe94XfXC5aUouAMlz7dhuhdBUmd7KNQSHGUICtAY7gsFoYOnIt0HDR5hnEHIaWjoc2xDz6ANusUv%2BWJAJdM0H9SzIdbOx2wrvwJOIhawRsIAgKDja0E34EeSPAhuFQoQeOAINPxjiOOciDa%2BmIhHhgQ2PY6wMp6TgJo11bBUe48Ax8aqoWb4uwTISNO%2FLQ2Qb%2FgXgbk0AXtFsLOopA3h4QhsYUcO2NtUDAOUR6wvuwFQKfLAgB59hwlVU%2BlN0mDwpGgAXi0EY2u9WQBquF9WwIu0l64uB0bAHWN7aBUsyDtRwzwAbMqELYtsCv3fi16jzwWgMMXBjyBncOLFfqU7sk1Q85XD%2BPqL%2B%2BV0AP3VhEjesYD2HcWgKE6EMe5M7zRYRDFnu0gz0gF1t7pI5jm%2Fg8AvRwDShYQAL%2BhjhaA2Mrqm1Ke8WOq7bcAIwABtSiDBs7QTd4UY7HtUwCiWOkAbpgD3LT%2FQjxkEbEeW1KS707Ht1AseQqYD27%2FwHffNQ3QpKoEOH1l0LGTjoa14mAFqARuKau8jPmH39oe0AW83iGCTZW%2BpkzJXtABxrYGJTru6%2Bzh1Q4gjNoBHdIBeILH3twgypwg1qIh5lTgWewh2e4NlfzCHq5iOYiPif7oC1yh2PjOV6rAsGZIzq6gm5QMAVoNvgzm26QNwagwTy4lDjqpzkiBIehupR5HI6xAF5DuXppqza7irGLiRwyO40iKLWDQI5pAaQLgnmoAhHjuR56H8mZgRloPjv%2FEJW5g7%2BmKwP%2BG7ocCJ06uhRPMrXyuw%2FKKjULeLydKbuNQQRiUId5SEEPwIZnuDU0xKD5mz57mScumIfMQ4ATQIfu2pg4QAeN2QBacIhuWAV0eIZN6LsqwD3jEqdpU664YK4r2JggcAdZMDtiQD6TKz17IAQLwLQcGj5GnAStKkXJibRJ2KMhOEQgUkARkAAVoAVbGD3JWYVkmpzNm4QS3InzCxd%2FoxB1EIZmKwV7iKMu4L9mWwSUcAdfsB5qUSEo0Cx3sL08uEZTrIVSkAVcPAN7sD1GTII%2F8IV22MNFTLoq6Ct7sJc4cgJZKIVaiCMyCCSJiDmJoEVyeh5q%2FKRU%2F3gGXEQAg8NDBFCBReACT4jBpEuFbiAE6zlHN9gYFdDIPmCk4iMwjiGDZ6gEFgg3URHC7SOeKhAGYWAtA9AkkQg7QmrCSpHIs%2FM04plCjjmDzemuHBAe54I%2FmVQHN5iBDViEebCH7kqCGbMeO7CUPtjCMrAHpGJEYZgHY5SAU3rDxFOJxXseifxAg0Ajh6HCDaCpzVnE0QlEYMOx%2BauneOACG%2FPEBUiFgPOAGjsC1TuCEnrALsgBXrs9aOMm5IKh3tsJ9SIeQrCHeOi7IDg%2BdzC5DTiCPEiFKrMIdWKnaiGeOEClz4yuedA%2BdMCGYPAFb6iERSCeRbAHYZgcfyLIm%2F94Rv2JRsMxuTJAB6eSAK2iwjo8C%2B7bmJRRoTEsGiHYmHPsu%2BBCgCCIB0yKHwnYARBTBzIIrg0gg24wyec0ACiwTcYzyLeYv1Mcl9MTAWHQFG7YgY1xgnjAQwlgPYfBKgSoN3t5go05N6qrJ3TwQHScyM0hhjNgSXUQQnv4PdahoGCogjw4piR0jCVkwjfziSd0tij8ybVLOEmLhzcUAWwYrMmCrBzrhlTog2tLAnughFIiLnSQt6ycvyt4hlqwv43pA3sQyzgsS%2FSbzRslE3eYhBbogk5Qh1U4NLdUB1Cs0VszBLpErwHDxS7QlI%2BMLfupAlI6gVacKjv4Nvjrvk7%2FTEzdY8xRBItSk4A8MISD4rlKQL6Z4xgGaAFFs5SZ6yElrbFpIzgDtAftU5ZJqIIWYBmOMbhv7Do7dEZ%2BsyTdBJX3m4H3K8oKY6Th9LTu%2BxwVclLlZE576DsPUAGYaoEWUIESc4da4IKd%2ByTtmoQhoEE6coMA3QBPPQEVUAETKAM1ixnyfIh4sAOQbMY4s5c42JgkuI1r0IPJwkN%2FajD7XAXIOsoJuzARmNUW2MYABSVi8AIDRdCtVIFaspd2itAJjRu0uFCJy9D72dA%2FVJZVUMb1nDmbRIdFQKl5E1Z7CFZGJLV3e4e%2BW6RFUh0uyNHJCiV9O9CNoQExOpjaWR3R%2F%2BO5Vagpd%2FAEdpVLBECEJ6UnlHCfvDTSydkARsIynpMcWbgGWqixBbBAdaDFMM29JSXTW00Jgn3OjWkCdigaQug%2B6RuwOkWmbmowdOg%2BSuBT9OqGBjqZ5bs1QqXNQ73NRFU1glqFecigNAqH0JIAjEOAPnAYgiIEVIoHT9hCDbtUi3CH5USAc8TFJKA0dEiFGkWaZxCGTsAGT4gDFSqeTFTHZ5iEMpC3GcBYBCixo5GrM7qYXF2IeDg92xqMMgiCPlhPez0wgijWY0VaZUUyyHrDZ4VZbAtQJ7CIa81W47SHAp3Ibn0nl1XCcJ2ROAwXnjRXSkJXs1k1pMVAVN0cWv9EAIujOhWt0hOopXjQT3pSB3mTgA0YXg%2Fwy6zUUYF1CRTsGGEIB2yo3U4kKCSwhWrpuwFaRLAclbq8WCm9DaQLvlqor4JFB8i13W6QTNtL2U%2FcWWorUwtFOJg9AbO5FGHgrByYI9bL2TvdGEpIr4VEgE0AWnrK0ZYRAT0AsWs7WkNN3YPAzYkhqAedBAmW4FIYMHt9O8Bxh%2Fk7gVLohlpQIRjQHrDNVLK1h5mzALXrhhmwABXoqxOYnEmwB3ugsY1hKtkzgQ20h6OcAXeYuQ3Yv2dQAQtogT9oWcMZXPSTSHgrmmewnzqq1xFFB24Qg43JAVKV3M2xzw%2BMhyqVne7%2Fi4NU8ARP2IRS4EzvHMiIwta%2BbcnPfT%2FWUZZnKANC6ISFchvTPV03Y%2BCJWV3Y0VAqTNcLrUPZhcMcqzEJ%2BIPz5VUEUNH32wCWqhb%2Fy9z5K4NweAZsqIVgeAYxQl5UEyWXNbmuawEFE4HDu2AWkFcDxDxDTi4NhlK%2BnVIL5hj%2FCYcLQ4A4iIdrqIQH2M9F8F3EVFn2FUUjBsHu8oAyOOZj7sEmg4IcEAFPyIcZIx5EMOGk%2B5priyRRwUUQjYd3C1AyaIdlCIY9ikhlVAZ1mB39Ek%2F0I6jnHCByFS6NQjgJ8ADrsQBXgzZMFVvmRIlrk4AgCF7Smj8LCAKQQlUaZkS7%2F2m2MQyHa1O47tuA3dsWJEY%2FeIyDnhEGdZO40ty8S1mFDBC4qYQ%2Fc5hcYeVDbIBRe5i%2FcbQHvhuCPcvCjUHjzl3jl%2F2DeVhXYJuHeRC%2FhGvGwLnj09XJq%2BFjnzzXP35dZF3PN2SlZygF2gyGfbS9Yf3fI3gG%2FuGYrKzSGTjfZ2gBEQiCVJgHTlY8T54eUI4cERCwzcFL1eG5r5vGCGPlhL2dASswA7iC9JIF1cHrGYIf0sqJ2lGduqMj%2F3GwrFuZlnmZ9h1m%2FrIxycwU4DXF%2F3ywNC0Ddh1kf04CdEhBU0sCpLMDCurm7jJgPYg4g7tHHdCBiI4JBxYbVpUfUFIHeP%2FsyaJBBK5DABEwuM0xGQMAwqLBrTHcLsIr4GfDhr4DN0YEsR7eI%2BROAuIKBsLrJyQEwYkOl2CIZNxmyqq7MxVSgCA4gj0i5StGgKLMIwUTqe5jgLB%2BUyjoA%2FdMuGeAaQSQaTUOz5pGib6zgCM4AuuxI3DF40KqUMck6vQzaiRtQUOVTo4xgRkIhluT07k9sHgoA%2FjZABdEw2BoNlGVN0f20IDt5DjcikUYgllVAUyrsmdRB0pIAhSY1SeoJHWQBiytgqHanJKDgrNDQSiAAkwVni7Y8WQ5nB3vTXRoiG6oAmklg1r4cRpXyh3Hn27gAiiISZY10wDaGLQkiHg4A7%2F%2FroUOm9cyUJZ7rDsxql3YqoJ4okkMp0Hla1VRKUCO6SOuaO20XARCwDI8xzJCmASCmAdafGODkKgbhwI3QHGCmARCIASv2ZxNSHRvMsodLyZDFx5DwNId%2F7OaYuI8iPQqWKZJS6ZIt0DGBpXq5pdaqOXIMbwGG7zgsgCU262anDTvkRwPwLeqXGu64zmUiwdycz6UIIYuOBn7xrqUmcaIk%2BUat2MJBfA8Rh%2Bgo6OeFJ60WzsDsABJg3UEqDKRU50N6IbQPRkeCrrWCQeTOxkd6LvbcQdE6ADB7jobwpiTaYEdLWuVcJijobBScRhbOBp4iidNmRgRepaAH4yB%2FyuC%2F2iIOwsHc8Cgfy%2Bagb%2BgNgKnbwq0JPC5iRGGJxCCJHBKYaiCExABkD%2BCTtucRfBqEbC6S3oCEwD5IMCZBsuDJNh4CvKEGQD5GciDj0oCBtuuZhaB3tHjAVtaiYBaorcI4bm2GzsIKQqVxCoafXL6fj%2BntVIrbwkMqQehrvKWiC91fnmGM%2FDqERABjitB4bGDmhcBFJAC0kImJ0iCMIedKqj4VUgCmzeESUOHPOj5k%2F9AdfiDmPdtXjCEmH86pYz5ZNknLlABkB%2FSZFd2Zkdd9CGyOIiDFTMHPBADO8iWZ5j8PkAa9bKDOMiD1tmuJ7CbLrCcPLCbI%2FiDZJr8Z0AHMf8arzgwBHSII98m1cQ1%2FbXPocmn%2FeQVJOdRiHLgheC%2FDp0ofjRpTCd8oq7iBXZosGrpBum3FNMxo1aKpzBqnVfTp63oBmagXlgjGdg%2FI6AP%2Bv2SoZOyWbUmDTOhmgTh%2BnAxGunXImm0COkvhmvwjaePpwoKIzQCCHQCBbpD1%2B2guoICE7pTJ%2FAWQ4foIg5MGO5guIYDN3LsWLGZAwAiR5IsafIkSgAJmkn06PKlx3gyWwokRyyeQ3UyFQqUGa9iw4QOg7pr6G7msxY5jniyZ69bCwQINikUqk5oxZ0wt26MYowm17Bcy90Sa1ZsMWdn1750B0YTT7ZyH5bbePWqx7v%2BHfWGVZcN2Eu8c2HGAwTo5%2BCO7oIYkIqgClh0wLIlnku2slx3msDETcw3MDpnatcKzlva5a26fT%2FPVQcyJezYJ1dGxszVmy3bLtV189B4gxs7M6RuEFZbt0uvx5F3vMwc7ejnW93Clc41tfWtf7MTNoxYtzs3M2bkyBMu8mTuL52rV7y5c3uBouN7xE7%2FY0jZ%2BmPTvr8Rt3ru9OGYAY1JhQd88Snnn0DsMZgWgwS9lWB79jG4XYSFHfZcSxp1lF6EDt6nGWcRhhYdgxbe51p%2B%2B7loUn8RAqieOps8cQKOJxyhhzcmorMggyLeB2GE1FGonor3Ycight%2F5B2KQZRX%2B%2BZ6J85mYZHwsvrglSTEyOGOA7hx0kDvEUGYikP4JSR%2BRDBp5pWoXApahdyZCqaaUblIZoZURYtmellxy6aV%2FYAKq153%2BpXnfmvG16d%2Bbfsbp35L%2BNWnnmVGaSOKR3PWZ4qT0BSroi4TeZ%2BiTmTK4KH2NtvfoiBPCaWKl910aYaKt5gnpngx%2B6t%2BfNL5GaqksmYjqfbnSx2p8rqoHK32RgkrrnEzWiauqjO46Yq%2F%2B%2FXpfsNyNSqx%2BptKHLH3KKvhViNsOiWKs1UlKrYm3Mqiues5mx2mV8IIbapbDkluusTLmhqmPzLanb3bQxictsADHVyt99qZqIsPS8cunv%2FT%2BhZvduCgVEUoIIhEQRih8aGAyyiqjZG586MaHr3oK5%2Bsumx23B%2FG%2F9NK5IbYY47xzt%2Fd967HEwraIkg3p4JOCSHXwg8s9rhAAAB9T48PK1TAW%2FOXBQaPJrqYmOryzrPNGSHF8Fiebra6bFk3f0fF9bF3IJalBDz3yQO3AOqwAoAY%2FPwAuuByFz%2FZ1oWHfC%2FeyZOPp49kBpj3t2tVaeu3jQstdIsc%2B3i1d3iSFIschTwPwwj6BAABEP2GksA8fABTBTxgnBdBMp9l5o%2FmTPY7du3QZS1e35aAQL93o0rHdntvpQr7w0AGCArqvOle4qcAnhcSH6j%2FwIwcANoxvPvn%2B4pP%2Fwhbttx8GLaLJPz%2F99dt%2F%2F%2F3FxII%2F%2F%2F3770ws0vK%2FARKQCb8gIAL9t78EMtB%2BtrBFAyMov2xkQRLZkKAEA4jBCOpvgw3MBh3ocEEPJlCDJERgB09IwGxIIgsjVOH%2FHghDAi5whv6jRQJkAz6oqQ8APeAHHNAHgB7%2BQA5GNCIfioGMYjCxiU58IhSjKEUoAiOAU7wiFrMYC2BksYtedKIRMvHFMWqRjGaU4i1uccY1NtEZFVwGG9loxTie0RZzpOMYnRFCZ%2BDRjLGwRR%2F9GMgxLqOFfBykF9OIyC%2FecZFTRAYOdai6F%2BjDdUXoxxZSUEnbYRIlvDsW8JIlvAj%2BeWV5z6meepDHHbcob1aZqxfngue5Il3PlMxRJXdQua%2FuoWSHAHCAOIbhgEDw4wUECOYw9%2FGCxS2HOzJrD824YzPuGO85lVvl5SLmM2sBrXPt%2BpwtkYPL7DSPOaUrSSD6ATUAhAEf69gHJEQSBn28M57MPJbjLja2Zlqnmsy55r6y2bNX%2FsxJb5ulnrDnLe0hKWni4uVJXjCFFv2gDlPo2hDncNGXMe5U%2BTzoPr9pNoYGVF6YkxMsu6nPsiU0nLoZp3XKiZxzDsxr%2FLTOM9UTzexMMzv%2BRA5ArcMzpG1zcyoFKUt5pVCjkZScDgUZRGt6T4P5aKfW6Wk%2Fddmwpmr%2FTKBEJSg3DSo9hCrVpbaBKfOeireoSrUkMGtPTrljVelgtXhatU5Qu2pSbYLVqGKd2fRuBs5%2BiU6tpGNrW0fyVvXENTtzfU5dn%2FNT3eT1OUO1m2GdF8q2xRKpk5vSUunG1bRGiKaJVUlHz%2FXRsYY0qf6pLHMuW6HMPud56okeYMnKrdDGB62npO1MEXvaxTpztblt7WcjBFvkyLahRbVVZ1nr2mjNrbej%2FW1phZtY4vrOuNAMbM0kpy3KXZe5XsXscysW3eNO92HVbY9vmSNT3Zh2u6mNmXd1Cl5pijduI93UeWebXs4eVbrJLSthXemf%2BraVuzjNr1z3y9P%2BNuuu%2FtJZLngC7Ny%2BQrfA7D3wbs2KmfgiZ762YbBUHSydxlrnscyJLHMmaxsM26a5uQQucmzLHdx%2BV7fU5S18y1tiHJ9Yuw2%2BL1wh7FgJX5XC1CMvgPc6UJQWFGEibWmC1bZgI6cYyYxVcouZTFcnC%2Fa%2FRdLwjQcMvfX2%2BMoIDp2CV8Tlmqr4OSyWjouRA2PkyBgzNMaMjZ2q5tuyWb8%2Bdi%2BQUylk3ZgYMyims5eLW1UxQ5bM1LSwNRcNaDQLmsPq9XCb20u0RHtK05hpdGUePbA6M%2BfOz8mzbvasmz5X5s%2BVCXRMiWwbHWeHx4Z2c4izfFI5L%2B20bo10dyedMEv7FNP%2F%2FjR1YnBNWk8T%2BK%2BhBvGPRVwZEjNa16me86qR%2FWBlI3e8ZnYTp3M96B0XOsKHHrW2E8Nt26DaM%2BAmF6uR42rmwNo2srYNrRNj62ine9pUDquVRR2g9yq6sNkttrEVK%2B4VgxnPlH4xs7MK5TNL%2BasH92vCsY3oeA9m3qf2tr0hHnHU3pTi5CZlxu26cXR3HL3UXjOof63wVTK81A5nkKrxPXE7V%2FzVF9dzzCXrbKBCezDSxu7NCZ1zdwM728Lm65ZVHvF862bfyOk3Zv6NmYAPZuBOLzjUP95ha%2Btc5PC%2B%2BpSJvXKb4vPlq0p6jJdO2abP5enyRXlieG0dX1N95%2Fvq%2Fnl2TF6Zeg8m6MTium28rhuwV0bslSH7XMzed7T%2Ffd29bveS371wUiee73NhfGvu%2Ffiht7ro%2FD56rPHOZ73P2PRs8fuQPT940IdZ9DwnvXUUnxjUy8XxpII8ZiRvG8onxvKJwbxcNJ8Zzuc%2B6uyeeuirPnK4e1zuc%2B8S6%2FXt%2Bq%2FD3t%2BynzXt%2FWz7teC%2B27qXDuGzb3ihIj74618L8dlifEEhvzLKxwzzDYbzDQb0sYX03R71uZ%2F1fR729Z72vR2caZn3fZ9I9F9i%2FF9lBOBcDKBlpF%2Bt3Z9ZtB%2B9Ad5gCB788Z7F%2Bd7hAd%2FxgKBZ5B9pqN7xhV%2FXjd%2FklV%2FYnR%2FA%2F3mgwLlgWIjgyb3fc8SfA86fxtRfC%2F5c1lGgxLUc0dmdoujg2PFg2fkgVwDh4pHgXJjgEKKg0akg%2FbHgcwjfYMDgWezfoNBg5Nng8uFg5Unh5VFh5lnhdCTgCAohcxBhCj7g6JHcXJDh6Wmh%2Fskg%2F6lh8rEhALph88Hh88lh9NEhTGDh8AkiW3BhHnrh64HhEYrhLUEiTJihWaDhlljgYGBgYmigXHCgXBTgWhwg%2B9lhEC7g7jXgHhqhZSHhGHriS4CiWIhisThh60HhfagiW7DiWbjiWUhiGVLiWlgicujhF%2FLh7%2FmhXACiXPBiXxgZAYQARhGANzZA12yj1rFc3f%2BFXBQCI%2FrNHKTAYhbi4TNiIvlp4i1yojjpImowYygaGR%2F4jUjYgDWIgziswxQAQArgAj2IgxJwFDrWoDBGzkJOoTrGCzWyBTaGhTPqBjRmojSu4ESuhTVSJD72onA5AB%2FoAz2s0xbwQyhAQij8AACEgjyEwTCsw8rQHVWZ4zAyIgE6ogHao2Kw4yS6I0bC4w3KY2zhYicq4QSeBExaw0mKxCGsQwg0gEiEwD3E0xT0Q0KaBAGwxF18JViGpViOJVl6AzGQJVqmpVqqAzF4w1q%2BJVyqg3LEJV2OZTnwQl3mZViKhl72pU6AASjghF%2FmJS%2BUw2DmZTac5WHSZZMsJl3%2FmoljxuVdRiZcxsP1CCZlqiVfZuZaFiZnqqVwqcEL%2BBIA4AI%2BpMM68AEBmE8dDBE%2FqAEAEIAGzOZshkAtUANu5qZu7iZv9qZv9uYvZMJvDidxFic1ZMIvGKdyLic1MIEuMCd0%2FiYzCGd0Vudu%2FkJyWqd2doMVOIJ2fmcmMMN3Wucv2MJ4Vmc33MEddMN5RqctZGd7Lud0xid0OoIVsCd9Kid25udyhid%2FGmctjONI%2BFIDsAIrTAEkYJIQic8cAMAUGCiEhoIVMAGFVqiFXiiGZqiGaqgRbKiHfiiIMkGHhiiJligT%2BICJpuiHjqiKtqiFGgGLumiLRoEP%2BEAUyKiM%2F8Yojqqoju4oidKojfoojwppi%2FYokXookN7okZIojC5piRqpk2poAUjSOo2EBshDKCwoP7CB9wSDj2QDIlaGLSjiYDCBMZgIOPBkKxaDiajDWzzkqYEDrYRp4xkGnIopmcpFmrbpZtypwLHplchphOij6jjAFtjAL8EDyeDDIThoPwykTX7JZn2YqPyITloGL%2FjIR55FPABmR55FYQqlbWRkPIZIpoIW2%2FmciYQq0BlZIOgD1GgAPIhDERDTFpSmQOKCPJRMpDZOQ66Ln3ZgREYLUC6jqGIGqRblRobhp5rFpp5FRW4Fg8nBOqxTEVgDPsiDaq7OMLgTpPaqR%2F1qe%2F8Q41oYo1kgYwgWayAea2UkaxsaJXMhZT0qpaho49I4QArUpMnka0qQ4lyY4mCgIluQ61mYK3REWbOKRbRqx6RKXarKn9v1IffZ3BIyITnepNjAXLCuopoeo09yhDKuqyyeIC1Goy0eJT2%2B1MdyxMIGBiGm4cbKBcDOhcCuBcGahcGGBbqKRcheY0iKxUWOKlG%2B67JuYsKGxbO%2B4M9yhS%2B6iL%2FKLJ0GbJ6m4qVy7LA%2BjLr6LLsmhrsmIryCh7yqLL0GjIDaV8yyxczKRc2exc2KRc5yxc7%2BYNaC5NYORtdm4NSWa8fybNie1cpuRMvuxsuOoiH6X9TSbN7abNUW497%2FHizHHe11LC1XBC2yDq3XFu08Qu5WJK3CSi5MNO1%2BPC3aHq7aJi7bLq7eXi3a1JyAjWwXlqxGnmy8pqzfji2gDO4vlmPG3t3ZFmzj6uzfSgjrbpjafdrDFmHETuPEtm7FMqHorkXassXamkXbhsXbbkXcXuHc4p%2FnwgTltqvl4u3X1ljfjljw0sXDWezFgo24hlfv4uzvwu359izduu4lwm6pyi7Y0q752q7SqO%2FznkX0rsX0ikX1jkX8Yu%2F8bi%2B0du9LfC%2FXhu8pmq7bJnBblO%2B2nS86BG5e4K7TFu4Fkq70UrABo67vqq7lDG%2Ba2e874q%2By6i%2F58m8G%2B%2B9Dle2R%2F72vWQzwWRRwWBzwVlwvTGRvHapwpxVvteFkhQ1WBA5bvdpwl%2BGwWOiwWfAwV%2FgwTADxSwhxJDKw0tbtXNztBI8voGGwvGkwB%2B%2BFB4cuCJeiCBMwCfewCcMvCmMTEasbCw%2BlCxMtDI%2BxDJcxDYNMMOSQxQZwDrfxDr9xFcdxBc9xSWnuJzqwS0Cw3Uqw1IrxrZFxyZkxJO9FMDgxpEFxWEixWFDxVljxelhwFi9wHRscpTTs9R1vLSYvRy4v8S7l9xFyFBvyFCNyKSuy9aKyS2hxW3Bx53qxXIBxJWMuyjryS3BuWJwxR4AuwYDybejyKPMyTJiyS2BxMKsyM9%2BjMf%2BzBTIjriVHGyb%2FoSan7yCv8b9ac1iQcjb7MgIzslAR8zNvckdI8hdTMjkr8%2Bx%2Bs0c4c%2BSqs%2FOyM9S2L39R8xUDs0cIs0vQL%2FeG81qMc%2BmWs9OdczWmc6t6crgpNEyI8jtj80tos0dwc0N7c5wpiSszICybrCwzKy2vcPNSIC6HsjtzBTyPtDz%2FMEN3hEN7BEQ3sERzKj9XtD%2FvL0B3hEBvBTTbRRpPs%2B56k8Ye9d4hbErThz4fc1GPsEX3HUazxVI%2Fcml1MgAb9Ogi9IR59Db3NEf89E%2Buctq1ckq1dOy%2BtNHGdBHb8tzVdDWjdZOpdUmz9Ua4Ncja80DfsdDm8eX%2F7vEl93Em%2F%2FFacbTQAbZHgDROi3Ry7PRC07NeJTXL4jNHZLU4b7Ubd3VmfLVHavRM37JZQ%2B9Nb0VOZzZlc4RJ%2BzRKS6BKzzUSPxloefZGhPUugjZ%2BlPVsc4RlwzZmewRJN4dgDwRhb0RQdzFiV65iiy9V87FvDwRwg%2FNGE3dUrxTvXrf6WTVuY%2FVKzyJd569dZy5e2%2FFq73VrC%2FBrw0RsK7dmnzJnW5ZhM7VwD4RoTzRpH7Jp3x5qn8V210d%2FT0QgezfGSnV4M%2FYHkjcTm7du7665YdkSY51erxxfb8Vx03dyd8Ry03ZzC8RzD0R0F%2FN0g291h7F4m7NjozNkH5Zk%2F69ecf%2FHfL9EfYv4fa91fsfWfov1ikdwiyczhF90jGf0jHPIgq%2FzjQ%2FEh%2Bt4iHPEiG9Ebbf1bU%2F4xJw3yab3C6%2F3Mrc3KzcxbGgAH7jCJbgkADSAHLjCIfAqm7s5r4Kravn1mD05Olz5YGe5hud2lVm4f2F49iy5OSEWAZhmKIgDPSBq1rCCPOACVRKTo%2BMCRoEfnqNDlLvEjlN5jwf2j5sXXHfekE9ykffzkXt1koO1am%2B4SKRAarqmHBzO4BQO4ITCrKv5sV16pnvEpndFpzP3p2dYqFefEeOcl%2BsxmP%2BzmMc1maeEA1yNEmDS7NTOD8TOtNsO7pxEV2a3QPxOVf%2BN0t1xu55r9wK3UnlveYU7%2BIVDSi0tu6hDipGlAEBqgBChj5aSjxJcgr7vuy3wwgP9O8AHvMAPPMEP%2FC38UcEnvMIvfCzcwsI%2FPMQDfBgBQ8RXvMIjvMVnvMDHAsZrvMcTQwURg8ePvB2R%2FMhzvMlrPDGEkMinvMU3vMtnfMfH%2FMITQwu1PM0%2FPMrnPMTPPM8TPDBUgiCnRAo4pUuKT2v%2BEBvcOwBowAs8%2FdPjwDF4A9VXvdVfPdZnvdZnvTPcwtZ%2FPdiHvTfcgjOIvdmfvTc4J9qv%2FdZnQyywPdxjPRPFPd17wzmAgSTUPd3HQjboPdw7gy34Pdufwx7swTkI%2Ftr%2BQxDio73bLz7aSwIYHL7ji%2F3cT77Y873lh%2F0uDP1JhIA1rIOaa5IlSfsmRfutcmV85zCXx%2FI5vrgfn5m5a3l7%2FDdRl7pRn%2Fppp3pqE3pwjSMBsAI%2FBEIPFEEJANMwaMCrGlMwacAh6MMy0Tl%2B2Xml4fm4mzifx52fIxygJ3Fvuzuxszq264M%2B8MM%2FuM4UZOs%2BNCoAbAH6qz%2F0J5n0Yxz1lzg6nLjwcvsGJzg60L5ZUDRXAwQ6gQMJFjR4EGHBcrcSNnT40J0mMO4eVrQ40Jmzixsf3irHEaRBdc0cADB58mQIJUVYKklh0oYaJQROxpyJEmWCZupC9hzozZZPocD%2Bsgn1GcUYT6McFy4NWUyj043uwGiiKPWiR6wXswHbajEeIEDxvlYkWvZhU7QNI05c2zDj24Za5YokiRNvXr17TepUWrcgUMAHzw4uiPSvYbWGB0JlPJCq1ccC6T7uOhld2LGYCz9ezLjt1cdxMVc2PLIkX9WrT%2FrFLJhzUcyIJ39m7HhyZNGMTRu%2BPFkz2cmdGdseHBoz6cm9AaNm%2FZyv68mwh8ueTNszQ8y4H%2Bsu%2FXHy78fBY2M2Dhj5ZOWPmdd1Dh0%2BTumPqT8mzhh7ce2TuYOuutuw9uoSjzHyqjNvP9AkAnCw9XgDj7H34ptwPsbqY%2Bw%2Bw%2FJTLMHbouruv%2B%2F%2FMCPQMAPts04%2FzNIb7UP2IDztrgkp3Om1oMqbLanaOjSsP8O8W%2B5F37wCTizhTkRQxQWTa%2FHBySSUEboKDbvQsAwH23Cw8wDr8bgQgRxxyPGKvDG7JN1Sj8kAg2wuRiijpHE6Gw%2FEMbGN1HEHT3fqbEhLoe7UU6A%2F%2F%2BISJEEt%2BtFFMDEzca0%2F8eTJyrrOM7SsFRlzUE0n23STNSkHo3KwSOvC8tBuPNkEVWEATWtHo9TBBtVS0FHnGVRrUYpQO4NJdc%2BDEH1LnWCFFVAuEgdj9Ks7a0XVE2ncIQZFDkVaNhW0LG1UWJ4w7SnbiohtdFNOVfP0InfiOTeebh2CTZ1z%2F3stS1S5SHUoWEJUQABfBDaoQph3CeqzJ3c2wfeEcOKJwwAEkrgq13KPwDcPI9nyslF3nikF41KE4WVNwIwFDFms1AnHDRHyRUCELmzxBsmC3PkD3xz89elatLpJBeNu0Nk2JFlynpmyjuV6Utzo4ASpG0P%2BWPqPVGqpJZhgGxJMnVSWpgRop%2BKll0GL5m1InS5OPlmEVLr%2Bt1WhBCbYYDcMMGBhgRq2SJ0gIJY4oV%2BT7aYMk%2FPdAIljsv7q47pCdkqdboYYO18UBNfRIHcIwVeHwTmq%2Bat48sg3Dnd45iicFvCd5GyCvkWL6KL1IvehqhlXAAELqujGX8HicduAI%2F5Kx2rrvEnuHKSvEXLHjXxTtiOHfGcI5y9BlVpI2EBXnfVRke6UWqC1ESg4HkNMMKELhp3JE%2FtApb5%2BoGD1rPvuivT%2B6mHGEVDhGculKlyuw5dSJ4l8W3DjDKLDVxUS4zyCRI965Ttg9Q5SDl5MDx2So5z9yqWkoenAf%2Bb43EZCN7rdBU1TqVGd0SiYvlTID18GEALzEGI73OkOML07iDo2MQMDXAFvFRGeSISxAXwF4RnuEhsCDEC6WalDGJNYRC3qp46FYEMYwpiVLyZxqzthYxKbwMZu3BGOVSyxG1fRXsES5wtfPGMg1%2FhFLRaxiWeEQzTPEEb9qCjFCIYjFf6TCGL8IuY%2Bin3FHYvI1w7skAe74St8C1zfAc8HqOihL32P%2Bstl1KfAtehPbQNDpMHi0Y1DIsAXPOEJGycRjC0OBIpSpNUkSkE7Rj6DEpMQBhxdho1KLEKKYpwcAipXKQuuxR2pgF2%2BJnGNqCAwfeVTHwQ7iAAjRhKCHkEgJFEXrhHihXX0OiG%2BoOAGN3TBbwgwxFXudC48CcYdhghCENwgSkeaq3nxgCD6KOUyYpADgtR75%2FTscYWEdcEeJdxhQeJhB3xZIBjk7MYM2CmLO9ViBxbAlwQ68IVulIMYVbCABf5wBAkgQAJOeIYdTIAvEYwze4uYwUcl0AJCUGSMBv6zw0ahQBF1xAEEH41dCxahp260wAItiINELUCJeCyiBR%2Fd1wzaB5E%2FbuV2MUMXOoLwNhVABh3CQNUbRdONZ9QPG55Ao1fHuolaZA8dy%2BKqQLJBDHdI41SrCGMJOYJJmkEBXy1gYQRX0QIkxKF%2B7pjESicqgj5krwsb%2FYMTJDo%2FrGVPGFDwwEFzMAml8MQOJ4CdBXLQ0wjuspeA%2FCVa4sGFsT3BmOggq84IIo2vmuOOWhVrBAXSzGfeSRpbxd4twvHVMIZDFp6YazVFeM28ZBNs20SAJ%2BwRj3nUwocIqAJMTZWHOExCFt4gxqyekYpU5GJkODMbNgyRh2pRpBR2wP%2FlVbqBsVvVghB%2FsGIkn9GIOBhCFrMK1MVKUb9aLG2%2BteifwpxGwYESxB1OmOABaZcuJJ6AcQbogjqIMWAinuxeCZvoKu5kCPnZAU%2Ba5J7bFIYnDzNOAqVwRzfCSUQPdIMSKERAH50qGdIaFGWbyMw8StGEL9ghUJPIQXQ30AJDiDIJHRBBHCC8gU2UoQMeyANTJWCHeVBiyPgq8h944o1KPGGyIDVBGVx5yTGVRYBdwJs57hksTzR2bC%2BNRxUOqmEt90sdtSgp44CnjiugmHQS5CVdITLaZD3DZAqowmYrcQ139MECG9ABZAzRgQ3MgHaEACq%2BPFBZntgWpqtIgt%2F%2BNjAEs6GDF5TYQAe6UMOPioDMhKaXNY3bmqPZSbmbuEo8MIiAmgbyXvlagBAq0a7iKSwe2PChCv6wZ1%2Bn4pMbWESwagG7HMRBpxJIQv1mZQ47hBkBC5hBJ8iiOXyVwQnZLsPIIHyyuF3kwJCJXxnw9hd3IMwAPJ3EE35IYQUjct%2FG%2B0MedPqHeTwjulWYxBAlIIx4iLht%2BEoCWWzo60kYot1x6GS7ERCEIVzBHUxFmSEWsYN80dgh75NKIE82AzdsIhzEaAdMO6HTsZGOfWOrxZ8RMExnpsLmJ9M1M1CQL5sfAbZm3sxWEhdszxbkLO5IQsKOsIhF9Brkc84XFBb%2Bni9DkKXXHjgDIUQugVQ8PF9emAReEbC8eIBW1mwx9FYELQJhtFsMjvaFTnU9q0MC9MRjk4AnuihAnKeixRMdZ6o5rQA7G6AMHwxJ6mrdl1tfxHX4Yq5zZeG3KjwXzvkyQE2jimxsTJYBKB7bBp7hjlqkPuhETIKwoGDnfFmgE%2BbaHEgZZ9kW507yBIn3rLrRbjfkMH3CWIQdVtHcSZgUG8T4t%2B7soUkELKK58auCPfrww3nYwx4D%2FkP12Vb6uKVCD2JQhz2kji%2BNFx9fuhtZLXSK%2FXkII8won5iN18J2DDdhFWzqCBJmBgzBXgZITz5JB3RAd%2BiMYJIA0waQlwz%2BUIA%2BT5NaQGP6APYcSumQz0%2Foz4MMojBqwRDiABuaa%2FdkRus6rl3UQeQIwR5KYaIoYR7iIRxEDgrswQGhYBmaK3kQoBPsAe586UxQ5wcBigzwBQQ0gn8GKF1AUAIcquKGQGnajd5sq5OCzQPKwA60UBiIIcYOKg80La%2FCoSwor%2FKQKyEyDwGOoAu4oAqi6%2FrsAccwsBaGaMQkLtnCTASqaHHwZQdkwRB0ahKeS6c2wBBWwf9KYR4ECV%2BEwBMmod30ytwGSBYWIbrIwB0Q4Qd14A8sayOGz%2B%2FwBeRcZlXcYR58gRCqgLD05RikD1%2BOTx2C4aMsoF%2FiIQmlyx5Mq%2B3%2FuuAKuuAHn4D8tifiSiwznKES7AAKVGCY3q%2FdPOuoCMaV3OGQ9C9vnorpuiGxGMcCjEgW%2FqALngH8cvEJEhBflidxVvAEgggb0OG%2FukAY7GEeyiD%2B5uH5UKYPoiaL7KgDD81vXsqeZIPz8mAZh0kFHZAMyEIdeg0Gj01mBCIeYGZ%2BwqHXdKAJuKALBCgPhHDBRKsIkwUEEaAUYnAB8KUR8OQeReAZ5uEM%2Bg0dSiEPuiAc5NEBr9Dw7OHEBq8GhcFvygAM8wX77MERPQAb4g4h0LDW1PAolSvCnGBWwoGNcmEewkEi89D0wswNwE8ibZEsgq0QQ3IR5kFPRK4Mwu%2BH%2F%2B4pHlahsSbBHnavBSJoHthOzexhiAAq%2BIQvR8Di3x6SIMawibABCj4qYQ7xFf9NFkHQFttliLZviIjobRImd4bRKhcmmETnbXgPAZxR82DKEWfgsqrRA10GG0UGFYPhD5bxZPQqguJBGAyBFXWqpnLODhRyBXFIv1CRBKsgqepxFVJvolqg1fSrH9GMFI0kcdxAD5iB2h7mMhvrIBFJIX8QBhdTOARLy2oh0RxTwySMIweNCO8SJOKBHrdHGKRBGIJt9kZGgI4MBvAFGl3vD66gFW1ydHQw%2FnZtiITgJxHAA5pom0SgzESG1tLw8uiGKfNFAWCNhdzMDbKs%2FI5t4v9OD190rRJPgHZsyxBjh9vEE1%2BcIB5ecBmKghpjsS1%2FiCLiYYhUkOfULHjysiIK6qASKnt8IfUsABHoMmE2oNU2AXY2oDBj8Qlr8RYXcxfP0Q3KoAy8yQ0WAe2I0fzi4Rn2bAbyYBWOTTMRoO9Ybnum8Q%2BtcXhG0ynCARtKwRMMZsU2QQjyxaiewaMuzDdj85D%2BQDhWkN4CpRbiJ2F8U3e8QQxir%2BMCNHPOjOnYTq%2BUIh7u0QQCsKrmxw2sJmbaxQFZVB2k0x4c0lC7b3ueIdh2QAyQVEkLcQg9EjztBP5AagNONdtu5WA6tBOkkdpygAEuU6fo05nsge2ODyKP7QT%2FGA8BVFMdZBBlABVxBjQpC7Qi2NANlGgRUsFZRMmTHBNlHlQPJRQBUqFddi8IggVDEXNDjw0KXBBfFCFEM8MwS5QFI%2BjEPDMeVjQ0E0IU80ynciCIbDB%2Blgsd2o0t7SEMfRQWEeAwhVQxB8gexvMIwA8n%2F0CsYsr85kGTiBL8%2Fm02S7Xv1GEVdIoGk63dvNRXwNRVnkGAmHRWoLSx%2FsAd0rRXyWAThghO8aUP5hQhhcMcek0FumASCNYdxmEZhAF55HDGRnUj7CpgHNHXOMljtQwbEDMe7SEOHnUFJZVSNckCGNEGfzAH%2F80LenAelqYUDCZU6W7unEJLZYzekMiH%2F0QgfhIycdqz7dzAE46NVtmS7aYLIsczCPZTBczwV01KWPeHWI1LKWdIuTxBLBcpe6qAAOXrHidzD%2FHFWisxW9VzdDK04XgCFzv0Q%2FGFEMYVHUTODsw1W9H1HNuFXVuUgojHf66gDEQOAZ4gcfyGDG5GgIiyX%2F81doZ0gDLUX4NhESTgbcYP4hYWaicBG%2F6gsY5PYkXjB09gWT9JYyOHY42imTBNnq6MEJ%2BBpWoB%2FMZzZRGgZSHyZWeFFmPHF%2BwhH5a2Dd2BEvQAZQ%2BOEkTu3coCaLnFwmagC7qA4%2BJgHlYhX%2F6gGyYhup4TAZwWcztJgFQgDwyhXtnyxCxAD3Q2X%2F9SYR66FiswZ39MtshUAINbILosFFJPJgqDBVhZD%2FzY7m3tQSJV8lwWCpHsFm%2BBFUCNcob69pr%2BViRyrWvA9fryQSil9SoZ91r7DXKdCXfdoAZLNSvZbgZsgRzs4R6Xy3N5Ip1Cd10RKaA4QhQDpTFPxgBmILAMt%2FGMbhcqjIjGttpAakjfpgrkaTx7Ll9yAI5%2Bl8QidM8UgGeDYMX8JveyZxNiT6eaVzT5L3OOrVfjYBG4YIO7QRhGNhw2Yc%2B2t3sz43vhlWXDoRPQcxcTRgVKAYoOCVdJS1Cz8ZPGBgm8gSd%2BMFr9x2AiNToxF08owU8zU2oWFTMRwAnaRSL50mv%2FP1IqJBkBuCwcflkdhLan3METTuZz8xakJqEbFiHMEhILg8E5Se6QJGAVWHhWXHhvXUWGR4iGC4IN%2B04kRC4IBDHY7vZJqbVxsVVbDQ93JeAKDMHkQKoWHq4kEYAFvECjfigz1Bl02y5gt6cL2ikUXZRu1KELT0Z2uC1xLMwCuuAIPKADDCGjOqADQGwWRcADTqBfiIeiE0kd3ADcJGAImsgTPMAD3M4OKHq6BMvZZuAPTuCk32gGTLoU7G0RnK2bIJpk%2FQiQmY4iZYwQ4sEcRE4BOK5XI%2BiQHnkFE7K2VNeodcAddgEE8sUDdMoCOGw4z1AbwQ1l1sAWigKJVFcE%2F9xgpstmHsiAos9AACHaswQmB2zOpcgpsuCsoWknnaLsCGDYV77WKFa1dpunG4LtcTfX62yqVCXgqUfGK%2FEEUxmnD9yBV%2B%2F2mjktm%2F1km1Wnmw%2FIhn2lDGzvZGShUt%2FmCJItutL5bR43HCCsiHD3wvIFxCIIx8ZGBVQ1D04big3hbTwzkLYThuCNoMvFVFBlE1SledDhVIa7i74KG26hG1yLtdABG6ShHQVitSBjWcwKe8JBGqSBtXqLu7OHFhoBVcKoud8IurfbDBGMWkbmGaQhvWvMZ%2B3kGaqAqxEABVBKHTxBgPgzDlTAAjzg7I5AscQosSzADcgpFZxtrIFKBP%2BCgRwq4QbGZgaeyZOXDnUsRrjd6FlkI3GEu%2FXK2wyb%2B7upG72xahWEO4wWaBfEG7uVQrtHXFTLIhxyYKNKkSBuZ6NEQFUhLajKjKXz5QQyywLoZ3M3KksNYb97FaVSbaOWZ1ZSYaNUoLJ9Ain91lhbpxZmQMutdYbCoQyqWgJUwBC4YAZYICz%2FQMsjz5O0%2FFY2UcsnTB3MAQJnwBPiAQQ3wA6SSgJMYKcDZROGwAIkQAJE4Aq4LZDeHIoHawa%2BNXGgINAlIJF8W9YcJZ%2Byp3qEBXoUCJmOqIDIx5uVqXyQwdEcCXs2HZouy35UjjSfYRJafRI8wRbYIX36t9VV5av%2FnkFnbv25Vcu31NvVW%2B%2BrZqmtzKEUXH1r4%2FtnP%2FnCPb0zHEWUSl3TLUmfKh0dHIiBkkmv91qXpULXD6IYaEGOuvvWXYbVW91Zgj3Xv%2Bq9uygSs4iW0IG3xr225D1ZLrtoMrtQLCYYgmGuvCFMPrAW3XvfTwnB3KESaCEYWo%2BCgkUYgmGWrPi3AQNg3mJugOl5dzlP8IRjFInUUb1O1AWaOh4dKMnTDUfZQyVasiRt5IKCXcXUBcIZHK2ApN3ZOd18Pj7j%2F0Kaoj3b7aK4Ks%2FWeh5sEMjfEQdpQb4giMEbqP1Ypf0hrtgpJn4tKt5aLh4tTgct8Oct4hdeUl7iV%2F4t%2Flr%2BLTboLbC%2B3n8e6AEA350CVAqljCfXIWSoLKB%2BKaQeLai%2BUqy%2BLMyecP69RE4%2BhrxeUsAemPhaLsh%2BLfheQNEe6Nd%2BKdqeI%2FLMAyxgBLitIeT%2BK%2BjeKOy%2BLPAekPT%2BKxQfK7Q%2BqzFE8OWC83MZ2Y0C8a9eaIDF3sXF8Y0C8jnCHOj98k9fXiJ%2B8DEDHTyf7kB%2FK0T%2Ffvz%2BWAC%2FLjAfK1J%2Fgg1%2F7NNkMIifbxmfQIX%2BImo%2F8p1eBHX%2FLTRfKJgfK4B%2FgoUfK6R%2FKUi%2Fwtt1LZRfKsAfbJ1%2FLVp%2F718fXKi%2FWK3fIrB%2F%2Fbl%2FLbzfJwCi3C10BAsaPIgwocKExZwt%2FnwIMaI7MJrcRbyIseCtchk7QswGzKPIhPEAAYo3MmVBYNlUqhToMqU7TWAsxhTpzOFNkRt3dlTXzAGAoUSLGj2KNCmABM3U%2BezozdbTjiynZoxizKlViDC3RmzoFeLEimEf9iyrECRahSVPrk1Y9e3BrnILzqxZ12DOvAbP5gUqVCmACC9KFNWAWAOBoQ5eaFDKVCvfqHxXtqyMDqvkunT5gq081iZfv3nVVm6LsnJcvp3r3hWddy9m0nIBC56SDt%2B9Q4ttrJMnD98UADas4YO3JWlkzJQxr%2BaruXLrup%2F5hp7NsbJpvqidX2Y9EDRN2HVlV6b91nbSEPesFTnU%2F294GH2H%2BASyQQDXOiWs5IVAulxlzan2HXRZSRdeZdXldd152fG1XV7dEYjZdG%2B9hpl5oz1Yl3pIhRBIEQC8wM8cAByyTgqPAVACPocAMEV8SBHQFHMheYdZZgeCl6OGroEBCnlyofdWhHVNyNdznCXI4HgZ6uRgZR4Kxgc%2FIuKiDzz4QEKADfzUAcAP%2FLABgAYpnHnmC8eU402bbr4JZ5xyzhmnMxvRiWeeeQrkjJ5%2B%2FvkmE7qwCWiheMZiaKJyllNMMYQqCuk5FD0KqaKxZFNppc7YQmmmgJ6zByDneJpoObb0Saqh2fCSqqHl0DRqq38y6qisgCJqq5%2Fl7JKAYP9DhcHPJQQQcAkkQPDRzxheyhFmiTCGAm20tvBiS7XWXottttpum20ssXALbrji2uLtuOaea4sRmVCLbrva3vKtu%2FJiW%2B689hKThSTs2itvLLfwO2%2B9ALdLDB10EDOwuwInbC68DKPLiyRZIPywuQtXHK6%2FGIvLSyW9CgZsKIER5QA8oXgJpphqzFijgDdSiFl0PD6J2URBYoe\
ZkXIhmZeSclm4FoaV%2BVgXkWhNedQU%2B4SyWJlyiKiBPJewBwkAW%2FSjBIAtTyYVjjHvmBfQay34I1lRaveyhCallmSBS9bs5NBQbihlUEqFsM4%2BrlwSyhQOpIMcJPxkHYo8agyzzor%2BRgXIdY4%2ByyVz2EzmRbZcDdKNNmY81%2FX4WmKXJTRfRA%2FJYW12J6WEONasns7KNuAijzhjDJVCf%2B4pt3VeA7adY%2BRvY1b5hRQJ%2BZbRaOn81uZydY7W52GFHtvceRkfFtJFDYt900NpMPL22h%2FFuO5dw1yZ7z9PTp30lg%2BPc%2Banre31zNbFLbr6pNfdva%2F6CxZ%2BXbv37La6mO8tzgtL8ILGvrNBKG1Hgh%2F5JAc3vMgtR9TzivX2h8Gi9E8u%2F%2BNcACEHtt8pyH4INBvmFqg5B%2FIOQREk3lpGV7zSped0GayhBnPnv%2FGtsHwhPF%2BODoiWy01PhkVi4M5UCMAKoe9C9Iv%2FHgWJeDQa2tCGG3xLB5f3wbcM0HNLfAsQQZfAE5bGiMlDogeV2EKate8vUpxiBqu4liu%2BhXlo2WLzujg2EgYxjEPMGRnXorw5ZvGOaZzgGjvURjfuD45okeNa6FgWO5algF754vP4WDQoHu%2BPaAnkIwc5STyCronl0SNaKriVCyqSfzjkoA6T%2BLXN%2BBB4prykCfvoPu6YEYtoFI8E6%2FdE%2FK2yhowsiyPRAsmwSDIslNyKJb0ixEz6MYVueaAIm%2FRLJx7SdPkbJitl6UrHgTKSPSSgKMvyzK1E8365VFs1dwhBX7oQLTBcCyqtokpvgq%2BVVnzlGWPJQlrWDJPsROH7%2Ft4JS%2Flhc55lqecpNVm9ROpTa%2BDspzh7V04u%2FrCW0CRoDKd5ULYlNJ7zy2Ypg8mXfE6UKMUMyzHLkkyvLNMrzbRKOq2yzo%2B2s4EI%2FadCXUNKuTi0LPecikpXuhR%2BxtGfvAToT9M30FtKc6dH7GlTn8pEkwqVo14p6lOOutKWeuWlYYnpVma6lZpO5aZTyak9IRoW5AFyl4LsZUkZGpahhsWrPgHrRMW6FbJ6xaxWQatV1PoUtj7FrQ8FqS6tWteA3lWNCkRkN5F6w4ou9aJOJalnuIpTj77Vse4UqU89C1StvkWvXYVrKiWK2aEA1iqC3Qphp2LYqSDWJ4r1CWOJ%2Furarci1k3T9pF0XSlkxcjO2uNNsI5kaWR46l5nnNCBo2yraxlK1jJA1rmSRa8jKLpe5%2B5yuS6HrXel%2Bl3LXXWx2gUtanpr2qqi1XFBX296n8HUnftXnbKdSW6vc9im5fcpud9Lbnfx2r8G1ynDL4klkjpOm1VXnfV%2BYX5%2Fs9yb99eZ%2FnxLgqQzYJwX2yYFvkuCbLLi18a3qfKNb36zi1Sus3cqGY9LhYX7YJyF%2Byoh3UuKdnDgmKY7Jim3c4Kk8OCwRhumE01phnF6YnhneyY1dkuNV7ngnPfbJj28S5JsM2SVFdsmRrXJllyzZK00u65MPG%2BW2TrmhVb5JmlOS%2F2VFbvkmXd7Jl2MS5piMWSVlVsmZp3LnlKx5K20e7Jt1G%2BfFzjmvdY5JokWSZzfuOSZ9vsmfXRJolww6JYWWyXsZ3GLuvji9MQ7apGlcaZdc2iOZnuKmXdLpmHxaJaF%2BSaQTG2tTS7WgY6TmqiV83NTOeCs1RnOS%2Bwrb2N5aJbl2ya5T0uuUjHokpR7JofX7bJ8s2iqNtu2jDfxrBb%2Ba2cFOyax%2FEm3MTjsl1VbJtUeS7ZFsWyTdFsm3NRzunYx7KuUW8LlNnG4Vr9sqzUZ0wHEcb6TOeyT1Tsm9RZJvkezbI%2F32yL%2Bt%2FPCYDPwpBRfxwYWccCMvfCoNB7cwybs4pf4%2Bl7PqxaoX2%2B3vU7N4u3PtLrLXa1%2FVYhilbLwscycukoqP5OIeybhHNt6Rjnfk43YOuZo5CeHi%2FtzmQVz5U1oO8JfDnKUyNyZ6t24g80J5o1FdtrNT3fNjOznZQXc7y3HOE6vjOeJhLft5aZ52oMtF6hmhuqX1rmisM1nrcxe8q4VOZaJbduyZZc7ZG1%2FzVuex7duUy8h9UnIfn1zMKTez130CdpCLnfJI94jSRcL0jji9I1DPCOExYnhZI34kn99J6L08ekGX3tCn30nqq776o4TgEMO4RAoYw4fmPx8ADgiE9JtrecDnZfYZqT1Gbn%2BR3Kvk3R3p%2FU1%2B7%2Bfgi%2F56%2BDIp%2Fk2Of%2FjkXw8X94DEOqzxmEDs4xLrGIZQDrF%2F8OB%2FFJV98RN4XIcW4CcROodkcEdcPod5mjdKkEdnkjdeSIEBkDAcctAPL%2BAA6xAKABAG%2FfADJROCI0gEBCggl%2BdmGKV2cMZ2oMGAb8dzDyh3Leh4XUeBlGaBM2R0RfEDw4ALjbEPfNAsYeACRQgARcAPs3MUNOIO6iCFU0iFVWiFV4iFVegO3kAMUZiFXwiGX%2BgOxOANXhiGZ4iG6hAF1GCGaeiGWMgLbyiHV%2BgOOdGGcyiH8QAk8YCHfagOvFAOfjiHW9iFgpiHa2OIbziGZZiIblgOcdiIaRgPoAAGfP4YiWdYh85wh5eYhZDIiWDoDhGnAeLADysjJsyyLMvSLMwyBdECLZdgBVQgi7NIi7Voi7eIi7i4BLnIi73oi1Swi78ojMNIBT7ABMSIjLwYjMnIjLS4BMvYjMxoBT5gBNFojdVojc34jNnYjD7gA7HIjcgIjeE4jONIjr5oBN94juVojuuYi%2B3ojrdoBQWgPyEgB%2FugBCjTLGqgiqdYJmiSJqigCwNJkAVpkAeJkAmJkK%2BQCQrpkA8JkbqQCa8QkRVpkbrABKBwkRvpkA3JkR9pkJngkSAJksZABZjwDSmpkivJki3pki%2FpktAAkzNJkzVpkzeJkyt5B21gDCRJkv8T6ZMgyZBB%2BZHGkAhW0JNEuZEiqZQcOZJNWZGo8IMO8AOPEQL4EAhXGQhL2A9bUAL6sJVK0JUss4mfqIVcWJZmOYWLmJZqKYVr2JZu6YluaYWZGJdmqYfJ8A97yZd96Zd%2FCZiBKZiDSZiFaZiHiZiFGQknQZd0SIZ3%2BYmP2JhXOImVOJlaaIeXWYVzqZnuoA0%2FmAL6MDVy4A9hQACrUwKHgA8vcJrWEAKQgA8uoIKNY4Dbl1GEJFAyqJeJyZu96Zu%2FCZy%2FuZg36Gh0J2PJhUtFJxh1gA%2F0sDRCoQT0gA9gORRTIJ3UOZvio30CdJuhFIPWAQa7GZzjSZ7laZ6DOZz%2FtTlLkxVeyuWDvmIDW1AE2vMCW%2FADRVGf94l9K7idIPSCkPadDBKe50mgBWqgvZme1rSe4AVMnbcWtUZFfjdWLFicnXVN7DVQ4nmgG8qhHJqg8HShdYecU6WclCdbEhpYFGpuLpiDCYh3UzegHSqjM2qeHzpSIXqc7Zmck2eiSfWfAKaiBseiCIhOL1p4MUqjSaqkiWmjp4Wjj2d3X2ekGUF%2BGAGhxISitBWkJjekElikGbqkYSqmgtmk9PWkOhilqDelGFGlF3Glb5SlQNqfWtSd1BWgP6KhY6qnYVqmMHamE5imxremF9GmEfGmGNR6ULGlotelf%2Fqlurmnkcqn%2FxCIg0QKTe4XE%2FCne%2FJHXomaEa%2FnEbF3FXVKYXe6Pnkqqam6oX3Kao56qTsIaz34oHz3V3EKYosKfI26oBgKqarqq6tKqRVqqRYGq%2Bwmq1H0g%2FJmqzyGq%2Bmnq%2BZkqsKDqr9KrePJqmjnqsQaqO83qBFRqBBxqIu0rFzWrJ6mfqBGqmuXm%2BA5rdXqrggarCvaos%2BDqS6hqeO3e7RGq%2F41rnxWrrp2rryWrjC4rgLaru%2BKsIZ5rRGYrVJWrAzXrRDxrQ8RrvrjqRgBqlQRsNg2sABasHiasCHLmwtbqV76qtuaqRFrFvkKb8kqcf3Kaf9qbRuLbx2LbtGKQAcrsjvbl%2F8kK6wmq60jSmwXyHowi2sya280i3E2i3A4u0c6y7M867PyOqwOi7L2qrILMbELoQ7B8DEmerEXkbEZIaoYwX0Y4X0XoYBigaRR67Y9G69COq8nK7Q69RfB4LJ996O3OqdrcbYXkbZfkbUJMRFQ%2B7YJO7VyW7Vy9rB3d6xlUbG%2BErYRMbYYUbYX8bcREbgQsbYPUbiHC7r%2FkLhcOrdBq6MkyqNga7TUhrQWp7RNx7Qo57RgZLihW62jy6ila7V1O1opta8etrr01rpL97qyF7ukN7uXVLu2%2B6u4m6u6y7hXqxL36m4smxGR%2B00FqKD%2BCb1rNbgI8bnMG7XO66zd61v%2F9Tq934sQW6sQ2AsZwUtxwwt7xTuqeyu7H3uq4ju%2BcUu6iytpjSuljxtReVur9kuufVtHxyt8ydtRy6u%2Fkkq%2B5mqcUMq72lWiqmvA%2ForA5JTB68fA6tS2D4ywEQywE4ymFQxfKYW3Peqj2gui3NnBvvbBoeXAIqynJDyzJgyoKIxqvkvA%2FBrDrLvByqTAHoy%2F0mrDIYvDSavD9ArAairAFvS7Oga%2FSSe%2FoUq%2FZlvEMnzEOZvEiMu%2Fueu%2F5%2FvEghrFr%2FXDwBvEwjvEMrXF2sZ%2BpKa%2BBhG%2BX%2ByuS%2By6TUy3pzu079mjkwsRlXsRlxsRmcsVccxtc2wXIWzHvorHxKvH%2F6bboOLlxxjswjcKw%2BbLW4pMEHXcyM0bxs87xupWxtx6xvg0xVpWxa53xRr7rBrVxU%2F7ybcbyuU7ygpXyil7ykbltSwMyA8hyBFByBBhyA%2BxuQ%2FRuQvhybOcqo88v5G8u3xst6lbtGscv218Vm%2Bsb4jMb5yMDsvMzJHqzFgMzdHLwzt3wdV8yU6aybeMYt4MzuF8w7UswZqMy9KbEtQ7EuybEF37terMn%2BrJve5MZPDMyPI8puPsyvascrmMtbv8Vb0sGEUgB1PQNA6gBBk9Bf8RJhX9PZUX0NtLp9b8dNzMcQZdwwgNrMRJtUAbzZPsnrOarIHAD%2BsgmovBhPzAD%2F%2F%2FkBxboA95UzXZmUPYXFjarHEmHXUordIQTM8lzNCm59DpC9HQ9oMaYA2H4ACHwA8vAABycA9KEAM9wD3iMAwaoH9cXV7rbKbt7NI2pdRLvacKTbZZrLlIjXvom8%2FejA78jBAq5QAE4ACXAA%2F%2FwX9bsAWP8QLUWQRjiRTNgM8Up3hl5Q0Y9dgl3SNvDdcJ3dTWNtlPbWiUWNkeoc88UTMR5wDWwA9hAACnqQ%2FigA%2FiUAL9yA%2BoGAa1XdtqQAvIkBO7zdu97du%2FDdy%2FXQyxENzFbdzH7QyxAAzIzdzN7QxL8ArOLd3BPdwNMd3Xzdu3cAvYzd05kQUpndnnGQl00N3%2F3K3c5X3dw43e1y0x6z3d2u3ezl3d8d3ctPDPSOEAWxAK4sCaW%2BA3SrAP9zHbq0gctn3buU3fzK3eCY7c583gxw3dD27cCy7hwQ3fFR7c3x3eCU3eGA7cDu7hvU3hIc7b7U3ivX3hJ54T863iOWHfghEYKcAPW0kUDbAOrJDYRrjYqt3YoQ0VkT1Ync1DPo62do0Row2j4L3h5CnXlivkbb1YoH3ONlbaP%2FgC4gAHS8gPfKABw2CEL%2BAiH8gKAKAG%2FKCfMUfSrEzUuGXUlh3LtLvkk8rSigvlZEzkR67XfH0Q%2BeQArqAP%2FZEOKUAAocAPrCAO8MDVNI0L9OAKH32i%2F2muqGtOYG1Oe0autpgd5zTa5INM14dcSDC9o0R7FBEgB6FwCNPnAKV%2BCGhNAGkQCoGgOGiu1n7K1g3r1mCa6Um66cLc6cZs6WKB1yOB5B2h5wbhvvtJmyLtt5Tefb%2FOuZie6x266xAxzAtxzAoBPSfloMjqy6sc6QI90p5NaNAe7SsN7rjJnqCOuqIOc7%2B8EMFM7b3%2BEMVs7c6OzORe7gY67Q9R7Qpx7YQb7DiR59ZrpamsZ97%2Bqa0816%2BM7p%2BF6%2FnuoZvNxOLubQEv2gPPqUeH8Bir8JYr7wthyFZoEJIphSpBhQQxhff%2B8BB%2FoHJdhQsRUyePDim%2FzZ%2BuTZQs0%2F%2FdDukJL%2Bkkxux20Q21IPS18AxRSBCmIvTCoBLCIPTdoA7hMPThsBBkow7kUfXYpeQsf5jjbBFDXwvdYPQIkUzqgA1C%2FwxOEQxCL%2FVHbfN7LvNub8DDTrElv9cE76YGr2njWvXuwPcGDO8PQQzkcOeY%2B%2FNO0QctIAGJLwEeUAVnP%2FOVwAALcATbqg45sAALYAjx8AwbwAASUAuaVR3qEA%2B14AZOP%2FOj%2FwdYr%2FXmjmPqQAgzoPgS0AJxYPoHkUzucAWX7wbxEA4tsAASsAmB%2Bu%2Fge19RKAzHHwxnDxvhIAzJL%2FD9HPY%2BIQ3BEAzdUPcZL222WvXPMAndPwnCEP1i2%2FH%2F%2FSwZ3aAHjTAJa2%2BbO%2B8OXYAA7w%2F%2F738CwiCFlfD%2BQkD5M%2FD%2Bmf8MFoAAACGhljp0BQ0WLOasoLpubjZIkKaOoR0LMAgexJhR40F3YJL9AxlS5EiSJU2eRJlS5UqWLVVGAhRv40yN6sogwJkT5wxhFw0Cy0azoDsnOMvEC6cC5yR3QjWWu%2BVU6lSD7jSBaXpQ4qQgFiR83RBkUVZ3hr4e8TnVmUKM7sIRepaWas0gX8feKjdX70Z1zRwAABxY8GDChQ0DSNBMLk2CcUTotAClJ1VvtvbudSesSiqJtXBKiHtZNLooxhaPVlcqZwsybnTk7OJOXSWcQppK5CsxrboZ%2FjgNxXtmAYHA3bgTDk2F0wM2dfEWGUCQA%2Fdojh5dXseeXfv27TBlUncXJ%2BcGKFxM5Eyym5i36Rh1u4NiFGmLpbLbL7yvGyq66bjv4z9tLquw0iqcKnRCsAyC4ukDpyACnGmtjDbJAYGBqMOoNwTuygtDvfr66zARRyQsMQjdCycJBHMSYZWsnKrMQ6HU%2BWMDAzqRrRYGELAgNBmnKu1Evdz5AycVwpknHnWOgM6DbmarbR50aqkFnRetROeZUlLpBkv%2BNPwtuOEu5M8dbEqpxZxr2EpNAQQ8ECYcdQjZKZxwfuzoI%2B725LNPP1Pyjjp1hNkAJx2CiSeebo7IqRSC%2FyTqphJPugnnSome4dKe%2BBA4Khz6ENgkHmG4lM2gbk496NRuoAoH1SlraZVSjFTFcMAr3ekiJwl04GIGN%2Btj0MHiAlTHnTW1ElOCXOTSzan%2FNByLl%2F8%2BFNI9v0jElkQTp3LnitXi6KNCnHIwRyt37NPKG2LKfLS%2FUhc6d7Fi4zVInXA8wKkUJXXkMa5iT5uXWXenzSjIH9GJJw%2FlNmlunlSqqIIMOWlD4IhJZvhqBkIuUmcSHfBVQAQdKHkUTOCEI85KT5J4TIIWmqBFNi4eQyDkJLro4DMTdJDTwzz%2FBDpoobELdLTwcNpAGLJq8WCGLgZSpxaWaxahhT8ucqeUI%2F4KNaGMIOTz1KitETiBjCfVeaYFE1TwRaJSTDAhB2yI%2BQPuPJKQwIIWTjBhBuasrNuEIGq96kV1PMkpiIGUnEQ4A2ZAuEEEHhyKISrl9KnYcGqphBYv1QkG5SrrdaebWnxBOC07rRw0GC%2FRgXYeW1Y52yA777R99YJWR7vK2zNHR%2FeFrs22%2BMK2dVYWCXCCoptE1fEWJ4b529wQQ1Lp6aJndqkEHWGuD%2BcZX3y5s5bry3xmkUWUJv2ZTQzZRBj%2BgpeF5vWj3tECbMIpxRCo6x3UIiaRPYMIY3z8MV8punEljRgMT5vICQNyEAdPoMMe87gNxUQgAejkZCzu2MTyEP5EHN745mRjKtYihIOgGTwjHjnoIAIex6ScGEAEPauVdYa2Qx728B9FE407huAgBspPSWg7wYoQYIgcFQonMeTUfGpYwyPw5xnLU8BAQIgTEcwtDk3KiQ6cyBQrMQoBsQFP4QwSj1y9SRjfQcc83GCCI0gsWJN71CaCYAIFSEAFRyjFbbrRhRYsTwQ56EOlFsHHmp2gBbIoliyqoAIGWGAGZYiIlRahAhX8YRI5sIAFcmCIi2ioD2VAAQNEAIXQQI%2BTTLRXEDjpiXjUogUqqEIePCCBGbTAl5u4TTBmoIJHcox4xkMmYJAnFHeQgYuZtGIOnvCHuLjDExjLiQW6cP%2B2I%2BTNITjpAxm%2BYoduOqgWdqCZBeLwKGxwAV%2BfmUEq5hFCXW3gGfzagB0%2BJQEo9AxtT1ihBIaQi9vUxQKTeIIIW0BKmjjwR%2Bo4EIJYQ1D%2BUAwBIrBDHJyYBNnsADpB6AM6ceIGJZksWbXIjBNFEIcuiPAI7siDuCQQhDLYQUMbOEIVcJdDPfnQpz%2FlDhAvo46vIYCk7qlKF6DTAjHgQVxJUJIZJeCGmOakU59iQBX6oCKcLOKExLEmTk4wNztkMwge8MSmqiCbZxQqZUZT4%2B4%2BVYXv6MZe7pDJHR%2BUNRFCJhVuKSqCumCPP0DRAKWYRyneqROeNKewCFAKFD3RFA3%2BOW41EXHH1wxgByWFI4kIoEQtkSbCE%2FTGAHS1kuRO8KThhSiZyFwmTTKLk5cWCK%2BdcaJODHAUoq6oFG2UoU5ymxNguqMKUDRSNzaB3Hvu6Ik1jI06pKEhnaggezvAiQWgqCwIOVRG9urCCnXigbFAaTibsIc9FIaAGRCkE3GAgjTSG1G6lnCJX62FHMXqi3nMwyz5skct3OQkd8xjEeM6F550CFQGN3glQv0QNmjWBzhmJDV26EIqrtGOA1cMOO8kRH%2Bf8c6rMi9R6HgqfouFOLKRNSeGmIf8JsFFbMTDEOPyWVzR9k4mFqQbzwCyNIAcDr1KJAjQmUEcykCzMtj%2Fo8Mz2EQlmpBd9%2BXATQrIgeIkrJwyVEGEPItHkcTqhjI4kQsyoe4MxAAFEcbGHULASR46qxRQ1dK57O1ah1dbLDgjIA5wBNFrkxnbmajjNQjg7EyaaQADjGwTXH1pbw11hRygI6IIIEMnuMAiQhhihWWYRy20i4A8vE%2BE2Asv89xgOueeAH5DREALzBGPMkDHBITwmAyhIJvAVuG9CwAnAw%2FiXRkVuBZ3O09O9kwxJxXrxtFZUKgX0QVsIuAKJTXhSd0hLjdIyUpFjYM9UjFgzD5bOgf7mYPVve6RQHgu9oLBSCtspXe5wx7PmIQYduBEFaCDxfZcUFGiGDYEkPGO%2Fv0%2B6YrF6uI3nc1en5rEPMyY6DQSiD%2BqwclkrUSGDnjA4x7YgCfsITnKTYIMSXhGejeNacLuZBO0uEYfFjEpdyTrjfEo60XlGQ9CiHASLR9OKdIbvfbatwXdIMY8bkK2BfZZzvaic6j4hYD0ALkbNJvEh4cDyXodU9DZInRN2grOeWNEGJP4gzDsMScjVaqoLSCy8yIqnVCLMA%2FpbSNH%2BbcIQtgDOBrSFzo%2Bm4q1T90QFyzF8iQQp89OIh%2F2EIZwRLDAokonUUU96kaIjaHNpYLIpZsErDc0D4rB3dnj6kw5ofOra9s3TKLbNk4QkZV4CNwN4ib36aGN7gWz2%2FcN%2Fna3gIpa24PAD3PdgILjYniEebadIPABG8Sb4g5K4KQFWRKdwltMjJzrwCe0xkkVulEoC0ym4lkB3Qp7HI%2FjIgi9JF%2FQvScRByE4kQz2mHFOKqADN%2BRXIpFHIUkDtYKIB1hrMjGDHCt5NsixLzKIh1tQh1TYEQWQJ6ebM%2Bmxs646IuPCiSuwh2fzPq3wuq%2FTFsWYCg05iraoN3dIBTtIgs9CABOgPBPjD%2FbDiS5QkoSLBzfAiSdoinmQhkXgAjFqlNKhmcnCHx7JHjFhgGAQBixKAiiAgoTCiVSIh6LCQSvhqsxrINN4qG7QgeX5A5lojqsbKdKjrekzN4IQFxW4%2FoJF2JTWMynY0xBC%2BA53MKPbG7c3KTfU472e%2Br1A9Kngowpc4SLWshLPiLVNmAel4hEkQIRncwJ7gKCLYq142JQSK7jp6zCEy76w2r6cIz4EWh4VkBy0yDGLs5fPSkF3mCMVGAHiGjlh%2BadCYbSccEB1AC5d4QL%2BAEASOjQ7JMBMBDrKcYcn%2B5Kucge8MEMEQCwLhDoM5Je3codOEKsUwYkxFEHXIsESrBYrgbUguBJzKIO088UhukUnWq3ZIrXvsMEzUpJfXBweRAAfVIc8UL6vyBcjzLgcyR9%2F%2BcVguKInYrQYssKi0kZ32MKyM4jNQw1xObp4MLYV%2BgM0RADb%2F1BABFuFAXuGebCHNpLDbBMdTDSUYhGVd0IEhxkw5ymLcZFIBQNEQZTJoSFEbmExa0MYpIA1gcCGMVqGdlAEnEiCuluKeVAHc%2FgUTewCo7SHiLKNZAmGAsu%2FseK%2BNNSK15CAdyIjwrE4%2FuAqFWCt1UkO6ZnFyQEssaoCQ6DHXIyHTbiCQtIJO5RHiRAXbbSSJzCKYnw%2BZLSvo4DAsXPGeYDGpJDGHQG4g6jDx0ia3RjBbjyMsNMIV1SOZyALjDuoeXgCW3ODVJjKGWxHAowoHByU7NvBHpwHa6StRVAGMwqkZkRCfumR%2F0MZJ8SimooDO8iD3KRMhJQJhZS3mXBI0f9ImJyYATvYBDegs%2FJrB4rByJaMDhb8jElAh06gGdGcwzGJh%2FxDACighEXQkBHABhZ0kw0QIOcUgUkwhJ0Cj96byfb8k5qcCnXYlMnBTeq6gnkQEwTog2WghXiLNTkpKhXYhGe4NE2UAEIQBorIRuCwv25IBQ2hSlG8FTphkb%2FhyhehPvSYtURxB8kBlbIMgnhYhezKr4%2BUj1qYBDtAKVrQAzqrghhDGWFIkk2RDrx6Bpr5A73UpJ1IRjziBQNDGhfqsz4wymaUOsP0EYQRj4tyk12zFm50zMc0QWdZBecaghqLB2kQFwaohfEDsA8UK8%2BUM9C8wXgkTXp8AntYOub%2FkxI6%2B6tmJDx3gE2ARBlfaMZFeDxhoKpNeBLe1MLf1DwvfChzEALkygk3kA3mVEPUG7HP%2BBTmkY3rfACouTSdkIDyGlFlQ4ex5CIcWs%2BYdM9QDaqYwBCGED2Jyp4%2B4yXxmrwtyiad6BQ6y67LMrLx%2BJWLYrhRtCKaQYC1Kra4Wggzio44UMtDI0uSi4extABPSA06G6wkWCphcIZiMCMygNGa%2BYNFcJ%2BcqAJP8ISi8oCOFDNj5EvqKgNboASaSQ921IFnwAbgOlIEOMyFCB2dGIsnjVJv5JalizUouAI6MwAcBMwycB%2BaOQG3izN3DE0zRaHSrEc1tb5a0AwPUhSa%2F4ECO2iufpHNMWlE6BCBRVgFJrGh8PRT3zQqhiyI4BQNtKmC4bqodaqos1DDr%2FC%2BY1whA9iAMtglFWCOMJQARPiwvPkfndUJFJg96gms8kMHMzKAI%2FlGZmJPUZVaoiHVUu2GKxCv4WClR7GlJ5KASfoKZi2LxcoBcZoqpIABCRiBbxqXYHgUT4BBC0BOPyKrr%2BAojGCjnNC4VLQUYaAuJTqCjiQ5M4lFHvlbHYgHShChDUCBd7IAlCLMIqxUnfgDvBKzEDxGHrUvnMiAX5GAQJJMpBkuqRvPJC0jZUPEroPSfC2RKXUW6FEiAwiCs4GCDsraHrlCRhtThDmugI1HLP9anDNgtKHEuOEYNRnqFOoygAH6DIAE3syQVZ2ApdcwAAr7UwPgwoIR1IP5v0WwHkPQ1qwoB1s4nWcwlfGRH1%2BMREPoCQOCFe8ZnycJh2DwhWDYqZrzXvgphmuol27I31SgHvQ8n2KL2qk14Aer2lLNjPw1BEjKHGzwXj1wEfGpBWwYiu8BXzsZn0wyoJ4IBuuZBE%2BVLu%2B9nw4uB17ohvExXwBSOutTz%2FNzj4bg1c%2FQgUWQiDATlrK42Q3ogkIRgTdahE%2FpoBYgo9DdR3QoM504AUJoChzGox1lrx4lpPFgYv7ABmOlOjOSuuWZ16HoMEwru0BjXSl92vnJg0e9KLP%2FeZRFYZE8OAITOM95gAK4qWIrKQO4QVS0URsVcFuYgpvosoN3WgAomCMTeAJNopkFiB%2B%2BaQF%2FSZu16eNaqIucUIEeU4cngJse6xa46QNha8jtPZgyORd6KYgTbhYAyZxRbheOOeVTJp1RRga2gBdSnpd38ZkCPuBcNgn4%2FJBRtuVXXgZv4A9XrmW7YuVHUWX3SGb9gEBX9h58%2BzSUxQxgrRfgWIQ%2FwGb%2F%2BZx7ktih8AVs%2FgNfkNNakIUnAb0%2FwAM8WIQFqhdKwOZFuJNi%2BZ53Zmf%2BkAYqSV%2FLOZ2C8AVyDgds0ANsjsp6CYdr%2FgNmfQZZ6FJ7oZL3xY94KN693cYx%2FybjIXHQUsBoabBlgkgFjKbMWLmTcGAGWygX2zmVnaKV3TnpC8ZoqElptGnpgrAFZugSU3GVYa4FjCYVk5YVle7pQC3jH9mPUJ6K4yBqp0g3XVbqk%2BDlo0YHoHBqoRhq9wiC3OriC%2BULvOJQgWmP5nieYU5lY7mGX7YSDjWXrdYKYm5lu%2BKFdlCSjNDqVQagtMCGZxCGQ6u0mmhMilYm16UKYwaYtTYIdbGwYUnrtO6Prj5lYsgGw0bs%2F4BsIVHZqJ7qqN4Io7bsyMTlpV7qpj5qqM7sp4iKjGC%2FDpKAHsMTag5tg5CQ1c4IvCg2XcqtOsZXvm7doP6RGHFtjADt3f%2F%2BZNz2kMr2bcz27aTm7OMGCc8m6t72beFeiGnrgs0EbtlSbddubd8uCNj2mUmIIScotL3ma8gMbd3G7qcOivImDVB2bed2beLebeNGbs5W7lBm7t1m7xr86lC2FfS%2BbuzW7lKtBYhJS0%2BtbdsWDPHObPLG7vre7cl26vsObfd2bfiOb6We74Nh8NWGcMve7%2FLub9%2F%2B71JNlJf87tW1bQS3bAX37QxfbQc%2F6g23bAlfbQqv8Fy%2B8B9h8cyGcafucOz%2B8N0OcdcWYwMPDBSPahXf7RzPbBcn6h13ahkPbRqvcQO%2BcRlRcsoebezucd%2F%2BcdcO8tUeciJHDL%2FebSR37Sv%2Fj2omD2UnP2ooz2wpn3KprXIPQfMXz%2FLiru7V7vLV%2FvLQDnMiN3KnNvPVrvOjVvODYXOidnMO3%2Bw4D9U5x5BCX%2FM7f%2B88D%2B09D%2B0%2Bz%2Bw%2FN%2FBAP%2BpBD21JD%2BVDF2pK3%2B1Fj2o4d3T3hHTqEPVSR%2B8t321Mz2xNt2xOP3Eyd21Qz%2BxX%2FxFSl5FED2VU5%2FFGX%2FWZbPXR8PXgNvUZt%2FTMpnXLtvWoxnXCSIEUCAwHeAENEAxt53bD8HSi5nXLXnYPAXZmR290IPajVvVjl8lkF41ypw5hT%2B2u5HJZ9u8O8e1qF4wXkAdWAAwbsAZ8gIctCPiBL3hw1%2FXVHveolnfqOHcM%2F6H3H1l3om53dw9EeL%2BMhxeNiedb%2FsZ3ENf33eZ3wCAAVugHgAcAXFgHJWAFeQiBlW%2F5l4%2F520bvhndqjheNiJ%2F3Zl%2FtitdvY8f439P4vdD5vfB4rPbwkAfykRdy8A4MNZAHeAD4EMAHSAAAJeiHKdAAfDgEAJiCrT%2BehR9vy0Dvo98Lnh%2BNpMcQoP%2FDoZ%2FaotcLtJ8Ltocre591pvdypwdzqAeAF6CHMBgGgLcBfuADAPgBflCDF%2BCHOkB8fmCDwnAAt715sy9vup8Lte94n49wvY9yoYf7dZP7ucD8qbD7lX32GC%2BGdJ92pwYdEwcMB8CFSwCAwX98OQCAwpcD3f5%2F%2FDkAe1YA%2FuC3BV64heI3%2FuNH%2FuRX%2FuVP%2FliIBeaH%2FuiX%2Fltw%2Fum3%2Fuu%2FBSPIBOLH%2Fu5f%2Fuf3%2FvBH%2FuoX%2F%2FLnhSwA1dAXxEigA%2B4v%2F%2FAn%2F%2Ff3%2FviXf%2BznBUnIAvev%2F%2Bun%2F%2F23foCIdWsgwYIGDyJMeJBXpQQAHkKEGIZfoDDprE2xwY8PgB%2F81LzgV6fjRwAENKBEGSJYuZYuX8KMKXOmzGy2aOLMqbOcrWw7fwItx8RY0KI0vd0yqhQmuGLFwC2Nqg5Msn9Wr2LNqnUr165ev4INK3Ys2EiA2EVdCq5n2qVI2ypVpwmMOrhFmz61W%2FSWN71BjzmIKJjPPXn06P7hG5ZCHiQAU%2Fop0YCv8RbIgh8SaKYOHefOnj%2BDDi0atDdbo0%2BjTo0OWDbVrl%2Bji2JsM%2Bzaocvdsq0bdDFnu3%2Bjc0eVLPHixo8jR242HvDdrJvrxg3dtru57qbXduYbO%2Byk3F2raxb48kMHIc6LG6YBQCh6aoatW9%2F%2Bfbr1lxNo%2Fu66tH7Xz%2FunJhttAIomHYGn9XbgaMJVlZyDD0IY4VfLKSjafxV%2BZiCGnlUHxnUbeqYdiJ95NyI64Y1HXkShNAZACKzIY00RD5UAo4wq4jfgiPyZyNmFJgrYo4YmJtgjgxIimaSSxVHY448gDglihx%2BaKGKP6JQ4IooqCkYAAf8RafAlmGKSl%2BOVPDrZ2pVBmhgliEWaeOSSc9JZ5z9Nmvjkhm5iOOWVVvaYJYhbclmooffl1yOaearZI5sj8okhnCPKaaellyaH54h6Yhipgn72CKiJgm5I6KGnFmqmoqZdySmGj0KZ25WTSjkcprfiKpamILqqoKcHglrldoGW06OpqCIrmKomLrppo0DOJqSsPdK6YaW5YpvtVbtu2OuBvxIY7Iiijkgqhscmm%2B6yO7Ka5pWxRdvmtEQOS6mt2uKbK7cYeksguACKCyK5IJpbIbrpIrsuiM3y%2BuyIsO4574jV9nlvvhdbum%2BF%2FQL4b38BbzjwhgUreDDCpyq8IcP%2F3ToMIsSdSvxmvbU2iLHNdGqsIMf9eawfyBiKjCHJB5p8sqEpY7gyvy1v%2BHKFPetHcYXX3ly1hDkfuLN%2BUHP3c4VBVzg0gUUbzSXSFSq9MdOvxgtpzBtK%2FanFVtPtINYEav0d19h5rSDYCooNINlll5kos%2B0y%2Bq7Tvr4t6czWzl235EwCwpy70l7Z94F%2FHxh4f4MTrqzh7L6b93eLf9t4hXEDG%2Fnkr4d1N4CmY7f3dJoTyDmBnusHeugQna1g2jqvXSHq%2FqquIOvhug6781zJ3h%2Ft09kOHe4A6g4g79%2F5%2FjsAwR84fNbFK3h8x8kfuDzAzT%2Ff%2FraVt0o%2B8plb9%2Bfj%2FiMXa2L3v4NPoPh4y49A5uMZ%2Bgikvo%2Bxz33ti55%2Bpged6jXnev3JXn%2B2x539ha5%2FAPrf7AIIoAFurYAAOqDPEqhA5zHwOw5sDgSBI0H9UFA%2FFsQOBgmnwf5wUHoe7A8I9SbC%2FpDwO1Q7oQJTyJ0VAqeFv3nhd2L4nRlOp4Zlu6F%2BctjAHeqnh9xR4m%2BC2DUTEnFyRsQOEn%2FDRd0wkTtO5A4UoSNFo1HxO1ZUIRZP17ZYvcuLfANjGOs2xumUcTdnpE79QnU%2FoeVPS%2BLx3qHiyJ05HrGO3NFi7X4YtUPKrWZ9dN8foRPI6Fiya4UU1rva2Jw3nsyR2IEkGSWJHUpS%2Fy%2BU3NHj7fi4yap1sjmftM0ga5NG7KwRO6YEDioRpsrpsBKQrpwOLB8oS%2BzQ0nq2vKXNcgmcXdaml7D55XSCOZ1h%2FqaY6hrdwhDnLMXdMWJ5xGTrNElN2FnzN9iEjTZfw03oeBM64NyNOJN1TOgk05PLhE4zWfjM6UQzgtN8Z77i6ZyBJvGgERzluNjZuUQOapGMTBU5VWbOhqFTR%2BqclUXX506GSs6hupnna%2Brpmns2J5%2FN2adu%2BpmwjibtoywLKeZImrmFojRbKrUNS13jUtXAFDgyBQ5NbWNTVP2zOQHVJUSBU9CIrvOnJw2q1YZam6Kq5qipSepvlvqbptbmqf4owynadLo0nsorq0YCKldx5VXYgDU1YkUNWXdj1t2gFTZqbSRbhedWtcHVbXKNE13riqm7viavqNnrafqqm7%2FqJrCvGezRChu%2BwxIvsXj06Vy36liMQdY%2FVRWkRF1IUYGVVHsYLZVGN4ojz%2FoPtOMT7UipFdsSmva0DYXf5eJqpNeG7LcynO25amtbRInUo6Vb7W6uasbWAiehLmyscOuUWtVI9jSUXRBygabcJzLXYM59bkSiCpypXpO6urEuaxdrr%2BB2V6jETVxP41Ter52Xjekt2XrZ%2BxD3%2Fga%2B8pSvbegLSvvSLL%2B43O85%2B0up%2F%2FotwMIcMNEKbGAE70bBD%2F7lLcwgDDn8StiuFAaphaWE4c1p%2BJscHpuH2Qti3Yh4pQyujYN5id0uxlihKE7xY1e80xZb68W5C%2FJMZyy4Gj%2F3xrbJMVF3DJseZ%2FPHu9HuErlLZCR9NzXhHc14RWNZ22DWNpoFD5Qh4oBQHIJGkLgEnX8AAAcEYhiXSMFto5vT6ZL4aVrWDZd3M8Qv68vIb0Vyn5SMPSYz1cmfa%2FND%2BPAPVjzkMesQxzqmAIBD6OMS8BhGitqL2w3qFoCBZpyJKzZkRHtX0Yhl9NQcPUFIn1XSvaP0D%2B6BD0wDgA%2FyCIGXAKABeYQCAGHoBxEK5%2Be2AnpN6SwxaRn7aljPKcyoGf9zgQbtS1vDENeA1TX32uwAa1zCGsAOBbJDoQQA2GAfHCkCP8ZAngBMIx763je%2F%2B%2B3vfwP83%2BcgRsALbvCDx4MY40A4wxsejyhQw%2BESDzg7eDHxi%2FfbHde4hjsw7vF6eBnbdhNEPTyOcXcsY%2BEmvzg7CL7yidcDFGAo%2BcsdrnGO11zivGBHzh0%2BjVJfJhDi0MAwME0Aa6wDEtbQRxE0IgeSPP0Hcpj61Odwh6tjPeta3zrXu971NqDB62IfO9nvgIY2lD3tar%2BDD9C%2B9rd7Pexwn7vW0SB3utN9D20vBN%2F77ve%2FAz7wgh884Qtv%2BMMjPvGGxwIT9oB3vJ%2F98ZCX%2FNz%2F9wAGHzie8m%2B3u%2BbhfvfOp70NBeASEfAxhhBYAxfrCcF6UnCPSzgd6gB4wRZqb3tBJCL3ut8973vv%2B9%2F73g90AD7xi2%2F8RPjBD8dfPvMTgfnmQ5%2F4w48%2B9Xmf%2FOpjPxGOYEIbHOH974M%2F%2FOIfP%2FnH74fyoz%2F96vf%2B%2Bdfv%2FvdjwQqOyH71r09%2F6k%2F%2F%2Fs13RBuYMH%2F9N5%2F9ASDz5d8AHp8gjJ6KBMI%2FGAZikFoKrIcDrEMopAA%2BBAIAKEE%2FbAF5ZEY8uMMHgmAIiuAIkmAJjuDAmWAKquAKuoPCseALvqAHQpwHwmANmmDF2WAOluDG6WAPgiDIkUI9%2BKAP7twQ9uA4%2FxCDEepgPQACySlhDqbcE9ogDkohDMbczFUhDPJgFrKgOhQhF6pgPGgD0EWEDYTBGV6EEpSAPLCCBkwBP8jB0VlDCUACPriAs51JqnXQqqVOq00NGGgClZQLuX1HNgDDlcQDIMhaaNHap4BbE4lbZhEiDVHaQ6TeQ7ABPsjDrwXGFCCGPlwgHq5KtDnKtAmaH8pNIF7JmrmGISKiIloOfxmXf3mI%2FZTSJEZRJcLbC0AE7RUBmdCenfVZHpIitDxbH1abvagisVyJK%2FZIIi7ibjUisDyiGkWimuGiG%2Bki%2F5waDumhDvHh%2FCRjrSzjqGQjdDijiUBjLFbYLF5YLRrSLf8ayzZmUDdW0TdeUTieDyq2TjkOYjMe4jPCYvxcSZmFxpllxzXWBiumBmdx1DF%2BVjE%2BjCmy2jhCjj8SzDk2RzqOyDoS5DSGSzUCk0J2h0aGEz3akD3KET7SkT4SED8yD0biD0C%2BYjSqGkgCjEh2E0m%2BBkOihkOajUo%2BEktGkkuGEEyuj0wiEk0KpE3uIU5%2BjE7iE0%2B6hk%2BeBlAO4yh%2BZClC5D5aZMUoZdiY5G9wJIh4ZHEp1nHBIymt4ljWFEpOkVCuElG2klH6EFIiUFgCjlvqRlluyFnKYlrSoiDCljzqD1zCkVwiE10qk11ukbfVRqGhESAS5kz2iF9iCGC2o2D%2FvmNlmpdhKhIZfphiAhRjCpRjVhJelpBeXhRTquNAouVoDaYttuU8iqaNkaZUmSZVoWYsqaYQUWZtXmZAvqZTgiNU%2BoxUxhRVqoZVjgZWiuLhSKTLUCQy%2BtZPsebu8KVtYGaFaCaLuaOLrWVFgWZG3WaU5eZ77WZ89aYz%2FeYXZadsuWZHwmZgymZn0iYzHuZ52paU1QaVfZWVvQaW0RNkwoZkUkdw6qeJdKeCfOeRhWeSjWdhCmdoGhh0EeNWGiNyXhJ2eqZYzqdZ1udm3qd4fmiGlWepBINDXKipdSWqTWfTVKc4XudcxWcFbWdtNOiBPOiiRWijTWhypei5rGiL%2F7pohsYmdb7oUX7lH97ocoXoX44oeHKmieanOdqmkQJPeibYei5YexrUe%2B7Rk6JXlGbmlEJolUroicLYkKoXf26Uf8IGgOKVgLoGgbaUgb4GgvqSgmLpcNYkO1Jpia7plf7jfmrpgXFpiHnpiEnbkt5lk6Yim2qnmXonmvqomgIppT6amxIYnDKSnL4GnUaWnaoGnhqVnroGn26Tnx4qgxInfRpnPnKoKAXpZ1aoeSbq9ywqjjWqjoEpVklqP3Iqjlqqg2LqrP1ord0qgHlqh4Gq94jqfvxqlQXrdYlpLZGpgB0rjyYrIy6rIzYriuYqbUUrN0LqSsYo26Rrag5rTP8WK5QCalMKapoS6qYaakZmaaJOq2qQqmpda329a1LGa5nOa3HWa6beK7MWrDU%2BK42daz2261yuq%2FHMqFfWKGNt64Z1K4H0qLJqKsPmq2VaKL%2F26pRVa4AG7IMNbF42LMcerKwmLMgurLi%2B7E4%2B7JNFbEpO7GJWbPlc7Eu27GrerD7lKGzsqMd%2BqzSGKzWOa5uWa3PtbFz2bGn%2B7IGgalipqmqwqj25qr7GrIjOakvWKt8op1IxZ2o4p2hAJ4ZqZZLKaNUKa8YqY9E2WccCyMeCa8ja7MguJaKarNyq59UKUNAyKd2So91GGt72h94yLd86reKWVdqixtqGhjoUaeD%2FIql9KmnZQhPlLsjXkuyIJG3eLu1NNm1IPu2S5eyksaiW9mtq%2FCt4mWqAGG6kIu5FSu64Ma5%2BOC7qQq7q7u5lge5oWC5otK3oCG6XEu4H3e5jZqs0bayM9e53%2FO5Tpm5Orm6nRu2b7mrsosbsilntokbW6tXWpkbXvpTo%2Fi2sBqqG1mzk%2Bi2I6k%2FmqogDKMEU5G8IPITUTQGZ%2BC%2BZKO%2FmkmjnZu8IFe9Bsi%2F9ui%2B9wm9v4Wc8du%2BnFgq98QM%2F%2FMMGboE%2BrMM%2BtMgGd3CLuK10PnDcei5CJTBoCMf0Gm31csf1HucBJ%2Bf23lrr7hp%2FqgE%2BKMEL2IAGNIA1qEcg8MML%2FxBAemhAIOwDL44w6ZQwu54wdKgvUi3wXrowdsAwrcqwEJ3t5NpwufEnJKxD7bWeBQJAEWhgCYBiGWsgB57sf8ZqAZtwFkPiT4HC8GJjFU%2FHFZOtHJstDYdbF18QlB2dPogDPohDCmjESPQAP7BB7HnE02nAC0iyJOPAMXjDJWNyJmvyJnNyJ3OyM%2FCFJ4vyKJPyLTgDKaNyKmcyE%2BiCKrvyKGdDLLzyLHcyMBQDLeMyJp8DGEhCLvtyLGSDL%2BOyM9iCMNPyOezBHpyDMc%2ByLZwyM7tyLEPzK0sCGCzzNKeyU2CzKgPzNqMyYHAJAWzBFDhAEezDIcSe0zkyHGIgnf%2B58yXYAi%2FYwjzTcz3b8z3jcz7f8y3Egj778z8DtC0IREATdEHbghFkAjAY9ELrcz8z9EPbcyw4NERDNDFkgSQQA0VT9ERrNEPzAkd3dEETAx3QQUaH9EIP9EmjtEobNDFIQhaYNEsHtETLdEGDdE3nMzA0xKk4QDqwwgvoA0cQQT%2BEQQrImxqHARvbsRuXjjeg01Ln6bukWavW8QQrSOk27ulib%2FACjMxB9WtMdXdkDpSFwDBwxAvgwyFIIKapAT%2F8wFoDABu4dXQyMdw6MR9%2Froda9YFgte9qdQxzdVT68Rzvtc6GcyjwAyuIAzzwIh%2FwAy7QAy58iWPjwj24ggD%2Fb%2BnyMmrz8tDzumvuguVXV%2BXRvkZfW%2B9fY3Fgz7Boq0ZY9yRpq8bgOAAbwJkSE0AYhEIg2AcBjEFu28cSlxNnZ5Fn%2B%2BbQAicL323YSunYFuUTu9ZgO2xhT9rUJqZm%2B6pw25F1Z1n0KhRyL65ynylz16VzL9EW%2B1UKg8bxfkbyHunbcm4cq3aH2ihrqy1sq4ZpvzBq73F82yp9o4Zrj%2Fa%2Bwm4bz2nK1unK%2Bhh3b5d35xoeQ4ceNzdeW495Ey8gUyJ1pxKBj6qBlyqCb7dxw6d%2Fn4Z6fwZ%2BW7F%2BRzh%2F97GIjwaAN6d9%2FyRiZrh2%2FyeHA%2ByjkjeQ6fWCku4bL%2FfM7m38%2Fwrv%2FFIx4A44jRc4dk8ScbsniI8pi4sGiXuGiecxio%2B3hE8UdI%2BkhecihhuThlOrkr8Sk4epk2srlIeGlHcGlT%2B4lTdmjqMRhaMZepMIjF%2BljH85km%2B4mDMTmc8tvez4nzYwwjZxRc6mBPO4uX4vmPurjdOuh7MtCf6LOnwgkkfxWE1xa4L3pYo3eFR6aHDbbaBvZcl5QnK5Nnr5OOl5mBc60K56Z6hDOCzCEwyBEAzBEfwBNvDCT5ZBEARBKdD4pfNVphPIF36gvrnDq0%2B5j4c3kAPHFfg6sINGqIOGQaqwnI8gRP4VpSf7awu4kYpqsofDuKNDPEQXgI57ODw6jv9%2FzDPkAALAe7wjwAnoQVeqAAIYwCIstbBXFrH3DjYgQRIIfBJAQR78wSJgg4izeXNA%2BGvce75XJrVnyKiTl5YjrzpsQhcMfBcA%2B7OZlTtMgsDHAaSq%2BYnguarTEDoQQhCoQMvngB0k%2FGfkmDssQstDwYtK%2FGeYrzo8wwzIuwdIgLwvgrO3ALxPwr7TeWesMJp7hjoIQ9DLe7ybwCY4O3AsPHA0vGsUPQIc%2FbQ%2FizpAJNg35MV3xpCAvbJzyBbHOhREPbxXwTP4mVnFgx0YgAEEQbyWPHtndhR1wxG0PQK0wCYI4swTArznAM6T72nsvBDEexKkwjPUQhx4ALyLgDD%2BbEbHJXuyM8fWd33H6RtnIHtwaL5IqYO5U%2Fo1bIfn64jqHzfTw%2FozWMDfw7sFCD6AXP1vZL1qcH7Etwalo4MwwH23w%2Fp1CEM4JPvZc8bZg%2F0zhMNmUDrPBz86SMfzP4MwdIPvDzk%2FhUMS%2FLy8B4FoyL0dwPsR4L2dP%2BfJ%2B1OvqkM3BEG8W4AOTD68e4Dld4Y3AIPYXyXyckjhI8DhrzdAoBM4EFi2gQLVHVQ4MOFChw8FRjHWEGLFh%2Bo8IdBYxZ07dermTZKgsUy8bnHI5AnGJYcbYTM0TvJIiEyZMsK6uSHTB92iKjrIlKLorlacJDnIVLr28Q8ZMpMaqqP5lKL%2BRavo3IHR5O5q16vqnlkgWcqToSojEajoRlFdvI%2FxuDKM51Zdx7h1PcJFlw2YV78W4wECFO9v1xYx4x4s6C5YmRkWRATpEy5qODs5LLQgUytIjip1L%2BcwBGVDi0Um4%2BTw4CHIInTlbqmzrNrCiSCGPha%2B6k4TmMSF49nRiGCIJ2ybcgwndBeuu2vXfqPD27aqu7l1684TjuBIYuvTFcam6%2FZgW712yetG2MwBAPfv4ceXP58%2BgATNqqp3tx1BFWFgy9DIgCvicoccW7oJp6OoFqwrHAU%2F4mqtAgnRKIeoCEtwQYGAIWdBjyZkqMEMO1IvoolMfCieODSyIJjqjrD%2BUB1pLDAgs%2BFKgQmBSezpQ8Au1BEGAQNOiNEAjRbIgyt3FhFrOAagCCceKAwwYIaEwNpgSEOiSzGrrVIsDCwnDbGno3kMGW6RAmux44gj3JhEOumEcSPOVKo4whDKwvEpiDJc4ytM3QIbbFCHDtuxyw47EWG44Y6gTLYYBbRSASvbquJIJw34A50gHtUoiXJ4QYfSUMnI71CseuuyK3W6OUFU7OKRxlEJuljSlz6SCKIJMUrxTpg%2FnjjCDlkS%2B8POVf7485k8NOpOOnUmcSOILgjpJjF1eClqCDg9yU2dWuzc06wk8nhGVa%2FUYa%2B%2Bd%2BGd7751%2FYJVBVE9ks4dIRD%2BMOEzrDyRggURWjBWUlne7KOWKlqYgYwE%2B8ghskUScqdCBC7EqpYuJIYhiTKw%2BYgWJI5wQhg7dIjMU%2BlqeTOPbsiY4YQnoDJRInpNdCcJGRWKxw2NTggHGw9CncGcRDfxxMlI3RHGSQREmAGtE9ZyWiMRYFBAozjmKUUjCWqpaxGg11oVK61cNXuhMTVaDiF0EuVIujKejlZddyapcgZHEbAAG2l0CPUIZohRu6tCCTMcbsQWIoYWWfvOczgo2vpjuB04Hu7CeK4YboMTPOjGx8ihcBIPYrxGwIM%2BfBouFZxzblW%2FSXD0jhBCagkHq0m0fFSCP5Y0hOjhJHCjoRb%2BjkzUAEIs5y5fKIr2hKuEvKgbgSsmXOTIDUAdTgSh1Gu3vXjJh3feMDEaTiaGgimlbLzRejQIBTfRyIMNjtQoiCCqHI5Li2WkjlXw7VE5wIY7KqG1tAxpOGXoSP0Q0ALk5Q8BwFPPzQynjsAhAAqJGwiTvlaLbgxPBZ2YBMUSVYbeReojVsPYM9yRJgQoIBXzIINGhqAtkUAtZBuMA1yeoJEuePBQX0qb4hASlrZ5B3oImAFWRtc3AuagG%2FGA4HAMwJHuSaAFThJCX5BYEcQhMVHrU8gyxGA%2FT8zDHSzSSCfckRzuoGMe6JDj5jqHgA2kohulCMe9EFAme9DOicD%2BuJgKPEFHO8RhEt1AIm98ox8ZUq06%2BQLL8Ag2PKoRxUkiUIEC14QOHRHvWdHqSIA0ogJM3g2VeuSbASgHwuGcAHIISALsKiK%2B8u2SPufzEgQ3oK7yiGtoGqGBE7qHgFpYkXi9UiACTpCE3umgLRe7kDlmkDwnCAEtp6kEA4bTAifwzQLCYOZwgpAEJz3xgihSmwY10kGFAFCPOBleHMzElcMoAC0woAydnHQadRRTAatQh47iIA1hPENHpbDHdi7UjVsFS21GDONFlIgAtwmEcxq50jOGlwSc%2FAEtebDHFWeQijysghL2E4on%2BFaJI4ZxjIorY5eIwQKS1PEjPkT%2FB9%2FgiI54NA%2BPGnGCW%2BKRipEoIA%2BLWIQhtJQBW6TiUTMjxDPmgUv9yI5QqMzYRTbRAg%2FMQFu0qIAeYbgzBARBGuoYHTtHaYdN%2FHA7R4jHM3pHiIF2Lw%2FzqAVauvAMbPwsJvMYWzwdWQWyadUhuuTlY9%2Fjy5xtJ2j0AssVgrADYNgjHnKcxDyuWKZwQK4Fz7AHtHgYD2sOtAudMa09KPWHeHxTf%2BEYJFpScU4EkMEdPdJIMBm7EAy%2Bs3tfHYjPgCa04ZlxcY%2FaQNgAigCwfQSkM5QFNnonAe1KQIGEiIcwtCQBX2TEiYqz6EXXltGNClWxTsSb%2FWAIkvbewB1X%2FKx1%2FtoLhW48IxztjcNMkVhTw920cTTQCJcE4g4nbO2nGgFfDGXUUQQMESstxSIFESDTLoSqb10IIyQBDJF4tNe4DDHxfvsYhwxoJJGQW8R%2BhXGrF%2BnIrh0JTrRCArRnPKMbzQvCPNzYgmm5g1JQsMdhxduRTixWN46F7GMlqx%2FKlo0hbJnLMSpBiCr0rg8nTW5dKFUSdchCa8FUbQDjMY9u1GIRXTCBRrhgD9oG0i0EXcU5FVALj9SizMIszHDNhty%2B%2Fac83btSMRHwuoEk6lFCwJLVJPCiS1oXuzO0wKUtsIEKWOCHRNZIHlDpBiIWEW3oTa%2BT1ivhGQj6q%2B%2BFJjog%2FijeigVRuhuwNVquMGpTC1Uwuj4UgRWS0wMnTmcM5htF4yHDok6YMPX9mg50kAMd7C8HlYDLJKBAwAOHuDAg1k%2FzRNDWgzyIPGCJQxC0RMFJBAMtmbY1KN2hIy4k7sbcsYcbJWDrDayz2NejtxthIEu11AWClGyyu54MZfyEydnWZQs2aoEVOlXhzf3TyB%2B8DE3KeBoBdnALn9F6ZoxRtwuftPiE5QxOBGzCI3id4Z0hKIK1CLDPwVUIoFflDvIiwAkjat5u5yGN4SlaIIkyTe%2FWFCSxRJq6RCsoOgC5CGwIQxmVoAWPsXLYGdzLAtCtaKl3zRD1bmuDRvZqQ9yx%2F%2BRXQ1AF%2F3QHrRmw3e1SOOzH7TUZY8LZuczFHcTgFwez6g6Jtg0dkOuCmeJBqWVTWB3BEEs54fKMSdQCG7wQRioWIUJPxAFyR7C5V7ytG1lKYBWJiUcXWtAFoTyD0SpAwooR4IlaEE%2Fu2l0TQuld13trJO61D51az5B7jbRAHVpPcMGp%2FBcnJ7x8UW7yKtBiCA%2FGgwwLyEEewAJICwzBDjrCeME3TimPj6vPIs%2BYDo4kAR24YQhCTLl0%2F5Oll5%2BzsjRH6%2BcHgnOzJfMJ7jsZWjxAGNxB6DSC6JprEezhhiKIMiBN0qqLhuahiW7JHmTBA4okbOxFfvBvN8Cu7tgmkP%2ByCiQ8AS0IwR5kqO0SYh4I60rYzu1o7QqeIReEQRZqgRZsoe4OQsDUJlGw5Q980AcXgRj0AEnKoBZSof1CLo8koAxKob1GTsLoTpREZS0UkAZsIY8MqCOaKFfMi6vExOX87S2EgWgMIAnsgbBaYBPM4RpQQI%2BkAdEM4RmCoRZKoRawTkdCSah072JmQBiCQRhWQRaCQV3OLiHiYcE46Mg0AgaOj8nEBOGYr%2FkWblB0pLSQKhjIcAfeoXlYQKbsYYO%2B78s4bvxAzsysKR4I6XvUwR64wP1oSwLiz%2BUKiv5mbhVqTjf071Aab3iuJn7obEaGjiLK6Lv4hmsasOlmKLf%2FrmgHuACQVCBkhKqVAonb%2FuK8PDCj7EAOg4EQIEcEYOivhOgjBmhrMg4FoSiVTCscdKAFdgARqDHQ7s6mOExARMAWsuFUVO7TPGIM5%2FEJ84juZAmaWkCB4oAYlMZ%2BcgCQFKULI0k%2FWlGIcCIVYOBrKGEekJAM7MEeKAGcJCBY5KgL5sEeSuEEZqAKQgYP46Le7KoWOHITMpIMVCAH%2BkC39EodDCH6FBEBGBErkG8DpQMSIzFenE%2F0ZMiJFgHzGA0BNwwBdoAY6mGHKijjKmsUP678rGkemqft%2FIpvDu8VY1FLZrEn7Q%2B4cNGdMkgWRulRREAPsIRGjsQAT6BK1iQe%2F%2Fog%2FYRBSDTCF6irRhKtLgiLgfpFFqJCqexH3AzHGsPuA%2BWOeNxROpywYZzkGc%2FJHMGCbzQjmWQKBzkqHgesH9PCFryhG6DAFz1ASTgqFeQIY5Zyc9orCtXBDsSif5aQVPBmePrHAoznkbxQTLohNSXgBPIRCqxDATfADeKAgHikKIWADGTFAHLAHKQQAfJQJT2CUjagC5JgJJaHK7pHAWZAajTiBqrosHay4QzuEccnKIVyEtFHGn3xMyBMI3bACZ6my8APzDSCFK3SQuIhdZyoCnixKznyK%2BdPLG3x%2FsrSJ3ejGwgBCqBt2vLgGEpFILrBDuzEz9ChD%2BwEA0%2FCTv88oUPdABor9EIrhhKe4EG9gBZ%2B46CM6h39AjF3LUh8US0RIXHAIpmGwwRYDm%2BqRAT%2BqcI4ZTjwYBk0czMNRXFSYROUdEmXtBTs8SNSwULd4A9gCCFk4RmEwRM8YRN6wqM%2BohaU1OsSrE3sxA2CBTawYljK9A8E8MN28ws3SHBmrhZs0wAUYMUMwOPQoYkAUwT0DG7kMiXjoEqCYB%2BVJ3%2BAhE50KlRy4G60xwBUoBENIHR8cvnUsz6GssnUwQ2sRwKqQFLCoYmqRAJgwgCC4Jx8tC6EoEp%2BaMy%2B5hmGSm8%2BYimrRAECx0rQIYE0wgGdRBmvZuaoqm8w1C9y0Wym4yP%2F6gJNP%2Bg6DsI60sM8yGPvmpVZE8wj6uIanAEh3AG00IISXBT0OjAxu0EMvsApzJUMrmpFzWERguA7W6JKx8Up4kB3PghPvnMGaGYcwEgzddBY7eJf7aIgEGLv8iXBhMACPOAIpMEe1KG95AY8FAJayUNZ64JgFXQ33lRMwoEQhuBej8A1ogJhvvMIGqESnKIme6Jdv7MM%2FMwOnEIwEWITThZLnqEMcuA7dQBlpcMW8EBlc8AOyiZeycAOECIY5JVe0fNS1%2FNiF4Io4qAKrqAKyuB1KiMPpKAJphYbnEpOnmFrEcITnIpDnWoRGNCpuPQjzKIKuqAT%2BsSpusEWEMFt%2FwWibaUOLLYWOgdqbJH2L4oVvZS1SIshW8clCbZs%2BH70MMO17niBHfbOYh3CWiPEyvQiYiG3IwSlSPs17AS2ItzBDfLnBJxglPLQL%2F4WB0MvRbADWesiYpHVOaAjPbBCdQsWK6h1YCdXX2RXIRZXdiV3W%2FjORCxVaeUjU4HXWWtXW8mBGOjCLvSlRLR1dpm3eb2DYLGiRDrEeavVkqJXem3GLOuudHEwcKUjGC5FTb4VXMGkSG%2BhHIp0L%2FYVBzN31zYXIgYqNSnICdQDfMPudHHQGbK1fde3SINXeOGDeNHLG26wfedXM%2Fv2ovQ37MQXVvYmanDjomA07AK4SC%2BXX%2F85EwcX%2BCL6BAre5AiqgBLmpDAe2NT4t%2B78t33RIYNxcIAJ2D0M%2BKIQ2IU%2FuO4aOIxS2NTEl0K7wZHO90UTF4PZV4Pft%2B7i19RyuLEAFntR%2BBbad4XDroUB%2BIhjGChnuIDZEwdvWIENon13GIl6GL1%2BeFqYtisueNdgGAc3GH47uO6a2NTK2E0bUjOtWH2x2AO1eItpuIvr7ouLdI5NbYwVp47D6IxNt4jZeI%2Fr7o2VOI41N4w1E5EZcojDJI81s40Ts4%2F9uIbDSJA1k5DRy5ANx5IVR5Hrbo1NjZPDDpLDbonRi5R5WIqLlIp3TZNx0JVNTYZnGJSRSJQ9mJIZ2Hv%2Fww6VDUeV95eRW9mRXzmJY1mS5ZeYv9eWNROXTU2X646X0cuXH6sB3gWYFUeY5ZiaddiYdw2Z1UaZd42V0Yub0QuWd02WL4qWydiaTTdjc%2Fl%2F9ViAPfk9UoAVXAEXcKEIACCgCbqgAUADIEEcXMEGegmQw46cJ9mFTVlt1Nls2FmFmfmdnXnX5NnU6DmM7PmQ8XmV9Tmb%2BXmTP7qb%2F9k9poAfrGEYrEEJAGALZJqmbRoS8CEQxMEa0pOL01g3KHqaLRqd6fik626j0cudLwqeLyqk0WukkaikT1mp2zml0Uubjdifg1o%2BAkEeQgA%2BAmEdNOA9NEAeLuGm%2B8Ggh1ei%2F3etqJnYnMPuos0mo1eFqS24o5%2B6peMZmudZmue6ffF6ULB5q1d6l%2F06jLyZFehhGIYhDNzDsSFbsm2AH%2FgAAICAH9SAPpoBk1PEGwBbfr3hqEE7f7F6n6cYDEDhtNUDqsNIqi%2BKqhUHGEq7SAub4UDhjvs3sbd5il%2BaAHDBGviAFfhhCgiApvnAFfhBCS5bDgDgB%2FhhDgCgCA7hurHbFoBhu7m7u737u8E7vMHbFmJBvM37vNEbGGLhFtK7vd0bGIwgE4rhvelbvMu7vvHbu2PhvvM7v5chCyRhvvs7v2NBuwccv2%2BBvw%2F8vZeBDuhgGRa8vtc7wumbvCn8vYtBEv%2ByAMIvvL33u8PdW8FB3LxpIQHexQHaI61DAQBQHAA%2BQK2fO7r5AbpLoAhs3MaVgBayYcd5vMd9%2FMeBPMiB3BluQciN%2FMiRPBtuoRiSvMmdPBuY4BWefMqF3Bligcqx%2FMe3O8u5PBvGAcC9ocuzPBacQcyxvBjs0cynfBz2YA%2FGQc2n3BaYHM6d3Mrp3Mm9QcPf%2FM6TfMv5PMnJ%2FM%2BRvMTrowF%2BoARYfB1YgQAOPdFDIQXw4RAAQAn6YQrmgwA%2Bu31FG4dvu0glwrWj2IW5mqNb%2B4rbV7ZpSrBnma6Teop3G9QLY9Sb%2BZZfmgPkYRheIAw4O61xfQw4O7nFwQYuAR%2F%2FUkBe4NrU5HrVj3qo%2FyK3w0SvP4yvwwi2kQjVA0zV65nV%2FTa1m1qrL0rWPdqr32UL5AEf8OES2oPczR3dq3sd9AEfOtvYmf0vkj3blx23ud2MfbudpR2JqF1xrF1xaNtwrBqj892OYf0vwL2vxf1dQqAIIPo9Hj4G4EMDiuAFMPXYDziBB1nbSxmpt92Fof2R%2Bl1x%2Ft1wAt5wBl5tCv6uD143eZuF972RG96PhVrTOX6UPf6i7HpVnD1FRt68St5wTl5tUl5tVt5sWt7nX%2F6S23fhp32xkcibhVecDafeSXrnw6jnD%2BXnTSToETd9WfrUR3uqsT3rCbvpD9Pbwwjq%2Fv1d6hWH6pXW6tUG66ta65GI6wfF69UD7L9O7BWb7Ns36Vdl6bte7SuK7ZHI7U0e7jPopQmY7s3G7msb7xVH78OE73XD783GqaNe8DH37O8%2B7adY8RWH8Yne8d8J8qte420454f53isZ8dd55pt66NWm6M3m6OHxSHWe9G%2FZ9A0H9XNf9Y2V9efe9UMZ9stZ9nFQ8wuD83MO981G91eF91eF8A%2FF8Pee9nNO%2BNWG%2BKvf%2BFdF7i9V8leF8gne8g0H81ME%2Bv9C%2BkkN8LeZ%2FK%2B%2F7Gdb9Csf%2BK8Z%2FM0GIJw5Q0ewoMGDCBMqTHir3MKHECGqa%2BYAgMWLGDNq3MgRQIJm%2FuoiihxZ0JstkigjAsuWsqXCKMZCupyJrtwtmjiLDcTp0h0YTe54umwotGU2YEVTxgMEKF5SlCufkrQpdaQ7TWCCVo0ocKtIol4XTqzYsaxZjR9lhlVocu3DqG5fxoyLkCpdhDrvHvQJVK9BsH7RHQ1McGlTwujgBrYb%2BGpWxF0RA9Y79qzls2kRt0WsODBMtXoZB85LmK%2FWwJP1DiZs2CnhzqFvlsZ62m9kwqnpVr7Me2Nmwptfs0T8mbBov6Qb%2F6ytNzfd1YFbcx6%2BWHZj2pB34nYYeHfv7xZ%2FBw4eGLbe4tURo0vu17Rk7oGh%2B5UuHPHxu46Z372NGj5liuAF%2FiieX%2BT5Zd5d6Pl1313s6eXedojJpxd95VGnoHXtYUcYf34555Z3AfI2oF4F6nUgXQnGpl6D%2BC33XoRIscaUaxXah6GDGgbGYXP%2B3QViiJaNeFeJd50YV4p3LUgXi3Q92B%2BMiFFooIUqzvbYhto92R2AQIoIkmYnTaceknQpGReTcTnZYY93SXiXlCZSmeSN%2BOVoW5ZrEvZjl2UJSReRdBnpFplxmekWmm6pySOUMh5Wn3F0NmmnXjve5eFae%2FLJkZ9xARqXoGsR6pahayG6lqKWsvlcjNHNKCakiOWXnXqXhpWppmh9CVyYjxIm6lqkhmVqWKjSVWtYbtIFZ5Fy%2FpYZaZqT7ofnoluShWufuo7Ha43EzZUeYsN6VWxcx3qVbFzLBtpsoc8mGi1dlRqr6odcXtsRp2556haoYf0aVrBehbvVuG6Vu9W5bqX76bqjtnvqu3HFS%2B68mNZrr2%2FZErjtlGN6e%2BGK0zbpIoSEIbyWwvsyDKzDxELslsQFU2yrxRdnhO9a%2Bq7Fr1f%2BegXwVgJXRfBaBldlclgo66zyvyyL6%2FJaMBMts1e31nxzWDmHtfNWPW%2F1c1VBSzV0WEVLdbRXSWu9tM9ND%2Fx0WFGTPfVWVV98tVdZe7V1VV1X9bVUYT81tldlP3X2VmnrvbbXbQv9tldxEz53VXXbe%2FdW%2F3lvtbdUfUv191OBJzX4VoUndXhViWu%2BuN%2BNi%2F34VpGTPrlUlV97eVWZV7X5U50%2F9XlSoRc1elWlF3W6VKnrvrrnrQv%2BelWxEz%2F7U7XjertUuUu1e1K9J%2FV7UcELNbxUxQt1%2FFPJa7%2B8782L%2FrxU0ZM%2FfVLVa3r9U9k%2FtX1R3Rf1vVDh48n4nlI%2BnpwvKenT3%2Fq81z7hve8p8SPg%2FIpSPz7dLyn5S8r%2BhNI%2FofyPJwHEyQCTUkCcHLAoCdTgAv3XQPE9MCkRJOEEhVLBLl2wKBksygZ50kGefDAnIUvTyLQUH1bNx1W9%2BpiV9AOvIE5MTzSr2UVuKJQcCmWHOOkhTv5%2BSJMQ0mSERSkhTU4olBTqcIUebKEAX1iUGIZxhjypIZCoyBMr8gSLNNEiTbg4Ey%2FOBIxCEeNMyMgTM14RjT5UowjZKBQ3BhKOOJFjiOiIEzviBI8z0eNM%2BOgSP%2FZkiHkqmREnhERufes6V9KRE2MGRWtJESOUpIklaYJJl2jSJZxsiSdbAkieCNIlhMSJIe%2BIyC0q8ouM5IkjfQlJmlTuBXXgwwouooRAhMFa1dyCK2GZMRJtLE4dA82cQBYrUFKriFEqJcdgtcRZvahaZSkCPdYhD3m8AABh2Ic49HEJAuBTn%2Fz0Z67EOaRvMiuc7CTMLlPSS5z80iijfJM6wf6Z0Ayl8k60auZMqkaAYVjDAS%2FAhRIIIA5cOIAP%2FLABSU2KUhtgjKB%2FMqi6EHrK0aySWOZMFaNa5ShTKhGVTIzYTeXWyo6kAB%2BHsEERKvICfQQCAEXoxxZS4FSo9iMMGyFAM%2BKhjq569atgDatYxwpWd4yDGO4gq1rXulZ3EGMcaWWrXOfa1ShQg6t0zetY08oLvfpVrO64xjXi%2BtfC1gMMoMBrYQvLi3IQdrF5NStaIfvXegBCEPWgrF%2FdClfNRrYcvHisZ9kaD1CAIbOjnWtgB5tauvZVtK0VazymsU2M2AAf4hDHPYahARvwQw4A6AE%2F4OBb4P7gtwAIwQ%2BWu%2F%2FcIlgCFNCNrnSnS93qWre6mpDEdbfL3e6CQhLa9a54x%2BsDR4z3vNzNribQy97qgre98I0uKZgACFLEN76SWO992%2Fve%2FbKXFGAAg339i97%2BEni82T3weUmxhygMWMHeNTCE05vfCXvXEgXoiA30YY0QAGEfciguAIor4uMCVwmQSHGKDxHgFrv4xTCOsYxnDIYs0PjGOKaxjXPM4x6DwQdW8LGQdTzkIsM4Czs2spJ9wAQlOznJTh4ykqNsZB%2F4gMpFnjKWhQzlLeeYCVf2co%2B1LOYcd7nMM9ZChjnyAnxAAgAkvQRVnxrVMKRgH3ywKlY1EoCtuuPPgA60oAdN6EL%2BD%2FocaDW0ohfN6Lcy%2BtGQ%2FnM83GHXSUf60oZmR2gxzWlCC7bToAb0YUlRj1CHmhfsMDWox7EMVXfasph1NaeXAVdZX5odibY1pOth2lLrGtKf%2FjWkUS1sRsdDG7W9iAOs8dGjHsIB63AFAeSQUmizYtopfSmY1FPLltyyJblMyUJR0lCaPDQlwaTJMC9ZzD0e84%2FJxMkyHapRl9RtC%2FpMBzzuSe1h4OPaAKgDP%2FwdCoHarJsF5Xa78%2BixKil0qAPLqbx2esSerrOmOLoopSAuu6LGExKBuCectwAJOWjAIgQguck3hfCYKpymP7VpOftCMnQ2ikYXj3nGg%2Foyjkv%2Fz%2BOv5CZMOyXThcHc4TIvjcSfKMp0WpyiGK%2BTxqWVUaAHPTwtJ%2FrLuzX0lZFT6TQnol%2FSPZN103LhuHx3T%2BJNk3mbu94tkaSAsp6voqfs6OMEl88Ft3RWNv3mr4q6pKbexKrD8%2BpTpDvO7K40vDvr68o\
JeyhtzlOcQ13nUuc51PYuQatfPZYzmeVMup2Sb6ck3CgZN0nKPZNzo4TsLjH76NEObrXzku0zcXvr4Z4SuYMH9C4RvUtIjxLTowT1JFG9VfouNYqT8ukHrejO3Vnz%2FyRbisBvifBbQnySGH8qttcl54XHfKL%2BvfKBx%2FzgNQ%2B38b%2FR80HPfkq2n5Luj%2BT7%2FiNB%2FkiULxLWD4X36BZRyjJR0Sd40EJ4QmV4fuF73yF%2FKEF%2FUEF73tZwefdwM8d%2BkuN8EgV9MyV9mUd9YucjUfRKDkgSEEgS9icS%2BCcS%2BicS%2FBcR%2FtcSrkcSsNcSsjd8Enh84UduuOcSuvd%2F8EeCioc1jKc2jscukNce5ZeB51dxlleA6neAGAg77vdIQYh9Q4g3Rag4R9gwSeggS9hxTfh8T9iBBuguCNhzCmh9iJd4Xbd4W%2BcrFPh4eneB70R5Tph%2BSDd9WLKGInh9VpOFmLOFqtOFXleHYDeFPzeGG1iGRueB6weCk0cZwZAAbYh1b0iEcegZc4iEiBh5iig%2F%2Fxo4gBz4iGf4MGm4eX6oG5V4iR4hiLhDiMpjiEzzhS0ieec0dgKILgRohlGIhqEIQVXITHoSDIBoN7CIPbKoPrTINrYoMrioU4xIio54d5AohZKYi3%2FoiiU4Eic4EikYESsYES0YES8IETGYEjM4EjWoFL1oir%2BIisEIQ8NIb1cYiJmohZvoF%2BMIEeUIEef4EOmIEusoEu2IEjfIfTkIfrHSgy3xgzIIgCTBgL3RjSLxjSIRjhDRjw%2Fxjw8RkAsxkCRRkBFxkCSRkPW3kPm3g6vnkCkBkeookSNBkV6Sj4O4j%2BfRiV74iUoYjRM3jbxYitZ4ii2Tiu23inFBk5dhkf8RgZEqoZL3p5OHaIGJeIe66HTV2HjXCIzZKI0LOIJYaJOxiJMIIpW1yJNg6JNMh4dkqIcVaFHz2Eb1%2BHb3iIxiqYxkiSJm6YxoeYtxaYVAmTDvOJTxWJR%2FqUxzuXvFeIyWk4z4s4wK1IyM84xCpJZ%2Bx5aN6JZ0CFRd%2BZNfyZi245gYBJkqJJmsQ5mJEoaLiJnUqJmeyJl9aJXbeIlMCRFOCREa%2BRAcuRAeuRAgqRAiORIkCREmORIoGYE20pBGCTmJCYSH14a1%2BRC3%2BRZQqYJ7OZl9CY2HaY%2BBeTKDqZVE6TTLSYVISS%2BgaT2iiUOkeUamyTyoeSqqKYrdiTTfaYT%2FWymPnbmWbEib6VlF63lI7ck%2B74lTltl884k29cmF92mY%2BXmZ%2Bwmd%2FVlH%2F0lMAcpAAyou8dl5B4o4CVqICyqe29l2zRmRxWiJ%2FHmXj5mXR3Kdp5mdlRmiirmhqNOhs%2FihbjOe0DOiMVmXjYmio6mig8Ki7umiqVmg5seaQZmV9hmeNwqjPqijBCmTIqGUQRKhlTSh7FahLHShEWekTIikgimU4FmYINqgBrqArVgWBGADKoVyIfCmJUAWGvADKXAvVipLWHp2WppGXCo0GSpDo5ikrrmTsKlK5VkxxxgCuIAP%2BsAKFfED8oAP%2BMAPWwAAP5AO%2BkAPezZQ2zaoQeqj%2F3xKpPDppWIIpt4ppktKpk1qpkf6oBtxCfRQBGGAD5U6q3ygBnLwAh0lDj8QCvRQAtq2K0AaKkI6k2J1EB%2FUVX00EMqalk5KojKKPDTKjDbqODgKP1A6klIaEVXDAfLwZhoQAhUBCevwAsAKAM4GAErQD1MQrNoyrP1SrCLRDfRar%2FSKDpNGEP8TDvQaDj5YDP3ak8%2B6o9GKPtMamdXqOtcqjIc6M4B4W7gwDOvAB%2F40DPsQqaHgACWGXATQsR6rAcEAquaTp7OnHkwgrxABDkEgAifQsi1rAjRQBZ0QEt%2BjDlAgAiJgCKB6DXqAs0cgsvb2E0DrUN4QqG7BDkzBDv%2BeijUsOZNYMbRdVAyIAQ7DKRZgGVz4sA5TMAeUSgCHkFRy0A9ssLFzAABTwApom7a2wAu30LZu%2B7ZwG7dyO7dxGwuxQLd4m7d6ewt2u7d%2B67dsawSZwLZ%2Fi7e8YAsogACKu7iMqwe80LeF27a8sAMIYABiQLiFGwt6YAAGwAK8gLmRG7m8kAWSALqhe7p8e7eou7qQu7qnywt0QAem67p%2F27q0m7mqe7uFywuSkAWzq7t5a7vAu7ex8LvDK7e8UAkmuhFNdQkAAG2hgBHQ61t5BgT8oAZw5gDaq70gqw7l8L3gG77iO77kW77iKxgnYb7qu77riw62wBLsG7%2FyC77%2FJ%2Bu986u%2B6gAOLaC4FoCzOKsAiusBz2AT4etV5vtVQaC4eMAO49tVBezADsGzPmu%2FD0zB94u%2FQnvBGky%2Bt1C0G%2FzBDpEN6QvCG4y0gMDAJKzB7gu%2FKXy%2F6OANN9HCF6wOTyvDLlwMUmvD90sUOhy%2F6mCMHaEB0fa88AAJGhAI7aoB8nAJGkAPb7YF%2FaAEWXWnoUeyOLinD7G%2FCHAF5tCvhiABijsJ6iAbaSUNz4ANf3YQ6uAO2PAM4TAPCYwAfeAUf7bG6PAMz%2BBV7tANz9ANWuEMxWAO4eCv6LDGaRUUeGzHovOn71ewCHSwpZmwzrOw9NiwVHO1AHAI%2FHAIl8AP%2F0rQAOIgD2oQCvtQBAAQCvjAB9YgDifHqcK6tPEKtQihxV0wD12VVicQxmPcVYuQBB6wASLwBKVwGu5QC0kgAhswA4sQx30wD6sQBEEQB6kQBBvgAUkgDOFQBiewASqQBwRxDY0AzV2wxnkAzaUwCTlQzUcwzItMqqt5lYCXRHv4gbFZfbPJEQ5wCOkgDmNgES%2FACutgDZWaXJewDsPwAywny8FnxQqJxQtBy%2BowyN1ACGAsAb6gDn1VBYyruBLQByGhDqkgAotrAAgAxnJsD5uguBsgASStuC2QA5y7uHkQWJtrADOgDvFQBSSdA5W7uBsgDAqNDsH5FdtakrsYpv9KqqBMaq0DixIwGaU8%2BrwGZxEOMNXPGwB2GtTzx9Ap6dAKocXcrAIqINIl%2FQfuAFp%2FsLgtUAW5rLibEBQzwL9VUAUbsLh9gNKLawFQcAQA7NJVoMUtYA48q7g5gNNX4NNVIASLGwfPOtQRUbULUZwicZwoWJ3%2B2LT955JOna3CWdQPQaWYQcULDa88g7IQocUbrbgiMAlnbQttDQVv%2FAxxjQA54A6pYNKLMA%2FzsAkLoLh3ndKKawj24A48jQAm8Ax4jQAW8AzcoAeEbdj86wnz4A5xDAWNzciAaar0iapKrapMzapf6qqfJ9rax9XIyXVSocUncAQ74AEeYNIIkNv%2FlcC%2FtRAU8QDcy70ILl3IBDHbv63SeewOSaC4UMBVtQDGG8Dczk3b0I0AQWDfbkDg1%2B3O8qndCMrdHrrUCtvUJPHU2hrV6KnVD2jele3VCUHL9qAO0oANtTDbMFAO840AItANHy0MFlDSwqDfCHDTBEHdvp3cJxAOazzgCBAHBo7gCv7c8XDYCNAFThEPZSDh5Efh9vZVBVEuVl7IXhV3koWVsIydhYpRsqkbmNyjnSrPOSni6EDLTtFV89AHKo0NMe4B2FDjNy4BOa64PF7IzAzkNC7gimvk6nDgCJDgza3kTO7k%2BBrlCGDdU87hBuEO4bAKqVDpz5BW6HAs6vAM%2F5UO1OogDJ2Oop%2BeCp5QCV5OP1tOnTaS6vRsqGOelGUemmrujSQOjpa9kaadxYr7BcP9Z%2FPA6Bsg5329CbY8D2ld6N0wCQF86eqADR7w48B9An9O5IJO6Ia%2B4IW95Iqr6FAu5eKD3dy6CDPAAIvrAV1w6cfiDoaguGUQD9re5EltEPHQBdse79KK4QQxyISMEJteC7UgDLg5HGs86wpRDrbg77Ww79hIGWu8I6me5QkB8Y%2Ft2VZ7nvZjpYYMaBKfENO5EEZiyASPf1osBItgCIawCFxg0jkADrYw2y2wCcIwCWRd4M9Q1whQBd2ADfQO7Yor7UMe6Ede6EnO4O%2FO7f%2BM7ujfTuUzGeGpbdyp0FjouO4I0O5Fb%2B%2BFcQWcywVW%2F8gY%2Fukz0AIzkMcI0e03r3lRIel%2FUAsEXxe2INIMkAprjxCyohfCEAzB0CDdYPcAf8d2%2FwwL8Qx23w0f%2FpyIR0cqPgmIPwmUIAx47MfSWesZuS6fPgmLAPd8k%2BsP3fSMuwiaRgnwDd8iANTusPMyTtY8jwA%2BD%2BhFHvTXjuj1vujeLkDgHpJwrtJV4AazveO2AB%2B3DBrqzu7unuiKVRAQr8dlIAIecAa1MfAE0az3Hu%2BDDsB4TlBQzrlIrxAroQ6bENelEPcGYfA2b%2FmR2CSTIAHmLwbXEOmLYP45sOjmr%2FX%2BCSHg5p8H9g7ZER%2FrIV52hNDS%2FLsBFgAQKv64Q1fQoEFvtg4uZNjQ4cODwLI5dIfIAIIZEDU%2BjGJM3UaQBlUgIFmypAdC6srdUrdopMkcqT4WvFLSwIkjCAzksbeJpIhu6twdMWDATTx1tUhKeMZNz8UZ6uJVKdolHrp4ZYo6IRgSojswmrp61ajumQiSOYLFu9qFpAE97NAJ7VbKkzR1M90ZIlmGbU0EXdxJe9bNYLdnhQ8%2Fk4buWTBaCgsSrLUJm7twicORBRkPEKCrG5NKQGBB2MyD7txYsMBlbF7YBSV280Ay1diCsRfmNci7oe6C5Wy12LBhFWrYqHcD9%2Br%2BThMY3JzJuoNSEsQv1O4WkYSB1S2CKqEXugtC0o54jbfKSWd%2FUF0zBwDkz6df3%2F59%2FAASNFNONt4fkwJEwI7%2BEJKsPQQloggRklpAkCOPHmSok0kqtLDCTZ4haCV03OnGEDJCXCSc19SZJMQ4nhGmwtOewTC3VCr05aNuLDTHGVoq9GQuWSqs5aOkKjxOwsnCik5CdwBEQAJZQlMHGxVyIKOScj5y4wSSPEjCF4L26usvksgQRgQPZgjKHS466EAwdaRpwQMRnnGjAw%2FKIEgdT3IgTQQyzlCTkCMf9Aw0kEYr7bSGpAkmmGdy8zCVUmQh0R2JlEELgU3CMWeycIL%2BKQUv1MLpphsS0alFUtzykqaUYEpFRzhhFt1sLnWEKaWURlP1sJRaSCzwq%2BcCJXI3YSwwCZGxtCMpo3i%2BC485d5JgrQ%2F0aC2Ql%2FVy821Yh96LLz9ww7Vvv187I2QpKK64IgjSlsxlprzckTeh3ngTCkjf7u1N3gLj3XYyYryZi1%2BD3KFkhhmuUE4od8oFqSOH2ZN3YoobDu4WR9mKx%2BLxNI7XYoZfI3gyedEpxpmRGUZuZCLBEovbgqZalqFnpMIWneoCPOFHLxHwKx7AulCnBZI8weylFkjcDoEW1OGCJC423qTdktqlFmasPqu221pIM61Ad%2BwwwQQyGu6GCxX%2BFFiyhS6eWaYREdRGAM5NGv6jBWNFSGJI7UQQwQ5CZpBAghYM6codYaBAy4IW8phLuBlM2FmoTXTYgKQNZjAE3me4WFwFN8KJeLxgsXYoHjsCDCK7pZn97gp7upEFm22fqaUWbPY1VZaglLNF07xs99V09%2BAT93hxyW0vnnMR2KCbedhqHoE%2FrvKwFkMMqeUYYgyyvRZ0hFmkV2FqmRGdUrSnVXxKNEztmVIISaUb8cLxpRJaPPTEkBln6uZ2YRQsHKsghCc0NDqHQIx4GuHQAjVyMgd%2BxUhYc4cTSCKY3RTkFuzgy5LKYIjyIOAIUungz4JmjzKQxA32KAUDllL%2Fi3kA5gz2%2BI5V0BFCD%2FThDzkoydVgNqit%2FaZrhypQVooChaskQUAGOEIxGnERmywChQKygEx6hhYoImABk2hYMIgWIMEI53IISEU8PGEsARnOLDMQ0BNEFxLnQCeCuQkHG0VIGgn8aDKt8w5JqhCHtIkACrW40xVa0AJAzSUccZiBBRRggiPcZi7CYIEKoCCMJIiAASooQ1Ac6C3khRI%2FymMP8zBXs7nQhiR5QIohVNAuCXhADJNJggQs0IXaLMAQOojlJEIogScIowtoFMHmDOKG2jSIEDCSwAKS0IdLSaAKotPO4HIwmU7kQG4b6MIbOaPAOTKkgeFkCATJOZ4J%2FsIsHC%2Fxi0PUkxOf5cMe5sBSHudRQjAFxh6eIIkOwmaSzRGNAamg4QXnMUQESHEe0jABSXzILSAWaohfY0hWSAKFeZSiQZ6ohR3kVolVDKFdOjiCLFLRLij8AZ46wEoHEaACO7hhjM8KYQv6UIZ2TaIdtkhmKuaRszLUohQhXJ07AHOCPKyGJAOBY%2Bnm6A6fLEkWX2xnh%2FjYLJIYK4si4Fl5DHCeJ%2B1AQBLoQ8NqobYNeCCLBqiCsIgESlHGdT6klI4pnQe9eMxjakvtiYCWKi94mqQUbFSABLLovADlUSgpFJAdGpaKrArIDfLiozvOKKAkmAOBCwHnOS%2Fm2YWY%2FxO0HUont9QRwraOp2G8wAaWEACFMsT2JZOwBz6BZtBuLO4ZSpRbFYbougvaY2kn8ORQHBpEBEVUNBNF1EIs%2Blp7TIIkAglGSyaRClt4wxyXWkX0qnBRe9hjaLa5Z5aCMQ97AKYK8zip84SRj3ykDjw77Wk8dHBRSiDmD6wyy%2BUkkAr4ShcBq2uqHJ%2BaMyHMgwwkIe5HlIWRPi4rDl1o1wiNOyCkKHFJSSiDay2winggFAFXsIMdN4BK4sFVrnGlK2fsKoEyxGHCY1RALeLhhIsEYROb4CECkgDYkhwBCkdAhx0lEIdOaBgBIliEIZLZh4OikQydwOmh4gHZBi1iEv4vyYFQ%2BFhkkhxhE4QY4yLcmsAIjXacoxUtaF125rp%2BFyMLM8QipMHaSxWlKG8hRG2%2FdNvAbEzOeRhJEHg4AzeQ5AxsqaE9GISAG8wkHolGwEOHpdyyMLeIjMWoL6hGuC4YjRjZyC1JSkGQHg8hpiVepZ8R0GWsMDYH7hCwCGQcB8C0ABw8JS8ZsriBIOThGRvjp%2FPcIGMyoBXFGokjnCVklmRKEaFmturMsLrkZ8xjHvK1wFrgaYeDyo2V8XjGF50Q4naRIR72aG%2BNNysdFa84lC32z%2FT8SoaPrMgOz7CHOxh7BCC%2FOi%2BGsWMS0EuJkig0hDyJA0mCEF57yPkP7P5dik%2Ft0TwaeHlZliWJCcIR3g5CwdmcTTNo1wzaNnv2zRTMQ1aD0RWz7EkP4LhUErrAhS6EqAuLKK%2FP8mkVWi%2BLNHZIoQWwtACZXLsLws0S7ToET0sTCdMQMRRFnctppOQBjSYJQnZLjYBTf10ne9YJ7DoI6werQB1KGvueDbABbPCajO54RghN0gEoF7vtUGTKZps9x%2F9gThjmqCNJhODgqzrrKv0t2jy%2BbQ8lqeCN8ehDg9Dh6SWdmvGKXWC85X08envFrgLygBt481g7DOEEcgP4hY8yFzBTb2MClkB1T%2BtQewiBwVDgvR27QPG5nensGsdIzzzAeyiEUPLfLP%2B5Z9XBC4%2B5R2NIMV3Kz7lymKkD8yKkXxJLogd19NgO8nRHHhaBKtsGDSliJ6PeEdBgpR%2B0XRM%2F6BijLqGpP6TqzT3Ic0WuDnuQkxwYI50QA3L4ulNbp2WpAt5TlyowhJ5DOwFrmg7aAOSrgiuoAjLYtZ6SClqDgrQpiRPTqNKAAgbEwCroAk%2FaiL%2Bbox6TgBM4ARVAI8V6MOAascVDQMczD3toOB87nKWRAGEQBq%2Bpmc3ToxQzns%2BbN%2F5YnuY5sj%2Fogz4wIJgTBh7aMzRqvW8TDzsys6BjGtG5vUqbh%2Ft6Cz3TiRy4sizBi57pMhvsmb3TiROYFa%2ForOubhCZwQC7%2FmoxJwMAMnIR3CwnrIyfsgxnVKIkZIIM4KMMBs4V2oDQLWIRn8EF7Sr8Lsh45e7%2FMIMDUUrqrKEMYswPXqjTkWh6tkagijJ7pcwf%2FC7FFsAOee4ZNCKEdOEDuih54IoN8iB5DmARfIJHh65AJNBEGA0B7qIVF%2BBTh6MBJQIROMhWtKxrMM43wEh8D2hSQaMHOKwWq8Su%2FsMEIu4IcvBRP2MEB6UGHk7Th6hSvOY0jDESy8LwlBJfQCwm7eh5V5JiCCKEcyANZoDQtNA8uJAkvnMAwDCEoC6EjyAM7sIM86APzcwcs8wA2HL437KATaEiHhEhDkA47JCcjeguuoCUo%2FzKAOChF9hjEcCpE01IHwBAQFRAGbCm3qimJsomHDlI3mQm0aiOJH1MHsSKJPYyHp0GAqFGHVNg6knAhUsSa%2FOMaPLqCEJlKMoBATqOhixCB%2BemGnGkCW1QhRBCG5tmARfiQpfAEV5NAy5OGZOIC2%2FmiJzgHuUuFcBCBouACbKgLY1GA2yjDIxCGZxCCi8gBOmQ2p1ogNFkKD1jMxUSjE5CGeEi8BukGVtyrPIqHx6M9GJKXnAkCd9C0d%2Bw8JZzH5GnCUhrLZeuNZ9hLXwivfwu48zCILpQXg8wLhLQHSksCiJMxSZTINRQKi2wdqFrD8JoENzAEWfDI5gNJSvuJ3v95hmQSSKxRyacqrexDhzi4lKXYEndQD3cIhh7LKnzrEERgjclyh2GyADuZJBGYFnmJA9ZogeIiA9b4AoLYJ8uxgL8pw%2FsTlFNcrm40CSaaoteaB2FIJgnYABqsBG9whyGwiUlAhy9yHrUxgCRoqWVxMAGTvCQpCQuApVJgh7mcBx90ng1olyQQCkqApa3bw2w8TNOBtjDpBmmQhm0oBj0oiT6TzIsqHzu6pgs7D2y4lBmYhFJYMJKAQNB8Bv9CwhgdTdKkR9OsK9Tsl9VUoWdYhEsJSAyTTYKkzQY5SIeaB1lol6BqHgMgBOCjSOBMC%2BKLinCAgTArBUowgSOCR3T%2F%2BMhwmrQAMZrhNInYdBSK%2BQ2KWRh3uIZrGNTrs04KwoYL%2BZGPUA%2FYKwUL4T%2FEUAx0uFTD8J7E2NRLdbqCQIzIaBPkTAVG6YbcWyWUrKv%2FzLQTHRxYhVUowM3BaSt3KIXw%2FIlFWIZsqKaSmLhaeNCqqQLa2YvB0QENHZwZ2Iwkic6X4iLhOIHBkSRkCpAhQKW%2BMQkPYKoCGzmJcanbgI1rKIYfBcdry6p22SJ5EdbzgMMAgYK8WNK9dFKskccoHZcpdbE%2FuIi%2BcwhGJMAlox%2FdM0nx%2BKKCnC4x3YmN6YLD8skOwbINqMgMfbDuoLUARQATSM2HWc49bU6B5FNADQ3E%2F7GDJLA5T9iWvEiFMyjZMlgFkEmFP8ADSpiEJ6gCQFzUl%2FmkQjUISRVUfdQWeGEO4EgO91CHbCAGuhujJzAMT7gUSvBWe2xVjQiHWFkUq7XamlEURpkM9MmeXtQQBUHK7JmERsmLTvBamfCfRQmgUF3bgsnSsb2MV7GFqp0Vumuy7EkF2JsMF8me3pwOGK1X3RuwhXCGa0idwooRa0NSMpjQDTCcp1NVq5rQ0uimeCWNDXBH6FwSes0%2BKL3X%2B6jHbFwEyYEBjc0NX7A7gcgBGSyFqRgbbkUHIRgbLoKqsQmCMISCsVGjRWqorFLBeI1BM%2FGysUlRWhsbIhPGFpAbCf%2FQAZdVTjzFP0qTVhGyzSVxrUCVqQB5AlRSh27IxKUog7kISQ8gDQOANUJk1HPq2dHKBmCYCyUTgRBcMrxwSqkti%2BTIX3z5l5CxGAUZGJbZ2XrhX%2F4V4JUQWgF2jwTu1gi6nVpITWdwhv%2B5HWmY4GCYi%2B8RFUP4gz8QhrEonwfWixrhYEPw4JkIh0q4nVkJBwcuzHr9XNCtD9EFCVEZFapDh1VIhflxh2ywBVJBhxouzBrGxkz94YII4twgNx02VX3sBltgBoMwh1GZFSk24g4JhyUGn%2BjNU44FPEobAqI5MWyojRYIoXaVryWJTtzNiyuAIgsgQMEAWZtgJZyFWpj%2FYV%2FQct%2B5wAa7g6IW2IQthoinJKf%2FVTOMGa0OCdx6ZQ50iGBr2V%2BgjZeNWRgEZoufRQdeIOBALhQYjuG5yld4%2B5duiQ1vIAbk6BdKpuTlYGR1GLWifeWiZWSy0FMvvqic2QQBqwILGhADRaMkqIVuYCwEyIN50LsuAMyc%2Ba95aM4g8AQ7qK46RmR0wGPP0mNF8oQ4cANtngTKJJ5BDqdCNrlDHi1tBC1HlmZqJid79WT9AOVzohdpDmfQouUIAtkqUJJsJglC2GU7gLyfuAypeIJ%2BUjA35Q07KgPcFLxJVjn1Jad0JidrHphV3GRBvt9zkudzOrnrU2RyOmdEfug5%2F1pnT57hCIJnRMboc6JnBwJZKJCFBUAAHeChPNKwfpYvgIuZDpqBCvqSmMnNhH4pb2LonB0tkJ6jiAatb54jlA4njSZEjg4njybqbAEtkY5hknYgkx6tpQ4nlV4gkHUCdMASBVAbFUAHmrYHmwbCjQOq0ABZ3ZzeFRRqO%2BaWoo6go%2FaspI6grY6gpl7Jp56jqAatuhbNb2FnGXZncspq0NrrCOpqb%2FZpJUMAJzDHfm45CPuIZV6WnTwCkRXWWaW0jEBklvSswV6guz6nvHYgxl6gvn6qv46gwCbtqXa%2BTmbnq14gxfas1V4gxzYdt7YHy%2Barb5uHVRA3oViFZEJoJf%2BJRNpsF0P4aSQS7YYOp9ImntMGSYsm5IlA5NaOoHL2rNhe39k%2Bp6oG3dsmnty%2B6O1G5N52ytzMqJIYKMyUzsHFiCAYoxPI2i9iAB3gpbQIB5ae65aZ7jmqbtO57j3NbnBeb3GW5u8%2Bp%2FB26PFW59oeacQOp%2FTWbmnmYoquK61gonj4ujmMhyAoipP0XrsTwbrpkFWg3GX5ESOyUAFHEgKPIAPHGgQHPAVXagb3rO52oAfvaGfY8Bs3rQq36gufowxf8A1vb0NsBCSAgj7ICzvgvTzIizzgvT1Uh3D4gyBQARVIxFx4DWywgxwAc0QrrkWoAiTAgxl%2FkNEWb2nO8Xr%2F3nG97vGMHmc3e20HinDqnvBwKu97PW%2FTWXIeb%2FIuDmno0wtLngy2WBkuZ9b%2BEAog3gzqcxREdfAad6Ai5xY6X2k7V208J6cfR0w%2BXyA%2FL3BAD%2BkjN%2B8kL%2BkD0epRJycnh5lSXyDq9O5NX6BOH5ZP9%2BpQX6DdNp1bN50gh%2BohR%2BdVjyCRdoAfePZnTwH5eIEt%2BAH6oHZrH6VXx%2BpYX%2BxZ5%2BpE52s9R7lkJ%2BddJ55eJ5Jf9%2BZgJ55hx5pip6BTJ55Ut%2FFl%2F6QK%2FwF%2F4Ad%2BwId%2BOAQAUIJ7uAd9CAT5mIKBL3ht73D2MPQ7R3SG54x4n85yd7NzN510l5B19%2B12N513%2F7f1cd9oAxuteuf0eyfs%2FNAAJVCCIggFerABArAGawiBQ9CHF4j5mYcEfHiB0N123O523f72Oap1bpl4mMl1IL94rMn4B9l4%2ByWUkxZ6BzL6YTl2wK54wT75JCzs%2FAgBeJADAEgBfAD4IuiHLQgBfDB4JTD7%2ByCAZnjzB%2FGG941ngZHmjoD79qD6YSl54gELUMD79mB6BHH6H%2Bp4rPn4og95QgSFkTdnrCdtB291ALgEcYiPHuCHOQCAy1cDG%2BAHsP8BzweAF5gC0if9LaCFCE591V991m9913f9YoiF15992q99Z4iFk7F93d99JniFbNh94Kd92Q9%2B4m99W7CF4v9P%2FtTPhiyQhN9X%2FuQffugv%2FmLghekv%2FmygAzp4%2FusHfl7I%2Fe4HfukPf9vPBknIAu4n%2F9o%2FfvXf%2FfFv%2F9fPBlpIgHARezWQD9AH%2B86Xg%2F0HgPwHCAA%2F%2BBAkGKgYsmIKFzJs6PAhRIfAYkWsaPFisVi2MHLsWMxIJo8iK1IcabIhr1snVxZblkXSMpYnYwGTadJWSZsel9GhE1OnR41APU4c2nGZpCw%2FjV7kxYspx5xQIyKjlQAA1qxaAajBlwJrDH58BPIL80IsgCL8xmzN2swdurhy59Kta%2FduXW%2FA8PLt6xcdMG9%2FBxNGF8UY3MKK795a7LiuM2ePJ6NzBwZUYsr%2Bi2%2BV0%2Bw4217PiuMBAhRPtOLAqAuXa7x6sDtQYDK%2F7hu59mDXuPm6a%2Bag7VZW1ghg1QAvFIAw%2FX44kIdcORDgCZqp293Xmy3rfYFl0873cHXvdVuLv1tMcnm6ljXRTo%2BOs%2Fu5oOPLJW2aflzu%2BNGRx%2B9O02z73bYffPSp4xtwWTmwDnJZHbLPJesM89sh%2BlwCz4TSUbcfdvsB1t1%2B4OHXH37n7bdee%2BkVSN98%2BNl3Gn76jahbfP8FiN%2BA%2BK3o3oG%2FJQiAA5BsoZUDfAxzyVdAGolkgtOFR1%2BH%2B8mIn4j0kUifif6BwR6BneHXIn0vSgmilTS6Z2OK5eVI347p9fj%2BI5xxavhkfFHGSCZ9VcZ3ZXxZ0odil%2FuBGZ%2BYd%2B7HZ3poCoiejl7G96ackcbpJIfZjemhnu4hmp6fNW6Zpnhtpjeoe4XSN%2BWeZiYKIKjerRmfqOJBKimtbVGKn52n4hlfpultWl6nZ34a6JehhVkajLoeqmp5iuLIKJuO8ohgrdVmdSuUlhoaojF0%2BsossNAKy2WjghpLKLKXzngiq4t6GKt3s1pbK7Z1aqsst96W96t4wSY6bLnF7mdqfKhqCq53ztL3qnvwaifvvJLW616uBe%2FqXq%2F7Iuydv80CHK25A6e7bZns3riwuA1L6ya1EdM6cXoVu2cwxt2uu1%2FH4gH%2FGjCL55Y6Mr4l%2B9fus%2B%2BuXB7ELk%2B6Ia73WoypzUKXmLLH5IIssItAP33zn0SjbDR%2BSSv9I8zlyZwezellLB6%2FHFOt88ewHl0eqekRPPPFGpvcqnYMqzh3vC2PvbS%2BZjuNN9SFe9e2djknHLfKIWd9H8mp7u0usY8KPjjZTGfrYdrlrb34xo2%2F%2FbjVckt%2BLOVBWz70yfH5XZ7D1onN%2BVZli3d2eaGLN7p2jFvnuHY7X92zyK1vLXWNXst%2Bune173Y77td6bi%2FoeYse9etTnwj536ujqzziXDcfu3uzhwr4w5tXn%2Fv1FB%2BOtva%2Fc3%2Bwh8RbZ7zqWLOe7PK6dz6%2BWUd9%2FtFjn%2B3c9z7rKc47vBOP77wDPOsIbzf62w3%2FIue%2F8QGwfMw7k%2FPSBz3tSA831Huf7hw4v97VT4L3%2B1b%2BRohB8NEOgdapW3nuRr9lXa5omZuWjxZoq%2FjFbIUQbKF2JribCuLmgrjJYPg2%2BDPy7dB8IERfegxIQhuaUIFCTKF2HuidCCbxhXrDmQyfSMP1iW%2BKHaziB1eFRTWlETclrM0JqwdG64hRO2S0jhJxw8TaOLE2UKxhG%2B2mNQ8K8IoE3I0WrXPH1%2BQRd3vcTR%2Bt88fdBLI2g3xNIV9zSDZKUZFUZCEPYfdI3ERyN5NcTSU5d0ncZHI3m8RNJ1%2FzydWEcjWj%2FjxgInO4SDg2Uo6rrE0r7chFPHpxgbOsTS1xc8va5HI1u0RNL1Hzyy0GUzw6RKUVjYk5ngFRiHOqVPYSF05O1VGUawRmKYV5yiOmsmtzFE8ya%2FNK1MRycM98TTRrM83XVBM11xRNNkWzTUkuszY49OYwwRnHZoUwi%2B18zT5F08%2Bx%2FXM1AX3NQFdTUNEc1DMJ9cxCXdnQ1zzUO9%2Bk5zp1VlE6gs1AzUQhEQ2XznzFtF8X1eY7uRlPiM5zjEhcYukwOFN8%2FhQ1GfXMRpXWUdR8dDUhRc1IPVNSzZxUMylVZjddGlGYTlSm93RVU0XzVM1E1WVTFU1VUXNV0WRVM1ul%2F0xXKfNVfa50NS3VzkuNWs8BjvN45TQn%2FBoYRiMKlqdl9en3UqdB5E3ujRItJkXP2re0ematlGlrxN7qmbiKZq6eqStl7jqZvE5mrxjtK2r%2Bap3A%2BvGogkzqE5eK1ppqLoiIxYpoNUNaz5hWM6idjGofw9rHuHY1nqWMbHdDW03a1pO4NaRuN8vbw%2F4WuDndHWNrq87Hui2yx3xtWAE71saSd3%2FZLSBnNfPcx4B2XsGlzHA1U1zKHPcxyXXMch3TXKfCVjTRxc10bVldXV5XlO%2BFZHwpM1%2FH1Nda951Mfimz38n01zH%2FXUyAFzNgtRbYMweuTYKluWBrNtiXD2ZlhP4nM%2BHFVLhaF35Mhiez4cd0eDEfVkyIFTPizpZYMyd%2BTYoFumKDtlibL0ZmjB8zY8VQLwWXuPKVh5QCSFw5FD8AUiCOlKQhKpaP4aXueDEbLvP%2B0D1HXk2SQbpkkjZZoU9%2BTT7Ra1PfbsUG4vjzOv4xlin0Ix3iWIcSAFChCGWIzOhUF5XMyLY6IzTKIg4qQ9M72%2FWKt6fFu%2FNq8uzcIk%2FmhAQggANYkSE%2ByCMExAGABpyTnH4UATgE%2BK4KdxrpMt82hmwmp5t9ZkrLklXNCQM1akRN4LDdFCtT0MeXARAK57Ai0TZAi1rSACQNcJvbJWjGPNwh7nGTu9zmPje6zf7tDV6ku93ufrc7iOENeNO73u5gAjXiYe99o1sdvFAHvwNe7mVEQ%2BAGd0c9wCAKfR884LwoR8MDzg1iRJzf9ShNPSq%2Bb2JwQ%2BP2Lge7yw1wj587HqIAQ8ZJDu9rXMPjI3%2B3v1%2B%2Bb5nbex7NJoA1GoTzdEBiGPoowrXlQBahT4EVRj%2B6OVrxiVGM4hNOf%2FonVHGKpbei6U5XRSumDnWot0IVXof6Kbw%2BC1pInelWP8UpRuF1prci62k3%2Byfargq1Nx3rbm97062uClrM4utPP4Xcrb71q6tdFVdvO%2BLRXnWnmz3sWtjE1AUP9a%2BPAu1PH0XXB%2F90rPud8VI%2FBS3ezv50xqfd61NPvNnr3vXCO73tis%2F60q9OC7Ib%2FvKAX7zmo856qiP%2B7mlfutlb0QZGKF3ym5%2F7JyzP%2BMznnvOdVzvaQz%2F30S%2B99Gu3u%2BibDvi5h731d8%2B83sfe%2Berjnfpb97rfMd97xf8%2B9a0YxCCKr%2Fm1Jx%2F5S8e68Tff9eejfe99F331Md31uV7qJR%2FedV%2FUud3tUV%2Fl0R7UVR4BNh%2F6ed76bV%2FeBd8gaIH8DR7dUZ3VqR3uceD%2B1V71hR0lUELZUd%2FbDaDbwZ36CeDhfR%2FcJZ%2F0bd3t%2FZ7mFR7ygWDvQeAHsl2zqUWiYUUIaAAAlAA9XELQDR1waAArdNeP2AAkQP5hghxCtFHhVoSCEWIhkTwhF2qFGoTBF2qFFY5hVmihGQrEIaRhcohhGpahGYZAg5ihDYxFGm7BkKQhK%2FAZFrLCFv7IIcDDFhJAChjhgoRCCuBDIACAEvRDHm5FqrGhFLIhJFzhGKKhGUZiGoYhG8KhGWLiGP7AGqZhGLihGXriF8ohG4oiG4aBGrDhHurhH9raMOBCVoSAPLBCCEwBP8gBzlnDlnlFE3ohHU5hGlYiG4LiF2qiGXLiG1riF4ZCCKQhK5KiKY4hKnKhKlLjKJphKaYhAcSiGfohnDSHMWJFV8gDPsSiEtADPuiDHbaFE0riOY4hMqahMnIhM46hM%2F%2BeIjRyoTRyYyte4xdmIxZuoxlWozcSJBaGIx9SITn%2BCAHYwJhhxQtsQRG8GgCkwBb8Y1bMYxpO4jF6JBXmIxbu4xf2IzaSJBQGZEJ24xh%2B4zOmIUKGIkx%2BoUyOoUPKIhZqACxI4iVQIkt2V0SOoQbY4ia%2B4kjC4jSaYRHUY0oqpRne4xiGADGGIlRyoRpI5RcSAC48JBTCwix2lw2woQOUZRq%2BwFhyoQ1o5BiiZRw2JR2uJRa2ZRo6wAuwYQjI5Ri%2BAFh210Tq5RSs4lD%2BFly%2BpVv%2BlgbYAF8C5l7u5atpwA80JucwZlZM5GFiZmIOTgj0wKsRwF5qgKsR4Q98wPv%2FnKUNBNFEroBWTGRevk8K%2FEAJKMhjjiYAhMAP0KW1pEAPzGIJ5KZW%2FKZuRsxZviYRhqaPFKcQEcBkZkUKpKZW8OZfusxz3uJjJidFnmZtOid0cud0SooDbCeQPOYfvkB34o5mfmQPzKZ6ViTn4KZcimZoZoV5bmbEgGZt%2Bshi8qVkUma1NEBthsBv4GcRRmZzCtEPpIM%2ByANDmpMS3AM%2BvGOiFcE6LOgjco4S9CJWOEAovGMo%2FAaHeuh31ooD4MI6%2BMgWRGiEftkUyIM%2BIBruvIA1RKg15KUT6gM%2BXMJv3GiONgDnEEAgRCg9CB1XqOg95OUWuOg6RIfLAGmEikOt%2FyUHPeiDOERbGExpleLOD4hDhB4CcWgAl%2BIDPyxiCPgcPnjp%2B8iBP7ihHNwDlaKlHLyjONTA%2B4TAOgzHRq5DhGpoClgDjsbj4ByCiqbDb%2FDBOwIjVhiqPiCq0kCCiorDbzjqk%2F5GkOrDMLiny4QALkQoOfqZPtCDUnoqqFaPGqijPAymtEWopZ6ao%2BoDLpjm4BTBPkSoOo7FD1SoPOThrVqo0mQoreLDHDCiO0poWuDqhf7oMFQpK7QaFRoqH6iBHKTAL%2F6AiQ4niY4BPWhocpTFFvDDK4ZBWYArVyrNC%2BACP0AqVhyCPMgBtApoOgzDDyTriEbKpirBFOADcsgBP%2F9sgRo4IgDoK7%2F6a6z%2BAyTYQCjoQ15GiBywgRxwWy5u6TDYp6T8QD%2FwgZ8Nw206B8RmrJeJQ8RyDi6kQw8EQj8k2g%2FoAyRAa60JqhLwAT9EaWVmqxi%2BQI7e6hPS7CXY7PtcQj%2FgqRLowyGoQR182SXQQxEcAj8cZpMOgzVAqxpMJD8cQhEkIQBcm9RSbZNawzBA6xicmtZyLXOOaRHgQ1ZGzCXggxKk6JCY6A%2Bc7VewrdtyTg%2FsQ8EOQ8Q6gDjgArSKYYbOwbMt4uCkgByw66ZmZLL%2BwLJqAAEc7rL6p6QILuHiw5fVAT48a7ROa7XCpiICAKENYXeFAjA2ZViMxRb%2F0BrnbIGF4AORhsKJEoA4PCHrOgABpMNVugze2i26AgAuXGpT%2FgA%2FaBsbJO3gEEAY5KHW6q44AIk8BCUuiAOqLS%2FnvAAfTGPp1towsEIJbGEjDmYgIKzLSCZxMC3n9sNgCmoIbK%2BiCePgvEBeToE%2FJFoY4EMRJAnOYWwiAu7gNECy4oMYKketXYI8OEDpRgcAw%2BrgJKk44Gmc%2FkCSLMgThgWRjk2sHUIKQABW6GtZssI6EAAGA4AGz2uC4GIgpICPiDAJJ%2Bo%2B5KUr5K7SxFpQimZ43sMUFoEjaoAMp4XAjk2QknARbqTqnnD6TiPTSuy8aMA6jEUK6MMidm4JKPH4%2F3pupq7D6oauRe4D6Zpu9fguG6SFt0Kh6%2BKDOkICAdAw3%2FZDg1qLDdjAC%2BiD0C0unlqDNTjAELsxEdMKASiBA0TIb2CAnqqjlxLaYG6BP6Aq7qgFH9QvADRA3jrA8eItUqInLghirIFx5c5arfUrzEZMCgyDPNRa8H4ZBqcBP4DyKFcPHyQhcUACP6jjpRoHcsTaHI4NH4jDvYqhy8YAAHRvCvDBPpRlIKQw56SAPKgB6BJHKKwyPrxqCNxwIpattfiuPNwDgwKAo36Fo4aAoFozPrDnvAABMsPDkHizOoIzNd%2FDNBat49YKze7uEQNADVhx1fbiC8DztQGqy0wb6%2F%2FiQvsiM4yGgiB68DpYa7VAAqECgDe%2FolqEwbUhdBePzSWgK85RshgnNCPmMOfQ8Cv6bgQjVpAEgg2QLEaacUWf8bzMcxvDcfjG8RADANOCcKTELqxdgsUeQskCMgAIMiEPzg%2FIgzVogCLbousOQwTkbSJrbR3XCgFcQlncZijIgRSOMrjWWhpgscsYbDvr65cFbw%2BoQSmzwXKYst3mpRzk7L1eAizD2nFwzg8YbQrsw5AEAj%2FkJS9Lr%2FfCtdLOSzjCrjUkasFuwT4cQgmQ7UbSgzNXi8FugQ1sagg46mwKaglAwj1oM6bSCuIiNid3ZihYdqsB8DRe8%2BDYAD6swxT%2FAOzoxjMfnMVY2AA8D84xQ4ISJPAYh8IU%2FIA1BLQGG%2BG0CTStJCKRqkVG%2Fy7FMvQWK80K4INSdnQdOiIZczFJz4tG43BzL5AGEDbFlvGxkus%2BEOkcGzUuDEf9HnWtwHR0KiL6li4UK81Oi8NXIDLeukIDNDJR%2FyjPbjRWBF31AsAnc44c9IMNgGt06OsLKAcRAEAdCG%2F1nLVWNG8KMEjGBuXYeCU8yIGgssIPdHD3loCF44NxukyGXoIc1PbTagXTCvMUJuJNHvD77nA5a0A2UzM9pHOtmLdWhIE%2FHC0%2BnLM86LacrHFQzu4lrPEiXhsbJPEi9oC2OrT3Bu%2BG77cN%2F1yIEbrCieIOG6iv78IBFyM2P2zxcisN5XLzR1L371b0dStNYE%2Bh%2F0JhCARCrZl4YC8iVxemOmc3VgCwBjhAWtO5nccya0d5CpThtdXBWQgdH3jv%2Bt7pmGkwAdjwFCK6Bgg25yCtVL7AIeQlEJhxdaevl1dLEVzCbIbBPxQBDQ8JJNCDBoS6i8M4eAYtkKwDLnCwUra0%2BKL28JooPMiDO8JB50rbibpvorGujsfJFsDDOtQ6PlhDCdSBGAa1IwtEP4xrxBytEY7BcoDrlzUvAfRrtbOwtShBIBghthdBt%2BM3f3N1Wa60BLP6qps19HZucwSlTQ%2BOy4LyPqQAtxcqP%2F%2BswKB%2FhTU88uC4wsf68Boqx2SeqSWPze7eopoDfJtzBT%2F0wAKFAj3UQQK7dMQYxzqoASvgg8O7wrpOfPXEQD8QaYer8mCOPD%2Fk9J7%2FRgrcgzikAS7QwwssrhSzOnjLSTj2gziEgiusYbdy2cveND%2F4fCZzOD%2BsIyvggg2swKKOgTXAg4D%2BmRzImsv4Li7IwTqIQ50ncB3cwwtrPdf%2FKC7Ao1KL4THzAdIKnb4GQsZvuO3WuVr4op0Og6FOYQhgyNz%2FaLc1r%2BLiQnarshjCNR%2FggjxM9rb%2FAyuowZ02QArQAy647CIufuOPqdJMwT%2BEAuJHLOVbvoQQwDoDPu7A9SH%2BkDwAnC0f1LYRkr7pRy89WIPVt7qnX0KpPqEN6EMoQDru2LmDA0AAsMKQejzvy4HHf688nKMRX3zGfxnHA38cL1AIPDTS1yUr5O0QpkAovC7bj00K4MIjMr01sMEAYEUawDEb1DytBMKHYsUPrDAuROkLVD8ico4T4oL8D8MUcjAcu6H9W0N004oa4IIrAAQuXMN%2BACiCSxyrHgAA2GAl7lIIhhMpVrQ4ccowcaFeMLThCqLEhiAjXjR5kmEISOKsqSEAQMMhlnJeNggkbtgUlDtNpsClhOEPhJA0MAQytChPpRMDXUq5suUAAA5kDgO6lOcWjZdSMFSi8ZADr2CtxWK9GGZrVwBoIZYYKy5QWbMmHQSyZm0MQw0rcRWEydfvXJMHIXYloMaaOEgitYrj81LwRQ2swlAMcUmcKxspMWuOTJEDri0UHYr7ybBEqIQdP%2B%2FUALn13NcVZ8dW6iDpRNy2lQbgAFsvb6Ua5OotLvwigdwMlSNvTvH5xOjIYR4nTvs4dejLAUzXjh289t3bK3pvPV43d%2FTUr1OsPfG9c%2FXzv5uMDxP49%2Fu1AwIAOw%3D%3D";
var provMapCoords = {imgWidth:710, imgHeight:708, mapWidth:670, mapHeight:670, leftMargin:31, topMargin:19};
var DEFAULT_ALERT_SOUND_URL = 'http://www.universal-soundbank.com/mp3/sounds/261.mp3';
var SWF_PLAYER_URL = 'http://ddflux.org/bao/bao/miniplayer.swf';
var URL_ALERT="data:image/gif;base64,R0lGODlhJQAcAOUBASEhGBgYMSEhISkhISkpISkpKTExKSMjOTk5MXMICHsICEJCOTc3QkpKSlJKSkpCUlpaWmNaUlpaY2tjY3tza3RzdIwQEJUQEKUQEK0QELUQEM0YGNoYGOcYGOchIecpKec5Oe9CQu9KSu9SUu9aWu9jY+9ra+97e4GBgZSMhJeUlK2llKWlpbW1tfeEhPeMjPeUlPecnMa9rca9tfetrfe9vdbGvcDAwN7Oxvfn3ufn5//n5//37/7+/AAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQBAgA/ACwAAAAAJQAcAAUG/sCfcEgsGo/IJJIE4oRML6UUybkortiMaco1cTQWRXh8zXCVJg8nE8Ziw+az8RTybDBit9sSlw9JIV9WV2RtYh9+QiWAgoZ6bok/JDAkG2x5eoYWiHIkMTshd5qYhFh+JTQ7dniPpKadMTUeGnhkrW1+kzGrj22OCn4mJy6Nb72EficmJLOsx3p+LovFvs/RJCJfv6Wu16FgedvQci4h37aY1WHRISAb4K2t7O7gttWQ5CEfluJ7eez72KBz9eqMCxMiOmgYlKChgoYOISY4w2JFDhwyUkxwsACBAQMEBggYCaCkyQEVpKjA0aNHjhkaOSJAUCCkyJICAOTMOaABNZIWK3i07MHDhgoKERx4rGnz5k6cAwaoKCJDxtCWOmaoqCDhAQMGB8KKFRvgQAAGENJCQCEEACH5BAECAD8ALAAAAAAlABwABQb+wJ9wSCwaj8gkkgTihEwvpRTJuSiu2IxpyjVxNBZFeHzNcJUmDycTxmLD5rPxFPJsMGK32xKXD0khX1ZXZG1iH35CJYCChnpuiT8kMCQbbHl6hhaIciQxOyF3mpiEWH4lNDt2eI+kpp0xNR4aeGStbX6TMauPbY4KfiYnLo1vvYR+JyYks6zHen4ui8W+z9EkIl+/pa7XoWB529ByLiHftpjVYdEhIBvgra3s7uC21ZDkIR+W4nt57PvYoHP16owLEyI6aBiUoKGChg4hJjjDYkUOHDJSTHCwAIEBAwQGCBgJoKTJARWkqMDRo0eOGRo5IkBQIKTIkgIA5Mw5oAE1khYreLTswcOGCgoRHHisafPmTpwDBqgowkLG0JY6ZqioIOEBAwYHwooVG+BAAAYQ0kJAIQQAIfkEAQIAPwAsAAAAACUAHAAFBv7An3BILBqPyGTSdYIpn0rTKEStjqDYH80kHZW8I9L0mkXSXC5TqSRVe0khUtlIi7leJhI3zQWPyHNCMTEvfCYxMGhpX2IugVp1Ly+JMDR1hFxqVI8xNTSSgzQ5njQwhWqNczQ1PHUwMas5OTiehHxTqjk8g7A1urKjdYu4ZTE4OaWWxzzMPKOYUiFznTihNMvNyHZugFirNaE12M61w9Jllpe9ujuz5ZrnWemvr6vttMKLm+iwky6vx3BYQoTmDzF5g9Bw6XXpVJcQIFQhOsHnBa9ECv9Q+SARBhc2ezLlefiBIzpJfUaIVPnlD4gQHzyowvMwjEExUzZ+4KAqjXVLKhrHgABRkoPRnifgwIRJtKRTD0Y3bMjSosUOHThYqEDBtYLXr14lQJDg4IEDFU9Y4ODRY0fWrSjATpgroS4ECGUbPJiQhEUPtmxxtIA7ocIECYftPsBbdsECBAhYFGFhoxlbrFrjGq7LmfODzwwkeJ2L9gcAOw%3D%3D";
var Options={Langue:'fr',mapInfo:false,KDODef:0,disableAnim:false,mailtrone:true,KDOUser:{},NewButton:false,NewButtonSelect:'',NewButtonSelect2:'',NewButtonSelect3:'',TourUnit:2,curMarchTab:"EU",AttackRunning:false,RangeSaveModeSetting:0,ThroneDeleteItems:false,enableGuardians:true,NewTab:true,NewTabURL:sitesupport,NewTabName:"Site BAO",NewTab2:true,NewTabURL2:"http://koc-bao.com/phpBB3",NewTabName2:"Forum BAO",currentTab:null,currentTab2:"Overview1",reapprointerval:0,TSSrchFilter:0,BOTransparence:true,includeMarching:false,EnableFormation:false,showTroops:true,showPop:false,Smiley:true,showRes:true,checktournoi:false,SelQG:null,showProduction:true,showDefense:false,encRemaining:true,pbEveryEnable:true,pbEveryMins:60,pbChatOnRight:false,pbWideMap:false,pbKillFairie:true,maxIdlePop:true,ChatLearder:true,voirRaid:false,WhisperOn:true,gmtClock:false,AttaqueOn:true,EclaireurOn:true,srcSortBy:"level",EnableRefrechRapport:false,srcMinLevel:1,srcMaxLevel:10,srcTypeSelect:1,srcaDist:0,srcDist:20,Xrenfort:0,srcScoutAmt:1,PageReport:1,Yrenfort:0,icon_chat:false,URLicon:"http://www.france-lol.fr/francelol.tools/images/ip_points.png",filAll0:'',filAll1:'',filPuissance:0,filPuissanceMax:1e6,wildType:1,citySrchFilter:0,fixPageNav:true,mistedOnly:false,hostileOnly:false,fixTower:true,enhanceARpts:true,allowAlterAR:true,enableCheckTournoi:false,HauteurBoite:700,pbWinIsOpen:false,boTrackOpen:true,ptWin2IsOpen:false,ptWinDrag:true,ptWinPos:{},ptWin2Pos:{},enableFoodWarn:false,enableFoodWarnTchat:false,EnableReduireUnit:true,foodWarnHours:12,chatEnhance:true,fixKnightSelect:true,attackCityPicker:true,mapCoordsTop:true,dispBattleRounds:false,reportDeleteButton:true,arPageFrom:1,arPageTo:2,rptType:"alliance",rptAuto:false,alertSound:{enabled:true,soundUrl:DEFAULT_ALERT_SOUND_URL,repeat:true,playLength:20,repeatDelay:.5,volume:100,alarmActive:false,expireTime:0},alertConfig:{aChat:true,raid:false,aPrefix:"**** Je suis attaque !!! **",scouting:true,wilds:true,defence:true,minTroops:1,minTroops2:2,embassy:false,empennage:true,marechal:true,defBoost:true,TroneRangeDebuff:true,TroneRange:true,TroneLife:true,TroneCombatSpeed:true,mytroops:false,food:false,defense:false,MonQG:false,hq:"",sendEmail:false,emailAddress:"",token:"",sendasWhisper:false,sendtoAlly:true,showAttack:false,},URLson1:"http://www.universal-soundbank.com/mp3/sounds/684.mp3",URLson2:"http://www.universal-soundbank.com/mp3/sounds/217.mp3",URLson4:"http://www.universal-soundbank.com/mp3/sounds/2376.mp3",AttackHorloge:"21:00:00",AttackGoHorloge:null,AttackOnOff:false,AttackUnits:{},AttackFav:{0:{0:"200K miliciens",1:0,2:2e5,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},1:{0:"200K dada",1:0,2:0,3:0,4:0,5:0,6:0,7:2e5,8:0,9:0,10:0,11:0,12:0,13:0}},AttackFromCity:0,AttackCibleX:0,AttackCibleY:0,AttackKnight:0,TournoiLigne:5,AttackFSUnits:{1:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},2:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},3:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},4:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},5:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},6:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},7:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},8:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},9:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},10:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0}},DeleteMsg:false,DeleteMsgs5:false,DeleteMsgs6:false,DeleteMsgs0:false,DeleteMsgs1:false,DeleteMsgs2:false,DeleteMsgs3:false,DeleteMsgs7:false,DeleteMsgs7X:0,DeleteMsgs7Y:0,DeleteTimerMinute:10,giftDomains:{valid:false,list:{}},giftDelete:"e",HelpRequest:true,ChatRules:false,DeleteRequest:true,ChatVIP:false,MapShowExtra:true,transportinterval:60,minwagons:1000,lasttransport:0,reassigninterval:60,lastreassign:0,RaidRunning:true,RaidReset:0,MsgInterval:1,foodreport:false,Foodstatus:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},
crestRunning:false,Crestinterval:10,CrestSlot:2,crestMarchError:0,CrestMsgInterval:24,Crest1Count:0,Crest2Count:0,crestreport:false,enhancedinbox : false,CrestLevel:0,CrestType:0,Creststatus:{1101:0,1102:0,1103:0,1104:0,1105:0,1106:0,1107:0,1108:0,1109:0,1110:0,1111:0,1112:0,1113:0,1114:0,1115:0,9:0,36:0,37:0,38:0,55:0,57:0,261:0,262:0,271:0,272:0,351:0,361:0,362:0,911:0,3000:0,3001:0,3002:0,3003:0,3007:0,3008:0,3009:0,3011:0,931:0,932:0},LastCrestReport:0,LastReport:0,spamconfig:{aspam:false,spamvert:"Nous recrutons, rejoignez-nous",spammins:"10",atime:2,spamstate:"a"}
,EffetRouge:[],BORac_Trp:true,BORac_Apo:false,BORac_App:true,BORac_Rea:true,BORac_Ts:true,BORac_Tra:true,BORac_Cra:true,BORac_Bui:false,BORac_Far:false,BORac_Dar:false,BORac_Salvage:false,BORac_Salvage2:true,BORac_Upg:true,AllEffet:true,salvageconfig:{running:false,CityCity:0,RepairCity:0,Repairrunning:false,},TroneInverse:true,pbGoldHappy:95,pbGoldEnable:false,enhanceViewMembers:false};
var Colors ={ChatLeaders:'#C8C8C8',ChatVC:'#81EE81',ChatChancy:'#F8A151',ChatAtt:'#FF7D7D',ChatEcl:'#FFDD7D',ChatGlo:'#F9AAAA',};
var AttackOptions={Running:false,LastReport:0,MsgEnabled:true,MsgInterval:60,Method:"distance",SendInterval:8,MaxDistance:50,RallyClip:0,BarbsFailedKnight:0,BarbsFailedRP:0,BarbsFailedTraffic:0,BarbsFailedVaria:0,BarbsFailedMarais:0,BarbsFailedBog:0,BarbsTried:0,DeleteMsg:true,DeleteMsgs0:false,Foodstatus:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},MsgLevel:{1:true,2:true,3:true,4:true,5:true,6:true,7:true,8:true,9:true,10:true},BarbsDone:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},BarbNumber:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},Levels:{1:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},2:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},3:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},4:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},5:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},6:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},7:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false},8:{0:false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,10:false}},Troops:{1:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},2:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},3:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},4:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},5:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},6:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},7:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},8:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},9:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},10:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0}},MinDistance:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0},Distance:{1:750,2:750,3:750,4:750,5:750,6:750,7:750,8:750,9:750,10:750},Update:{1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0]},UpdateEnabled:true,UpdateInterval:30,stopsearch:1,knightselector:0}
var TrainOptions={Running:false,list:{},Item:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},listactif:{},listlabour:{},timelauch:15,unitemin:{},unitemax:{},listboost:{},UnitMixValue:75,Workers:{1:25,2:25,3:25,4:25,5:25,6:25,7:25,8:25},Keep:{1:{Food:0,Wood:0,Stone:0,Ore:0},2:{Food:0,Wood:0,Stone:0,Ore:0},3:{Food:0,Wood:0,Stone:0,Ore:0},4:{Food:0,Wood:0,Stone:0,Ore:0},5:{Food:0,Wood:0,Stone:0,Ore:0},6:{Food:0,Wood:0,Stone:0,Ore:0},7:{Food:0,Wood:0,Stone:0,Ore:0},8:{Food:0,Wood:0,Stone:0,Ore:0}},Resource:{1:true,2:true,3:true,4:true,5:true,6:true,7:true,8:true},CraftingRunning:false,CraftIntervallMin:3,CraftingActif:{221:false,3e3:false,3001:false,3002:false,3003:false,3004:false,3005:false,3006:false,3007:false,3008:false,3009:false,3010:false,3011:false,},CraftingNb:{221:0,3e3:0,3001:0,3002:0,3003:0,3004:0,3005:0,3006:0,3007:0,3008:0,3009:0,3010:0,3011:0,},doTraps:{1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false},doCalrops:{1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false},doSpikes:{1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false},doXbows:{1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false},doTrebu:{1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false},troopType:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},keepFood:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},keepWood:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},keepStone:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},keepOre:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}}
var GlobalOptions={pbWatchdog:true,pbWideScreen:true,pbWideScreenStyle:"normal",autoPublishGamePopups:false,}
var upgradeData = {  active : false, Items: [],  retryInterval : 30, };
var ThroneOptions={Active:false,Use20005:false,Use20001:false,Use20002:false,nexttries:100,IntervalMin:3,RepairTime:0,Tries:0,minStones:980000,Good:0,Bad:0,Items:[],Salvage:{},SalvageQuality:0,SalvageAdvisor:true,SalvageBanner:true,SalvageChair:true,SalvageTable:true,SalvageWindow:true,SalvageTrophy:true,SalvageTriple:false,presetname:{1:'Defense',2:'',3:'',4:'',5:'',6:'',7:'',8:''},}
var ApothecaryOptions = {Active:false,goldkeep:0,city:{0:[],1:[],2:[],3:[],4:[],5:[],6:[],7:[]},};
var CrestOptions={Running:false,CrestCity:0,RoundOne:false,RoundTwo:true,lastRoundTwo:0,X:0,Y:0,R1ST:0,R1MM:0,R1Scout:0,R1Pike:0,R1Sword:0,R1Arch:0,R1LC:0,R1HC:0,R1SW:0,R1Ball:0,R1Ram:0,R1Cat:0,R2ST:0,R2MM:0,R2Scout:0,R2Pike:0,R2Sword:0,R2Arch:0,R2LC:0,R2HC:0,R2SW:0,R2Ball:0,R2Ram:0,R2Cat:0}
var CrestData = new Array();
function CrestFunc(a){if(a==undefined)a=CrestOptions;this.Running=true;this.active=a.active;this.CrestCity=a.CrestCity;this.RoundOne=a.RoundOne;this.RoundTwo=true;this.lastRoundTwo=0;this.X=a.X;this.Y=a.Y;this.R1ST=a.R1ST;this.R1MM=a.R1MM;this.R1Scout=a.R1Scout;this.R1Pike=a.R1Pike;this.R1Sword=a.R1Sword;this.R1Arch=a.R1Arch;this.R1LC=a.R1LC;this.R1HC=a.R1HC;this.R1SW=a.R1SW;this.R1Ball=a.R1Ball;this.R1Ram=a.R1Ram;this.R1Cat=a.R1Cat;this.R2ST=a.R2ST;this.R2MM=a.R2MM;this.R2Scout=a.R2Scout;this.R2Pike=a.R2Pike;this.R2Sword=a.R2Sword;this.R2Arch=a.R2Arch;this.R2LC=a.R2LC;this.R2HC=a.R2HC;this.R2SW=a.R2SW;this.R2Ball=a.R2Ball;this.R2Ram=a.R2Ram;this.R2Cat=a.R2Cat}
var FarmOptions={RallyClip:0,Running:false,MinMight:0,MaxMight:999999999,Interval:0,SendInterval:10,MaxDistance:20,Inactive:30,InactiveMax:999,DeleteReports:false,Troops:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},FarmNumber:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},CityEnable:{1:true,2:true,3:true,4:true,5:true,6:true,7:true,8:true},CityLevel:{0:true,1:true,2:true,3:true,4:true,5:true,6:true,7:true,8:true,9:true,10:true,11:true,12:true},Diplomacy:{friendly:true,hostile:true,friendlyToThem:true,friendlyToYou:true,neutral:true,unallied:true},FarmMarches:[],farmMarches:{},Attacks:0,Checks:0,};var salvageData={salvageActive:false,throneSaveNum:10,minQuality:3,ruleSet:[{"type":"any","faction":"any","conditions":[{"mustHave":"true","number":"2","effect":"Range","buffType":"e","slots":[true,true,true,true,true]}]},{"type":"any","faction":"any","conditions":[{"mustHave":"true","number":"2","effect":"Troop Training Speed","buffType":"e","slots":[true,true,true,true,true]}]},{"type":"banner","faction":"any","conditions":[{"mustHave":"true","number":"2","effect":"Siege Range","buffType":"e","slots":[true,true,true,true,true]}]}],numSalvagedItems:0,maxStones:1000000,anyCity:true,overflow: "order",};
readOptions();
/** SYSTEM MULTILANGUE **/
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('Oe Of={\'fr\':{8L:\'yy\',8M:\'rB\',8N:\'4H\',8O:\'Og\',8P:\'rC\',8Q:\'38\',8R:\'Oh\',8S:\'5p\',8T:\'1F\',8U:\'yz\',8V:\'Oi\',8W:\'Oj\',8X:\'yA\',8Y:\'R&c;2j&c;\',8Z:\'90\',91:\'2E\',92:\'Ol\',93:\'7t\',94:\'Om\',95:\'96\',97:"98",99:"2T",9a:"Oo me Op, Oq Z la Os kM",4I:{9b:"6a:7u/9c;9d,9e+Ot/Ov+Ow/P/Ox+Oy/Oz/OA/bh+4/OB+OC/OD/OE//OG%3D",9f:"3B://9g.9h.3C/9i/OH/",1M:"7v",or:"Ou",6b:"rD",9j:"kN",9k:"yB",6c:"n1 ",3E:"rE",9l:"OI",1S:"1S",9m:"yC",9n:"OJ yC",9o:"La 5q a d&c;rF&c;e 1T 11 n\\\'1U 7w rG&c;",9p:"OK OL a &c;t&c; d&c;rF&c;e :",9q:"6d OM&c;",9r:"OO OP 1S ",9s:"39 OQ : 5 yD, on OR",9t:"OS a rH n2 5q a yE !",1j:"9u",9v:"OT",9w:"OU",1m:"3F",2F:"7x",9x:"3a OV",9y:"3a OW",3b:"6d",2U:"OX",1n:"3a",9z:"rI rJ :",1k:"6e",9A:"yF",9B:"yG",2u:"rK",to:"yH",},9C:{9D:"OY n3 de OZ",9E:"n4 rL kO P0 d\\\'1V 2G 2k rM w P1",9F:"98",9G:\'P2 P3\',9H:"x yI - 2T",9I:"n5",9J:"P4 P5",9K:"n4 yJ yK de yL le P6 2k rM w P7...",9L:"9M w 6f",9N:"7y 2v:",9O:"3a 9P:",9Q:\'7z 7A:\',9R:"1G.",9S:"1N.",9T:"2H 3G:",9U:"9V :",9W:"1H(s) kP du rN",9X:"PR",9Y:"7z",9Z:"P8",a0:"yM",a1:"n1 1F",a2:"4J",a3:"7B",a4:"# 3G",a5:"P9: ",a6:"4K de rO&c;e",a7:"rP: ",a8:"Pa si le 2I 1U a9 yN kQ de:",aa:"yO",ab:"yO yP (v&c;Pb kR w 6 rD)",ac:"# V&c;Pc&c;",ae:"*n6*",af:"7v",ag:"kS&c;:",ah:"rQ...",},aj:{3H:"Ma 2I",3I:"a yK de Pd. n7 : ",3J:"5r :",},ak:{3c:"3c :",ao:"rR",ap:"kT",aq:"Pe",ar:"TS",av:"n8",aw:"4H:",at:"de",hq:"QG",1I:"rS :",ax:"rT",ay:"Pf",aA:"Pg 1S",aB:"a",aC:"Ph",aD:"JE Pi",aE:"7C n9",aF:"rU n9",6g:"Pj",1s:"6h",2w:"5s",5t:"Pk",aG:"6d n7 :",aH:"yQ",},3G:{j:"Pl Pm DE 6h",6i:"yR",25:"rB",aI:"yS",aJ:"yS + Pn",aK:"7z la kQ Po",aL:"rI 3G",aM:"rI yT",7D:"(en 7D)",aN:"na&c;es Pp : ",aO:"yU",aP:"7x yU",aQ:"6e",aR:"Pq 1V 3K",aS:"yV Ps&c;e : ",26:"7E de nb un yW 2k Pt n2 Pu !",aT:"Pv kT Pw",3L:"yX",kU:"kT yY",aU:"D&c;Px 1o !",aV:"Py yZ de l\'z0.",6j:"z1&c;e",aW:"<1b 2V=2l aX=\'aY\'><b>7v, kM de nf !<b></1b>",aZ:"yT b0&c;",kV:"3G b0&c;e",b1:"z2 b0&c;",b2:"rV",},7F:{j:"Pz 27 PA",b3:"PB : ",b4:"<b><1c>PC PD !<br><br>PE 22 z3 rW d&c;ja &c;t&c; b0&c;s.</1c></b>",b5:"<1c>yz b0&c;s</1c>",b6:"3F z4 b7 !",},b8:{j:"kW PF rX PG UN z5",k:"kW rY LE z5 EN rZ",3M:"D&c;PH",4l:"PI",kX:"n7",2W:"s0 en 28",b9:"7G s1 s2.",1M:"7v de PJ",},6k:{j:"PK 3N rZ PL",ba:"rK de l\\\'2G",bb:"s3 z6",1B:"PM&c;.",bc:"R&c;z7&c;z8 en 28 de la s4 Q bd...",bf:"R&c;z7&c;z8 en 28 de la s4 Q PN...",bg:"V&c;PO...",k:"z9 27 PP",1W:"6l&c;",1m:"3F z4 de 6l&c;!",6m:"za &17; PQ : ",bi:"S&c;zb w bd :",bj:"PS w 6n",26:"zc de s&c;PT&c; !",bk:"s5 en 28 Z",2u:"bd :",1X:"kY la PU",2w:" PV 2m : ",bl:"PW Q 6n bm&c;e.",bn:"s5 en 28... ",},38:{j:"kZ - 3d",bo:"zd Z le 1l 1F",bp:"zd Z le 1l l0",bq:"ze 5u bs w ",bt:"PX ng :",},bu:{j:"PY PZ - Q0 DE LA Q1",bv:"Q2",bw:"Q3 7v",bx:"nh zf",bz:"2E 29",bA:"Q4 x",bB:"x zg",bC:"zh",bD:"96",bE:"Q5",bF:"x s0",},4m:{j:"ni 27 l1",bG:"G&c;n&c;Q6",bH:"Q7&c;l&7H;re",bI:"bJ",bK:"za",bL:"Q8",bM:"Q9",1t:"Qa",2a:"zi&c;",bN:"4n&c;Qb",bO:"5s Qc yY L\'ni :",},2n:{1u:"3N Qd Qe",k:"nj 27 6h",1d:"Qf 27 Qg",2b:"Qh - Qi 27 6h & s6 27 zj",2c:"s7",bP:"zk&c; de 6o a l\'bQ",bR:"zk&c; de s8 a l\'bQ",bS:"2J de zl",3O:"7A Q zl",bT:"Qj Qk",bU:"n8 bJ",bV:"2d Ql",bW:"2d Qm",bX:"2d Qn",bY:"2J de Qo",bZ:"Qp zm",c0:"nk 27 Qq",c1:"s9 Qr rX 3N zn",c2:"Qs Qt en 4m",c3:"La 7y yN",c4:"zo",c5:"1U de",},1F:{j:"kW rY Qv l2",1u:"3e Q bd de l\\\'2G",c6:"zp 3f :",c7:"3e",c8:"sa. nl",c9:"Qw&c;e",ca:"Qx&c; rK",},4H:{j:"zq DU l3 - l4 ni",cb:"3P sb w cc",cd:"3P 1T w zr sc&c;s",cf:"sd(s) en nm :",cg:"Qy w sf de la 2I ",k:"zs EN Qz QA",1d:"zt QB",2b:"l4 ni",ch:"QC le QD",2K:"R&c;zv",2e:"R&c;sg en 28",2f:"A",4L:"R",3Q:"3a",1Y:"5v",ci:"D&c;s&c;QE",cj:"4M l5",cl:"sh(s) QF",cm:"sc&c;(s)",},cn:{j:"sj 27 QH - zw 27 QI",co:"QJ 11",cp:"QK 3G",6p:"QL&c;e",},4N:{1t:"sk",2a:"6q",cq:"Fl&7H;l6 de 5w n\\\'1U 7w pr&c;QM Z l7 2I !",cs:"Fl&7H;l6 de 5w",ct:"QN&c;e le",2j:"s7",3R:"cu.",3S:"s2.",cv:"5r de l8 a l\\\'bQ",cw:"5r de QO a l\\\'bQ",cx:"5r de zx a l\\\'bQ",cy:"5r de QP a l\\\'bQ",cz:"sl.",3T:"4o",cA:"cu",ts:"TS",3g:"zy",cB:"QQ s1 / sm de nn",cC:"7G 1N",cD:"7G sn.",cE:"QR",cF:"n5",cG:"l5",},cH:{cI:"QS",cJ:"zz",3h:"3c :",to:"&#sp;",us:"QT",7I:"6r sq",4l:"QU!",2j:"zA:",cK:"zB:",cL:"QV:",cM:"TS",cN:"FS",cO:"sr",cP:"l9 du 6s 3K",cQ:"l9 du 6s ",6t:"QW 6t",cR:"QX 6t",4p:"2J",cS:"QY&c;QZ de R0 :",cT:"7C R1 Q sq R2&c;s",W:"3F ss d\\\'3K 6l&c;",1u:"R&c;2j&c; Q 9P d\\\'3K(s)",cU:"zC 6l&c;",4O:"zf",2g:"3F R3 6l&c;",cV:"3a w 9P R4",cW:"R&c;2j&c; Q 9P",cX:"3F r&c;st",cY:"&lt;lb zD&gt;",cZ:"R5 :",2X:"kS&c; :",d0:"R6",d1:"sv R7 de :",},d2:{d3:"4o",PR:"PR",d4:"TS",7J:"R8",d5:"7C R9 en 28...",19:"2d",3g:"zy",2c:"zA",d6:"Ma 2I",d7:"7z 2d",d8:"6u 2d ",d9:"FS 2d",db:"7z/6u 2d",1u:"3e Q 2o b0&c;es en sw",k:"3e Q 2o en zE 1S Ra Rb",dc:"Rc 2o en zE Rd.",dd:"Rf",df:"Rg&c;es",dg:"sx&c; 3f",dh:"zF",dj:"l8 / h",dk:"1O zG 6v",dl:"dm : n4 rL np 11 2k rM w Rh sw Ri dn.",1W:"kS&c :",5x:"4M 6l&c;",},2L:{dp:"rQ d&c;Rj ...",dq:"D&c;Rk:",4q:"4r",14:"et",dr:"rQ 1S le zH d\'zI ...",ds:"<B>Rl d\'zI :</b> 4K 6l&c; ! (Rm la zJ ?)",dt:"3F",1c:"Rn",1B:"Ro Rp !",1M:"39 :",1X:"kY la nq",W:"X 6w &4P;dv 4r 0 et 3U",13:"Y 6w &4P;dv 4r 0 et 3U",1v:"La 2x zK 6w &4P;dv lc&c;ld &17; 0",1w:"La 2x Rq 6w &4P;dv lc&c;ld &17; 1",3V:"La 2x 2v 6w &4P;dv lc&c;ld &17; la 2x zK",3W:"La 2x 2v ne zL d&c;Rr dw ! au Rs de p&4P;zM n2 Rt",dx:"9M/Ru w 1J (Rv d\\\'sy le zN &c;zO)",dy:"7A 1G. :",dz:"7A 1N. :",dA:"3c TS ",dB:"Rw ",dC:"zp 3f ",dD:"Rx w TS",dE:"nr zQ",dF:"lf",dG:"zR 6x",dH:"lb 2G 6x",5y:"lg ",dI:"Ry w 6f",dJ:"lf 6x",dK:"Rz la zJ 6x",dL:"RA 6x",dM:"z6 6x",dN:"zR 6x",dO:"lb 2G 6x",2x:"4J",19:"2d",6y:"zS 2n",dP:"RB",dQ:"RC",dR:"<dS dT=#dU>dm : Le zH RD zQ dV Q",dW:"RF RG\\\'a ce 1T la nq RH bm&c;e.</1b>",2Y:"nr...",dX:"RI le r&c;st",dY:"rB",dZ:"3e z2",5x:"4M 6l&c;",1W:"kS&c :",e0:"2J de zT ",1j:"sx&c; !",e1:\'RJ\',e2:"RK&c;!",e3:"RL Z ",e4:"En 4Q du sz de nn...",e5:"39 : 7C RM RN",e6:"39 : lg RO",e7:"2T de RP 5z",},e8:{j:"kT 7K rY 3N lh ns",25:"96",3i:"FO",e9:"RQ Q 2o",1J:"2T",k:"nj 27 lh ns",1d:"6z rX 3N lh ns",ea:"2d",4R:"4R",eb:"4K de rO&c;e",ed:"RR 27 6h",ee:"6z lh ns - RS",ef:"\'RT 3N lh",eg:"RU",eh:"RV &17; z&c;ro Q RW :",ei:"2H d&RX;3K :",ej:"7y 2v de nq :",ek:"9V",em:"sz(s) de nn(s) sA(s)",eo:"RY w zU bs w",ep:"RZ la 2I S0&c;s",eq:"S1",eu:"sB :",ev:"S2 en nt",ew:"zV &c;S3&c;s en nt",ex:"zV S4 en nt",ey:"zW&c; du zX :",ez:"sm de zY S5",eA:"sm de zY S6",eB:"S7 S8 de la 2I :",26:"4K sC de 2Z PR b7",3L:"4K de zX b7",2X:"kS&c; :",1B:"S9 Sa L\\\'Sb",},7L:{j:"15 TS - s9 / Sc",3i:"TS",eC:"90",3E:"rE n6",1I:"9M w Sd",3X:"2H d\\\'3K :",eD:"9u un ss kR w",1x:"9V",eE:"sz(s) de nn(s) sA(s)",1k:"6e 1V zT",eF:"rE Z l\\\'3K Q zZ A0 - zg",eG:"<BR>L\\\'sD s9 1U Sf 2k Sg Sh et 5u 1V sE A1.<BR>        Sj 3K en 2 Sk, Sl la A2 si n&c;Sm et Sn.<BR>        V&c;So 1T dn yJ 1 Sp de sA 1S n2 Sq 2k 1V A2 A1 &17; Sr.<BR>        Ss w A3 d\\\'1V sE Sv et w 2o et Sw Z ON !.<BR><BR>        2J de 2o (11 eH):<BR>        <A 1I=eI eJ=3B://eK.eL.3C/eM/eN>zS d\\\'A4 Z eO li</a>        <eP eQ=100%><TR><TD>2p</td><TD>2M 1</td><TD>2M 2</td><TD>sv</td><TD>rT. 1G</td></tr>        <TR><TD>1</td><TD>n/a</td><TD>160 MM</td><TD>12 MM</td><TD>0</td></tr>        <TR><TD>1</td><TD>n/a</td><TD>80 4S</td><TD>7C</td><TD>1+</td></tr>        <TR><TD>2</td><TD>5 MM</td><TD>130 4S</td><TD>5A 2M</td><TD>2+</td></tr>        <TR><TD>3</td><TD>10 MM</td><TD>eR 4S</td><TD>5A 2M</td><TD>3+</td></tr>        <TR><TD>4</td><TD>20 MM</td><TD>eS 4S</td><TD>5A 2M</td><TD>4+</td></tr>        <TR><TD>5</td><TD>50 MM</td><TD>eT 4S</td><TD>5A 2M</td><TD>6+</td></tr>        <TR><TD>6</td><TD>100 MM</td><TD>eU 4S</td><TD>5A 2M</td><TD>7+</td></tr>        <TR><TD>7</td><TD>150 MM</td><TD>eV 4S</td><TD>5A 2M</td><TD>8+</td></tr>        <TR><TD>8</td><TD>eW MM + 3Y</td><TD>eX 4S + 3Z 40</td><TD>5A 2M + 1 2y</td><TD>9+</td></tr>        <TR><TD>9</td><TD>eY MM + 3Y</td><TD>eZ 4S + 3Z 40</td><TD>5A 2M + 2 2y</td><TD>10</td></tr>        <TR><TD>10</td><TD>f0 MM + lj</td><TD>f1 4S + f2 4n</td><TD>5A 2M + 6 2y + 50 4n</td><TD>10</td></tr></f3><br><br>",f4:"4K de A3 !",f5:"rS(s) d\\\'3K de zZ A0 :",f6:"Sx",sF:"Sy",1K:"2M",3H:"1f 2h:",3I:"1f f7",3J:"A5 :",f8:"2m 1f f9:",fa:"4s of 1st 3j 1j:",fb:"4s of lk 3j 1j:",fc:"sG 90",nu:"98",},3k:{fd:"nv",fe:"A6",29:"n3",ff:"Sz",fg:"ll",fh:"SA le QG Z bs w A7",fi:"SB 7K - 3d",fj:"SC SD zn",fk:"7K",fl:"2H 5z ",fm:"Ce sH se SF SG SH a sI A8 de la 5q ! il 1U A9 3f le sH le kQ SI 4r le QG et w 6f Aa + 10 kN.",fn:"7z de SJ ",fo:"sJ &17; lm",fp:"5B 7K - 3d",fq:"n6 n&c;SK :",fs:"6z DU 5B",ft:"9M w Ac",fu:"l5 ",fv:"Ad UN 5B",fw:"9u w Ae bs w",fx:"9u w Ae nw un Af de",fy:"nx ",1x:"9V",fz:"SL",fA:"6e 1V ln",fB:"2E ll",fC:"6r A7 du 2E n3 :",41:"SM&c;",42:"D&SN;SO&c;",fD:"Ag SQ 27 SR",fE:"Ou Q SS&c;es",fF:"(la sK&c de Ah 1U le Ai Q 6A&c;s ST)",fG:"nx Q 6n 3k&c;es : ",W:"La sK&c; ne zL SU&c;18",fH:"4K d\'2G !",13:"7E de SV un 3h de Ah !",1v:\'1o Z w m&4P;SW 6f !\',1w:"1o de SX Z la Aj 0,0 !",fI:"2E SY&c;.",fJ:"7v, kM de nf !",fK:"Ak 1S 2 yB !",},7M:{fL:"SZ",j:\'Ao 7K - 3d\',fM:"Ad Ap T0",fN:"9M w Ac",6B:"T1 la 2I :",to:"yH la 2I :",fO:"D&Aq 4r sI r&c;Ar :",fP:"T2 w T3 de 2o",fQ:"6e 1V T4",fR:"3N T5 T6",k:"Ao 27 6h T7",W:"1o de As kQ de",13:"6A&c;es a la T8.",fS:"7E de Au...",1Z:"R&c;T9 bm&c;e - 6d :",fT:"",},fU:{2i:"s0",j:"Ta 7K DE 6h - Tb",7N:"lp",1J:"2T Av :",3X:"2H de 6o :",fV:"(Tc et np 2k Td en Te)",fW:"Tf de la ny (2w) 3f d&c;sL 2k Tg la Aw -na&c; fX-",fY:"7x Th",k:"<u><b>x-Ax :</b></u> 4T en 5z d\'1V d&c;lq 2k Ay un sM de 5.",fZ:"nz 5z Q g0 en 28 :",g1:"3a la 6o en 28",W:"39 : 1o d\'lr w g0...<br>AA le 7O et nf.",g2:"x-Ti",},g3:{j:"15-nA D\\\'Ap l2",g4:"rP",g5:"n4 rL kO Tj d\\\'1V 2G 2k kO Tk l7 sD.",2i:"7t",3M:"yR w 7P",g6:"4K Tl",43:"AB : Le r&c;st se Tm Z le Tn, Tp w rO&c;es rW AC de Tq !<br>AB : L\'AD 1U Tr&c; Z 1 6i kR w 24 rD 3f lg !<br><b>AE DE NE AF Ts DE Tt Tu !</b>",g7:"2J Tv ",g8:"2H ",g9:"Tw un yW d\\\'2G ",ga:"Tx 1F",},7Q:{7R:"n1 Ty (zB) :",2n:"AG Tz&c;AH",1k:"cr&c;TA :",7S:"Ou 1V 2I :",},6C:{j:"TB Q 2o et TC Q d&c;nB Z w TE",gb:"# 3f 1H de ",3T:"6r d&c;nB &6D;",1s:"6r 2o &6D;",W:"2J de 2o 3f 1H sN (6w TF > 0)",13:"2J sN de 2Z.",1v:"1o de TG TH ! (le 2v 1U de ",1w:"sO d\\\'4Q d&c;nB bm&c;e.",gc:"yV de TI ",3V:"nz Q g0 r&c;TJ",3W:"39 : 1o d\'lr w g0...<br>AA le 7O et nf.",gd:"A TK de TL 1H TN-dn lr ? (1=6o en 28 a",gf:"nz Q 6o en 28... AE DE TP !",gg:"39 : 1o d\'lr la 6o...",gh:"sO d\\\'4Q Q 2o bm&c;e.",19:"7A",gi:"D&c;lq Q TQ",gj:"D&c;lq Q AI",},nC:{1Z:"AJ&c;e.",gk:"TT",2q:\'4T de \',gl:"AK TU",},2q:{2i:"sP",gm:"x 4T",j:"15-s6 - 3d",4U:"lp 4T",k:"s6 EN rZ",ec:"Ec:",gn:"En 28 de s8",W:"7v sQ la AM !",13:"4K sC de 6n !!",1v:"sR nD in 6E!",1w:"La s8 Q TV 10 ou + TW se kO TX.",go:"TY 5z 1S 10 ls...",gp:"TZ 3f sH",2z:"sO d\\\'4Q de",},gq:{j:"l4 27 U0 ",gr:"U1 de",sS:"U2&c;U3(s)",1Z:"AJ&c;e.",},gs:{j:"15-gu - 3d",44:"nj",k:"6z - U4 3N U5 A U6",1t:"zC &17; cr&c;er",2c:"s7",43:"<i><u>sT :</u> AO un AP de 5 nE sU</u></i> - <i>(*) Il sL np le 7O 2k nb le 4m &17; rH.</i>",},2T:{gv:"U7 Z la",45:"6F de la sV",7T:"7T",gw:"(La U8 du 7O AQ U9&c;e &c;AR)",gx:"D&c;Ua de la AS&4P;dv",6G:"Ub Q AS&4P;Uc",gy:"AU 11 bs w",gz:"R&c;Ud l\\\'l9 Q 6n 1S r&c;2j&c;",gA:"4t le zN &c;zO",gB:"AV le 1g Z la Ue",7U:"7U de la 5q :",gC:"Uf la 4V Ug",gD:"AG Uh&c;AH Z la 4V.",gE:"Ui l\\\'z0 du 7O en lu",gF:"AU si 11 n\\\'1U 7w rG&c; sQ 1 AW",gG:"Uj 5u Z nF (7x Uk)",gH:"4t l\\\'sD Ul",gI:"4t le Um -",gJ:"Un de la 5q :",gK:"6F du r&c;2j&c; :",gL:"3P w 2o",gM:"3P w d&Uo",gN:"3P le 4m de 6n",gO:"3P w A4 Z la ny",gP:"3P la sW de 6n",3R:"Up w 2o et 6n Uq",3S:"lv w 2o en 28 de 6o",gQ:"3P \\\'Ur\\\' en nm si la sW de l8 1U en n&c;Ut et Uu&c;Uv &17; ",gR:"3P w Uw",gS:"6F du 1g :",gT:"4t le nG 5z Z AX 2G en sX d\\\'Ux en nm",gU:"Uy 5u 2k w Uz/zU Q AY bd",gV:"3a w UA Av (UB) du 1g 1F",gW:"3a w r&7H;B0 du 1g",gX:"4t w am&c;UC du 1g (5y UD, B1 B2, UE Z nH 2k UF)",gY:"lw Z le B3",gZ:"lw Z 1V sY rR",h0:"lw Z 1V sY kT",h1:"lv Q B4",h2:"lv w B1 Z w B5",h3:"B6 Z le 1g :",h4:"B6 de UG du 1g B7 :",h5:"UH h6 nH Z le 1g",h7:"<br>>> UI 7u UJ : h8 3f h8 - <i>UK : sZ 1T 3f dn</i>",h9:"6F Q sG de 5C :",hb:"Am&c;t0 w 9P de l\\\'2G",hc:"Am&c;t0 la UL Q bd de l\\\'2G",hd:"3a 5u w 9P :",he:"2H de nq :",hf:"6F B2 :",hg:"Ma 2I B8 ( QG ) :",hh:"S&c;zb 5u l7 2I &17; l\\\'A8 du 7O",hj:"s5 5z de l\\\'or UM le UO 1U lc&c;ld &17;",hk:"4t la s&c;UQ UR Q 6f 1S la 5q d\\\'3K (US, As et 3k)",hl:"Am&c;t0 la UT Q t1 (AI CC)",hm:"6F de nI :",hn:"4t la nI",hp:"4t la UU d\\\'un h6 Z 1V 3K/UV t2",hr:"UW du UX B9",hs:"UY h6 :",ht:"UZ",hu:"t3 :",hv:"kY",hw:"V0 sQ",hx:"R&c;V1",hy:"ze 1V sY :",hz:"Ba V2 :",hA:"Z AX 2G et/ou",hB:"en B3 &17; V3 m&4P;me",hC:"V4 V5 Z ",hD:"lx de 2o : <br><i>(V6 Z le 1g)",hE:"lv si d&c;V7 ou 7w : ",hF:"3P Bb V8 :",hG:"3P le Bc de Bb V9&c;Va (lb Bd) :",hH:"lv :",hI:"3P ma Vb de l8 :",hJ:"D&c;t4 l\\\'l9 du QG (2I B8) :",hK:"kY  Z 3K t2 :",hL:"9u un Vc :",hM:"rU Bd D&c;lq",hN:"s3 2o",hO:"n6 1S n9",hP:"Be Vd 6r 1J",hQ:"s3 d&c;nB",hR:"Be Ve",hS:"4t la Bf Q t1 de z3",hT:"7E Vf Vg Q Bg : Bh, Bi et hU hV<br>7E &c;AR &17; bs w Vi Vj rW Vk&c;s Vl nJ.<br>7E &17; kR l\\\'Bj de la 5q : hW,7V,hX,hY,hZ",i0:"sw Vm",i1:"zo dn",i2:"de dn",i3:"6F 4H",i4:"9u un Bk en sX de Vn Z Vo (4H)",i5:"D&c;t4 l\\\'ly en sX d\\\'&c;Vp (Vq nm)",i6:"D&c;t4 le h6 Q t5 i7",i8:"Vr le QG : ",i9:"Z 6f Aa",ia:"4t le 4W",ib:"3G t2 Z Bl 5y",ic:"6F Q Vs",id:"4t/Vt l\\\'l9 Q Vu 29 (F5 Vv Vw Vx)",},3l:{46:"yA",47:"x Bm",6H:"9M le d&c;Vy",1J:"6z",7W:"Or &17; lm :",1k:\'6e\',44:\'6h EN t6 DE Vz\',7X:\'3e Q VA VB\',2U:\'3l 2U\',1n:\'3l 1n\',},3m:{45:"3d",1X:"7x kY",6s:"7x VC",1n:"7x 3a",ie:"VD un ss Z le Bn kR w",ih:"VF 3m",1m:"3F 7Y Z l7 2I",7Z:"VG VH",ii:"VI",ij:"7C VJ Z l7 2I",},ik:{6I:"Bo:",},io:{46:"zh",4X:"sd",ip:"Bp",6J:"6J",1p:"1p/21",2h:"yy",6K:"Bq&c;",19:"7A",5v:"5v",iq:"VK",ir:{j:"15-81 : Br 3N l1 DU l3",iu:"7z 2k nb w sf :",iv:"VL lm : ",iw:" et kQ.",ix:"9V w nt",iy:"AV w sf Z w AY 6f 5u",iz:"D&c;yL w r&7H;B0 :",3n:"VM",iA:"nK 3h:",iB:"6e Bs",iC:"6e 1V VN",iD:"7E de Au...",iE:"nL VO sb w 16 nw Bl VQ",3O:"t7",5D:"6r sq",2Z:"VR :",iF:"6w sy",iG:"ne 6w 7w sy",14:"et",iH:"en 4X(s) :",iI:"3a Bs",41:"nh Q 16 en 28...",42:"VS 16 &17; nM. En 4Q du 6L nN.",iJ:"82 83 6M (nO) 84 of lz",iK:"nh en 28 ",iL:"1o de nM l\\\'1C",iO:"nh bm&c;e. En 4Q du 6L nN.",iP:"sB VT :",iQ:"VU Q 6f",iR:"VV w iS VW",iT:"VX d\\\'VY : ",},iU:{j:"15-81 : Br 3N l1 DU l3",iV:"z9 27 VZ A t8",iW:"t8 3N 4Y Bt 1V Bv",iX:"ou lc&c;ld",iY:"t8 3N 4Y Bt",iZ:"W0&c;(s)",j0:"3c d\\\'16 a W1 :",j1:"9V w 16 nw w 3 lA cc W2",j2:\'au iS, 1 Q 3 lA cc\',j3:\'au iS, 1 Q 2 lA cc\',j4:\'au iS, le Bw 4X\',j5:\'au iS, w 2 lA cc\',j6:\'au iS, w 3 lA cc\',j7:"<u>Ne W3 7w nM :</u> 6r 16 W4, W5 et nw un Bc Bx &17; 0",1t:"sd &17; lm",2a:"By",48:"3e Q 16 Bz&c;s 5u - (By d\\\'4X 4r W6)",49:"6d",4a:"6q",j8:"W7 27 4Y W8 W9 Wa Wb",2N:"Wc",j9:"3F 1C AQ Bz&c;.",jb:"zc a nM - on Wd ",jc:"We de la Bf de",jd:"BA t9 :(",},2f:{j:"15 6N/6O/nP",k:"Wf LA BB D\\\'t6",16:"3e Q 16 : ",1d:"Wg ET kW",2b:"BB D\\\'t6",2g:"3F 1C 1S la ta d\'4Q !",6P:"En 4Q...",jf:"Wh : ",jg:"Ak de",jh:"lB nQ: ",85:"lC nQ: ",ji:"x 1p/21/3o 1U Wi&c;.",1m:"3F 1C 1S la ta d\'4Q !",jj:"Wj de l\'1C nN...",jk:"1o d\'Wk un 2f Bx a 10 !",jl:"1o de kO 1V Bv au Wl de Wm (5) !",48:"3e Q 16 -1p/21- r&c;Wn",49:"6d",jm:"n1",4a:"6q",jn:"tb.",jo:"lB 4Z.",jp:"lC 4Z.",jq:"4K sC de zx 2k",jr:"6O BC ",js:"6N BC ",jt:"BA",2e:"R&c;sg : ",ju:"6d n7 : ",jv:"En 28",jw:"Wo",jx:"2J de yD :",jy:"<i>(Wp Wq Wr &17; l\\\'1C nN)</i>",4u:"En Bw",},1Y:{j:"zt 27 l1 DU l3",1Y:"BD",jz:"De-5v",4W:"Pr&c;-BE :",2g:"3F ",jA:"sh b7 :(",jB:"sh Bj !!!",jC:"Pr&c;-BE &Ws&c; :",jD:"x-86",k:"BF DU nR",},jE:{j:"zq DU l3 - nj",47:"Wt :",},2K:{W:"1o ! kM de BG l\'29 2K.",13:"1o ! kM de BG l\'29 2f/4L.",2e:"R&c;sg en 4Q...",j:"Wu 7K Wv",k:"<i>R&c;zv 5u sb w zr sc&c;s.</i>",1d:"<i><1b 2V=2l>NE AF Ww Wx 15 6N / 6O</1b></i>",jF:"3o x On",jG:"3o x nS",},},},\'en\':{8L:\'2h\',8M:\'30\',8N:\'51\',8O:\'tc\',8P:\'rC\',8Q:\'38\',8R:\'tf\',8S:\'5p\',8T:\'1F\',8U:\'tg\',8V:\'th\',8W:\'Wy\',8X:\'3l\',8Y:\'4N\',8Z:\'nT\',91:\'2E\',92:\'BH\',93:\'7t\',94:\'Wz\',95:\'nU\',97:"98",99:"2T",9a:"WA 2O, nV on WB",4I:{9b:"6a:7u/9c;9d,9e+nW/nX/zP/nY/nZ/o0/K+J/o1/o2/o3/o4/o5+o6/o7+Vh+o8/o9/oa/ob/oc+od/oe+og+oh+oi/oj+ol+om+oo/op/oq/os+ot+ov/ow/ox+/oy+oz+/oA+/oB/oC/oD%3D%3D",9f:"3B://9g.9h.3C/9i/oE/",1M:"3p",or:"Or",6b:"6b",9j:"kN",9k:"WC",6c:"5E ",3E:"oF",9l:"WD",1S:"in",9m:"4b",9n:"BI 4b",9o:"sV a BJ WE tj is 52 tk",9p:"An 3p WF:",9q:"WG 3b",9r:"WH 87 in ",9s:"WI 53: 5 BK, we 1X",9t:"WJ lD 5q a yE !",1j:"54",9v:"BL",9w:"WK",1m:"oG",2F:"82",9x:"4c tg",9y:"x 4c oH",3b:"6Q",2U:"WL",1n:"4c",9z:"6Q WM :",1k:"5F",9A:"yF",9B:"yG",2u:"7P",to:"to",},9C:{9D:"oI 6R WN",9E:"tl 5G be in an 2G to WO WP WQ",9F:"WR",9G:\'6R WS\',9H:"x yI - 2T",9I:"n5",9J:"2L 87",9K:"tl 6S to tm q 2L to tn q tp...",9L:"1O tp",9N:"2L 7y:",9O:"4c oJ:",9Q:\'4d 2p:\',9R:"1G.",9S:"1N.",9T:"2H:",9U:"88:",9W:"oK 1H(s) 2Y",9X:"PR",9Y:"4d",9Z:"BM",a0:"BN",a1:"1F 5E",a2:"4J",a3:"7B",a4:"# BO",a5:"tp: ",a6:"No BP",a7:"BN: ",a8:"6R if a9 2r 6y WT:",aa:"BQ",ab:"1N BQ (WU 89 6 6b)",ac:"# tq",ae:"*6R 6v*",af:"3p",ag:"6T:",ah:"WV at",},aj:{3H:"My 31",3I:"is WW on 5t. tt: ",3J:"BS:",},ak:{3c:"3c:",ao:"nA",ap:"tv",aq:"WX",ar:"WY",av:"WZ",aw:"51:",at:"at",hq:"HQ",1I:"BT:",ax:"X0.",ay:"X1 jH",aA:"X2 in",aB:"at",aC:"X3",aD:"yQ",aE:"No 6g",aF:"My 6g",6g:"X4",1s:"jH",2w:"5s",5t:"X5",aG:"BV:",aH:"X6 BW",},3G:{j:"X7 X8 6v",6i:"lE",25:"30",aI:"tw",aJ:"tw + lF",aK:"X9 31",aL:"6Q 30",aM:"BX 6Q",7D:"(BY)",aN:"Xa BO: ",aO:"C0",aP:"C0 2F",aQ:"5F",aR:"Xb an 25",aS:"Xc 3b: ",26:"C1 3q to 6U a 6c to Xd lD Xe!",aT:"Xf...",3L:"yX",kU:"30 in",aU:"cu 52 Xg.!",aV:"85 3b yZ.",6j:"6j",aW:"<1b 2V=2l aX=\'aY\'><b>3p, Xh 87 !<b></1b>",aZ:"BX in C2 tx!",kV:"30 on C2 tx!e",b1:"Xi 6M on oL tx!",b2:"rV",},7F:{j:"Xj Xk TO l2",b3:"7F: ",b4:"<b><1c>Xl Xm Xn!<br><br>22 Xo Xp nD ty .</1c></b>",b5:"<1c>tg ty</1c>",b6:"No 2u C3 !",},b8:{j:"tc C4",k:"tc tz",3M:"oM",4l:"oN",kX:"tt",2W:"In 2W",b9:"Xq.",1M:"oO 1M",},6k:{j:"Xr Xs Xt",ba:"1F 7P",bb:"My Xu",1B:"BI",bc:"C5 C6 lG...",bf:"C5 Xv lG...",bg:"C7...",k:"C6 lG",1W:"6T",1m:"No 7P 6T!",6m:"6k to 6m ",bi:"oP 2u :",bj:"C8 jI",26:"oG Xw !",bk:"C9...",2u:"2u :",1X:"lH 6m",2w:" 2m Xx : ",bl:"Xy Xz Ca",bn:"C9... ",},38:{j:"kZ - 3d",bo:"54 to 1F 1l",bp:"54 to l0 1l",bq:"XA nG 89 ",bt:"tA ng :",},bu:{j:"XB-UP XC- XD 2O",bv:"XE",bw:"Cb",bx:"4c oH",bz:"XF",bA:"XG",bB:"nT",bC:"tB",bD:"nU",bE:"A6",bF:"BH",},4m:{j:"oQ OF l1",bG:"4I",bH:"XH up",bI:"bJ",bK:"6k",bL:"XI",bM:"rC",1t:"1f",2a:"XJ",bN:"XK",bO:"5s XL OF 55 oQ :",},2n:{1u:"XM XN",k:"XO Cc",1d:"XP OF XQ",2b:"XR - Cd OF 55 jH & XS OF 55 zj",2c:"2m",bP:"oR XT at q 3b",bR:" XU XV AT 55 XW ",bS:"Cf 4p ",3O:"Cf 19",bT:"XX XY",bU:"n8 bJ",bV:"XZ 19",bW:"Y0 19",bX:" Y1 19",bY:"jJ of Y2",bZ:"zm Y3",c0:"Cg Y4",c1:"Ch Y5 tC Ci",c2:"tA Y6 in lD Cj",c3:"lI 7y 6B",c4:"To ",c5:"is ",},1F:{j:"kW ON Ck l2",1u:"jK of q 2u of q 2G",c6:"Cl by:",c7:"jK",c8:"Y7 nl",c9:"Y8",ca:"Y9 7P",},4H:{j:"56 tD - oQ",cb:"1O 2F jL",cd:"Ya 16 tE 4v",cf:"oS(s) in 2l:",cg:"Yb q oT on ",k:"Cm",1d:"Yc 1f",2b:"oQ",ch:"Yd oU",2K:"3o",2e:"Ye...",2f:"U",4L:"E",3Q:"t9",1Y:"Cn",ci:"Yf",cj:"52 C3",cl:"1C(s) Yg",cm:"tE",},cn:{j:"Yh sj - tv zw",co:"Yi 11",cp:"Yj 30",6p:"6p",},4N:{1t:"tf",2a:"6q",cq:"no Co Cp in 31!",cs:"5w Cq - oV",ct:"Yk Yl",2j:"2m",3R:"cu.",3S:"6C.",cv:"oW lF 5r",cw:"oW Ym 5r",cx:"oW Yn 5r",cy:"oW Yo 5r",cz:"BV",3T:"4o",cA:"cu",ts:"5H",3g:"Cr",cB:"tF / 5I",cC:"7G 1N",cD:"7G sn.",cE:"Yp",cF:"lJ",cG:"Cs",},cH:{cI:"Yq",cJ:"zz",3h:"3c :",to:"to",us:"Us",7I:"Yr",4l:"tm!",2j:"5s:",cK:"2L 2r:",cL:"Ys:",cM:"5H",cN:"DF",cO:"Ct",cP:"1O 25 lK",cQ:"1O DF lK",6t:"tA Cv",cR:"lf Cv",4p:"jJ",cS:"6I Yt:",cT:"no 6I Yu on 7I Yv",W:"no oJ 2X;",1u:"30 lK",cU:"6T 16;",4O:"lL",2g:"No Yw 1W",cV:"4c 4O",cW:"30 lK",cX:"No tG",cY:"&lt;Cw&gt;",cZ:"Yx:",2X:"6T:",d0:"Yy",d1:"Cx:",},d2:{d3:"4o",PR:"PR",d4:"5H",7J:"7J",d5:"no 7Z 2X...",19:"Cy",3g:"Cr",2c:"5s",d6:"My Yz",d7:"4d Lv",d8:"6u Lv",d9:"DF Lv",db:"4d/6u Lv",1u:"tH YA",k:"6v in Cz",dc:"3q 5J no YB 1s at q YC",dd:"6q",df:"lg",dg:"54 by",dh:"BS",dj:"lF YD",dk:"1O zG 6v",dl:"dm : 2N YF 6H 1s in lD Cz YG!",1W:"YH:",5x:"oG",},2L:{dp:"2L CA YI",dq:"tI:",4q:"4q",14:"14",dr:"oX YJ 6a...",ds:"<B>tJ :</b> No 6T ! (YK ?)",dt:"oG",1c:"YL",1B:"2L YM!",1M:"53:",1X:"lH oX",W:"X 5G be 4q 0 14 3U",13:"Y 5G be 4q 0 14 3U",1v:"lx 2x tK be oY jM 0...",1w:"8a 2x tK be oY jM 1...",3V:"8a 2x tK be oY jM CB 2x...",3W:"8a 2x YN 52 6S to be oY jM dw - it 4v YO YP CD 14 YQ YR q oX ...r",dx:"1O/YS lM",dy:"1G. 2p:",dz:"1N. 2p:",dA:"5H ",dB:"CE ",dC:"YT by ",dD:"82 5H",dE:"YU 2Y",dF:"lf",dG:"jN",dH:"CF",5y:"lg ",dI:"82",dJ:"lf 4v",dK:"YV 4v",dL:"CG 4v",dM:"YW 4v",dN:"jN 4v",dO:"CF 4v",2x:"4J",19:"Cy",6y:"oZ",dP:"tL",dQ:"nl",dR:"<dS dT=#dU>dm : YX 4v dV of",dW:"YY YZ oX is Z0.</1b>",2Y:"Cs...",dX:"Z1 to 5C 30",dY:"30",dZ:"lE jK",1W:"6T:",5x:"No tG",e0:"Z2 ",1j:"ty =)",e1:\'oM\',e2:"tm!",e3:"Z3 to ",e4:"6V 2Y 1H",e5:"53 : 3q Z4 52 Z5 3n lN...",e6:"53 : Z6 5y",e7:"7t 2A",},e8:{j:"57 58 - 4N",25:"nU",3i:"DF",e9:"oP 1s",1J:"2A",k:"57 58 2h: (54/2m)",1d:"Z7 2A",ea:"Z8",4R:"4R",eb:"no BP",ed:"Z9",ee:"57 58 2r CH: ",ef:"57 58 2A",eg:"Za",eh:"8b Cb",ei:"2H:",ej:"1N. 2L 7y:",ek:"88",em:"oK 1H(s) 2Y",eo:"8b 2L 89",ep:"Zb 31 5K ",eq:"Zc",eu:"Zd:",ev:"7y",ew:"Ze p0",ex:"Zf p0",ey:"Zg 3g:",ez:"p1 bJ CI",eA:"Zh bJ CI",eB:"CJ CK tC:",26:"52 p2 oK 1H(s) 2Y",3L:"52 p2 Zi 2Y",2X:"6T:",1B:"Zj by CL",},7L:{j:"15 Ch / Zk",3i:"6W",eC:"nT",3E:"oF",1I:"tn 1I",3X:"30 2H:",eD:"54 4O 89",1x:"88",eE:"oK 1H(s) 2Y",1k:"5F a 1I",eF:"oF to 25 tM - 6W",eG:"<BR>lI 7L CM is CN to Zl Zm 14 8c a tM.<BR>        He 25 in 2 1K, Zn so Zo q tN 14 Zp 87 .<BR>        Zq CO 3q 5J 1 2Y 1H in lD Zr 2r a tN to be Zs.<BR>        Zt q lN of a tN 14 q 1s 14 6U ON !.<BR><BR>        jJ of 1s (11 eH):<BR>        <A 1I=eI eJ=3B://eK.eL.3C/eM/eN>oZ tO at eO li</a>        <eP eQ=100%><TR><TD>2p</td><TD>1K 1</td><TD>1K 2</td><TD>Cx</td><TD>rT. 1G</td></tr>        <TR><TD>1</td><TD>n/a</td><TD>160 MM</td><TD>12 MM</td><TD>0</td></tr>        <TR><TD>1</td><TD>n/a</td><TD>80 2y</td><TD>Zu</td><TD>1+</td></tr>        <TR><TD>2</td><TD>5 MM</td><TD>130 2y</td><TD>1st 1K</td><TD>2+</td></tr>        <TR><TD>3</td><TD>10 MM</td><TD>eR 2y</td><TD>1st 1K</td><TD>3+</td></tr>        <TR><TD>4</td><TD>20 MM</td><TD>eS 2y</td><TD>1st 1K</td><TD>4+</td></tr>        <TR><TD>5</td><TD>50 MM</td><TD>eT 2y</td><TD>1st 1K</td><TD>6+</td></tr>        <TR><TD>6</td><TD>100 MM</td><TD>eU 2y</td><TD>1st 1K</td><TD>7+</td></tr>        <TR><TD>7</td><TD>150 MM</td><TD>eV 2y</td><TD>1st 1K</td><TD>8+</td></tr>        <TR><TD>8</td><TD>eW MM + 3Y</td><TD>eX 2y + 3Z 40</td><TD>1st 1K + 1 2y</td><TD>9+</td></tr>        <TR><TD>9</td><TD>eY MM + 3Y</td><TD>eZ 2y + 3Z 40</td><TD>1st 1K + 2 2y</td><TD>10</td></tr>        <TR><TD>10</td><TD>f0 MM + lj</td><TD>f1 2y + f2 4n</td><TD>1st 1K + 6 2y + 50 4n</td><TD>10</td></tr></f3><br><br>",f4:"No lN !",f5:"BT 25 of tM :",f6:"Zv",sF:"n5",1K:"3j",3H:"1f 2h:",3I:"1f f7",3J:"tP:",f8:"2m 1f f9:",fa:"4s of 1st 3j 1j:",fb:"4s of lk 3j 1j:",fc:"6W lL",nu:"98",},3k:{fd:"nv",fe:"CP",29:"oI",ff:"CP",fg:"ll",fh:"Zw q HQ on 2F q Zx",fi:"p3 Zy - 3d",fj:"Zz Ck Ci",fk:"p3",fl:"2H 8d ",fm:"ZA 3b ZB ZC in 89 ZD of q ZE ! He is A9 by 3b ZF ZG 4q q HQ 14 q CQ 83 + 10 kN.",fn:"4d of ZH ",fo:"sJ to be ZI",fp:"p3 5B - 3d",fq:"ZJ 1s:",fs:"5B 6z",ft:"1O q CR",fu:"ZK ",fv:"CS A 5B",fw:"54 3k 89",fx:"54 3k CT a Af of",fy:"nx ",1x:"88",fz:"ZL",fA:"5F a CR",fB:"2E ll",fC:"oI 2E ZM:",41:"ZN",42:"ZO",fD:"5B ZP ZQ",fE:"Or lN",fF:"(lI CU of ZR is q Ai of q ZS ZT)",fG:"nx of q jI ZU:",W:"lI CU CV ZV",fH:"No 2G !",13:"5L 3q 2r ZW q jI !",1v:\'1o on q CW 83 !\',1w:"1o to 3k on q Aj 0,0 !",fI:"ZX 3k ",fJ:"3p, C1 3q 2r ZY 87 !",fK:"CX in 2 CY !",},7M:{fL:"Re-p4",j:\'15 RE-CZ - 3d\',fM:"CS A D0",fN:"tn 2F q ZZ",6B:"101 q 31 :",to:"To q 31 :",fO:"102 4q 89 re-p4 :",fP:"D1 q 103 of 1s",fQ:"5F a 104",fR:"105 D0 ",k:"RE-CZ jH 106",W:"1o to re-p4 6y of",13:"6A.",fS:"D2 tQ...",1Z:"Re-p4 D3 - 6d :",fT:"",},fU:{2i:"6C",j:"p3 jH D4 107 108 Cd",7N:"lp",1J:"2T 109:",3X:"10a of 2W:",fV:"(BL 14 2N to CN on )",fW:"10b of q ny (2w) by 10c to 10d q Aw -6A fX-",fY:"10e 10f",k:"<u><b>D5 6X:</b></u> n3 2q 2r a 2q tR to be 5J a sM of 5.",fZ:"oI D6 of q D7 2z in 2W :",g1:"10g q 2z",W:"53: 1o to 1B q 2W 2z...<br>4b p5...",g2:"6X tR",},g3:{j:"15-nA l2",g4:"rP",g5:"tl 6S to be in an 1F to 10h D8 10i!",2i:"7t",3M:"lE 7P",g6:"52 10j",43:"",g7:"jJ of lE",g8:"2H",g9:"1F 5E",ga:"1F 2L",},7Q:{7R:"10k 6c (10l) :",2n:"10m tO",1k:"1k:",7S:"Or 31:",},6C:{j:"oR 6v",gb:"# 1e 1H ",3T:"10n &6D;",1s:"6v &6D;",W:"jJ of 1s by 2z sN (to be do > 0)",13:"10o 10p of 2Z",1v:"3q CV 10q ! (2v ",1w:"6V 2z to be 10r.",gc:"6Q to oN ",3V:"10s D6 of q D9 2z",3W:"39 : 1o to 1B q 2W 2z...<br>4b 14 Db 87.",gd:"10t 10u 2Z do 3q 10v to 1B? (1 = tk 1H - 2m 2Z:a",gf:"10w of q D7 D9 2z... 10x 10y tC Dc !",gg:"39 : 1o to 1B q 2W 2z...",gh:"10z of q D3 1s.",19:"2p",gi:"Dd on q 10A",gj:"Dd on q 10B",},nC:{1Z:"Ca.",gk:"Df",2q:\'4T of \',gl:"AK 10C",},2q:{2i:"6X",gm:"x 2q",j:"10D 10E 8c",4U:"6X 7N",k:"4T 6E",ec:"Qu:",gn:"4T 6E",W:"AM 3p !",13:"Dg p2 jI!",1v:"sR nD in 6E!",1w:"6E 1C Dh: 10F to 2q 19 10+ 10G! D2 4O if D8 10H!",go:"10I 6Y be 10J in 10 CY",gp:"Cl by 10K",2z:"4T 6E",4U:"lp 2q:",},gq:{j:"tF 10L ",gr:"10M 10N",1Z:"1Z.",},gs:{j:"15-gu - 3d",44:"10O",k:"6z - 4Y",1t:"8e",2c:"2m",43:"<i><u>sT :</u> 10P a CB of 5 nE sU</u></i>",},2T:{gv:"10Q",45:"sV A BJ 2A",7T:"10R",gw:"(lI Di 10S 6Y p6 be 10T )",gx:"10U lO 10V&10W",6G:"lO 10X ",gy:"x 4b - 2H ",gz:"10Y 4p of jI in 4N CM",gA:"Dj",gB:"1l on 10Z",7U:"lO 110:",gC:"Dk p7",gD:"1O p7 Dl",gE:"1O lu 6Q ",gF:"x 4b if 5C a9 2r 1 AW",gG:"x 111 6X tS to nF D5",gH:"112 4w",gI:"6Z p8 -",gJ:"4w:",gK:"4N 2A:",gL:"1O 6v",gM:"1O 113",gN:"1O jI\'s Cj",gO:"1O ny",gP:"1O sW",3R:"Dm 114 1s",3S:"Dm 2W 1s",gQ:"1O \'5t Dn\' in 115 if 5t 6Y 116 Do in 117 jM",gR:"1O tT",gS:"Dp 2A:",gT:"6Z lF p9",gU:"oF on 6X 14 Dq tS",gV:"118 6X 14 Dq tS",gW:"119 1l 11a",gX:"pa 1l 11b (11c 11d, 11e tU.)",gY:"Dr 59",gZ:"59 on lE",h0:"59 on 30",h1:"tV",h2:"11f 2r 1F 11g",h3:"11h 2V:",h4:"11i tW - l0 1l",h5:"Ds Dt",h7:"<br>>> 11j: tX <i>4v sZ 2r Dv</i>",h9:"oH 2A:",hb:"pa 1F oH",hc:"pa 1F 7P",hd:"4c oJ 8c:",he:"2H:",hf:"oZ 2A:",hg:"oP HQ:",hh:"oP HQ 8c 5K 2N",hj:"C8 tY 8c 11k 11l ",hk:"1O 4d Dw in 11m 4w (tw, 7M 14 3k) ",hl:"pa t1",hm:"nI 2A:",hn:"6Z 11n p9 ",hp:"6Z tZ on 25",hr:"u0 11o",hs:"59 Dx:",ht:"11p",hu:"t3:",hv:"lH",hw:"Dy 6p",hx:"11q",hy:"Dz 2A:",hz:"Ds Ba:",hA:"1F 1l 14/or",hB:"11r to 3q",hC:"DB on ",hD:"1G. 11s 11t: <br><i>(Dp p9)",hE:"tH:",hF:"11u:",hG:"tF n8 (11v pb):",hH:"1O:",hI:"My lF Dn:",hJ:"11w 6H HQ:",hK:"lH on DC:",hL:"54 pc:",hM:"4o pb",hN:"My 1s",hO:"11x",hP:"8b 2F 1J",hQ:"My tH",hR:"8b 11y",hS:"6Z 1n 11z 4O 3i in 11A",hT:"5L\'s 11 70 pd, 11 70 pe, 11 hU hV - 5C pf...<br>5L 3q p6 to 2F u1 pg u2 oL nJ<br>u3 to lP : hW,7V,hX,hY,hZ",i0:"11B",i1:"to 3q",i2:"Dv",i3:"51 2A:",i4:"1j a Bk if 11C DD",i5:"lJ ph/pi ly (pj 2l X)",i6:"DG q tZ of t5 i7",i8:"On q 32 : ",i9:"on CQ 83 : ",ia:"11D q 4W",ib:"4c q oJ of DC 11E 6B pk lN",ic:"pl lM:",id:"lQ 8d lR of lS (6S 2N 5K lT)",},3l:{46:"11F",47:"x Bm",6H:"1O 7X",1J:"6z",7W:" 1x 7W:",1k:\'5F\',44:\'Dc jH ON 11G\',7X:\'jK of q 8d 11H\',2U:\'3l 2U\',1n:\'3l 1n\',},3m:{45:"7Y 2A",1X:"lH 4x",6s:"11I 4x",1n:"4c 4x",ie:" 1j 7Y lL 5K ",ih:"u4 3m",1m:"no pm tk",7Z:"rV 11J",ii:"11K",ij:"no Bn 6j",},ik:{6I:"DH:",},io:{46:"tB",4X:"oS",ip:"Bp",6J:"6J",1p:"1p/21",2h:" C4 ",6K:" 11L ",19:"2p",5v:" Cn ",iq:" 11M ",ir:{j:"15-81 : pn 56 jO\\\'S",iu:"4d to 6U 8f:",iv:"u5 1x:",iw:" 14 lU",ix:"88 q u6",iy:"u7 84 6U oT in 3n 31",iz:"u8 q TR 16 to 1x:",3n:"u9",iA:"nK 3h:",iB:"ua jP",iC:"5F ub",iD:"oO ...",iE:"nL 6Y 1x 16 uc 3n of pk ud",3O:"71",5D:"5D",2Z:"5I:",iF:"5G 5J",iG:"5G 71 5J",14:"14",iH:"in 1H(s):",iI:"4c jP",41:"5M 16",42:"No 16 to 3Q.  6V 2r jQ 6L.",iJ:"82 83 6M (nO) 84 of lz",iK:"5M ",iL:"ue to 3Q 1C",iO:"5M uf.  6V 2r jQ 6L.",iP:"ug uh:",iQ:"4d oU",iR:"p1 31",iT:"8a 4p of 8f:",},iU:{j:"15-81 : pn 56 jO\\\'S ",iV:" lG OF 55 11N TO 11O ",iW:"DJ 4Y DK a 6K ",iX:"or lU ",iY:" DJ 4Y DK",iZ:"11P",j0:"16 3h 11Q to 11R :",j1:"1x q 16 CT q CW 11S jL",j2:\' At lV, 1 of q 3 4u jL\',j3:\' At lV, 1 of q 2 4u jL\',j4:\' At lV, q 4u 4X\',j5:\' At lV, q 2 4u jL\',j6:\' At lV, q 3 4u jL\',j7:"<u>16 pg 6M 52 1n:</u><br>1f CO 6M 1Y, 11T or 11U a lU 6K jM +0 6Y 11V 1n!",1t:"oS to 1x",2a:"DL",48:" jK of q 16 8c Dh - (DL 11W in 11X)",49:"6Q",4a:"6q",j8:"11Y 4Y 11Z 120 121 122",2N:"DM",j9:"No 1C 6Y be 1n.",jb:"1m to 1n, we 6M 6P ( tQ 2r 123 ) ",jc:"oM of q 124",jd:"t9 DN :(",},2f:{j:"15 6N/6O/nP",k:"125 55 DP",16:"1f jK:",1d:"126 D4  127",2b:"DP",2g:"No 1C in q 6P ta !",6P:"In tQ...",jf:"128: ",jg:"CX of",jh:"lB nQ: ",85:"lC nQ: ",ji:"x 1p/21/3o is 129;.",1m:" No 1C in q 12a!",jj:" 12b of q DQ 1C...",jk:"1o to 12c an 2f DR 19 10 !",jl:"1o to 4L DR 12d (5) !",48:"8e\\\'s 12e -1p/21- 12f",49:"6Q",jm:"5E",4a:"6q",jn:"tb.",jo:"lB 4Z.",jp:"lC 4Z.",jq:"Dg p2 12g ",jr:"6O DS ",js:"6N DS ",jt:"DN",2e:"3o: ",ju:" tt 3b: ",jv:" 12h ",jw:"12i",jx:" jJ of BK:",jy:"<i>(5K it 12j at q DQ 1C)</i>",4u:"At q oN",},1Y:{j:"12k 55 jO OF 55 56 tD ",1Y:" BD ",jz:"12l 12m",4W:"86:",2g:"No 1C ",jA:"12n 1C :(",jB:" Do 12o 1C!!!",jC:"86 12p 12q:",jD:"DT",k:" 12r OF 55 nR",},jE:{j:" 56 tD- Cc ",47:"DH:",},2K:{W:"1o ! 5L\\\'s to DV q 29 2K.",13:"1o ! 5L\\\'s to DV q 29 2f/4L.",2e:"2K on 12s...",j:"15 nP 12t",k:"<i>3o 8c tE 16</i>",1d:"<i><1b 2V=2l>DO 71 12u 12v 55 15 6N / 6O</1b></i>",jF:"3o x On",jG:"3o x nS",},},},\'it\':{8L:\'12w\',8M:\'DW 72\',8N:\'4e\',8O:\'DX\',8P:\'po\',8Q:\'38\',8R:\'pp\',8S:\'5p\',8T:\'12x\',8U:\'ui\',8V:\'th\',8W:\'DY\',8X:\'12y\',8Y:\'pq\',8Z:\'90\',91:\'ps\',92:\'C.A.R.\',93:\'7t\',94:\'sE\',95:\'96\',97:"uj",99:"pt",9a:"12z il 2O: 12A il 12B",4I:{9b:"6a:7u/9c;9d,9e+12C/12D+12E+12F++12G/12H+12I++12J/12K+12L+12M+12N/12O/12P+12Q+12R+12S+12T%3D",9f:"3B://9g.9h.3C/9i/12U/",1M:"8g",or:"o",6b:"uk",9j:"12V",9k:"DZ",6c:"jR ",3E:"ul",9l:"12W",1S:"in",9m:"jS",9n:"12X 12Y",9o:"La 5q a d&c;rF&c;e 1T 11 n\\\'1U 7w rG&c;",9p:"pu E0 :",9q:"73 12Z",9r:"E1 131 8h ",9s:"39 132: 5 uo, 133",9t:"jS 2O !",1j:"lW",9v:"134",9w:"E1",1m:"uq",2F:"135",9x:"33 136 ui",9y:"33 E2",3b:"ur",2U:"ut",1n:"33",9z:"73 E3 :",1k:"jT",9A:"137",9B:"138",2u:"uu",to:"a",},9C:{9D:"uv uj",9E:"E4 8i in un\\\'jU 1e E5 la E6",9F:"uj",9G:\'uv - uw\',9H:"uv - 139",9I:"13a",9J:"lX 13b",9K:"13c il 13d 1e E7 8j ux...",9L:"3r ux 1e",9N:"13e 2v:",9O:"33 5N:",9Q:\'pv lY:\',9R:"1G",9S:"1N",9T:"uy 5a:",9U:"uz:",9W:"1H(s) E8 1e 2P",9X:"13f",9Y:"uA",9Z:"13g",a0:"13h",a1:"E9",a2:"13i",a3:"13j",a4:"# pw",a5:"13k: ",a6:"5b Ea",a7:"Eb: ",a8:"13l i 13m 13n da jV:",aa:"Ed",ab:"2v Ed (13o 5a 6 uk)",ac:"# Ee;",ae:"*72 da 13p*",af:"8g",ag:"pu:",ah:"13q...",},aj:{3H:"il px ",3I:"ha 13r di py. 13s : ",3J:"13t :",},ak:{3c:" ",ao:"13u",ap:"uB",aq:" uA ",ar:"  13v ",av:"13w.",aw:"4e:",at:"74",hq:"QG",1I:"Ob:",ax:"Ef",ay:"13x",aA:"in ",aB:"a",aC:"13y",aD:"IN Eg",aE:"13z Eh",aF:"Eh",6g:"13A",1s:"jW",2w:"Ei",5t:"13B",aG:"73 13C :",aH:"Eg",},3G:{j:"jX pz jW",6i:"Ej",25:"uy",aI:"Em",aJ:"Em + 13D",aK:"px 13E",aL:" 73 pw",aM:" 73 Eo",7D:"(13F)",aN:"13G 13H di 34: ",aO:"33",aP:"33 lZ",aQ:"jR da 13I",aR:"13J un 5O",aS:"13K di 13L : ",26:"13M un 13N 1e Ep !",aT:"uB 13O",3L:"13P",aU:"13Q 13R !",aV:"Eq 13S uC.",6j:"z1&c;e",aW:"<1b 2V=2l aX=\'aY\'><b>8g, Et !<b></1b>",aZ:"Eo Eu",kV:"pw Eu",b1:"13T 13U",b2:"13V",},7F:{j:"jX 13W",b3:"Ev : ",b4:"<b><1c>13X 13Y !<br><br>I 13Z 22 140 di 141 Ew 142\\\' 143 Ex.</1c></b>",b5:"<1c>ui Ex</1c>",b6:"5b 144 75 !",},b8:{j:"145. 146 pA",k:"147 148 pA 149",3M:"14a",4l:"uD",kX:"Al pB",2W:"na&17; in m0",b9:"14b. l6 14c",1M:"8g di 14d",},6k:{j:"jX 14e Ey",ba:"uu",bb:"Ez",1B:"33",bc:"m1 EA la pC 4f 14f...",bf:"m1 EA la pC pD 14g",bg:"Ee in 5P...",k:"14h",1W:"uE;",1m:"5b 14i 75 !",6m:"14j in pE : ",bi:"m2 m3 :",bj:"14k le 76",26:"EB 14l !",bk:"uF in 14m",2u:"m3 :",1X:"m4 la pE",2w:" uF EC : ",bl:"uD 5Q pE.",bn:"uF in 5P... ",},38:{j:"kZ - 77",bo:"ED in 1g m5",bp:"ED in 1g EE",bq:"14n lo ng 5a ",bt:"Il 14o ng :",},bu:{j:"14p - EF 14q",bv:"14r",bw:"14s E0",bx:"33 E2",bz:"ps 29",bA:"EG x",bB:"x EH",bC:"4e",bD:"96",bE:"uG",bF:"C.A.R.",},4m:{j:"8k ",bG:"14t",bH:"14u",bI:"14v",bK:"76",bL:"EI",bM:"po",1t:"14w",2a:"zi&17;",bN:"14x",bO:"Ei 14y 14z :",},2n:{1u:"14A 14B",k:"EJ jW",1d:"14C 14D",2b:"14E - EM & 14F 14G",2c:"uH",bP:"14H 14I",bR:"EO m6",bS:"EP. EQ",3O:"2Q. EQ",bT:"14J",bU:"ES",bV:"2Q. 14K",bW:"2Q. 14L",bX:"2Q. 14M",bY:"EP. 14N",bZ:"14O di 14P",c0:"14Q Cg",c1:"14R 14S EU uA",c2:"14T 14U",c3:"La jY da",c4:"a",c5:"&7H; di",},1F:{j:"uI 14V 14W 14X",1u:"3r m3",c6:"uJ 1e :",c7:"3r",c8:"14Y 14Z",c9:"151",ca:"152; uu",},4H:{j:"uK 5R jZ - EV 8k",cb:"4g pF 8j k0",cd:"4g k1 8j uL EW",cf:"153 in uM :",cg:"154 uN pG 2P ",k:"zs DI 155",1d:"156 157",2b:"EV 8k",ch:"EX",2K:"158",2e:"uO in 5P",2f:"pv",4L:"159\\\';",3Q:"33",1Y:"EY",ci:"15a",cj:"4M 15b",cl:"15c(i)",cm:"15d(i)",},cn:{j:"-= sj 15e DI 15f =-",co:"15g 11",cp:"15h pw",6p:"15i",},4N:{1t:"sk",2a:"pH",cq:"La pI di 5w 5c si 15j in 15k 2P",cs:"m7 di 5w",ct:"15l il",2j:"uH",3R:"15m",3S:"s2.",cv:"15n m6 di py",cw:"uP m6 di 15o",cx:"uP m6 di 15p",cy:"uP m6 di 15q",cz:"sl.",3T:"15r",cA:"15s",ts:"TS",3g:"EZ",cB:"F0 s1 / 15t di pE",cC:"7G 1N",cD:"7G 15u.",cE:"15v",cF:"15w",cG:"F1",},cH:{cI:"F2",cJ:"15x",3h:"3c :",to:"&#sp;",us:"15y",7I:"F3",4l:"uD!",2j:"F4:",cK:"uQ:",cL:"15z:",cM:"TS",cN:"FS",cO:"sr",cP:"15A 1q F6 di 5O",cQ:"15B 1q F6 ",6t:"15C F7",cR:"F2 F7",4p:"78",cS:"15D di 15E :",cT:"k2 15F 1e 15G",W:"5b uR d\\\'5O 75",1u:"pq 4f 5N d\\\'5O",cU:"uS 75",4O:"15H",2g:"5b k3 75;",cV:"15I i 5N 15J",cW:"pq 4f 5N",cX:"15K 15L",cY:"&lt;lb zD&gt;",cZ:"15M :",2X:"pu :",d0:"F8",d1:"F8 F9 di :",},d2:{d3:"4o",PR:"PR",d4:"TS",7J:"15N",d5:"k2 Fa in 5P...",19:"2Q",3g:"EZ",2c:"F4",d6:"2P",d7:"2Q 2P",d8:"2Q 6u ",d9:"FO 2Q",db:"px/6u 2Q",1u:"8l 34 15O in uT",k:"8l pJ 34 15P in uT",dc:"k2 15Q in uT 15R.",dd:"pH",df:"pK",dg:"sx&c; 3f",dh:"zF",dj:"l8 / h",dk:"4g 72 15S",dl:"dm : 15T 11 1e E7 i 15U Fb.",1W:"uE :",5x:"4M 75;",},2L:{dp:"lX 15V ...",dq:"uw:",4q:"8h",14:"e",dr:"lX in 15W ...",ds:"<B>15X :</b> 4M 75 ! (Fc Fd ?)",dt:"uq",1c:"15Y",1B:"15Z 161 !",1M:"k4 :",1X:"m4 la m8",W:"X Fe 8h 0 e 3U",13:"Y Fe 8h 0 e 3U",1v:"La jY fX 79 8i m9 di 0",1w:"La jY 2v 79 8i m9 di  1",3V:"La jY 2v 79 8i m9 5Q fX",3W:"La jY 2v 5c 79 Ff dw ! 162 vi 163 164.!!!",dx:"pt (165 lo 166 Fg)",dy:"2Q 1G :",dz:"pv 1N :",dA:"k5 TS ",dB:"Fh ",dC:"uJ 1e ",dD:"167 le TS",dE:"Fi",dF:"Fj",dG:"Fk",dH:"pL m5",5y:"pK ",dI:"uU i lY",dJ:"Fj",dK:"168 Fd",dL:"di un\\\'jU",dM:"Ez",dN:"Fk",dO:"pL jU",2x:"4J",19:"2Q",6y:"169 2n",dP:"16a",dQ:"16b",dR:"<dS dT=#dU>dm : Le 16c 16d k1 i 16e dV di",dW:"uV 16f al pB 5Q m8.</1b>",2Y:"Fi...",dX:"16g i uV",dY:"uy",dZ:"8l uW",5x:"4M 75;",1W:"pu :",e0:"78 uW ",1j:"16h !",e1:\'Fm\',e2:"16i!",e3:"Fm a  ",e4:"In uX di 16j 1H E8...",e5:"k4 : k2 Fn 16k",e6:"k4 : pK 16l",e7:"16m 1e la m8 pD ux",},e8:{j:"Fo pM pN",25:"96",3i:"FO",e9:"m2 34",1J:"pt",k:"Fp - pM pN",1d:"77 pM pN",ea:"2Q",4R:"4J",eb:"5b Ea",ed:"uY jW",ee:"uZ FO - 16n",ef:"\'Fq LE pM pN",eg:"16o",eh:"Fr la v0 pJ FO :",ei:"k6 di 5O :",ej:"16p 2v di m8 :",ek:"8m Fs",em:"rN",eo:"lX 5a",ep:"16q al Ft 2P Fu",eq:"uo",eu:"v1 :",ev:"1e 16r&17;",ew:"1e 16s, 16t",ex:"1e v2 16u",ey:"zW&17; 16v :",ez:"Fv 16w",eA:"Fv 16x",eB:"16y 16z 1q 2P :",26:"8m 5c 16A",3L:"F0 5c Fw",2X:"uE: ",1B:"16B EU L\'16C",},7L:{j:"15 TS - Fx / 16D",3i:"TS",eC:"90",3E:"ul 72",1I:"v3 uW",3X:"k6 d\\\'5O :",eD:"lW uR 5a",1x:"uz",eE:"rN Fs",1k:"jT",eF:"ul 16E\\\'5O 74 TS - EH",eG:"<BR>16F Fx 1e 16G 16H 3s TS.<BR>        16I in 2 16J, 16K la 16L, se 1q k7, e 16M.<BR>        16N le v4 di 3s TS e le 34.  16O ON !.<BR><BR>        78 di 34 (11 eH):<BR>        <A 1I=eI eJ=3B://eK.eL.3C/eM/eN> eO li</a>        <eP eQ=100%><TR><TD>2p</td><TD>2M 1</td><TD>2M 2</td><TD>sv</td><TD>Ef 1G</td></tr>        <TR><TD>1</td><TD>n/a</td><TD>160 MM</td><TD>12 MM</td><TD>0</td></tr>        <TR><TD>1</td><TD>n/a</td><TD>80 4h</td><TD>7C</td><TD>1+</td></tr>        <TR><TD>2</td><TD>5 MM</td><TD>130 4h</td><TD>1a 5S</td><TD>2+</td></tr>        <TR><TD>3</td><TD>10 MM</td><TD>eR 4h</td><TD>1a 5S</td><TD>3+</td></tr>        <TR><TD>4</td><TD>20 MM</td><TD>eS 4h</td><TD>1a 5S</td><TD>4+</td></tr>        <TR><TD>5</td><TD>50 MM</td><TD>eT 4h</td><TD>1a 5S</td><TD>6+</td></tr>        <TR><TD>6</td><TD>100 MM</td><TD>eU 4h</td><TD>1a 5S</td><TD>7+</td></tr>        <TR><TD>7</td><TD>150 MM</td><TD>eV 4h</td><TD>1a 5S</td><TD>8+</td></tr>        <TR><TD>8</td><TD>eW MM + 3Y</td><TD>eX 4h + 3Z 40</td><TD>1a 5S + 1 16P</td><TD>9+</td></tr>        <TR><TD>9</td><TD>eY MM + 3Y</td><TD>eZ 4h + 3Z 40</td><TD>1a 5S + 2 4h</td><TD>10</td></tr>        <TR><TD>10</td><TD>f0 MM + lj</td><TD>f1 4h + f2 4n</td><TD>1a 5S + 6 4h + 50 4n</td><TD>10</td></tr></f3><br><br>",f4:"pK 16Q !",f5:"rS(s) d\\\'5O 74 ts :",f6:"7a",sF:"Fy",1K:"2M",3H:"1f 2h:",3I:"1f f7",3J:"A5 :",f8:"2m 1f f9:",fa:"4s of 1st 3j 1j:",fb:"4s of lk 3j 1j:",fc:"sG 90",nu:"Fz",},3k:{fd:"ps",fe:"uG",29:"FA",ff:"uG",fg:"FC",fh:"16R la 16S QG su pF i 16T ",fi:"16U k8 - 77",fj:"16V I 16W",fk:"k8",fl:"k6 pO ",fm:"Il v5 FD 16X 16Y ad 5a 16Z ! si 170 pP v5 m9 di jY 35 il QG + 10 kN.",fn:"171 172 ",fo:"sJ &17; lm",fp:"pQ k8 - 77",fq:"72 173 :",fs:"174 pQ",ft:"v3 i v6",fu:"F1 ",fv:"175 UN pQ",fw:"FE FF 5a",fx:"lW FF 35 un k9 di ",fy:"FG ",1x:"uz",fz:"176",fA:"jT un FH",fB:"FI FC",fC:" ps v6:",41:"177;",42:"Fy;",fD:"pQ 178 Ey",fE:"179 le v4",fF:"(Il 17a FD 17b 1e 6A&17; di 17c)",fG:"FG 76 17d : ",W:"La sK&17; 5c 79 Ff ",fH:"pL m5 !",13:"v7 la 17e !",1v:\'5T 17f 17g lo 17h 2P !\',1w:"5T su 0,0 !",fI:"FI 17i.",fJ:"8g, 17j !",fK:"17k 8h 2 DZ !",},7M:{fL:"EG",j:\'77 - pz 17l jW\',fM:"17m UN pz",fN:"v3 la v0",6B:"17n 2P:",to:"al 2P:",fO:"D&Aq 4r sI r&c;Ar :",fP:"17o le 34",fQ:"jT FH",fR:"17p 17q",k:"pz 17r",W:"5T 17s 17t\\\' di",13:"6A&17; 1e FJ.",fS:"FK...",1Z:"17u pR - 73 :",fT:"",},fU:{2i:"C.A.R.",j:"77 - 17v EM 17w",7N:"v8",1J:"17x 17y :",3X:"k6 di m0 :",fV:"(Ep e 17z 1e 17A)",fW:"17B di FL (EC) 1e 17C 17D -na&17; fX-",fY:"17E",k:"<u><b>x-Ax :</b></u> 4T en 5z d\'1V d&c;lq 2k Ay un sM de 5.",fZ:"nz 5z Q g0 en 28 :",g1:"3a la 6o en 28",W:"39 : 1o d\'lr w g0...<br>4b Di...",g2:"6X tR",},g3:{j:"15-nA DI UN\\\'E9",g4:"Eb",g5:"E4 8i 17F di un\\\'m5 1e E5 la E6",2i:"7t",3M:"Ej i 17G",g6:"4M 17H",43:"FM: I uV si 17I pP 17J 17K a AC 17L!<br>FM : AD ?Ãƒâ€°Ã‚Â¬Ã‚Â® 17M 1e FN 1 6i 5a 24 uk 1e Fn!<br><b>t7 17N 17O 17P !</b>",g7:"78 17Q ",g8:"k6 ",g9:"jR m5 ",ga:"lX jU",},7Q:{7R:"jR FP (uQ) :",2n:"5p v9",1k:"FQ :",7S:"o pG 2P: ",},7Q:{7R:"jR FP (uQ) :",2n:"5p v9",1k:"FQ :",7S:"o pG 2P: ",},6C:{j:"17R 34 e 17S pS pT FR",gb:"# 1e 1H ",3T:"Le pS &6D;",1s:"6r 17T &6D;",W:"78 di 34 1e 1H uC (79 8i > 0)",13:"78 di 1H uC.",1v:"5T 17U ! (2v: ",1w:"3r 17V pS, vb",gc:"17W 5Q 17X ",3V:"pU pR",3W:"k4 : 5T vc...<br>jS 11 e Et.",gd:"Da l6 1H 17Y vc ? (1=17Z in 5P a",gf:"m1 180... 181 !",gg:"39 : 4M 182 vc...",gh:"3r m0, vb",19:"183",gi:"vd pT FR",gj:"vd pP FT",},nC:{1Z:"pR.",gk:"184",2q:\'EO di \',gl:"185 186",},2q:{2i:"187",gm:"188 189",j:"jX 18a",4U:"18b ",k:"18c AL 18d",ec:"Ec:",gn:"m1 18e",W:"8g 18f la 18g !",13:"Le 76 5c 18h !!",1v:"18i in FU!",1w:"Le FV > di 9 18j 18k FW.",go:"Si 18l 8h 10 ls...",gp:"uJ 1e v5",2z:"3r di uX",},gq:{j:"jX uK 18m  18n ",gr:"18o ",sS:"18p",1Z:"pR.",},gs:{j:"jX - 15-gu",44:"EJ",k:"uZ - FX 18q 18r DA 18s",1t:"18t da 18u",2c:"uH ",43:"<i><u>sT :</u> AO un AP de 5 nE sU</u></i> - <i>(*) Il sL np le 7O 2k nb le 4m &17; rH.</i>",},2T:{gv:"18v su ",45:"5U 1q 2O",7T:"18w",gw:"(si 18x in pO Fu il 18y)",gx:"18z 5Q 18A",6G:"18B",gy:"jS 11 5a",gz:"18C la FY pJ 76 18D 5N",gA:"18E Fg",gB:"1l a 18F",7U:"18G :",gC:"18H 18I",gD:"5p v9 vf 18J.",gE:"ut l\'18K in lu",gF:"jS 11 se 5c 18L 1e 1 FZ",gG:"18M ka su FB (uU i 18N)",gH:"7a la G0 18O",gI:"18P 18Q -",gJ:"18R :",gK:"5U 4f 5N; :",gL:"4g le 34",gM:"4g le pS",gN:"4g lo 4m di 76",gO:"18S 2n vf FL",gP:"4g la G1 di 76",3R:"18T 34 e 76 in Fa",3S:"18U le 34 in m0",gQ:"4g \\\'18V\\\' in uM se la G1 di py &7H;  in 18W o 18X a  ",gR:"4g 18Y",gS:"5U 5Q 1l :",gT:"18Z nG in 1g se 190 in uM",gU:"191 ka le FV e le 192 pD m3",gV:"33 193 di 194 in 1g ",gW:"33 le vg 5Q 1g",gX:"7a 195 5Q 1g (G2., G3, 196)",gY:"197 su G4",gZ:"lw su vh 198",h0:"lw su vh uB",h1:"mb B4",h2:"mb i G3 1e i B5",h3:"G5 in 1g :",h4:"199 lo 19a 5Q 1g EE :",h5:"19b 19c nH",h7:"<br>>> 19d : h8 3f h8 - <i>19e : 19f k1 tu</i>",h9:"5U 4f 5N di 11 :",hb:"pV i 5N jU",hc:"19g la 19h pD m3",hd:"33 ka i 5N :",he:"k6 di m8 :",hf:"5U 19i 19j :",hg:"32 ( QG ) :",hh:"v7 il 2P 2F\'G6 1q 19k",hj:"19l l\'G7 in pO",hk:"7a la G8 19m 4f lY G9 G0 DW 72 ",hl:"pV i Ga (FT CC)",hm:"5U m7 :",hn:"7a la pI",hp:"7a 19n vf pI",hr:"Gb 19o di B9",hs:"19p 19q :",ht:"Gb",hu:"t3 :",hv:"m4",hw:"19r pG",hx:"19s",hy:"mb un 19t :",hz:"19u 19v :",hA:"in 1g jU",hB:"in G4 a te 19w",hC:"FN vh a ",hD:"vj pJ 34 : <br><i>(19x in 1g)",hE:"mb se 19y : ",hF:"4g la 19z 19A :",hG:"4g v2 ES :",hH:"mb :",hI:"4g 19B 19C py :",hJ:"Gc FY 1q 32 :",hK:"m4 lZ se Fc 5O :",hL:"lW E-pc :",hM:"19D 19E",hN:"72",hO:"72 19F",hP:"Fr le pt",hQ:"vd 19G",hR:"19H i G5",hS:"7a la Gd 4f Ga di 19I",hT:"Ge 8j 19J 4f Bg : Bh, Bi, hU hV, 19K<br> Ge 7V 1e la 19L 19M e  pF 19N l6, a 19O 19P, 19Q 19R. <br>19S al lP: hW,7V,hX,hY,hZ",i0:"Fb ",i1:"a te",i2:"da te",i3:"5U 1q Gf :",i4:"lW un 19T 19U il Gf 19V",i5:" 19W 19X 19Y/19Z (1a0 X 1a1)",i6:"Gc i 1a2 1e le 1a3 i7",i8:"1a4 32 : ",i9:"pT 1a5 1a6 : ",ia:"7a il 4W",ib:"1a7 1a8 su 1a9 v4 :",ic:"5U 4f 1aa a 1ab :",id:"lQ 8d lR of lS (6S 2N 5K lT)",},3l:{46:"1ac",47:"1ad 29",6H:"uw",1J:"uZ",7W:"1ae da 1af :",1k:\'jT\',44:\'jW IN 1ag DI 1ah\',7X:\'3r 4f 1ai\',2U:\'ut\',1n:\'33\',},3m:{45:"Fq 3m",1X:"m4 lZ",6s:"1aj lZ",1n:"33 lZ",ie:"FE un uR 1ak 7Y 5a ",ih:"ur 3m",1m:"5b 7Y pP 2P",7Z:"1al 1am",ii:"FX",ij:"k2 G8 1e il 2P",},ik:{6I:"Bo:",},io:{46:"4e",4X:"vk",ip:"x m2",6J:"x mc",1p:"Gg/pV",2h:"pq",6K:"Bq&17;",19:"pv",5v:"EY",iq:"1an",ir:{j:"Gh DI 15 uY nk",iu:"px 1ao 1ap l\'uN:",iv:"vl le 4V: ",iw:" o F9",ix:"1aq il 1ar",iy:"1as 1at 1au l\'uN 1av 1aw lY",iz:"1ax le vg:",3n:"uU",iA:"k5 1ay:",iB:"jT 1az",iC:"1aA 3s 1aB",iD:"1aC...",iE:"L\'29 Gd Gi 1aD di Gj le vg",3O:"NO",5D:"F3",2Z:"vk:",iF:"79 Gk",iG:"5c 79 Gk",14:"e",iH:"1aE\'vm:",iI:"1aF la 1aG",41:"m2 1aH\'vm",42:"5b k3 da vn. FK.",iJ:"I lY Ew 1aI di 1aJ o 1aK",iK:"pU in 5P ",iL:"L\'k3 5c 1aL\' 8i 1aM",iO:"pU Gm. 1aN.",iP:"v1 di 1aO:",iQ:"1aP",iR:"1aQ",iT:"1aR 1aS:",},iU:{j:"Gh DI 15 uY nk",iV:"md Gn DA 1aT",iW:"vl le 4V 35 3s Go&17;",iX:"o 1aU",iY:"1aV le 4V 35",iZ:"1aW(i)",j0:"k5 4V da Gp :",j1:"vl, 1aX, Gj le 4V 35 3 k0 1aY",j2:\'jV, 1 4f 3 pW k0\',j3:\'jV, 1 4f 2 pW k0\',j4:\'jV, l\\\'Gq vm\',j5:\'jV, 8j pW 2 k0\',j6:\'jV, 8j pW 3 k0\',j7:"<u>4M 1aZ 1b0 :</u><br>le 4V 1b1, 1b2 e 35 v2 m9 di 0",1t:"vk da Gp",2a:"Gr",48:"8l 4V 1b3 in pO - (Gr 8h 1b4)",49:"ur",4a:"pH",j8:"1b5 1b6 nk DA 1b7",2N:"jS",j9:"5b k3 da vn.",jb:"EB da vn - 1b8 ",jc:"pU in 5P di",jd:"m2 1b9 (1ba!) :(",},2f:{j:"77 1bb E Gs 1bc Gn",k:"Fo",16:"8l 4V : ",1d:"1bd E uI",2b:"8l v6",2g:"5b k3 1be !",6P:"In uX...",jf:"pX : ",jg:"pX di",jh:"pX 1bf: ",85:"pX 1bg: ",ji:"x 1bh/1bi/uO 1bj.",1m:"k2 v0 !",jj:"1bk 35 il Ft k3...",jk:"5T 2f > di 10 !",jl:"5T 1bl la Go&17; 1bm 1bn (5) !",48:"8l uL -Gg/pV- 1bo",49:"73",jm:"jR",4a:"pH",jn:"tb.",jo:"lB 4Z.",jp:"lC 4Z.",jq:"1bp 5c 1bq.",jr:"1br Gt ",js:"1bs Gt ",jt:"1bt",2e:"mc : ",ju:"73 E3 : ",jv:"In 5P",jw:"EX",jx:"78 uo :",jy:"<i>(al pB 1bu al 1bv G9 pC)</i>",4u:"1bw in FU",},1Y:{j:"1bx IL jZ",1Y:"1by",jz:"De-v7",4W:"5U :",2g:"uq ",jA:"uS Fw :(",jB:"uS 1bz !!!",jC:"4e 1bA :",jD:"x-86:",k:"77",},jE:{j:"uK 5R jZ - Fp",47:"1bB :",},2K:{W:"5T ! Gu la 1bC 29.",13:"5T ! Gu l\'29 2f/4L.",2e:"uO in 5P...",j:"Gs vo",k:"<i>mc ka pF 8j uL EW.</i>",1d:"<i><1b 2V=2l>t7 1bD 15 6N / 6O</1b></i>",jF:"mc x On",jG:"mc x nS",},},},\'de\':{8L:\'2h\',8M:\'nv.1bE\',8N:\'vp\',8O:\'Gv\',8P:\'Gw\',8Q:\'38\',8R:\'pY\',8S:\'5p\',8T:\'3t\',8U:\'kb\',8V:\'Gx\',8W:\'1bF\',8X:\'Gy\',8Y:\'2h\',8Z:\'4y\',91:\'2E\',92:\'Gz\',93:\'x vq\',94:\'5H\',95:\'1bG\',97:"98",99:\'vr\',9a:"p5 vs me ! nV on vt",4I:{9b:"6a:7u/9c;9d,9e+nW/nX/zP/nY/nZ/o0/K+J/o1/o2/o3/o4/o5+o6/o7+Vh+o8/o9/oa/ob/oc+od/oe+og+oh+oi/oj+ol+om+oo/op/oq/os+ot+ov/ow/ox+/oy+oz+/oA+/oB/oC/oD%3D%3D",9f:"3B://9g.9h.3C/9i/oE/",1M:"5V",or:"5d",6b:"1bH",9j:"1G.",9k:"1bI.",6c:"GA ",3E:"vu",9l:"pZ",1S:"im",9m:"vv",9n:"GB vv",9o:"11 is 52 GC",9p:"Es 3u vw 5V 1bJ:",9q:"GD GF",9r:"1bK 1P es in ",9s:"1bL 5V: 5 1bM q0, 1bN pZ",9t:"vv 2O !",1j:"kc",9v:"q1",9w:"kd",1m:"q2",2F:"mf",9x:"2s kb",9y:"x 2s 2B 1bO",3b:"5e",2U:"GG",1n:"2s",9z:"1bP :",1k:"7bÃƒâ€šÃ‚Â¸4z",9A:"2R",9B:"mg",2u:"3v",to:"zu",},9C:{9D:"1bQ 6R",9E:"Du vx vy 3t 1bR, vz du 1bS 3v 1bT 5W",9F:"1bU",9G:\'6R 1bV\',9H:"x 6R - 4i",9I:"vA",9J:"ke GH",9K:"5f ke mh 1bW vB 8n vz q3 1bX 5X 1bY...",9L:"q3 2C",9N:"GI 5Y:",9O:"mj 2s:",9Q:\'4A 2p:\',9R:"1G.",9S:"1N.",9T:"6R 2H:",9U:"1bZ:",9W:"q4 8m(s)",9X:"PR",9Y:"4A",9Z:"BM",a0:"GJ",a1:"3t 5E",a2:"4J",a3:"7B",a4:"# q5",a5:"q3: ",a6:"3w GK",a7:"GJ: ",a8:"q3 5Z 3v q6 60:",aa:"GL vA 3u ",ab:"1N GL vA 3u (tz 74 6 1c0)",ac:"# tq",ae:"*1D 1c1*",af:"1c2",ag:"kf:",ah:"q7 4B vC",},aj:{3H:"1c3 2R",3I:"1c4 zu 1c5 ml. GM: ",3J:"GN:",},ak:{3c:"GO:",ao:"SPÃƒâ€ Ã¢â‚¬â„¢vD",ap:"GP",aq:"1c6",ar:"1c7 GP",av:"1c8",aw:"vp:",at:"4B",hq:"32",1I:"mg:",ax:"1c9..",ay:"1ca 1D",aA:"q8 in",aB:"4B",aC:"GQ 1cb 1Q 1cc",aD:"GQ 1cd",aE:"kg kh",aF:"GR kh 5I",6g:"1ce",1s:"1cf",2w:"vE",5t:"1cg",aG:"GM 5e:",aH:"1ch BW",},3G:{j:"1D kd q9 5d 1ci",6i:"7c",25:"GS",aI:"vF",aJ:"vF + ml",aK:"1cj 4A",aL:"61 GT",aM:"vF GT",7D:"(BY)",aN:"GU q5: ",aO:"2s",aP:"74 2s",aQ:"5E",aR:"x 61",aS:"q8: ",26:"GV GW GX, 1ck GA zu 1cl, um 1cm 1cn zu 1co!",aT:"1cp...",3L:"1cqÃƒÆ’Ã‚Â·1cr",kU:"61 in",aU:"GD 1Q 1cs.!",aV:"1ct 5e-1cu.",6j:"vG",aW:"<1b 2V=2l aX=\'aY\'><b>5V, 1cv 1P es 1cw !<b></1b>",aZ:"vH 3u 2t 23 vI!",kV:"61 3u 1cx",b1:"7c GY 2t mm vI!",b2:"1cy",},7F:{j:"1cz kb 1cA",b3:"1cB: ",b4:"<b><1c>1cC 1P 1cD vJ!<br><br>22 kb GZ H0 H1 .</1c></b>",b5:"<1c>kb 1cE</1c>",b6:"kg H2 1cFÃƒâ€šÃ‚Â¸vK !",},b8:{j:"2R qa fÃƒâ€šÃ‚Â¸r 1cG",k:"Gv tz",3M:"1cH",4l:"1cI",kX:"1cJ",2W:"H3. 5e",b9:"vL.",1M:"5V 1cK qb",vM:"vN",},6k:{j:"3v H4 1cL",ba:"3t",bb:"H5",1B:"1cM",bc:"q7 1r 3t 62 1cN...",bf:"q7 1r 1cO 3e (mn tj H5) 62 3v 7d 1cP...",bg:"C7...",k:"1cQ lG",1W:"kf",1m:"kg 3v H4 H6!",6m:"4j zu H7 ",bi:"1cR 3v :",bj:"qc 1P 4j",26:"q2 1cS !",bk:"qc...",2u:"3v 1cT :",1X:"1cU 1P H7",2w:" H8 1cV : ",bl:"4j H9",bn:"qc... ",},38:{j:"kZ - Ha",bo:"kc an 3t 1l",bp:"kc an 23 1cW 1l",bq:"7e nG an Hb ",bt:"Hc 38 :",},bu:{j:"1cX DY-2O",bv:"2s",bw:"5V",bx:"2s 18 mj",bz:"6G.",bA:"q9",bB:"4y",bC:"1cY",bD:"nU",bE:"qd",bF:"Gz",},4m:{j:"Hd",bG:"1cZ",bH:"1d0",bI:"1d1",bK:"4j",bL:"1d2",bM:"Gw",1t:"1d3",2a:"qe",bN:"1d4",bO:"mo qf im pY :",},2n:{1u:"1d5",k:"1D 5p",1d:"7A 1d6",2b:"1d7 2S qg 5g 2h",2c:"1d8",bP:"1D 8o (in 18 Hf je 2R)",bR:" qg 5g (in 18 Hf je 2R) ",bS:"Hg ",3O:"Hg (2p)",bT:"1d9 (vO)",bU:"7f (vO)",bV:"1da 2p",bW:"1db 2p",bX:" 1dc 19",bY:"ki 18 HÃƒâ€šÃ‚Â¸1dd",bZ:"1de 1df",c0:"1dg",c1:"4y ÃƒÂ¢Ã¢â€šÂ¬Ã‚Â¹1dh",c2:"4y pY",c3:"5Y 2B",c4:"62 ",c5:"q8 ",},1F:{j:"uI 1di 1dj",1u:"3e 18 H2 18 3t",c6:"vP:",c7:"2C",c8:"vQ Hh",c9:"1dk",ca:"Hj	1dl",},4H:{j:"51 4i",cb:"mf kj 2C",cd:"kk mn 1r kj 1dm",cf:"Hk(s) in Hl:",cg:"qh 2B 2R ",k:"qh",1d:"HmÃƒâ€šÃ‚Â¸1dn 1f",2b:"Hd",ch:"1do 1dp",2K:"3o",2e:"qi...",2f:"1p",4L:"21;",3Q:"2s",1Y:"vRÃƒâ€šÃ‚Â¸vS",ci:"Hn",cj:"Ho 1dq",cl:"1C(s) ",cm:"Hp 2S Hq vT 1dr",},cn:{j:"Gx 61",co:"4b 11",cp:"61",6p:"4C",},4N:{1t:"tf",2a:"6q",cq:"no Co Cp in 31!",cs:"5w Cq - oV",ct:"1ds 1dt",2j:"mo",3R:"cu.",3S:"H3.",cv:"StÃƒâ€šÃ‚Â¸qj ml mp",cw:"StÃƒâ€šÃ‚Â¸qj 1du mp",cx:"StÃƒâ€šÃ‚Â¸qj 1dv mp",cy:"StÃƒâ€šÃ‚Â¸qj 1dw mp",cz:"rJ",3T:"4o",cA:"Hr",ts:"5H",3g:"7f",cB:"7f / 5I",cC:"1N. vL.",cD:"vL. 1dx.",cE:"Hs",cF:"Ht",cG:"Hu",},cH:{cI:"Hv",cJ:"1dy",3h:"1dz :",to:"zu",us:"1dA",7I:"1dB",4l:"vU!",2j:"vE:",cK:"1dC:",cL:"1Q Hw:",cM:"kl",cN:"DF",cO:"Ct",cP:"mq qk vV",cQ:"57 58 qk vV",6t:"1dD ql",cR:"1dE ql",4p:"ki",cS:"qf 1dF:",cT:"mr 1dG 2t 1dH 1dI",W:"3w Hx;",1u:"mq qk",cU:"1dJ;",4O:"8p",2g:"mr 1dK 1dL",cV:"pZ 8p 2s",cW:"mq qk",cX:"3w Hx",cY:"&lt;mr 1dM&gt;",cZ:"1dN:",2X:"kf:",d0:"1dO",d1:"ql:",},d2:{d3:"4o",PR:"VP",d4:"kl",7J:"1dP",d5:"3w Hr H6...",19:"2Q",3g:"7f",2c:"vE",d6:"vW 4A",d7:"4A Lv",d8:"Hy Lv",d9:"DF Lv",db:"4A/Hy Lv",1u:"1dQ 1D",k:"vH in 18 kh",dc:"du Hz 3w vH in HA kh",dd:"vX",df:"8q",dg:"2B 3v",dh:"GN",dj:"1dR",dk:"1dS 1D 2C",dl:"qm : Du vx 1dT vz 1r 1D in HA kh 1dU 1dV 5X!",1W:"1dW:",5x:"q2",},2L:{dp:"ke 3v tI",dq:"tI:",4q:"1G.",14:"1N.",dr:"q7 8r tJ...",ds:"<B>tJ :</b> kg kf ! (1dX ?)",dt:"q2",1c:"1dY",1B:"ke 1dZ!",1M:"km:",1X:"vY",W:"X mh vZ 0 2S 3U HB",13:"Y mh vZ 0 2S 3U HB",1v:"lx 5Y w0 ms 60 0 8n...",1w:"5f qn 5Y w0 ms 60 0 8n...",3V:"5f qn 5Y w0 ms 8n 60 lx 5Y...",3W:"5f qn 5Y HC 1Q ms 8n 60 dw, 1e0 mn 1e1 CD 2S 1e2 1r ke ...r",dx:"4i HD/1e3",dy:"1G. 2p:",dz:"1N. 2p:",dA:"kl ",dB:"CE ",dC:"vP ",dD:"mf 1e4",dE:"GR",dF:"HE",dG:"jN",dH:"HF",5y:"8q ",dI:"mf",dJ:"HE",dK:"Im 1e5",dL:"CG 4v",dM:"1e6",dN:"jN",dO:"HF",2x:"HG.",19:"2Q",6y:"2R",dP:"tL",dQ:"vQ Hh",dR:"<dS dT=#dU>qm : kk mn dV 2B",dW:"1e7, HH 1r ke vB.</1b>",2Y:"1e8...",dX:"1e9 62 5C 30",dY:"61",dZ:"7c 3e",1W:"kf:",e0:"1ea ",1j:"1eb =)",e1:\'1ec\',e2:"vU!",e3:"H1 an ",e4:"w1 2t 1ed 1ee",e5:"km : 1P HI 3w 1ef 3w 1eg...",e6:"km : w2 8q",e7:"x 7c",},e8:{j:"1eh tv  DF",25:"57 58",3i:"DF",e9:"qo 1ei",1J:"4i",k:"57 58 61 tL: (kc/mo)",1d:"2R 4i",ea:"2Q",4R:"HG.",eb:"3w GK",ed:"qo fÃƒâ€šÃ‚Â¸r 1r 57 58",ee:"57 58 fÃƒâ€šÃ‚Â¸r CH: ",ef:"57 58 HJÃƒâ€šÃ‚Â¸HK",eg:"HJÃƒâ€šÃ‚Â¸HK",eh:"5V w3",ei:"4C:",ej:"qn GI 5Y:",ek:"HL",em:"q4 8m(s) 1ej",eo:"8b 62 ",ep:"2R Ãƒâ€šÃ‚Â¸1ek 62 ",eq:"1el(n)",eu:"sB:",ev:"5Y",ew:"1em p0",ex:"1en p0",ey:"1eo 7f:",ez:"7d 23 1ep HM",eA:"7d 23 HN HM",eB:"CJ CK:",26:"1Q w4 q4 5I) w5",3L:"1Q w4 w5 7f",2X:"kf:",1B:"1eq HO CL",},7L:{j:"15 1er 1es",3i:"4y",eC:"4y",3E:"1et",1I:"mq qp 1I",3X:"61 4C:",eD:"4y 8p HP -   4C",1x:"HL",eE:"q4 8m(s) w5 1eu",1k:"mg 7bÃƒâ€šÃ‚Â¸4z",eF:"4y 4w - vu",eG:"<BR>sa 4w GZ 1ev um 1ew 1ex um 4y zu H9.<BR>        Er mt qq kl 7d 2 1ey GS, 1ez 2S 8r 1eA vJ .<BR>        1eB 1eC 1eD du Hz 2 1eE 1eF in 1eG 2R.<BR>        1eH 1r qo 1eI, 2S 23 1eJ 2t AN 1eK !.<BR><BR>        (kl q5 (11 eH):<BR>        <A 1I=eI eJ=3B://eK.eL.3C/eM/eN>oZ tO at eO li</a>        <eP eQ=100%><TR><TD>2p</td><TD>63  1</td><TD>63  2</td><TD>ql</td><TD>1eL</td></tr>        <TR><TD>1</td><TD>n/a</td><TD>160 4D</td><TD>12 4D</td><TD>0</td></tr>        <TR><TD>1</td><TD>n/a</td><TD>80 3x</td><TD>3w</td><TD>1+</td></tr>        <TR><TD>2</td><TD>5 4D</td><TD>130 3x</td><TD>1 63</td><TD>2+</td></tr>        <TR><TD>3</td><TD>10 4D</td><TD>eR 3x</td><TD>1 63</td><TD>3+</td></tr>        <TR><TD>4</td><TD>20 4D</td><TD>eS 3x</td><TD>1 63</td><TD>4+</td></tr>        <TR><TD>5</td><TD>50 4D</td><TD>eT 3x</td><TD>1 63</td><TD>6+</td></tr>        <TR><TD>6</td><TD>100 4D</td><TD>eU 3x</td><TD>1 63</td><TD>7+</td></tr>        <TR><TD>7</td><TD>150 4D</td><TD>eV 3x</td><TD>1 63</td><TD>8+</td></tr>        <TR><TD>8</td><TD>eW 4D + 3Y</td><TD>eX 3x + 3Z 40</td><TD>1st 1K + 1 3x</td><TD>9+</td></tr>        <TR><TD>9</td><TD>eY 4D + 3Y</td><TD>eZ 3x + 3Z 40</td><TD>1st 1K + 2 3x</td><TD>10</td></tr>        <TR><TD>10</td><TD>f0 4D + lj</td><TD>f1 3x + f2 4n</td><TD>1st 1K + 6 3x + 50 4n</td><TD>10</td></tr></f3><br><br>",f4:"3w 8q !",f5:"mq qp :",f6:"Hu",a9:"Ht",1K:"63",3H:"1f 2h:",3I:"1f f7",3J:"GF:",f8:"2m 1f f9:",fa:"4s of 1st 3j 1j:",fb:"1eM 3j 1j:",fc:"4y 8p",},3k:{fd:"nv",fe:"1eN",29:"7e",ff:"qd",fg:"ll",fh:"1eO 1P 23 32 2t 1eP 1eQÃƒÂ¯Ã‚Â¬Ã¢â‚¬Å¡en",fi:"4j fÃƒâ€šÃ‚Â¸r 8o 5d 5g 1eR",fj:"qd 4i",fk:"x 2E 1eS",fl:"4C 1eT ",fm:"1eU 5e HR 1eV, 1eW in Hb ÃƒÆ’Ã‚Â·1eX 18 HS ! Er mt 2B 23 HN 18 5e vZ mm 1eY 2S 23 HT w6 + 10 1eZ 1f0 1f1.",fn:"2R ",fo:"8s. HU",fp:"x 2E - 4i",fq:"1f2 HV:",fs:"5B 4i",ft:"ln 1f3",fu:"1f4Ãƒâ€šÃ‚Â¸vK ",fv:"2E qp - 7bÃƒâ€šÃ‚Â¸4z",fw:"kc 1P HW 1f5",fx:"1D lx",fy:"1f6 1f7 ",1x:"8s. HU",fz:"2E",fA:"ln 7bÃƒâ€šÃ‚Â¸4z",fB:"pZ HW",fC:"5B HX:",41:"1f8",42:"1f9",fD:"mu 5W du HY 4j 1fa",fE:"5d mg vC",fF:"(5f qe 18 1fb 3u 8r 8a 18 HZ 1fc)",fG:"5f 1fd 18 4j 1fe:",W:"5f qe HC 1Q q6 60",fH:"kg 3t !",13:"I0 I1 fÃƒâ€šÃ‚Â¸r 23 HZ 4j !",1v:\'qr 2t 1ff w6 !\',1w:"Du 5W 1Q 2t 1r vC 0,0 1fg !",fI:"2E 3u 2t 23 vI ",fJ:"5V, GV GW GX fÃƒâ€šÃ‚Â¸r 23 1fh vJ !",fK:"I2 in 2 I3 !",},7M:{fL:"kd 1fi",j:\'1D 7e kd q9\',fM:"ln 7bÃƒâ€šÃ‚Â¸4z",fN:"qp 2C",6B:"2R :",to:"mg :",fO:"4C :",fP:"1D D1",fQ:"ln 7bÃƒâ€šÃ‚Â¸4z",fR:"1fj 1fk HX ",k:"mu 5W du 1D kd q9",W:"qr zu HR 1fl q6 2B",13:"6A.",fS:"w7 I4...",1Z:"1D 1fm kd 1fn - q8 :",fT:"",},fU:{2i:"1fo",j:"mu 5W du 1D 7e I5",7N:"lp",1J:"vr 1fp:",3X:"4C 18 8o:",fV:"(q1 2S I6 )",fW:"1fq 18 I7 (H8) 1frÃƒÂ¯Ã‚Â¬Ã¢â‚¬Å¡ig, um 1r 1fs-1ft fX 1fu-",fY:"1fv 1fw",k:"<u><b>qg 5g:</b></u> 7e qq mv 2t 1fx 5 zu 1fy.",fZ:"qs 2s 2B I8 8o in Hs :",g1:"GB 8o",W:"km: 1fz, 1r I8 zu w8 8o...<br>w7 I6...",g2:"1fA 1fB",},g3:{j:"qs 3t vq",g4:"yM",g5:"Du vx 1fC vy 3t 8n um I9 4w zu 1fD!",2i:"vq",3M:"7c 3v",g6:"1Q Hq",43:"",g7:"7c ki",g8:"4C",g9:"3t 5E",ga:"1fE Hw",},7Q:{7R:"3v 5E :",2n:"1fF 1fG",1k:"1fHÃƒâ€šÃ‚Â¸4z:",7S:"5d 4A:",},6C:{j:"mu 5W du 1D I5",gb:"# je 8m ",3T:"qg 5g &6D;",1s:"w9 &6D;",W:"ki 18 1D HO Ia 1fI (zu 1fJ > 0)",13:"Ia qe an 5I",1v:"1P wa 1Q 1fK ! (2v ",1w:"7g 1fL 8n.",gc:"1fM 5e ",3V:"wb 1fN Q w9 7g",3W:"km : qr, 8r oR 7g Ib...<br>4b 14 Db 87.",gd:"Ab 1fO 8m 1fP 1r w9 1fQ 5X? (1 = 1fR 8o - mo 5I:a",gf:"1fS 18 1fT 7g... w1 1P 1fU !",gg:"km : qr, 8r oR 7g Ib...",gh:"1fV 18 1D vB.",19:"1fW",gi:"mv 2t 23 1fX",gj:"1fY 2t mm 1fZ",},5H:{1Z:"vU.",gk:"1g0",2q:\'5g 2B \',gl:"1g1 Ic",wc:"Ic",},2q:{2i:"15 1g2",gm:"x 1g3",j:"mu 5W du HY Hj wd 1g4",4U:"wf",k:"wg",ec:"BZ:",gn:"wg",W:"Id 5V !",13:"wh 4zÃƒâ€šÃ‚Â¸1g5 4j!",1v:"Id H0 in 18 7g!",1w:"5g Ie wi: 5g Ie wi: 1g6 1g7 vw 2p 10+ 1g8 zu 1g9! w7 1ga, 5Z 1gb 1gc!",go:"If mt in 10 I3 1gd",gp:"vP 62 1ge",2z:"wg",4U:"1gf:",},gq:{j:"7f 1gg vO 1gh ",gr:"1gi 1gj zu",1Z:"1gk.",},gs:{j:"1f 7d mm 5w 1gl 1gm",44:"oV 2h",k:"oV 4i",1t:"8e",2c:"mo",43:"<i><u>qm :</u> 1G. qh: Ig - pY mt 4B 4b 1gn</u></i>",},2T:{gv:"1go 4B",45:"2O Ha",7T:"Ih",gw:"(wj 1gp Ih 5X 1gq 1gr )",gx:"If 1gs 1gt",6G:"lO 1gu ",gy:"x 4b - 4C ",gz:"1gv ki 2B 4j",gA:"Dj",gB:"1l 1gw",7U:"lO 1gx:",gC:"Dk p7",gD:"p7 Dl 2C",gE:"lu 1gy 2C ",gF:"x 4b 5Z 5C 1 1gz 1Q 1gA 3u",gG:"vu 1gB 7e 2t 18 nF 1gC 1gD ",gH:"1gE 4w",gI:"6Z p8 -",gJ:"4w:",gK:"mw:",gL:"1D 2C",gM:"kk mv",gN:"4j 2C",gO:"I7 2C",gP:"4j mp 2C",3R:"1gF 1D",3S:"1gG 1D 2C",gQ:"ml 1gH wf - 1gI du 1gJ fÃƒâ€šÃ‚Â¸r",gR:"kk tT",gS:"1l-mw:",gT:"1gK Ii mx",gU:"7e 4B 5g 2S Ij 1gL",gV:"5g 2S Ij im 1l 1Q vV",gW:"1l wk 1gM",gX:"wl 1l 1gN (1gO 8q, 1gP tU.)",gY:"FlÃƒâ€šÃ‚Â¸wm 59",wn:"1gQ in Hl 18 Dr",gZ:"59 4B 7c qt",h0:"59 4B qt",wo:"1gR 1P, 5Z Hc 4y 1gSÃƒâ€šÃ‚Â¸1gT 1gU 5X (1gV 1Q zu 1gW 23 8p)",h1:"tV",h2:"FÃƒâ€šÃ‚Â¸1gX wf",h3:"1l-wp:",h4:"1gY wp - l0 1l",h5:"Dt",h7:"<br>>> 1gZÃƒÂ¯Ã‚Â¬Ã¢â‚¬Å¡e: tX <i>mn fÃƒâ€šÃ‚Â¸r 1h0</i>",h9:"mj mw:",hb:"wl 3t mj",hc:"3v 2C mx",hd:"qs 2s 18 mj:",he:"4C:",hf:"1h1 mw:",hg:"Ik 32:",hh:"Ik 1P 32 wd 62 2N",hj:"qc 1P tY wd, 5Z 8r GlÃƒâ€šÃ‚Â¸ck 3u ",hk:"kk 4A Dw in 1h2 4w ",hl:"wl w3",hm:"nI mw:",hn:"1h3 Ii mx ",hp:"59 4B qt (Io 7c 5d kl)",hr:"u0 qb",hs:"59 Dx:",ht:"qb",hu:"1h4:",hv:"1h5",hw:"Dy 1h6",hx:"GH",hy:"Dz 4i:",hz:"1h7 Ip:",hA:"3t 1l 2S/5d",hB:"FlÃƒâ€šÃ‚Â¸1h8",hC:"DB 4B ",hD:"1G. qo: <br><i>(1l p9)",i8:"sa 32 : ",i9:"2t HT w6 : ",hE:"mv:",hF:"1h9:",hG:"7f (1ha pb):",hH:"1hb:",hI:"rJ ml:",hJ:"32 4A 1Q 2C:",hK:"vY 4B qt:",hL:"kc pc:",hM:"4o pb",hN:"vW 1D",hO:"kh",hP:"8b-vr",hQ:"vW mv",hR:"1hc 1r wp",hS:"mx 1P w8 kb 8p 1hd im 1he",wq:"8q HS Ãƒâ€šÃ‚Â¸wr 18 1D 1hf 2C",hT:"Iq Ir 11 70 pd, 11 70 pe, 11 hU hV - 5C pf...<br>I0 I1 Io an 74 1hg, 1r 1hh 1hi 1hj<br>Iq Ir 18 lP : hW,7V,hX,hY,hZ)",i0:"qd",i1:"2B 1hk",i2:"2B Hv",i4:"qq Ip 1hl, 5Z 1hm 1hn 29 vp",i3:"51 2A:",i5:"lJ ph/pi ly (pj 2l X)",i6:"1ho 1P 23 59 2B tV i7",ia:"mx 1P 1r 1hp",ib:"2s 1P 1r 1hq w3 Ãƒâ€šÃ‚Â¸wr q5 HD I9 8q",ic:"pl lM:",id:"lQ 8d lR of lS (6S 2N 5K lT)",},3l:{46:"Gy",47:"x It",6H:"2C",1J:"ws - 4i",7W:" tY q1:",1k:\'7bÃƒâ€šÃ‚Â¸4z\',44:\'1D vT It\',7X:\'qs HV 1hr\',2U:\'ws Iu  GG\',1n:\'ws Iu 2s\',},3m:{45:"7Y 4i",1X:"4x vY",6s:"4x 1hs",1n:"4x 2s",ie:" 8p HP -   4C ",ih:"7Y 8b u4",1m:"3w 1ht 4x im 2R Iv",7Z:"GC 4x",ii:"GU 4x",ij:"3w 1hu 4x im 2R Iv",},ik:{6I:"qf:",},io:{46:"tB",4X:"oS",ip:"2s",6J:"wt",1p:"1p/21",2h:" qa ",6K:" 21 ",19:"1p",5v:" vRÃƒâ€šÃ‚Â¸vS ",iq:" 1hv ",ir:{j:"15-81 : 1hw 56 jO\\\'S",iu:"1hx 1hy:",iv:"Iw:",iw:" 2S q6",ix:"1hz 1hA",iy:"1hB 18 4A, 5Z 8r 1hC 1hD 3u",iz:"1hE 1P 1r wk:",3n:"1hF",iA:"Ix 3h:",iB:"1hG 1hH",iC:"FÃƒÆ’Ã‚Â¼4z 1P qq Iy",iD:"qb ...",iE:"5f 1hI 74 wk wrÃƒÆ’Ã‚Â¼1hJ",3O:"1hK",5D:"1hL",2Z:"kj:",iF:"Iz mh",iG:"3w Iz mh",14:"2S",iH:"in 23 2Z:",iI:"1hM w8",41:"1hN 1hO",42:"1hP Ix IAÃƒÆ’Ã‚Â¼1hQ 1r 1hR.  1hS HH 1hT nÃƒÆ’Ã‚Â¤IB PrÃƒÆ’Ã‚Â¼1hU.",iJ:"5f 1hV GY 1hW 18 lz",iK:"wj wu wa 1Q vG 5X ",iL:"wj wu wa 1Q vG 5X",iO:"5f LÃƒÆ’Ã‚Â¶1hX 3u zu 1hY. w1 1P 2t 23 nÃƒÆ’Ã‚Â¤IB 1hZ.",iP:"1i0:",iQ:"1i1",iR:"1i2 4A",iT:"1i3 2B 8f:",},iU:{j:"2s 18 51 1f ",iV:" 1f 62 wv 1i4 ",iW:"IC 4Y 7d vy ID ",iX:"5d ms ",iY:" IC 4Y 1i5",iZ:"1i6",j0:"4Y 1i7 GO :",j1:"Iw,74 1i8 7d 3 1i9 kj",j2:\' 8s. 1 2B 23 qu 3 wv\',j3:\' 8s. 1 2B 23 qu 2 wv\',j4:\' 8s. vQ Hk\',j5:\' 8s. 1r qu 2 kj\',j6:\' 8s. 1r qu 3 kj\',j7:"<u>qm:</u><br>1f 1r HmÃƒâ€šÃ‚Â¸IE, Hp 5d vw 1ia ID 60 +0 HI 5X 1Q wi!",1t:"q1",2a:"1ib",48:" 8e 1ic s4",49:"5e",4a:"vX",j8:"kk qv, 1r 1id 5X",2N:"DM",j9:"mr qv mt 1ie.",jb:"1if zu IF, I4 1ig ",jc:"oM 18 1ih",jd:"IF 1ii :(",},2f:{j:"IG 1p/21/3o qw",k:"8e fÃƒâ€šÃ‚Â¸r 1p 5d 21 7bÃƒâ€šÃ‚Â¸4z",16:"51 1f:",1d:"51 qa",2b:"7g",2g:"Ho 8e in 18 7g !",6P:"1ij 2t u4...",jf:"q0: ",jg:"I2 18",jh:"wb 4Z.: ",85:"w2 4Z.: ",ji:"1Q IH: 1p 2S 21 qw 3u 1ik;.",1m:" mr qv in 18 Iy!",jj:" 1il 7d mm 1im 8e...",jk:"Du 5W II IJ 60 2p 10 IM !",jl:"Du 5W II IJ 60 1r 1in 1io 10 IM !",48:"qv 3e -1p/21- 1ip",49:"5e",jm:"5E",4a:"vX",jn:"q0",jo:"wb 4Z.",jp:"w2 4Z.",jq:"1Q w4 qh in 2R ",jr:"6O IO ",js:"6N IO ",jt:"1iq",2e:"qi: ",ju:" 1ir 5e: ",jv:" 1is ",jw:"1it",jx:" ki 18 q0:",jy:"<i>(1iu 1iv er vT 1iw wu)</i>",4u:"1ix",},1Y:{j:"56 IPÃƒâ€šÃ‚Â¸IQ ",1Y:" vRÃƒâ€šÃ‚Â¸vS ",jz:"Hn",4W:"86:",2g:"kg 1C ",jA:"IAÃƒâ€šÃ‚Â¸vK 1C :(",jB:" 1C 1iyÃƒâ€šÃ‚Â¸IE!!!",jC:"86 1iz 1iA:",jD:"DT:",k:" BF 1iB nR",},jE:{j:" 56 IPÃƒâ€šÃ‚Â¸IQ ",47:"qf:",},2K:{W:"1Q IH: x 3o 3u am 1iC.",13:"wh IR 5Z du 1r 1p/21 qw IS.",2e:"1iD 2t 1iE...",j:"IG qi",k:"<i>mf 1iF 1f 7e qi</i>",1d:"<i><1b 2V=2l>wh IR 5Z du 1r 1p/21 qw IS</1b></i>",jF:"wt An",jG:"wt 1iG",},},},\'tr\':{8L:\'64\',8M:\'5h\',8N:\'1iH\',8O:\'1iI\',8P:\'IT\',8Q:\'1iJ\',8R:\'1iK\',8S:\'1iL\',8T:\'my\',8U:\'IU\',8V:\'1iM\',8W:\'GEÃƒâ€¡IV\',8X:\'IW\',8Y:\'ww\',8Z:\'qx\',91:\'kn\',92:\'1iN\',93:\'IX\',94:\'qy\',95:\'1iO\',97:"1iP",99:\'1iQ\',9a:"p5 vs me ! nV on vt",4I:{9b:"6a:7u/9c;9d,9e+nW/nX/zP/nY/nZ/o0/K+J/o1/o2/o3/o4/o5+o6/o7+Vh+o8/o9/oa/ob/oc+od/oe+og+oh+oi/oj+ol+om+oo/op/oq/os+ot+ov/ow/ox+/oy+oz+/oA+/oB/oC/oD%3D%3D",9f:"3B://9g.9h.3C/9i/oE/",1M:"wx",or:"IY",6b:"1iR",9j:"1iS",9k:"1iT",6c:"IZ ",3E:"mz",9l:"1iU",1S:"in",9m:"GÃƒÅ“1iV",9n:"GÃƒÅ“1iW Ãƒâ€¡IK",9o:"2O qz YÃƒÅ“1iX..1iY 1iZ qA J0",9p:"1j0 7h 1j1 qB:",9q:"1j2 SÃƒÅ“RE",9r:"1j3 ",9s:"5 1j4 J1 7h 1j5",9t:"1j6 GÃƒÅ“1j7 1j8 !",1j:"54",9v:"1j9",9w:"1ja",1m:"hiÃƒÂ§ko 1jb",2F:"TÃƒÂ¼m",9x:"1jc kp ET",9y:"J2 1jd J3",3b:"7i",2U:"DÃƒÅ“1je",1n:"kp",9z:"J4 7i :",1k:"4E 8t",9A:"1jf",9B:"1jg",2u:"ÃƒÅ“wy",to:"iÃƒÂ§in",},9C:{9D:"7j sÃƒÂ¶mÃƒÂ¼kq (1jh 1ji 1jj",9E:"1jk 1jl 1jm qC ko 1jn ÃƒÂ¼ye 1jo wz",9F:"SÃƒÂ¶mÃƒÂ¼kq",9G:\'sÃƒÂ¶mÃƒÂ¼kq qa\',9H:"7j sÃƒÂ¶mÃƒÂ¼kq - 1jp",9I:"1jq",9J:"J5 qD",9K:"sÃƒÂ¶mÃƒÂ¼J6 gÃƒÂ¶1jr qC J7 sÃƒÂ¼1js 1jt J8 wz...",9L:"sÃƒÂ¶mÃƒÂ¼J6 gÃƒÂ¶wm",9N:"J7 1ju:",9O:"1jv wA:",9Q:\'1jw 1jx:\',9R:"1G.",9S:"1N.",9T:"1jy:",9U:"IÃƒÂ§J9 1jz 1jA 1jB 1jC",9W:"",9X:"PR",9Y:"Ja",9Z:"1jD",a0:"Jb Jc",a1:"1jE 1jF",a2:"4J",a3:"7B",a4:"# 1jG",a5:"sÃƒÂ¶mÃƒÂ¼kq: ",a6:"6a Jd",a7:"Jb Jc: ",a8:"gÃƒÂ¼1jH Je 1jI 1jJ sÃƒÂ¶mÃƒÂ¼kq qC ls.:",aa:"",ab:"yP (1jK 6 1jL ko qD)",ac:"# tq",ae:"*sÃƒÂ¶mÃƒÂ¼1jM qC Jf ls*",af:"1jN",ag:"1jO:",ah:"az 1jP",},aj:{3H:"wB Bu",3I:"1jQ 1jR. wC : ",3J:"ÃƒÅ“1jS :",},ak:{3c:"5h TÃƒÂ¼rÃƒÂ¼ :",ao:"rR",ap:"Jg",aq:"1jT",ar:"TS",av:"1jU",aw:"qE:",at:"a",hq:"QG",1I:"1jV :",ax:"wB ElÃƒÂ§1jW wD",ay:"1jX",aA:"1jY",aB:"a",aC:"1jZ ÃƒÂ§1k0",aD:"1k1 1k2",aE:"BÃƒÂ¼yÃƒÂ¼1k3ÃƒÂ§Jh 1k4",aF:"wB ElÃƒÂ§1k5 Su 1k6",6g:"BÃƒÅ“YÃƒÅ“1k7Ãƒâ€¡1k8",1s:"mA",2w:"mB",5t:"1k9",aG:"wC sÃƒÂ¼re :",aH:"kr",},3G:{j:"3y 7k 1RÃƒÅ“SÃƒÅ“",6i:"1ka",25:"5h",aI:"wE",aJ:"wE + kn",aK:"En 1kb Ji",aL:"5h Jj",aM:"wE Jj",7D:"(1kc GÃƒâ€“RE)",aN:"SEÃƒâ€¡wF: ",aO:"65",aP:"TÃƒÅ“MÃƒÅ“NÃƒÅ“ 65",aQ:"4E 8t",aR:"1y 1kd 3y",aS:"5h 1ke: ",26:"1kf 1kg 1kh 1ki Jk 1kj 1kk!",aT:"3y Jl...",3L:"MÃƒÅ“MKÃƒÅ“N wG",kU:"3y Jl",aU:"iÃƒâ€¡wH Jm Jn 1kl 1km Jo, 8u 1knÃƒâ€¡1ko.!",aV:"Jp 7i 1kp.",6j:"1kq",aW:"<1b 2V=2l aX=\'aY\'><b>7h, LÃƒÅ“1kr mC Jq !<b></1b>",aZ:"wI GÃƒâ€“Jr",b1:"ks GÃƒâ€“Jr!",b2:"1ks",},7F:{j:"8v 1kt Js Jt 7k",b3:"IU: ",b4:"<b><1c>1ku 1kv!<br><br>22 Ju 1kw gÃƒÂ¶1kx .</1c></b>",b5:"<1c>Ju gÃƒÂ¶1ky</1c>",b6:"1kzÃƒÂ¼z ÃƒÂ¼ye !",},b8:{j:"(Jv 7k) - NÃƒÅ“Jw, ÃƒÅ“Jx ve wJ Jy 1kA Jz",k:"Jv 1kB",3M:"1kCÃƒÂ§",4l:"1kD",kX:"wC sÃƒÂ¼re",2W:"1kE 1kF",b9:"8w 1kG NÃƒÂ¼wK.",1M:"YÃƒÂ¼1kH 1kI",vM:"vN",},6k:{j:"JA wL 1kJ 7k",ba:"my ÃƒÂ¼1kK",bb:"1kL",1B:"1kM",bc:"8v ÃƒÅ“JB JC...",bf:"1kN JC...",bg:"1kO 1kP 1kQ...",k:"1kR qFÃƒâ€¡1kS",1W:"8w",1m:"qFÃƒâ€¡ JD!",6m:"wL 1kT wM iÃƒâ€¡1kU ",bi:"ÃƒÅ“JB wN 1kV SEÃƒâ€¡iN :",bj:"wL wO ET",26:"HiÃƒâ€¡1kW SEÃƒâ€¡1kX !",bk:"8u JF...",2u:"ÃƒÅ“YE/1kY :",1X:"wO kp qB",2w:" 1kZ 1l0 wP : ",bl:"8u kt mD",bn:"wO 1l1.1l2 wQ... ",},38:{j:"1y qG - ku",bo:"8v 1l3 GÃƒâ€“JG",bp:"1l4 GÃƒâ€“JG",bq:"1y 1l5 GÃƒâ€“JH SÃƒÅ“JI ",bt:"1l6 :",},bu:{j:"1l7 1l8- GEÃƒâ€¡IV 2O",bv:"TÃƒÂ¼mÃƒÂ¼nÃƒÂ¼ wA",bw:"wx",bx:"1l9 J3",bz:"7j kn",bA:"7j qH 1la",bB:"7j qy",bC:"qE",bD:"qI wR",bE:"wS",bF:"7j JJ",},4m:{j:"1lb Ãƒâ€“JK",bG:"ww",bH:"1lc",bI:"1ld 1le",bK:"1lf",bL:"1lg",bM:"IT",1t:"1lh",2a:"1li",bN:"1lj",bO:"mB :",},2n:{1u:"EK 1lk",k:"64 1ll",1d:"1lm 7l Jz",2b:"mA ve kr 1ln wT 1lo",2c:"8w",bP:"JL JM mE 1lp MÃƒÂ¼mkÃƒÂ¼ndÃƒÂ¼r",bR:" JL JM mE 1lq MÃƒÂ¼mkÃƒÂ¼ndÃƒÂ¼r ",bS:"1lr JN ",3O:"1ls 8w wD",bT:"JO 1lt",bU:"JO wD:",bV:"1lu JP",bW:"AtÃƒâ€“1lv 1lw",bX:" 1lx JP",bY:"1lyÃƒÂ¼be JN",bZ:"8x 1lz",c0:"1lA 1lB",c1:"1lC 1lD 1lE iÃƒâ€¡iN 1lF 1lG ve MÃƒÅ“HÃƒÅ“1lH JQ",c2:"1lI",c3:"Bu 1lJ",c4:"JR ",c5:"1lK 1lL ",},1F:{j:"8v 1lM 5i",1u:"JS 1lN JT",c6:"1lO:",c7:"1lP JT",c8:"1lQ nl",c9:"1lR",ca:"1lS ÃƒÅ“wy",},4H:{j:"kv kw Ãƒâ€“1lT 64 kx",cb:"Ãƒâ€“1lU BÃƒÅ“TÃƒÅ“N AÃƒâ€¡IK 8y Ãƒâ€“JU GÃƒâ€“qJ",cd:"8z JV Ãƒâ€“JW GÃƒâ€“qJ",cf:"SEÃƒâ€¡1lV Ãƒâ€“1lW JX JY JZ:",cg:"qK SEÃƒâ€¡1lX ",k:"K0 qL wU 1lY",1d:"wV 8y Ãƒâ€“1lZ",2b:"1m0 8y kv kw Ãƒâ€“JK",ch:"1m1 YÃƒâ€“N",2K:"8z",2e:"K1 JF...",2f:"YÃƒÅ“1m2",4L:"1m3;",3Q:"65",1Y:"qM",ci:"Ãƒâ€¡K2",cj:"Jn wG",cl:"Ãƒâ€“ge",cm:"1m4 1m5",},cn:{j:"1m6 3y 1RÃƒÅ“SÃƒÅ“ SEÃƒâ€¡wW",co:"GÃƒÂ¼1m7 11",cp:"1m8 5h",6p:"sÃƒÂ¼re",},4N:{1t:"ky",2a:"GÃƒâ€“1m9",cq:"BU K3 K4 K5 kz!",cs:"K4 K5",ct:"EN qN AÃƒâ€¡IK 1ma 7i",2j:"mB",3R:"1mb.",3S:"K6.",cv:"qO 1mc ÃƒÅ“qP",cw:"qO 1md ÃƒÅ“qP",cx:"qO 1me ÃƒÅ“qP",cy:"qO 1mf ÃƒÅ“qP",cz:"1mg",3T:"mF",cA:"1mh",ts:"qy",3g:"SÃƒÂ¶K7",cB:"wX SÃƒÂ¶K7/IÃƒÂ§J9 1mi",cC:"1mj NÃƒÂ¼wK",cD:"GÃƒÂ¼1mk NÃƒÂ¼wK.",cE:"IsÃƒÂ§1ml",cF:"K8",cG:"wX",},cH:{cI:"1mm",cJ:"1mn",3h:"IÃƒÂ§1mo :",to:"1mp",us:"1mq",7I:"1mr",4l:"1ms 1mt 1mu!",2j:"mB:",cK:"IÃƒÂ§1mv:",cL:"1mw:",cM:"qy",cN:"1mx",cO:"1myÃƒÂ¶1mz",cP:"8w K9ÃƒÂ§1mA GÃƒâ€“36",cQ:"1mB",6t:"1mC 1mD",cR:"DÃƒÂ¼1mE 1mF",4p:"Ka",cS:"1mG K8:",cT:"HiÃƒÂ§ mE 1mH 7m",W:"Kb 1mI;",1u:"5h ww 1mJ 1mK",cU:"1mL qE Ãƒâ€“Kc;",4O:"Kb",2g:"qE Ãƒâ€“Kc 1mM",cV:"1mN 1mO 1mP",cW:"30 lK",cX:"No tG",cY:"&lt;Cw&gt;",cZ:"K9ÃƒÂ§1mQ:",2X:"1mR:",d0:"1mS",d1:"1mT:",},d2:{d3:"kr",PR:"iÃƒâ€¡TM.1mU",d4:"Kd",7J:"1mV",d5:"1mW 1mX 7m...",19:"qQ",3g:"SÃƒâ€“1mY",2c:"mB",d6:"mG 1mZ",d7:"qK\\7l",d8:"qR qQ",d9:"Ke qQ",db:"qK\\qR qQ",1u:"wI 1n0 1n1 ve wY 1RÃƒÅ“SÃƒÅ“",k:"wI mH GÃƒâ€“Kf 1n2 JQ",dc:"Kg 1n3 7m",dd:"ky",df:"mI",dg:"GÃƒâ€“1n4",dh:"1n5",dj:"Kh 1n6",dk:"1n7 mA 1n8 GÃƒâ€“36",dl:"1n9 : 1na 11 1nb elÃƒÂ§Jh wZ gÃƒÂ¶1nc iÃƒÂ§in!",1W:"x0:",5x:"JD",},2L:{dp:"Kj Kk",dq:"Kl:",4q:"1nd",14:"VE",dr:"Kj Kk...",ds:"<B>1ne :</b> 1nf ! (1ng Km ?)",dt:"7m",1c:"1nh",1B:"x1 kp qB!",1M:"7h:",1X:"1ni Kn",W:"X Ko EN AZ 0 Kp 3U A x2 8y qS Kq",13:"Y Ko EN AZ 0 Kp 3U A x2 8y qS Kq",1v:"qT 8x Kr 0 1nj BÃƒÅ“YÃƒÅ“K x3...",1w:"kA 8x Kr 1 23 BÃƒÅ“YÃƒÅ“K x3...",3V:"kA 8x qT 1nk Ks x3...",3W:"kA 8x dw i GEÃƒâ€¡1nl.1nm 1nn 1no Ãƒâ€¡Ãƒâ€“1np 1nq 1nr ...r",dx:"1ns 1nt qU x1 SEÃƒâ€¡Kt 1nu",dy:"qT 7l:",dz:"kA 7l:",dA:"1nv ",dB:"SEÃƒâ€¡iM ",dC:"1nw ",dD:"TÃƒÅ“MÃƒÅ“",dE:"Ku",dF:"DÃƒÅ“1nx",dG:"Kv",dH:"1ny",5y:"mI ",dI:"TÃƒÅ“M 1nz",dJ:"qV DÃƒÅ“1nA",dK:"qV 1nB",dL:"qV MÃƒÅ“1nC",dM:"1nD",dN:"Kv",dO:"1nE",2x:"8x",19:"7l",6y:"Kl",dP:"ky",dQ:"qN 1nF 1nG",dR:"<dS dT=#dU>71 : BU 1RÃƒÅ“DE kA dV qFÃƒâ€¡ GÃƒâ€“RÃƒÅ“NTÃƒÅ“1nH",dW:"x1 1nI qFÃƒâ€¡1nJ GÃƒâ€“36.</1b>",2Y:"Ku...",dX:"1nK 1nL",dY:"3y",dZ:"ks qW",1W:"x0:",e0:"qX SEÃƒâ€¡ ",1j:"GÃƒâ€“1nM =)",e1:\'1nN\',e2:"kt 1nO!",e3:"GÃƒâ€“Kf ",e4:"iÃƒâ€¡wH 1nP 1nQ qY",e5:"7h : HiÃƒâ€¡ 66 mI SEÃƒâ€¡1nR...",e6:"7h : Jp mI",e7:"1y ks GÃƒâ€“JH 1RÃƒÅ“SÃƒÅ“",},e8:{j:"1y 1nS 1nT Kw 5i",25:"qI wR",3i:"qI",e9:"Kx",1J:"1nU",k:"x4 Ky: (GÃƒÂ¶1nV / 8w)",1d:"Ke 7l x5",ea:"qZ",4R:"4R",eb:"4E 7m",ed:"Kz",ee:"KA qI wR: ",ef:"KA",eg:"x6",eh:"1nW x7",ei:"3y 1nX KB:",ej:"1nY kA 8x:",ek:"qS",em:"(1nZ 1o0 x8 Jm 1o1 1o2)",eo:"x9 KC 66 1o3",ep:"1o4 ",eq:"1o5",eu:"3y 1o6:",ev:"mJ EN 1o7",ew:"mJ KD KE",ex:"mJ KF KE",ey:"xa x5:",ez:"mJ KF KG",eA:"mJ KD KG",eB:"xb:",26:"x8 1o8 KH",3L:"xa KH",2X:"x0:",1B:"1o9 1oa kp qB",},7L:{j:"1y Kd KI 5i",3i:"qx",eC:"qx",3E:"mz",1I:"KJ 1ob",3X:"3y kB KB:",eD:"KK KL 1oc kB",1x:"x8 1od 1oe wM 1of",eE:"1og",1k:"4E 8t",eF:"KM r0 1oh - 6W",eG:"<BR>qx 1oi sÃƒÂ¼1oj ve KN ko r1 r0.<BR>        O, 2 1ok r0 ÃƒÂ§ok 1ol r1 1om ve KO 1on .<BR>        KP 1oo 1op ko r1 iÃƒÂ§in 1oq iÃƒÂ§KQ 1 ÃƒÂ¼1or 1H 1os 1ot.<BR>        mE r1 KR ve wZ 1ou ve ON 1ov !.<BR><BR>        KS xc (11 eH):<BR>        <A 1I=eI eJ=3B://eK.eL.3C/eM/eN>1ow Je 1ox eO li</a>        <eP eQ=100%><TR><TD>qZ</td><TD>Ãƒâ€“ncÃƒÂ¼ 5h</td><TD>1oy 5h</td><TD>1oz</td><TD>1G. 1oA</td></tr>        <TR><TD>1</td><TD>n/a</td><TD>160 4F</td><TD>12 4F</td><TD>0</td></tr>        <TR><TD>1</td><TD>n/a</td><TD>80 OkÃƒÂ§u</td><TD>7m</td><TD>1+</td></tr>        <TR><TD>2</td><TD>5 4F</td><TD>130 OkÃƒÂ§u</td><TD>Ãƒâ€“ncÃƒÂ¼ 67 ve</td><TD>2+</td></tr>        <TR><TD>3</td><TD>10 4F</td><TD>eR OkÃƒÂ§u</td><TD>Ãƒâ€“ncÃƒÂ¼ 67 ve</td><TD>3+</td></tr>        <TR><TD>4</td><TD>20 4F</td><TD>eS OkÃƒÂ§u</td><TD>Ãƒâ€“ncÃƒÂ¼ 67 ve</td><TD>4+</td></tr>        <TR><TD>5</td><TD>50 4F</td><TD>eT OkÃƒÂ§u</td><TD>Ãƒâ€“ncÃƒÂ¼ 67 ve</td><TD>6+</td></tr>        <TR><TD>6</td><TD>100 4F</td><TD>eU OkÃƒÂ§u</td><TD>Ãƒâ€“ncÃƒÂ¼ 67 ve</td><TD>7+</td></tr>        <TR><TD>7</td><TD>150 4F</td><TD>eV OkÃƒÂ§u</td><TD>Ãƒâ€“ncÃƒÂ¼ 67 ve</td><TD>8+</td></tr>        <TR><TD>8</td><TD>eW 4F + 3Y</td><TD>eX OkÃƒÂ§u + 3Z 40</td><TD>Ãƒâ€“ncÃƒÂ¼ 67 ve + 1 OkÃƒÂ§u</td><TD>9+</td></tr>        <TR><TD>9</td><TD>eY 4F + 3Y</td><TD>eZ OkÃƒÂ§u + 3Z 40</td><TD>Ãƒâ€“ncÃƒÂ¼ 67 ve + 2 OkÃƒÂ§u</td><TD>10</td></tr>        <TR><TD>10</td><TD>f0 4F + 1oB</td><TD>f1 OkÃƒÂ§u + f2 KT</td><TD>1Ãƒâ€“ncÃƒÂ¼ 67 ve + 6 OkÃƒÂ§u + 50 KT</td><TD>10</td></tr></f3><br><br>",f4:"mI 1oC 1oD !",f5:"KM 1oE 1oF :",f6:"1oG",a9:"1oH",1K:"5h",3H:"1f 2h:",3I:"1f f7",3J:"tP:",f8:"2m 1f f9:",fa:"4s of 1st 3j 1j:",fb:"4s of lk 3j 1j:",fc:"6W lL",},3k:{fd:"kn",fe:"wS",29:"mK-7n",ff:"1oI",fg:"r2 7n",fh:"TÃƒÂ¼m 1oJ HQ 1oK",fi:"1y 1oL 5i",fj:"x4 1oM",fk:"1y 1oN",fl:"J2 1oO ",fm:"qz Ãƒâ€“1oP 1oQ.! 1oR Ki..! 1oS 1y 7i 1oT +10 xd 1oU 1oV.",fn:"wS 1oW Ji ",fo:"1oX 1oY 1oZ",fp:"1y 7n 5i",fq:"1p0 1p1:",fs:"7n VE KU kB 1p2",ft:"1p3 1p4",fu:"1p5 ",fv:"7n r3 1p6 5i",fw:"kn ve 1p7 KV 1p8",fx:"En az 1p9 1pa 1pb",fy:"1pc 1pd ",1x:"1pe xe wP",fz:"kn",fA:"4E 8t",fB:"r2-wU",fC:"1pf r4 1pg:",41:"xf",42:"1ph",fD:"r2 7n 5i",fE:"wN 1pi",fF:"(1pj 1pk 1pl xg xh 8y 1pm 1pn)",fG:"1po wP:",W:"1pp 1pq",fH:"1pr JS !",13:"xg xh wQ 1ps 1pt !",1v:\'1pu!! J1 1pv 7n KW KX !\',1w:"0.0 1pw 7n r3 KW KX !",fI:"xg r4 ",fJ:"7h.!! 1px mC Jq !",fK:"KY.! vD 1py 1pz 66 qA J0 !",},7M:{fL:"qH 1pA",j:\'1y qA KZ 5i\',fM:"4E 8t",fN:"KJ 1pB",6B:"Jk :",to:"JR :",fO:"qH 1pC KV 1pD 1pE :",fP:"1pF 1pG 1pH",fQ:"4E 8t",fR:"1pI 1pJ ",k:"r2 qA KZ 5i",W:"xi KO 1pK 1pL",13:"6A.",fS:"LÃƒÂ¼xj 1pM...",1Z:"qH 1pN 1pO 1pP - SÃƒÅ“RE :",fT:"",},fU:{2i:"7j L0",j:"7j L0 Kz",7N:"DÃƒâ€“SE:",1J:"xb:",3X:"r5 x9 KC mK-wJ KU 1pQ JJ:",fV:"(mC 1pR xf 1pS )",fW:"1y mH 1pT 1pU wJ 1pV 1pW. -Kx 1G- ",fY:"mK 1pX",k:"<u><b>mF xk xl:</b></u> 5 ER 1pY 1pZ Ki 1q0 1q1.",fZ:"1q2 8y vD 1q3 1q4 qN 1q5 L1 :",g1:"qU xf 1q6",W:"7h: xi L2 1q7 xm xn iÃƒÂ§in...<br>1q8 lÃƒÂ¼xj...",g2:"1q9 1qa",},g3:{j:"1y ks Jt 5i",g4:"1qb",g5:"Bu ÃƒÂ¶1qc 1qd iÃƒÂ§in ko my J8 wz!",2i:"IX",3M:"1qe ÃƒÅ“wy",g6:"xo",43:"",g7:"ks x7",g8:"wT GÃƒÂ¶1qf",g9:"my qD",ga:"my 1qg",},7Q:{7R:"1qh qD :",2n:"Ek 1qi",1k:"1qj:",7S:"IY Ja:",},6C:{j:"L3 L4 & mF xk xl",gb:"# 1qk Jf xc ",3T:"mF xk xl ",1s:"L3 L4 ",W:"1ql mL 1qm wZ xc (1qn ÃƒÂ¼1qo > 0)",13:"1qp 1qq 1qr",1v:"KP 1qs 1qt ! (1qu ",1w:"1qv 1qw mL.",gc:"1qx 1qy ",3V:"1qz mL 1qA xm",3W:"K6 mL xm xn xi...<br>1qB ve J5 1qC.",gd:"1qD xn 1qE 1qF mEÃƒÂ§ok L5? (1 = 1qG L5 - 8w 1qH:a",gf:"wX L2 mL 1qI... 1qJ IÃƒâ€¡IN 1qKÃƒÅ“R 1qL !",gg:"39 : 1o to 1B q 2W 2z...",gh:"1qM 1qN 1qO.",19:"qZ",gi:"1qP mF",gj:"1qQ 1qR",},5H:{1Z:"kt mD.",gk:"Df",2q:\'1qS \',gl:"L6 KS TÃƒÂ¼rÃƒÂ¼",wc:"L6 1qT",},2q:{2i:"L7 et",gm:"L7 et",j:"mK 1qU ET - ku",4U:"L8-L9",k:"4T 6E",ec:"Qu:",gn:"mK 1qV SEÃƒâ€¡wW",W:"wx Jd !",13:"1qW 1qX!",1v:"1qY 1qZ 1r0!",1w:"1r1 ÃƒÂ¶ge 1r2: qZ 10 1r3 ÃƒÂ§1r4 + 1r5! Bu 1r6 lÃƒÂ¼xj 1r7!",go:"1r8 10 1r9 iÃƒÂ§KQ 1ra Lb",gp:"1rb 1rc",2z:"L8 L9",4U:"1rd 1re:",},gq:{j:"xa 1rf xp 1rg ",gr:"1rh 1ri 1rj",1Z:"mD.",},gs:{j:"JA 1rk ve ÃƒÅ“1rl 1RÃƒÅ“SÃƒÅ“",44:"64 kx",k:"SEÃƒâ€¡wF",1t:"Ka IÃƒÂ§1rm",2c:"1rn",43:"<i><u>Ãƒâ€“1ro :</u> Bu Ãƒâ€“1rp Ãƒâ€¡1rq IÃƒÂ§in; En Az Ig(1rr) qL wU 1rs 1rt.!</u></i>",},2T:{gv:"1ru",45:"1rv 2O",7T:"qz Lc 1rw",gw:"(1rx 1ry de 1rz Lb )",gx:"Ld,1rA 1rB 1rC",6G:"Ld,1RÃƒÅ“ VE 1rD %10 1rE 1rF 1rG 1rH ",gy:"r5 1rI xd DA 66 mC Lf ",gz:"64 1rJ 1rK 1rL 1rM",gA:"1rN 1rO",gB:"mM 1rP 1rQ 1rR 1rS",7U:"1RÃƒÅ“ YÃƒÅ“1rT Lg:",gC:"1rU 1rV",gD:"qU 1rW 1rX Lh GÃƒâ€“RÃƒÅ“NTÃƒÅ“1rY",gE:"1rZ 1s0 GÃƒâ€“qJ ",gF:"qz Ãƒâ€¡1s1 1s2 66 xd iÃƒâ€¡1s3 mC Lf",gG:"r4 1s4 VE 1s5 64 mz xq L1 1s6",gH:"1s7 1RÃƒÅ“:(r5 1s8 1s9 1sa.)",gI:"6Z p8 -",gJ:"4w:",gK:"1sb ku:",gL:"1sc GÃƒâ€“36",gM:"kr 1sd GÃƒâ€“36",gN:"wQ xr GÃƒâ€“36",gO:"NÃƒÅ“Jw xr GÃƒâ€“36",gP:"ÃƒÅ“Jx xr GÃƒâ€“36",3R:"YÃƒÅ“RÃƒÅ“YÃƒÅ“1se 1sf GÃƒâ€“1sg",3S:"1sh,1si Li mA VE 1sj GÃƒâ€“qJ",gQ:"1sk 1sl 1sm 1sn xs 1so 1sp 1sq JX 1sr 1ss",gR:"tT GÃƒâ€“36",gS:"1su 1sv ku:",gT:"1sw 1sx 1sy qG mH Lj",gU:"mz Lk 1y Lj",gV:"1sz mz Lk mM 1sA 1sB",gW:"mM Ll Lm 1sC",gX:"1sD mM Ll Ãƒâ€“JU 1sE",gY:"1sF 1sG r6 JZ",wn:"1sH Ln Lo Lp",gZ:"ks Kw Lq xt Lr r7",h0:"3y Lq xt Lr r7",wo:"MÃƒÂ¼1sI r0 Km 1sJ 1sK 1sL (Bu 1sM 1sN 1sO 1sP)",h1:"1sQ r7",h2:"8v 1sR YÃƒâ€“1sS 1sT",h3:"1sU:",h4:"1sV Ln Lo Lp",h5:"mM 1sW 1sX 1sY",h7:"<br>>> 1sZ: tX <i>1t0 qV 1t1 GÃƒâ€“RÃƒÅ“NÃƒÅ“R</i>",h9:"1t2 SEÃƒâ€¡wW:",hb:"xu 8v 1t3 r7",hc:"xu 1t4 1t5 YÃƒâ€“Ls",hd:"Lt 65:",he:"Lt Lu kB:",hf:"1t6 SEÃƒâ€¡wF:",hg:"1t7 Ãƒâ€¡1t8 1t9 1ta SEÃƒâ€¡1tb:",hh:"qU,1tc EN qN 1td K3 1te 1tf AÃƒâ€¡1tg 1th",hj:"1y 1ti 1tj 1tk 1tl ",hk:"iÃƒâ€¡wH 1tm 1RÃƒÅ“SÃƒÅ“1tn x4 xp 1to 1tp ",hl:"xu qG YÃƒâ€“Ls",hm:"r6 7k ku:",hn:"xt 1tq 1tr ",hp:"r5 x9 1ts r6 1tt mH 1tu",hr:"u0 YÃƒÅ“1tv",hs:"Lw 1tw:",ht:"YÃƒÅ“1tx",hu:"Lw Lg:",hv:"1ty",hw:"Ãƒâ€¡Lx SÃƒÅ“JI",hx:"1tz kB",hy:"8v 1tA 3y KY 1tB 1tC:",hz:"qG Ky:",hA:"1tD qW",hB:"1tE 1tF qW",hC:"r6 ",hD:"qT mA x7: <br><i>",i8:"32 : ",i9:"1tG 1tH : ",hE:"kr 1tI GÃƒâ€“RÃƒÅ“NTÃƒÅ“LE:",hF:"ALÃƒâ€¡1tJ 1tK GÃƒâ€“36:",hG:"mG 1tL 1tM GÃƒâ€“36:",hH:"GÃƒâ€“1tN:",hI:"Kh 1tO GÃƒâ€“36:",hJ:"mG 1tP GÃƒâ€“36:",hK:"3y 1tQ 1tR MU?:",hL:"E-1tS qW:",hM:"Ly 1tT MI 1tU 1tV MI ?",hN:"mG Ly",hO:"Kg Ki 1tW",hP:"TÃƒÅ“M ku Lz",hQ:"mG kr 1tX",hR:"TÃƒÅ“M JY Lm Lz",hS:"xs Js 1tY 1y 65",wq:"1tZ 1u0 1u1 gÃƒÂ¶wm",hT:"5L\'s 11 70 pd, 11 70 pe, 11 hU hV - 5C pf...<br>5L 3q p6 to 2F u1 pg u2 oL nJ<br>u3 to lP : hW,7V,hX,hY,hZ",i0:"xs",i1:"1u2",i2:"1u3",i4:"1u4 gÃƒÂ¶1u5 1u6 KN 1u7 1u8",i3:"51 2A:",i5:"lJ ph/pi ly (pj 2l X)",i6:"DG q tZ of t5 i7",ia:"Ãƒâ€“1u9 1ua",ib:"Bu KR 1ub 1uc 1ud wA",ic:"pl lM:",id:"lQ 8d lR of lS (6S 2N 5K lT)",},3l:{46:"xv",47:"IW",6H:"GÃƒâ€“36",1J:"xb",7W:" 1ue wM 1uf 1ug:",1k:\'4E 8t\',44:\'K0 1uh 1ui 64 kx\',7X:\'4E Li 1uj 64 kx\',2U:\'xv - 1uk\',1n:\'xv - 65\',},3m:{45:"1y qR 1ul 3y 1RÃƒÅ“SÃƒÅ“",1X:"qX Kn",6s:"qX x6",1n:"qX 65",ie:" KK KL kB ",ih:"LB wT",1m:"4E kz",7Z:"Ãƒâ€¡1um qR KI",ii:"1un Jg",ij:"4E kz",1uo:\'LB 1up\'},ik:{6I:"GÃƒÅ“Ãƒâ€¡:",},io:{46:"LC",4X:"LD",ip:"65",6J:"8z",1p:"YÃƒÅ“kC/8A",2h:" wY ",6K:" 1uq ",19:"7l",5v:" qM ",iq:" GEÃƒâ€¡1ur ",ir:{j:"15-81 : pn 56 jO\\\'S",iu:"4d to 6U 8f:",iv:"u5 1x:",iw:" 14 lU",ix:"88 q u6",iy:"u7 84 6U oT in 3n 31",iz:"u8 q TR 16 to 1x:",3n:"u9",iA:"nK 3h:",iB:"ua jP",iC:"5F ub",iD:"oO ...",iE:"nL 6Y 1x 16 uc 3n of pk ud",3O:"71",5D:"5D",2Z:"5I:",iF:"5G 5J",iG:"5G 71 5J",14:"14",iH:"in 1H(s):",iI:"4c jP",41:"5M 16",42:"No 16 to 3Q.  6V 2r jQ 6L.",iJ:"82 83 6M (nO) 84 of lz",iK:"5M ",iL:"ue to 3Q 1C",iO:"5M uf.  6V 2r jQ 6L.",iP:"ug uh:",iQ:"4d oU",iR:"p1 31",iT:"8a 4p of 8f:",},iU:{j:"1y 65 7k ",iV:" SEÃƒâ€¡1us 1ut ",iW:"xw xe 7l ",iX:"Jy 1uu YÃƒÅ“1uv 1uw ",iY:" xw xe Ãƒâ€“1ux",iZ:"",j0:"1uy Ãƒâ€“GE 1uz :",j1:"1uA,3 1uB 1uC 1uD bÃƒÂ¼tÃƒÂ¼n 1uE",j2:\' SeÃƒÂ§LF 3 Ãƒâ€“LG En Az 1 LH mN\',j3:\' SeÃƒÂ§LF 2 Ãƒâ€“LG En Az 1 LH mN\',j4:\' SeÃƒÂ§xx 1 xy mN\',j5:\' SeÃƒÂ§xx 2 xy mN\',j6:\' SeÃƒÂ§xx 3 xy mN\',j7:"<u>xw 1uF SEÃƒâ€¡iM 1RÃƒÅ“SÃƒÅ“:</u><br>(1uG 1uH Ãƒâ€“GE 1uI 1uJ wV 1uK wN 1uL..!)!",1t:"1uM 1uN 1uO.!! 1uP",2a:"1uQ",48:" 1uR 1uS Ãƒâ€“1uT 1uU 1uV",49:"7i",4a:"ky",j8:"1uW Ãƒâ€“LI wY 1RÃƒÅ“SÃƒÅ“",2N:"x6",j9:"LJ 1uX kz.",jb:"LJ Ãƒâ€“GE 7m! qY ",jc:"kp",jd:"Lu 8u r8 LK :(",},2f:{j:"1y YÃƒÅ“kC/8A 1uY SEÃƒâ€¡Kt 1RÃƒÅ“SÃƒÅ“",k:"1y YÃƒÅ“kC/8A 7k 8z BÃƒâ€“LÃƒÅ“MÃƒÅ“ 1RÃƒÅ“SÃƒÅ“",16:"SEÃƒâ€¡iM 1RÃƒÅ“SÃƒÅ“:",1d:"ky 1uZ 1RÃƒÅ“SÃƒÅ“",2b:"1v0 Lh 1RÃƒÅ“SÃƒÅ“",2g:"LL LM 66 Ãƒâ€“GE kz !",6P:"qY...",jf:"LN: ",jg:"1v1",jh:"r8 r9: ",85:"LO r9: ",ji:"1y YÃƒÅ“kC/8A 7k xo;.",1m:" LL LM 66 Ãƒâ€“GE kz!",jj:" 1v2 8u 1v3...",jk:"kv kw Ãƒâ€“1v4 +10 1v5 1v6 YÃƒÅ“1v7 !",jl:"kv kw Ãƒâ€“1v8 EN Ks 5 LD Jo +5 1v9 1va 8A r3 1vb (5) !",48:"kt 1vc 1vd 1ve",49:"7i",jm:"IZ",4a:"ky",jn:"LN.",jo:"r8 r9.",jp:"LO r9.",jq:"1vf qL 1vg 7m ",jr:"8A 8u kt mD ",js:"YÃƒÅ“kC 8u kt mD ",jt:"r8 LK",2e:"K1 r4: ",ju:" J4 7i: ",jv:" 1vh 1vi ",jw:"LP",jx:" 1vj xh 1vk:",jy:"<i>(**1vl 1vm 1vn qS x2 xz 1vo.)<BR>(**1vp 66 LP 1vq 1vr 1vs 1y mH GEÃƒâ€¡1vt..)</i>",4u:"1vu 1vv AL",},1Y:{j:"kv kw Ãƒâ€“LI Lc 1RÃƒÅ“SÃƒÅ“ ",1Y:" qM ",jz:"Ãƒâ€¡K2",4W:"66 Ãƒâ€“1vw SEÃƒâ€¡:",2g:"xA LQ ",jA:"xA LQ :(",jB:" wV!!!",jC:"1vx 1vy qM(qK x5):",jD:"1vz:",k:" xp kx ve xA Lx 1RÃƒÅ“SÃƒÅ“",},jE:{j:" 1vA kv kw Ãƒâ€“1vB 64 kx ",47:"GÃƒÂ¼ÃƒÂ§:",},2K:{W:"LR.! xz xq iÃƒâ€¡iN xB LS AÃƒâ€¡LT.",13:"LR.! xz xq iÃƒâ€¡iN LC LS AÃƒâ€¡LT.",2e:"8z qY...",j:"1y 8z",k:"<i>8z JV Ãƒâ€“JW 1y 1vC</i>",1d:"<i><1b 2V=2l>8A 1vD YÃƒÅ“kC r3 MÃƒÅ“MKÃƒÅ“N wG</1b></i>",jF:"xB = AÃƒâ€¡IK",jG:"xB = xo",},},},\'es\':{8L:\'xC\',8M:\'1vE\',8N:\'4e\',8O:\'DX\',8P:\'po\',8Q:\'38\',8R:\'pp\',8S:\'5p\',8T:\'8B\',8U:\'mO\',8V:\'th\',8W:\'1vF\',8X:\'1vG\',8Y:\'4I\',8Z:\'1vH\',91:\'2E\',92:\'A.kD\',93:\'xD\',94:\'1vI\',95:\'xE\',97:"1vJ",99:\'kE\',9a:"p5 vs me ! nV on vt",4I:{9b:"6a:7u/9c;9d,9e+nW/nX/zP/nY/nZ/o0/K+J/o1/o2/o3/o4/o5+o6/o7+Vh+o8/o9/oa/ob/oc+od/oe+og+oh+oi/oj+ol+om+oo/op/oq/os+ot+ov/ow/ox+/oy+oz+/oA+/oB/oC/oD%3D%3D",9f:"3B://9g.9h.3C/9i/oE/",1M:"8g",or:"1vK",6b:"xF",9j:"LU",9k:"LV",6c:"2J ",3E:"LW",9l:"1vL",1S:"en",9m:"68",9n:"LX 68",9o:"Il 2O LYÃƒÂ³ 1T el ra no LZ",9p:"En 1M de M0 :",9q:"4G M1",9r:"M2 en ",9s:"53 : 5 xG, me 1vM",9t:"1vN 3s 1vO 1vPÃƒÂ³n de 2O !",1j:"5j",9v:"8C",9w:"1vQ",1m:"M3",2F:"1vR",9x:"3z M4 de mO",9y:"x 3z 5k",3b:"4G",2U:"1vS",1n:"3z",9z:"4G rb :",1k:"AÃƒÂ±8D",9A:"De",9B:"M5",2u:"xH",to:"a",},9C:{9D:"1vTÃƒÂ³n de mP kFÃƒÂ¡rc",9E:"1vU xI en 3s 5l 1z xJ 1vV 1vW",9F:"mP",9G:\'M6ÃƒÂ­M7 de 1h mP\',9H:"x mP - kE",9I:"1vX",9J:"xK M8 xL",9K:"Es 1vY 1z 1vZ la bÃƒÂº7o 1z xJ 1h M9...",9L:"1A M9",9N:"rd de bÃƒÂº7o:",9O:"3z 5k:",9Q:\'8E de la 2D:\',9R:"1G.",9S:"1N.",9T:"8F de xM:",9U:"rf:",9W:"xN kP en el xO",9X:"PR",9Y:"kG",9Z:"1w0",a0:"xP",a1:"2J de la 8B",a2:"4J",a3:"7B",a4:"# NÃƒÂº8G de rg",a5:"mP: ",a6:"No 37 xQ",a7:"xP: ",a8:"1w1 si 1UÃƒÂ¡ 1w2 mÃƒÂ¡s de:",aa:"dÃƒÂ­as",ab:"2v dÃƒÂ­as (1w3 5m 6 xF)",ac:"# 1w4",ae:"*xR 1z 1w5*",af:"3p",ag:"1w6:",ah:"BÃƒÂº7o en",},aj:{3H:"Mi 2D",3I:"Gi 1w7 xS. Mb : ",3J:"mQÃƒÂ³n :",},ak:{3c:"k5 :",ao:"1w8Ãƒâ€œN",ap:"Mc",aq:"1w9",ar:"TS",av:"1wa",aw:"4e:",at:"a",hq:"QG",1I:"M5 :",ax:"xT",ay:"1wb",aA:"1wc a",aB:"a",aC:"No Md",aD:"1wd",aE:"1we Me",aF:"rU n9",6g:"1wf",1s:"mR",2w:"5s",5t:"1wg",aG:"4G 1wh :",aH:"1wi",},3G:{j:"1wj 1wk DE 1wl",6i:"xD",25:"xU",aI:"xV",aJ:"xV y + xW",aK:"kG mÃƒÂ¡s 1wm",aL:"El rh de 7p",aM:"El rh de 1wn",7D:"(1wo)",aN:"8C 1E : ",aO:"3z",aP:"3z kH",aQ:"AÃƒÂ±8D",aR:"1wp un 7p",aS:"1wq de 1wr : ",26:"1ws un 1wt 1z xX en 1wu !",aT:"ri 1wv",3L:"1ww",kU:"ri en",aU:"3p xO de MfÃƒÂ³n !",aV:"Eq 1q 1wx 1wy.",6j:"1wz",aW:"<1b 2V=2l aX=\'aY\'><b>3p, 1L Mg Mh !<b></1b>",aZ:"Mj rj",kV:"ri rj",b1:"1wA rj",b2:"1wB",},7F:{j:"5j mO a 8B",b3:"Ev : ",b4:"<b><1c>1wC maÃƒÂ±1wD !<br><br>1wE 22 1wF ya Mk 1wG 1wH.</1c></b>",b5:"<1c>mO rj</1c>",b6:"No 37 mS Ml !",},b8:{j:"Mm xC 5R pA",k:"1wIÃƒâ€œN DE pA EL 1wJ",3M:"1wK",oN:"1wL",1wM:"Mb",2W:"La 8HÃƒÂ³n en el Mn",b9:"xY 8HÃƒÂ³n.",1M:"3p de LZ",vM:"vN",},6k:{j:"1wN DE 1wO EN 1wPÃƒÂ1wQ",ba:"xH de la 8B",bb:"xZ 1wR",1B:"LX.",bc:"1wS 5l...",bf:"1wT la pC de Mo...",bg:"1wUÃƒÂ³n...",k:"md DE mT Mp",1W:"1wV",1m:"No se Mk mU mS!",6m:"y0 1z Mq : ",bi:"y1 1i mS/Mo :",bj:"1wW 1i 8I",26:"No 37 y2 Mr !",bk:"MsÃƒÂ³n en rk",2u:"mS :",1X:"mV la 1wXÃƒÂ³n",2w:" 2m 8I : ",bl:"MsÃƒÂ³n de 8I 1wY.",bn:"1wZÃƒÂ³n de 1x0 en rk... ",},38:{j:"kZ - y3Ãƒâ€œN",bo:"5j en 1l 8B",bp:"5j en 1l l0",bq:"1x1 1x2 Mt 5m ",bt:"38 :",},bu:{j:"1x3 DE 1x4 - EF 5R 2O",bv:"3z kH",bw:"1x5",bx:"3z 5k",bz:"1x6",bA:"Mu",bB:"1x7ÃƒÂ³n",bC:"4e",bD:"xE",bE:"Mv",bF:"kD",},4m:{j:"MwÃƒÂ­mW 1q pp",bG:"4I",bH:"1x8",bI:"1x9",bK:"y0",bL:"EI",bM:"po",1t:"1xa",2a:"1xb",bN:"1xcÃƒÂ­a",bO:"1xd 2w en el pp :",},2n:{1u:"1xe 1xf",k:"Mx DE mR",1d:"1xg DE 1xh",2b:"xC DE Mz Y 1xi",2c:"2m",bP:"kD 1E (1L 8J 1L 2D)",bR:"kI mX (1L 8J 1L 2D)",bS:"nÃƒÂº8G de MA",3O:"kJ de 1i MA",bT:"1xj (MB)",bU:"MC (MB)",bV:"8E de 1xk",bW:"8E de 1xl",bX:"1xmÃƒÂ­a	",bY:"NÃƒÂº8G de 1xnÃƒÂ±as",bZ:"1xo DE 1xp",c0:"1xq DE LA 1xr",c1:"1xs DE MD",c2:"1xt MD EN 8k",c3:"rd ME",c4:"a",c5:"es",},1F:{j:"MF DE LA MG",1u:"md DE mT Mp DE LA MG",c6:"y4 1L :",c7:"3r",c8:"MH 1xu",c9:"1xv el",ca:"rl xH 1xw",},4H:{j:"1xx 5R jZ - 1xyÃƒâ€œN 5R 8k",cb:"1A kH 1i 8K",cd:"1A mY 1xz",cf:"1xA (s) en y5 :",cg:"MJ ÃƒÂ©zM de la kG ",k:"8k DE 1xB qL",1d:"1xC 1xD",2b:"l4 DE 8k",ch:"1xE 1xF",2K:"7q",2e:"MLÃƒÂ³n en rm",2f:"+1p",4L:"+21",3Q:"3z",1Y:"y6",ci:"MN",cj:"No 1xG",cl:"rnÃƒÂ­1xH (s) ",cm:"1xI(s)",},cn:{j:"1xJ DE 1xK - 1xLÃƒÂ³n de rg",co:"68 11",cp:"ri 1xM",6p:"1xNÃƒÂ³n",},4N:{1t:"sk",2a:"y7ÃƒÂ³n",cq:"No 37 m7 5w en la 2D !",cs:"m7 5w",ct:"1xO 1xP :",2j:"2m",3R:"MO.",3S:"kD.",cv:"mQÃƒÂ³n de xS 1L 8J",cw:"mQÃƒÂ³n de 1xQ 1L 8J",cx:"mQÃƒÂ³n de 1xR 1L 8J",cy:"mQÃƒÂ³n de 1xS 1L 8J",cz:"sl.",3T:"4o",cA:"MO",ts:"TS",3g:"MP",cB:"MQ / 1xT",cC:"xY 1N",cD:"xY sn.",cE:"1xU",cF:"MR",cG:"l5",},cH:{cI:"1xV",cJ:"PÃƒÂ¡1xW",3h:"k5 :",to:"&#sp;",us:"1xX",7I:"1xY",4l:"MS!",2j:"5s:",cK:"xK:",cL:"MT:",cM:"TS",cN:"FO",cO:"sr",cP:"1A el MV de xM",cQ:"MV ",6t:"1xZ pÃƒÂ©rp",cR:"pÃƒÂ©rp 1q 1y0",4p:"NÃƒÂº8G",cS:"MT de 1y1 :",cT:"No 37 pÃƒÂ©1y2 en 1y3 1y4",W:"No se 1y5 5k",1u:"rl 5k de 1y6 de 7p",cU:"1y7 mU",4O:"1y8",2g:"y8 1y9",cV:"3z M4",cW:"1A 5k",cX:"No 37 y9",cY:"pL 1ya",cZ:"1yb de la bÃƒÂº7o :",2X:"yb :",d0:"1yc",d1:"PÃƒÂ©rp :",},d2:{d3:"4o",PR:"PR",d4:"TS",7J:"1yd",d5:"no se LYÃƒÂ³ yc...",19:"2d",3g:"MP",2c:"5s",d6:"Mi 2D",d7:"kG 2d",d8:"6u 2d ",d9:"FS 2d",db:"kG/6u 2d",1u:"3r de 1h 1E 1ye 1z 1yf",k:"3r de 1h 1E 1yg en la Me",dc:"No 37 1E MW.",dd:"1yh",df:"1yi",dg:"1yj de",dh:"1yk",dj:"xW / h",dk:"1A 1yl de 1E",dl:"MX : 1ymÃƒÂ¡ 1T 1yn tj 1z MY 1E MW o 1h 1E 1T 1yo MZÃƒÂ©s de 3s 1yp.",1W:"yb :",5x:"No mU",},2L:{dp:"1yq N0 ...",dq:"N0:",4q:"En",14:"Y",dr:"1yr xQ en la N1ÃƒÂ³n ...",ds:"<B>N1ÃƒÂ³n :</b> No mU ! (En 1ys ?)",dt:"M3",1c:"7B",1B:"BÃƒÂº7o 1yt !",1M:"53 :",1X:"mV N2",W:"X kK xI 4r 0 y 3U",13:"Y kK xI 4r 0 y 3U",1v:"La mZ mÃƒÂ­N3 kK 7r rq de 0",1w:"La mZ mÃƒÂ¡rr kK 7r rq de 1",3V:"La mZ mÃƒÂ¡rr kK 7r rq 1T la mZ mÃƒÂ­N3",3W:"La mZ mÃƒÂ¡rr no kK 7r rq de dw ! k1 1yu 1T la bÃƒÂº7o 1yv 1yw y el 1yx se 1yy",dx:"1A/yd 1i 1yz (te 1yA xJ a yf vb)",dy:"8E 1G. :",dz:"8E 1N. :",dA:"k5 TS ",dB:"Fh ",dC:"y4 1L ",dD:"1yB",dE:"nr",dF:"1yC",dG:"jN",dH:"yg 5l",5y:"7B ",dI:"1yD",dJ:"1yE",dK:"En 1yF",dL:"1yG",dM:"1yH",dN:"jN",dO:"yg 8B",2x:"4J",19:"2d",6y:"yh 2n",dP:"yh",dQ:"1yIÃƒÂ³n",dR:"<dS dT=#dU>MX : 1yJ k1 dV di",dW:"y9 1yK 1T pB la bÃƒÂº7o.</1b>",2Y:"nr...",dX:"1yL y9",dY:"xU",dZ:"3r de yi",1W:"yb :",e0:"NÃƒÂº8G de N4 ",1j:"N5 !",e1:\'N6\',e2:"MS!",e3:"N5 a ",e4:"1yM el xO de MfÃƒÂ³n...",e5:"53 : no ha 1yN 1yO 7s",e6:"53 : 7s no h6 vÃƒÂ¡1yP",e7:"kE 1z la N7ÃƒÂ³n kFÃƒÂ¡rc",},e8:{j:"Mc k8 rs N8",25:"rs N8",3i:"xE",e9:"1yQ 1E",1J:"kE",k:"N9ÃƒÂNa DE LA 1yR 1yS",1d:"Mx DE mT 1yT",ea:"2d",4R:"4R",eb:"y8 xQ",ed:"1yU Mm mR",ee:"yj DE mT rs - 1yV",ef:"1yW rs",eg:"rt Nb",eh:"1A Nb :",ei:"8F de rg :",ej:"rd mÃƒÂ¡rr de bÃƒÂº7o :",ek:"rf",em:"yc kP Nc.Nd",eo:"rt N2 5m",ep:"Nf 2D 1yX",eq:"xG",eu:"v1 :",ev:"rd",ew:"1yY kJ Ng",ex:"1yZ kJ Ng",ey:"1z0 1z1 :",ez:"1z2 Nh Ni",eA:"1z3 Nh Ni",eB:"1z4 1z5 Nj :",26:"ho 37 xN Ml",3L:"MC no 1UÃƒÂ¡ b7",2X:"mU :",1B:"1z6 1L el 1z7",},7L:{j:"Nk vo DE Nl",3i:"6W",eC:"nT",3E:"LW",1I:"1A N4",3X:"8F de 7p:",eD:"5j 1z8 de 1z9 5m",1x:"rf",eE:"yc kP Nc.Nd",1k:"AÃƒÂ±8D 7p",eF:"1za 5R 1zb DE Nl - 6W",eG:"<BR>La NmÃƒÂ±a de Nn 1UÃƒÂ¡ 1zcÃƒÂ±1zd 1z 1ze 3s Np 3s y M8 xL.<BR>        xUÃƒÂ¡ 3s 1zf 2 1zg, la 1zhÃƒÂ¡ y 1ziÃƒÂ¡ de M0 .<BR>        1zjÃƒÂº1zk de 1T 1zl 2 xN kP en tu 1zm 1z 3s Np.<BR>        1zn 1h 7s, 1E y 1zo a ON !.<BR><BR>        2J de 2o (11 eH):<BR>        <A 1I=eI eJ=3B://eK.eL.3C/eM/eN>xM a 1zp</a>        <eP eQ=100%><TR><TD>8E</td><TD>4k 1</td><TD>4k 2</td><TD>PÃƒÂ©rp</td><TD>xT 1G</td></tr>        <TR><TD>1</td><TD>n/a</td><TD>160 MM</td><TD>12 MM</td><TD>0</td></tr>        <TR><TD>1</td><TD>n/a</td><TD>80 3A</td><TD>1zq</td><TD>1+</td></tr>        <TR><TD>2</td><TD>5 MM</td><TD>130 3A</td><TD>1 4k</td><TD>2+</td></tr>        <TR><TD>3</td><TD>10 MM</td><TD>eR 3A</td><TD>1 4k</td><TD>3+</td></tr>        <TR><TD>4</td><TD>20 MM</td><TD>eS 3A</td><TD>1 4k</td><TD>4+</td></tr>        <TR><TD>5</td><TD>50 MM</td><TD>eT 3A</td><TD>1 4k</td><TD>6+</td></tr>        <TR><TD>6</td><TD>100 MM</td><TD>eU 3A</td><TD>1 4k</td><TD>7+</td></tr>        <TR><TD>7</td><TD>150 MM</td><TD>eV 3A</td><TD>1 4k</td><TD>8+</td></tr>        <TR><TD>8</td><TD>eW MM + 3Y</td><TD>eX 3A + 3Z 40</td><TD>1 4k + 1 3A</td><TD>9+</td></tr>        <TR><TD>9</td><TD>eY MM + 3Y</td><TD>eZ 3A + 3Z 40</td><TD>1 4k + 2 3A</td><TD>10</td></tr>        <TR><TD>10</td><TD>f0 MM + lj</td><TD>f1 3A + f2 4n</td><TD>1 4k + 6 3A + 50 4n</td><TD>10</td></tr></f3><br><br>",f4:"No 7s 1zr !",f5:"1zs :",f6:"1zt",a9:"MR",1K:"4k",3H:"1f 2h:",3I:"1f f7",3J:"tP:",f8:"2m 1f f9:",fa:"4s of 1st 3j 1j:",fb:"4s of lk 3j 1j:",fc:"6W lL",nu:"Fz",},3k:{fd:"6G",fe:"1zu",29:"FA",ff:"Mv",fg:"Nq",fh:"1zv la Nr 1zw en kH 1i 1zx",fi:"1zy k8 - y3Ãƒâ€œN",fj:"1zz 5R 1zA",fk:"k8",fl:"8F kFÃƒÂ¡1zB ",fm:"1zC xL sÃƒÂ³lo se 1zD en 5m G6 de 1h 2O! Es 1zE 1L el rh mÃƒÂ¡s 1zF 4r la Nr y la 2D 1zG + 10 LU.",fn:"kG de la 1zH ",fo:"vj a 1zI",fp:"15 ru - 3d",fq:"1zJ 1zK :",fs:"yj DE ru",ft:"1A 1zL",fu:"l5 ",fv:"AÃƒâ€˜1zM Ns DE ru",fw:"5j el Nt 5m",fx:"5j el Nt 35 un mÃƒÂ­Nu de",fy:"NvÃƒÂ³n ",1x:"rf",fz:"yk",fA:"AÃƒÂ±8D 1zN",fB:"yk Nq",fC:"Ns DE ru :",41:"1zO",42:"1zP",fD:"Ag 1zQ mT 1zR",fE:"O 1h 7s",fF:"(La Nw a rv es la 1zS de 1h 1E 1zT)",fG:"NvÃƒÂ³n de lo 1T 1zU rv : ",W:"La Nw no 5n 1zV",fH:"yg 5l !",13:"1zW un yl de 1zX !",1v:\'No 1zY rv a la 1zZ 2D !\',1w:"No se 5n 1A0 0,0 G2 !",fI:"yk 1A1.",fJ:"3p, 1L Mg Mh !",fK:"1A2 de 2 LV !",},7M:{fL:"Mu",j:\'Nk vo DE 1A3 DE mR\',fM:"AÃƒÂ±8D Nx",fN:"1A 1A4",6B:"ME la 2D :",to:"Nj la 2D :",fO:"4G 4r 1A5 :",fP:"1A6 1i 1A7 de 1h 1E",fQ:"AÃƒÂ±8D Nx",fR:"I 1A8 1A9",k:"Re-1Aa 1E 35 1Ab",W:"No se 5n Ny mÃƒÂ¡s de",13:"34 a FJ.",fS:"1Ac 1L su 1Ad...",1Z:"1AeÃƒÂ³n Gm - 4G :",fT:"",},fU:{2i:"x kD",j:"15 Mz",7N:"v8",1J:"kE :",3X:"8F :",fV:"(68 1z 1Af 1i 1Ag)",fW:"1Ah de la NzÃƒÂ³n (2w) 1z 1Ai el 1Aj 1L 1Ak",fY:"1Al Mt",k:"<u><b>kI mX :</b></u> La ymÃƒÂ³n kFÃƒÂ¡rc de la NA 1z 1Am a un mÃƒÂ¡1An de 5.",fZ:"la NBÃƒÂ³n kFÃƒÂ¡rc de la 69 1Ao en la 8HÃƒÂ³n :",g1:"rw 1h 1Ap en Mn",W:"k4 : No se 5n rx la 69 de la 8HÃƒÂ³n...<br>68 el ra.",g2:"kI mX",},g3:{j:"15 1Aq 1Ar",g4:"xP",g5:"1As 1T 7r en 3s 5l 1z 1At yn 1AuÃƒÂ­1Av.",2i:"xD",3M:"1Aw i 1Ax",g6:"No 1Ay",43:"<br><br><b>m1 pT 1Az a 1AA..1AB 1AC k1 ai 1AD !</b>",g7:"1AE ",g8:"8F de yi ",g9:"2J de la 5l ",ga:"xK la 8B",},7Q:{7R:"2J de 1AF (1AG) :",2n:"1AHÃƒÂ³n NC",1k:"1AI :",7S:"O de la 2D :",},6C:{j:"kD xR",gb:"# 1L 1AJ  ",3T:"yp",1s:"1AK 1E",W:"El nÃƒÂº8G de 1h 1E 1L la 69 ND (1T se 1AL > 0)",13:"78 ND de 2Z.",1v:"no se 5n 1AM (2v ",1w:"la 69 de rm 1z 7r 1AN.",gc:"4G M1 ",3V:"El ÃƒÂ©NF de la NBÃƒÂ³n de la 69 de 1i 1AO",3W:"53 : No se 5n rx la 69 de la 8HÃƒÂ³n...<br>68 el ra.",gd:"CuÃƒÂ¡1AP 2Z se 1AQ rx ? (1=1E en 1AR a",gf:"1AS 1q\\\'m0... !",gg:"k4 : No se 5n rx la 69 de la 8HÃƒÂ³n...",gh:"LÃƒÂ­1AT de 1h 1E 1AU.",19:"8E",gi:"yp en 1i 1AV",gj:"yp en el 1AW",},nC:{1Z:"1AX.",gk:"1AY",2q:\'1AZÃƒÂ³n de \',gl:"1B0 1B1",wc:"1B2",},2q:{2i:"kI",gm:"x kI",j:"MF DE NGÃƒâ€œN",4U:"v8 kI",k:"1B3 DE NGÃƒâ€œN",ec:"Ec:",gn:"En ymÃƒÂ³n",W:"3p 1z la 1B4ÃƒÂ³n !",13:"y0 1B5 !!",1v:"sR nD in 6E!",1w:"rl 1B6 1q kJ 10 o + 1B7 7r 1B8 FW.",go:"1B9 1Ba de 10 ls...",gp:"y4 1z rh",2z:"NH de",4U:"yl de ymÃƒÂ³n:",},gq:{j:"l4 DE 1Bb ",gr:"1BcÃƒÂ³n de",sS:"1Bd",1Z:"1Be.",},gs:{j:"15 gu",44:"1Bf DE 1Bg Y 1Bh DE gu",k:"15 gu - md",1t:"MwÃƒÂ­mW",2c:"2m",43:"<i><u>1Bi :</u> vj 5.nE Cm</u></i> - <i>(*) NI 1z yq el 1Bj (F5).</i>",},2T:{gv:"1Bk a",45:"NJ 1Bl",7T:"1Bm",gw:"(1Bn el 1Bo 1q ra 7rÃƒÂ¡ 1Bp)",gx:"1Bq el 1Br de la NK (1Bs la NK 1Bt la 1Bu NL 35 el 1BvÃƒÂ³n)",6G:"1Bw de 1h 1Bx",gy:"68 11 5m",gz:"yd la 1ByÃƒÂ³n de 1i 8I",gA:"5o 1Bz de yf",gB:"1BA 1g a la 1BB (1BC yf 1BD)",7U:"1BE de la 1BF :",gC:"1BG 1BH",gD:"1A yrÃƒÂ³n NC en el 1BI.",gE:"5o 1BJ lu 1BK al de 1BL ",gF:"M2 11 si no 1BM en 1 FZ",gG:"x 1BN 1BO de la 1BPÃƒÂ³n en el 1BQ de nF (kH 1i 1BR)",gH:"1BSÃƒÂ±a 1BT",gI:"6Z p8 -",gJ:"4w:",gK:"kLÃƒÂ³n NmÃƒÂ±a 4I :",gL:"1A 1h 1E",gM:"1A 1h mX",gN:"1A 1h 1BU de 8I",gO:"1A yrÃƒÂ³n de la NzÃƒÂ³n",gP:"1A la 1BVÃƒÂ³n de 8I",3R:"1BW 8I y 1E en la NM",3S:"1A 1h 1E en el rk de 8HÃƒÂ³n",gQ:"1A xS rb en y5 si se va a 1BX en 1BY de ",gR:"1A 1BZ",gS:"kLÃƒÂ³n 1q 1l :",gT:"5o NN 1C0 en el 1g(1C1 en 6 xF,1C2 5m 1C3 8J)",gU:"1C4 ka en 1h NP(sP./NQ.)de 1C5 1C6ÃƒÂ±1C7",gV:"yd 1h NP(sP./NQ)en el 1g",gW:"1C8 1h 1C9 1q 1g",gX:"1Ca 1h 1Cb 1q 1l (7s 1Cc, 1Cd, tU...)",gY:"1Ce de NR",wn:"1Cf en y5 el NR",gZ:"NS en k7 de N7ÃƒÂ³n",h0:"NS en el k7 de un 7p",wo:"1Cg Nn si 1Ch 1Ci h6 1Cj (1z no 1Ck el NU)",h1:"5o 1Cl",h2:"5o 2V de ys 1z 1Cm",h3:"tW de ys 1q 1g de la 5l :",h4:"tW de ys 1q B7 :",h5:"1Cn tu nH en el 1g",h7:"<br>>> 1Co de 1Cp : h8 1z h8 - <i>1CqÃƒÂ³n : sZ sÃƒÂ³lo 1L tÃƒÂ­</i>",h9:"kLÃƒÂ³n de 1i 5k de eO :",hb:"1Cr 1i 5k de 5l",hc:"ry la 1Cs de 1i mS de la 5l",hd:"rw kFÃƒÂ¡1Ct 1i 5k :",he:"8F :",hf:"1Cu 1Cv :",hg:"y1 32 ( QG ) :",hh:"y1 32 ka MZÃƒÂ©s de NI",hj:"x Mq el G7 1Cw la 1Cx 1Cy a",hk:"5o la 1Cz 1CA de la 2D (xV, Ny y rv)",hl:"ry la 1CBÃƒÂ³n de 1CC",hm:"kLÃƒÂ³n de la m7 de NN :",hn:"5o 1h 1CD de la pI",hp:"5o 1CE en k7 de 7p/yi",hr:"1CF 1CG CA",hs:"1CH 1CI :",ht:"1CJ",hu:"1CK :",hv:"mV",hw:"1CL 1z",hx:"1CM 5m",hy:"NV un 1CN :",hz:"1CO 1CP :",hA:"en el 1g de la 5l",hB:"1CQ a mi",hC:"1CR en k7 de ",hD:"MÃƒÂ­Nu de 1E : <br><i>(NV en el 1g)",i8:"El 32 : ",i9:"en 1h 1CS 1CT : ",hE:"1A si yo Md : ",hF:"2d. xT :",hG:"MQ (y8 NW) :",hH:"1A :",hI:"xW rb :",hJ:"No MY la 2D 1CU :",hK:"mV en k7 de 7p :",hL:"5j e-pc :",hM:"1A el 1CV de NA",hN:"xZ 1E",hO:"xR en la 1CW",hP:"rt 1CX 1h kE",hQ:"xZ mX",hR:"rt 1CY",hS:"5o el 1CZÃƒÂ³n de 3z 1D0 de mO en la 1D1 de 1D2",wq:"1A la 1D3 de 7s yt de 1h 1D4 de 1E",hT:"5L\'s 11 70 pd, 11 70 pe, 11 hU hV - 5C pf...<br>5L 3q p6 to 2F u1 pg u2 oL nJ<br>u3 to lP : hW,7V,hX,hY,hZ",i0:"Mj",i1:"1D5 ti",i2:"1D6",i4:"5j un 1D7 si DD ÃƒÂ©NF",i3:"51 2A:",i5:"lJ ph/pi ly (pj 2l X)",i6:"1D8 1i 1D9 1Da 1z i7",ia:"5o el 4W",ib:"rw 1i 5k de 1i rg 1Db de NX 7s",ic:"pl lM:",id:"lQ 8d lR of lS (6S 2N 5K lT)",},3l:{46:"1Dc",47:"x 1Dd",6H:"NH",1J:"yj",7W:"1De a xX :",1k:\'AÃƒÂ±8D\',44:\'mR 1Df\',7X:\'yu DE 1Dg\',2U:\'3l 1Dh\',1n:\'3l 1Di\',},3m:{45:"y3Ãƒâ€œN",1X:"mV pm",6s:"1Dj pm",1n:"3z pm",ie:"5j NU de 4x 5m",ih:"4G de 3m",1m:"No 37 NY en la 2D",7Z:"1Dk 3m",ii:"1Dl 3m",ij:"No 37 NY 1Dm en yn 2D",},ik:{6I:"NZ:",},io:{46:"1Dn 4e",4X:"O0",ip:"x rw",6J:"x 7q",1p:"1p/21",2h:"M6ÃƒÂ­M7",6K:"1p",19:"21",5v:"y6",iq:"1Do",ir:{j:"15-81 : pn 56 jO\\\'S",iu:"4d to 6U 8f:",iv:"u5 1x:",iw:" 14 lU",ix:"88 q u6",iy:"u7 84 6U oT in 3n 31",iz:"u8 q TR 16 to 1x:",3n:"u9",iA:"nK 3h:",iB:"ua jP",iC:"5F ub",iD:"oO ...",iE:"nL 6Y 1x 16 uc 3n of pk ud",3O:"71",5D:"5D",2Z:"5I:",iF:"5G 5J",iG:"5G 71 5J",14:"14",iH:"in 1H(s):",iI:"4c jP",41:"5M 16",42:"No 16 to 3Q.  6V 2r jQ 6L.",iJ:"82 83 6M (nO) 84 of lz",iK:"5M ",iL:"ue to 3Q 1C",iO:"5M uf.  6V 2r jQ 6L.",iP:"ug uh:",iQ:"4d oU",iR:"p1 31",iT:"8a 4p of 8f:",},iU:{j:"3z rnÃƒÂ­mW 1q 4e",iV:"8C 8K 1q 4e",iW:"8C 1i mY 1T 1Dp un 1Dq",iX:"o 1Dr",iY:"8C 1i mY 35",iZ:"Mr (i)",j0:"8C rnÃƒÂ­mW 1q yl :",j1:"8C,1Ds 1h 1Dt 35 3 8K 1Du",j2:\'n0 k9, 1 de 1i 3 rz 8K\',j3:\'n0 k9, 1 de 1i 2 rz 8K\',j4:\'n0 k9, el Gq 1Dv\',j5:\'n0 k9, 1i 2 rz 8K\',j6:\'n0 k9, 1i 3 rz 8K\',j7:"<u>No se 1Dw :</u><br>rl yv yw, daÃƒÂ±O1 o 35 3s O2 NL a 0",1t:"O0 a xX",2a:"1Dx",48:"md DE 1Dy 5R jZ",49:"4G",4a:"y7ÃƒÂ³n",j8:"1Dz 1DA DE 1DBÃƒÂ1DC 1DD 1DEÃƒÂN 1DF",2N:"O3",j9:"No 37 y2 1T O4.",jb:"No 37 y2 1T se 1DG - 1DH ",jc:"N6 de la 1DIÃƒÂ³n de 1i",jd:"no se 5n O4 :(",},2f:{j:"x 68/ry/7q",k:"1DJ LA yu DE O5",16:"3r de mY : ",1d:"yh e yrÃƒÂ³n",2b:"yu DE O5",2g:"No 37 yv en la 69 !",6P:"En rm...",jf:"rA : ",jg:"1DK de",jh:"O6 1DL: ",85:"O6 1DM: ",ji:"1DN 1p/21/3o yn 1DO.",1m:"No 37 yv en la 69 !",jj:"1DP 1q yx O7...",jk:"No se 5n yq 1L yt 1q kJ 10 !",jl:"No se 5n O8 1L yt de kJ de O2 (5) !",48:"3r de 1DQ-NW 35 1DR",49:"4G",jm:"2J",4a:"y7ÃƒÂ³n",jn:"rA.",jo:"rA 1DS.",jp:"rA 1DT.",jq:"MJ 1DU 1DV",jr:"1DW O9 Ãƒâ€°Oa ",js:"O3 O9 Ãƒâ€°Oa ",jt:"3p",2e:"7q : ",ju:"4G rb : ",jv:"en rk",jw:"Nf",jx:"NÃƒÂº8G de xG :",jy:"<i>(A 1DXÃƒÂ³n, 1DY al O7 yx)</i>",4u:"MH",},1Y:{j:"NJ 1q 4e",1Y:"y6",jz:"MN",4W:"kLÃƒÂ³n :",2g:"1DZÃƒÂºn ",jA:"yx b7 :(",jB:"mY yw !!!",jC:"kLÃƒÂ³n 1E0 yw :",jD:"x-86 :",k:"1E1Ãƒâ€œN DE nR",},jE:{j:"EL jZ - N9ÃƒÂNa",47:"NZ:",},2K:{W:"Oc ! x 7q 1UÃƒÂ¡ en NM.",13:"Oc ! La OdÃƒÂ³n de yq/O8 1UÃƒÂ¡ 1E2.",2e:"MLÃƒÂ³n en rm...",j:"1E3 15 nP",k:"<i>7q kH 1i rnÃƒÂ­mW daÃƒÂ±O1.</i>",1d:"<i><1b 2V=2l>No 1E4 si NX 1E5 la OdÃƒÂ³n 68/ry</1b></i>",jF:"x 7q On",jG:"x 7q nS",},},},}',62,6330,'||||||||||||eacute|||||||title|title2||||||the||||||les|Auto|||||||||||||||||||des||||||err1|||sur||KOC||err2|and|AUTO|items|agrave|der|level||font|center|title3|per|Items|chat|las|los|send|add|Chat|nothing|delete|Impossible|Upgrade|del|die|troops|col1|title1|err3|err4|keep|OTOMATiK|para|Mostrar|cancel|item|Truppen|tropas|Alliance|Min|slot|target|options|wave|por|error|Max|Show|Sie|nicht|MEN|dans|que|est|une|find|stop|equip|done||Enhance||den||attack|error1|DES|cours|auto|col2|title4|tot|Niv|repairing|upgrade|noitem|Stats|buttonlabel|sum|pour|red|Total|info|troupes|Level|build|for|Loeschen|auf|members|max|total|distance|Archer|queue|Settings|von|Anzeigen|ciudad|Transport|all|alliance|Interval|ville|Nombre|repair|Search|Vague|refresh|BAO|villo|Liv|Heiligtum|und|Options|edit|color|training|found|free|slots|Attack|city|Bunker|Elimina|truppe|con|STER|hay|Spam|ERREUR|Supprimer|time|Type|CONFIGURATION|Liste|par|knight|type|button|Wave|transport|Apothecary|RAID|any|Repair|Error|you|Lista|una|Allianz|ist|Spieler|keine|Bogen|SALDIRI|Borrar|Arqueros|http|com||help|Aucun|Attaque|msg1|msg2|msg3|attaque|error2|start|LES|row1|Montrer|salvage|includeMarching|EnableFormation|def|749|err5|err6|interval|1Bal|900|Bal|status1|status2|notes|stat|conf|label|power|popHistory|popCell0|popCell2|Refresh|Delete|City|Trono|dei|Mostra|archi|Einstellung|Ressourcen|Oleada|end|stock|Cat|Def|number|between|entre|Numbers|Activer|last|only|Tab|Raids|Wappen|gen|Stadt|bei|Intervall|Miliz|KAYIT|Milis|Tiempo|Trone|General|Dist|Pas|enhance|Non|Overview|report|ecirc|attente|dist|archers|Construction|modebuild|carte|preset|effet|ITEMS|Req||Throne|not|ERROR|Send|THE|THRONE|Dark|Forest|Sound|ogni|Nessun|non|oder|Zeit|Die|Bau|Saldiri|MENUSU|Enviar|informes|alianza|cada|puede|Activar|Info|boite|Production|TOTAL|food|automatiquement|Equiper|Fey|nofind|coords|automatique|1ere|TRANSPORT|KoC|Either|Name|Add|must|Wild|Slots|have|after|Thank|Salvaging|rapporti|attacco|corso|della|DEL|Ondata|Impossibile|Settaggio|Fehler|kannst|werden|Entfernung|wenn|als|Angriff|nach|Welle|GENEL|SiL|BiR|Saldiridakiler|Actualizar|cola|data|hours|name|Temps|Ajouter|villes|ambassy|TROUPES|scout|saved|Resources|trouv|collect|ressources|formation|duration|Action|Les|resume|pertes|Barb|Troops|doit|Seulement|more|OPTIONS|unit|from|Train|nbsp|Queue|Configuration|Transp|show|might|AutoRepair|quality|cycle|are|UPGRADE|ENHANCE|waiting|Time|Farm|need|Found|put|Waiting|Crest|Build|will|Enable|Power|NOT|Truppe|Tempo|alle|trovato|risorse|SETTAGGIO|Numero|deve|Attiva|Hinzuf|Spaeher|mit|Automatisch|Ritter|Warteschlange|HATA|ZAMAN|Oto|FONKSiYONU|SEViYE|YOK|NAKLiYE|squeda|ataque|Reparar|ser|coordenadas|AutoScout|image|Erreur|pas|Tout|Distance|Ville|Niveau|Coord|Aucune|option|Merci|Gift|Pop|egrave|both|unknow|AUTOMATIQUE|crest|reassign|mode|jeu|Members|AllianceList|allPlayName|orcity|Langue|Hauteur|Krone|gold|detail|Raid|marches||SALVAGE|All|cities|full|bad|Preset|again|Keep|every|Maximum|Reset|automatically|automatic|Item|aetherstones|Errore|tra|essere|gli|INVENTARIO|Elenco|Slot|sein|Ausbildung|Bericht|Koordinaten|das|mind|EKLE|iSLEMiNiZ|iTTiFAK|Toplam|MESAFE|OLAN|ONARIM|iYiLESTiRME|Alianza|Guardar|adir|Nivel|Intervalo|mero|formaci|recursos|hora|efectos|StatLabel|StatLabelAttaque|StatLabelTrone|StatLabelTournoi|StatLabelResources|StatLabelSpam|StatLabelInventaire|StatLabelInfo|StatLabelAlliance|StatLabelGift|StatLabelTest|StatLabelLogs|BoiteLabelApothecary|BoiteLabelResume|BoiteLabelCrest|AutoTS|BoiteLabelTransport|BoiteLabelautoFormation|BoiteLabelScoutAlliance|BoiteLabelWild|BoiteLabelFO|AutoFO|BoiteLabelFarm|AutoFarm|BoiteLabelOptions|pubbao|flag|png|base64|iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA|supporturl|www|facebook|groups|mins|secs|nowt|now|cancelact|kocnotfound|dialogRetry|EstimateT|Retry|myRetry|BOUpdate|Envoyer|save|new|delGift|delRpt|timeremi|source|dest|autoFarm|farmHead|playerMustInAlliance|farmButton|farmHeadStats|farmHeadOptions|farmInactive|farmSearch|farmShowNote|farmShow|Voir|farmSearchDist|farmDeleteRpt|rapports|farmCityLevel|shortMin|shortMax|farmIntervall|farmKeepRP|Garder|farmKeepRP2|mainSRallyPoint|mainCity|mainPlayer|mainDiplo|farmAllianceName|shortDistance|shortCoordinate|farmAttacks|farmFarms|farmNoData|farmDip|farmInactivePlayer|inactive|farmInactivePlayer2|farmInactivePlayer3|farmChecks||farmHeadTroops|mainError|farmFound|farmSearchAt||FoodAlerts|TowerAlerts||||atkType|atkType1|targetcity|target1||||marshallCombat|throne|emp|arrival||arrival2|arrival3|sanctuary|defence|noambassy|myambassy|timerem|defense|renforce|renforcefood|BOVilleProche|TimeAttack|Timerenforce|BO_AT_Fav|BO_AT_Fav_Sup|BO_AT_Fav_RESET|BO_AT_Fav_Nom|titleprog|timeAr|BOCompAttack|error3|error4|error0|size|3px|marche2|envoy|marche4|buttonactiv|gift|nobody|oksend|nomembers|disponible|tournoi|popdispo|pballlist|pballlist2|load1|membres||load2|check||select|accept|collecting|alldone|termin|collecting2|pbSpamState1|pbSpamState2|pbSpamMin||toutes|pbSpamAd|log|clear|option1|option2||option3|option4|option5|option6|option7|option8|option9|cat1|cat2|cat3|Combat|cat4|cat5|cat6|col3|puitotal|trainhour|heure|buildhour|row0|row2|row3|row5|row24|row6|row25|title5|title6|title7|title8|ptdistout1|ptdistout2|ptdistout3|sortby|alList|row8|row9|member|BOFiltre4ST|effets|BOFiltre7ST||BOlisteeffets|BOTroneCityCity|BOTroneInverse|unequip|norow||nbart|nbart1|fake|reloadkoc|fakeatk|nofey||titlefey|opendate|March|prodfood|prodwood|prodstone|prodore|auton|march|knight1|pop1|pop2|pop3|pop4|pop5|Rpt|them|pages|idRptWhat|idRptWhatNot|idRptFiltre1_1|idRptFiltre1_2|BOSyntheseAttack|BOresumeAT|BOresumeDF|pertes2|mes1|mes2|itemfind|BODelAllDF|title_popRapportDF|noresult|nosubject|result|lost|lost1|marchs|attackcol2|targetTS|nomarch|mycity|citylevel|barblevel|folevel||boglevel|notroops|refcol1||refcol2|refcol3|refcol5||foodh|encRemaining|comment|NOTE|vous||PDetail|Detail|PLeaderboard|PLb2|ANothing||tre|375|ShowHideOpts|minlevel|maxlevel|typewilderness|filter|orderby|TS0|TS1|TS2|TS3|TS4|Cit0|Cit1|Cit2|Cit3|Cit4|Cit5|Cit6|status|connexion|notetable|FONT|COLOR|600000|500|notetable1|exportKOCattack|generateFSList|generateScoutList|numberCible|startattack|finishattack|sendto|waitPR|errFS1|errFS2|scoutTitle|autofo|troopselect|lvl|nodata||pbTraderDivD|barboptions|barb1|raz|reset|pbsendint|pbmaxdist|rallyclip||rallyclip1||pbreport|barbstopsearch|barbstopsearch1||||pbmethod|pbmethod1|pbmethod2|pbmethod3|barbknight|barbknight1|barbknight2|popTradeRoutes|Cresttoggle|sendrpt|keep2|helpTitle|helpText|WIKI|_tab|href|koc|wikia|wiki|Wilderness|Koc|TABLE|width|520|1600|2200|3000|6000|299|9000|599|13000|1199|35000|2500|table|nolocation|popCrest|actif|Gained|msg4|gained|msg5|msg6|msg7|labTrp|labAppro|appro|manu|BOTrpQG|titleappro|titleappro2|BORecupReappro|pbreapprointerval|pninterval|cityFrom|keepmin|titleauto|TroopsNeeded||titleauto2|showRoutes|TroopAmount|titleauto3|pbtransportinterval|pbminwagons|CarryAmount|trade|pbSaveRoute|pbManualSend|TradeRoutes|titleManuel|typetrpx|trswagmax|BOEstimationR|noalliance|trpdone|trperr|trptryagain|buttonlab|addroute|showroute|pbreassigninterval|autofilloff|pbSaveRouteReassign|popReassignRoutes|plzwait|tryagain|autoForm|note1|bomodediv|min|BO_AllCalculate|BO_AF_CancelFirst|formations|CancelTrain|DoTraps|ScoutAlliance|diplo|needalliance|noready|IdNumScouts|IdScoutInterval|IdSearchAllianceName|IdSearchAllianceNameSubmit|pttdInpPS|estimfin|cancel1||cancel2|err7|err8|wallSpace|fieldSpace|close|merc|biglabel|titleec|autoclose|optimize|Knights|assigned|autoCraft||CRAFTING|welcome|langue2|MoveW|reload|prodshort|WideScreen|TchatR|WideMap|moremap|horlGMT|Watchdog|autoPublishGamePopups|NewTab|NewButton|NewButtonSelect|confres|ShowTroops|ShowDefense|ShowRes|ShowPop|ShowProduction|foodWarm|enableguardian|confchat|FoodWarnTchat|HelReq|DelReq|DelRules|ChatStuff|WhisperOn|EclaireurOn|AttaqueOn|Smiley|ChatLeader|ChatColor|ChatGlo|user_icon|son|iconinfo|25px|confrpt||AllRpts|AllMembers|deleterpt|intervrpt|confdiv|alertHQ|SelQG||GoldEnable|AttackPicker|EnhanceMsging|conftower|alertEnable||SoundEnable||Loadingswf|soundFile|SoundLoad|volume|SoundStop|soundLength|SoundRepeat|postAlert|alertPrefix|alertSendToAlly|alertSendAsWhisper|alertWild|alertTroops|alertDefend|alertEmpennage|alertMarechal|alertShow|alertFood|alertQG|alertraid|alertSendEmail|defBoost|alertMytroops|alertEmbassy|ResetALL|alertDefense|CResetALL|RptGift|credits|Multi|PDX|Conik|Deejey|Grand_Blanc|Minante|del3|toyou|ofyou|conftrone|togMailTrone|togAnimTrone|ChatVIP|VIP|onHQ|secondarycities|activateThePreset|DeleteMsgs|confonglet|racauto|sendReport|||timer|memory|nothingmemory|map||||AUTOTRONE|Autosalvage|history|autosalvage2|||BOSalvageCity|BOSalvageQuality|BOSalvageQuality2|BOSaveNum|BOSalAnyCity|rulestitle|BOCardType|BOAddRule|BOAddRow|BOSalvStatus|explainRules|musthave|mustnothave|inslot|BODelRule|status3|status4|status5|||status6|BOOverflow|BOOverflow1|BOOverflow2|moins|BOMaxStone|autosalvage|titleeffet|SalvageQuality|SalvageQuality2|RangeSaveMode|RangeSaveMode2|BOSType|BOSTripleSalvage|SalvageKeepEffects1|SalvageKeepEffects2|SalvageKeepEffects3|SalvageKeepEffects4|SalvageKeepEffects5|alert|titlelive|nodelitem||actionlog1|actionlog2|Salvagelog1||retry|trying|good|off|letsgo|upgrade10|enhance5|popCell1|popCell3|popCell4|popCell5|notenough|mptitleenhance|mptitleupgrade|fail|timeleft|paintCol1|paintCol2|bonexttries|bonexttries1|deequip|itemavai|itemequip|preset2|preset3|stats|repairon|repairoff|TROOPS|resources|Number|List|effects|than|Neutral|ITEM|Rule|next|Nome|Aggiorna|Aggiungi|alley|almeno|TRUPPE|SEZIONE|distanza|TRONO|effetti|solo|Nessuna|oggetto|ERRORE|Tipo|Intervallo|caso|AUTOMATICO|minimo|automaticamente|Geschenke|Senden|Neu|Suche|Gefunden|Keine|Botschaft|Anzahl|Effekte|Zeige|Wildniss|FEHLER|Nakliye|bir|iPTAL|rme|SAVUNMA|HABERCi|BASARIYLA|AYARLARI|TAHT|ODASI|BAKIS|DURUM|BULUNMUYOR|MAKSiMUM|ZAMANI|KSELTME|Entrenar|Opciones|autom|Ciudad|todos|Construir|nivel|debe|Configuraci|merci|minutes|faire|libres|plus|toute|Trouv|ATTAQUE|BOCompAttackIn|marche3|INFORMATIONS|timeRem|Stopper|SPAM|Global|ARTICLES|ALLIANCE|TRONE|GESTION|Dispo|che|cette|nourriture|affichage||Sans|sup|rieur||Hostile|Coords|FORETS|Wikia|1Cat|2nd|Manuel|garder|Route||Mode|fense|annuler|sec||GMT|Afficher|Audio|Minimum|animation|aetherstone|derniers|Good|Bad|your|Scout|Food|LIST|Stop|The|Disable|summary|Report|settings|coordinates|Popup|TeamWork|enable|display|buttons|change|higher|least|Invia|Ricerca|villi|tutto|addestramento|Sto|Selezione|alleati|Ferma|alleanza|oraria|Torre|ricerca|maggiore||Pubblica|Ripara|LISTA||Alle|Ziel|muss||Berichte||Nahrung|dem|nur|Gesamt|Produktion|Angriffs|Kein|hoeher|wird|Hier|Verteidigung|Einstellungen|Aktivieren|Ittifak|YARDIM|ASKER|TOPLAM|SAYFANIZI|TAMAMLANMISTIR|Bir|Savunma|BENiM|OLARAK|KOORDiNAT|ONCE|OTO|kuyruk|SOHBET|Varsa|Regalos|Vacas|Producci|TROPAS|miembros|LOS|encontrado|Parar|culos|defensas|objetos|distancia|Como|Nom|votre|Automatique|Vous|Inactive|Troupes|Restant|Marechal|ambassade|Unit|mettre||||recommencer|spam|Suppression|INVENTAIRE|STATISTIQUES|CARTE|Connexion|rouge|ralliement||rafraichir|recherche|Libre|OBSCURES|premiers|Farmtoggle|Trp|avec|Estimation|population|Annulation|SCOUT|fenses|wild|already|000|Facebook|post|avatar|TowerAlert|contributions|Card|Salvager|supprimer|suivant|nearly|REPAIR|requests|PRESET|Off|AutoCrest|AutoDF|click|f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAQfSURBVHja1JZdbJNlFMd|b1va9X03ugGDsVRYoqgJII6NCCjimJuwkUAYbmEZKIqEmMxoQBwGTIwSRV2EgA4YcAGRIB8BBDaBMAGHBj9QHGQITAZky7qVtuv6tmvfj8eLFrYr8GJceJLn5jnnOf|mfnEcSQvAwzcJDtocOIAE2IAkYNMC5NaDXBiT7v9nvTy0v4cLFNr5YV4fPFwDs|eIMDhxajre8FIBhu|dSMrcasParS2Pw8HSWFj|rkUaOZERVZZoNUGKXmuk5eJSJxQVs3b6YuiN|0trakSBnAAKbVUKZPh0Am1VixoyxiQZYAUHm6BHkZ0LK1ctYF5bizJkAVZWKBbDVuiYRc8gENtaS1H6bl0tzGf9UFh5PNx6PH48niBCgd3Whd3YiBHg8QTo6|Hh8YR4fk0GRuIXz919wznwRe84EamsbAWwWgJP1F9h1YxCdTzyNumc|4eMNzJo5jsVLXkDTrKhqFCFAqCoiHEYIUNUoMYtM2XNu8lsasUYipFYuIZCcxrYtZ9iz52yfijTN4HpzC59818oPo6bQc|4PvNVfM26UzMqqIkKhXkBgqiqmqgKCUKiXN8dZGXPueyw52bgWL|D0Tzd5b|lumppuYBhSvJ0Aum7S06Ph93ezY98d5Ldn87wcRP2tCff0qayrXogpwAgGATAFbF|71YS98A5|DxbmGv9m0|hgAaWkymha9J9PRdwKhVkeSgwcNtbdkTlxFBw7fX|sSRHtjDE1VsmwAnlkFOIcMweju|k8C9xTk3ddvdbmIJHLZAAxdR2trwwgEBmTCzFAI0|HoA0ivO4FTlh|4sP3JxwDIvHL9gbGRcBjS0||IAz|SuRtclgsEIABs3L|OV8lz0Ti|qmXPYMzPQsrMRptnXpi6VMaPT6N53GHtmBntvWqlcthmAwYOd2O30l6mEYZggBrFqTRmLynMJHTtJ55wFXDv7F||kvbU1wN|MHyB67gstXPLiKZ3Bny06m1XxI9Vt5JI9wo||sGmmbpAzCMKFlZbhoaV7Pq3QK8q9eirv2MptkLKTlFAhyEacZZiPjds5M|5uiZW7h3fsXQV8sorqulvnwYU|MnoWlaH0Bh4UTqG1aSmy7RXlSGdu0fduQtpXTTJTparmKaAtGPgQBMUxCJdDN||7gZWVh0k6fUKhu|qYeipOjYmX||K1iil9AOs3lGFraKBt3iJC2ZNYIefxeU0j1mgURUlBURxIElhkGYssI0mgKA4URUFWFLZtPU5R|pe0pmTg|vEI1hSZil|vacirevTDYRPnKZlbgUfHG3nVvOphEsCYoCB3|cj0BufTqfPRywWTtRnAHD|EWmTV7DR2vnM|9d5AP1cPZY5oEuIBHgNQBXjgB4Pbdjea4OxMDaDoQlf73v4p|BwAgir62|ncsQQAAAABJRU5ErkJggg|428854527154817|Help|Nothing|Reports|Automatic|reports|rallypoint|their|Start|End|Loading|Select|INVENTORY|Training|Effect|stones|order|Crafting|Hourly|search|larger|More|Levels|Lowest|enough|AUTOMATIC|assign|plz|also|Map|shortcut|Alert|Extended|Booster|mail|Bot|Tools|Scripters|who|success|failure|Big|these|Tabs|raids|DELETE|Corte|Inventario|Sintesi||Trasporti|Opzioni|Trovato|Livello|Attacco|Villo|cibo|MOVIMENTO|TORNEO|termine|lista|degli|raccolta|tutti|dal|Azione|torre|delle|Coordinate|Senza|FORESTE|OSCURE|automatico|sul|TRASPORTO|eseguita|difese|sulle|Eliminazione|Migliora|ultimi|Tentativi|Inventar|jetzt|Versuche|Speichern|Nichts|Farmen|Versammlungsplatz|Angriffe|mehr|Durchsuche|Ankunft|Zuordnen|Statistik|Laden|Sammeln|Versorger|Menge|Macht|Mauer|Aehtersteine|Reparieren|ndliche|Zusammenfassung|Verluste|Wichtig|Maximale|Truppenstaerke|Routen|eine|Unmoeglich|Automatisches|Angriffen|letzten|Artikel|Funktion|OtoBozkir|Bozkir|SCRiPT|YENiDEN|EDiLDi|icin|ara|TahtOdasi|SONU|MESAJ|Yeniden|Karanlik|STERiR|SEHiR|ETER|KULLAN|SON|Saatlik|retiminiz|SVY|BARBAR|SAYI|MiNiMUM|iSARETLENDiGiNDE|SADECE|YOLLA|HEPSiNi|BEKLENiYOR|Seviye|saldiri|vahsi|ELLE|iSLEMi|YAPILAN|KUTUYA|ALARM|AKTiFLESTiRiR|BASARILI|iSTEK|juego|restante|tica|Distancia||Mantener|ataques|tiempo|Ataque|enviado|curso|Los|espera|art||rdidas|mayor|xima|BOSQUES|Resetear|TRANSPORTE|transportar|Eliminar|cancelar|Mejorar|ultimos|Intentos|Attaquer|Court|heures|Aide|tect|charg|jour|Tps|Rest|Membres|devez|voir|pdr|donn|Diplomacie|Recherche|ECLAIREUR|Cible|Emp|Mon|ACTIVE|ont|POUR|SUR|COURS|Formation|dispo|Form|Mes|liste|Collecte|CONSTRUCTION|Totaux|construction|ARMOIRIES|Der|tous|cass|Effet||pierres|paration|article||TEST|Stock|Aut|Point|Act||8211|deux|SYNTH|rapport|sultat||Pertes|renforts|Envoy|avoir|point|libre|Methode|assez|onglet|Terre|inactif|Rapports|temps|chaque|Minimun|quantit|faut|maximum|incorrect|File|Const|pendant|Destruction|ass2|Note|Aethestone|Boite|production|cas|alerte|visible|liorer|messages|entrante|Volume|sactiver|smileys|ATTENTE|NON|CONSERVER|Salvage|file|Tent|Tournament|||Inventory|Gifts|Test||KofC|active|You|Finish|See||Farms|Checks|||Remaining||ATTACK|Reinforce|way|sent|Check|Your|AutoThrone|FOR|ROOM|broken|Knight|Result|Defense|Details|Leaderboard|should|Status|wilderness|wildreness|information|Duration|wait|defenses|Request|Guardians|etc|Smileys|Color|25x25|Gold|sound|FlashPlayer|persons|made|Thanks|Timer|Always|first|When|Define|Any|Create|Row|matching|rules|Unable|complete|Overflow|method|Regali|FARM|ore|Aiuto|||tentativi||Nessuno|Tempi||Modifica|Alleati|Rastrellamento|Dettagli|obiettivi|Attacca|Tieni|VILLO|ATTACCO|errato|Fine|Trova|Raccolta|Approvigiona|Totali|INFO|Ordina|SALA|oggetti|rosso|eterea|Riparazione|Produzione|Contiene|rapporto|Oggetto|rinforzo|Tutti|risultati|Obiettivi|attesa|SELEZIONE|OPZIONI|programmazione|Metodo|livello|Vedi|coordinate|tempo|programmati|Seleziona|Modo|supplementari||completa|annullare|Difese||sulla|regole|allarme||Minimo|Effetti|Salva|effetto|eliminare|AUTOMATICA|Thron|Spaehen|Optionen|support|advert|Hilfe|Aktualisieren|ein|musst|einer|damit|Inaktiv|beendet|Koordinate|HER|GESAMT|Verstaerken|gespeichert|Verstaerkung|Weg|wieder|gbar|Bev|tournament|TOURNAMENT|Punkte|Sortieren|Letzter|Ausr|sten|zum|FERTIG|anzeigen|Meine|Aktion|Anhalten|zwischen|sollte|Warten|Fehlerhafte|Meldungen|genug|frei|Staedten|Bitte|loeschen|Ausbildungen|kann|Erfolgreiche|mercenars|automatisch||Markieren|Bauwarteschlange|Nicht|geloescht|Das|Regeln|Erweiterte|ster|WhisperOnRed|StopRaidMes|Farbe|CoordBox|ber|Apotheken|Wiederherstellen|Objekt|Effekten|Genel|Hata|yeler|gerekiyor|sil|Benim|Kalan|Seviyesi|Takviye|ENEKLER|DEGiL|TiMA|TAKViYE|EGiTiM|fus|SARAY|iSTENiLEN|YADA|ZiYARET|MiKTAR|MALZEME|Orman|Tedarik|ZAMANLAMA|TASI|KULLANIMDA|ENEKLERI|Mevcut|iZLEME|asker|BULUNAN|ARAMA|KADAR|OLMALIDIR|SEHiRLERiNiZiN|SECiMi|YENiLE|ADETi|iCTiMA|GiRiLEN|SOVALYE|AYARLAR|sayisi|DAKiKA|iSTENMEYEN|AKTiF|NAKLiYESi|YAPILACAK|Imkansiz|tfen|birimleri|olustur|iptal|etmek|KAPALI|HIZLI|YAPMAK|BiLGiLERiMi|GELEN|SESLi|GELiSTiRiLMiS|ECZANE|SiLiNMESi|tiklerinizden|Tane|iSLEMiNiZi|KULLANIMA|OTOONARIM|ESTADISTICAS|Explorar|Bosques|horas|intentos|Miembros|estar|ver|Buscar|vez|Ataques|huecos|punto|Diplomacia|datos|Tropas|alimento|Flechas|Atacar|Reforzar|Alimento|guardar|Pob|Mis|Recursos|Seleccionar|nada|CONFIGURACI|Ordenar|rojo|Equipar|Acci|sin|resultados||Encontrados|marchas|Ocultar||pantalla|Sin|Estado|exploraciones|OPCIONES|Transporte|tipo|construcci|esta||Defensas|actualizar|informaci|fondo|encima|COLA|articulos|equipados|objeto|Statistiques|Cadeaux|Pharmacie|secondes|Actualisation|tentatives|outils|Source|Destination|Vers|Frigo|avez|besoin|finir|Diplomatie|depuis|jours|MAX|DEFENSE|Eclairer|Renforcer|Renfort|Sup|Heure|nom|IMPOSSIBLE|DANS|format|horloge|enregistr|Reconnaissance|cadeaux|membre|TOURNOI|Amis|cup|ration|LISTE|Ressources|lectionner|Rien|Actuellement|Poster|Rapport|Armoiries|AutoTrone|Quantit|DEFENSES|Capacit|casernes|DISTANCE|VILLES|vers|Trier|SALLE|articles|STOCK|EQUIPEMENT||parer|DETECTION|pierre|Chev|Pages|TOTAUX|Contient|Objet|Sujet|renfort|Entretien|Original|tableau|honneur|brume|mini|peut|ter|plein|cran||seulement|Neutre|Plus|cible|recherches|Niveaux|Priorit|chevalier|combat|terres|sauvages|sauvage|terre|coordonnees|informations|Duree|Appro|routes|ouverture|defini|secondaires||Routes|AJOUTER|transports|minumum|TRANSPORTER|ressource|maximun|destination|Tentative||||REASSIGNER|UNE|eacutelai|assignement|reassigner||patienter|divers|zone|rempart|atteindre||Actualisez|ATTENTION|24h|autoScout|MERCI|PAS|Informations|mentaires|Champs|Effectu|Configure||destruction||Avoir|minimun|sera|galement|fen||Actualiser|Mettre|minute|tchat|autres||gles|couleurs|diverses|chuchotement|Emoticones|Leaders|Couleur|global|forte|Flash|Message|mon|niveau|boost|Reinitialiser|suppression|BOT|KOCPowerBOT|POWERTOOLS|equipe|message|ces|Heal|raid|Puis|AutoSalvage|Qualit|SUPRRIME|Regle|ayant||qualite|dernier|superieur|Famille|supprim|Echec|FILE|REUSSI|Organiser|set|ORGANISATION|couper|AutoTrain|Cancel|Outils|attempts|Save|Player|Diplomacy|Attacks|Data|days||Upkeep|Target||Left|DEF|Reinforcement|Optional||Del|thank|its|available|Statistics|RETREVING|MEMBERS|Checking|Collect|Collecting|Done|Errors|STATISTICS|TRAINING||barracks|PROVINCE|CREST|CITIES|inventory|YOUR|sort|Aetherstones|Equip|fey|spire|Spire|Kni|Free|SYN||losses|NoSubjet|Losses|Lev|embassy|player|minimum||lags|Filter|Unaligned|Allies|Server|Skill|DARK|FOREST|User|tab|take|that|Supply|secondary|road|ADD|with|quantity|cannot|same|Attempt|seconds|ASSIGN|TRAVEL|Lock|Please|ended|AND|Wall|cancellation|current|this|trainings||begin|WAITING|Defenses||CLOSE|Not|deleted|game|Widescreen|Wide|Extras|Include|left|out|TChat|Research|Whisper|Own|Avatar||yourself|Buttons|URL|Alarm|Post||alarm|attacks|autothrone|||deactivate|Might||PRESERVE|having|Familly|REFRESH|Failure||QUEUE|following|over|SUCCEEDED|AutoPreset||desactivate|Movimento|Torneo|Log|secondi|errore|Nuovo|Rapporti|Residuo|Devi|utilizzare|funzione|vedere|libero|ALLEANZA|dato|Diplomazia||giorni|Verifica|Piuma|DIFESA|ambasciata|TOTALE|Spia|||Rinforza||Rinforzo|registrare|Formato|||riprova|inviato|Regalo|sono|inviati|RISORSE|Amici|indicizzando|Nulla|totale|Sei|globale|REGISTRO|Riassegna|Elmi|Cassa|STATISTICHE|||ADDESTRAMENTO||Costruzione|Num|caserme||Maresciallo||PER|GESTIONE|rotti|Precedente|Equipaggia|Cav|Cavaliere|Disponibili|Loro|Entrambi|TOTALI||resoconto|perdite|Perdite|superiori|marcia|rinforzi|sotto|nebbia|compreso|superare|intero|Filtro|Libere|Ostili|Neutrali||Inviare|coordinata|PROGRAMMAZIONE|SINTESI|SETTARE|Resetta|liberi|prossimo|dopo|Punti|disponibile|ELMI|Inattiva|AutoFARM|Automatico||Manuale|viene|invia|trasporti|Stima|movimento|Trasporto|volta|Attendi|popolazione|ATTENZIONE|inviare||giocatore|crea|mura||Campo|coda|costruzioni|manualmente|SELEZIONA|pubblicazione|minuto|sezione|produzione|coord|colori|bisbiglio|Colori|apertura|oro|selezione|nella|messaggi|Carica|Disattiva|eliminazione|Ringrazio|trono|Potenzia|IMPOSTAZIONI|tiene|tutte|avere||finita|EFFETTI|qualit|salvare|ultimo|Famiglia|RIPARAZIONE|RIUSCITO|spegni|Turnier|Hof|Fake|Apotheke|Konstruktion|Namen|Abbrechen|Aktive|Marsch||Dauer|Bearbeiten|Wiederholen|Such|Dioplomatie|Daten|Tage|Verbleibende|Unterhalt|TYP|ANGRIFF|Ich|Freie|Angreifen|ETA|Gespeicherte|ich|danke|Ihnen|sind|wurde|bereits|gesendet|Mitglieder|Ausb|Hoefe|Freunde|gefunden|sammeln|insgesamt|erhalten|KONFIGURATION|jedem|Ihr|INVENTAR||Stunde|Kasernen|Login||Staedte|Effekt|rot|Ausger|Ablegen|kein|Zerstoert|Bereit|Maersche|Arbeit|inaktiv|aktiv|Angreifer|Suchen|Treffer|Barbs|hast|deiner|liegen|darf|aus|Feindliche|Allianzlose|Entf|bis|haben|Zur|cksetzen|Halten|Punkten|meisten|durch|Zusenden||neu|Box|sekundaeren|Bestand|truppen|transportieren|ROUTEN|deine|ausgewaehlten|Vielen|Dank|Versuch|Sekunden|warten|Ausbilden|aktualisieren|Bevoelkerung|Warteschlangen|diesen|falsche|abbrechen|Soeldner|Abriss|Auftrag|Fenster|5000|Sprache|Meldung|Forschungshilfen|Waehlen||||auch|Nachricht|Wir|danken||Heilen|Eintrag|vorhanden|Sparen|Karte|Zeile|enthalten|erf|chsten|ERHALTUNG|Qualitaet|stet|loefschen|Automatische|Moefglich|nich|hoefher|||Upgraden||GELUNGEN|AUSR|STEN|einschalten|verwendest|Saray|Hediye|MIS|Eczane|OtoHaberci|veya|iSiM|DENENECEKTiR|AYNI|Otomatik|Raporlar|KALAN|tekrar|rmeyi|arama|olmasi|tima|sehir|Diploma|durumu|yok|fazla|birlik|SALDIRILAR|ilik|Sehir|Mesafesi|Buradan|ZAMANLANMISTIR|ALANI|MEVCUT|OLDUGUNDAN|YANLIS|YENiLEYiNiZ|NDERiLMiSTiR|HEDiYE|GONDERME|Hediyeler|TURNUVA|FUS|RETiM|iLE|BiLGiLERiNiZ|OTOMATIK|YELERi|ARANIYOR|BULUNAMADI||YAPILIYOR|NDER|NDERME|RESi|Egit|GELERiNiZ|Asagidaki|Saatte|Sayiniz|Maresalinizin|Seviyeniz|LiSTESi|Buraya|ittifak|Listele|ZELLiKLERiNi|BEKLEYEN|GELERiNiZi|KIRMIZI|RENK|VERiR|SEHiRLERiNiZDEKi|ONARIMI|IKAR|SEHiRDE|FEY|KULESi|Egitim|valye|Fark|Sonu|Birim|Rapor|gesi|BOZKIR|KARANLIKORMAN|NDERiLEN|TAKViYEDE|SAATLiK||DETAYLARA|ULASILIYOR|DETAYLAR|altinda|DURDUR|KUTUSUNA|DAN|GiRMELiSiNiZ|DEGERi|FAZLA|ENEKLERi|SAHiPSiZ|TARAFSIZ|SALDIRISI|Birlikler|iCERiGi|BIRLIKLER|SECENEKLER|ARALIGI|SUREDE|YUKSEK|SEViYELERE|DUSUK|SEViYELER|HATALARI|SALDIRILARI|KAYITLARI|AYRINTILI|RAPOR|Vahsi|otomatik|yeniden|Eger|inde|koordinatlari|Asker|Kata|KONTROL|zamani|YAPMAYA|CALISIYORSUNUZ|UYARI|ATAMA|EGIT|iCiN|egitim|Birlikleri|egit|yuvasi|Parali|OtoInsa|Insaat|Sirasi||olacak|KULLANIM|Isaretlendiginde||YENiLER|AYARI|BiLGiLERi|EDiLEN|YAYINLAR|iSTEKLERiNi|PENCERESi|AYARLARINI|ARKA|FON|RENGi|ESNASINDA|FISILDAMAYI|NETiMi|RAPORLARI|SiLME||SES|ALMA|ASKERLERiM|SIFIRLA||OTOBARBAR|TAHTODASI|OZELLiK||tiginiz|zellikden|Tanesi|GELERi|SiLiNECEK|OLAMADI|SIRADA|HERHANGi|DENEMELER|BASARISIZ|SONRAKi|ALINAMADI|iMKANSIZ|FONKSiYONUNU|MALISINIZ|minutos|segundos|Ayuda|Cancelar|encontr|carga|nuevo|estimado|Refrescar|Ninguno|Informes|Objetivo|Estad|sticas|otra|vacas||Queda|ATAQUE|defiendo|embajada|reuni|favor|reinicie||Refuerzos|han|disponibles|LAS|progreso|amigos|MIEMBROS|recoger|seleccionado|Colecci|todo|Reasignar|Aprovisionar|Art|INFORMACION||ENTRENAMIENTO|cuarteles|Puntos|Caballero|BLASONES|Desde|FUNCIONES|ALIANZA|Ultimo||Roca||Reparaci||Descartar|Marcha|Cab|Caballeros|Inactiva|Finalizar|Diferencia||Resumen|acampadas|NOTA|mostrar|despu|Detalles|Clasificaci|busqueda|nima|objetivos|Enviado|Inicio|exploraci|OSCUROS|ESTAD|STICAS|bosques|pto|reunion||Siguiente|primero|puntos|combate|Para|FUNCION|BLASONEO|pesta|blasoneo||tierra|Manual|sede|RUTAS|transporte|nimo|Estimaci|cantidad|Ruta|reasignar|poblaci|defensa|cancelaci|adicional|incorrecta||xito|CONSTRUCCI|Cola|refrescar|Ajustes|ventana|superior|marcha|alerta||publicaciones|Invest|susurro|Sonidos||informe|Publicar|mejoras|estas|redadas|Poder|Efectos|ados|calidad|ACTUALIZAR|eliminar|ESPERA|Solicitudes|siguiente|mejorar|CON|XITO||Imposible|funci|var|culang|Tournoi|Inventaire|Tester|Journal||AutoForm|Terres||Pour|soutenir|cliquez||pub|f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAGeSURBVHja1JYxjtNAFIa||sYfNQlYQDkBDxxXoWG3LETgDN|EUHIFi6204BlKQKBAKjmNvYs97byiS4BibFRMlBVPZY837|z229cjJFzjowzj7MDHOCBS|DRiWsHYOOBq5ubDz|zfFzM7e37B6t8efvur89efvr43APTLMu4vn511GtevXk9Ol|dfQaYesCLKE0TKIp74s63f|txS6NDshmTzE1AO8BVI26bqjrNllBrNf9e8BdXBBFYLfBhKBUVUtVNckAq|phcrwnqnYAEWW1WlOW62SArlbDyTzDgvQBZdkBUvZBy2ok|Bkm4RAgFMWG5XKTblFZDus7sPaPPZjPFxTFfTKgnX8bOjSr0ctJB2hbRWSbpnQJwzVRBJPs0KKAqscs|c8aRwCYYiH0LTJzmB2hYBfHHjQISuwAqopZjuoRveG36n32IlgkBu0rADuBRdv1URXTQwViZDlMp5P0hvLk8Qg1ErWLaQgiOK1GCywWiwcBy3bT7y79LzU44BnwApiduOEUwNd9R5vs7TrhEKBx||2p4tcAWS7l64CWshYAAAAASUVORK5CYII|142657062507166|Maintenant|Annuler|Une|erreur|estim||Nouvel|essai|REQUETE|arrete|Mettez|Enregistrer|Nouveau|KDO|AutoRapports|Editer|Fonction|Visite|parti|joueurs|Scanne|statistique|Cherche|encore|scannage|frigos|Joueur|Frigos|Farmer|rifie|rifi|pommes|VILLE|ARRIVEE|arrive|SANCTUAIRE|DEFENDS|EMBASSADE|NOURRITURE|MOUVEMENT|RAPIDE|Nourriture|proche|Favorites|Programmer||arriv|decrire|favori|LANCEMENT|EFFECTUE|part|Mauvais|ENVOYER|CADEAUX|Cadeau|Reviens|demain|Tes|PRATIQUES|PREPARER|but|Fin|chargement|VISITER|AUTOMATIQUEMENT|Annul|amis|rification|MEMBRES|collecter||Collecter|lectionn|collecte|Gain|Acceptation|Votre|SUIVI|ACTIVITE|JOURNAL|BOITE|Nettoyer|Autre|Reassigne|Approvisonner|ral|Acc|Coffre|Cour|Articles|gorie|PUISSANCE|LIENS|EXTERNES|NIVEAU|TECHNOLOGIES|ESTIMATIONS|FORMATION|Contremaitre|Politique|Ecurie|Atelier|Forgeron|maisons|CALCULATEUR|PROVINCES|NECESSAIRES|Vos|armoiries||VOTRE|Arriv|Class|Prendre|PIERRE|BLEUE|ACTUEL|Inverser|sens|quiper|dont||ALERTES|ATTAQUES|Recharger|Fausse|Dur|sente|Entr|bois|minerais|Chevalier|Travail|Eux|Nous|Fini|Different|Nos|Leurs|Diff|rence|puissance|perte|cot|objet|concernes|Resultat|Perdu|superieures|Inconnu|marche|vos|ambassades|Aucunes|actuellement||Actions|Coordonn|nouveaux|chez|dails|dtails|Tableau|sous|Centre|RECHERCHE|ANNULEE|maxi|passer|risque|navigateur|Cacher|permets|Filtre|Toute|Toutes|Sous|Allie|Statut|Connection|montre||resultats|jusqu|soit|Exporter|Lancer|Termin|Envoi|coordonnee|selectionnee|invalides|reconnaissance|Selections|SELECTIONS|DOMAIN|GERER|RAZ|Remise|compteurs|rsquo|Relancer|Passer|apr|essaies|Proches|lev|faibles|faible|haut|Forests|Obscures|ANNULER|PAR|UTILISATEUR|BARBARES|cibles||fait|attaquer|continuellement||Cela|vague|abandonne|cessaire|recommence|rifier|place|chateau|conquerir|Remplisser|||Sauvage|appuyer|Actif|Inactif|Approvisionner|Forcer|APPROVISIONNER|CONFIGURER|VOS||recalcule|TOUT|seul|eleve|provision|cessaires|Transporter|Activ|acture|activ||RAPIDEMENT|RESSOURCES|coordonn|choisies|exc|cocher|mes|transporter|effectu|Reassigner|ROUTE|Depuis|Verrouiller|valeurs|route|ROUTES|ENREGISTREES|FACILEMENT|fois|assignation|FORMATIONS|REMPARTS|enregistrer|prise|compte|Pourcentage|calculer|recalculer|Rempart|partie|fonctionner|Pret|base|LeaderBoard||donc|retard|brid|ABUSER|CETTE|FONCTION|Eclaireur|Entrer|Rechercher|joueur|suppl|ation|Former|construire||remparts|etre|former|autant|fin|ussie|partir|quel||voulez||PATIENTER|Remparts|||FERMER|Mercenaires|niveaux|doivent|manuellement|Fermeture|Optimiser|CHEVALIERS|Assignation|comp|tence|DEFINIR|OBJETS|CREER|Bienvenue|langue|chang|placement|Transparence|tres|duire|droite|Utiliser|large|compl|Modifier|Publier|Domain|personnalisable|raccourci|Onglet|eacutefenses|Inclure|marchants|Autonomie||gatif|inf|rieure|guardiens|autonomie|Aider|constructions|demandes|aides|liorations|cliquables|clique|chuchoter|fond|Changer|Taille|requis|Attention|visu|quand||bonheur||lection|rapide|renforcer|gestion|lecture|eclairage|Chargement|lecteur|Fichier|Charger|Jouer|peter|Perso|soi|Alerter|aussi|Alertes|fend|empennage|mar|chal|consommation|email|TOUTES|Couleurs|aux|auteurs||personnes|qui|apport|leurs|recus|reussite|AutoUpgrade|chec|croix|Sur|onglets|Deactiver|boutons|obligatoire|apres|changement|tail|RAVIVEMENT|ravivements|automatiques|Reprendre|envoyer||Minuteur|MARCHES|ACTIVES|SAUVEGARDE|sauvegarde|Historique|Toujours|Tous|ligne|gardera||regles|Effets|Aucuns|remplissage|Ordre|Villes|pleines|Maximun|ether|EFFETS|coch|conserver|identiques|sont|equipes|casses|paranthese|PREVISUALISATION|QUI|VONT|ETRE|SUPPRIMES|ACTUALISER|attend|Lancement|PROGRAMMER|STATUT|Tentatives|coup|Commencement|effectuer|dessus|Superbe|ussis|Suivant|ensuite|cela|passe|eacutequip|Puissance|REPARATION|SEULE|UTILISER|AVEC|Logs|Wilds|Support|advertisements|second|Now|Detected|occured|estimated|Try|REQUEST|Update|New|Edit|Rem|Function|see|other|players|Farming|Statistic|then|checked|Searching|low|CITY|WILD|Marshall|Fletch|INCOMING|arriving|SANCTUARY|EMBASSY|FOOD|WALL|Quick|Mouvement|Nearest|Saved|Program|Arrival|describe|favorites|processing|possible|try|Scouts|SEND|GIFTS|Come|back|tomorrow|Gifs|was|Population|VISIT|COURT|AUTOMATICALLY|friends|FRIENDS|Selected|gain|Resource|Allowance|Automatically|FOLLOW|ACTIVITY|LOGS|Clean|AutoTransport|AutoReassign|speed|Trunk|Quantity|Category|MIGHT|EXTERNAL|LINKS|TROUPS|LEVEL|TECHNOLOGY|ESTIMATES|BUILDING|capacity|BULDING|CAPACITY|TIME|Foreman|policy|Stable|workshop|blacksmith|houses|CALCULATOR|MAP|NEED|crests|Last|come|Classified|Showing|Take|Equipped|Invert|Repairing|UnEquip|including|ALERT|Reload|False|Playing|since|Wood|Stone|Ore|Labor|Them|Both|Difference|difference|loss|sides|bonus|Searched|Lost|citye|Troop|reinforcement|moment|Usage||KOCto|correctly|Find|details|leaderboard|Misted|Center|canceled|does|causes|browser|slows|down|hide|Order|Only|Mist|Friendly|Displaying|results|until|finished|Export|Amount|Sent|did|enter|invalid|Sanctuary|Lvl|Units|RESET|Skip|tries|Method|High|Low|Preferred|Highest|knigth|Canceled|BARBARIANS|atack|constantly|abandon|necessary|begins|Verify|castle|conquered|Fill|None|Active|Force|roads|SUPPLY|CONFIGURE|This|recalculates|ALONE|opening|box|most|raised|reserve|kept|Necessary|Available|Trade|Road|Actived|Deactivated|QUICKLY|RESOURCES|resource|chosen|units|transported|exceed|selected|Made|beginning|travels||From|Deadline|values|travel|RECORDED|EASILY|BUILD|DEEFENSES|miscellaneous|Intervalley|Percentage|default|calculate|recalculate|everything|cancelled|use|feature|ready|Gamer|Contains|Additional|Defences|wrong|amount|train|finish|Successful|How|many|want|Cancellation|THANK|YOU|Line|walls|field|Mercenaries|Building|Cities|Tried|building|happens|window|closed|times|Management|Assign|Skills|STATISTICAL|Have|Welcome|Language|language|changed|allow|Drag|Drop|transparency|Reduce|Right|Height|Publish|Customized|defences|marching|RED|run|less|Hide|Remove|Rules|Functionality|clickable|Coordinates|Colours|Backgrounds|Leader|Tchat|Background|Size|when|happiness|Movement|Tower|loading|Load|Repeat|whisper|troop|count|Fletching|without|Dont|Embassy|colors|gifts|inbox|reinforcements|successful|Activate|incoming|APOTHECARY|REVIVING|reviving|Resume|RAIDS|SAVING|Quality|History|EFFECTS|PRESERVED|marked|has|preserve|three|destroyed|got|never|effect|brackets|DISPLAY|WHO|ARE|GOING|DELETED|action|deletion|SCHEDULE|STATUS|INFORMATION|Attempts|OFF|line|Beginning|make|Wondrous|list|succeeded|Aetherstone|ongoing|Next|passes|EQUIP|Fit|Out|avalaible|fit|currently|settled|ORGANIZATION|standby|ONLY|USE|WITH|Statistiche|Alleanza|Farmacia|Sostieni|clicca|link|f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAGeSURBVHja1JY7chNBEIa|GY2xsCmMUwofgQtQPgMZAQE3IeIsVEHGKSgO4sIOcMlopV3tox8Elkor76LSghS4w97p|fbvx8wEd|eQFjmwHRwQgASMgaM9790AZQKevfv26W4UQ|qL28|bt3l5v2Hv357|fXzeQJOYwhcvnq9qWtHG1|6fWX338AnCYgqSm1NkyrHF|uv2tv2a9bANrdGM|eY2YAKQE0buRSUkg1ONFWLDo|P3qCi8CywKgqRV2R1|VggOd515cSLroGiAnzesG8XgwG6HzWBYwipi0FokJWF2RNMVxBNu|6QsTqZg1oVJk2BVk9HGBZ1jtcGzUQFa5nt0yrfPg0|bzuSVuOjo83AQqr1hoooSdGBa1jCyCKxIA9PFnDPwJE8dCugQnuI4wHi3eYNjftMlWwZfASoASLmPn6r3ceZW8F3J8BwRxz3azBiHivwP|nBr6SgFtLgZkRHU7SePiFcvK0J2|OtwatEVNk1j8Dk8lkK2BSbj1emgCcARfAiz1fOL|Bq9WNdrxK1x5NgCo8|lfFnwEABhrmQSenkh4AAAAASUVORK5CYII|367345943338098|minuti|Adesso|Annulla|aggiornamento|stimato||tentativo|RIPETUTO|blocco|Registra|Tutto|Msg|Origine|Meta|Impostazioni|Inattivi|ancora|Finisci|rastrellamento|Distaza|LdR|GIOCATORE|DIPLOMAZIA|DIST|COORD|Obiettivo|Farmare|giocatori|inattivi|controllo|impiegare|Ricerco|bisogno|Resta|Bilancio|ESPLORAZIONE|TERRA|Maresc|ARRIVA|SANTUARIO|nessuna|AMBASCIATA|CIBO|residuo|Cibo|vicino|opzionale|Gruppi|preimpostati|attribuire|Programmare|Orario|arrivo|Attribuire|nome|INVIATO|IMPOSSIBILE|Partenza|impossibile|ora|Esplorazione|inviata|ATTIVO|REGALI|Riprova|domani|tuoi|regali|oggi|gia|stati|alleato|SEZ|PREPARAZIONE|INFORMAZIONI|SUL|CORRENTE|Inizio|Popolaz|addestra|caricamento|RECUPERO|camerati|amici|ALLEATI|Alleato|Risorse|Raccogliere|selezionato|conrso|Posta|tuo|LOG|EVENTI|Pulisci|Altro|generico|velocizza|combattimento|Articoli|Categoria|POTERE|INVENTARIATO|COLLEGAMENTI|ESTERNI|LIVELLO|RICERCHE|STIME|FORMAZIONE|DIFESE|Addestramento|orario|Politico|Stalla|Laboratorio|Fabbro|case|Calcolatore|distanze|MAPPA|STEMMI|NECESSARI|Stemmi|raccolti|SULLA|TUA|ALLEY|Ultima|connessione||Arrivo|Classe|Effeti|Rifornimento|ETEREA|EQUIPAGGIAMENTO|ATTUALE|Riparare|Qualita|Diseguipaggia|Disponibile|articolo|rotto|TORRE|GUARDIA|Ricarica|Falso|Durata|trova|questo|Entrato|Marce|Produtione|legno|pietra|minerali|Dif|Marcia|Punto|Att|Lavoro|Inttiva|Pagine|Noi|Differenti|Anteprima|anteprima|Nostre|Differenza|poteree|perdita|entrambi|Rapporto|Cancella|inerenti|Alcun|risultato|Risultato|Ignoto|inviate|ricevute|truppa|attualmente|partite|VouRiaggiornare|nuovi|dettagli|classifica|Classifica|Centra|RICERCA||ANNULLATA|Altimenti|siete|perdesi|permette|schermo|Tutte|Sotto|Maggiori|Stato|Connessione|tabella|mostra|primi|fino|Esporta|Inviato|Finire|uno|trovata|errate|Opioni|DOMINIO|RESETTA|Distanza|Passa|prossimit|liv|crescente|decrescente|cavaliere|crescenti|decrescenti|Foreste|Oscure|disponibili|ANNULLA|UTENTE|BARBARI|sull|Sezione|attaccare|continuamente|Eseguito|ondate|abbandona|terra|riparte|Assegnare|Premere|arco|mancanti|Assegna|destinazione|movimenti|APPROVVIGIONAMENTO|CONFIGURA|VILLI|determinato|automaticemente|riavvio|determina|Quartier|Generale|necessarie|OPTIONI|AGGIUNGI|Trasporta|Attivi|CELERE|inserisci|carico|massimizzato|trasporto|trasportabili|risorsa|trasportare|verso|stesso|eseguito|reinizia|Riprovo|PROGRAMMATO|PROGRAMMA|Dal|Mantenere|MOVIMENTI|PROGRAMMATI|MANUALE|riassegnare|piu|Riassegnazione|CENTRO|RECLUTE|Altre|opzioni|aggiornare|caricare|Percentuali|defoult|impostare|Ricalcola|parte|membri|pronto|basano|server|aggiornata|prima|impostato|ABUSARE|DELLA|FUNZIONE|spie|Addestra|monta|trouppe|addestrare|montaggio|Ora|fine|vuoi|quella|annullando|Aspetta|posso|Nivello|CHIUDI|Imposta|mercenari|Costruisci|Edilizia|popolare|EDILIZIA|Programma|MURATORI|LAVORO|costruendo|durante|demolizione|bastano|Demolizione|devono|edificarsi|chiude|DEI|CAVALIERI|Assegnazione|punti|GLI|OGGETTI|FORGIARE|Oggetti|forgiare|Benvenuto|Lingua|riavvia|settaggio|Posizione|finestra|Transparenza|Ridurre|nei|Schermo|destra|Autore|Mappa|larga|mappa|orologio|carica|Pubblia|Domini|personalizzabile|Abilita|collegamento|Linguetta|Moostra|Includi|Visualizza|Autonomia|negativo|inferiore|Guardiani|Attia|autonomia|Aiuta|ricerce|richieste|aiuto|migliorie|altro|Suono|SPIATA|Colora|sfondo|Cambiare|proprio|TImmagine|Attenzione|vedi|migliora|visualizzazione|altre|funzioni|gioco|Raccogli|celere|sirena|lettore|Usa|suono|Gioca|Ripeti|allerta|Messaggi|Personali|medesimo|Allerta|difendo|mia|difesa|mio|consumo|Boost|Difesa|accampate|passive|resetta|regalo|autori|MadMaxx|versione|italiana|coloro|vario|titolo|hanno|collaborato|Grazie|messaggio|quando|implementa|Disabilita|animazione|successo|fallimento|grande|rossa|suoni|faccine|Sul|citta|secondarie|Attacchi|entranti|queste|menu|video|FARMACIA|Cura|Minerali|tenere|ATTESA|RICOVERO|ricoveri|Riprendi|sui|MARCE|ATTIVE|Cronologia|dove|immagazzinare|Tenere|primo|Quando|pieno|deposita|sugli|altri|Definire|carta|Regola|Aggiungere|riga|Caricamento|conto|nell|Elimare|regola|dell|pieni|etera|quasi|puo|salvato|Attendere|deposito|Sequenziale|Uniforme|Capienza|massima|SALVARE|superiore|Conserva|spuntato|comunque|uguali|saranno|eliminati|equipaggiate|rotte|eliminate|parentesi|ANTEPRIMA|DELLE|ELIMINARE|attendo|fallita|merda|IMPLEMENTAZIONE|DEGLI|STATO|programmato|effettuati|falliti|Potenziamento|Miglioramento|chiuso|Procedi|alzare|oltre|Prodigioso|riuscito|Eterea|suff|MIGLIORAMENTO|POTENZIAMANTO|FALLITO|passa|successivo|Sposta|EQUIPAGGIA|Organizza|equipaggiato|attuale|Potere|riparazione|USARE|Bewegun|Logbuch|DarkForest|Std|Sek|aufgetreten|Versuchen|Query|erfolglose|stoppe|Berichten|Restzeit|Roundup|angehaeren|andere|sehen|FARMEN|Detalis|erst|angezeigt|koennen|Freihalten|Stunden|eingesetzt|Kontrollieren|Mein|hat|wenig|HEILIGTUM|WILDNISS|Marschall|Befl|Eindringenden|glaube|verteidigen|verteidige|BOTSCHAFT|TRUPPEN|NAHRUNG|MAUER|Entsenden|nachbar|einen|setzen|Ihre|Favoriten|beschreiben|Verarbeitung|UNM|GLICH|moeglich|schlechte|Format|versuchen|erneut|unterwegs|AKTIV|Jetzt|verschicken|Geschenk|Kommen|morgen|geschickt|verf|Turniere|Startet|Endet|Verbleibend|beim|Besuchen|Stornieren|Spielern|Freundes|Hoefen|SPIELER|Woehlen|ausgewaehlt|alliierten|stoppen|Gewinn|globalen|Event|AutoThron|Allgemein|Speedups|Schlacht|Truhen|Artikle|Kategorie|Links|Technologie|Ausbildungs|gesamt|Meister|Stallung|Werkstatt|Schmied|tten|Entfernungs|Rechner|Landkarte|bersicht|IHRE|ALLYANZ|Erstellt|Pos|gebrochen|stete|Reihenfolge|umkehren|Platz|reparieren|Spielt|seit|Holz|Stein|Erz|akt|Seite|Typ|uns|beide|Suchbegiff|unsere|deren|Unterschied|Verlust|beiden|Seiten|Fundsachen|Bonus|finden|Betreff|Durchsucht|Verloren|unbekannt|Verteidigungs|Verbrauch|Orginale|Refreshen|Richtig|Angzeigt|Finden|Nebeltrank|Startpunkt|Abgebrochen|verursacht|Browser|verlangsamt|einblenden|Wildnis|Nebel|Alliierte|Ergebnissen|Frei|Exportieren|Ziele|Gesendet|Starten|freien|Steckplatz|Angabe|koordinierte|KONFIGURATIONS|Auswaehlen|freihalten|berspringen|versuche|hohe|niedrige|Bevorzugter|wenigsten|Abbruch|WAPPEN|SUCHEN|HILFE|halten|erstellt|Wildnisse|anzugreifen|Wellen|Aufgeben|immer|Also|sei|sicher|FREIEN|SLOT|deinem|Einfach|eintragen|Button|stellen|Befliedern|N2nd|Versor|Zwingen|allen|Stra|Verwalten|Werte|automatik|Diese|berechnet|allein|ffnen|Hauptquartier|Minuten|angehoben|definiert|Benoetigte|Ainzengen|Verf|jeden|koefnnen|Transportieren|aktiviert|deaktiviert|verschieben|Ressource|Einheiten|Schaetzung|transportiert|denselben|Maschieren|Beginn|Zordnen|NEU|ZORDNEN|zuzuordnen|wurden|Zugeordnet|Kaserne|Sonstiges|Prozentsatz|standardmae|Zone|Einheit|berechnen|Neuberechnung|alles|maximal|erreichen|Unfaehig|Baue|Verteidigungsanlagen|Mitglied|Nutzen|Allianze|Zusaetzliche|Informationen|hinzuf|Schlange|tun|auszubilden|fertig|Geschaetzte|Aufhebung|welchen|sollen|abbgebrochen|Derzeitige|Stornierung|aktuellen|bitte|Linie|Ebene|Waenden|Verteidigungen|Feld|SCHLIFLEEN|Konfigurieren|BAU|bau|ausbauen|gend|habe|versucht|Gebaeude|bauen|melden|dies|geschieht|geschlossen|Zeiten|Bauweise|Fertigkeits|zuweisen|Weise|Fertigkeiten|gemacht|Turm|Herstellen|Aktualisiert|Willkommen|Spiel|ebenfalls|geaendert|Verschieben|erlauben|Transparentz|Verstecken|Rechts|Hoehe|Uhrzeit|Minute|Aktiv|Anfragen|Pinwand|veroeffentlichen|Kundenspezifische|Marschierene|Auszubildene|Rot|Wenn|noch|Nahrungs|helfen|Entfernen|Funktionen|klickbare|Farben|Zeigt|Stoppen|Verb|ndeten|angegriffen|Dies|verstopfen|hrung|Hintergrund|Groe|dich|Weitere|Bewegung|Wachturm|Lautstaerke|Ausschalten|dauer|Eigene|stern|Befiederung|ohne|Zeigen|Setzt|Taste|Posteingang|Aktivitaet|Personen|ihren|Beitrag|geleistet|dir|senden|sie|erfolgreich|Deaktivieren|voreingestellten|eingehenden|heilen|Fortsetzen|Laufende|gespeicherten|Verlauf|LOESCHEN|stadt|Laugerung|Erste|Bewahren|Aendern|Limit|erreicht|Schreiben|Alles|Regel|erstellen|Prozedur|cksichtigt|Nein|BEIDE|Reghel|Bergung|Elemente|Kaine|llt|Bedingungen|arten|zur|fung|Staedt|voller|schung|Ende|Zyklus|Overflowmethode|Stadtordnung|Niedrigste|Hoechstzahl|Behalten|MIT|markiert|VOM|Karten|gleichen|hoehere|Familie|Loesch|entfernt|geloefscht|nichts|wir|Loefschung|fehlgeschlagen|Warte|eingeschaltet|beginne|Naechsten|Qualitaets|Stufe|gelungen|Scheitern|verbleibende|laufend|naechste|spaeter|wechselte|naechsten|letzte|ausger|aktuell|ausgewaehlte|DER|laufen|Reparatur|Standby|Zerstoefrten|Auf|Tahtodasi|Turnuva|Otomesaj|Envanter|Bilgi|Deneme|OtoEgit|OtoKaranlik|OtoSaldiri|Ayarlar|Saat|Dakika|Saniye|simdi|NCELLE|NCELLEMEDEN|KLENEMEDI|SAYFANIZ|YENILENEREK|BIR|TESPiT|TAHMiNi|YENiLENiYOR|SEFER|OLUSTU|SCRiPTi|NCEL|TUTUNUZ|KAYDET|YENi|sey|HEDiYELERi|Silme|ZENLE|BURADAN|BURAYA|malzeme|cektiginiz|kaleler|baska|oyunculari|arayabilmek|ittifaka|olman|ayarlar|oynamIyor|rebilmek|resi|bitmis|mesafesi|RaporlarI|Kale|seviyesi|aralik|Alaninda|Istenilen|Boslugu|Belirtiniz|oyuncu|Itti|ismi|saldIrIlar|nden|oyuna|girmediyse|her|saate|rmek|hata|bulundu|Arama|Gida|ihtiyaci|retim|SEHIR|maresal|Hedef|iligimin|ULASIM|geldi|Ben|ikmayiz|ben|savunmak|kel|olmadan|iligimde|Anda|KEL|ILIGI|GIDA|Haberci|Yakyn|ISTEGE|ZAMANLI|Zamani|Sik|Kullanilanlara|Ekledikden|Sonra|islem|Yapabilirsiniz|SEViYESi|DOLU|GER|EKLESEMEDi|DiLiMi|Kaydet|TFEN|ZAMANLA|UYELERiNE|Yarin|gel|zaten|nderildi|nderdi|Hen|iLGiLi|DETAYLARI|Baslangi|Bitis|Egitimdeky|Birimleriniz|Kullanabilir|kleme|Hatasi|ZIYARETi|yeleri|Arkadaslarim|Kaldir|ARKADASLARINIZ|ULASILAN|LiSTENiZ|DOGRULANIYOR|LiSTELENEN|LAR|ZiYARETiNDE|ERiK|ARKADASLARINIZI|BiRSEY|MEDiNiZ|ARKADAS|TOPLAMDA|TOPLANAN|EDiLMiSTiR|ALINAN|SOHBETE|EVRENSELE|MESAJI|OTOMESAJ|TAKIP|FAALIYET|Sil|Ata|ENVANTERDEKi|Hizlandirici|Savas|Donanimi|Kaynak|Sandik|Ogeler|Kalite|Kategori|KAYNAKLAR|BiLGiLER|ARAsTIRMA|EGiTiMi|CETVELi|Egitilmesi|Insaasi|Kisla|Kislalarinizin|Deneyimi|Makul|lye|Sevyeniz|Demirci|Kul|HESAPLAMA|ViLAYETLER|HARiTASI|TAPULARI|ELDE|ETMEK|GEREKLi|ARMA|RLERiNiZiN|ENVANTERiNiZDEKiLER|Koordinattan|Uzakliginiz|Budur|UYELERi|Uyelerini|sirala|UyeLeri|Son|gelmek|Seri|GELERiNiZE|GELERiNiZiN|TiGiNiZ|ZELLiGE|iMi|STOGUNUZ|GELER|MeVCUT|TERS|KSELT|iYiLESTiR|Onarim|Bekliyor|SAHTE|ncelle|Sahte|ZLEM|OLDUGU|IlERLiYOR|Yiyecek|Kereste|Tas|Cevher|Gider|Ilerliyor|Alani|Maksimum|ncel|iler|Onlar|Sayfa|erik|Saldiran|Sizin|Ikiside|Islem|Basariyla|Tamamlanmistir|eren|Diger|KaranlikOrman|TopluG|sterme|lari|Ayrintilar|Bizim|Kayiplarimiz|smanin|Kayiplari|Arasindaki|Kayip|Bulunamadi|Raporlamasi|Detaylari|Bulunan|Bulunmadi|Ilgili|Raporlari|SIL|lar|Bulunanlar|kayip|Zararlar|ALN|BiLiNMiYOR|iLERLEYEN|BiRLiK|VALYE|SEHiRiM|BiRLiKLERi|BiLGi|ASKERLERiNiZiN|ASKERiNiZ|NDEREN|GiDER|BAKIMI|GERCEK|SAYILARINI|dikkat|yenileme|dogru|stermek|ARASINDA|LiSTELE|SiSTE|sis|MERKEZ|ARAMAYI|dan|MESAFEDEN|MEMELiDiR|AKSi|TAKDiRDE|FiREFOX|KME|HATASI|ALABiLiRSiNiZ|YANDAKi|KUTUCUK|GiZLENiR|BOZKIRLAR|SIRALA|SMAN|iTTiFAKSIZ|SEHiRLER|SMANLAR|SiSTEKiLER|TTEFiKLER|DOST|iTTiFAKsiz|GiRiS|TARiHi|LENEBiLiYOR|SONUNDA|LARI|SONUCLARI|GONDER|NDERiLDi|Launch|TAMAMLANDI|ALANININ|BOSALMASI|iLMEDi|KARANLIK|ORMAN|Secenekler|nder|YENiLEME|SURESi|ARANILACAK|iHTiYAC|DUYULAN|BOSLUGUNU|BELiRTiNiZ|YENiLENiR|DENEME|GIRISIMI|SEKLi|YAKINDAKiLERE|ALAN|KULLANICI|TARAFINDAN|GOSTER|YOLLAMA|ALANINDA|BIRAKILMAK|BOSLUK|ADETTiR|Yardim|sekmesi|rekli|dalga|gerekli|terk|baslar|fethedilmesi|gereken|kale|cretsiz|oldugunu|dogrulayin|doldurun|koymak|Daha|bilgi|Esas|Zaiyatiniz|OkYapimi|1Kata|GiRiSi|YAPMADINIZ|saldirisina|hedef|Aktif|Pasif|TEDARIK|yollarda|zorla|TEDARiK|AYARLAMALARI|DOLDUR|Zamanlama|ZEL|FONKSiYONUDUR|UNUTMAYINIZ|TEDARiGiN|ARALIGINI|UZERiNDE|HESAPLAR|Edilecek|Nakliyesi|Yapilmayacak|Miktar|Ihtiyak|duyulan|SECENEKLERi|Kayitlari|goster|Sahip|AYAR|kontrol|araligi|nakliye|birimi|adeti|Maks|Kaynaklar|TASINMASI|AYDI|NAKLiYELERiNiZ|PASiF|Koordinatlar|ASAGIDAKi|RESiMLERE|TIKLAYARAK|MALZEMEYi|BELiRTMELiSiNiZ|TASINAN|Miktari|asamaz|Hayir|CESiDiNi|SECiNiZ|DiKKAT|SEHiRiNiZE|KOORDiNATINA|LUTFEN|iKi|DAKiKADA|ata|GORUNTULE|atama|araligini|belirtiniz|Girilen|Degerleri|Sabitler|KAYDEDILMIS|SEYAHAT|atayin|daha|bekleyin|atamak|sona|erdi|EDiLiR|YENiLEDiGiNiZDE|OLACAKTIR|NUFUSUNUZLA|KIYASLAYARAK|DiZiNi|OLUSTURUR|HESAPLA|ADETLERLE|SAVUNMANIZDA|EKSiKLERi|TAMAMLAR|EGiTiMDE|BiRiMiN|EGiTiMiNE|VERMEK|OLUR|kuyrugu|Yenile|savunmalar|insa|Diplomasi|zelligi|kullanmak|Izci|zetle|bul|Kullanici|bilgiler|ekle|Egitilecek|Yanlis|tarafindan|yapmak|zere|yuvalari|yanlis|miktarda|antrenman|yapamaz|maks|Bitmis|bekleyen|Sonuna|Zaman|Egitimler|Basarili|Yenileyin|baslayacak|Iptal|istediginiz|nasil|aktif|yuva|iptali|BEKLEME|TESEKK|EDERIM|Sona|birliklerinin|Hatti|Duvarlarda|Sahada|Savunmasini|Insaati|Askerler|INSA|INSAAT|Yeterli|kaynak|Zaten|Kuyrugunda|Yikim|Kuyruk|silindi|olusturmaya|alistik|bina|olursa|bildirin|pencere|saniye|kapali|kat|siralama|tip|insaat|BECERiLERi|BUTONLARI|ARTTIRILAN|BECERi|PUANI|ZANAAT|RETIM|erigi|toplam|NEMLI|zelligin|alisabilmesi|BESBIN|Olmasi|Gerekmektedir|karsilama|Yapilandirma|LiSANI|Oyunun|dili|degismis|Pencereyi|Hareket|Ettirebilirsiniz|PENCERELERIN|ORANINDA|SAYDAM|OLMASINI|SAGLAR|GiRiLECEK|SEKMESiNDEKi|KAYNAK|MiKTARLARINI|KISALTIR|EKRAN|BiCiMi|PENCERESiNi|SAG|TARAFA|TASIR|KSEKLiK|HARiTAYI|GENiSLETiR|HARiTADA|DETAYLI|LER|CAMELOT|ZAMANINI|ALISMAYI|DURDURURSA|iNDE|INSAT|ARASTIRMALARDA|iSARETLENMELiDiR|KiSiSELLESTiRiLEBiLEN|SAYFANIN|LINKINI|GiRiNiZ|YAPILANDIRMA|ASKERLERi|BiRiMLERiNi|STEKi|BiRLiKLERiNiZi|STERIR|EGiTiLEN|iNSAA|SAVUNMALARINIZI|GiDERiNiZ|KRiTiK|SEViYEYE|ULASTIGINDA|iKAZ|YAZISI|FONU|OLMASI|iSTENiRSE||KiSiSEL|SOHEBT|YiYECEK|SIKINTISINI|iTTiFAKA|YAYINLANAN|PENCERESiNDEN|GiZLER|KALDIRIR|GELiSMiS|UYGULAR|FISILDAYAN|OLURSA|FISILTI|ttefikleri|iseniz|kret|Durdur|rapor|yapismasina|neden|degil|iFADELERi|SOHBETiNDE|NETiCiLERi|RENKLENDiRiR|RENLENDiR|EVRENSEL|PENCERESiNDEKi|AVATARINIZI|DEGiSTiRiR|boyut|iKON|SiZE|RAPORLAMA|RAPORLAMASINI|KENDi|RAPORLARINIZIN|DIGER|ALARMIN|ALISMASINI|ISTEMNEDIGINIZ|SEHIRI|INIZ|OYUNDA|HANGi|KALMISSANIZ|ORADAN|ILISI|YAPAR|VERGi|TOPLAYARAK|ALTINI|ARTIRIR|MEYDANI|NDE|BUTONLARINI|EKLER|ALARMI|AKTiFLESTiR|LINK|SESi|AYARLANIR|KLEYiNiZ|DOSYASI|KLENiYOR|SUSTUR|TEKRARLAMA|SOHBETiNE|YAZISINI|YOLLAR|iTTiFAKa|KENDiNE|FISILDAYARAK|ikincil|sehirlerde|ASKERLERiMi|iLiK|AYRINTILARINI|MARESALiMIN|SEViYESiNi|STERiLSiN|GiDERiMi|DURUMUMU|SIRASINDA|DURDURULSUN|MAIL|SIGINAKTA|YOKSA|SAVUNMADA|ASKERLER|BiRiMLERiM|MESAJLARINI|Birliklerin|bulundugu|kooru|SiZiN|SiZDEN|Mesaj|ndermek|basarili|tahta|eger|nceden|etkinlestirin|gelen|saldirilarin|raporlari|SAKLAMAK|ALTIN|MiKTARI|YARALI|BiRLiKLERE|BiRiMLERE|DUZENLE|KAMPLARI|ALISAN|KAYITLI|ResetTimer|YENiLENDi|KALiTE|MiS|iLENLER|SiLiNMEYECEKTiR|DAHA|KSEK|SEViYEDEKiLER|ZELLiK|KORUNAN|GRUPLARI|Kurtarmak|benzer|etkileri|olan|kartlari|iSTENMEYENLERi|iSARETLENDiGi|HALDE|SiLiNEMiYOR|iSE|OLABiLiR|ONARIMDADIR|iSARETLi|OLANLAR|KORUNUR|SiLiNMEZ|GRUP|Taht|Odasi|geleri|SiLinenler|Listesi|SiLiNEN|OGE|FONKSIYONU|BiLGiSi|SIRALAMA|DENENiYOR|SIRADAKi|iSLENiYOR|GELERiNi|SEViYEDEN|YUKARI|KSELTEMEZSiNiZ|GELERiNDE|DEN|BASKA|YAPILAMAZ|TAMAMLANAN|iSLEMLERiN|AYRINTILARI|YETERLi|TASINIZ|DEVAM|EDiYOR|DENEMESi|ADET|YUKARIDAKi|KUTUCUGA|GiRDiGiNiZ|DENEYECEKTiR|ARDINDAN|SIRAYA|ALDIGINIZ|iSLEME|ECEKTiR|SIRANIN|SONUNA|NCEKiNi|HAFAZIDAKI|DONANIMLARI|AUTOPRESET|KULLANILAN|GELERiNE|ONARIN|yada|Movimiento|Registro|Hospital|Blasoneo|Tierras|AutoVacas|Oppure|Ahora|detengo|Hay|nueva|versi|Nuevo|Todos|Editar|Funci|Debe|otros|jugadores|Inactivo|necesario|finalizar|Jugador|Vaca|inactivo|comprobado|Cheques|enviar|Encontrado|poco|EXPLORACI|CIUDAD|Mariscal|LLEGADA|llega|Defiendo|Ninguna|EMBAJADA|COMIDA|Restante|DEFENSA|MOVIMIENTO|RAPIDO|TROPA|cercana|refuerzo|opcional|Programar|Hora|llegada|Pon|nombre|favoritos|lanzado|IMPOSIBLE|reloj|mala|guardado|Explorador|ACTIVA|Vuelve|ana|Sus|regalos|sido|enviados|INFORMACI|CURSO|Empieza|Termina|TimeRem|VISITA|CORTES|AUTOM|TICO|Amigos|Comprobando|comprobando|Comprobaci|encontrando|Recoge|colecci|terminado|Creaci|colecciones|Automaticamente|postear|ACTIVIDAD|SEGUIMIENTO|Errori|Transporto|Blas|Aceleradores|Combate|Articulo|Cantidad|Categor|Poderio|ENLACES|UTILES|LABORATORIO|ALQUIMIA|MURO|Capataz|Establo|Taller|Herrer|caba|CALCULADORA|DISTANCIA|MAPA|PROVINCIA|RESUMEN|SUS|acceso|Creado|clasificados|SALON|GESTI|rotos|Efecto|ROCA|ARTICULOS|EQUIPADOS|Invertir|orden|Disponible|culo|roto|ALERTA|PRUEBA|detecci|falso|Duraci|Jugando|desde|madera|piedra|mineral|Huecos|Trabajador|Ellos|ginas|Nosotros|Ambos|tus|enemigo|poderio|rdida|ambos|lados|encontraron|resumen|Objeto|Informe|objecto|argomento|Resultados|Perdo|desconocido|enviadas|reforzar|estacionadas|Acciones|Coordenadas|Enviato|Mantenimiento|origen|Tendr|recargar|quedan|batalla|Bustando|Buscando|niebla|cancelada|provoca|tarde|mucho|navegador|pare|ajustes|permite|Todas|Hostil|Todo|hostil|Niebla|Aliados|Amistoso|Conexi|Mostrando|hasta|Exportar|Esperando|introducido|ninguna|lidas|Selecciona|SELVA|OSCURA|ATAQUES|ELEGIR|SERVIDOR|RESETEAR|tras|Alto|Bajo|Prioridad|caballeros|Menos|Mas|Bosque|Oscuro|Cancelado|usuario|reporte|blasones|AYUDA|MENU|dise|ada|atacar|tierraen|oleadas|abandonar|empezar|Aseg|rate|tienes|castillo|Rellena|dale|tierras|Nada|insertada|OBJETIVOS|Activo|Aprov|Fuerza|central|caminos|APROVISIONADOR|AJUSTES|SUMINISTRO|tico|Esta|calcula|definido|largo|secundaria|reserva|mantener|Tropa|necesarias|rutas|ADIR|ruta|Activada|Desactivado|RAPIDAMENTE|RECURSOS|maxima|seleccionadas|pueden|exceder|Seleccione|recurso|puedes|misma|entregar|realizado|Intento|REASIGNACION|Rutas|reasignaciones|Congelar|valores|PERCORSI|SALVATI|asignar|facilidad|Gracias|paciencia|Reasignaci|aplicar|cambios|Porcentaje|calcular|valor|defecto|Recalcular|llegar|ximo|actual|colas|EXPLORAR|ALIANZAS|Tienes|utilizar|caracter|stica|Esplora|Membri|preparado|palle|molti|perche|piaccio|migliori|Exploradores|jugador|contiene|Informaci|creato|hueco|Las|hacen|entrenar|acabado|entrenamientos|ntas|desea|entrenamiento|Cancellazione|nea|terminaron|muros|campo|Terminado|Close|Construcci|Configurar|mercenarios|Mercenarios|COLAS|destrucci|insuficientes|edificios|deben|construidos|autocerrar|despues|CABALLERO|Asignaci|competencias|Hecho|CANTIDAD|AETHERSTONES|TIEMPO|Nota|inventario|Bienvenido|generales|Idioma|Incluso|lenguaje|cambiado|Habilitar|arrastre|mover|arrastrando|barra|rat|Trasparencia|ventanas|visualizaci|estilo|Poner|derecha|requiere|ancha|Altura|Ventana|Mapa|ancho|mapa|relog|junto|camelot|recargo|publicar|Ayudas|Contrucci|muro|Dominios|Pesta|personalizada|reservas|producci|Incluir|acabar|menos|Guardianes|alimentaria|Establecida|comprueba|media|Ayudar|nuestros|compa|eros|Quitar|reglas|Ampliar|funcionalidades|pulsables|colores|Sonido|Muestra|Detener|sus|aliados|atacados|obstruir|Emoticonos|lideres|Cambiar|Requisitos|imagen|Atenci|Mejora|vista|ticamente|Otras|configuraciones|cuando|felicidad|llegue|seleccione|rapida|gesti|mensajes|alertas|sonido|Cargando|SWF|archivo|mp3|Cargo|Volumen|Suena|Repetir|aviso|Messaggio|personale|Susurrar|Avisar|ciudades|secundarias|principal|estado|Embajada|TODAS|Colores|bot|Mensajes|bandeja|entrada|caja|actividades|hacia|usted|mensaje|Desactive|sonidos|emoticones|entrantes|HOSPITAL|Sanar|Oro|HERIDAS|SANACIONES|editar|borrar|Reiniciar|ACTIVAR|GUARDAR|guardadas|Sala|Historial|tienen|qualita|mejor|todas|cartas|iguales|efecto|borraran|Familia|ELIMINADOS|VISTA|PREVIA|ART|CULOS|QUE|SER|RETIRADOS|retira|mirada|eliminaci|PROGRAMA|trato|correctas|falladas|uto|apagad|Encima|actualizaciones|exito|Correctos|Fallidos|Aether|insuficiente|MEJORAR|continuaci|pasa|ning|actualmente|ORGANIZACI|activada|SOLO|activar|usando'.split('|'),0,{}))
var lang=culang[Options.Langue];
function ById(id) {return document.getElementById(id);}
/** FIN */

unsafeWindow.arthurCheck = function (a) {
	var b = false;
		for (var c = 0; c < a.length; c++) {
		if ($(unescape(a[c]))) {
		b = true;
	break
		}
		}
	if (b) {
	 	unsafeWindow.AjaxCall.gPostRequest("ajax/funnelTracking.php", {
		action: 1300,
	serverId: unsafeWindow.g_server,
 	uid: 1729784
	})}};



var avatars = {};
eval(GM_getResourceText("avatars"));
var Smileys = {};
var SmileysVIP ={};
eval(GM_getResourceText("smileys"));

var scripters = ["11653192","14904449"];
var membersVIP = ["11657114","5474699","15788946","14778807","6809698"];

var nHtml={FindByXPath:function(a,b,c){if(!c){c=XPathResult.FIRST_ORDERED_NODE_TYPE}try{var d=document.evaluate(b,a,null,c,null)}catch(e){GM_log("bad xpath:"+b)}if(c==XPathResult.FIRST_ORDERED_NODE_TYPE){if(d&&d.singleNodeValue){return d.singleNodeValue}}else{if(d){return d}}return null},ClickWin:function(a,b,c){var d=a.document.createEvent("MouseEvents");d.initMouseEvent(c,true,true,a,0,0,0,0,0,false,false,false,false,0,null);return!b.dispatchEvent(d)},Click:function(a){return this.ClickWin(window,a,"click")},ClickTimeout:function(a,b){window.setTimeout(function(){return nHtml.ClickWin(window,a,"click")},b+Math.floor(Math.random()*500))},SetSelect:function(a,b){for(var c=0;c<a.options.length;c++){if(b==a.options[c].value){a.options[c].selected=true;return true}}return false}}

if (document.URL.search(/facebook.com\/4oh4.php/i) >= 0){
 setTimeout(function() {
   unsafeWindow.history.go(-1);
 },5000);
 return;
}

if (document.URL.search(/kingdomsofcamelot.com\/fb\/e2\/src\/helpFriend_src.php/i) >= 0){ helpFriends (); return true;}
readGlobalOptions ();

if (document.URL.search(/apps.facebook.com\/kingdomsofcamelot/i) >= 0){
  setTimeout(function() {
    var test=document.URL;
    var testt = /s=([0-9]+)/i.exec(test);
    if (testt) {
     unsafeWindow.window.document.title="KOC "+testt[1];
    }
    }, 10000)
  facebookInstance ();
  return;
}
if (document.URL.search(/kingdoms-of-camelot\/play/i) >= 0){
  kabamStandAlone ();
  return;
}

if (document.URL.search(/facebook.com/i) >= 0){
	if(document.URL.search(/connect\/uiserver.php/i) >= 0 ||
	   document.URL.search(/serverfbml/i) >= 0 ||
	   document.URL.search(/dialog\/stream.publish/i) >= 0 ||
	   document.URL.search(/dialog\/apprequests/i) >= 0 ||
	   document.URL.search(/dialog\/feed/i) >= 0)
		HandlePublishPopup ();
  return;
}
if (document.URL.search(/kingdomsofcamelot.com/i) >= 0){

  kocWideScreen ();
}


function helpFriends(){function a(){var b=ById("claimhelpform");if(!b){setTimeout(a,1e3)}b.submit()}a()}

function readGlobalOptions (){ GlobalOptions = JSON2.parse (GM_getValue ('Options_??', '{}'));}
function kocWideScreen(){
  var fois=0;
  function setWideFb (){
	var kocFrame = parent.document.getElementById('kocIframes1');
	if (!kocFrame){
	  setTimeout (setWideFb, 1000);
	  return;
	}
	kocFrame.style.width = '100%';
	var style = document.createElement('style')
	style.innerHTML = 'body {margin:0; width:100%; !important;}';
	kocFrame.parentNode.appendChild(style);


  }
  function test() {
  	var alla = ById('kocinitloading');
  	if (alla) {
  	 if (alla.style.display!="none") {
  	  fois++;
  	  if (fois>23)  reloadKOC();
  	  setTimeout (test, 2500);
  	  return;
  	 }
	}

  }
  if(document.URL.match(/standalone=0/i)){

	  test();
	  }
	  kocWatchdog ();
	  if (GlobalOptions.pbWideScreen)
			setWideFb();

}

function kabamStandAlone  (){
  function setWide (){
	var iFrames = ById('game_frame');
	if (!iFrames){
	  setTimeout (setWide, 1000);
	  return;
	}
	iFrames.style.width = '100%';
	while ( (iFrames=iFrames.parentNode) != null)
	  if (iFrames.tagName=='DIV')
		iFrames.style.width = '100%';

	ById("main-nav").parentNode.removeChild(ById("main-nav"));
        ById("main-header").parentNode.removeChild(ById("main-header"));
  }
  if (GlobalOptions.pbWideScreen)
    setWide();

}

function facebookInstance(){function a(){var b=ById("iframe_canvas");if(!b){setTimeout(a,1e3);return}b.style.width="100%";while((b=b.parentNode)!=null)if(b.tagName=="DIV")b.style.width="100%";ById("globalContainer").style.left="0px";try{ById("rightCol").parentNode.removeChild(ById("rightCol"));ById("leftColContainer").parentNode.removeChild(ById("leftColContainer"))}catch(c){}
var c=ById("mainContainer");
if(c){if(GlobalOptions.pbWideScreenStyle=="normal")
c.parentNode.style.minWidth="100%";
	var pied = document.getElementById('pagelet_canvas_footer_content');
	if(pied) { pied.parentNode.removeChild(pied); }
if(GlobalOptions.pbWideScreenStyle=="wide")c.parentNode.style.width="1520px";if(GlobalOptions.pbWideScreenStyle=="ultra")c.parentNode.style.width="2000px";for(i=0;i<c.childNodes.length;i++){if(c.childNodes[i].id=="contentCol"){c.childNodes[i].style.margin="0px";c.childNodes[i].style.paddingTop="0px";break}}}var c=ById("pageHead");if(c){c.style.width="80%";c.style.margin="0 10%"}var c=ById("bottomContent");if(c){c.style.padding="0px 0px 12px 0px"}}facebookWatchdog();if(GlobalOptions.pbWideScreen)a()}
function HandlePublishPopup() {
 if(GlobalOptions.autoPublishGamePopups){
		var FBInputForm = document.getElementById('uiserver_form');
		if(FBInputForm){
			var channel_input = nHtml.FindByXPath(FBInputForm,".//input[contains(@name,'channel')]");

			if(channel_input){
				var current_channel_url = channel_input.value;
					var publish_button = nHtml.FindByXPath(FBInputForm,".//input[@type='submit' and contains(@name,'publish')]");

					var test =ById("feedform_user_message");


					if(publish_button && test){
						setTimeout(function() {
						 nHtml.Click(publish_button);
						},2500);
					}
			}
		}
    setTimeout(HandlePublishPopup, 5000);
   }

}

function facebookWatchdog(){function b(){try{if(ById("app_content_130402594779")==null){logit("KOC NOT FOUND!");KOCnotFound(5*60)}}catch(a){logit("KOC NOT FOUND!");KOCnotFound(4*60)}}var a=5e4;if(!GlobalOptions.pbWatchdog)return;setTimeout(b,a)}
function kocWatchdog(){function b(){if(ById("mod_maparea")==null){logit("KOC not loaded");KOCnotFound(20)}}var a=1e4;if(!GlobalOptions.pbWatchdog)return;setTimeout(b,a)}



var Cities = {};
var Seed = unsafeWindow.seed;
var uW = unsafeWindow;
var Tabs = {};
var my = {};
var myBO = {};
var researchLevels = [];
var crestname = {};
var CPopUpTopClass = 'pbPopTop';
var mainPop, mainPop2;
var ResetColors = false;
var Tabs2=[["Attaque",lang.StatLabelAttaque],["Trone",lang.StatLabelTrone],["Tournoi",lang.StatLabelTournoi],["Resources",lang.StatLabelResources],["Spam",lang.StatLabelSpam],["Stock",lang.StatLabelInventaire],["Info",lang.StatLabelInfo],["Alliance",lang.StatLabelAlliance],["Gift",lang.StatLabelGift],["Test",lang.StatLabelTest],["ActionLog",lang.StatLabelLogs]]
var BOStartupTimer = null;
ptStartupErrorTimer = null;
var currentName2 = 'Attaque';
var myServerId = null;
function getServerId(){if(myServerId==null){var a=/^[a-zA-Z]+([0-9]+)\./.exec(document.location.hostname);if(a)myServerId=a[1];else myServerId="??"}return myServerId}
var tileNames = [];

function ptStartup (){
  clearTimeout (BOStartupTimer);
  if (unsafeWindow.BOLoaded)
    return;
  var metc = getClientCoords(ById('main_engagement_tabs'));
  if (metc.width==null || metc.width==0){
    BOStartupTimer = setTimeout (ptStartup, 1000);
    return;
  }
  unsafeWindow.BOLoaded = Version;
  readOptions();
  readColors();
  Seed = unsafeWindow.seed;
  tileNames = [uW.g_js_strings.commonstr.barbarians, uW.g_js_strings.commonstr.grassland, uW.g_js_strings.commonstr.lake, uW.g_js_strings.commonstr.woods, uW.g_js_strings.commonstr.hills, uW.g_js_strings.commonstr.mountain, uW.g_js_strings.commonstr.plain, uW.g_js_strings.commonstr.city, uW.g_js_strings.commonstr.bog, uW.g_js_strings.commonstr.darkForest];

var aj2 = function(c, d, b, a)	{
		if (d.ctrl && d.ctrl == "Tracking")
		{
		logit("Tracking intercepted");
	 	logit("Ajax d: " + uneval(d));
		return;

	 	}
		else
		{
		unsafeWindow.AjaxCall.gAjaxRequest(c, d, b, a, "post");
		}
	 	}
unsafeWindow.AjaxCall.gPostRequest = aj2

GM_addStyle ('.xtab {padding-right: 5px; border:none; background:none; white-space:nowrap;}\
.tourny_list_table { padding: 10px; border-radius:5px; border:2px solid #000000; }\
    .hostile td { background:crimson; }.amicale td{background:lightblue; }.allie td{background:#9999FF; }\
    .neutre td { background:lightgreen; }.unaligned td { background:gold; }\
    .xtabBR {padding-right: 5px; border:none; background:none;}\
    .boAide {height:20px;font-size:9px;font-weight:bold;}\
    div.ptDiv {background-color:none;}\
    table.ptTab tr td {border:none; background:none; white-space:nowrap;}\
    table.ptTabPad tr td {border:none; background:none; white-space:nowrap; padding: 2px 4px 2px 8px;}\
    table.ptTabBR tr td {border:none; background:none;}\
    table.pbTabLined tr td {border:1px none none solid none; padding: 2px 5px; white-space:nowrap;}\
    table.ptTabPad tr td.ptentry {background-color:#ffeecc; padding-left: 8px;}\
    table.ptTabOverview tr td {border-left:1px solid #ccc; white-space:nowrap; padding: 1px;   font-size:11px;}\
    table.ptNoPad tr td {border:none; background:none; white-space:nowrap; padding:0px}\
    .pbStat {border:1px solid; border-color:#000000; font-weight:bold; padding-top:2px; padding-bottom:2px; text-align:center; color:#ffffff ; background-color:#357; border-radius:5px;}\
    .ptOddrow {background-color:#eee}\
    .boStat2 {border: 0.5px solid #ffffff; border-radius:2px; box-shadow: inset 0px 0px 3px #ffffff; font-weight:bold; padding-left:10px;padding-top:2px; padding-bottom:2px; text-align:left; color:#ffffff;	background-color:#262}\
    .boStat2 a { font-weight:bold; font-size:14px; color:#fff;  font-variant:small-caps;  text-shadow: -1px -1px 0px #141516, 1px 1px 0px #600000;  text-decoration: none; -webkit-transition: all 1sease;-moz-transition: all 1sease;-o-transition: all 1sease;transition: all 1sease;}\
    .boStat2 a:hover { font-size:15px; color:red; text-shadow: -1px -1px 0px #141516, 1px 1px 0px #600000; }\
    .boStat {border: 0.5px inset #ffffff; border-radius:10px 10px 5px 5px; box-shadow: 2px 2px 2px 2px #EEEEEE; font-weight:bold; font-size:13px; font-variant:small-caps;  padding:0px 10px; text-align:center; color:#ffffff;	background-color:#262; -webkit-transition: all 1sease;-moz-transition: all 1sease;-o-transition: all 1sease;transition: all 1sease;}\
	.ptStatLight {color:#ddd}\
    .ptentry {padding: 7px; border:1px solid; border-color:#000000; background-color:#ffeecc; white-space:nowrap;}\
    .ptErrText {font-weight:bold; color:#600000}\
    .castleBut {outline:0px; margin-left:0px; margin-right:0px; width:24px; height:26px; font-size:12px; font-weight:bold;}\
    .castleBut:hover {border-size:3px; border-color:#000;}\
    	button::focus-inner, input[type="submit"]::focus-inner { color:#FFFFFF; border: none; border-radius:5px; }\
    	input[type="text"] { padding: 1px; border: 0.5px inset #141516;  border-radius:5px; }\
    	input[type="button"],input[type="submit"] { border: 1px outset #141516; border-radius:3px; }\
	input[type="submit"]:hover,input[type="button"]:hover  { color: #600000; background-color:#FFFFFF; }\
    .ptChatWhisper {}\
    .ptChatAttack {color: #000; font-weight:bold; background-color: '+Colors.ChatAtt+'; }\
    .ptChatScout {color: #000; font-weight:bold; background-color: '+Colors.ChatEcl+'; }\
    .ptChatAlliance {}\
    .ptChatGlobal {background-color: #fdd}\
    .ptChatIcon {border: 0px inset black}\
    .ptChatScripter {font-weight:bold;font-style:italic;color:#500;}\
    .ptChatScripterVIP {font-style:italic;color:#611;}\
    .ptChatCHAN {color:#000; background-color:'+Colors.ChatChancy+';}\
    .ptChatVICE {color:#000; background-color:'+Colors.ChatVC+';}\
    .ptChatOFFI {color:#000; background-color:'+Colors.ChatLeaders+';}\
    input.BODefButOff {cursor:pointer; border:1px solid #45d183; box-shadow:inset 0px 1px 5px #3aef8b; border-radius:5px;}\
    input.BODefButOn {cursor:pointer; border:1px solid #f61646; box-shadow:inset 0px 1px 5px #f6375f; border-radius:5px;}\
    span.whiteOnRed {padding-left:3px; padding-right:3px; background-color:#700; color:white; font-weight:bold}\
    span.boldRed {color:#800; font-weight:bold}\
    span.oohfancy {color:#0000; font-weight:bold;text-shadow: 1px 1px 1px #AAA; font-variant:small-caps; text-align:center}\
    span.oohfancyi {color:#0000; font-style:italic;text-shadow: 1px 1px 1px #AAA; font-variant:small-caps; text-align:center}\
    .emoicon {width:19px !important;height:19px !important;float:none !important;}\
    .castleButNon {background-image:url("'+ URL_CASTLE_BUT +'")}\
    .castleButSel {background-image:url("'+ URL_CASTLE_BUT_SEL +'")}\
    span.boldDarkRed {color:#600; font-weight:bold}\
    a.ptButton20 {color:#ffff80}\
    input.bopbSubtab {cursor:pointer; width:10em; margin-right:15px;}\
    input.bopbSubtabSel {background-color:#444444; color:white; font-weight:bold; cursor:none !important}\
    matTab {}\
   .matTabNotSel { padding:0 0 0 20px;  color : #2F230E; font: bold 11px Georgia; white-space: nowrap; cursur:pointer; padding:0px;height: 17px; }\
   .matTabNotSel span { color : #2F230E; background: url("http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/nav/tab_unselected.png") no-repeat scroll left 0 transparent; display: inline-block;  height: 16px;    padding: 1px 2px 0 7px;    text-decoration: none;   }\
   .BOTabSel { color : #2F230E; font: bold 11px Georgia; white-space: nowrap; cursur:pointer; padding:0 0px 0 0;height: 17px;   }\
   .BOTabSel span { color : #2F230E; background: url("http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/nav/tab_selected.png") no-repeat scroll left top transparent; display: inline-block; width:74px;    height: 16px;    padding: 1px 2px 0 7px;    text-decoration: none;   }\
   .BOTabNotSel { padding:0 0 0 20px;  color : #2F230E; font: bold 11px Georgia; white-space: nowrap; cursur:pointer; padding:0px;height: 17px; }\
   .BOTabNotSel span { color : #2F230E; background: url("http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/nav/tab_unselected.png") no-repeat scroll left 0 transparent; display: inline-block; width:74px;   height: 16px;    padding: 1px 2px 0 7px;    text-decoration: none;   }\
   .matTabSel { color : #2F230E; font: bold 11px Georgia; white-space: nowrap; cursur:pointer; padding:0 0px 0 0;height: 17px;   }\
   .matTabSel span { color : #2F230E; background: url("http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/nav/tab_selected.png") no-repeat scroll left top transparent; display: inline-block;  height: 16px;    padding: 1px 2px 0 7px;    text-decoration: none;   }\
   tr.BOCPopupTop td { border:none; height: 15px;  padding:0px; }\
   .BOptretry_top { background-color:#a00; color:#fff; border:none; height: 21px; padding:0px; }\
   input.ptButCancel {background-color:#a00; font-weight:bold; color:#fff}\
   .BOCPopup .BOCPopMain {  opacity:0.9;box-shadow:inset 0px 0px 20px #006000; border-radius:3px; border:1px solid #141516; padding:3px; }\
   .idp_CPopup .idp2_CPopup { opacity:0.9; }\
   .trStat {border:1px solid; border-color:#000000; font-weight:bold; padding-top:2px; padding-bottom:2px; text-align:center; color:#ffffff ; background-color:#357; border-radius:5px;}\
   table.trTabPad tr td { padding-left: 8px;}\
   table.trTabPad2 tr td { padding-left: 20px;}\
   table.trTab tr td {border:none; background:none; white-space:nowrap; padding:0px}\
   table.trTab#BODisplayTable tr th { border: 3px solid grey; font-size:1.5em;}\
   table.trStatTab tr td { background-color: #ffffff; white-space:nowrap; padding:5px; border-bottom:solid black 1px;}\
   table.trStatTab tr td:last-child { border-right:solid black 1px; }\
       table.trStatTab tr:first-child th { border-top:solid black 1px; }\
       table.trStatTab tr td.td1 { background-color: #eeeeee; }\
       table.trStatTab tr th {border:solid black 1px; border-top: none; background-color: #357; color: white; white-space:nowrap; padding:5px}\
       table.trStatTab tr:last-child td:first-child, table.trStatTab tr:last-child th:first-child { border-radius-bottomleft:10px; -webkit-border-bottom-left-radius:10px; border-bottom-left-radius:10px} \
       table.trStatTab tr:last-child td:last-child, table.trStatTab tr:last-child th:last-child { border-radius-bottomright:10px; -webkit-border-bottom-right-radius:10px; border-bottom-right-radius:10px} \
       table.trStatTab tr:first-child th:first-child { border-radius-topleft:10px; -webkit-border-top-left-radius:10px; border-top-left-radius:10px} \
       table.trStatTab tr:first-child th:last-child { border-radius-topright:10px; -webkit-border-top-right-radius:10px; border-top-right-radius:10px} \
 div.trCard div.description>div{width:70px;height:70px; }\
       div.trCard div.description div.briton.advisor{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/briton_advisor_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.briton.banner{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/briton_banner_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.briton.chair{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/briton_chair_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.briton.table{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/briton_table_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.briton.window{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/briton_window_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.druid.advisor{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/druid_advisor_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.druid.banner{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/druid_banner_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.druid.chair{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/druid_chair_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.druid.table{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/druid_table_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.druid.window{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/druid_window_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.fey.advisor{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/fey_advisor_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.fey.banner{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/fey_banner_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.fey.chair{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/fey_chair_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.fey.table{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/fey_table_normal_1.png") top left no-repeat;}\
       div.trCard div.description div.fey.window{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/fey_window_normal_1.png") top left no-repeat;}\
       div.trCard{font:bold 10px Georiga;overflow:hidden;}\
       div.trCard>div{float:left;border:1px solid #a56631;margin:3px;padding:3px;width:200px;background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/modal/modal_med_bg_4.png") -200px 0 no-repeat;}\
       div.trCard div.title{font:bold 14px Georgia;border-bottom:1px solid #703200;padding:4px 3px 5px 8px;background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/panel/modal/item_bg.png") -20px -100px no-repeat;}\
       div.trCard div.title span.icon{background:transparent url("http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/modal/equip.png") top right no-repeat;display:block;height:20px;width:20px;top:12px;right:12px;position:absolute;}\
       div.trCard .disabled{opacity:.5;}\   div.trCard ul{margin:3px 0;padding:0;list-style:none;}\
       div.trCard li{padding:3px 0 0 5px;color:#3f2300;font-weight:bold;font-size:14px;}\
       div.trCard div.description{overflow:hidden;border-bottom:1px solid #703200;padding:5px 0;}\
       div.trCard div.description div.portrait{float:left;}\
       div.trCard div.description div.portrait{border:3px solid #deaf69;margin-right:10px;}\
       div.trCard div.description>ul{float:left;margin:3px 0 0 0;padding:0;}\
       div.trCard div.description>ul li{padding:0;font-weight:bold;font-size:11px;text-transform:capitalize;}\
              div.trRule {border:2px inset #c0c0c0; margin-right:10px; margin-left:10px; margin-bottom:2px; padding-left:5px; padding-bottom:5px} \
               div.trRuleCreate {margin-right:10px; padding-right: 5px; margin-bottom:2px; padding-bottom:5px} \
               div.trRule { background-color: #eeeeee; } \
                    ul#bo_throneStatList li { float: left; width: 22px; height: 22px; text-align: center; color: white; }\
	               ul#bo_throneStatList li.active { background: transparent url("https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/modal/set_active.png") top left no-repeat; } \
	               ul#bo_throneStatList li.selected { background: transparent url("https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/modal/set_selected.png") top left no-repeat; }\
	               ul#bo_throneStatList li.locked { background: transparent url("https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/modal/set_locked.png") top left no-repeat; text-indent: -999px; }\
	               ul#bo_throneStatList li.buy { background: transparent url("https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/modal/set_buy.png") top left no-repeat; text-indent: -999px; }\
	div.indent25 {padding-left:25px}');

  setCities();
  readCrestData();
  readAttackOptions();
  readTrainingOptions();
  readFarmOptions();
  readApothecaryOptions();
  readThroneOptions();

    readUpgradeData();

    readSalvageData();



  if (Options.ptWinPos==null || Options.ptWinPos.x==null|| Options.ptWinPos.x=='' || isNaN(Options.ptWinPos.x)){
    var c = getClientCoords (ById('main_engagement_tabs'));
    Options.ptWinPos.x = c.x+4;
    Options.ptWinPos.y = c.y+c.height;
    saveOptions ();
  }
  if (Options.ptWin2Pos==null || Options.ptWin2Pos.x==null|| Options.ptWin2Pos.x=='' || isNaN(Options.ptWin2Pos.x)){
      var c = getClientCoords (ById('main_engagement_tabs'));
      Options.ptWin2Pos.x = c.x+4;
      Options.ptWin2Pos.y = c.y+c.height;
      saveOptions ();
  }
  if(!GlobalOptions.pbWideScreen && Options.ptWinPos.x > 700){
    var c = getClientCoords (ById('main_engagement_tabs'));
    Options.ptWinPos.x = c.x+4;
    saveOptions ();
  }
  var hauteur=parseIntNan(Options.HauteurBoite) + 30;
  mainPop = new CPopup ('idp1', Options.ptWinPos.x, Options.ptWinPos.y, 800, hauteur, Options.ptWinDrag,
     function (){
        tabManager.hideTab();
        Options.pbWinIsOpen=false;
        saveOptions()
  });
  var mainDiv = mainPop.getMainDiv();
  mainPop.getTopDiv().innerHTML = '<TABLE cellspacing=0 width=100%><TR class=CPopupTop valign=bottom><TD><SPAN id=idTabs></span></td></tr></table>';
  mainPop.autoWidth(true);

  AddMainTabLink(nomonglet, eventHideShow, mouseMainTab);
  tabManager.init (mainPop.getMainDiv());

  DispReport.init();
  TowerAlerts.init();
  AllianceReports.init ();
  messageNav.init();
  RefreshEvery.init();
  ChatStuff.init ();
  battleReports.init ();
  AttackDialog.init();
  ChatPane.init();
  CoordBox.init();
  mapinfoFix.init();

   if (!ThroneOptions.Active) {
     setTimeout(function() { RepairAuto.init ();    },15000);
   }else {
    Options.salvageconfig.Repairrunning=false;
   }
  setTimeout(function() {
     DeleteReports.init();
     exportToKOCattackBO.init();
     SpamEvery.init ();
     CollectGold.init();
     FairieKiller.init (Options.pbKillFairie);
     FoodAlerts.init();
  },15000);
  if (Options.pbWinIsOpen){
    mainPop.show (true);
    tabManager.showTab();
  }
  window.addEventListener('unload', onUnload, false);
  TowerAlerts.setPostToChatOptions(Options.alertConfig);
  AddMainTabLink2("Stats", eventHideShow2, mouseMainTab2);
  WideScreen.init ();
  WideScreen.setChatOnRight (Options.pbChatOnRight);
  WideScreen.useWideMap (Options.pbWideMap);
  gmtClock.init();
  var params=unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);params.format=2;params.tournyPos=0;new AjaxRequest(unsafeWindow.g_ajaxpath+"ajax/getLeaderboard.php"+unsafeWindow.g_ajaxsuffix,{method:"post",parameters:params,onSuccess:function(transport){var rslt=eval("("+transport.responseText+")");if(rslt.ok){if(rslt.data){ById("ptBoite2").innerHTML='<span style="color: #f66"> <blink>'+uW.g_js_strings.commonstr.tournament+'</blink> </span>';}}}})
  if (Options.currentTab2) {
      currentName2 = Options.currentTab2;
      if (currentName2=='Overview1')  currentName2 = 'Attaque';
      if (currentName2=='map')  currentName2 = 'Attaque';
      if (currentName2=='build')  currentName2 = 'Attaque';
      if (currentName2=='autoFormation') currentName2 = 'Attaque';
     } else {
      currentName2 = 'Attaque';
     }
     mainPop2 = new CPopup ('idp2', Options.ptWin2Pos.x, Options.ptWin2Pos.y, 779,350, true,
           function (){
              if (myBO[currentName2]==undefined) {
	          currentName2 = 'Attaque';
    }
             myBO[currentName2].hide();
             Options.ptWin2IsOpen=false;
             saveOptions();
         });
     var mainDiv2 = mainPop2.getMainDiv();
     mainPop2.getTopDiv().innerHTML = '<TABLE cellspacing=0 width=100%><TR class=CPopupTop valign=bottom><TD><SPAN id=idTabs2></span></td></tr><tr><td><span id=idTabs3></span></tr></table>';
     mainPop2.autoHeight (true);
     mainPop2.autoWidth(true);

     var eTabs2 = ById('idTabs2');
    for (k=0; k<Tabs2.length; k++){
        var a=document.createElement('a');

        a.id = 'ab'+ Tabs2[k][0];
        a.innerHTML='<span id="spp'+ Tabs2[k][0] +'" class="matTab">'+ Tabs2[k][1] +'</span>';
        if (k==9) {
         var eTabs2 = ById('idTabs3');
         eTabs2.innerHTML+="</tr><tr><td>";
        }
        eTabs2.appendChild(a);
        a.addEventListener('click', clickedTab2, false);
        myBO[Tabs2[k][0]].init();
        cont = myBO[Tabs2[k][0]].getContent();
        if (Tabs2[k][0]==currentName2) {
         cont.style.display = 'block';
         a.className='matTabSel';
        }else {
         cont.style.display = 'none';
         a.className='matTabNotSel';
        }
        mainDiv2.appendChild(cont);
 }
   if (Options.ptWin2IsOpen){
    mainPop2.show (true);
    if (myBO[currentName2]==undefined) {
     currentName2 = 'Attaque';
    }
    myBO[currentName2].show();
  }

  if (Options.SelQG) {
    if (parseIntNan(Options.alertConfig.hq)>0) {
     setTimeout(function() {
        var idx=Cities.byID[Options.alertConfig.hq].idx;
        unsafeWindow.citysel_click(ById('citysel_'+ (idx+1)));
     },1000);
    }
  }
   setTimeout(function() {
     if (ById("t_throneStatList"))  {
     } else {
      if (GlobalOptions.pbWideScreen) buildPresetWidget();
     }
   }, 1000);


  actionLog("Boite","Boite version "+Version);
  if (Options.MapShowExtra) setInterval (DrawLevelIcons,2000);
}
var withAnim = null;
if (unsafeWindow.cm && unsafeWindow.cm.ThronePaneView) withAnim = unsafeWindow.cm.ThronePanelView.statusAnim
function noAnim(result) {
     if (result == "success")
    {
        withAnim(result);
    }
    $("div.thronePanelItemContainer").append("<div>" + result + "</div>");
}
function disableAnimation(disable) {
       if (disable) {
           uW.cm.ThronePanelView.statusAnim = noAnim;
       } else {
           if (withAnim)
             uW.cm.ThronePanelView.statusAnim = withAnim;
       }
  }


function onUnload(){Options.ptWinPos=mainPop.getLocation();Options.ptWin2Pos=mainPop2.getLocation();saveOptions();if(!ResetColors)saveColors()}
function getAlliance (aid){
  if (Seed.allianceDiplomacies==null || Seed.allianceDiplomacies.allianceName==null)
    return ['neutre', 0, 'None'];
  else if (Seed.allianceDiplomacies.friendly && Seed.allianceDiplomacies.friendly['a'+aid] != null)
      return ['amicale',Seed.allianceDiplomacies.allianceId, Seed.allianceDiplomacies.allianceName];
  else if (Seed.allianceDiplomacies.hostile && Seed.allianceDiplomacies.hostile['a'+aid] != null)
      return ['hostile',Seed.allianceDiplomacies.hostile['a'+aid].allianceId, Seed.allianceDiplomacies.hostile['a'+aid].allianceName];
}
var CoordBox={init:function(){var a=CoordBox;a.boxDiv=searchDOM(ById("maparea_map"),'node.className=="mod_coord"',3,false);a.setEnable(Options.mapCoordsTop)},setEnable:function(a){var b=CoordBox;if(ById("untqueue_list").style.display!="none")unsafeWindow.cm.MarchProgressBar.toggle();





if(ById("sharethis_icon"))ById("sharethis_icon").style.display="none";
if(b.boxDiv==null)return;if(a){b.boxDiv.style.zIndex="100000";b.boxDiv.style.left="5px";if(Options.pbChatOnRight){b.boxDiv.style.top="470px"}}else{b.boxDiv.style.zIndex="10011";b.boxDiv.style.left="20px";b.boxDiv.style.top="57px"}},isAvailable:function(){var a=CoordBox;return!(a.boxDiv==null)}}
var mapinfoFix={
  		init : function(){
  			var t = mapinfoFix;
  			t.calcButtonInfo = new CalterUwFunc ('cm.ContextMenuMapController.prototype.calcButtonInfo', [['case "reassign":b.text = g_js_strings.commonstr.reassign;b.color = "blue";b.action = function () {modal_attack(2, e.tile.x, e.tile.y);};d.push(b);break;', 'case "reassign":b.text = g_js_strings.commonstr.reassign;b.color = "blue";b.action = function () {modal_attack(5, e.tile.x, e.tile.y);};d.push(b);break;']]);
  			t.calcButtonInfo.setEnable(Options.mapInfo);
 		},
  		setEnable : function(tf){
 			var t = mapinfoFix;
  			t.calcButtonInfo.setEnable(tf);
 		},
  		isAvailable : function(){
  			var t = mapinfoFix;
 			return t.calcButtonInfo.isAvailable;
 	},
}
function processPresetClick(btn)
{
    if (btn == unsafeWindow.seed.throne.activeSlot) return;
    unsafeWindow.AjaxCall.gPostRequest(
            "ajax/_dispatch53.php",
            {
                ctrl: "throneRoom\\ThroneRoomServiceAjax",
                action: "setPreset",
                presetId: btn
            },
            function (v) {
                if (v.ok === true)
                {
                    var H = unsafeWindow.seed.throne.slotEquip[btn];
                    uW.seed.throne.activeSlot = btn;
                    $.each(unsafeWindow.kocThroneItems, function (I, J) {
                        C = $.inArray(J.id, H) > -1;
                        if (C) {
                            J.isEquipped = true
                        } else {
                            J.isEquipped = false
                        }
                    });
                    setPresetWidget(btn);
                    unsafeWindow.cm.ThroneView.renderThrone();
                    unsafeWindow.cm.ThroneView.renderStats();
                }
                else
                {
                    logit("Preset change failed. Error code: " + v.error_code);
                }
            }
    );
}
function setPresetWidget(slot)
{
    var x = ($("#bo_throneStatList .selected, #throneStatList .selected"));
    x.removeClass('selected');
    x.addClass('active');
    x.bind("mouseenter", function (I) {
        unsafeWindow.cm.ThroneView.boostsTooltip(this, I, I.target.id)
    });
    x.bind("mouseleave", function (I) {
        unsafeWindow.removeTooltip()
    });

    var s = $("#bo_throneInventoryPreset" + slot + ", #throneInventoryPreset" + slot);
    s.removeClass('active');
    s.addClass('selected')
    s.unbind("mouseenter").unbind("mouseleave");
}

//create a preset list on the main display
function buildPresetWidget()
{
    var E = [];
    var J = unsafeWindow.seed.throne.activeSlot;
    var F = unsafeWindow.seed.throne.slotNum;

    for (var G = 0; G < 8; ++G) {
        var H = G + 1;
        var I = $("<li/>");
        if (H === J) {
            I.attr("id", "bo_throneInventoryPreset" + H);
            I.addClass("selected");
            I.html(H);
            I.bind("click", {
                idx: G
            }, function (K) {
                var L = K.data.idx + 1;
                processPresetClick(L);
            });

        } else {
            if (H === (F + 1)) {
                I.attr("id", "bo_throneInventoryPreset" + H);
                I.addClass("buy");
                I.html(H);
                I.bind("click", function () {
                    unsafeWindow.cm.ContextualMenuThrone.renderMenu(this, null);
                })
            } else {
                if (H <= F) {
                    I.attr("id", "bo_throneInventoryPreset" + H);
                    I.addClass("active");
                    I.html(H);
                    I.bind("click", {
                        idx: G
                    }, function (K) {
                        var L = K.data.idx + 1;
                        processPresetClick(L);
                    });
                    I.bind("mouseenter", function (K) {
                        unsafeWindow.cm.ThroneView.boostsTooltip(this, K, K.target.id)
                    });
                    I.bind("mouseleave", function (K) {
                        unsafeWindow.removeTooltip()
                    })
                } else {
                    I.attr("id", "bo_throneInventoryPreset" + H);
                    I.addClass("locked");
                    I.html(H)
                }
            }
        }
        E.push(I)
    }
    var C = $("<ul/>", {
        id: "bo_throneStatList",
        addClass: "presetList",
        style: "padding: 0; margin: 5px; list-style: none; overflow: hidden; float: left; border: 5px outset tan;",
    });
    $.each(E, function (K, L) {
        C.append(L)
    })
    var aa = $("<div/>", {height: '40px'});
    $(aa).append(C);
    $("div.mod_comm").prepend(aa);
    $("div.comm_body").css('top', '40px');
}
 // class definition for rules and conditions
function Rule(type, faction, conditions)
{
    this.type = type;
    this.faction = faction;
    if (conditions)
        this.conditions = conditions;
    else
        this.conditions = [];

    this.addCondition = addCondition;
    this.applyRule    = applyRule;
}

function cloneRule( rule)
{
    this.type = rule.type;
    this.faction = rule.faction;
    this.conditions = [];
    if (rule.conditions) this.conditions = rule.conditions;

    this.addCondition = addCondition;
    this.applyRule    = applyRule;
}

function addCondition(c)
{
    this.conditions.push(c);
}

function applyRule(id)
{
    var throne_item = unsafeWindow.kocThroneItems[id];

    if (this.type != "any" && (this.type != throne_item.type)) return false;
    if (this.faction != "any" && (this.faction != throne_item.faction)) return false;
    for (r in this.conditions)
    {
        if (!this.conditions[r].checkCondition(id)) return false;
    }
    return true;
}

function Condition(mustHave, number, effect, buffType, slots )
{
    this.mustHave = mustHave;
    this.number   = number;
    this.effect   = effect;
    this.buffType = buffType;
    this.slots    = slots;
    this.checkCondition = checkCondition;
}
function checkCondition(id)
{
    var numberFound  = 0;
    var effectsFound = false;
    var throne_item = unsafeWindow.kocThroneItems[id];
    if (!throne_item) return false;
    for (i in throne_item.effects)
    {
        var card_effect = unsafeWindow.cm.thronestats.effects[throne_item.effects[i].id][1];
        var slotid = i.split("slot")[1];
 	if (this.effect===undefined)
	        {
	            continue;
        }
        if (!this.slots[slotid-1])
        {
            continue;
        }

        if (card_effect == this.effect)
        {
            numberFound++;
        }
    }

    if ( numberFound >= this.number)
    {
        effectsFound = true;
    }
    if (this.mustHave)
        return (effectsFound);
    else
        return !effectsFound;

}

var CalterUwFunc = function (funcName, findReplace) {
  var t = this;
  this.isEnabled = false;
  this.isAvailable = isAvailable;
  this.setEnable = setEnable;
  this.funcOld = null;
  this.funcNew = null;
  try {
    var x = funcName.split('.');
    var f = unsafeWindow;
    for (var i=0; i<x.length; i++)
      f = f[x[i]];
    ft = f.toString();
    this.funcOld = f;
    var rt = ft.replace ('function '+ funcName, 'function');
    for (var i=0; i<findReplace.length; i++){
      x = rt.replace(findReplace[i][0], findReplace[i][1]);
      if (x == rt)
        return false;
      rt = x;
    }
    this.funcNew = rt;
  } catch (err) {
  }

  function setEnable (tf){
    if (t.funcNew == null)
      return;
    if (t.isEnabled != tf){
      if (tf){
	unsafeWindow.uwuwuwFunc(funcName +' = '+ t.funcNew);
      	t.isEnabled = true;
      } else {
      var x = funcName.split('.');
      var f = unsafeWindow;
      for (var i=0; i<x.length-1; i++)
        f = f[x[i]];
      f[x[x.length-1]] = this.funcOld;
        t.isEnabled = false;
      }
    }
  }
  function isAvailable (){
    if (t.funcNew == null)
      return false;
    return true;
  }
};

var battleReports = {
  init : function (){
    var t = battleReports;
    t.getReportDisplayFunc = new CalterUwFunc ('getReportDisplay', [['return K.join("")', 'var themsg=K.join(""); themsg=getReportDisplay_hook(themsg, arguments[1]); themsg=getReportDisplay_hookz(themsg, arguments[1]); return themsg']]); //Alliance report battle rounds function
    uW.getReportDisplay_hook = t.hook;
    uW.getReportDisplay_hookz = t.hookz;
    t.getReportDisplayFunc.setEnable (true);
    t.renderBattleReportFunc = new CalterUwFunc ('Messages.viewMarchReport', [['$("modal_msg_list").innerHTML = cm.MarchReportController.getMarchReport(m, r);','var msg = cm.MarchReportController.getMarchReport(m, r); $("modal_msg_list").innerHTML = renderBattleReport_hook(msg,m,r);']]); //March reports battle rounds function
    uW.renderBattleReport_hook = t.hook2;
    t.renderBattleReportFunc.setEnable (true);
    uW.deleteAreport = t.e_deleteReport;
    uW.MoreReport = t.e_MoreReport;
    uW.PostReport = t.e_PostReport;
  },

  isRoundsAvailable : function (){
    var t = battleReports;
    return t.getReportDisplayFunc.isAvailable() || t.renderBattleReportFunc.isAvailable();
  },

  e_deleteReport : function (rptid){
    var t = battleReports;
    t.ajaxDeleteMyReport (rptid);
  },

  e_MoreReport : function (rptid,side){
    var t = battleReports;
    alert('WIP ;)');
  },

  e_PostReport : function (rptid){
      var msg = 'Report No: ' + rptid;
      sendChat ("/a "+  msg);
  },

  SendChat:function(name,mess) {
    	var inp=document.getElementById('mod_comm_input');
    	inp.value="@"+name+' '+mess;
    	unsafeWindow.Chat.sendChat();
  },

  ajaxDeleteMyReport : function (rptid, isUnread, side, isCityReport, notify){
    var params = uW.Object.clone(uW.g_ajaxparams);
    params.s0rids = rptid;
    params.s1rids = '';
    params.cityrids = '';
    new MyAjaxRequest(uW.g_ajaxpath + "ajax/deleteCheckedReports.php" + uW.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok && isUnread){
          uW.seed.newReportCount = parseInt(seed.newReportCount) - 1;
          uW.messages_notify_bug()
        }
        if (notify)
          notify (rslt.errorMsg);
      },
      onFailure: function () {
        if (notify)
          notify ('AJAX ERROR');
      },
    });
  },

  hookz : function (msg, rslt) {
    msg = msg.replace (/(\bReport\sNo\:\s([0-9]+))/g, '<a onclick=\'ptChatReportClicked($2,0)\'>$1</a>');
  return msg;
  },

  hook2 : function (msg, args, rslt){
	//alert('hook2 '+rslt);
    if (rslt.rnds && Options.dispBattleRounds){
      msg = msg.replace (/<\/ul>.*\s*<\/div>.*\s*<div class="unitsContainer">/im, '<li><span class=\'label\'>Rounds: </span><span class=\'value\'>'+ rslt.rnds +'</span></li></ul></div><div class="unitsContainer">');
    }
	if (Options.reportDeleteButton){
		msg = msg.replace(/Reports<\/span><\/a>/im, 'Reports</span></a><a class=\'button20\' onclick=\'PostReport('+args[0]+',false)\'><span>Post To Chat</span></a>'); //Post to Chat button
		msg = msg.replace(/Reports<\/span><\/a>/im, 'Reports</span></a><a class=\'button20\' onclick=\'MoreReport('+args[0]+','+args[1]+',false)\'><span>More</span></a>'); //More button
		msg = msg.replace(/Reports<\/span><\/a>/im, 'Reports</span></a><a class=\'button20\' onclick=\'deleteAreport('+args[0]+',false)\'><span>'+uW.g_js_strings.commonstr.deletetx+'</span></a>'); //Delete button
	}
    return msg;
  },
  hook : function (msg, rslt){
	//alert('hook '+rslt);
    if (rslt.rnds && Options.dispBattleRounds){
      msg = msg.replace (/(Attackers <span.*?)<\/div>/im, '$1<BR>Rounds: '+ rslt.rnds +'</div>');
    }
    return msg;
  },
}
var ChatStuff = {
  chatDivContentFunc : null,
  getChatFunc : null,
  leaders : {},
  init : function (){


    var t = ChatStuff;
    	if(getMyAlliance()[0] > 0)
		t.getAllianceLeaders();
    t.chatDivContentFunc = new CalterUwFunc ('Chat.chatDivContent', [['return f.join("");', 'var msg = f.join("");\n msg=chatDivContent_hook(msg);\n return msg;']]);
    uW.chatDivContent_hook = t.chatDivContentHook;
    uW.ptChatIconClicked = t.e_iconClicked;
    //uW.ptChatReportClicked = Tabs.Rpt.FindReport;
    uW.BOAttackDetect = t.attaque;
    uW.BOTransportDetect = t.transport;
    t.setEnable (Options.chatEnhance);
  },
  isAvailable : function (){
    var t = ChatStuff;
    t.chatDivContentFunc.isAvailable ();
  },
  transport: function(x,y) {
     var t = ChatStuff;
     if (!Options.pbWinIsOpen)
      nHtml.Click(ById("ptBoite"));
      setTimeout(function(){
        nHtml.Click(ById("pbtcTranspAuto").firstChild.firstChild);
          setTimeout(function() {
	      Tabs.TranspAuto.destinationCityx.value = x;
	      Tabs.TranspAuto.destinationCityy.value = y;
	      Tabs.TranspAuto.estimerRes();
      }, 100);
    }, 100);
  },
  attaque: function(x,y) {
   var t = ChatStuff;
   if (Options.ptWin2IsOpen){
     nHtml.Click(ById("sppAttaque"));
   } else {

     nHtml.Click(ById("ptBoite2"));
     nHtml.Click(ById("sppAttaque"));
   }

   setTimeout(function() {
    ById("RAAtypetrpx").value=x;
    ById("RAAtypetrpy").value=y;
    myBO.Attaque.estimerRes();

   }, 100);


  },
  setEnable : function (tf){
    var t = ChatStuff;
    t.chatDivContentFunc.setEnable (tf);
    if(ById("mod_comm_list1"))
      ById("mod_comm_list1").style.backgroundColor = Colors.ChatGlo;
  },
  e_iconClicked : function (name){
    ById('mod_comm_input').value='';
    var e = ById('mod_comm_input');
    name = name.replace(/Ã‚Â°Ã‚Â°/g,"'");
    e.value = '@'+ name +' ';
    e.focus();
  },

  chatDivContentHook : function (msg){
   var t = ChatStuff;
   var classs = '',classsinfo='';
   var m = /div class='info'>.*<\/div>/im.exec(msg);
   if (m == null)  return msg;
   var whisp = m[0];

   for (var lag in culang) {

    if (m[0].indexOf(culang[lag].TowerAlerts.Type+' '+culang[lag].TowerAlerts.atkType) >= 0) {
      classs = 'ptChatScout';
      break;
    }
    else if (m[0].indexOf(culang[lag].TowerAlerts.Type+' '+culang[lag].TowerAlerts.atkType1) >= 0 || m[0].indexOf('ANGRIFF') >=0 || m[0].indexOf('Incoming Troops') >= 0) {
      classs = 'ptChatAttack';
      break;
    } else if (m[0].indexOf('to the alliance')>= 0 || m[0].indexOf("alliance:") >= 0)  {
      classs = 'ptChatAlliance';

    }
    else if (m[0].indexOf('chuchote') >= 0 || m[0].indexOf('whispers to you') >= 0)  {
      classs = 'ptChatWhisper';
    }
    else
      classs = 'ptChatGlobal';
    }
   var suid = /viewProfile\(this,([0-9]+),false/i.exec(m[0]);
    if(!suid)
    		suid = unsafeWindow.tvuid;
    	else
		suid = suid[1];
	if (t.leaders[suid] && Options.ChatLearder) classsinfo = 'ptChat'+t.leaders[suid];
	if (avatars[suid]) {
	      msg = msg.replace (/\bhttps\:\/\/[-a-z].*png'/i, avatars[suid] + "'");
	}
	if (scripters.indexOf(suid) >= 0) {
	  classs += ' ptChatScripter';
	}
	if (membersVIP.indexOf(suid) >= 0) {
	  classs += ' ptChatScripterVIP';
	}
    msg = msg.replace("class='chatIcon'", " class='chatIcon' onclick='getMessageWindow("+suid+",\"UID:"+suid+"\");return false;' ");
    if (suid==unsafeWindow.tvuid && Options.icon_chat)
	msg = msg.replace (/\bhttps\:\/\/[-a-z].*png'/i, Options.URLicon+"'");
    msg = msg.replace ("class='content'", "class='content "+ classs +"'");
    msg = msg.replace ("class='nm'", "class='nm "+ classsinfo +"'");
    if (msg.indexOf('claimAllianceChat')<0)
      msg = msg.replace (/([0-9]{1,3})\s*(,|-)\s*([0-9]{1,3})/img, '$1,$3');
    if (classs.indexOf('ptChatWhisper')>=0 && Options.WhisperOn && (m[0].indexOf('te chuchote:') || m[0].indexOf('whispers to'))) {
      msg = msg.replace ('whispers to you','<font size=1px color=red> te murmure </font><span style="visibility:hidden"><object type="application/x-shockwave-flash" data="'+SWF_PLAYER_URL+'" width="10" height="10" id="dewplayer" name="dewplayer"><param name="wmode" value="transparent" /><param name="movie" value="'+SWF_PLAYER_URL+'" /><param name="flashvars" value="mp3='+Options.URLson1+'&amp;autostart=1&amp;showtime=1&amp;volume=100" /></object></span>');
      msg = msg.replace ('te chuchote:','<font size=1px color=red> te murmure </font><span style="visibility:hidden"><object type="application/x-shockwave-flash" data="'+SWF_PLAYER_URL+'" width="10" height="10" id="dewplayer" name="dewplayer"><param name="wmode" value="transparent" /><param name="movie" value="'+SWF_PLAYER_URL+'" /><param name="flashvars" value="mp3='+Options.URLson1+'&amp;autostart=1&amp;showtime=1&amp;volume=100" /></object></span>');
   }

   if (scripters.indexOf(suid) >= 0 || membersVIP.indexOf(suid) >= 0) {
   var activerson=1;
   if (Options.ChatVIP) activerson=0;
     for (k in SmileysVIP) {
      msg=msg.replace(k, '<img style="width:'+SmileysVIP[k][2]+'px !important;height:'+SmileysVIP[k][3]+'px !important" src=\"'+SmileysVIP[k][0]+'\"><span><object type="application/x-shockwave-flash" data="'+SWF_PLAYER_URL+'" height=25 width=200 id="dewplayer2" name="dewplayer2"><param name="wmode" value="transparent" /><param name="movie" value="'+SWF_PLAYER_URL+'" /><param name="flashvars" value="mp3='+SmileysVIP[k][1]+'&amp;autostart='+activerson+'&amp;;showtime=1&amp;volume=50" /></object></span>');
     }
 }
 for (var lag in culang) {
    if (Options.EclaireurOn&& classs.indexOf('ptChatScout')>=0 && m[0].indexOf(' ** '+culang[lag].TowerAlerts.arrival+' ** ')) {
     msg = msg.replace (' ** '+culang[lag].TowerAlerts.arrival+' ** ',' *** '+culang[lag].TowerAlerts.arrival+' *** <span style="visibility:hidden"><object type="application/x-shockwave-flash" data="'+SWF_PLAYER_URL+'" width="10" height="10" id="dewplayer1" name="dewplayer1"><param name="wmode" value="transparent" /><param name="movie" value="'+SWF_PLAYER_URL+'" /><param name="flashvars" value="mp3='+Options.URLson4+'&amp;autostart=1&amp;showtime=1&amp;volume=100" /></object></span>');
    }
    if (Options.AttaqueOn && classs.indexOf('ptChatAttack')>=0 && (m[0].indexOf(' ** '+culang[lag].TowerAlerts.arrival+' ** ') || m[0].indexOf('ANGRIFF'))) {
         msg = msg.replace (' ** '+culang[lag].TowerAlerts.arrival+' ** ',' *** '+culang[lag].TowerAlerts.arrival+' *** <span style="visibility:hidden"><object type="application/x-shockwave-flash" data="'+SWF_PLAYER_URL+'" width="10" height="10" id="dewplayer2" name="dewplayer2"><param name="wmode" value="transparent" /><param name="movie" value="'+SWF_PLAYER_URL+'" /><param name="flashvars" value="mp3='+Options.URLson2+'&amp;autostart=1&amp;showtime=1&amp;volume=100" /></object></span>');
    }
    if (m[0].indexOf(culang[lag].FoodAlerts.msg1) >= 0 && m[0].indexOf(culang[lag].FoodAlerts.msg2) >= 0) {
      try {
             var testt = /;'> ([0-9]+),<span><\/span>([0-9]+) <\/a>#/i.exec(m[0]);
             if (testt) {
                msg +='<div onclick="BOTransportDetect('+parseIntNan(testt[1])+','+parseIntNan(testt[2])+')" style="position: absolute; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB2RJREFUeNrsVltvXFcV/s79nDlzv/mS2HHjxKkCATUQWkRKylWtAEWCB0BCSCn0ideCEO8I8QsQQkhIEfBEVYlLVbUoqtKmkJKLHcepk7h2HN9mPPaM58y5XzbfOI1QEC88oD7QLa25nLP3Xnut9X3f2pIQAh/EkPEBjf8/x6okSbANHcV8HrJpwfB9iGIRzXoVf//HVXzly5/DmdNPNS5eung6eOv6k0eKuclLsnZ+aeC9Muh2Uedau1RCzLXTEpBlGfDYNJ4/dw4zUyP49a9+id/+7mU0azW0+33kcjkMcaX++0mGUIsg7RtoS/c3oF6bN0Wr89WZLDl9PGc1u5IU3HXE3zihG+/P5zoGIEn/RcQPf6Tvb2AL8bWTIj07ItJylM9dXmh1rjXXNr991u2fk2wFx1QdJyeb59Z2uoffBF57AsKuSShc9rw5V1OXVU1rS7J8TzOMPcM0IVQFw8MFaarGWZY89Ld/RlXXcKBc/vQhXf/+Fza3nv9UIQ9p4iBaUYQ/LK+Kz6SxNCmy/dkaU9KcfgzvBD5m72/hO7YJe3oaVySB3q3b2bhp9d8ytM7Ng5Nb41OHFrB44/DEert26PCk9sfNzqV3XP9FVZYdSTdMHM1ZP38hjn40M1aFXynj8vUFdKIUk4aGmWoeW16Inb4Hi46rD4CBNUWBFCUoDKMxDByemcbqygqSKIBVLuLVVg8+331JAcaLFk4+9Un0efgXry/97Mr29k+U737zWz8Yuzn3Uyv0YdDRkSPHsK6qMNsdfDzNUJs4gKknTmCjtYNbfoj7jLhP2+W7QrGAxngTolHG/NIy5kWEFUnBqKKjTr6cThMcHhYzSDC4t4FypYS2aozOe/55xfK8Pz3dbtsTjMYc+Mh6fbRY8FJ/D2UuCnsOUifAwPMxYho4dvxx7GkKUs/FGSuHqiqjbhsIGendIMYzsolTo00gSTFwfWIGMLi3xIPGG238uefU5KMzE4qwtR/KA9eeZAnznLDuenivtweDTlMNKMYZOnsOlqIYR2WBohRiPQxRcgMU/QCJO8Bmvws3jjFKdDY4T+F7k+lfJjUdOta5b4WBv00fb+pAbbzkKFOj1ufNKfPo3CDGQpChzQl8jzZT1eWiKekBAlf4YScZjMhH6oaIOEnhswItx7kN4nX4bH6IATrPBwHuZQJ/5f9heRZps0cK+PqzY1i8755XWzvxG5MV/bngkIm9SEbQj5nGFJthilNBine50KT1aHO0J4mYUX4v4sHBhs6a75PkCu0mrTXkNVO7nddgjllozBQxccDCGYMp8WIsbXgL6iBIFqNEh56m0DUJjY9VUC7oOEHkmn6CrhPDZ6QpU77FrFzloVRZwirrrSgaVlnXhppCLppQtAzPFFXUKiYaoxYmGyoK5P4e192952BjtQ9faAM/zBZV3w9mgzTfUoQYEXGCsB8wVwLVmgmtrGH0RBHjdQPjNXKbXI0y1lAh6o08hFEmsQ2odKwKPk9j0inGoO8jN8QIg+n2XbgDj84TxInAnR0su4P+nCqydKXnirURUx1x3QghJzuEf9mPkCYy7IZO5KYQRLVWLCNvV6hyChyPICnYMEsjUHiAOHIR+g6SzMGuuw5PDTkrQWuPFOtE8MIMY1Udr9zOZmVFiVXTygk3FNftqvYJj6DJSCWTFMmZMlRFRqfPaCimBT2C5VPcjRC5Sh1eYiCfUfAjhS2OKoE8wiSAS1bEBFXAvUQSwnETyNx0rCzDC3Tc63Rf2lfLKAyw25NelydL37MNFywfBn4KZgxjNQ2Neg4lRqaKlFyN4bEjyaSUqhfQ3tiFmbOgGzYxo0KnjqssQ6NRQhay0bg9BEEImQFsdzx0AyNOJfNWwWZQwzbmBenVQawnhmWoFC3kWaAoFbi77oOqCJltrGLJsAg+haCrF3WY9TokzWKLk5BJGhSfUcsW5HAXe5vraO/2GG1ELKgomgoy6u27nWwuCOMNU1f2c0QQJDutXvRezra+mNdhcC/USvo+JXIUEU3V4DgJAorEkDmpUODHKXpOiB7B6Dg+VSpgAARn4CGKQuIjQ7OqMgMSnEHIDqXg9fngpbXN7ssBOa48bFNxHN/YdsQbiaR/tFrQD/I/gaTxgmAQRCpGyxZKdo70yMOwCyiwzqqWo7ooGKdeF6vj1OIGs6XB0rPhfvuliZMEvUDGa/PJ7YvXtn7MS8CQ5v9yPByarq11uv7vW33RZs1mIMsVQd3yw4gbkfxSAomNQMpYYxFA1wVVToVmFpg1ZR9MHiU0ZjYUgmWYjQtzzvpvXm3/4u3ZzRfodPmRfvxwDIGS8KSyJDNdScWyjLMHm9Y3jk8VPntiyiweGSd4pAwVgoNlQq5ATdPy5HaOYDMQZBZu3N4JVza6/YU77QtXF7f/stvzLlAAVlm3R24g/9Gxyl6bsLskyb4WNjRd/8hozX768an6KRWD6tSIIVULlBGGRdbEu4HWHwRyfL/lbtxZ6VxJUzHX98I7aRx3Nd5AeCNhIPGjjj+80H/o+H81/inAAPD+pq3c2maWAAAAAElFTkSuQmCC\');   background-repeat: no-repeat; border-radius: 3px 3px 3px 3px; height: 18px; width: 18px; border: 2px inset rgb(96, 0, 0); box-shadow: 0px 0px 2px rgb(255, 255, 255); left: 3px; top: 30px; "></div>';
             }
            } catch(e) {}

    }
    if (classs.indexOf('ptChatAttack')>=0 && m[0].indexOf(culang[lag].TowerAlerts.Type+' '+culang[lag].TowerAlerts.atkType1) >= 0 && m[0].indexOf(culang[lag].TowerAlerts.target) >= 0) {
           try {
            var testt = /;'> ([0-9]+),<span><\/span>([0-9]+) <\/a>#/i.exec(m[0]);
            if (testt) {
               msg +='<div onclick="BOAttackDetect('+parseIntNan(testt[1])+','+parseIntNan(testt[2])+')" style="position: absolute; background-image: url(\'data:image/jpeg;base64,/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja3kAAQAEAAAAZAAA/+4ADkFkb2JlAGTAAAAAAf/bAIQAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQICAgICAgICAgICAwMDAwMDAwMDAwEBAQEBAQECAQECAgIBAgIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMD/8AAEQgAEgASAwERAAIRAQMRAf/EAJgAAAIDAAAAAAAAAAAAAAAAAAYHAAgJAQABBQEAAAAAAAAAAAAAAAAFAQYHCAkKEAAABQIDBQQLAAAAAAAAAAABAgQFBwMGABI2ETFWNwghIzRlQYETM2QVNRYXZxgRAAIAAgcDCAUNAAAAAAAAAAECAwQAETESBQYHQSIyIWFiEzM0NQhRcVRkNkJScqIjUxQVZRZWFxj/2gAMAwEAAhEDEQA/AMPs5ANkE5APlE+QTlA2QogBqmUR25CiPabcGMu6mqvVGquqzb6PXzU6ny6BrhYB6iaqxXULTV6BtNgpo/C0Wxl0yRzb/Vd1TW033jcd1ovmvSz0xPqelWGQ6wlE7dM0ssyoO4ihtq7K7M2qSAW4KhSqq5Rbi0SLrEZIybg+SsHGoWoAA5K5WWYAszEbrFDa7fJU8ijebZTPHW/WPOetGcX8vHl7djGvXcWxVCRCloYNUSGsVeEKQREZTfdh1UPevMlSPz1e3DMTc9v6D5b2zqfhD6Vy98t8F8LgN/c/6TJ+JfiLB2X3XDxdKzmo/P8AH0T+XY38L/lfaP3j2zj+pxdKiJ+9LviyTI5eG+OW+/VjE+2pIiyJZUTOyGOr3t2ijWKWh5u5nqCiVqraXtTtVBurkA1B4OoKQSKkJVJcNnIT4DhEX9yZhErFlIERoaC6Ir9arIWhbjDlDojRIbn7O7eYBiqsH1vm8R1ezmuVNCIsVs8SklHlsQxSDMNDlZSTik9ZKsQGR5h3XcKjrYZG6ygllYUhS/IM93o/SzKT+vuW9rqVnruTitpLUlBPQpiAJmhjbF6Fsrs9vNRO4SpgTUSlJT2gBgynMJz3mzF824285icQGEvJChqylISGxRcd0LEVFmDMTtqNaicPLhpvlrTnTSUksDwibwrEZgFpsTghmdjRlYq0SO8MkFWILQgCAqEVKtlA3DLpPlBVl1FdurPc2XrvU+kGzwn6+4Z8p9ngxP8Ahsl3Pimu6dh3l+L3z273i9StPlu7HNPgHxHG8M+iveen8zmroVDv9Pr34DUsubdtJhaJT//Z\');   background-repeat: no-repeat; border-radius: 3px 3px 3px 3px; height: 18px; width: 18px; border: 2px inset rgb(96, 0, 0); box-shadow: 0px 0px 2px rgb(255, 255, 255); left: 4px; top: 55px; "></div>';
            }
           } catch(e) {}
    }
     if (classs.indexOf('ptChatScout')>=0 && m[0].indexOf(culang[lag].TowerAlerts.Type+' '+culang[lag].TowerAlerts.atkType) >= 0 && m[0].indexOf(culang[lag].TowerAlerts.target) >= 0) {
      try {
             var testt = /;'> ([0-9]+),<span><\/span>([0-9]+) <\/a>#/i.exec(m[0]);
             if (testt) {
                msg +='<div onclick="BOAttackDetect('+parseIntNan(testt[1])+','+parseIntNan(testt[2])+')" style="position: absolute; background-image: url(\'data:image/jpeg;base64,/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja3kAAQAEAAAAUAAA/+4ADkFkb2JlAGTAAAAAAf/bAIQAAgICAgICAgICAgMCAgIDBAMCAgMEBQQEBAQEBQYFBQUFBQUGBgcHCAcHBgkJCgoJCQwMDAwMDAwMDAwMDAwMDAEDAwMFBAUJBgYJDQsJCw0PDg4ODg8PDAwMDAwPDwwMDAwMDA8MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM/8AAEQgAEgASAwERAAIRAQMRAf/EAJMAAAMBAQAAAAAAAAAAAAAAAAQFCAcJAQACAgMAAAAAAAAAAAAAAAACBQQGAAEHEAABAgMEBQURAAAAAAAAAAABAgMEBQYAETQHITESMjPwYUIUCEHBUmKCohNTY3ODVBVVFlaWEQABAgMFBgQHAAAAAAAAAAABAgMAEQQhMVESBfBBYXGBBpGhseHBIjJCghMU/9oADAMBAAIRAxEAPwCooGW52mUNVJmF2gZPR6n2y+7KKdpyDMvhB4CouauOOuhOgFRCL+a3L0u0hIQ2yVHiozPRMh6x0lymqkZlLcSkDgJDqZn0hrIJ5mBHoKqcz5pSr1BG22o0+wta03Ai4wc1Sm8gjo3aRotj7IYkpTKkg4mzzEFTFNQcgdQoi+VpE8bYG/L8xv2leK6vhobGes3OH7PzrRv2DDjDL+YeUoUV9kBGVfBVy1PYlqtzU0CiDp9Ma85BGSN+jcYdbgw2HWwHEulRWUbYUEnaIGzZ3oOusaefnanfMi+3nFQ7s7df1tkobfyKCkqSCDlCkkKE5XiYtnCPIrs/qyGy1rajIp6IrlU+gQiUxr8WtcRAOpCdhbbiYdsNlgNoS0EK7h0hNybO63uqidbDQbUU780t8JNE7N1JiqXUvvNhZCUgIBAATM/cZkme/dZGAfUc4/v0FiuocNWP+b3t7xNXPasSpsDj+OHvF+zVGI98Y6oMb3R8rvWTN3wa4FmuEiPdK4evVbTkHT/UOcR9/O47l8W0jx2+ETvC/brH/9k%3D\');   background-repeat: no-repeat; border-radius: 3px 3px 3px 3px; height: 18px; width: 18px; border: 2px inset rgb(96, 0, 0); box-shadow: 0px 0px 2px rgb(255, 255, 255); left: 4px; top: 55px; "></div>';
             }
            } catch(e) {}
     }

   }

    var m = /(Lord|Lady) (.*?)</im.exec(msg);
    if (m != null)
      msg = msg.replace (/<img (.*?>)/img, '<A onclick=ptChatIconClicked(\"'+ m[2] +'\")><img class=\"ptChatIcon\" $1</a>');
    if (Options.Smiley) {

      for (k in Smileys) {

        if (k=="(massage)")
          msg=msg.replace(k, '<img style="width:32px !important;height:24px !important" class=emoicon src=\"'+Smileys[k]+'\">');
    else if (k=="(GoHabsGo)")
          msg=msg.replace(k, '<img style="width:60px !important;height:43px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="*kissing*")
          msg=msg.replace(k, '<img style="width:47px !important;height:30px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else  if (k=="(fouet)")
          msg=msg.replace(k, '<img style="width:60px !important;height:30px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="(sonic)")
          msg=msg.replace(k, '<img style="width:64px !important;height:64px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if ( k=="(renne)" || k=="(tigre)" || k=="(girafe)" || k=="(elephant)" || k=="(rat)")
          msg=msg.replace(k, '<img style="width:60px !important;height:60px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="(spider)")
          msg=msg.replace(k, '<img style="width:95px !important;height:57px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="(hamta)" || k=="(cat)")
          msg=msg.replace(k, '<img style="width:31px !important;height:40px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="(shark2)")
          msg=msg.replace(k, '<img style="width:117px !important;height:50px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="(concombre)")
          msg=msg.replace(k, '<img style="width:100px !important;height:50px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="(baby)")
          msg=msg.replace(k, '<img style="width:56px !important;height:40px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="]:->" || k=="(pingouin)" || k=="(shark)")
          msg=msg.replace(k, '<img style="width:35px !important;height:35px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="(bath)" || k=="(emotlove2)" || k=="(smyno)")
          msg=msg.replace(k, '<img style="width:40px !important;height:40px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="(miroir)")
          msg=msg.replace(k, '<img style="width:45px !important;height:45px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="(caribou)")
          msg=msg.replace(k, '<img style="width:65px !important;height:33px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="(magebarbe)")
          msg=msg.replace(k, '<img style="width:45px !important;height:45px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else if (k=="(couette)" || k=="(ver)")
          msg=msg.replace(k, '<img style="width:60px !important;height:45px !important" class=emoicon src=\"'+Smileys[k]+'\">');
        else if (k=="(fox)" || k=="(heidy)")
          msg=msg.replace(k, '<img style="width:30px !important;height:30px !important" class=emoicon src=\"'+Smileys[k]+'\">');
        else if (k=="(autruche)")
          msg=msg.replace(k, '<img style="width:93px !important;height:84px !important" class=emoicon src=\"'+Smileys[k]+'\">');
        else if (k=="(panda)" || k=="(crabe)" || k=="(tortue)"|| k=="(vache)" || k=="(singe)" || k=="(bravo2)" || k=="(bubulle)" || k=="(chien)" || k=="(cuicui)" || k=="(bubulle)" || k=="(cochon)" || k=="(lapin)" || k=="(grenouille)")
	  msg=msg.replace(k, '<img style="width:66px !important;height:66px !important" class=emoicon src=\"'+Smileys[k]+'\">');
        else if (k=="(herisson)" || k=="(lion)" || k=="(chat)" || k=="(papillon)"  || k=="(serpent)" || k=="(dragon)" || k=="(camelot)")
          msg=msg.replace(k, '<img style="width:77px !important;height:77px !important" class=emoicon src=\"'+Smileys[k]+'\">');
        else if (k=="(ours)" || k=="(taupe)" )
          msg=msg.replace(k, '<img style="width:88px !important;height:88px !important" class=emoicon src=\"'+Smileys[k]+'\">')
        else if (k=="(bienmal)")
          msg=msg.replace(k, '<img style="width:109px !important;height:60px !important" class=emoicon src=\"'+Smileys[k]+'\">')
        else if (k=="(aigle)")
          msg=msg.replace(k, '<img style="width:65px !important;height:100px !important" class=emoicon src=\"'+Smileys[k]+'\">');
        else if (k=="(hippo)")
          msg=msg.replace(k, '<img style="width:73px !important;height:115px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	 else if (k=="(lapin1)" || k=="(lapin2)" || k=="(lapin3)")
          msg=msg.replace(k, '<img style="width:96px !important;height:96px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	 else if (k=="(Foot)")
          msg=msg.replace(k, '<img style="width:110px !important;height:110px !important" class=emoicon src=\"'+Smileys[k]+'\">');
      else if (k=="(gemini)")
		            msg=msg.replace(k, '<img style="width:50px !important;height:55px !important" class=emoicon src=\"'+Smileys[k]+'\">');
		   else if (k=="(sniper)")
		            msg=msg.replace(k, '<img style="width:79px !important;height:19px !important" class=emoicon src=\"'+Smileys[k]+'\">');
		   else if (k=="(ent)")
          msg=msg.replace(k, '<img style="width:50px !important;height:56px !important" class=emoicon src=\"'+Smileys[k]+'\">');
	else
	  msg=msg.replace(k, '<img class=emoicon src=\"'+Smileys[k]+'\">');
    }

   }
   return msg;
  },
  getAllianceLeaders : function (){
   var t = ChatStuff;
    var params = uW.Object.clone(uW.g_ajaxparams);
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetLeaders.php" + unsafeWindow.g_ajaxsuffix, {
		 method: "post",
		 parameters: params,
		 loading: true,
		 onSuccess: function (rslt) {
			 if (rslt.officers) {
				for (uid in rslt.officers) {
					var user = rslt.officers[uid];
					t.leaders[user.userId] = user.type.substr(0,4);
				}
			 }
		},
		onFailure: function () {}
  		});
	},
}

var knightRoles = [[uW.g_js_strings.commonstr.politics, 'politics', 'Pol'],[uW.g_js_strings.commonstr.marshal, 'combat', 'Com'],[uW.g_js_strings.commonstr.alchemystic, 'intelligence', 'Int'],[uW.g_js_strings.commonstr.steward, 'resourcefulness', 'Res']];
function formatUnixTime(a,b){var c=unsafeWindow.formatDateByUnixTime(a);return c}
function readTrainingOptions(){var a=getServerId();s=GM_getValue("TrainingOptions_"+a);if(s!=null){opts=JSON2.parse(s);for(k in opts){TrainOptions[k]=opts[k]}}}
function saveTrainingOptions(){var a=getServerId();setTimeout(function(){GM_setValue("TrainingOptions_"+a,JSON2.stringify(TrainOptions))},0)}
/*** Gifts ***/
myBO.Gift = {
 cont : null,
 kdodisp:{},
 amis:[],
 init : function (){
    var t = myBO.Gift;
    t.cont = document.createElement('div');
    return t.cont;
  },
   getContent : function (){
     var t = myBO.Gift;
     return t.cont;
   },
   hide : function (){
     var t = myBO.Gift;
   },
   show : function (){
    var t = myBO.Gift;
    var  m = "<DIV class=boStat><b>"+lang.Gift.title+"</b></div>";
    m+="<br>"+lang.Gift.gift+"<select id=BOKdoSel>";
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
          params.ctrl = "GiftItems";
          params.action = "getGiftItems";
        new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
         method: "post",
            	        parameters: params,
            	        onSuccess: function (rslt) {
       	          if (rslt.ok){

       	             t.kdodisp = rslt.giftItems;

    for (k in t.kdodisp) {
     if (t.kdodisp[k].itemId) {
      m+="<option value='"+t.kdodisp[k].itemId+"' "+ (Options.KDODef==t.kdodisp[k].itemId?'SELECTED ':'') +">"+unsafeWindow.ksoItems[t.kdodisp[k].itemId].name+"</option>";
     }

    }
    m+="</select>";
    m+="<input type='button' value='"+lang.General.send+"' id=BOKdoVal>&nbsp;<input type='button' value='Reset' id=BOKdoRst>&nbsp;<span id=BOKdoResul></span><hr><div id=BOKdoContenu style='max-height:400px;overflow-y:auto'></div>";
    m+="<br><hr><br><center><font size=1>"+lang.pubbao+"<br><iframe src='"+sitepub+"' width=320 marginwidth=0 marginheight=0 height=50 scrolling=no frameborder=0></iframe>";
        t.cont.innerHTML = m;
        ById("BOKdoSel").addEventListener('change', function(e){ Options.KDODef=ById("BOKdoSel").value;saveOptions(); },false);
        ById("BOKdoVal").addEventListener('click', function(e){ t.sendGift(); },false);
        ById("BOKdoRst").addEventListener('click', function(e){ Options.KDOUser={}; saveOptions(); },false);

        t.findFriends();
       } // fin rsl.ok
      }
    });// fin de la requete de la liste des kdo dispo
   },
   saveUser: function(userId) {
    var t = myBO.Gift;
    if (Options.KDOUser===undefined)
     Options.KDOUser={};
     if (Options.KDOUser[userId]===undefined)
        Options.KDOUser[userId]="OK";
   },
   findFriends:function() {
    var t = myBO.Gift;
    uW.BOSaveUserGift = t.saveUser;
    var m="<table width=100%><tr><td width=30>&nbsp;</td><td></td><td></td></tr>";
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
                params.ctrl = "allianceGifting\\AllianceGiftingServiceAjax";
                params.action = "getRecipients";
              new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
               method: "post",
                  	        parameters: params,
                  	        onSuccess: function (rslt) {
          	          if (parseInt(rslt.freeSlot)>0) {
          	          var rsp=rslt.recipients;
          	          var amis = "";
          	          for (k in rsp) {
          	           if (rsp[k].userId) {

          	             m+="<tr><td><input type=checkbox id='KDO"+rsp[k].userId+"' "+(Options.KDOUser[rsp[k].userId]?'CHECKED ':'')+" onchange='BOSaveUserGift("+rsp[k].userId+");'></td><td>"+rsp[k].displayName+"</td><td>"+rsp[k].userId+"</tr>";
          	           }
          	           ById("BOKdoContenu").innerHTML=m+"</table>";
       	          }


       	        }else {

       	         ById("BOKdoContenu").innerHTML=m+"<tr><td colspan=3>"+lang.Gift.nobody+"</table>";
       	         ById("BOKdoVal").disabled=true;

       	       }  }
       	    });// fin de la requete de la liste des kdo dispo
   },
   sendGift:function() {
    var t = myBO.Gift;
    var amis="";
     for (k in Options.KDOUser)
     {
       	    if (ById("KDO"+k))
       	        amis += k +"|";
     }
     amis = amis.substring(0,amis.length-1);
     if (Options.KDODef==0) Options.KDODef=931;
     if (amis!="") {
     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		                params.ctrl = "allianceGifting\\AllianceGiftingServiceAjax";
		                params.action = "sendGift";
		                params.itemId=Options.KDODef;
		                params.recipients = amis;
		              new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
		               method: "post",  parameters: params,
               	        onSuccess: function (rslt) {
               	           ById("BOKdoContenu").innerHTML=lang.Gift.oksend;
               	        }
        });
    } else {
      ById("BOKdoResul").innerHTML=lang.Gift.nomembers;
    }
  },
}
/** STATISTIQUES **/
myBO.Attaque = {
 cont : null,
 displayTimer : null,
 state : null,
 curTabBut : null,
 curTabName : null,
 BOAttackTimer: null,
 sourceCity : {},
 destinationCity : {},
 rows : [],
 iused : new Array(),
 init : function (){
   var t = myBO.Attaque;
   t.cont = document.createElement('div');
   t.state = null;
   clearTimeout (t.displayTimer);
   return t.cont;
 },
  getContent : function (){
    var t = myBO.Attaque;
    return t.cont;
  },
  hide : function (){
    var t = myBO.Attaque;
    t.state = null;
    clearTimeout (t.displayTimer);
  },
  show : function (){
    var t = myBO.Attaque;
    var rownum = 0;
    var ModelCity = {};
    if (t.state == null) {
         m = "<DIV class=boStat><b>"+lang.Attaque.title+"</b> - <input type=button value='?' id=boaideattaquer class=boAide></div>";
         m +="<div id='statpourRAA'></div>";
         m += "<TABLE width=600 class=ptTab border=0 align=center>\
           <tr><td colspan=4 align=center><input type=button id=REEaction value='"+lang.Attaque.scout+"'>&nbsp;<input type=button id=RAAaction value='"+lang.Attaque.attack+"'>&nbsp;&nbsp;<input type=button id=RENaction value='"+lang.Attaque.renforce+"'>&nbsp;&nbsp;<input type=button id=RENBaction value='"+lang.Attaque.renforcefood+"'></td></tr><tr align=center valign=top><td colspan=1 width=130><b><u>"+lang.General.source+"</b></u><br><span id=RAAsrcRptspeedcity></span></td>\
           <td colspan=1><b><u>"+lang.General.dest+"</b></u><br><span id='BOrefreshCo'>X:</span><input type=text id=RAAtypetrpx size=3>&nbsp;Y:<input type=text id=RAAtypetrpy size=3><br><a href='javascript:void(0);' id='BOchargelistelieux'>"+lang.General.members+"</a> : <select id='listeFavori'></select></td>\
           <td><b><u>Distance</u></b><br><span id='BOEstimationD'>&nbsp;</span><td><b><u>"+lang.Attaque.BOVilleProche+"</u></b><br><span id=BOVilleProche></span>\
           </tr><tr align=center valign=top>\
           <td colspan=4 align=left><table border=0 bordercolor=black cellspacing=0 cellpadding=0 width=100% style='text-align:center'><tr><td rowspan=13><div id=RAAstatsource></div></td><td colspan=2><a href='javascript:void(0)' id=BO_RAZ_Units>"+uW.g_js_strings.commonstr.troops+"</a></td><td>"+lang.Attaque.TimeAttack+"</td><td>"+lang.Attaque.Timerenforce+"</td></tr>";
            for (r=1; r<13; r++){
   	     m += '<tr><td align=right><img height=20 title="'+uW.unitcost['unt'+r][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_'+r+'_30_s34.jpg></td><td align=left><input style="border:1px solid black;height:16px;font-size:11px;" id="RAAnbunit'+r+'" type=text size=7 value="0" ></td><td><span id="BOEstimationTT'+r+'">&nbsp;</span></td><td><span id="BOEstimationTZ'+r+'">&nbsp;</span></td></tr>';
      	}
      	var itemlist=[55,57,931,932];
	var BOitems="";
	for(var i=0;i<itemlist.length;i++){
		 BOitems += "<img src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/30/"+itemlist[i]+".jpg' /><input type=checkbox id='BOitem_"+itemlist[i]+"'><span id='BOitemSpan_"+itemlist[i]+"'>" + unsafeWindow.ksoItems[itemlist[i]].count + "</span>&nbsp;";
        }
        m += "</table></td></tr>\
              <tr><td colspan=2>"+uW.g_js_strings.commonstr.knight+" : <SELECT id='RAApiKnight' type=list></select> "+lang.Attaque.option+"<br>"+BOitems+"</td><td colspan=2><div id=BOinfodest></div><center><input type=button value='"+lang.General.now+"' id=BOrechdest></td></tr>\
              <tr><td colspan=4><b><div class=boStat>"+lang.Attaque.BO_AT_Fav+"</div></tr><tr><td colspan=2><select id=BO_AT_Fav></select><input type=button value='"+lang.Attaque.BO_AT_Fav_Sup+"' id=BO_AT_Fav_Sup><input type=button value='"+lang.Attaque.BO_AT_Fav_RESET+"' id=BO_AT_Fav_RESET></td><td colspan=2>"+lang.Attaque.BO_AT_Fav_Nom+" : <input type=type id=BO_AT_Fav_Nom size=10 maxlength=12>&nbsp;<input type=checkbox id=BO_AT_Fav_Coo> coords&nbsp;<input type=button value='"+lang.General.save+"' id=BO_AT_Fav_ajou>\
              <tr><td><input type=button id=RAAaction2 value='"+lang.Attaque.attack+"'></td><td colspan=4><div id=ptRAAStatus style='overflow-y:auto; max-height:50px; height: 50px;'></div></td></tr>\
              <tr><td colspan=4><b><div class=boStat>"+lang.Attaque.titleprog+"</div></tr><tr><td><input type=button id='BOActiveAttack' value='"+lang.Attaque.buttonactiv+" : OFF' ></td><td colspan=3><span id='BOCompAttack'></span></tr>\
              <tr><td><b>"+lang.Attaque.timeAr+"</b><input type=text size=7 id='BOHorloge' value='" + Options.AttackHorloge + "'></td><td><input type=button value='"+lang.General.save+"' id='BOSaveAttack'></td><td><input type=button value='"+lang.General.edit+"' id='BOEditAttack' disabled></td></tr>\
              <tr><td colspan=4><span id='BOAttackProg'></span></td></tr></table>";
        t.cont.innerHTML = m;
        t.statpourRAA = ById ('statpourRAA');
        t.Favoris = ById('BO_AT_Fav');
        t.BOinfodest = ById('BOinfodest');
        t.BOrechdest = ById("BOrechdest");
         ById('boaideattaquer').addEventListener('click', function(){
	       	 window.open(sitesupport+"?page=aide_attaquer");
    	} , false);
        t.BOrechdest.addEventListener ('click', function() {
         t.rechercheDEST();
        }, false);
	function metajourfavori() {
	       t.Favoris.innerHTML="<option value=''>...</option>";
	       var lisf = Options.AttackFav;
	       for (var m in lisf) {
	         var lis = lisf[m];
	         if (lis!=null)
	          t.Favoris.innerHTML+="<option value='"+m+"'>"+lis[0]+"</option>";
      	       }
	}
       ById("BO_AT_Fav_RESET").addEventListener ('click', function() {
	 Options.AttackFav={};
	 saveOptions();
         metajourfavori();
       }, false);
       ById("BO_AT_Fav_Sup").addEventListener ('click', function() {
       numfav=ById("BO_AT_Fav").value;
       if (numfav!="") {
        Options.AttackFav[numfav]={};
        delete Options.AttackFav[numfav];
        saveOptions();
        metajourfavori();
       }
       }, false);
 	  ById("BO_RAZ_Units").addEventListener ('click', function() {
  	for (r=1; r<13; r++) ById("RAAnbunit"+r).value=0;
 	}, false);
       ById("BO_AT_Fav_ajou").addEventListener ('click', function() {
        if (ById("BO_AT_Fav_Nom").value=="") {
         alert(lang.Attaque.error1);
         return;
        }
        var a =ById("BO_AT_Fav_Nom").value;
        Options.AttackFav[a]={};
        var lisf = Options.AttackFav[a];
        lisf[0]=ById("BO_AT_Fav_Nom").value;
        for (r=1; r<13; r++) lisf[r]=ById("RAAnbunit"+r).value;
        if (ById("BO_AT_Fav_Coo").checked) {
         lisf[13]=t.destinationCityx.value;
         lisf[14]=t.destinationCityy.value;

        }
        ById("BO_AT_Fav_Coo").checked=false;
        ById("BO_AT_Fav_Nom").value="";
        saveOptions();
	metajourfavori();
       }, false);
       ById("BO_AT_Fav").addEventListener ('change', function() {
         numfav=ById("BO_AT_Fav").value;
         if (numfav=="") {
          for (r=1; r<13; r++) ById("RAAnbunit"+r).value=0;
         }else {
          var lisf = Options.AttackFav[numfav];
          for (var m in lisf) {
           if(m>0 && m<13)
	    if (ById("RAAnbunit"+m)) ById("RAAnbunit"+m).value=lisf[m];
	   if (m==13)
	    if (lisf[m]>0)
	     t.destinationCityx.value=lisf[m];
	   if (m==14)
	    if (lisf[m]>0)
	     t.destinationCityy.value=lisf[m];
	  }
         }
       }, false);
       ById("BOitem_55").addEventListener ('click', function() {
        ById("BOitem_57").checked=false;
        t.estimerRes();
       }, false);
       ById("BOitem_57").addEventListener ('click', function() {
              ById("BOitem_55").checked=false;
              t.estimerRes();
       }, false);
        t.statutRAA = ById ('ptRAAStatus');
        t.destinationCityx = ById ('RAAtypetrpx');
        t.destinationCityy = ById ('RAAtypetrpy');
        t.destinationCityx.value = Options.Xrenfort;
        t.destinationCityy.value = Options.Yrenfort;
        if (ById ('maparea_map').style.display!="none") {
         t.destinationCityx.value = ById ('mapXCoor').value;
         t.destinationCityy.value = ById ('mapYCoor').value;
         t.rechercheDEST();
        }
        ById("BOrefreshCo").addEventListener ('click', function () {
        t.destinationCityx.value = ById ('mapXCoor').value;
         t.destinationCityy.value = ById ('mapYCoor').value;
         t.rechercheDEST();
        }, false);
        t.listeFavoris = ById ('listeFavori');
        t.listeFavoris.addEventListener ('change', t.SelectFavoris, false);
        t.chargelistelieux = ById ('BOchargelistelieux');
        t.chargelistelieux.addEventListener ('click', t.chercherFavoris, false);
        t.actionREN = ById ('RENaction');
        t.actionRENB = ById ('RENBaction');
        t.actionREE = ById ('REEaction');
        t.actionRAA = ById ('RAAaction');
  	t.actionREN.addEventListener ('click', function () { t.clickATTAQUEDo(2,0); }, false);
        t.actionRAA.addEventListener ('click',  function () { t.clickATTAQUEDo(4,0); }, false);
ById ('RAAaction2').addEventListener ('click',  function () { t.clickATTAQUEDo(4,0); }, false);


        t.actionRENB.addEventListener ('click',  function () { t.clickATTAQUEDo(2,1); }, false);
        t.actionREE.addEventListener ('click',  function () { t.clickATTAQUEDo(3,0); }, false);
        t.destinationCityx.addEventListener ('keyup', function () { t.estimerRes(); }, false);
        t.destinationCityy.addEventListener ('keyup', function () { t.estimerRes(); }, false);
        var dcp0 = new CdispCityPicker ('ptRAA0', ById('RAAsrcRptspeedcity'), false, t.clickRAACitySourceSelect, Cities.byID[unsafeWindow.currentcityid].idx);
        t.state = 1;
        t.estimerRes();
        t.BOAttackProg = ById ('BOAttackProg');
        t.BOHorloge = ById ('BOHorloge');
        t.BOSaveAttack = ById ('BOSaveAttack');
        t.BOEditAttack = ById ('BOEditAttack');
        t.BOCompAttack = ById ('BOCompAttack');
        t.BOActiveAttack  = ById ('BOActiveAttack');
        t.BOActiveAttack.addEventListener ('click', t.AutoattackOnOff, false);
        t.BOSaveAttack.addEventListener ('click', function () {
        var itemlist=[55,57,931,932];
	  for(var i=0;i<itemlist.length;i++){
	        ById('BOitemSpan_'+itemlist[i]).checked=false;
          }
         t.enregistreAttack();
        }, false);
        if (Options.AttackCibleX!=0 && Options.AttackCibleY!=0) {
         t.BOEditAttack.disabled=false;
        }
        t.BOEditAttack.addEventListener ('click', function () {
          t.destinationCityx.value = Options.AttackCibleX;
          t.destinationCityy.value = Options.AttackCibleY;
          ById("RAApiKnight").value=Options.AttackKnight;
          nHtml.Click(ById("ptRAA0_"+Cities.byID[Options.AttackFromCity].idx));
          for (r=1; r<13; r++) {
	      ById("RAAnbunit"+r).value=Options.AttackUnits[r-1];
          }
        }, false);
        metajourfavori();
        if (Options.AttackOnOff) {
          t.BOActiveAttack.value=lang.Attaque.buttonactiv+' : ON';
    	  t.activeAttack();
        }
        t.clickRAACitySourceSelect(t.sourceCity);
       }
    },
    getclosestcity : function (){
	var t = myBO.Attaque;
	var x1 = parseInt(t.sourceCity.x);
	var x2 = parseInt(t.destinationCityx.value);
	var y1 = parseInt(t.sourceCity.y);
	var y2 = parseInt(t.destinationCityy.value);
	var dist = distance (x1, y1, x2, y2);
     	var closestDist=999999;
     	var closestLoc=null;
 	var closestNum=1;
 	for (var c=0; c<Cities.numCities; c++){
	 var city = Cities.cities[c];
	 var dist=distance(city.x,city.y,x2,y2);
	 if(dist<closestDist) {
 	  closestDist=dist;
 	  closestLoc=city.x +','+ city.y;
 	   closestNum=c;
	  }
	}
	return closestNum;
    },
    MapAjax : new CMapAjax(),
    rechercheDEST:function() {
     var t = myBO.Attaque;
     t.BOinfodest.innerHTML="<center>"+uW.g_js_strings.commonstr.research+"</center>";
     var xcoord=t.destinationCityx.value;
     var ycoord=t.destinationCityy.value;
     t.MapAjax.request (xcoord, ycoord, 1, function(left, top, width, rslt) {
       	   map = rslt.data;
     	   for (k in map){
		   if (xcoord==map[k].xCoord && ycoord==map[k].yCoord) {
		    var m="";
		    var uid=map[k].tileUserId;

		    if (uid==null || uid==0 || uid=="0") {
		     t.BOinfodest.innerHTML="-";
		     return;
		    }
		    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		               params.checkArr = uid;
		               new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getOnline.php" + unsafeWindow.g_ajaxsuffix, {
		                 method: "post",
		                 parameters: params,
		               onSuccess: function (rslt) {
		                  var p = rslt.data;
		         	  if (p[uid] == true) {
		         	         m = '<span style="color:green"><b>'+uW.g_js_strings.commonstr.online+'</b></span>';
		         	       } else {
		         	          m = '<center><span style="color:red"><b>'+uW.g_js_strings.commonstr.offline+'</b></span>';
		                   }
		                   var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
			           params.pid = uid;
				   new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/viewCourt.php" + unsafeWindow.g_ajaxsuffix, {
				         method: "post",
				         parameters: params,
				         onSuccess: function (rslt) {
				            t.BOinfodest.innerHTML="<center><b>" + rslt.playerInfo.displayName+"</b><bR>"+m;
				         },
				         onFailure: function (rslt) {},
    				   });
		             },onFailure: function (rslt) {},
			 });
		  }
           }
     });
    },
    AutoattackOnOff:function() {
     var t = myBO.Attaque;
     t.BOCompAttack.innerHTML='';
     clearTimeout (t.BOAttackTimer);
     if (t.BOActiveAttack.value==lang.Attaque.buttonactiv+' : OFF') {
    	t.BOActiveAttack.value=lang.Attaque.buttonactiv+' : ON';
    	     Options.AttackOnOff = true;
    	     saveOptions();
    	     t.activeAttack();

    	    } else {
    	     Options.AttackOnOff = false;
    	     saveOptions();
    	     t.BOActiveAttack.value=lang.Attaque.buttonactiv+' : OFF';
    }
    },
    activeAttack:function() {
     var t = myBO.Attaque;
     clearTimeout (t.BOAttackTimer);
     if (Options.AttackGoHorloge) {
       var depart=new Date()
       depart.setTime(Options.AttackGoHorloge);
       var now = unixTime()*1000;
       if (now >= Options.AttackGoHorloge) {
	t.BOCompAttack.innerHTML='<center><font color=red>'+lang.Attaque.BOCompAttack+'</font></center>';
	t.destinationCityx.value = Options.AttackCibleX;
	t.destinationCityy.value = Options.AttackCibleY;
	ById("RAApiKnight").value=Options.AttackKnight;
	nHtml.Click(ById("ptRAA0_"+Cities.byID[Options.AttackFromCity].idx));
	for (r=1; r<13; r++) {
	   ById("RAAnbunit"+r).value=Options.AttackUnits[r-1];
          }
      t.clickATTAQUEDo(4,0);
      clearTimeout (t.BOAttackTimer);
      Options.AttackGoHorloge=null;
      Options.AttackOnOff = false;
      saveOptions();
      return;
     }
     if (now > depart.getTime()) {
         t.BOCompAttack.innerHTML='<center><font color=red>'+lang.Attaque.error2+'</font></center>';
         clearTimeout (t.BOAttackTimer);
       	 Options.AttackGoHorloge=null;
         saveOptions();
         return false;
     }
     t.BOAttackTimer=setTimeout(function(){
        var depart=new Date();
	depart.setTime(Options.AttackGoHorloge);
        var now = unixTime()*1000;
        var tempsrestant = depart.getTime() - now;
        t.BOCompAttack.innerHTML='<center><font color=red><b>'+lang.Attaque.BOCompAttackIn+' '+timestr(tempsrestant/1000)+'</b></font></center>';
        t.activeAttack();
      },1000);
     }
    },
    enregistreAttack : function() {
     var t = myBO.Attaque;
     if (t.BOHorloge.value.match("^[0-9]{2}:[0-9]{2}:[0-9]{2}$")) {
       var horloge = t.BOHorloge.value;
       Options.AttackHorloge = horloge;
       var ndate=new Date();
       ndate.setHours(horloge.substr(0,2));
       ndate.setMinutes(horloge.substr(3,2));
       ndate.setSeconds(0);
       var atunits=new Array();
       for (r=1; r<13; r++) {
          atunits.push(parseInt(ById("RAAnbunit"+r).value));
       }
       Options.AttackUnits = atunits;
       Options.AttackFromCity = t.sourceCity.id;
       Options.AttackKnight = ById("RAApiKnight").value;
       Options.AttackCibleX = t.destinationCityx.value;
       Options.AttackCibleY = t.destinationCityy.value;

       var x1 = parseInt(t.sourceCity.x);
       var x2 = parseInt(t.destinationCityx.value);
       var y1 = parseInt(t.sourceCity.y);
       var y2 = parseInt(t.destinationCityy.value);
       var dist = distance (x1, y1, x2, y2);
       var tempplusgrand=0;
       for (r=1; r<13; r++){
         if (parseInt(ById("RAAnbunit"+r).value)>0) {
               var m = estETA(dist, r, t.sourceCity.id,4);
               if (tempplusgrand<m.ETA) tempplusgrand=m.ETA;
         }
       }
       var departtime=ndate.getTime() - (tempplusgrand*1000);
       var depart=new Date()
       depart.setTime(departtime);
       var now = unixTime()*1000;
       if (now > depart.getTime()) {
        t.BOAttackProg.innerHTML = lang.Attaque.error3;
        return false;
       }
       Options.AttackGoHorloge =  depart.getTime();
       saveOptions ();
       t.BOAttackProg.innerHTML = Options.AttackCibleX + ","+ Options.AttackCibleY +" "+lang.Attaque.saved;
       t.BOEditAttack.disabled=false;
     } else {
      t.BOAttackProg.innerHTML = lang.Attaque.error4;;
     }
    },
    clickATTAQUEDo: function(typemarche, bouffe, porc) {
      var t = myBO.Attaque;
      var totalunit=0;
      if (typemarche==3 && ById("RAAnbunit3").value==0) ById("RAAnbunit3").value=1;
      for (r=1; r<13; r++){
         if (typemarche==3 && r!=3) {
          ById("RAAnbunit"+r).value=0;
         }
          if (parseInt(ById("RAAnbunit"+r).value) > parseInt(ById("RAAdestunit"+r).value)) {
            ById("RAAnbunit"+r).style.backgroundColor="red";
            return false;
          }
          totalunit=totalunit+parseInt(ById("RAAnbunit"+r).value);
          ById("RAAnbunit"+r).style.backgroundColor="";
      }
      var errMsg = "";
      if (isNaN (t.destinationCityx.value) ||t.destinationCityx.value<0 || t.destinationCityx.value>749)
            errMsg = "X doit &ecirc;tre entre 0 et 749<BR>";
      if (isNaN (t.destinationCityy.value) || t.destinationCityy.value<0 || t.destinationCityy.value>749)
       errMsg += "Y doit &ecirc;tre entre 0 et 749<br>";

      if (ById("RAApiKnight").value==0 && typemarche==4) {
       errMsg += uW.g_js_strings.modal_attack.chooseknightlead + "<BR>";
      }
      if (errMsg != "") {
           t.statutRAA.innerHTML = "<FONT COLOR=#550000>"+ errMsg +"</font>";
           return;
      }
      var x=t.destinationCityx.value;
      var y=t.destinationCityy.value;
      t.SaveCoordsOptions(x,y);
      var e=1;
      var f=uW.unixtime();
      if(Seed.playerEffects.aurasExpire){
      if(Seed.playerEffects.aurasExpire>f){e=1.15}}
      if(Seed.playerEffects.auras2Expire){if(Seed.playerEffects.auras2Expire>f){e=1.3}}
     var l_elem=ById("BOitem_931");
     if(l_elem&&l_elem.checked&&parseInt(Seed.items["i931"])>0){
       e+=0.25;
     }
     var l_elem=ById("BOitem_932");
     if(l_elem&&l_elem.checked&&parseInt(Seed.items["i932"])>0){
       e+=0.5;
     }
     var q=EffetTronePrc(66).percent;
     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
     if (totalunit==0) {
         t.statutRAA.innerHTML = '<FONT COLOR=#550000>'+uW.g_js_strings.modal_attack_do.sendtroop+'</font>';
           return;
     }
     var niveauPointRall=parseInt(getCityBuilding (t.sourceCity.id, 12).maxLevel);
         var maxtroupe=parseInt(niveauPointRall*10000*e);
         if (niveauPointRall==11) maxtroupe=parseInt(150000*e);
         if (niveauPointRall==12) maxtroupe=parseInt(200000*e);

      maxtroupe=Math.round(maxtroupe*(1+q/100));
      if (totalunit>maxtroupe) {
       t.statutRAA.innerHTML = '<FONT COLOR=#550000>Impossible avec plus de '+maxtroupe+' unit&eacute;es a la fois.</font>';
       return;
      }
      var iused=new Array();
      var itemlist=[55,57,931,932];
      for(var i=0;i<itemlist.length;i++){

       var l_elem=ById("BOitem_"+itemlist[i]);
       if(l_elem&&l_elem.checked&&parseInt(Seed.items["i"+itemlist[i]])>0){
        iused.push(itemlist[i]);
       }
      }
      var res=0;
      if (bouffe==1) {
       for (var i=1;i<13;i++) {
        res += parseInt(unsafeWindow.unitstats['unt'+i][5] * ById("RAAnbunit"+i).value * (1 + (0.10 * Seed.tech.tch10)));
       }
       }
      params.items=iused.join(",");
         params.cid= t.sourceCity.id;
         params.type = typemarche;
         params.xcoord = x;
         params.ycoord = y;
         if (typemarche==3)
           params.kid=0;
         else
   	   params.kid= ById("RAApiKnight").value;
	 params.r1 = res;
	 params.u1 = 0;
  	 params.u2 = 0;
  	 params.u3 = 0;
  	 params.u4 = 0;
  	 params.u5 = 0;
  	 params.u6 = 0;
  	 params.u7 = 0;
  	 params.u8 = 0;
  	 params.u9 = 0;
  	 params.u10 = 0;
  	 params.u11 = 0;
 	 params.u12 = 0;
      if (typemarche!=3) {
        if (ById("RAAnbunit1").value>0) params.u1 = ById("RAAnbunit1").value;
	if (ById("RAAnbunit2").value>0) params.u2 = ById("RAAnbunit2").value;
	if (ById("RAAnbunit3").value>0) params.u3 = ById("RAAnbunit3").value;
	if (ById("RAAnbunit4").value>0) params.u4 = ById("RAAnbunit4").value;
	if (ById("RAAnbunit5").value>0) params.u5 = ById("RAAnbunit5").value;
	if (ById("RAAnbunit6").value>0) params.u6 = ById("RAAnbunit6").value;
	if (ById("RAAnbunit7").value>0) params.u7 = ById("RAAnbunit7").value;
	if (ById("RAAnbunit8").value>0) params.u8 = ById("RAAnbunit8").value;
	if (ById("RAAnbunit9").value>0) params.u9 = ById("RAAnbunit9").value;
	if (ById("RAAnbunit10").value>0) params.u10 = ById("RAAnbunit10").value;
	if (ById("RAAnbunit11").value>0) params.u11 = ById("RAAnbunit11").value;
	if (ById("RAAnbunit12").value>0) params.u12 = ById("RAAnbunit12").value;

	}else {
	 params.u3 = ById("RAAnbunit3").value;

	}
  	t.actionRAA.disabled=true;
        t.actionREN.disabled=true;
        t.actionREE.disabled=true;
	t.statutRAA.innerHTML = "<i><b>"+uW.g_js_strings.commonstr.loadingddd+"</b></i>";
	new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
	              method: "post",
	              parameters: params,
	              loading: true,
	              onSuccess: function (transport) {
	                  var t = myBO.Attaque;
	                  var rslt = transport;
	                  if (rslt.ok) {

			   var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
	                   var ut = unsafeWindow.unixtime();
	                   var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
	                   for(i = 0; i <= unitsarr.length; i++){
	                   	if(params["u"+i]){
	                  	unitsarr[i] = params["u"+i];
	                  	}
	                   }
	                   var resources=new Array();
	                   resources[0] = params.gold;
	                   for(i=1; i<=4; i++){
	                  	resources[i] = params["r"+i];
	                   }
	                   var currentcityid =  t.sourceCity.id;
	                   unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
	                   //unsafeWindow.update_seed(rslt.updateSeed)
	                   if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};

	                   for(var i=0;i<iused.length;i++){
			    Seed.items["i"+iused[i]]=parseInt(Seed.items["i"+iused[i]])-1;unsafeWindow.ksoItems[iused[i]].subtract();
			   }
	                   if (typemarche==2) var typeattaque=lang.Attaque.marche2;
	                   if (typemarche==4) var typeattaque=lang.Attaque.marche3;
	                   if (typemarche==3) {var typeattaque=lang.Attaque.marche4;  ById("RAAnbunit3").value=0; }
     	 		   t.statutRAA.innerHTML = "<center><font size='3px'><b>"+typeattaque+"</b></font></center>";
	                   t.actionRAA.disabled=false;
	                   t.actionREE.disabled=false;
      			   t.actionREN.disabled=false;
      			   t.clickRAACitySourceSelect(t.sourceCity);
      			    if (porc) {

			   	                    t.clickATTAQUEDo(typemarche, bouffe, porc);
	                   }
	                  } else {
	                    if (rslt.user_action) {
			   	t.statutRAA.innerHTML ="<font color=red size='3px'><b>CAPTCHA ALERT !<b></font>";
			   	 t.actionRAA.disabled=false;
      			     t.actionREN.disabled=false;
      			     t.actionREE.disabled=false;
			    } else {
			    t.statutRAA.innerHTML = lang.Attaque.error0;
			     if (rslt.msg) {
			       t.statutRAA.innerHTML +="<br><font color=black size='2px'>" + rslt.msg +"</font>";

	                     t.actionRAA.disabled=false;
      			     t.actionREN.disabled=false;
      			     t.actionREE.disabled=false;
      			     }else{
      			      t.statutRAA.innerHTML +=lang.Attaque.error0;
         	     	      t.actionRAA.disabled=false;
     			     t.actionREN.disabled=false;
      			     t.actionREE.disabled=false;
      			     }
      			    }
	                  }
	                  },
	                  onFailure: function () {
	                    var t = myBO.Attaque;
	                    t.statutRAA.innerHTML = lang.Attaque.error0;
	                    t.actionRAA.disabled=false;
      			    t.actionREN.disabled=false;
      			    t.actionREE.disabled=false;
	                  }
	          });
    },
    estimerRes: function() {
     var t = myBO.Attaque;
     var x1 = parseInt(t.sourceCity.x);
     var x2 = parseInt(t.destinationCityx.value);
     var y1 = parseInt(t.sourceCity.y);
     var y2 = parseInt(t.destinationCityy.value);
     var dist = distance (x1, y1, x2, y2);
     ById("BOEstimationD").innerHTML = '<b>' + dist + '</b>&nbsp;<a href="javascript:void(0)" onclick="cm.utils.CoordinateLinkController.onClick(event)" class="coordinateLink">('+ t.destinationCityx.value +','+ t.destinationCityy.value +')</a>';
     for (r=1; r<13; r++){
        var m = estETA(dist, r, t.sourceCity.id,4);
        ById("BOEstimationTT"+r).innerHTML = "<b>" + m.etaStr + "</b>";
        var m = estETA(dist, r, t.sourceCity.id,2);
        ById("BOEstimationTZ"+r).innerHTML = "<b>" + m.friendEtaStr + "</b>";
     }
    var closestDist=999999;
	var closestLoc=null;
	var closestNum=1;
	for (var c=0; c<Cities.numCities; c++){
	var city = Cities.cities[c];
	var dist=distance(city.x,city.y,x2,y2);
	if(dist<closestDist) {
	 closestDist=dist;
	 closestLoc=city.x +','+ city.y;
	 closestNum=c+1;
	}
	}
	ById("BOVilleProche").innerHTML='<input type="submit" value="'+closestNum+'" class="castleBut castleButNon">'
    },
    SelectFavoris:function() {
      var t = myBO.Attaque;
      if (t.listeFavoris.value!='') {
       var valeur=t.listeFavoris.value;
       var x=valeur.substr(0, valeur.lastIndexOf(','));
       var y=valeur.substr(valeur.lastIndexOf(',')+1, valeur.length);
       t.destinationCityx.value = x;
       t.destinationCityy.value = y;
      }
      t.estimerRes();
     },
      chercherFavoris: function() {
      var t = myBO.Attaque;
      var myA = getMyAlliance ();
      if (myA[0]!=0) {
         var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
         params.perPage = 100;
         params.allianceId = myA[0];
             new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserLeaderboard.php" + unsafeWindow.g_ajaxsuffix, {
   	        method: "post",
   	        parameters: params,
   	        onSuccess: function (rslt) {
   	          if (rslt.ok){
   	           var z=0;
   	           var m="";
   	           for (var i=0; i<rslt.results.length; i++){
        		      p = rslt.results[i];
   		      if (p.userId != 0){
   		       for (var c=0; c<p.cities.length; c++){
   		         if (Seed.player.name!=p.displayName) {
   		          m += "<option value='" + p.cities[c].xCoord + ","+ p.cities[c].yCoord+"'>" + p.displayName + " - Ville " + (c+1) + " - " + p.cities[c].xCoord + "," + p.cities[c].yCoord+"</option>";
   		         }
   		       }
   		      }
         	    }
         	    t.listeFavoris.innerHTML="<option value=''>...</option>"+m;
   	          }
   	        },
   	        onFailure: function (rslt) {
   	          t.listeFavoris.innerHTML="<option>...</option>";
   	        },
       	});
      } else {
        t.listeFavoris.innerHTML="<option>...</option>";
      }
  },
   SaveCoordsOptions: function(x,y) {
       Options.Xrenfort = x;
       Options.Yrenfort = y;
       saveOptions ();
  },
  clickRAACitySourceSelect : function (city){
     var t = myBO.Attaque;
     if (t.sourceCity!=city) {
      t.sourceCity = city;
     }
     var m="";
     m="<table cellspacing=0 cellpadding=0 width=80%><tr><td colspan=2>"+uW.g_js_strings.commonstr.troops+"</tr>";
     var cityID = 'city'+ t.sourceCity.id;
     for (r=1; r<13; r++){
       m += '<tr><td align=right><img title="'+unsafeWindow.unitcost['unt'+r][0]+'" height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_'+r+'_30_s34.jpg></td>\
             <td align=left><input style="border:1px solid black;height:16px;font-size:11px;" id="RAAdestunit'+r+'" type=text size=7 readonly value="'+parseInt(Seed.units[cityID]['unt'+r])+'">&nbsp;\
             <input type=button value=">" id="RAApdestunit'+r+'"  style="border:1px solid black;height:16px;font-size:11px;"></td></tr>';
     }
     m += "</table>";
     ById("RAAstatsource").innerHTML = m;
        var knt = new Array();
        for (k in Seed.knights['city' + t.sourceCity.id]){
               		if (Seed.knights['city' + t.sourceCity.id][k]["knightStatus"] == 1 && Seed.leaders['city' + t.sourceCity.id]["resourcefulnessKnightId"] != Seed.knights['city' + t.sourceCity.id][k]["knightId"] && Seed.leaders['city' + t.sourceCity.id]["politicsKnightId"] != Seed.knights['city' + t.sourceCity.id][k]["knightId"] && Seed.leaders['city' + t.sourceCity.id]["combatKnightId"] != Seed.knights['city' + t.sourceCity.id][k]["knightId"] && Seed.leaders['city' + t.sourceCity.id]["intelligenceKnightId"] != Seed.knights['city' + t.sourceCity.id][k]["knightId"]){
               			knt.push ({
               				Name:   Seed.knights['city' + t.sourceCity.id][k]["knightName"],
               				Combat:	Seed.knights['city' + t.sourceCity.id][k]["combat"],
               				ID:	Seed.knights['city' + t.sourceCity.id][k]["knightId"],
               			});
               		}
               }
               knt = knt.sort(function sort(a,b) {a = parseInt(a['Combat']);b = parseInt(b['Combat']);return a == b ? 0 : (a > b ? -1 : 1);});
               ById('RAApiKnight').innerHTML="";
               var o = document.createElement("option");
     	       o.text = uW.g_js_strings.modal_attack.dchooseknightd;
     	       o.value = 0;
               ById("RAApiKnight").options.add(o);
               for (k in knt){
            			if (knt[k]["Name"] !=undefined){
        	    			var o = document.createElement("option");
        	    			o.text = (knt[k]["Name"] + ' (' + knt[k]["Combat"] +')')
        	    			o.value = knt[k]["ID"];
        	    			ById("RAApiKnight").options.add(o);
            			}
         }
      if (ById('RAApiKnight').options.length>0) {
       ById('RAApiKnight').selectedIndex=1;
      }

      var itemlist=[55,57,931,932];
      for(var i=0;i<itemlist.length;i++){
        ById('BOitemSpan_'+itemlist[i]).innerHTML = unsafeWindow.ksoItems[itemlist[i]].count;
      }
     for (r=1; r<13; r++){
       ById("RAApdestunit"+r).addEventListener ('click', function() {
         var nomcha=this.id.replace("RAApdest","RAAdest");
         var nomcha2=this.id.replace("RAApdestunit","RAAnbunit");
         ById(nomcha2).value=0;
         var e=1;
         var f=unsafeWindow.unixtime();
         if(Seed.playerEffects.aurasExpire){if(Seed.playerEffects.aurasExpire>f){e=1.15}}
	 if(Seed.playerEffects.auras2Expire){if(Seed.playerEffects.auras2Expire>f){e=1.3}}
         var l_elem=ById("BOitem_931");
	 if(l_elem&&l_elem.checked&&parseInt(Seed.items["i931"])>0){	        e+=0.25;	 }
	 var l_elem=ById("BOitem_932");
	 if(l_elem&&l_elem.checked&&parseInt(Seed.items["i932"])>0){	        e+=0.5;     }
         var niveauPointRall=parseInt(getCityBuilding (t.sourceCity.id, 12).maxLevel); // 12=Point de ralliement
         var maxtroupe=parseInt(niveauPointRall*10000*e);
         if (niveauPointRall==11) maxtroupe=parseInt(150000*e);
         if (niveauPointRall==12) maxtroupe=parseInt(200000*e);
         var q=EffetTronePrc(66).percent;
         maxtroupe=Math.round(maxtroupe*(1+q/100));
         var nbunitto=0;
         for (r=1; r<13; r++) {
           nbunitto+=parseIntNan(ById("RAAnbunit"+r).value);
	 }
         var libre = parseIntNan(maxtroupe - nbunitto);
         if (ById(nomcha).value>=libre) {
           ById(nomcha2).value = libre;
         }  else {
           ById(nomcha2).value= ById(nomcha).value;
         }
        }, false);
     }
     if (t.sourceCity!=city) {
           for (r=1; r<13; r++){
            ById("RAAnbunit"+r).value="0";
           }
     } else {
          for (r=1; r<13; r++){
              if (ById("RAAnbunit"+r).value=="") ById("RAAnbunit"+r).value="0";
              if (ById("RAAdestunit"+r).value=="") ById("RAAdestunit"+r).value="0";
                if (parseInt(ById("RAAnbunit"+r).value)>parseInt(ById("RAAdestunit"+r).value)) {
                 ById("RAAnbunit"+r).value="0";
                }
           }
     }
     t.estimerRes();
   },
}
// stock
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('8.9={l:C,V:f(){5 t=8.9;c.D=t.E;t.l=W.X(\'q\');F t.l},Y:f(){5 t=8.9;F t.l},Z:f(){5 t=8.9;t.10=C;11(t.12)},13:f(){5 t=8.9;m="<14 15=16>"+6.7.G+"</q>";m+="<q 17=\'18-H:I; H:I; 19-y:1a\' n=\'J\'></q>";t.l.K=m;t.w()},w:f(){5 t=8.9;5 r=[\'\',6.7.1b,6.7.1c,6.7.1d,6.7.1e,6.7.1f,6.7.1g];5 x={1h:L,z:1i,1j:1k,1l:1m,1n:z,1o:1p,1q:M,1r:1s,1t:1u,1v:N,1w:z,1x:M,1y:L,1z:1A,1B:1C,1D:1E,1F:1G,1H:1I,1J:1K,1L:N,1M:1N,1O:1P};5 g=0;5 m="<1Q 1R=0 1S=O><j><3 P=2><b>"+6.7.1T+"</3><3><b>"+6.7.1U+"</3><3><b>"+6.7.1V+"</3><3></3></j>";5 1W=o.k;5 e=c.1X.1Y(o.k);5 1Z=[];20(5 d=0;d<e.21;d++){5 h=e[d].22("i")[1];5 s=0;u(c.v["i"+h]&&p(o.k[e[d]])>0){u((p(h)<23||p(h)>24)&&p(c.v["i"+h].r)>0){u(x[h])s=x[h]*p(o.k[e[d]]);m+="<j><3><Q G=\'"+h+"\' n=\'26"+h+"\' R=\'D("+h+", 27);\' A=\'S://28-a.29.2a/2b/2c/2d/A/Q/k/2e/"+h+".2f\' 2g=25></3><3>"+c.v["i"+h].2h+"</3><3><O><b>"+o.k[e[d]]+"</3><3>"+r[c.v["i"+h].r]+"</3>";m+="<3>"+T(s)+"</3></j>";g=g+s}}}u(g>0){m+="<j><3 P=4>"+6.7.g+"</3><3><b>"+T(g)+"</j></2i>"}2j(\'J\').K=m},B:0,E:f(U,n){5 t=8.9;n.A=\'S://2k.2l.2m/2n.2o\';n.R="";t.B++;c.2p.2q.2r(U);t.B=0;t.w()},}',62,152,'|||td||var|lang|stock|myBO|Stock|||unsafeWindow|||function|puitotal|||tr|items|cont||id|Seed|parseInt|div|category|pui||if|itemlist|voir|puipui||1350|src|count|null|BOutiliser|useItem|return|title|height|480px|BOStockContenu|innerHTML|400|3000|1000|center|colspan|img|onclick|http|addCommas|num|init|document|createElement|getContent|hide|state|clearTimeout|displayTimer|show|DIV|class|boStat|style|max|overflow|auto|cat1|cat2|cat3|cat4|cat5|cat6|1330|600|1411|2000|1476|10000|1455|1370|700|1381|1471|100|1390|900|1474|1465|1351|1445|1452|175|1461|90|1371|3500|1391|4500|1427|150|1443|200|1311|1401|1800|1341|2250|TABLE|border|align|col1|col2|col3|test|Object|keys|lestock|for|length|split|1100|1199||BOitem|this|kabam1|akamaihd|net|kingdomsofcamelot|fb|e2|70|jpg|width|name|table|ById|www|ronlohse|com|wait2|gif|cm|ItemController|use'.split('|'),0,{}))

myBO.Info = {
  cont : null,
  state : null,
  ModelCity : {},
  init : function (){
    var t = myBO.Info;
    t.cont = document.createElement('div');
    return t.cont;
  },

  getContent : function (){
    var t = myBO.Info;
    return t.cont;
  },

  hide : function (){
    var t = myBO.Info;
  },

  show : function (){
    fortmight = {
      u53: "4",
      u55: "7",
      u60: "1",
      u61: "2",
      u62: "3",
    };
    var t = myBO.Info;
    rownum = 0;
    if (t.state == null){
      m = '<STYLE>.xtabH {background:#ffffe8; border:none; padding-right: 5px; padding-left: 5px; margin-left:10px; }\
              .xtabHL { background:#ffffe8; border-width: 1px; border-style: none none none solid; padding-right:5px; padding-left:5px; margin-left:10px; }\
              .xtabL { background:none; border-width: 1px; border-style: none none none solid; padding-right:5px; padding-left: 5px; margin-left:10px; }\
              .xtabLine { padding:0px; spacing:0px; height:1px; border-color:black; border-width: 1px; border-style: none none solid none }</style>\
          <DIV style="height:650px; max-height:650px; overflow-y:auto; overflow-x:auto"><DIV class=boStat><b>'+lang.info.title1+'</div>\
          <table border=0 width=100%><tr><td colspan=2><center><b><a href=http://www.facebook.com/groups/142657062507166/ target=_blank><font size=3>SUPPORT DE LA BOITE SUR FACEBOOK</font></a></td>\
          </tr><tr><td width=50%>La carte koc.dunno.com : <a target=_blank HREF="http://koc.dunno.com/index.sjs?f=KocMapViewer&server_id=' + getServerId() +'">Domain ' + getServerId() +'</A>\
          </td><td><a target=_blank HREF="http://koc-bao.com">Site Web koc-bao</a></td></tr>\
          <tr><td><a HREF="http://koc-bao.com/phpBB3">Forum Support KOC BAO</a></td><td>Bruitages et son dispo ici : <a target=_blank href="http://www.universal-soundbank.com">www.universal-soundbank.com</a></td></table><br>\
          <DIV class=boStat>'+lang.info.title2+'</div><TABLE align=center cellpadding=1 cellspacing=0 width=98%>\
          <TR align=center><TD class=xtab></td><TD class=xtabHL><B>Entr</b></td><TD class=xtabHL colspan=5><B>COST TO BUILD</b></td><TD class=xtabHL colspan=8><B>STATS</b></td></tr>\
          <TR valign=bottom align=right><TD class=xtab></td><TD class=xtabHL>Food</td><TD class=xtabHL>Food</td><TD class=xtabH>Wood</td><TD class=xtabH>Stone</td>\
          <TD class=xtabH>Ore</td><TD class=xtabH>Pop</td><TD class=xtabHL>Might</td><TD class=xtabH>Life</td><TD class=xtabH>Atk</td><TD class=xtabH>Def</td><TD class=xtabH>Speed</td><TD class=xtabH>Range</td><TD class=xtabH>Load</td><TD class=xtabH>Training</td>\
          </tr>\
          <TR style="height:1px;"><TD style="padding:0px; spacing:0px; height:1px; border-color:black; border-width: 1px; border-style: none none solid none" colspan=14></td></tr>';
      for (ui=1; ui<13; ui++){
        if (++rownum % 2)
          rsty = '';
        else
          rsty = ' style="background: #e8e8e8" ';
        cost = unsafeWindow.unitcost['unt'+ui];
        stats = unsafeWindow.unitstats['unt'+ui];
        food = unsafeWindow.unitupkeeps[ui];
        might = unsafeWindow.unitmight['unt'+ui];

        var sped=0,range=0,life=0,atk=0,def=0,loadEffectBoost=0;
        var techLoadBoost=parseInt(Seed.tech.tch10)*0.1;
        if(Seed.playerEffects.loadExpire>uW.unixtime()){loadEffectBoost=0.25}
	var loadBoostBase=(EffetTronePrc(6).percent*0.01)+loadEffectBoost+techLoadBoost;
        var loadBoost=loadBoostBase;

        range+=EffetTronePrc(5).percent;   // range
        life += EffetTronePrc(3).percent;   //life
        atk +=EffetTronePrc(1).percent;    //attack

        if(uW.cm.unitFrontendType[ui]=="infantry"){
          life +=EffetTronePrc(26).percent; //infrantry life
          atk +=EffetTronePrc(24).percent;    //infrantry attack
        }
        if(uW.cm.unitFrontendType[ui]=="ranged"){
	   life +=EffetTronePrc(36).percent;  //ranged life
	   range +=EffetTronePrc(37).percent; //ranged range
           atk +=EffetTronePrc(34).percent;    //ranged attack
        }
        if(uW.cm.unitFrontendType[ui]=="siege"){
          range +=EffetTronePrc(58).percent; //siege range
          atk +=EffetTronePrc(56).percent;   //siege attack
          loadBoost+=EffetTronePrc(59).percent*0.01; //siege load - valable pour le siege sauf wagon ^^^^

        }
        if(uW.cm.unitFrontendType[ui]=="horsed"){
          life +=EffetTronePrc(46).percent; //horse life
          atk +=EffetTronePrc(44).percent;   //horse attack
          loadBoost+=EffetTronePrc(48).percent*0.01; // horse load
        }
        // estimation life
  	lifestat=stats[0]*(1+(Seed.tech.tch15*5)/100);
        lifestat=lifestat + (stats[0]*((life/100)));
        // estimation range
	rangestat=stats[4]*(1+(Seed.tech.tch13*5)/100);
        rangestat=rangestat + (stats[4]*((range/100)));
        // estimation attack
	atkstat=(stats[1]*(0+(Seed.tech.tch8*5)/100))  + (stats[1]*(0+(Seed.tech.tch15*5)/100));
        atkstat=stats[1] +   atkstat + (stats[1]*((atk/100))) + (stats[1]* ( parseFloat(255*0.005))) + (stats[1]*0.20)  + (stats[1]*0.20);
        // estimation def
	defstat=(stats[2]*(1+(Seed.tech.tch9*5)/100));
        defstat=defstat + (stats[2]*((def/100))) + (stats[2]* ( parseFloat(255*0.005))) + (stats[2]*0.20);
        // estimation speed
	//sped=stats[3]*(1+(Seed.tech.tch9*5)/100);
        //sped=atkstat + (stats[3]*((atk/100)));
        // estmation load
        loadstat=stats[5] * (1+loadBoost);

      m += '<TR '+ rsty +'align=right><TD class=xtab align=left><B>'+ cost[0].substr(0,16) +'</b></td><TD class=xtabL>'+ food +'</td><TD class=xtabL>'+ cost[1] +'</td><TD class=xtab>'+ cost[2] +'</td>\
            <TD class=xtab>'+ cost[3] +'</td><TD class=xtab>'+ cost[4] +'</td><TD class=xtab>'+ cost[6] +'</td><TD class=xtabL>'+ might +'</td>\
            <TD class=xtab>'+ stats[0] +'</td><TD class=xtab>'+ stats[1] +'</td><TD class=xtab>'+ stats[2] +'</td><TD class=xtab>'+ stats[3] +'</td>\
            <TD class=xtab>'+ stats[4] +'</td><TD class=xtab>'+ stats[5] +'</td><td>'+parseInt(cost[7])+'</tr>';

	m += '<TR '+ rsty +' align=right ><TD class=xtab align=left>&nbsp;</td><TD class=xtabL>&nbsp;</td><TD class=xtabL>&nbsp;</td><TD class=xtab>&nbsp;</td>\
            <TD class=xtab>&nbsp;</td><TD class=xtab>&nbsp;</td><TD class=xtab>&nbsp;</td><TD class=xtabL>&nbsp;</td>\
            <TD class=xtab style="color:red">'+ Math.ceil(lifestat) +'</td><TD class=xtab style="color:red">'+ Math.ceil(atkstat) +'</td><TD class=xtab style="color:red">'+ Math.round(defstat) +'</td><TD class=xtab style="color:red">'+ Math.ceil(sped) +'</td>\
            <TD class=xtab style="color:red">'+ Math.ceil(rangestat) +'</td><TD class=xtab style="color:red">'+ Math.ceil(loadstat) +'</td></tr>';
      }
      m += '<TR class=xtabLine><TD colspan=14 class=xtabLine></td></tr>';
      for (k in unsafeWindow.fortcost){
        if (++rownum % 2)
          rsty = '';
        else
          rsty = ' style="background: #e8e8e8" ';
        cost = unsafeWindow.fortcost[k];
        fi = k.substring(3);
        stats = unsafeWindow.fortstats['unt'+fi];
        food = 0;
        might = fortmight['u'+fi];
        name = cost[0].replace ('Defensive','');
        name = name.replace ('Wall-Mounted','');
        m += '<TR '+ rsty +'align=right><TD align=left class=xtab><B>'+ name.substr(0,20) +'</b></td><TD class=xtabL>'+ food +'</td><TD class=xtabL>'+ cost[1] +'</td><TD class=xtab>'+ cost[2] +'</td>\
            <TD class=xtab>'+ cost[3] +'</td><TD class=xtab>'+ cost[4] +'</td><TD class=xtab>'+ cost[6] +'</td><TD class=xtabL>'+ might +'</td>\
            <TD class=xtab>'+ stats[0] +'</td><TD class=xtab>'+ stats[1] +'</td><TD class=xtab>'+ stats[2] +'</td><TD class=xtab>'+ stats[3] +'</td>\
            <TD class=xtab>'+ stats[4] +'</td><TD class=xtab>'+ stats[5] +'</td></tr>';
      }
      m += '<TR class=xtabLine><TD colspan=14 class=xtabLine></td></tr>';
      m += '</table>';
      function _displayrow (name, row){
                    var tot=0;
      			style = ((rownum++ % 2)?'':' style = "background: #e8e8e8"');
      			m += '<TR' + style + '><TD align=right><B>' + name + '</B></td>';
      			for (i=0; i<row.length; i++) {
      				m += ((row[i]==0)?'<td align=right><SPAN class=boldRed>0</SPAN></td>':'<td align=right>'+addCommas(parseInt(row[i]))+'</td>');
      				tot+=parseInt(row[i]);
      				}
      			m += '<td align=right>'+addCommas(tot)+'</td></tr>';
      		}
      		m += '<BR /><DIV class=boStat>'+lang.info.title3+'</div><BR /><SPAN id="Research">&nbsp;</SPAN><BR><DIV class=boStat>'+lang.info.title4+'</div>' +
      			'<BR /><TABLE align=center cellpadding=1 cellspacing=0><TABLE align=center cellpadding=1 cellspacing=0><TR align=right><TD></td>';
      		infoRows = [];
      		for (r=0; r<26; r++)
      			infoRows[r] = [];
      		for(i=0; i<Cities.numCities; i++) {
      			cityID = 'city'+ Cities.cities[i].id;
      			m += "<TD align=center valign=bottom width=60px><B>" + Cities.cities[i].name.replace(/ /g, "<BR>").substr(0,10)  + "</B></TD>";
      			getTroopDefTrainEstimates(cityID,Cities.cities[i].id);
      			infoRows[0][i] = Cities.cities[i].numBarracks;
      			infoRows[1][i] = Cities.cities[i].totLevelsBarracks;
      			infoRows[2][i] = Cities.cities[i].foremanBasePoliticsScore;
      			infoRows[3][i] = Cities.cities[i].marshallCombatScore;
      			infoRows[5][i] = Cities.cities[i].stableLevel;
      			infoRows[6][i] = Cities.cities[i].workshopLevel;
      			infoRows[24][i] = Cities.cities[i].blacksmithLevel;
      			infoRows[25][i] = Cities.cities[i].numHouse;
      			for (var j=1; j<13; j++)
      				infoRows[j+6][i] = ((Cities.cities[i]['Troop'+j+'Time'] > 0)?(3600 / Cities.cities[i]['Troop'+j+'Time']):0);
      			infoRows[19][i] = Cities.cities[i]['Def53Time'];
      			if (infoRows[19][i] > 0)
      				infoRows[19][i] = 3600 / infoRows[19][i];
      			infoRows[20][i] = Cities.cities[i]['Def55Time'];
      			if (infoRows[20][i] > 0)
      				infoRows[20][i] = 3600 / infoRows[20][i];
      			infoRows[21][i] = Cities.cities[i]['Def60Time'];
      			if (infoRows[21][i] > 0)
      				infoRows[21][i] = 3600 / infoRows[21][i];
      			infoRows[22][i] = Cities.cities[i]['Def61Time'];
      			if (infoRows[22][i] > 0)
      				infoRows[22][i] = 3600 / infoRows[22][i];
      			infoRows[23][i] = Cities.cities[i]['Def62Time'];
      			if (infoRows[23][i] > 0)
      				infoRows[23][i] = 3600 / infoRows[23][i];
      		}
      		m += "<td align=center valign=bottom width=60px><b>"+lang.info.tot+"</td></tr>";
      		rownum=0;
      		_displayrow (lang.info.row25, infoRows[25]);
      		_displayrow (lang.info.row0, infoRows[0]);
      		_displayrow (lang.info.row1, infoRows[1]);
      		_displayrow (lang.info.row2, infoRows[2]);
      		_displayrow (lang.info.row3, infoRows[3]);
      		_displayrow (lang.info.row5, infoRows[5]);
      		_displayrow (lang.info.row24, infoRows[24]);
      		_displayrow (lang.info.row6, infoRows[6]);
      		m += "<TR><TD></TD><TD nowrap align=center colspan="+(Cities.numCities)+"><B>"+lang.info.trainhour+"</B></TD></TR>";
      		_displayrow (uW.unitcost['unt1'][0], infoRows[7]);
      		_displayrow (uW.unitcost['unt2'][0], infoRows[8]);
      		_displayrow (uW.unitcost['unt3'][0], infoRows[9]);
      		_displayrow (uW.unitcost['unt4'][0], infoRows[10]);
      		_displayrow (uW.unitcost['unt5'][0], infoRows[11]);
      		_displayrow (uW.unitcost['unt6'][0], infoRows[12]);
      		_displayrow (uW.unitcost['unt7'][0], infoRows[13]);
      		_displayrow (uW.unitcost['unt8'][0], infoRows[14]);
      		_displayrow (uW.unitcost['unt9'][0], infoRows[15]);
      		_displayrow (uW.unitcost['unt10'][0], infoRows[16]);
      		_displayrow (uW.unitcost['unt11'][0], infoRows[17]);
      		_displayrow (uW.unitcost['unt12'][0], infoRows[18]);
      		m += "<TR><TD></TD><TD nowrap align=center colspan="+(Cities.numCities)+"><B>"+lang.info.buildhour+"</B></TD></TR>";
      		_displayrow (uW.fortcost['frt53'][0], infoRows[19]);
      		_displayrow (uW.fortcost['frt55'][0], infoRows[20]);
      		_displayrow (uW.fortcost['frt60'][0], infoRows[21]);
      		_displayrow (uW.fortcost['frt61'][0], infoRows[22]);
      		_displayrow (uW.fortcost['frt62'][0], infoRows[23]);
		m += "</TABLE><BR />";
      m += '<BR><DIV class=boStat>'+lang.info.title5+'</div><DIV class=ptentry><TABLE align=center cellpadding=1 cellspacing=0>\
      <TR><TD class=xtab align=right><B>'+lang.General.source+' : </b></td><TD  class=xtab> X: <INPUT id=calcX type=text\> Y: <INPUT id=calcY type=text\> '+lang.General.or+' '+unsafeWindow.g_js_strings.commonstr.city+' : <SPAN id=ptloc1></span></td></tr>\
      <TR><TD class=xtab><B>'+lang.General.dest+' : </b></td><TD class=xtab> X: <INPUT id=calcX2 type=text\> Y: <INPUT id=calcY2 type=text\> '+lang.General.or+' '+unsafeWindow.g_js_strings.commonstr.city+' <SPAN id=ptloc2></span></td></tr></table>\
      <CENTER><DIV style="width:60%; font-size:14px; border: 1px solid; background-color:white; margin:20px 3px 3px 0px; padding:4px" id=ptdistout></div>\
<div><b>'+lang.General.EstimateT+' </b><select id="idETASelect">\
        <option value="0" > ---- </option>';
        var z=0;
        for (y in unsafeWindow.unitcost) {
          z++;
          m+='<option value="'+z+'">'+unsafeWindow.unitcost[y][0]+'</option>';
	}
m +='</select></div><DIV style="width:60%; font-size:14px; border: 1px solid; background-color:white; margin:20px 3px 3px 0px; padding:4px" id=ptETAout></div></center>';
m += '<BR><DIV class=boStat>'+lang.info.title6+'</div><DIV id=ptProvMap style="height:'+ provMapCoords.imgHeight +'px; width:'+ provMapCoords.imgWidth +'px; background-repeat:no-repeat; background-image:url(\''+ URL_PROVINCE_MAP +'\')"></div></div>';
var bor,ector,kay,bedivere,gawain,percival,galahad,lancelot,arthur,morgana,mordred;
if (Seed.items.i1101){bor=Seed.items.i1101}else{bor=0};
if (Seed.items.i1102){ector=Seed.items.i1102}else{ector=0};
if (Seed.items.i1103){kay=Seed.items.i1103}else{kay=0};
if (Seed.items.i1104){bedivere=Seed.items.i1104}else{bedivere=0};
if (Seed.items.i1105){gawain=Seed.items.i1105}else{gawain=0};
if (Seed.items.i1106){percival=Seed.items.i1106}else{percival=0};
if (Seed.items.i1107){galahad=Seed.items.i1107}else{galahad=0};
if (Seed.items.i1108){lancelot=Seed.items.i1108}else{lancelot=0};
if (Seed.items.i1109){arthur=Seed.items.i1109}else{arthur=0};
if (Seed.items.i1110){morgana=Seed.items.i1110}else{morgana=0};
if (Seed.items.i1111){mordred=Seed.items.i1111}else{mordred=0};
if (Seed.items.i1112){Stag=Seed.items.i1112}else{Stag=0};
if (Seed.items.i1113){Pendragon=Seed.items.i1113}else{Pendragon=0};
if (Seed.items.i1114){Lady=Seed.items.i1114}else{Lady=0};
if (Seed.items.i1115){Merlin=Seed.items.i1115}else{Merlin=0};
if (Seed.items.i1120){aetherseal=Seed.items.i1120}else{aetherseal=0};
if (Seed.items.i1121){ysbadden=Seed.items.i1121}else{ysbadden=0};
if (Cities.cities[1]){ville2="#99EE99";}else{ville2="#EE9999";}
if (Cities.cities[2]){ville3="#99EE99";}else{ville3="#EE9999";}
if (Cities.cities[3]){ville4="#99EE99";}else{ville4="#EE9999";}
if (Cities.cities[4]){ville5="#99EE99";}else{ville5="#EE9999";}
if (Cities.cities[5]){ville6="#99EE99";}else{ville6="#EE9999";}
if (Cities.cities[6]){ville7="#99EE99";}else{ville7="#EE9999";}
if (Cities.cities[7]){ville8="#99EE99";}else{ville8="#EE9999";}
m += '<style>CAPTION.MYTABLE  {background-color:eeffff;color:black;border-style:solid;border-width:1px;border-color:black;}\
  TABLE.MYTABLE  { \
     font-family:arial;\
     border-collapse:collapse;\
     font-size:10pt;\
     background-color:F5F5F5;\
     width:100%;\
     border-style:solid;\
     border-color:black;\
     border-width:1px;\
  } TH.MYTABLE  {\
     font-size:10pt;\
     color:black;\
     text-align:center;\
     border-style:solid;\
     border-color:black;\
     border-width:1px;\
  } TR.MYTABLE { }\
  TD.MYTABLE {  \
     font-size:10pt;\
     background-color:FFFFE5;\
     color:black;\
     border-style:solid;\
     border-width:1px;\
     text-align:left;\
  }</style>\
<TABLE CLASS="MYTABLE" CELLPADDING=0 CELLSPACING=0>\
    <CAPTION CLASS="MYTABLE">'+lang.info.title7+'</CAPTION><THEAD >\
      <TR CLASS="MYTABLE">\
        <TH CLASS="MYTABLE">'+uW.g_js_strings.commonstr.cities+'</TH>\
        <TH CLASS="MYTABLE">Besoins 1</TH>\
        <TH CLASS="MYTABLE">Besoins 2</TH>\
        <TH CLASS="MYTABLE">Besoins 3</TH>\
      </TR>\
    </THEAD><TBODY>\
      <TR CLASS="MYTABLE">  \
        <TD CLASS="MYTABLE" style="background-color:'+ville2+';">'+uW.g_js_strings.commonstr.city+' 2</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+ville2+';">Niveau 7 ('+Seed.player.title+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+ville2+';">10 Amis</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+ville2+';">&nbsp;</TD>\
      </TR><TR CLASS="MYTABLE">  \
        <TD CLASS="MYTABLE" style="background-color:'+ville3+';">'+uW.g_js_strings.commonstr.city+' 3</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+ ( (bor>=4)?"#99EE99":ville3 ) +';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1101.jpg>&nbsp;4 Bor ('+bor+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+ ( (ector>=2)?"#99EE99":ville3 ) +';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1102.jpg>&nbsp;2 Ector ('+ector+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+ ( (kay>=1)?"#99EE99":ville3 ) +';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1103.jpg>&nbsp;1 Kay ('+kay+')</TD>\
      </TR><TR CLASS="MYTABLE">  \
        <TD CLASS="MYTABLE" style="background-color:'+ville4+';">'+uW.g_js_strings.commonstr.city+' 4</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (kay>=4)?"#99EE99":ville4 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1103.jpg>&nbsp;4 Kay ('+kay+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (bedivere>=3)?"#99EE99":ville4 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1104.jpg>&nbsp;3 Bedivere ('+bedivere+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (gawain>=1)?"#99EE99":ville4 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1105.jpg>&nbsp;1 Gawain ('+gawain+')</TD>\
      </TR>\
      <TR CLASS="MYTABLE">  \
        <TD CLASS="MYTABLE" style="background-color:'+ville5+';">'+uW.g_js_strings.commonstr.city+' 5</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (percival>=4)?"#99EE99":ville5 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1106.jpg>&nbsp;4 Perceval ('+percival+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (galahad>=3)?"#99EE99":ville5 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1107.jpg>&nbsp;3 Galaad ('+galahad+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (lancelot>=2)?"#99EE99":ville5 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1108.jpg>&nbsp;2 Lancelot ('+lancelot+')</TD>\
      </TR>\
      <TR CLASS="MYTABLE">  \
        <TD CLASS="MYTABLE" style="background-color:'+ville6+';">'+uW.g_js_strings.commonstr.city+' 6</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (arthur>=4)?"#99EE99":ville6 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1109.jpg>&nbsp;4 Roi Arthur ('+arthur+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (morgana>=3)?"#99EE99":ville6 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1110.jpg>&nbsp;3 Morgane ('+morgana+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (mordred>=2)?"#99EE99":ville6 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1111.jpg>&nbsp;2 Mordred ('+mordred+')</TD>\
      </TR>\
       <TR CLASS="MYTABLE">  \
        <TD CLASS="MYTABLE" style="background-color:'+ville7+';">'+uW.g_js_strings.commonstr.city+' 7</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (Stag>=4)?"#99EE99":ville7 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1112.jpg>&nbsp;4 Roi Stag ('+Stag+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (Pendragon>=3)?"#99EE99":ville7 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1113.jpg>&nbsp;3 Terrestre ('+Pendragon+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (Lady>=2)?"#99EE99":ville7 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1114.jpg>&nbsp;2 Aquatique ('+Lady+')</TD>\
      </TR>\
      <TR CLASS="MYTABLE">  \
        <TD CLASS="MYTABLE" style="background-color:'+ville8+';">'+uW.g_js_strings.commonstr.city+' 8</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (Merlin>=4)?"#99EE99":ville8 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1115.jpg>&nbsp;4 Merlin ('+Merlin+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (aetherseal>=3)?"#99EE99":ville8 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1120.jpg>&nbsp;3 Aetherseal ('+aetherseal+')</TD>\
        <TD CLASS="MYTABLE" style="background-color:'+( (ysbadden>=2)?"#99EE99":ville8 )+';"><img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1121.jpg>&nbsp;2 Ysbadden  ('+ysbadden +')</TD>\
      </TR>\
    </TBODY></TABLE><TABLE CLASS="MYTABLE" CELLPADDING=0 CELLSPACING=0><CAPTION CLASS="MYTABLE">'+lang.info.title8+'</CAPTION><THEAD >\
        <TR CLASS="MYTABLE">\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1101.jpg title="Bor"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1102.jpg title="Ector"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1103.jpg title="Kay"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1104.jpg title="Bedivere"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1105.jpg title="Gawain"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1106.jpg title="Perceval"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1107.jpg title="Galaad"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1108.jpg title="Lancelot"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1109.jpg title="Arthur"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1110.jpg title="Morgane"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1111.jpg title="Mordred"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1112.jpg title="Stag"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1113.jpg title="Terrestre"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1114.jpg title="Aquatique"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1115.jpg title="Merlin"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1120.jpg title="Aetherseal"></TH>\
          <TH CLASS="MYTABLE"><img width=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1121.jpg title="Ysbadden"></TH>\
         </TR>\
 </THEAD><TR CLASS="MYTABLE">\
  <TD CLASS="MYTABLE"><center><b>'+bor+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+ector+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+kay+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+bedivere+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+gawain+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+percival+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+galahad+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+lancelot+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+arthur+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+morgana+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+mordred+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+Stag+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+Pendragon+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+Lady+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+Merlin+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+aetherseal+'</TD>\
  <TD CLASS="MYTABLE"><center><b>'+ysbadden+'</TD>\
  </TR><TR CLASS="MYTABLE"></tr>\
  </table>';

 t.cont.innerHTML = m;
        new CdispCityPicker ('ptloc1', ById('ptloc1'), true, t.eventFromLocChanged, 0).bindToXYboxes(ById('calcX'), ById('calcY'));
    new CdispCityPicker ('ptloc2', ById('ptloc2'), true, t.eventLocChanged, 0).bindToXYboxes(ById('calcX2'), ById('calcY2'));
     t.eventFromLocChanged(Cities.cities[0], Cities.cities[0].x, Cities.cities[0].y);
    ById('idETASelect').addEventListener ( 'change', t.eventLocChanged, false);
    function rlShow(rl) {
    			var retval = '<TD nowrap><B>'+rl.Name+'</B></TD><TD align=right><B>&nbsp;&nbsp;';
    			nlETA = ((rl.NextLevelETA > 0)?('(' + (rl.Level + 1) + ': ' + timestr(rl.NextLevelETA) + ')'):'');
    			retval += ((rl.Level < 9)?('<SPAN class=boldRed>' + rl.Level + '</SPAN></B></TD><TD nowrap>&nbsp;&nbsp;' + nlETA + '</TD>'):(rl.Level + '</B></TD><TD nowrap>&nbsp;&nbsp;' + nlETA + '</TD>'));
    			return retval;
    };
    var m = '';
    getResearchLevels();
    m += '<TABLE align=center cellpadding=1 cellspacing=0>' +
    			'<TR>' + rlShow(researchLevels[1]) + '<TD width=10></TD>' + rlShow(researchLevels[6]) + '<TD width=10></TD>' + rlShow(researchLevels[12]) + '</TR>' +
    			'<TR>' + rlShow(researchLevels[2]) + '<TD></TD>' + rlShow(researchLevels[8]) + '<TD></TD>' + rlShow(researchLevels[13]) + '</TR>' +
    			'<TR>' + rlShow(researchLevels[3]) + '<TD></TD>' + rlShow(researchLevels[9]) + '<TD></TD>' + rlShow(researchLevels[14]) + '</TR>' +
    			'<TR>' + rlShow(researchLevels[4]) + '<TD></TD>' + rlShow(researchLevels[15]) + '<TD></TD>' + rlShow(researchLevels[10]) + '</TR>' +
    			'<TR>' + rlShow(researchLevels[5]) + '<TD></TD>' + rlShow(researchLevels[11]) + '<TD></TD>' + rlShow(researchLevels[16]) + '</TR></TABLE>';
    ById('Research').innerHTML = m;
     for (var c=0; c<Cities.numCities; c++)
        t.makeCityImg (c, ById('ptProvMap'));
      t.state = 1;
    }
  },
  makeCityImg : function (cityNum, eMap){
    var t = my.Info;
    var city = Cities.cities[cityNum];
    var x = parseInt((provMapCoords.mapWidth * city.x) / 750);
    var y = parseInt((provMapCoords.mapHeight * city.y) / 750);
    var ce = document.createElement ('div');
    ce.style.background = 'black';
    ce.style.opacity = '1.0';
    ce.style.position='relative';
    ce.style.display='block';
    ce.style.width='14px';
    ce.style.height='16px';
    ce.style.border='1px solid #fff';
    ce.style.color = 'white';
    ce.style.textAlign = 'center';
    ce.style.top = (y+provMapCoords.topMargin-(cityNum*16)-8) +'px';
    ce.style.left = (x+provMapCoords.leftMargin-7) +'px';
    eMap.appendChild(ce);
    ce.innerHTML = (cityNum+1) +'';
  },

  eventLocChanged : function (city, x, y){
    var t = myBO.Info;
    var x1 = parseInt(ById('calcX').value);
    var x2 = parseInt(ById('calcX2').value);
    if (isNaN(x2))
      return;
    var y1 = parseInt(ById('calcY').value);
    var y2 = parseInt(ById('calcY2').value);
    var m = lang.info.ptdistout1+' '+ x1 +','+ y1 +' '+lang.info.ptdistout2+' '+ x2 +','+ y2 +' '+lang.info.ptdistout3+' <B>'+ distance (x1, y1, x2, y2).toFixed(2) +'</b>';
    ById('ptdistout').innerHTML = m;
    var dist = distance (x1, y1, x2, y2);
    if (t.ModelCity) m = estETA(dist, ById('idETASelect').value, t.ModelCity.id,4)
     else
      m = estETA(dist, ById('idETASelect').value, 0, 4)
    if (m != null)
           ById('ptETAout').innerHTML = "Atk : "+m.etaStr+" - Renf : "+m.friendEtaStr;
  },
  eventFromLocChanged : function (city, x, y){
    var t = myBO.Info;
    t.ModelCity = city;
    var x1 = parseInt(ById('calcX').value);
    var x2 = parseInt(ById('calcX2').value);
    if (isNaN(x2))
      return;
    var y1 = parseInt(ById('calcY').value);
    var y2 = parseInt(ById('calcY2').value);
    var m = lang.info.ptdistout1+' '+ x1 +','+ y1 +' '+lang.info.ptdistout2+' '+ x2 +','+ y2 +' '+lang.info.ptdistout3+' <B>'+ distance (x1, y1, x2, y2).toFixed(2) +'</b>';
    ById('ptdistout').innerHTML = m;
    var dist = distance (x1, y1, x2, y2);
       if (t.ModelCity) m = estETA(dist, ById('idETASelect').value, t.ModelCity.id,4)
        else
      m = estETA(dist, ById('idETASelect').value, 0, 4)
    if (m != null)
       ById('ptETAout').innerHTML = "Atk : "+m.etaStr+" - Renf : "+m.friendEtaStr;
  },
}
myBO.Alliance = {
  tabOrder : 120,
  cont : null,
  alliancemembers:[],
  number:0,
  totalmembers:0,
  error:false,

  getContent : function (){
      var t = myBO.Alliance;
      return t.cont;
  },
  init : function (){
      var t = myBO.Alliance;
      t.cont = document.createElement('div');
      return t.cont;
  },
  show : function (){
     var t = myBO.Alliance;
     t.cont.style.overflowY = 'scroll';
     t.cont.style.maxHeight = '500px';
     t.totalmembers=0;
     t.alliancemembers=[];
     unsafeWindow.getdetails = t.getMemberDetails;
    var m =  '<DIV class=boStat><b>'+lang.Alliance.title+'</b></div><TABLE align=center cellpadding=1 cellspacing=0></table>';
    m +='<TABLE class=ptTab><TD width=200px>'+lang.Alliance.title1+'</td><TD>'+lang.Alliance.sortby+' <select id="searchAlli"><option value="name">'+lang.General.name+'</options>';
    m += '<option value="might">'+uW.g_js_strings.commonstr.might+'</option>';
    m += '<option value="login">'+uW.g_js_strings.modal_messages_viewreports_view.lastlogin+'</option>';
    m += '<option value="cities">'+uW.g_js_strings.commonstr.cities+'</option>';
    m += '<option value="position">'+uW.g_js_strings.commonstr.position+'</option>';
    m += '<option value="glory">'+uW.g_js_strings.commonstr.glory+'</option><option value="dip">'+uW.g_js_strings.showMemberInfo.daysincurrpos+'</option></select></td>';
    m += '<TD><INPUT id=alList type=submit value="'+lang.Alliance.alList+'"></td>';
    m += '<TD id=progress></td>';
    m += '<TR><TD width=200px>'+uW.g_js_strings.allianceInfo.allidiplomacy+'</td><TD><INPUT id=aldiplo type=submit value="'+lang.Alliance.alList+'"></td></tr></table>';
    m+='<DIV class=boStat><b>&nbsp;</div><TABLE align=center cellpadding=1 cellspacing=0 class=ptTab></table>';
    m += '<TABLE id=alOverviewTab class=alTab><TR align="center"></tr></table>';
   t.cont.innerHTML = m;
   ById('alList').addEventListener('click', function(){
    	if (!t.searching){
	    	t.totalmembers=0;
	    	t.alliancemembers=[];
		    ById('alOverviewTab').innerHTML ="";
		    ById('progress').innerHTML ="";
		    ById('progress').innerHTML = uW.g_js_strings.commonstr.research+"...";
		    ById('alList').disabled = true;
		    t.error=false;
		    t.fetchAllianceMemberPage();
		}
    }, false);

    ById('searchAlli').addEventListener('click', function(){
        if (t.alliancemembers!="") {
        	ById('alOverviewTab').innerHTML ="";
        	t.paintMembers();
        }
    }, false);
    ById('aldiplo').addEventListener('click', function(){t.paintDiplomacy();}, false);

  window.addEventListener('unload', t.onUnload, false);
  },
  paintMembers: function(){
  var t = myBO.Alliance;
	  		  if (ById('searchAlli').value == "name") {
				  var sortmembers = t.alliancemembers.sort(function(a, b){
				         var sortA=a.Name.toLowerCase(), sortB=b.Name.toLowerCase()
				         if (sortA < sortB)
				          return -1
				         if (sortA > sortB)
				          return 1
				         return 0
				        });
			  }
			  if (ById('searchAlli').value == "might") {
			  	  var sortmembers = t.alliancemembers.sort(function(a, b){
			  	         var sortA=parseInt(a.Might),sortB=parseInt(b.Might)
			  	         if (sortA > sortB)
			  	          return -1
			  	         if (sortA < sortB)
			  	          return 1
			  	         return 0
			  	        });
			  }
			  if (ById('searchAlli').value == "login") {
			  	  var sortmembers = t.alliancemembers.sort(function(a, b){
			  	         var sortA=a.LastLogin,sortB=b.LastLogin
			  	         if (sortA < sortB)
			  	          return -1
			  	         if (sortA > sortB)
			  	          return 1
			  	         return 0
			  	        });
			  }
			  if (ById('searchAlli').value == "cities") {
			  	  var sortmembers = t.alliancemembers.sort(function(a, b){
			  	         var sortA=a.Cities,sortB=b.Cities
			  	         if (sortA < sortB)
			  	          return -1
			  	         if (sortA > sortB)
			  	          return 1
			  	         return 0
			  	        });
			  }
			  if (ById('searchAlli').value == "dip") {
			  	  var sortmembers = t.alliancemembers.sort(function(a, b){
			  	         var sortA=a.dip,sortB=b.dip
			  	         if (sortA < sortB)
			  	          return -1
			  	         if (sortA > sortB)
			  	          return 1
			  	         return 0
			  	        });
			  }
			  if (ById('searchAlli').value == "position") {
			  	  var sortmembers = t.alliancemembers.sort(function(a, b){
			  	         var sortA=a.Position,sortB=b.Position
			  	         if (sortA < sortB)
			  	          return -1
			  	         if (sortA > sortB)
			  	          return 1
			  	         return 0
			  	        });
			  }
			  if (ById('searchAlli').value == "glory") {
			  	  var sortmembers = t.alliancemembers.sort(function(a, b){
			  	         var sortA=parseInt(a.glory),sortB=parseInt(b.glory);
			  	         if (sortA > sortB)
			  	          return -1
			  	         if (sortA < sortB)
			  	          return 1
			  	         return 0
			  	        });
			  }
			  for (var y = (sortmembers.length-1); y >=0; y--) {
			                      t._addTab(sortmembers[y].Name,sortmembers[y].Might,sortmembers[y].LastLogin,sortmembers[y].Position,sortmembers[y].dip,sortmembers[y].uid,sortmembers[y].fbuid,sortmembers[y].Cities,sortmembers[y].avatarurl,sortmembers[y].glory,sortmembers[y].dateJoined);
			                      t.cont.style.overflowY = 'scroll';
			  }
			 t._addTabHeader();
   },

    _addTab: function(Name,Might,LastLogin,Position,dip,uid,fbuid,Cities,avatar,gloire,arrive){
             var t = myBO.Alliance;
             var row = ById('alOverviewTab').insertRow(0);
             row.vAlign = 'top';
             row.insertCell(0).innerHTML ='<img width=25 src="'+ avatar +'">';
             row.insertCell(1).innerHTML ='<A target="_tab" href="http://www.facebook.com/profile.php?id='+ fbuid +'">FB</a>';
             row.insertCell(2).innerHTML = Name;
             var cell2 = row.insertCell(3);
       		 cell2.width = "60" ;
       		 cell2.align = "right" ;
       		 cell2.vAlign = "top";
       		 cell2.innerHTML = addCommas(Might);
       		var cell2 = row.insertCell(4);
       		 cell2.width = "60" ;
       		 cell2.align = "right" ;
       		 cell2.vAlign = "top";
       		 cell2.innerHTML = addCommas(gloire);
       		row.insertCell(5).innerHTML = Cities;
       		 row.insertCell(6).innerHTML = officerId2String (Position);
       		 row.insertCell(7).innerHTML = dip;
       		 row.insertCell(8).innerHTML = LastLogin;
       		 row.insertCell(9).innerHTML = arrive;
          },

    _addTabHeader: function() {
    var t = myBO.Alliance;
        var row = ById('alOverviewTab').insertRow(0);
        row.vAlign = 'top';
        row.insertCell(0).innerHTML = "<b>Avatar";
        row.insertCell(1).innerHTML = "<b>Facebook";
        row.insertCell(2).innerHTML = "<b>"+lang.General.name;
        row.insertCell(3).innerHTML = "<b>"+uW.g_js_strings.commonstr.might;
        row.insertCell(4).innerHTML = "<b>"+uW.g_js_strings.commonstr.glory;
        row.insertCell(5).innerHTML = "<b>"+uW.g_js_strings.commonstr.cities;
        row.insertCell(6).innerHTML = "<b>"+uW.g_js_strings.commonstr.position;
        row.insertCell(7).innerHTML = "<b>DIP";
        row.insertCell(8).innerHTML = "<b>"+lang.Alliance.row8;
        row.insertCell(9).innerHTML = "<b>"+lang.Alliance.row9;
    },
    paintDiplomacy : function () {
    	ById('alOverviewTab').innerHTML ="";
    	ById('progress').innerHTML ="";
    	var m= '<TR><TD colspan=4 style=\'background: #33CC66;\' align=center><B>'+uW.g_js_strings.commonstr.friendly+' : </b></td></tr>';
    	if (Seed.allianceDiplomacies['friendly'] == null) m+='<TR><TD>'+uW.g_js_strings.getDiplomacy.sorrynoalli+'</td>';
    	else m += '<TABLE class=xtab><TR><TD>'+uW.g_js_strings.getDiplomacy.alliname+'</td><TD>'+lang.Alliance.member+'</td></tr>';
    	for (k in Seed.allianceDiplomacies['friendly']){
				m+='<TR><TD>'+Seed.allianceDiplomacies['friendly'][k]['allianceName']+'</td>';
				m+='<TD align=center>'+Seed.allianceDiplomacies['friendly'][k]['membersCount']+'</td>';
    	}
    	m+='<TR></tr></table>';
    	m+= '<TR><TD colspan=4 style=\'background: #CC0033;\' align=center><B>'+uW.g_js_strings.commonstr.hostile+' : </b></td></tr>';
    	if (Seed.allianceDiplomacies['hostile'] == null) m+='<TR><TD>'+uW.g_js_strings.getDiplomacy.sorrynoalli+'</td>';
    	else m += '<TABLE class=xtab><TR><TD>'+uW.g_js_strings.getDiplomacy.alliname+'</td><TD>'+lang.Alliance.member+'</td></tr>';
    	for (k in Seed.allianceDiplomacies["hostile"]){
    		m+='<TR><TD>'+Seed.allianceDiplomacies["hostile"][k]['allianceName']+'</td>';
    		m+='<TD align=center>'+Seed.allianceDiplomacies["hostile"][k]['membersCount']+'</td>';
    	}
    	m+='<TR></tr></table>';
    	m+= '<TR><TD colspan=4 style=\'background: #FF6633;\' align=center><B>'+uW.g_js_strings.getDiplomacy.friendlytoyou+'</b></td></tr>';
    	if (Seed.allianceDiplomacies['friendlyToYou'] == null) m+='<TR><TD>'+uW.g_js_strings.getDiplomacy.sorrynoalli+'</td>';
    	else m += '<TABLE class=xtab><TR><TD>'+uW.g_js_strings.getDiplomacy.alliname+'</td><TD>'+lang.Alliance.member+'</td></tr>';
    	for (k in Seed.allianceDiplomacies["friendlyToYou"]){
    		m+='<TR><TD>'+Seed.allianceDiplomacies["friendlyToYou"][k]['allianceName']+'</td>';
    		m+='<TD align=center>'+Seed.allianceDiplomacies["friendlyToYou"][k]['membersCount']+'</td>';
    	}
    	m+='<TR></tr></table>';
    	ById('alOverviewTab').innerHTML = m;
    },


    fetchAllianceMemberPage : function () {
    var t = myBO.Alliance;
    ById('alList').disabled = true;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

    params.pf = 0;

    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (transport) {
      	  var rslt = eval("(" + transport.responseText + ")");
          t.totalmembers = (rslt["allianceInfo"]["members"]);
          for (var i=1;i<=10;i++) {
                 params.pageNo = i;
                 params.pf = 0;
                 new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetMembersInfo.php" + unsafeWindow.g_ajaxsuffix, {
                   method: "post",
                   parameters: params,
                   onSuccess: function (transport) {
                    var info = eval("(" + transport.responseText + ")");
                    if (info.ok) {
                       for (var k in info["memberInfo"]){
                         if ( info["memberInfo"][k]["might"] != undefined && !t.error){
                           t.alliancemembers.push ({
                               Name: info["memberInfo"][k]["name"],
                               Might: info["memberInfo"][k]["might"],
                               Cities: info["memberInfo"][k]["cities"],
                               Position : info["memberInfo"][k]["positionType"],
                               dip : info["memberInfo"][k]["daysInPosition"],
                               LastLogin : info["memberInfo"][k]["lastLogin"],
                               uid : info["memberInfo"][k]["userId"],
                               fbuid : info["memberInfo"][k]["fbuid"],
                               avatarurl : info["memberInfo"][k]["avatarurl"],
                               glory : info["memberInfo"][k]["glory"],
                               dateJoined : info["memberInfo"][k]["dateJoined"],
                           });
                          }
                           ById('alOverviewTab').innerHTML ="";
                           t.paintMembers();
                   		}
                       if (!t.error) ById('progress').innerHTML	 = '(' + (t.alliancemembers.length) +'/'+ t.totalmembers +')';
                       if ( t.alliancemembers.length >= t.totalmembers) ById('alList').disabled = false;
                    } else  if (info.error) {
                    	ById('alList').disabled = false;
                    	ById('progress').innerHTML = "ERREUR";
                    	t.error=true;
                   	}
                   },
                   onFailure: function (rslt) {;
                     notify ({errorMsg:'AJAX error'});
                   },
           });
          }
      },
      onFailure: function (rslt) {;
        notify ({errorMsg:'AJAX error'});
      },
    });
  },
  hide : function (){
  },
};


/************************ Tournoi *************************/
myBO.Tournoi = {
 cont:null,
 state:null,
 pos:0,
 displayTimer : null,
 init : function (){
    this.cont = document.createElement('div');
    return this.cont;
 },
 hide : function (){
  var t = myBO.Tournoi;
  clearTimeout (t.displayTimer);
 },
 getContent : function (){
	    var t = myBO.Tournoi;
	    return t.cont;
 },
 show : function () {
  var t = myBO.Tournoi;

  clearTimeout (t.displayTimer);


  t.cont.innerHTML = "<div class='tourny_modal_upsell'></div><DIV class=boStat><b>"+lang.tournoi.title+" - <input type=button value='?' id='boaidetournoi' class=boAide onclick=window.open('"+sitesupport+"?page=aide_tournoi');></b></div>";


  var mhtl = "<table width=100% class=ptTab><tr><td></td>";
  for(var i=0; i<Cities.numCities; i++) {
   mhtl += "<TD align=center valign=bottom width=50px><B>" + Cities.cities[i].name.replace(/ /g, "<BR>").substr(0,10) + "</B></TD>";
  }
  mhtl += "<td align=center width=60px><b>Total</td></tr>";

    var p = Options.TourUnit;
    mhtl += "<tr><td>Population/h</td>";
    var pop=[],tot1=0;
    for(var i=0; i<Cities.numCities; i++) {
     cityID = 'city'+ Cities.cities[i].id;
     pop[i] =  parseInt(Seed.citystats[cityID]["pop"][1] / uW.unitcost['unt'+p][6]) / 2;
     mhtl += "<td  align=right>" + addCommas(parseInt(pop[i])) +"</td>";
     tot1+=parseInt(pop[i]);
    }
  mhtl += "<td align=right><b>"+addCommas(tot1)+"</td></tr>";


  mhtl +=" <tr><td><select id=BOTournoiUnit>";
  for (var r=1;r<13;r++)
   mhtl += "<option value="+r+" " + (p == r?'SELECTED':'') + ">"+uW.unitcost['unt'+r][0]+"</option>";

  mhtl +="</select></td>";
  var temps=[],tot=0;
  for(var i=0; i<Cities.numCities; i++) {
   temps[i]=((Cities.cities[i]['Troop'+p+'Time'] > 0)?(3600 / Cities.cities[i]['Troop'+p+'Time']):0);
   mhtl += "<td align=right>" + addCommas(parseInt(temps[i] )) +"</td>";
   tot+=parseInt(temps[i]);
  }
  mhtl += "<td align=right><b>"+addCommas(tot)+"</td></tr>";

  mhtl +=" <tr><td>&nbsp;</td>";
  var diff=0;
  for(var i=0; i<Cities.numCities; i++) {
   diff = parseInt(pop[i] - temps[i]);
   var couleur=" style='color:green' ";
   if (diff<0) couleur=" style='color:red' ";
   mhtl += "<td "+couleur+"  align=right><b>" + addCommas(parseInt(diff)) +"</b></td>";
  }
  diff = parseInt(tot1 - tot);
  var couleur=" style='color:green' ";
  if (diff<0) couleur=" style='color:red' ";
  mhtl += "<td "+couleur+" align=right><b>" + addCommas(parseInt(diff)) +"</b></td></tr>";



  mhtl +="<tr><td></td></tr><tr><td>"+uW.g_js_strings.commonstr.happiness+"</td>";
  for(var i=0; i<Cities.numCities; i++) {
   cityID = 'city'+ Cities.cities[i].id;
   var bon = parseInt(Seed.citystats[cityID]["pop"][2]);
   var bonc = "red";
   if (bon>99) bonc="green";
   mhtl += "<td style='color:"+bonc+"'><center><b>"+bon+"</td>";
  }
  var now = unixTime();
  var totalpop=0,tpop=0;
  mhtl += "</tr><tr><td>"+lang.tournoi.training+"</td>";
  for(var i=0; i<Cities.numCities; i++) {
   cityID = Cities.cities[i].id;
   var q = Seed.queue_unt['city'+cityID];
   if (parseInt(q.length)>=parseInt(getCityBuilding(cityID, 13).count-1)) {
   mhtl += "<td style='color:red;'><center><b>"+ q.length +"/"+getCityBuilding(cityID, 13).count +"</td>";
   }else{
   mhtl += "<td><center><b>"+ q.length +"/"+getCityBuilding(cityID, 13).count +"</td>";
   }
  }
  mhtl += "</tr><tr><td>"+lang.tournoi.training+"</td>";
  var phtl = "</tr><tr><td>"+lang.tournoi.popdispo+"</td>";
    for(var i=0; i<Cities.numCities; i++) {
     cityID = 'city'+ Cities.cities[i].id;
     var totTime = 0;
     var q = Seed.queue_unt[cityID];
     if (q!=null && q.length>0) {
         totTime = q[q.length-1][3] - now;
         totalpop=0;
         for (var zz=0; zz<q.length; zz++){
         totalpop += parseInt((parseInt(q[zz][1]) * uW.unitcost['unt'+q[zz][0]][6]) / 2);
         }
     }
     tpop+=totalpop;
     if (totTime < 0) totTime = 0;
     if (totTime < 3600)
      var bonc="style='color:red'";
     else
      var bonc="";
     mhtl += "<td "+bonc+"><center><b>"+timestr(totTime)+"</td>";
     phtl += "<td "+bonc+"><center><b>"+addCommas(totalpop)+"</td>";
    }
  mhtl += '<tr><td></td></tr>'+phtl+'<td><center><b>'+addCommas(tpop)+'</td><tr><td><img height=18 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/iron_30.png></td>'
  for(var i=0; i<Cities.numCities; i++) {
   cityID = 'city'+ Cities.cities[i].id;
   var mine=Seed.resources[cityID]['rec4'][0] / 3600
   var bonc="";
   if (mine<=15000000)
    var bonc="style='color:red'";

    mhtl += '<td "+bonc+" align=right><b>'+UniteKMG(parseInt(mine)) +'</td>';
  }
  mhtl += "</tr></table><br><DIV class=boStat><b>"+lang.tournoi.title2+"</b>&nbsp;<select id=BOPosTournoi><option value=0>"+uW.g_js_strings.commonstr.tournament+"</option><option value=1>"+uW.g_js_strings.commonstr.previous+" 1</option><option value=2>"+uW.g_js_strings.commonstr.previous+" 2</option><option value=3>"+uW.g_js_strings.commonstr.previous+" 3</option><option value=4>"+uW.g_js_strings.commonstr.previous+" 4</option></select></div><div id=BOTournoiResult></div>";
  t.cont.innerHTML += mhtl;

  //if (t.state==null) {
  //   t.state=1;
  ById("BOTournoiUnit").addEventListener('change', function(e){

       	      Options.TourUnit = ById("BOTournoiUnit").value;
       	      saveOptions();
       	      t.show();

  },false);
  ById("BOPosTournoi").value=t.pos;
  ById("BOPosTournoi").addEventListener('change', function(e){
  		t.pos =  ById("BOPosTournoi").value;
         	t.Tournoi(t.pos);
  },false);


  t.Tournoi(t.pos);
},
Tournoi: function(pos) {
  var t = myBO.Tournoi;
  var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  params.format=2;
  params.tournyPos=pos;


  new AjaxRequest(unsafeWindow.g_ajaxpath+"ajax/getLeaderboard.php"+unsafeWindow.g_ajaxsuffix, {  method:"post",  parameters:params,

  onSuccess:function(transport){
   var rslt=eval("("+transport.responseText+")");
   if(rslt.ok){

    if(!rslt.data){

	ById("BOTournoiResult").innerHTML ="<div class='tourny_modal_upsell'><br><center><b>"+unsafeWindow.g_js_strings.modal_tourny_changetab.notourny+"</b></center></div><br>";

    }else{ // fin rslt.data
     var tournyhtml=new Array();

     if(rslt.name){
	    tournyhtml.push("<div><center><b><u>"+rslt.name+"</u></b></center></div>")
     }  else{
	    tournyhtml.push("<div class='tournymodaltitle'><center>"+unsafeWindow.g_js_strings.commonstr.tournament+"</div>")
     }
	   tournyhtml.push("<div>");



	   if(rslt.startdate&&rslt.enddate){
	   	   	    var startTime=rslt.startdate;
	   	   	    var endTime=rslt.enddate;
	   	   	    var now=parseInt(new Date().getTime()/1000);
	   	   	    tournyhtml.push("<table width=100% align=center class=ptTab><tr bgcolor=#FE8888><td width=40%><b>"+lang.tournoi.start+"</td><td width=40%><b>"+lang.tournoi.end+"</td><td width=20%><b>"+lang.tournoi.timeRem+"</td></tr>");
	   	   	    dt = new Date ();
	   	            dt.setTime (startTime * 1000);
	   	            dtf = new Date ();
	   	            dtf.setTime (endTime * 1000);

	   	            var restant = endTime - now;


	   	   	   tournyhtml.push("<tr><td>");
	   	   	     tournyhtml.push("" + dt.toLocaleDateString() + " - "+ dt.toLocaleTimeString());
	   	   	    tournyhtml.push("</td><td>");
	   	   	    tournyhtml.push("" + dtf.toLocaleDateString()+ " - "+ dtf.toLocaleTimeString());
	   	   	    tournyhtml.push("</td><td>"+timestr(restant,1)+"</td></tr></table>");
	   	     tournyhtml.push("<br>");

	   }


	   tournyhtml.push("<center><DIV style='max-height:300px; overflow-y:auto;'><table class='tourny_list_table' cellpadding='0' cellspacing='0' border='0' width=90% style='margin:3px'>");
	   tournyhtml.push("<thead>");
	   tournyhtml.push("<tr>");
     if(rslt.type==24){
	    tournyhtml.push("<td class='rankcol' style='background-color:red'>");
	    tournyhtml.push("<div><select id='BOTournoiPM'><option value=5>5</option><option value=10>10</option><option value=25>25</option><option value=50>50</option><option value=100>100</option><option value=200>200</option></select></div>");
	    tournyhtml.push("</td>");
	    tournyhtml.push("<td  style='background-color:red'>");
	    tournyhtml.push("<div>"+unsafeWindow.g_js_strings.modal_tourny_changetab.chancellorname+"</div>");
	    tournyhtml.push("</td>");
	    tournyhtml.push("<td  style='background-color:red'>");
	    tournyhtml.push("<div>"+unsafeWindow.g_js_strings.commonstr.alliance.substring(0,20)+"</div>");
	    tournyhtml.push("</td>");
	    tournyhtml.push("<td  style='background-color:red'>");
	    tournyhtml.push("<div>"+unsafeWindow.g_js_strings.modal_tourny_changetab.mightgained+"</div>");
	    tournyhtml.push("</td  style='background-color:red'>");
	    tournyhtml.push("<td  style='background-color:red'> ");
	    tournyhtml.push("<div>"+unsafeWindow.g_js_strings.modal_tourny_changetab.rewardperplayer+"</div>");
	    tournyhtml.push("</td>")
      }else{
            tournyhtml.push("<td	class='rankcol' style='background-color:red'>");
	    tournyhtml.push("<div><select id='BOTournoiPM'><option value=5>5</option><option value=10>10</option><option value=25>25</option><option value=50>50</option><option value=100>100</option><option value=200>200</option></select></div>");
	    tournyhtml.push("</td>");
	    tournyhtml.push("<td  style='background-color:red'>");
	    tournyhtml.push("<div>Nom Joueur</div>");
	    tournyhtml.push("</td>");
	    tournyhtml.push("<td  style='background-color:red'>");
	    tournyhtml.push("<div>"+unsafeWindow.g_js_strings.commonstr.alliance+"</div>");
	    tournyhtml.push("</td>");
	    tournyhtml.push("<td  style='background-color:red'>");
	    tournyhtml.push("<div>"+rslt.contestcategory+"</div>");
	    tournyhtml.push("</td>");
	    tournyhtml.push("<td  style='background-color:red'>");
	    tournyhtml.push("<div>"+unsafeWindow.g_js_strings.commonstr.reward+"</div>");
	    tournyhtml.push("</td>")
     }
	   tournyhtml.push("</tr>");
	   tournyhtml.push("</thead>");
	   tournyhtml.push("</tbody>");
	   var nb=rslt.data.length;
	   var votrepuissance = 0;
	   for(var i=0;i<rslt.data.length;i++){
	    var row=rslt.data[i];
	    if(rslt.type==24){
	     // pour le tournoi alliance
	     if (getMyAlliance()[1] == row.alliance) {
	      votrepuissance=row.contestValue;
	      break;
	     }
	    } else {
	     if (Seed.player.prefix + ' '+ Seed.player.name == row.name ) {
	      votrepuissance=row.contestValue;
	      break;
	     }
	    }
	   }
	   for(var i=0;i< Options.TournoiLigne;i++){
	    var row=rslt.data[i];
	    var rewardString=row.itemCount+" ";
	    if(row.itemType==0){
	     rewardString+=unsafeWindow.g_js_strings.commonstr.gems;
	    }else{
	     rewardString+=unsafeWindow.itemlist["i"+row.itemType].name;
	    }
	    var couleur="";
	    if(rslt.type==24){
	     // pour le tournoi alliance
	     if (getMyAlliance()[1] == row.alliance) {
	      couleur=" style='background-color:#77FF77' ";
	     }
	    }else{
	     if (getMyAlliance()[1] == row.alliance) {
	       if(i%2==1){
	     	      couleur=" style='background-color:#FF9977' ";
	     	    }else{
	     	      couleur=" style='background-color:#FFAA88' ";
	       }

	     }
	     if (Seed.player.prefix + ' '+ Seed.player.name == row.name ) {
	      couleur=" style='background-color:#77FF77' ";
	     }
	    }
	    if(i%2==1){
	     tournyhtml.push("<tr>")
	    }else{
	     tournyhtml.push("<tr class='stripe'>")
	    }
	    tournyhtml.push("<td class='rankcol' "+couleur+">");
	    tournyhtml.push("<div><b>"+row.ranking+"</b></div>");
	    tournyhtml.push("</td>");
	    tournyhtml.push("<td "+couleur+">");
	    tournyhtml.push("<div>"+row.name+"</div>");
	    tournyhtml.push("</td>");
	    tournyhtml.push("<td "+couleur+">");
	    tournyhtml.push("<div>"+(row.alliance||"----")+"</div>");
	    tournyhtml.push("</td>");
	    tournyhtml.push("<td "+couleur+">");
	    tournyhtml.push("<div>"+addCommas(row.contestValue));
	    if (votrepuissance>0) {
	      var ecartavecvous = parseInt(row.contestValue - votrepuissance);
	      if (ecartavecvous>0) {
	       tournyhtml.push("&nbsp;(+ " + addCommas(ecartavecvous) +")");
	      }
	      if (ecartavecvous<0) {
	       tournyhtml.push("&nbsp;(" + addCommas(ecartavecvous) +")");
	      }
	    }
	    tournyhtml.push("</div>");
	    tournyhtml.push("</td>");
	    tournyhtml.push("<td "+couleur+">");
	    tournyhtml.push("<div>"+rewardString+"</div>");
	    tournyhtml.push("</td>");
	    tournyhtml.push("</tr>")
	   } // fin du for

	      if(rslt.type!=24){

	    for(var i= Options.TournoiLigne;i<rslt.data.length;i++){
	   	    var row=rslt.data[i];

	   	    if (Seed.player.prefix + ' '+ Seed.player.name == row.name ) {
	   	      var rewardString=row.itemCount+" ";
	   	     	    if(row.itemType==0){
	   	     	     rewardString+=unsafeWindow.g_js_strings.commonstr.gems;
	   	     	    }else{
	   	     	     rewardString+=unsafeWindow.itemlist["i"+row.itemType].name;
	   	     	    }
	   	     	    tournyhtml.push("<tr class='stripe' >")
	   	     	    tournyhtml.push("<td class='rankcol' style='background-color:#77FF77'>");
	   	     	    tournyhtml.push("<div><b>"+row.ranking+"</b></div>");
	   	     	    tournyhtml.push("</td>");
	   	     	    tournyhtml.push("<td style='background-color:#77FF77'>");
	   	     	    tournyhtml.push("<div>"+row.name+"</div>");
	   	     	    tournyhtml.push("</td>");
	   	     	    tournyhtml.push("<td style='background-color:#77FF77'>");
	   	     	    tournyhtml.push("<div>"+(row.alliance||"----")+"</div>");
	   	     	    tournyhtml.push("</td>");
	   	     	    tournyhtml.push("<td style='background-color:#77FF77'>");
	   	     	    tournyhtml.push("<div>"+addCommas(row.contestValue)+"</div>");
	   	     	    tournyhtml.push("</td>");
	   	     	    tournyhtml.push("<td style='background-color:#77FF77'>");
	   	     	    tournyhtml	.push("<div>"+rewardString+"</div>");
	   	     	    tournyhtml.push("</td>");
	   	            tournyhtml.push("</tr>")
	   	   }
	   }
	   }
	   tournyhtml.push("</tbody>");
	   tournyhtml.push("</table>");
      tournyhtml.push("</div></div>");
      ById("BOTournoiResult").innerHTML = tournyhtml.join("");

    ById('BOTournoiPM').value=Options.TournoiLigne;
           ById('BOTournoiPM').addEventListener ('change',
           function() {
            Options.TournoiLigne=ById('BOTournoiPM').value;
            saveOptions();
            t.show();
           }, false);


          } // fin rslt.data
         } else {
            ById("BOTournoiResult").innerHTML = "<div class='tourny_modal_upsell'><center>"+lang.tournoi.error+"</div>";
         }
       }, onFailure:function()  {
         ById("BOTournoiResult").innerHTML = "<div class='tourny_modal_upsell'><center>"+lang.tournoi.error+"</div>";
       }
   });
   t.displayTimer = setTimeout (function() { t.Tournoi(pos); }, 240000);

  },

},


/************************ Ressources **********************/
myBO.Resources = {
   cont:null,
  resource : {1:uW.g_js_strings.commonstr.food, 2:uW.g_js_strings.commonstr.wood, 3:uW.g_js_strings.commonstr.stone, 4:uW.g_js_strings.commonstr.ore},
  users : [],
  doList : [], // list of gifts to accept
  accepting : false,
  city : null,
  total : {gold:0, 1:0, 2:0, 3:0, 4:0},

  init : function (){
    this.cont = document.createElement('div');
    return this.cont;
  },
  show : function (){
    var t = myBO.Resources;
    this.cont.style.overflowY = 'scroll';
     this.cont.innerHTML = '<DIV class=boStat><b>'+lang.Resources.title+'</b></div><TABLE cellpadding=0 cellspacing=0 class=pbTab width=100%><TR><TD align=center><INPUT id="pballlist" type=submit value="'+lang.Resources.pballlist+'" \><INPUT id="pballlist2" type=submit value="'+lang.Resources.pballlist2+'" \></td></tr></table><HR>\
        <DIV id=resDiv style="width:100%; min-height:300px; height:100%">';
    ById('pballlist').addEventListener ('click', function() { t.e_clickfetchlist(1); }, false);
    ById('pballlist2').addEventListener ('click', function() { t.e_clickfetchlist(2); }, false);
  },

  hide : function (){
  },

  progress : function (msg, span, add){
	if(add)
		ById(span).innerHTML+=msg;
	else
		ById(span).innerHTML=msg;
  },

  e_clickfetchlist : function  (tt){     // (also cancel accepting)
    var t = myBO.Resources;
	t.users = [];
    if (t.accepting){
      ById('pballlist').value = lang.Resources.pballlist;
      ById('resDiv').innerHTML+= '<BR><SPAN class=boldRed>'+lang.Resources.cancel+'</span>';
      t.accepting = false;
      return;
    }
    if (tt==1) ById('resDiv').innerHTML = lang.Resources.load1+' <span id=pbResUserListCount></span>';
    if (tt==2) ById('resDiv').innerHTML = lang.Resources.load2+' <span id=pbResUserListCount></span>';

    t.fetchUserList (tt, gotUserList);
    function gotUserList(userList){
		if(userList.length < 1){
			listGifts();
			return;
		}
		ById('resDiv').innerHTML += '<BR>'+lang.Resources.check+' <span id=pbResUserAvailCount></span>';
		t.checkDailyAction(userList, listGifts);
	}

    function listGifts (){
	  t.city = Cities.cities[0];
	  var m = '<DIV class=boStat><CENTER>'+lang.Resources.title2+'&nbsp;('+ t.users.length +' '+lang.Resources.find+')</center></div>';
      if (t.users.length<1){
        ById('resDiv').innerHTML = m + '<BR><BR><CENTER>'+lang.Resources.nothing+'</center>';
        return;
      }
      m += '<TABLE class=pbTab align=center><TR><TD align=right>'+unsafeWindow.g_js_strings.commonstr.city+' : </td><TD id=pbrescityselspan></td></tr>\
          <TR><TD align=right>'+lang.Resources.collect+'</td><TD>'
        + htmlSelector (t.resource, Options.getResType, 'id=pbResColType')
        + '</td></tr><TR><TD>'+lang.Resources.select+'</td><TD width=250><INPUT type=submit id=pbResDo value="'+lang.Resources.accept+'">\
        &nbsp; <SPAN id=pbResNone class=boldRed></span></td></tr></table><HR><TABLE class=pbTab><TR valign=top><TD>\
        <INPUT id=pbResButAll type=submit value="'+lang.General.all+'" style="width:100%; margin-bottom:5px"><BR><INPUT id=pbResButNone type=submit value="'+lang.General.nothing+'"></td>\
        <TD width=10></td><TD><TABLE align=center cellpadding=0 cellspacing=0 class=pbTabLined>\
        <TBODY id=pbResTbody style="height:250px; overflow:auto; display:block;">\
        <TR style="font-weight:bold; background:white"><TD>'+lang.General.name+'</td><TD>'+uW.g_js_strings.commonstr.might+'</td><TD width=20></td></tr>';
      for (var i=0; i<t.users.length; i++){
        m += '<TR><TD><INPUT type=checkbox id=pbrchk_'+ i +'> &nbsp;'+ t.users[i].name +'</td><TD>'+ t.users[i].might +'</td></tr>';
      }
      ById('resDiv').innerHTML = m + '</tbody></table></td></tr></table>';
	  new CdispCityPicker ('pbrescitysel', ById('pbrescityselspan'), true, t.e_CityButton, t.city.idx);
      ById('pbResDo').addEventListener ('click', t.getErDone, false);
      ById('pbResButAll').addEventListener ('click', t.e_butAll, false);
      ById('pbResButNone').addEventListener ('click', t.e_butNone, false);
      // var tbody = ById('pbResTbody');
      // tbodyScroller (tbody, getRemainingHeight (tbody, mainPop.div));
    }
  },

  e_CityButton : function (city, x, y){
    var t = myBO.Resources;
	t.city = city;
  },

  e_butAll : function (){
    var t = myBO.Resources;
    for (var i=0; i<t.users.length; i++)
      ById('pbrchk_'+i).checked = true;
  },

  e_butNone : function (){
    var t = myBO.Resources;
    for (var i=0; i<t.users.length; i++)
      ById('pbrchk_'+i).checked = false;
  },

  getErDone : function (){
    var t = myBO.Resources;
    t.doList = [];
    ById('pbResNone').innerHTML = '';
	Options.getResType = ById('pbResColType').value;
	t.total = {gold:0, 1:0, 2:0, 3:0, 4:0};
    for (var i=0; i<t.users.length; i++){
      if (ById('pbrchk_'+i).checked)
        t.doList.push (t.users[i]);
    }
    if (t.doList.length==0){
      ById('pbResNone').innerHTML = lang.Resources.error1;
      return;
    }
    t.accepting = true;
    ById('pballlist').value = lang.Resources.stop;
    ById('resDiv').innerHTML = '<DIV id=rsltDiv style="height:400px; max-height:400px; overflow-y:auto"><B>'+lang.Resources.collecting+' '+ t.doList.length +' '+lang.Resources.members+'</b><BR></div>';
    t.acceptNext ();
  },


  allDone : function (msg){
    var t = myBO.Resources;
	msg += '<BR><BR>'+lang.Resources.total+'<BR>\
		   Or : '+addCommas(t.total.gold)+'<BR>';
	for(var i=1; i<=4; i++){
		msg += t.resource[i]+': '+addCommas(t.total[i])+'<BR>';
	}
    ById('rsltDiv').innerHTML += '<BR><BR>' + msg;
    ById('pballlist').value = lang.Resources.pballlist;
    t.accepting = false;
  },


  acceptNext : function (){
    var t = myBO.Resources;
    var gift = t.doList.shift();
    if (gift == null){
      t.allDone (lang.Resources.alldone);
      return;
    }
    var acpDiv = ById('rsltDiv');
    var curDiv = document.createElement ('div');
    acpDiv.appendChild (curDiv);
    curDiv.innerHTML = '<B>>> '+ gift.name +': ';
    var statSpan = document.createElement ('span');
    curDiv.appendChild (statSpan);
    statSpan.innerHTML = lang.Resources.collecting2;
    t.getCourtAction (gift, gotGiftData);

    function gotGiftData (rslt){
      if (!t.accepting)
        return;
      if (rslt.ok){
        var msg = rslt.gold +' '+uW.g_js_strings.commonstr.gold+' - '+rslt.resource +' '+ t.resource[rslt.resourcetype]+'&nbsp; &nbsp; <font color=green><b>OK</b></font>.';
        statSpan.innerHTML += msg;
		t.total.gold += rslt.gold;
		t.total[rslt.resourcetype] += rslt.resource;
		t.acceptNext ();
        return;
      }

      if (rslt.msg)
        msg = '<B>'+ rslt.msg + '</b>';
      else
        msg = '<SPAN class=boldRed>ERROR : '+ rslt.ajaxErr +'</span>';

      curDiv.removeChild (statSpan);
      curDiv = document.createElement ('div');
      curDiv.className = 'indent25';
      acpDiv.appendChild (curDiv);
      curDiv.innerHTML = msg;
      t.acceptNext ();
    }

  },

  getMembersInfo : function (pageNo, notify) {
    var t = myBO.Resources;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

    params.pageNo = pageNo;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetMembersInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errMsg:'Ajax Comm Error'});
      },
    });
  },
    getFriendsInfo : function (notify) {
      var t = myBO.Resources;
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getAppFriends.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function (rslt) {
          notify (rslt);
        },
        onFailure: function (rslt) {
          notify ({errMsg:'Ajax Comm Error'});
        },
      });
  },
  getDailyAction : function (uid, notify){
	var t = myBO.Resources;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

    params.pid = uid;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/viewCourt.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errMsg:'Ajax Comm Error'});
      },
    });
  },

  getCourtAction : function (gift, notify){
	var t = myBO.Resources;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

    params.atype = Options.getResType;
	params.toid = gift.userId;
	params.givercityid = t.city.id;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/courtDoAction.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errMsg:'Ajax Comm Error'});
      },
    });
  },

  checkDailyAction : function (userList, notify){
	var t = myBO.Resources;
	var count = 0;
    t.getDailyAction(userList[count].userId, parseViewCourt);

	function parseViewCourt (rslt){
		if (!rslt.ok || rslt.errMsg)
			notify ({errMsg:'Ajax Comm Error'});
		if(rslt.dailyActionFlag == 0)
			t.users.push(userList[count]);
		t.progress(count, 'pbResUserAvailCount');
		count++;
		if(count < userList.length){
			t.getDailyAction(userList[count].userId, parseViewCourt);
		} else {
			notify();
		}
	}
  },
  fetchUserList : function (tt, notify){
    var t = myBO.Resources;
    var userList = [];
    if (tt==1)
      t.getMembersInfo(1, parseAlliancePage);

    if (tt==2)
      t.getFriendsInfo(parseAlliancePage2);
    function parseAlliancePage (rslt){
      if (!rslt.ok || rslt.errMsg)
        notify ({errMsg:'Ajax Comm Error'});
	  var users = rslt.memberInfo;
      for(var k in users){
		userList.push({userId:users[k].userId, name:users[k].name, might:users[k].prestige, type:'alliance'});
	  }
	  t.progress(userList.length, 'pbResUserListCount');
	  if(rslt.currentPage < rslt.noOfPages){
		t.getMembersInfo((rslt.currentPage+1), parseAlliancePage);
	  } else {
		notify(userList);
		//t.getFriendsInfo(parseAlliancePage2);
	  }
    }


    function parseAlliancePage2 (rslt){
	      if (!rslt.ok || rslt.errMsg)
	        notify ({errMsg:'Ajax Comm Error'});
		  var users = rslt.data;
	          for(var k in users){
	             if (users[k].userId!=undefined)
			userList.push({userId:users[k].userId, name:users[k].displayName, might:users[k].might, type:'friends'});
		  }
		  t.progress(userList.length, 'pbResUserListCount');
		  notify(userList);
    }

  },
   getContent : function (){
  	    var t = myBO.Resources;
  	    return t.cont;
 },
},

myBO.Spam = {
  cont : null,
  timer : null,

  init : function (){
    var t = myBO.Spam;
    t.cont = document.createElement('div');
     return t.cont;
 },
    getContent : function (){
   	    var t = myBO.Spam;
   	    return t.cont;
 },
  show : function (){
    var t = myBO.Spam;

        var m = '<DIV class=boStat>'+lang.Spam.title+'</div><TABLE class=pbTab width=100% height=0% ><TR align="center">';

           if (Options.spamconfig.aspam == true) {
            m += '<TD><INPUT id=pbSpamEnable type=submit value="Spam On"></td>';
           }
           else {
            m += '<TD><INPUT id=pbSpamEnable type=submit value="Spam Off"></td>';
           }

           if (Options.spamconfig.spamstate == 'a') {
            m += '<TD><INPUT id=pbSpamState type=submit value="'+lang.Spam.pbSpamState1+'"></td>';
           }
           else {
            m += '<TD><INPUT id=pbSpamState type=submit value="'+lang.Spam.pbSpamState2+'"></td>';
           }
            m += '</tr></table></div>';
           m += '<DIV class=boStat>OPTIONS</div><TABLE class=pbTab>';
            m += '<tr><td>'+lang.Spam.pbSpamMin+' <INPUT id=pbSpamMin type=text size=2 maxlength=3 value="'+ Options.spamconfig.spammins +'"  \> '+lang.General.mins+'</td></tr><BR>\
                  <tr><TD><TABLE cellpadding=0 cellspacing=0>\
                  <TD align=left>'+lang.Spam.pbSpamAd+' &nbsp; </td><TD><INPUT id=pbSpamAd type=text size=60 maxlength=250 value="'+ Options.spamconfig.spamvert +'" \></td></tr>\
                  </table><BR>';

        t.cont.innerHTML = m;

        ById('pbSpamEnable').addEventListener ('click', function(){t.toggleon(this);}, false);
        ById('pbSpamAd').addEventListener ('change', t.e_spamOptChanged, false);
        ById('pbSpamMin').addEventListener ('change', t.e_spamOptChanged, false);
    ById('pbSpamState').addEventListener ('click', function(){t.togglespam(this);}, false);

  },
  hide : function (){
    var t = myBO.Spam;
  },


 e_spamOptChanged : function (){
  var t = myBO.Spam;
  Options.spamconfig.spamvert = ById('pbSpamAd').value;
  Options.spamconfig.spammins = ById('pbSpamMin').value;
  if(parseInt(Options.spamconfig.spammins) < 30){
   Options.spamconfig.spammins = 30;
   ById('pbSpamMin').value = 30;
  }
  saveOptions ();
 },

 togglespam: function(obj){
  var t = myBO.Spam;
  if (Options.spamconfig.spamstate == 'a') {
   Options.spamconfig.spamstate = 'g';
   obj.value = lang.Spam.pbSpamState2;
  }
  else {
   Options.spamconfig.spamstate = 'a';
   obj.value = lang.Spam.pbSpamState1;
  }
  saveOptions ();

 },

 toggleon: function(obj){
  var t = myBO.Spam;
  if (Options.spamconfig.aspam == true) {
   Options.spamconfig.aspam = false;
   obj.value = "Spam Off";
  }
  else {
   Options.spamconfig.aspam = true;
   obj.value = "Spam On";
   SpamEvery.init();
  }
  saveOptions ();

 },
};

var SpamEvery  = {
  timer : null,
  spamtimer : 0,
  init : function (){
    if (!Options.spamconfig.aspam) return;
    if (Options.spamconfig.spammins < 30)
      Options.spamconfig.spammins = 30;
    SpamEvery.setEnable (Options.spamconfig.aspam);
  },
  setEnable : function (tf){
    var t = SpamEvery;
    clearTimeout (t.timer);
    if (tf)
      t.timer = setTimeout (t.count, 60*1000);
  },
  count : function (){
   var t = SpamEvery;
   t.spamtimer = Options.spamconfig.spammins;
   if(parseInt(t.spamtimer) < 30) t.spamtimer = 30;
   if (Options.spamconfig.atime > t.spamtimer) {
    Options.spamconfig.atime = 2;
    t.doit ();
   } else {
    Options.spamconfig.atime = (Options.spamconfig.atime + 1);
    SpamEvery.init ();
   }
   saveOptions ();
  },
  doit : function (){
    sendChat ("/" + Options.spamconfig.spamstate + " " +  Options.spamconfig.spamvert);
    SpamEvery.init ();
  }
}

/*********************************** Log Tab ***********************************/
myBO.ActionLog = {
  myDiv : null,
  logTab : null,
  maxEntries: 300,
  last50 : [],
  state : null,
   init : function (){    // called once, upon script startup

        this.myDiv = document.createElement('div');

     window.addEventListener('unload', t.onUnload, false);
    return this.myDiv;
  },
  show : function (div){
    var t = myBO.ActionLog;

        t.myDiv = this.myDiv;
        t.myDiv.innerHTML = '<DIV  class=boStat>'+lang.log.title+'</div><DIV style="height:535px; max-height:535px; overflow-y:auto">\
       <select id=BOSuiviFiltre><option value="">'+uW.g_js_strings.commonstr.all+'</option><option value="Erreur">'+lang.log.option1+'</option>\
       <option value="Rapport">'+lang.log.option2+'</option><option value="Transport">'+lang.log.option3+'</option><option value="Appro">'+lang.log.option8+'</option>\
       <option value="AutoForm">'+lang.log.option9+'</option><option value="Reassign">'+lang.log.option4+'</option><option value="AutoFO">'+lang.log.option7+'</option>\
       <option value="RAID">Raid</option><option value="AutoTS">'+lang.log.option5+'</option><option value="AutoTrone">'+lang.log.option6+'</option></select>\
       &nbsp;<input type=button value="'+lang.log.clear+'" id=BOLogClean><br><TABLE cellpadding=0 cellspacing=0 id=BOactionlog class=pbTabLined></table></div>';
     t.logTab = ById('BOactionlog');
     t.filtre = ById('BOSuiviFiltre');
     t.state = 1;
     t.filtre.addEventListener ('change', t.pouette, false);
     ById('BOLogClean').addEventListener ('click', t.deleteall, false);

    t.pouette();
  },
  deleteall: function() {
    var t = myBO.ActionLog;
    GM_setValue ('BOlog_'+getServerId(), '[]');
     t.pouette();
  },
  pouette: function() {
    var t = myBO.ActionLog;
    t.logTab.innerHTML="<TR><TD></td><td></td><TD width=95%></td></tr>";
      var a = JSON2.parse(GM_getValue ('BOlog_'+getServerId(), '[]'));
      if (matTypeof(a) == 'array'){
        t.last50 = a;
        for (var i=0; i<t.last50.length; i++) {
           if (t.filtre.value=="" || t.filtre.value==t.last50[i].ou) {
           t._addTab (t.last50[i].msg, t.last50[i].ou, t.last50[i].ts);
          }

        }
    }

  },
  hide : function (){
  },
  getContent : function (){
      return myBO.ActionLog.myDiv;
  },
  _addTab : function (msg, ou, ts){
    var t = myBO.ActionLog;
    if (t.state != 1)
      return;
    if (t.logTab.rows.length >= t.maxEntries)
      t.logTab.deleteRow(t.maxEntries-1);
    var row = t.logTab.insertRow(0);
    row.vAlign = 'top';
    row.insertCell(0).innerHTML = ts;
    row.insertCell(1).innerHTML = ou;
    row.insertCell(2).innerHTML = msg;
  },

  log : function (msg,ou){
    var t = myBO.ActionLog;
    var ts = new Date().toTimeString().substring (0,8);
    if (t.filtre) {
     if (t.filtre.value=="" || t.filtre.value==ou) {
      t._addTab (msg, ou, ts);
     }
    }else {
    t._addTab (msg, ou, ts);
    }
    while (t.last50.length >= 50)
      t.last50.shift();
    t.last50.push ({msg:msg, ts:ts, ou:ou});
    GM_setValue ('BOlog_'+getServerId(), JSON2.stringify(t.last50));
  },
    onUnload : function (){
      var t = myBO.ActionLog;
      if (!ResetAll) GM_setValue ('BOlog_'+getServerId(), JSON2.stringify(t.last50));
  },
}

function actionLog (ou,msg){
    myBO.ActionLog.log (msg,ou);
}


/*********************************** Throme TAB ***********************************/
myBO.Trone = {
  myDiv : null,
  cont : null,
  passage:null,
  timer : null,
  filtre:"",
  tableau:[],
  filtre2:"",
  filtre3:"",
  filtre6:0,
  filtre15:0,
  filtre7:false,
  filtre8:"",
  filtre4:Options.AllEffet,
  filtre5:Options.EffetRouge,
  init : function (){
    this.myDiv = document.createElement('div');
    return this.myDiv;
  },

  hide : function (){
    var t = myBO.Trone;

  },
  getContent : function (){
      return myBO.Trone.myDiv;
  },

  show : function (){
     var t = myBO.Trone;
     if (Options.salvageconfig.CityCity==undefined) Options.salvageconfig.CityCity=0;
     uW.BOsalvage=t.salvage;
     uW.BOequipItem=t.equipItem;
     uW.BOUnequipItem=t.UnequipItem;
     uW.BORepair = t.Repair;
     uW.BOupgradeQualite = t.upgradeQualite;
     uW.BOupgradeLevel = t.upgradeLevel;
     t.cont = this.myDiv;
     var m="",nb=0,nbbroken=0,k=Seed.throne.slotEquip[Seed.throne.activeSlot],i=Seed.throne.inventory,e,faction,i = uW.kocThroneItems,sl=0;
     if (t.passage==null) {
      t.passage=1;
     var taille = 450; //uW.screen.height - mainPop2.getLocation().y - 450;
      m += '<DIV class=boStat><b>'+lang.Trone.title+' - <input type=button value="?" id=boaidetrone class=boAide></b></div><table style="background-color:transparent;max-width:100%;width:755px;" cellspacing=0 cellpadding=2><tr>\
      <td><input type=checkbox id=BOFiltre4ST> '+lang.Trone.BOFiltre4ST+'<br><input type=checkbox id=BOFiltre7ST> '+lang.Trone.BOFiltre7ST+'</td><td><center>'+lang.Trone.BOlisteeffets+'<br><select id=BOlisteeffets multiple="multiple"></select>\
         </td><td style="text-align:right"><font size=1>'+lang.pubbao+'<br><iframe src="'+sitepub+'" width=320 marginwidth=0 marginheight=0 height=50 scrolling=no frameborder=0></iframe><br>'+lang.Trone.BOTroneCityCity+' <span id=BOTroneCityCity></span></td>\
         </tr></table>';
      m +='<DIV class=boStat><b>'+lang.Trone.title2+'</b></div><DIV id=BOTroneAether style="width:100%;height:45px;max-height:45px;"></DIV><DIV class=boStat><b>'+lang.Trone.title3+'</b></div><DIV id=BOTroneE style="width:100%;height:33px;max-height:33px;"></DIV>\
      <DIV class=boStat><b>'+lang.Trone.title4+' - <span id=BONbArticle></span></b></div><center><table style="background-color:transparent;max-width:95%;width:755px;" cellspacing=0 cellpadding=2>\
      <tr><td colspan=1 width=35>&nbsp;</td>\
      <td width=35><select id=BOFiltre8ST><option value="">'+uW.g_js_strings.commonstr.level+'...</option><option value=1>+1</option><option value=2>+2</option><option value=3>+3</option><option value=4>+4</option><option value=5>+5</option><option value=6>+6</option><option value=7>+7</option><option value=8>+8</option><option value=9>+9</option><option value=10>+10</option></select></td>\
      <td width=120><select id=BOFiltre2ST><option value="">'+uW.g_js_strings.commonstr.quality+'...</option><option value="0">'+uW.g_js_strings.throneRoom.simple+'</option><option value="1">'+unsafeWindow.g_js_strings.throneRoom.common+'</option><option value="2">'+unsafeWindow.g_js_strings.throneRoom.uncommon+'</option><option value="3">'+unsafeWindow.g_js_strings.throneRoom.rare+'</option><option value="4">'+unsafeWindow.g_js_strings.throneRoom.epic+'</option><option value="5">'+unsafeWindow.g_js_strings.throneRoom.wondrous+'</option><option value="6">'+uW.g_js_strings.throneRoom.unique+'</option></select></td>\
      <td width=80><select id=BOFiltreST><option value="">'+uW.g_js_strings.commonstr.faction+'...</option><option value="briton">briton</option><option value="druid">druid</option><option value="fey">fey</option></select></td>\
      <td width=80><select id=BOFiltre3ST><option value="">'+uW.g_js_strings.commonstr.type+'...</option><option value="advisor">advisor</option><option value="banner">banner</option><option value="chair">chair</option><option value="table">table</option><option value="window">window</option><option value="trophy">trophy</option></select></td>\
      <td width=250><select id=BOFiltre15ST></select><br><select id=BOFiltre5ST></select></td>\
      <td width=80><input type=checkbox id=BOTroneInverse>'+lang.Trone.BOTroneInverse+'</td></tr></table><DIV id=BOTroneC style="width:100%;height:'+taille+'px; max-height:'+taille+'px; overflow-y:auto"></div><br>';
       t.cont.innerHTML = m;
        ById('boaidetrone').addEventListener('click', function(){
                  	       	 window.open(sitesupport+"?page=aide_trone");
        } , false);
       var dcp0 = new CdispCityPicker ('BORCityC', ById('BOTroneCityCity'), false, function(c) { var t = myBO.Trone;Options.salvageconfig.CityCity=c.idx;saveOptions();t.show();}, Options.salvageconfig.CityCity);


    	 var liste = uW.cm.thronestats.effects;
	     ById("BOlisteeffets").innerHTML="";
	     for (k in liste){
	         if (liste[k] !=undefined){
	             	var o = document.createElement("option");
	             	o.text = liste[k][1].substring(0,30);
	             	o.value = k;
	             	for (var ww=0;ww<t.filtre5.length;ww++)
			  if(t.filtre5[ww]==k)
	       			o.selected = true;
	             	ById("BOlisteeffets").options.add(o);
	         }
	     }
	     ById("BOFiltre5ST").innerHTML="";
	     ById("BOFiltre15ST").innerHTML="";
	      var o = document.createElement("option");
	     	     o.text = "----";
	     	     o.value = 0;
	     ById("BOFiltre15ST").options.add(o);
	     var ef=[];
	       	 var liste1 = uW.cm.thronestats.boosts;
	     for (k in liste1){
	         if (liste1[k] !=undefined ){
	          var o = document.createElement("option");
		  	             	o.text = liste1[k].BoostName;
		  	             	o.value = k;
	             	ById("BOFiltre15ST").options.add(o);
	         }
	     }


	     var o = document.createElement("option");
	     o.text = "----";
	     o.value = 0;
	     ById("BOFiltre5ST").options.add(o);
	     for (k in liste){
	         if (liste[k] !=undefined){
	           if (t.filtre15==0 || t.filtre15==liste[k][2]) {
	             	var o = document.createElement("option");
	             	o.text = liste[k][1].substring(0,35);
	             	o.value = k;
	             	ById("BOFiltre5ST").options.add(o);
	             	}
	         }
	     }

	     ById("BOlisteeffets").addEventListener ('change', t.filtreaction, false);

	     ById('BOFiltreST').value=t.filtre;
	     ById('BOFiltreST').addEventListener ('change', t.filtreaction, false);
	     ById('BOFiltre2ST').value=t.filtre2;
	     ById('BOFiltre2ST').addEventListener ('change', t.filtreaction, false);
	     ById('BOFiltre3ST').value=t.filtre3;
	     ById('BOFiltre3ST').addEventListener ('change', t.filtreaction, false);
	     ById('BOFiltre4ST').checked=t.filtre4;
	     ById('BOFiltre4ST').addEventListener ('click', t.filtreaction, false);
	     ById('BOFiltre5ST').value=t.filtre6;

	     ById('BOFiltre15ST').value=t.filtre15;
             ById('BOFiltre5ST').addEventListener ('change', function() {

             t.filtreaction();
             }, false);
    	     ById('BOFiltre15ST').addEventListener ('change', function() {
    	                t.filtre15 = ById('BOFiltre15ST').value;
	     	         var liste = uW.cm.thronestats.effects;
	     	         ById("BOFiltre5ST").innerHTML="";
	     	         var o = document.createElement("option");
	     	         	     o.text = "----";
	     	         	     o.value = 0;
	     	         	     ById("BOFiltre5ST").options.add(o);
	     	         	     for (k in liste){
	     	         	         if (liste[k] !=undefined){
	     	         	           if (t.filtre15==0 || t.filtre15==liste[k][2]) {
	     	         	             	var o = document.createElement("option");
	     	         	             	o.text = liste[k][1];
	     	         	             	o.value = k;
	     	         	             	ById("BOFiltre5ST").options.add(o);
	     	         	             	}
	     	         	         }
    }

    	     t.filtreaction();

    	     }, false);
    	     ById('BOFiltre7ST').checked=t.filtre7;
	     ById('BOFiltre7ST').addEventListener ('click', t.filtreaction, false);
	     ById('BOFiltre8ST').value=t.filtre8;
	     ById('BOFiltre8ST').addEventListener ('click', t.filtreaction, false);

	     ById('BOTroneInverse').checked=Options.TroneInverse;
	     ById('BOTroneInverse').addEventListener ('click', function() {
	      Options.TroneInverse = ById('BOTroneInverse').checked;

	      saveOptions ();
   		 t.show();
	     }, false);

     }
     m='<table style="background-color:transparent;width:755px;max-width:95%;" cellspacing=0 cellpadding=2>';
     t.tableau=[];
     for (var z in i) {
           if (i[z].id) {
            e=uW.kocThroneItems[i[z].id];
            if (e) {

              t.tableau[sl]=i[z].id;
              sl++
            }
           }
     }
     var lignauto = Seed.throne.rowNum * 5;
     if (Options.TroneInverse) t.tableau.reverse();
     var pastoucher = [];

       for (var nbslot=1;nbslot<=Seed.throne.slotNum;nbslot++) {
        B = Seed.throne.slotEquip[nbslot];
        for (var zzz in B) {
         if (uW.kocThroneItems[B[zzz]]) {
          pastoucher.push(B[zzz]);
         }
        }
       }

     var nbl=t.tableau.length+1;

     var BOtimeLeft=-1;
     if (Seed.queue_throne) {
      if (Seed.queue_throne.end)
          BOtimeLeft = Seed.queue_throne.end - uW.unixtime();
     }

     for (var z=0;z<t.tableau.length;z++) {
       e=uW.kocThroneItems[t.tableau[z]];
       nb++
       faction=e.faction;
       x=0;
       nbl--;
       if ( (t.filtre=="" || t.filtre==faction) && (t.filtre2=="" || t.filtre2==e.quality) && (t.filtre3=="" || t.filtre3==e.type) && (t.filtre7==false || (t.filtre7==e.isBroken || (t.filtre=true && Seed.queue_throne.itemId==e.id)))  && (t.filtre8=="" || t.filtre8==e.level)   )  {

       var ok=0;
       for (var u in e.effects) {
            if (t.filtre6==e.effects[u].id) {
                 ok=1;
            }
            if (t.filtre6=="0") {
             for (l=0;l<unsafeWindow.cm.thronestats.effects[e.effects[u].id]["2"].length;l++){
	   	type = unsafeWindow.cm.thronestats.effects[e.effects[u].id]["2"][l];
	   	if (type==t.filtre15) {
	   	 ok=1
	   	}
	     }
	    }

       }
       if ((t.filtre6=="0" || ok==1) && (t.filtre15=="0" || ok==1)) {
       var styleez="";
       var name="";

       if (e.isEquipped) {
        equip="equip";
        styleez="background-color:#DC9999";
        name=faction+"/"+ faction +"_"+e.type+"_"+equip+"_1.png";
        if (e.type=="trophy")
         name=faction+"/"+ faction +"_"+e.type+"_"+equip+"_1_"+e.quality+".png";
       }else{
        equip="normal";
        name=faction+"/"+ faction +"_"+e.type+"_"+equip+"_1_"+e.quality+".png";
        }

       if (pastoucher.toString().indexOf(t.tableau[z])>-1 && equip=="normal")
          styleez="background-color:#99DC99";

       var styleauto="";
       m+="<tr><td style='"+styleez+";width:35px'>"
       if (Seed.queue_throne) {
        if (Seed.queue_throne.itemId==e.id) {
           nbbroken++
            m+="<img title='"+ThroneItemName(e) +"' width=30 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/modal/sm_hammer.png>";
        } else {
         if (e.isBroken) {
            nbbroken++
	          m+="<img title='"+ThroneItemName(e) +"' width=30 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/modal/sm_fail_overlay.png>";
         } else {
          m+="<img title='"+ThroneItemName(e) +"' width=30 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/30/"+ name +">";
         }
        }
       } else {
         if (e.isBroken) {
	          m+="<img title='"+ThroneItemName(e) +"' width=30 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/modal/sm_fail_overlay.png>";
        } else {
          m+="<img title='"+ThroneItemName(e) +"' width=30 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/30/"+ name +">";
        }
       }
        m+="</td><td colspan=4 style='"+styleez+";width:250px'>"+ ThroneItemName(e) +"</td>";
        m+="<td style='"+styleez+";width:300px'>";
        for (var u in e.effects) {
           x++;
           L = e.effects[u];
           if ((e.quality >= x && !t.filtre4) || t.filtre4) {
           var coleur="";
           var stylee="";
           if (e.quality < x)
            stylee="text-decoration:line-through";
            for (var ww=0;ww<t.filtre5.length;ww++)
             if (t.filtre5[ww]==e.effects[u].id)
               stylee+=";color:#AA1111;font-weigth:bold";
 	    effect = uW.cm.thronestats.effects[L.id];
            tier = uW.cm.thronestats.tiers[L.id][L.tier];
            var percent = + tier.base + (e.level * e.level + e.level) * + tier.growth * 0.5;
            //percent = percent > 0 ? "+" + percent : + percent;
            percent = Math.round(percent*100)/100;
            typpee="";
            for (l=0;l<effect["2"].length;l++){
             typpee+=effect["2"][l];
            }
           m+="<span style='"+stylee+"'><font color="+coleur+">" + percent + "% " + effect[1] + " ("+typpee+")</font></span><bR>";
         }
        }
        m+="</td>";
        if ((Options.TroneInverse && nbl<=lignauto) || (!Options.TroneInverse && nb<=lignauto)) {

        m+="<td style='"+styleez+"'><center>";

         if (Seed.queue_throne && Seed.queue_throne.itemId==e.id) {
	              var timeLeft = Seed.queue_throne.end - uW.unixtime();
	              if (timeLeft<0) timeLeft=0;
	 	      m+=lang.Trone.repairing+"<br>"+timestr(timeLeft)+"";
	}else{
	  if (e.isBroken) {
	    if (BOtimeLeft<0) {
	              m+="<a onclick='BORepair("+t.tableau[z]+")' class='buttonv2 h20 blue'>"+lang.Trone.repair+"</a>";
	    }

         } else {
         if (e.quality<5) {
           stoneenhance=uW.cm.thronestats["enhance"][e.quality+1].Stones;
           cityId='city'+Seed.cities[Options.salvageconfig.CityCity][0];
	   if (parseIntNan(stoneenhance)<parseIntNan(Seed.resources[cityId]['rec5'][0])) {
             m+="<a onclick='BOupgradeQualite("+t.tableau[z]+",0)' class='buttonv2 h20 brown' title='Enhance - "+stoneenhance+" ether'>"+lang.Trone.enhance+"</a>";
             if (uW.ksoItems[20001].count > 0)
                      m+="<a onclick='BOupgradeQualite("+t.tableau[z]+",20001)' class='buttonv2 h20 brown' title='Besoin de "+stoneenhance+" pierres ether'><img align=absmiddle width=13 src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20001.jpg'> "+lang.Trone.enhance+"</a>";

             if (uW.ksoItems[20002].count > 0)
                      m+="<a onclick='BOupgradeQualite("+t.tableau[z]+",20002)' class='buttonv2 h20 brown' title='Besoin de "+stoneenhance+" pierres ether'><img align=absmiddle width=13 src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20002.jpg'> "+lang.Trone.enhance+"</a>";

             if (uW.ksoItems[20005].count > 0)
                       m+="<a onclick='BOupgradeQualite("+t.tableau[z]+",20005)' class='buttonv2 h20 brown' title='Besoin de "+stoneenhance+" pierres ether'><img align=absmiddle width=13 src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20005.jpg'> "+lang.Trone.enhance+"</a>";

             if (uW.ksoItems[20006].count > 0)
                    m+="<a onclick='BOupgradeQualite("+t.tableau[z]+",20006)' class='buttonv2 h20 brown' title='Besoin de "+stoneenhance+" pierres ether'><img align=absmiddle width=13 src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20006.jpg'> "+lang.Trone.enhance+"</a>";

           }
         }
         m+="<bR>";
         if (e.level<9) {
           stoneupgrade=uW.cm.thronestats["upgrade"][e.level+1].Stones;
           cityId='city'+Seed.cities[Options.salvageconfig.CityCity][0];
	   if (parseIntNan(stoneupgrade)<parseIntNan(Seed.resources[cityId]['rec5'][0])) {
            m+="<a onclick='BOupgradeLevel("+t.tableau[z]+",0)' class='buttonv2 h20 brown' title='Upgrade - "+stoneupgrade+" ether'>"+lang.Trone.upgrade+"</a>";
            if (uW.ksoItems[20001].count > 0)
               m+="<a onclick='BOupgradeLevel("+t.tableau[z]+",20001)' class='buttonv2 h20 brown' title='"+stoneupgrade+"'><img align=absmiddle width=13 src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20001.jpg'> "+lang.Trone.upgrade+"</a>";

            if (uW.ksoItems[20002].count > 0)
               m+="<a onclick='BOupgradeLevel("+t.tableau[z]+",20002)' class='buttonv2 h20 brown' title='"+stoneupgrade+"'><img align=absmiddle width=13 src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20002.jpg'> "+lang.Trone.upgrade+"</a>";

            if (uW.ksoItems[20005].count > 0)
               m+="<a onclick='BOupgradeLevel("+t.tableau[z]+",20005)' class='buttonv2 h20 brown' title='"+stoneupgrade+"'><img align=absmiddle width=13 src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20005.jpg'> "+lang.Trone.upgrade+"</a>";

            if (uW.ksoItems[20006].count > 0)
               m+="<a onclick='BOupgradeLevel("+t.tableau[z]+",20006)' class='buttonv2 h20 brown' title='"+stoneupgrade+"'><img align=absmiddle width=13 src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20006.jpg'> "+lang.Trone.upgrade+"</a>";


           }
          }
          m+="<br><a onclick='BOsalvage("+t.tableau[z]+")' class='buttonv2 h20 red'>"+lang.Trone.salvage+"</a>";
          if (equip=="normal")
           m+="<a onclick='BOequipItem("+t.tableau[z]+")' class='buttonv2 h20 blue'>"+lang.Trone.equip+"</a>";
          else
           m+="<a onclick='BOUnequipItem("+t.tableau[z]+")' class='buttonv2 h20 blue'>"+lang.Trone.unequip+"</a>";
         }
         }
        } else {
           m+="<td style="+styleez+"><center><i><b>"+lang.Trone.norow+"</b>";
        }
        m+"</td></tr>";
       }
      }

     }
     ById("BOTroneC").innerHTML=m;
     // Equipement
     var effft="",faction={0:'advisor',1:'banner',2:'chair',3:'table',4:'window',5:'trophy'};
     var zz="<center><table width=100%><tr>";
     for (var fp in faction) {
      equip="normal";
      effft="";
      var k=Seed.throne.slotEquip[Seed.throne.activeSlot];
      for (var tt in k) {
      if (uW.kocThroneItems[k[tt]])
       if (uW.kocThroneItems[k[tt]].type==faction[fp]) {
        equip="equip";
        x=0;
        for (var u in uW.kocThroneItems[k[tt]].effects) {
          x++;
          if (uW.kocThroneItems[k[tt]].quality >= x) {
            var ww=uW.cm.thronestats.tiers[uW.kocThroneItems[k[tt]].effects[u].id][uW.kocThroneItems[k[tt]].effects[u].tier];
            var pourc = + ww.base + (uW.kocThroneItems[k[tt]].level * uW.kocThroneItems[k[tt]].level + uW.kocThroneItems[k[tt]].level) * + ww.growth * 0.5;
            pourc = Math.ceil(pourc);
            effft+= pourc + "% " + uW.cm.thronestats.effects[uW.kocThroneItems[k[tt]].effects[u].id][1]+ "&#013;";

            }
        }
       }
      }


      if (equip=="equip") {
              name=faction[fp] +"_"+equip+"_1.png";
              if (faction[fp]=="trophy")
               name=faction[fp]+"_"+equip+"_1_1.png";
             }else{
              name=faction[fp] +"_"+equip+"_1_1.png";
        }

      zz+="<td><img title='"+effft+"' align=absmiddle width=30 src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/30/briton/briton_"+name+"><td>"+faction[fp]+"</td>";
     }
     zz+="</tr></table>";
     ById("BOTroneE").innerHTML=zz;
     ById("BONbArticle").innerHTML= nb + " "+lang.Trone.nbart+" "+ nbbroken +" "+lang.Trone.nbart;
     clearTimeout(t.citystattimer);
     t.citystat();
  },
  citystattimer:null,
  citystat:function() {
   var t = myBO.Trone;
   var zz="<TABLE class=ptTabLined cellspacing=0 style='margin-bottom:1px;'><tr>";
   var zx="";
   clearTimeout(t.citystattimer);

   for(var i=0; i<Cities.numCities; i++) {
      var cityID = 'city'+ Cities.cities[i].id;
            zz += "<TD width=81 align=center><B>"+ Cities.cities[i].name.substring(0,10) +'</b></td>';
            zx += "<TD width=81 align=center><B>"+ addCommas(parseIntNan(Seed.resources[cityID]['rec5'][0])) + "</b></td>";
      }


   zz+="<td><img align=absmiddle width=13 src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20001.jpg'></td>\
   <td><img align=absmiddle width=13 src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20002.jpg'></td>\
   <td><img align=absmiddle width=13 src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20005.jpg'></td>\
   <td><img align=absmiddle width=13 src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20006.jpg'></td></tr><tr>"+zx+"<td>"+uW.ksoItems[20001].count+"</tD><td>"+uW.ksoItems[20002].count+"</tD><td>"+uW.ksoItems[20005].count+"</tD><td>"+uW.ksoItems[20006].count+"</tD>";
   zz+="</table>";

   ById("BOTroneAether").innerHTML=zz;
   t.citystattimer=setTimeout(t.citystat,5000);

  },
  filtreaction: function() {
    var t = myBO.Trone;

     t.filtre15 = ById('BOFiltre15ST').value;
    t.filtre = ById('BOFiltreST').value;
    t.filtre2 = ById('BOFiltre2ST').value;
    t.filtre3 = ById('BOFiltre3ST').value;
    t.filtre4 = ById('BOFiltre4ST').checked;
    t.filtre5 = [];
    for (i=0; i<ById('BOlisteeffets').options.length; i++) {
      if (ById('BOlisteeffets').options[i].selected ) {
         t.filtre5.push(ById('BOlisteeffets').options[i].value);
      }
    }

    t.filtre6 = ById('BOFiltre5ST').value;


    t.filtre7 = ById('BOFiltre7ST').checked;
    t.filtre8 = ById('BOFiltre8ST').value;
    Options.EffetRouge = t.filtre5;
    Options.AllEffet = t.filtre4;
    saveOptions ();
    t.show();

  },
  upgradeQualite:function(id,objet) {
    var t = myBO.Trone;

    var currentcityid = Seed.cities[Options.salvageconfig.CityCity][0];

    var params = uW.Object.clone(uW.g_ajaxparams);
       params.action="upgradeQuality";
       params.ctrl="throneRoom\\ThroneRoomServiceAjax";
       params.throneRoomItemId=id;
       params.buffItemId=objet;
       params.payment="aetherstone";
       params.cityId=currentcityid;
       uW.ajax.Request(uW.g_ajaxpath+"ajax/_dispatch53.php"+uW.g_ajaxsuffix,{method:"post",parameters:params,loading:true,
        onSuccess:function(transport) {
         var m = eval("(" + transport.responseText + ")");
         if (m.ok === true){
          Seed.resources["city" + currentcityid].rec5[0] = Seed.resources["city" + currentcityid].rec5[0] - m.aetherstones;
          if (objet>0) {
           uW.ksoItems[objet].subtract();
          }
          var s = uW.kocThroneItems[id];
          if (m.success) {
           s.quality = m.item.quality;s.level = m.item.level;s.name = s.createName();
          } else {
           s.quality = m.item.quality;s.level = m.item.level;s.name = s.createName();
           if (m.break) {
            s.brokenType = "quality";
            s.isBroken = true;
            s.name = s.createName();
           }
          }
          uW.cm.ThroneView.renderInventory(uW.kocThroneItems);
          t.show();

         }
        }
   });

  },
  upgradeLevel:function(id,objet) {
    var t = myBO.Trone;
        var currentcityid = Seed.cities[Options.salvageconfig.CityCity][0];

        var params = uW.Object.clone(uW.g_ajaxparams);
           params.action="upgradeLevel";
           params.ctrl="throneRoom\\ThroneRoomServiceAjax";
           params.throneRoomItemId=id;
           params.buffItemId=objet;
           params.payment="aetherstone";
           params.cityId=currentcityid;
           uW.ajax.Request(uW.g_ajaxpath+"ajax/_dispatch53.php"+uW.g_ajaxsuffix,{method:"post",parameters:params,loading:true,
            onSuccess:function(transport) {
             var m = eval("(" + transport.responseText + ")");
             if (m.ok === true){
              Seed.resources["city" + currentcityid].rec5[0] = Seed.resources["city" + currentcityid].rec5[0] - m.aetherstones;
              if (objet>0) {
	                 uW.ksoItems[objet].subtract();
          }
                        var s = uW.kocThroneItems[id];
	                if (m.success) {
	                 s.quality = m.item.quality;s.level = m.item.level;s.name = s.createName();
	                } else {
	                 s.quality = m.item.quality;s.level = m.item.level;s.name = s.createName();
	                 if (m.break) {
	                  s.brokenType = "level";
	                  s.isBroken = true;
	                  s.name = s.createName();
	                 }
	                }
	                uW.cm.ThroneView.renderInventory(uW.kocThroneItems);
          		t.show();
             }
            }
   });

  },
  Repair:function(id) {
   var t = myBO.Trone;
   var params = uW.Object.clone(uW.g_ajaxparams);
   params.action="timeRepair";
   params.ctrl="throneRoom\\ThroneRoomServiceAjax";
   params.throneRoomItemId=id;
   uW.ajax.Request(uW.g_ajaxpath+"ajax/_dispatch53.php"+uW.g_ajaxsuffix,{method:"post",parameters:params,loading:true,
    onSuccess:function(transport) {
     var m = eval("(" + transport.responseText + ")");
     if (m.ok === true){
      Seed.queue_throne.start = uW.unixtime();
      Seed.queue_throne.end = m.eta;
      Seed.queue_throne.itemId = id;
      uW.kocThroneItems[id].isBroken = false;
      unsafeWindow.cm.ThroneView.renderInventory(unsafeWindow.kocThroneItems);
      t.show();
     }
    }
   });

  },
  equipItem: function(id) {
   var t = myBO.Trone;
    var params = uW.Object.clone(uW.g_ajaxparams);
   params.action="equipItem";
   params.ctrl="throneRoom\\ThroneRoomServiceAjax";
   params.itemId=id;
   params.presetId=Seed.throne.activeSlot;
   uW.ajax.Request(uW.g_ajaxpath+"ajax/_dispatch53.php"+uW.g_ajaxsuffix,{method:"post",parameters:params,loading:true,
    onSuccess:function(transport) {
     var m = eval("(" + transport.responseText + ")");
     if (m.ok === true){
      uW.cm.ThroneView.clickItemEquip(uW.kocThroneItems[id]);
      t.show();
     }
    }
   });
  },
  UnequipItem: function(id) {
     var t = myBO.Trone;
      var params = uW.Object.clone(uW.g_ajaxparams);
     params.action="unequipItem";
     params.ctrl="throneRoom\\ThroneRoomServiceAjax";
     params.itemId=id;
     params.presetId=Seed.throne.activeSlot;
     uW.ajax.Request(uW.g_ajaxpath+"ajax/_dispatch53.php"+uW.g_ajaxsuffix,{method:"post",parameters:params,loading:true,
      onSuccess:function(transport) {
       var m = eval("(" + transport.responseText + ")");
       if (m.ok === true){
        uW.cm.ThroneView.clickItemUnequip(uW.kocThroneItems[id]);
        t.show();
       }
      }
     });
  },
  salvage: function(id) {
   var t = myBO.Trone;

   if (uW.kocThroneItems[id].level>0) {
    var a=confirm("Etes-vous sur ?");
    if (!a) return;
   }

    var params = uW.Object.clone(uW.g_ajaxparams);
   params.action="salvage";
   params.ctrl="throneRoom\\ThroneRoomServiceAjax";
   params.itemId=id;
   params.cityId=Seed.cities[Options.salvageconfig.CityCity][0];
   uW.ajax.Request(uW.g_ajaxpath+"ajax/_dispatch53.php"+uW.g_ajaxsuffix,{method:"post",parameters:params,loading:true,
    onSuccess:function(transport) {
     var m = eval("(" + transport.responseText + ")");
     if (m.ok){

      uW.kocThroneItems[id].salvage();
      t.show();
     }else{

     }
    }
   });
  }
}

/*********************************** Test TAB ***********************************/
myBO.Test = {
  tabOrder: 25,
  tabDisabled : false,
  tabLabel : 'Test',
  myDiv : null,
  cont : null,

  init : function (){    // called once, upon script startup
    this.myDiv = document.createElement('div');
    return this.myDiv;
  },

  hide : function (){
    var t = myBO.Test;
  },
  getContent : function (){
      return myBO.Test.myDiv;
  },
  show : function (){
     var t = myBO.Test;
     t.cont = this.myDiv;
     var citySelect = '   <SELECT id=fakeCity>';
     	    for (var c=0; c<Cities.numCities; c++) {
     		 	 aCity = Cities.cities[c].name + ' ('+Cities.cities[c].x + ','+ Cities.cities[c].y+')';
     	         citySelect += '<option value=\''+c+'\'>'+aCity+'</option>';
     	    }
	    citySelect += '</select>';


  var m = '<DIV class=boStat><b>'+lang.fake.title+'</b></div><TABLE><TR><TD align=right>'+uW.g_js_strings.commonstr.scouting+'</td><TD><INPUT type=checkbox id=fakeIsScout></td><TD align=right>'+uW.g_js_strings.commonstr.wilderness+'</td><TD><INPUT type=checkbox id=fakeIsWild></td></tr>\
        <TR><TD colspan=2 align=right>'+lang.fake.duration+' ('+lang.General.secs+') : </td><TD><INPUT type=text size=4 value=300 id=fakeSeconds></td></tr>\
        <TR><TD align=right><img height=18 title="'+uW.unitcost['unt1'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_30_s34.jpg></td><TD><INPUT type=text size=6 value=0 id=faketroop0></td><TD align=right><img height=18 title="'+uW.unitcost['unt2'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_30_s34.jpg></td><TD><INPUT type=text size=6 value=1 id=faketroop1></td></tr>\
	<TR><TD align=right><img height=18 title="'+uW.unitcost['unt3'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_30_s34.jpg></td><TD><INPUT type=text size=6 value=0 id=faketroop2></td><TD align=right><img height=18 title="'+uW.unitcost['unt4'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_30_s34.jpg></td><TD><INPUT type=text size=6 value=0 id=faketroop3></td></tr>\
	<TR><TD align=right><img height=18 title="'+uW.unitcost['unt5'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_30_s34.jpg></td><TD><INPUT type=text size=6 value=0 id=faketroop4></td><TD align=right><img height=18 title="'+uW.unitcost['unt6'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_30_s34.jpg></td><TD><INPUT type=text size=6 value=0 id=faketroop5></td></tr>\
	<TR><TD align=right><img height=18 title="'+uW.unitcost['unt7'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_30_s34.jpg></td><TD><INPUT type=text size=6 value=0 id=faketroop6></td><TD align=right><img height=18 title="'+uW.unitcost['unt8'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_30_s34.jpg></td><TD><INPUT type=text size=6 value=0 id=faketroop7></td></tr>\
	<TR><TD align=right><img height=18 title="'+uW.unitcost['unt9'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_30_s34.jpg></td><TD><INPUT type=text size=6 value=0 id=faketroop8></td><TD align=right><img height=18 title="'+uW.unitcost['unt10'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_30_s34.jpg></td><TD><INPUT type=text size=6 value=0 id=faketroop9></td></tr>\
	<TR><TD align=right><img height=18 title="'+uW.unitcost['unt11'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_30_s34.jpg></td><TD><INPUT type=text size=6 value=0 id=faketroop10></td><TD align=right><img height=18 title="'+uW.unitcost['unt12'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_30_s34.jpg></td><TD><INPUT type=text size=6 value=0 id=faketroop11></td></tr>\
	<TR><TD align=right>'+uW.g_js_strings.commonstr.attacker+'</td><TD><INPUT type=text size=13 value="Kabam!" id=fakeName></td><td align=right>'+uW.g_js_strings.commonstr.might+'</td><td><INPUT type=text size=13 value="5441192" id=fakeMight></td></tr>\
	<TR><TD align=right>'+uW.g_js_strings.commonstr.target+'</td><TD>'+citySelect+'</td><td><INPUT id=testSendMarch type=submit value="'+lang.fake.fakeatk+'" \></td></tr>';
   m+='</td></tr></table><br><hr>Autres Options :<br><INPUT id=ptReloadKOC type=submit value="'+lang.fake.reloadkoc+'" \><hr></span><BR><DIV id=testDiv style="background-color:#fffff0; maxwidth:675; max-height:30px; height:0px; overflow-y:auto;"></div>';
    t.cont.innerHTML = m;

     ById('testSendMarch').addEventListener ('click', t.clickFakeAttack, false);
    ById('ptReloadKOC').addEventListener ('click', t.reloadKOC, false);

    function xyNotify(city, x, y){
      var m = '[ Notified: '+ (city?city.name:'null') +', x='+ x +', y='+ y +' ]';
      ById('testNotify').innerHTML = m;
    }

  },
  writeDiv : function (msg){
    var t = myBO.Test;
    if (t.state != null)
    ById('testDiv').innerHTML = msg;
  },

  addDiv : function (msg){
    var t = myBO.Test;
    if (t.state != null)
    ById('testDiv').innerHTML += msg;
  },

  reloadKOC : function (){

      reloadKOC();
  },

  createFakeAttack : function (cityNum, isScout, isWild, isFalse, secs, troops, name, might){
     var marchId = 'm'+ (88888 + Math.floor(Math.random()*11111));
     var march = {};
     if (matTypeof(Seed.queue_atkinc)=='array')
       Seed.queue_atkinc = {};
     if (isFalse)
       march.marchType = 0;
     else if (isScout)
       march.marchType = 3;
     else
       march.marchType = 4;

     march.toCityId = Cities.cities[cityNum].id;
     if (isWild) {
       keys = unsafeWindow.Object.keys(Seed.wilderness['city'+Cities.cities[cityNum].id]);
       march.toTileId = Seed.wilderness['city'+Cities.cities[cityNum].id][keys[0]].tileId;
     } else {
       march.toTileId = Cities.cities[cityNum].tileId;
     }
     secs = parseInt(secs);
     march.arrivalTime = unixTime() + secs;
     march.departureTime = unixTime() - 10;
      march.unts = {}
 	for(i=0; i<12; i++){
 	  if(troops[i] > 0)
 		march.unts["u"+(i+1)] = addCommas(troops[i]);
 	}
     march.pid = 1234567;
     march.score = 9;
     march.mid = marchId.substr(1);
     march.players = {}
     march.players.u1234567 = {}
     march.players.u1234567.n = name;
     march.players.u1234567.t = 60;
     march.players.u1234567.m = might;
     march.players.u1234567.s = 'M';
     march.players.u1234567.w = 1;
     march.players.u1234567.a = 1;
     march.players.u1234567.i = 5;
     Seed.queue_atkinc[marchId] = march;
     Seed.players.u1234567 = march.players.u1234567;
   },

   clickFakeAttack : function (){
     var t = myBO.Test;
     var isScout = ById('fakeIsScout').checked;
     var isWild = ById('fakeIsWild').checked;
     var isFalse = false;
 	var troops = [];
 	for(i=0; i<12; i++)
 		troops[i] = parseInt(ById('faketroop'+i).value);
     var secs = parseInt(ById('fakeSeconds').value);
 	var name = ById('fakeName').value;
 	var city = ById('fakeCity').value;
 	var might = ById('fakeMight').value;
     t.createFakeAttack (city, isScout, isWild, isFalse, secs, troops ,name,might);
   },
}

/********************************* RESUME ***********************************/

Tabs.Overview = {
  tabOrder: 1,
  tabLabel: lang.BoiteLabelResume,
  myDiv: null,

  displayTimer : null,
  checkBox:null,
  defMode : {},
  checkBox1:null,
  Overview : function (){
  },

  init : function (div){

    var t = Tabs.Overview;
    unsafeWindow.BOCrafting = t.Crafting;
    unsafeWindow.BOCraftingItem = t.CraftingItem;
    t.myDiv = div;
    var str= '<div id="BOResumeDIV" style="height:' + (Options.HauteurBoite-30) +'px;max-height:' + (Options.HauteurBoite-30) +'px;overflow-y:auto"></div>';
    t.myDiv.innerHTML = str;
    t.BOResumeDIV = ById("BOResumeDIV");

  },

  getContent : function (){

  },

  hide : function (){
   var t = Tabs.Overview;
    clearTimeout (t.displayTimer);
  },
 show : function (){
   var t = Tabs.Overview;
   clearTimeout (t.displayTimer);
   t.setContent();
 },
 CraftingItem: function (obj, currentcity, itemId, recipeId, categoryId) {
  var t = Tabs.Overview;
  if (obj) obj.value="Crafting...";
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.action="craft";
        params.ctrl="Crafting";
        params.cityId=currentcity;
        params.insurance=false;
 	params.itemId=itemId;
 	params.recipeId=recipeId;
 	params.categoryId=categoryId;

        new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
                      method: "post",
       		    parameters: params,
      	onSuccess: function (transport) {
          var o=eval("("+transport.responseText+")");
          if(o.ok===true){
           if (o.status=="error") {
            //alert("Erreur crafting : " + o.errorMessage);
            if (obj) obj.value="Craft";
           } else if(o.status=="failure"){
	     //alert("Echec crafting !");
	     if (obj) obj.value="Craft - try again";
	   } else if (o.status=="success"){
	     if (obj) obj.value="Craft OK";
		//if(!Seed.queue_craft["city"+currentcity]) {
		 Seed.queue_craft["city"+currentcity]=[];
		//}
     		var n={};

     		n.recipeId=recipeId;
     		n.craftingUnixTime=o.time.startTime;
     		n.craftingEtaUnixTime=o.time.endTime;
     		n.craftingId=o.craftingId;
     		n.categoryId=null;
     		n.recipeIndex=null;
     		unsafeWindow.seed.queue_craft["city"+currentcity].push(n);
     		setTimeout(function() { t.Crafting(currentcity); },1000);
     	  }
        }

        },
         onFailure: function () {          t.Crafting(currentcity);         }
        });
 },
 Crafting: function(currentcity) {
  var t = Tabs.Overview;
   var messagebody ="", ReciId=0, catId=0;
   var ret=getCityBuilding(currentcity,20).count;
   if (ret>0) {
     var texte="";
     var i=Seed.queue_craft["city"+currentcity];
     if(i.length>0) {
      var q=i[0];
      var totTime = 0;
      var now = unixTime();
      totTime = q.craftingEtaUnixTime - now;
      if (totTime > 0) {
         texte= "Reste " + timestr(totTime);
         ReciId=q.recipeId;
         catId=q.categoryId;
      }
     }
     messagebody += "<TABLE width=95% border=0 align=center class=ptTab>";
     messagebody += "<tr style='background-Color:#AAA;'><td colspan=2><b>"+uW.g_js_strings.commonstr.items+"</td><td><b>"+lang.Overview.col1+"</td><td><b>"+lang.Overview.col2+"</td><td><b>"+uW.g_js_strings.commonstr.requirements+"</td></tr>";

     for (ZZ in uW.recipelist) {
     for(var i=0; i < uW.recipelist[ZZ].length; i++){
       var h = parseInt(uW.recipelist[ZZ][i].output_item_id);
       var recipe_id = uW.recipelist[ZZ][i].recipe_id;
       var category = uW.recipelist[ZZ][i].category;
       var qte=0;
       if (parseInt(Seed.items["i"+h])>0) qte=parseIntNan(Seed.items["i"+h]);
            messagebody += "<tr><td colspan=2><img src='http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/"+ h + ".jpg' width=25>&nbsp;"+uW.itemlist["i"+h].name+"</td><td><center><b>"+qte+"</td>";
 	if (texte!="") {
 	   if (ReciId==recipe_id && catId==category) {
 	     messagebody += "<td><b><i>"+texte+"</td>";
 	   }else {
	           messagebody += "<td>&nbsp;</td>";
	           }
	 }     else
         messagebody += "<td><input type=button value='Craft' onclick='BOCraftingItem(this,"+currentcity+","+h+","+recipe_id+","+category+")'></td>";
         messagebody += "<td>"+ uW.recipelist[ZZ][i].input.resources[1] + " Ether<bR>";
        for (k in uW.recipelist[ZZ][i].input.items) {
         if (uW.itemlist["i"+k])
          messagebody += uW.recipelist[ZZ][i].input.items[k] + "/"+parseIntNan(Seed.items["i"+k])+" " + uW.itemlist["i"+k].name+"<br>";
       }


        messagebody += "</td></tr>"
      }

     }

       messagebody+="</table>";

  } else {
   messagebody += "<center>"+lang.Overview.nofey+"</center>";
  }
  if (t.BOPopCrafting == null) {
     	t.BOPopCrafting = new CPopup('BOPopCrafting', 0, 0, 560, 700, true, function() {clearTimeout (1000);});
     	t.BOPopCrafting.centerMe (mainPop.getMainDiv());
     	}
     	var m = '<DIV style="max-height:665px; height:665px; overflow-y:scroll">';
     	m+= messagebody + '</div>';
     	t.BOPopCrafting.getMainDiv().innerHTML = m;
     	t.BOPopCrafting.getTopDiv().innerHTML = '<DIV align=center><B>'+lang.Overview.titlefey+'</B></DIV>';
	t.BOPopCrafting.show(true);

 },

 setContent : function (){

    var t = Tabs.Overview;
    var rownum = 0;
    var totalentre = 0;
    function UniteFormation(id) {
     var nbunit=0; //
     for(i=0; i<Cities.numCities; i++) {
      var cityIdd = Cities.cities[i].id;
      var q = Seed.queue_unt['city'+cityIdd];
      var qs = q.toString();
       if (q!=null && q.length>0 ){
        for (var ii=0; ii<q.length; ii++){
         if (q[ii][0]==id) nbunit+=parseIntNan(q[ii][1]);

        }
      }
      }
      totalentre += parseIntNan(nbunit*UniteCout(id));
      return nbunit;
    }
    function UniteCout(id) {
      var Unitcout=parseIntNan(uW.unitupkeeps[id]);
      return Unitcout;
    }

    function _row (name, row, noTotal, typee){
      if (rownum++ % 2)
        style = '';
      else
        style = ' style = "background: #e8e8e8"';
      var tot = 0;
      var m = [];
      m.push ('<TR style="background: #fff" align=right');
      m.push (style);
      m.push ('><TD');
      m.push (style);
      m.push ('><B>');
      m.push (name);
      m.push ('</td>');
      if (noTotal){
        m.push ('<TD');
        m.push (style);
        m.push ('>&nbsp;</td>');
      } else {
        for (i=0; i<row.length; i++)
          tot += row[i];
        m.push ('<TD style="background: #ffc">');
         if (tot<0) {
              m.push ("<SPAN class=boldRed>"+UniteKMG(tot)+"</span>");
         } else {
	   if (typee>0 || !Options.EnableReduireUnit)
	    m.push (addCommas(tot));
           else
            m.push (UniteKMG(tot));
         }
        m.push ('</td>');
      }
      for (i=0; i<row.length; i++){
        m.push ('<TD');
        m.push (style);
        m.push ('>');
        if (typee>0 || !Options.EnableReduireUnit)
         m.push (addCommas(row[i]));
        else
         m.push (UniteKMG(row[i]));
        m.push ('</td>');
      }
      if (Options.EnableFormation && typee>0) {
       m.push ('<td>'+addCommas(UniteFormation(typee))+'</td>');
      }
      if (Options.EnableFormation && name=='Form') {
         if (!Options.EnableReduireUnit)
          m.push("<td>&nbsp;</td><td>" + addCommas(totalentre) + "</td>");
         else
          m.push("<td>&nbsp;</td><td>" + UniteKMG(totalentre) + "</td>");
      }
      m.push ('</tr>');
      return m.join('');
    }


    try {
      if (Options.includeMarching)
        march = getMarchInfo ();

      dt = new Date ();
      dt.setTime (Seed.player.datejoinUnixTime * 1000);

      str = '<DIV class=boStat style="margin-top:4px; margin-bottom:5px; "><TABLE cellspacing=0 class=ptTab cellpadding=0 width=98% align=center>\
        <TR align=left><TD align=center><input type=button value="?" id=boaideresume class=boAide> ' + uW.domainName +'</td><TD align=center><SPAN class=boStatLight>'+lang.Overview.opendate+'</span><br>'+ dt.toLocaleDateString() +'</td>\
        <TD align=center><SPAN class=boStatLight>Alliance</span><br>' + getMyAlliance()[1] +'</td>\
        <TD align=center><SPAN class=boStatLight>'+uW.g_js_strings.commonstr.might+'</span><br>' + addCommas(Seed.player.might) +'</td>\
        <TD align=center><SPAN class=boStatLight>'+uW.g_js_strings.commonstr.glory+'</span><br><span title="Max : ' + addCommas(Seed.player.maxGlory) +'">' + addCommas(Seed.player.glory) +'</span></td>\
        <TD align=center><SPAN class=boStatLight>'+uW.g_js_strings.commonstr.throneroom+'<br>'+addCommas(uW.cm.ThroneController.calcMight())+'</span></td>\
        </tr></table></div>';

      str += "<DIV id=overMainDiv style='font-size:10px;padding:5px'><TABLE class=ptTabOverview cellpadding=0 cellspacing=0><TR  align=center><TD width=45 align=center></td><TD width=88 style='background: #ffc; font-size:150%' align=center><SPAN class=oohfancy>"+lang.Overview.sum+"</SPAN></td>";
      for(i=0; i<Cities.numCities; i++) {
         cityID = 'city'+ Cities.cities[i].id;
         Gate = parseInt(Seed.citystats[cityID].gate);
	 if(Gate == 0) var couleurr="#77EE77";
         if(Gate != 0) var couleurr="#EE7777";

         str += "<TD width=80 style='background-color:"+couleurr+"'><SPAN class=oohfancy>"+ Cities.cities[i].name.substring(0,10) +"</SPAN><BR><a href='javascript:void(0)' onclick='cm.utils.CoordinateLinkController.onClick(event)' class='coordinateLink'>("+Cities.cities[i].x +","+ Cities.cities[i].y+")</a><BR>"+ unsafeWindow.provincenames['p'+ Cities.cities[i].provId] +"</td>";

      }

      if (Options.includeMarching)
        str += '<TD width=81><B>'+lang.Overview.includeMarching+'</b></td>';
      if (Options.EnableFormation)
       str += '<TD width=81><B>'+lang.Overview.EnableFormation+'</b></td>';

      str += "<td></td></tr>";
      str += "<tr><td>&nbsp;</td><td></td>";

      for (var cityId in Cities.byID)
      		str += '<TD align=center><INPUT type=submit id=BOtabut_'+ cityId +' value=""></td>';
      str += '</tr>';

      if (Options.enableGuardians) {
      str += "<tr><td>&nbsp;</td><td></td>";
      for (var cityId in Cities.byID) {
       var typeg="No";
       var mm=Seed.guardian;
       for (var ii in mm) {
        var ww = mm[ii];
        if (ww.cityId==cityId) {
            typeg = ww.type;
            selectg="";
            for (var z in ww.cityGuardianLevels) {
             if (ww.cityGuardianLevels[z]>0) {
             if (typeg==z)
              selectg+="<img width=18 style='border:1px solid RED' src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/chrome_icon_"+z+".png value='"+z+"' title='"+z+" Level "+ww.cityGuardianLevels[z]+"'>";
             else
              selectg+="<img width=18 id='BoG_"+cityId+"_"+z+"' src=https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/chrome_icon_"+z+".png value='"+z+"' title='"+z+" Level "+ww.cityGuardianLevels[z]+"'>";
             }

            }

        }
       }
       str += '<TD align=center>'+selectg+'</td>';
      }
      str += '</tr>';
      }

      rows = [];
      rowsnm = [];
      rows[0] = [];
     // Ressources
     if (Options.showRes) {
      for(i=0; i<Cities.numCities; i++) {
        cityID = 'city'+ Cities.cities[i].id;
        rows[0][i] = parseInt(Seed.citystats[cityID].gold[0]);
      }
      for (r=1; r<6; r++){
        rows[r] = [];
        for(i=0; i<Cities.numCities; i++) {
          cityID = 'city'+ Cities.cities[i].id;
          if (r==5)
           rows[r][i] = parseInt(Seed.resources[cityID]['rec'+r][0]);
          else
           rows[r][i] = parseInt(Seed.resources[cityID]['rec'+r][0] / 3600);

        }

      }

      if (Options.includeMarching){
        for (var i=0; i<6; i++)
          rows[i][Cities.numCities] = parseIntNan(march.resources[i]);
      }
      str += _row ('<img height=18 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/gold_30.png>', rows[0], false, 0);
      str += _row ('<img height=18 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/food_30.png>', rows[1], false, 0);
      str += _row ('<img height=18 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/wood_30.png>', rows[2], false, 0);
      str += _row ('<img height=18 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/stone_30.png>', rows[3], false, 0);
      str += _row ('<img height=18 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/iron_30.png>', rows[4], false, 0);
      str += _row ('<img height=18 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/aetherstone_30.png>', rows[5], false, 0);

      if (Options.showProduction) {

          str += '<TR><TD><BR></td></tr>';

          row = [];
            for(i=0; i<Cities.numCities; i++) {
                        var rp = getResourceProduction (Cities.cities[i].id);
                        row[i] = rp[1];
            }
            str += _row ('<img height=18 title="'+lang.Overview.prodfood+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/food_30.png>', row, false, 0);
          row = [];
                  for(i=0; i<Cities.numCities; i++) {
                              var rp = getResourceProduction (Cities.cities[i].id);
                              row[i] = rp[2];
                  }
                  str += _row ('<img height=18 title="'+lang.Overview.prodwood+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/wood_30.png>', row, false, 0);

       row = [];
            for(i=0; i<Cities.numCities; i++) {
                        var rp = getResourceProduction (Cities.cities[i].id);
                        row[i] = rp[3];
            }
            str += _row ('<img height=18 title="'+lang.Overview.prodstone+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/stone_30.png>', row, false, 0);

       row = [];
            for(i=0; i<Cities.numCities; i++) {
                        var rp = getResourceProduction (Cities.cities[i].id);
                        row[i] = rp[4];
            }
        str += _row ('<img height=18 title="'+lang.Overview.prodore+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/iron_30.png>', row, false, 0);

      }


     }

         str += '<TR><TD style="font-size:6px"><BR></td></tr>';
	            row = [];
	            var totalbouffe = 0;
	            for(i=0; i<Cities.numCities; i++) {
	              var rp = getResourceProduction (Cities.cities[i].id);
	              //var usage = parseIntNan(Seed.resources["city" + Cities.cities[i].id]['rec1'][3]);
	              row[i] = rp[1];
	            }
	            //str += _row ('Prod', row, false,  0);

	            for(i=0; i<Cities.numCities; i++) {
	              if (row[i] >= 0)
	                row[i] = '----';
	              else {
	                var timeLeft = parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][0]) / 3600 / (0-row[i]) * 3600;
	                if (timeLeft > 86313600)
	                  row[i] = '----';
	                else {
	                  if (Options.enableFoodWarn && timeLeft<(Options.foodWarnHours*3600))
	                    row[i] = '<SPAN class=whiteOnRed><blink>'+ timestrShort(timeLeft) +'</blink></span>';
	                  else
	                    row[i] = timestrShort(timeLeft);
	                }
	              }
	            }
      str += _row (lang.Overview.auton, row, true, 0);


            var now = unixTime();
            str += '<TR><TD style="font-size:6px"><BR></font></td></tr>';
            str +='<tr style="background: #fff" align=right><td><img height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/131.jpg title="'+uW.g_js_strings.commonstr.buildings+'"></td><td>&nbsp;</td>';
            for(i=0; i<Cities.numCities; i++) {
             var totTime = 0;
             if (Seed.queue_con["city" + Cities.cities[i].id].length > 0) {
              var q=Seed.queue_con["city" + Cities.cities[i].id][0];
              var totTime = 0;
              totTime = q[4] - now;
              if (totTime < 0)
                totTime = 0;
              if (totTime < 3600)
                affuichage = '<SPAN class=boldRed><B>'+ timestr(totTime) +'</b></span>';
              else
                affuichage = timestr(totTime);
              str +="<td>"+ affuichage + "</td>";
             } else {
             str +="<td>0s</td>";
             }
            }
            str +="</tr>";
            //
            str +='<tr style="background: #e8e8e8" align=right><td><img height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/1.jpg title="'+uW.g_js_strings.commonstr.technology+'"></b></td><td>&nbsp;</td>';
            for(i=0; i<Cities.numCities; i++) {
             var totTime = 0;
             if (Seed.queue_tch["city" + Cities.cities[i].id].length > 0) {
              var q=Seed.queue_tch["city" + Cities.cities[i].id][0];
              var totTime = 0;
              totTime = q[3] - now;
              if (totTime < 0)
                totTime = 0;
              if (totTime < 3600)
                affuichage = '<SPAN class=boldRed><B>'+ timestr(totTime) +'</b></span>';
              else
                affuichage = timestr(totTime);

              str +="<td>"+ affuichage + "</td>";

             } else {
             str +="<td>0s</td>";
             }
            }
             str +="</tr>";
      // crafting
          str +='<tr style="background: #e8e8e8" align=right><td><img height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/3.jpg title="Crafting"></b></td><td>&nbsp;</td>';
            for(i=0; i<Cities.numCities; i++) {
             var totTime = 0;
             if (Seed.queue_craft["city" + Cities.cities[i].id].length > 0) {
              var q=Seed.queue_craft["city" + Cities.cities[i].id][0];
              var totTime = 0;
              totTime = q.craftingEtaUnixTime - now;
              if (totTime < 0)
                totTime = 0;
              if (getCityBuilding(Cities.cities[i].id,20).count>0 && totTime == 0)
                affuichage = '<SPAN class=boldRed><B>'+ timestr(totTime) +'</b></span>';
              else
                affuichage = timestr(totTime);

              str +="<td><span onclick='BOCrafting("+Cities.cities[i].id+");'>"+ affuichage + "</span></td>";

             } else {
             affuichage = timestr(totTime);
             if (getCityBuilding(Cities.cities[i].id,20).count>0)
                affuichage = '<SPAN class=boldRed><B>'+ timestr(totTime) +'</b></span>';

             str +="<td><span onclick='BOCrafting("+Cities.cities[i].id+");'>"+affuichage+"</span></td>";
             }
            }
             str +="</tr>";
             // Reviving
            str +='<tr style="background: #e8e8e8" align=right><td><img height=20 src="'+URL_HOSPITAL+'" title="'+uW.g_js_strings.revive.trainttl+'"></b></td><td>&nbsp;</td>';
            for(i=0; i<Cities.numCities; i++) {
             var totTime = 0;
             var ah=Seed.queue_revive["city" + Cities.cities[i].id];
             var l=0;
             if (ah) {
              for(var an=0;an<Math.min(ah.length,1);an++){
                 var P=uW.unixtime();
                 l=parseInt(ah[an][3])-P;
              }
              var totTime = 0;
              totTime = parseIntNan(l);
              if (totTime < 0)
                totTime = 0;
                affuichage = timestr(totTime);

              str +="<td><span>"+ affuichage + "</span></td>";

             } else {
             affuichage = timestr(totTime);

             str +="<td><span>"+affuichage+"</span></td>";
             }
            }
             str +="</tr>";



      // Population

      if (Options.showPop) {
       str += '<TR><TD style="font-size:6px"><BR></td></tr>';

              for (r=0; r<7; r++){
                rowsnm[r] = [];
              }
              for(i=0; i<Cities.numCities; i++) {
                cityID = 'city'+ Cities.cities[i].id;
                rowsnm[0][i] = parseIntNan(Seed.citystats[cityID]["pop"][1]);
                rowsnm[1][i] = parseIntNan(Seed.citystats[cityID]["pop"][0]);
                rowsnm[2][i] = parseIntNan(Seed.citystats[cityID]["pop"][3]);
                rowsnm[5][i] = parseIntNan(Seed.citystats[cityID]["pop"][2]);
                if (rowsnm[5][i] < 100)
		                  rowsnm[5][i] = '<SPAN class=boldRed>' + rowsnm[5][i] + '</SPAN>';
                rowsnm[3][i] = rowsnm[0][i] * rowsnm[5][i] / 100 - rowsnm[2][i];
                rowsnm[4][i] = rowsnm[1][i] - rowsnm[2][i];
                rowsnm[6][i] = parseIntNan(Seed.citystats[cityID]["gold"][1]);
                if (rowsnm[6][i] > 0)
                  rowsnm[6][i] = '<SPAN class=boldRed>' + rowsnm[6][i] + '</SPAN>';
              }

              rownum = 0;
              str += _row ('<span class=pdxCapShadowSG>'+lang.Overview.pop1+'</span>',  rowsnm[0]);
              str += _row ('<span class=pdxCapShadowSG>'+lang.Overview.pop2+'</span>',  rowsnm[1]);
              str += _row ('<span class=pdxCapShadowSG>'+lang.Overview.pop3+'</span>',  rowsnm[2]);
              str += _row ('<span class=pdxCapShadowSG>'+lang.Overview.pop4+'</span>', rowsnm[3]);
              str += _row ('<span class=pdxCapShadowSG>'+lang.Overview.pop5+'</span>', rowsnm[4]);
              str += _row ('<span class=pdxCapShadowSG><img height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/happiness.png title="'+uW.g_js_strings.commonstr.happiness+'"></span>',  rowsnm[5], true);
        str += _row ('<span class=pdxCapShadowSG><img height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/taxes.png title="'+uW.g_js_strings.changeTax.taxrate+'"></span>', rowsnm[6], true);
      }



      // Troupes
      if (Options.showTroops) {

      str += '<TR><TD style="font-size:6px"><BR></td></tr>';
      for (r=1; r<13; r++){
        rows[r] = [];
        for(i=0; i<Cities.numCities; i++) {
          cityID = 'city'+ Cities.cities[i].id;
          rows[r][i] = parseInt(Seed.units[cityID]['unt'+r]);
        }
      }
      if (Options.includeMarching){
        for (var i=0; i<13; i++)
          rows[i][Cities.numCities] = parseIntNan(march.marchUnits[i]);
      }
      rownum = 0;
      this.totalentre = 0;
      for (r=1; r<13; r++){
       str += _row ('<img height=18 title="'+unsafeWindow.unitcost['unt'+r][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_'+r+'_30_s34.jpg>', rows[r],false, r);
      }

      }

      var row = [];
            for(i=0; i<Cities.numCities; i++) {
              var totTime = 0;
              var q = Seed.queue_unt['city'+Cities.cities[i].id];
              if (q!=null && q.length>0)
                totTime = q[q.length-1][3] - now;
              if (totTime < 0)
                totTime = 0;
              if (totTime < 86400)
                row[i] = '<SPAN class=boldRed><B>'+ timestr(totTime) +'</b></span>';
              else
                row[i] = timestr(totTime);
            }
      str += _row (lang.Overview.EnableFormation, row, true, 0);

           // Defenses du remparts
            if (Options.showDefense) {
             str += '<TR><TD style="font-size:6px"><BR></td></tr>';
             owsnm = [];
                     for (r=0; r<5; r++){
                       rowsnm[r] = [];
                     }
                     for(i=0; i<Cities.numCities; i++) {
                       var wall = {};
                       getWallInfo (Cities.cities[i].id, wall);
                       rowsnm[0][i] = parseIntNan(wall.Crossbows);
                       rowsnm[1][i] = parseIntNan(wall.Trebuchet);
                       rowsnm[2][i] = parseIntNan(wall.Caltrops);
                       if (isNaN(parseInt(wall.SpikedBarrier))) // KoC bug if wall lvl 0
                         rowsnm[3][i] = 0;
                       else
                       rowsnm[3][i] = parseIntNan(wall.SpikedBarrier);
                       rowsnm[4][i] = parseIntNan(wall.Trap);
                     }
                     if (Options.defBau){
                       var q = Seed.queue_unt;
                       for(i=0; i<Cities.numCities; i++) {
                         var q = Seed.queue_fort['city'+Cities.cities[i].id];
                         if (q && q.length>0){
                           for (qi=0; qi<q.length; qi++) {
                             if (q[qi][0]==53)
                               rowsnm[0][i] += parseIntNan(q[qi][1]);
                             if (q[qi][0]==55)
                               rowsnm[1][i] += parseIntNan(q[qi][1]);
                             if (q[qi][0]==60)
                               rowsnm[4][i] += parseIntNan(q[qi][1]);
                             if (q[qi][0]==61)
                               rowsnm[2][i] += parseIntNan(q[qi][1]);
                             if (q[qi][0]==62)
                               rowsnm[3][i] += parseIntNan(q[qi][1]);
                           }
                         }
                       }
                     }

                     rownum = 0;
                     str += _row ('<span class=pdxCapShadowSG><img height=18 title="'+uW.fortcost.frt53[0]+'" src="http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_53_30.jpg"></span>',  rowsnm[0]);
                     str += _row ('<span class=pdxCapShadowSG><img height=18 title="'+uW.fortcost.frt55[0]+'" src="http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_55_30.jpg"></span>',  rowsnm[1]);
                     str += _row ('<span class=pdxCapShadowSG><img height=18 title="'+uW.fortcost.frt60[0]+'" src="http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_60_30.jpg"></span>',  rowsnm[4]);
                     str += _row ('<span class=pdxCapShadowSG><img height=18 title="'+uW.fortcost.frt61[0]+'" src="http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_61_30.jpg"></span>', rowsnm[2]);
                     str += _row ('<span class=pdxCapShadowSG><img height=18 title="'+uW.fortcost.frt62[0]+'" src="http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/units/unit_62_30.jpg"></span>',  rowsnm[3]);
      }


      var row = [];
      for(i=0; i<Cities.numCities; i++) {
        var wall = {};
        getWallInfo (Cities.cities[i].id, wall);
        var totTime = 0;
        var q = Seed.queue_fort['city'+Cities.cities[i].id];
        if (q!=null && q.length>0)
          totTime = q[q.length-1][3] - now;
        if (totTime < 0)
          totTime = 0;
        if (totTime<1 && (wall.wallSpaceUsed < wall.wallSpace-4 || wall.fieldSpaceUsed < wall.fieldSpace-4))
          row[i] = '<SPAN class=boldRed><B>'+ timestr(totTime) +'</b></span>';
        else
          row[i] = timestr(totTime);
      }


      str += _row (lang.Overview.def, row, true, 0);

      str += '<TR><TD style="font-size:6px"><BR></td></tr>';

      // Nombre de marches
      row = [];
      for(i=0; i<Cities.numCities; i++) {
        var cityId = 'city'+ Cities.cities[i].id;
        var slots = 0;
        for (var k in Seed.queue_atkp[cityId]){
         march = Seed.queue_atkp[cityId][k];
         if (typeof (march) == 'object'){
           slots++;
         }
        }
        var niveauPointRall=parseInt(getCityBuilding (Cities.cities[i].id, 12).maxLevel);
        if (niveauPointRall==12) niveauPointRall=11;
        row[i] = '<SPAN><B>'+ slots +'/'+ niveauPointRall +'</b></span>';
      }
      str += _row (lang.Overview.march, row, true, 0);
      // Terres sauvages
      row = [];
      for(i=0; i<Cities.numCities; i++) {
        var totWilds = 0;
        dat = Seed.wilderness['city'+ Cities.cities[i].id];
        if (dat!=null && matTypeof(dat)=='object')
          for (k in dat)
            ++totWilds;
        var nivcastle = parseInt(Seed.buildings['city'+ Cities.cities[i].id].pos0[1]);
        var castle = nivcastle;
        if (nivcastle==11) castle=12;
        if (nivcastle==12) castle=14;
        if (totWilds < castle)
        {
         row[i] = '<SPAN class=boldRed><B>'+ totWilds +'/'+ castle +'</b></span>';
        }else{

          row[i] = totWilds +'/'+ castle;
        }
      }
      str += _row (lang.Overview.ts, row, true, 0);
      row = [];
      var did = {};
      for(i=0; i<Cities.numCities; i++) {
        totKnights = 0;
        dat = Seed.knights['city'+ Cities.cities[i].id];
        for (k in dat)
          ++totKnights;

        var Knidispo = 0;
        var niveauPointRall=parseInt(getCityBuilding (Cities.cities[i].id, 12).maxLevel);
        if (niveauPointRall==12) niveauPointRall=11;  // fix : Send eleven armies at a time for level 12
        for (var z=0; z<knightRoles.length; z++){
	        var leader = Seed.leaders['city'+Cities.cities[i].id][knightRoles[z][1]+'KnightId'];
	        if (leader == 0) {

	        }else{
	         did['knt'+leader] = true;
	        }
         }
         for (k in Seed.knights['city'+Cities.cities[i].id]){
	         if (!did[k])
	           Knidispo++;
         }
         if (Knidispo<niveauPointRall) {
          row[i] = '<b>' + totKnights + '</b> - <span title="'+lang.Overview.knight1+'"><SPAN class=boldRed><B>'+Knidispo+'/' + niveauPointRall +'</span></span>';
         }else {
          row[i] = '<b>' + totKnights + '</b> - <span title="'+lang.Overview.knight1+'">'+Knidispo+'/' + niveauPointRall +'</span>';
	 }

      }
      str += _row (lang.Overview.knight, row, true, 0);
      str += "</table>";
      t.BOResumeDIV.innerHTML = str +'</div>';

      function addListener (but, i){
                  but.addEventListener ('click', function (){t.butToggleDefMode(i)}, false);
      }
      function addListenerG (but,i,c) {
        but.addEventListener ('click', function (){
          numcid=Cities.byID[i].num + 1 ;
          uW.citysel_click(ById('citysel_'+ (numcid)));
          but.src = "http://fr.igstatic.com/common/images/www/inscription/wait.gif";
          clearTimeout(t.displayTimer);
          t.butToggleGuardian(i,c,but);
         }, false);
      }
      for (var cityId in Cities.byID){
        	  var but = ById('BOtabut_'+ cityId);
        	  addListener (but, cityId);
        	  t.defMode[cityId] =  parseInt(Seed.citystats["city" + cityId].gate);
        	  t.displayDefMode (cityId);
      }
      var mm=Seed.guardian;
      for (var ii in mm) {
              var ww = mm[ii];
              for (var z in ww.cityGuardianLevels) {
              if (ww.cityGuardianLevels[z]>0) {
               var but = ById('BoG_'+ww.cityId+'_'+z);
               if (but)
                addListenerG (but, ww.cityId, z);
              }
             }
      }
       ById('boaideresume').addEventListener('click', function(){
	       	 window.open(sitesupport+"?page=aide_resume");
    	} , false);
    } catch (e){
      t.BOResumeDIV.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';
    }
    t.displayTimer = setTimeout (t.setContent, 3000);
  },
  butToggleGuardian:function (cityId, guardiuan, but) {
   var t = Tabs.Overview;
   var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    		params.cityId = cityId;
    		params.ctrl = "Guardian";
    		params.action="summon";
    		params.type=guardiuan;
    		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
    			method: "post",
    			parameters: params,
    			onSuccess: function (rslt) {
    			     var rslt=eval("("+rslt.responseText+")");
    				if (rslt.ok) {
    				var g = uW.cm.guardianModalModel.gObj();
    				g.summonGuardian = {summonFinishTime: parseInt(rslt.summonFinishTime), level: rslt.summonGuardian.cl0, type: rslt.summonGuardian.type, upgrading: false};
    				var now = unixTime();
        		 	var tempsrestant = parseInt(rslt.summonFinishTime) - now;
        		 	numcid=Cities.byID[cityId].num + 1 ;
        		 	setTimeout(function() {
        		 	uW.citysel_click(ById('citysel_'+ (numcid)));
        		 	setTimeout (t.setContent, 1000);
    				}, tempsrestant*1000);
    				} else {
    				  setTimeout (t.setContent, 1000);
    				}
    			},
    			onFailure: function () {

    			 setTimeout (t.setContent, 1000);
    			}
   });
  },
  butToggleDefMode : function (cityId){
      var t = Tabs.Overview;
      var mode = 1;
      if (Seed.citystats["city" + cityId].gate != 0)
        mode = 0;
      t.ajaxSetDefMode (cityId, mode, function (newMode){
          t.defMode[cityId] = newMode;
          t.displayDefMode (cityId);
        });
    },

    displayDefMode : function (cityId){
      var t = Tabs.Overview;
      var but = ById('BOtabut_'+ cityId);
      if (t.defMode[cityId]){
        but.className = 'BODefButOn';
        but.value = lang.Overview.def+' = ON';
      } else {
        but.className = 'BODefButOff';
        but.value = lang.Overview.def+' = OFF';
      }
  },
  ajaxSetDefMode : function (cityId, state, notify){
  		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  		params.cid = cityId;
  		params.state = state;
  		new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/gate.php" + unsafeWindow.g_ajaxsuffix, {
  			method: "post",
  			parameters: params,
  			onSuccess: function (rslt) {
  				if (rslt.ok) {
  					Seed.citystats["city" + cityId].gate = state;
  					notify (state);
  				}
  			},
  			onFailure: function () {
  			}
  		})
  },
};
  
/********************************* REPORT Tab *************************************/

Tabs.Berichte = {
  tabOrder : 15,
  tabLabel : lang.BoiteLabelRapporti,
  cont:null,
  state : null,

  init : function (div){
    
    var t = Tabs.Berichte;
    if (GM_getValue('ScanTidTimer_'+GetServerId(),'Offline') != "Online") {
      clearTimeout(tid);
    }
    t.cont=div;

    t.getAllianceReports();

    t.cont.innerHTML = '\
    <DIV class=ptstat align="center">Multi Whisper Tool</div>\
    <DIV class=pdxEntry>\
          <table width="100%">\
          <tr>\
          <td class=xtab colspan="3" align="center">Whisper : <INPUT id=wText type=text value="" size="90" />  <INPUT id=wSendButton type=submit value="Send" /></td>\
          </tr>\
          <tr>\
          <td class=xtab align="center"><INPUT id=wName1 type=text value="' + GM_getValue('wName1_'+GetServerId(),'') + '" /><INPUT id=wCheck1 type=checkbox unchecked /></td>\
          <td class=xtab align="center"><INPUT id=wName2 type=text value="' + GM_getValue('wName2_'+GetServerId(),'') + '" /><INPUT id=wCheck2 type=checkbox unchecked /></td>\
          <td class=xtab align="center"><INPUT id=wName3 type=text value="' + GM_getValue('wName3_'+GetServerId(),'') + '" /><INPUT id=wCheck3 type=checkbox unchecked /></td>\
          </tr>\
          <tr>\
          <td class=xtab align="center"><INPUT id=wName4 type=text value="' + GM_getValue('wName4_'+GetServerId(),'') + '" /><INPUT id=wCheck4 type=checkbox unchecked /></td>\
          <td class=xtab align="center"><INPUT id=wName5 type=text value="' + GM_getValue('wName5_'+GetServerId(),'') + '" /><INPUT id=wCheck5 type=checkbox unchecked /></td>\
          <td class=xtab align="center"><INPUT id=wName6 type=text value="' + GM_getValue('wName6_'+GetServerId(),'') + '" /><INPUT id=wCheck6 type=checkbox unchecked /></td>\
          </tr>\
          <tr>\
          <td class=xtab align="center"><INPUT id=wName7 type=text value="' + GM_getValue('wName7_'+GetServerId(),'') + '" /><INPUT id=wCheck7 type=checkbox unchecked /></td>\
          <td class=xtab align="center"><INPUT id=wName8 type=text value="' + GM_getValue('wName8_'+GetServerId(),'') + '" /><INPUT id=wCheck8 type=checkbox unchecked /></td>\
          <td class=xtab align="center"><INPUT id=wName9 type=text value="' + GM_getValue('wName9_'+GetServerId(),'') + '" /><INPUT id=wCheck9 type=checkbox unchecked /></td>\
          </tr>\
          <tr>\
          </tr>\
          </table>\
   </div>\
   <DIV class=ptstat align="center">Report Scanner</div>\
   <DIV class=pdxEntry>\
            <table width="100%">\
            <tr>\
            <td colspan="4" class=xtab>Recommended setting is a 2min delay to avoid getting locked out of reports.</td>\
            <TD width="20" class=xtab align="right">Delay<INPUT id=delayField1 size="1" maxlength="3" type=text value="' + GM_getValue('delayField1_'+GetServerId(),'') + '" /><SPAN> Min.</SPAN>\
            <td class=xtab align="right" colspan="2">Status: <span id=idRepStatus></span></td>\
            </tr><tr><td width="97" class=xtab>Pages to Scan:</td>\
            <td width="16" class=xtab><span id=idSpanNumPages text-color=#ffeecc></span></td>\
            <td width="225" class=xtab><INPUT name="idHudSelect" id="idHudSelect" size="1" maxlength="3" type=text value="' + GM_getValue('idHudSelect_'+GetServerId(),'5') + '" /></td>\
            <TD width="89" class=xtab align="right"><INPUT id=idHudSearch type=submit value="Scan Once" /></td>\
            <TD width="89" class=xtab align="center"><INPUT id=idHudStart type=submit value="Start" /></td>\
            <TD width="45" class=xtab align="left"><INPUT id=idHudStop type=submit value="Stop"></td>\
            <TD width="60" class=xtab align="right"><span id=repCountDown></span></td>\
            </tr></table>\
            </div>\
        <DIV id="hudResultsDiv" style="height:220px; max-height:220px; overflow:scroll;"></div>\
        <DIV><td style="background-color:white" font-size:7pt; text-align:right; align="right" colspan="4"><a target="_blank" href="http://userscripts.org/scripts/show/145310">Godlike Reports v. '+Version+' </a></td>\
   </div>';
        
        document.getElementById('idHudSearch').addEventListener ('click', t.handleHudSearchOnce, false);
        document.getElementById('idHudStop').addEventListener ('click', t.abortTidTimer, false);
        document.getElementById('idHudStart').addEventListener ('click', t.startTidTimer, false);
        document.getElementById('idHudSelect').addEventListener ('change', t.handleHudSelect, false);
        document.getElementById('wSendButton').addEventListener ('click', t.handleWhisper, false);
        document.getElementById('delayField1').addEventListener ('change', t.repDelayChange, false);
		document.getElementById('wName1').addEventListener('change',function() {
		var wName1=document.getElementById('wName1').value;
			GM_setValue('wName1_'+GetServerId(),wName1);
		},false);
		document.getElementById('wName2').addEventListener('change',function() {
		var wName2=document.getElementById('wName2').value;
			GM_setValue('wName2_'+GetServerId(),wName2);
		},false);
		document.getElementById('wName3').addEventListener('change',function() {
		var wName3=document.getElementById('wName3').value;
			GM_setValue('wName3_'+GetServerId(),wName3);
		},false);
		document.getElementById('wName4').addEventListener('change',function() {
		var wName4=document.getElementById('wName4').value;
			GM_setValue('wName4_'+GetServerId(),wName4);
		},false);
		document.getElementById('wName5').addEventListener('change',function() {
		var wName5=document.getElementById('wName5').value;
			GM_setValue('wName5_'+GetServerId(),wName5);
		},false);
		document.getElementById('wName6').addEventListener('change',function() {
		var wName6=document.getElementById('wName6').value;
			GM_setValue('wName6_'+GetServerId(),wName6);
		},false);
		document.getElementById('wName7').addEventListener('change',function() {
		var wName7=document.getElementById('wName7').value;
			GM_setValue('wName7_'+GetServerId(),wName7);
		},false);
		document.getElementById('wName8').addEventListener('change',function() {
		var wName8=document.getElementById('wName8').value;
			GM_setValue('wName8_'+GetServerId(),wName8);
		},false);
		document.getElementById('wName9').addEventListener('change',function() {
		var wName9=document.getElementById('wName9').value;
			GM_setValue('wName9_'+GetServerId(),wName9);
		},false);
    t.statusRepColorChanger();
    return this.cont;
    
  },
  
    handleWhisper : function(rslt, page) { // handles sending whispers to all names in the whisper tool
    var t = Tabs.Berichte;
    var wtext=document.getElementById("wText").value;
    var wname1=document.getElementById("wName1").value;
    if ((document.getElementById("wCheck1").checked==true) && (document.getElementById("wName1").value!="")) {
    sendChat("/" + wname1 + ' ' + wtext);
    }
    var wname2=document.getElementById("wName2").value;
    if ((document.getElementById("wCheck2").checked==true) && (document.getElementById("wName2").value!="")) {
    sendChat("/" + wname2 + ' ' + wtext);
    }
    var wname3=document.getElementById("wName3").value;
    if ((document.getElementById("wCheck3").checked==true) && (document.getElementById("wName3").value!="")) {
    sendChat("/" + wname3 + ' ' + wtext);
    }
    var wname4=document.getElementById("wName4").value;
    if ((document.getElementById("wCheck4").checked==true) && (document.getElementById("wName4").value!="")) {
    sendChat("/" + wname4 + ' ' + wtext);
    }
    var wname5=document.getElementById("wName5").value;
    if ((document.getElementById("wCheck5").checked==true) && (document.getElementById("wName5").value!="")) {
    sendChat("/" + wname5 + ' ' + wtext);
    }
    var wname6=document.getElementById("wName6").value;
    if ((document.getElementById("wCheck6").checked==true) && (document.getElementById("wName6").value!="")) {
    sendChat("/" + wname6 + ' ' + wtext);
    }
    var wname7=document.getElementById("wName7").value;
    if ((document.getElementById("wCheck7").checked==true) && (document.getElementById("wName7").value!="")) {
    sendChat("/" + wname7 + ' ' + wtext);
    }
    var wname8=document.getElementById("wName8").value;
    if ((document.getElementById("wCheck8").checked==true) && (document.getElementById("wName8").value!="")) {
    sendChat("/" + wname8 + ' ' + wtext);
    }
    var wname9=document.getElementById("wName9").value;
    if ((document.getElementById("wCheck9").checked==true) && (document.getElementById("wName9").value!="")) {
    sendChat("/" + wname9 + ' ' + wtext);
    }
  },

  DisplayReports : function (){
    var t = Tabs.Berichte;
    var data = t.data;
    var results=document.getElementById("hudResultsDiv");
    if(!t.data.length) {
       var todaysdate = Date();
       results.innerHTML = '<td><center><b> '+todaysdate+' Search done! no Attacks to report</b></center>';
       return;
    }
    var m = '<center><table><thead><th>Page #</th><th>Date</th><th>Attacker</th><th>Attacker<br>Coords</th><th>Alliance</th><th>Type</th><th>Target</th><th>Target<br>Coords</th></thead>';
    m += '<tbody>';
     var msg = '';
    for ( var i=0; i<t.data.length;i++) {
       var rpt = data[i];
       msg += rpt;
       //sendChat("/a" + msg);
       if (rpt.side0Name=='undefined')
          continue;
            
            m += '<tr><td>'+rpt.page+'</td>\
            <td>'+unsafeWindow.formatDateByUnixTime(rpt.reportUnixTime)+'</td>\
            <td>'+rpt.side1Name+'</td>\
            <td>'+ pdxkoordlink(rpt.side1XCoord, rpt.side1YCoord)+'</td>\
            <td>'+rpt.side1AllianceName+'</td>\
            <td>'+rpt.marchName+'</td>\
            <td>'+rpt.side0Name+'</td>\
             <td>'+ pdxkoordlink(rpt.side0XCoord, rpt.side0YCoord)+'</td>\
            </tr>';
    }
    m += '</tbody></table></center>';
    results.innerHTML = m;
   
   msg += '<tbody>'; 
    for ( var i=0; i<t.data.length;i++) {
       var rpt = data[i];
          if (rpt.side0Name=='undefined')
          continue;
          if (LastUnixTime >= rpt.reportUnixTime)
          continue;

            var msg = "";
          //  msg += <td>'-=  ATTACK  =-           '</td>;
          //    msg += '<tbody>';
            msg +=<td>--= INCOMING REPORT ON PAGE: </td>;
            msg += '<tr><td>'+rpt.page+' =- </td>\
            <td>Time: '+unsafeWindow.formatDateByUnixTime(rpt.reportUnixTime)+'</td>\
            <td>Name: '+rpt.side1Name+' </td>\
            <td>'+ pdxkoordlink(rpt.side1XCoord, rpt.side1YCoord)+' Alliance: </td>\
            <td>'+rpt.side1AllianceName+'</td>\
            <td>Type: '+rpt.marchName+'! </td>\
            <td>Our Member: '+rpt.side0Name+'</td>\
             <td>'+ pdxkoordlink(rpt.side0XCoord, rpt.side0YCoord)+' MAY NEED ASSISTANCE! <td>\
            <tr>\
            </tr>';
        if (GM_getValue('TheOldMsg_'+GetServerId(),'') != rpt.reportUnixTime)
     // sendChat("/" + Seed.player.name + ' ' + msg); // Whisper to myself       
      sendChat("/a " + msg); // Alliance chat
     GM_setValue('TheOldMsg_'+GetServerId(),rpt.reportUnixTime)
     LastUnixTime = rpt.reportUnixTime
        
     }
  },

  handleHudSelect : function(rslt, page) {
    var t = Tabs.Berichte;
    t.maxPages=document.getElementById("idHudSelect").value;
    GM_setValue('idHudSelect_'+GetServerId(),t.maxPages);
    if ( t.maxPages==99999)
       t.maxPages=t.totalPages;
 //   document.getElementById("idSpanNumPages").innerHTML = t.maxPages+'';
  },
  handleHudSearchCB : function(rslt, page) {
    var t = Tabs.Berichte;
    if (rslt) {
       if (!rslt.ok) {
          document.getElementById("idSpanHudErrorMsg").innerHTML = rslt.errorMsg;
          return;
       }
       t.totalPages=rslt.totalPages;
       if (rslt.arReports && page) {
         var ar = rslt.arReports;
         var rptkeys = unsafeWindow.Object.keys(ar);
         var myAllianceId = getMyAlliance()[0];
         for (var i = 0; i < rptkeys.length; i++) {
              var rpt = ar[rptkeys[i]];
              rpt.page = page;     
              var side0Name = rslt.arPlayerNames['p'+rpt.side0PlayerId];
              rpt.side0Name = side0Name;
              rpt.side1Name = rslt.arPlayerNames['p'+rpt.side1PlayerId];
              if (rpt.side0AllianceId > 0)
                rpt.side0AllianceName = rslt.arAllianceNames['a'+rpt.side0AllianceId];
              else
                rpt.side0AllianceName = 'unaligned';
              if (rpt.side1AllianceId > 0)
                rpt.side1AllianceName = rslt.arAllianceNames['a'+rpt.side1AllianceId];
              else
                rpt.side1AllianceName = 'unaligned';

              if (rpt.side0CityId > 0)
                rpt.side0CityName = rslt.arCityNames['c'+rpt.side0CityId];
              else
                rpt.side0CityName = 'none';
              if (rpt.side1CityId > 0)
                rpt.side1CityName = rslt.arCityNames['c'+rpt.side1CityId];
              else
                rpt.side1CityName = 'none';
              if (rpt.marchType == 1)
                  rpt.marchName = 'Transport';
              else if (rpt.marchType == 3)
                  rpt.marchName = 'Scout';
              else if (rpt.marchType == 2)
                  rpt.marchName = 'Reinforced ';
              else if (rpt.marchType == 4)
                  rpt.marchName = 'Attack';
              else rpt.marchName = 'unknown';
              if (myAllianceId != rpt.side1AllianceId)
                 t.data.push(rpt);
         }
       }
       if (parseInt(page)+1 <= t.maxPages) {
          var results=document.getElementById("hudResultsDiv");
          results.innerHTML = '<center><b>Search Page: '+(parseInt(page)+1)+'</b></center>';
          t.getAllianceReports(parseInt(page)+1);
       }
       else if (page)
           t.DisplayReports();
    }
  },

  maxPages:1,
  data:[],
  totalPages:0,
 
    
  handleHudSearch : function() { // handles the timed event when pressing Start in the report scanner
    var t = Tabs.Berichte;
    tid = setTimeout(t.handleHudSearch, GM_getValue('repScanTime_'+GetServerId(),120000));
    var results=document.getElementById("hudResultsDiv");
    //logit("handleHudSearch");
    t.maxPages=document.getElementById("idHudSelect").value;
    if ( t.maxPages==99999)
       t.maxPages=t.totalPages;
    results.innerHTML = '<center><b>Searching '+t.maxPages+' Pages!</b></center>';
    t.data=[];
    t.getAllianceReports(1);
  },
  
  handleHudSearchOnce : function() { // handles the Scan Once button in the report scanner
    var t = Tabs.Berichte;
    var results=document.getElementById("hudResultsDiv");
    //logit("handleHudSearch");
    t.maxPages=document.getElementById("idHudSelect").value;
    if ( t.maxPages==99999)
       t.maxPages=t.totalPages;
    results.innerHTML = '<center><b>Searching '+t.maxPages+' Pages!</b></center>';
    t.data=[];
    t.getAllianceReports(1);
  },
  
  startTidTimer : function() { // starts the timer in the report scanner
  var t = Tabs.Berichte;
  GM_setValue('ScanTidTimer_'+GetServerId(),"Online");
//  var therepcountdown = setInterval(t.repCountDowner, 5000);
  if (GM_getValue('delayField1_'+GetServerId(),'') != "") {
//  t.repCountDowner();
  t.statusRepColorChanger();
  t.handleHudSearch();
   }
  if (GM_getValue('delayField1_'+GetServerId(),'') == "") {
  alert("Enter a valid number in the Delay Box");
   }
  },
  
 // repCountDowner : function() {
  //  var t = Tabs.Berichte;
    
  //  var totaltid = GM_getValue('repScanTime','');
  //  var tidmath = totaltid - tid;
  //  var tidseconds = tidmath / 1000;
  //  document.getElementById("repCountDown").innerHTML = tid;
        
  //  },
  
  repDelayChange : function() { // handles changes in the delay box
  var t = Tabs.Berichte;
  var repDelay=document.getElementById("delayField1").value;
  var repDelayResult=repDelay * 60000;
  GM_setValue('delayField1_'+GetServerId(),repDelay);
  GM_setValue('repScanTime_'+GetServerId(),repDelayResult);
 // alert(GM_getValue('repScanTime'));
  },
  
  abortTidTimer : function() { // to be called when you want to stop the timer
  var t = Tabs.Berichte;
  clearTimeout(tid);
  GM_setValue('ScanTidTimer_'+GetServerId(),"Offline");
  t.statusRepColorChanger();
  },

  statusRepColorChanger : function() {
  var t = Tabs.Berichte;
  var selectorHud = GM_getValue('idHudSelect_'+GetServerId(),'5');
  document.getElementById("idHudSelect").innerHTML = selectorHud;
  var ColorGreen = "<span style='color:Green'>" + GM_getValue('ScanTidTimer_'+GetServerId(),'Offline') + "</span>";
  var ColorRed = "<span style='color:Red'>" + GM_getValue('ScanTidTimer_'+GetServerId(),'Offline') + "</span>";
  if (GM_getValue('ScanTidTimer_'+GetServerId(),'Offline') == "Online") {
  document.getElementById("idRepStatus").innerHTML = ColorGreen;
   }
  if (GM_getValue('ScanTidTimer_'+GetServerId(),'Offline') == "Offline") {
  document.getElementById("idRepStatus").innerHTML = ColorRed;
   }
  },

  getAllianceReports : function (pageNum){
    var t = Tabs.Berichte;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    if (pageNum)
      params.pageNo = pageNum;
    params.group = "a";
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/listReports.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
          Tabs.Berichte.handleHudSearchCB (rslt, pageNum);     
      },
      onFailure: function (rslt) {
          Tabs.Berichte.handleHudSearchCB (rslt, pageNum);     
      },
    }, false);
    
  },

  show : function (){
	  if (Options.widescreen==true)mainPop.div.style.width = 770 + 'px';
  },

  hide : function (){
  },
};

 var tid = setTimeout(Tabs.Berichte.handleHudSearch, GM_getValue('repScanTime_'+GetServerId(),120000));

/********************************* Koordinaten Hide/Show */
function pdxkoordlink (x, y){
  var m = [];
  m.push ('(<a onclick="pdxGotoMapHide (');
  m.push (x);
  m.push (',');
  m.push (y);
  m.push ('); return false">');
  m.push (x);
  m.push (',');
  m.push (y);
  m.push ('</a>)');  
  return m.join('');
}
unsafeWindow.pdxGotoMapHide = function (x, y){
  try {
    unsafeWindow.Modal.hideModal();
  } catch (e){ }
  try {
    Modal.hideModal();
  } catch (e){ }
  unsafeWindow.pdxGotoMap (x, y);  
}



unsafeWindow.pdxGotoMap = function (x, y){
  if (Options.pdxhideOnGoto)
    hideMe ();
  setTimeout (function (){
    document.getElementById('mapXCoor').value = x;
    document.getElementById('mapYCoor').value = y;
    unsafeWindow.reCenterMapWithCoor();
    var a = document.getElementById("mod_views").getElementsByTagName("a");
    for (var b = 0; b < a.length; b++) {
        a[b].className = ""
    }
    document.getElementById('mod_views_map').className = "sel";
    document.getElementById("maparea_city").style.display = 'none';
    document.getElementById("maparea_fields").style.display = 'none';
    document.getElementById("maparea_map").style.display = 'block';
    unsafeWindow.tutorialClear()
  }, 0);
};
pdxStartup ();

/*********************************  Cresting Tab ***********************************/
 Tabs.Crest = {
  tabOrder: 17,
  tabLabel: lang.BoiteLabelCrest,
  myDiv : null,
  rallypointlevel:null,
  error_code: 0,
  knt:{},
  init : function (div){
    var t = Tabs.Crest;
    Options.crestMarchError = 0;

    setInterval(t.sendCrestReport, 1*60*1000);
    setTimeout(function(){ t.Rounds(1,0,0);}, 5*1000);
    setTimeout(function() {

	if (Options.BORac_Ts) {
	AddSubTabLink(lang.crest.button, t.toggleCrestState, 'pbautotstab');
	if (Options.crestRunning == false)
	  updatebotbutton(lang.crest.button+" - OFF", 'pbautotstab');
	else
	  updatebotbutton(lang.crest.button+" - ON", 'pbautotstab');
    }

    },100);
    t.myDiv = div;
    var selbut=0;
    var m = '<DIV id=pbTowrtDivF class=boStat>'+lang.crest.title+'</div><TABLE id=pbcrestfunctions width=100% height=0% class=pbTab><TR align="center">';
    if (Options.crestRunning == false) {
	       m += '<TD><INPUT id=Cresttoggle type=submit value="'+lang.crest.Cresttoggle+' = OFF"></td>';
	   } else {
	       m += '<TD><INPUT id=Cresttoggle type=submit value="'+lang.crest.Cresttoggle+' = ON"></td>';
    }
    m += '<TD colspan=2><INPUT id=CrestHelp type=submit value="'+lang.crest.help+'">';
    m += '<INPUT id=showCrestTargets type=submit value="'+lang.crest.target+'"><br>'+lang.crest.interval+' <INPUT type=text size=3 value='+Options.Crestinterval+' id=pbcrest_interval /> '+lang.General.secs+'</td>';
    m += '<TD><INPUT id=pbsendreport type=checkbox '+ (Options.crestreport?' CHECKED':'') +'\> '+lang.crest.sendrpt+'&nbsp;';
    m += '<INPUT id=pbsendcrestreportint value='+ Options.CrestMsgInterval +' type=text size=3 \> '+lang.General.hours+' - <input type=button value="'+uW.g_js_strings.modal_auto_attack.now+'" id=bosendreportnow><br>';
    m += lang.crest.keep+' <INPUT id=bocrestslot value='+Options.CrestSlot+' type=text size=2 \> '+lang.crest.keep2+'</td></table>';
    m += '<DIV id=pbOpt class=boStat>OPTIONS</div><TABLE id=pbcrestopt	 width=100% height=0% class=pbTab><TR align="center"></table>';
    m += '<DIV style="margin-bottom:10px;">'+uW.g_js_strings.commonstr.from+' : <span id=crestcity></span></div>';
    m += '<TABLE class=ptTab><TR><TD>'+uW.g_js_strings.commonstr.location+' : &nbsp;&nbsp;X:<INPUT id=pbcrestx type=text size=3 maxlength=3 value=""></td>';
    m += '<TD>Y:<INPUT id=pbcresty type=text size=3 maxlength=3 value=""></td></tr></table>';
    m += '<TABLE class=ptTab><TR><TD>'+lang.crest.wave+' <b>1</b>: </td><TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_30.png></td><TD><INPUT id=R1ST type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_30.png></td><TD><INPUT id=R1MM type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_30.png></td><TD><INPUT id=R1Scout type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_30.png></td><TD><INPUT id=R1Pike type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_30.png></td><TD><INPUT id=R1Sword type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_30.png></td><TD><INPUT id=R1Arch type=text size=6 maxlength=6 value=0></td></tr>';
    m += '<tr><td></td><TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_30.png></td><TD><INPUT id=R1LC type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_30.png></td><TD><INPUT id=R1HC type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_30.png></td><TD><INPUT id=R1SW type=text size=7 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_30.png></td><TD><INPUT id=R1Ball type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_30.png></td><TD><INPUT id=R1Ram type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_30.png></td><TD><INPUT id=R1Cat type=text size=6 maxlength=6 value=0></td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr>';
    m += '<TR><TD>'+lang.crest.wave+' <b>2</b>: </td><TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_30.png></td><TD><INPUT id=R2ST type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_30.png></td><TD><INPUT id=R2MM type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_30.png></td><TD><INPUT id=R2Scout type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_30.png></td><TD><INPUT id=R2Pike type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_30.png></td><TD><INPUT id=R2Sword type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_30.png></td><TD><INPUT id=R2Arch type=text size=6 maxlength=6 value=0></td></tr>';
    m += '<tr><td></td><TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_30.png></td><TD><INPUT id=R2LC type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_30.png></td><TD><INPUT id=R2HC type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_30.png></td><TD><INPUT id=R2SW type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_30.png></td><TD><INPUT id=R2Ball type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_30.png></td><TD><INPUT id=R2Ram type=text size=6 maxlength=6 value=0></td>';
    m += '<TD>&nbsp;&nbsp;<img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_30.png></td><TD><INPUT id=R2Cat type=text size=6 maxlength=6 value=0></td></tr></table>';
    m += '<DIV style="text-align:center; margin-top:15px"><INPUT id=pbSaveRouteCrest type=submit value="'+lang.crest.add+'"></div>';

    t.myDiv.innerHTML = m;
	document.getElementById('bocrestslot').addEventListener('change', function(){
	  if (parseIntNan(document.getElementById('bocrestslot').value)>9) document.getElementById('bocrestslot').value=1;
		Options.CrestSlot = document.getElementById('bocrestslot').value;
		saveOptions();
	}, false);

	document.getElementById('pbsendreport').addEventListener('change', function(){
		Options.crestreport = document.getElementById('pbsendreport').checked;
		saveOptions();
	}, false);
	ById('pbsendcrestreportint').addEventListener('change', function(){
		Options.CrestMsgInterval = parseIntNan(document.getElementById('pbsendcrestreportint').value);
		saveOptions();
	}, false);
    ById("pbcrest_interval").addEventListener('change', function(e){
       		if (parseIntNan(e.target.value)<5) e.target.value=5;
    		Options.Crestinterval = parseIntNan(e.target.value);
    		saveOptions();
	},false);
    for (var i=0;i<Seed.cities.length;i++){
		if (CrestOptions.CrestCity == Seed.cities[i][0]){
			selbut=i;
			break;
		}
	}

    t.tcp = new CdispCityPicker ('crestcityselect', document.getElementById('crestcity'), true, t.clickCitySelect, selbut);

    if (CrestOptions.CrestCity == 0) {
    	CrestOptions.CrestCity = t.tcp.city.id
    }
    ById('bosendreportnow').addEventListener('click', function() {
	t.sendCrestReportNow();

	}, false);

      document.getElementById('pbcrestx').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbcrestx').value)) document.getElementById('pbcrestx').value='' ;
      }, false);

      document.getElementById('pbcresty').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbcresty').value)) document.getElementById('pbcresty').value='' ;
      }, false);

      document.getElementById('R1ST').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R1ST').value)) document.getElementById('R1ST').value=0 ;
      }, false);

      document.getElementById('R1MM').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R1MM').value)) document.getElementById('R1MM').value=0 ;
      }, false);

      document.getElementById('R1Pike').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R1Pike').value)) document.getElementById('R1Pike').value=0 ;
      }, false);

      document.getElementById('R1Scout').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R1Scout').value)) document.getElementById('R1Scout').value=0 ;
      }, false);

      document.getElementById('R1Sword').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R1Sword').value)) document.getElementById('R1Sword').value=0 ;
      }, false);

      document.getElementById('R1Arch').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R1Arch').value)) document.getElementById('R1Arch').value=0 ;
      }, false);

      document.getElementById('R1LC').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R1LC').value)) document.getElementById('R1LC').value=0 ;
      }, false);

      document.getElementById('R1HC').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R1HC').value)) document.getElementById('R1HC').value=0 ;
      }, false);

      document.getElementById('R1SW').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R1SW').value)) document.getElementById('R1SW').value=0 ;
      }, false);

      document.getElementById('R1Ball').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R1Ball').value)) document.getElementById('R1Ball').value=0 ;
      }, false);

      document.getElementById('R1Ram').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R1Ram').value)) document.getElementById('R1Ram').value=0 ;
      }, false);

      document.getElementById('R1Cat').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R1Cat').value)) document.getElementById('R1Cat').value=0 ;
      }, false);

      document.getElementById('R2ST').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R2ST').value)) document.getElementById('R2ST').value=0 ;
      }, false);

      document.getElementById('R2MM').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R2MM').value)) document.getElementById('R2MM').value=0 ;
      }, false);

      document.getElementById('R2Pike').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R2Pike').value)) document.getElementById('R2Pike').value=0 ;
      }, false);

      document.getElementById('R2Scout').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R2Scout').value)) document.getElementById('R2Scout').value=0 ;
      }, false);

      document.getElementById('R2Sword').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R2Sword').value)) document.getElementById('R2Sword').value=0 ;
      }, false);

      document.getElementById('R2Arch').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R2Arch').value)) document.getElementById('R2Arch').value=0 ;
      }, false);

      document.getElementById('R2LC').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R2LC').value)) document.getElementById('R2LC').value=0 ;
      }, false);

      document.getElementById('R2HC').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R2HC').value)) document.getElementById('R2HC').value=0 ;
      }, false);

      document.getElementById('R2SW').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R2SW').value)) document.getElementById('R2SW').value=0 ;
      }, false);

      document.getElementById('R2Ball').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R2Ball').value)) document.getElementById('R2Ball').value=0 ;
      }, false);

      document.getElementById('R2Ram').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R2Ram').value)) document.getElementById('R2Ram').value=0 ;
      }, false);

      document.getElementById('R2Cat').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('R2Cat').value)) document.getElementById('R2Cat').value=0 ;
      }, false);

    document.getElementById('crestcity').addEventListener('click', function(){CrestOptions.CrestCity = t.tcp.city.id;} , false);
    document.getElementById('Cresttoggle').addEventListener('click', function(){t.toggleCrestState(this)} , false);
    document.getElementById('pbcrestx').addEventListener('change', function(){CrestOptions.X = document.getElementById('pbcrestx').value;;} , false);
    document.getElementById('pbcresty').addEventListener('change', function(){CrestOptions.Y = document.getElementById('pbcresty').value;} , false);
    document.getElementById('R1ST').addEventListener('change', function(){CrestOptions.R1ST = document.getElementById('R1ST').value;} , false);
    document.getElementById('R1MM').addEventListener('change', function(){CrestOptions.R1MM = document.getElementById('R1MM').value;} , false);
    document.getElementById('R1Scout').addEventListener('change', function(){CrestOptions.R1Scout = document.getElementById('R1Scout').value;} , false);
    document.getElementById('R1Pike').addEventListener('change', function(){CrestOptions.R1Pike = document.getElementById('R1Pike').value;} , false);
    document.getElementById('R1Sword').addEventListener('change', function(){CrestOptions.R1Sword = document.getElementById('R1Sword').value;} , false);
    document.getElementById('R1Arch').addEventListener('change', function(){CrestOptions.R1Arch = document.getElementById('R1Arch').value;} , false);
    document.getElementById('R1LC').addEventListener('change', function(){CrestOptions.R1LC = document.getElementById('R1LC').value;} , false);
    document.getElementById('R1HC').addEventListener('change', function(){CrestOptions.R1HC = document.getElementById('R1HC').value;} , false);
    document.getElementById('R1SW').addEventListener('change', function(){CrestOptions.R1SW = document.getElementById('R1SW').value;} , false);
    document.getElementById('R1Ball').addEventListener('change', function(){CrestOptions.R1Ball = document.getElementById('R1Ball').value;} , false);
    document.getElementById('R1Ram').addEventListener('change', function(){CrestOptions.R1Ram = document.getElementById('R1Ram').value;} , false);
    document.getElementById('R1Cat').addEventListener('change', function(){CrestOptions.R1Cat = document.getElementById('R1Cat').value;} , false);
    document.getElementById('R2ST').addEventListener('change', function(){CrestOptions.R2ST = document.getElementById('R2ST').value;} , false);
    document.getElementById('R2MM').addEventListener('change', function(){CrestOptions.R2MM = document.getElementById('R2MM').value;} , false);
    document.getElementById('R2Scout').addEventListener('change', function(){CrestOptions.R2Scout = document.getElementById('R2Scout').value;} , false);
    document.getElementById('R2Pike').addEventListener('change', function(){CrestOptions.R2Pike = document.getElementById('R2Pike').value;} , false);
    document.getElementById('R2Sword').addEventListener('change', function(){CrestOptions.R2Sword = document.getElementById('R2Sword').value;} , false);
    document.getElementById('R2Arch').addEventListener('change', function(){CrestOptions.R2Arch = document.getElementById('R2Arch').value;} , false);
    document.getElementById('R2LC').addEventListener('change', function(){CrestOptions.R2LC = document.getElementById('R2LC').value;} , false);
    document.getElementById('R2HC').addEventListener('change', function(){CrestOptions.R2HC = document.getElementById('R2HC').value;} , false);
    document.getElementById('R2SW').addEventListener('change', function(){CrestOptions.R2SW = document.getElementById('R2SW').value;} , false);
    document.getElementById('R2Ball').addEventListener('change', function(){CrestOptions.R2Ball = document.getElementById('R2Ball').value;} , false);
    document.getElementById('R2Ram').addEventListener('change', function(){CrestOptions.R2Ram = document.getElementById('R2Ram').value;} , false);
    document.getElementById('R2Cat').addEventListener('change', function(){CrestOptions.R2Cat = document.getElementById('R2Cat').value;} , false);
    document.getElementById('CrestHelp').addEventListener('click', function(){t.helpPop();} , false);
    document.getElementById('pbSaveRouteCrest').addEventListener('click', function(){CrestOptions.active="Actif";t.addCrestRoute();}, false);
    document.getElementById('showCrestTargets').addEventListener('click', function(){t.showCrestRoute();}, false);
  },


helpPop : function (){
    var helpText = lang.crest.helpText;
    var pop = new CPopup ('ArmoiriesHelp', 0, 0, 585, 400, true);
    pop.centerMe (mainPop.getMainDiv());
    pop.getMainDiv().innerHTML = helpText;
    pop.getTopDiv().innerHTML = '<CENTER><B>'+lang.crest.helpTitle+'</b></center>';
    pop.show (true);
  },
    addCrestRoute : function () {
		if(CrestOptions.X == "" || CrestOptions.Y == "") {
		        alert(lang.crest.nolocation);
			return;
		}
		var t = Tabs.Crest;
		var CrestLength = CrestData.length;
		CrestData[CrestLength] = new CrestFunc(CrestOptions);
		saveCrestData();
    },
    showCrestRoute : function () {
		var t = Tabs.Crest;
		var popCrestTargets = null;
		t.popCrestTargets = new CPopup('pbShowCrestTargets', 0, 0, 1100, 500, true, function() {clearTimeout (1000);});
		var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbShowCrestTargets" id="pbCrestTargets">';
		t.popCrestTargets.getMainDiv().innerHTML = '</table></div>' + m;
		t.popCrestTargets.getTopDiv().innerHTML = '<TD><B>'+lang.crest.popCrest+'</td>';
		t.paintCrestTargets();
		t._addTabHeader();
		t.popCrestTargets.show(true);
    },
    _addTabHeader : function () {
		var row = document.getElementById('pbCrestTargets').insertRow(0);
		row.vAlign = 'top';
	     	row.insertCell(0).innerHTML = uW.g_js_strings.commonstr.target;
	     	row.insertCell(1).innerHTML = lang.crest.wave + " #";
	     	row.insertCell(2).innerHTML = "<img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_30.png>";
	     	row.insertCell(3).innerHTML = "<img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_30.png>";
	     	row.insertCell(4).innerHTML = "<img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_30.png>";
	     	row.insertCell(5).innerHTML = "<img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_30.png>";
	     	row.insertCell(6).innerHTML = "<img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_30.png>";
	     	row.insertCell(7).innerHTML = "<img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_30.png>";
	     	row.insertCell(8).innerHTML = "<img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_30.png>";
	     	row.insertCell(9).innerHTML = "<img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_30.png>";
	     	row.insertCell(10).innerHTML = "<img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_30.png>";
	     	row.insertCell(11).innerHTML = "<img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_30.png>";
	     	row.insertCell(12).innerHTML = "<img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_30.png>";
	     	row.insertCell(13).innerHTML = "<img width=25 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_30.png>";
	     	row.insertCell(14).innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;";
	     	row.insertCell(14).innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
    },
    paintCrestTargets : function () {
		t = Tabs.Crest;

		for(var i = 0; i < CrestData.length; i++) {
			t._addTabCrest(i, uW.g_js_strings.commonstr.location+' : <a href="javascript:void(0)" onclick="cm.utils.CoordinateLinkController.onClick(event)" class="coordinateLink">(' + CrestData[i].X + ',' + CrestData[i].Y+')</a>', "<b>2</b>", CrestData[i].R2ST, CrestData[i].R2MM, CrestData[i].R2Scout, CrestData[i].R2Pike, CrestData[i].R2Sword, CrestData[i].R2Arch, CrestData[i].R2LC, CrestData[i].R2HC, CrestData[i].R2SW, CrestData[i].R2Ball, CrestData[i].R2Ram, CrestData[i].R2Cat, " "," ");
			if (CrestData[i].active=="Actif")
			 t._addTabCrest(i, CrestData[i].CrestCity, "<b>1</b>", CrestData[i].R1ST, CrestData[i].R1MM, CrestData[i].R1Scout, CrestData[i].R1Pike, CrestData[i].R1Sword, CrestData[i].R1Arch, CrestData[i].R1LC, CrestData[i].R1HC, CrestData[i].R1SW, CrestData[i].R1Ball, CrestData[i].R1Ram, CrestData[i].R1Cat, uW.g_js_strings.commonstr.remove, lang.crest.actif);
			else
			 t._addTabCrest(i, CrestData[i].CrestCity, "<b>1</b>", CrestData[i].R1ST, CrestData[i].R1MM, CrestData[i].R1Scout, CrestData[i].R1Pike, CrestData[i].R1Sword, CrestData[i].R1Arch, CrestData[i].R1LC, CrestData[i].R1HC, CrestData[i].R1SW, CrestData[i].R1Ball, CrestData[i].R1Ram, CrestData[i].R1Cat, uW.g_js_strings.commonstr.remove, lang.crest.inactif);
			t._addTabCrest(i, "","","","","","","","","","","","","","","","");
		}
    },
    _addTabCrest : function (QueID, col0, col1, col2, col3, col4, col5, col6, col7, col8, col9, col10, col11, col12, col13, col14, col15) {
		var t = Tabs.Crest;
		var row = document.getElementById('pbCrestTargets').insertRow(0);

		for (var i = 0; i <= 15; i++) {
			if (i == 14 && col14 == uW.g_js_strings.commonstr.remove) {
				row.insertCell(i).innerHTML = "<a id=pbCrestDel_" + QueID + " value=" + i + ">"+uW.g_js_strings.commonstr.remove+"</a>";
				document.getElementById('pbCrestDel_' + QueID).addEventListener('click', function(){t.cancelCrestTarget(QueID);}, false);
			} else if (col14 == uW.g_js_strings.commonstr.remove && i == 0) {
				row.insertCell(i).innerHTML = Cities.byID[col0].name;
			} else if  (i == 15 && col14 == uW.g_js_strings.commonstr.remove) {

			  if (CrestData[QueID].active=="Actif") {
			   row.insertCell(i).innerHTML = "<a id=BOCrestAct_" + QueID + " value=" + i + ">"+lang.crest.actif+"</a>";
			     document.getElementById('BOCrestAct_' + QueID).addEventListener('click', function(){ CrestData[QueID].active="De-Actif";saveCrestData();t.showCrestRoute();  }, false);
			  } else if (CrestData[QueID].active=="De-Actif") {
			   row.insertCell(i).innerHTML = "<a id=BOCrestAct_" + QueID + " value=" + i + ">"+lang.crest.inactif+"</a>";
			     document.getElementById('BOCrestAct_' + QueID).addEventListener('click', function(){ CrestData[QueID].active="Actif";saveCrestData();t.showCrestRoute();  }, false);
			  }
			}else{
				row.insertCell(i).innerHTML = eval("col" + i) + "&nbsp; &nbsp;";
			}
		}
   },
   cancelCrestTarget : function (QueID) {
	     var t = Tabs.Crest;
	     var queueId = parseInt(QueID);
	     CrestData.splice(queueId, 1);
	     saveCrestData();
	     t.showCrestRoute();
   },
   getRallypointLevel: function(cityId){
		var t = Tabs.Crest;
		for (var o in Seed.buildings[cityId]){
			var buildingType = parseInt(Seed.buildings[cityId][o][0]);
			var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
			if (buildingType == 12)
				t.rallypointlevel=parseInt(buildingLevel);
		}
    },
    getAtkKnight : function(cityID){
		var t = Tabs.Crest;
		t.knt = new Array();
		for (k in Seed.knights[cityID]){
			if (Seed.knights[cityID][k]["knightStatus"] == 1 && Seed.leaders[cityID]["resourcefulnessKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["politicsKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["combatKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["intelligenceKnightId"] != Seed.knights[cityID][k]["knightId"]){
     			t.knt.push ({
     				Name:   Seed.knights[cityID][k]["knightName"],
     				Combat:	parseInt(Seed.knights[cityID][k]["combat"]),
     				ID:		Seed.knights[cityID][k]["knightId"],
     			});
     		}
		}
		t.knt = t.knt.sort(function sort(a,b) {a = parseInt(a['Combat']);b = parseInt(b['Combat']);return a == b ? 0 : (a > b ? -1 : 1);});
	},
 	sendMarch: function(p,callback,r,retry, CrestDataNum){
		var t = Tabs.Crest;
		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
			 method: "post",
			 parameters: p,
			 loading: true,
			 onSuccess: function (transport) {
			     try {
				var rslt = eval("(" + transport.responseText + ")");
				if (rslt.ok) {
					var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
					var ut = unsafeWindow.unixtime();
					var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
					var resources=[0,0,0,0,0,0,0,0,0,0,0,0,0];
					for(i = 0; i <= unitsarr.length; i++){
						if(p["u"+i]){
							unitsarr[i] = p["u"+i];
						}
					}

					var currentcityid = p.cid;
					unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, p.xcoord, p.ycoord, unitsarr, p.type, p.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
					unsafeWindow.update_seed(rslt.updateSeed)

					if (rslt.updateSeed) {
						unsafeWindow.update_seed(rslt.updateSeed);
					}
			 		var now = new Date().getTime()/1000.0;
					now = now.toFixed(0);
					if(r==1){
											Options.Crest1Count++;
											r = 2;
											CrestData[CrestDataNum].lastRoundTwo = now;
					} else {
											Options.Crest2Count++;
					}



					saveCrestData();
					t.timer = setTimeout (function(){callback(r,0,CrestDataNum);}, (Math.random()*10*1000)+(Options.Crestinterval*1000));
					return;

				} else {

					if (rslt.user_action) {
						actionLog("AutoTS","<b><font color=red>CAPTCHA</font></b>");
						new CdialogCancelContinue('<SPAN class=boldRed>CAPTCHA ALERT ! AutoTS, on attend 10 minutes</span>', null, null, mainPop.getMainDiv());
						t.timer = setTimeout (function(){callback(r,retry,CrestDataNum);},5*60*1000);

						return;
					}
					t.timer = setTimeout (function(){callback(r,retry,CrestDataNum);}, Options.Crestinterval*1000);
					return;
				}
			   } catch(err) {
			     t.timer = setTimeout (function(){callback(r,retry,CrestDataNum);}, 1000);
			     return;
			   }
			},
			 onFailure: function () {
				setTimeout (function(){callback(r,retry,CrestDataNum);}, Options.Crestinterval*1000);
				return;
			 }
  		});
	},
	abandonWilderness: function(tid,x,y,cid,callback,retry, CrestDataNum){
		var t = Tabs.Crest;
		if (!Options.crestRunning) return;

		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		var cityID = cid;
		var tileid = tid;
		params.tid=tid;
		params.cid=cid;
		params.x=x;
  		params.y=y;
  		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/abandonWilderness.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
  		    parameters: params,
  		    loading: true,
  		    onSuccess:function(transport){
				var rslt=eval("("+transport.responseText+")");
				if (rslt.ok) {
					t.error_code = 0;
					if (rslt.returningMarches) {
						var cities = Object.keys(rslt.returningMarches);
						for (var i = 0; i < cities.length; i++) {
							for (var j = 0; j < rslt.returningMarches[cities[i]].length; j++) {
				                var cid = cities[i].split("c")[1];
				                var mid = rslt.returningMarches[cities[i]][j];
				                var march = Seed.queue_atkp["city" + cid]["m" + mid];
								if (march) {
									var marchtime = Math.abs(parseInt(march.destinationUnixTime) - parseInt(march.marchUnixTime));
				                    var ut = unsafeWindow.unixtime();
				                    Seed.queue_atkp["city" + cid]["m" + mid].destinationUnixTime = ut;
				                    Seed.queue_atkp["city" + cid]["m" + mid].marchUnixTime = ut - marchtime;
				                    Seed.queue_atkp["city" + cid]["m" + mid].returnUnixTime = ut + marchtime;
				                    Seed.queue_atkp["city" + cid]["m" + mid].marchStatus = 8
				                }
				            }
				        }
				    }
					if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
				    if (Object.keys(Seed.wilderness["city" + cityID]).length == 1) {
						Seed.wilderness["city" + cityID] = []
  		         	} else	{
						delete Seed.wilderness["city"+cityID]["t"+tileid];
  		         	}
				} else {
					if (rslt.error_code != 401) {
						t.error_code = rslt.error_code;

               		}
  		        }
  		    },
  		    onFailure: function () {}
  		});
    },
    Rounds : function (r, retry, CrestDataNum) {
		var t = Tabs.Crest;
		clearTimeout(t.timer);
		if (!Options.crestRunning) return;
		if (CrestData.length == 0)
			return;
		if (CrestDataNum >= CrestData.length)
			CrestDataNum = 0;
		if (CrestData[CrestDataNum].active=="De-Actif") {
		    t.timer =setTimeout(function() { t.Rounds(1,0,parseInt(CrestDataNum+1)); },1000);
		    return;
		}
		cityID = 'city' + CrestData[CrestDataNum].CrestCity;
		retry++;
		for (var k in Seed.wilderness[cityID] ){
			if (Seed.wilderness[cityID][k]['xCoord']==CrestData[CrestDataNum].X && Seed.wilderness[cityID][k]['yCoord']==CrestData[CrestDataNum].Y && t.error_code!=401) {
				t.abandonWilderness(Seed.wilderness[cityID][k]['tileId'],Seed.wilderness[cityID][k]['xCoord'],Seed.wilderness[cityID][k]['yCoord'],CrestData[CrestDataNum].CrestCity,t.Rounds,retry,CrestDataNum);
			}
		}
		switch (retry) {
			case 10:
				t.timer =setTimeout(function(){ t.Rounds(r,retry,CrestDataNum);},30000);
				return;
				break;
			case 20:
				t.timer =setTimeout(function(){ t.Rounds(r,retry,CrestDataNum);},30000);
				return;
				break;
			case 50:
				//reloadKOC();
				return;
				break;
		}
		if (parseInt(Seed.units[cityID]['unt1']) < CrestData[CrestDataNum].R1ST || parseInt(Seed.units[cityID]['unt2']) < CrestData[CrestDataNum].R1MM || parseInt(Seed.units[cityID]['unt3']) < CrestData[CrestDataNum].R1Scout || parseInt(Seed.units[cityID]['unt4']) < CrestData[CrestDataNum].R1Pike || parseInt(Seed.units[cityID]['unt5']) < CrestData[CrestDataNum].R1Sword || parseInt(Seed.units[cityID]['unt6']) < CrestData[CrestDataNum].R1Arch || parseInt(Seed.units[cityID]['unt7']) < CrestData[CrestDataNum].R1LC || parseInt(Seed.units[cityID]['unt8']) < CrestData[CrestDataNum].R1HC || parseInt(Seed.units[cityID]['unt9']) < CrestData[CrestDataNum].R1SW || parseInt(Seed.units[cityID]['unt10']) < CrestData[CrestDataNum].R1Ball || parseInt(Seed.units[cityID]['unt11']) < CrestData[CrestDataNum].R1Ram || parseInt(Seed.units[cityID]['unt12']) < CrestData[CrestDataNum].R1Cat || parseInt(Seed.units[cityID]['unt1']) < CrestData[CrestDataNum].R2ST || parseInt(Seed.units[cityID]['unt2']) < CrestData[CrestDataNum].R2MM || parseInt(Seed.units[cityID]['unt3']) < CrestData[CrestDataNum].R2Scout || parseInt(Seed.units[cityID]['unt4']) < CrestData[CrestDataNum].R2Pike || parseInt(Seed.units[cityID]['unt5']) < CrestData[CrestDataNum].R2Sword || parseInt(Seed.units[cityID]['unt6']) < CrestData[CrestDataNum].R2Arch || parseInt(Seed.units[cityID]['unt7']) < CrestData[CrestDataNum].R2LC || parseInt(Seed.units[cityID]['unt8']) < CrestData[CrestDataNum].R2HC || parseInt(Seed.units[cityID]['unt9']) < CrestData[CrestDataNum].R2SW || parseInt(Seed.units[cityID]['unt10']) < CrestData[CrestDataNum].R2Ball || parseInt(Seed.units[cityID]['unt11']) < CrestData[CrestDataNum].R2Ram || parseInt(Seed.units[cityID]['unt12']) < CrestData[CrestDataNum].R2Cat) {
			if (CrestData.length == 1) {
				t.timer =setTimeout(function(){ t.Rounds(r,retry,CrestDataNum);},Options.Crestinterval*1000);
				return;
			 } else
				t.timer =setTimeout(function(){ t.Rounds(1,retry,parseInt(CrestDataNum)+1);},Options.Crestinterval*1000);
			return;
		}

		t.getAtkKnight(cityID);
		slots=0;

		for (z in Seed.queue_atkp[cityID]) {
			slots++;
		}
		if  (Seed.queue_atkp[cityID].toSource() == "[]")
			slots=0;

		slots=parseInt(slots)+parseInt(Options.CrestSlot); // protection slots
		t.getRallypointLevel(cityID);
				switch (t.rallypointlevel) {
					case 12:
						t.rallypointlevel = t.rallypointlevel - 1;
					default:
						if (t.rallypointlevel <= slots) {
							if (CrestData.length == 1) {
								t.timer = setTimeout(function(){ t.Rounds(r,retry,CrestDataNum);},Options.Crestinterval*1000);
							} else {
								t.timer = setTimeout(function(){ t.Rounds(1,retry,parseInt(CrestDataNum)+1);},Options.Crestinterval*1000);
							}
							return;
							break;
						}
				}



		if  (t.knt.toSource() == "[]") {
			t.timer = setTimeout(function(){ t.Rounds(1,retry,parseInt(CrestDataNum)+1);},Options.Crestinterval*1000);
			return;
		}
		var kid = t.knt[0].ID;
		if (CrestData[CrestDataNum].R1ST == 0 && CrestData[CrestDataNum].R1MM == 0 && CrestData[CrestDataNum].R1Scout == 0 && CrestData[CrestDataNum].R1Pike == 0 && CrestData[CrestDataNum].R1Sword == 0 && CrestData[CrestDataNum].R1Arch == 0 && CrestData[CrestDataNum].R1LC == 0 && CrestData[CrestDataNum].R1HC == 0 && CrestData[CrestDataNum].R1SW == 0 && CrestData[CrestDataNum].R1Ball == 0 && CrestData[CrestDataNum].R1Ram == 0 && CrestData[CrestDataNum].R1Cat == 0) {
		   r=2;
	   	}else {
			var now = new Date().getTime()/1000.0;
			now = now.toFixed(0);
			if (now > (parseInt(CrestData[CrestDataNum].lastRoundTwo) + 300)) {
				r=1;
			}
		}
		switch(r) {
			case 1:
				if ((t.rallypointlevel-slots) < 2) {
					t.timer =setTimeout(function(){ t.Rounds(1,retry,(parseInt(CrestDataNum)+1));},Options.Crestinterval*1000);
					return;
				}
				var params 		= 	unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
				params.cid		= 	CrestData[CrestDataNum].CrestCity;
				params.type		=	4;
				params.kid		= 	kid;
				params.xcoord 	= 	CrestData[CrestDataNum].X;
				params.ycoord 	= 	CrestData[CrestDataNum].Y;
				if (now < (parseInt(CrestData[CrestDataNum].lastRoundTwo) + 300)) {

					params.u2 	= 	(CrestData[CrestDataNum].R1MM / 10);
					params.u2 	= 	params.u2.toFixed(0);

					if (params.u2 < (CrestData[CrestDataNum].R1MM / 10))
						params.u2++;
				} else {
					params.u2	= 	CrestData[CrestDataNum].R1MM;
				}
				params.u1 		= 	CrestData[CrestDataNum].R1ST;
				params.u2 		= 	CrestData[CrestDataNum].R1MM;
				params.u3 		= 	CrestData[CrestDataNum].R1Scout;
				params.u4 		= 	CrestData[CrestDataNum].R1Pike;
				params.u5 		= 	CrestData[CrestDataNum].R1Sword;
				params.u6 		= 	CrestData[CrestDataNum].R1Arch;
				params.u7 		= 	CrestData[CrestDataNum].R1LC;
				params.u8 		= 	CrestData[CrestDataNum].R1HC;
				params.u9 		= 	CrestData[CrestDataNum].R1SW;
				params.u10 		= 	CrestData[CrestDataNum].R1Ball;
				params.u11 		= 	CrestData[CrestDataNum].R1Ram;
				params.u12 		= 	CrestData[CrestDataNum].R1Cat;

				t.sendMarch(params,t.Rounds,r,retry, CrestDataNum);
				break;
			default:
				var params 		= 	unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
				params.cid		= 	CrestData[CrestDataNum].CrestCity;
				params.type		= 	4;
				params.kid		= 	kid;
				params.xcoord 	= 	CrestData[CrestDataNum].X;
				params.ycoord 	= 	CrestData[CrestDataNum].Y;
				params.u1 		= 	CrestData[CrestDataNum].R2ST;
				params.u2 		= 	CrestData[CrestDataNum].R2MM;
				params.u3 		= 	CrestData[CrestDataNum].R2Scout;
				params.u4 		= 	CrestData[CrestDataNum].R2Pike;
				params.u5 		= 	CrestData[CrestDataNum].R2Sword;
				params.u6 		= 	CrestData[CrestDataNum].R2Arch;
				params.u7 		= 	CrestData[CrestDataNum].R2LC;
				params.u8 		= 	CrestData[CrestDataNum].R2HC;
				params.u9 		= 	CrestData[CrestDataNum].R2SW;
				params.u10 		= 	CrestData[CrestDataNum].R2Ball;
				params.u11 		= 	CrestData[CrestDataNum].R2Ram;
				params.u12 		= 	CrestData[CrestDataNum].R2Cat;
				t.sendMarch(params,t.Rounds,r,retry, CrestDataNum);
				break;
		}

	},



	toggleCrestState: function(obj) {
		var t = Tabs.Crest;
		obj = ById('Cresttoggle');
			if (Options.crestRunning == true) {
				Options.crestRunning = false;
				if (obj) obj.value = lang.crest.Cresttoggle+" = OFF";
				if (Options.BORac_Ts) updatebotbutton(lang.crest.button+' - OFF', 'pbautotstab');
				saveOptions();
			} else {
				Options.crestRunning = true;
				if (obj) obj.value = lang.crest.Cresttoggle+" = ON";
				if (Options.BORac_Ts) updatebotbutton(lang.crest.button+' - ON', 'pbautotstab');
				Options.Creststatus={1101:0,1102:0,1103:0,1104:0,1105:0,1106:0,1107:0,1108:0,1109:0,1110:0,1111:0,1112:0,1113:0,1114:0,1115:0,9:0,36:0,37:0,38:0,55:0,57:0,261:0,262:0,271:0,272:0,351:0,361:0,362:0,911:0,3000:0,3001:0,3002:0,3003:0,3007:0,3008:0,3009:0,3011:0,931:0,932:0,285:0,};
				for (crest in Options.Creststatus) {
					owned = Seed.items['i'+crest];
					if (owned == undefined) {
						owned=0;
					}
					Options.Creststatus[crest] = owned;
					Options.Crest1Count = 0;
					Options.Crest2Count = 0;
				}
				var now = new Date().getTime()/1000.0;
				now = now.toFixed(0);
				Options.LastCrestReport = now;
				saveOptions();
				t.timer =setTimeout(function(){ t.Rounds(1,0,0);}, 1000);
			}
	},
	 sendCrestReportNow: function(){
	    	var t = myBO.Crest;
	    	var now = new Date().getTime()/1000.0;
	        now = now.toFixed(0);
	    	var total = 0;
	    	var wildtype = '';

		var message = lang.crest.msg1+' %0A';
		message += '%0A '+lang.crest.msg2+'%0A';

		for (crest in Options.Creststatus) {
			owned = Seed.items['i'+crest];
			if (owned == undefined)
				owned =	0;
			if ((owned - Options.Creststatus[crest]) > 0)
				message	+= 	'<DIV><B>' + unsafeWindow.itemlist['i'+crest]['name'] +': '+ (owned - Options.Creststatus[crest]) +'%0A </b></div>';
			total += (owned - Options.Creststatus[crest]);
			Options.Creststatus[crest] = owned;

		}
		message += '%0A '+lang.crest.msg3+' ' + timestr(now-Options.LastCrestReport) + '%0A'
		message += '%0A '+lang.crest.msg4+' '+ total +'%0A';
		message += '%0A '+lang.crest.msg5+' '+ Options.Crest1Count +'%0A';
		message += ''+lang.crest.msg6+' '+ Options.Crest2Count +'%0A';

	    	Options.Crest1Count = 0;
	    	Options.Crest2Count = 0;
	    	Options.Crest3Count = 0;
	    	Options.Crest4Count = 0;
	      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	      params.emailTo = Seed.player['name'];
	      params.subject = lang.crest.msg7;
	      params.message = message;
	      params.requestType = "COMPOSED_MAIL";
	      new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
	          method: "post",
	          parameters: params,
	          onSuccess: function (message) {
	              var rslt = eval("(" + message.responseText + ")");
	              if (rslt.ok) {
	              		Options.LastCrestReport = now;
	              } else {
	              }
	          },
	          onFailure: function () {
	          },
	      });
	      saveOptions();
      },
	sendCrestReport: function(){
		if(!Options.crestreport || !CrestOptions.Running)
			return;

		var t = Tabs.Crest;
		var now = new Date().getTime()/1000.0;
		now = now.toFixed(0);

		if (now < (parseInt(Options.LastCrestReport)+(Options.CrestMsgInterval*60*60)))
			return;

		var total = 0;
		var wildtype = 	'';

		var message = 'Crest Stats: %0A';
		message += '%0A Crests Gained%0A';

		for (crest in Options.Creststatus) {
			owned = Seed.items['i'+crest];
			if (owned == undefined)
				owned =	0;
			if ((owned - Options.Creststatus[crest]) > 0)
				message	+= 	'<DIV><B>' + unsafeWindow.itemlist['i'+crest]['name'] +': '+ (owned - Options.Creststatus[crest]) +'%0A </b></div>';
			else
				message	+= 	unsafeWindow.itemlist['i'+crest]['name'] +': '+ (owned - Options.Creststatus[crest]) +'%0A';

			total += (owned - Options.Creststatus[crest]);
			Options.Creststatus[crest] = owned;
		}

		message += '%0A Total Crests gained: '+ total +'%0A';
		message += '%0A Numbers of 1st Wave send: '+ Options.Crest1Count +'%0A';
		message += 'Numbers of 2nd Wave send: '+ Options.Crest2Count +'%0A';

		Options.Crest1Count = 0;
		Options.Crest2Count = 0;

		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.emailTo = Seed.player['name'];
		params.subject = lang.crest.msg7;
		params.message = message;
		params.requestType = "COMPOSED_MAIL";

		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			onSuccess: function (message) {
				var rslt = eval("(" + message.responseText + ")");
				if (rslt.ok) {
					Options.LastCrestReport = now;
				}
			},
			onFailure: function () {
			},
		});

		saveOptions();
	},


	hide : function (){
		var t = Tabs.Crest;
	},

	show : function (){
	 var t = Tabs.Crest;
	if (ById ('maparea_map').style.display!="none") {
	         ById ('pbcrestx').value = ById ('mapXCoor').value;
                 ById ('pbcresty').value = ById ('mapYCoor').value;
                 CrestOptions.X = ById('pbcrestx').value;
                 CrestOptions.Y = ById('pbcresty').value;
         }
	},
 };
/** End Cresting tab **/

/*********************************** Players TAB ***********************************/
Tabs.AllianceList = {
  tabOrder: 5,
  tabLabel: uW.g_js_strings.commonstr.player,
  cont : null,
  nombre: null,
  state : null,
  dat : [],

  show : function (){
  },

  hide : function (){
  },

  init : function (div){
     var t = Tabs.AllianceList;
        t.cont = div;
        t.nombre=0;
        uW.BoPTgetMembers = t.eventGetMembers;
        uW.PTPaintMembers = t.GetDataForMap;
        uW.BoPTDme = t.eventGetLienMember;
        uW.BoPTpd = t.clickedPlayerDetail;
        uW.BoPTpl = t.clickedPlayerLeaderboard;
        uW.BoPTpl2 = t.clickedPlayerLeaderboard2;
        uW.BoPCplo = t.clickedPlayerGetLastLogin;
        uW.BoPTalClickPrev = t.eventListPrev;
        uW.BoPTalClickNext = t.eventListNext;

    if (t.state == null){
      if (getMyAlliance()[0] == 0) {
        t.cont.innerHTML = '<BR><BR><CENTER>'+uW.g_js_strings.membersInfo.youmustbelong+'</center>';
        t.state = 1;
        return;
      }
      var m = '<DIV class=ptentry><TABLE width=100% cellpadding=0>\
          <TR><TD class=xtab align=right></td><TD class=xtab>'+lang.AllianceList.allPlayName+' &nbsp;</td>\
            <TD width=80% class=xtab><INPUT id=allPlayName size=20 type=text/> &nbsp; <INPUT id=playSubmit type=submit value="'+uW.g_js_strings.modal_fow_leaderboard.searchuser+'" /></td>\
            <TD class="xtab ptErrText"><SPAN id=ptplayErr></span></td></tr>\
          <TR><TD class=xtab>&nbsp;</td><TD class=xtab>'+uW.g_js_strings.setDiplomacyWindow.srchalli+' : &nbsp;</td>\
            <TD class=xtab><INPUT id=allAllName type=text /> &nbsp; <INPUT id=allSubmit type=submit value="'+uW.g_js_strings.modal_fow_leaderboard.findalli+'" /></td>\
            <TD class="xtab ptErrText"><SPAN id=ptallErr></span></td></tr>\
            <TR><TD class=xtab>&nbsp;</td><TD class=xtab> &nbsp;\
            <INPUT align=left id=allListSubmit type=submit value="'+uW.g_js_strings.modal_alliance.allilist+'" /></td>\
            <TD class=xtab><INPUT align=right id=allGotoPage type=submit value="Page" />\
             <INPUT align=right id=idPageNum type="text" value='+t.curPage+' size=4 />\
             <INPUT align=left id="idMyAllSubmit" type=submit value="'+ getMyAlliance()[1] +'"/>\
             <INPUT align=left id="idMyTHSubmit" type=submit value="TOP 100"/>\
             <span align=right <b>'+uW.g_js_strings.commonstr.estimatedtime+' : </b></span></td>\
	                  <TD class=xtab ><div><select id="idFindETASelect">\
	             <option value="0" > -- -- </option>\
 	<option value="1" >'+uW.unitcost["unt1"][0]+'</option>\
        <option value="2" > '+uW.unitcost["unt2"][0]+' </option>\
        <option value="3" > '+uW.unitcost["unt3"][0]+' </option>\
        <option value="4" > '+uW.unitcost["unt4"][0]+' </option>\
        <option value="5" > '+uW.unitcost["unt5"][0]+' </option>\
        <option value="6" > '+uW.unitcost["unt6"][0]+' </option>\
        <option value="7" > '+uW.unitcost["unt7"][0]+' </option>\
        <option value="8" > '+uW.unitcost["unt8"][0]+' </option>\
        <option value="9" > '+uW.unitcost["unt9"][0]+' </option>\
        <option value="10" > '+uW.unitcost["unt10"][0]+' </option>\
        <option value="11" > '+uW.unitcost["unt11"][0]+' </option>\
        <option value="12" > '+uW.unitcost["unt12"][0]+' </option>\
        </select></div>\
        </td></tr>\
          </table><span style="vertical-align:middle;" id=altInput></span></div>\
          <SPAN id=allListOut></span>';
      t.cont.innerHTML = m;

      ById('allSubmit').addEventListener ('click', t.eventSubmit, false);
      ById('playSubmit').addEventListener ('click', t.eventPlayerSubmit, false);
      ById('allAllName').addEventListener ('focus', function (){ById('ptallErr').innerHTML='';}, false);
      ById('idMyTHSubmit').addEventListener ('click', t.eventListTHSubmit, false);
      ById('allPlayName').addEventListener ('focus', function (){ById('ptplayErr').innerHTML='';}, false);
      ById('allListSubmit').addEventListener ('click', t.eventListSubmit, false);
      ById('allGotoPage').addEventListener ('click', t.gotoPage, false);
      ById('idMyAllSubmit').addEventListener ('click', t.showMyAlliance, false);
      ById('allGotoPage').disabled = true;
      ById('idFindETASelect').addEventListener ('click', t.handleEtaSelect, false);
      ById('idFindETASelect').disabled = true;

      t.ModelCity=Cities.cities[0];
      t.curPage = 0;
      t.MaxPage = -1;
      t.state = 1;
    }
  },

  pName : '',
  eventPlayerSubmit : function (){
    var t = Tabs.AllianceList;
    ById('ptplayErr').innerHTML='';
    var name = ById('allPlayName').value;
     name = name.replace(/\'/g,"_");
    t.pName = name;
    if (name.length < 3){
      ById('ptplayErr').innerHTML = uW.g_js_strings.getAllianceSearchResults.entryatleast3;
      return;
    }
    ById('altInput').innerHTML = '';
     ById('allListOut').innerHTML = '<BR><BR><CENTER>'+uW.g_js_strings.commonstr.loadingddd+'</center>';
    t.fetchPlayerList (name, t.eventGotPlayerList);
  },
  eventGetLienMember: function(name) {
    var t = Tabs.AllianceList;
    ById('allPlayName').value = name;
    t.eventPlayerSubmit();
  },
  eventGotPlayerList : function (rslt){
    var t = Tabs.AllianceList;
    if (!rslt.ok){
      ById('allListOut').innerHTML = rslt.errorMsg;
      return;
    }
    t.playerList = rslt.matchedUsers;
        var uList = [];
        for (k in rslt.matchedUsers)
          uList.push (rslt.matchedUsers[k].userId);
          t.fetchPlayerStatus (uList, function(r) {t.eventGotPlayerOnlineList(r)});
      },

      eventGotPlayerOnlineList : function (rslt){
        var t = Tabs.AllianceList;
        if (!rslt.ok){
          ById('allListOut').innerHTML = rslt.errorMsg;
          return;
    }
    var m = '<DIV class=boStat>'+uW.g_js_strings.recommendSelectedFriends.playersrch+' : <b>"'+ t.pName +'"</b></div>\
      <DIV style="height:575px; max-height:575px; overflow-y:auto">\
      <TABLE width=95% align=center class=ptTab cellspacing=0><TR style="font-weight:bold"><TD width=20%>'+uW.g_js_strings.commonstr.nametx+'</td>\
      <TD align=right>'+uW.g_js_strings.commonstr.might+' &nbsp;&nbsp;&nbsp;&nbsp;</td><td>KOCMon<TD> &nbsp;'+uW.g_js_strings.commonstr.online+'</td><TD width=60%>'+lang.AllianceList.info+'</td></tr>';
    var row=0;
    var cl='';
    for (k in t.playerList){
      var u = t.playerList[k];
      if (++row % 2)
        cl = 'class=ptOddrow ';
      else
        cl = '';
        if (u.allianceName) { var alliancenammme=u.allianceName; }else {var alliancenammme="---"; }
      m += '<TR '+ cl +'valign=top><TD><A onclick="boshowthrone('+u.userId +');" href="javascript:void(0);">'+ u.genderAndName +'</a><br>'+alliancenammme+'<br><A target="_tab" href="http://www.facebook.com/profile.php?id='+ u.fbuid +'">profil</a></td><TD align=center>&nbsp;'+ addCommasInt(u.might) +'&nbsp;</td><td><a target=_blank href="http://kocmon.com/'+uW.domainName +'/players/'+ u.userId +'">KOCmon</a></td>\
          <TD>'+ (rslt.data[u.userId]?"&nbsp;<SPAN class=boldDarkRed>"+uW.g_js_strings.commonstr.online+"</span>":"") +'</td>\
         <TD><SPAN onclick="BoPTpd(this, '+ u.userId +')"><A>'+uW.g_js_strings.modaltitles.memberdetails+'</a> &nbsp; <BR></span><span onclick="BoPTpl2(this,'+ u.userId+','+rslt.data[u.userId]+')"><A>'+uW.g_js_strings.modaltitles.leaderboard+'</a></span>&nbsp;<br><SPAN onclick="BoPCplo(this, \''+ u.userId +'\')"><A>'+uW.g_js_strings.modal_messages_viewreports_view.lastlogin+'</a></span></td></tr>';
    }
    m += '</table></div>';
    ById('allListOut').innerHTML = m;
  },

  clickedPlayerDetail : function (span, uid){
    var t = Tabs.AllianceList;
    span.onclick = '';
    span.innerHTML = uW.g_js_strings.commonstr.search +': '+ uW.g_js_strings.modaltitles.memberdetails + " ...";
    t.fetchPlayerInfo (uid, function (r) {t.gotPlayerDetail(r, span)});
  },

  clickedPlayerLeaderboard : function (span, uid){
    var t = Tabs.AllianceList;
    span.onclick = '';
    span.innerHTML = uW.g_js_strings.commonstr.search +': '+ uW.g_js_strings.modaltitles.leaderboard + " ...";
    t.fetchLeaderboard (uid, function (r) {t.gotPlayerLeaderboard(r, span)});
  },
  clickedPlayerLeaderboard2 : function (span, uid,status){
      var t = Tabs.AllianceList;
    span.onclick = '';
    span.innerHTML = uW.g_js_strings.commonstr.search +': '+ uW.g_js_strings.modaltitles.leaderboard + " ...";
    t.fetchLeaderboard (uid, function (r) {t.gotPlayerLeaderboard2(r, span,uid,status)});
  },

   clickedPlayerGetLastLogin : function (span, uid){
      var t = Tabs.AllianceList;
      span.onclick = '';
      span.innerHTML = uW.g_js_strings.commonstr.search +': '+ uW.g_js_strings.modal_messages_viewreports_view.lastlogin + " ...";
      t.fetchPlayerLastLogin (uid, function (r) {t.gotPlayerLastLogin(r, span)});
    },
   gotPlayerLeaderboard2 : function (rslt,span,uid,status){
      var t = Tabs.AllianceList;
      if (!rslt.ok){
        span.innerHTML = rslt.errorMsg;
        return;
      }
      if (rslt.totalResults == 0){
        span.innerHTML = '<B>'+uW.g_js_strings.commonstr.leaderboard+': </b>'+uW.itemlist.i10021.name+'?<BR>';
        return;
      }
      var myA = getMyAlliance ();
      t.dat = [];
      var p = rslt.results[0];
          if ( myA[0] == p.allianceId)
             t.friendEta = true;
          else
             t.friendEta = false;
          for (var c=0; c<p.cities.length; c++){
                   t.dat.push ([p.displayName, parseInt(p.might), p.officerType, parseInt(p.numCities), parseInt(p.cities[c].tileLevel),
		                parseInt(p.cities[c].xCoord), parseInt(p.cities[c].yCoord), p.cities[c].cityName, 0, c, p.userId, p.avatarId, p.playerSex, p.rank, status, 'NA']);

          }
          t.setDistances (Cities.cities[0].x, Cities.cities[0].y);
          t.ModelCity=Cities.cities[0];
          t.setEta();
          t.fetchPlayerLastLogin (uid, function (r) {t.displayPlayer(p.allianceName,r)});
  },
  gotPlayerLeaderboard : function (rslt, span){
    var t = Tabs.AllianceList;
    if (!rslt.ok){
      span.innerHTML = rslt.errorMsg;
      return;
    }
    if (rslt.totalResults == 0){
      span.innerHTML =  '<B>'+uW.g_js_strings.commonstr.leaderboard+': </b>'+uW.itemlist.i10021.name+'?<BR>';
      return;
    }
    var p = rslt.results[0];
    var an = p.allianceName;
    if (!an || an=='' || p.officerType==4)
      an = 'Aucune';
    else
      an += ' ('+ officerId2String(p.officerType) +')';
    m = '<TABLE cellspacing=0 class=ptTab><TR><TD><B>'+uW.g_js_strings.commonstr.leaderboard+' : </b></td><TD colspan=2> '+uW.g_js_strings.commonstr.might+' : '+ p.might  +' &nbsp; '+uW.g_js_strings.commonstr.alliance+' : '+ an +'</td></tr>';
    for (var i=0; i<p.cities.length; i++){
      var c = p.cities[i];
      var created = '';
      if (c.dateCreated && c.dateCreated.substr(0,2)=='20')
        created = ' &nbsp; &nbsp; '+lang.AllianceList.add+' ' + c.dateCreated.substr(0,10);
      m += '<TR><TD align=right><B>'+uW.g_js_strings.commonstr.city+' #'+ (i+1) +':</b></td><TD> &nbsp; '+ c.cityName
        + '&nbsp;<a href="javascript:void(0)" onclick="cm.utils.CoordinateLinkController.onClick(event)" class="coordinateLink">('+ c.xCoord +',' +c.yCoord+ ')</a>'
        + '</td><TD width=75%> &nbsp; '+uW.g_js_strings.commonstr.level+' : '
        + c.tileLevel +' &nbsp; &nbsp; '+uW.g_js_strings.commonstr.status+': '+ cityStatusString (c.cityStatus) + created +'</td></tr>';
    }
    span.innerHTML = m + '</table>';
  },
 displayPlayer : function (allName,rslt){
   var t = Tabs.AllianceList;
    function alClickSort (e){
      var t = Tabs.AllianceList;
      var newColNum = e.id.substr(8);
      ById('clickCol'+t.sortColNum).className = 'clickable';
      e.className='clickable clickableSel';
      if (newColNum == t.sortColNum)
        t.sortDir *= -1;
      else
        t.sortColNum = newColNum;
      t.reDisp();
    }
    uW.PTalClickSort = alClickSort;
    var m = '<STYLE>.clickable{background-color:#ddd; border:2px outset; border-color:#555; padding-left:5px; padding-right:5px}\
            .clickableSel{background-color:#ffffcc;}\
            .xxtab{background-color:none; padding-left:5px; padding-right:5px;} </style>\
            <DIV class=boStat ><TABLE id=tabAllMembers cellpadding=0  width=100%><TR font-weight:bold"><TD class=xtab>'+uW.g_js_strings.commonstr.alliance+': '+ allName +'</td>\
              <TD class=xtab width=80% align=center>'+uW.g_js_strings.modal_messages_viewreports_view.lastlogin+' : <SPAN id=lastlogin>'+  rslt.playerInfo.lastLogin+'</span></td><TD class=xtab align=right></td></tr></table></div>\
      <div style="max-height:470px; height:470px; overflow-y:auto;"><TABLE id=tabAllMembers align=center cellpadding=0 cellspacing=0><THEAD style="overflow-y:hidden;">\
      <TR style="font-weight:bold"><TD id=clickCol0 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.commonstr.player+'</div></a></td>\
        <TD id=clickCol1 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>'+uW.g_js_strings.commonstr.rank+'</a></div></td>\
        <TD id=clickCol3 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.commonstr.cities+'</a></div></td>\
        <TD id=clickCol2 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>'+uW.g_js_strings.commonstr.alliance+'</a></div></td>\
        <TD id=clickCol9 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>'+uW.g_js_strings.commonstr.online+'</a></div></td>\
        <TD id=clickCol7 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.MapObject.cityname+'</a></div></td>\
        <TD id=clickCol4 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.commonstr.lvl+'</a></div></td>\
        <TD id=clickCol5 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.commonstr.coordinates+'</a></div></td>\
        <TD id=clickCol8 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.commonstr.distance+'</a></div></td>\
        <TD id=clickCol10 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.attack_generateincoming.estimatedarrival+'</a></div></td>\
		<TD class=clickable><A><DIV>'+uW.g_js_strings.modal_messages_viewreports_view.lastlogin+'</a></div></td></tr></thead>\
      <TBODY id=allBody style="background-color:#ffffff;"></tbody></table></div>\
      <DIV  width:100%; style="top:670px; left:0px; position:absolute; background-color:#ffffff; border-top:1px solid; margin-top:8px; color:#700; font-weight:bold;">';
    ById('allListOut').innerHTML = m;
    ById('altInput').innerHTML = '<HR><TABLE width=100% cellpaddding=0><TR align=center>\
        <TD class=xtab>'+uW.g_js_strings.commonstr.distance + ' ' + uW.g_js_strings.commonstr.from+' : &nbsp; X: <INPUT size=2 type=text id=plyrX /> Y: <INPUT size=2 type=text id=plyrY /> &nbsp; '+lang.AllianceList.orcity+' <span id=dmcoords></span></td></tr></table>';
    ById('clickCol'+t.sortColNum).className = 'clickable clickableSel';

    t.reDisp();
    new CdispCityPicker ('plyrdcp', document.getElementById ('dmcoords'), true, t.eventCoords, 0).bindToXYboxes(ById('plyrX'), ById('plyrY'));
    ById('idFindETASelect').disabled = false;
  },

  gotPlayerLastLogin : function (rslt, span){
    var t = Tabs.AllianceList;
    if (!rslt.ok){
      span.innerHTML = rslt.errorMsg;
      return;
    }

    var p = rslt.playerInfo;
    var lastLogin = rslt.playerInfo.lastLogin;

    if (lastLogin) {
      m = '<span style="color:blue">'+lastLogin+'</span>';
    } else {
       m = '<span style="color:red">-</span>';
    }
    span.innerHTML = m + '';
  },
  gotPlayerDetail : function (rslt, span){
    var t = Tabs.AllianceList;
    if (!rslt.ok){
      span.innerHTML = rslt.errorMsg;
      return;
    }
    var u = rslt.userInfo[0];
    var a = 'Aucune';
    if (u.allianceName)
      a = u.allianceName +' ('+ getDiplomacy(u.allianceId) + ')';
    var m = '<TABLE cellspacing=0 class=ptTab><TR><TD><B>Details :</b> &nbsp; </td><TD>'+uW.g_js_strings.commonstr.alliance+' : '+ a +' &nbsp; '+uW.g_js_strings.commonstr.cities+' : '
          + u.cities +' &nbsp; '+uW.g_js_strings.commonstr.population+' : '+ u.population +'</td></tr><TR><TD></td><TD>'+uW.g_js_strings.commonstr.province+' : ';
    var pids = u.provinceIds.split (',');
    var p = [];
    for (var i=0; i<pids.length; i++)
      p.push(uW.provincenames['p'+pids[i]]);
    span.innerHTML = m + p.join (', ') +'</td></tr></table>';
  },

  aName : '',
  eventSubmit : function (){
    var t = Tabs.AllianceList;
    ById('ptallErr').innerHTML='';
    t.aName = ById('allAllName').value;
    if (t.aName.length < 3){
      ById('ptallErr').innerHTML = uW.g_js_strings.getAllianceSearchResults.entryatleast3;
      return;
    }
    var myA = getMyAlliance ();
    ById('altInput').innerHTML = '';
    ById('allListOut').innerHTML = '<BR><BR><CENTER>'+uW.g_js_strings.commonstr.loadingddd+'...</center>';
    if (myA[0]!=0 && myA[1].toLowerCase().indexOf(t.aName.toLowerCase())>=0 )
      t.fetchAllianceList (t.aName, myA[0], t.eventGotAllianceList);
    else
      t.fetchAllianceList (t.aName, null, t.eventGotAllianceList);
  },
  eventListSubmit : function (){
    var t = Tabs.AllianceList;
    var myA = getMyAlliance ();
    ById('allListOut').innerHTML = '<BR><BR><CENTER>'+uW.g_js_strings.commonstr.loadingddd+'...</center>';
    if (myA[0]!=0  ) {
       t.curPage=1;
       t.fetchOtherAllianceInfo ( 1, t.eventGotOtherAlliancePage);
       ById('allGotoPage').disabled = false;
    }
    else {
       ById('allListOut').innerHTML =  uW.g_js_strings.membersInfo.youmustbelong;
    }
  },
  eventListTHSubmit : function (){
      var t = Tabs.AllianceList;
      ById('allListOut').innerHTML = '<BR><BR><CENTER>'+uW.g_js_strings.commonstr.loadingddd+'...</center>';
      t.fetchUserLeaderboard (1, t.eventGetUserLeaderboard);
  },
  eventGotAllianceList : function (rslt){
    var t = Tabs.AllianceList;
    if (!rslt.ok){
      ById('allListOut').innerHTML = rslt.errorMsg;
      return;
    }
    var m = '<DIV class=boStat>'+uW.g_js_strings.commonstr.alliances+' <B>"'+ t.aName +'"</b></div>\
    <TABLE><TR style="font-weight:bold"><TD class=xtab>'+uW.g_js_strings.commonstr.alliance+'</td><TD class=xtab>'+uW.g_js_strings.commonstr.rank+'</td><TD class=xtab>'+uW.g_js_strings.commonstr.members+'</td>\
        <TD align=right class=xtab>'+uW.g_js_strings.commonstr.might+'</td><TD class=xtab>'+uW.g_js_strings.getAllianceSearchResults.currdiplo+'</td><TD class=xtab>'+uW.g_js_strings.commonstr.members+'</td><TD class=xtab>'+uW.g_js_strings.commonstr.viewmap+'</td></tr>';
    for (k in rslt.alliancesMatched){
      var all = rslt.alliancesMatched[k];
      var dip = '';
      if (all.relation && all.relation==1)
        dip = 'Amicale';
      else if (all.relation && all.relation==2)
        dip = 'Hostile';
      m += '<TR  class="'+ dip + '"><TD class=xtab>'+ all.allianceName +'</td><TD align=right class=xtab>'+ all.ranking +'</td><TD align=right class=xtab>'+ all.membersCount +'</td>\
       <TD align=right class=xtab>'+ addCommasInt(all.might) +'</td><TD class=xtab>'+ dip +'</td>\
       <TD class=xtab><a onclick="BoPTgetMembers('+ all.allianceId +')">'+uW.g_js_strings.commonstr.members+'</a></td>\
       <TD class=xtab><a onclick="PTPaintMembers('+ all.allianceId +')">'+uW.g_js_strings.commonstr.viewmap+'</a></td></tr>';
    }
    ById('allListOut').innerHTML = m;
  },
  GetDataForMap : function (allianceId) {
    var t = Tabs.AllianceList;
    var params = uW.Object.clone(uW.g_ajaxparams);
    var Data=[];
    params.perPage = 100;
    params.allianceId = allianceId;
    new MyAjaxRequest(uW.g_ajaxpath + "ajax/getUserLeaderboard.php" + uW.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
      	var city = '';
      	for (var i=0; i<rslt.results.length; i++) {
      	    if (rslt.results[i]['userId'] !=0){
	      	    player = rslt.results[i]['cities'];
	      	    for (var ii=0; ii<player.length; ii++)
	      			Data.push ({X:player[ii]['xCoord'],Y:player[ii]['yCoord']});
	    	}
        }
        if (Data != []) t.PaintDataOnMap(Data);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },
  PaintDataOnMap : function(Data){
  		var provMapCoordsA = {imgWidth:710, imgHeight:708, mapWidth:670, mapHeight:670, leftMargin:31, topMargin:19};
  		var map = '<div style="overflow:auto; height:'+(Options.HauteurBoite-140)+'px;max-height:'+(Options.HauteurBoite-140)+'px;"><DIV id=ptAlliProvMap style="height:'+ provMapCoordsA.imgHeight +'px; width:'+ provMapCoordsA.imgWidth +'px; background-repeat:no-repeat; background-image:url(\''+ URL_PROVINCE_MAP +'\')"></div></div>';
		ById('allListOut').innerHTML = map;
		var eMap =  ById('ptAlliProvMap');
		for (var cc=0; cc<Seed.cities.length; cc++) {
		    var city = Seed.cities;
		    var Xplot = parseInt((provMapCoordsA.mapWidth * parseInt(city[cc][2])) / 750);
		    var Yplot = parseInt((provMapCoordsA.mapHeight * parseInt(city[cc][3])) / 750);
		    var cf = document.createElement ('div');
		    cf.style.background = 'black';
		    cf.style.opacity = '1.0';
		    cf.style.position='relative';
		    cf.style.display='block';
		    cf.style.width='14px';
		    cf.style.height='16px';
		    cf.style.border='1px solid #fff';
		    cf.style.color = 'white';
		    cf.style.textAlign = 'center';
		    cf.style.top = (Yplot+provMapCoordsA.topMargin-(cc*16)-8) +'px';
		    cf.style.left = (Xplot+provMapCoordsA.leftMargin-7) +'px';
		    cf.innerHTML = (cc+1) +'';
		    eMap.appendChild(cf);

		}
		for (var i=0;i<Data.length;i++) {
			var x = parseInt(Data[i]['X']);
			var y = parseInt(Data[i]['Y']);
  	        var xplot = parseInt((provMapCoordsA.mapWidth * x) / 750);
  	        var yplot = parseInt((provMapCoordsA.mapHeight * y) / 750);
  	    	var ce= document.createElement ('div');
  	    		ce.style.background = 'red';
  	    		ce.style.opacity = '1.0';
  	    		ce.style.position='relative';
  	    		ce.style.display='block';
  	    		ce.style.width='4px';
  	    		ce.style.height='4px';
  	    		ce.style.color = 'white';
  	    		ce.style.textAlign = 'center';
  	    	ce.style.top = (yplot+provMapCoordsA.topMargin -(4*i)-((Seed.cities.length)*18)) +'px';
  	    	ce.style.left = (xplot+provMapCoordsA.leftMargin -2) +'px';
  	    	ce.innerHTML = '<DIV onclick="ptGotoMap('+ x +','+ y +')">&nbsp;</div>';
  	        eMap.appendChild(ce);
  	   }
  },
 showMyAlliance : function (){
    var t = Tabs.AllianceList;
    var myA = getMyAlliance ();
    ById('allListOut').innerHTML = '<BR><BR><CENTER>'+uW.g_js_strings.commonstr.loadingddd+'...</center>';
    if (myA[0]!=0  ) {
       t.eventGetMembers(myA[0]);
    }
    else {
       ById('allListOut').innerHTML =  uW.g_js_strings.membersInfo.youmustbelong;
    }
  },
 curPage : 0,
  MaxPage : 0,

  eventListNext : function (amt){
    var t = Tabs.AllianceList;
    if( parseInt(amt) >= 9999 )
       t.curPage = t.MaxPage;
    else {
	    t.curPage = parseInt(t.curPage) + parseInt(amt);
	    if ( t.curPage > t.MaxPage) {
	      t.curPage = t.MaxPage;
	    }
    }
    ById('allListOut').innerHTML = '<BR><BR><CENTER> ...</center>';
    t.fetchOtherAllianceInfo (t.curPage, t.eventGotOtherAlliancePage);
  },

  eventListPrev : function (amt){
    var t = Tabs.AllianceList;
    if(amt <= -1)
       t.curPage = 1;
    else {
	    t.curPage-=amt;
	    if ( t.curPage < 1 ) {
	      t.curPage = 1;
	    }
    }
    ById('allListOut').innerHTML = '<BR><BR><CENTER> ...</center>';
    t.fetchOtherAllianceInfo (t.curPage, t.eventGotOtherAlliancePage);
  },

  gotoPage : function (){
    var t = Tabs.AllianceList;
    var val = ById('idPageNum').value;
    if (t.MaxPage < 0 ) {
      ById('allListOut').innerHTML = 'List Alliances first.';
      return;
    }
    if (t.MaxPage < 0 || val > t.MaxPage || val < 1) {
      ById('allListOut').innerHTML = 'Page number out of range';
      return;
    }
    t.curPage = val;
    ById('allListOut').innerHTML = '<BR><BR><CENTER> ...</center>';
    t.fetchOtherAllianceInfo (t.curPage, t.eventGotOtherAlliancePage);
  },

  eventGetUserLeaderboard: function(rslt) {
   var t = Tabs.AllianceList;
      if (!rslt.ok){
        ById('allListOut').innerHTML = rslt.errorMsg;
        return;
    }
    var m = '<div style="overflow:auto; height:'+(Options.HauteurBoite-145)+'px;max-height:'+(Options.HauteurBoite-145)+'px;"><TABLE width="100%"><thead><TR style="font-weight:bold"> \
          <th class=xtab>'+uW.g_js_strings.commonstr.ranking+'</th><th class=xtab>'+uW.g_js_strings.commonstr.nametx+'</th><th>Avatar</th><th class=xtab>'+uW.g_js_strings.commonstr.might+'</th>\
          <th class=xtab>'+uW.g_js_strings.commonstr.alliance+'</th><th class=xtab>'+uW.g_js_strings.commonstr.rank+'</th><th class=xtab>'+uW.g_js_strings.commonstr.cities+'</th></tr></thead><tbody>';
    ById('allListOut').innerHTML = m;
    for (var i=0; i<rslt.results.length; i++) {
     var resultat = rslt.results[i];

     m += '<TR class=xtab><TD class=xtab align=center><b>' + resultat.rank +'</b></td>\
                <td class=xtab><a onclick=BoPTDme("' + resultat.displayName +'");><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/avatars/25/' + resultat.playerSex + '' + resultat.avatarId + '.jpg"></a></td>\
     		<TD class=xtab>' + resultat.displayName +'</td>\
     		<td class=xtab>' + resultat.might + '</td>\
     		<td class=xtab><a onclick="BoPTgetMembers('+ resultat.allianceId +')">' + resultat.allianceName + '</a></td>\
     		<td class=xtab>' + officerId2String(resultat.officerType) + '</td><td class=xtab>' + resultat.numCities + '</td>\
     		</tr>';
     m += '</div>';
     ById('allListOut').innerHTML = m;
    }
  },
  fetchUserLeaderboard: function(pagNum, notify) {
        var t = Tabs.AllianceList;
        var params = uW.Object.clone(uW.g_ajaxparams);
        params.page = pagNum;
        params.perPage = 100;
        new MyAjaxRequest(uW.g_ajaxpath + "ajax/getUserLeaderboard.php" + uW.g_ajaxsuffix, {
          method: "post",
          parameters: params,
          onSuccess: function (rslt) {
            notify (rslt);
          },
          onFailure: function (rslt) {
            notify (rslt);
          },
      });
  },


  eventGotOtherAlliancePage : function (rslt){
    var t = Tabs.AllianceList;
    if (!rslt.ok){
      ById('allListOut').innerHTML = rslt.errorMsg;
      return;
    }

    ById('idPageNum').value = t.curPage;

    t.MaxPage=rslt.noOfPages;

    var m = '<div style="overflow:auto; height:'+(Options.HauteurBoite-230)+'px;width:95%;"><TABLE><thead><TR style="font-weight:bold"> \
   <th class=xtab>'+uW.g_js_strings.commonstr.rank+'</th><th class=xtab>'+uW.g_js_strings.modaltitles.alliance+'</th><th class=xtab>'+uW.g_js_strings.commonstr.chancellor+'</th><th class=xtab>'+uW.g_js_strings.commonstr.members+'</th>\
        <th align=right class=xtab>'+uW.g_js_strings.commonstr.might+'</th><th align=right class=xtab>'+uW.g_js_strings.commonstr.glory+'</th><th class=xtab>'+uW.g_js_strings.getAllianceSearchResults.currdiplo.substr(0,10)+'</th><th class=xtab>'+uW.g_js_strings.commonstr.members+'</th><th class=xtab>'+uW.g_js_strings.commonstr.viewmap+'</th></tr></thead><tbody>';
    ById('allListOut').innerHTML = m;

    for (var i=0; i<rslt.otherAlliances.length; i++) {
      var alliance = rslt.otherAlliances[i];
      var dip = '';
      dip = getDiplomacy(alliance.allianceId);

      m += '<TR class="'+ dip + '"><TD align=right class=xtab>'+ alliance.ranking +'</td><TD class=xtab>' + alliance.name +'</td><TD class=xtab>' + alliance.hostGenderAndName +'</td><TD align=right class=xtab>'+ alliance.membersCount +'</td>\
       <TD align=right class=xtab>'+ addCommasInt(alliance.might) +'</td><TD align=right class=xtab>'+ addCommasInt(alliance.glory) +'</td><TD class=xtab>'+ dip +'</td>\
       <TD class=xtab><a onclick="BoPTgetMembers('+ alliance.allianceId +')">'+uW.g_js_strings.commonstr.members+'</a></td>\
       <TD class=xtab><a onclick="PTPaintMembers('+ alliance.allianceId +')">'+uW.g_js_strings.commonstr.viewmap+'</a></td></tr>';
    }
    m += '</tbody></TABLE><div style="font-weight:bold; height:20px;width:95%;text-align:center;"><span><center><a onclick="BoPTalClickPrev(-1)"> ['+uW.g_js_strings.commonstr.first+'] </a><a onclick="BoPTalClickPrev(10)"> [-10] </a><a onclick="BoPTalClickPrev(5)"> [-5] </a><a onclick="BoPTalClickPrev(1)"> ['+uW.g_js_strings.commonstr.previous+'] </a> \
          <a onclick="BoPTalClickNext(1)"> ['+uW.g_js_strings.commonstr.next+'] </a><a onclick="BoPTalClickNext(5)"> [+5] </a><a onclick="BoPTalClickNext(10)"> [+10] </a><a onclick="BoPTalClickNext(9999)"> [End] </a> </span></div>';
    m += '</div>';
    ById('allListOut').innerHTML = m;
 },

  showCurrentPage : function (){
    var t = Tabs.AllianceList;
    var myA = getMyAlliance ();

    ById('allListOut').innerHTML = '<BR><BR><CENTER>'+uW.g_js_strings.commonstr.loadingddd+'...</center>';
    if (myA[0]!=0  ) {
       t.fetchOtherAllianceInfo ( t.curPage, t.eventGotOtherAlliancePage);
    }
    else {
       t.fetchOtherAllianceInfo ( t.curPage, t.eventGotOtherAlliancePage);
    }

  },


  eventGotMemberList : function (rslt){
     var t = Tabs.AllianceList;
     if (!rslt.ok){
       ById('allListOut').innerHTML = rslt.errorMsg;
       return;
     }
     t.memberListRslt = rslt;
     var uList = [];
     for (k in rslt.results)
       uList.push (rslt.results[k].userId);
     t.fetchPlayerStatus (uList, function(r){t.eventGotMemberOnlineList(r)});
   },

  eventGotMemberOnlineList : function (rslt){
    var t = Tabs.AllianceList;
    var numInvalid = 0;
    var numPlayers = 0;
    var myA = getMyAlliance ();
    t.dat = [];
    for (var i=0; i<t.memberListRslt.results.length; i++){
      p = t.memberListRslt.results[i];
      if (p.userId == 0){
        ++numInvalid;
      } else {
        ++numPlayers;
        if ( myA[0] == p.allianceId)
          t.friendEta = true;
	        else
           t.friendEta = false;
        for (var c=0; c<p.cities.length; c++){
           t.dat.push ([p.displayName, parseInt(p.might), p.officerType, parseInt(p.numCities), parseInt(p.cities[c].tileLevel),
               parseInt(p.cities[c].xCoord), parseInt(p.cities[c].yCoord), p.cities[c].cityName, 0, c, p.userId, p.avatarId, p.playerSex, p.rank, rslt.data[p.userId]?1:0, 'NA']);
        }
      }
    }
    t.setDistances (Cities.cities[0].x, Cities.cities[0].y);
    t.ModelCity=Cities.cities[0];
    t.setEta();
    t.displayMembers (t.memberListRslt.allianceName, numPlayers);
  },
  reDisp : function (){
    var t = Tabs.AllianceList;
    function sortFunc (a, b){
          var t = Tabs.AllianceList;
     if (typeof(a[t.sortColNum]) == 'number'){
             if (t.sortDir > 0)
               return a[t.sortColNum] - b[t.sortColNum];
             else
               return b[t.sortColNum] - a[t.sortColNum];
           } else if (typeof(a[t.sortColNum]) == 'boolean'){

     	return 0;
           } else {
             if (t.sortDir > 0)
               return a[t.sortColNum].localeCompare(b[t.sortColNum]);
             else
               return b[t.sortColNum].localeCompare(a[t.sortColNum]);
      }
    }
    t.dat.sort (sortFunc);
    var m = '';
    var tbody = ById('allBody');
    tbody.innerHTML ='';
    tbody.style.maxHeight = '';
    var csvXL="";
    for (var i=0; i<t.dat.length; i++){
    	if (i % 2 == 0) {
        		 tabclass = 'xxtab';
        	} else {
        		tabclass = 'xxtab_even';
    	}
        m += '<TR><TD  class='+ tabclass +' align=left><a onclick=BoPTDme("' +  t.dat[i][0] +'");><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/avatars/25/'+t.dat[i][12]+''+t.dat[i][11]+'.jpg" align=absmiddle></a>&nbsp;<a onclick=getInfoForAnUser("'+ t.dat[i][10] +'");>'+ t.dat[i][0] +'</a></td><TD align=right class='+ tabclass +'>'+ addCommasInt(t.dat[i][1]) +'</td><TD align=center class='+ tabclass +'>'+ t.dat[i][3] +'</td>\
	                <TD class='+ tabclass +' align=left><span title="Classement : '+t.dat[i][13]+' joueur">'+ officerId2String(t.dat[i][2])  +'</span></td><TD class='+ tabclass +' align=left>'+ (t.dat[i][14]?'<SPAN class=boldDarkRed>LIGNE</span>':'') +'</td><TD class='+ tabclass +' align=left><span title="'+ t.dat[i][7]+'">'+ t.dat[i][7].substring(0,8) +'</span></td><TD align=right class='+ tabclass +'>'+ t.dat[i][4] +'</td>\
	                <TD align=left class='+ tabclass +'>\
	                <a href="javascript:void(0)" onclick="cm.utils.CoordinateLinkController.onClick(event)" class="coordinateLink">('+ t.dat[i][5] +','+ t.dat[i][6] +')</a>\
	                </td><TD align=left class=xxtab style="padding-right:20px;">'+ t.dat[i][8].toFixed(2) +'</td>';
      	m += '<TD nowrap class=xxtab align=left>'+ (t.dat[i][15]?'<SPAN>'+ (t.dat[i][15]>0?timestr(t.dat[i][15],1):'NA') +'</span>':'<SPAN>NA</span>') +'</td><td class='+ tabclass +' align=left><SPAN onclick="BoPCplo(this, \''+ t.dat[i][10] +'\');"><A>?</a></span><td></tr>';
	csvXL += t.dat[i][0]+';'+t.dat[i][1]+';'+t.dat[i][5]+';'+t.dat[i][6]+';'+t.dat[i][4]+';'+t.dat[i][8]+';'+t.dat[i][7]+'\n';
    }
    m += '<tr><td colspan=11><textarea cols="55" rows="12" onclick="this.focus();this.select();" id="cutAndPaste" name="csv">Joueur;'+uW.g_js_strings.commonstr.might+';X;Y;Niveau;Distance;Ville\n'+csvXL+'</textarea><br><b>Export XLS (pour toi public:</b><bR>Copiez le contenu de la zone, coller ensuite le contenu dans blocnote et enregistrer le fichier en .cvs</tr>';

   var tbody = ById('allBody');
    tbody.style.maxHeight = '';
    tbody.innerHTML = m;
    ById("cutAndPaste").innerHTML=csvXL;
    if (parseInt(tbody.clientHeight) > 475){
      tbody.style.height = '475px';
      tbody.style.maxHeight = '475px';
    }
  },
  setDistances : function (x, y){
    var t = Tabs.AllianceList;
    for (var i=0; i<t.dat.length; i++)
      t.dat[i][8] = distance (x, y, t.dat[i][5], t.dat[i][6]);
  },
  friendEta:false,
  setEta : function (){
    var t = Tabs.AllianceList;
    for (var i=0; i<t.dat.length; i++) {
      if (t.dat[i][8]) {
        if (ById('idFindETASelect').value>0) {
         var eta = estETA(parseFloat(t.dat[i][8]), ById('idFindETASelect').value, t.ModelCity.id,4);
         if (t.friendEta)
           t.dat[i][15] = eta.friendETA;
         else
           t.dat[i][15] = eta.ETA;
        }
      }
    }
  },
  handleEtaSelect : function (){
    var t = Tabs.AllianceList;
    t.setEta();
    t.reDisp();
  },
  sortColNum : 1,
  sortDir : 1,
  displayMembers : function (allName, numPlayers){
    var t = Tabs.AllianceList;
    function alClickSort (e){
      var t = Tabs.AllianceList;
      var newColNum = e.id.substr(8);
      ById('clickCol'+t.sortColNum).className = 'clickable';
      e.className='clickable clickableSel';
      if (newColNum == t.sortColNum)
        t.sortDir *= -1;
      else
        t.sortColNum = newColNum;
      t.reDisp();
    }
    uW.PTalClickSort = alClickSort;
    var m = '<STYLE>.clickable{background-color:#ddd; border:2px outset; border-color:#555; padding-left:5px; padding-right:5px;}\
            .clickableSel{background-color:#ffffcc;}\
            .xxtab{background-color:none; padding-left:5px; padding-right:5px;} </style>\
      <DIV class=boStat><TABLE id=tabAllMembers cellpadding=0  width=100%><TR font-weight:bold"><TD class=xtab> &nbsp; '+ allName +'</td>\
        <TD class=xtab width=80% align=center>'+uW.g_js_strings.commonstr.distance + ' ' + uW.g_js_strings.commonstr.from+' <SPAN id=distFrom>'+ Cities.cities[0].name +' ('+ Cities.cities[0].x +','+ Cities.cities[0].y +')</span></td><TD class=xtab align=right>'+ numPlayers +' joueurs trouv&eacute;s &nbsp; </td></tr></table></div>';
     m += '<div style="width:800px;max-height:'+(Options.HauteurBoite-190)+'px;height:'+(Options.HauteurBoite-190)+'px;overflow:auto;">\
      <TABLE id=tabAllMembers align=center cellpadding=0 cellspacing=0><THEAD>\
      <TR style="font-weight:bold"><TD id=clickCol0 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.commonstr.player+'</div></a></td>\
        <TD id=clickCol1 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>'+uW.g_js_strings.commonstr.might+'</a></div></td>\
        <TD id=clickCol3 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.commonstr.cities+'</a></div></td>\
        <TD id=clickCol2 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>'+uW.g_js_strings.commonstr.rank+'</a></div></td>\
        <TD id=clickCol14 onclick="PTalClickSort(this)" class=clickable align=center><A><DIV>'+uW.g_js_strings.commonstr.online+'</a></div></td>\
        <TD id=clickCol7 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.MapObject.cityname+'</a></div></td>\
        <TD id=clickCol4 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.commonstr.lvl+'</a></div></td>\
        <TD id=clickCol5 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.commonstr.coordinates+'</a></div></td>\
        <TD id=clickCol8 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.commonstr.distance+'</a></div></td>\
        <TD id=clickCol15 onclick="PTalClickSort(this)" class=clickable><A><DIV>'+uW.g_js_strings.attack_generateincoming.estimatedarrival+'</a></div></td>\
        <TD class=clickable><A><DIV>'+uW.g_js_strings.modal_messages_viewreports_view.lastlogin+'</div></a></td></tr></thead>\
      <tbody id=allBody ></tbody></table></div>';
    ById('allListOut').innerHTML = m;
    ById('altInput').innerHTML = '<HR><TABLE width=100% cellpaddding=0><TR align=center>\
        <TD class=xtab>'+uW.g_js_strings.commonstr.distance + ' ' + uW.g_js_strings.commonstr.from+' : &nbsp; X: <INPUT size=2 type=text id="plyrX" /> Y: <INPUT size=2 type=text id="plyrY" /> &nbsp; '+lang.AllianceList.orcity+' <span id=dmcoords></span></td></tr></table>';
    ById('clickCol'+t.sortColNum).className = 'clickable clickableSel';
    t.reDisp();
    new CdispCityPicker ('plyrdcp', document.getElementById ('dmcoords'), true, t.eventCoords, 0).bindToXYboxes(ById('plyrX'), ById('plyrY'));
    ById('idFindETASelect').disabled = false;

 },

 eventCoords : function (city, x, y){
    var t = Tabs.AllianceList;
    var m = '';
    if (city != null)
      m = city.name +' ('+ city.x +','+ city.y +')';
    else
      m = x +','+ y;
    var distFrom = ById('distFrom');
    if (distFrom)
        distFrom.innerHTML = m;
    t.ModelCity=city;
    t.setDistances(x,y);
    t.setEta(x,y);
    t.reDisp();
  },

  eventGetMembers : function (aid){
    var t = Tabs.AllianceList;
    ById('allListOut').innerHTML = '<BR><BR><CENTER>'+uW.g_js_strings.commonstr.loadingddd+'...</center>';
    t.fetchAllianceMemberList (aid, null, t.eventGotMemberList);
  },

  fetchAllianceMemberList : function (allianceId, allianceName, notify) {
    var t = Tabs.AllianceList;
    var params = uW.Object.clone(uW.g_ajaxparams);
    params.perPage = 100;
    if (allianceName)
      params.allianceName = allianceName;
    if (allianceId && allianceId != 0)
      params.allianceId = allianceId;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserLeaderboard.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify (rslt);
      },
    });
  },


  fetchLeaderboard : function (uid, notify) {
    var t = Tabs.AllianceList;
    var params = uW.Object.clone(uW.g_ajaxparams);
    params.userId = uid;
    new MyAjaxRequest(uW.g_ajaxpath + "ajax/getUserLeaderboard.php" + uW.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify (rslt);
      },
    });
  },
  fetchAllianceList : function (allianceName, myAid, notify) {
    var t = Tabs.AllianceList;
    function combineResults (rsltA, rsltM, notify){
      if (!rsltA.ok){
        if (rsltA.msg.indexOf("No alliance found under")!=0 || !rsltM.ok){
          notify (rsltA);
          return;
        }
        rsltA.ok = true;
        rsltA.count = 0;
        rsltA.alliancesMatched = {};
      }
      if (rsltM.ok){
        rsltA.alliancesMatched['a'+rsltM.allianceInfo.allianceId] = {allianceId: rsltM.allianceInfo.allianceId, allianceName: rsltM.allianceInfo.allianceName,
              membersCount: rsltM.allianceInfo.members, relation: null, might: rsltM.allianceInfo.might, ranking: rsltM.allianceInfo.ranking};
        ++rsltA.count;
      }
      notify (rsltA);
    }
    var params = uW.Object.clone(uW.g_ajaxparams);
    params.allianceName = allianceName;
    new MyAjaxRequest(uW.g_ajaxpath + "ajax/allianceGetSearchResults.php" + uW.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (myAid!=null && myAid>0)
          t.fetchMyAllianceInfo  (function (r){ combineResults (rslt, r, notify)});
        else
          notify (rslt);
      },
      onFailure: function (rslt) {
        notify (rslt);
      },
    });
  },
  fetchOtherAllianceInfo : function (pageNum, notify){
    var params = uW.Object.clone(uW.g_ajaxparams);
    params.pageNo = pageNum;
    params.cityId = unsafeWindow.currentcityid;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetOtherInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onSuccess: function (rslt) {
        notify (rslt);
      },
    });
  },

  fetchMyAllianceInfo : function (notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onSuccess: function (rslt) {
        notify (rslt);
      },
    });
  },

  fetchPlayerList : function (name, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.searchName = name;
    params.subType = "ALLIANCE_INVITE";
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/searchPlayers.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onSuccess: function (rslt) {
        notify (rslt);
      },
    });
  },

  fetchPlayerInfo : function (uid, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.uid = uid;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserGeneralInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onSuccess: function (rslt) {
        notify (rslt);
      },
    });
  },
  fetchPlayerLastLogin : function (uid, notify){
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.pid = uid;
      new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/viewCourt.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function (rslt) {
          notify (rslt);
        },
        onSuccess: function (rslt) {
          notify (rslt);
        },
      });

  },
  fetchPlayerStatusSimple : function (uid, notify){
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.checkArr = uid;
        new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getOnline.php" + unsafeWindow.g_ajaxsuffix, {
          method: "post",
          parameters: params,
          onSuccess: function (rslt) {
            notify (rslt);
          },
          onSuccess: function (rslt) {
            notify (rslt);
          },
        });
    },

  fetchPlayerStatus : function (uidArray, notify){
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.checkArr = uidArray.join(',');
      new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getOnline.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function (rslt) {
          notify (rslt);
        },
        onFailure: function (rslt) {
          notify ({errorMsg:'AJAX error'});
        },
      });
  },

  ModelCity : {},

};


/*************** TRANSPORT **********/
Tabs.TranspAuto = {
 tabOrder: 6,
 tabLabel: lang.BoiteLabelTransport,
 cont : null,
 displayTimer : null,
 state : null,
 curTabBut : null,
 curTabName : null,
 sourceCity : {},
 destinationCity : {},
 rows : [],
  timer: null,
  traderState: [],
  reapproState: [],
  lTR: [],
  tradeRoutes: [],
  checkdotradetimeout: null,
  count:0,
  check:false,
 show : function (){
   var t = Tabs.TranspAuto;
   if (document.getElementById ('maparea_map').style.display!="none") {
     if (t.destinationCityx) {
                      t.destinationCityx.value = document.getElementById ('mapXCoor').value;
                      t.destinationCityy.value = document.getElementById ('mapYCoor').value;
                     }
   }
   if (t.curTabBut) {
    var but=t.curTabBut;
    t.show2();
   }
 },
 clickmap:function() {
  var t = Tabs.TranspAuto;
  if (document.getElementById ('maparea_map').style.display!="none") {
      if (t.destinationCityx) {
                       t.destinationCityx.value = document.getElementById ('mapXCoor').value;
                       t.destinationCityy.value = document.getElementById ('mapYCoor').value;
                      }
   }
 },
 hide : function (){
    var t = Tabs.TranspAuto;
    clearTimeout (t.displayTimer);
    clearTimeout (t.timer);
  },

  init : function (div){
   var t = Tabs.TranspAuto;
   unsafeWindow.BOestimeres = t.estimerRes;
   t.traderState = {running: false,};
   t.reapproState = {running: false,city:-1,unit:9,mini:1000};
   t.readTraderState();
   t.readReapproState();

   t.readTradeRoutes();
   t.e_tradeRoutes();


   if (Options.BORac_Trp) AddSubTabLink('Trp', t.toggleTraderState, 'pbtrantab');
   if (Options.BORac_App) AddSubTabLink('Appro', t.toggleReapproState, 'boreapprotab');

   if (Options.BORac_App){
   if (t.reapproState.running == false) {
       	       updatebotbutton(lang.transport.labAppro+' - OFF', 'boreapprotab');
             } else {
       	      updatebotbutton(lang.transport.labAppro+' - ON', 'boreapprotab');
       	      setTimeout(t.actionreappro,10000);
   }
   }
   if (Options.BORac_Trp) {
    if (t.traderState.running == false) {
       	       updatebotbutton(lang.transport.labTrp+' - OFF', 'pbtrantab');
             } else {
       	       updatebotbutton(lang.transport.labTrp+' - ON', 'pbtrantab');
     }
    }
    window.addEventListener('unload', t.onUnload, false);
    t.cont = div;
    t.cont.innerHTML = '<TABLE class=ptTab align=center><TR><TD><INPUT class=bopbSubtab ID=BoTrpSubM type=submit value="'+lang.transport.manu+'"></td>\
             <TD><INPUT class=bopbSubtab ID=BoTrpSubA type=submit  value="'+lang.transport.auto+'"></td><TD><INPUT class=bopbSubtab ID=BoTrpSubR type=submit  value="'+lang.transport.appro+'"></td></tr></table>\
         <DIV id="BoTrpOutput" style="margin-top:5px; background-color:white; height:'+(Options.HauteurBoite-65)+'px;max-height:'+(Options.HauteurBoite-65)+'px;overflow-y:auto"></div>';
        t.TransportDiv = ById('BoTrpOutput');
  ById('BoTrpSubA').addEventListener('click', e_butSubtab, false);
  ById('BoTrpSubM').addEventListener('click', e_butSubtab, false);
  ById('BoTrpSubR').addEventListener('click', e_butSubtab, false);
  changeSubtab (ById('BoTrpSubM'));
  function e_butSubtab (evt){
          changeSubtab (evt.target);
      }
  function changeSubtab (but){
          if (but == t.curTabBut)
            return;
          if (t.curTabBut){
            t.curTabBut.className='bopbSubtab';
            t.curTabBut.disabled=false;
          }
          t.curTabBut = but;
          but.className='bopbSubtab bopbSubtabSel';
          but.disabled=true;
          t.curTabName = but.id.substr(8);
          t.show2();
      }
      var final = 0;
      if (t.reapproState.city>=0) {
      for(var i=0; i<Cities.numCities; i++) {
          var x2 = parseInt(Cities.cities[i].x);
          var x1 = parseInt(Cities.cities[t.reapproState.city].x);
          var y2 = parseInt(Cities.cities[i].y);
          var y1 = parseInt(Cities.cities[t.reapproState.city].y);
          var dist = distance (x1, y1, x2, y2);
          var m = estETA(dist,t.reapproState.unit,Cities.cities[t.reapproState.city].id,1);
           if (m.friendETA>final)
            final=m.friendETA;
        }
        Options.reapprointerval = parseInt(final/60*2+10);
       }
  },
   show2 : function (){
     var t = Tabs.TranspAuto
     t.state = null;
     clearTimeout (t.displayTimer);
     clearTimeout (t.timer);
     if (t.curTabName == 'M')
       t.showManuel();
     else  if (t.curTabName == 'R')
       t.showReappro();
     else {
       t.showAuto();
       t.showTimer();
     }
  },
  showTimer: function() {
   var t = Tabs.TranspAuto;
   t.updateTroops();
   t.updateResources();
   t.timer = setTimeout (t.showTimer, 1000);
  },
  showReappro: function () {
   var t = Tabs.TranspAuto;
   var m = '<DIV id=pbTowrtDivF class=boStat>'+lang.transport.titleappro+' - <input type=button value="?" id=boaideappro class=boAide></div><TABLE id=pbtraderfunctions width=100% height=0% class=pbTab><TR align="center">';
   if (t.reapproState.running == false) {
               m += '<TD><INPUT id=boReapproState type=submit value="'+lang.transport.labAppro+' = OFF"></td>';
     	       if (Options.BORac_App) updatebotbutton(lang.transport.labAppro+' - OFF', 'boreapprotab');
           } else {
               m += '<TD><INPUT id=boReapproState type=submit value="'+lang.transport.labAppro+' = ON"></td>';
     	      if (Options.BORac_App) updatebotbutton(lang.transport.labAppro+' - ON', 'boreapprotab');
   }
   m += '<td><input type=button value="'+lang.transport.BORecupReappro+'" id=BORecupReappro></td><td><input type=button value="'+uW.g_js_strings.commonstr.save+'" id="boReappro"><td><span title="'+lang.transport.pninterval+'">'+lang.transport.pbreapprointerval+': <INPUT id=pbreapprointerval type=text size=2 READONLY value="'+Options.reapprointerval+'"\> '+lang.General.mins+'</td></tr></table>';
   m += '<DIV id=pbReapproDivDRoute class=boStat>'+lang.transport.titleappro2+'</div>';
   m += '<TABLE id=pbaddReapproroute width=95% height=0% class=pbTab><TR align="left">';
   m += '<TR align="left"><TD colspan=2>'+lang.transport.cityFrom+':</td> <TD colspan=3><DIV style="margin-bottom:10px;"><span id=borescity></span></div></td><td colspan=4>'+uW.g_js_strings.commonstr.troops+' : '
   m += '<select id="BOApproUnit">';
   m += '<option value=9>'+uW.unitcost['unt9'][0]+'</option><option value=7>'+uW.unitcost['unt7'][0]+'</option><option value=8>'+uW.unitcost['unt8'][0]+'</option>';
   m += '</select>&nbsp;Min : <input type=text size=5 value="0" id=BOApproMin></td></tr>';
   var Types = ['gold','food','wood','stone','iron','aetherstone'];
   m += '<TR align="left"><td colspan=2>'+lang.transport.labAppro+'</td>';
   for (var y=0; y< Seed.cities.length;y++)
    m += '<td>'+Seed.cities[y][1]+'</td>';
   for (var i=0;i<=5;i++) {
    m += '</tr><tr><td align=center valign=middle rowspan=2><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/'+Types[i]+'_30.png"></td><td>'+uW.g_js_strings.commonstr.inventory+'</td>';
    for (var y=0; y< Seed.cities.length;y++)
     m += '<td><span id="ReappRec_'+y+'_'+i+'"></span></td>';
    m += '</tr><tr><td>'+lang.transport.keepmin+'</td>';
        for (var y=0; y< Seed.cities.length;y++)
     m += '<td><input id="ReappRes_'+y+'_'+i+'" type=text size=10 maxlength=12 value=0></td>';
    m +='</tr>';
   }
   m += '</table>';
   t.TransportDiv.innerHTML = m;
   if (t.reapproState.city==undefined ||t.reapproState.city==-1) {

    t.reapproState.city=0;
   }
   ById('boaideappro').addEventListener('click', function(){
       	 window.open(sitesupport+"?page=aide_appro");
    	} , false);
   t.reacp = new CdispCityPicker ('botrader', ById('borescity'), true, t.updateResources2, t.reapproState.city);
   ById('BOApproMin').addEventListener('change', function(){
    t.reapproState.mini = ById('BOApproMin').value;
    t.saveReappro();
    }, false);
   ById('boReapproState').addEventListener('click', function(){t.toggleReapproState(this);}, false);
   ById('boReappro').addEventListener('click', function(){t.saveReappro();}, false);

   ById('pbreapprointerval').addEventListener('keyup', function(){
      		if (isNaN(ById('pbreapprointerval').value)){ ById('pbreapprointerval').value=60 ;}
      		Options.reapprointerval = ById('pbreapprointerval').value;
      		saveOptions();
   }, false);

   ById('BORecupReappro').addEventListener('click', function(){t.RecupReappro();}, false);
   ById('BOApproUnit').value = t.reapproState.unit;
   ById('BOApproMin').value = parseIntNan(t.reapproState.mini);
   ById('BOApproUnit').addEventListener('change', function(){
    t.reapproState.unit = ById('BOApproUnit').value;
    t.saveReappro();

   }, false);

   t.updateResources2();
  },
  RecupReappro:function() {
   var t = Tabs.TranspAuto;
   var r = t.tradeRoutes;
   for (var y=0; y< Seed.cities.length;y++) {
    for (var i=0;i<(r.length);i++) {
     if (parseInt(Seed.cities[y][0]) == r[i].city) {
   ById('ReappRes_'+y+'_0').value=r[i].target_Gold;
   ById('ReappRes_'+y+'_1').value=r[i].target_Food;
   ById('ReappRes_'+y+'_2').value=r[i].target_Wood;
   ById('ReappRes_'+y+'_3').value=r[i].target_Stone;
   ById('ReappRes_'+y+'_4').value=r[i].target_Ore;
   ById('ReappRes_'+y+'_5').value=r[i].target_Astone;

     }
    }
   }
   t.saveReappro();


  },
  saveReapproState: function(){
    var t = Tabs.TranspAuto;
    var serverID = getServerId();
    GM_setValue('reapproState_' + serverID, JSON2.stringify(t.reapproState));
  },
  saveReappro:function() {
   var t = Tabs.TranspAuto;
   for (var y=0; y< Seed.cities.length;y++) {
    t.reapproState['ReappRes_'+y+'_0'] = parseIntNan(ById('ReappRes_'+y+'_0').value);
    for (var i=1;i<=5;i++) {
     t.reapproState['ReappRes_'+y+'_'+i] = parseIntNan(ById('ReappRes_'+y+'_'+i).value);
    }
   }
   t.saveReapproState();
  },
  readReapproState: function(){
             var t = Tabs.TranspAuto;
             var serverID = getServerId();
             s = GM_getValue('reapproState_' + serverID);
             if (s != null) {
                 state = JSON2.parse(s);
                 for (k in state)
                     t.reapproState[k] = state[k];
             }
  },
  toggleReapproState: function(obj){
     	   var t = Tabs.TranspAuto;
     	   obj = ById('boReapproState');
             if (t.reapproState.running == true) {
                 t.reapproState.running = false;
                 if (obj)  obj.value = lang.transport.labAppro+' = OFF';
     	       if (Options.BORac_App) updatebotbutton(lang.transport.labAppro+' - OFF', 'boreapprotab');
     	      clearTimeout(t.checkdoreapprotimeout);
             }
             else {
                t.reapproState.running = true;
                if (obj) obj.value = lang.transport.labAppro+' = ON';
     		if (Options.BORac_App) updatebotbutton(lang.transport.labAppro+' - ON', 'boreapprotab');
     		t.actionreappro();
             }
  },
  retry:0,
  nbcity:-1,
  actionreappro:function() {
   var t = Tabs.TranspAuto;
   t.nbcity++;
   if (t.reapproState.running == false) {
     clearTimeout(t.checkdoreapprotimeout);
     return;
   }
   if (t.nbcity==t.reapproState.city)
   	t.nbcity++;
   var tempsprochainevisite = 10000;
   if ((Seed.cities.length-1)<t.nbcity) {
    tempsprochainevisite = Options.reapprointerval*60*1000;
    t.nbcity=-1;
   } else {
     var besoin=[0,0,0,0,0,0];
     var stock=[0,0,0,0,0,0];
     qtemin = parseIntNan(t.reapproState['ReappRes_'+t.nbcity+'_0']);
     qtest = parseIntNan(Seed.citystats["city" + Seed.cities[t.nbcity][0]]['gold'][0]);
     if (qtest<qtemin)
        besoin[0] = parseInt(qtemin - qtest);
     stock[0] = parseIntNan(Seed.citystats["city" + Seed.cities[t.reapproState.city][0]]['gold'][0]);
     for (var i=1;i<=5;i++) {
        qtemin = parseIntNan(t.reapproState['ReappRes_'+t.nbcity+'_'+i]);
        if(i==5) {
         qtest = parseInt(Seed.resources["city" + Seed.cities[t.nbcity][0]]['rec'+i][0]);
         qtstock = parseInt(Seed.resources["city" + Seed.cities[t.reapproState.city][0]]['rec'+i][0]);
        }else {
         qtest = parseInt(Seed.resources["city" + Seed.cities[t.nbcity][0]]['rec'+i][0]/3600);
         qtstock= parseInt(Seed.resources["city" + Seed.cities[t.reapproState.city][0]]['rec'+i][0]/3600);
        }
        if (qtest<qtemin)
        besoin[i] = parseInt(qtemin - qtest);
        stock[i] = qtstock;
     }
     var rallypointlevel = t.getRallypoint('city' + Cities.cities[t.reapproState.city].id);
     if(rallypointlevel == 12) rallypointlevel = 11;
     var slots = 0;
     var cityId = 'city'+ Cities.cities[t.reapproState.city].id;
     for (var k in Seed.queue_atkp[cityId]){
         	         march = Seed.queue_atkp[cityId][k];
         	         if (typeof (march) == 'object'){
         	           slots++;
         	         }
     }
     if(slots >= rallypointlevel){
      		actionLog("Appro","Transport from "+Cities.cities[t.reapproState.city].name+" to "+Cities.cities[t.nbcity].name+" <font color=red>Point de ralliement complet !</font>");
      		return;
     }
     if (besoin[0]>0 || besoin[1]>0|| besoin[2]>0 || besoin[3]>0 || besoin[4]>0 || besoin[5]>0) {
     if (besoin[0]<=stock[0] && besoin[1]<=stock[1] && besoin[2]<=stock[2] && besoin[3]<=stock[3] && besoin[4]<=stock[4] && besoin[5]<=stock[5]) {
          var unit = 'unt' + t.reapproState.unit
       	  Troops = parseInt(Seed.units['city' + Seed.cities[t.reapproState.city][0]][unit]);
       	     var untid=t.reapproState.unit;
	     var techLoadBoost=parseInt(Seed.tech.tch10)*0.1;
	     var loadEffectBoost=0;
	     if(Seed.playerEffects.loadExpire>uW.unixtime()){loadEffectBoost=0.25}
	     var loadBoostBase=(EffetTronePrc(6).percent*0.01)+loadEffectBoost+techLoadBoost;
	     var loadBoost=loadBoostBase;
	     if(uW.cm.unitFrontendType[untid]=="horsed"){
	       loadBoost+=(EffetTronePrc(48).percent*0.01)
	     }
       	  var LoadUnit=parseInt(parseInt(uW.unitstats["unt"+untid][5])*(1+loadBoost));
       	  TroopsNeeded = (besoin[0] + besoin[1] + besoin[2] + besoin[3] + besoin[4] + (besoin[5]*5))  / LoadUnit;
       	  TroopsNeeded = TroopsNeeded.toFixed(0);
       	  if (TroopsNeeded < ((besoin[0] + besoin[1] + besoin[2] + besoin[3] + besoin[4] + (besoin[5]*5))  / LoadUnit )) TroopsNeeded++;
       	  var rallypointlevel = t.getRallypoint('city' +Seed.cities[t.reapproState.city][0]);
  	  if (rallypointlevel == 11) rallypointlevel = 15;
	  if (rallypointlevel == 12) rallypointlevel = 20;
       	  if (parseInt(TroopsNeeded) > parseInt(rallypointlevel*10000)){
       	   TroopsNeeded = (rallypointlevel*10000);
       	   var lemax=LoadUnit*TroopsNeeded;
       	   var totalb=lemax;
       	   for (var i=1;i<=5;i++) {
       	    if (besoin[i]>=totalb)
       	    	besoin[i]=totalb;
       	    totalb=totalb-besoin[i];
       	   }
       	  }
       	  if (parseIntNan(TroopsNeeded)<=parseIntNan(Troops) && parseIntNan(TroopsNeeded)>=parseIntNan(t.reapproState.mini)) {
       	   var city = Seed.cities[t.reapproState.city][0]
       	   var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	   params.gold =besoin[0];
	   params.r1 =besoin[1];
	   params.r2 =besoin[2];
	   params.r3 =besoin[3];
	   params.r4 =besoin[4];
	   params.r5 =besoin[5];
   	   params.kid = 0;
   	   params.type = "1";
       	   params.cid=city;
       	   switch (unit){
	            case 'unt1': params.u1 = TroopsNeeded;break;
	            case 'unt2': params.u2 = TroopsNeeded;break;
	            case 'unt3': params.u3 = TroopsNeeded;break;
	            case 'unt4': params.u4 = TroopsNeeded;break;
	            case 'unt5': params.u5 = TroopsNeeded;break;
	            case 'unt6': params.u6 = TroopsNeeded;break;
	            case 'unt7': params.u7 = TroopsNeeded;break;
	            case 'unt8': params.u8 = TroopsNeeded;break;
	            case 'unt9': params.u9 = TroopsNeeded;break;
	            case 'unt10': params.u10 = TroopsNeeded;break;
	            case 'unt11': params.u11 = TroopsNeeded;break;
	            case 'unt12': params.u12 = TroopsNeeded;break;
           }
       	   params.xcoord = Seed.cities[t.nbcity][2];
   	   params.ycoord = Seed.cities[t.nbcity][3];

       	  new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
	                       method: "post",
	                       parameters: params,
	                       loading: true,
	                       onSuccess: function (transport) {
	                       var rslt = eval("(" + transport.responseText + ")");
	                       if (rslt.ok) {
	                       var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
	                       var ut = uW.unixtime();
	                       var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
	                       for(i = 0; i <= unitsarr.length; i++){
	                       	if(params["u"+i]){
	                       	unitsarr[i] = params["u"+i];
	                       	}
	                       }
	                       var resources=new Array();
	                       resources[0] = params.gold;
	                       for(i=1; i<=5; i++){
	                       	resources[i] = params["r"+i];
	                       }
	                       var currentcityid = city;
	                       uW.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
	                       uW.update_seed(rslt.updateSeed)
	                       if(rslt.updateSeed){uW.update_seed(rslt.updateSeed)};
	                        actionLog("Appro","Transport from "+Cities.cities[t.reapproState.city].name+" to "+Cities.cities[t.nbcity].name+" de "+TroopsNeeded+" "+uW.unitcost[unit][0]);
	                       } else {
	  			actionLog("Appro","Transport from "+Cities.cities[t.reapproState.city].name+" to "+Cities.cities[t.nbcity].name+" <font color=red>" + transport.responseText +"</font>");
	  			t.retry++;
	  			if (t.retry>4) {
	  			 t.retry=0;
	  			}else {
	  			 setTimeout(function() {t.nbcity--;t.actionreappro();},6000);
	  			}
	                       }
	                       },
	                       onFailure: function (rslt) {
	                       if (rslt.user_action) {
			       		actionLog("Appro","<b><font color=red>Captcha</font></b>");
			       	   new CdialogCancelContinue('<SPAN class=boldRed>CAPTCHA ALERT ! - Appro</span>', null, null, mainPop.getMainDiv());

				} else {
	                          actionLog("Appro","<font color=red>" + rslt.responseText +"</font>");
	                        }
	                       }
             });
       	  } else {
       	   //actionLog("Appro","Transport de "+Cities.cities[t.reapproState.city].name+" vers "+Cities.cities[t.nbcity].name+" : blocage troupes minimun");
       	  }
      } else {
       actionLog("Appro","Transport de "+Cities.cities[t.reapproState.city].name+" vers "+Cities.cities[t.nbcity].name+" : Stock insuffisant");
      }
     }
   }
   t.checkdoreapprotimeout = setTimeout(function() { t.actionreappro();}, tempsprochainevisite);
  },
  showAuto: function() {
   var t = Tabs.TranspAuto;
    var m = '<DIV id=pbTowrtDivF class=boStat>'+lang.transport.titleauto+'</div><TABLE id=pbtraderfunctions width=100% height=0% class=pbTab><TR align="center">';
         if (t.traderState.running == false) {
             m += '<TD><INPUT id=pbTraderState type=submit value="'+lang.transport.labTrp+' = OFF"></td>';
   	       if (Options.BORac_Trp) updatebotbutton(lang.transport.labTrp+' - OFF', 'pbtrantab');
         } else {
             m += '<TD><INPUT id=pbTraderState type=submit value="'+lang.transport.labTrp+' = ON"></td>';
   	      if (Options.BORac_Trp) updatebotbutton(lang.transport.labTrp+' - ON', 'pbtrantab');
         }
         m += '<TD><INPUT id=pbShowRoutes type=submit value="'+lang.transport.showRoutes+'"></td>';
         m += '</tr></table></div>';
         m += '<DIV id=pbTraderDivDRoute class=boStat>'+lang.transport.titleauto2+'</div>';
         m += '<TABLE id=pbtraderfunctions width=100% height=0% class=pbTab><TR align="left">';
   	 m += '<TD colspan=2>'+lang.transport.pbtransportinterval+' <INPUT id=pbtransportinterval type=text size=4 value="'+Options.transportinterval+'"\> '+lang.General.mins+'</td>';
         m += '<TD colspan=4>'+lang.transport.pbminwagons+' <INPUT id=pbminwagons type=text size=4 value="'+Options.minwagons+'"\> '+uW.g_js_strings.commonstr.troops+'</td></tr></table>';
         m += '</table>';
         m += '<DIV id=pbTraderDivDRoute class=boStat>'+lang.transport.titleauto3+'</div>';
         m += '<TABLE id=pbaddtraderoute width=95% height=0% class=pbTab><TR align="left">';
         m += '<TR align="left"><TD>'+lang.General.source+':</td> <TD colspan=4><DIV style="margin-bottom:10px;"><span id=ptrescity></span></div></td></tr>';

         m += '<TR align="left">';
         m += '<TD>'+lang.General.dest+':</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptcityTo></span></div></td>';
         m += '<TD>OU</td>';
         m += '<TD>X:<INPUT id=ptcityX type=text size=3\></td>';
         m += '<TD>Y:<INPUT id=ptcityY type=text size=3\></td></tr>';
         m += '<TABLE id=pbaddtraderoute height=0% class=pbTab><TR align="left">';
         m += '<TD width=75px>'+uW.g_js_strings.commonstr.troops+':</td><TD width=150px><SELECT id="TransportTroop">';
         for (y in uW.unitcost) m+='<option value="'+y+'">'+uW.unitcost[y][0]+'</option>';
         m+='</select></td><TD width=75px>'+lang.transport.TroopAmount+':&nbsp;</td><TD id=TroopAmount align=left width=75px></td>';
         m+='<TD width=75px>'+lang.transport.CarryAmount+':&nbsp;</td><TD id=CarryAmount align=left width=75px></td>';
         m += '<TR><TD >'+uW.g_js_strings.commonstr.troops+' : </td><TD><INPUT id=TroopsToSend type=text size=6 maxlength=6 value="0">&nbsp;&nbsp;<INPUT id=MaxTroops type=submit value="Max"></td>';
         m += '<TD width=50px><INPUT id=FillInMax type=submit value="<----"></td>';
         m +='<TD id=Calc colspan=3></td></tr>';
         m += '<TABLE id=pbaddtraderoute height=0% class=pbTab><TR align="center">';
         m += '<TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/food_30.png"></td>';
         m += '<TD id=TransRec1 align=right width=110px></td>';
         m += '<TD id=HaveRec1 align=right width=110px></td>';
         m += '<TD width=55px align=right><INPUT id=pbshipFood type=checkbox unchecked=true\></td>';
         m += '<TD width=180px  align=left>'+lang.transport.keep+': <INPUT id=pbtargetamountFood type=text size=11 maxlength=12 value="0" disabled=true\></td>';
         m += '<TD width=100px>'+lang.transport.trade+': <INPUT id=pbtradeamountFood type=text size=11 maxlength=12 value="0"\></td>';
         m += '<TD width=50px><INPUT id=MaxFood type=submit value="Max"></td></tr>';
         m += '<TR align="center">';
         m += '<TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/wood_30.png"></td>';
         m += '<TD id=TransRec2 align=right width=110px></td>';
         m += '<TD id=HaveRec2 align=right width=110px></td>';
         m += '<TD width=55px align=right><INPUT id=pbshipWood type=checkbox unchecked=true\></td>';
         m += '<TD width=180px align=left>'+lang.transport.keep+': <INPUT id=pbtargetamountWood type=text size=11 maxlength=12 value="0" disabled=true\></td>';
         m += '<TD width=100px>'+lang.transport.trade+': <INPUT id=pbtradeamountWood type=text size=11 maxlength=12 value="0"\></td>';
         m += '<TD width=50px><INPUT id=MaxWood type=submit value="Max"></td></tr>';
         m += '<TR align="center">';
         m += '<TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/stone_30.png"></td>';
         m += '<TD id=TransRec3 align=right width=110px></td>';
         m += '<TD id=HaveRec3 align=right width=110px></td>';
         m += '<TD width=55px align=right><INPUT id=pbshipStone type=checkbox unchecked=true\></td>';
         m += '<TD width=180px align=left>'+lang.transport.keep+': <INPUT id=pbtargetamountStone type=text size=11 maxlength=12 value="0" disabled=true\></td>';
         m += '<TD width=100px>'+lang.transport.trade+': <INPUT id=pbtradeamountStone type=text size=11 maxlength=12 value="0"\></td>';
         m += '<TD width=50px><INPUT id=MaxStone type=submit value="Max"></td></tr>';
         m += '<TR align="center">';
         m += '<TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/iron_30.png"></td>';
         m += '<TD id=TransRec4 align=right width=110px></td>';
         m += '<TD id=HaveRec4 align=right width=110px></td>';
         m += '<TD width=55px align=right><INPUT id=pbshipOre type=checkbox unchecked=true\></td>';
         m += '<TD width=180px align=left>'+lang.transport.keep+': <INPUT id=pbtargetamountOre type=text size=11 maxlength=12 value="0" disabled=true\></td>';
         m += '<TD width=100px>'+lang.transport.trade+': <INPUT id=pbtradeamountOre type=text size=11 maxlength=12 value="0"\></td>';
         m += '<TD width=50px><INPUT id=MaxOre type=submit value="Max"></td></tr>';
          m += '<TR align="center">';
      m += '<TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/aetherstone_30.png"></td>';
      m += '<TD id=TransRec5 align=right width=110px></td>';
      m += '<TD id=HaveRec5 align=right width=110px></td>';
      m += '<TD width=55px align=right><INPUT id=pbshipAstone type=checkbox unchecked=true\></td>';
      m += '<TD width=180px align=left>'+lang.transport.keep+': <INPUT id=pbtargetamountAstone type=text size=11 maxlength=12 value="0" disabled=true\></td>';
      m += '<TD width=100px>'+lang.transport.trade+': <INPUT id=pbtradeamountAstone type=text size=11 maxlength=12 value="0"\></td>';
      m += '<TD width=50px><INPUT id=MaxAstone type=submit value="Max"></td></tr>';
      m += '<TR align="center">';
         m += '<TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/gold_30.png"></td>';
         m += '<TD id=TransGold align=right width=110px></td>';
         m += '<TD id=HaveGold align=right width=110px></td>';
         m += '<TD width=55px align=right><INPUT id=pbshipGold type=checkbox unchecked=true\></td>';
         m += '<TD width=180px align=left>'+lang.transport.keep+': <INPUT id=pbtargetamountGold type=text size=11 maxlength=12 value="0" disabled=true\></td>';
         m += '<TD width=100px>'+lang.transport.trade+': <INPUT id=pbtradeamountGold type=text size=11 maxlength=12 value="0"\></td>';
         m += '<TD width=50px><INPUT id=MaxGold type=submit value="Max"></td></tr>';

         m += '</table>';

         m += '<DIV style="text-align:center; margin-top:15px"><INPUT id=pbSaveRoute type=submit value="'+lang.transport.pbSaveRoute+'"><INPUT id=pbManualSend type=submit value="'+lang.transport.pbManualSend+'"></div>';
         m += '<DIV id=errorSpace></div>'

  	 t.TransportDiv.innerHTML = m;

    ById('TransportTroop').value = 'unt9';

         t.tcp = new CdispCityPicker ('pttrader', ById('ptrescity'), true, t.updateResources, 0);
         t.tcpto = new CdispCityPicker ('pttraderTo', ById('ptcityTo'), true, t.clickCitySelect).bindToXYboxes(document.getElementById ('ptcityX'), document.getElementById ('ptcityY'));


       ById('TransportTroop').addEventListener('change', function(){t.updateTroops();}, false);
         ById('pbTraderState').addEventListener('click', function(){t.toggleTraderState(this);}, false);
         ById('pbSaveRoute').addEventListener('click', function(){t.addTradeRoute();}, false);
         ById('pbManualSend').addEventListener('click', function(){t.ManualTransport();}, false);
         ById('pbShowRoutes').addEventListener('click', function(){t.showTradeRoutes();}, false);
         ById('FillInMax').addEventListener('click', function(){ById('TroopsToSend').value = t.TroopsNeeded;}, false);

         ById('MaxTroops').addEventListener('click', function(){
   			var rallypointlevel = t.getRallypoint('city' + t.tcp.city.id);
   			if (rallypointlevel == 11) rallypointlevel = 15;
   			if (rallypointlevel == 12) rallypointlevel = 20;
   			var max = t.Troops;
   			if (t.Troops > (rallypointlevel*10000) ) max = (rallypointlevel*10000);
   			ById('TroopsToSend').value = max;
   	  }, false);
         ById('MaxFood').addEventListener('click', function(){
         		t.Food = 0;
   			var input = t.MaxLoad - (t.Food + t.Wood + t.Stone + t.Ore + t.Gold + t.Astone);
         		ById('pbtradeamountFood').value = (parseInt(input) <= parseIntCommas(ById('TransRec1').innerHTML))?input:parseIntCommas(ById('TransRec1').innerHTML);
         }, false);
         ById('MaxWood').addEventListener('click', function(){
         		t.Wood = 0;
   			var input = t.MaxLoad - (t.Food + t.Wood + t.Stone + t.Ore + t.Gold + t.Astone);
         		ById('pbtradeamountWood').value = (parseInt(input) <= parseIntCommas(ById('TransRec2').innerHTML))?input:parseIntCommas(ById('TransRec2').innerHTML);
         }, false);
         ById('MaxStone').addEventListener('click', function(){
         		t.Stone = 0;
   			var input = t.MaxLoad - (t.Food + t.Wood + t.Stone + t.Ore + t.Gold + t.Astone);
         		ById('pbtradeamountStone').value = (parseInt(input) <= parseIntCommas(ById('TransRec3').innerHTML))?input:parseIntCommas(ById('TransRec3').innerHTML);
         }, false);
         ById('MaxOre').addEventListener('click', function(){
         		t.Ore = 0;
   			var input = t.MaxLoad - (t.Food + t.Wood + t.Stone + t.Ore + t.Gold + t.Astone);
         		ById('pbtradeamountOre').value = (parseInt(input) <= parseIntCommas(ById('TransRec4').innerHTML))?input:parseIntCommas(ById('TransRec4').innerHTML);
         }, false);
         ById('MaxGold').addEventListener('click', function(){
   			t.Gold = 0;
   			var input = t.MaxLoad - (t.Food + t.Wood + t.Stone + t.Ore + t.Gold + t.Astone);
         		ById('pbtradeamountGold').value = (parseInt(input) <= parseIntCommas(ById('TransGold').innerHTML))?input:parseIntCommas(ById('TransGold').innerHTML);
         }, false);
   	   ById('MaxAstone').addEventListener('click', function(){
         		t.Astone = 0;
   			var input = t.MaxLoad - (t.Food + t.Wood + t.Stone + t.Ore + t.Gold + t.Astone);
         		ById('pbtradeamountAstone').value = (parseInt(input) <= parseIntCommas(ById('TransRec5').innerHTML))?input:parseIntCommas(ById('TransRec5').innerHTML);
         }, false);

         ById('pbtransportinterval').addEventListener('keyup', function(){
   		if (isNaN(ById('pbtransportinterval').value)){ ById('pbtransportinterval').value=60 ;}
   		Options.transportinterval = ById('pbtransportinterval').value;
   		saveOptions();
         }, false);

         ById('pbtargetamountFood').addEventListener('keyup', function(){
             if (isNaN(ById('pbtargetamountFood').value)) ById('pbtargetamountFood').value=0 ;
         }, false);
         ById('pbtargetamountWood').addEventListener('keyup', function(){
             if (isNaN(ById('pbtargetamountWood').value)) ById('pbtargetamountWood').value=0 ;
         }, false);
         ById('pbtargetamountStone').addEventListener('keyup', function(){
             if (isNaN(ById('pbtargetamountStone').value)) ById('pbtargetamountStone').value=0 ;
         }, false);
         ById('pbtargetamountOre').addEventListener('keyup', function(){
             if (isNaN(ById('pbtargetamountOre').value)) ById('pbtargetamountOre').value=0 ;
         }, false);
   	  ById('pbtargetamountAstone').addEventListener('keyup', function(){
             if (isNaN(ById('pbtargetamountAstone').value)) ById('pbtargetamountAstone').value=0 ;
         }, false);
         ById('pbtargetamountGold').addEventListener('keyup', function(){
             if (isNaN(ById('pbtargetamountGold').value)) ById('pbtargetamountGold').value=0 ;
         }, false);
         ById('pbtradeamountFood').addEventListener('keyup', function(){
             if (isNaN(ById('pbtradeamountFood').value)) ById('pbtradeamountFood').value=0 ;
         }, false);
         ById('pbtradeamountWood').addEventListener('keyup', function(){
             if (isNaN(ById('pbtradeamountWood').value)) ById('pbtradeamountWood').value=0 ;
         }, false);
         ById('pbtradeamountStone').addEventListener('keyup', function(){
             if (isNaN(ById('pbtradeamountStone').value)) ById('pbtradeamountStone').value=0 ;
         }, false);
         ById('pbtradeamountOre').addEventListener('keyup', function(){
             if (isNaN(ById('pbtradeamountOre').value)) ById('pbtradeamountOre').value=0 ;
         }, false);
   	  ById('pbtradeamountAstone').addEventListener('keyup', function(){
             if (isNaN(ById('pbtradeamountAstone').value)) ById('pbtradeamountAstone').value=0 ;
         }, false);
         ById('pbtradeamountGold').addEventListener('keyup', function(){
             if (isNaN(ById('pbtradeamountGold').value)) ById('pbtradeamountGold').value=0 ;
         }, false);
        ById('pbminwagons').addEventListener('keyup', function(){
            if (isNaN(ById('pbminwagons').value)) ById('pbminwagons').value=100 ;
            Options.minwagons = parseInt(ById('pbminwagons').value);
            saveOptions();
        }, false)

         ById('pbshipFood').addEventListener('click', function(){
             if (ById('pbshipFood').checked==false) {
                 ById('pbtargetamountFood').disabled = true;
             }
             else {
               ById('pbtargetamountFood').disabled = false;
             }
         },false);
         ById('pbshipWood').addEventListener('click', function(){
             if (ById('pbshipWood').checked==false) {
                 ById('pbtargetamountWood').disabled = true;
             }
             else {
               ById('pbtargetamountWood').disabled = false;
             }
         },false);
         ById('pbshipStone').addEventListener('click', function(){
             if (ById('pbshipStone').checked==false) {
                 ById('pbtargetamountStone').disabled = true;
             }
             else {
               ById('pbtargetamountStone').disabled = false;
             }
         },false);
         ById('pbshipOre').addEventListener('click', function(){
             if (ById('pbshipOre').checked==false) {
                 ById('pbtargetamountOre').disabled = true;
             }
             else {
               ById('pbtargetamountOre').disabled = false;
             }
         },false);
   	   ById('pbshipAstone').addEventListener('click', function(){
             if (ById('pbshipAstone').checked==false) {
                 ById('pbtargetamountAstone').disabled = true;
             }
             else {
               ById('pbtargetamountAstone').disabled = false;
             }
         },false);
          ById('pbshipGold').addEventListener('click', function(){
             if (ById('pbshipGold').checked==false) {
                 ById('pbtargetamountGold').disabled = true;
             }
             else {
               ById('pbtargetamountGold').disabled = false;
             }
         },false);

       },
       updateResources2 : function (){
       var t = Tabs.TranspAuto
       t.reapproState.city = t.reacp.city.idx;
       for (var y=0; y< Seed.cities.length;y++) {
         if (t.reacp.city.id==Seed.cities[y][0]) {
          ById('ReappRes_'+y+'_0').value="0";
          ById('ReappRes_'+y+'_0').disabled=true;
         }else {
          ById('ReappRes_'+y+'_0').disabled=false;
          ById('ReappRes_'+y+'_0').value=parseIntNan(t.reapproState['ReappRes_'+y+'_0']);
          ById('ReappRec_'+y+'_0').innerHTML = addCommas ( parseIntNan(Seed.citystats["city" + Seed.cities[y][0]]['gold'][0]) );
          }
         for (var i=1;i<=5;i++) {
          if (t.reacp.city.id==Seed.cities[y][0]) {
            ById('ReappRes_'+y+'_'+i).value="0";
            ById('ReappRes_'+y+'_'+i).disabled=true;
          } else{
            ById('ReappRes_'+y+'_'+i).value= parseIntNan(t.reapproState['ReappRes_'+y+'_'+i]);
            ById('ReappRes_'+y+'_'+i).disabled=false;
          }
          if(i==5)
              ById('ReappRec_'+y+'_'+i).innerHTML = addCommas ( parseIntNan(Seed.resources["city" + Seed.cities[y][0]]['rec'+i][0]) );
          else
              ById('ReappRec_'+y+'_'+i).innerHTML = addCommas ( parseIntNan(Seed.resources["city" + Seed.cities[y][0]]['rec'+i][0]/3600));
         }

       }

       },
       updateResources : function (){
       	var t = Tabs.TranspAuto
       	var ToCity = null;
       	for (var i=1;i<=5;i++)
   			if(i==5)
   			   ById('TransRec'+i).innerHTML = addCommas ( parseInt(Seed.resources["city" + t.tcp.city.id]['rec'+i][0]) );
   			else
                          ById('TransRec'+i).innerHTML = addCommas ( parseInt(Seed.resources["city" + t.tcp.city.id]['rec'+i][0]/3600) );
       	ById('TransGold').innerHTML = addCommas ( parseInt(Seed.citystats["city" + t.tcp.city.id]['gold'][0]) );
       	for (ii in Seed.cities)
           if (Seed.cities[ii][2] == document.getElementById ('ptcityX').value && Seed.cities[ii][3] == document.getElementById ('ptcityY').value)
             ToCity = Seed.cities[ii][0];
         for (var i=1;i<=5;i++)
             if (ToCity != null)
   			if(i==5)
   			   ById('HaveRec'+i).innerHTML = addCommas ( parseInt(Seed.resources["city" + ToCity]['rec'+i][0]) );
   			else
                  ById('HaveRec'+i).innerHTML = addCommas ( parseInt(Seed.resources["city" + ToCity]['rec'+i][0]/3600) );
       	  else ById('HaveRec'+i).innerHTML = "----";
         if (ToCity != null) ById('HaveGold').innerHTML = addCommas ( parseInt(Seed.citystats["city" + ToCity]['gold'][0]) );
         else  ById('HaveGold').innerHTML =  "----";
       },

       updateTroops : function (city){
       	var t = Tabs.TranspAuto;
       	var fontcolor = 'black';
       	t.Food = parseInt(ById('pbtradeamountFood').value);
         	t.Wood = parseInt(ById('pbtradeamountWood').value);
         	t.Stone = parseInt(ById('pbtradeamountStone').value);
         	t.Ore = parseInt(ById('pbtradeamountOre').value);
         	t.Gold = parseInt(ById('pbtradeamountGold').value);
   		t.Astone = parseInt(ById('pbtradeamountAstone').value*5);
       	var unit = ById('TransportTroop').value;
       	t.Troops = parseInt(Seed.units['city' + t.tcp.city.id][unit]);
      	var untid=ById('TransportTroop').value;
	var techLoadBoost=parseInt(Seed.tech.tch10)*0.1;
	var loadEffectBoost=0;
	if(Seed.playerEffects.loadExpire>uW.unixtime()){loadEffectBoost=0.25}
	var loadBoostBase=(EffetTronePrc(6).percent*0.01)+loadEffectBoost+techLoadBoost;
	var loadBoost=loadBoostBase;
	if(uW.cm.unitFrontendType[untid]=="horsed"){
	 loadBoost+=(EffetTronePrc(48).percent*0.01)
	}

        var LoadUnit=parseInt(parseInt(uW.unitstats[untid][5])*(1+loadBoost));
       	var GlobalMaxLoad = t.Troops * LoadUnit;
       	t.MaxLoad = parseInt(ById('TroopsToSend').value) * LoadUnit;
        	t.TroopsNeeded = (t.Food + t.Wood + t.Stone + t.Ore + t.Gold + t.Astone) / LoadUnit;
        	t.TroopsNeeded = t.TroopsNeeded.toFixed(0);
   		if (t.TroopsNeeded < ((t.Food + t.Wood + t.Stone + t.Ore + t.Gold + t.Astone) / LoadUnit)) t.TroopsNeeded++;

           if ( t.TroopsNeeded > t.Troops) fontcolor = 'red';
       	if (t.Troops > 0 ) ById('TroopAmount').innerHTML = '<FONT color='+fontcolor+'>' + addCommas(t.Troops) + '</font>';
       	else ById('TroopAmount').innerHTML = 0;
       	if (GlobalMaxLoad > 0) ById('CarryAmount').innerHTML = addCommas(GlobalMaxLoad);
       	else  ById('CarryAmount').innerHTML = 0;
       	ById('Calc').innerHTML = uW.g_js_strings.commonstr.resource+': ' +  addCommas(t.Food + t.Wood + t.Stone + t.Ore + t.Gold  + t.Astone) + ' / ' + addCommas(t.MaxLoad) + '&nbsp;&nbsp;('+lang.transport.TroopsNeeded+' <FONT color='+fontcolor+'>' + addCommas(t.TroopsNeeded) + '</font> )' ;
       },
       getRallypoint: function(cityId){
         var t = Tabs.TranspAuto;
         for (var o in Seed.buildings[cityId]){
   		var buildingType = parseInt(Seed.buildings[cityId][o][0]);
   		var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
   		if (buildingType == 12){
   			return parseInt(buildingLevel);
   			break;
   		}
   	   }
   	  return 0;
       },
      e_tradeRoutes: function(){
         var t = Tabs.TranspAuto;
         var now = new Date();
         clearTimeout(t.timer);
         if (t.traderState.running == true)    {
         	var now = new Date().getTime()/1000.0;
         	now = now.toFixed(0);
         	var last = Options.lasttransport;
          		if ( now > (parseInt(last) + (Options.transportinterval*60))){
   				  t.checkdoTrades();
         		}
         }
   	 t.timer = setTimeout(function(){ t.e_tradeRoutes();}, Options.transportinterval*1000);

       },

   	delTradeRoutes: function() {
   		var t = Tabs.TranspAuto;
   		t.tradeRoutes= [];
   	},

   	checkcoords : function (obj){
   		var t = Tabs.TranspAuto;
   		if(obj.id == 'pbok'){
   			t.check = true;
   			t.addTradeRoute();
   		}
   		return;
   	},

   	addTradeRoute: function () {
   		var valid = true;
   		var t = Tabs.TranspAuto;
   		var city = t.tcp.city.id;
   		if (ById('ptcityX').value==0 && ById('ptcityY').value ==0 && !t.check)
   		{
   			return;
   		}
   		var ship_Food = ById('pbshipFood').checked;
   		var ship_Wood = ById('pbshipWood').checked;
   		var ship_Stone = ById('pbshipStone').checked;
   		var ship_Ore = ById('pbshipOre').checked;
   		var ship_Astone = ById('pbshipAstone').checked;
   		var ship_Gold = ById('pbshipGold').checked;
   		var target_Food = ById('pbtargetamountFood').value;
   		var target_Wood = ById('pbtargetamountWood').value;
   		var target_Stone = ById('pbtargetamountStone').value;
   		var target_Ore = ById('pbtargetamountOre').value;
   		var target_Astone = ById('pbtargetamountAstone').value;
   		var target_Gold = ById('pbtargetamountGold').value;
   		var trade_Food = ById('pbtradeamountFood').value;
   		var trade_Wood = ById('pbtradeamountWood').value;
   		var trade_Stone = ById('pbtradeamountStone').value;
   		var trade_Ore = ById('pbtradeamountOre').value;
   		var trade_Astone = ById('pbtradeamountAstone').value;
   		var trade_Gold = ById('pbtradeamountGold').value;
   		var target_x = ById('ptcityX').value;
   		var target_y = ById('ptcityY').value;
   		var TroopType = ById('TransportTroop').value;
   		var route_state = true;

   		if (valid == true) {
   			var lTR = t.tradeRoutes;
   			lTR.push({
   				city:				city,
   				ship_Food:			ship_Food,
   				target_Food:		target_Food,
   				trade_Food: 		trade_Food,
   				ship_Wood:			ship_Wood,
   				target_Wood:		target_Wood,
   				trade_Wood: 		trade_Wood,
   				ship_Stone:			ship_Stone,
   				target_Stone:		target_Stone,
   				trade_Stone: 		trade_Stone,
   				ship_Ore:			ship_Ore,
   				target_Ore:			target_Ore,
   				trade_Ore:	 		trade_Ore,
   				ship_Astone:	    ship_Astone,
   				target_Astone:		target_Astone,
   				trade_Astone:	 	trade_Astone,
   				ship_Gold:			ship_Gold,
   				target_Gold:		target_Gold,
   				trade_Gold: 		trade_Gold,
   				target_x: 			target_x,
   				target_y: 			target_y,
   				TroopType:      TroopType,
   				route_state: 		"true"
   			});
   		}
   		ById('pbTraderDivDRoute').style.background ='#99FF99';
   		setTimeout(function(){ (ById('pbTraderDivDRoute').style.background =''); }, 500);
   	},
   	showTradeRoutes: function () {
   		var t = Tabs.TranspAuto;
   		if (t.popTradeRoutes == null) {
   		 t.popTradeRoutes = new CPopup('pbShowTrade', 0, 0, 750, 500, true, function() {clearTimeout (1000);});
   		 t.popTradeRoutes.centerMe (mainPop.getMainDiv());
   		}
   		var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbTab" id="pbRoutesQueue">';
   		t.popTradeRoutes.getMainDiv().innerHTML = '</table></div>' + m;
   		t.popTradeRoutes.getTopDiv().innerHTML = '<TD><B>'+lang.transport.TradeRoutes+'</td>';
   		t.paintTradeRoutes();
   		t.popTradeRoutes.show(true)	;
   	},
   	paintTradeRoutes: function(){
   	        var t = Tabs.TranspAuto;
   	        var r = t.tradeRoutes;
   	        var cityname;
   	        var citynameTo = null;
   	    var m= '<TABLE id=paintRoutes class=pbTab><tr><td colspan=4><input type=button id=BOTrpQG value="'+lang.transport.BOTrpQG+'"></tr>';
   			for (var i=0;i<(r.length);i++) {
   			  citynameTo = null;
   				for (var y=0; y< Seed.cities.length;y++) {
   					if ( parseInt(Seed.cities[y][0]) == r[i].city) var cityname = Seed.cities[y][1];
   					if ( parseInt(Seed.cities[y][2]) == r[i].target_x && parseInt(Seed.cities[y][3]) == r[i].target_y) var citynameTo = Seed.cities[y][1];
   				}
   				var queueId = i;
   				if (citynameTo == null) var TO =  r[i].target_x +','+ r[i].target_y ;
   				else TO = citynameTo;
   				if (r[i].route_state) var status = '<FONT color=green>'+lang.transport.status1+'</font>';
   				else var status = '<FONT color=red>'+lang.transport.status2+'</font>';
   				if (r[i].TroopType == undefined) var unit = 'unt9';
           else var unit = r[i].TroopType;
   				m += '<TR><TD TD width=12px>&nbsp;&nbsp;</td></tr>';
           m +='<TR><TD width=20px>'+(i+1)+'</td><TD width=175px>'+uW.g_js_strings.commonstr.from+':&nbsp;&nbsp;'+ cityname +'</TD><TD width=175px>'+lang.General.to+':&nbsp;&nbsp;'+ TO +'</td><TD width=175px>'+lang.transport.status1+'</td>';
           m +='<TD width=60px><A onclick="traceEdit('+queueId+')">'+lang.General.edit+'</a></td><TD width=60px><A onclick="traceDelete('+queueId+')">'+lang.General.delete+'</a></td></tr>';
           m += '<TR><TD></td><TD>'+uW.g_js_strings.commonstr.troops+':&nbsp;&nbsp;'+unsafeWindow.unitcost[unit][0]+'</td></tr>';
           if (r[i].ship_Food) m += '<TR><TD></td><TD align=center><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/food_30.png"></td><TD>'+lang.transport.keep+': '+ addCommas(r[i].target_Food) +'</td><TD>'+lang.transport.trade+': '+ addCommas(r[i].trade_Food)+'</td>';
   				if (r[i].ship_Wood) m += '<TR><TD></td><TD align=center><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/wood_30.png"></td><TD>'+lang.transport.keep+': '+ addCommas(r[i].target_Wood) +'</td><TD>'+lang.transport.trade+': '+ addCommas(r[i].trade_Wood)+'</td>';
   				if (r[i].ship_Stone) m += '<TR><TD></td><TD align=center><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/stone_30.png"></td><TD>'+lang.transport.keep+': '+ addCommas(r[i].target_Stone) +'</td><TD>'+lang.transport.trade+': '+ addCommas(r[i].trade_Stone)+'</td>';
   				if (r[i].ship_Ore) m += '<TR><TD></td><TD align=center><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/iron_30.png"></td><TD>'+lang.transport.keep+': '+ addCommas(r[i].target_Ore) +'</td><TD>'+lang.transport.trade+': '+ addCommas(r[i].trade_Ore)+'</td>';
   				if (r[i].ship_Astone) m += '<TR><TD></td><TD align=center><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/aetherstone_30.png"></td><TD>'+lang.transport.keep+': '+ addCommas(r[i].target_Astone) +'</td><TD>'+lang.transport.trade+': '+ addCommas(r[i].trade_Astone)+'</td>';
   				if (r[i].ship_Gold) m += '<TR><TD></td><TD align=center><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/gold_30.png"></td><TD>'+lang.transport.keep+': '+ addCommas(r[i].target_Gold) +'</td><TD>'+lang.transport.trade+': '+ addCommas(r[i].trade_Gold)+'</td>';
          }
   	     m +='</table>';
   	     ById('pbRoutesQueue').innerHTML= m;
   	     ById("BOTrpQG").addEventListener('click', function(){
   	      if (parseIntNan(Options.alertConfig.hq)>0) {

   	       var mavilleId=Cities.byID[Options.alertConfig.hq];
	       if (mavilleId) {
	        var r = t.tradeRoutes;
	        for (var i=0;i<(r.length);i++) {

	           r[i].target_x=mavilleId.x;


	            r[i].target_y=mavilleId.y;

	        }
	        t.showTradeRoutes();
	       }


   	      }

   	     },false);
          unsafeWindow.traceEdit = t.editQueueElement;
          unsafeWindow.traceDelete = t.cancelQueueElement;
   	    },

   	 cancelQueueElement: function(queueId){
   	     var t = Tabs.TranspAuto;
   	     var queueId = parseInt(queueId);
   	     t.tradeRoutes.splice(queueId, 1);
   	     t.showTradeRoutes();
   	 },

   	 editQueueElement: function(queueId){
   	     var t = Tabs.TranspAuto;
   	     var r = t.tradeRoutes;
          var queueId = parseInt(queueId);
   	     var cityname;
   	     var citynameTo = null;
   	     var Types = ['food','wood','stone','iron','aetherstone','gold'];
   	     for (var y=0; y< Seed.cities.length;y++) {
   					if ( parseInt(Seed.cities[y][0]) == r[queueId].city) var cityname = Seed.cities[y][1];
   					if ( parseInt(Seed.cities[y][2]) == r[queueId].target_x && parseInt(Seed.cities[y][3]) == r[queueId].target_y) var citynameTo = Seed.cities[y][1];
   			 }
          if (citynameTo == null) var TO = "x:<input type=text size=3 id='pbbtargetx' value='"+r[queueId].target_x+"'> y:<input type=text size=3 id='pbbtargety' value='"+r[queueId].target_y+"'>";
   			 else TO = citynameTo;
          var n = '<TABLE id=editRoutes class=pbTab>';
   	     n +='<TD>'+uW.g_js_strings.commonstr.from+' :&nbsp;'+ cityname +'</td><TD>'+lang.General.to+':&nbsp;'+ TO +'</td>';
   	     n +='<TD><INPUT id=TradeStatus type=checkbox>&nbsp;'+lang.transport.status1+'</td>';
   	     n += '<TD width=150px>'+uW.g_js_strings.commonstr.troops+' :<SELECT id="pbbTransportTroop">';
          for (y in unsafeWindow.unitcost) n+='<option value="'+y+'">'+unsafeWindow.unitcost[y][0]+'</option>';
          n+='</select></td></table><BR><TABLE  id=editRoutes class=pbTab>';
          for (var i=0;i<Types.length;i++){
   	    var icon = Types[i];
            n += '<TR><TD width=50px align=center><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/'+icon+'_30.png"></td>';
            n += '<TD width=50px align=center><INPUT id=pbbship'+Types[i]+' type=checkbox></td>';
            n += '<TD width=125px>'+lang.transport.keep+' : <INPUT id=pbbtargetamount'+Types[i]+' type=text size=11 maxlength=12 value="0"></td>';
            n += '<TD width=125px>'+lang.transport.trade+' : <INPUT id=pbbtradeamount'+Types[i]+' type=text size=11 maxlength=12 value="0"\></td></tr>';
          }
          n+='</table><BR><TABLE id=editRoutes class=pbTab><TR><TD><a class="button20" id="Cancel"><span>'+uW.g_js_strings.commonstr.cancel+'</span></a></td>';
          n+='<TD><a class="button20" id="Save"><span>'+lang.General.save+'</span></a></td></tr>';
          n +='</table>';

          ById('pbRoutesQueue').innerHTML= n;
          ById('TradeStatus').checked = r[queueId].route_state;
          if (r[queueId].TroopType == undefined) var unit = 'unt9';
          else var unit = r[queueId].TroopType;
          ById('pbbTransportTroop').value = unit;
	         ById('pbbshipfood').checked = r[queueId].ship_Food;
	         ById('pbbshipwood').checked = r[queueId].ship_Wood;
	         ById('pbbshipstone').checked = r[queueId].ship_Stone;
	         ById('pbbshipiron').checked = r[queueId].ship_Ore;
	  	   ById('pbbshipaetherstone').checked = r[queueId].ship_Astone;
	         ById('pbbshipgold').checked = r[queueId].ship_Gold;
	         ById('pbbtargetamountfood').value = r[queueId].target_Food;
	         ById('pbbtargetamountwood').value = r[queueId].target_Wood;
	         ById('pbbtargetamountstone').value = r[queueId].target_Stone;
	         ById('pbbtargetamountiron').value = r[queueId].target_Ore;
	  	   ById('pbbtargetamountaetherstone').value = r[queueId].target_Astone;
	         ById('pbbtargetamountgold').value = r[queueId].target_Gold;
	         ById('pbbtradeamountfood').value = r[queueId].trade_Food;
	         ById('pbbtradeamountwood').value = r[queueId].trade_Wood;
	         ById('pbbtradeamountstone').value = r[queueId].trade_Stone;
	         ById('pbbtradeamountiron').value = r[queueId].trade_Ore;
	  	 ById('pbbtradeamountaetherstone').value = r[queueId].trade_Astone;
	         ById('pbbtradeamountgold').value = r[queueId].trade_Gold;

	         ById('Cancel').addEventListener('click', function(){t.showTradeRoutes();}, false);
	         ById('Save').addEventListener('click', function(){
	              if (ById("pbbtargetx")) {

		 	   r[queueId].target_x = ById('pbbtargetx').value;
		 	   r[queueId].target_y = ById('pbbtargety').value;

	              }
	              r[queueId].route_state = ById('TradeStatus').checked;
	              r[queueId].TroopType = ById('pbbTransportTroop').value;
	              r[queueId].ship_Food = ById('pbbshipfood').checked;
	              r[queueId].ship_Wood = ById('pbbshipwood').checked;
	              r[queueId].ship_Stone = ById('pbbshipstone').checked;
	              r[queueId].ship_Ore = ById('pbbshipiron').checked;
	  			r[queueId].ship_Astone = ById('pbbshipaetherstone').checked;
	              r[queueId].ship_Gold = ById('pbbshipgold').checked;
	              r[queueId].target_Food = ById('pbbtargetamountfood').value;
	              r[queueId].target_Wood = ById('pbbtargetamountwood').value;
	              r[queueId].target_Stone = ById('pbbtargetamountstone').value;
	              r[queueId].target_Ore = ById('pbbtargetamountiron').value;
	  			r[queueId].target_Astone = ById('pbbtargetamountaetherstone').value;
	              r[queueId].target_Gold = ById('pbbtargetamountgold').value;
	              r[queueId].trade_Food = ById('pbbtradeamountfood').value;
	              r[queueId].trade_Wood = ById('pbbtradeamountwood').value;
	              r[queueId].trade_Stone = ById('pbbtradeamountstone').value;
	              r[queueId].trade_Ore = ById('pbbtradeamountiron').value;
	  			r[queueId].trade_Astone = ById('pbbtradeamountaetherstone').value;
	              r[queueId].trade_Gold = ById('pbbtradeamountgold').value;
	              t.showTradeRoutes();
	          }, false);
	 },

   	saveTradeRoutes: function(){
   		var t = Tabs.TranspAuto;
           var serverID = getServerId();
           GM_setValue('tradeRoutes_' + serverID, JSON2.stringify(t.tradeRoutes));
       },
     readTradeRoutes: function(){
           var t = Tabs.TranspAuto;
           var serverID = getServerId();
           s = GM_getValue('tradeRoutes_' + serverID);
           if (s != null) {
               route = JSON2.parse(s);
               for (k in route)
                   t.tradeRoutes[k] = route[k];
           }
       },
   	saveTraderState: function(){
   		var t = Tabs.TranspAuto;
           var serverID = getServerId();
           GM_setValue('traderState_' + serverID, JSON2.stringify(t.traderState));
       },
       readTraderState: function(){
           var t = Tabs.TranspAuto;
           var serverID = getServerId();
           s = GM_getValue('traderState_' + serverID);
           if (s != null) {
               state = JSON2.parse(s);
               for (k in state)
                   t.traderState[k] = state[k];
           }
       },
       toggleTraderState: function(obj){
   	   var t = Tabs.TranspAuto;
   	   obj = ById('pbTraderState');
           if (t.traderState.running == true) {
               t.traderState.running = false;
               if (obj)  obj.value = lang.transport.labTrp+' = OFF';
   	       if (Options.BORac_Trp) updatebotbutton(lang.transport.labTrp+' - OFF', 'pbtrantab');
   	       clearTimeout(t.checkdotradetimeout);
   	       t.count = 0;
   	       Options.lasttransport = 0;
	       saveOptions();
           }
           else {
               t.traderState.running = true;
               if (obj) obj.value = lang.transport.labTrp+' = ON';
   		     if (Options.BORac_Trp) updatebotbutton(lang.transport.labTrp+' - ON', 'pbtrantab');
   			t.e_tradeRoutes();
           }
       },

   	checkdoTrades: function(){
   	var t = Tabs.TranspAuto;
   	if(t.tradeRoutes.length==0) return;
   	t.doTrades(t.count);
   	t.count++;
   	if(t.count < t.tradeRoutes.length){
   			  t.checkdotradetimeout = setTimeout(function() { t.checkdoTrades();}, 10000);
   			} else {
   			  var now = new Date().getTime()/1000.0;
   			  now = now.toFixed(0);
   			  Options.lasttransport = now;
   			  saveOptions();
   			  t.count = 0;
   			}
   	},

     doTrades: function(count){
       var t = Tabs.TranspAuto;

      	if(t.tradeRoutes.length==0) return;
      	if(!t.tradeRoutes[count]["route_state"]) return;

      	var city = t.tradeRoutes[count]["city"];
      	if(!Cities.byID[city]) return;

	var xcoord = t.tradeRoutes[count]["target_x"];
       	var ycoord = t.tradeRoutes[count]["target_y"];
   	var cityID = 'city' + city;
   	for (var zz=0; zz< Seed.cities.length;zz++) {
	   if (parseInt(Seed.cities[zz][0]) == city)
	      var cityname = Seed.cities[zz][1];
	}

      	var rallypointlevel = t.getRallypoint(cityID);
	if(rallypointlevel == 12) rallypointlevel = 11;
        var slots = 0;
	for (var k in Seed.queue_atkp[cityID]){
	         	         march = Seed.queue_atkp[cityID][k];
	         	         if (typeof (march) == 'object'){
	         	           slots++;
	         	         }
	}
	if(slots >= rallypointlevel){
	      		actionLog("Transport","Transport de "+cityname+" vers " + xcoord + "," + ycoord + " <font color=red>Point de ralliement complet !</font>");
	      		return;
        }
      	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
   		params.gold =0;
   		params.r1 =0;
   		params.r2 =0;
   		params.r3 =0;
   		params.r4 =0 ;
   		params.r5 =0 ;
   		params.kid = 0;

   		var carry_amount= 0;
   		var wagons_needed=0;
   		var citymax = 0;



       	var trade_Food = t.tradeRoutes[count]["trade_Food"];
       	var trade_Wood = t.tradeRoutes[count]["trade_Wood"];
       	var trade_Stone = t.tradeRoutes[count]["trade_Stone"];
       	var trade_Ore = t.tradeRoutes[count]["trade_Ore"];
   	var trade_Astone = t.tradeRoutes[count]["trade_Astone"];
       	var trade_Gold = t.tradeRoutes[count]["trade_Gold"];
       	var target_Food = t.tradeRoutes[count]["target_Food"];
       	var target_Wood = t.tradeRoutes[count]["target_Wood"];
       	var target_Stone = t.tradeRoutes[count]["target_Stone"];
       	var target_Ore = t.tradeRoutes[count]["target_Ore"];
   		var target_Astone = t.tradeRoutes[count]["target_Astone"];
       	var target_Gold = t.tradeRoutes[count]["target_Gold"];
       	var ship_Food = t.tradeRoutes[count]["ship_Food"];
       	var ship_Wood = t.tradeRoutes[count]["ship_Wood"];
       	var ship_Stone = t.tradeRoutes[count]["ship_Stone"];
       	var ship_Ore = t.tradeRoutes[count]["ship_Ore"];
   		var ship_Astone = t.tradeRoutes[count]["ship_Astone"];
       	var ship_Gold = t.tradeRoutes[count]["ship_Gold"];
       	var citymax_Food = parseIntNan(Seed.resources[cityID]['rec1'][0] / 3600);
       	var citymax_Wood = parseIntNan(Seed.resources[cityID]['rec2'][0] / 3600);
       	var citymax_Stone = parseIntNan(Seed.resources[cityID]['rec3'][0] / 3600);
       	var citymax_Ore = parseIntNan(Seed.resources[cityID]['rec4'][0] / 3600);
   		var citymax_Astone = parseIntNan(Seed.resources[cityID]['rec5'][0]);
       	var citymax_Gold = parseIntNan(Seed.citystats[cityID]['gold']);
       	var carry_Food = parseIntNan(citymax_Food - target_Food);
       	var carry_Wood = parseIntNan(citymax_Wood - target_Wood);
       	var carry_Stone = parseIntNan(citymax_Stone - target_Stone);
       	var carry_Ore = parseIntNan(citymax_Ore - target_Ore);
   		var carry_Astone = parseIntNan(citymax_Astone - target_Astone);
       	var carry_Gold = 0;
       	if (carry_Food < 0 || ship_Food==false) carry_Food = 0;
       	if (carry_Wood < 0 || ship_Wood==false) carry_Wood = 0;
       	if (carry_Stone < 0 || ship_Stone==false) carry_Stone = 0;
       	if (carry_Ore < 0 || ship_Ore==false) carry_Ore = 0;
   		if (carry_Astone < 0 || ship_Astone==false) carry_Astone = 0;
       	if (trade_Food > 0 && (carry_Food > trade_Food)) carry_Food = parseIntNan(trade_Food);
       	if (trade_Wood > 0 && (carry_Wood > trade_Wood)) carry_Wood = parseIntNan(trade_Wood);
       	if (trade_Stone > 0 && (carry_Stone > trade_Stone)) carry_Stone = parseIntNan(trade_Stone);
       	if (trade_Ore > 0 && (carry_Ore > trade_Ore)) carry_Ore = parseIntNan(trade_Ore);
   	if (trade_Astone > 0 && (carry_Astone > trade_Astone)) carry_Astone = parseIntNan(trade_Astone);
   		carry_Astone *= 5;
         if (t.tradeRoutes[count]['TroopType'] == undefined) var wagons = parseInt(Seed.units[cityID]['unt'+ 9]);
         else var wagons =  parseInt(Seed.units[cityID][t.tradeRoutes[count]['TroopType']]);
         var rallypointlevel = t.getRallypoint(cityID);
   		  if (rallypointlevel == 11) rallypointlevel = 15;
   		  if (rallypointlevel == 12) rallypointlevel = 20;
       	if (parseInt(wagons) > parseInt(rallypointlevel*10000)){ wagons = (rallypointlevel*10000); }
         if (t.tradeRoutes[count]['TroopType'] == undefined) var unit = 'unt9';
         else var unit = t.tradeRoutes[count]['TroopType'];
         var Troops = parseInt(Seed.units[cityID][unit]);
   	  if(parseInt(Troops)>parseInt(wagons)) Troops = wagons;
         var featherweight = parseInt(Seed.tech.tch10);
       	var Load = parseInt(uW.unitstats[unit]['5'])
         var maxloadperwagon = (featherweight * ((Load/100)*10)) + Load;



            var techLoadBoost=parseInt(Seed.tech.tch10)*0.1;
		 	var loadEffectBoost=0;
		 	if(Seed.playerEffects.loadExpire>uW.unixtime()){loadEffectBoost=0.25}
		 	var loadBoostBase=(EffetTronePrc(6).percent*0.01)+loadEffectBoost+techLoadBoost;
		 	var loadBoost=loadBoostBase;
		 	var untnb=0;
		 	switch (unit){
			         case 'unt1': untnb=1;break;
			         case 'unt2': untnb=2;break;
			         case 'unt3': untnb=3;break;
			         case 'unt4': untnb=4;break;
			         case 'unt5': untnb=5;break;
			         case 'unt6': untnb=6;;break;
			         case 'unt7': untnb=7;break;
			         case 'unt8': untnb=8;break;
			         case 'unt9': untnb=9;break;
			         case 'unt10': untnb=10;break;
			         case 'unt11': untnb=11;break;
			         case 'unt12': untnb=12;break;
            }
		 	if(uW.cm.unitFrontendType[untnb]=="horsed"){
		 	 loadBoost+=(EffetTronePrc(48).percent*0.01)
		 	}
		    var maxloadperwagon=parseInt(parseInt(uW.unitstats[unit][5])*(1+loadBoost));

   		  var maxload = (maxloadperwagon * Troops);
   		  if(wagons <= 0) {return; }
   		  var shift_Food = parseIntNan(maxload / 9);
   		  var shift_Wood = parseIntNan(maxload / 9);
   		  var shift_Stone = parseIntNan(maxload / 9);
   		  var shift_Ore = parseIntNan(maxload / 9);
   		  var shift_Astone = parseIntNan(maxload / 9 * 5);
   		  if ((maxload - carry_Food - carry_Wood - carry_Stone - carry_Ore - carry_Astone) < 0){
   			 var shift_num=0;
   			 var shift_spare=0;
   			if (carry_Food < shift_Food) {
   				shift_spare += (shift_Food - carry_Food);
   				shift_Food = carry_Food;
   			}
   			if (carry_Wood < shift_Wood) {
   				shift_spare += (shift_Wood - carry_Wood);
   				shift_Wood = carry_Wood;
   			}
   			if (carry_Stone < shift_Stone) {
   				shift_spare += (shift_Stone - carry_Stone);
   				shift_Stone = carry_Stone;
   			}
   			if (carry_Ore < shift_Ore) {
   				shift_spare += (shift_Ore - carry_Ore);
   				shift_Ore = carry_Ore;
   			}
               if (carry_Astone < shift_Astone) {
   				shift_spare += (shift_Astone - carry_Astone);
   				shift_Astone = carry_Astone;
   			}

   		  while (shift_spare >1) {
   				 if (carry_Food < (shift_Food + shift_spare)){
   				    shift_spare = shift_spare - carry_Food;;
   				    shift_Food = carry_Food;
   				 }
   				 else{
   				  shift_Food = (shift_Food + shift_spare);
   				  shift_spare = shift_spare- shift_spare;
   				}
   				 if (carry_Wood < (shift_Wood + shift_spare)){
   				    shift_spare = shift_spare - carry_Wood;;
   				    shift_Wood = carry_Wood;
   				 }
   				 else{
   				  shift_Wood = shift_Wood + shift_spare;
   				  shift_spare = shift_spare- shift_spare;
   				}
           		if (carry_Stone < (shift_Stone + shift_spare)){
   				    shift_spare = shift_spare - carry_Stone;
   				    shift_Stone = carry_Stone;
   				 }
   				 else{
   				  shift_Stone = shift_Stone + shift_spare;
   				  shift_spare = shift_spare- shift_spare;
   				}
   				 if (carry_Ore < (shift_Ore + shift_spare)){
   				    shift_spare = shift_spare - carry_Ore;
   				    shift_Ore = carry_Ore;
   				 }
   				 else{
   				  shift_Ore = shift_Ore + shift_spare;
   				  shift_spare = shift_spare- shift_spare;
   				}
   				if (carry_Astone < (shift_Astone + shift_spare)){
   				    shift_spare = shift_spare - carry_Astone;
   				    shift_Astone = carry_Astone;
   				 }
   				 else{
   				  shift_Astone = shift_Astone + shift_spare;
   				  shift_spare = shift_spare- shift_spare;
   				}
   			 }

   		carry_Food = shift_Food;
   		carry_Wood = shift_Wood;
   		carry_Stone = shift_Stone;
   		carry_Ore = shift_Ore;
   		carry_Astone = shift_Astone;
   		}

   		if (maxload > (carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Astone) && ship_Gold==true) {
   		    if ((maxload-(carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Astone)) > (citymax_Gold - target_Gold)){
   		    	  carry_Gold = (citymax_Gold - target_Gold);
   		    	  if (carry_Gold < 0 ) carry_Gold = 0;
   		   	}
   		    else carry_Gold = (maxload-(carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Astone));
   		    if (trade_Gold > 0 && (carry_Gold > trade_Gold)) carry_Gold = parseInt(trade_Gold);
   		}

   		wagons_needed = ((carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Astone + carry_Gold) / maxloadperwagon);
   		wagons_needed = wagons_needed.toFixed(0);
   		if (wagons_needed < ((carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Astone + carry_Gold) / maxloadperwagon)) wagons_needed++;
   		if ( wagons_needed < Options.minwagons ) { return; }

   		params.cid= city;
   		params.type = "1";
   		params.xcoord = xcoord;
   		params.ycoord = ycoord;
   		params.r1 = carry_Food;
   		params.r2 = carry_Wood;
   		params.r3 = carry_Stone;
   		params.r4 = carry_Ore;
   		params.r5 = parseInt(carry_Astone/5);
   		params.gold = carry_Gold;

   		switch (unit){
         case 'unt1': params.u1 = wagons_needed;break;
         case 'unt2': params.u2 = wagons_needed;break;
         case 'unt3': params.u3 = wagons_needed;break;
         case 'unt4': params.u4 = wagons_needed;break;
         case 'unt5': params.u5 = wagons_needed;break;
         case 'unt6': params.u6 = wagons_needed;break;
         case 'unt7': params.u7 = wagons_needed;break;
         case 'unt8': params.u8 = wagons_needed;break;
         case 'unt9': params.u9 = wagons_needed;break;
         case 'unt10': params.u10 = wagons_needed;break;
         case 'unt11': params.u11 = wagons_needed;break;
         case 'unt12': params.u12 = wagons_needed;break;
       }
      if ((carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Astone + carry_Gold) > 0) {

            new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
                     method: "post",
                     parameters: params,
                     loading: true,
                     onSuccess: function (transport) {
                     var rslt = eval("(" + transport.responseText + ")");
                     if (rslt.ok) {
                     var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
                     var ut = unsafeWindow.unixtime();
                     var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
                     for(i = 0; i <= unitsarr.length; i++){
                     	if(params["u"+i]){
                     	unitsarr[i] = params["u"+i];
                     	}
                     }
                     var resources=new Array();
                     resources[0] = params.gold;
                     for(i=1; i<=5; i++){
                     	resources[i] = params["r"+i];
                     }
                     var currentcityid = city;
                     unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
                     unsafeWindow.update_seed(rslt.updateSeed)
                     if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
                      actionLog("Transport","Depuis: " + cityname + " Vers : " + xcoord + ',' + ycoord + "  -> "+ unsafeWindow.unitcost[unit][0] +": " + wagons_needed);
                     } else {
			actionLog("Transport","Depuis: " + cityname + " Vers : " + xcoord + ',' + ycoord + "<br><font color=red>" + transport.responseText + "</font>");
                     }
                     },
                     onFailure: function (transport) {
                     var rslt = eval("(" + transport.responseText + ")");
                     if (rslt.user_action) {
		     			actionLog("Transport","<b><font color=red>Captcha</font></b>");
		     			new CdialogCancelContinue('<SPAN class=boldRed>CAPTCHA ALERT ! - TRANSPORTAUTO</span>', null, null, mainPop.getMainDiv());
		     		}else{
                      actionLog("Transport","Depuis: " + cityname + " Vers : " + xcoord + ',' + ycoord + "<br><font color=red>" + transport.responseText + "</font>");
                     }
                     }
             });
           }
   	},

   ManualTransport: function(){
    var t = Tabs.TranspAuto;
    if (document.getElementById ('ptcityX').value == "" || document.getElementById ('ptcityY').value == "") return;
    if ( t.TroopsNeeded > t.Troops) return;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    var unitType = ById('TransportTroop').value;
    var untid=ById('TransportTroop').value;
    var techLoadBoost=parseInt(Seed.tech.tch10)*0.1;
    var loadEffectBoost=0;
    if(Seed.playerEffects.loadExpire>uW.unixtime()){loadEffectBoost=0.25}
    var loadBoostBase=(EffetTronePrc(6).percent*0.01)+loadEffectBoost+techLoadBoost;
       	     var loadBoost=loadBoostBase;
       	      if(uW.cm.unitFrontendType[untid]=="horsed"){
       	       loadBoost+=(EffetTronePrc(48).percent*0.01)
       	      }
       var LoadUnit=parseInt(parseInt(uW.unitstats[untid][5])*(1+loadBoost));
       var MaxLoad =  parseInt(Seed.units['city' + t.tcp.city.id][unitType]) * LoadUnit;
       document.getElementById ('errorSpace').innerHTML = '';

   	params.kid = 0;
        params.cid=  t.tcp.city.id;
   	params.type = "1";
   	params.xcoord = parseInt(document.getElementById ('ptcityX').value);
   	params.ycoord = parseInt(document.getElementById ('ptcityY').value);
   	params.r1 = parseInt(document.getElementById ('pbtradeamountFood').value);
   	params.r2 = parseInt(document.getElementById ('pbtradeamountWood').value);
   	params.r3 = parseInt(document.getElementById ('pbtradeamountStone').value);
   	params.r4 = parseInt(document.getElementById ('pbtradeamountOre').value);
   	params.r5 = parseInt(document.getElementById ('pbtradeamountAstone').value);
   	params.gold = parseInt(document.getElementById ('pbtradeamountGold').value);

       switch (unitType){
         case 'unt1': params.u1 = parseInt(document.getElementById ('TroopsToSend').value);break;
         case 'unt2': params.u2 = parseInt(document.getElementById ('TroopsToSend').value);break;
         case 'unt3': params.u3 = parseInt(document.getElementById ('TroopsToSend').value);break;
         case 'unt4': params.u4 = parseInt(document.getElementById ('TroopsToSend').value);break;
         case 'unt5': params.u5 = parseInt(document.getElementById ('TroopsToSend').value);break;
         case 'unt6': params.u6 = parseInt(document.getElementById ('TroopsToSend').value);break;
         case 'unt7': params.u7 = parseInt(document.getElementById ('TroopsToSend').value);break;
         case 'unt8': params.u8 = parseInt(document.getElementById ('TroopsToSend').value);break;
         case 'unt9': params.u9 = parseInt(document.getElementById ('TroopsToSend').value);break;
         case 'unt10': params.u10 = parseInt(document.getElementById ('TroopsToSend').value);break;
         case 'unt11': params.u11 = parseInt(document.getElementById ('TroopsToSend').value);break;
         case 'unt12': params.u12 = parseInt(document.getElementById ('TroopsToSend').value);break;
       }

       if ((params.r1 + params.r2 + params.r3 + params.r4 + params.r5 + params.gold) > 0) {
            new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
                     method: "post",
                     parameters: params,
                     loading: true,
                     onSuccess: function (transport) {
                     var rslt = eval("(" + transport.responseText + ")");
                     if (rslt.ok) {
   		                  var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
   		                  var ut = unixTime();
   		                  var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
   		                  for(i = 0; i <= unitsarr.length; i++){
   		                  	if(params["u"+i]){
   		                  	unitsarr[i] = params["u"+i];
   		                  	}
   		                  }
   		                  var resources=new Array();
   		                  resources[0] = params.gold;
   		                  for(i=1; i<=5; i++){
   		                  	resources[i] = params["r"+i];
   		                  }
   		                  var currentcityid = t.tcp.city.id;
   		                  unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
   		                  if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
   		                  document.getElementById ('errorSpace').innerHTML = 'Envoy&eacute;: ' + addCommas(params.r1+params.r2+params.r3+params.r4+params.r5+params.gold) + ' Ressources avec ' + addCommas(parseInt(document.getElementById ('TroopsToSend').value)) + ' ' + unsafeWindow.unitcost[unitType][0];
   		                  document.getElementById ('pbtradeamountFood').value = 0;
   		                  document.getElementById ('pbtradeamountWood').value = 0;
   		                  document.getElementById ('pbtradeamountStone').value = 0;
   		                  document.getElementById ('pbtradeamountOre').value = 0;
   						  document.getElementById ('pbtradeamountAstone').value = 0;
   		                  document.getElementById ('pbtradeamountGold').value = 0;
   		                  document.getElementById ('TroopsToSend').value = 0;
                     } else {
   		                  var errorcode =  'err_' + rslt.error_code;
   		                  if (rlst.msg == undefined)document.getElementById ('errorSpace').innerHTML = '<HR><FONT COLOR=red>Error: ' + unsafeWindow.g_js_strings.errorcode[errorcode] +'</font>';
   		                  else document.getElementById ('errorSpace').innerHTML = '<HR><FONT COLOR=red>Erreur : ' + rslt.msg +'</font>';
                     }
                     },
                     onFailure: function () {}
             });
           }
   	},

  onUnload: function(){
     var t = Tabs.TranspAuto;
     if (!ResetAll) t.saveTradeRoutes();
     if (!ResetAll) t.saveTraderState();
     if (!ResetAll) t.saveReapproState();
  },
  showManuel : function() {
   var t = Tabs.TranspAuto
   var rownum = 0;

   var ModelCity = {};

   function _row (name, row, noTotal){
      if (rownum++ % 2)
        style = '';
      else
        style = ' style = "background: #e8e8e8"';
      var tot = 0;
      var m = [];
      m.push ('<TR style="background: #fff" align=right');
      m.push (style);
      m.push ('><TD');
      m.push (style);
      m.push ('><B>');
      m.push (name);
      m.push ('</td>');
      if (noTotal){
        m.push ('<TD');
        m.push (style);
        m.push ('>&nbsp;</td>');
      } else {
        for (i=0; i<row.length; i++)
          tot += row[i];
        m.push ('<TD style="background: #ffc">');
        m.push (addCommas(tot));
        m.push ('</td>');
      }
      for (i=0; i<row.length; i++){
        m.push ('<TD');
        m.push (style);
        m.push ('>');
        m.push (addCommas(row[i]));
        m.push ('</td>');
      }
      m.push ('</tr>');
      return m.join('');
    }
    dt = new Date ();
    dt.setTime (Seed.player.datejoinUnixTime * 1000);
    if (t.state == null) {
      m = '<DIV class=boStat>'+lang.transport.titleManuel+'</div>';
      m +="<div id='statpourTr'></div>";
      m += "<TABLE width=100% class=ptTab border=0>\
       <tr align=center><td colspan=2><HR></td></tr>\
       <tr align=center valign=top><td colspan=1 width=50%><b><u>"+lang.General.source+"</b></u><br><span id=srcptspeedcity></span></td>\
       <td colspan=1 width=50%  rowspan=2><b><u>"+lang.General.dest+"</b></u><br><span id=desptspeedcity></span><br>\
       <a id=boclickmap href='javascript:void(0);'>"+lang.transport.typetrpx+"</a> <br>X: <input type=text size=4 id=typetrpx value=0>&nbsp;Y: <input type=text size=4 id=typetrpy value=0><br><a href='javascript:void(0);' id='chargelistelieux'>Membres</a> : <select id='BOlisteFavori'></select><br><br><INPUT id='ptttButTransport' type=submit value='"+uW.g_js_strings.commonstr.transport+"' style='font-weight:bold'>\
       </td></tr>\
       <tr align=center><td colspan=1>"+uW.g_js_strings.commonstr.troops+" : <select id=typetrp>";
        var l=0;
	      for (y in uW.unitcost) {
	   		 l++;
	   		 if (l==9)
	   		  m+='<option selected value="'+l+'">'+uW.unitcost[y][0]+'</option>';
	   		 else
	   		  m+='<option value="'+l+'">'+uW.unitcost[y][0]+'</option>';
       }

       m+="</select><br>"+uW.g_js_strings.commonstr.quantity+": <input type=text size=6 value='1000' id='Choixnbwagon'><input type=button id='trswagmax' value='Max'\><br><i>"+lang.transport.trswagmax+"</i>\
       <br><b>"+uW.g_js_strings.commonstr.resources+":</b><input type=radio id='ChoixRess0' name='ChoixRess' value='gold' style='visibility:hidden'><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/gold_30.png onclick=document.getElementById('ChoixRess0').checked=true;BOestimeres(); height=20>\
       <input type=radio id='ChoixRess1' name='ChoixRess' value='rec1' style='visibility:hidden'><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/food_30.png onclick=document.getElementById('ChoixRess1').checked=true;BOestimeres(); height=20>\
       <input type=radio id='ChoixRess2' name='ChoixRess' value='rec2' style='visibility:hidden'><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/wood_30.png onclick=document.getElementById('ChoixRess2').checked=true;BOestimeres(); height=20>\
       <input type=radio id='ChoixRess3' name='ChoixRess' value='rec3' style='visibility:hidden'><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/stone_30.png onclick=document.getElementById('ChoixRess3').checked=true;BOestimeres(); height=20>\
       <input type=radio id='ChoixRess4' name='ChoixRess' value='rec4' style='visibility:hidden'><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/iron_30.png onclick=document.getElementById('ChoixRess4').checked=true;BOestimeres(); height=20>\
       <input type=radio id='ChoixRess5' name='ChoixRess' value='rec5' style='visibility:hidden'><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/aetherstone_30.png onclick=document.getElementById('ChoixRess5').checked=true;BOestimeres(); height=20>\
       </td></tr>\
       <tr><td colspan=2>"+lang.transport.BOEstimationR+"<span id=BOEstimationR></td></tr>\
       </table>\
       <TABLE align=center width=100% class=ptTab><TR><TD><div id=ptTranportStatus style='text-align:center;overflow-y:auto; max-height:78px; height: 78px;'></div></td></tr></table>";
    t.TransportDiv.innerHTML = m;
    t.destinationCityx = document.getElementById ('typetrpx');
    t.destinationCityy = document.getElementById ('typetrpy');

    t.destinationCityx.addEventListener ('change', t.estimerRes, false);
    t.destinationCityy.addEventListener ('change', t.estimerRes, false);
    ById ('ChoixRess0').addEventListener ('click', t.estimerRes, false);
    ById ('ChoixRess1').addEventListener ('click', t.estimerRes, false);
    ById ('ChoixRess2').addEventListener ('click', t.estimerRes, false);
    ById ('ChoixRess3').addEventListener ('click', t.estimerRes, false);
    ById ('ChoixRess4').addEventListener ('click', t.estimerRes, false);
    ById ('ChoixRess5').addEventListener ('click', t.estimerRes, false);
    t.listeFavoris = document.getElementById ('BOlisteFavori');
    t.estimationRes = document.getElementById ('BOEstimationR');
    t.chargelistelieux = document.getElementById ('chargelistelieux');
    t.chargelistelieux.addEventListener ('click', t.chercherFavoris, false);
    t.listeFavoris.addEventListener ('change', t.SelectFavoris, false);
    var dcp1 = new CdispCityPicker ('ptspeed1', ById('desptspeedcity'), false, t.clickCityDestinationSelect, 1);
    t.TTbutTransport = document.getElementById ('ptttButTransport');
    t.TTbutTransport.addEventListener ('click', t.clickTransportDo, false);
    t.divTranportStatus = document.getElementById ('ptTranportStatus');
    t.statpourTr = document.getElementById ('statpourTr');
    t.typetrp = document.getElementById ('typetrp');
    t.typetrp.addEventListener ('click', t.estimerRes, false);
    t.trswagmax = document.getElementById ('trswagmax');
    t.trswagmax.addEventListener ('click', t.clickUniteMax, false);
    t.Choixnbwagon  = document.getElementById ('Choixnbwagon');
    t.Choixnbwagon.addEventListener ('keyup', t.verifierWagons, false);
    ById("boclickmap").addEventListener ('click',t.clickmap, false);
    var dcp0 = new CdispCityPicker ('ptspeed0', ById('srcptspeedcity'), false, t.clickCitySourceSelect, Cities.byID[unsafeWindow.currentcityid].idx);
    t.state = 1;
   }
   if (t.state == 1) {
    if (document.getElementById ('maparea_map').style.display!="none") {
       t.destinationCityx.value = document.getElementById ('mapXCoor').value;
       t.destinationCityy.value = document.getElementById ('mapYCoor').value;
       t.destinationCityx.style.backgroundColor="#FF9999";
       t.destinationCityy.style.backgroundColor="#FF9999";
       setTimeout(function() {
             t.destinationCityx.style.backgroundColor="#fff";
       t.destinationCityy.style.backgroundColor="#fff";
       }, 3000);

    }
    t.state = 2;
   }
   rows=[];
   rows[0]=[];
   m = "<TABLE class=ptTabLined cellspacing=0><TR valign=top align=right><TD width=65></td><TD width=88 style='background: #ffc'><B>TOTAL</b></td>";
      for(i=0; i<Cities.numCities; i++)
         m += '<TD width=81><B>'+ Cities.cities[i].name.substring(0,10) +'</b></td>';
      for(i=0; i<Cities.numCities; i++) {
        cityID = 'city'+ Cities.cities[i].id;
        rows[0][i] = parseInt(Seed.citystats[cityID].gold[0]);
      }
      for (r=1; r<6; r++){
        rows[r] = [];
        for(i=0; i<Cities.numCities; i++) {
          cityID = 'city'+ Cities.cities[i].id;
           if (r==5)
	    rows[r][i] = parseInt(Seed.resources[cityID]['rec'+r][0]);
	            else
           rows[r][i] = parseInt(Seed.resources[cityID]['rec'+r][0] / 3600);
        }
      }
      m += _row ('<img height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/gold_30.png>', rows[0]);
      m += _row ('<img height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/food_30.png>', rows[1]);
      m += _row ('<img height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/wood_30.png>', rows[2]);
      m += _row ('<img height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/stone_30.png>', rows[3]);
      m += _row ('<img height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/iron_30.png>', rows[4]);
      m += _row ('<img height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/aetherstone_30.png>', rows[5]);
      m += '<TR><TD><font size=1><BR></td></tr>';
      row = [];
      var totalbouffe = 0;
      for(i=0; i<Cities.numCities; i++) {
	var rp = getResourceProduction (Cities.cities[i].id);
	//var usage = parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][3]);
	row[i] = rp[1];
      }
      m += _row ('Ent.', row, false,  0);
      for(i=0; i<Cities.numCities; i++) {
                    if (row[i] >= 0)
                      row[i] = '----';
                    else {
                      var timeLeft = parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][0]) / 3600 / (0-row[i]) * 3600;
                      if (timeLeft > 86313600)
                        row[i] = '----';
                      else {
                        if (Options.enableFoodWarn && timeLeft<(Options.foodWarnHours*3600))
                          row[i] = '<SPAN class=whiteOnRed>'+ timestrShort(timeLeft) +'</span>';
                        else
                          row[i] = timestrShort(timeLeft);
                      }
                    }
      }
      m += _row ('Aut.', row, true, 0);
      m += '<TR><TD><font size=1><BR></td></tr>';
      for (r=1; r<13; r++){
        rows[r] = [];
        for(i=0; i<Cities.numCities; i++) {
          cityID = 'city'+ Cities.cities[i].id;
          rows[r][i] = parseInt(Seed.units[cityID]['unt'+r]);
        }
      }
      m += _row ('<img height=20 title="'+unsafeWindow.unitcost['unt1'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_30_s34.jpg>', rows[1]);
      m += _row ('<img height=20 title="'+unsafeWindow.unitcost['unt7'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_30_s34.jpg>', rows[7]);
      m += _row ('<img height=20 title="'+unsafeWindow.unitcost['unt8'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_30_s34.jpg>', rows[8]);
      m += _row ('<img height=20 title="'+unsafeWindow.unitcost['unt9'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_30_s34.jpg>', rows[9]);
          row = [];
    for(i=0; i<Cities.numCities; i++) {
    	        var cityId = 'city'+ Cities.cities[i].id;
    	        var slots = 0;
    	        for (var k in Seed.queue_atkp[cityId]){
    	         march = Seed.queue_atkp[cityId][k];
    	         if (typeof (march) == 'object'){
    	           slots++;
    	         }
    	        }
	var niveauPointRall=parseInt(getCityBuilding (Cities.cities[i].id, 12).maxLevel);
	if (niveauPointRall==12) niveauPointRall=11;
    	row[i] = '<SPAN><B>'+ slots +'/'+ niveauPointRall +'</b></span>';
     }
    m += _row ('PR', row, true, 0);   m += "</table>";
     t.statpourTr.innerHTML = m;
     clearTimeout (t.displayTimer);
     t.displayTimer = setTimeout (t.showManuel, 4000);
  },

  SelectFavoris:function() {
   var t = Tabs.TranspAuto;
   if (t.listeFavoris.value!='') {
    var valeur=t.listeFavoris.value;
    var x=valeur.substr(0, valeur.lastIndexOf(','));
    var y=valeur.substr(valeur.lastIndexOf(',')+1, valeur.length);
    t.destinationCityx.value = x;
    t.destinationCityy.value = y;
   }
   t.estimerRes();
  },

  chercherFavoris: function() {
   var t = Tabs.TranspAuto;
   var myA = getMyAlliance ();
   if (myA[0]!=0) {
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.perPage = 100;
      params.allianceId = myA[0];
          new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserLeaderboard.php" + unsafeWindow.g_ajaxsuffix, {
	        method: "post",
	        parameters: params,
	        onSuccess: function (rslt) {
	          if (rslt.ok){
	           var z=0;
	           var m="";
	           for (var i=0; i<rslt.results.length; i++){
     		      p = rslt.results[i];
		      if (p.userId != 0){
		       for (var c=0; c<p.cities.length; c++){
		         if (Seed.player.name!=p.displayName) {
		          m += "<option value='" + p.cities[c].xCoord + ","+ p.cities[c].yCoord+"'>" + p.displayName + " - "+unsafeWindow.g_js_strings.commonstr.city+" " + (c+1) + " - " + p.cities[c].xCoord + "," + p.cities[c].yCoord+"</option>";
		         }
		       }
		      }
      	            }
      	            t.listeFavoris.innerHTML="<option value=''>...</option>"+m;
	          }
	        },
	        onFailure: function (rslt) {
	          t.listeFavoris.innerHTML="<option>Error</option>";
	        },
    	});
   } else {
     t.listeFavoris.innerHTML="<option>"+lang.transport.noalliance+"</option>";
   }
  },
  verifierWagons: function() {
   var t = Tabs.TranspAuto;
   var maxw=parseInt(rows[t.typetrp.value][t.sourceCity.idx]);
   var saisw=parseInt(t.Choixnbwagon.value);
   if (saisw > maxw) {
      t.Choixnbwagon.value=maxw;
      t.divTranportStatus.innerHTML = '<FONT COLOR=#550000>'+lang.transport.err1+' '+maxw+' !.</font>';
   }
   t.estimerRes();
  },
  estimerRes: function() {
   var t = Tabs.TranspAuto;
   var cityID = 'city'+ t.sourceCity.id,ic=0,resact=0,ic_ty="gold",ic_text=" "+uW.g_js_strings.commonstr.gold;
   if (ById("ChoixRess1").checked) { ic_ty="rec1";ic=1;ic_text=" "+unsafeWindow.g_js_strings.commonstr.food; }
   if (ById("ChoixRess2").checked) { ic_ty="rec2";ic=2;ic_text=" "+uW.g_js_strings.commonstr.wood; }
   if (ById("ChoixRess3").checked) { ic_ty="rec3";ic=3;ic_text=" "+uW.g_js_strings.commonstr.stone; }
   if (ById("ChoixRess4").checked) { ic_ty="rec4";ic=4;ic_text=" "+uW.g_js_strings.commonstr.ore; }
   if (ById("ChoixRess5").checked) { ic_ty="rec5";ic=5;ic_text=" "+uW.g_js_strings.commonstr.aetherstone; }
   if (ById("ChoixRess0").checked) { ic_ty="gold";ic=0;ic_text=" "+uW.g_js_strings.commonstr.gold; }
   var esti = 0;

   var total_units=t.Choixnbwagon.value;
   var untid=t.typetrp.value;
   var techLoadBoost=parseInt(Seed.tech.tch10)*0.1;
   var loadEffectBoost=0;
   if(Seed.playerEffects.loadExpire>uW.unixtime()){loadEffectBoost=0.25}
   var loadBoostBase=(EffetTronePrc(6).percent*0.01)+loadEffectBoost+techLoadBoost;
   var loadBoost=loadBoostBase;
   if(uW.cm.unitFrontendType[untid]=="horsed"){
     loadBoost+=(EffetTronePrc(48).percent*0.01)
   }
   esti=parseInt(total_units*parseInt(uW.unitstats["unt"+untid][5])*(1+loadBoost));

   if (ic==5) {
    esti = parseInt(esti / 5);
   }
   var x1 = parseInt(t.sourceCity.x);
   var x2 = parseInt(t.destinationCityx.value);
   var y1 = parseInt(t.sourceCity.y);
   var y2 = parseInt(t.destinationCityy.value);
   var dist = distance (x1, y1, x2, y2);
   var m = estETA(dist,ById('typetrp').value,t.sourceCity.id,1);
   var a="";
   switch(ic){
    case 0:a=unsafeWindow.g_js_strings.commonstr.gold;break;
    case 1:a=unsafeWindow.g_js_strings.commonstr.food;break;
    case 2:a=unsafeWindow.g_js_strings.commonstr.wood;break;
    case 3:a=unsafeWindow.g_js_strings.commonstr.stone;break;
    case 4:a=unsafeWindow.g_js_strings.commonstr.ore;break;
    case 5:a=unsafeWindow.g_js_strings.commonstr.aetherstone;break;
   }
   t.estimationRes.innerHTML = "<b>" + addCommas(esti) + " "+a+"</b>";
   t.estimationRes.innerHTML += "<br>"+lang.General.EstimateT+" : <b>" + m.friendEtaStr + "</b>" ;

     if (ic==5)
      resact = parseIntNan(Seed.resources[cityID][ic_ty][0]);
     else {
      if (ic==0)
       resact = parseIntNan(Seed.citystats[cityID].gold[0]);
      else
       resact = parseIntNan(Seed.resources[cityID][ic_ty][0] / 3600);
     }
    if (resact < esti) {
     var untid=t.typetrp.value;
     var techLoadBoost=parseInt(Seed.tech.tch10)*0.1;
     var loadEffectBoost=0;
     if(Seed.playerEffects.loadExpire>uW.unixtime()){loadEffectBoost=0.25}
     		     var loadBoostBase=(EffetTronePrc(6).percent*0.01)+loadEffectBoost+techLoadBoost;
     		     var loadBoost=loadBoostBase;
     		      if(uW.cm.unitFrontendType[untid]=="horsed"){
     		       loadBoost+=(EffetTronePrc(48).percent*0.01)
     		      }
    var nbparunit=parseInt(uW.unitstats["unt"+untid][5])*(1+loadBoost);
    if (ic==5) nbparunit=nbparunit/5;
    var uniteness = Math.floor(resact / nbparunit);
    if (uniteness<1) uniteness=0;
    t.Choixnbwagon.value = uniteness;
    t.TTbutTransport.disabled = false;
    t.estimerRes();
   }
  },
  clickUniteMax: function() {
    var t = Tabs.TranspAuto;
    var maxw=parseInt(rows[t.typetrp.value][t.sourceCity.idx]);
    var niveauPointRall=parseInt(getCityBuilding (t.sourceCity.id, 12).maxLevel);
        var e=1;
      var f=unsafeWindow.unixtime();
      if(Seed.playerEffects.aurasExpire){
      if(Seed.playerEffects.aurasExpire>f){e=1.15}}
      if(Seed.playerEffects.auras2Expire){if(Seed.playerEffects.auras2Expire>f){e=1.3}}
    var maxtroupe=parseInt(niveauPointRall*10000*e);
    if (niveauPointRall==11) maxtroupe=parseInt(150000*e);
    if (niveauPointRall==12) maxtroupe=parseInt(200000*e);
    var q=EffetTronePrc(66).percent;
    maxtroupe=Math.floor(maxtroupe*(1+q/100));

    if (maxw>maxtroupe) maxw=maxtroupe;
    t.Choixnbwagon.value=maxw;
    t.estimerRes();
  },
  clickTransportDo: function() {
   var t = Tabs.TranspAuto;
   var SourceId = t.sourceCity.id;
   var DestinationId = t.destinationCity.id;
   if (!ById("ChoixRess0").checked && !ById("ChoixRess1").checked && !ById("ChoixRess2").checked && !ById("ChoixRess3").checked && !ById("ChoixRess4").checked && !ById("ChoixRess5").checked) {
       t.divTranportStatus.innerHTML = '<FONT COLOR=#550000>'+lang.transport.err2+'</font>';
      return;
   }
   if (t.sourceCity.x==t.destinationCityx.value && t.sourceCity.y==t.destinationCityy.value) {
      t.divTranportStatus.innerHTML = '<FONT COLOR=#550000>'+lang.transport.err3+'</font>';
     return;
   }
   if (parseInt(t.Choixnbwagon.value)=="0") {
   t.divTranportStatus.innerHTML = '<FONT COLOR=#550000>'+uW.g_js_strings.modal_attack_do.sendtroop+'</font>';
     return;
   }
   var x=t.destinationCityx.value;
   var y=t.destinationCityy.value;
   if (x == 0 && y == 0) {
      t.divTranportStatus.innerHTML = '<FONT COLOR=#550000>'+lang.transport.err4+'</font>';
     return;
   }
   t.TTbutTransport.disabled=true;
   var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
   params.kid = 0;
   params.cid= t.sourceCity.id;
   params.type = "1";
   params.xcoord = x;
   params.ycoord = y;
   params.r1 = 0;
   params.r2 = 0;
   params.r3 = 0;
   params.r4 = 0;
   params.r5 = 0;
   params.gold = 0;
   params.u9 = 0;
   var untid=t.typetrp.value
   var techLoadBoost=parseInt(Seed.tech.tch10)*0.1;
   var loadEffectBoost=0;
   if(Seed.playerEffects.loadExpire>uW.unixtime()){loadEffectBoost=0.25}
   var loadBoostBase=(EffetTronePrc(6).percent*0.01)+loadEffectBoost+techLoadBoost;
   var loadBoost=loadBoostBase;
   if(uW.cm.unitFrontendType[untid]=="horsed"){
   		       loadBoost+=(EffetTronePrc(48).percent*0.01)
   }
   var esti=parseInt(t.Choixnbwagon.value * parseInt(uW.unitstats["unt"+untid][5])*(1+loadBoost));
   if (ById("ChoixRess5").checked) {
    esti = parseInt(esti / 5);
   }
   if (ById("ChoixRess0").checked) { params.gold = esti; }
   if (ById("ChoixRess1").checked) { params.r1 = esti; }
   if (ById("ChoixRess2").checked) { params.r2 = esti; }
   if (ById("ChoixRess3").checked) { params.r3 = esti; }
   if (ById("ChoixRess4").checked) { params.r4 = esti; }
   if (ById("ChoixRess5").checked) { params.r5 = esti; }
   if (t.typetrp.value==1)  params.u1 = t.Choixnbwagon.value;
   if (t.typetrp.value==9)  params.u9 = t.Choixnbwagon.value;
   if (t.typetrp.value==7)  params.u7 = t.Choixnbwagon.value;
   if (t.typetrp.value==8)  params.u8 = t.Choixnbwagon.value;

  t.divTranportStatus.innerHTML = "<i><b>"+uW.g_js_strings.commonstr.loadingddd+"....</b></i>";
   new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
              method: "post",
              parameters: params,
              loading: true,
              onSuccess: function (transport) {
                  var t = Tabs.TranspAuto;
                  var rslt = transport;
                  if (rslt.ok) {
		   var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
                   var ut = unsafeWindow.unixtime();
                   var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
                   for(i = 0; i <= unitsarr.length; i++){
                   	if(params["u"+i]){
                  	unitsarr[i] = params["u"+i];
                  	}
                   }
                   var resources=new Array();
                   resources[0] = params.gold;
                   for(i=1; i<=4; i++){
                  	resources[i] = params["r"+i];
                   }
                   var currentcityid =  t.sourceCity.id;
                   unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
                   //unsafeWindow.update_seed(rslt.updateSeed)
                   if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
                   t.divTranportStatus.innerHTML = "<font size='3px'><b>"+lang.transport.trpdone+"</b>";
                   t.TTbutTransport.disabled=false;
                  } else {
		    t.divTranportStatus.innerHTML ="<font color=red size='3px'><b>"+lang.transport.trperr+"<b></font>";
		     if (rslt.msg) {
		       t.divTranportStatus.innerHTML +="<br><font color=black size='2px'>" + rslt.msg +"</font>";
		       t.TTbutTransport.disabled=false;
         	     } else {
         	      t.divTranportStatus.innerHTML +="<br>"+lang.transport.trptryagain+"</font>";
         	      setTimeout(function() { t.clickTransportDo(); }, 2000);
         	     }
                  }
                  },
                  onFailure: function (rslt) {
                   var t = Tabs.TranspAuto;
                   if (rslt.user_action) {
                    t.divTranportStatus.innerHTML ="<font color=red size='3px'><b>"+lang.transport.trperr+" CAPTCHA<b></font>";
                   } else {

                    t.divTranportStatus.innerHTML ="<font color=red size='3px'><b>"+lang.transport.trperr+"<b></font>";
                   }
                    t.TTbutTransport.disabled=false;
                  }
          });
  },
  clickCitySourceSelect : function (city){
    var t = Tabs.TranspAuto;
    t.sourceCity = city;
    t.TTbutTransport.disabled=false;
    var maxw=parseInt(rows[t.typetrp.value][t.sourceCity.idx]);
    var saisw=parseInt(t.Choixnbwagon.value);
    if (saisw > maxw)  t.Choixnbwagon.value=maxw;
    t.estimerRes();
   },
   clickCityDestinationSelect : function (city){
    var t = Tabs.TranspAuto;
    t.destinationCity = city;
    t.destinationCityx.value=t.destinationCity.x;
    t.destinationCityy.value=t.destinationCity.y;
    t.TTbutTransport.disabled=false;
    t.estimerRes();
   },

}

/*************** REASSIGNER **********/
var troops = {1:'SupplyTroops',
			  2:'Militiaman',
			  3:'Scout',
			  4:'Pikeman',
			  5:'Swordsman',
			  6:'Archer',
			  7:'Cavalry',
			  8:'HeavyCavalry',
			  9:'SupplyWagon',
			  10:'Ballista',
			  11:'BatteringRam',
			  12:'Catapult'};
Tabs.Reassign = {
  tabOrder: 7,
  tabLabel: uW.g_js_strings.commonstr.reassign,
 cont : null,
 displayTimer : null,
 state : null,
 curTabBut : null,
 curTabName : null,
 sourceCity : {},
 destinationCity : {},
 rows : [],
  timer: null,
  reassignState: [],
  lRE: [],
  reassignRoutes: [],
  rallypointlevel:null,
  count:0,
  check:false,
 show : function (){
 },
 hide : function (){
    var t = Tabs.Reassign;
    t.state = null;
    clearTimeout (t.displayTimer);
    clearTimeout (t.timer);
  },
  init : function (div){
   var t = Tabs.Reassign;
   t.cont = div;

   t.reassignState = {                running: false,    };
   t.readReassignState();
   t.readReassignRoutes();
   t.e_reassignRoutes();

  if (Options.BORac_Rea) AddSubTabLink(lang.reassign.buttonlab, t.toggleReassignState, 'pbsigntab');
  if (t.reassignState.running == false) {
       	       if (Options.BORac_Rea) updatebotbutton(lang.reassign.buttonlab+' - OFF', 'pbsigntab');
             } else {
       	      if (Options.BORac_Rea) updatebotbutton(lang.reassign.buttonlab+' - ON', 'pbsigntab');
        }
  window.addEventListener('unload', t.onUnload, false);
  t.cont = div;
  t.cont.innerHTML = '<TABLE class=ptTab align=center><TR><TD><INPUT class=bopbSubtab ID=BoReeSubM type=submit value="'+lang.transport.manu+'"></td>\
             <TD><INPUT class=bopbSubtab ID=BoReeSubA type=submit  value="'+lang.transport.auto+'"></td></tr></table>\
         <DIV id="BoReeOutput" style="margin-top:5px; background-color:white; height:'+(Options.HauteurBoite-65)+'px;max-height:'+(Options.HauteurBoite-65)+'px;overflow-y:auto"></div>';
  t.ReassignDiv = ById('BoReeOutput');
  ById('BoReeSubA').addEventListener('click', e_butSubtab, false);
  ById('BoReeSubM').addEventListener('click', e_butSubtab, false);
  changeSubtab (ById('BoReeSubM'));
  function e_butSubtab (evt){
          changeSubtab (evt.target);
      }
  function changeSubtab (but){
          if (but == t.curTabBut)
            return;
          if (t.curTabBut){
            t.curTabBut.className='bopbSubtab';
            t.curTabBut.disabled=false;
          }
          t.curTabBut = but;
          but.className='bopbSubtab bopbSubtabSel';
          but.disabled=true;
          t.curTabName = but.id.substr(8);
          t.show2();
      }

  },
   show2 : function (){
    var t = Tabs.Reassign ;
        t.state = null;
     clearTimeout (t.displayTimer);
     if (t.curTabName == 'M')
       t.showManuel();
     else
          t.showAuto();
     },

  showAuto: function() {
      var t = Tabs.Reassign ;
       clearTimeout (t.timer);
    if (t.state == null) {

      t.state = 1;

           var m = '<DIV id=pbReMainDivF class=boStat>'+lang.reassign.title+'</div><TABLE id=pbtraderfunctions width=100% height=0% class=pbTab><TR align="center">';
      if (t.reassignState.running == false) {
          m += '<TD><INPUT id=pbReassignState type=submit value="'+lang.reassign.buttonlab+'  = OFF"></td>';
	      if (Options.BORac_Rea)updatebotbutton(lang.reassign.buttonlab+' - OFF', 'pbsigntab');
      } else {
          m += '<TD><INPUT id=pbReassignState type=submit value="'+lang.reassign.buttonlab+'  = ON"></td>';
	      if (Options.BORac_Rea)updatebotbutton(lang.reassign.buttonlab+' - ON', 'pbsigntab');
      }
      m += '<TD><INPUT id=pbReassShowRoutes type=submit value="'+lang.reassign.showroute+'"></td>';
      m += '</tr></table></div>';
      m += '<DIV id=pbReassignDivD class=boStat>'+lang.reassign.addroute+'</div>';

      m += '<TABLE id=pbaddreasignroute width=95% height=0% class=pbTab><TR align="left">';
      m += '<TD width=20px>'+lang.reassign.from+'</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptassigncity></span></div></td></tr>';

      m += '<TR align="left">';
      m += '<TD width=20px>'+lang.reassign.to+'</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptassigncityTo></span></div></td>';

	    m += '<TR align="left">';
	    m += '<TD colspan=4>'+lang.reassign.pbreassigninterval+'<INPUT id=pbreassigninterval type=text size=2 value="'+Options.reassigninterval+'"\> '+lang.General.mins+'</td></tr>';
	    m += '<TR><TD colspan=4><INPUT id=autofilloff type=checkbox unchecked=true\> '+lang.reassign.autofilloff+'</TR></TD></table>';
      m += '';
      m += '<TABLE id=pbaddreasignroute width=100% height=0% class=pbTab><TR align="center">';
      m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_50.jpg?6545"></td>';
      m += '<TD>'+uW.unitcost['unt1'][0]+'</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_50.jpg?6545"></td>'
      m += '<TD>'+uW.unitcost['unt2'][0]+'</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_50.jpg?6545"></td>'
      m += '<TD>'+uW.unitcost['unt3'][0]+'</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_50.jpg?6545"></td>'
      m += '<TD>'+uW.unitcost['unt4'][0]+'</td></tr>'
      m += '<TR><TD><INPUT id=pbSupplyTroops type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetSupplyTroops disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbMilitiaman type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetMilitiaman disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbScout type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetScout disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbPikeman type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetPikeman disabled=true type=text size=10 maxlength=10 value="0"\></td></tr>';
      m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_50.jpg?6545"></td>';
      m += '<TD>'+uW.unitcost['unt5'][0]+'</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_50.jpg?6545"></td>'
      m += '<TD>'+uW.unitcost['unt6'][0]+'</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_50.jpg?6545"></td>'
      m += '<TD>'+unsafeWindow.unitcost['unt7'][0]+'</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_50.jpg?6545"></td>'
      m += '<TD>'+uW.unitcost['unt8'][0]+'</td></tr>'
      m += '<TR><TD><INPUT id=pbSwordsman type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetSwordsman disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbArcher type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetArcher disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbCavalry type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetCavalry disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbHeavyCavalry type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetHeavyCavalry disabled=true type=text size=10 maxlength=10 value="0"\></td></tr>';
      m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_50.jpg?6545"></td>';
      m += '<TD>'+uW.unitcost['unt9'][0]+'</td>'
      m += '<TD rowspan="2"><img src="http://0cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_50.jpg?6545"></td>'
      m += '<TD>'+uW.unitcost['unt10'][0]+'</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_50.jpg?6545"></td>'
      m += '<TD>'+uW.unitcost['unt11'][0]+'</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_50.jpg?6545"></td>'
      m += '<TD>'+uW.unitcost['unt12'][0]+'</td></tr>'
      m += '<TR><TD><INPUT id=pbSupplyWagon type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetSupplyWagon disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbBallista type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetBallista disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbBatteringRam type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetBatteringRam disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbCatapult type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetCatapult disabled=true type=text size=10 maxlength=10 value="0"\></td></tr></table>';
      m += '<DIV style="text-align:center; margin-top:15px"><INPUT id=pbSaveRouteReassign type=submit value="'+lang.reassign.pbSaveRouteReassign+'"></div>';
      t.ReassignDiv.innerHTML = m;

      t.tcp = new CdispCityPicker ('ptreassign', ById('ptassigncity'), true, null, 0);
	  t.tcpto = new CdispCityPicker ('ptreassignTo', ById('ptassigncityTo'), true);
	  for(var k in troops){
      ById('pbtarget'+troops[k]).value = parseInt(Seed.units['city' + t.tcp.city.id]['unt'+k]);
	  }

      ById('ptassigncity').addEventListener('click', function(){
		  if(ById('autofilloff').checked == false)
	    for(var k in troops)
        ById('pbtarget'+troops[k]).value = parseInt(Seed.units['city' + t.tcp.city.id]['unt'+k]);
      }, false);

      ById('pbReassignState').addEventListener('click', function(){
      	t.toggleReassignState(this);
      }, false);
      ById('pbSaveRouteReassign').addEventListener('click', function(){
      t.addReassignRoute();
      }, false);
      ById('pbReassShowRoutes').addEventListener('click', function(){
      t.showReassignRoutes();
      }, false);

      ById('pbreassigninterval').addEventListener('keyup', function(){
		if (parseIntNan(ById('pbreassigninterval').value)<10){ ById('pbreassigninterval').value=10 ;}
		Options.reassigninterval = ById('pbreassigninterval').value;
		saveOptions();
      }, false);

      ById('pbtargetSupplyTroops').addEventListener('keyup', function(){
          if (isNaN(ById('pbtargetSupplyTroops').value)) ById('pbtargetSupplyTroops').value=0 ;
      }, false);
      ById('pbtargetMilitiaman').addEventListener('keyup', function(){
          if (isNaN(ById('pbtargetMilitiaman').value)) ById('pbtargetMilitiaman').value=0 ;
      }, false);
      ById('pbtargetScout').addEventListener('keyup', function(){
          if (isNaN(ById('pbtargetScout').value)) ById('pbtargetScout').value=0 ;
      }, false);
      ById('pbtargetPikeman').addEventListener('keyup', function(){
          if (isNaN(ById('pbtargetPikeman').value)) ById('pbtargetPikeman').value=0 ;
      }, false);
      ById('pbtargetSwordsman').addEventListener('keyup', function(){
          if (isNaN(ById('pbtargetSwordsman').value)) ById('pbtargetSwordsman').value=0 ;
      }, false);
      ById('pbtargetArcher').addEventListener('keyup', function(){
          if (isNaN(ById('pbtargetArcher').value)) ById('pbtargetArcher').value=0 ;
      }, false);
      ById('pbtargetCavalry').addEventListener('keyup', function(){
          if (isNaN(ById('pbtargetCavalry').value)) ById('pbtargetCavalry').value=0 ;
      }, false);
      ById('pbtargetHeavyCavalry').addEventListener('keyup', function(){
          if (isNaN(ById('pbtargetHeavyCavalry').value)) ById('pbtargetHeavyCavalry').value=0 ;
      }, false);
      ById('pbtargetSupplyWagon').addEventListener('keyup', function(){
          if (isNaN(ById('pbtargetSupplyWagon').value)) ById('pbtargetSupplyWagon').value=0 ;
      }, false);
      ById('pbtargetBallista').addEventListener('keyup', function(){
          if (isNaN(ById('pbtargetBallista').value)) ById('pbtargetBallista').value=0 ;
      }, false);
     ById('pbtargetBatteringRam').addEventListener('keyup', function(){
         if (isNaN(ById('pbtargetBatteringRam').value)) ById('pbtargetBatteringRam').value=0 ;
     }, false);
     ById('pbtargetCatapult').addEventListener('keyup', function(){
         if (isNaN(ById('pbtargetCatapult').value)) ById('pbtargetCatapult').value=0 ;
     }, false);


      ById('pbSupplyTroops').addEventListener('click', function(){
          if (ById('pbSupplyTroops').checked==false) {
              ById('pbtargetSupplyTroops').disabled = true;
          }
          else {
            ById('pbtargetSupplyTroops').disabled = false;
          }
      },false);
      ById('pbMilitiaman').addEventListener('click', function(){
          if (ById('pbMilitiaman').checked==false) {
              ById('pbtargetMilitiaman').disabled = true;
          }
          else {
            ById('pbtargetMilitiaman').disabled = false;
          }
      },false);
      ById('pbScout').addEventListener('click', function(){
          if (ById('pbScout').checked==false) {
              ById('pbtargetScout').disabled = true;
          }
          else {
            ById('pbtargetScout').disabled = false;
          }
      },false);
      ById('pbPikeman').addEventListener('click', function(){
          if (ById('pbPikeman').checked==false) {
              ById('pbtargetPikeman').disabled = true;
          }
          else {
            ById('pbtargetPikeman').disabled = false;
          }
      },false);
      ById('pbSwordsman').addEventListener('click', function(){
          if (ById('pbSwordsman').checked==false) {
              ById('pbtargetSwordsman').disabled = true;
          }
          else {
            ById('pbtargetSwordsman').disabled = false;
          }
      },false);
      ById('pbArcher').addEventListener('click', function(){
          if (ById('pbArcher').checked==false) {
              ById('pbtargetArcher').disabled = true;
          }
          else {
            ById('pbtargetArcher').disabled = false;
          }
      },false);
      ById('pbCavalry').addEventListener('click', function(){
          if (ById('pbCavalry').checked==false) {
              ById('pbtargetCavalry').disabled = true;
          }
          else {
            ById('pbtargetCavalry').disabled = false;
          }
      },false);
      ById('pbHeavyCavalry').addEventListener('click', function(){
          if (ById('pbHeavyCavalry').checked==false) {
              ById('pbtargetHeavyCavalry').disabled = true;
          }
          else {
            ById('pbtargetHeavyCavalry').disabled = false;
          }
      },false);
      ById('pbSupplyWagon').addEventListener('click', function(){
          if (ById('pbSupplyWagon').checked==false) {
              ById('pbtargetSupplyWagon').disabled = true;
          }
          else {
            ById('pbtargetSupplyWagon').disabled = false;
          }
      },false);
      ById('pbBallista').addEventListener('click', function(){
          if (ById('pbBallista').checked==false) {
              ById('pbtargetBallista').disabled = true;
          }
          else {
            ById('pbtargetBallista').disabled = false;
          }
      },false);
      ById('pbBatteringRam').addEventListener('click', function(){
          if (ById('pbBatteringRam').checked==false) {
              ById('pbtargetBatteringRam').disabled = true;
          }
          else {
            ById('pbtargetBatteringRam').disabled = false;
          }
      },false);
      ById('pbCatapult').addEventListener('click', function(){
          if (ById('pbCatapult').checked==false) {
              ById('pbtargetCatapult').disabled = true;
          }
          else {
            ById('pbtargetCatapult').disabled = false;
          }
      },false);

        } else {


    	 }
  t.timer = setTimeout (t.showAuto, 3000);
  },
  getRallypoint: function(cityId){
        var t = Tabs.Reassign;
        for (var o in Seed.buildings[cityId]){
  		var buildingType = parseInt(Seed.buildings[cityId][o][0]);
  		var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
  		if (buildingType == 12) t.rallypointlevel=parseInt(buildingLevel);
  	   }
  	},
  e_reassignRoutes: function(){
        var t = Tabs.Reassign;
        var now = new Date();
        if (t.reassignState.running == true)    {
        	var now = new Date().getTime()/1000.0;
        	now = now.toFixed(0);
        	var last = Options.lastreassign;
         		if ( now > (parseInt(last) + (Options.reassigninterval*60))){
      			  t.checkdoReassign();
        		}
        }
        setTimeout(function(){ t.e_reassignRoutes();}, Options.reassigninterval*1000);

      },

  	delReassignRoutes: function() {

  		var t = Tabs.Reassign;

  		t.reassignRoutes= [];

  	},
  	checkcoords : function (obj){
  		var t = Tabs.Reassign;
  		if(obj.id == 'pbok'){
  			t.check = true;
  			t.addReassignRoute();
  		}
  		return;
  	},
  	addReassignRoute: function () {
  		var t = Tabs.Reassign;
  		var city = t.tcp.city.id;
  		if(t.tcpto.city == null)return;
  		if(t.tcp.city.id == t.tcpto.city.id)return;
  		t.check = false;
  		var SendSupplyTroop = ById('pbSupplyTroops').checked;
  		var SendMilitiaman = ById('pbMilitiaman').checked;
  		var SendScout = ById('pbScout').checked;
  		var SendPikeman = ById('pbPikeman').checked;
  		var SendSwordsman = ById('pbSwordsman').checked;
  		var SendArchers = ById('pbArcher').checked;
  		var SendCavalry = ById('pbCavalry').checked;
  		var SendHeavyCavalry = ById('pbHeavyCavalry').checked;
  		var SendSupplyWagons = ById('pbSupplyWagon').checked;
  		var SendBallista = ById('pbBallista').checked;
  		var SendBatteringRam = ById('pbBatteringRam').checked;
  		var SendCatapult = ById('pbCatapult').checked;
  		var SupplyTroop = ById('pbtargetSupplyTroops').value;
  		var Militiaman = ById('pbtargetMilitiaman').value;
  		var Scout = ById('pbtargetScout').value;
  		var Pikeman = ById('pbtargetPikeman').value;
  		var Swordsman = ById('pbtargetSwordsman').value;
  		var Archers = ById('pbtargetArcher').value;
  		var Cavalry = ById('pbtargetCavalry').value;
  		var HeavyCavalry = ById('pbtargetHeavyCavalry').value;
  		var SupplyWagons = ById('pbtargetSupplyWagon').value;
  		var Ballista = ById('pbtargetBallista').value;
  		var BatteringRam = ById('pbtargetBatteringRam').value;
  		var Catapult = ById('pbtargetCatapult').value;
  		var target_x = t.tcpto.city.x;
  		var target_y = t.tcpto.city.y;

  		var lRE = t.reassignRoutes;
  			lRE.push({
  				city:				city,
  				target_x:			target_x,
  				target_y:			target_y,
  				SendSupplyTroop:	SendSupplyTroop,
  				SupplyTroop:		SupplyTroop,
  				SendMilitiaman:		SendMilitiaman,
  				Militiaman:			Militiaman,
  				SendScout:			SendScout,
  				Scout:				Scout,
  				SendPikeman: 		SendPikeman,
  				Pikeman: 			Pikeman,
  				SendSwordsman:		SendSwordsman,
  				Swordsman:			Swordsman,
  				SendArchers:		SendArchers,
  				Archers:			Archers,
  				SendCavalry: 		SendCavalry,
  				Cavalry: 			Cavalry,
  				SendHeavyCavalry:	SendHeavyCavalry,
  				HeavyCavalry:		HeavyCavalry,
  				SendSupplyWagons:	SendSupplyWagons,
  				SupplyWagons:		SupplyWagons,
  				SendBallista: 		SendBallista,
  				Ballista: 			Ballista,
  				SendBatteringRam:	SendBatteringRam,
  				BatteringRam:		BatteringRam,
  				SendCatapult:		SendCatapult,
  				Catapult:			Catapult,
  			});
  		ById('pbReassignDivD').style.background ='#99FF99';
  		setTimeout(function(){ (ById('pbReassignDivD').style.background =''); }, 1000);
  	},
  	showReassignRoutes: function () {
  		var t = Tabs.Reassign;
  		var popReassignRoutes = null;
  		t.popReassignRoutes = new CPopup('pbShowTrade', 0, 0, 1100, 500, true, function() {clearTimeout (1000);});
  		var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbShowReassignRoutes" id="pbRoutesQueue">';
  		t.popReassignRoutes.getMainDiv().innerHTML = '</table></div>' + m;
  		t.popReassignRoutes.getTopDiv().innerHTML = '<TD><B>'+lang.reassign.popReassignRoutes+'</td>';
  		t.paintReassignRoutes();
  		t._addTabHeader();
  		t.popReassignRoutes.show(true)	;
  	},
  	paintReassignRoutes: function(){
  	        var t = Tabs.Reassign;
  	        var r = t.reassignRoutes;
  	        var cityname;
  			for (var i = (r.length-1); i>=0; i--) {
  				for (var y=0; y< Seed.cities.length;y++) {
  					if ( parseInt(Seed.cities[y][0]) == r[i].city) var cityname = Seed.cities[y][1];
  				}
  				var queueId = i;
  				t._addTab(queueId, cityname, r[i].target_x, r[i].target_y, r[i].SendSupplyTroop,r[i].SupplyTroop, r[i].SendMilitiaman, r[i].Militiaman, r[i].SendScout, r[i].Scout, r[i].SendPikeman, r[i].Pikeman, r[i].SendSwordsman, r[i].Swordsman, r[i].SendArchers, r[i].Archers, r[i].SendCavalry, r[i].Cavalry, r[i].SendHeavyCavalry, r[i].HeavyCavalry, r[i].SendSupplyWagons, r[i].SupplyWagons, r[i].SendBallista, r[i].Ballista, r[i].SendBatteringRam, r[i].BatteringRam, r[i].SendCatapult, r[i].Catapult);
  	        }
  	    },

  	 _addTab: function(queueId,cityname,target_x,target_y,SendSupplyTroop,SupplyTroop,SendMilitiaman,Militiaman,SendScout,Scout,SendPikeman,Pikeman,SendSwordsman,Swordsman,SendArchers,Archers,SendCavalry,Cavalry,SendHeavyCavalry,HeavyCavalry,SendSupplyWagons,SupplyWagons,SendBallista,Ballista,SendBatteringRam,BatteringRam,SendCatapult,Catapult){
  	 	var t = Tabs.Reassign;
  	     var row = ById('pbRoutesQueue').insertRow(0);
  	     row.vAlign = 'top';
  	     row.insertCell(0).innerHTML = queueId;
  	     row.insertCell(1).innerHTML = cityname;
  	     row.insertCell(2).innerHTML = target_x + ',' + target_y;
  	     row.insertCell(3).innerHTML = SendSupplyTroop;
  	     row.insertCell(4).innerHTML = addCommas(SupplyTroop);
  	     row.insertCell(5).innerHTML = SendMilitiaman;
  	     row.insertCell(6).innerHTML = addCommas(Militiaman);
  	 	 row.insertCell(7).innerHTML = SendScout;
  	 	 row.insertCell(8).innerHTML = addCommas(Scout);
  	 	 row.insertCell(9).innerHTML = SendPikeman;
  	 	 row.insertCell(10).innerHTML = addCommas(Pikeman);
  	 	 row.insertCell(11).innerHTML = SendSwordsman;
  	 	 row.insertCell(12).innerHTML = addCommas(Swordsman);
  	 	 row.insertCell(13).innerHTML = SendArchers;
  	 	 row.insertCell(14).innerHTML = addCommas(Archers);
  	 	 row.insertCell(15).innerHTML = SendCavalry;
  	 	 row.insertCell(16).innerHTML = addCommas(Cavalry);
  	 	 row.insertCell(17).innerHTML = SendHeavyCavalry;
  	 	 row.insertCell(18).innerHTML = addCommas(HeavyCavalry);
  	 	 row.insertCell(19).innerHTML = SendSupplyWagons;
  	 	 row.insertCell(20).innerHTML = addCommas(SupplyWagons);
  	 	 row.insertCell(21).innerHTML = SendBallista;
  	 	 row.insertCell(22).innerHTML = addCommas(Ballista);
  	 	 row.insertCell(23).innerHTML = SendBatteringRam;
  	 	 row.insertCell(24).innerHTML = addCommas(BatteringRam);
  	 	 row.insertCell(25).innerHTML = SendCatapult;
  	 	 row.insertCell(26).innerHTML = addCommas(Catapult);
  	     row.insertCell(27).innerHTML = '<a class="button20" id="tradecancel_' + queueId + '"><span>'+uW.g_js_strings.commonstr.remove+'</span></a>';
  	     ById('tradecancel_' + queueId).addEventListener('click', function(){
  	        t.cancelQueueElement(queueId);
  	     }, false);
  	 },

  	 _addTabHeader: function() {
  	     var t = Tabs.Reassign;
  	     var row = ById('pbRoutesQueue').insertRow(0);
  	     row.innerHTML='<td colspan=10><input type=button value="'+lang.transport.BOTrpQG+'" id=botradeQG>&nbsp;</td>';
  	     ById('botradeQG').addEventListener('click', function(){
  	      if (parseIntNan(Options.alertConfig.hq)>0) {
   	       var mavilleId=Cities.byID[Options.alertConfig.hq];
	       if (mavilleId) {
	        var r = t.reassignRoutes;
	        for (var i = (r.length-1); i>=0; i--) {
	           r[i].target_x=mavilleId.x;
          	   r[i].target_y=mavilleId.y;
	        }
	        t.showReassignRoutes();
	       }
	      }
  	     }, false);

  	     var row = ById('pbRoutesQueue').insertRow(0);
  	     row.vAlign = 'top';
  	     row.insertCell(0).innerHTML = "ID";
  	     row.insertCell(1).innerHTML = uW.g_js_strings.commonstr.from;
  	     row.insertCell(2).innerHTML = lang.General.to;
  	     row.insertCell(3).innerHTML = '<img height=20 title="'+unsafeWindow.unitcost['unt1'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_30_s34.jpg>';
  	     row.insertCell(4).innerHTML = "";
  	     row.insertCell(5).innerHTML = '<img height=20 title="'+unsafeWindow.unitcost['unt2'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_30_s34.jpg>';
  	     row.insertCell(6).innerHTML = "";
  	     row.insertCell(7).innerHTML = '<img height=20 title="'+unsafeWindow.unitcost['unt3'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_30_s34.jpg>';
  	     row.insertCell(8).innerHTML = "";
  	     row.insertCell(9).innerHTML = '<img height=20 title="'+unsafeWindow.unitcost['unt4'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_30_s34.jpg>';
  	     row.insertCell(10).innerHTML = "";
  	     row.insertCell(11).innerHTML = '<img height=20 title="'+unsafeWindow.unitcost['unt5'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_30_s34.jpg>';
  	     row.insertCell(12).innerHTML = "";
  	     row.insertCell(13).innerHTML = '<img height=20 title="'+unsafeWindow.unitcost['unt6'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_30_s34.jpg>';
  	     row.insertCell(14).innerHTML = "";
  	     row.insertCell(15).innerHTML = '<img height=20 title="'+unsafeWindow.unitcost['unt7'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_30_s34.jpg>';
  	     row.insertCell(16).innerHTML = "";
  	     row.insertCell(17).innerHTML = '<img height=20 title="'+unsafeWindow.unitcost['unt8'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_30_s34.jpg>';
  	     row.insertCell(18).innerHTML = "";
  	     row.insertCell(19).innerHTML = '<img height=20 title="'+unsafeWindow.unitcost['unt9'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_30_s34.jpg>';
  	     row.insertCell(20).innerHTML = "";
  	     row.insertCell(21).innerHTML = '<img height=20 title="'+unsafeWindow.unitcost['unt10'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_30_s34.jpg>';
  	     row.insertCell(22).innerHTML = "";
  	     row.insertCell(23).innerHTML = '<img height=20 title="'+unsafeWindow.unitcost['unt11'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_30_s34.jpg>';
  	     row.insertCell(24).innerHTML = "";
  	     row.insertCell(25).innerHTML = '<img height=20 title="'+unsafeWindow.unitcost['unt12'][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_30_s34.jpg>';
  	     row.insertCell(26).innerHTML = "";
  	     row.insertCell(27).innerHTML = "X";
  	   },

  	 cancelQueueElement: function(queueId){
  	     var t = Tabs.Reassign;
  	     var queueId = parseInt(queueId);
  	     t.reassignRoutes.splice(queueId, 1);
  	     t.showReassignRoutes();
  	 },

  	saveReassignRoutes: function(){
  		var t = Tabs.Reassign;
          var serverID = getServerId();
          GM_setValue('reassignRoutes_' + serverID, JSON2.stringify(t.reassignRoutes));
      },
      readReassignRoutes: function(){
          var t = Tabs.Reassign;
          var serverID = getServerId();
          s = GM_getValue('reassignRoutes_' + serverID);
          if (s != null) {
              route = JSON2.parse(s);
              for (k in route)
                  t.reassignRoutes[k] = route[k];
          }
      },
      saveReassignState: function(){
  		var t = Tabs.Reassign;
          var serverID = getServerId();
          GM_setValue('reassignState_' + serverID, JSON2.stringify(t.reassignState));
      },
      readReassignState: function(){
          var t = Tabs.Reassign;
          var serverID = getServerId();
          s = GM_getValue('reassignState_' + serverID);
          if (s != null) {
              state = JSON2.parse(s);
              for (k in state)
                  t.reassignState[k] = state[k];
          }
      },
      toggleReassignState: function(obj){
  		var t = Tabs.Reassign;
  	obj = ById('pbReassignState');
          if (t.reassignState.running == true) {
              t.reassignState.running = false;
              if (obj) obj.value = lang.reassign.buttonlab+" = OFF";
  		    if (Options.BORac_Rea)updatebotbutton(lang.reassign.buttonlab+' - OFF', 'pbsigntab');
  			t.checkdoreassigntimeout = null;
  			t.count = 0;
  			  		  Options.lastreassign = 0;
			  		  saveOptions();

          }
          else {
              t.reassignState.running = true;
              if (obj) obj.value = lang.reassign.buttonlab+" = ON";
  		    if (Options.BORac_Rea) updatebotbutton(lang.reassign.buttonlab+' - ON', 'pbsigntab');
  			t.e_reassignRoutes();
          }
      },

     checkdoReassign: function(){
  	var t = Tabs.Reassign;
  	t.doReassign(t.count);
  	t.count++;
  		if(t.count < t.reassignRoutes.length && t.reassignState.running){
  		  t.checkdoreassigntimeout = setTimeout(function() { t.checkdoReassign();}, 5000);
  		} else {
  		  var now = new Date().getTime()/1000.0;
  		  now = now.toFixed(0);
  		  Options.lastreassign = now;
  		  saveOptions();
  		  t.count = 0;
  		}
  	},

      doReassign: function(count){
      	var t = Tabs.Reassign;
     		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
     		if(t.reassignRoutes.length==0) return;
     		var send=[];
     		var citytotal=0;
     		var totalsend=0;
  		params.u1 = 0;
  		params.u2 = 0;
  		params.u3 = 0;
  		params.u4 = 0;
  		params.u5 = 0;
  		params.u6 = 0;
  		params.u7 = 0;
  		params.u8 = 0;
  		params.u9 = 0;
  		params.u10 = 0;
  		params.u11 = 0;
  		params.u12 = 0;

     	 	var city = t.reassignRoutes[count]["city"];
     	 	var xcoord = t.reassignRoutes[count]["target_x"];
     	 	var ycoord = t.reassignRoutes[count]["target_y"];

      	var cityID = 'city' + city;
  		if(!Cities.byID[city]) return;
  		var marching = getMarchInfoBOT(cityID);
      	t.getRallypoint(cityID);
  		if(t.rallypointlevel == 11) t.rallypointlevel = 15;
      	var maxsend = (t.rallypointlevel * 10000);
      	totalsend=0;

      	var troopsselect=["SupplyTroop","Militiaman","Scout","Pikeman","Swordsman","Archers","Cavalry","HeavyCavalry","SupplyWagons","Ballista","BatteringRam","Catapult"];
      	for (k=0; k<troopsselect.length; k++) {
  			var citytroops = Seed.units[cityID]['unt'+(parseInt(k)+1)];
  			var marchtroops = marching.marchUnits[parseInt(k)+1];
  			citytotal = parseInt(citytroops) + parseInt(marchtroops);
  			if(t.reassignRoutes[count]['Send'+troopsselect[k]]==false) {continue; }
  			if(citytotal > t.reassignRoutes[count][troopsselect[k]]){
  				var sendtroops = parseInt(citytotal) - parseInt(t.reassignRoutes[count][troopsselect[k]]);
  				if (parseInt(sendtroops) > parseInt(citytroops)) sendtroops = citytroops;
  				if (parseInt(sendtroops) < 0) sendtroops = 0;
  				send[(parseInt(k)+1)] = sendtroops;
  				totalsend += send[(parseInt(k)+1)];

  			}
  			if(totalsend > maxsend){
  				totalsend -= send[(parseInt(k)+1)];
  				send[(parseInt(k)+1)] = parseInt(maxsend-totalsend);
  				totalsend += send[(parseInt(k)+1)];
  				break;
  			}
         	}

      	for (var zz=0; zz< Seed.cities.length;zz++) {
      		if ( parseInt(Seed.cities[zz][0]) == city) var cityname = Seed.cities[zz][1];
      	}

    		params.cid= city;
  		params.type = "5";
  		params.kid=0;
  		params.xcoord = xcoord;
  		params.ycoord = ycoord;
  		params.u1 = send[1];
  		params.u2 = send[2];
  		params.u3 = send[3];
  		params.u4 = send[4];
  		params.u5 = send[5];
  		params.u6 = send[6];
  		params.u7 = send[7];
  		params.u8 = send[8];
  		params.u9 = send[9];
  		params.u10 = send[10];
  		params.u11 = send[11];
  		params.u12 = send[12];

     		if (totalsend >0) {
        		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
                    method: "post",
                    parameters: params,
                    loading: true,
                    onSuccess: function (transport) {
                    var rslt = eval("(" + transport.responseText + ")");
                    if (rslt.ok) {
                    var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
                    var ut = unixTime();
                    var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
                    					for(i = 0; i <= unitsarr.length; i++){
                    						if(params["u"+i]){
                    								unitsarr[i] = params["u"+i];
                    						}
                    					}
                    var resources=[0,0,0,0,0,0,0,0,0,0,0,0,0];
                    var currentcityid = city;
                    unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
                    if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
                    actionLog("Reassign","From: " + cityname + " to : " + xcoord + ',' + ycoord + "    ->   "+uW.g_js_strings.commonstr.troops+" : " + totalsend);
                    } else {
                    actionLog("Reassign","<font color=red>" + transport.responseText + "</font>");
                    }
                    },
                    onFailure: function (transport) {
                      var rslt = eval("(" + transport.responseText + ")");
                      if (rslt.user_action) {
		      						actionLog("Reassign","<b><font color=red>Detection Captcha</font></b>");
		      						new CdialogCancelContinue('<SPAN class=boldRed>CAPTCHA ALERT ! - REASSIGN AUTO</span>', null, null, mainPop.getMainDiv());
			} else {
                      actionLog("Reassign","<font color=red>" + transport.responseText + "</font>");

                    }
                    }
            });
     	 }
  	},
      show: function(){
  		var t = Tabs.Reassign;
      },
  	hide: function(){
          var t = Tabs.Reassign;
      },
      onUnload: function(){
          var t = Tabs.Reassign;
          if (!ResetAll) t.saveReassignRoutes();
  	  if (!ResetAll) t.saveReassignState();
    },
  showManuel: function() {
    var t = Tabs.Reassign;
    var ModelCity = {};
    var rownum = 0;
    var rownum2 = 0;
    function _row (name, row, noTotal){
          if (rownum++ % 2)
            style = '';
          else
            style = ' style = "background: #e8e8e8"';
          var tot = 0;
          var m = [];
          m.push ('<TR style="background: #fff" align=right');
          m.push (style);
          m.push ('><TD');
          m.push (style);
          m.push ('><B>');
          m.push (name);
          m.push ('</td>');
          if (noTotal){
            m.push ('<TD');
            m.push (style);
            m.push ('>&nbsp;</td>');
          } else {
            for (i=0; i<row.length; i++)
              tot += row[i];
            m.push ('<TD style="background: #ffc">');
            m.push (addCommas(tot));
            m.push ('</td>');
          }
          for (i=0; i<row.length; i++){
            m.push ('<TD');
            m.push (style);
            m.push ('>');
            m.push (addCommas(row[i]));
            m.push ('</td>');
          }
          m.push ('</tr>');
          return m.join('');
    }
    if (t.state == null) {
      m = "<DIV class=boStat>"+lang.reassign.title2+"</div>";
      m +="<div id='statpourREA'></div>";
      m += "<TABLE width='450px' class=ptTab border=0 align=left>\
        <tr align=center valign=middle><td colspan=1 width=100><b><u>"+lang.General.source+"</b></u><br><span id=REAsrcRptspeedcity></span></td>\
        <td colspan=1 width='100px'><input type=button style='font-weight:bold' id=REAaction value='"+uW.g_js_strings.commonstr.reassign+"'></td>\
        <td colspan=1 width='100px'><b><u>"+lang.General.dest+"</b></u><br><span id=REAdesRptspeedcity></span></td><td width=150 colspan=1><b><u>"+lang.General.EstimateT+"</b></u><br>&nbsp;"+uW.g_js_strings.commonstr.distance+": <span id='BOEstimationREAD'>&nbsp;</span></td></tr>\
        <tr align=center valign=top><td width=100><div id=REAstatsource></div></td>\
        <td ><table cellspacing=0 cellpadding=0 width=99%>";
         for (r=1; r<13; r++){
         if (rownum++ % 2)
	             style = '';
	           else
            style = ' style = "background: #e8e8e8"';
	     m += '<tr '+style+'><td  align=right><img height=20 title="'+uW.unitcost['unt'+r][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_'+r+'_30_s34.jpg></td><td align=left><input style="border:1px solid black;height:16px;font-size:11px;" id="REAnbunit'+r+'" type=text size=7 value="0"></td></tr>';
   	}

        m += "</table></td><td><div id=REAstatdest></div></td>";
        m += "<td colspan=2><table cellspacing=0 cellpadding=0 width=80%>";
        for (r=1; r<13; r++){
        if (rownum++ % 2)
	            style = '';
	          else
            style = 'background: #e8e8e8;';
		    m += '<tr style="'+style+' height:16px;font-size:11px;"><td width=50% height=20 align=center><span id="BOEstimationREAZ'+r+'">&nbsp;</span></td></tr>';
   	}
      m += "</tr></table>";
      m += "</tr><tr><td colspan=4>"+uW.g_js_strings.commonstr.knight+": <SELECT id='REApiKnight' type=list></tr><tr><td colspan=4><div id='ptREAStatus' style='text-align:center;overflow-y:auto; max-height:30px; height: 30px;'></div></td></tr></table>";
      t.ReassignDiv.innerHTML = m;
      t.statpourREA = document.getElementById ('statpourREA');
      t.statutREA = document.getElementById ('ptREAStatus');
      t.actionREA = document.getElementById ('REAaction');
      t.actionREA.addEventListener ('click', t.clickReassigneDo, false);
      var dcp1 = new CdispCityPicker ('ptREA1', ById('REAdesRptspeedcity'), false, t.clickREACityDestinationSelect, 1);
      var dcp0 = new CdispCityPicker ('ptREA0', ById('REAsrcRptspeedcity'), false, t.clickREACitySourceSelect, Cities.byID[unsafeWindow.currentcityid].idx);
      t.state = 1;
      t.estimerTemps();
    }
    rows = [];
    rows[0]=[];
    m = "<TABLE class=ptTabLined cellspacing=0><TR valign=top align=right><TD width=20></td><TD width=88 style='background: #ffc'><B>TOTAL</b></td>";
    for(i=0; i<Cities.numCities; i++) {
             m += '<TD width=81><B>'+ Cities.cities[i].name.substring(0,10) +'</b></td>';
    }
    for (r=1; r<13; r++){
            rows[r] = [];
            for(i=0; i<Cities.numCities; i++) {
              cityID = 'city'+ Cities.cities[i].id;
              rows[r][i] = parseInt(Seed.units[cityID]['unt'+r]);
            }
    }
    for (r=1; r<13; r++){
     m += _row ('<img height=18 title="'+uW.unitcost['unt'+r][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_'+r+'_30_s34.jpg>', rows[r]);
    }
     row = [];
    for(i=0; i<Cities.numCities; i++) {
    	        var cityId = 'city'+ Cities.cities[i].id;
    	        var slots = 0;
    	        for (var k in Seed.queue_atkp[cityId]){
    	         march = Seed.queue_atkp[cityId][k];
    	         if (typeof (march) == 'object'){
    	           slots++;
    	         }
    	        }
	  var niveauPointRall=parseInt(getCityBuilding (Cities.cities[i].id, 12).maxLevel);t
	 if (niveauPointRall==12) niveauPointRall=11;
    	        row[i] = '<SPAN><B>'+ slots +'/'+ niveauPointRall +'</b></span>';
     }
    m += _row ('PR', row, true, 0);
    m += "</table>";
    t.statpourREA.innerHTML = m;
    clearTimeout (t.displayTimer);
    t.displayTimer = setTimeout (t.showManuel, 4000);
  },
  estimerTemps: function() {
       var t = Tabs.Reassign;
       var x1 = parseInt(t.sourceCity.x);
       var x2 = parseInt(t.destinationCity.x);
       var y1 = parseInt(t.sourceCity.y);
       var y2 = parseInt(t.destinationCity.y);
       var dist = distance (x1, y1, x2, y2);
       ById("BOEstimationREAD").innerHTML = "<b>" + dist + "</b>";
       for (r=1; r<13; r++){
          var m = estETA(dist, r, t.sourceCity.id,5);
          ById("BOEstimationREAZ"+r).innerHTML = "<b>" + m.friendEtaStr + "</b>";
       }
    },
  clickReassigneDo: function() {
   var t = Tabs.Reassign;
   t.statutREA.innerHTML = '';
    var totalunit=0;
   for (r=1; r<13; r++){
       if (parseInt(ById("REAnbunit"+r).value) > parseInt(ById("REAdestunit"+r).value)) {
         ById("REAnbunit"+r).style.backgroundColor="red";
         return false;
       }
       totalunit=totalunit+parseInt(ById("REAnbunit"+r).value);
       ById("REAnbunit"+r).style.backgroundColor="";
   }
   if (t.sourceCity.id==t.destinationCity.id) {
         t.statutREA.innerHTML = '<FONT COLOR=#550000>'+lang.transport.err3+'</font>';
        return;
   }
   if (totalunit==0) {
      t.statutREA.innerHTML = '<FONT COLOR=#550000>'+uW.g_js_strings.modal_attack_do.sendtroop+'</font>';
        return;
   }
       var e=1;
         var f=uW.unixtime();
         if(Seed.playerEffects.aurasExpire){
         if(Seed.playerEffects.aurasExpire>f){e=1.15}}
      if(Seed.playerEffects.auras2Expire){if(Seed.playerEffects.auras2Expire>f){e=1.3}}
      var q=EffetTronePrc(66).percent;

   var niveauPointRall=parseInt(getCityBuilding (t.sourceCity.id, 12).maxLevel);
         var maxtroupe=parseInt(niveauPointRall*10000*e);
         if (niveauPointRall==11) maxtroupe=parseInt(150000*e);
         if (niveauPointRall==12) maxtroupe=parseInt(200000*e);

      maxtroupe=Math.round(maxtroupe*(1+q/100));

   if (totalunit>maxtroupe) {
    t.statutREA.innerHTML = '<FONT COLOR=#550000>'+lang.reassign.err1+' '+maxtroupe+' '+lang.reassign.err2+'</font>';
    return;
   }
  t.actionREA.disabled=true;
  var x=t.destinationCity.x;
  var y=t.destinationCity.y;
  var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  params.u1 = ById("REAnbunit1").value;
  params.u2 = ById("REAnbunit2").value;
  params.u3 = ById("REAnbunit3").value;
  params.u4 = ById("REAnbunit4").value;
  params.u5 = ById("REAnbunit5").value;
  params.u6 = ById("REAnbunit6").value;
  params.u7 = ById("REAnbunit7").value;
  params.u8 = ById("REAnbunit8").value;
  params.u9 = ById("REAnbunit9").value;;
  params.u10 = ById("REAnbunit10").value;
  params.u11 = ById("REAnbunit11").value;
  params.u12 = ById("REAnbunit12").value;
  params.cid= t.sourceCity.id;
  params.type = "5";
  params.kid= ById("REApiKnight").value;
  params.xcoord = x;
  params.ycoord = y;
  t.statutREA.innerHTML ="<font size='2px'><b><i>"+lang.reassign.plzwait+"</i></b></font>";
  new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + uW.g_ajaxsuffix, {
	method: "post",
	parameters: params,
	loading: true,
	onSuccess: function (transport) {
	 var t = Tabs.Reassign;
	 var rslt = transport;
	 if (rslt.ok) {
	  var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
	  var ut = unsafeWindow.unixtime();
    	  var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
	  for(i = 0; i <= unitsarr.length; i++){
	    if(params["u"+i]){	unitsarr[i] = params["u"+i];	}
	  }
	  var resources=[0,0,0,0,0,0,0,0,0,0,0,0,0];
	  var currentcityid = t.sourceCity.id;
	  unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
	  t.clickREACitySourceSelect(t.sourceCity);
	  t.statutREA.innerHTML ="<font size='2px'><b>"+lang.reassign.done+" " + timestr(timediff)+"</font>";
	  t.actionREA.disabled=false;
	 } else {
          t.statutREA.innerHTML ="<font color=red size='2px'>"+lang.transport.trperr+"</font>";
          if (rslt.msg) {
           t.statutREA.innerHTML +="<br><font color=black size='2px'>" + rslt.msg +"</font>";
           t.actionREA.disabled=false;
          } else {
             t.statutREA.innerHTML +="<br>"+lang.transport.trptryagain+"</font>";
             setTimeout(function() { t.clickReassigneDo(); }, 2000);
          }
        }
       },
       onFailure: function () {
        var t = Tabs.Reassign;
         t.statutREA.innerHTML ="<font color=red>"+lang.transport.trperr+"</font>";
         t.actionREA.disabled=false;
       }
    });
 },
 clickREACitySourceSelect : function (city){
   var t = Tabs.Reassign;
   var rownum=0;
   if (t.sourceCity!=city) {
         t.sourceCity = city;
    for (r=1; r<13; r++){
     ById("REAnbunit"+r).value="0";
    }
   } else {
    var cityID = 'city'+ t.sourceCity.id;
    for (r=1; r<13; r++){

      if (parseInt(Seed.units[cityID]['unt'+r]) < ById("REAnbunit"+r).value)  ById("REAnbunit"+r).value="0";
    }
   }
   t.actionREA.disabled=false;
   var m="";
   m="<table cellspacing=0 cellpadding=0 width=80%>";
   var cityID = 'city'+ t.sourceCity.id;
   for (r=1; r<13; r++){
       if (rownum++ % 2)
   	            style = '';
   	          else
            style = 'background: #e8e8e8;';
     m += '<tr style="'+style+'"><td align=right><img title="'+uW.unitcost['unt'+r][0]+'" height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_'+r+'_30_s34.jpg></td>\
           <td align=left><input style="border:1px solid black;height:16px;font-size:11px;" id="REAdestunit'+r+'" type=text size=7 readonly value="'+parseInt(Seed.units[cityID]['unt'+r])+'">&nbsp;\
           <input type=button value=">" id="REApdestunit'+r+'"  style="border:1px solid black;height:16px;font-size:11px;"></td></tr>';
   }
   m += "</table>";
   ById("REAstatsource").innerHTML = m;
   var knt = new Array();
   ById('REApiKnight').innerHTML="";
   var o = document.createElement("option");
   o.text = uW.g_js_strings.modal_attack.dchooseknightd;
	  o.value = 0;
   	  ById("REApiKnight").options.add(o);
   	  for (k in Seed.knights['city' + t.sourceCity.id]){
          		if (Seed.knights['city' + t.sourceCity.id][k]["knightStatus"] == 1 && Seed.leaders['city' + t.sourceCity.id]["resourcefulnessKnightId"] != Seed.knights['city' + t.sourceCity.id][k]["knightId"] && Seed.leaders['city' + t.sourceCity.id]["politicsKnightId"] != Seed.knights['city' + t.sourceCity.id][k]["knightId"] && Seed.leaders['city' + t.sourceCity.id]["combatKnightId"] != Seed.knights['city' + t.sourceCity.id][k]["knightId"] && Seed.leaders['city' + t.sourceCity.id]["intelligenceKnightId"] != Seed.knights['city' + t.sourceCity.id][k]["knightId"]){
          			knt.push ({
          				Name:   Seed.knights['city' + t.sourceCity.id][k]["knightName"],
          				Combat:	Seed.knights['city' + t.sourceCity.id][k]["combat"],
          				ID:	Seed.knights['city' + t.sourceCity.id][k]["knightId"],
          			});
          		}
          }
   knt = knt.sort(function sort(a,b) {a = parseInt(a['Combat']);b = parseInt(b['Combat']);return a == b ? 0 : (a > b ? -1 : 1);});
   for (k in knt){
       			if (knt[k]["Name"] !=undefined){
   	    			var o = document.createElement("option");
   	    			o.text = (knt[k]["Name"] + ' (' + knt[k]["Combat"] +')')
   	    			o.value = knt[k]["ID"];
   	    			ById("REApiKnight").options.add(o);
       			}
   }
   for (r=1; r<13; r++){
     ById("REApdestunit"+r).addEventListener ('click', function() {
       var nomcha=this.id.replace("REApdest","REAdest");
       var nomcha2=this.id.replace("REApdestunit","REAnbunit");
       ById(nomcha2).value=0;
           var e=1;
               var f=uW.unixtime();
               if(Seed.playerEffects.aurasExpire){
               if(Seed.playerEffects.aurasExpire>f){e=1.15}}
            if(Seed.playerEffects.auras2Expire){if(Seed.playerEffects.auras2Expire>f){e=1.3}}
            var q=EffetTronePrc(66).percent;

         var niveauPointRall=parseInt(getCityBuilding (t.sourceCity.id, 12).maxLevel);
               var maxtroupe=parseInt(niveauPointRall*10000*e);
               if (niveauPointRall==11) maxtroupe=parseInt(150000*e);
               if (niveauPointRall==12) maxtroupe=parseInt(200000*e);

      maxtroupe=Math.round(maxtroupe*(1+q/100));
       var nbunitto=0;
       for (r=1; r<13; r++) {
         nbunitto+=parseInt(ById("REAnbunit"+r).value);
       }
       var libre = parseInt(maxtroupe - nbunitto);
       if (ById(nomcha).value>=libre) {
         ById(nomcha2).value = libre;
       }  else {
         ById(nomcha2).value= ById(nomcha).value;
       }
      }, false);
   }
   t.estimerTemps();
 },
 clickREACityDestinationSelect : function (city){
    var t = Tabs.Reassign;
    var rownum=0;
    t.destinationCity = city;
    var m="";
    m="<table cellspacing=0 cellpadding=0 width=80%>";
    for (r=1; r<13; r++){
       if (rownum++ % 2)
   	            style = '';
   	          else
            style = 'background: #e8e8e8;';
         cityID = 'city'+ t.destinationCity.id;
         m += '<tr style="'+style+'"><td align=right><img height=20 title="'+unsafeWindow.unitcost['unt'+r][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_'+r+'_30_s34.jpg></td><td align=left><input style="border:1px solid black;height:16px;font-size:11px;" type=text size=7 readonly value="'+parseInt(Seed.units[cityID]['unt'+r])+'"></td></tr>';
    }
    m += "</table>";
    ById("REAstatdest").innerHTML = m;
    t.estimerTemps();
  },
}

Tabs.autoFormation= {
 tabOrder: 9,
 tabLabel: lang.BoiteLabelautoFormation,
 cont : null,
 nbfil : 0,
 crfil : 0,
 timer:null,
 city : 0,
 numcity :-1,
 init : function (div){
   var t = Tabs.autoFormation;
   t.cont = div;
   t.state = null;
   if (Options.BORac_Tra) AddSubTabLink(lang.autoForm.buttonlabel, t.toggleautoFormationState, 'pbformtab');
   if (TrainOptions.Running == false) {
      if (Options.BORac_Tra) updatebotbutton(lang.autoForm.buttonlabel+' - OFF', 'pbformtab');
   } else {
      if (Options.BORac_Tra) updatebotbutton(lang.autoForm.buttonlabel+' - ON', 'pbformtab');
      t.timer=setTimeout(t.Start,5000);
   }
   if (TrainOptions.timelauch<5) {
    TrainOptions.timelauch=5;
    saveTrainingOptions();

   }
   return t.cont;
  },
 Start: function() {
  var t = Tabs.autoFormation;
  if (!TrainOptions.Running) {
    clearTimeout(t.timer);
    return;
  }
  if (t.numcity<Cities.numCities-1) {
      t.numcity++;
    } else {
     t.numcity=-1;
     clearTimeout(t.timer);

     t.timer=setTimeout(t.Start,parseIntNan(TrainOptions.timelauch*60)*1000);
     return;
  }
  var c=t.numcity;
  var cityId=Cities.cities[c].id;
  if (!TrainOptions.listactif[cityId]) t.Start();
  var populationdispo = 0;
  if(!TrainOptions.listlabour[cityId]) {
   populationdispo = parseIntNan(Seed.citystats['city'+cityId].pop[0]) - parseIntNan(Seed.citystats['city'+cityId].pop[3]);
  }else {
    populationdispo = parseIntNan(Seed.citystats['city'+cityId].pop[0]).toFixed(0);
  }
  var availableTrainingSlots = 0;
  try{
   	var barracksTotal = getCityBuilding(cityId, 13).count;
   	var trainingSlotsUsed = Seed.queue_unt['city'+cityId].length;
   	if(trainingSlotsUsed!=null){
   	  availableTrainingSlots = barracksTotal-trainingSlotsUsed;
   	}
  }finally{

   }
   maxunite = t.unitemax(cityId, TrainOptions.list[Cities.cities[c].id],(c+1));
   var resources = t.checkresources(cityId, c);
   if (!resources) {
    actionLog("AutoForm",Cities.cities[c].name+ " - ERREUR : Ressources - possible de faire : "+maxunite+"/"+parseInt(TrainOptions.unitemin[Cities.cities[c].id]));
    return;
   }
   if(availableTrainingSlots>0 && maxunite>=parseIntNan(TrainOptions.unitemin[Cities.cities[c].id]) && TrainOptions.listactif[Cities.cities[c].id]) {
       var unitId = TrainOptions.list[cityId];
       var num = parseInt(maxunite);
       if (TrainOptions.unitemax[Cities.cities[c].id] != undefined) {
        var maxnum = TrainOptions.unitemax[Cities.cities[c].id];
        if (num>parseInt(TrainOptions.unitemax[Cities.cities[c].id])) num=parseInt(TrainOptions.unitemax[Cities.cities[c].id]);
       }
       var gam= TrainOptions.listboost[cityId];
       var time = unsafeWindow.modal_barracks_traintime(unitId, num);
         var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
         params.cid = cityId;
         params.type = unitId;
         params.quant = num;
         //params.items = 0;
         if (parseInt(TrainOptions.Item[(c+1)])) {
          params.items = TrainOptions.Item[(c+1)];
         }
         params.gambleId = gam;
         new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/train.php" + unsafeWindow.g_ajaxsuffix, {
           method: "post",
           parameters: params,
           loading: true,
           onSuccess: function(transport) {
            var rslt = eval("(" + transport.responseText + ")");
             if (rslt.ok) {
               var resourceFactors=[],resourceLost;
	              if(gam!=null){
	                time=rslt.timeNeeded;
	       	      }
	               for(var i=1;i<5;i++){
	               if(rslt.gamble){
	                resourceFactors.push(rslt.gamble[i.toString()]);
	               }else{
	               resourceFactors.push(1);
	               }
	               resourceLost=parseInt(unsafeWindow.unitcost["unt"+unitId][i])*3600*parseInt(num);resourceLost=resourceLost*resourceFactors[i-1];
	               unsafeWindow.seed.resources["city"+cityId]["rec"+i][0]=parseInt(unsafeWindow.seed.resources["city"+cityId]["rec"+i][0])-resourceLost;
       }
   unsafeWindow.seed.citystats["city"+cityId].gold[0]=parseInt(unsafeWindow.seed.citystats["city"+cityId].gold[0])-parseInt(unsafeWindow.unitcost["unt"+unitId][5])*parseInt(num);
         unsafeWindow.seed.citystats["city"+cityId].pop[0]=parseInt(unsafeWindow.seed.citystats["city"+cityId].pop[0])-parseInt(unsafeWindow.unitcost["unt"+unitId][6])*parseInt(num);
         unsafeWindow.seed.queue_unt["city"+cityId].push([unitId,num,rslt.initTS,parseInt(rslt.initTS)+time,0,time,null]);

	if(rslt.updateSeed) { unsafeWindow.update_seed(rslt.updateSeed) }
         actionLog("AutoForm",Cities.cities[c].name+" - " + num+" "+unsafeWindow.unitcost['unt'+ TrainOptions.list[Cities.cities[c].id]][0]+" OK");
             } else {
              actionLog("AutoForm",Cities.cities[c].name+ " - " + num+" "+unsafeWindow.unitcost['unt'+ TrainOptions.list[Cities.cities[c].id]][0]+"<br><font color=red>" + transport.responseText +"</font>");
             }
           },
           onFailure: function(o) {
            actionLog("AutoForm",Cities.cities[c].name+ " - " + num+" "+unsafeWindow.unitcost['unt'+ TrainOptions.list[Cities.cities[c].id]][0]+"<br><font color=red>" +o.responseText+"</font>");
           }
  	});
   } else {
    if (availableTrainingSlots<=0) {
       //actionLog("AutoForm",Cities.cities[c].name+ " - ERREUR : Slot non dispo");
    }
    if (maxunite<parseInt(TrainOptions.unitemin[Cities.cities[c].id])) {
       actionLog("AutoForm",Cities.cities[c].name+ " - ERREUR : Population ou Ressource - possible de faire : "+maxunite+"/"+parseInt(TrainOptions.unitemin[Cities.cities[c].id]));
       //if (t.numcity+1<Cities.numCities-1) return;
    }
   }

   var cityNo = t.numcity + 1;
   		if (TrainOptions.doTraps[cityNo])
   			t.doAutoTraps(cityNo);
   		if (TrainOptions.doCalrops[cityNo])
   			t.doAutoCaltrops(cityNo);
   		if (TrainOptions.doSpikes[cityNo])
   			t.doAutoSpikes(cityNo);
   		if (TrainOptions.doXbows[cityNo])
			t.doAutoCrossbows(cityNo);
   		if (TrainOptions.doTrebu[cityNo])
			t.doAutoTrebu(cityNo);


    clearTimeout(t.timer);
    t.timer=setTimeout(function() { t.Start(); },5000);

 },
 doAutoTraps: function (cityNo) {
 		var t = Tabs.autoFormation;
 		wall = {};
 		var cityId = Cities.cities[cityNo - 1].id
 		var cityID = 'city'+ cityId;
 		getWallInfo (cityId, wall);
 		availableSpace = wall.fieldSpace - wall.fieldSpaceUsed;
 		if (availableSpace > 0 && wall.slotsBusy < 3) {
 			var food = parseInt (Seed.resources['city'+cityId].rec1[0]/3600);
 			var wood = parseInt (Seed.resources['city'+cityId].rec2[0]/3600);
 			var stone = parseInt (Seed.resources['city'+cityId].rec3[0]/3600);
 			var ore = parseInt (Seed.resources['city'+cityId].rec4[0]/3600);
 			availableSlots = 3 - wall.slotsBusy;
 			var foodRes = TrainOptions.keepFood[cityNo];
 			var woodRes = TrainOptions.keepWood[cityNo];
 			var stoneRes = TrainOptions.keepStone[cityNo];
 			var oreRes = TrainOptions.keepOre[cityNo];
 			var availFood = food - foodRes;
 			var availWood = wood - woodRes;
 			var availStone = stone - stoneRes;
 			var availOre = ore - oreRes;
 		        secsPerTrap = Cities.byID[cityId]['Def60Time'];
 			if (secsPerTrap > 0 && availableSpace > 4 && availableSlots > 0) {
 				if (availFood > 400 && availWood > 800 & availStone > 200 & availOre > 400) {
 					var numberToTrain = 9999999999;
 					if ((availFood / 400) < numberToTrain)
 						numberToTrain = parseInt(availFood / 400);
 					if ((availWood / 800) < numberToTrain)
 						numberToTrain = parseInt(availWood / 800);
 					if ((availStone / 200) < numberToTrain)
 						numberToTrain = parseInt(availStone / 200);
 					if ((availOre / 400) < numberToTrain)
 						numberToTrain = parseInt(availOre / 400);
 					if (numberToTrain > 5)
 						numberToTrain = 5;
 					if (wall.Trap + wall.TrapTraining < 10 || availableSpace < 15) {
 						numberToTrain = 1;
 					}
 					actionLog("AutoForm",Cities.byID[cityId].name + ' - Construction ' + numberToTrain + ' piege ');
 					doDefTrain (cityId, 0, 60, numberToTrain);
 				}
 			}
 		}
  },
 doAutoCaltrops: function (cityNo) {
 		var t = Tabs.autoFormation;
 		var wall = {};
 		var cityId = Cities.cities[cityNo - 1].id;
 		var cityID = 'city'+ cityId;
 		getWallInfo (cityId, wall);
 		availableSpace = wall.fieldSpace - wall.fieldSpaceUsed;
 		if (availableSpace > 0 && wall.slotsBusy < 3) {
 			var food = parseInt (Seed.resources['city'+cityId].rec1[0]/3600);
 			var wood = parseInt (Seed.resources['city'+cityId].rec2[0]/3600);
 			var stone = parseInt (Seed.resources['city'+cityId].rec3[0]/3600);
 			var ore = parseInt (Seed.resources['city'+cityId].rec4[0]/3600);
 			availableSlots = 3 - wall.slotsBusy;
 			var foodRes = TrainOptions.keepFood[cityNo];
 			var woodRes = TrainOptions.keepWood[cityNo];
 			var stoneRes = TrainOptions.keepStone[cityNo];
 			var oreRes = TrainOptions.keepOre[cityNo];
 			var availFood = food - foodRes;
 			var availWood = wood - woodRes;
 			var availStone = stone - stoneRes;
 			var availOre = ore - oreRes;
 			secsPerCaltrop = Cities.byID[cityId]['Def61Time'];
 			if (secsPerCaltrop > 0 && availableSpace > 1 && availableSlots > 0) {
 				if (availFood > 100 && availOre > 400) {
 					var numberToTrain = 9999999999;
 					if ((availFood / 100) < numberToTrain)
 						numberToTrain = parseInt(availFood / 100);
 					if ((availOre / 400) < numberToTrain)
 						numberToTrain = parseInt(availOre / 400);
 					if (numberToTrain > 5)
 						numberToTrain = 5;
 					if (wall.Caltrops + wall.CaltropsTraining < 10 || availableSpace < 15) {
 						numberToTrain = 1;
 					}
 					actionLog("AutoForm",Cities.byID[cityId].name + ' - Construction ' + numberToTrain + ' chausse-trape ');
 					doDefTrain (cityId,0,61,numberToTrain);
 				}
 			}
 		}
	},
	doAutoSpikes: function (cityNo) {
		var t = Tabs.autoFormation;
		wall = {};
		var cityId = Cities.cities[cityNo - 1].id
		var cityID = 'city'+ cityId;
		getWallInfo (cityId, wall);
		availableSpace = wall.fieldSpace - wall.fieldSpaceUsed;
		if (availableSpace > 0 && wall.slotsBusy < 3) {
			var food = parseInt (Seed.resources['city'+cityId].rec1[0]/3600);
			var wood = parseInt (Seed.resources['city'+cityId].rec2[0]/3600);
			var stone = parseInt (Seed.resources['city'+cityId].rec3[0]/3600);
			var ore = parseInt (Seed.resources['city'+cityId].rec4[0]/3600);
			availableSlots = 3 - wall.slotsBusy;
			var foodRes = TrainOptions.keepFood[cityNo];
			var woodRes = TrainOptions.keepWood[cityNo];
			var stoneRes = TrainOptions.keepStone[cityNo];
			var oreRes = TrainOptions.keepOre[cityNo];
			var availFood = food - foodRes;
			var availWood = wood - woodRes;
			var availStone = stone - stoneRes;
			var availOre = ore - oreRes;
			secsPerSpike = Cities.byID[cityId]['Def62Time'];
			if (secsPerSpike > 0 && availableSpace > 3 && availableSlots > 0) {
				if (availFood > 150 && availWood > 750 & availStone > 50) {
					var numberToTrain = 9999999999;
					if ((availFood / 150) < numberToTrain)
						numberToTrain = parseInt(availFood / 150);
					if ((availWood / 750) < numberToTrain)
						numberToTrain = parseInt(availWood / 750);
					if ((availStone / 50) < numberToTrain)
						numberToTrain = parseInt(availStone / 50);
					if (numberToTrain > 5)
						numberToTrain = 5;
					if (wall.SpikedBarrier + wall.SpikedBarrierTraining < 10 || availableSpace < 15) {
						numberToTrain = 1;
					}
					actionLog("AutoForm",Cities.byID[cityId].name + ' - Construction ' + numberToTrain + ' palissade ');
					doDefTrain (cityId, 0, 62, numberToTrain);
				}
			}
		}
	},
	doAutoCrossbows: function (cityNo) {
		var t = Tabs.autoFormation;
		wall = {};
		var cityId = Cities.cities[cityNo - 1].id
		var cityID = 'city'+ cityId;
		getWallInfo (cityId, wall);
		availableSpace = wall.wallSpace - wall.wallSpaceUsed;
		if (availableSpace > 0 && wall.slotsBusy < 2) {
			var food = parseInt (Seed.resources['city'+cityId].rec1[0]/3600);
			var wood = parseInt (Seed.resources['city'+cityId].rec2[0]/3600);
			var stone = parseInt (Seed.resources['city'+cityId].rec3[0]/3600);
			var ore = parseInt (Seed.resources['city'+cityId].rec4[0]/3600);
			availableSlots = 2 - wall.slotsBusy;
			var foodRes = TrainOptions.keepFood[cityNo];
			var woodRes = TrainOptions.keepWood[cityNo];
			var stoneRes = TrainOptions.keepStone[cityNo];
			var oreRes = TrainOptions.keepOre[cityNo];
			var availFood = food - foodRes;
			var availWood = wood - woodRes;
			var availStone = stone - stoneRes;
			var availOre = ore - oreRes;
			secsPerXbow = Cities.byID[cityId]['Def53Time'];
			if (secsPerXbow > 0 && availableSpace > 2 && availableSlots > 0) {
				if (availFood > 250 && availWood > 2000 & availStone > 750 & availOre > 500) {
					var numberToTrain = 9999999999;
					if ((availFood / 250) < numberToTrain)
						numberToTrain = parseInt(availFood / 250);
					if ((availWood / 2000) < numberToTrain)
						numberToTrain = parseInt(availWood / 2000);
					if ((availStone / 750) < numberToTrain)
						numberToTrain = parseInt(availStone / 750);
					if ((availOre / 500) < numberToTrain)
						numberToTrain = parseInt(availOre / 500);
					if (numberToTrain > 5)
						numberToTrain = 5;
					if (wall.Crossbows + wall.CrossbowsTraining < 10 || availableSpace < 15) {
						numberToTrain = 1;
					}
					actionLog("AutoForm",Cities.byID[cityId].name + ' - Construction ' + numberToTrain + ' arbaletes ');
					doDefTrain (cityId, 0, 53, numberToTrain);
				}
			}
		}
	},
	doAutoTrebu: function (cityNo) {
		var t = Tabs.autoFormation;
		wall = {};
		var cityId = Cities.cities[cityNo - 1].id
		var cityID = 'city'+ cityId;
		getWallInfo (cityId, wall);
		availableSpace = wall.wallSpace - wall.wallSpaceUsed;
		if (availableSpace > 0 && wall.slotsBusy < 2) {
			var food = parseInt (Seed.resources['city'+cityId].rec1[0]/3600);
			var wood = parseInt (Seed.resources['city'+cityId].rec2[0]/3600);
			var stone = parseInt (Seed.resources['city'+cityId].rec3[0]/3600);
			var ore = parseInt (Seed.resources['city'+cityId].rec4[0]/3600);
			availableSlots = 2 - wall.slotsBusy;
			var foodRes = TrainOptions.keepFood[cityNo];
			var woodRes = TrainOptions.keepWood[cityNo];
			var stoneRes = TrainOptions.keepStone[cityNo];
			var oreRes = TrainOptions.keepOre[cityNo];
			var availFood = food - foodRes;
			var availWood = wood - woodRes;
			var availStone = stone - stoneRes;
			var availOre = ore - oreRes;
			secsPerTrebu = Cities.byID[cityId]['Def55Time'];
			if (secsPerTrebu > 0 && availableSpace > 4 && availableSlots > 0) {
				if (availFood > 500 && availWood > 3500 & availStone > 1800 & availOre > 1200) {
					var numberToTrain = 9999999999;
					if ((availFood / 500) < numberToTrain)
						numberToTrain = parseInt(availFood / 500);
					if ((availWood / 3500) < numberToTrain)
						numberToTrain = parseInt(availWood / 3500);
					if ((availStone / 1800) < numberToTrain)
						numberToTrain = parseInt(availStone / 1800);
					if ((availOre / 1200) < numberToTrain)
						numberToTrain = parseInt(availOre / 1200);
					if (numberToTrain > 5)
						numberToTrain = 5;
					if (wall.Trebuchet + wall.TrebuchetTraining < 10 || availableSpace < 15) {
						numberToTrain = 1;
					}
					actionLog("AutoForm",Cities.byID[cityId].name + ' - Construction ' + numberToTrain + ' trebuchet ');
					doDefTrain (cityId, 0, 55, numberToTrain);
				}
			}
		}
	},
 unitemax : function(currentcityid, e, numcity){

 var gumble = TrainOptions.listboost[currentcityid];
 var mult=1;
 if (gumble==0) mult=1;
 if (gumble==1) mult=2;
 if (gumble==2) mult=4;
 var b=new Array();
 var a=new Array();
 for(var d=1;d<5;d++){
  b.push((parseInt(unsafeWindow.unitcost["unt"+e][d])*3600)*mult);
  a.push(parseInt(unsafeWindow.seed.resources["city"+currentcityid]["rec"+d][0]))
 }
  b.push((parseInt(unsafeWindow.unitcost["unt"+e][5]))*mult);
  a.push(parseInt(unsafeWindow.seed.citystats["city"+currentcityid].gold[0]));
  b.push((parseInt(unsafeWindow.unitcost["unt"+e][6])));

  if (!TrainOptions.listlabour[currentcityid]) {
    a.push(parseInt(unsafeWindow.seed.citystats["city"+currentcityid].pop[0])-parseInt(unsafeWindow.seed.citystats["city"+currentcityid].pop[3]));
  } else {
    a.push(parseInt(unsafeWindow.seed.citystats["city"+currentcityid].pop[0])-parseInt(unsafeWindow.seed.citystats["city"+currentcityid].pop[3])+ parseInt((parseInt(unsafeWindow.seed.citystats["city"+currentcityid].pop[3])*(TrainOptions.Workers[numcity]/100))));
  }
  var c=a[0]/b[0];
  for(var d=1;d<b.length;d++)
  {
    if(parseInt(b[d])!=0){
     c=Math.min(c,a[d]/b[d])
    }
  }
  if (c<0) c=0
  return parseInt(c)||0
 },
 hide : function (){
    var t = Tabs.autoFormation;
    t.saveOptionsAutoF();
  },

  show : function (){
    var t = Tabs.autoFormation;
    uW.BO_AF_TU_Change = t.AF_TU_Change;
    m = "<DIV class=boStat>"+lang.autoForm.title+" - <input type=button value='?' id=boaideautoform class=boAide></div>";
    m += '<div style="height:' + (Options.HauteurBoite-60) +'px;max-height:' + (Options.HauteurBoite-60) +'px;overflow-y:auto"><TABLE width=720 class=ptTab border=0 align=center><tr align=center valign=top><TD>';
    if (TrainOptions.Running == false) {
       m += '<INPUT id=autoFormationtoggle type=submit value="'+lang.autoForm.buttonlabel+' = OFF">';
    } else {
       m += '<INPUT id=autoFormationtoggle type=submit value="'+lang.autoForm.buttonlabel+' = ON">';
    }
    m+="&nbsp;<INPUT id=autoMilicienstoggle type=submit value='"+lang.autoForm.mode+" : '><select id=BOModeFA>";
    for (r=1; r<13; r++){
     m+= "<option value='"+r+"'>"+uW.unitcost['unt'+r][0]+"</option>";
    }
    m+="</select></td></tr></table>";
    m += "<TABLE width=100% class=ptTab border=0 align=center cellspacing=0 cellpadding=1>\
          <tr align=center><td align=center style='border-bottom:1px solid black' colspan=2><b>"+uW.g_js_strings.commonstr.city+"</td>\
          <td align=center style='border-bottom:1px solid black'><b>"+uW.g_js_strings.commonstr.troops+"</td>\
          <td align=center style='border-bottom:1px solid black'><b>"+uW.g_js_strings.commonstr.troops+" Min</td>\
          <td align=center style='border-bottom:1px solid black'><b>"+uW.g_js_strings.commonstr.troops+" Max</td>\
          <td align=center style='border-bottom:1px solid black' colspan=2><a id=BO_WorkersCalc><b>"+uW.g_js_strings.showPopTooltip.lbrforce+"</a></td>\
          <tD align=center style='border-bottom:1px solid black'><b>Boost</td></tr>";
    var city=0;
    for (var c=0; c<Cities.numCities; c++) {
     cityId=Cities.cities[c].id;
     city = c+1;
     m+="<tr><td rowspan=3 width=10% align=left style='border-bottom:1px solid black'><b>"+(c+1)+"</b> : "+Cities.cities[c].name+"<br></td><td align=right rowspan=3 style='border-bottom:1px solid black'>";
     if (TrainOptions.listactif && TrainOptions.listactif[cityId] == false) {
      m+="<input type=checkbox id='autoFCheck_"+cityId+"'>";
     }else {
      m+="<input checked type=checkbox id='autoFCheck_"+cityId+"'>";
     }
     m+="</td><TD align=center><SELECT id='autoFType_"+cityId+"' onchange='BO_AF_TU_Change("+cityId+",this.value);'>";
     for (r=1; r<13; r++){
      var faux = 0;
      var uc = uW.unitcost['unt'+r];
      if (matTypeof(uc[8]) == 'object'){
            for (k in uc[8]){
              var b = getCityBuilding (cityId, k.substr(1));
              if (b.maxLevel < uc[8][k][1]){
                faux = 1;
                break;
              }
            }
          }
          if (matTypeof(uc[9]) == 'object'){
            for (k in uc[9]){
              if (parseInt(Seed.tech['tch'+k.substr(1)]) < uc[9][k][1]){
 	       faux = 1;
                break;
              }
            }
         }
       if (faux==0) {
	if (TrainOptions.list) {
	   if (r==TrainOptions.list[cityId]) {
		     	               m+= "<option selected value='"+r+"'>"+uW.unitcost['unt'+r][0]+"</option>";
           } else {
		     	               m+= "<option value='"+r+"'>"+uW.unitcost['unt'+r][0]+"</option>";
	   }
	}else{
	   if (r==2) {
	               m+= "<option selected value='"+r+"'>"+uW.unitcost['unt'+r][0]+"</option>";
	              } else {
	               m+= "<option value='"+r+"'>"+uW.unitcost['unt'+r][0]+"</option>";
	   }
       }
      }
    }
    if (TrainOptions.unitemax[Cities.cities[c].id] == undefined) TrainOptions.unitemax[Cities.cities[c].id] = 999999;
    if (isNaN(parseInt(TrainOptions.unitemin[cityId]))) TrainOptions.unitemin[cityId]=0 ;
    if (TrainOptions.Keep[city] == undefined) TrainOptions.Keep[city] ={};
    m+= "</select></td><td align=left><input type=text value='"+ parseIntNan(TrainOptions.unitemin[cityId]) +"' id='aFunitemin_"+cityId+"' size=4></td><td align=left><input type=text value='"+ parseIntNan(TrainOptions.unitemax[cityId]) +"' id='aFunitemax_"+cityId+"' size=5></td><td align=right>";
    if (TrainOptions.listlabour && TrainOptions.listlabour[cityId] == false) {
         m+="<input type=checkbox class="+city+" id='autoFWorkers_"+cityId+"'>";
    }else {
         m+="<input checked class="+city+" type=checkbox id='autoFWorkers_"+cityId+"'>";
    }
    m+="</td><td align=right>";
    m+='<SELECT class='+city+' id="workers'+city+'"><option value="0">0%</options>';
    m+='<option value="25">25%</options><option value="50">50%</options><option value="75">75%</options><option value="100">100%</options></select></td><td align=right>';
    m+="<select id='autoFboost_"+cityId+"'>";
    m+="<option value=0>Normal</option><option value=1 "+ (TrainOptions.listboost[cityId]==1?'SELECTED ':'') +">5-15%</option><option value=2 "+ (TrainOptions.listboost[cityId]==2?'SELECTED ':'') +">10-25%</option></select>";
    m+='<br><select class='+city+' id="TrainSpeedItem_'+city+'"><option value=0><CENTER>--- '+uW.g_js_strings.commonstr.items+' '+uW.g_js_strings.commonstr.speedup+' ---</center></option>\
 			<option value=36>'+uW.itemlist.i36.name+'</option>\
  			<option value=37>'+uW.itemlist.i37.name+'</option>\
			<option value=38>'+uW.itemlist.i38.name+'</option></select></td></tr>';
    m+='<TR><td colspan=6><img width=23 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/food_30.png">&nbsp;';
    m += '<INPUT class='+city+'  id="KeepFood'+city+'" type=text size=7 maxlength=8 value="'+ parseIntNan(TrainOptions.Keep[city]['Food'])+'"\>&nbsp;';
    m += '<img width=23 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/wood_30.png">&nbsp;';
    m += '<INPUT class='+city+' id="KeepWood'+city+'" type=text size=7 maxlength=8 value="'+ parseIntNan(TrainOptions.Keep[city]['Wood'])+'"\>&nbsp;';
    m += '<img width=23 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/stone_30.png">&nbsp;';
    m += '<INPUT class='+city+'  id="KeepStone'+city+'" type=text size=7 maxlength=8 value="'+ parseIntNan(TrainOptions.Keep[city]['Stone'])+'"\>&nbsp;';
    m += '<img width=23 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/iron_30.png">&nbsp;';
    m += '<INPUT class='+city+' id="KeepOre'+city+'" type=text size=7 maxlength=8 value="'+ parseIntNan(TrainOptions.Keep[city]['Ore'])+'"\>';
    m += "</td></tr><TR><td colspan=8 style='border-bottom:1px solid black'>"+lang.autoForm.DoTraps+" <INPUT class="+city+" type=CHECKBOX id='chkDoTraps"+city+"' "+ (TrainOptions.doTraps[city]?' CHECKED ':'') +">"+uW.fortcost.frt60[0]+"&nbsp;\
        	<INPUT class="+city+" type=CHECKBOX id='chkDoCaltrops"+city+"' "+ (TrainOptions.doCalrops[city]?' CHECKED ':'') +">"+uW.fortcost.frt61[0]+"&nbsp;\
        	<INPUT class="+city+" type=CHECKBOX id='chkDoSpikes"+city+"' "+ (TrainOptions.doSpikes[city]?' CHECKED ':'') +">"+uW.fortcost.frt62[0]+"&nbsp;\
        	<INPUT class="+city+" type=CHECKBOX id='chkDoXbows"+city+"' "+ (TrainOptions.doXbows[city]?' CHECKED ':'') +">"+uW.fortcost.frt53[0].substr(0,9)+"&nbsp;\
       	<INPUT class="+city+" type=CHECKBOX id='chkDoTrebu"+city+"' "+ (TrainOptions.doTrebu[city]?' CHECKED ':'') +">"+uW.fortcost.frt55[0]+"</TD></TR>";

    }
    m+="</table><table width=100% class=ptTab border=0><tr><td><u><b>"+lang.autoForm.options+"</b></u><br>"+lang.autoForm.interval+" <input id=aFtimelauch type=text size=2 value='"+parseInt(TrainOptions.timelauch)+"'> "+lang.General.mins+" "+lang.autoForm.note1+"\
         <br>"+lang.autoForm.bomodediv+" : <select id=BOModeDiv><option value=25>25%</option><option value=50>50%</option><option value=75>75%</option><option value=90>90%</option><option value=100>100%</option></select> - <input type=button value='"+lang.autoForm.BO_AllCalculate+"' id=BO_AllCalculate>'";
    m+="<br><br>"+lang.autoForm.title2+"</td></tr>\
    <tr><td><u><b>"+lang.autoForm.BO_AF_CancelFirst+"</b></u> <input type=checkbox id=BO_AF_CancelFirst> "+lang.autoForm.CancelTrain+"</td><td><input type=button value='"+uW.g_js_strings.modaltitles.deleteall+"' id=BO_AF_CancelAll></td></tr>\
    <tr><td><span id='BO_AF_Progression'></span></td></tr></table><br></div><br>";

    t.cont.innerHTML = m;
     ById('boaideautoform').addEventListener('click', function(){
    	       	 window.open(sitesupport+"?page=aide_autoform");
    	} , false);
    for (i=0;i<Seed.cities.length;i++){
            city = i+1;
            ById('workers'+city).value = TrainOptions.Workers[city];
            ById('TrainSpeedItem_'+city).value = TrainOptions.Item[city];
    }
    ById('BOModeDiv').value=TrainOptions.UnitMixValue;
    ById('BOModeDiv').addEventListener('change', function(e){
      TrainOptions.UnitMixValue=ById('BOModeDiv').value;
      for (var c=0; c<Cities.numCities; c++) {
           		cityId=Cities.cities[c].id;
                      t.AF_TU_Change(cityId,ById("autoFType_"+cityId).value);
      }

    },false);
    ById('BO_WorkersCalc').addEventListener('click', function(){
     t.workers();
    } , false);
    ById('BO_AllCalculate').addEventListener('click', function(){
        for (var c=0; c<Cities.numCities; c++) {
     		cityId=Cities.cities[c].id;
                t.AF_TU_Change(cityId,ById("autoFType_"+cityId).value);
      	}

    } , false);
    ById('autoFormationtoggle').addEventListener('click', function(){t.toggleautoFormationState(this)} , false);
    ById('autoMilicienstoggle').addEventListener('click', function(){t.milicien()} , false);
    ById('BO_AF_CancelAll').addEventListener('click', function(){t.AF_CancelAll()} , false);
    t.dispStatus = ById('BO_AF_Progression');
    var k=0;
    window.addEventListener('unload', t.onUnload, false);
    for (var c=0; c<Cities.numCities; c++) {
    	  k=c+1;
    	  cityID=Cities.cities[c].id;
    	  ById('autoFWorkers_'+cityID).addEventListener('click', function(e){

    	   cityId=Cities.cities[(e.target['className']-1)].id;
    	   TrainOptions.listlabour[cityId] = ById('autoFWorkers_'+cityId).checked;
	   t.AF_TU_Change(cityId,ById("autoFType_"+cityId).value);

    	  },false);


    	  ById('TrainSpeedItem_'+k).addEventListener('change', function(e){
	      TrainOptions.Item[e.target['className']] = e.target.value;
	      saveTrainingOptions();
	  }, false);
    	  ById('workers'+k).addEventListener('change', function(e){
	   TrainOptions.Workers[e.target['className']] = e.target.value;
	   cityId=Cities.cities[(e.target['className']-1)].id;
    	   t.AF_TU_Change(cityId,ById("autoFType_"+cityId).value);

      	  }, false);

    	 ById('chkDoTraps'+k).addEventListener('click', function(e){
    			TrainOptions.doTraps[e.target['className']] = e.target.checked;
         		saveTrainingOptions();
		}, false);
	ById('chkDoCaltrops'+k).addEventListener('click', function(e){
    			TrainOptions.doCalrops[e.target['className']] = e.target.checked;
         		saveTrainingOptions();
		}, false);
	ById('chkDoSpikes'+k).addEventListener('click', function(e){
    			TrainOptions.doSpikes[e.target['className']] = e.target.checked;
         		saveTrainingOptions();
		}, false);
       ById('chkDoXbows'+k).addEventListener('click', function(e){
    			TrainOptions.doXbows[e.target['className']] = e.target.checked;
         		saveTrainingOptions();
		}, false);
	 ById('chkDoTrebu'+k).addEventListener('click', function(e){
    			TrainOptions.doTrebu[e.target['className']] = e.target.checked;
         		saveTrainingOptions();
		}, false);
		ById('KeepFood'+k).addEventListener('change', function(e){
			if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Keep[e.target['className']]['Food'] = e.target.value;
            saveTrainingOptions();
      	}, false);
      	ById('KeepWood'+k).addEventListener('change', function(e){
      	    if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Keep[e.target['className']]['Wood'] = e.target.value;
            saveTrainingOptions();
      	}, false);
      	ById('KeepStone'+k).addEventListener('change', function(e){
			if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Keep[e.target['className']]['Stone'] = e.target.value;
            saveTrainingOptions();
      	}, false);
      	ById('KeepOre'+k).addEventListener('change', function(e){
      	    if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Keep[e.target['className']]['Ore'] = e.target.value;
            saveTrainingOptions();
      	}, false);
    }
  },
  unload:function() {
   var t = Tabs.autoFormation;
   t.saveOptionsAutoF();
  },
  checkresources : function(cityId, city){
  	var t = Tabs.autoFormation;
  	var city=city+1;
  	t.food = parseInt((Seed.resources['city'+cityId].rec1[0]/3600) - parseIntNan(TrainOptions['Keep'][city]['Food']));
  	t.wood = parseInt((Seed.resources['city'+cityId].rec2[0]/3600) - parseIntNan(TrainOptions['Keep'][city]['Wood']));
  	t.stone = parseInt((Seed.resources['city'+cityId].rec3[0]/3600) - parseIntNan(TrainOptions['Keep'][city]['Stone']));
  	t.ore = parseInt((Seed.resources['city'+cityId].rec4[0]/3600) - parseIntNan(TrainOptions['Keep'][city]['Ore']));
  	if(t.food>0 && t.wood>0 && t.stone>0 && t.ore>0){
  		return true;
  	}
  	return false;
  },
    AF_TU_Change: function(cityId,unit) {
     var t = Tabs.autoFormation;
     var coutenpop= unsafeWindow.unitcost['unt'+unit][6];
     var numcity=Cities.byID[cityId].idx+1;
     var X = Seed.citystats['city'+cityId]["pop"][1];
     var Y = unsafeWindow.seed.citystats["city"+cityId].pop[3];
     var Q= coutenpop;
     var Z = 0;
     var M = ById("BOModeDiv").value/100;
     if (ById("autoFWorkers_"+cityId).checked) {
        Z = ById('workers'+numcity).value/100;
        ById("aFunitemax_"+cityId).value = parseIntNan(X/Q);
     } else {
      Z = 0;
      ById("aFunitemax_"+cityId).value=parseIntNan((X-Y)/Q);
     }
     var Min =((X-(Y*(1-Z)))*M)/Q;
     if (Min<0) Min=0;
     ById("aFunitemin_"+cityId).value = parseIntNan(Min);
     if (ById("aFunitemax_"+cityId).value<0) { ById("aFunitemax_"+cityId).value=0;ById("aFunitemin_"+cityId).value =0; }
     t.saveOptionsAutoF();
  },

  workers:function() {
   var t = Tabs.autoFormation;
   for (var c=0; c<Cities.numCities; c++) {
    if (ById('workers'+(c+1)).value == "100")
     ById('workers'+(c+1)).value = "25"
    else
     ById('workers'+(c+1)).value = "100";

    TrainOptions.Workers[(c+1)] = ById('workers'+(c+1)).value ;
    cityId=Cities.cities[c].id;
    t.AF_TU_Change(cityId,ById("autoFType_"+cityId).value);
   }
   t.saveOptionsAutoF();
  },
  milicien: function() {
   var t = Tabs.autoFormation;
   var typeunite = ById('BOModeFA').value;
   ById('BOModeDiv').value="90";
   var coutenpop= unsafeWindow.unitcost['unt'+typeunite][6];
   for (var c=0; c<Cities.numCities; c++) {
    cityId=Cities.cities[c].id;
    ById("autoFWorkers_"+Cities.cities[c].id).checked=true;
    ById("autoFCheck_"+Cities.cities[c].id).checked=true;
    ById("autoFType_"+Cities.cities[c].id).value=typeunite;
    t.AF_TU_Change(cityId,ById("autoFType_"+cityId).value);
   }
   for (var c=0; c<Cities.numCities; c++) {
        cityId=Cities.cities[c].id;
        t.AF_TU_Change(cityId,ById("autoFType_"+cityId).value);
   }
   t.saveOptionsAutoF();
  },
  saveOptionsAutoF: function() {
     var t = Tabs.autoFormation;
     if (parseIntNan(ById('aFtimelauch').value) < 5)  ById('aFtimelauch').value = "5";
     TrainOptions.timelauch=ById('aFtimelauch').value;
     TrainOptions.UnitMixValue=ById('BOModeDiv').value;
     TrainOptions.list={};
     TrainOptions.listactif={};
     TrainOptions.listlabour={};
     TrainOptions.unitemin={};
     TrainOptions.unitemax={};
     TrainOptions.listboost={};
     for (var c=0; c<Cities.numCities; c++) {
        TrainOptions.list[Cities.cities[c].id] = ById('autoFType_'+Cities.cities[c].id).value;
        TrainOptions.listactif[Cities.cities[c].id] = ById('autoFCheck_'+Cities.cities[c].id).checked;
        TrainOptions.listlabour[Cities.cities[c].id] = ById('autoFWorkers_'+Cities.cities[c].id).checked;
        TrainOptions.unitemin[Cities.cities[c].id]=parseIntNan(ById('aFunitemin_'+Cities.cities[c].id).value);
        TrainOptions.unitemax[Cities.cities[c].id]=parseIntNan(ById('aFunitemax_'+Cities.cities[c].id).value);
        TrainOptions.listboost[Cities.cities[c].id]=ById('autoFboost_'+Cities.cities[c].id).value;
        TrainOptions.Workers[(c+1)] = ById('workers'+(c+1)).value;
        TrainOptions.Item[(c+1)] = ById('TrainSpeedItem_'+(c+1)).value;
     }
     saveTrainingOptions();
  },
  toggleautoFormationState : function(obj) {
     var t = Tabs.autoFormation;
     obj = ById('autoFormationtoggle');
     if (TrainOptions.Running == true) {
              TrainOptions.Running = false;
              clearTimeout(t.timer);
              if (obj) obj.value = lang.autoForm.buttonlabel+" = OFF";
              if (Options.BORac_Tra) updatebotbutton(lang.autoForm.buttonlabel+' - OFF', 'pbformtab');
              saveTrainingOptions();
      }  else {
              TrainOptions.Running = true;
              clearTimeout(t.timer);
              t.numcity=-1;
              t.timer=setTimeout(t.Start,5000);
              if (obj) obj.value = lang.autoForm.buttonlabel+" = ON";
              if (Options.BORac_Tra) updatebotbutton(lang.autoForm.buttonlabel+" - ON", 'pbformtab');
              saveTrainingOptions();
      }
   },
    CancelActionall: function(numville, num, fintraitement) {

        var t = Tabs.autoFormation;
        var first=1;
        var cityId = Cities.cities[numville].id;
        var q = Seed.queue_unt['city'+cityId];
        var now = unixTime();
        start = q[num][2];
        end = q[num][3];
        actual = end - now;
        if (actual < 0) actual = 0;
        var param2=cityId;
        var param3=q[num][0];
        var param4=q[num][1];
        var param5=end;t
        var param6=start;
        var param7=actual;
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
             params.cityId = param2;
             params.requestType ="CANCEL_TRAINING";
             params.numtrptrn = param4;
             params.trnETA= param5;
             params.trnNeeded = param7;
             params.trnTmp = param6;
             params.typetrn= param3;

          new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/cancelTraining.php" + unsafeWindow.g_ajaxsuffix, {
                  method: "post",
                  parameters: params,
                onSuccess: function (rslt) {
                 var t = Tabs.autoFormation;
                 if (rslt.ok) {
                    unsafeWindow.update_seed_ajax(true,function(){
        	       var k=0;for(var j=0;j<unsafeWindow.seed.queue_unt["city"+param2].length;j++){
        	        if(j>num){
        	         unsafeWindow.seed.queue_unt["city"+param2][j][2]=parseInt(rslt.dateTraining[k]["start"]);
        	         unsafeWindow.seed.queue_unt["city"+param2][j][3]=parseInt(rslt.dateTraining[k]["end"]);
        	         k++;
        	         }
        	        }
        	        unsafeWindow.seed.queue_unt["city"+param2].splice(num,1);
        	        for(var i=1;i<5;i++){
        	         var totalReturn=parseInt(unsafeWindow.unitcost["unt"+param3][i])*parseInt(param4)*3600/2;
        	         unsafeWindow.seed.resources["city"+param2]["rec"+i][0]=parseInt(unsafeWindow.seed.resources["city"+param2]["rec"+i][0])+totalReturn;
        	        }

            	});
                   t.crfil++;
     		ById('BO_AF_Progression').innerHTML = "<b><i>"+uW.g_js_strings.commonstr.loadingddd+" " + t.crfil+ " / " +t.nbfil +"</i></b>";
     	        var numnew = num - 1;
     	        if (numnew<fintraitement) {
   		  		 if (numville==Cities.numCities) {
   		  		  ById('BO_AF_Progression').innerHTML = "<font color=#880000><B>Termine...</b></font>";

   		  		  return;
   		  		 }
   		  		 numville++;
   		  		   		 var cityId = Cities.cities[numville].id;
   				 		 var q = Seed.queue_unt['city'+cityId];
   				   		 numnew=q.length-1;
   				   		if (q.length<=fintraitement) {
   				   		 ById('BO_AF_Progression').innerHTML = "<font color=#550000><B>Error...</b></font>";
   				   		 return;
   		  		}
   		  		 setTimeout(function (){
   				    t.CancelActionall(numville, numnew, fintraitement);
   		  		 }, (Math.random()*100)+100 );
   		  	        } else {
   		  	          setTimeout(function (){
   		  	            t.CancelActionall(numville, numnew, fintraitement);
   		  		  }, (Math.random()*100)+100 );
                    }

                 } else {
                  ById('BO_AF_Progression').innerHTML = "<font color=#550000><B>"+lang.autoForm.err1+"</b></font>";
                 }
                },
                onFailure: function (rslt) {
                 var t = Tabs.autoFormation;
                 ById('BO_AF_Progression').innerHTML = "<font color=#550000><B>"+lang.autoForm.err1+"</b></font>";
                }
         });

     },
     AF_CancelAll: function() {
      var t = Tabs.autoFormation;
      t.nbfil=0;
      t.crfil=0;
      var debutsup = 1;
      if ( ById('BO_AF_CancelFirst').checked) {
       var debutsup=0 ;
      }
       for(i=0; i<Cities.numCities; i++) {
        var cityId = Cities.cities[i].id;
        var q = Seed.queue_unt['city'+cityId];
        t.nbfil += q.length - debutsup;
       }
      for(i=0; i<Cities.numCities; i++) {
       var cityId = Cities.cities[i].id;
       var q = Seed.queue_unt['city'+cityId];
       if (q.length>debutsup) {
        obj = ById('autoFormationtoggle');
        TrainOptions.Running = false;
        if (obj) obj.value = lang.autoForm.buttonlabel+" = OFF";
        if (Options.BORac_Tra) updatebotbutton(lang.autoForm.buttonlabel+' - OFF', 'pbformtab');
        saveTrainingOptions();
        t.CancelActionall(i, q.length-1, debutsup);
        return false;
       }
      }
  },
}

Tabs.ScoutAlliance = {
  tabOrder : 16,
  tabLabel: lang.BoiteLabelScoutAlliance,
  myDiv : null,
  MapAjax : new CMapAjax(),
  ScoutAllianceOptions : {
     num_scouts     : 1,
     min_might      : 500000,
     max_might      : 30000000,
     scout_interval : 5,
     scouting       : false,
     scout_ready    : false,
     scoutage : {},
  },
  init : function (div){
    var t = Tabs.ScoutAlliance;
    var o = t.ScoutAllianceOptions;
    unsafeWindow.fetchAllianceMembers = t.eventGetMembers;
    t.myDiv = div;
    t.city = 0;
    t.citiesToScout = {};
    var s = GM_getValue('ScoutAllianceOptions_' + getServerId());
    if (s != null){
       t.ScoutAllianceOptions = JSON2.parse(s);
    }

    for(var i=0; i < Cities.numCities; i++) {
        t.citiesToScout[i] = [];
        var s = GM_getValue('CitiesToScout_city_' + i + '_' + getServerId());
        if (s != null){
            t.citiesToScout[i] = JSON2.parse(s);
        }
    }
    t.show();
    t.doNextScout();
  },
  setScoutAllianceOptions : function () {
     var t = Tabs.ScoutAlliance;
     GM_setValue ('ScoutAllianceOptions_' + getServerId(), JSON2.stringify(t.ScoutAllianceOptions));
  },
  show : function (){
    var t = Tabs.ScoutAlliance;
    var o = t.ScoutAllianceOptions;
    if (t.state == null){
      if (getMyAlliance()[0] == 0) {
        t.myDiv.innerHTML = '<BR><BR><CENTER>'+lang.ScoutAlliance.needalliance+'</center>';
        t.state = 1;
        return;
      }
      var m = '<DIV class=boStat>'+lang.ScoutAlliance.title+'</div><DIV class=pbentry><TABLE width=100% cellpadding=0>';
         if (o.scouting) {
           m += '<TD><INPUT id=IdScoutingStatus type=submit value="'+lang.ScoutAlliance.buttonlabel+' = ON"></td>';
         } else {
            if (o.scout_ready) {
               m += '<TD><INPUT id=IdScoutingStatus type=submit value="'+lang.ScoutAlliance.buttonlabel+' = OFF"></td>';
            } else {
               m += '<TD><INPUT id=IdScoutingStatus type=submit value="'+lang.ScoutAlliance.buttonlabel+' = '+lang.ScoutAlliance.noready+'"></td>';
            }
         }
         m += "<TR><TD colspan=1>"+lang.ScoutAlliance.notes+"</td></tr>";
         m += '<TR><TD>'+lang.ScoutAlliance.IdScoutInterval+': <INPUT id=IdScoutInterval type=text size=8 maxlength=8 value='+ o.scout_interval +' \> '+lang.General.secs+'</td>';
         m += '<TD>'+lang.ScoutAlliance.IdNumScouts+': <INPUT id=IdNumScouts disabled type=text size=8 maxlength=8 value='+ o.num_scouts +' \></td></tr>';
         m += '<TR><TD>'+uW.g_js_strings.commonstr.might+' Min : <INPUT id=IdMinMight type=text size=8 maxlength=8 value='+ o.min_might +' \></td>';
         m += '<TD>'+uW.g_js_strings.commonstr.might+' Max : <INPUT id=IdMaxMight type=text size=8 maxlength=8 value='+ o.max_might +' \></td></tr>';

         m += '<TR><TD class=xtab>'+lang.ScoutAlliance.IdSearchAllianceName+': &nbsp;</td>';
         m += '<TD class=xtab><INPUT id=IdSearchAllianceName type=text /> &nbsp;';
         m += '<INPUT id=IdSearchAllianceNameSubmit type=submit value="'+lang.ScoutAlliance.IdSearchAllianceNameSubmit+'" /></td></tr>';
         m += '<TR><TD class="xtab ptErrText"><SPAN id=IdScoutAllianceErrorSpan></span></td></tr>';
         m += '</table><span style="vertical-align:middle;" id=IdScoutAlliance></span></div>';
         m += '<div style="height:35px; max-height:35px;" id=IdScoutAllianceStatus></div></div>';
         m += '<div style="height:400px; max-height:400px; overflow-y:auto;"; id=IdScoutAllianceProgress></div></div>';
      t.myDiv.innerHTML = m;

      document.getElementById('IdScoutInterval').addEventListener('change', function(){
		o.scout_interval=parseInt(document.getElementById('IdScoutInterval').value);
		t.setScoutAllianceOptions();
	        },false);
      document.getElementById('IdNumScouts').addEventListener('change', function(){
		o.num_scouts=parseInt(document.getElementById('IdNumScouts').value);
		t.setScoutAllianceOptions();
	        },false);
      document.getElementById('IdMinMight').addEventListener('change', function(){
		o.min_might=parseInt(document.getElementById('IdMinMight').value);
		t.setScoutAllianceOptions();
	        },false);
      document.getElementById('IdMaxMight').addEventListener('change', function(){
		o.max_might=parseInt(document.getElementById('IdMaxMight').value);
		t.setScoutAllianceOptions();
	        },false);
      document.getElementById('IdSearchAllianceNameSubmit').addEventListener ('click', t.SearchAllianceSubmit, false);
      document.getElementById('IdScoutingStatus').addEventListener('click', function(){t.toggleScoutingStatus(this)} , false);
      t.state = 1;
    }
  },
  hide: function(){
  },
  SearchAllianceName : '',
  SearchAllianceSubmit : function (){
    var t = Tabs.ScoutAlliance;
    document.getElementById('IdScoutAllianceErrorSpan').innerHTML='';
    t.SearchAllianceName = document.getElementById('IdSearchAllianceName').value;
    if (t.SearchAllianceName.length < 3){
      document.getElementById('IdScoutAllianceErrorSpan').innerHTML = uW.g_js_strings.getAllianceSearchResults.entryatleast3;
      return;
    }
    document.getElementById('IdScoutAllianceStatus').innerHTML = "<DIV class=ptstat>"+uW.g_js_strings.commonstr.research+" <B>"+ t.SearchAllianceName +"</b>...";
    t.fetchAllianceList (t.SearchAllianceName, t.eventGotAllianceList);
  },
  eventGotAllianceList : function (rslt){
    var t = Tabs.ScoutAlliance;
    if (!rslt.ok){
      document.getElementById('IdScoutAllianceStatus').innerHTML = rslt.errorMsg;
      document.getElementById('IdScoutAllianceErrorSpan').innerHTML = rslt.errorMsg;
      return;
    }
    var m = '<DIV class=boStat>'+uW.g_js_strings.commonstr.research+' <B>"'+ t.SearchAllianceName +'"</b></div>\
    <TABLE><TR style="font-weight:bold"><TD class=xtab>'+lang.General.name+'</td><TD class=xtab>'+uW.g_js_strings.commonstr.rank+'</td><TD class=xtab>'+uW.g_js_strings.commonstr.members+'</td>\
        <TD align=right class=xtab>'+uW.g_js_strings.commonstr.might+'</td><TD class=xtab>'+lang.ScoutAlliance.diplo+'</td><TD class=xtab></td></tr>';
    for (k in rslt.alliancesMatched){
      var all = rslt.alliancesMatched[k];
      var dip = '';
      if (all.relation && all.relation==1)
        dip = uW.g_js_strings.commonstr.friendly;
      else if (all.relation && all.relation==2)
        dip = uW.g_js_strings.commonstr.hostile;
      m += '<TR><TD class=xtab>'+ all.allianceName +'</td><TD align=right class=xtab>'+ all.ranking +'</td><TD align=right class=xtab>'+ all.membersCount +'</td>\
       <TD align=right class=xtab>'+ addCommasInt(all.might) +'</td><TD class=xtab>'+ dip +'</td>\
       <TD class=xtab><a onclick="fetchAllianceMembers('+ all.allianceId +')">'+lang.ScoutAlliance.start+'</a></td></tr>';
    }
    document.getElementById('IdScoutAllianceStatus').innerHTML = m;
  },
  fetchAllianceList : function (allianceName, notify) {
    var t = Tabs.ScoutAlliance;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.allianceName = allianceName;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetSearchResults.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
          notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },
  eventGetMembers : function (aid){
    var t = Tabs.ScoutAlliance;
    t.ScoutAllianceOptions.scout_ready = false;
    t.setScoutAllianceOptions();
    document.getElementById('IdScoutingStatus').value = lang.ScoutAlliance.buttonlabel+' = '+lang.ScoutAlliance.noready;
    document.getElementById('IdScoutAllianceStatus').innerHTML = '<DIV class=ptstat>'+uW.g_js_strings.commonstr.loadingddd+'...';
    document.getElementById('IdScoutAllianceProgress').innerHTML = '';
    t.fetchAllianceMemberList (aid, t.eventGotMemberList);
  },
  fetchAllianceMemberList : function (allianceId, notify) {
    var t = Tabs.ScoutAlliance;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.perPage = 100;
    params.allianceId = allianceId;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserLeaderboard.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },
  eventGotMemberList : function (rslt){
    var t = Tabs.ScoutAlliance;
    var o = t.ScoutAllianceOptions;
    document.getElementById('IdScoutAllianceProgress').innerHTML="";
    if (!rslt.ok){
      document.getElementById('IdScoutAllianceStatus').innerHTML = rslt.errorMsg;
      document.getElementById('IdScoutAllianceErrorSpan').innerHTML = rslt.errorMsg;
      return;
    }
    var numInvalid = 0;
    var numPlayers = 0;
    var numCities = 0;
    var myA = getMyAlliance ();
    var dist = 0;
    for(var i=0; i < Cities.numCities; i++) {
        t.citiesToScout[i] = [];
    }
    for (var r=0; r<rslt.results.length; r++){
      p = rslt.results[r];
      if (p.userId == 0){
        ++numInvalid;
      } else {
        ++numPlayers;
        numCities += p.cities.length;
        might = parseInt(p.might);
        if (might > parseInt(o.min_might) && might < parseInt(o.max_might)) {
          for (var c=0; c<p.cities.length; c++){
             for(var i=0; i < Cities.numCities; i++) {
                dist = distance (Cities.cities[i].x, Cities.cities[i].y, p.cities[c].xCoord, p.cities[c].yCoord);
                t.citiesToScout[i].push ({x:p.cities[c].xCoord,y:p.cities[c].yCoord, dist:dist, nom:p.displayName});
            }
          }
        }
      }
    }
    dist = 100000;
    for(var i=0; i < Cities.numCities; i++) {
        t.citiesToScout[i].sort(function sortDist(a,b) {a = a['dist'];b = b['dist'];return a == b ? 0 : (a < b ? -1 : 1);});
        if (t.citiesToScout[0].length > 0 && t.citiesToScout[i][0].dist < dist) {
            t.city = i;
            dist = t.citiesToScout[i][0].dist;
        }
        GM_setValue('CitiesToScout_city_' + i + '_' + getServerId(), JSON2.stringify(t.citiesToScout[i]));
    }
    if (t.city == 0) t.city = Cities.numCities;
    else t.city -= 1;

    var m = '';
    m += '<DIV class=boStat>Recherche termin&eacute;e : '+ rslt.allianceName +' (trouv&eacute; ' + numPlayers + ' joueurs';
    if (numInvalid > 0) m += ' (' + numInvalid + 'sous brume ?)';
    m += ', ' +t.citiesToScout[0].length+ ' villes &agrave; &eacute;clairer';
    if (t.citiesToScout[0].length != numCities) m += ' (total ' + numCities + ')';
    m += ')</div><div>';
    document.getElementById('IdScoutAllianceStatus').innerHTML = m;
    if (t.citiesToScout[0].length > 0) {
      t.ScoutAllianceOptions.scout_ready = true;
      t.setScoutAllianceOptions();
      document.getElementById('IdScoutingStatus').value = lang.ScoutAlliance.buttonlabel+" = OFF";
    }
  },
  toggleScoutingStatus: function(obj){
     var t = Tabs.ScoutAlliance;
     var o = t.ScoutAllianceOptions;
     if (!o.scout_ready) return;
     if (o.scouting) {
         o.scouting = false;
         t.setScoutAllianceOptions();
         obj.value = lang.ScoutAlliance.buttonlabel+" = OFF";
         t.nextscout = null;
     } else {
         o.scouting = true;
         t.setScoutAllianceOptions();
         obj.value = lang.ScoutAlliance.buttonlabel+" = ON";
         t.doNextScout();
     }
  },
  doNextScout: function(){
     var t = Tabs.ScoutAlliance;
     var o = t.ScoutAllianceOptions;
     if (!o.scout_ready) return;
     if (!o.scouting) return;
     var slots = 0;
     var can_scout = false;
     that_city = t.city;
     var now = new Date().getTime()/1000.0;
     now = now.toFixed(0);
     do {
       t.city += 1;
       if (t.city>=Seed.cities.length){
	  t.city=0;
       }
       this_city = t.city;
       if (this_city == that_city) {
           t.nextscout = setTimeout(t.doNextScout,(parseInt(o.scout_interval)*1000));
           return;
       }
       city = Cities.cities[this_city];
       if (t.citiesToScout[this_city].length == 0) {
          o.scout_ready = false;
          o.scouting = false;
          t.setScoutAllianceOptions();
          document.getElementById('IdScoutingStatus').value = lang.ScoutAlliance.buttonlabel+' = '+lang.ScoutAlliance.noready;
          t.nextscout = null;
          return;
       }

       if(parseInt(Seed.units['city'+city.id]['unt'+3]) < parseInt(o.num_scouts)){
          continue;
       }

       var rallypointlevel = t.getRallypoint(city.id);
       if(rallypointlevel == 12) rallypointlevel = 11;
       slots = 0;
       if (Seed.queue_atkp['city'+city.id] != undefined){
	       for(var k in Seed.queue_atkp['city'+city.id])
		      slots++;
		      if(Seed.queue_atkp['city'+city.id].toSource() == "[]")
		          slots = 0;
	}
	  else slots=0;

       id=t.citiesToScout[this_city][0].x+","+t.citiesToScout[this_city][0].y;
       if (t.ScoutAllianceOptions.scoutage[id]) {
        last = t.ScoutAllianceOptions.scoutage[id];
        if ( now < (parseInt(last) + (24 * 60 * 60))){
         t.scout_delete(t.citiesToScout[this_city][0].x,t.citiesToScout[this_city][0].y);

         continue;
        }
       }
       if(slots >= rallypointlevel){
          continue;
       }
       can_scout = true;
    } while (!can_scout);

	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.cid = city.id;
	params.kid = 0;
	params.type = 3;
	params.xcoord = t.citiesToScout[this_city][0].x;
	params.ycoord = t.citiesToScout[this_city][0].y;
	params.u3 = parseInt(o.num_scouts);
	new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
		 method: "post",
		 parameters: params,
		 onSuccess: function (rslt) {
		 if (rslt.ok) {
			 var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
			 var ut = unixTime();
			 var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
			 var resources=[0,0,0,0,0,0,0,0,0,0,0,0,0];
			 for(i = 0; i <= unitsarr.length; i++){
				if(params["u"+i]){
				unitsarr[i] = params["u"+i];
				}
			 }
			 var currentcityid = params.cid;
			 unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
			 //if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
			 document.getElementById('IdScoutAllianceProgress').innerHTML += 'Eclaireur envoy&eacute; de '+city.name+' sur '+t.citiesToScout[this_city][0].nom+' '+params.xcoord+', '+params.ycoord+' - Distance : '+t.citiesToScout[this_city][0].dist+'<BR>';
                         t.scout_done(params.xcoord, params.ycoord);
                         t.nextscout = setTimeout(t.doNextScout,(o.scout_interval*1000));
		 } else {
                         rslt.errorMsg = unsafeWindow.printLocalError((rslt.error_code || null), (rslt.msg || null), (rslt.feedback || null));
			 document.getElementById('IdScoutAllianceProgress').innerHTML += 'Echec d\'envoi de '+city.name+' sur '+t.citiesToScout[this_city][0].nom+' '+params.xcoord+', '+params.ycoord+' ['+rslt.errorMsg+']<BR>';
                          if (rslt.error_code==208) t.scout_done(params.xcoord, params.ycoord);
                         t.nextscout = setTimeout(t.doNextScout,(o.scout_interval*1000));
		  }
		},
		onFailure: function () {}
  		});
  },
 getRallypoint: function(cityId){
      var t = Tabs.ScoutAlliance;
      cityId = 'city'+cityId;
      for (o in Seed.buildings[cityId]){
		var buildingType = parseInt(Seed.buildings[cityId][o][0]);
		var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
		if (buildingType == 12){
			return parseInt(buildingLevel);
			break;
		}
	   }
	  return 0;
    },
  scout_delete : function(x,y) {
    var t = Tabs.ScoutAlliance;
    var id = x + "," + y;

    for(var i=0; i < Cities.numCities; i++) {
     for (var c=0; c < (t.citiesToScout[i].length); c++) {
       if (parseInt(t.citiesToScout[i][c].x) == parseInt(x) && parseInt(t.citiesToScout[i][c].y) == parseInt(y)) {
             t.citiesToScout[i].splice(parseInt(c), 1);
       }
     }
    }
   document.getElementById('IdScoutAllianceProgress').innerHTML += 'Eclaireur '+t.citiesToScout[this_city][0].nom+' sur '+x+', '+y+' - <b>Restriction 24h !</b><BR>';

  },
  scout_done: function(x,y){
     var t = Tabs.ScoutAlliance;
     var cnt = 0;
     for(var i=0; i < Cities.numCities; i++) {
       for (var c=0; c < (t.citiesToScout[i].length); c++) {
         if (parseInt(t.citiesToScout[i][c].x) == parseInt(x) && parseInt(t.citiesToScout[i][c].y) == parseInt(y)) {
           var now = new Date().getTime()/1000.0;
	   now = now.toFixed(0);
	   var id = x + "," + y;
           t.ScoutAllianceOptions.scoutage[id] = now;
           t.setScoutAllianceOptions();
           t.citiesToScout[i].splice(parseInt(c), 1);
           GM_setValue('CitiesToScout_city_' + i + '_' + getServerId(), JSON2.stringify(t.citiesToScout[i]));
           cnt++;
           break;
         }
       }
    }
    if (cnt != Cities.numCities) {
    }
  },
}

/*************************************** FORMATION ***********************************************/
Tabs.Train = {
  tabOrder: 8,
  tabLabel: uW.g_js_strings.commonstr.train,
  cont : null,
  timer : null,
  state : null,
  stats : {},
  selectedCity : {},
  sourceCity : {},
  destinationCity : {},

  show : function (){
   var t = Tabs.Train;
    t.displayCityStats();
            t.changeTroopSelect();
         t.changeDefSelect();

   t.timer = setTimeout (t.show, 4000);
  },

  hide : function (){
    var t = Tabs.Train;
    clearTimeout (t.timer);
  },
  renvoyer : function(typeunit, cityId) {
   var t = Tabs.Train;
   var qte = parseInt(Seed.citystats["city"+cityId]["pop"][1]);
   var a=prompt("Renvoyer les unites - "+unsafeWindow.unitcost['unt'+typeunit][0]+" - Quantite ?", qte);
   if (parseInt(a)>0) {
     a = parseInt(a);
     nbcity = Seed.units["city"+cityId]["unt"+typeunit];
     if (a<=nbcity) {
     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
           params.cid = cityId;
           params.quant = a;
           params.type = typeunit;
               new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/dismissUnits.php" + unsafeWindow.g_ajaxsuffix, {
     	        method: "post",
     	        parameters: params,
	        onSuccess: function (rslt) {
                 if (rslt.ok){
     		  Seed.units["city"+cityId]["unt"+typeunit]=parseInt(Seed.units["city"+cityId]["unt"+typeunit])-parseInt(a);
                 }
       		},
			        onFailure: function (rslt) {
			          t.listeFavoris.innerHTML="<option>Erreur</option>";
			        },
    	});

    }
   }


  },
  init : function (div){
    var t = Tabs.Train;
    t.cont = div;
    uW.BOcancelTraining = t.cancelTrainingBO;
    uW.BOcancelFort = t.butcancelFort;
    uW.BoRenvoyer = t.renvoyer;

    if (t.state == null){

      s = "<DIV id=trainTopSelect >\
        <DIV class=boStat>"+lang.Train.title+"</div><DIV style='height:10px'></div><DIV class=ptentry>\
        <DIV style='text-align:center; margin-bottom:10px;'>"+uW.g_js_strings.commonstr.city+" : &nbsp; <span id=ptspeedcity></span></div>\
        <TABLE class=ptTab width=100%><TR valign=top><TD width=50%>\
        <TABLE align=center><TR><TD align=right>"+uW.g_js_strings.commonstr.troops+" : </td><TD colspan=2>\
        <SELECT id=ptttType>";
         for (r=1; r<13; r++){
         if (r==2) {
          s+= "<option selected value='"+r+"'>"+uW.unitcost['unt'+r][0]+"</option>";
         } else {
          s+= "<option value='"+r+"'>"+uW.unitcost['unt'+r][0]+"</option>";
         }
        }
        if (Seed.items.i36){tutel1=Seed.items.i36}else{tutel1=0};
        if (Seed.items.i37){tutel2=Seed.items.i37}else{tutel2=0};
        if (Seed.items.i38){tutel3=Seed.items.i38}else{tutel3=0};
        if (Seed.items.i26){siege1=Seed.items.i26}else{siege1=0};
       s+= " </select> <br> (max <span id=ptttSpMax></span>)</td></tr>\
        <TR><TD align=right>par slot de </td><TD><INPUT id='ptttInpPS' size=5 type='text' value='0'\></td>\
          <TD><INPUT id='ptttButMaxPS' type=submit value='max'\> &nbsp; (max <span id=ptttSpMaxPS>0</span>)</td></tr>\
        <TR><TD align=right>sur</td><TD><INPUT id='ptttInpSlots' size=2 type='text' value='1'\> slots</td>\
          <TD width=75%><INPUT id='ptttButMaxSlots' type=submit value='max'\> &nbsp; (max <span id=ptttSpMaxSlots>1</span>)</td></tr>\
        <TR><TD align=right valign=top>"+uW.g_js_strings.showPopTooltip.lbrforce+" : </td><TD colspan=2><INPUT type=CHECKBOX id=chkPop"+ (Options.maxIdlePop?' CHECKED ':'') +">\
        - Boost: <SELECT id=BOGamble>\
        <option value='0'>-</option>\
        <option value='1'>5% - 15%</option>\
        <option value='2'>10% - 25%</option>\
        </select>\
        <br><SELECT id=tutelage>\
		<option value='0'><CENTER>--- "+uW.g_js_strings.commonstr.speedup+" ---</center></option>\
		<option value='36'>"+ uW.itemlist.i36.name+" ("+tutel1+")</option>\
        <option value='37'>"+ uW.itemlist.i37.name+" ("+tutel2+")</option>\
        <option value='38'>"+ uW.itemlist.i38.name+" ("+tutel3+")</option>\
		</select>\</td></tr>\
        <TR><TD colspan=3 align=center><DIV style='height:10px'></div><INPUT id='ptttButDo' type=submit value='"+uW.g_js_strings.modal_openBarracks.trainttl+"'\>\
        <br><span id='BOmodal_barracks_traintime'>"+uW.g_js_strings.modal_barracks_trainingtab.esttime+" :</span></td></tr>\
        </table></td><TD width=20></td><TD style='border-left:solid 2px;' width=50% align=center>\
        <TABLE align=center><TR><TD align=right>"+uW.g_js_strings.commonstr.defense+": </td><TD colspan=2>\
      <SELECT id=pttdType>\
        <option value='53'>"+uW.fortcost.frt53[0]+"</option>\
        <option value='55'>"+uW.fortcost.frt55[0]+"</option>\
        <option value='60'>"+uW.fortcost.frt60[0]+"</option>\
        <option value='61'>"+uW.fortcost.frt61[0]+"</option>\
        <option value='62'>"+uW.fortcost.frt62[0]+"</option>\
      </select> <br> (<span id=pttdSpMax></span>)</td></tr>\
        <TR><TD align=right>"+lang.Train.pttdInpPS+"</td><TD><INPUT id='pttdInpPS' size=5 type='text' value='0'\></td>\
          <TD><INPUT id='pttdButMaxPS' type=submit value='max'\> (max <span id=pttdSpMaxPS>0</span>)</td></tr>\
        <TR><TD align=right># </td><TD><INPUT id='pttdInpSlots' size=2 type='text' value='1'\> slots</td>\
          <TD width=75%><INPUT id='pttdButMaxSlots' type=submit value='max'\> (max <span id=pttdSpMaxSlots>1</span>)</td></tr>\
        <TR align=center><TD colspan=3><SPAN id=pttdSpace></span></td></tr>\
         <TR><TD colspan=3 align=center><DIV style='height:10px'>\
      <SELECT id=siege>\
      <option value='0'><CENTER>--- "+uW.g_js_strings.commonstr.speedup+" ---</center></option>\
      <option value='26'>"+ uW.itemlist.i26.name+" ("+siege1+")</option>\
      </select></div>\
      <BR><INPUT id='pttdButDo' type=submit value='"+uW.g_js_strings.modal_openWalls.builddefenses+"'\>\
      <br><span id='BOmodal_barracks_deftime'>"+uW.g_js_strings.modal_barracks_trainingtab.esttime+" :</span> </td></tr></table>\
        </td></tr></table></div></div>\
        <TABLE align=center width=425 class=ptTab><TR><TD><div id=ptTrainStatus style='overflow-y:auto; max-height:70px; height: 70px;'></div></td></tr></table>\
        <div style='height: "+(Options.HauteurBoite-240)+"pxpx; max-height:"+(Options.HauteurBoite-240)+"pxpx; overflow-y:auto'>\
        <br><TABLE width=100% class=ptTab><TR><TD colspan=3><DIV id=divSTtop></div></td></tr>\
        <TR><TD width=50% style='padding-left:5px; padding-right:5px'><DIV style='text-align:center'><div class=boStat><img id=BOCancelAllTrain valign=absmiddle border=0 title='Annuler toutes les formations' src='http://cdn1.iconfinder.com/data/icons/musthave/16/Remove.png'>&nbsp;&nbsp;<B>"+lang.Train.troops+" (<SPAN id=statTTtot></span>)</b></span></div></div><DIV id=divSTleft style='padding:5px; box-shadow:inset 0px 0px 5px #000; overflow-y: auto; height:"+(Options.HauteurBoite-590)+"px; max-height:"+(Options.HauteurBoite-590)+"px'></div></td>\
          <TD width=50% style='padding-left:5px; padding-right:5px'><DIV style='text-align:center'><div  class=boStat><B>"+lang.Train.def+" (<SPAN id=statDTtot></span>)</b></div></div><DIV id=divSTright style='padding:5px;box-shadow:inset 0px 0px 5px #000; overflow-y: auto; height:"+(Options.HauteurBoite-590)+"px; max-height:"+(Options.HauteurBoite-590)+"px'></div></td></tr>\
        </div></div>";
      t.cont.innerHTML = s;

      var dcp = new CdispCityPicker ('ptspeed', ById('ptspeedcity'), true, t.clickCitySelect, 0);
      t.TTspMax = document.getElementById ('ptttSpMax');
      t.BOGamble = document.getElementById ('BOGamble');
      t.TTspMaxPS = document.getElementById ('ptttSpMaxPS');
      t.TTspMaxSlots = document.getElementById ('ptttSpMaxSlots');
      t.TTbutMaxSlots = document.getElementById ('ptttButMaxSlots');
      t.TTbutMaxPerSlot = document.getElementById ('ptttButMaxPS');
      t.TTinpPerSlot = document.getElementById ('ptttInpPS');
      t.TTinpSlots = document.getElementById ('ptttInpSlots');
      t.TTselType = document.getElementById ('ptttType');
      t.TTbutDo = document.getElementById ('ptttButDo');
      t.TDspMax = document.getElementById ('pttdSpMax');
      t.TDspMaxPS = document.getElementById ('pttdSpMaxPS');
      t.TDspMaxSlots = document.getElementById ('pttdSpMaxSlots');
      t.TDbutMaxSlots = document.getElementById ('pttdButMaxSlots');
      t.TDbutMaxPerSlot = document.getElementById ('pttdButMaxPS');
      t.TDinpPerSlot = document.getElementById ('pttdInpPS');
      t.TDinpSlots = document.getElementById ('pttdInpSlots');
      t.TDselType = document.getElementById ('pttdType');
      t.TDbutDo = document.getElementById ('pttdButDo');
      t.TDspSpace = document.getElementById ('pttdSpace');
      t.divTrainStatus = document.getElementById ('ptTrainStatus');

      t.TTinpSlots.addEventListener ('change', t.updateTopTroops, false);
      t.BOGamble.addEventListener ('change', t.changeTroopSelect, false);
      t.TTbutMaxPerSlot.addEventListener ('click', t.clickTroopMaxPS, false);
      t.TTbutMaxSlots.addEventListener ('click', t.clickTroopMaxSlots, false);
      t.TTselType.addEventListener ('change', t.changeTroopSelect, false);
      t.TTbutDo.addEventListener ('click', t.clickTroopDo, false);
      t.TDinpSlots.addEventListener ('change', t.updateTopDef, false);
      t.TDselType.addEventListener ('change', t.changeDefSelect, false);
      t.TDbutMaxPerSlot.addEventListener ('click', t.clickDefMaxPS, false);
      t.TDbutMaxSlots.addEventListener ('click', t.clickDefMaxSlots, false);
      t.TDbutDo.addEventListener ('click', t.clickDefDo, false);

      document.getElementById ('BOCancelAllTrain').addEventListener ('click', t.CancelAllTraining, false);

      document.getElementById ('chkPop').addEventListener ('change', t.clickCheckIdlePop, false);

      t.state = 1;
    }


  },


/*******  TROOPS  ******/

  updateTopTroops : function (){
    var t = Tabs.Train;
    var slots = parseInt(t.TTinpSlots.value, 10);
    if (isNaN(slots) || slots<0)
      slots = 0;
    t.TTspMax.innerHTML = t.stats.MaxTrain;
    t.TTspMaxSlots.innerHTML = t.stats.barracks - t.stats.queued;
    if (slots<1 || (t.stats.barracks-t.stats.queued < 1))
      t.TTspMaxPS.innerHTML = 0;
    else
      t.TTspMaxPS.innerHTML = parseInt(t.stats.MaxTrain / slots);
  },


  clickTroopMaxPS : function (){
    var t = Tabs.Train;
    var slots = parseInt(t.TTinpSlots.value, 10);
    if (slots<1 || (t.stats.barracks-t.stats.queued < 1))
      t.TTinpPerSlot.value = 0;
    else
      t.TTinpPerSlot.value = parseInt(t.stats.MaxTrain / slots);
  },

  clickTroopMaxSlots : function (){
    var t = Tabs.Train;
    t.TTinpSlots.value = t.stats.barracks - t.stats.queued;
  },

  clickCitySelect : function (city){
    var t = Tabs.Train;
    t.selectedCity = city;
    t.lastQueString = null;
    t.lastDQueString = null;
    t.displayCityStats ();
    t.changeTroopSelect();
    t.changeDefSelect();
  },

  clickCheckIdlePop : function (){
    var t = Tabs.Train;
    if (document.getElementById ('chkPop').checked)
      Options.maxIdlePop = true;
    else
      Options.maxIdlePop = false;
    saveOptions ();
    t.displayCityStats ();
    t.changeTroopSelect ();
  },
  limitingFactor : null,
  changeTroopSelect : function (){
    var t = Tabs.Train;
    var cityId = t.selectedCity.id;
    var id = t.TTselType.value;
    t.lastTroopSelect = id;
    t.limitingFactor = null;
    var uc = unsafeWindow.unitcost['unt'+id];
    var a=1
    var gumble= t.BOGamble.value;
    if (gumble==0) a=1;
    if (gumble==1) a=2;
    if (gumble==2) a=4;
    var max = 9999999999;
    if ( (t.stats.food / (uc[1]*a)) < max){
      max = t.stats.food / (uc[1]*a);
      t.limitingFactor = 'food';
    }
    if ( (t.stats.wood / (uc[2]*a)) < max){
      max = t.stats.wood / (uc[2]*a);
      t.limitingFactor = 'wood';
    }
    if ( (t.stats.stone / (uc[3]*a)) < max){
      max = t.stats.stone / (uc[3]*a);
      t.limitingFactor = 'stone';
    }
    if ( (t.stats.ore / (uc[4]*a)) < max){
      max = t.stats.ore / (uc[4]*a);
      t.limitingFactor = 'ore';
    }
    if ( (t.stats.idlePop / uc[6]) < max){
      max = t.stats.idlePop / (uc[6]);
      t.limitingFactor = 'pop';
    }
    t.stats.MaxTrain = parseInt (max);
    if (t.stats.MaxTrain < 0)
      t.stats.MaxTrain = 0;
    if (matTypeof(uc[8]) == 'object'){
      for (k in uc[8]){
        var b = getCityBuilding (cityId, k.substr(1));
        if (b.maxLevel < uc[8][k][1]){
          t.stats.MaxTrain = 0;
          t.limitingFactor = null;
          break;
        }
      }
    }
    if (matTypeof(uc[9]) == 'object'){
      for (k in uc[9]){
        if (parseInt(Seed.tech['tch'+k.substr(1)]) < uc[9][k][1]){
          t.stats.MaxTrain = 0;
          t.limitingFactor = null;
          break;
        }
      }
    }
    t.updateTopTroops();
  },

  clickTroopDo : function (){
    var t = Tabs.Train;
    var cityId = t.selectedCity.id;
    //unsafeWindow.citysel_click(ById('citysel_'+ (t.selectedCity.idx+1)+''));
    var unitId = t.TTselType.value;
    var perSlot = parseInt(t.TTinpPerSlot.value, 10);
    var numSlots = parseInt(t.TTinpSlots.value, 10);
    t.displayCityStats ();
    if (perSlot<1){
      t.divTrainStatus.innerHTML = '<FONT COLOR=#550000>'+lang.Train.err1+'</font>';
      return;
    }
    if (perSlot*numSlots > t.stats.MaxTrain){
      t.divTrainStatus.innerHTML = '<FONT COLOR=#550000>'+lang.Train.err3+' '+ t.stats.MaxTrain +')</font>';
      return;
    }
    if (numSlots<1 || numSlots>t.stats.barracks - t.stats.queued){
      t.divTrainStatus.innerHTML = '<FONT COLOR=#550000>'+lang.Train.err2+'</font>';
      return;
    }

    var tut = document.getElementById ('tutelage').value;
    var gam = t.BOGamble.value;
    t.setBusy(true);
    var que = [];
    for (var i=0; i<numSlots; i++)
      que.push (['T', unitId, parseInt (perSlot)]);
    t.divTrainStatus.innerHTML = '';
    t.doQueue (cityId, tut, gam, que);
  },


/*******  DEF  ******/

  updateTopDef : function (){
    var t = Tabs.Train;
    var slots = parseInt(t.TDinpSlots.value, 10);
    if (isNaN(slots) || slots<0)
      slots = 0;
    t.TDspMax.innerHTML = 'max:'+ t.stats.MaxDefTrain +'&nbsp; actuel:'+ t.stats.defOwned;
    t.TDspMaxSlots.innerHTML = t.stats.wallLevel-t.stats.Dqueued;
    if (slots<1)
      t.TDspMaxPS.innerHTML = 0;
    else
      t.TDspMaxPS.innerHTML = parseInt(t.stats.MaxDefTrain / slots);

    t.TDspSpace.innerHTML = '<table border=1 cellspacing=0 width=100% bordercolor=black><tr><td>Niveau</td><td>D&eacute;fense des Remparts</td><td>D&eacute;fense des Champs</td></tr>\
       <tr><td><B>'+ t.stats.wallLevel +'</b></td><td>'+ (t.stats.wallSpaceUsed+t.stats.wallSpaceQueued)  +'/<B>'+ t.stats.wallSpace +'</b></td>\
        <td>'+ (t.stats.fieldSpaceUsed+t.stats.fieldSpaceQueued) +'/<B>'+ t.stats.fieldSpace +'</b></td></table>';
  },

  changeDefSelect : function (){
    var t = Tabs.Train;
    var cityId = t.selectedCity.id;
    var id = t.TDselType.value;
    t.lastDefSelect = id;
    t.stats.defOwned = parseInt(Seed.fortifications['city' + cityId]['fort'+id]);
    var uc = unsafeWindow.fortcost['frt'+id];
    var max = 9999999999;
    if ( (t.stats.food / uc[1]) < max)
      max = t.stats.food / uc[1];
    if ( (t.stats.wood / uc[2]) < max)
      max = t.stats.wood / uc[2];
    if ( (t.stats.stone / uc[3]) < max)
      max = t.stats.stone / uc[3];
    if ( (t.stats.ore / uc[4]) < max)
      max = t.stats.ore / uc[4];
    if ( (t.stats.idlePop / uc[6]) < max)
      max = t.stats.idlePop / uc[6];
    t.stats.MaxDefTrain = parseInt (max);
    if (t.stats.MaxDefTrain < 0)
      t.stats.MaxDefTrain = 0;
    if (matTypeof(uc[8]) == 'object'){
      for (k in uc[8]){
        var b = getCityBuilding (cityId, k.substr(1));
        if (b.maxLevel < uc[8][k][1]){
          t.stats.MaxDefTrain = 0;
          break;
        }
      }
    }
    if (matTypeof(uc[9]) == 'object'){
      for (k in uc[9]){
        if (parseInt(Seed.tech['tch'+k.substr(1)]) < uc[9][k][1]){
          t.stats.MaxDefTrain = 0;
          break;
        }
      }
    }

    var spaceEach = parseInt(unsafeWindow.fortstats["unt"+ id][5]);
    if (id<60)
      var spaceAvail = t.stats.wallSpace - t.stats.wallSpaceUsed - t.stats.wallSpaceQueued;
    else
      var spaceAvail = t.stats.fieldSpace - t.stats.fieldSpaceUsed - t.stats.fieldSpaceQueued;
    if ( t.stats.MaxDefTrain * spaceEach > spaceAvail)
      t.stats.MaxDefTrain = parseInt(spaceAvail / spaceEach);

    t.updateTopDef();
  },

  clickDefMaxPS : function (){
    var t = Tabs.Train;
    var slots = parseInt(t.TDinpSlots.value, 10);
    if (slots<1)
      t.TDinpPerSlot.value = 0;
    else
      t.TDinpPerSlot.value = parseInt(t.stats.MaxDefTrain / slots);
  },

  clickDefMaxSlots : function (){
    var t = Tabs.Train;
    t.TDinpSlots.value = t.stats.wallLevel-t.stats.Dqueued;
  },

  clickDefDo : function (){
    var t = Tabs.Train;
    var cityId = t.selectedCity.id;
    var unitId = t.TDselType.value;
    var perSlot = parseInt(t.TDinpPerSlot.value, 10);
    var numSlots = parseInt(t.TDinpSlots.value, 10);

    t.displayCityStats ();
    if (perSlot<1){
      t.divTrainStatus.innerHTML = '<FONT COLOR=#550000>'+lang.Train.err1+'.</font>';
      return;
    }
    if (perSlot*numSlots > t.stats.MaxDefTrain){
      t.divTrainStatus.innerHTML = '<FONT COLOR=#550000>'+lang.Train.err3+' '+ t.stats.MaxDefTrain +')</font>';
      return;
    }
    if (numSlots<1 || numSlots > t.stats.wallLevel-t.stats.Dqueued){
      t.divTrainStatus.innerHTML = '<FONT COLOR=#550000>'+lang.Train.err2+'</font>';
      return;
    }
    var siege = document.getElementById ('siege').value;
    t.setBusy(true);
    var que = [];
    for (var i=0; i<numSlots; i++)
      que.push (['T', unitId, parseInt (perSlot)]);
    t.divTrainStatus.innerHTML = '';
    t.doDefQueue (cityId, siege, que);
  },

  doDefQueue : function (cityId, siege, que, errMsg){
    var t = Tabs.Train;
    try {
      t.displayCityStats();
      if (errMsg){
        t.dispTrainStatus ('<font color=#550000><B>ERREUR : '+ errMsg +'</b></font><BR>');
        t.setBusy(false);
        return;
      }
      var cmd = que.shift();
      if (!cmd){
        t.dispTrainStatus ('<B>'+lang.Train.err4+'</b><BR>');
        t.setBusy(false);
        return;
      }
      if (cmd[0] == 'T'){
        t.dispTrainStatus ('Construction '+ cmd[2] +' '+  fortNamesShort[cmd[1]] +'<BR>');
          doDefTrain ( cityId, siege, cmd[1], cmd[2],
          function(errMsg){
            setTimeout(function (){Tabs.Train.doDefQueue(cityId, siege, que, errMsg);}, (Math.random()*3500)+500);
          } );
      }
    } catch (err) {
      t.dispTrainStatus ('<font color=#550000>PROGRAMME ERREUR : '+ err.message +'</font><BR>');
      t.setBusy(false);
    }
  },
  setBusy : function (tf){
    var t = Tabs.Train;
    t.TDbutDo.disabled = tf;
    t.TTbutDo.disabled = tf;
  },
  fixQueTimes : function (q){
    var now = unixTime();
    if (q[0][2] > now)
      q[0][2] = now;
    for (var i=0; i<q.length; i++){
      if (q[i+1]!=null && q[i+1][2]!=q[i][3])
        q[i][3] = q[i+1][2];
    }
  },
  displayCityStats : function (){
    var t = Tabs.Train;
    var cityId = t.selectedCity.id;
    t.stats.food = parseInt (Seed.resources['city'+cityId].rec1[0]/3600);
    t.stats.wood = parseInt (Seed.resources['city'+cityId].rec2[0]/3600);
    t.stats.stone = parseInt (Seed.resources['city'+cityId].rec3[0]/3600);
    t.stats.ore = parseInt (Seed.resources['city'+cityId].rec4[0]/3600);
    t.stats.gold = Seed.citystats['city'+cityId].gold[0];
    if (Options.maxIdlePop)
       t.stats.idlePop = parseInt(Seed.citystats['city'+cityId].pop[0]);
     else
       t.stats.idlePop = parseInt(Seed.citystats['city'+cityId].pop[0]) - parseInt(Seed.citystats['city'+cityId].pop[3]);
    t.stats.barracks = getCityBuilding (cityId, 13).count;
    cost = unsafeWindow.unitcost['unt'+t.TTselType.value];
    nbunit=t.TTinpPerSlot.value*t.TTinpSlots.value;
    var a=1;
    var gumble= t.BOGamble.value;
    if (gumble==0) a=1;
	    if (gumble==1) a=2;
	    if (gumble==2) a=4;
         consoFood = cost[1] * a * nbunit;
        styleFood="";stylePop="";styleWood="";styleOre="";styleStone="";
        if (consoFood>t.stats.food) styleFood='style="color:#E30;font-weight:bold;"';
        consoOre = cost[4] * a * nbunit;
        if (consoOre>t.stats.ore) styleOre='style="color:#E30;font-weight:bold;"';
        consoStone = cost[3] * a * nbunit;
        if (consoStone>t.stats.stone) styleStone='style="color:#E30;font-weight:bold;"';
        consoWood = cost[2] * a * nbunit;
        if (consoWood>t.stats.wood) styleWood='style="color:#E30;font-weight:bold;"';
        consoPop = cost[6] * nbunit;
    if (consoPop>t.stats.idlePop) stylePop='style="color:#E30;font-weight:bold;"';

    var m = '<TABLE class=ptTab width=100%><TR align=center>\
        <TD width=8%><B>Ravi:</b></td><TD width=8%><B>Mili:</b></td><TD width=8%><B>Ecla:</b></td>\
        <TD width=8%><B>Piqu:</b></td><TD width=8%><B>Pala:</b></td><TD width=8%><B>Arch:</b></td>\
        <TD width=8%><B>Cav:</b></td><TD width=8%><B>CavL:</b></td><TD width=8%><B>Wago:</b></td>\
        <TD width=8%><B>Bali:</b></td><TD width=8%><B>Beli:</b></td><TD width=8%><B>Cata:</b></td><tr>';

 m += '<TR align=center>';
 for (var r=1;r<13;r++) {

  m += '<TD width=8%><span title="'+unsafeWindow.g_js_strings.commonstr.dismiss+'" onclick="BoRenvoyer('+r+','+cityId+');">'+Seed.units['city'+cityId]['unt'+r]+'</span></td>';
 }
 m+='<tr></table>';

 m += '<TABLE class=ptTab width=100%><TR align=center>\
        <td width=15%>&nbsp;</td><TD width=14%><B>'+unsafeWindow.g_js_strings.commonstr.gold+'</b></td><TD width=15%><B>'+unsafeWindow.g_js_strings.commonstr.food+'</b></td><TD width=14%><B>'+unsafeWindow.g_js_strings.commonstr.wood+'</b></td><TD width=14%><B>'+unsafeWindow.g_js_strings.commonstr.stone+'</b></td><TD width=14%><B>'+unsafeWindow.g_js_strings.commonstr.ore+'</b></td><TD width=14%><B>'+unsafeWindow.g_js_strings.showPopTooltip.idlepop+'</b></td></tr>\
      <TR align=center><td><b>'+uW.g_js_strings.commonstr.inventory+'</b></td><TD><SPAN id=ptttr_gold>'+ addCommasInt(t.stats.gold) +'</span></td><TD><SPAN id=ptttr_food>'+ addCommasInt(t.stats.food) +'</span></td>\
      <TD><SPAN id=ptttr_wood>'+ addCommasInt(t.stats.wood) +'</span></td><TD><SPAN id=ptttr_stone>'+ addCommasInt(t.stats.stone) +'</span></td><TD><SPAN id=ptttr_ore>'+ addCommasInt(t.stats.ore) +'</span></td>\
         <TD><SPAN id=ptttr_gold>'+ addCommasInt(t.stats.idlePop) +'</span></td></tr>\
        <tr align=center><td width=15%><b>'+unsafeWindow.g_js_strings.commonstr.required+'</b></td><td>&nbsp;</td><td '+styleFood+'>'+addCommasInt(consoFood)+'</td><td '+styleWood+'>'+addCommasInt(consoWood)+'</td><td '+styleStone+'>'+addCommasInt(consoStone)+'</td><td '+styleOre+'>'+addCommasInt(consoOre)+'</td>\
        <TD '+stylePop+'>'+ addCommasInt(consoPop)+'</td></tr>\
       </table>';
       document.getElementById ('divSTtop').innerHTML = m;
       var e=parseInt((t.TDinpPerSlot.value*t.TDinpSlots.value),10);
       if (e>0) {
          d=t.TDselType.value;
          var a=unsafeWindow.modal_walls_traintime(d,e)

          var reduction=0
          var tut = ById('siege').value;
          if (tut==26) reduction=parseInt(a*0.3);

          var reducStr=timestr(reduction,1);
          ById('BOmodal_barracks_deftime').innerHTML=uW.g_js_strings.modal_barracks_trainingtab.esttime+" : <b>" + timestr(a,1) +"</b>";
          if (reduction>0) {
           var totalred = a - reduction;
           ById('BOmodal_barracks_deftime').innerHTML=uW.g_js_strings.modal_barracks_trainingtab.esttime+" : <b>" + timestr(totalred,1) +"</b>";
           ById('BOmodal_barracks_deftime').title=uW.g_js_strings.modal_barracks_trainingtab.esttime+" : " + timestr(a,1) +" - Boost : " + reducStr + "";
          }
         }
    var e=parseInt(nbunit,10);
    var b=t.TTselType.value;
    var m=0;

    if(e>0){
     var m=parseInt(parseInt(unsafeWindow.unitcost["unt"+b][7]))*e;
     var c=0;
     var d=0;
     var h=0;
     var j=Object.keys(Seed.buildings["city"+cityId]);
     for(var f=0;f<j.length;f++){
      var k=Seed.buildings["city"+cityId][j[f]];
      if((parseInt(k[0])==13)&&(parseInt(k[1])>0)){
       c+=(parseInt(k[1])+9)
      }
      if((parseInt(k[0])==16)&&(parseInt(k[1])>d)){
       if(parseInt(b)>=9){
        d=parseInt(k[1])
       }
      }
      if((parseInt(k[0])==17)&&(parseInt(k[1])>h)){
       if(parseInt(b)>=7){
        h=parseInt(k[1])
       }
      }
     }
     var a=c/10;
     var l=0;
     var g=0;
     var n=Seed.knights["city"+cityId];
     m=Math.max(1,Math.ceil(m/a));
     a=1;
     l=d+h;
     if(n){
      n=n["knt"+Seed.leaders["city"+cityId].combatKnightId];
      if(n){
       g=parseInt(n.combat);
       newkntlv=((parseInt(n.combatBoostExpireUnixtime)-unixTime())>0)?(g*1.25):g;
       a=a+(0.005*newkntlv)
      }
     }


     if(Seed.tech){
      l=l+Seed.tech.tch5;
     }
     a=a+(0.1*l);

     var h=EffetTronePrc(77).percent;
     a=a*(1+(h/100));
     if(uW.cm.WorldSettings.isOn("GUARDIAN_MARCH_EFFECT")){
     var SPD={0:0,1:1,2:1,3:2,4:2,5:3,6:3,7:4,8:5,9:7,10:10,11:20};
          var b=0,y=false,v=false,w=0;
          var mm=Seed.guardian;
          for (var ii in mm) {
           var ww = mm[ii];
           if (ww.cityId==cityId) {
            if (ww.type== "stone") y=true;
            if (ww.guardianCount==4) v=true;
            var level=0;
            if (ww.cityGuardianLevels.stone!=undefined) level = ww.cityGuardianLevels.stone;
            w = SPD[level] / 100;
            var bx = 0;
                if (y && v) {
                    bx = 1.5;
                }
                if (y && !v) {
                    bx = 1;
                }
                if (!y && v) {
                    bx = 0.5;
                }
                if (!y && !v) {
                    bx = 0;
                }
                b = w * bx;

                a=a*(1+b);
           }

         }
     }

      m=Math.max(1,Math.ceil(m/a));

     var reduction=0
     var tut = document.getElementById ('tutelage').value;
     if (tut==36)
       reduction=parseInt(m*0.3,10);
     if (tut==37)
      reduction=parseInt(m*0.5,10);
     if (tut==38)
      reduction=parseInt(m*0.7,10);

     var reducStr=timestr(reduction,1);

     var aa=1;
     var now = unixTime();
     var estimfin = new Date();
     estimfin.setTime((now+m) * 1000);
     ById('BOmodal_barracks_traintime').innerHTML=uW.g_js_strings.modal_barracks_trainingtab.esttime+" : <b>" + timestr(m,1) +"</b><br>"+lang.Train.estimfin+": "+estimfin.toLocaleString()+"";
     var gumble= t.BOGamble.value;
     if (gumble==0) aa=1;
     if (gumble==1) aa=2;
     if (gumble==2) aa=4;
     if (aa>1 && reduction==0) {
      if (aa==2) {
       var r1=parseInt(m*0.05,10);
       var r2=parseInt(m*0.15,10);
       var n1 = m - r1;
       var n2 = m - r2;
      }
      if (aa==4) {
       var r1=parseInt(m*0.10,10);
       var r2=parseInt(m*0.25,10);
       var n1 = m - r1;
       var n2 = m - r2;
      }
      var now = unixTime();
      var estimfin1 = new Date();
      estimfin1.setTime((now+n2) * 1000);
      var estimfin2 = new Date();
      estimfin2.setTime((now+n1) * 1000);
      ById('BOmodal_barracks_traintime').innerHTML=uW.g_js_strings.modal_barracks_trainingtab.esttime+" <b><font color=red>" + timestr(n2,1) +"</font> et <font color=red>" + timestr(n1,1) +"</font></b><br>"+lang.Train.estimfin+" "+estimfin1.toLocaleString()+"<br>et "+estimfin2.toLocaleString()+"";
     }
     if (reduction>0 && aa==1) {
       var totalred = m - reduction;
       var now = unixTime();
       var estimfin = new Date();
       estimfin.setTime((now+totalred) * 1000);
       ById('BOmodal_barracks_traintime').innerHTML=uW.g_js_strings.modal_barracks_trainingtab.esttime+" : <b><font color=red>" + timestr(totalred,1) +"</font></b><br>"+lang.Train.estimfin+": "+estimfin.toLocaleString()+"";
       ById('BOmodal_barracks_traintime').title=uW.g_js_strings.modal_barracks_trainingtab.esttime+" : " + timestr(m,1) +" - Boost : " + reducStr + "";
     }
     if (reduction>0 && aa>1) {
            var totalred = m - reduction;
             if (aa==2) {
	           var r1=parseInt(totalred*0.05,10);
	           var r2=parseInt(totalred*0.15,10);
	           var n1 = totalred - r1;
	           var n2 = totalred - r2;
	          }
	          if (aa==4) {
	           var r1=parseInt(totalred*0.10,10);
	           var r2=parseInt(totalred*0.25,10);
	           var n1 = totalred - r1;
	           var n2 = totalred - r2;
	          }

	          var now = unixTime();
		        var estimfin1 = new Date();
		        estimfin1.setTime((now+n2) * 1000);
		        var estimfin2 = new Date();
      estimfin2.setTime((now+n1) * 1000);
 ById('BOmodal_barracks_traintime').innerHTML=uW.g_js_strings.modal_barracks_trainingtab.esttime+" <b><font color=red>" + timestr(n2,1) +"</font> et <font color=red>" + timestr(n1,1) +"</font></b><br>"+lang.Train.estimfin+" "+estimfin1.toLocaleString()+"<br>et "+estimfin2.toLocaleString()+"";
     }
    }
    var totTime = 0;
    var q = Seed.queue_unt['city'+cityId];
    var c = Cities.byID[cityId].idx;
    t.stats.queued = q.length;
    var qs = q.toString();
    var now = unixTime();
    if (q!=null && q.length>0)
      totTime = q[q.length-1][3] - now;
    if ( qs == t.lastQueString){
      if (q!=null && q.length>0){
        var cur = q[0][3] - now;
        if (cur < 1)
          q.shift();
        if (document.getElementById ('ptttfq')) document.getElementById ('ptttfq').innerHTML = timestr(cur, true);
      }
    } else {
      t.lastQueString = qs;
      t.stats.queued = 0;
      m = '<TABLE align=center class=ptTab>';
      if (q!=null && q.length>0 ){
        t.fixQueTimes (q);
        t.stats.queued = q.length;
        first = true;
        for (var i=0; i<q.length; i++){
          start = q[i][2];
          end = q[i][3];
          if (first)
            actual = end - now;
          else
            actual = end - lastEnd;
          if (actual < 0)
            actual = 0;
            param1=i; //
            param2=cityId; // id de la ville
            param3=q[i][0]; // Type de trouoe
            param4=q[i][1]; // Qte troupe
            param5=end; // debut
            param6=start; // fin
            param7=actual; // duree
          m += '<TR align=right><td width=35 align=center>'+(i+1)+'&nbsp;<a onclick="BOcancelTraining('+param1+','+param2+','+param3+','+param4+','+param5+','+param6+','+param7+');return false;" href="javascript:void(0);"><img src="http://cdn1.iconfinder.com/data/icons/musthave/16/Remove.png" border=0 title="Annuler la formation"></a></td><TD>'+ q[i][1] +' </td><TD align=left> '+ unsafeWindow.unitcost['unt'+q[i][0]][0].replace('de Ravitaillement','');
          if (first)
            m += '</td><TD>&nbsp;<img src="http://cdn1.iconfinder.com/data/icons/ledicons/wait.png" onclick=citysel_click(document.getElementById(\'citysel_'+ (c+1)+'\'));modal_speedup("trn",'+param3+','+param3+',"Training",'+param6+');return false;> &nbsp; '+  timestr(end-start, true) +'</td><TD> (<SPAN id=ptttfq>'+ timestr(actual, true) +'</span>)';
          else
            m += '</td><TD> &nbsp; '+  timestr(actual, true) +'</td></tr>';
          lastEnd = end;
          first = false;
         }
      }
      m += '</table>';
      document.getElementById ('divSTleft').innerHTML = m;
    }
    m = t.stats.barracks +' casernes';
    if (t.stats.queued > 0)
      m += ', '+ t.stats.queued +' slots';
    if (totTime > 0)
      m += ', '+ unsafeWindow.timestr(totTime);
    document.getElementById ('statTTtot').innerHTML = m;
    getWallInfo (cityId, t.stats);
    var totTime = 0;
    var q = Seed.queue_fort['city'+cityId];
    var qs = q.toString();
    if (q!=null && q.length>0)
      totTime = q[q.length-1][3] - now;
    if ( qs == t.lastDQueString){
      if (q!=null && q.length>0){
        var cur = q[0][3] - now;
        if (cur < 1)
          q.shift();
        document.getElementById ('pttdfq').innerHTML = timestr(cur, true);
      }
    } else {
      t.lastDQueString = qs;
      t.stats.Dqueued = 0;
      t.stats.wallSpaceQueued = 0;
      t.stats.fieldSpaceQueued = 0;
      m = '<TABLE align=center class=ptTab>';
      if (q!=null && q.length > 0 ){
        t.fixQueTimes (q);
        t.stats.Dqueued = q.length;
        first = true;
        for (i=0; i<q.length; i++){
          if (q[i][0] < 60)
            t.stats.wallSpaceQueued += parseInt(unsafeWindow.fortstats["unt"+ q[i][0]][5]) * parseInt(q[i][1]);
          else
            t.stats.fieldSpaceQueued += parseInt(unsafeWindow.fortstats["unt"+ q[i][0]][5]) * parseInt(q[i][1]);
          start = q[i][2];
          end = q[i][3];
          if (first)
            actual = end - now;
          else
            actual = end - lastEnd;
          if (actual < 0)
            actual = 0;
          q[i][7]=cityId;
          m += '<TR align=right><TD><a onclick="BOcancelFort('+ q[i][0]+','+q[i][1]+','+q[i][2]+','+q[i][3]+','+q[i][5]+','+q[i][6]+','+q[i][7] +','+ i +');return false;" href="javascript:void(0);"><img src="http://cdn1.iconfinder.com/data/icons/musthave/16/Remove.png" border=0 title="Annuler la fortification"></a></td><TD>'+ q[i][1] +'</td><TD align=left> '+ fortNamesShort[q[i][0]];
          if (first)
            m += '</td><TD> &nbsp; '+  timestr(end-start, true) +'</td><TD> (<SPAN id=pttdfq>'+ timestr(actual, true) +'</span>)';
          else
            m += '</td><TD> &nbsp; '+  timestr(actual, true) +'</td></tr>';
          lastEnd = end;
          first = false;
        }
      }
      m += '</table>';
      document.getElementById ('divSTright').innerHTML = m;
    }
    m = t.stats.Dqueued +' slots';
    if (totTime > 0)
      m += ', '+ unsafeWindow.timestr(totTime);
    document.getElementById ('statDTtot').innerHTML = m;
  },
  dispTrainStatus : function (msg){
    var t = Tabs.Train;
    if (t.divTrainStatus)
      t.divTrainStatus.innerHTML = msg + t.divTrainStatus.innerHTML;
  },
  CancelActionall: function(cityId, num, fintraitement) {
   var t = Tabs.Train;
   var q = Seed.queue_unt['city'+cityId];
   var now = unixTime();
   start = q[num][2];
   end = q[num][3];
   actual = end - now;
   if (actual < 0)
          actual = 0;
   var param2=cityId; // id de la ville
   var param3=q[num][0]; // Type de trouoe
   var param4=q[num][1]; // Qte troupe
   var param5=end; // debut
   var param6=start; // fin
   var param7=actual; // duree
   var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
   params.cityId = param2;
   params.requestType ="CANCEL_TRAINING";
   params.numtrptrn = param4;
   params.trnETA= param5;
   params.trnNeeded = param7;
   params.trnTmp = param6;
   params.typetrn= param3;
   new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/cancelTraining.php" + unsafeWindow.g_ajaxsuffix, {
             method: "post",
             parameters: params,
           onSuccess: function (rslt) {
            var t = Tabs.Train;
            if (rslt.ok) {
                 if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
   	       var k=0;for(var j=0;j<unsafeWindow.seed.queue_unt["city"+param2].length;j++){
   	        if(j>num){
   	         unsafeWindow.seed.queue_unt["city"+param2][j][2]=parseInt(rslt.dateTraining[k]["start"]);
   	         unsafeWindow.seed.queue_unt["city"+param2][j][3]=parseInt(rslt.dateTraining[k]["end"]);
   	         k++;
   	         }
   	        }
   	        unsafeWindow.seed.queue_unt["city"+param2].splice(num,1);
   	        for(var i=1;i<5;i++){
   	         var totalReturn=parseInt(unsafeWindow.unitcost["unt"+param3][i])*parseInt(param4)*3600/2;
   	         unsafeWindow.seed.resources["city"+param2]["rec"+i][0]=parseInt(unsafeWindow.seed.resources["city"+param2]["rec"+i][0])+totalReturn;
   	        }



	        var numnew = num - 1;
	        if (numnew<fintraitement) {
	         t.dispTrainStatus ('<font color=#550000><B>'+lang.Train.err5+'</b></font><BR>');
                 document.getElementById ('BOCancelAllTrain').style.display='block';
	         t.displayCityStats();
	        } else {
	          if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
	          setTimeout(function (){

	            t.CancelActionall(cityId, numnew, fintraitement);
		  }, (Math.random()*200)+700);
                }

            } else {
             t.dispTrainStatus ("<font color=#550000><B>"+lang.Train.err6+"</b></font><BR>");
             t.displayCityStats();
             if (ById ('BOCancelAllTrain'))document.getElementById ('BOCancelAllTrain').style.display='block';
            }
           },
           onFailure: function (rslt) {
            var t = Tabs.Train;
            t.dispTrainStatus ("<font color=#550000><B>"+lang.Train.err6+"</b></font><BR>");
            t.displayCityStats();
            if (ById ('BOCancelAllTrain')) document.getElementById ('BOCancelAllTrain').style.display='block';
           }
    });
    setTimeout(unsafeWindow.update_seed_ajax, 250);

  },
  CancelAllTraining : function() {
   var t = Tabs.Train;
   var cityId = t.selectedCity.id;
   var q = Seed.queue_unt['city'+cityId];
   if (q.length>0) {
    var b=prompt(lang.Train.cancel1+" "+(q.length)+")", 2);
    if (parseInt(b)<=q.length && parseInt(b)>0) {
     t.dispTrainStatus ('<font color=#550000><B>'+lang.Train.cancel2+'</b></font><BR>');
     if (ById ('BOCancelAllTrain')) document.getElementById ('BOCancelAllTrain').style.display='none';
     obj = ById('autoFormationtoggle');
     TrainOptions.Running = false;
     if (obj) obj.value = lang.autoForm.buttonlabel+" = OFF";
     if (Options.BORac_Tra) updatebotbutton(lang.autoForm.buttonlabel+' - OFF', 'pbformtab');
     saveTrainingOptions();
     t.CancelActionall(cityId, q.length-1, b-1);

    }
   }
  },
  cancelTrainingBO : function (p1,p2,p3,p4,p5,p6,p7) {
   var t = Tabs.Train;
   var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
     params.cityId = p2;
     params.requestType ="CANCEL_TRAINING";
     params.numtrptrn = p4;
     params.trnETA= p5;
     params.trnNeeded = p7;
     params.trnTmp = p6;
     params.typetrn= p3

  new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/cancelTraining.php" + unsafeWindow.g_ajaxsuffix, {
          method: "post",
          parameters: params,
        onSuccess: function (rslt) {
         var t = Tabs.Train;
         if (rslt.ok) {
              if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};

	       var k=0;for(var j=0;j<unsafeWindow.seed.queue_unt["city"+p2].length;j++){
	        if(j>p1){
	         unsafeWindow.seed.queue_unt["city"+p2][j][2]=parseInt(rslt.dateTraining[k]["start"]);
	         unsafeWindow.seed.queue_unt["city"+p2][j][3]=parseInt(rslt.dateTraining[k]["end"]);
	         k++;
	         }
	        }
	        unsafeWindow.seed.queue_unt["city"+p2].splice(p1,1);
	        for(var i=1;i<5;i++){
	         var totalReturn=parseInt(unsafeWindow.unitcost["unt"+p3][i])*parseInt(p4)*3600/2;
	         unsafeWindow.seed.resources["city"+p2]["rec"+i][0]=parseInt(unsafeWindow.seed.resources["city"+p2]["rec"+i][0])+totalReturn;
	        }

          t.dispTrainStatus ('<font color=#550000><B>'+lang.Train.err5+'</b></font><BR>');
          t.displayCityStats();
         } else {
          t.dispTrainStatus ("<font color=#550000><B>"+lang.Train.err7+"</b></font><BR>");
          t.displayCityStats();
         }
        },
        onFailure: function (rslt) {
         var t = Tabs.Train;
         t.dispTrainStatus ("<font color=#550000><B>"+lang.Train.err7+"</b></font><BR>");
         t.displayCityStats();
        }
    });

    setTimeout(unsafeWindow.update_seed_ajax, 250);
  },
 butcancelFort : function (typefrt, numtrpfrt, frtTmp, frtETA, frtNeeded, frtid, cityId, queueId){
   var t = Tabs.Train;
   var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
   params.pf =0;
   params.requestType = "CANCEL_FORTIFICATIONS";
   params.cityId = cityId;
   params.typefrt = typefrt;
   params.numtrpfrt =  numtrpfrt;
   params.frtETA = frtETA;
   params.frtTmp = frtTmp;
   params.frtNeeded = frtNeeded;
   params.frtid = frtid;
   new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/cancelFortifications.php" + unsafeWindow.g_ajaxsuffix, {
       method: "post",
       parameters: params,
       onSuccess: function (message) {
       var rslt=eval("("+message.responseText+")");
       var t = Tabs.Train;
       if (rslt.ok) {
 			var k=0;
 			for(var j=0;j<Seed.queue_fort["city"+cityId].length;j++){
 				if(j>queueId){
 					Seed.queue_fort["city"+cityId][j][2]=parseInt(rslt.dateFortifications[k]["start"]);
 					Seed.queue_fort["city"+cityId][j][3]=parseInt(rslt.dateFortifications[k]["end"]);
 					k++;
 				}
 			}
			unsafeWindow.update_seed(rslt.updateSeed);
 			Seed.queue_fort["city"+cityId].splice(queueId,1);
 			for(var i=1;i<5;i++){
 				var totalReturn=parseInt(unsafeWindow.fortcost["frt"+typefrt][i])*parseInt(numtrpfrt)*3600/2;
 				Seed.resources["city"+cityId]["rec"+i][0]=parseInt(Seed.resources["city"+cityId]["rec"+i][0])+totalReturn;
 			}
 		  t.dispTrainStatus ('<font color=#550000><B>'+lang.Train.err5+'</b></font><BR>');
         	  t.displayCityStats();
 		} else {

		  t.dispTrainStatus ("<font color=#550000><B>"+lang.Train.err7+"</b></font><BR>");
                  t.displayCityStats();
 		}

       },
       onFailure: function () {
       var t = Tabs.Train;
       		  t.dispTrainStatus ("<font color=#550000><B>"+lang.Train.err7+"</b></font><BR>");
                  t.displayCityStats();
       },
   });
 },
  doQueue : function (cityId, tut, gam, que, errMsg){
    var t = Tabs.Train;
    try {
      t.displayCityStats();
      if (errMsg){
        t.dispTrainStatus ('<font color=#550000><B>ERREUR : '+ errMsg +'</b></font><BR>');
        t.setBusy(false);
        return;
      }
      var cmd = que.shift();
      if (!cmd){
        t.dispTrainStatus ('<B>'+lang.Train.err8+'</b><BR>');
        t.setBusy(false);
        return;
      }
      if (cmd[0] == 'T'){
        t.dispTrainStatus ('Formation '+ cmd[2] +' '+  unsafeWindow.unitcost['unt'+cmd[1]][0] +' dans '+ Cities.byID[cityId].name +' ('+ que.length +' slot(s) restant(s))<BR>');
        doTrain (cityId, tut, gam, cmd[1], cmd[2],
          function(errMsg){
	           setTimeout(function (){Tabs.Train.doQueue(cityId, tut, gam, que, errMsg);}, (Math.random()*1000)+1000 );
          }
        );
      }
    } catch (err) {
      t.dispTrainStatus ('<font color=#550000>PROGRAME ERREUR : '+ err.message +'</font><BR>');
      t.setBusy(false);
    }
  },
}


/*************** WILDS TAB *********************/
var wildNames={0:"Marais",10:"Prairie",11:"Lac",20:"Bois",30:"Collines",40:"Montagne",50:"Plaine"};
var mercNames={0:"Aucun",1:"Novices",2:"Intermediaire",3:"Veterans"}
Tabs.Wilds = {
  tabOrder : 9,
  tabLabel: lang.BoiteLabelWild,
  cont : null,
  state : null,
  upGoldTimer : null,
  wildList : [],
  buildList : {},

  show : function (){
   var t = Tabs.Wilds;
   t.init();
  },

  hide : function (){
    var t = Tabs.Wilds;
    clearTimeout (t.upGoldTimer);
  },
  abandon : function (cid,tid,x,y){
      var t = Tabs.Wilds;
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      		var cityID = cid;
      		var tileid = tid;
      		params.tid=tid;
      		params.cid=cid;
      		params.x=x;
        		params.y=y;
        		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/abandonWilderness.php" + unsafeWindow.g_ajaxsuffix, {
      			method: "post",
        		    parameters: params,
        		    loading: true,
        		    onSuccess:function(transport){
      				var rslt=eval("("+transport.responseText+")");
      				if (rslt.ok) {
      					t.error_code = 0;
      					if (rslt.returningMarches) {
      						var cities = Object.keys(rslt.returningMarches);
      						for (var i = 0; i < cities.length; i++) {
      							for (var j = 0; j < rslt.returningMarches[cities[i]].length; j++) {
      				                var cid = cities[i].split("c")[1];
      				                var mid = rslt.returningMarches[cities[i]][j];
      				                var march = Seed.queue_atkp["city" + cid]["m" + mid];
      								if (march) {
      									var marchtime = Math.abs(parseInt(march.destinationUnixTime) - parseInt(march.marchUnixTime));
      				                    var ut = unsafeWindow.unixtime();
      				                    Seed.queue_atkp["city" + cid]["m" + mid].destinationUnixTime = ut;
      				                    Seed.queue_atkp["city" + cid]["m" + mid].marchUnixTime = ut - marchtime;
      				                    Seed.queue_atkp["city" + cid]["m" + mid].returnUnixTime = ut + marchtime;
      				                    Seed.queue_atkp["city" + cid]["m" + mid].marchStatus = 8
      				                }
      				            }
      				        }
      				        t.init();
      				    }
      					if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
      				    if (Object.keys(Seed.wilderness["city" + cityID]).length == 1) {
      						Seed.wilderness["city" + cityID] = []
        		         	} else	{
      						delete Seed.wilderness["city"+cityID]["t"+tileid];
        		         	}
      				} else {
      				 t.init();
      					if (rslt.error_code != 401) {
      						t.error_code = rslt.error_code;

                     		}
        		        }
        		    },
        		    onFailure: function () {}
  		});

  },
  init : function (div){
    var t = Tabs.Wilds;

    uW.ptButMaxTraps = t.e_butMaxTraps;
    uW.ptInpWildTraps = t.e_inpTraps;
    uW.ptButWildSet = t.e_butWildSet;
    uW.ptButWildShow = t.init;
    uW.boAbandon = t.abandon;
    clearTimeout (t.upGoldTimer);
    if (t.state == null){
      t.cont = div;
      t.cont.innerHTML = '<DIV id=wildContent style="maxheight:'+(Options.HauteurBoite-25)+'px; height:'+(Options.HauteurBoite-25)+'px; overflow-y:auto">';
      t.state = 1;
    }

    m = '<TABLE cellspacing=0 cellpadding=0 class=ptTabPad align=center width=99%>';
    for (var c=0; c<Cities.numCities; c++){
      var city = Cities.cities[c];
      t.wildList[c] = [];

      var totWilds = 0;
      var datw = Seed.wilderness['city'+ city.id];
      if (datw!=null && matTypeof(datw)=='object')
       for (k in datw)
        ++totWilds;
      var nivcastle = parseInt(Seed.buildings['city'+ city.id].pos0[1]);
              var castle = nivcastle;
              if (nivcastle==11) castle=12;
        if (nivcastle==12) castle=14;
      if (totWilds < castle)  {
        var totWildsstring = '<SPAN style="font-color:red"><B>'+ totWilds +'/'+ castle +'</b></span>';
      }else{
          var totWildsstring = totWilds +'/'+ castle;
      }


      m += '<TR><TD colspan=21><DIV class=boStat>'+ city.name +' &nbsp; ('+ city.x +','+ city.y +') - '+totWildsstring+'</div></td></tr>';
      var row = 0;
      var sortem = [];

      var cWilds = Seed.wilderness['city'+city.id];
      if (matTypeof(cWilds) != 'array') {
        m += '<TR style="font-weight:bold;" align=right><TD align=left>'+uW.g_js_strings.commonstr.wilderness+'</td><TD></td><TD align=left>Coord</td><td>Dist</td><TD>'+uW.g_js_strings.commonstr.traps+'</td><TD align=left>Merc</td>\
         <TD width=15></td><TD colspan=3 class=entry>'+ htmlTitleLine(' '+uW.g_js_strings.modaltitles.wildernessdefense.toUpperCase()+' ') +'</td></tr>';
        for (var k in Seed.wilderness['city'+city.id])
          sortem.push (Seed.wilderness['city'+city.id][k]);
        sortem.sort (function (a,b){
          var x; if ((x = b.tileLevel-a.tileLevel)!=0)
            return x;
          return a.tileType-b.tileType;
        });
        for (i=0; i<sortem.length; i++){
          var wild = sortem[i];
          var wildDef = Seed.wildDef['t'+wild.tileId];
          if (wildDef==undefined || !wildDef)
            wildDef = {fort60Count:0, mercLevel:0};
          var maxTraps = parseInt(wild.tileLevel)*100;
          var maxBuild = maxTraps - parseInt(wildDef.fort60Count);
           var distancedelaville = distance (city.x, city.y, wild.xCoord, wild.yCoord);
          t.wildList[c][i] = [wild.tileId, maxBuild];
          m += '<TR align=right><TD align=left><a onclick="boAbandon('+city.id+','+wild.tileId+','+ wild.xCoord +','+ wild.yCoord +');"><img src="http://cdn1.iconfinder.com/data/icons/musthave/16/Remove.png" border=0 title="'+uW.g_js_strings.commonstr.abandon+'"></a>&nbsp;'+ wildNames[wild.tileType] +'</td>\
            <TD>'+ wild.tileLevel +'</td><TD align=center>\
             <a href="javascript:void(0)" onclick="cm.utils.CoordinateLinkController.onClick(event)" class="coordinateLink">('+ wild.xCoord +','+ wild.yCoord +')</a></td><td><b>'+distancedelaville+'</td>\
            <TD align=right><B>'+ wildDef.fort60Count +'</b></td><TD align=center><B>'+ mercNames[wildDef.mercLevel] +'</b></td>\
            <TD></td><TD align=left class=ptentry><B>Ajout Pi&egrave;ges :</b> <INPUT onchange="ptInpWildTraps(this)" id=ptwt_'+ c +'_'+ i
              + (maxBuild==0?' DISABLED ':'')+' style="margin:0px; padding:0px" type=text size=3 maxlength=4></td>'
          if (wildDef.fort60Count < maxTraps)
            m += '<TD class=ptentry style="padding:0px">'+ strButton14('Max', 'id=ptwx_'+ c +'_'+ i +' onclick="ptButMaxTraps(this)"') +'</td>';
          else
            m += '<TD class=ptentry></td>';
          m += '<TD class=ptentry> &nbsp; &nbsp; <B>Mercs:</b> ' + htmlSelector(mercNames, wildDef.mercLevel, 'id=ptwm_'+ c +'_'+ i) +' &nbsp; &nbsp; </td></tr>';
        }
        m += '<TR><TD colspan=7></td><TD class=ptentry align=center colspan=3><TABLE><TR><TD width=40% align=left>Co&ucirc;t Or : <SPAN id=ptwgc_'+ c +'>0</span></td>\
            <TD width=10%>'+ strButton20(uW.g_js_strings.commonstr.upgrade.toUpperCase(), 'onclick="ptButWildSet('+ c +')"') +'<TD width=40% align=right><SPAN id=ptwgt_'+ c +'></span></td></td></tr></table></td></tr>';
      } else {
        m+= '<TR><TD colspan=10> &nbsp; </td></tr>';
      }
    }
    ById('wildContent').innerHTML = m + '</table></div>';
    t.updateGold ();
  },

  e_butWildSet : function (c){
    var t = Tabs.Wilds;
    var totTraps = 0;
    var cid = Cities.cities[c].id;
    t.buildList = {cityId:cid, list:[]};

    for (var w=0; w<t.wildList[c].length; w++){
      var wild = Seed.wilderness['city'+cid]['t'+t.wildList[c][w][0]];
      var wildDef = Seed.wildDef['t'+t.wildList[c][w][0]];
      if (wildDef==undefined || !wildDef)
        wildDef = {fort60Count:0, mercLevel:0};

      var numTraps = parseInt(ById('ptwt_'+ c +'_'+ w).value, 10);
      if (isNaN(numTraps))
        numTraps = 0;
      totTraps += numTraps;
      if (numTraps > 0)
        t.buildList.list.push (['T', wild.tileId, numTraps]);
      var mercId=ById('ptwm_'+ c +'_'+ w).value;
      if (wildDef.mercLevel != mercId)
        t.buildList.list.push (['M', wild.tileId, mercId, wildDef.mercLevel]);
    }

    var totCost = totTraps * 200;
    if (totCost > parseInt(Seed.citystats['city'+cid].gold[0])){
      ById('ptwgc_'+ c).innerHTML = '<SPAN class=boldRed>'+ addCommasInt(totCost) +'</span>';
      return;
    }
    if (t.buildList.list.length == 0)
      return;
    t.setCurtain (true);
    var popDiv = t.setPopup (true);
    popDiv.innerHTML = '<TABLE class=ptTab width=100% height=100%><TR><TD>\
          <DIV class=boStat>Configuration des d&eacute;fenses des terres sauvages (TS)</div>\
          <DIV id=ptWildBuildDiv class=ptDiv style="padding:10px; height:225px; max-height:225px; overflow-y:auto"></div>\
          </td></tr><TR><TD align=center>'+ strButton20(uW.g_js_strings.commonstr.cancel.toUpperCase(), 'id=ptWildCancel') +'</td></tr></table>';
    ById('ptWildCancel').addEventListener('click', t.e_buildCancel, false);
    t.processQue(null);
  },

  e_buildCancel : function (){
    var t = Tabs.Wilds;
    t.setCurtain(false);
    t.setPopup(false);
    t.init();
  },

  processQue : function (errMsg){
    var t = Tabs.Wilds;
    var what = t.buildList.list.shift();
    var div = ById('ptWildBuildDiv');
    if (what==null || errMsg){
      if (errMsg)
        div.innerHTML += '<BR><SPAN style="white-space:normal;" class=boldRed>ERREUR : '+ errMsg +'</span>';
      else
        div.innerHTML += lang.wild.done+'<BR>';
      ById('ptWildCancel').firstChild.innerHTML = lang.wild.close;
      return;
    }
    if (div.innerHTML != '')
      div.innerHTML += lang.wild.done+'<BR>';
    var wild = Seed.wilderness['city'+ t.buildList.cityId]['t'+what[1]];
    if (what[0] == 'T'){
      div.innerHTML += lang.wild.build+''+ what[2] +' pi&egrave;ges sur '+ Cities.byID[t.buildList.cityId].name +'\' sur Terres au '+ wild.xCoord +','+ wild.yCoord +' ... ';
      t.postBuyTraps (t.buildList.cityId, what[1], what[2], t.processQue);
    } else {
      div.innerHTML += lang.wild.merc+' -'+ mercNames[what[2]] +'- sur '+ Cities.byID[t.buildList.cityId].name +'\' sur Terres au '+ wild.xCoord +','+ wild.yCoord +' ... ';
      t.postHireMercs (t.buildList.cityId, what[1], what[2], what[3], t.processQue);
    }
  },

  setPopup : function (onoff){
    var t = Tabs.Wilds;
    if (onoff){
      var div = document.createElement('div');
      div.id = 'ptWildPop';
      div.style.backgroundColor = '#fff';
      div.style.zindex = mainPop.getLayer()+2;
      div.style.opacity = '1';
      div.style.border = '3px outset red';
      div.style.width = '550px';
      div.style.height = '300px';
      div.style.display = 'block';
      div.style.position = 'absolute';
      div.style.top = '100px';
      div.style.left = '100px';
      t.cont.appendChild (div);
      return div;
    } else {
      t.cont.removeChild (ById('ptWildPop'));
    }
  },

  setCurtain : function (onoff){
    var t = Tabs.Wilds;
    if (onoff){
      var off = getAbsoluteOffsets (t.cont);
      var curtain = document.createElement('div');
      curtain.id = 'ptWildCurtain';
      curtain.style.zindex = mainPop.getLayer()+1;
      curtain.style.backgroundColor = "#000000";
      curtain.style.opacity = '0.5';
      curtain.style.width = t.cont.clientWidth +'px';
      curtain.style.height = t.cont.clientHeight +'px';
      curtain.style.display = 'block';
      curtain.style.position = 'absolute';
      curtain.style.top = off.top + 'px';
      curtain.style.left = off.left + 'px';
      t.cont.appendChild (curtain);
    } else {
      t.cont.removeChild (ById('ptWildCurtain'));
    }
  },

  e_butMaxTraps : function (e){
    var t = Tabs.Wilds;
    var c = e.id.substr(5,1);
    var w = e.id.substr(7);
    var inp = ById('ptwt_'+ c +'_'+ w);
    inp.value = t.wildList[c][w][1];
    t.e_inpTraps (inp);
  },

  e_inpTraps : function (e){
    var t = Tabs.Wilds;
    var c = e.id.substr(5,1);
    var w = e.id.substr (7);
    var tot = 0;
    for (var i=0; i<t.wildList[c].length; i++) {
      var val = parseInt(ById('ptwt_'+ c +'_'+ i).value, 10);
      if (isNaN(val))
        val = 0;
      tot += val;
    }
    ById('ptwgc_'+ c).innerHTML = addCommasInt(tot * 200);
    if (isNaN(e.value) || e.value<0 || e.value>t.wildList[c][w][1]){
      e.value = '';
      e.style.backgroundColor = '#ffaaaa';
    } else
      e.style.backgroundColor = null;
  },

  updateGold : function (){
    var t = Tabs.Wilds;
    for (var c=0; c<Cities.numCities; c++){
      var e = ById('ptwgt_'+ c +'');
      if (e)
        e.innerHTML = addCommasInt(Seed.citystats['city'+Cities.cities[c].id].gold[0]);
    }
  },

  postBuyTraps : function (cid, tid, quant, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = cid;
    params.tid = tid;
    params.quant = quant;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/buyWildTraps.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok){
         if (!Seed.wildDef["t"+ tid])
          Seed.wildDef["t"+ tid] = {tileId:tid, fort60Count:0, mercLevel:0};
          Seed.wildDef["t"+ tid].fort60Count = parseInt(Seed.wildDef["t"+ tid].fort60Count) + parseInt(quant);
         }
         if (notify)
          notify (rslt.errorMsg);
      },
      onFailure: function () {
        if (notify)
          notify ('AJAX ERROR');
      },
    });
  },

  postHireMercs : function (cid, tid, newLevel, oldLevel, notify){

    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = cid;
    params.tid = tid;
    params.lv = newLevel;
    params.olv = oldLevel;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/hireWildMerc.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok){
          if (!Seed.wildDef["t"+ tid])
            Seed.wildDef["t"+ tid] = {tileId:tid, fort60Count:0, mercLevel:0};
          Seed.wildDef["t"+ tid].mercLevel = newLevel;
        }
        if (notify)
          notify (rslt.errorMsg);
      },
      onFailure: function () {
        if (notify)
          notify ('AJAX ERROR');
      },
    });
  },
}

/*********** AUTO CONSTRUCTION *********/
Tabs.build = {
    tabOrder: 11,
    tabLabel: uW.g_js_strings.commonstr.build,
    myDiv: null,
    timer: null,
    buildTab: null,
    koc_buildslot: null,
    currentBuildMode: null,
    buildStates: [],
	loaded_bQ: [],
	lbQ: [],

    init: function(div){
        var t = Tabs.build;
        t.myDiv = div;
        t.koc_buildslot = unsafeWindow.buildslot;
        t.currentBuildMode = "build";
		t.buildStates = {
            running: false,
			help: false,
        };
        t.readBuildStates();

	if (Options.BORac_Bui) AddSubTabLink(lang.build.buttonlabel, t.toggleStateRunning, 'pbbuildtab');

        for (var i = 0; i < Cities.cities.length; i++) {
            t["bQ_" + Cities.cities[i].id] = JSON2.parse(GM_getValue('bQ_' + getServerId() + '_' + Cities.cities[i].id, '[]'));
			if (typeof t["bQ_" + Cities.cities[i].id] == 'undefined' || (t["bQ_" + Cities.cities[i].id]) == "") {
				t["bQ_" + Cities.cities[i].id] = [];
			}

        }

        var m = '<DIV id=pbBuildDivF class=boStat'+lang.build.title+'</div><TABLE id=pbbuildfunctions width=100% height=0% class=pbTab><TR>';
        if (t.buildStates.running == false) {
            m += '<TD><INPUT id=pbBuildRunning type=submit value="'+lang.build.biglabel+' = OFF"></td>';
	       if (Options.BORac_Bui) updatebotbutton(lang.build.buttonlabel+' - OFF', 'pbbuildtab');
        }
        else {
            m += '<TD><INPUT id=pbBuildRunning type=submit value="'+lang.build.biglabel+' = ON"></td>';
	       if (Options.BORac_Bui) updatebotbutton(lang.build.buttonlabel+' - ON', 'pbbuildtab');
        }
	m += '<TD><INPUT id=pbBuildMode type=submit value="'+lang.build.modebuild+' = OFF"></td>';
			m += '<TD>Build Type: <SELECT id="pbBuildType">\
				<OPTION value=build>'+uW.g_js_strings.commonstr.next+'</option>\
				<OPTION value=max>'+uW.g_js_strings.commonstr.maximum+'</option>\
				<OPTION value=destruct>'+uW.g_js_strings.commonstr.destroy+'</option>\
				<OPTION value=destructnow>'+uW.g_js_strings.commonstr.destroy+' Now !</option>\
				</select></td>';
		m += '<TD><INPUT id=pbHelpRequest type=checkbox '+ (t.buildStates.help?' CHECKED':'') +'\></td><TD>'+uW.g_js_strings.modaltitles.helprequest+'</td>';
		m += '</tr></table></div>';
        m += '<DIV id=pbBuildDivQ class=boStat>'+lang.build.biglabel+'</div><TABLE id=pbbuildqueues width=100% height=0% class=ptentry><TR>';
		for (var i = 0; i < Cities.cities.length; i++) {
            m += '<TD colspan=2><CENTER><B>' + Cities.cities[i].name + '</b></center></td>';
        }
		m += '</tr><TR>';
        for (var i = 0; i < Cities.cities.length; i++) {
            m += '<TD colspan=2><CENTER><INPUT id=pbbuild_' + Cities.cities[i].id + ' type=submit value="'+uW.g_js_strings.commonstr.view+'"></center></td>';
        }
        m += '</tr><TR>';
        for (var i = 0; i < Cities.cities.length; i++) {
            m += '<TD colspan=2><CENTER><INPUT id=pbCancelAll_' + Cities.cities[i].id + ' type=submit value="'+uW.g_js_strings.modaltitles.deleteall+'"></center></td>';
        }
        m += '</tr><TR>';

        for (var i = 0; i < Cities.cities.length; i++) {
            m += '<TD align=right width=2%>Fil:</td><TD id=pbbuildcount_' + Cities.cities[i].id + '>' + t["bQ_" + Cities.cities[i].id].length + '</td>';
        }
        m += '</tr><TR>';
        for (var i = 0; i < Cities.cities.length; i++) {
            t['totalTime_' + Cities.cities[i].id] = 0;
            cbQ = t["bQ_" + Cities.cities[i].id];
            if (typeof cbQ != 'undefined') {
                for (var j = 0; j < cbQ.length; j++) {
                    t['totalTime_' + Cities.cities[i].id] = parseInt(t['totalTime_' + Cities.cities[i].id]) + parseInt(cbQ[j].buildingTime);
                }
                timestring = timestr(t['totalTime_' + Cities.cities[i].id]);
            }
            m += '<TD align=right width=2%>Tp:</td><TD id=pbbuildtotal_' + Cities.cities[i].id + '>' + timestring + '</td>';
        }
        m += '</tr><TR>';
	    var now = unixTime();
	    for (var i = 0; i < Cities.cities.length; i++) {
	      var qcon = Seed.queue_con["city" + Cities.cities[i].id], btimestr = '0s';
	      if (qcon.length>0) {
	        btimestr = timestr(parseInt(qcon[0][4])-now);
	      }
	      m += '<TD align=right width=2%><span title="'+lang.build.ectitle+'">'+lang.build.ec+'</span></td>';
	      m += '<TD align=left width=9% id=pbbuildtime_' + Cities.cities[i].id + '>' + btimestr + '</td>';

       }
         m += '</tr></table><SPAN class=boldRed id=pbbuildError></span>';
         m+='<br><br><font size=1>'+lang.pubbao+'<br><iframe src="'+sitepub+'" width=320 marginwidth=0 marginheight=0 height=50 scrolling=no frameborder=0></iframe>';
        t.myDiv.innerHTML = m;

        for (var i = 0; i < Cities.cities.length; i++) {
            var cityId = Cities.cities[i].id;
            var btnName = 'pbbuild_' + cityId;
            addQueueEventListener(cityId, btnName);
            var btn2Name = 'pbCancelAll_' + cityId;
            CancelAllEventListener(cityId, btn2Name);
			t.showBuildQueue(cityId, false);
        }

        setTimeout(function() { t.e_autoBuild(0);  }, 10000);

		ById('pbBuildType').addEventListener('change', function(){t.setBuildMode(this.value);}, false);
		ById('pbBuildRunning').addEventListener('click', function(){
            t.toggleStateRunning(this);
        }, false);
		ById('pbBuildMode').addEventListener('click', function(){
            t.toggleStateMode(this);
        }, false);
		ById('pbHelpRequest').addEventListener ('change', function (){
        t.buildStates.help = (ById('pbHelpRequest').checked);
        t.saveBuildStates();
        }, false);

		window.addEventListener('unload', t.onUnload, false);

        function addQueueEventListener(cityId, name){
            ById(name).addEventListener('click', function(){
                t.showBuildQueue(cityId, true);
            }, false);
        }

        function CancelAllEventListener(cityId, name){
            ById(name).addEventListener('click', function(){
            	t["bQ_" + cityId] = [];
            	t['totalTime_' + cityId] = 0;
            	ById('pbbuildcount_' + cityId).innerHTML = 0;
            	ById('pbbuildtotal_' + cityId).innerHTML = timestr(0);
            }, false);
        }


    },
	setBuildMode: function (type) {
	    var t = Tabs.build;
		t.currentBuildMode = type;
		},
    e_autoBuild: function(cityIdT){
      var t = Tabs.build;
      var ilya=0;
      ById('pbbuildError').innerHTML = '';
      for (var i = 0; i < Cities.cities.length; i++) {
        var cityId = Cities.cities[i].id;
        ilya+=t["bQ_" + cityId].length;

      }
      if (ilya < 1) {

        t.toggleStateRunning();
        return;
      }
      if (t.buildStates.running == true) {
          var now = unixTime();
          for (var i = 0; i < Cities.cities.length; i++) {
              var cityId = Cities.cities[i].id;
              var isBusy = false;
              document.getElementById('pbbuildtime_' + cityId).innerHTML = "0s";
              var qcon = Seed.queue_con["city" + cityId];
              if (matTypeof(qcon)=='array' && qcon.length>0) {
               var buildtimeremainsec=parseInt(qcon[0][4])-now;
                if (buildtimeremainsec > 0) {
                  isBusy = true;
                  btimestr = timestr(buildtimeremainsec);
                  document.getElementById('pbbuildtime_' + cityId).innerHTML = btimestr;
                }else
                  qcon.shift();
              }
              if (isBusy) {
                   if (i >= Cities.cities.length-1) {
		       setTimeout(function() { t.e_autoBuild(cityId);  }, 20000);
                   }
              } else {
                 if (t["bQ_" + cityId].length > 0) {
                 	 var bQi = t["bQ_" + cityId][0];
			 t.doOne(bQi);
			 setTimeout(function() {

			 t.e_autoBuild(cityId);

			 },10000);
			 break;

                 } else {

                   if (i >= Cities.cities.length-1) {
                     setTimeout(function() { t.e_autoBuild(cityId);  }, 15000);
                   }
                 }
              }

            }


       }

    },
    doOne : function (bQi){
		var t = Tabs.build;
		var currentcityid = parseInt(bQi.cityId);
		var cityName = t.getCityNameById(currentcityid);
		var time = parseInt(bQi.buildingTime);
		var mult = parseInt(bQi.buildingMult);
		var attempt = parseInt(bQi.buildingAttempt);
		var mode = bQi.buildingMode;
		var citpos = parseInt(bQi.buildingPos);
		if (Seed.buildings['city' + currentcityid]["pos" + citpos] != undefined && Seed.buildings['city' + currentcityid]["pos" + citpos][0] != undefined) {
			var l_bdgid = parseInt(bQi.buildingType);
			var bdgid = parseInt(Seed.buildings['city' + currentcityid]["pos" + citpos][0]);
			var l_curlvl = parseInt(bQi.buildingLevel);
			var curlvl = parseInt(Seed.buildings['city' + currentcityid]["pos" + citpos][1]);
			var l_bid = parseInt(bQi.buildingId);
			var bid = parseInt(Seed.buildings["city" + currentcityid]["pos" + citpos][3]);

			if (curlvl > 8 && mode == 'build') {
				t.cancelQueueElement(0, currentcityid, time, false);
				actionLog("AutoCons","Queue item deleted: Building Level equals 9 or higher!!!");
				return;
			};
			if (isNaN(curlvl)) {
				t.cancelQueueElement(0, currentcityid, time, false);
				actionLog("AutoCons","Found no correct value for current building!!!!");
				return;
			}
			if (l_bdgid != bdgid) {
				t.cancelQueueElement(0, currentcityid, time, false);
				actionLog("AutoCons","Building Type does not match!!!!");
				return;
			}
			if (l_bid != bid) {
				t.cancelQueueElement(0, currentcityid, time, false);
				actionLog("AutoCons","Building ID does not match!!!!");
				return;
			}
			if (l_curlvl < curlvl) {
					t.cancelQueueElement(0, currentcityid, time, false);
					actionLog("AutoCons","Queue item deleted: Buildinglevel is equal or higher!!!");
					return;
			}
			if (l_curlvl > curlvl && mode == 'build') {
					t.requeueQueueElement(bQi);
					return;
			}

			if (mode == 'destruct') {
				var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
				params.cid = currentcityid;
				params.bid = "";
				params.pos = citpos;
				params.lv = curlvl - 1;
				if (curlvl >= 1) {
					params.bid = bid;
				}
				params.type = bdgid;
				new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/destruct.php" + unsafeWindow.g_ajaxsuffix, {
					method: "post",
					parameters: params,
					onSuccess: function(rslt){
						if (rslt.ok) {
							Seed.queue_con["city" + currentcityid].push([bdgid, 0, parseInt(rslt.buildingId), unsafeWindow.unixtime(), unsafeWindow.unixtime() + time, 0, time, citpos]);
							if (params.cid == unsafeWindow.currentcityid)
								unsafeWindow.update_bdg();
							if (ById('pbHelpRequest').checked == true)
								t.bot_gethelp(params.bid, currentcityid);
							t.cancelQueueElement(0, currentcityid, time, false);
						} else {
							var errmsg = unsafeWindow.printLocalError(rslt.error_code || null, rslt.msg || null, rslt.feedback || null);
							actionLog("AutoCons",cityName + " : " + errmsg);
							t.requeueQueueElement(bQi);
							ById('pbbuildError').innerHTML = errmsg;

						}
					},
					onFailure: function(){
						ById('pbbuildError').innerHTML = lang.build.err1;
					}
				})
			}
			if (mode == 'build') {
				var invalid = false;
				var chk = unsafeWindow.checkreq("bdg", bdgid, curlvl);
				for (var c = 0; c < chk[3].length; c++) {
					if (chk[3][c] == 0) {
					invalid = true;
					}
				}
				if (invalid == false) {
					var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
					params.cid = currentcityid;
					params.bid = "";
					params.pos = citpos;
					params.lv = curlvl + 1;
					if (params.lv > 9){
						t.cancelQueueElement(0, currentcityid, time, false);
						actionLog("AutoCons","Queue item deleted: Tryed to build level 10+ building! Please report if this happens!!!");
						return;
					}
					if (params.lv > 1) {
						params.bid = bid;
					}
					params.type = bdgid;
					if ((Seed.resources["city" + currentcityid].rec1[0] >= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][1]) * mult * 3600) &&
					   (Seed.resources["city" + currentcityid].rec2[0] >= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][2]) * mult * 3600) &&
					  (Seed.resources["city" + currentcityid].rec3[0] >= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][3]) * mult * 3600) &&
					  (Seed.resources["city" + currentcityid].rec4[0] >= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][4]) * mult * 3600) &&
					 (Seed.citystats["city" + currentcityid].gold[0] >= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][5]) * mult)) {
					new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/construct.php" + unsafeWindow.g_ajaxsuffix, {
						method: "post",
						parameters: params,
						onSuccess: function(rslt){
							if (rslt.ok) {
								Seed.resources["city" + currentcityid].rec1[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][1]) * mult * 3600;
								Seed.resources["city" + currentcityid].rec2[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][2]) * mult * 3600;
								Seed.resources["city" + currentcityid].rec3[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][3]) * mult * 3600;
								Seed.resources["city" + currentcityid].rec4[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][4]) * mult * 3600;
								Seed.citystats["city" + currentcityid].gold[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][5]) * mult;
								Seed.queue_con["city" + currentcityid].push([bdgid, curlvl + 1, parseInt(rslt.buildingId), unsafeWindow.unixtime(),  unsafeWindow.unixtime() + time, 0, time, citpos]);
								if (params.cid == unsafeWindow.currentcityid)
									unsafeWindow.update_bdg();
								if (ById('pbHelpRequest').checked == true)
									t.bot_gethelp(params.bid, currentcityid);
								t.cancelQueueElement(0, currentcityid, time, false);
							} else {
							if (rslt.user_action) {
							   if (rslt.user_action!="backOffWaitTime") {
								actionLog("AutoCons","<b><font color=red>Detection Captcha  !!!</font></b>");
								new CdialogCancelContinue('<SPAN class=boldRed>CAPTCHA ALERT ! AUTOBUILD !</span>', null, null, mainPop.getMainDiv());
							   }

							} else {
								var errmsg = unsafeWindow.printLocalError(rslt.error_code || null, rslt.msg || null, rslt.feedback || null);
								if (rslt.error_code == 103) {
									t.cancelQueueElement(0, currentcityid, time, false);
									actionLog("AutoCons", Cities.byID[currentcityid].name +" : Building at this Level already exists or build process already started!");
								} else {
									t.requeueQueueElement(bQi);
									actionLog("AutoCons", Cities.byID[currentcityid].name +' : '+ errmsg);
									ById('pbbuildError').innerHTML = Cities.byID[currentcityid].name +': '+ errmsg + " Item was requeued. Check for retry count.";
								}
							}

							}
					},
						onFailure: function(){
							ById('pbbuildError').innerHTML = "Connection Error while building! Please try later again";
						}
					});

				   } else {
				    t.requeueQueueElement(bQi);
				    ById('pbbuildError').innerHTML =lang.build.err2;
				    actionLog("AutoCons", Cities.byID[currentcityid].name +' : <font color=red>'+lang.build.err2+'</font>');
				   }


				} else {
					t.requeueQueueElement(bQi);
					//actionLog("AutoCons", Cities.byID[currentcityid].name +' : <font color=red>Bizarreee !!</font>');
					t.countbizarre++;
					if (t.countbizarre>10) {
					 actionLog("AutoCons",Cities.byID[currentcityid].name +" : 10 tentatives de contruction bizarre - on recharge le jeu - MERCI DE REFAIRE VOS FILES");
					 reloadKOC();

					}
				}
			}
		} else {
			t.cancelQueueElement(0, currentcityid, time, false);
		}
	},
	countbizarre:0,
	requeueQueueElement: function (bQi) {
	    var t = Tabs.build;
		var cityId = bQi.cityId;
		var buildingPos = parseInt(bQi.buildingPos);
		var buildingId = parseInt(bQi.buildingId);
		var buildingLevel = parseInt(bQi.buildingLevel);
		var buildingType = parseInt(bQi.buildingType);
		var buildingTime = parseInt(bQi.buildingTime);
		var buildingMult = parseInt(bQi.buildingMult);
		var buildingAttempts = parseInt(bQi.buildingAttempts);
		var buildingMode = bQi.buildingMode;

		t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts + 1, buildingMult, buildingMode);
		t.cancelQueueElement(0, cityId, buildingTime, false);
	},
    show: function(){
		var t = Tabs.build;
    },
    bot_buildslot: function(c, a){
        var t = Tabs.build;
		var cityId = t.getCurrentCityId();
        	var buildingPos   = c.id.split("_")[1];
        	var buildingType  = parseInt(Seed.buildings['city' + cityId]["pos" + buildingPos][0]);
        	var buildingLevel = parseInt(Seed.buildings['city' + cityId]["pos" + buildingPos][1]);
		var buildingId    = parseInt(Seed.buildings['city' + cityId]["pos" + buildingPos][3]);
  		var buildingAttempts = 0;
		var loaded_bQ = t["bQ_" + cityId];
		if (typeof Seed.queue_con['city' + cityId][0] != 'undefined') {
			var current_construction_pos = Seed.queue_con['city' + cityId][0][2];
		} else {
			var current_construction_pos = "";
		}
		if (loaded_bQ.length == 0 && current_construction_pos != "" ) {
			if (current_construction_pos != 'NaN' && current_construction_pos == buildingId) {
				buildingLevel += 1;
			}
		} else {
			if (current_construction_pos != "" && current_construction_pos == buildingId) {
				buildingLevel += 1;
			}
			for (var i = 0; i < loaded_bQ.length; i++) {
				var loadedCity = loaded_bQ[i].cityId;
				var loadedSlot = loaded_bQ[i].buildingPos;
				if (loadedSlot == buildingPos && loadedCity == cityId) {
					buildingLevel += 1;
				}
				if (loaded_bQ[i].buildingMode == 'destruct' && loadedSlot == buildingPos && loadedCity == cityId) {
					t.modalmessage(lang.build.err3);
					return;
				}
			}
		}
        if (t.currentBuildMode == "build") {
	   if (buildingLevel >= 9) {
                t.modalmessage(lang.build.err4);
                return;
            }
            var buildingMode = "build";
			var result = t.calculateQueueValues(cityId, buildingLevel, buildingType, buildingMode);
			var buildingMult = result[0];
			var buildingTime = result[1];
			var queueId = loaded_bQ.length;
			t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode);
			t._addTab(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode);
        }
        if (t.currentBuildMode == "max") {
            var buildingMode = "build";
			for (var bL = buildingLevel; bL <9; bL++) {
				var queueId = loaded_bQ.length;
				var result = t.calculateQueueValues(cityId, bL, buildingType, buildingMode);
				var buildingMult = result[0];
				var buildingTime = result[1];
				queueId = queueId ;
				t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, bL, buildingAttempts, buildingMult, buildingMode);
				t._addTab(queueId, cityId, buildingType, buildingTime, bL, buildingAttempts, buildingMode);
			}
        }
        if (t.currentBuildMode == "destruct") {
            var buildingMode = "destruct";
			var result = t.calculateQueueValues(cityId, buildingLevel, buildingType, buildingMode);
			var buildingMult = result[0];
			var buildingTime = result[1];
			var queueId = loaded_bQ.length;
			t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode);
			t._addTab(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode);
        }
            if (t.currentBuildMode == "destructnow") {

		  var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
				params.cityId = cityId;
				params.buildingId = buildingId;
				params.pos = buildingPos;
				params.requestType = "DESTROY_BUILDING_DRAGON_STOMP_MEDAL";
				new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/destroyBuilding.php" + unsafeWindow.g_ajaxsuffix, {
					method: "post",
					parameters: params,
					onSuccess: function(rslt){
						if (rslt.ok) {
							uW.seed.items.i9=Number(uW.seed.items.i9)-1;
							uW.ksoItems[9].subtract();

							delete Seed.buildings["city"+cityId]["pos"+buildingPos];
							uW.citysel_click(ById("citysel_"+(Cities.byID[cityId].idx+1)));

						} else {
							var errmsg = unsafeWindow.printLocalError(rslt.error_code || null, rslt.msg || null, rslt.feedback || null);

							ById('pbbuildError').innerHTML = errmsg;

						}
					},
					onFailure: function(){
						ById('pbbuildError').innerHTML = lang.build.err1;
					}
				})


        }




    },
	calculateQueueValues: function (cityId, buildingLevel, buildingType, buildingMode) {
	    var t = Tabs.build;
		var now = unixTime();
		if (buildingMode == 'build') {
			var buildingMult = Math.pow(2, buildingLevel);
        }
		if (buildingMode == 'destruct') {
			var buildingMult = Math.pow(2, buildingLevel - 2);
		}

		var knights = Seed.knights["city" + cityId];
		if (knights) {
			var polKniId = parseInt(Seed.leaders['city' + cityId].politicsKnightId);
			if (polKniId) {
				var polValue = parseInt(Seed.knights['city' + cityId]['knt' + polKniId].politics);
				var polBoost = parseInt(Seed.knights['city' + cityId]['knt' + polKniId].politicsBoostExpireUnixtime);
				if ((polBoost - now) > 0) {
					polValue = parseInt(polValue * 1.25);
				}
			} else {
				polValue = 0;
			}
		} else {
			polValue = 0;
		}

        var buildingTime = unsafeWindow.buildingcost["bdg" + buildingType][7] * buildingMult;



        if (parseInt(buildingType) < 6 && parseInt(buildingType) > 0 && buildingMult == 1) {
            buildingTime = 15;
        }
        var C=EffetTronePrc(78).percent;

	if (buildingMode == 'build') {
			buildingTime = parseInt(buildingTime / (1 + 0.005 * polValue + 0.1 * parseInt(Seed.tech.tch16)));

        }
	if (buildingMode == 'destruct') {
			buildingTime = parseInt(buildingTime / (1 + 0.005 * polValue + 0.1 * parseInt(Seed.tech.tch16)));
			if (buildingTime % 1 > 0) {
				buildingTime = parseInt(buildingTime);
			}
		}
	 buildingTime=Math.round(buildingTime/(1+(C/100)));
	 var result = new Array(buildingMult, buildingTime);
	 return result;
	},
	calculateQueueValues: function (cityId, buildingLevel, buildingType, buildingMode) {
	    var t = Tabs.build;
		var now = unixTime();
		if (buildingMode == 'build') {
			var buildingMult = Math.pow(2, buildingLevel);
        }
		if (buildingMode == 'destruct') {
			var buildingMult = Math.pow(2, buildingLevel - 2);
		}

		var knights = Seed.knights["city" + cityId];
		if (knights) {
			var polKniId = parseInt(Seed.leaders['city' + cityId].politicsKnightId);
			if (polKniId) {
				var polValue = parseInt(Seed.knights['city' + cityId]['knt' + polKniId].politics);
				var polBoost = parseInt(Seed.knights['city' + cityId]['knt' + polKniId].politicsBoostExpireUnixtime);
				if ((polBoost - now) > 0) {
					polValue = parseInt(polValue * 1.25);
				}
			} else {
				polValue = 0;
			}
		} else {
			polValue = 0;
		}

        var buildingTime = unsafeWindow.buildingcost["bdg" + buildingType][7] * buildingMult;
        if (parseInt(buildingType) < 6 && parseInt(buildingType) > 0 && buildingMult == 1) {
            buildingTime = 15;
        }
		if (buildingMode == 'build') {
			buildingTime = parseInt(buildingTime / (1 + 0.005 * polValue + 0.1 * parseInt(Seed.tech.tch16)));
        }
		if (buildingMode == 'destruct') {
			buildingTime = buildingTime / (1 + 0.005 * polValue + 0.1 * parseInt(Seed.tech.tch16));
			if (buildingTime % 1 > 0) {
				buildingTime = parseInt(buildingTime);
			}
		}

		var result = new Array(buildingMult, buildingTime);
		return result;
	},
	bot_gethelp: function (f, currentcityid) {
		var t = Tabs.build;
		var city = t.getCityNameById(currentcityid);
		for (i=0;i<Seed.cities.length;i++) {
			if (Seed.cities[i][1]==city) var cityNum=i;
		}
		cityNum++;
		unsafeWindow.citysel_click(ById('citysel_'+ (cityNum)));
	  var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	  params.bid = f;
	  params.ctrl = 'AskForHelp';
	  params.action = 'getHelpData';
	  new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
		  method: "post",
		  parameters: params,
		  onSuccess: function (rslt) {
			unsafeWindow.handleHelpCallback (rslt.data);
		  },
		  onFailure: function (rslt) {
			t.bot_gethelp (f, currentcityid);
			return;
		  },
		  });

	  var a = Seed.queue_con["city" + currentcityid];
	  var e = 0;
	  var d = 0;
	  for (var c = 0; c < a.length; c++) {
		if (parseInt(a[c][2]) == parseInt(f)) {
		  e = parseInt(a[c][0]);
		  d = parseInt(a[c][1]);
		  break
		}
	  }
	  var b = new Array();
	  b.push(["REPLACE_LeVeLbUiLdInG", d]);
	  b.push(["REPLACE_BuIlDiNgNaMe", unsafeWindow.buildingcost["bdg" + e][0]]);
	  b.push(["REPLACE_LeVeLiD", d]);
	  b.push(["REPLACE_AsSeTiD", f]);
	  var g = function(h, i) {
		unsafeWindow.continuation_95(h, i);
		if (!h) {
		  var j = d > 1 ? unsafeWindow.cm.SpeedUpType.upgrade : unsafeWindow.cm.SpeedUpType.build;
		  unsafeWindow.cm.ClientSideCookieManager.setCookie(j, false)
		}
	  };
	  unsafeWindow.common_postToProfile("95", unsafeWindow.Object.cloneFeed(unsafeWindow.template_data_95), unsafeWindow.Object.cloneFeed(unsafeWindow.actionlink_data_95), g, b)
	},
	addQueueItem: function (cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode) {
	var t = Tabs.build;
		var lbQ = t["bQ_" + cityId];
		lbQ.push({
            cityId: 			cityId,
            buildingPos:		buildingPos,
            buildingType: 		buildingType,
			buildingId: 		buildingId,
            buildingTime: 		buildingTime,
            buildingLevel: 		buildingLevel,
            buildingAttempts: 	buildingAttempts,
			buildingMult: 		buildingMult,
            buildingMode: 		buildingMode
        });
	t.modifyTotalTime(cityId, 'increase', buildingTime);
	},
    modalmessage: function(message){
	var t = Tabs.build;
        var timeout = 10000;
        var content = lang.build.autoclose+"<br><br>"
        content += message;
        unsafeWindow.Modal.showAlert(content);
        setTimeout(function() {
          unsafeWindow.Modal.hideModal();
        }, timeout);
    },
	modifyTotalTime: function (cityId, type, buildingTime) {
	    var t = Tabs.build;
		var element = ById('pbbuildcount_' + cityId);
		var currentCount = parseInt(element.innerHTML);
		if (type == "increase") {
			t['totalTime_' + cityId] = t['totalTime_' + cityId] + buildingTime;
			var currentCount = currentCount + 1;
		}
		if (type == "decrease") {
			t['totalTime_' + cityId] = t['totalTime_' + cityId] - buildingTime;
			var currentCount = currentCount - 1;
		}
		element.innerHTML = currentCount;
		ById('pbbuildtotal_' + cityId).innerHTML = timestr(t['totalTime_' + cityId]);
	},
    hide: function(){
        var t = Tabs.build;
    },
    onUnload: function(){
        var t = Tabs.build;
        for (var i = 0; i < Cities.cities.length; i++) {
            t["bQ_" + Cities.cities[i].id].sort(function(a,b){return a.buildingTime - b.buildingTime});
            if (!ResetAll) GM_setValue('bQ_' + getServerId() + '_' + Cities.cities[i].id, JSON2.stringify((t["bQ_" + Cities.cities[i].id])));
        }
        t.saveBuildStates();
    },
    _addTab: function(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode){
		var t = Tabs.build;
        var row = ById('pbCityQueueContent').insertRow(0);
        row.vAlign = 'top';
        row.insertCell(0).innerHTML = queueId;
        if (buildingMode == "destruct") {
            row.insertCell(1).innerHTML = '<img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/bonus_att.png">';
        }
        else {
            row.insertCell(1).innerHTML = '<img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/bonus_prod.png">';
        }
        row.insertCell(2).innerHTML = unsafeWindow.buildingcost['bdg' + buildingType][0];
        row.insertCell(3).innerHTML = timestr(buildingTime);
		if (buildingMode == "destruct") {
			row.insertCell(4).innerHTML = 0;
        } else {
			row.insertCell(4).innerHTML = buildingLevel + 1;
		}
		row.insertCell(5).innerHTML = buildingAttempts;
        row.insertCell(6).innerHTML = '<a class="button20" id="queuecancel_' + queueId + '"><span>'+uW.g_js_strings.commonstr.cancel+'</span></a>';
        ById('queuecancel_' + queueId).addEventListener('click', function(){
            t.cancelQueueElement(queueId, cityId, buildingTime, true);
        }, false);
    },
    cancelQueueElement: function(queueId, cityId, buildingTime, showQueue){
        var t = Tabs.build;
        var queueId = parseInt(queueId);
        t["bQ_" + cityId].splice(queueId, 1);
        t.modifyTotalTime(cityId, 'decrease', buildingTime);

        if (showQueue == true) {
            t.showBuildQueue(cityId, false);
        }
    },
    showBuildQueue: function(cityId, focus){
	    var t = Tabs.build;
	    clearTimeout (t.timer);
        var popBuildQueue = null;
        var cityName = t.getCityNameById(cityId);
        if (t.popBuildQueue == null) {
            t.popBuildQueue = new CPopup('pbbuild_' + cityId, 0, 0, 350, 500, true, function() {clearTimeout (t.timer);});
        }
        var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbTabPad" id="pbCityQueueContent">';
        t.popBuildQueue.getMainDiv().innerHTML = '</table></div>' + m;
        t.popBuildQueue.getTopDiv().innerHTML = '<TD width="200px"><B>'+lang.build.queue+ ' ' + cityName + '</b></td><TD><INPUT id=pbOptimizeByTime type=submit value="'+lang.build.optimize+'"></td>';
        t.popBuildQueue.centerMe (mainPop.getMainDiv());

        t.paintBuildQueue(cityId);
        if (focus)
          t.popBuildQueue.show(true);
		ById('pbOptimizeByTime').addEventListener('click', function(){t.clearBuildQueue();t.paintBuildQueue(cityId, true);}, false);
		t.timer = setTimeout (function() {t.showBuildQueue(cityId, false)}, 45000);
	},
    paintBuildQueue: function(cityId, optimize){
        var t = Tabs.build;
        var lbQ = t["bQ_" + cityId];
		if (optimize == true) {
			lbQ.sort(function(a,b){return a.buildingTime - b.buildingTime});
		}
		t["bQ_" + cityId] = lbQ;
		for (var i = 0; i < lbQ.length; i++) {
			var queueId = i;
			t._addTab(queueId, lbQ[i].cityId, lbQ[i].buildingType, lbQ[i].buildingTime, lbQ[i].buildingLevel, lbQ[i].buildingAttempts, lbQ[i].buildingMode);
        }
    },
    clearBuildQueue: function() {
	    var t = Tabs.build;
		var table = ById('pbCityQueueContent');
		var rows = table.rows;
		while(rows.length)
			table.deleteRow(rows.length-1);
	},
    getCurrentCityId: function(){
        if (!unsafeWindow.currentcityid)
            return null;
        return unsafeWindow.currentcityid;
    },
    saveBuildStates: function(){
		var t = Tabs.build;
        var serverID = getServerId();
        GM_setValue('buildStates_' + serverID, JSON2.stringify(t.buildStates));
    },
    readBuildStates: function(){
        var t = Tabs.build;
        var serverID = getServerId();
        s = GM_getValue('buildStates_' + serverID);
        if (s != null) {
            states = JSON2.parse(s);
            for (k in states)
                t.buildStates[k] = states[k];
        }
    },
    toggleStateRunning: function(obj){
		var t = Tabs.build;
		obj = ById('pbBuildRunning');
        if (t.buildStates.running == true) {
            t.buildStates.running = false;
            t.saveBuildStates();
            if (obj) obj.value = lang.build.biglabel+" = OFF";
	      if (Options.BORac_Bui) updatebotbutton(lang.build.buttonlabel+' - OFF', 'pbbuildtab');
        }
        else {
            t.buildStates.running = true;
            t.saveBuildStates();
            if (obj) obj.value = lang.build.biglabel+" = ON";
	    if (Options.BORac_Bui) updatebotbutton(lang.build.buttonlabel+' - ON', 'pbbuildtab');
	    t.e_autoBuild(0);
        }
    },
    toggleStateMode: function(obj){
		var t = Tabs.build;
		obj = ById('pbBuildMode');
            if (obj.value == lang.build.modebuild+' = OFF') {
			unsafeWindow.buildslot = t.bot_buildslot;
            obj.value = lang.build.modebuild+" = ON";

        }      else {
			unsafeWindow.buildslot = t.koc_buildslot;
			obj.value = lang.build.modebuild+" = OFF";
        }
    },
	getCityNameById: function (cityId) {
    return Cities.byID[cityId].name;
	},
}
/**************************** CHEVALIERS *********************/
Tabs.Knights = {
 tabOrder: 9,
  tabLabel: uW.g_js_strings.commonstr.knight,
  cont : null,
  state : null,
  displayTimer : null,
  action : 0,
  show : function (){
    var t = Tabs.Knights;
  },
  hide : function (){
    var t = Tabs.Knights;
    clearTimeout (t.displayTimer);
  },
  init : function (div){
    var t = Tabs.Knights;
    uW.ptAssignSkill = t.clickedAssignPoints;
    uW.ptAssignTunes = t.clickedAssignTune;
    uW.BOFireKnigth = t.renvoyer;
    t.cont=div;
    clearTimeout (t.displayTimer);
    if (t.state == null){
      t.cont.innerHTML = '<STYLE>table.ptTabPad tr.ptwpad {background-color:#ffffff; padding-left:5px}</style>\
            <DIV id=ptknightdiv style="max-height:'+(Options.HauteurBoite-25)+'px; height:'+(Options.HauteurBoite-25)+'px; overflow-y:auto">';
      t.state = 1;
    }
    t.showDiv();
   },
   renvoyer: function(cid, kid) {
	       var t = Tabs.Knights;
	       var params = uW.Object.clone(uW.g_ajaxparams);
	           params.cid = cid;
	           params.kid = kid;
	       new MyAjaxRequest(uW.g_ajaxpath + "ajax/fireKnight.php" + uW.g_ajaxsuffix, {
	         method: "post",
	         parameters: params,
	         onSuccess: function (rslt) {
 				delete Seed.knights['city'+cid]['knt'+kid];
 				if (rslt.updateSeed)
        			unsafeWindow.update_seed(rslt.updateSeed);


        		setTimeout(unsafeWindow.update_seed_ajax, 250);
        		t.showDiv();
	         },
	         onFailure: function () {
	         },
    });
   },
   showDiv: function() {
    var t = Tabs.Knights;
    function _dispKnight (roleId, knight, numcid){
      var rid = roleId;
      if (roleId==null)
        rid = 1;
      var sty='';
      if (row++ % 2)
        sty = ' ';
       if (knight == null) {
		 m = '<TR '+ sty +'valign=top align=right><TD> --- </td><TD align=left>';
         m += '--------</td><TD colspan=5></td><TD class=ptentry colspan=5></td><TD colspan=2></td></tr>';
      } else {

        var level = parseInt(Math.sqrt(parseInt(knight.experience) / 75)) + 1;
        var unpoints = level - parseInt(knight.skillPointsApplied);
        var salary = (parseInt(knight.skillPointsApplied) + 1) * 20;
        totSalary += salary;
        var ass = '';
        if (knight.knightStatus == 10){
          ass = '<TD class=ptentry align=left colspan=4>'+uW.g_js_strings.commonstr.marching+'</td>';
          	 m = '<TR '+ sty +'valign=top align=right><TD></td><TD align=left>';

        } else {
				 m = '<TR '+ sty +'valign=top align=right><TD> <img src="http://cdn1.iconfinder.com/data/icons/musthave/16/Remove.png" border=0 onclick="BOFireKnigth('+cid+','+knight.knightId+')"></td><TD align=left>';

          if (unpoints > 0){
            unpoints = '<SPAN class="boldRed">'+ unpoints +'</span>';
            for (var i=0; i<4; i++){
            var sty = 'padding-left:1px;';
            if (i == rid) {
              sty += 'font-weight:bold;color:#116654';
              if (t.action==1) {
	          t.clickedAssignPoints(null, cid,knight.knightId,i);
              }
              if (t.action==2) {
	      	          t.clickedAssignPoints(null, cid,knight.knightId,1);
              }
            }
            ass += '<TD class=ptentry align=left style="'+ sty +'" ><A style="'+ sty +'" onclick="ptAssignSkill(this,' + cid +','+ knight.knightId +','+ i +')">['+ knightRoles[i][2] +'] &nbsp;</a></td>';
           }
          }
          else
            ass = '<TD class=ptentry colspan=4></td>';
        }
        var now = unixTime();
        var skills = [];
        for (var i=0; i<4; i++){
          if (i == rid) {
            var point = knight[knightRoles[i][1]];
            skills[i] = '<B>'+ point +'</b>';
            if (i==1 && knight.combatBoostExpireUnixtime > now) {
		point *= 1.25;
		skills[i] = '<font color=red><span title="Boost 25 %  '+timestr(knight.combatBoostExpireUnixtime - now)+'"><B>'+ parseInt(point) +'</b></span></font>';
            }
             if (i==0 && knight.politicsBoostExpireUnixtime > now) {
	    		point *= 1.25;
	    		skills[i] = '<font color=red><span title="Boost 25 %  '+timestr(knight.politicsBoostExpireUnixtime - now)+'"><B>'+ parseInt(point) +'</b></span></font>';
            }
             if (i==3 && knight.resourcefulnessBoostExpireUnixtime > now) {
	    		point *= 1.25;
	    		skills[i] = '<font color=red><span title="Boost 25 %  '+timestr(knight.resourcefulnessBoostExpireUnixtime - now)+'"><B>'+ parseInt(point) +'</b></span></font>';
            }
             if (i==2 && knight.intelligenceBoostExpireUnixtime > now) {
	    		point *= 1.25;
	    		skills[i] = '<font color=red><span title="Boost 25 %  '+timestr(knight.intelligenceBoostExpireUnixtime - now)+'"><B>'+ parseInt(point) +'</b></span></font>';
            }
           } else {
              var point = knight[knightRoles[i][1]];
	      skills[i] = ''+ point +'';
	                 if (i==1 && knight.combatBoostExpireUnixtime > now) {
	     		point *= 1.25;
	     		skills[i] = '<font color=red><span title="Boost 25 %  '+timestr(knight.combatBoostExpireUnixtime - now)+'">'+ parseInt(point) +'</span></font>';
	                 }
	                  if (i==0 && knight.politicsBoostExpireUnixtime > now) {
	     	    		point *= 1.25;
	     	    		skills[i] = '<font color=red><span title="Boost 25 %  '+timestr(knight.politicsBoostExpireUnixtime - now)+'">'+ parseInt(point) +'</span></font>';
	                 }
	                  if (i==3 && knight.resourcefulnessBoostExpireUnixtime > now) {
	     	    		point *= 1.25;
	     	    		skills[i] = '<font color=red><span title="Boost 25 %  '+timestr(knight.resourcefulnessBoostExpireUnixtime - now)+'">'+ parseInt(point) +'</span></font>';
	                 }
	                  if (i==2 && knight.intelligenceBoostExpireUnixtime > now) {
	     	    		point *= 1.25;
	     	    		skills[i] = '<font color=red><span title="Boost 25 %  '+timestr(knight.intelligenceBoostExpireUnixtime - now)+'">'+ parseInt(point) +'</span></font>';
            		 }
           }
        }
        var item211="0";
        var item221="0";
        var item231="0";
        var item241="0";
        if (Seed.items.i211) item211='<a onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){ boost_modal(1,'+ knight.knightId +');return false;}, 500);">'+Seed.items.i211+'</a>';
        if (Seed.items.i221) item221='<a onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){ boost_modal(2,'+ knight.knightId +');return false;}, 500);">'+Seed.items.i221+'</a>';
        if (Seed.items.i231) item231='<a onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){ boost_modal(3,'+ knight.knightId +');return false;}, 500);">'+Seed.items.i231+'</a>';
        if (Seed.items.i241) item241='<a onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){ boost_modal(4,'+ knight.knightId +');return false;}, 500);">'+Seed.items.i241+'</a>';
        m += '<a title="Assigner un role" onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){ assign_role_modal('+ knight.knightId +');return false;}, 500);">' + knight.knightName.substring(0,20) + '</a></td><TD><a title="Augmenter EXP" onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){  xpBoost_modal('+ knight.knightId +');return false; }, 500);" href="javascript:void(0)">'+ level +'</a></td>\
              <TD>'+ skills[0] +' ('+item211+')</td><TD>'+ skills[1] +' ('+item221+')</td><TD>'+ skills[2] +' ('+item231+')</td><TD>' + skills[3]
          +' ('+item241+')</td><TD class=ptentry>'+ unpoints +'</td>'+ ass +'<td><a onclick="citysel_click(document.getElementById(\'citysel_'+ (numcid+1)+'\'));setTimeout (function (){ loyalBoost_modal('+ knight.knightId +');return false;}, 500);" colspan=2>'+knight.loyalty+'</a><img onclick="ptAssignTunes(' + cid +','+ knight.knightId +');" src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/gold_16.png" title="Booster la loyaute a 5% avec l\'or"></td><TD>'+ addCommas(salary) +'</td></tr>';
      }
      return m;
    }

    var totSalary = 0;
    var m = '<TABLE cellspacing=0 align=center class=ptTabPad><TR><td colspan=15><DIV class=boStat>'+lang.Knights.title+' - <input style="height:20px;font-size:9px;" type=button value="Attribution par defaut" id="BOchebut"><input style="height:20px;font-size:9px;" type=button value="Attribution en combat" id="BOchebut1"></div></td></tr>';
    for (var c=0; c<Cities.numCities; c++) {
      var city = Cities.cities[c];
      var cid = Cities.cities[c].id;
      m += '<tr><TD colspan=15><DIV class=boStat>'+ Cities.cities[c].name +' &nbsp; ('+ city.x +','+ city.y +') </div></td></tr>\
          <TBODY id="BOkin'+cid+'"><TR style="font-weight:bold" align=right><TD width=30>X</td><TD width=140 align=center>'+uW.g_js_strings.commonstr.nametx+'</td><TD width=22>Niv</td><TD width=25>Pol</td><TD width=25>Com</td>\
          <TD width=25>Int</td><TD width=25>Res</td><TD width=75 align=center colspan=5>-- '+uW.g_js_strings.modaltitles.assignskills+' --</td><td witdh=25 colspan=1>Loy</td><TD width=40 align=right> '+uW.g_js_strings.commonstr.salary+' </td></tr>';
      totSalary = 0;
      var did = {};
      var row = 0;
      for (var i=0; i<knightRoles.length; i++){
        var leader = Seed.leaders['city'+cid][knightRoles[i][1]+'KnightId'];
        if (leader == 0)
          m += _dispKnight (i, null, c);
        else {
          m += _dispKnight (i, Seed.knights['city'+cid]['knt'+leader], c);
          did['knt'+leader] = true;
        }
      }
      var list = [];
      for (k in Seed.knights['city'+cid]){
        if (!did[k])
          list.push (Seed.knights['city'+cid][k]);
      }
      list.sort (function (a,b){return parseInt(b.combat)-parseInt(a.combat)});
      for (i=0; i<list.length; i++)
        m += _dispKnight (null, list[i], c);
       m += '<TR align=right><TD colspan=13><B>'+uW.g_js_strings.commonstr.salary+' Total :</b></td><TD>'+ addCommas(totSalary) +'</td></tr></TBODY>';
    }
    ById('ptknightdiv').innerHTML = m +'</table></div>';


    t.action = 0;
    but = ById('BOchebut');
    but.addEventListener ('click', function (){
      t.action=1;
      t.showDiv();
    }, false);
    but = ById('BOchebut1');
    but.addEventListener ('click', function (){
          t.action=2;
          t.showDiv();
    }, false);
    t.displayTimer = setTimeout (t.showDiv, 5000);
  },

  clickedAssignTune: function(cid, kid) {
    var t = Tabs.Knights;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.cid = cid;
        params.kid = kid;
      params.rid=0;
      params.standalone=0;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/rewardKnight.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
       if (rslt.ok) {
         var knight = Seed.knights["city" + cid]["knt" + kid];
         knight.loyalty = parseInt(knight.loyalty) + 5;
        }
      },
      onFailure: function () {
      },
    });
  },
  clickedAssignPoints : function (e, cid, kid, rid){
    var t = Tabs.Knights;
    clearTimeout (t.displayTimer);

    var knight = Seed.knights['city'+cid]['knt'+kid];
    if (knight.knightStatus == 10 && e!=null){
      var row = e.parentNode.parentNode;
      row.childNodes[7].innerHTML = uW.g_js_strings.commonstr.marching;
      return;
    }
    sk = [];
    var unassigned = parseInt(Math.sqrt(parseInt(knight.experience)/75)) + 1  - parseInt(knight.skillPointsApplied);


    for (var i=0; i<4; i++){
      sk[i] = parseInt(knight[knightRoles[i][1]]);
      if (i == rid) {
        if ((sk[i]+unassigned)>=255) {
          unassigned=255-sk[i];
          sk[i]=255;

        }else{
          sk[i] += unassigned;
        }
      }
    }
    if (unassigned==0) return;
    if (e!=null) {
     var row = e.parentNode.parentNode;
     for (i=row.cells.length-1; i>=1; i--)
      row.deleteCell (i);
     var newCell=row.insertCell(-1);
     newCell.colSpan = 12;
     newCell.align= 'left';
     newCell.style.padding='1px 5px 1px 10px';
     var div = document.createElement ('div');
     div.style.backgroundColor = '#ffffff';
     div.style.textAlign = 'center';
     div.style.border = '1px solid';
     div.style.width = '98%';
     div.style.whiteSpace = 'normal';
     newCell.appendChild (div);
     div.innerHTML = lang.Knights.assigned+' '+ unassigned +' '+lang.Knights.ass2+' '+ knightRoles[rid][1] +' ... ';
    }
    t.postSkillPoints (cid, kid, sk[0], sk[1], sk[2], sk[3], function (r){t.postDone(r, div)});
  },

  postDone : function (rslt, div){
    var t = Tabs.Knights;
    clearTimeout (t.displayTimer);
    if (rslt.ok){
      if (div) div.innerHTML += '<B>'+lang.Knights.done+'</b>';
      t.displayTimer = setTimeout (t.showDiv, 5000);
    } else {
      if (div) div.innerHTML += '<BR><SPAN class=boldRed>ERREUR : '+ rslt.errorMsg +'</span>';
      t.displayTimer = setTimeout (t.showDiv, 10000);
    }
  },

  postSkillPoints : function (cid, kid, pol, com, int, res, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = cid;
    params.kid = kid;
    params.p = pol;
    params.c = com;
    params.i = int;
    params.r = res;

    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/skillupKnight.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok) {
          var knight = Seed.knights["city" + cid]["knt" + kid];
          var up = pol + com + int + res - knight.politics - knight.combat - knight.intelligence - knight.resourcefulness;
          knight.politics = pol;
          knight.combat = com;
          knight.intelligence = int;
          knight.resourcefulness = res;
          knight.skillPointsApplied = (parseInt(knight.skillPointsApplied) + up).toString();
        }
        if (notify)
          notify (rslt);
      },
      onFailure: function () {
        if (notify)
          notify (rslt);
      },
    });
  },
};

/******************* AUTO CRAFTING ************/
Tabs.AutoCraft = {

tabOrder: 14,
    tabLabel: 'AutoCraft',
    myDiv: null,
    timer: null,
    toutles  : TrainOptions.CraftIntervallMin,
    crafting: [],
    craftinfo : {},
myDiv: null,
    timer: null,
    timerStat: null,
    numcity :-1,
 init: function(div){
        var t = Tabs.AutoCraft;
        t.myDiv = div;
        t.crafting = {
	            running: TrainOptions.CraftingRunning,
        };
        if (Options.BORac_Cra) AddSubTabLink('Craft', t.toggleStateRunning, 'bocrafttab');
        var m = '<DIV id=pbBuildDivF class=boStat>'+lang.autoCraft.title+'</div><TABLE width=100% height=0% class=pbTab><TR>';
        if (t.crafting.running == false) {
	            m += '<TD><INPUT id=pbCraftRunning type=submit value="AutoCraft = OFF"></td>';
	            if (Options.BORac_Cra) updatebotbutton("Craft - OFF", 'bocrafttab');
	 }	        else {
	            m += '<TD><INPUT id=pbCraftRunning type=submit value="AutoCraft = ON"></td>';
	            if (Options.BORac_Cra) updatebotbutton("Craft - ON", 'bocrafttab');
	            setTimeout(t.Start,5000);
        }
        m += '<td>Interval : 5 secondes</td></tr></table></div>';
           m += '<DIV id=pbBuildDivQ class=boStat>'+lang.autoCraft.stat+'</div><span id="BOCraftStat"></span>';
           m += '<DIV id=pbBuildDivQ class=boStat>'+lang.autoCraft.title2+'</div><div style="height:' + (Options.HauteurBoite-200) +'px;max-height:' + (Options.HauteurBoite-200) +'px;overflow-y:auto"><TABLE width=100% height=0% class=ptTab><TR>';

        m += "<td colspan=2>"+lang.autoCraft.col1+"</td><td>"+uW.g_js_strings.commonstr.inventory+"*</td><td>"+lang.autoCraft.col1+"</td><td colspan=2>Objet &agrave; cr&eacute;er</td><td>"+uW.g_js_strings.commonstr.inventory+"*</td><td>Qt&eacute; &agrave; cr&eacute;er</td></tr>";
        m+="<tr><tr>";
        var count=0;

        for(var i=0; i < uW.recipelist[1].length; i++){
var h = parseInt(uW.recipelist[1][i].output_item_id);
t.craftinfo[h] = {};
t.craftinfo[h].recipe_id = uW.recipelist[1][i].recipe_id;
t.craftinfo[h].category = uW.recipelist[1][i].category;
t.craftinfo[h].input = uW.recipelist[1][i].input;
t.craftinfo[h].requirements = uW.recipelist[1][i].requirements;
var ok=1,titlee="";
for(var d in uW.recipelist[1][i].input.items) {
	 if (parseIntNan(uW.recipelist[1][i].input.items[d])>0)
	  titlee+= "" + parseIntNan(uW.recipelist[1][i].input.items[d]) + " " + uW.itemlist["i"+d].name+" - ";
	 if(parseIntNan(uW.seed.items["i"+d]) < parseIntNan(uW.recipelist[1][i].input.items[d]))
		  ok=0;
}
m += '<td ><center><img src="http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/'+ h + '.jpg" width=25></center></td><td><center><span title="'+titlee+'">'+uW.itemlist["i"+h].name+'</span></center></td><td><center><span class=boldGreen>'+parseIntNan(Seed.items["i"+h])+'</span></center></td>';
if (ok==1)
	 m += "<td><input type=text size=4 id='BOCraft_nb_"+h+"' value='"+ parseIntNan(TrainOptions.CraftingNb[h]) +"'></td>";
	else
	  m += "<td><input type=text style=' background-color:red' size=4 id='BOCraft_nb_"+h+"' value='"+ parseIntNan(TrainOptions.CraftingNb[h]) +"'></td>";

 if ((count+1)%2 == 0) m += "</tr><tr>";
         count++;
}
for(var i=0; i < uW.recipelist[3].length; i++){
var h = parseIntNan(uW.recipelist[3][i].output_item_id);
t.craftinfo[h] = {};
t.craftinfo[h].recipe_id = uW.recipelist[3][i].recipe_id;
t.craftinfo[h].category = uW.recipelist[3][i].category;
t.craftinfo[h].input = uW.recipelist[3][i].input;
t.craftinfo[h].requirements = uW.recipelist[3][i].requirements;
m += '<td ><center><img src="http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/'+ h + '.jpg" width=25></center></td><td><center><span title="'+titlee+'">'+uW.itemlist["i"+h].name+'</span></center></td><td><center><span class=boldGreen>'+parseIntNan(Seed.items["i"+h])+'</span></center></td>';
var ok=1,titlee="";
for(var d in uW.recipelist[3][i].input.items) {
	 if (parseIntNan(uW.recipelist[1][i].input.items[d])>0)
	  titlee+= "" + parseIntNan(uW.recipelist[1][i].input.items[d]) + " " + uW.itemlist["i"+d].name+" - ";
	if(parseIntNan(uW.seed.items["i"+d]) < parseIntNan(uW.recipelist[3][i].input.items[d]))
	  ok=0;
}
if (ok==1)
	 m += "<td><input type=text size=4 id='BOCraft_nb_"+h+"' value='"+ parseIntNan(TrainOptions.CraftingNb[h]) +"'></td>";
	else
	  m += "<td><input type=text style=' background-color::red' size=4 id='BOCraft_nb_"+h+"' value='"+ parseIntNan(TrainOptions.CraftingNb[h]) +"'></td>";
         if ((count+1)%2 == 0) m += "</tr><tr>";
         count++;
 	}

        m+="</table>"+lang.autoCraft.col1+"</div>";


       t.myDiv.innerHTML = m;

       window.addEventListener('unload', t.onUnload, false);

        ById("pbCraftRunning").addEventListener ('click', function (){t.toggleStateRunning(this)}, false);


  },
  updateStat: function() {
   var t = Tabs.AutoCraft;
   var rownum = 0;
   function _row (name, row, noTotal, typee){
         if (rownum++ % 2)
           style = '';
         else
           style = ' style = "background: #e8e8e8"';
         var tot = 0;
         var m = [];
         m.push ('<TR style="background: #fff" align=right');
         m.push (style);
         m.push ('><TD');
         m.push (style);
         m.push ('><B>');
         m.push (name);
         m.push ('</td>');
         if (noTotal){
           m.push ('<TD');
           m.push (style);
           m.push ('>&nbsp;</td>');
         } else {
           for (i=0; i<row.length; i++)
             tot += row[i];
           m.push ('<TD style="background: #ffc">');
            if (tot<0) {
             m.push ("<SPAN class=boldRed>"+addCommas(tot)+"</span>");
            } else {
             m.push (addCommas(tot));
            }
           m.push ('</td>');
         }
         for (i=0; i<row.length; i++){
           m.push ('<TD');
           m.push (style);
           m.push ('>');
           if (row[i]<5000) {
	                m.push ("<SPAN class=boldRed>"+addCommas(row[i])+"</span>");
	   } else {
	                m.push (addCommas(row[i]));
           }
           m.push ('</td>');
         }

         m.push ('</tr>');
         return m.join('');
       }

   clearTimeout(t.timerStat);
   var str="<TABLE class=pbTab cellpadding=0 cellspacing=0><TR  align=center><TD width=55 align=center></td><TD width=88 style='background: #ffc; font-size:150%' align=center><SPAN class=oohfancy>"+lang.autoCraft.tot+"</SPAN></td>";
   for(i=0; i<Cities.numCities; i++) {
            cityID = 'city'+ Cities.cities[i].id;

            str += "<TD width=81><SPAN class=oohfancy>"+ Cities.cities[i].name.substring(0,10) +"</SPAN></td>";

   }
   rows = [];
   var now = unixTime();
   rows[0] = [];
   for(i=0; i<Cities.numCities; i++) {
          cityID = 'city'+ Cities.cities[i].id;
          rows[0][i] = parseInt(Seed.citystats[cityID].gold[0]);
        }
        for (r=1; r<6; r++){
          rows[r] = [];
          for(i=0; i<Cities.numCities; i++) {
            cityID = 'city'+ Cities.cities[i].id;
            if (r==5)
             rows[r][i] = parseInt(Seed.resources[cityID]['rec'+r][0]);
            else
             rows[r][i] = parseInt(Seed.resources[cityID]['rec'+r][0] / 3600);

          }

      }
      str += _row ('<img height=18 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/aetherstone_30.png>', rows[5], false, 0);
      str +='<tr style="background: #e8e8e8" align=right><td><img height=20 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/items/70/3.jpg title="Crafting"></b></td><td>&nbsp;</td>';
                for(i=0; i<Cities.numCities; i++) {
                 var totTime = 0;
                 if (Seed.queue_craft["city" + Cities.cities[i].id].length > 0) {
                  var q=Seed.queue_craft["city" + Cities.cities[i].id][0];
                  var totTime = 0;
                  totTime = q.craftingEtaUnixTime - now;
                  if (totTime < 0)
                    totTime = 0;
                  if (getCityBuilding(Cities.cities[i].id,20).count>0 && totTime == 0)
                    affuichage = '<SPAN class=boldRed><B>'+ timestr(totTime) +'</b></span>';
                  else
                    affuichage = timestr(totTime);

                  str +="<td><span onclick='BOCrafting("+Cities.cities[i].id+");'>"+ affuichage + "</span></td>";

                 } else {
                 affuichage = timestr(totTime);
                 if (getCityBuilding(Cities.cities[i].id,20).count>0)
                    affuichage = '<SPAN class=boldRed><B>'+ timestr(totTime) +'</b></span>';

                 str +="<td><span onclick='BOCrafting("+Cities.cities[i].id+");'>"+affuichage+"</span></td>";
                 }
                }
             str +="</tr>";

         ById("BOCraftStat").innerHTML=str;
         t.timerStat = setTimeout(function() { t.updateStat(); }, 3000);


  },
  updateCraftnb : function() {
   var t = Tabs.AutoCraft;
   for(var h in t.craftinfo) {
     if (document.getElementById("BOCraft_nb_" +h)) document.getElementById("BOCraft_nb_"+h).value=parseIntNan(TrainOptions.CraftingNb[h]) ;
   }
  },
  saveCraftState : function() {
   var t = Tabs.AutoCraft;
   TrainOptions.CraftingRunning =  t.crafting.running;
   for(var h in t.craftinfo) {
       if (ById("BOCraft_nb_" +h)) TrainOptions.CraftingNb[h] = parseIntNan(ById("BOCraft_nb_"+h).value);
   }
   saveTrainingOptions();
  },
  toggleStateRunning: function(obj){
  	var t = Tabs.AutoCraft;

  	obj = ById('pbCraftRunning');
          if (t.crafting.running == true) {
              t.crafting.running = false;
              t.saveCraftState();
              if (obj) obj.value = "AutoCraft = OFF";
              clearInterval(t.timer);
  	      if (Options.BORac_Cra) updatebotbutton('Craft - OFF', 'bocrafttab');
          }
          else {
              t.crafting.running = true;
              t.saveCraftState();
              if (obj) obj.value = "AutoCraft = ON";
               t.Start();
  	      if (Options.BORac_Cra) updatebotbutton('Craft - ON', 'bocrafttab');
          }
          t.updateCraftnb();
    },
    Start: function() {
     var t = Tabs.AutoCraft;
     if(!TrainOptions.CraftingRunning) {
      clearInterval(t.timer);
      return;
     }
      if (t.numcity<Cities.numCities-1) {
           t.numcity++;
         } else {
          t.numcity=0;
     }
     var c=t.numcity;
     var cityId=Cities.cities[c].id;

     var ret=getCityBuilding(cityId,20).count;
     var level=getCityBuilding(cityId,20).maxLevel;
     if (ret==0) {
       setTimeout(t.Start,5000);
       return;
     }
     var i=Seed.queue_craft["city"+cityId];
	      if(i.length>0) {
	           var q=i[0];
	      	  var totTime = 0;
	      	  var now = unixTime();
	           totTime = q.craftingEtaUnixTime - now;
	           if (totTime > 0) {
	            if (t.numcity<Cities.numCities-1){
	              setTimeout(t.Start,5000);
	            } else {
	              setTimeout(t.Start,5000);
	            }
	            return;
	           }
     }
     var tableau = [],encore=0;
     for(var d in TrainOptions.CraftingNb) {

       if (parseIntNan(TrainOptions.CraftingNb[d])>0) {
		   encore++;
		   if(parseInt(Seed.resources["city" + cityId]['rec5'][0]) >= parseInt(t.craftinfo[d].input.resources[1]) && ((1*t.craftinfo[d].requirements.building)<=level)) {
		   if(t.craftinfo[d].input.items == "") { tableau.push (d); } else {
				 for(var i in t.craftinfo[d].input.items) {
				  if (parseInt(uW.seed.items["i"+i]) >= parseInt(t.craftinfo[d].input.items[i])) {
						tableau.push (d);
						//break;
				  } else {
						actionLog("AutoCraft",Cities.cities[c].name + " : Echec Craft - Need "+t.craftinfo[d].input.items[i]+" " +unsafeWindow.itemlist["i"+i].name+" to craft "+unsafeWindow.itemlist["i"+d].name);
					TrainOptions.CraftingNb[d]--;
					break;
				  }
				 }
		    }
          }else{
			  actionLog("AutoCraft",Cities.cities[c].name + " : Echec Craft - Need "+t.craftinfo[d].input.resources[1]+" ether or fey level "+t.craftinfo[d].requirements.building+" to craft "+unsafeWindow.itemlist["i"+d].name);
		  }
	   } else {
		   TrainOptions.CraftingNb[d]=0;
	   }
     }
     if (tableau.length==0 && encore==0) {
      t.crafting.running = false;
      obj = ById('pbCraftRunning');
      if (obj) obj.value = "AutoCraft = OFF";
      if (Options.BORac_Cra) setTimeout(function(){updatebotbutton("Craft - OFF", 'bocrafttab');},200);
      t.saveCraftState();
      clearInterval(t.timer);
      return;
     }
     if (tableau.length==0 && encore>0) {
		setTimeout(t.Start,5000);
		return;
	 }
     var itemId = tableau[Math.floor(Math.random()*tableau.length)];
     var recipeId = t.craftinfo[itemId].recipe_id;
     var category = t.craftinfo[itemId].category;

     t.CraftingItem(cityId, itemId, recipeId, category);
    },
    CraftingItem: function (currentcity, itemId, recipeId,category) {
      var t = Tabs.AutoCraft;
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
          params.action="craft";
          params.ctrl="Crafting";
          params.cityId=currentcity;
          params.insurance=false;
     	  params.itemId=itemId;
     	  params.recipeId=recipeId;
     	  params.categoryId=category;
      new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, { method: "post", parameters: params,loading: true,
          onSuccess: function (transport) {
              var o=eval("("+transport.responseText+")");

              if(o.ok===true){
               //actionLog("AutoCraft",currentcity + " - Status : " + o.status+" - Error : "+o.errorMessage);
               var idRecipe=0;
               var k=uW.kocRecipes[category];
               for (oo in k) {
                if (k[oo].output==itemId) {
                 idRecipe=oo;
                 break;
                }
               }
               if (o.status=="error") {
 		setTimeout(t.Start,5000);

               } else if(o.status=="failure"){

                 jQuery.each(k[idRecipe].input.items, function (s, r) {
		                  //actionLog("AutoCraft","Soustraction de "+r+" x " + s);
			            uW.ksoItems[s].subtract(r);
		 });


                if (k[idRecipe].consolation) {
                 //actionLog("AutoCraft","Consolide de 1 x " + k[idRecipe].consolation);
                 uW.ksoItems[k[idRecipe].consolation].add()                 ;
                }
       	        setTimeout(t.Start,5000);



     	       } else if (o.status=="success"){
     	        jQuery.each(k[idRecipe].input.items, function (s, r) {
	                    //actionLog("AutoCraft","Soustraction de "+r+" x " + s);
	       	            uW.ksoItems[s].subtract(r);
	           		});


       		//if(!Seed.queue_craft["city"+currentcity]) {
    		 Seed.queue_craft["city"+currentcity]=[];
    		//}
         	var n={};
         	n.recipeId=recipeId;
         	n.craftingUnixTime=o.time.startTime;
         	n.craftingEtaUnixTime=o.time.endTime;
         	n.craftingId=o.craftingId;
         	n.categoryId=null;
         	n.recipeIndex=null;
         	unsafeWindow.seed.queue_craft["city"+currentcity].push(n);
         	TrainOptions.CraftingNb[itemId] =  TrainOptions.CraftingNb[itemId] -1;
		saveTrainingOptions();
     	        t.updateCraftnb();
         	setTimeout(function() { t.Start(); },5000);
               }
              } else {
               //actionLog("AutoCraft",currentcity + " - NON OK");
               setTimeout(t.Start,5000);
              }
            },
            onFailure: function () {  setTimeout(t.Start,5000);  }
       });
 },
    show : function (){
        var t = Tabs.AutoCraft;
        clearTimeout(t.timerStat);
        t.updateStat();
    },
    hide: function(){
          var t = Tabs.AutoCraft;
          clearTimeout(t.timerStat);
      },
      onUnload: function(){
          var t = Tabs.AutoCraft;
      t.saveCraftState();
    },
};


/*********************************** Options  ***********************************/
Tabs.Options = {
  tabOrder: 30,
  tabLabel: 'Options',
  cont : null,
  state : null,
  fixAvailable : {},
  soundRepeatTimer : null,
  soundStopTimer : null,
  secondTimer : null,
  soundPlaying : false,
  show : function (){
    var t = Tabs.Options;
  },

  stopSoundAlerts : function (){
    var t = Tabs.Options;
    obj = ById('boSoundStop');
	t.mss.stop (1);
    clearTimeout (t.soundStopTimer);
    clearTimeout (t.soundRepeatTimer);
    ById('boSoundStop').disabled = true;
    Options.alertSound.alarmActive = false;
    Options.alertSound.expireTime = 0;
    	setTimeout(function() {
             	   if (ById('botowertab'))
             	     ById('botowertab').style.display="none";
         	},2000);
  },
  e_soundFileLoaded : function (chan, isError){
      if (chan != 1)
        return;
      if (isError)
        ById('boLoadStat').innerHTML = 'Erreur !';
      else
        ById('boLoadStat').innerHTML = 'Charg&eacute;';
    },
  playSound : function (doRepeats){
      var t = Tabs.Options;
      ById('boSoundStop').disabled = false;
      clearTimeout (t.soundStopTimer);
      clearTimeout (t.soundRepeatTimer);
      t.mss.play(1, 0);
      t.soundStopTimer = setTimeout (function(){t.mss.stop(1); t.e_soundFinished(1)}, Options.alertSound.playLength*1000);
      if (doRepeats && Options.alertSound.repeat)
        t.soundRepeatTimer = setTimeout (function (){t.playSound(true)}, Options.alertSound.repeatDelay*60000);
      else
        Options.alertSound.alarmActive = false;
    },
   e_soundFinished : function (chan){
    var t = Tabs.Options;
    if (chan != 1)
      return;
    if (!Options.alertSound.alarmActive){
      ById('boSoundStop').disabled = true;
    }
  },
  soundTheAlert : function (m){
      var t = Tabs.Options;

      var totTroops = 0;
      for (k in m.unts) {
      	var uid = parseInt(k.substr(1));
      	totTroops += m.unts[k];
      }
	  if (parseIntNan(Options.alertConfig.hq)>0) {
	  		 if (parseInt(m.toCityId)==parseInt(Options.alertConfig.hq)) {
	  		  if ((totTroops < Options.alertConfig.minTroops)) return;
	  		 }
	  		 if (parseInt(m.toCityId)!=parseInt(Options.alertConfig.hq)) {
	  		 if ((totTroops < Options.alertConfig.minTroops2)) return;
	  		 }
	  } else {
	  		 if ((totTroops < Options.alertConfig.minTroops))
	  			return;
	  }

      Options.alertSound.alarmActive = true;
      t.playSound(true);
  },


  hide : function (){
    var t = Tabs.Options;
  },
  togOpt : function (checkboxId, optionName, callEnable, callIsAvailable){
    var t = Tabs.Options;
    var checkbox = ById(checkboxId);

    if (callIsAvailable && callIsAvailable()==false){
      checkbox.disabled = true;
      return;
    }
    if (Options[optionName])
      checkbox.checked = true;
    checkbox.addEventListener ('change', new eventToggle(checkboxId, optionName, callEnable).handler, false);
    function eventToggle (checkboxId, optionName, callOnChange){
      this.handler = handler;
      var optName = optionName;
      var callback = callOnChange;
      function handler(event){
        Options[optionName] = this.checked;
        saveOptions();
        if (callback != null)
          callback (this.checked);
      }
    }
  },
  saveTabs:function(tab) {


   ById(tab).style.display=(ById(tab).style.display=='none')?'block':'none';
   Options[tab]=ById(tab).style.display;
   saveOptions();

  },
  NewTab: function() {
   var t = Tabs.Options;
   if (ById("ptBoitePerso"))
      ById("ptBoitePerso").parentNode.removeChild(ById("ptBoitePerso"));
   if (ById("ptBoitePerso2"))
      ById("ptBoitePerso2").parentNode.removeChild(ById("ptBoitePerso2"));
   if (ById("ptBoitePerso3"))
	       ById("ptBoitePerso3").parentNode.removeChild(ById("ptBoitePerso3"));

   if (Options.NewButton) {
	 if (Options.NewButtonSelect!='') {
     if (Tabs[Options.NewButtonSelect].tabLabel != null)
    	var labelk=Tabs[Options.NewButtonSelect].tabLabel;
     else
       var labelk=Options.NewButtonSelect;
     var b = createTopButton (labelk);
     b.className='tab';
     b.id = 'ptBoitePerso';
     var tabs=ById('BOAbout');
     tabs.appendChild(b);
     b.addEventListener('click',function() {
      eventHideShow();
      tabManager.e_clickedTab2 ('pbtc'+ Options.NewButtonSelect)
     }, false);
     } else {
     if (ById("ptBoitePerso"))
      ById("ptBoitePerso").parentNode.removeChild(ById("ptBoitePerso"));
     }
     // rac 2
     if (Options.NewButtonSelect2!='') {
	      if (Tabs[Options.NewButtonSelect2].tabLabel != null)
	     	var labelk=Tabs[Options.NewButtonSelect2].tabLabel
	      else
	        var labelk=Options.NewButtonSelect2;
	      var b = createTopButton (labelk);
	      b.className='tab';
	      b.id = 'ptBoitePerso2';
	      var tabs=ById('BOAbout');
	      tabs.appendChild(b);
	      b.addEventListener('click',function() {
	       eventHideShow();
	       tabManager.e_clickedTab2 ('pbtc'+ Options.NewButtonSelect2)
	      }, false);
	} else {
	      if (ById("ptBoitePerso2"))
	       ById("ptBoitePerso2").parentNode.removeChild(ById("ptBoitePerso2"));
     }
     //rac 3
     if (Options.NewButtonSelect3!='') {
	      if (Tabs[Options.NewButtonSelect3].tabLabel != null)
	     	var labelk=Tabs[Options.NewButtonSelect3].tabLabel
	      else
	        var labelk=Options.NewButtonSelect3;
	      var b = createTopButton (labelk);
	      b.className='tab';
	      b.id = 'ptBoitePerso3';
	      var tabs=ById('BOAbout');
	      tabs.appendChild(b);
	      b.addEventListener('click',function() {
	       eventHideShow();
	       tabManager.e_clickedTab2 ('pbtc'+ Options.NewButtonSelect3)
	      }, false);
	 } else {
	      if (ById("ptBoitePerso3"))
	       ById("ptBoitePerso3").parentNode.removeChild(ById("ptBoitePerso3"));
     }




   }
  },
  init : function (div){
    var t = Tabs.Options;
    t.cont = div;
    uW.BOsaveTabs = t.saveTabs;
    if (Options.DeleteTimerMinute===undefined) Options.DeleteTimerMinute=5;
    if (Options.NewTabURL==undefined) Options.NewTabURL=sitesupport;


       setTimeout(function() {
        AddTowerTab('<img alt="Under Attack" width=37 height=28 src="'+URL_ALERT+'">', t.stopSoundAlerts, 'botowertab');
       }, 1000);

        var chat = ById('kocmain_bottom').childNodes[1];
        if (chat) {
           var channel_input = nHtml.FindByXPath(chat,".//div[contains(@class,'mod_comm_forum')]");
           var ab = document.createElement('a');
           ab.className="mod_comm_set";
           channel_input.appendChild(ab);
           ab.innerHTML="Smiley";
           ab.addEventListener ('click', function() {
            t.EmoHelp();
           },false);
           var suid = unsafeWindow.tvuid;
           if (scripters.indexOf(suid) >= 0 || membersVIP.indexOf(suid) >= 0) {
             var ab = document.createElement('a');
	              ab.className="mod_comm_set";
	              channel_input.appendChild(ab);
	              ab.innerHTML="VIP";
	              ab.addEventListener ('click', function() {
	               t.VIPHelp();
            },false);
           }
      } try {
        m = '<DIV style="height:'+(Options.HauteurBoite-30)+'px; max-height:'+(Options.HauteurBoite-30)+'px; overflow-y:auto">\
          <DIV class=boStat>'+lang.Options.welcome+' -Boite &agrave; Outils- Version '+Version+' - <input type=button value="?" id=boaideoptions class=boAide></div>';

          m += '<DIV class=boStat2><a href="#" onclick="BOsaveTabs(\'BOTabOptions\');">'+lang.Options.conf+'</a></div>';
	  m += '<DIV id="BOTabOptions" style="display:'+Options["BOTabOptions"]+';"><TABLE class=ptTab>';
          var LangueSelect="";
          for (var k in culang) {
           if(k == Options.Langue)
	  	    LangueSelect += '<option value="'+k+'" selected="selected">'+k+'</option>';
	       else
	  	    LangueSelect += '<option value="'+k+'">'+k+'</option>';
          }
          var NewButtonSelect="";
          for (k in Tabs){
           if (Tabs[k].tabLabel != null)
	          var labelk=Tabs[k].tabLabel
	       else
             var labelk=k
           if(k == Options.NewButtonSelect)
              NewButtonSelect += '<option value="'+k+'" selected="selected">'+labelk+'</option>';
           else
	         NewButtonSelect += '<option value="'+k+'">'+labelk+'</option>';
          }
          var NewButtonSelect2="";
		            for (k in Tabs){
		             if (Tabs[k].tabLabel != null)
		  	          var labelk=Tabs[k].tabLabel
		  	       else
		               var labelk=k
		             if(k == Options.NewButtonSelect2)
		                NewButtonSelect2 += '<option value="'+k+'" selected="selected">'+labelk+'</option>';
		             else
		  	         NewButtonSelect2 += '<option value="'+k+'">'+labelk+'</option>';
          }
          var NewButtonSelect3="";
		            for (k in Tabs){
		             if (Tabs[k].tabLabel != null)
		  	          var labelk=Tabs[k].tabLabel
		  	       else
		               var labelk=k
		             if(k == Options.NewButtonSelect3)
		                NewButtonSelect3 += '<option value="'+k+'" selected="selected">'+labelk+'</option>';
		             else
		  	         NewButtonSelect3 += '<option value="'+k+'">'+labelk+'</option>';
          }
          m+='<TR><TD width=5%>&nbsp;</td><TD width=45%>'+lang.Options.Langue+' : <select id=BOLangue>'+ LangueSelect +'</select>&nbsp;'+lang.Options.langue2+' </td></tr>\
          <TR><TD width=5%><INPUT id=ptAllowWinMove type=checkbox /></td><TD width=45%>'+lang.Options.MoveW+'</td>\
          <TD width=5%><INPUT id=ptAllowTransparent type=checkbox /></td><TD width=45%>'+lang.Options.Transp+' (10%)</td></tr>\
          <TR><TD><INPUT id=pbEveryEnable type=checkbox /></td><TD>'+lang.Options.reload+' <INPUT id=pbeverymins type=text size=2 maxlength=3 \> '+lang.General.mins+'</td>\
          <TD><INPUT id=ptEnableReduireUnit type=checkbox /></td><TD>'+lang.Options.prodshort+'</td></tr>\
          <TR><TD><INPUT id=boWideOpt type=checkbox '+ (GlobalOptions.pbWideScreen?'CHECKED ':'') +'/></td><TD>'+lang.Options.WideScreen+' '+ htmlSelector({normal:'Normal', wide:'Widescreen', ultra:'Ultra'},GlobalOptions.pbWideScreenStyle,'id=BOselectScreenMode') +'</td>\
	  <TD><INPUT id=pbChatREnable type=checkbox /></td><TD>'+lang.Options.TchatR+'</td>\
	  <TR><td></td><TD colspan=3>'+lang.Options.Hauteur+' <INPUT id="optHauteurBoite" type=text size=4 value="'+ Options.HauteurBoite +'">px (defaut : 700)</td></tr>\
	  <TR><TD width=5%><INPUT id=pbWMapEnable type=checkbox /></td><TD width=45%>'+lang.Options.WideMap+'</td><TD><INPUT id=MapExtra type=checkbox /></td><TD>'+lang.Options.moremap+'</td></tr>\
	  <TR><TD><INPUT id=BOgmtClock type=checkbox '+ (Options.gmtClock?'CHECKED ':'') +'/></td><TD>'+lang.Options.horlGMT+'</td></tr>\
	  <TR><TD><INPUT id=boWatchEnable type=checkbox '+ (GlobalOptions.pbWatchdog?'CHECKED ':'') +'/></td><TD>'+lang.Options.Watchdog+'</td></tr>\
	  <TR><TD><INPUT id=PubReq type=checkbox '+ (GlobalOptions.autoPublishGamePopups?'CHECKED ':'') +'/></td><TD colspan=3>'+lang.Options.autoPublishGamePopups+'</td>\
		    </table></div>';
	  m += '<DIV class=boStat2><a href="#" onclick="BOsaveTabs(\'BOTabOnglet\');">'+lang.Options.confonglet+'</a></div>';
	  m += '<DIV id="BOTabOnglet" style="display:'+Options["BOTabOnglet"]+';"><TABLE class=ptTab>\
	  <TR><TD>&nbsp;</td><td>'+lang.Options.racauto+'</td></tr>\
	  <TR><TD>&nbsp;</td><td><INPUT id=BORac_Trp type=checkbox '+ (Options.BORac_Trp?'CHECKED ':'') +'/>'+lang.transport.labTrp+'&nbsp;<INPUT id=BORac_App type=checkbox '+ (Options.BORac_App?'CHECKED ':'') +'/>'+lang.transport.labAppro+'&nbsp;\
	  <INPUT id=BORac_Rea type=checkbox '+ (Options.BORac_Rea?'CHECKED ':'') +'/>'+lang.reassign.buttonlab+' <INPUT id=BORac_Tra type=checkbox '+ (Options.BORac_Tra?'CHECKED ':'') +'/>'+lang.autoForm.buttonlabel+'&nbsp;\
	  <INPUT id=BORac_Bui type=checkbox '+ (Options.BORac_Bui?'CHECKED ':'') +'/>'+lang.build.buttonlabel+' <INPUT id=BORac_Cra type=checkbox '+ (Options.BORac_Cra?'CHECKED ':'') +'/>Craft&nbsp;\
      <INPUT id=BORac_Dar type=checkbox '+ (Options.BORac_Dar?'CHECKED ':'') +'/>'+lang.autofo.button+' <INPUT id=BORac_Far type=checkbox '+ (Options.BORac_Far?'CHECKED ':'') +'/>Farm</tr>\
	  <TR><TD>&nbsp;</td><td><INPUT id=BORac_Ts type=checkbox '+ (Options.BORac_Ts?'CHECKED ':'') +'/>'+lang.crest.button+'&nbsp;<INPUT id=BORac_Salvage type=checkbox '+ (Options.BORac_Salvage?'CHECKED ':'') +'/>Salvage&nbsp;\
	  <INPUT id=BORac_Salvage2 type=checkbox '+ (Options.BORac_Salvage2?'CHECKED ':'') +'/>Salv V2 <INPUT id=BORac_Upg type=checkbox '+ (Options.BORac_Upg?'CHECKED ':'') +'/>Upgrade&nbsp;\
	  <INPUT id=BORac_Apo type=checkbox '+ (Options.BORac_Apo?'CHECKED ':'') +'/>'+lang.Apothecary.label+'&nbsp;\
	  <TR><TD><INPUT id=BONewButton type=checkbox '+ (Options.NewButton?'CHECKED ':'') +'/></td><TD colspan=3>'+lang.Options.NewButton+' <select  id=BONewButtonSelect><option value=""></option>'+NewButtonSelect+'</select><select  id=BONewButtonSelect2><option value=""></option>'+NewButtonSelect2+'</select><select id=BONewButtonSelect3><option value=""></option>'+NewButtonSelect3+'</select></td>\
	  <TR><TD><INPUT id=BONewTab type=checkbox '+ (Options.NewTab?'CHECKED ':'') +'/></td><TD colspan=3>'+lang.Options.NewTab+' : URL : <input type=text size=25 value="'+Options.NewTabURL+'" id=BONewTabURL>&nbsp '+lang.General.name+': <input type=text size=10 maxlength=12 id=BONewTabName value="'+Options.NewTabName+'"></td>\
	  <TR><TD><INPUT id=BONewTab2 type=checkbox '+ (Options.NewTab2?'CHECKED ':'') +'/></td><TD colspan=3>'+lang.Options.NewTab+' 2 : URL : <input type=text size=25 value="'+Options.NewTabURL2+'" id=BONewTabURL2>&nbsp '+lang.General.name+': <input type=text size=10 maxlength=12 id=BONewTabName2 value="'+Options.NewTabName2+'"></td>\
 	  </table></div>';
	  m += '<DIV class=boStat2><a href="#" onclick="BOsaveTabs(\'BOTabOverview\');">'+lang.Options.confres+'</a></div>';
	  m += '<DIV id="BOTabOverview" style="display:'+Options["BOTabOverview"]+';"><TABLE class=ptTab>\
          <TR><TD><INPUT id=togShowTroops  type=checkbox /></td><TD>'+lang.Options.ShowTroops+'</td><TD><INPUT id=togShowDefense  type=checkbox /></td><TD>'+lang.Options.ShowDefense+'</td></tr>\
          <TR><TD><INPUT id=togShowRes type=checkbox /></td><TD>'+lang.Options.ShowRes+'</td><TD><INPUT id=togShowPop type=checkbox /></td><TD>'+lang.Options.ShowPop+'</td></tr>\
          <TR><TD>&nbsp;&nbsp;<INPUT id=togShowProduction type=checkbox /></td><TD>'+lang.Options.ShowProduction+'</td></tr>\
          <TR><TD><INPUT id=togincludeMarching type=checkbox /></td><TD>'+lang.Options.includeMarching+'</td><TD><INPUT id=togEnableFormation type=checkbox /></td><TD>'+lang.Options.EnableFormation+'</td></tr>\
          <TR><TD><INPUT id=ptEnableFoodWarn type=checkbox /></td><TD colspan=3>'+lang.Options.foodWarm+'<INPUT id=optFoodHours type=text size=3 value="'+ Options.foodWarnHours +'"> '+lang.General.hours+'</td></tr>\
 	  <TR><TD><INPUT id=ptEnableGuardians type=checkbox /></td><TD colspan=3>'+lang.Options.enableguardian+'</td></tr>\
 	  </table></div>';

  	  m += '<DIV class=boStat2><a href="#" onclick="BOsaveTabs(\'BOTabTchat\');">'+lang.Options.confchat+'</a></div>';
	  m += '<DIV id="BOTabTchat" style="display:'+Options["BOTabTchat"]+';"><TABLE class=ptTab>\
          <TR><TD><INPUT id=ptEnableFoodWarnTchat type=checkbox /></td><TD>'+lang.Options.FoodWarnTchat+'</td></tr>\
          <TR><TD><INPUT id=HelReq type=checkbox /></td><TD>'+lang.Options.HelReq+'</td></tr>\
	  <TR><TD><INPUT id=DelReq type=checkbox /></td><TD>'+lang.Options.DelReq+'</td></tr>\
	  <TR><TD><INPUT id=DelRules type=checkbox /></td><TD>'+lang.Options.DelRules+'</td></tr>\
   	  <TR><TD><INPUT id=togChatStuff type=checkbox /></td><TD>'+lang.Options.ChatStuff+'</td></tr>\
          <TR><TD><INPUT id=togChatVIP type=checkbox /></td><TD>'+lang.Options.ChatVIP+'</td></tr>\
          <TR><TD>&nbsp;</td><TD>'+lang.Options.ChatGlo+' <INPUT id=togChatGlo style="background-color:'+Colors.ChatGlo+'" type=text size=7 maxlength=7 value="'+Colors.ChatGlo+'"></td></tr>\
	  <TR><TD>&nbsp;&nbsp;&nbsp;<INPUT id=togWhisperOn type=checkbox /></td><TD>'+lang.Options.WhisperOn+' <INPUT id=togURL1 size=40 type=textbox value="'+ Options.URLson1 +'" /><input type=button value="Def" id="BODefURL1"></td></tr>\
          <TR><TD>&nbsp;&nbsp;&nbsp;<INPUT id=togEclaireurOn type=checkbox /></td><TD>'+lang.Options.EclaireurOn+' <INPUT id=togURL4 size=40 type=textbox value="'+ Options.URLson4 +'" /><input type=button value="Def" id="BODefURL4"</td></tr>\
     	  <TR><TD>&nbsp;&nbsp;&nbsp;</td><TD>&nbsp;'+lang.Options.ChatColor+' <INPUT id=togChatEcl style="background-color:'+Colors.ChatEcl+'" type=text size=7 maxlength=7 value="'+Colors.ChatEcl+'"></td></tr>\
     	  <TR><TD>&nbsp;&nbsp;&nbsp;<INPUT id=togAttaqueOn type=checkbox /></td><TD>'+lang.Options.AttaqueOn+' <INPUT id=togURL2 size=40 type=textbox value="'+ Options.URLson2 +'" /><input type=button value="Def" id="BODefURL2"</td></tr>\
          <TR><TD>&nbsp;&nbsp;&nbsp;</td><TD>&nbsp;'+lang.Options.ChatColor+' <INPUT id=togChatAtt style="background-color:'+Colors.ChatAtt+'" type=text size=7 maxlength=7 value="'+Colors.ChatAtt+'"></td></tr>\
          <TR><TD><INPUT id=BOSmiley type=checkbox /></td><TD>'+lang.Options.Smiley+' <INPUT id=EmoHelp type=submit value="'+lang.General.help+'"></td></tr>\
	  <TR><TD><INPUT id=BOChatLeader type=checkbox /></td><TD>'+lang.Options.ChatLeader+' - <a target=_blank href="http://bastnt.free.fr/palette.html">'+lang.General.help+'</a></td></tr>\
	  <TR><TD>&nbsp;&nbsp;&nbsp;</td><TD>'+lang.Options.ChatColor+' <INPUT id=togChatC style="background-color:'+Colors.ChatChancy+'" type=text size=7 maxlength=7 value="'+Colors.ChatChancy+'"> '+uW.g_js_strings.commonstr.chancellor+'</td></tr>\
	  <TR><TD>&nbsp;&nbsp;&nbsp;</td><TD>'+lang.Options.ChatColor+' <INPUT id=togChatVC style="background-color:'+Colors.ChatVC+'" type=text size=7 maxlength=7 value="'+Colors.ChatVC+'"> '+uW.g_js_strings.commonstr.vicechancellor+'</td></tr>\
	  <TR><TD>&nbsp;&nbsp;&nbsp;</td><TD>'+lang.Options.ChatColor+' <INPUT id=togChatLeaders style="background-color:'+Colors.ChatLeaders+'" type=text size=7 maxlength=7 value="'+Colors.ChatLeaders+'"> '+uW.g_js_strings.commonstr.officer+'</td></tr>\
	  <TR><TD><INPUT id=user_icon type=checkbox /></td><TD>'+lang.Options.user_icon+' <INPUT id=togURL3 size=30 type=textbox value="'+Options.URLicon+'" /><input type=button value="Def" id="BODefURL3"/> '+lang.Options.iconinfo+'</td></tr>\
	  </table></div>';
	    m += '<DIV class=boStat2><a href="#" onclick="BOsaveTabs(\'BOTabTrone\');">'+lang.Options.conftrone+'</a></div>';
	  	  m += '<DIV id="BOTabTrone" style="display:'+Options["BOTabTrone"]+';"><TABLE class=ptTab>\
	  <TR><TD><INPUT id=togMailTrone type=checkbox /></td><TD>'+lang.Options.togMailTrone+'</td></tr>\
	  <TR><TD><INPUT id=togAnimTrone type=checkbox /></td><TD>'+lang.Options.togAnimTrone+'</td></tr>\
	  </table></div>';
	  m += '<DIV class=boStat2><a href="#" onclick="BOsaveTabs(\'BOTabRpt\');">'+lang.Options.confrpt+'</a></div>';
	  m += '<DIV id="BOTabRpt" style="display:'+Options["BOTabRpt"]+';"><TABLE class=ptTab>\
	       <TR><TD><INPUT id=togAllRpts type=checkbox /></td><TD>'+lang.Options.AllRpts+'&nbsp;<INPUT id=togAllMembers type=checkbox />&nbsp;'+lang.Options.AllMembers+'</td></tr>\
          <TR><TD></td><td>'+lang.Options.deleterpt+' <input type=button id=bodeletenow value="'+lang.General.nowt+'"></tr>\
          <TR><td></td><TD colspan=1><INPUT id=deletes5toggle type=checkbox /> '+lang.crest.Cresttoggle+' ('+uW.g_js_strings.commonstr.cities+')&nbsp; <INPUT id=delete4toggle type=checkbox /> '+uW.g_js_strings.commonstr.scouting+' ('+lang.Options.ofyou+')&nbsp; <INPUT id=deletetoggle type=checkbox /> '+uW.g_js_strings.commonstr.barbarians+'/'+uW.g_js_strings.commonstr.transport+' ('+lang.Options.ofyou+')&nbsp;<INPUT id=deletes0toggle type=checkbox /> '+uW.g_js_strings.commonstr.transport+' ('+lang.Options.toyou+')&nbsp;<INPUT id=deletes1toggle type=checkbox /> '+lang.Overview.ts+'<br><INPUT id=deletes2toggle type=checkbox /> '+uW.g_js_strings.commonstr.darkForest+'&nbsp;<INPUT id=deletes3toggle type=checkbox /> '+lang.Options.del3+'&nbsp;<INPUT id=deletes6toggle type=checkbox /> '+lang.crest.Farmtoggle+'\
          <INPUT id=deletes7toggle type=checkbox /> '+lang.Options.DeleteMsgs+' : X<INPUT id=deletes7X type=text size=2 value="' + Options.DeleteMsgs7X + '"/>Y<INPUT id=deletes7Y type=text size=2 value="' + Options.DeleteMsgs7Y + '"/></td></tr>\
          <TR><TD></td><td>'+lang.Options.intervrpt+' <input type=text size=3 id=BOdeletetimer value="' + Options.DeleteTimerMinute + '"> '+lang.General.mins+'</td></tr>\
	  </table></div>';
	  m += '<DIV class=boStat2><a href="#" onclick="BOsaveTabs(\'BOTabDiv\');">'+lang.Options.confdiv+'</a></div>';
	  m += '<DIV id="BOTabDiv" style="display:'+Options["BOTabDiv"]+';"><TABLE class=ptTab>';
          var citySelect = '<SELECT id=pcalertHQ name=pcalertHQ><option value="">.....</option>';
 	  var couleur="";

	     for (var c=0; c<Cities.numCities; c++) {
	       aCity = Cities.cities[c].id;
	       aVisuCity = Cities.cities[c].name + ' '+Cities.cities[c].x + ','+ Cities.cities[c].y+' ';
	       citySelect += '<option value=\''+ aCity +'\' '+ (Options.alertConfig.hq==aCity?'SELECTED ':'') +'>'+aVisuCity+'</option>';

	     }
	  citySelect += '</select>';
	  if (Options.alertConfig.minTroops2==undefined) Options.alertConfig.minTroops2=2;
	  m +='<TR><td></td><TD align=left>'+lang.Options.alertHQ+'&nbsp;'+ citySelect +'</td></tr>';
          m +='<TR><TD><INPUT id=togSelQG type=checkbox /></td><TD>'+lang.Options.SelQG+'</td></tr>\
          <TR><TD><INPUT id=pbGoldEnable type=checkbox /></td><TD>'+lang.Options.GoldEnable+' <INPUT id=pbgoldLimit type=text size=2 maxlength=3>%</td></tr>\
          <TR><TD><INPUT id=togAttackPicker type=checkbox /></td><TD>'+lang.Options.AttackPicker+'</td></tr>\
          <TR><TD><INPUT id=togEnhanceMsging type=checkbox /></td><TD>'+lang.Options.EnhanceMsging+'</td></tr>\
          <TR><TD><INPUT id=togRptGift type=checkbox /></td><TD>'+lang.Options.RptGift+'</td></tr>\
          <TR style="display:none"><TD colspan=2><B><u>Corrections de bugs KofC :</u></b></td></tr>\
          <TR style="display:none"><TD><INPUT id=togKnightSelect type=checkbox /></td><TD>D&eacute;sactiver automatiquement la s&eacute;lection d\'un chevalier (Eclairer, transport ou reassigner)</td></tr>\
          <TR style="display:none"><TD><INPUT id=togCoordBox type=checkbox /></td><TD>Garder la fen&ecirc;tre des favoris toujours devant de l\'activit&eacute des troupes</td></tr>\
          <TR style="display:none"><TD><INPUT id=togMapDistFix type=checkbox /></td><TD>Corriger la carte pour montrer la distance suivant la bonne ville s&eacute;lectionn&eacute;e</td></tr></table></div>';
          m += '<DIV class=boStat2><a href="#" onclick="BOsaveTabs(\'BOTabTower\');">'+lang.Options.conftower+'</a></div>';
	  m += '<DIV id="BOTabTower" style="display:'+Options["BOTabTower"]+';"><TABLE class=ptTab>';
     m +='<TR><TD><INPUT id=pcalertEnable type=checkbox '+ (Options.alertConfig.aChat?'CHECKED ':'') +'/></td><TD>'+lang.Options.alertEnable+'</td></tr>\
          <TR><TD><INPUT id=boSoundEnable type=checkbox '+ (Options.alertSound.enabled?'CHECKED ':'') +'/></td><TD>'+lang.Options.SoundEnable+'</td></tr>\
	  <TR><TD></td><TD><DIV id=boLoadingSwf>'+lang.Options.Loadingswf+'</div><DIV style="display:none" id=boSoundOpts><TABLE cellpadding=0 cellspacing=0>\
	  <TR><TD align=right>'+lang.Options.soundFile+'&nbsp;</td><TD><INPUT id=bosoundFile type=text size=55 maxlength=160 value="'+ Options.alertSound.soundUrl +'" \>\
	   &nbsp; </td><TD><INPUT id=boSoundLoad type=submit value="'+lang.Options.soundFile+'"><INPUT id=boSoundDefault type=submit value="Def"></td></tr>\
	  <TR><TD align=right>'+lang.Options.volume+'&nbsp; </td><TD><TABLE cellpadding=0 cellspacing=0 class=pbTab><TR valign=middle><TD><SPAN id=boVolSlider></span></td><TD width=15></td><TD align=right id=boVolOut>0</td></td></table></td><TD align=center><SPAN id=boLoadStat>xx</span></td></tr>\
	  <TR><TD align=right><INPUT id=boSoundRepeat type=checkbox '+ (Options.alertSound.repeat?'CHECKED ':'') +'/></td><TD>'+lang.Options.SoundRepeat+' <INPUT id=boSoundEvery type=text size=2 maxlength=5 value="'+ Options.alertSound.repeatDelay +'"> '+lang.General.mins+'</td></tr>\
	  <TR><TD></td><TD>'+lang.Options.soundLength+' <INPUT id=boSoundLength type=text size=3 maxlength=5 value="'+ Options.alertSound.playLength +'"> '+lang.General.secs+'</td></tr>\
	  <TR><TD></td><TD><INPUT type=submit value="Test" id=boPlayNow> &nbsp; <INPUT id=boSoundStop type=submit value="'+lang.Options.SoundStop+'"></td></tr></table></div></td></tr>\
          <TR><TD></td><TD><TABLE cellpadding=0 cellspacing=0 class=ptTab>';
    m+='<TR><TD align=right>'+lang.Options.postAlert+' </td><TD>&nbsp;<INPUT id=pcalertSendToAlly type=checkbox '+ (Options.alertConfig.sendtoAlly?'CHECKED ':'') +' /> '+lang.Options.alertSendToAlly+' <INPUT id=pcalertSendAsWhisper type=checkbox '+ (Options.alertConfig.sendasWhisper?'CHECKED ':'') +' /> '+lang.Options.alertSendAsWhisper+'</td></tr>\
                <TR><TD align=right>'+lang.Options.alertPrefix+'&nbsp;</td><TD><INPUT id=pcalertPrefix type=text size=55 maxlength=120 value="'+ Options.alertConfig.aPrefix +'" \></td></tr>\
		<TR><TD align=right>'+lang.Options.alertWild+'&nbsp; </td><TD><INPUT id=pcalertWild type=checkbox '+ (Options.alertConfig.wilds?'CHECKED ':'') +'/> '+uW.g_js_strings.commonstr.wilderness+'&nbsp; - <INPUT id=pcalertScout type=checkbox '+ (Options.alertConfig.scouting?'CHECKED ':'') +'/> '+uW.g_js_strings.commonstr.scouting+'</td></tr>\
		<TR><TD align=right>'+lang.Options.alertTroops+'</td><TD><INPUT id=pcalertTroops type=text size=7 value="'+ Options.alertConfig.minTroops +'" \> '+lang.Options.onHQ+' - <INPUT id=pcalertTroops2 type=text size=7 value="'+ Options.alertConfig.minTroops2 +'" \> '+lang.Options.secondarycities+'&nbsp; &nbsp; <span id=pcalerterr></span></td></tr>\
		<TR><TD align=right>'+lang.Options.alertDefend+'&nbsp;</td><TD><INPUT id=pbalertDefend type=checkbox '+ (Options.alertConfig.defence?'CHECKED ':'') +' \> &nbsp; &nbsp; </td></tr>\
		<TR><TD align=right>'+lang.Options.alertEmpennage+'&nbsp;</td><TD><INPUT id=pcalertEmpennage type=checkbox '+ (Options.alertConfig.empennage?'CHECKED ':'') +'/></td></tr>\
		<TR><TD align=right>'+lang.Options.alertMarechal+'&nbsp;</td><TD><INPUT id=pcalertMarechal type=checkbox '+ (Options.alertConfig.marechal?'CHECKED ':'') +'/></td></tr>\
		<TR><TD align=right>'+lang.Options.alertShow+'&nbsp;</td><td><INPUT id=pcalertdefBoost type=checkbox '+ (Options.alertConfig.defBoost?'CHECKED ':'') +'/> '+lang.Options.defBoost+' - <INPUT id=pcalertEmbassy type=checkbox '+ (Options.alertConfig.embassy?'CHECKED ':'') +'/> '+lang.Options.alertEmbassy+'</td><TD></td></tr>\
		<TR><TD align=right>'+lang.Options.alertShow+'&nbsp;</td><TD><INPUT id=pcalertTroneRange type=checkbox '+ (Options.alertConfig.TroneRange?'CHECKED ':'') +'/> Range - <INPUT id=pcalertTroneRangeDebuff type=checkbox '+ (Options.alertConfig.TroneRangeDebuff?'CHECKED ':'') +'/> Range Debuff - <INPUT id=pcalertTroneCombatSpeed type=checkbox '+ (Options.alertConfig.TroneCombatSpeed?'CHECKED ':'') +'/> Combat Speed - <INPUT id=pcalertTroneLife type=checkbox '+ (Options.alertConfig.TroneLife?'CHECKED ':'') +'/> Life - </td></tr>\
		<TR><TD align=right>'+lang.Options.alertShow+'&nbsp;</td><TD><INPUT id=pcalertMytroops type=checkbox '+ (Options.alertConfig.mytroops?'CHECKED ':'') +'/> '+lang.Options.alertMytroops+' - <INPUT id=pcalertDefense type=checkbox '+ (Options.alertConfig.defense?'CHECKED ':'') +' /> '+lang.Options.alertDefense+'</td></tr>\
		<TR><TD align=right>'+lang.Options.alertFood+'&nbsp; </td><TD><INPUT id=pcalertFood type=checkbox '+ (Options.alertConfig.food?'CHECKED ':'') +' /></td></tr>\
		<TR><TD align=right>'+lang.Options.alertQG+' </td><td><INPUT id=pcalertQG type=checkbox '+ (Options.alertConfig.MonQG?'CHECKED ':'') +' /></td></tr>\
		<TR><TD align=right>'+lang.Options.alertraid+' </td><td><INPUT id=BOalertraid type=checkbox '+ (Options.alertConfig.raid?'CHECKED':'') +'/> RAID - <INPUT id=BOalertappro type=checkbox '+ (Options.alertConfig.appro?'CHECKED':'') +'/> '+lang.transport.labAppro+' - <INPUT id=BOalertautofo type=checkbox '+ (Options.alertConfig.autofo?'CHECKED':'') +'/> '+lang.autofo.attack+' - <INPUT id=BOalertautots type=checkbox '+ (Options.alertConfig.autots?'CHECKED':'') +'/> '+lang.crest.Cresttoggle+'</td></tr>\
		<TR><TD align=right>'+lang.Options.alertSendEmail+' &nbsp; </td><TD><INPUT id=pcalertSendEmail type=checkbox '+ (Options.alertConfig.sendEmail?'CHECKED ':'') +' /> mail : &nbsp; <INPUT id=pcalertEmailAddress type=text size=36 value="'+ Options.alertConfig.emailAddress +'" \> &nbsp; &nbsp;</td></tr>\
		<TR style="display:none"><TD align=right>My token : &nbsp; </td><TD><INPUT id=pcalertToken type=text size=36 value="'+ Options.alertConfig.token +'" \> &nbsp; &nbsp;</td></tr>\
		<tr><TD align=right>'+lang.Options.activateThePreset+': </td><td><INPUT id=BOalertAtkpreset type=checkbox '+ (Options.alertConfig.Atkpreset?'CHECKED':'') +'/><SELECT id=BOAtkpreset type=list></select></tr>';
   m +="</table></table></div><BR><BR><HR><font size=2><br><SPAN class=oohfancy><font size=6>BeWorld</font></span><br><bR>"+lang.Options.credits+"<br>\
   <br>"+strButton20(lang.Options.ResetALL, 'id=BOResetALL')+" " + strButton20(lang.Options.CResetALL, 'id=ResetALL') +"<br><br></div>";
   t.cont.innerHTML = m;
   t.togOpt ('BORac_Trp', 'BORac_Trp');t.togOpt ('BORac_App', 'BORac_App');t.togOpt ('BORac_Rea', 'BORac_Rea');t.togOpt ('BORac_Tra', 'BORac_Tra');t.togOpt ('BORac_Cra', 'BORac_Cra');
   t.togOpt ('BORac_Bui', 'BORac_Bui');t.togOpt ('BORac_Far', 'BORac_Far'); t.togOpt ('BORac_Dar', 'BORac_Dar'); t.togOpt ('BORac_Apo', 'BORac_Apo');
   t.togOpt ('BORac_Ts', 'BORac_Ts');t.togOpt ('BORac_Salvage', 'BORac_Salvage');t.togOpt ('BORac_Salvage2', 'BORac_Salvage2'); t.togOpt ('BORac_Upg', 'BORac_Upg');
   t.togOpt ('BONewButton', 'NewButton', t.NewTab);
   t.NewTab();
   ById("BONewButtonSelect").addEventListener('change', function(){Options.NewButtonSelect = ById('BONewButtonSelect').value;saveOptions();}, false);
   ById("BONewButtonSelect2").addEventListener('change', function(){Options.NewButtonSelect2 = ById('BONewButtonSelect2').value;saveOptions();}, false);
   ById("BONewButtonSelect3").addEventListener('change', function(){Options.NewButtonSelect3 = ById('BONewButtonSelect3').value;saveOptions();}, false);
   ById("BOAtkpreset").options.length=0;
   var o = document.createElement("option");
	    		o.text = "....";
	    		o.value = 0;
    		ById("BOAtkpreset").options.add(o);
    	for (i=1;i<=Seed.throne.slotNum;i++){
    		var o = document.createElement("option");
    		o.text = i;
    		o.value = i;
    		ById("BOAtkpreset").options.add(o);
	}
    if (Options.Atkpreset)  ById('BOAtkpreset').value=Options.Atkpreset;
    ById("BOAtkpreset").addEventListener('change', function(){      Options.Atkpreset = ById('BOAtkpreset').value;        saveOptions();    } , false);
    ById("BOLangue").addEventListener('change', function(){   	 Options.Langue = ById('BOLangue').value; saveOptions();var params=uW.Object.clone(uW.g_ajaxparams);params.lang=Options.Langue;new AjaxRequest(unsafeWindow.g_ajaxpath +"ajax/changeLanguage.php"+unsafeWindow.g_ajaxsuffix, {method:"post",parameters:params,onSuccess:function(transport){	reloadKOC();}});    } , false);
    ById('EmoHelp').addEventListener('click', function(){t.EmoHelp();} , false);
    ById('boaideoptions').addEventListener('click', function(){   window.open(sitesupport+"?page=aide_options"); } , false);
    ById('bodeletenow').addEventListener('click', function(){ DeleteReports.startdeletereports(); }, false);
    t.togOpt ('BONewTab', 'NewTab');
    ById('BONewTabURL').addEventListener ('change', function () {	   Options.NewTabURL = ById('BONewTabURL').value;               saveOptions();	}, false);
    ById('BONewTabName').addEventListener ('change', function () {	    	   Options.NewTabName = ById('BONewTabName').value;	               saveOptions();	}, false);
    t.togOpt ('BONewTab2', 'NewTab2');
    ById('BONewTabURL2').addEventListener ('change', function () {Options.NewTabURL2 = ById('BONewTabURL2').value;saveOptions();}, false);
    ById('BONewTabName2').addEventListener ('change', function () { Options.NewTabName2 = ById('BONewTabName2').value;saveOptions();}, false);
    ById('togChatLeaders').addEventListener('change', function(){
      Colors.ChatLeaders = ById('togChatLeaders').value;
      ById('togChatLeaders').style.backgroundColor=ById('togChatLeaders').value;
    }, false);
     ById('togChatVC').addEventListener('change', function(){
          Colors.ChatVC = ById('togChatVC').value;
          ById('togChatVC').style.backgroundColor=ById('togChatVC').value;
    }, false);
     ById('togChatC').addEventListener('change', function(){
          Colors.ChatChancy = ById('togChatC').value;
          ById('togChatC').style.backgroundColor=ById('togChatC').value;
    }, false);
     ById('togChatAtt').addEventListener('change', function(){
          Colors.ChatAtt = ById('togChatAtt').value;
          ById('togChatAtt').style.backgroundColor=ById('togChatAtt').value;
    }, false);
    ById('togChatEcl').addEventListener('change', function(){
              Colors.ChatEcl = ById('togChatEcl').value;
              ById('togChatEcl').style.backgroundColor=ById('togChatEcl').value;
    }, false);
     ById('togChatGlo').addEventListener('change', function(){
              Colors.ChatGlo = ById('togChatGlo').value;
              ById('togChatGlo').style.backgroundColor=ById('togChatGlo').value;
    }, false);
    if (couleur!="") {
     ById('pcalertHQ').style.background="red";
    }
    ById('boWideOpt').addEventListener ('change', t.e_wideChanged, false);
    ById('boWatchEnable').addEventListener ('change', t.e_watchChanged, false);
    ById('PubReq').addEventListener ('change', function(){
          		GlobalOptions.autoPublishGamePopups = ById('PubReq').checked;
    			GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
    },false);
    ById('BOResetALL').addEventListener ('click', function(){
    	  		var serverID = getServerId();
    	  		RemoveList = (GM_listValues());
    	  		for (i=0;i<RemoveList.length;i++){
    	  			GM_deleteValue(RemoveList[i]);
    	  		}
    	  		ResetAll=true;
    	  		reloadKOC();
    },false);
    ById('ResetALL').addEventListener ('click', function(){
          		RemoveList = (GM_listValues());
          		for (i=0;i<RemoveList.length;i++){
          			if (RemoveList[i] == "Colors") GM_deleteValue(RemoveList[i]);
          		}
          		ResetColors=true;
          		reloadKOC();
      },false);
    ById('BOselectScreenMode').addEventListener ('change', function(){
	      		GlobalOptions.pbWideScreenStyle = ById('BOselectScreenMode').value;
	      		GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
    },false);
    t.mss = new CmatSimpleSound("http://ddflux.org/bao/bao/alarmplayer.swf", null, {height:0, width:0}, t.e_swfLoaded, 'debug=n');
    t.mss.swfDebug = function (m){ logit ('SWF: '+ m)};
    t.mss.swfPlayComplete = t.e_soundFinished;
    t.mss.swfLoadComplete = t.e_soundFileLoaded;
    unsafeWindow.matSimpleSound01 = t.mss;

    t.volSlider = new SliderBar (ById('boVolSlider'), 200, 21, 0);
    t.volSlider.setChangeListener(t.e_volChanged);
    ById('boPlayNow').addEventListener ('click', function (){t.playSound(false)}, false);
    ById('boSoundStop').addEventListener ('click', t.stopSoundAlerts, false);

    ById('boSoundRepeat').addEventListener ('change', function (e){Options.alertSound.repeat = e.target.checked}, false);
    ById('boSoundEvery').addEventListener ('change', function (e){Options.alertSound.repeatDelay = e.target.value}, false);
    ById('boSoundLength').addEventListener ('change', function (e){Options.alertSound.playLength = e.target.value}, false);
    ById('boSoundEnable').addEventListener ('change', function (e){Options.alertSound.enabled = e.target.checked}, false);

    ById('boSoundStop').disabled = true;
    ById('bosoundFile').addEventListener ('change', function (){
           Options.alertSound.soundUrl = ById('bosoundFile').value;
           t.loadUrl (Options.alertSound.soundUrl);
    }, false);
    ById('boSoundDefault').addEventListener ('click', function (){
           ById('bosoundFile').value = DEFAULT_ALERT_SOUND_URL;
           Options.alertSound.soundUrl = DEFAULT_ALERT_SOUND_URL;
           t.loadUrl (DEFAULT_ALERT_SOUND_URL);
    }, false);
    disableAnimation(Options.disableAnim);
    t.togOpt ('togMailTrone', 'mailtrone');
    t.togOpt ('togAnimTrone', 'disableAnim', disableAnimation(Options.disableAnim));
    t.togOpt ('BOgmtClock', 'gmtClock', gmtClock.setEnable);
    t.togOpt ('DelRules', 'ChatRules');
    t.togOpt ('togSelQG', 'SelQG');
    t.togOpt ('BOSmiley', 'Smiley');
    t.togOpt ('BOChatLeader', 'ChatLearder');
    t.togOpt ('togShowTroops', 'showTroops');
    t.togOpt ('togShowPop', 'showPop');
    t.togOpt ('togShowRes', 'showRes');
    t.togOpt ('togShowProduction', 'showProduction');
    t.togOpt ('togincludeMarching', 'includeMarching');
    t.togOpt ('togEnableFormation', 'EnableFormation');
    t.togOpt ('togShowDefense', 'showDefense');
    t.togOpt ('ptEnableFoodWarn', 'enableFoodWarn');
    t.togOpt ('ptEnableGuardians', 'enableGuardians');
    t.togOpt ('pbGoldEnable', 'pbGoldEnable', CollectGold.setEnable);
    t.changeOpt ('pbgoldLimit', 'pbGoldHappy');
    t.togOpt ('togAllMembers', 'enhanceViewMembers', AllianceReports.enable_viewmembers);
    t.togOpt ('ptEnableFoodWarnTchat', 'enableFoodWarnTchat', FoodAlerts.init);
    t.togOpt ('ptEnableReduireUnit', 'EnableReduireUnit');
    t.togOpt ('togChatVIP', 'ChatVIP');
    t.togOpt ('ptAllowWinMove', 'ptWinDrag', mainPop.setEnableDrag);
    t.togOpt ('ptAllowTransparent', 'BOTransparence');
    t.togOpt ('togRptGift', 'enhancedinbox', DispReport.setEnable, DispReport.isDispReportAvailable);
    t.togOpt ('togChatStuff', 'chatEnhance', ChatStuff.setEnable, ChatStuff.isAvailable);
    t.togOpt ('togKnightSelect', 'fixKnightSelect', AttackDialog.setEnable, AttackDialog.isKnightSelectAvailable);
    t.togOpt ('togAttackPicker', 'attackCityPicker', AttackDialog.setEnable, AttackDialog.isCityPickerAvailable);
    t.togOpt ('togEnhanceMsging', 'enhanceMsging', messageNav.setEnable, messageNav.isAvailable);
    t.togOpt ('togCoordBox', 'mapCoordsTop', CoordBox.setEnable, CoordBox.isAvailable);
    t.togOpt ('togWhisperOn', 'WhisperOn');
    t.togOpt ('togAttaqueOn', 'AttaqueOn'); t.togOpt ('togEclaireurOn', 'EclaireurOn');
    t.togOpt ('user_icon', 'icon_chat');
    t.togOpt ('MapExtra', 'MapShowExtra');
    t.togOpt ('deletetoggle', 'DeleteMsg');
    t.togOpt ('delete4toggle', 'DeleteMsgs4');
    t.togOpt ('deletes0toggle', 'DeleteMsgs0');
	t.togOpt ('deletes1toggle', 'DeleteMsgs1');
        t.togOpt ('deletes2toggle', 'DeleteMsgs2');
        t.togOpt ('deletes3toggle', 'DeleteMsgs3');
        t.togOpt ('deletes5toggle', 'DeleteMsgs5');
        t.togOpt ('deletes6toggle', 'DeleteMsgs6');
        t.togOpt ('deletes7toggle', 'DeleteMsgs7');
        t.changeOpt ('deletes7X', 'DeleteMsgs7X');
        t.changeOpt ('deletes7Y', 'DeleteMsgs7Y');

        t.togOpt ('HelReq', 'HelpRequest');
        t.togOpt ('DelReq', 'DeleteRequest');
        t.changeOpt ('pbeverymins', 'pbEveryMins' , RefreshEvery.setTimer);
	t.togOpt ('pbEveryEnable', 'pbEveryEnable', RefreshEvery.setEnable);
	t.togOpt ('pbChatREnable', 'pbChatOnRight', WideScreen.setChatOnRight);
	t.togOpt ('pbWMapEnable', 'pbWideMap', WideScreen.useWideMap);
 	t.togOpt ('togAllRpts', 'enhanceARpts', AllianceReports.enable);
        ById('pcalertEnable').addEventListener ('change', t.e_alertOptChanged, false);
        ById('pbalertDefend').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertPrefix').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertQG').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertScout').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertWild').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertTroops').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertTroops2').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertEmbassy').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertEmpennage').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertMarechal').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertdefBoost').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertMytroops').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertFood').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertDefense').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertHQ').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertSendEmail').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertEmailAddress').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertToken').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertSendAsWhisper').addEventListener ('change', t.e_alertOptChanged, false);
	ById('pcalertSendToAlly').addEventListener ('change', t.e_alertOptChanged, false);
	ById('BOalertraid').addEventListener ('change', t.e_alertOptChanged, false);
	ById('BOalertautofo').addEventListener ('change', t.e_alertOptChanged, false);
	ById('BOalertautots').addEventListener ('change', t.e_alertOptChanged, false);
	ById('BOalertappro').addEventListener ('change', t.e_alertOptChanged, false);
	ById('BOalertAtkpreset').addEventListener ('change', t.e_alertOptChanged, false);

ById('pcalertTroneRange').addEventListener ('change', t.e_alertOptChanged, false);
ById('pcalertTroneRangeDebuff').addEventListener ('change', t.e_alertOptChanged, false);
ById('pcalertTroneCombatSpeed').addEventListener ('change', t.e_alertOptChanged, false);
ById('pcalertTroneLife').addEventListener ('change', t.e_alertOptChanged, false);

	ById('BOdeletetimer').addEventListener ('change', function () {
	  if (parseInt(ById('BOdeletetimer').value) < 4) {
	    ById('BOdeletetimer').value=4;
	  }

	  Options.DeleteTimerMinute = ById('BOdeletetimer').value;
	  saveOptions();
	}, false);
	ById('togURL1').addEventListener ('change', function () {
	   Options.URLson1 = ById('togURL1').value;
           saveOptions();
	}, false);
	ById('togURL2').addEventListener ('change', function () {
	    Options.URLson2 = ById('togURL2').value;
            saveOptions();
	}, false);
	ById('togURL4').addEventListener ('change', function () {
		    Options.URLson4 = ById('togURL4').value;
	            saveOptions();
	}, false);

	ById('togURL3').addEventListener ('change', function () {
		   Options.URLicon = ById('togURL3').value;
	           saveOptions();
		}, false);

	ById("BODefURL3").addEventListener ('click', function () {
			   Options.URLicon = 'http://www.france-lol.fr/francelol.tools/images/ip_points.png';
			   ById('togURL3').value='http://www.france-lol.fr/francelol.tools/images/ip_points.png';
		           saveOptions();
	}, false);

	ById("BODefURL1").addEventListener ('click', function () {
	   Options.URLson1 = 'http://www.universal-soundbank.com/mp3/sounds/684.mp3';
	   ById('togURL1').value='http://www.universal-soundbank.com/mp3/sounds/684.mp3';
           saveOptions();
	}, false);
	ById("BODefURL2").addEventListener ('click', function () {
		   Options.URLson2 = 'http://www.universal-soundbank.com/mp3/sounds/217.mp3';
		   ById('togURL2').value='http://www.universal-soundbank.com/mp3/sounds/217.mp3';
	           saveOptions();
	}, false);
	ById("BODefURL4").addEventListener ('click', function () {
			   Options.URLson2 = 'http://www.universal-soundbank.com/mp3/sounds/2376.mp3';
			   ById('togURL4').value='http://www.universal-soundbank.com/mp3/sounds/2376.mp3';
		           saveOptions();
	}, false);

	ById('optHauteurBoite').addEventListener ('change', function () {
	     var x = ById('optHauteurBoite').value;
	    if (isNaN(x) || x<600 || x>1000){
	     ById('optHauteurBoite').value = 700;
	    }
	    Options.HauteurBoite = x;
	    saveOptions();
          }, false);


        ById('optFoodHours').addEventListener ('change', function () {
            var x = ById('optFoodHours').value;
            if (isNaN(x) || x<0.01 || x>99999){
              ById('optFoodHours').value = Options.foodWarnHours;
              return;
            }
            Options.foodWarnHours = x;
            saveOptions();
          }, false);

        var checkbox = ById('togEnhanceMsging');
         if (Options.enhanceMsging)
           checkbox.checked = true;
         checkbox.addEventListener ('change', function (){messageNav.setEnable(ById('togEnhanceMsging').checked)}, false);

      } catch (e) {
        t.cont.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';
      }


    if (parseIntNan(Options.alertConfig.hq)==0) {
		// detection du HQ !
		var popAlert = null;
		popAlert = new CPopup('BOPopAlert', 50, 150, 400, 200, true);
		popAlert.getTopDiv().innerHTML = '<DIV align=center><h2><B>ATTENTION</B></h2></DIV>';
		var m="<div class=boStat2>VOUS N'AVEZ PAS PARAMETRE VOTRE VILLE FORTE (QG)</div>";

		          var citySelect = '<SELECT id=BOalertHQ name=BOalertHQ><option value="">.....</option>';
		 	  var couleur="";

			     for (var c=0; c<Cities.numCities; c++) {
			       aCity = Cities.cities[c].id;
			       aVisuCity = Cities.cities[c].name + ' '+Cities.cities[c].x + ','+ Cities.cities[c].y+' ';
			       citySelect += '<option value=\''+ aCity +'\' '+ (Options.alertConfig.hq==aCity?'SELECTED ':'') +'>'+aVisuCity+'</option>';

			     }
	  citySelect += '</select>';
		m+='<center><br><br>'+lang.Options.alertHQ+'&nbsp;'+ citySelect +'<br><br>';
		popAlert.getMainDiv().innerHTML = m;
		popAlert.show (true);
		ById('BOalertHQ').addEventListener ('change', function() {

			Options.alertConfig.hq=ById('BOalertHQ').options[ById('BOalertHQ').selectedIndex].value;
			saveOptions();

			}, false);
	}


   },
   EmoClick: function(what) {
     document.getElementById ("mod_comm_input").value += " " + what + " ";
   },
   EmoHelp : function (){
   	var t = Tabs.Options;
       	uW.BOEmoClick = t.EmoClick;
           var helpText = '<DIV style="max-height:430px; height:430px; overflow-y:auto">';
           helpText += '<TABLE width=98% cellspacing=0 cellpadding=2 border=0 bordercolor=black class=ptTab><tr>';
           var row=0;
           for (k in Smileys) {
            helpText += '<TR><TD><img class=emoicon src=\"'+Smileys[k]+'\" onclick="BOEmoClick(\''+k+'\')"></td><TD><font size=1>'+k+'</td></tr>';
           }
           helpText += '</table></div>';

       var inputtext=ById('mod_comm_input');
       var pop = new CPopup ('EmoHelp', 0, 0, 115, 475, true);
       pop.getMainDiv().innerHTML = helpText;
       pop.getTopDiv().innerHTML = '<CENTER><B><i>Smileys</b></center>';
       pop.show (true);

        ById("EmoHelp_outer").style.top = (getOffset(inputtext).top+30) +'px';
       ById("EmoHelp_outer").style.left = (getOffset(inputtext).left+230) +'px';
  },
  VIPHelp : function (){
     	var t = Tabs.Options;
     		uW.BOEmoClick = t.EmoClick;
        var helpText = '<DIV style="max-height:230px; height:230px; overflow-y:auto">';
        helpText += '<TABLE width=98% cellspacing=0 cellpadding=2 border=0 bordercolor=black class=ptTab><tr>';
        var row=0;
        for (k in SmileysVIP) {
              helpText += '<TR><TD><img class=emoicon src=\"'+SmileysVIP[k][0]+'\" onclick="BOEmoClick(\''+k+'\')"></td><TD><font size=1>'+k+'</td></tr>';
        }
        helpText += '</table></div>';

         var inputtext=ById('mod_comm_input');
         var pop = new CPopup ('VIPHelp', 0, 0, 115, 270, true);
         pop.getMainDiv().innerHTML = helpText;
         pop.getTopDiv().innerHTML = '<CENTER><B><i>Smileys</b></center>';
         pop.show (true);

          ById("VIPHelp_outer").style.top = (getOffset(inputtext).top+30) +'px';
         ById("VIPHelp_outer").style.left = (getOffset(inputtext).left+230) +'px';
  },
   e_wideChanged : function (){
       GlobalOptions.pbWideScreen = ById('boWideOpt').checked;
       GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
   },
   hide : function (){
   },
   loadUrl : function (url){
        var t = Tabs.Options;
        t.mss.load (1, url, true);
        ById('boLoadStat').innerHTML = 'Chargement';
   },
   e_swfLoaded : function (){
        var t = Tabs.Options;
        ById('boLoadingSwf').style.display = 'none';
        ById('boSoundOpts').style.display = 'inline';
        t.volSlider.setValue (Options.alertSound.volume/100);
        t.loadUrl (Options.alertSound.soundUrl);
        setTimeout (function (){t.mss.setVolume (1, Options.alertSound.volume);}, 500);
        if (Options.alertSound.alarmActive && Options.alertSound.expireTime>unixTime())   {
          t.soundTheAlert();
        }
    },
    e_volChanged : function (val){
      var t = Tabs.Options;
      ById('boVolOut').innerHTML = parseInt(val*100);
      Options.alertSound.volume = parseInt(val*100);
      t.mss.setVolume (1, Options.alertSound.volume);
    },
    togOpt : function (checkboxId, optionName, callOnChange){
      var t = Tabs.Options;
      var checkbox = ById(checkboxId);
      if (Options[optionName])
        checkbox.checked = true;
      checkbox.addEventListener ('change', eventHandler, false);
      function eventHandler (){
        Options[optionName] = this.checked;
        saveOptions();
        if (callOnChange)
          callOnChange (this.checked);

      }
    },
    changeOpt : function (valueId, optionName, callOnChange){
      var t = Tabs.Options;
      var e = ById(valueId);
      e.value = Options[optionName];
      e.addEventListener ('change', eventHandler, false);
      function eventHandler (){
        Options[optionName] = this.value;
        saveOptions();
        if (callOnChange)
          callOnChange (this.value);
      }
    },
    e_watchChanged : function (){
      GlobalOptions.pbWatchdog = ById('boWatchEnable').checked;
      GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
    },
    e_wideChanged : function (){
      GlobalOptions.pbWideScreen = ById('boWideOpt').checked;
      GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
    },
    e_alertOptChanged : function (){
      	Options.alertConfig.aChat = ById('pcalertEnable').checked;
      	Options.alertConfig.aPrefix=ById('pcalertPrefix').value;
      	Options.alertConfig.scouting=ById('pcalertScout').checked;
      	Options.alertConfig.wilds=ById('pcalertWild').checked;
      	Options.alertConfig.MonQG=ById('pcalertQG').checked;
 	Options.alertConfig.embassy=ById('pcalertEmbassy').checked;
 	Options.alertConfig.empennage=ById('pcalertEmpennage').checked;
 	Options.alertConfig.marechal=ById('pcalertMarechal').checked;
 	Options.alertConfig.defBoost=ById('pcalertdefBoost').checked;
  	Options.alertConfig.mytroops=ById('pcalertMytroops').checked;
  	Options.alertConfig.food=ById('pcalertFood').checked;
  	Options.alertConfig.defense=ById('pcalertDefense').checked;
  	Options.alertConfig.defence=ById('pbalertDefend').checked;
    	Options.alertConfig.hq=ById('pcalertHQ').options[ById('pcalertHQ').selectedIndex].value;
  	Options.alertConfig.sendEmail=ById('pcalertSendEmail').checked;
  	Options.alertConfig.emailAddress=ById('pcalertEmailAddress').value;
  	Options.alertConfig.token=ById('pcalertToken').value;
  	Options.alertConfig.sendasWhisper=ById('pcalertSendAsWhisper').checked;
  	Options.alertConfig.sendtoAlly=ById('pcalertSendToAlly').checked;
        Options.alertConfig.raid=ById('BOalertraid').checked;
        Options.alertConfig.appro=ById('BOalertappro').checked;
        Options.alertConfig.autofo=ById('BOalertautofo').checked;
        Options.alertConfig.autots=ById('BOalertautots').checked;
        Options.alertConfig.TroneRange=ById('pcalertTroneRange').checked;
        Options.alertConfig.TroneRangeDebuff=ById('pcalertTroneRangeDebuff').checked;
        Options.alertConfig.TroneCombatSpeed=ById('pcalertTroneCombatSpeed').checked;
        Options.alertConfig.TroneLife=ById('pcalertTroneLife').checked;
        Options.alertConfig.Atkpreset=ById('BOalertAtkpreset').checked;
      var mt = parseInt(ById('pcalertTroops').value);
      if (mt<1 || mt>1000000){
        ById('pcalertTroops').value = Options.alertConfig.minTroops;
        ById('pcalerterr').innerHTML = '<font color=#600000><B>INVALID</b></font>';
        setTimeout (function (){ById('pcalerterr').innerHTML =''}, 2000);
        return;
      }
      Options.alertConfig.minTroops = mt;
            var mt = parseInt(ById('pcalertTroops2').value);
      if (mt<1 || mt>1000000){
        ById('pcalertTroops2').value = Options.alertConfig.minTroops2;
        ById('pcalerterr').innerHTML = '<font color=#600000><B>INVALID</b></font>';
        setTimeout (function (){ById('pcalerterr').innerHTML =''}, 2000);
        return;
      }
      Options.alertConfig.minTroops2 = mt;
      saveOptions();
  },
}


var DispReport = {
  	  init : function (){
  	    var t = DispReport;
  	    t.modal_InboxFunc = new CalterUwFunc ('modal_messages_listshow', [['msghtml.join("");', 'msghtml.join("");dispInbox_hook(rslt,boxType,msghtml);']]);
  	    uW.dispInbox_hook = t.ModalInboxHook;
  	    t.modal_InboxFunc.setEnable (Options.enhancedinbox);
  	  },
  	  setEnable : function (tf){
  	    var t = DispReport;
 	    t.modal_InboxFunc.setEnable (tf);
 	  },
  	  isDispReportAvailable : function (){
  	    var t = DispReport;
  	    return t.modal_InboxFunc.isAvailable();
  	  },

 	  ModalInboxHook : function (rslt,boxType,msghtml){
 	    var t = DispReport;
  	    if(boxType == 'inbox'){
  			msgBody = document.getElementById('modal_msg_list').parentNode.childNodes[0];
  			if (!ById("BODelete")) {
  			var a = document.createElement('a');
 				a.className='buttonDown20';
 				a.id="BODelete";
 				a.innerHTML='<span>'+lang.General.delGift+'</span>';
 				a.style.float = 'left';
 				a.style.left = '60px';
  				a.addEventListener('click', function() {

  				  t.checkinbox();
  				 }, false);
  			var div = document.createElement('div');
  			div.appendChild(a);
  			msgBody.appendChild(div);
  			}
  			if (!ById("BODelete2")) {
			  			var a = document.createElement('a');
			 				a.className='buttonDown20';
			 				a.id="BODelete2";
			 				a.innerHTML='<span>'+lang.General.delRpt+'</span>';
			 				a.style.float = 'left';
			 				a.style.left = '60px';
			  				a.addEventListener('click', function() {

			  				  DeleteReports.startdeletereports();
			  				  setTimeout(function() { uW.Messages.listReports(); },1000);
			  				 }, false);
			  			var div = document.createElement('div');
			  			div.appendChild(a);
			  			msgBody.appendChild(div);
  			}
 		}
  	  },
  	  checkinbox : function(){
  	    var t = DispReport;

  	    var body = document.getElementById('tbl_messages');
  	    var trs=body.getElementsByTagName('tr');
  	    var reports = [];
  		for(var i=0; i<trs.length; i++){
  			var tds = trs[i].getElementsByTagName('td');
  			for(var j=0; j<tds.length; j++){
  				if(tds[j].className == 'chkcol'){
 					var checkbox = tds[j];
  				}
  				if(tds[j].className == 'nmcol'){
 					var sender = tds[j];
 				}
  				if(tds[j].className == 'subjcol'){
  					var subject = tds[j];
  				}
 			}
  			reports.push({checkbox:checkbox,sender:sender,subject:subject});
  		}
 		t.parseGiftReport(reports);
 	  },
 	  parseGiftReport : function(rpts){
 	    var t = DispReport;
 	    for(var i=0; i<rpts.length; i++){
  			if((rpts[i].subject.innerHTML.indexOf('Nouveaux Cadeaux') >= 0 || rpts[i].subject.innerHTML.indexOf('New Gift Received!') >= 0 || rpts[i].subject.innerHTML.indexOf('Neues Geschenk erhalten!') >= 0 || rpts[i].subject.innerHTML.indexOf('Nuovo Regalo ricevuto')) && rpts[i].sender.innerHTML.indexOf('Kingdoms Of Camelot') >= 0){
 				rpts[i].checkbox.firstChild.checked = true;
 			}
 		}
 	   uW.messages_action("delete","tbl_messages");
 	  }
  	}

/****************************  Onglet PersonnalisÃƒÂ©  ******************************/
Tabs.perso = {
  tabOrder : 98,
  tabLabel : Options.NewTabName,
  tabDisabled : !Options.NewTab,
  myDiv : null,
  timer : null,

  init : function (div){
    var t = Tabs.perso;
    t.myDiv = div;
    t.myDiv.innerHTML = '<CENTER><iframe src="'+Options.NewTabURL+'" width="950" height="'+(Options.HauteurBoite-30)+'" id="BOFrame" border=0></iframe><BR></center>';
  },

  hide : function (){
  },

  show : function (){
    var t = Tabs.perso;
  },
}
/****************************  Onglet PersonnalisÃƒÂ© 2 ******************************/
Tabs.perso2 = {
  tabOrder : 99,
  tabLabel : Options.NewTabName2,
  tabDisabled : !Options.NewTab2,
  myDiv : null,
  timer : null,

  init : function (div){
    var t = Tabs.perso;
    t.myDiv = div;
    t.myDiv.innerHTML = '<CENTER><iframe src="'+Options.NewTabURL2+'" width="950" height="'+(Options.HauteurBoite-30)+'" id="BOFrame2" border=0 ></iframe><BR></center>';
  },

  hide : function (){
  },

  show : function (){
    var t = Tabs.perso;
  },
}
/********************************* Auto Dark Forest ***********************************/
Tabs.autoFO = {
  tabLabel: lang.BoiteLabelFO,
  tabOrder : 12,
  tabDisabled : false,
  myDiv : null,
  MapAjax : new CMapAjax(),
  popFirst : true,
  opt : {},
  nextattack : null,
  searchRunning : false,
  tilesSearched : 0,
  tilesFound : 0,
  curX : 0,
  curY : 0,
  lastX : 0,
  firstX : 0,
  firstY : 0,
  lastY : 0,
  rallypointlevel:0,
  knt:{},
  barbArray:{},
  lookup:1,
  city:0,
  deleting:false,


  init : function (div){
    var t = Tabs.autoFO;
    t.myDiv = div;
    if (Options.BORac_Dar) AddSubTabLink(lang.autofo.button, t.toggleBarbState, 'pbautofstab');

    var m = '<DIV id=pbTowrtDivF class=boStat>'+lang.autofo.title+' - <input type=button value="?" id=boaideautofo class=boAide></div><TABLE width=100% height=0% class=pbTab><TR align="center">';
	 if (Options.AttackRunning == false) {
	       m += '<TD><INPUT id=AttSearch type=submit value="'+lang.autofo.attack+' = OFF"></td>';
	       if (Options.BORac_Dar) updatebotbutton(lang.autofo.button+" - OFF", 'pbautofstab');
	   } else {
	       m += '<TD><INPUT id=AttSearch type=submit value="'+lang.autofo.attack+' = ON"></td>';
	       if (Options.BORac_Dar) updatebotbutton(lang.autofo.button+" - ON", 'pbautofstab');
	   }
	  m += '<TD><INPUT id=troopselect type=submit value="'+lang.autofo.troopselect+'"></td>';
	  m += '<TD><INPUT id=Options type=submit value="'+lang.autofo.options+'"></td>';
	  m += '</tr></table></div>';

	  m += '<DIV id=pbTraderDivD class=boStat>'+lang.autofo.title2+'</div>';

	  m += '<TABLE id=pbbarbstats width=100% height=0% class=pbTab><TR align="left"><TR>';
	  for(i=0;i<Seed.cities.length;i++){
	  		m += '<TD>' + Seed.cities[i][1] +'</td>';
	  }
	  m+='</tr><TR>';
	  for(i=0;i<Seed.cities.length;i++){
	  		m += '<TD><DIV><span id='+ 'pdtotalcity' + i +'></span></div></td>';
	  }
	  m+='</tr><TR>';
	  for(i=0;i<Seed.cities.length;i++){
	  		m += '<TD><DIV><span id='+ 'pddatacity' + i +'></span></div></td>';
	  }
	  m+='</tr><TR>'
	   for(i=0;i<Seed.cities.length;i++){
	  		m += '<TD><DIV><span id='+ 'pddataarray' + i +'></span></div></td>';
	 }
	 m+='</tr></table><TABLE id=pbbarbstats width=100% height=0% class=pbTab><TR align="center"><TR>';
	 for (i=0;i<=7;i++) {
	 	m+='<TD><DIV><span id='+ 'pberror' + i +'></span></div></td>';
     }
     m+='</tr></table>';
     m += '<DIV id=pbTraderDivD class=boStat>'+lang.autofo.title3+'</div>';
     m += '<TABLE width=100% height=0% class=ptTab><TR align="center">';
     for(i=0;i<Seed.cities.length;i++){
        m += '<TR><TD>' + Seed.cities[i][1] +'</td>';
        for (w=1;w<=10;w++){
           m += '<TD class=pblevelopt><INPUT id=pbcity'+i+'level'+w+' type=checkbox unchecked=true>'+lang.autofo.lvl+':'+w+'</td>';
        }
     }

     t.myDiv.innerHTML = m;

     saveAttackOptions();
     t.checkBarbData();

     for(i=0;i<Seed.cities.length;i++){
		var element = 'pdtotalcity'+i;
		if (t.barbArray[i+1] == undefined) ById(element).innerHTML = lang.autofo.nodata;
		else ById(element).innerHTML =  'Forets:' + t.barbArray[i+1].length;
     }

    for(i=0;i<Seed.cities.length;i++){
		for (w=1;w<=10;w++){
			ById('pbcity'+i+'level'+w).checked = AttackOptions.Levels[i+1][w];
		}
    }

	ById('AttSearch').addEventListener('click', function(){t.toggleBarbState(this)} , false);

	ById('boaideautofo').addEventListener('click', function(){
	 window.open(sitesupport+"?page=aide_autofo");
	} , false);

	ById('Options').addEventListener('click', t.barbOptions , false);
	ById('troopselect').addEventListener('click', t.troopOptions , false);
    var element_class = document.getElementsByClassName('pblevelopt');
    for (k=0;k<element_class.length;k++){
    	element_class[k].addEventListener('click', t.saveLevelOptions , false);
    }
   },

  saveLevelOptions : function(){
		for(i=0;i<Seed.cities.length;i++){
			AttackOptions.Levels[i+1][0]=false;
			for (w=1;w<=10;w++){
				var ele = ById('pbcity'+i+'level'+w);
				AttackOptions.Levels[i+1][w]=ele.checked;
				if (ele.checked)
					AttackOptions.Levels[i+1][0]=true;
			}
		}
		saveAttackOptions();
   },

  troopOptions: function(){
  	 var t = Tabs.autoFO;
	 var troopDef = [
	 ['Ravi', 1],
      ['Militiens', 2],
      ['Eclaireurs', 3],
      ['Piquiers', 4],
	  ['Paladins', 5],
      ['Archers', 6],
      ['Cavaleries', 7],
      ['C.Lourdes', 8],
      ['Wagons', 9],
      ['Balistes', 10],
      ['Beliers', 11],['Catapultes', 12],
     ];
  	 if(t.troopselect == null)
		t.troopselect = new CPopup ('pbtroopselect', 0, 0, 830, 445, true, function(){t.saveTroops();});
  	 t.troopselect.centerMe (mainPop.getMainDiv());
  	 var z= '<DIV id=pbTraderDivD class=boStat>'+lang.autofo.pbTraderDivD+'</div><TABLE width=100%><TR>';
	 z+='<TD></td>';
	 for (r=1; r<13; r++)
		z+='<TD><img height=20 title="'+uW.unitcost['unt'+r][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_'+r+'_30_s34.jpg></td>';
	 z+='<TD>MIN '+lang.autofo.dist+'</td><TD>MAX '+lang.autofo.dist+'</td>';
	 for(i=0;i<10;i++){
	 	z += '<TR><TD>'+lang.autofo.lvl+' '+(i+1)+': </td>';
	 	for(var j=0; j<troopDef.length; j++){
	 		z += '<TD><INPUT id="level'+i+'troop'+j+'" type=text size=4 maxlength=6 value="'+AttackOptions.Troops[i+1][j+1]+'" /></td>';
	 	}
		z+='<TD align=left><INPUT id=Mindist'+i+' type=text size=3 maxlength=3 value="'+AttackOptions.MinDistance[i+1]+'"</td>';
	 	z+='<TD align=right><INPUT id=dist'+i+' type=text size=3 maxlength=3 value="'+AttackOptions.Distance[i+1]+'"</td>';
	 	z+='</tr>';
	 }
	 z+='</table>';
	  t.troopselect.getMainDiv().innerHTML = z;
	  t.troopselect.show(true);
  },

  barbOptions: function(){
  	 var t = Tabs.autoFO;
  	 if(t.barboptions == null)
		t.barboptions = new CPopup ('pbbarboptions', 0,0, 375,350, true);
  	 t.barboptions.centerMe (mainPop.getMainDiv());
	 t.barboptions.getTopDiv().innerHTML = '<CENTER><b>'+lang.autofo.barboptions+' '+getServerId()+'</b></CENTER>';
  	var y = '<DIV style="max-height:400px; overflow-y:auto;"><DIV class=boStat>'+lang.autofo.barb1+'</div><TABLE width=100%>';
	   y +='<TR><TD style="margin-top:5px; text-align:center;"><INPUT id=pbresetbarbs type=submit value="'+lang.General.delete+'"></td>';
	   y +='<TD style="margin-top:5px; text-align:center;"><INPUT id=pbpaintbarbs type=submit value="'+lang.General.edit+'"></td>';
	   y += '<TD><SELECT id=pbcity type=list></td></tr></table>';
	   y +='<TD style="margin-top:5px; text-align:center;"><DIV class=boStat> OPTIONS </div></td><TABLE>';
     y +='<TR><TD>'+lang.autofo.pbsendint+' <INPUT id=pbsendint type=text size=4 maxlength=4 value='+ AttackOptions.SendInterval +' \> '+lang.General.secs+'</td></tr>';
     y +='<TR><TD>'+lang.autofo.pbmaxdist+' <INPUT id=pbmaxdist type=text size=4 maxlength=4 value='+ AttackOptions.MaxDistance +' \></td></tr>';
     y +='<TR><TD>'+lang.autofo.rallyclip+' <INPUT id=rallyclip type=text size=1 maxlength=2 value="'+AttackOptions.RallyClip+'" \> '+lang.autofo.rallyclip1+'</td></tr>';
     y +='<TR><TD><INPUT id=pbreport type=checkbox '+(AttackOptions.UpdateEnabled?'CHECKED':'')+'\> '+lang.autofo.pbreport+' <INPUT id=pbmsgint type=text size=3 maxlength=3 value='+AttackOptions.UpdateInterval+' \> '+lang.General.mins+'</td></tr>';
     y +='<TR><TD>'+lang.autofo.barbstopsearch+' <INPUT id=barbstopsearch type=text size=4 value='+AttackOptions.stopsearch+' \> '+lang.autofo.barbstopsearch1+'</td></tr>';
     y +='<TR><TD>'+lang.autofo.pbmethod+' '+htmlSelector({distance:lang.autofo.pbmethod1, level:lang.autofo.pbmethod2, lowlevel:lang.autofo.pbmethod3}, AttackOptions.Method, 'id=pbmethod')+'</td></tr>';
     y +='<TR><TD>'+lang.autofo.barbknight+' '+htmlSelector({0:lang.autofo.barbknight1, 1:lang.autofo.barbknight2}, AttackOptions.knightselector, 'id=barbknight')+'</td></tr>';
     y+='<tr><td>'+lang.autofo.reset+' <input type=button value="'+lang.autofo.raz+'" id=BO_FO_razCompteur></table></td></tr></table>';
	   t.barboptions.getMainDiv().innerHTML = y;
	   t.barboptions.show(true);

	ById('BO_FO_razCompteur').addEventListener('click', function(){
	 AttackOptions.BarbsFailedTraffic=0;
	 AttackOptions.BarbsFailedKnight=0;
	 AttackOptions.BarbsFailedVaria=0;
	 AttackOptions.BarbsFailedMarais=0;
	 AttackOptions.BarbsFailedRP=0;
	 AttackOptions.BarbsFailedBog=0;
	 AttackOptions.BarbsTried=0;
	 for (var city=0;city<Seed.cities.length;city++)
	  AttackOptions.BarbsDone[city]=0;

	 saveAttackOptions();
	},false);
	ById('pbcity').options.length=0;
	for (i=0;i<Seed.cities.length;i++){
		var o = document.createElement("option");
		o.text = Seed.cities[i][1]
		o.value = i+1;
		ById("pbcity").options.add(o);
	}

	ById('pbpaintbarbs').addEventListener('click', function(){
	   t.showBarbs(ById("pbcity").value,Seed.cities[ById("pbcity").value -1][1]);
        },false);
	ById('pbresetbarbs').addEventListener('click', t.deletebarbs,false);
	ById('pbmethod').addEventListener('change', function(){
		AttackOptions.Method=ById('pbmethod').value;
		saveAttackOptions();
		t.checkBarbData();
	},false);
	ById('barbknight').addEventListener('change', function(){
		AttackOptions.knightselector=ById('barbknight').value;
		saveAttackOptions();
	},false);
	ById('pbreport').addEventListener('change', function(){
		AttackOptions.UpdateEnabled=ById('pbreport').checked;
		saveAttackOptions();
	},false);
	ById('pbmsgint').addEventListener('change', function(){
	        if (parseInt(ById('pbmsgint').value)<15) ById('pbmsgint').value=15;
		AttackOptions.UpdateInterval=parseInt(ById('pbmsgint').value);
		saveAttackOptions();
	},false);
    ById('pbsendint').addEventListener('change', function(){
		if(parseInt(ById('pbsendint').value) <5)
			ById('pbsendint').value = 5;
		AttackOptions.SendInterval=parseInt(ById('pbsendint').value);
		saveAttackOptions();
	},false);
    ById('pbmaxdist').addEventListener('change', function(){
		if(parseInt(ById('pbmaxdist').value) > 100)
			ById('pbmaxdist').value = 100;
		AttackOptions.MaxDistance=parseInt(ById('pbmaxdist').value);
		saveAttackOptions();
	},false);
    ById('rallyclip').addEventListener('change', function(){
		AttackOptions.RallyClip=parseInt(ById('rallyclip').value);
		saveAttackOptions();
	},false);
    ById('barbstopsearch').addEventListener('change', function(){
		ById('barbstopsearch').value = parseInt(ById('barbstopsearch').value)>0?ById('barbstopsearch').value:1
		AttackOptions.stopsearch=parseInt(ById('barbstopsearch').value);
		saveAttackOptions();
	},false);
  },

    showBarbs: function (citynumber,cityname) {
		var t = Tabs.autoFO;
		var popTradeRoutes = null;
		t.popTradeRoutes = new CPopup('pbShowBarbs', 0, 0, 500, 500, true, function() {clearTimeout (1000);});
		var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbShowBarbs" id="pbBars">';
		t.popTradeRoutes.getMainDiv().innerHTML = '</table></div>' + m;
		t.popTradeRoutes.getTopDiv().innerHTML = '<TD><B>'+lang.autofo.popTradeRoutes+' '+cityname+'</td>';
		t.popTradeRoutes.centerMe (mainPop.getMainDiv());
		t.paintBarbs(citynumber,cityname);
		t._addTabHeader(citynumber,cityname);
		t.popTradeRoutes.show(true)	;
	 },
  	paintBarbs: function(i,cityname){
	        var t = Tabs.autoFO;
				for (k=(t.barbArray[i].length-1);k>=0;k--){t._addTab(i,cityname,k+1,t.barbArray[i][k]['x'], t.barbArray[i][k]['y'],t.barbArray[i][k]['dist'], t.barbArray[i][k]['level']);}
	    },

  _addTab: function(citynumber,cityname,queueId,X,Y,dist,level){
	 var t = Tabs.autoFO;
	 var row = ById('pbBars').insertRow(0);
	 row.vAlign = 'top';
	 row.insertCell(0).innerHTML = queueId;
	 row.insertCell(1).innerHTML = '<a href="javascript:void(0)" onclick="cm.utils.CoordinateLinkController.onClick(event)" class="coordinateLink">('+X+','+Y+')</a>';
	 row.insertCell(2).innerHTML = '';
	 row.insertCell(3).innerHTML = dist;
	 row.insertCell(4).innerHTML = level;
	 row.insertCell(5).innerHTML = '<a class="button20" id="barbdel_' + queueId + '"><span>'+lang.General.delete+'</span></a>';
	 ById('barbdel_' + queueId).addEventListener('click', function(){
		t.deleteBarbElement(citynumber,queueId,cityname, true);
	 }, false);
  },

  _addTabHeader: function(citynumber,cityname) {
	 var t = Tabs.autoFO;
	 var row = ById('pbBars').insertRow(0);
	 row.vAlign = 'top';
	 row.insertCell(0).innerHTML = "Order";
	 row.insertCell(1).innerHTML = "Coords";
	 row.insertCell(2).innerHTML = "";
	 row.insertCell(3).innerHTML = "Dist.";
	 row.insertCell(4).innerHTML = "Lvl";
	 row.insertCell(5).innerHTML = '<a class="button20" id="barbdelAll"><span>'+lang.General.delete+'</span></a>';
	 ById('barbdelAll').addEventListener('click', function(){
		t.deleteBarbsCity(citynumber,cityname);
	 }, false);
  },

  deleteBarbElement: function(citynumber,queueId,cityname,showFlag){
      var t = Tabs.autoFO;
      var queueId = parseInt(queueId);
      var myarray = t.barbArray[citynumber];
      if (myarray) {
        myarray.splice((queueId-1), 1);
        GM_setValue('DF_' + Seed.player['name'] + '_city_' + citynumber + '_' + getServerId(), JSON2.stringify(myarray));
        t.checkBarbData();
        if (showFlag) t.showBarbs(citynumber,cityname);
      }
  },
  deleteBarbsCity: function(citynumber,cityname){
      var t = Tabs.autoFO;
      var queueId = parseInt(queueId);
	  AttackOptions.Update[citynumber][1] = 0;
      GM_deleteValue('DF_' + Seed.player['name'] + '_city_' + citynumber + '_' + getServerId())
      t.checkBarbData();
      t.showBarbs(citynumber,cityname);
      actionLog("AutoFO","Reboot....");
      reloadKOC();
  },
  saveTroops: function(){
    for(i=0;i<10;i++){
  	 	for (w=0;w<12;w++){
  	 		AttackOptions.Troops[i+1][w+1] = parseIntNan(ById('level'+i+'troop'+w).value);
  	 	}
		if(parseIntNan(ById('dist'+i).value) > AttackOptions.MaxDistance)
			ById('dist'+i).value = AttackOptions.MaxDistance;
		AttackOptions.MinDistance[i+1] = parseIntNan(ById('Mindist'+i).value);
  	 	AttackOptions.Distance[i+1] = parseIntNan(ById('dist'+i).value);
	 }
	 saveAttackOptions();
  },

   deletebarbs: function(){
	for (i=1;i<=Seed.cities.length;i++){
		AttackOptions.Update[i][1] = 0;
		GM_deleteValue('DF_' + Seed.player['name'] + '_city_' + i + '_' + getServerId())
	}
	 actionLog("AutoFO","Reboot....");
	reloadKOC();
   },

  checkBarbData: function(){
  	var t = Tabs.autoFO;
	if(!Options.AttackRunning) return;
	  for (i=1;i<=Seed.cities.length;i++){
		if (!AttackOptions.Levels[i][0]) continue; //Skip city if not selected
		t.barbArray[i] = [];
	  	var myarray = JSON2.parse(GM_getValue('DF_' + Seed.player['name'] + '_city_' + i + '_' + getServerId(),"[]"));

		if ((myarray == undefined || myarray.length == 0) && t.searchRunning==false) {
	  		t.lookup=i;
			if(parseInt(AttackOptions.Update[t.lookup][1]) >= parseInt(AttackOptions.stopsearch)) continue; //Skip if search results are empty more than X times
			t.searchRunning = true;
	  		t.opt.startX = parseInt(Seed.cities[(i-1)][2]);
	  		t.opt.startY = parseInt(Seed.cities[(i-1)][3]);
	  		t.clickedSearch();
			break;
	  	}
		if (myarray){
			if(AttackOptions.Method == 'distance') t.barbArray[i] = myarray.sort(function sortBarbs(a,b) {a = a['dist'];b = b['dist'];return a == b ? 0 : (a < b ? -1 : 1);});
			if(AttackOptions.Method == 'level') t.barbArray[i] = myarray.sort(function sortBarbs(a,b) {a = a['level']+a['dist'];b = b['level']+b['dist'];return a == b ? 0 : (a > b ? -1 : 1);});
			if(AttackOptions.Method == 'lowlevel') t.barbArray[i] = myarray.sort(function sortBarbs(a,b) {a = a['level']+a['dist'];b = b['level']+b['dist'];return a == b ? 0 : (a < b ? -1 : 1);});
	  		GM_setValue('DF_' + Seed.player['name'] + '_city_' + i + '_' + getServerId(), JSON2.stringify(t.barbArray[i]));
	  	}
		AttackOptions.Update[i][1] = 0;
		saveAttackOptions();
	  }
	  t.nextattack = setTimeout(t.getnextCity, parseInt((Math.random()*3000)+2000));
  },

  toggleBarbState: function(obj){
	var t = Tabs.autoFO;
	obj = ById('AttSearch');
	if (parseInt(AttackOptions.UpdateInterval)<15) AttackOptions.UpdateInterval=15;
	if (Options.AttackRunning == true) {
		Options.AttackRunning = false;
		obj.value = lang.autofo.attack+" = OFF";
	    if (Options.BORac_Dar) updatebotbutton(lang.autofo.button+' - OFF', 'pbautofstab');
		saveAttackOptions();saveOptions();
		clearTimeout(t.nextattack);
		t.nextattack = null;
	} else {
		Options.AttackRunning = true;
		obj.value = lang.autofo.attack+" = ON";
		if (Options.BORac_Dar) updatebotbutton(lang.autofo.button+' - ON', 'pbautofstab');
		saveAttackOptions();saveOptions();
		t.checkBarbData();
		t.nextattack = setTimeout(t.getnextCity, parseInt((Math.random()*3000)+2000));
	}
  },

  barbing : function(){
     var t = Tabs.autoFO;
     var city = t.city;
     citynumber = Seed.cities[city-1][0];
     cityID = 'city' + citynumber;
     t.getAtkKnight(cityID);
       t.getRallypointLevel(cityID);
       if (t.rallypointlevel > 11 ) t.rallypointlevel = 11;
	   var slots=0;
	   if (Seed.queue_atkp[cityID] != undefined){
	       for(var k in Seed.queue_atkp[cityID])
		    slots++;
		   if(Seed.queue_atkp[cityID].toSource() == "[]")
			slots = 0;
		} else
			slots=0;



	   var element1 = 'pddatacity'+(city-1);
       ById(element1).innerHTML = 'Env: ' + AttackOptions.BarbsDone[city];
       var element2 = 'pddataarray'+(city-1);
       ById(element2).innerHTML =  'PR: (' + slots + '/' + t.rallypointlevel +')';

	   if ((t.rallypointlevel-AttackOptions.RallyClip) <= slots) {
	    actionLog("AutoFO",Cities.cities[city-1].name+" - " +lang.autofo.error1);
	    return;
	   }
	   if (t.knt.toSource() == "[]") {
	    actionLog("AutoFO", Cities.cities[city-1].name+" - " +lang.autofo.error2);
	    return;
	   }
	   var kid = t.knt[0].ID;

	   if(t.barbArray[city].length > 0)
		var barbinfo = t.barbArray[city].shift();
	  else if(!t.searchRunning){
		t.checkBarbData();
		return;
	   } else {
		return;
	  }
       var check=0;
       var barblevel = parseInt(barbinfo.level);
	 if (AttackOptions.Levels[city][barbinfo.level])
			check=1;


        var xcoord = barbinfo['x'];
        var ycoord = barbinfo['y'];
        if (barbinfo.dist < AttackOptions.MinDistance[barblevel] || barbinfo.dist > AttackOptions.Distance[barblevel]){
			check=0;
			GM_setValue('DF_' + Seed.player['name'] + '_city_' + city + '_' + getServerId(), JSON2.stringify(t.barbArray[city]));
			return;
		}

         // check troop levels in city
         var trps = AttackOptions.Troops[barblevel];
         var num_troops = 0;
         for (var ii=1; ii<13; ii++) {
	        if (parseInt(trps[ii]) > Seed.units[cityID]['unt'+ii]) check = 0;
	        num_troops += trps[ii];
         }
         if (num_troops == 0) check = 0;

       if (check == 0){
		t.barbArray[city].push(barbinfo);
		GM_setValue('DF_' + Seed.player['name'] + '_city_' + city + '_' + getServerId(), JSON2.stringify(t.barbArray[city]));
		 //actionLog("AutoFO","Pas assez de troupes sur le niveau "+parseInt(barblevel));
		return;
	   }

	var element = 'pdtotalcity'+(city-1);
		if (t.barbArray[city] == undefined) ById(element).innerHTML = lang.autofo.nodata;
		else ById(element).innerHTML =  lang.autofo.button+':' + t.barbArray[city].length;

       var xcoord = barbinfo['x'];
       var ycoord = barbinfo['y'];


       t.doBarb(citynumber,city,xcoord,ycoord,barblevel,kid,trps);
       saveAttackOptions();
  },

  getnextCity: function(){
	var t = Tabs.autoFO;

	clearTimeout(t.nextattack);
	if(t.searchRunning || !Options.AttackRunning) return;
	t.nextattack = setTimeout(t.getnextCity, parseInt((Math.random()*3)+AttackOptions.SendInterval)*1000);

	var city = t.city+1;
	if (city>Seed.cities.length){
		city=1;
	}
	t.city = city;
	if(AttackOptions.UpdateEnabled){
		var now = unixTime();
		if(now > parseInt(AttackOptions.Update[city][0] + (AttackOptions.UpdateInterval*60))){
			AttackOptions.Update[city][1]=0;
			t.barbArray[city] = []; //Clears data if last update was more than X minutes
			GM_setValue('DF_' + Seed.player['name'] + '_city_' + city + '_' + getServerId(), JSON2.stringify(t.barbArray[city]));
		}
	}

	if(AttackOptions.Levels[city][0])
		t.barbing();
	/*	t.nextattack = setTimeout(t.getnextCity, parseInt((Math.random()*3)+AttackOptions.SendInterval)*1000);
	} else {
		 t.getnextCity();

	}*/
  },

  getRallypointLevel: function(cityId){
    var t = Tabs.autoFO;
    for (var o in Seed.buildings[cityId]){
  	var buildingType = parseInt(Seed.buildings[cityId][o][0]);
  	var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
  	if (buildingType == 12) t.rallypointlevel=parseInt(buildingLevel);
     }
  },

  getAtkKnight : function(cityID){
     var t = Tabs.autoFO;
     t.knt = new Array();
     t.getRallypointLevel(cityID);
     for (k in Seed.knights[cityID]){
     		if (Seed.knights[cityID][k]["knightStatus"] == 1 && Seed.leaders[cityID]["resourcefulnessKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["politicsKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["combatKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["intelligenceKnightId"] != Seed.knights[cityID][k]["knightId"]){
     			t.knt.push ({
     				Name:   Seed.knights[cityID][k]["knightName"],
     				Combat:	Seed.knights[cityID][k]["combat"],
     				ID:		Seed.knights[cityID][k]["knightId"],
     			});
     		}
     }
     t.knt = t.knt.sort(function sort(a,b) {
							a = parseInt(a['Combat']);
							b = parseInt(b['Combat']);
							if(parseInt(AttackOptions.knightselector) > 0)
								return a == b ? 0 : (a > b ? -1 : 1);
							else
								return a == b ? 0 : (a < b ? -1 : 1);
							});
  },
  doBarb: function(cityID,counter,xcoord,ycoord,level,kid,trps){
  	var t = Tabs.autoFO;
  	/*t.MapAjax.request (xcoord, ycoord, 1, function(left, top, width, rslt) {
  	   map = rslt.data;
	   for (k in map){
		   if (xcoord==map[k].xCoord && ycoord==map[k].yCoord) {
		    if (parseInt(level)!=parseInt(map[k].tileLevel) && map[k].tileType==54 || map[k].tileType!=54) {
		     	AttackOptions.BarbsTried++;
		       	if (map[k].tileType==0) {
		       	 AttackOptions.BarbsFailedMarais++;
		       	 actionLog("AutoFO","Marais detecte sur "+ xcoord + ","+ycoord+" ");
		       	}else {
		       	 AttackOptions.BarbsFailedVaria++;
		       	 actionLog("AutoFO","Niveau different detecte sur "+ xcoord + ","+ycoord+" " + parseInt(map[k].tileLevel) +" au lieu de "+parseInt(level));
		       	}
		       	ById('pberror0').innerHTML = 'Tentative :'+ AttackOptions.BarbsTried;
		       	ById('pberror5').innerHTML = 'Autre :' + AttackOptions.BarbsFailedVaria;
		       	ById('pberror7').innerHTML = 'Marais :' + AttackOptions.BarbsFailedMarais;
		       	GM_setValue('DF_' + Seed.player['name'] + '_city_' + counter + '_' + getServerId(), JSON2.stringify(t.barbArray[counter]));
			saveAttackOptions();
		       return;
		    }


		  }
            }
            */
     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
     params.cid=cityID;
  		params.type=4;
  	    params.kid=kid;
  		params.xcoord = xcoord;
  		params.ycoord = ycoord;
		for (ii=1; ii<13; ii++) {
			if(parseInt(trps[ii]) > 0)
				params['u'+ii]=trps[ii];
                }

  		AttackOptions.BarbsTried++;
  		ById('pberror0').innerHTML = 'Tentative :'+ AttackOptions.BarbsTried;
  		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
  		         method: "post",
  		         parameters: params,
  		         loading: true,
  		         onSuccess: function (transport) {
  		            try {
				   var rslt = eval("(" + transport.responseText + ")");
				   if (rslt.ok) {
					 var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
					 var ut = unsafeWindow.unixtime();
					 var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
					 var resources=[0,0,0,0,0,0,0,0,0,0,0,0,0];
					 for(i = 0; i <= unitsarr.length; i++){
						if(params["u"+i]){
						unitsarr[i] = params["u"+i];
						}
					 }
					 var currentcityid = params.cid;
					 unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
					 unsafeWindow.update_seed(rslt.updateSeed)
					 if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
					 var slots=0;
					 for(var k in Seed.queue_atkp['city'+cityID])
					  slots++;
					 if(Seed.queue_atkp['city'+cityID].toSource() == "[]")
					  slots = 0;
					 AttackOptions.BarbsDone[counter]++;
					 var element1 = 'pddatacity'+(counter-1);
					 ById(element1).innerHTML = 'Env: ' + AttackOptions.BarbsDone[counter];
					 var element2 = 'pddataarray'+(counter-1);
					 ById(element2).innerHTML =  'PR: (' + slots + '/' + t.rallypointlevel +')';
					 var now = new Date().getTime()/1000.0;
					 now = now.toFixed(0);
					 GM_setValue('DF_' + Seed.player['name'] + '_city_' + counter + '_' + getServerId(), JSON2.stringify(t.barbArray[counter]));
					 saveAttackOptions();
				   } else {
					 if (rslt.error_code != 8 && rslt.error_code != 213 && rslt.error_code == 210) AttackOptions.BarbsFailedVaria++;
					 if (rslt.error_code == 213)AttackOptions.BarbsFailedKnight++;
					 if (rslt.error_code == 210) AttackOptions.BarbsFailedRP++;
					 if (rslt.error_code == 8) AttackOptions.BarbsFailedTraffic++;
					 if (rslt.user_action) {
					 	actionLog("AutoFO","<b><font color=red>Captcha</font></b>");
					 	new CdialogCancelContinue('<SPAN class=boldRed>CAPTCHA ALERT !</span>', null, null, mainPop.getMainDiv());
						AttackOptions.BarbsFailedVaria++;
					}
					 if (rslt.error_code == 104) {
					   AttackOptions.BarbsFailedBog++;
					   GM_setValue('DF_' + Seed.player['name'] + '_city_' + counter + '_' + getServerId(), JSON2.stringify(t.barbArray[counter]));
					   saveAttackOptions();
					 }
					 ById('pberror2').innerHTML = 'Erreur Traffic :' + AttackOptions.BarbsFailedTraffic;
					 ById('pberror3').innerHTML = 'Erreur PR : '+ AttackOptions.BarbsFailedRP;
					 ById('pberror4').innerHTML = 'Erreur Chev :' + AttackOptions.BarbsFailedKnight;
					 ById('pberror5').innerHTML = 'Autre :' + AttackOptions.BarbsFailedVaria;
					 ById('pberror6').innerHTML = 'Bug :' + AttackOptions.BarbsFailedBog;
					 }
			    } catch(err) {
			   	AttackOptions.BarbsFailedVaria++;
			   	saveAttackOptions();
			   }
  		         },
  		         onFailure: function () {}
  		 });




  	 saveAttackOptions();
  },

  sendreport: function(){
	  var t = Tabs.autoFO;
	  var total = 0;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.emailTo = Seed.player['name'];
    params.subject = "Barb Overview";
    var message = 'Barbing Stats: (Sent/Total)' + '%0A';
    for (x=1;x<=Seed.cities.length;x++){
    	message+= Seed.cities[x-1][1] + ': (' + AttackOptions.BarbsDone[x] + '/' + t.barbArray[x].length +')' + '%0A';
    }
    message += '%0A'+ 'Excess traffic errors: ' + AttackOptions.BarbsFailedTraffic +'%0A';
    message += 'Rallypoint errors: ' + AttackOptions.BarbsFailedRP +'%0A';
    message += 'Knight errors: ' + AttackOptions.BarbsFailedKnight +'%0A';
    message += 'Other errors: ' + AttackOptions.BarbsFailedVaria +'%0A';
    message += 'Actual sent attacks: ' + (AttackOptions.BarbsTried - AttackOptions.BarbsFailedTraffic - AttackOptions.BarbsFailedRP - AttackOptions.BarbsFailedKnight -  AttackOptions.BarbsFailedVaria) +'%0A';
    message += '%0A'+'%0A' + 'Food Gain (for '+AttackOptions.MsgInterval+' hour of barbing)' +'%0A';
    for (q=1;q<=Seed.cities.length;q++){
    	var cityID = 'city' + Seed.cities[q-1][0];
    	var gain = parseInt(Seed.resources[cityID]['rec1'][0] / 3600) - AttackOptions.Foodstatus[q];
    	message+= Seed.cities[q-1][1] + ': Start: ' + addCommas(AttackOptions.Foodstatus[q]) + ' End :' + addCommas(parseInt(Seed.resources[cityID]['rec1'][0] / 3600)) + ' Gain: ';
    	message += addCommas(gain)  + '%0A';
		total += gain;
    }
	message += '%0A Total food gain : '+addCommas(total)+'%0A';
    params.message = message;
    params.requestType = "COMPOSED_MAIL";
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function (message) {
            var rslt = eval("(" + message.responseText + ")");
            if (rslt.ok) {
            } else {
            }
        },
        onFailure: function () {
        },
    });
  },

  clickedSearch : function (){
    var t = Tabs.autoFO;

    t.opt.maxDistance = parseInt(AttackOptions.MaxDistance);
    t.opt.searchDistance = (t.opt.maxDistance*2);
    if(t.opt.maxDistance > 40){
     t.opt.searchDistance = 40;
    }
    t.opt.searchShape = 'circle';
    t.mapDat = [];
    t.firstX =  t.opt.startX - t.opt.maxDistance;
    t.lastX = t.opt.startX + t.opt.maxDistance;
    t.firstY =  t.opt.startY - t.opt.maxDistance;
    t.lastY = t.opt.startY + t.opt.maxDistance;
    t.tilesSearched = 0;
    t.tilesFound = 0;
    t.curX = t.firstX;
    t.curY = t.firstY;
    var xxx = t.MapAjax.normalize(t.curX);
    var yyy = t.MapAjax.normalize(t.curY);
    var element = 'pddatacity'+(t.lookup-1);
    ById(element).innerHTML = uW.g_js_strings.commonstr.loadingddd+' : '+ xxx +','+ yyy;

    t.timerMap=setTimeout (function(){t.MapAjax.request (xxx, yyy, t.opt.searchDistance, t.mapCallback)}, MAP_DELAY);
  },
  timerMap:null,
  mapCallback : function (left, top, width, rslt){
    var t = Tabs.autoFO;
     if (!t.searchRunning)
      return;
    if (!rslt.ok){
      t.stopSearch ('ERROR: '+ rslt.errorMsg);
      return;
    }
    if (!Options.AttackRunning) {

     for (i=1;i<=Seed.cities.length;i++){
    		AttackOptions.Update[i][1] = 0;
    		GM_deleteValue('DF_' + Seed.player['name'] + '_city_' + i + '_' + getServerId())
     }
     var element = 'pddatacity'+(t.lookup-1);
     ById(element).innerHTML = lang.autofo.cancel;
     t.searchRunning = false;
     saveAttackOptions();
     return;
    }
    map = rslt.data;

    for (k in map){
	  if (map[k].tileType==54 && AttackOptions.Levels[t.lookup][map[k].tileLevel]){
	     var dist = distance (t.opt.startX, t.opt.startY, map[k].xCoord, map[k].yCoord);
		 if(dist <= parseInt(AttackOptions.MaxDistance))
			t.mapDat.push ({time:0,x:map[k].xCoord,y:map[k].yCoord,dist:dist,level:map[k].tileLevel});
	  }
    }

    t.tilesSearched += (t.opt.searchDistance*t.opt.searchDistance);

    t.curX += t.opt.searchDistance;
    if (t.curX > t.lastX){
      t.curX = t.firstX;
      t.curY += t.opt.searchDistance;
      if (t.curY > t.lastY){
		t.stopSearch(lang.autofo.found+' ' + t.mapDat.length);
        return;
      }
    }
    var x = t.MapAjax.normalize(t.curX);
    var y = t.MapAjax.normalize(t.curY);
    var element = 'pddatacity'+(t.lookup-1);
    ById(element).innerHTML = uW.g_js_strings.commonstr.loadingddd+' : '+ x +','+ y;
    t.timerMap=setTimeout (function(){t.MapAjax.request (x, y, t.opt.searchDistance, t.mapCallback)}, MAP_DELAY);
  },

  stopSearch : function (msg){
    var t = Tabs.autoFO;
	var element = 'pddatacity'+(t.lookup-1);
        ById(element).innerHTML = msg;
	GM_setValue('DF_' + Seed.player['name'] + '_city_' + t.lookup + '_' + getServerId(), JSON2.stringify(t.mapDat));
	AttackOptions.Update[t.lookup][0] = unixTime();
	AttackOptions.Update[t.lookup][1]++;
        t.searchRunning = false;
	saveAttackOptions();
	t.checkBarbData();
	return;
  },

  hide : function (){

  },

  show : function (){
  },

};

Tabs.Raid = {
  tabDisabled : false,
  tabLabel: 'Raid',
  tabOrder : 20,
  myDiv : null,
  rallypointlevel:null,
  knt:{},
  Troops:{},
  city:0,
  raidtimer:null,
  rslt:{},
  save:{},
  stopping:false,
  resuming:false,
  deleting:false,
  stopprogress:0,
  stopcount:0,
  activecount:0,
  count:0,
  timerLookup:null,
  timerPaint:null,
  timerReport:null,
  init : function (div){
    var t = Tabs.Raid;
    t.myDiv = div;
	t.raidtimer = setTimeout(t.checkRaids, 6000);
	var m = '<DIV class=boStat>'+lang.RAID.conf+'</div><TABLE width=100% height=0% class=pbTab><TR align="center">\
	    <td colspan=2><INPUT id=pbraidtab type=submit value="'+lang.RAID.stop+'" class="tab"><INPUT id=pbraidtabRes type=submit value="'+lang.RAID.resume+'" class="tab" >\
	    <INPUT id=pbraidtabDel type=submit value="'+lang.RAID.delete+'" class="tab"></td>\
	    <TR align="center">';
	    m += '<TD><INPUT id=pbRaidStart type=submit value="Auto Reset = '+ (Options.RaidRunning?'ON':'OFF') +'" ></td>';
	    m += '<TD><INPUT id=pbsendraidreport type=checkbox '+ (Options.foodreport?'CHECKED':'') +'\> '+lang.RAID.sendReport+' ';
	    m += '<INPUT id=pbsendreportint value='+ Options.MsgInterval +' type=text size=3 \> '+lang.General.hours+' </td>';
	    m += '</tr></table></div>';
	    m += '<DIV class=boStat>'+lang.RAID.marches+'</div><TABLE width=100% height=0% class=pbTab><TR align="center">';
	    m += '<TD><DIV style="margin-bottom:10px;"><span id=ptRaidCity></span></div></td></tr>';
	    m+='<TR><TD><DIV style="margin-bottom:10px;"><span id=ptRaidTimer></span></div></td></tr></table>';
	    m += '<DIV id=PaintRaids></div>';
	    m += '<DIV class=boStat>'+lang.RAID.memory+'</div><TABLE width=100% height=0% class=pbTab><TR align="center">';
	    m += '<DIV id=SavedRaids></div>';
	t.myDiv.innerHTML = m;
	if (Options.foodreport) {
	 t.timerReport=setInterval(t.sendreport, 1*60*1000);
	 }

	t.from = new CdispCityPicker ('ptRaidpicker', ById('ptRaidCity'), true, t.clickCitySelect, 0);
	ById('pbRaidStart').addEventListener('click', t.toggleRaidState, false);
	ById('pbsendraidreport').addEventListener('change', function(){
		Options.foodreport = ById('pbsendraidreport').checked;
		if (Options.foodreport) {
		   clearInterval(t.timerReport);
		   t.timerReport=setInterval(t.sendreport, 1*60*1000);
		 } else {
		  clearInterval(t.timerReport);
		 }
		saveOptions();
	}, false);
	ById('pbsendreportint').addEventListener('change', function(){
		Options.MsgInterval = parseInt(ById('pbsendreportint').value);
		saveOptions();
	}, false);

	ById('pbraidtab').addEventListener('click', t.StopAllRaids, false);
	ById('pbraidtabRes').addEventListener('click', t.ResumeAllRaids, false);
	ById('pbraidtabDel').addEventListener('click', t.DeleteAllRaids, false);


	var serverID = getServerId();
	t.save = GM_getValue ('SavedRaids_'+serverID);
	if (t.save != undefined) t.save = JSON2.parse (t.save);


  },

  lookup : function (){
      	var t = Tabs.Raid;
      	t.activecount=0;
      	t.stopcount=0;
      	for (c=0; c< Seed.cities.length;c++) {
      			cityID = 'city' + Seed.cities[c][0];
   				for (b in Seed.queue_atkp[cityID]){
   					destinationUnixTime = Seed.queue_atkp[cityID][b]['destinationUnixTime'];
   					MarchStatus = Seed.queue_atkp[cityID][b]['marchStatus'];
   					MarchType = Seed.queue_atkp[cityID][b]['marchType'];
   					botMarchStatus = Seed.queue_atkp[cityID][b]['botMarchStatus'];
   					if (MarchType == 9 &&  MarchStatus == 3 || MarchStatus==10) t.stopcount++;
   					else if (MarchType == 9) t.activecount++;

   				}
   		}

   		if (t.resuming == false && t.stopping == false && t.deleting == false && t.activecount != 0)
				if (ById('pbraidtab')) ById('pbraidtab').value = lang.RAID.stop+' ('+ t.activecount + ')'
			   	else if (t.resuming == false && t.stopping == false && t.deleting == false)
					if (ById('pbraidtab')) ById('pbraidtab').value = lang.RAID.stop+' ('+ t.activecount + ')'
		   		if (t.resuming == false && t.resuming == false && t.deleting == false && t.stopcount !=0)
					if (ById('pbraidtabRes')) ById('pbraidtabRes').value = lang.RAID.resume+' ('+ t.stopcount + ')'
		   		else if (t.resuming == false && t.stopping == false && t.deleting == false)
					if (ById('pbraidtabRes')) ById('pbraidtabRes').value = lang.RAID.resume+' ('+ t.stopcount + ')'
		   		if (t.resuming == false && t.stopping == false && t.deleting == false && t.stopcount !=0)
					if (ById('pbraidtabDel')) ById('pbraidtabDel').value = lang.RAID.delete+' ('+ t.stopcount + ')'
		   		else if (t.resuming == false && t.stopping == false && t.deleting == false)
			if (ById('pbraidtabDel')) ById('pbraidtabDel').value = lang.RAID.delete+' ('+ t.stopcount + ')'
  },

  paint : function ()	{
  	var t = Tabs.Raid;

  	var botMarchStat = {0:'Inactive',
  						1:'Raiding',
  						2:'Returning',
  						3:'Stopped',
  						4:'Resting',
  						5:'Unknown',
  						7:'Situation Changed',
  						8:'Returning',
  						9:'Aborting'};
  	var botStat = {0:'Undefined',
  						1:'Marching',
  						2:'Returning',
  						3:'Stopped',
  						4:'Insufficient Troops',
  						5:'Max Raids Exceeded',
  						7:'Timed out',
  						8:'Resting'};
  	var o = '';
  	if (t.rslt.settings != undefined) o+= '<FONT size=2px><B>'+lang.RAID.timer+' : '+ timestr( 86400 - ( unixTime() - t.rslt.settings.lastUpdated )) +'</b></font>';
  	ById('ptRaidTimer').innerHTML = o;

  	var z ='<TABLE class=pbTab><TR><TD width=60px align=center><A onclick="pbStopAll('+t.cityId+')">STOP</a></td><TD width=70px>'+lang.General.time+'</td><TD width=85px>'+uW.g_js_strings.commonstr.coordinates+'</td><TD width=50px>'+uW.g_js_strings.commonstr.level+'</td><TD width=50px>&nbsp;</td><TD width=50px>&nbsp;</td></TR>';
  	if (t.rslt['queue'] != ""){
  		for (y in t.rslt['queue']) {
  			if (t.rslt['queue'][y]['botMarches'] != undefined) {
  				for (k in Seed.queue_atkp['city' + t.cityId]){
  					if (Seed.queue_atkp['city' + t.cityId][k]['marchId'] == t.rslt['queue'][y]['botMarches']['marchId']) {
  						botMarchStatus = Seed.queue_atkp['city' + t.cityId][k]['botMarchStatus'];
  						MarchStatus = Seed.queue_atkp['city' + t.cityId][k]['marchStatus'];
  						restPeriod = (Seed.queue_atkp['city' + t.cityId][k]['restPeriod']/60);
  						destinationUnixTime = Seed.queue_atkp['city' + t.cityId][k]['destinationUnixTime'];
  						returnUnixTime = Seed.queue_atkp['city' + t.cityId][k]['returnUnixTime']
  						now = unixTime();
  						z+='<TR>';
  						if (MarchStatus == 1) z+='<TD align=center><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/attacking.jpg></td>';
  						if (MarchStatus == 8 && (destinationUnixTime - now) <= 0 && botMarchStatus !=3 && returnUnixTime > now) z+='<TD align=center><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/returning.jpg></td>';
  						if (MarchStatus == 3) z+='<TD align=center><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/autoAttack/raid_stopped_desat.png></td>';
  						if (MarchStatus == 4 || (returnUnixTime < now  && botMarchStatus !=3)) z+='<TD align=center><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/autoAttack/raid_resting.png></td>';

  						if (destinationUnixTime >= now) z+='<TD>'+ timestr(Seed.queue_atkp['city' + t.cityId][k]['destinationUnixTime'] - unixTime())+'</td>';
  						if (destinationUnixTime <= now) {
  							if ((destinationUnixTime - now) <= 0 && returnUnixTime > now) z+='<TD>'+ timestr(returnUnixTime - now)+'</td>';
  							if (returnUnixTime <= now) z+='<TD>'+ timestr(now - returnUnixTime)+'</td>';
  						}
  					}
  				}
  				z+="<TD><a href='javascript:void(0)' onclick='cm.utils.CoordinateLinkController.onClick(event)' class='coordinateLink'>("+ t.rslt['queue'][y]['botMarches']['toXCoord'] +","+ t.rslt['queue'][y]['botMarches']['toYCoord']+")</a></td>";
  				z+='<TD align=center>'+ t.rslt['queue'][y]['botMarches']['toTileLevel'] +'</td>';
  				if (botMarchStatus == 3) z+='<TD><A onclick="pbEditRaid('+ y +')">'+lang.General.edit+'</a></td>';
	  				else z+='<TD><FONT COLOR= "CCCCCC">'+lang.General.edit+'</font></td>';
  				if (botMarchStatus == 3) z+='<TD align=center><A onclick="pbDeleteRaid('+ t.rslt['queue'][y]['botMarches']['marchId']+')">'+lang.General.delete+'</a></td>';
  				else z+='<TD align=center><FONT COLOR= "CCCCCC">'+lang.General.delete+'</font></td>';
  				z +='<TD width=25px></td><TD>'+lang.General.timeremi+' '+ timestr(restPeriod) +'</td>';
  				z+='</tr>';
  			}
  		}
  	}
  	z+='</table>';
  	if (t.rslt['queue'] == "") z ='<TABLE class=pbTab><TR><TD>'+lang.RAID.nothing+'</td></TR>';
  	ById('PaintRaids').innerHTML = z;

  	var check = true;
  		if (t.save != ""){
  			var a ='<TABLE class=pbTab><TR><TD width=60px></td><TD width=70px></td><TD width=85px>'+uW.g_js_strings.commonstr.coordinates+'</td><TD width=50px>'+uW.g_js_strings.commonstr.level+'</td><TD width=50px></td><TD width=50px></td></tr>';
  			for (y in t.save){
  				if (t.save[y] != undefined && t.cityId == t.save[y]['cityId']){
  					a +='<TR><TD align=center><A onclick="pbDeleteSavedRaid('+ t.save[y]['marchId'] +')">X</a></td>';
  					a +="<TD></td><TD><FONT COLOR='#CC0000'><a href='javascript:void(0)' onclick='cm.utils.CoordinateLinkController.onClick(event)' class='coordinateLink'>("+t.save[y]['toXCoord']+","+t.save[y]['toYCoord']+")</a></font></td>";
  					a +='<TD align=center>'+t.save[y]['toTileLevel']+'</td>';
  					a +='<TD><A onclick="pbEditSavedRaid('+ y +')">'+lang.General.edit+'</a></td>';
  					a +='<TD align=center><A onclick="pbAddRaid('+ t.save[y]['marchId']+')">'+lang.General.add+'</a></td></tr>';
  					check = false;
  				}
  			}
  			m+='</table>';
  		}

  	if (check) a ='<TABLE class=pbTab><TR><TD>'+lang.RAID.nothingmemory+'</td></TR>';

  	ById('SavedRaids').innerHTML = a;

  	unsafeWindow.pbDeleteRaid = t.DeleteRaid;
  	unsafeWindow.pbEditRaid = t.EditRaid;
  	unsafeWindow.pbAddRaid = t.AddRaid;
  	unsafeWindow.pbDeleteSavedRaid = t.DeleteSavedRaid;
  	unsafeWindow.pbEditSavedRaid = t.EditSavedRaid;
  	unsafeWindow.pbStopAll = t.StopCityRaids;
  },

  DeleteSavedRaid : function (Id){
    	  var t = Tabs.Raid;
    	  for (yy=0;yy<t.save.length;yy++){
    	  	if (t.save[yy]['marchId'] == Id){
    	  		  t.save.splice (yy,1);
    	  	}
    	  }
    	  var serverID = getServerId();
    	  setTimeout (function (){GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));}, 0);
    	  t.paint();
    },

  EditSavedRaid : function (y){
      var t = Tabs.Raid;
	  var pop = new CPopup ('pbEditRaid', 0,0, 750,350, true);
	  if (t.popFirst){
	    pop.centerMe (mainPop.getMainDiv());
	    t.popFirst = false;
	  }
	  pop.getTopDiv().innerHTML = '<CENTER><B>Edition du Raid</b></center>';
	  cityId =  t.save[y]['cityId'];

		  var m = '<BR><TABLE id=pbRaidAdd height=0% class=pbTab><TR align="center">';
		  m+='<TR></tr><TR><TD width=25px>X= <INPUT id=toXCoord type=text size=3 maxlength=3 value='+t.save[y]['toXCoord']+'></td>';
		  m+='<TD width=10px></td><TD widht=25px>Y= <INPUT id=toYCoord type=text size=3 maxlength=3 value='+ t.save[y]['toYCoord'] +'></td>';
		  m+='<TD width=25px></td><TD>Round Trip : '+ timestr((t.save[y]['returnUnixTime'] - t.save[y]['destinationUnixTime'])*2)+ '</td></tr></table>';

		  m += '<BR><TABLE id=pbRaidAdd width=100% height=0% class=pbTab><TR align="center">';
		  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_50.jpg?6545"></td>';
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt1']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt2']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt3']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt4']) +'</td></tr>'
		  m += '<TR><TD><INPUT id=Unit1 type=text size=6 maxlength=6 value="'+ t.save[y]['unit1Count']+'"></td>';
		  m += '<TD><INPUT id=Unit2 type=text size=6 maxlength=6 value="'+ t.save[y]['unit2Count']+'"></td>';
		  m += '<TD><INPUT id=Unit3 type=text size=6 maxlength=6 value="'+ t.save[y]['unit3Count']+'"></td>';
		  m += '<TD><INPUT id=Unit4 type=text size=6 maxlength=6 value="'+ t.save[y]['unit4Count']+'"></td></tr>';

		  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_50.jpg?6545"></td>';
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt5']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt6']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt7']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt8']) +'</td></tr>'
		  m += '<TR><TD><INPUT id=Unit5 type=text size=6 maxlength=6 value="'+ t.save[y]['unit5Count']+'"></td>';
		  m += '<TD><INPUT id=Unit6 type=text size=6 maxlength=6 value="'+ t.save[y]['unit6Count']+'"></td>';
		  m += '<TD><INPUT id=Unit7 type=text size=6 maxlength=6 value="'+ t.save[y]['unit7Count']+'"></td>';
		  m += '<TD><INPUT id=Unit8 type=text size=6 maxlength=6 value="'+ t.save[y]['unit8Count']+'"></td></tr>';

		  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_50.jpg?6545"></td>';
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt9']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt10']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt11']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt12']) +'</td></tr>'
		  m += '<TR><TD><INPUT id=Unit9 type=text size=6 maxlength=6 value="'+ t.save[y]['unit9Count']+'"></td>';
		  m += '<TD><INPUT id=Unit10 type=text size=6 maxlength=6 value="'+ t.save[y]['unit10Count']+'"></td>';
		  m += '<TD><INPUT id=Unit11 type=text size=6 maxlength=6 value="'+ t.save[y]['unit11Count']+'"></td>';
		  m += '<TD><INPUT id=Unit12 type=text size=6 maxlength=6 value="'+ t.save[y]['unit12Count']+'"></td></tr></table>';

		  m += '<BR><CENTER><SELECT id=AddKnights type=list></select></center>';
		  m+= '<BR><CENTER>'+ strButton20('Save', 'id=pbSaveRaid') +'</center>';

	  pop.getMainDiv().innerHTML = m;

	  t.getKnights(cityId);

	  document.getElementById ('AddKnights').value =  t.save[y]['knightId'];
	  document.getElementById ('pbSaveRaid').addEventListener ('click', function(){
	  			t.save[y]['knightId'] = parseInt(document.getElementById ('AddKnights').value);
	  			t.save[y]['toXCoord'] = parseInt(document.getElementById ('toXCoord').value);
	  			t.save[y]['toYCoord'] = parseInt(document.getElementById ('toYCoord').value);
	  			t.save[y]['unit1Count'] = parseInt(document.getElementById ('Unit1').value);
	  			t.save[y]['unit2Count'] = parseInt(document.getElementById ('Unit2').value);
	  			t.save[y]['unit3Count'] = parseInt(document.getElementById ('Unit3').value);
	  			t.save[y]['unit4Count'] = parseInt(document.getElementById ('Unit4').value);
	  			t.save[y]['unit5Count'] = parseInt(document.getElementById ('Unit5').value);
	  			t.save[y]['unit6Count'] = parseInt(document.getElementById ('Unit6').value);
	  			t.save[y]['unit7Count'] = parseInt(document.getElementById ('Unit7').value);
	  			t.save[y]['unit8Count'] = parseInt(document.getElementById ('Unit8').value);
	  			t.save[y]['unit9Count'] = parseInt(document.getElementById ('Unit9').value);
	  			t.save[y]['unit10Count'] = parseInt(document.getElementById ('Unit10').value);
	  			t.save[y]['unit11Count'] = parseInt(document.getElementById ('Unit11').value);
	  			t.save[y]['unit12Count'] = parseInt(document.getElementById ('Unit12').value);
	  			var serverID = getServerId();
	  			setTimeout (function (){GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));}, 0);
	  			pop.show (false);
	  }, false);

	  pop.show (true);
    },

  EditRaid : function (y){
  	  var t = Tabs.Raid;
  	  var pop = new CPopup ('pbEditRaid', 0,0, 750,350, true);
  	  if (t.popFirst){
  	    pop.centerMe (mainPop.getMainDiv());
  	    t.popFirst = false;
  	  }
  	  pop.getTopDiv().innerHTML = '<CENTER><B>Edit Raid</b></center>';
  	  cityId = t.rslt['queue'][y]['botMarches']['cityId'];

  		  var m = '<BR><TABLE id=pbRaidAdd height=0% class=pbTab><TR align="center">';
  		  m+='<TR></tr><TR><TD width=25px>X= <INPUT id=toXCoord type=text size=3 maxlength=3 value='+t.rslt['queue'][y]['botMarches']['toXCoord']+'></td>';
  		  m+='<TD width=10px></td><TD widht=25px>Y= <INPUT id=toYCoord type=text size=3 maxlength=3 value='+ t.rslt['queue'][y]['botMarches']['toYCoord'] +'></td>';
  		  m+='<TD width=25px></td><TD>Round Trip: '+ timestr((t.rslt['queue'][y]['botMarches']['returnUnixTime'] - t.rslt['queue'][y]['botMarches']['destinationUnixTime'])*2)+ '</td></tr></table>';

  		  m += '<BR><TABLE id=pbRaidAdd width=100% height=0% class=pbTab><TR align="center">';
  		  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_50.jpg?6545"></td>';
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt1']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt2']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt3']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt4']) +'</td></tr>'
  		  m += '<TR><TD><INPUT id=Unit1 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit1Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit2 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit2Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit3 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit3Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit4 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit4Count']+'"></td></tr>';

  		  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_50.jpg?6545"></td>';
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt5']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt6']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt7']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt8']) +'</td></tr>'
  		  m += '<TR><TD><INPUT id=Unit5 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit5Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit6 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit6Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit7 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit7Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit8 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit8Count']+'"></td></tr>';

  		  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_50.jpg?6545"></td>';
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt9']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt10']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt11']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt12']) +'</td></tr>'
  		  m += '<TR><TD><INPUT id=Unit9 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit9Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit10 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit10Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit11 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit11Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit12 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit12Count']+'"></td></tr></table>';

  		  m += '<BR><CENTER><SELECT id=AddKnights type=list></select></center>';
  		  m+= '<BR><CENTER>'+ strButton20('Save', 'id=pbRaidSave') +'</center>';

  	  pop.getMainDiv().innerHTML = m;

  	  t.getKnights(cityId);

  	  document.getElementById ('AddKnights').value =  t.rslt['queue'][y]['botMarches']['knightId'];
  	  document.getElementById ('pbRaidSave').addEventListener ('click', function(){
  	  	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

  	  	params.pf = 0;
  	      params.ctrl = 'BotManager';
  	  	params.action = 'editMarch';
  	  	params.settings = {};
  	  	params.settings.cityId = t.rslt['queue'][y]['botMarches']['fromCityId'];
  	  	params.queue = {0:{botMarches:{botMarchStatus:1,botState:1},cityMarches:{}}};
  	  	params.queue[0].cityMarches.knightId = parseInt(document.getElementById ('AddKnights').value);
  	  	params.queue[0].cityMarches.toXCoord =  parseInt(document.getElementById ('toXCoord').value);
  	  	params.queue[0].cityMarches.toYCoord =  parseInt(document.getElementById ('toYCoord').value);
  	  	params.queue[0].cityMarches.unit0Count = 0; //document.getElementById ('Unit0').value;
  	  	params.queue[0].cityMarches.unit1Count =  parseInt(document.getElementById ('Unit1').value);
  	  	params.queue[0].cityMarches.unit2Count = parseInt(document.getElementById ('Unit2').value);
  	  	params.queue[0].cityMarches.unit3Count = parseInt(document.getElementById ('Unit3').value);
  	  	params.queue[0].cityMarches.unit4Count = parseInt(document.getElementById ('Unit4').value);
  	  	params.queue[0].cityMarches.unit5Count = parseInt(document.getElementById ('Unit5').value);
  	  	params.queue[0].cityMarches.unit6Count = parseInt(document.getElementById ('Unit6').value);
  	  	params.queue[0].cityMarches.unit7Count = parseInt(document.getElementById ('Unit7').value);
  	  	params.queue[0].cityMarches.unit8Count = parseInt(document.getElementById ('Unit8').value);
  	  	params.queue[0].cityMarches.unit9Count = parseInt(document.getElementById ('Unit9').value);
  	  	params.queue[0].cityMarches.unit10Count = parseInt(document.getElementById ('Unit10').value);
  	  	params.queue[0].cityMarches.unit11Count = parseInt(document.getElementById ('Unit11').value);
  	  	params.queue[0].cityMarches.unit12Count = parseInt(document.getElementById ('Unit12').value);
  	  	params.queue[0].cityMarches.marchId =  t.rslt['queue'][y]['botMarches']['marchId'];

  	  	 new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  				  		method: "post",
  				         parameters: params,
  						 loading: true,
  						 onSuccess: function(transport){
  							var rslt = eval("(" + transport.responseText + ")");
  		                      if (rslt.ok) {
  		                      		pop.show (false);
  									unsafeWindow.cityinfo_army();
  		                          setTimeout(unsafeWindow.update_seed_ajax, 250);
  		                          setTimeout(t.GetRaids, (750),Seed.cities[i][0]);
  								}
  						 },
  				 });
  	  	}, false);

  	  pop.show (true);
  },

  DeleteRaid : function (Id){
  	var t = Tabs.Raid;
  	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

  	for (y in t.rslt['queue']) {
  		if (t.rslt['queue'][y]['botMarches'] != undefined) {
	  		if (t.rslt['queue'][y]['botMarches']['marchId'] == Id) {
	  				marchId = t.rslt['queue'][y]['botMarches']['marchId'];
	  				cityId = t.rslt['queue'][y]['botMarches']['cityId'];
	  				knightId = t.rslt['queue'][y]['botMarches']['knightId'];
	  				toTileLevel = t.rslt['queue'][y]['botMarches']['toTileLevel'];
	  				returnUnixTime = t.rslt['queue'][y]['botMarches']['returnUnixTime'];
	  				destinationUnixTime = t.rslt['queue'][y]['botMarches']['destinationUnixTime'];
	  				toXCoord = t.rslt['queue'][y]['botMarches']['toXCoord'];
	  				toYCoord = t.rslt['queue'][y]['botMarches']['toYCoord'];
	  				var units = {};
	  				for (i=1;i<13;i++) units[i] = t.rslt['queue'][y]['botMarches']['unit'+i+'Count'];
	  		}
	  	}
  	}

  	params.pf = 0;
  	params.ctrl = 'BotManager';
  	params.action = 'deleteMarch';
  	params.marchId = marchId;
  	params.settings = {};
  	params.settings.cityId = cityId;

    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  	         method: "post",
  	         parameters: params,
  			 loading: true,
  			 onSuccess: function(transport){
  				var rslt = eval("(" + transport.responseText + ")");
  	              if (rslt.ok) {
  	              	  var serverID = getServerId();
  	              	  t.save = GM_getValue ('SavedRaids_'+serverID);
  	              	  if (t.save == undefined) t.save =new Array();
					  else t.save = JSON2.parse (t.save);

  	              	  t.save.push ({
  	              	  	marchId:		marchId,
  	              	  	cityId:   		cityId,
  	              	  	knightId:		knightId,
  	              	  	toTileLevel:	toTileLevel,
  	              	  	returnUnixTime:	destinationUnixTime,
  	              	  	returnUnixTime:	returnUnixTime,
  	              	  	toXCoord:		toXCoord,
  	              	  	toYCoord:		toYCoord,
  	              	  	unit1Count: 	units[1],
  	              	  	unit2Count: 	units[2],
  	              	  	unit3Count: 	units[3],
  	              	  	unit4Count: 	units[4],
  	              	  	unit5Count: 	units[5],
  	              	  	unit6Count: 	units[6],
  	              	  	unit7Count: 	units[7],
  	              	  	unit8Count: 	units[8],
  	              	  	unit9Count: 	units[9],
  	              	  	unit10Count: 	units[10],
  	              	  	unit11Count: 	units[11],
  	              	  	unit12Count: 	units[12],
  	              	  });
  	              	  var troops = Seed.units["city" + cityId];
                      for (var u = 1; u <= 12; ++u) {
                          var troop_number = parseInt(rslt["unit" + u + "Return"]);
                          if (isNaN(troop_number)) {
                              troop_number = parseInt(Seed.units["city" + cityId]["unt" + u]);
                          } else troop_number = parseInt(rslt["unit" + u + "Return"]) + parseInt(Seed.units["city" + cityId]["unt" + u]);
                          troops["unt" + u] = troop_number;
                      }
                      for (u in Seed.queue_atkp['city' + cityId]){
                      	if (Seed.queue_atkp['city' + cityId][u]['marchId'] == marchId){
							Seed.queue_atkp['city' + cityId][u] = "";
                      		unsafeWindow.seed.queue_atkp['city' + cityId] = Seed.queue_atkp['city' + cityId];
                      	}
                      }

                      for (u in Seed.knights['city' + cityId]){
                      	if (Seed.knights['city' + cityId][u]['knightId'] == knightId){
                      		Seed.knights['city' + cityId][u]["knightStatus"] = 1;
                      		unsafeWindow.seed.knights['city' + cityId] = Seed.knights['city' + cityId];
                      	}
                      }

  	              	  GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));
  	              	  t.save = null;
                      unsafeWindow.cityinfo_army();
  	                  setTimeout(unsafeWindow.update_seed_ajax, 250);
  	                  t.GetRaids(cityId);
  					}
  			 },
  	 });
},

  StopCityRaids : function (cityId){
    	var t = Tabs.Raid;
    	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);


    	params.pf = 0;
    	params.ctrl = 'BotManager';
    	params.action = 'stopAll';
    	params.settings = {};

  	    params.settings.cityId = cityId;

    	 new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
    		  		method: "post",
    		         parameters: params,
    				 loading: true,
    				 onSuccess: function(transport){
    					var rslt = eval("(" + transport.responseText + ")");
    	                  if (rslt.ok) {

    					  }
    				 },
    		 });
    setTimeout(t.GetRaids, (750), cityId);
    },

  StopAllRaids : function (){
      	var t = Tabs.Raid;
      	if (t.stopping == true || t.resuming == true || t.deleting == true) return;
      	if (t.activecount == 0) return;
	    t.stopping = true;
	      	for (i=0;i<Seed.cities.length;i++){
		      	setTimeout(t.DoAllStop, (i*1500),i);
		     }
   },

   ResumeAllRaids : function (){
       	var t = Tabs.Raid;
       	if (t.stopping == true || t.resuming == true || t.deleting == true) return;
       	if (t.stopcount == 0) return;
       	t.resuming = true;
   			for (i=0;i<Seed.cities.length;i++){
   			    setTimeout(t.DoAllResume, (i*1500),i);
   			}
    },


   DeleteAllRaids : function (){
       	var t = Tabs.Raid;
       	if (t.stopping == true || t.resuming == true || t.deleting == true) return;
       	if (t.stopcount == 0) return;
       	t.deleting = true;
       	count=0;
       	t.count = t.stopcount;
	for (d=0; d< Seed.cities.length;d++) {
	   cityID = 'city' + Seed.cities[d][0];
							for (e in Seed.queue_atkp[cityID]){
								destinationUnixTime = Seed.queue_atkp[cityID][e]['destinationUnixTime'];
								MarchStatus = Seed.queue_atkp[cityID][e]['marchStatus'];
								MarchType = Seed.queue_atkp[cityID][e]['marchType'];
								if (MarchType == 9 && (botMarchStatus == 3 || MarchStatus == 3)) {
									count++;
									setTimeout(t.DoAllDelete, (count*1250), (Seed.queue_atkp[cityID][e]['marchId']),d,count);
								}
							}
				}
    },


  DoAllStop: function(i) {
    var t = Tabs.Raid;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  	params.pf = 0;
  	params.ctrl = 'BotManager';
  	params.action = 'stopAll';
  	params.settings = {};
  	params.settings.cityId = Seed.cities[i][0];

  		 new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  			  		method: "post",
  			         parameters: params,
  					 loading: true,
  					 onSuccess: function(transport){
  						var rslt = eval("(" + transport.responseText + ")");
  		                  if (rslt.ok) {
  		                  		t.stopprogress = t.stopprogress + (100/Seed.cities.length);

  		                  		if (ById("pbraidtab")) ById("pbraidtab").value='Stopping: '+ t.stopprogress.toFixed(0) + '%';
  		                  		if (t.stopprogress.toFixed(0) == 100) {
  		                  			 t.stopprogress = 0;
  		                  			 setTimeout(
  		                  			 function(){
  		                  			  if (ById("pbraidtab")) ById("pbraidtab").value=lang.RAID.stop+' ('+ t.activecount + ')';
  		                  			  t.stopping = false;

  		                  			 }, (5000));

  		                  		}
  						  }
  						  else {
  						  		if (rslt.msg == "The system is busy, please try again later") setTimeout (t.DoAllStop, (2000),i);
  						  		else {
  					 	  			t.stopprogress = t.stopprogress + (100/Seed.cities.length);
  					 	  		        if (ById("pbraidtab")) ById("pbraidtab").value='Stopping: '+ t.stopprogress.toFixed(0) + '%';

  					 	  			if (t.stopprogress.toFixed(0) == 100) {
  					 	  				 t.stopprogress = 0;
  					 	  				 setTimeout(function(){
  					 	  				 if (ById("pbraidtab")) ById("pbraidtab").value=lang.RAID.stop+' ('+ t.activecount + ')';
  					 	  				 t.stopping = false;
  					 	  				 }, (5000));

  					 	  			}
  					 	  		}
  					 	  }
  					 },
    });
  },

  DoAllResume: function(i) {
    var t = Tabs.Raid;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  	params.pf = 0;
  	params.ctrl = 'BotManager';
  	params.action = 'resumeAll';
  	params.settings = {};
    params.settings.cityId = Seed.cities[i][0];

  		 new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  			  		method: "post",
  			         parameters: params,
  					 loading: true,
  					 onSuccess: function(transport){
  						var rslt = eval("(" + transport.responseText + ")");
  		                  if (rslt.ok) {
  		                  		t.stopprogress = t.stopprogress + (100/Seed.cities.length);
  		                  		if (ById("pbraidtabRes")) ById("pbraidtabRes").value='Resuming: '+ t.stopprogress.toFixed(0) + '%';
  		                  		if (t.stopprogress.toFixed(0) == 100) {
  		                  			 t.stopprogress = 0;
  		                  			 setTimeout(function(){

  		                  			 if (ById("pbraidtabRes")) ById("pbraidtabRes").value='Resume Raids ('+ t.stopcount + ')';

  		                  			 t.resuming = false;
  		                  			 }, (5000));
  		                  		}
  						  } else {
  						  		if (rslt.msg == "The system is busy, please try again later") setTimeout (t.DoAllResume, (2000),i);
  						  		else {
  					 	  			t.stopprogress = t.stopprogress + (100/Seed.cities.length);
  					 	  			if (ById("pbraidtabRes")) ById("pbraidtabRes").value='Resuming: '+ t.stopprogress.toFixed(0) + '%';
  					 	  			if (t.stopprogress.toFixed(0) == 100) {
  					 	  				 t.stopprogress = 0;
  					 	  				 setTimeout(function(){
  					 	  				 if (ById("pbraidtabRes")) ById("pbraidtabRes").value='Resume Raids ('+ t.stopcount + ')';
  					 	  				 t.resuming = false;}, (5000));
  					 	  			}
  					 	  		}
  					 	  }
  					 },
    });
  },

  DoAllDelete : function (Id,city,count){
    	var t = Tabs.Raid;
    	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    	cityID = 'city'+ Seed.cities[city][0];
    	for (f in Seed.queue_atkp[cityID]){
    		if (Seed.queue_atkp[cityID][f]['marchId'] == Id) {
    				marchId = Seed.queue_atkp[cityID][f]['marchId'];
    				cityId = Seed.queue_atkp[cityID][f]['cityId'];
    				knightId = Seed.queue_atkp[cityID][f]['knightId'];
    				toTileLevel = Seed.queue_atkp[cityID][f]['toTileLevel'];
    				returnUnixTime = Seed.queue_atkp[cityID][f]['returnUnixTime'];
    				destinationUnixTime = Seed.queue_atkp[cityID][f]['destinationUnixTime'];
    				toXCoord = Seed.queue_atkp[cityID][f]['toXCoord'];
    				toYCoord = Seed.queue_atkp[cityID][f]['toYCoord'];
    				var units = {};
    				for (i=1;i<13;i++) units[i] = Seed.queue_atkp[cityID][f]['unit'+i+'Count'];
    		}
    	}

    	params.pf = 0;
    	params.ctrl = 'BotManager';
    	params.action = 'deleteMarch';
    	params.marchId = marchId;
    	params.settings = {};
    	params.settings.cityId = cityId;

      new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
    	         method: "post",
    	         parameters: params,
    			 loading: true,
    			 onSuccess: function(transport){
    				var rslt = eval("(" + transport.responseText + ")");
    	              if (rslt != "") {
    	              	  var serverID = getServerId();
    	              	  t.save = GM_getValue ('SavedRaids_'+serverID, "[]");
    	              	  if (t.save != undefined) t.save = JSON2.parse (t.save);
    	              	  if (t.save == undefined) t.save =new Array();

    	              	  t.save.push ({
    	              	  	marchId:		marchId,
    	              	  	cityId:   		cityId,
    	              	  	knightId:		knightId,
    	              	  	toTileLevel:	toTileLevel,
    	              	  	returnUnixTime:	destinationUnixTime,
    	              	  	returnUnixTime:	returnUnixTime,
    	              	  	toXCoord:		toXCoord,
    	              	  	toYCoord:		toYCoord,
    	              	  	unit1Count: 	units[1],
    	              	  	unit2Count: 	units[2],
    	              	  	unit3Count: 	units[3],
    	              	  	unit4Count: 	units[4],
    	              	  	unit5Count: 	units[5],
    	              	  	unit6Count: 	units[6],
    	              	  	unit7Count: 	units[7],
    	              	  	unit8Count: 	units[8],
    	              	  	unit9Count: 	units[9],
    	              	  	unit10Count: 	units[10],
    	              	  	unit11Count: 	units[11],
    	              	  	unit12Count: 	units[12],
    	              	  });

    	              	  var troops = Seed.units["city" + cityId];
    	              	  for (var u = 1; u <= 12; ++u) {
    	              	      var troop_number = parseInt(rslt["unit" + u + "Return"]);
    	              	      if (isNaN(troop_number)) {
    	              	          troop_number = parseInt(Seed.units["city" + cityId]["unt" + u]);
    	              	      } else troop_number = parseInt(rslt["unit" + u + "Return"]) + parseInt(Seed.units["city" + cityId]["unt" + u]);
    	              	      troops["unt" + u] = troop_number;
    	              	  }

    	              	  setTimeout (function (){GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));}, 0);
                          unsafeWindow.cityinfo_army();
    	                  setTimeout(unsafeWindow.update_seed_ajax, 250);
    					}
    			 },
    	 });
  		  	 t.stopprogress = count * (100/t.count);
 		  	 if (ById("pbraidtabRes")) ById("pbraidtabDel").value='Deleting: '+ t.stopprogress.toFixed(0) + '%';
  		  	 if (t.stopprogress.toFixed(0) == 100) {
  		  	 	 t.stopprogress = 0;
  		  	 	 t.GetRaids(cityId);
  	}

},
AddRaid : function (Id){
    	var t = Tabs.Raid;
    	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    	update = {};

    	params.pf = 0;
    	params.ctrl = 'BotManager';
    	params.action = 'saveMarch';
    	params.settings = {};
    	params.queue = {0:{botMarches:{botMarchStatus:1,botState:1},cityMarches:{}}};

    	for (y in t.save){
    		if (t.save[y]['marchId'] == Id){
	    		params.settings.cityId = t.save[y]['cityId'];
	    		params.queue[0].cityMarches.knightId = t.save[y]['knightId'];
	    		params.queue[0].cityMarches.toXCoord = t.save[y]['toXCoord'];
	    		params.queue[0].cityMarches.toYCoord = t.save[y]['toYCoord'];
	    		params.queue[0].cityMarches.unit0Count = 0;
	    		params.queue[0].cityMarches.unit1Count = t.save[y]['unit1Count'];
	    		params.queue[0].cityMarches.unit2Count = t.save[y]['unit2Count'];
	    		params.queue[0].cityMarches.unit3Count = t.save[y]['unit3Count'];
	    		params.queue[0].cityMarches.unit4Count = t.save[y]['unit4Count'];
	    		params.queue[0].cityMarches.unit5Count = t.save[y]['unit5Count'];
	    		params.queue[0].cityMarches.unit6Count = t.save[y]['unit6Count'];
	    		params.queue[0].cityMarches.unit7Count = t.save[y]['unit7Count'];
	    		params.queue[0].cityMarches.unit8Count = t.save[y]['unit8Count'];
	    		params.queue[0].cityMarches.unit9Count = t.save[y]['unit9Count'];
	    		params.queue[0].cityMarches.unit10Count = t.save[y]['unit10Count'];
	    		params.queue[0].cityMarches.unit11Count = t.save[y]['unit12Count'];
	    		params.queue[0].cityMarches.unit12Count = t.save[y]['unit12Count'];
    		}
    	}

    	 new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
    		  		method: "post",
    		         parameters: params,
    				 loading: true,
    				 onSuccess: function(transport){
    					var rslt = eval("(" + transport.responseText + ")");
    	                  if (rslt.ok) {
								t.GetRaids(params.settings.cityId);
      					        unsafeWindow.cityinfo_army();
      	                  		setTimeout(unsafeWindow.update_seed_ajax, 250);
      	                  		for (yy=0;yy<t.save.length;yy++){
      	                  			if (t.save[yy]['marchId'] == Id){
      	                  				  t.save.splice (yy,1);
      	                  			}
      	                  		}
      	                  		var serverID = getServerId();
      	                  		setTimeout (function (){GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));}, 0);
      	                  		t.paint();
    					 } else {
  				 		  	  alert('Error: '+ rslt.msg);
    					 }
    				 },
    		 });
    },


  getKnights : function(cityId){
         var t = Tabs.Raid;
         var knt = new Array();
         var status ="";
         for (k in Seed.knights['city' + cityId]){
         		if ( Seed.leaders['city' + cityId]["resourcefulnessKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["politicsKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["combatKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["intelligenceKnightId"] != Seed.knights['city' + cityId][k]["knightId"]){
         		   if (Seed.knights['city' + cityId][k]["knightStatus"] == 1 ) status = "Free";
         		   else status = "Marching";
         			knt.push ({
         				Name:   Seed.knights['city' + cityId][k]["knightName"],
         				Combat:	parseInt(Seed.knights['city' + cityId][k]["combat"]),
         				ID:		Seed.knights['city' + cityId][k]["knightId"],
         				Status: status,
         			});
         		}
         }
         knt = knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
         ById('AddKnights').options.length=0;
  		var o = document.createElement("option");
  		o.text = '--Choose a Knight--';
  		o.value = 0;
  		ById("AddKnights").options.add(o);
         for (k in knt){
      			if (knt[k]["Name"] !=undefined){
  	    			var o = document.createElement("option");
  	    			o.text = (knt[k]["Name"] + ' (' + knt[k]["Combat"] +') (' + knt[k]["Status"] +')');
  	    			o.value = knt[k]["ID"];
  	    			ById("AddKnights").options.add(o);
      			}
      	}
      },


  clickCitySelect : function (city){
  	var t = Tabs.Raid;
  	t.cityId = city['id'];
  	t.GetRaids(t.cityId);
  },

  checkRaids : function (){
	var t = Tabs.Raid;
	var now = unixTime();
	if(!Options.RaidRunning) return;
	if ( (now - Options.RaidReset) > 7200 ) {
		Options.RaidReset = now;
		saveOptions();
		for (g=0;g<Seed.cities.length;g++){
				t.citiesdone = "";
				setTimeout(t.resetRaids, (1500*g), Seed.cities[g][0],Seed.cities[g][1]);
		}
	}
	t.raidtimer = setTimeout(t.checkRaids, 60*60*1000); // toute les heures !
  },

  GetRaids : function(cityId){
  		var t = Tabs.Raid;
  		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

  		params.pf = 0;
  		params.ctrl = 'BotManager';
  		params.action = 'getMarches';
  		params.settings = {};
  		params.settings.cityId = cityId;


   		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  		         method: "post",
  		         parameters: params,
  				 loading: true,
  				 onSuccess: function(transport){
  					var rslt = eval("(" + transport.responseText + ")");

                        if (rslt.ok) {
                        	t.rslt = rslt;
  							t.paint();
  							unsafeWindow.cityinfo_army();
  							setTimeout(unsafeWindow.update_seed_ajax, 250);
  						}
  				 },
  		 });
  },

  resetRaids : function(cityId,cityName){
  		var t = Tabs.Raid;
  		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

  		params.pf = 0;
  		params.ctrl = 'BotManager';
  		params.action = 'resetRaidTimer';
		params.settings = {};
  		params.settings.cityId = cityId;


   		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  		         method: "post",
  		         parameters: params,
				 loading: true,
				 onSuccess: function(transport){
					var rslt = eval("(" + transport.responseText + ")");
                        if (rslt.ok) {
                          actionLog("RAID","Minuteur RAID remis a zero sur "+cityName);
			  unsafeWindow.cityinfo_army();
                            setTimeout(unsafeWindow.update_seed_ajax, 250);
                            t.citiesdone += cityName + ' ';
						}
				 },
  		 });
  },
  sendreport: function(){
	  var t = Tabs.Raid;
	  if(!Options.foodreport) return;
	  var now = new Date().getTime()/1000.0;
      now = now.toFixed(0);
      if (now < (parseInt(Options.LastReport)+(Options.MsgInterval*60*60))) return;

	var total = 0;
    var message = 'Raid Stats: %0A';
    message += '%0A Food Gain (for '+ Options.MsgInterval +' hour of raiding) %0A';
    for (q=1;q<=Seed.cities.length;q++){
    	var cityID = 'city' + Seed.cities[q-1][0];
    	var gain = parseInt(Seed.resources[cityID]['rec1'][0] / 3600) - Options.Foodstatus[q];
    	message+= Seed.cities[q-1][1] + ': Start: ' + addCommas(Options.Foodstatus[q]) + ' End :' + addCommas(parseInt(Seed.resources[cityID]['rec1'][0] / 3600)) + ' Gain: ';
    	message += addCommas(gain)  + '%0A';
		total += gain;
		Options.Foodstatus[q] = parseInt(Seed.resources[cityID]['rec1'][0] / 3600);
    }
	message += '%0A Total food gain : '+addCommas(total)+'%0A';

    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.emailTo = Seed.player['name'];
    params.subject = "Raid Overview";
    params.message = message;
    params.requestType = "COMPOSED_MAIL";
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function (message) {
            var rslt = eval("(" + message.responseText + ")");
            if (rslt.ok) {
            } else {
            }
        },
        onFailure: function () {
        },
    });

    Options.LastReport = now;
    saveOptions();
  },

  toggleRaidState : function (){
  	var t = Tabs.Raid;
  	if(Options.RaidRunning){
  		Options.RaidRunning = false;
  		t.raidtimer = null;
  		ById('pbRaidStart').value = 'Auto Reset = OFF';
  	} else {
  		Options.RaidRunning = true;
  		t.raidtimer = setTimeout(t.checkRaids, 5000);
  		ById('pbRaidStart').value = 'Auto Reset = ON';
  	}
  	saveOptions();
  },


  hide : function (){
   var t = Tabs.Raid;
   clearInterval(t.timerPaint);
   clearInterval(t.timerLookup);
  },

  show : function (){
   var t = Tabs.Raid;
   clearInterval(t.timerPaint);
   clearInterval(t.timerLookup);
   t.timerPaint = setInterval (t.paint,2000);
   t.timerLookup = setInterval(t.lookup, 3500);
  },
 };

unsafeWindow.ptGotoMap = function (x, y){
  setTimeout (function (){
    ById('mapXCoor').value = x;
    ById('mapYCoor').value = y;
    unsafeWindow.reCenterMapWithCoor();
    var a = ById("mod_views").getElementsByTagName("a");
    for (var b = 0; b < a.length; b++) {
        a[b].className = ""
    }
    ById('mod_views_map').className = "sel";
    ById("maparea_city").style.display = 'none';
    ById("maparea_fields").style.display = 'none';
    ById("maparea_map").style.display = 'block';
    unsafeWindow.tutorialClear()
  }, 0);
};

function clickWinBO(win,obj,evtName) {
	var evt = win.document.createEvent("MouseEvents");
	evt.initMouseEvent(evtName, true, true, win, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
	return !obj.dispatchEvent(evt);
}
  function searchDOM (node, condition, maxLevel, doMult){
    var found = [];
    eval ('var compFunc = function (node) { return ('+ condition +') }');
    doOne(node, 1);
    if(!doMult){
      if (found.length==0)
        return null;
      return found[0];
    }
    return found;
    function doOne (node, curLevel){
      try {
        if (compFunc(node))
          found.push(node);
      } catch (e){
      }
      if (!doMult && found.length>0)
        return;
      if (++curLevel<maxLevel && node.childNodes!=undefined)
        for (var c=0; c<node.childNodes.length; c++)
          doOne (node.childNodes[c], curLevel);
    }
  }

function CwaitForElement (id, timeout, notify){
  this.check = check;
  this.end = new Date().getTime() + timeout;
  var t = this;
  this.check();
  function check(){
    if (document.getElementById (id))
      notify (true);
    else if (new Date().getTime() > t.end)
      notify (false);
    else
      setTimeout (t.check, 250);
  }
}
function ThroneItemName(e) {
  return e.createPrefix()+" "+e.type+" "+e.faction+" +"+e.level;
}
function CdialogCancelContinue (msg, canNotify, contNotify, centerElement,title){
  var pop = new CPopup ('ptcancont', 10, 10, 400,210, true, canNotify);
  if (centerElement)
    pop.centerMe(centerElement);

  if (title)
   pop.getTopDiv().innerHTML = '<b><CENTER>'+title+'</center></b>';
  else
   pop.getTopDiv().innerHTML = '<CENTER>ATTENTION</center>';
  pop.getMainDiv().innerHTML = '<div style="overflow-y:auto;max-height:160px;"><TABLE class=ptTab align=center style="height: 100%"><TR align=center height=90%><TD>'+ msg +'</td></tr>\
      <TR align=center><TD><INPUT id=ptok type=submit value="OK" \> &nbsp; &nbsp; </td></tr></table></div>';
  document.getElementById('ptok').addEventListener ('click', function (){pop.destroy(false); if (canNotify) canNotify();}, false);
  pop.show(true);
}

function saveAttackOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('AttackOptions_'+serverID, JSON2.stringify(AttackOptions));}, 0);
}
function readAttackOptions (){
  var serverID = getServerId();
  s = GM_getValue ('AttackOptions_'+serverID);
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
          AttackOptions[k][kk] = opts[k][kk];
      else
        AttackOptions[k] = opts[k];
    }
  }
}
function saveThroneOptions() {
    var serverID = getServerId();
    setTimeout(function () {
        GM_setValue('ThroneOptions_' + serverID, JSON2.stringify(ThroneOptions));
    }, 0);
}

function readThroneOptions() {
    var serverID = getServerId();
    s = GM_getValue('ThroneOptions_' + serverID);
    if (s != null) {
        opts = JSON2.parse(s);
        for (k in opts) {
            if (matTypeof(opts[k]) == 'object') for (kk in opts[k])
            ThroneOptions[k][kk] = opts[k][kk];
            else ThroneOptions[k] = opts[k];
        }
    }
}
function saveFarmOptions() {
    var serverID = getServerId();
    setTimeout(function () {
        GM_setValue('FarmOptions_' + serverID, JSON2.stringify(FarmOptions));
    }, 0);
}
function readFarmOptions() {
    var serverID = getServerId();
    s = GM_getValue('FarmOptions_' + serverID);
    if (s != null) {
        opts = JSON2.parse(s);
        for (k in opts) {
            if (matTypeof(opts[k]) == 'object') for (kk in opts[k])
            FarmOptions[k][kk] = opts[k][kk];
            else FarmOptions[k] = opts[k];
        }
    }
}
function saveApothecaryOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('ApothecaryOptions_' + Seed.player['name'] + '_' +serverID, JSON2.stringify(ApothecaryOptions));}, 0);
}
function readApothecaryOptions (){
  var serverID = getServerId();
  s = GM_getValue ('ApothecaryOptions_'+Seed.player['name']+'_'+serverID, '[]');
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
          ApothecaryOptions[k][kk] = opts[k][kk];
      else
        ApothecaryOptions[k] = opts[k];
    }
  }
}

/*******************   KOC Map interface ****************/
// 0:bog, 10:grassland, 11:lake, 20:woods, 30:hills, 40:mountain, 50:plain, 51:city / barb, 53:misted city
function CMapAjax (){
  this.normalize = normalize;
  this.request = request;

  function request (left, top, width, notify){
    var left = parseInt(left / 5) * 5;
    var top = parseInt(top / 5) * 5;
    var width = parseInt((width+4) / 5) * 5;

    var blockString = generateBlockList(left, top, width);
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.blocks = blockString;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify(left, top, width, rslt);
      },
      onFailure: function (rslt) {
        notify(left, top, width, rslt);
      }
    });
    function generateBlockList (left, top, width) {
      var width5 = parseInt(width / 5);
      var bl = [];
      for (x=0; x<width5; x++){
        var xx = left + (x*5);
        if (xx > 745)
          xx -= 750;
        for (y=0; y<width5; y++){
          var yy = top + (y*5);
          if (yy > 745)
            yy -= 750;
          bl.push ('bl_'+ xx +'_bt_'+ yy);
        }
      }
      return bl.join(",");
    }
  }

  function normalize  (x){
    if ( x >= 750)
      x -= 750;
    else if (x < 0)
      x += 750;
    return parseInt (x/5) * 5;
  }
}

function inspect(obj, maxLevels, level, doFunctions){
  var str = '', type, msg;
  if(level == null)  level = 0;
  if(maxLevels == null) maxLevels = 1;
  if(maxLevels < 1)
      return 'Inspect Error: Levels number must be > 0';
  if(obj == null)
    return 'ERROR: Object is NULL\n';
  var indent = '';
  for (var i=0; i<level; i++)
    indent += '  ';
  for(property in obj) {

    try {
        type =  matTypeof(obj[property]);
        if (doFunctions==true && (type == 'function')){
          str += indent + '(' + type + ') ' + property + "[FUNCTION]\n   " + ( (obj[property]==null)?(': null'):('')) +' = '+ obj[property] +"\n";
        } else if (type != 'function') {
          str += indent + '(' + type + ') ' + property + ( (obj[property]==null)?(': null'):('')) +' = '+ obj[property] +"\n";
        }
        if((type=='object' || type=='array') && (obj[property] != null) && (level+1 < maxLevels))
          str += inspect(obj[property], maxLevels, level+1, doFunctions);
    }
    catch(err) {
      if(typeof(err) == 'string') msg = err;
      else if(err.message)        msg = err.message;
      else if(err.description)    msg = err.description;
      else                        msg = 'Unknown';
      str += '(Error) ' + property + ': ' + msg +"\n";
    }
  }
  str += "\n";
  return str;
}

var messageNav = {
   mmFunc : null,   MapFunc :null,
   mmsFunc : null,
   init : function (){
     t = messageNav;
     t.MapFunc = new CalterUwFunc ('modal_maptile', [[/}\s*$/, 'setTimeout(function() { BOMdal_hook(j,k,m,a); },0); }']]);
     t.mmFunc = new CalterUwFunc ('modal_messages', [[/}\s*$/, 'setTimeout(messageNav_hook,0); }']]);
     t.mmsFunc = new CalterUwFunc ('modal_messages_send', [[/{\s*var params/i, '{\nif (modal_messages_send_hook()) return;\nvar params']]);
     unsafeWindow.messageNav_hook = t.hook;
     unsafeWindow.BOMdal_hook = t.testons;
     unsafeWindow.modal_messages_send_hook = t.msgSendHook;
     t.mmFunc.setEnable (true);
     t.mmsFunc.setEnable (true);
     t.MapFunc.setEnable (true);
   },
  setEnable : function (tf){
  },
  isAvailable : function (){
    t = messageNav;
    return t.mmFunc.isAvailable();
  },
  testons :function(uid,x,y,a) {

      var div = ById('contextMenu');

      //if (uid=="11653192" || uid=="14904449" || uid=="11657114"){div.innerHTML="<center><img src=http://www.educol.net/tete-de-mort-t16657.jpg></center>";return;}
      var scr = document.createElement('div');
      scr.className = "buttons";
      scr.innerHTML = '<li><a class="buttonv2 red h20" href="javascript:void(0);" onclick="boshowthrone('+uid+');">'+uW.g_js_strings.commonstr.throneroom+'</a></li>';
      div.appendChild(scr);
      var scr = document.createElement('div');
      scr.innerHTML = '<br><a href="javascript:void(0)" onclick="cm.utils.CoordinateLinkController.onClick(event)" class="coordinateLink">('+x+','+y+')</a><br>'+uW.provincenames['p'+a]+' ';
      scr.className = "maptilewrap";
      div.appendChild(scr);
       if (uid!=null && uid!=0 && uid!="0") {
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.checkArr = uid;
      new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getOnline.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
      onSuccess: function (rslt) {
         var p = rslt.data;
	 if (p[uid] == true) {
	         m = '<br><span style="color:green"><b>'+uW.g_js_strings.commonstr.online+'</b></span>';
	         scr.innerHTML += m;
	       } else {
	          m = '<br></b> <span style="color:red;text-decoration:line-through;"><b>'+uW.g_js_strings.commonstr.online+'</b></span>';
	          scr.innerHTML += m;
	        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.pid = uid;
      new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/viewCourt.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
      onSuccess: function (rslt) {
         if (rslt.ok) {
           scr.innerHTML += '<br><span style="color:green"><b>'+rslt.playerInfo.lastLogin+'</b></span>';
         }

         },onFailure: function (rslt) {},

         });

      }


    },onFailure: function (rslt) {},
    });
   }
  },
  hook : function (){
    if (!Options.enhanceMsging)
      return;
    var div = ById('modal_msg_view_actions');
    div = ById('modal_msg_write_to').parentNode;
    div.innerHTML = '<TABLE><TR><TD class=xtab><b>A :</b> <INPUT type=text id=modal_msg_write_to></td>\
    <TD class=xtab></td></tr>\
    <tr><td></td><td></td></tr></table>\
    <table><tr><TD colspan=2><SPAN id=pt2fwdbut></span></td></tr></table>';
    ById('pt2fwdbut').innerHTML="Cc : <INPUT type=text id=message_cc>";
  },
  eventForward : function (){
    ById('modal_msg_write_subj').value = "TR: " + ById('modal_msg_view_subj').innerHTML.toString().stripTags();
    ById('modal_msg_write_to').value = '';
    var from = ById('modal_msg_view_from').children[0].innerHTML;
    var body = ById('modal_msg_view_body').innerHTML.replace(/\n/g, '').replace(/<br>/gi, '\n').stripTags().replace (/back$/i, '');
    ById('modal_msg_write_txt').value = '[Message original de '+ from +']\n'+ body;
    unsafeWindow.modal_messages_compose();
  },
  msgSendHook : function (){
    if (!Options.enhanceMsging)
      return;
    var to = ById("modal_msg_write_to").value.trim();
      var chaine = ById("message_cc").value;
      var tableau = chaine.split(";")
      if (tableau.length==0) tableau[0]=chaine;
      for (var i = 0; i < tableau.length; i++) {
        var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
        params.emailTo = tableau[i] ;
        params.subject = "CC: "+ById("modal_msg_write_subj").value;
        params.message = ById("modal_msg_write_txt").value;
        params.requestType	 = 'COMPOSED_MAIL';
        new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
         method: "post",
         parameters: params,
         onSuccess: function (rslt) {
              if (rslt.ok) ById('message_cc').value = "";
         },
       });
      }
    if (to.toLowerCase() != '<officiers>' || getMyAlliance()[0]==0) {
      return false;
    }
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.toIds = getMyAlliance()[0];
    params.subject = ById("modal_msg_write_subj").value +'';
    params.message = ById("modal_msg_write_txt").value;
    params.type = 'alliance';
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/sendMessage.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function (rslt) {
            if (rslt.ok) {
                unsafeWindow.Modal.showAlert(unsafeWindow.g_js_strings.modal_messages_send.msgsent);
                ById('modal_msg_write_to').value = "";
                ById('modal_msg_write_subj').value = "";
                ById('modal_msg_write_txt').value = ""
            } else {
                unsafeWindow.Modal.showAlert(unsafeWindow.g_js_strings.modal_messages_send.enterexistingname)
            }
        },
        onFailure: function () {
          unsafeWindow.Modal.showAlert(unsafeWindow.g_js_strings.modal_messages_send.oopscompose)
        },
    });
    return true;
  },
}

var AttackDialog = {
  init : function (){
    var t = AttackDialog;
    t.modal_attackFunc = new CalterUwFunc ('modal_attack', [[/}\s*$/, 'attackDialog_hook(); }']]);
    unsafeWindow.attackDialog_hook = t.modalAttackHook;
    t.modal_attackFunc.setEnable (true);
  },
  setEnable : function (){
  },
  isKnightSelectAvailable : function (){
    var t = AttackDialog;
    return t.modal_attackFunc.isAvailable();
  },
  isAttackCityPickerAvailable : function (){
    var t = AttackDialog;
    return t.modal_attackFunc.isAvailable();
  },

  modalAttackHook : function (){
    var t = AttackDialog;
    if (Options.fixKnightSelect || Options.attackCityPicker){
      for (var i=1; i<6; i++)
        ById('modal_attack_tab_'+ i).addEventListener('click', t.e_changeMarchType, false);
    }
    if (Options.attackCityPicker){
      setTimeout (t.initCityPicker, 0);
    }
  },

  initCityPicker : function (){
    var t = AttackDialog;
    var div = ById('modal_attack_target_numflag'); // as of KofC version 96;
    var mySpan;
    if (div) {
      div.parentNode.innerHTML += ' &nbsp; <SPAN id=modal_attack_citybuts></span>';
    } else {
      var span = ById('modal_attack_target_coords');   // KofC version 116+;
      span.parentNode.parentNode.firstChild.innerHTML += ' &nbsp; <SPAN id=modal_attack_citybuts></span>';
    }
    new CdispCityPicker ('ptatp', ById('modal_attack_citybuts'), false, t.e_CityButton);
    var cityIdx = Cities.byID[unsafeWindow.currentcityid].idx;
    thisCityBut = ById('ptatp_'+ cityIdx);
    thisCityBut.style.opacity = '0.5';
    thisCityBut.disabled = true;
    if (ById('modal_attack_tab_4').className=='selected' || ById('modal_attack_tab_3').className=='selected')   // don't do for attack or scout
      ById('modal_attack_citybuts').style.display = 'none';
  },

  e_CityButton : function (city){
    ById('modal_attack_target_coords_x').value = city.x;
    ById('modal_attack_target_coords_y').value = city.y;
    unsafeWindow.modal_attack_update_time();
  },

  e_changeMarchType : function (evt){
    var t = AttackDialog;
    var marchType = parseInt(evt.target.id.substr(17));
    if (Options.attackCityPicker){
      if (marchType==3 || marchType==4)
        ById('modal_attack_citybuts').style.display = 'none';
      else
        ById('modal_attack_citybuts').style.display = 'inline';
    }
    if (Options.fixKnightSelect){
      var knightVal = 0;
      var selector = ById('modal_attack_knight');
      if (selector.length>1 && (marchType==4 || marchType==2))   // if 'attack' or 'reinforce'
        knightVal = 1;
      selector.selectedIndex = knightVal;
    }
  },
}

var AllianceReports = {
  checkPeriod : 300,
  allianceNames : [],
  saveArfunc : unsafeWindow.allianceReports,
  init : function (){
    t = AllianceReports;
    t.enable (Options.enhanceARpts);
    t.marvFunc = new CalterUwFunc ('modal_alliance_report_view', [['getReportDisplay', 'getReportDisplay_hook2']]);
    t.memListFunc = new CalterUwFunc ('membersInfo', [['commonstr.might','commonstr.might + "</td><td class=colcities>" + g_js_strings.commonstr.cities + "</td><td class=colava>Avatar</td><td class=collast>" + g_js_strings.membersInfo.lastonline'],['memberInfo[key].prestige', 'memberInfo[key].prestige+ "</td>");memhtml.push("<td class=colcities>" + memberInfo[key].cities + "</td><td class=colava><img width=35 src=" + memberInfo[key].avatarurl + "></td>");memhtml.push("<td class=collast>" + memberInfo[key].lastLogin']]);
    unsafeWindow.getReportDisplay_hook2 = t.getReportDisplayHook;
    unsafeWindow.getmembersInfo_hook = t.getMembersInfoHook;
    t.marvFunc.setEnable (true);
    t.enable_viewmembers(Options.enhanceViewMembers);
  },
  getReportDisplayHook : function (a, b){
    var x = '';
    try {
      x = unsafeWindow.getReportDisplay(a,b);
    } catch (e){
      x = 'Error formatting report: '+ e;
    }
    return x;
  },
  enable_viewmembers : function (tf){
    	    t = AllianceReports;
   	    t.memListFunc.setEnable (tf);
  },
  enable : function (tf){
    t = AllianceReports;
    if (tf)
      unsafeWindow.allianceReports = t.myAllianceReports;
    else
      unsafeWindow.allianceReports = t.saveArfunc;
  },
  myAllianceReports : function (pageNum){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    if (pageNum)
      params.pageNo = pageNum;
    params.group = "a";
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/listReports.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        displayReports (rslt.arReports, rslt.arPlayerNames, rslt.arAllianceNames, rslt.arCityNames, rslt.totalPages);
      },
      onFailure: function (rslt) {
      },
    }, false);

    function displayReports (ar, playerNames, allianceNames, cityNames, totalPages){
      var msg = new Array();
      var myAllianceId = getMyAlliance()[0];
      msg.push ("<STYLE>.msgviewtable tbody .myCol div {margin-left:5px; overflow:hidden; white-space:nowrap; color:#000}\
            .msgviewtable tbody .myHostile div {font-weight:600; color:#600}\
            .msgviewtable tbody .myGray div {color:#666}\
            .msgviewtable tbody .myRein div {color:#050}\
            .msgviewtable tbody .myWarn div {font-weight:600; color:#442200}\
            </style>");
      msg.push("<div class='modal_msg_reports'>");
      var rptkeys = unsafeWindow.Object.keys(ar);
      if (matTypeof(ar) != 'array') {
        if (Options.allowAlterAR)
          msg.push("<div id='modal_alliance_reports_tablediv' class='modal_msg_list'><table width=675 cellpadding='0' cellspacing='0' class='msgviewtable reportviewtable alliancetable'>");
        else
          msg.push("<div id='modal_alliance_reports_tabledivNKA' class='modal_msg_list'><table width=675 cellpadding='0' cellspacing='0' class='msgviewtable reportviewtable alliancetable'>");
        msg.push("<thead><tr><td width=105>Date</td><td width=40>Type</td><td width=150>"+uW.g_js_strings.commonstr.attacker+"</td><td>"+uW.g_js_strings.commonstr.target+"</td><td>Voir</td><td colspan=2>Dist. ville</tr></thead><tbody>");
        for (var i = 0; i < rptkeys.length; i++) {
          var rpt = ar[rptkeys[i]];
          var colClass = '"myCol"';
          rpt.marchType = parseInt(rpt.marchType);
          rpt.side0AllianceId = parseInt(rpt.side0AllianceId);
          var targetDiplomacy = getDiplomacy (rpt.side0AllianceId);
          if (rpt.marchType == 2){
            colClass = '"myCol myRein"';
          } else if (rpt.side1AllianceId != myAllianceId){
            colClass = '"myCol myHostile"';
          } else {
            if (parseInt(rpt.side0TileType) < 50){          // if wild
              if (parseInt(rpt.side0PlayerId) == 0)
                colClass = '"myCol myGray"';
              else
                colClass = '"myCol myWarn"';
            } else if (parseInt(rpt.side0PlayerId) == 0) {   // barb
              colClass = '"myCol myGray"';
            } else {
              if (targetDiplomacy == 'amicale')
                colClass = '"myCol myWarn"';
            }
          }
          msg.push ('<tr valign=top');
          if (i%2 == 0)
            msg.push(" class=stripe");
          msg.push("><TD class="+ colClass +"><div>");
          msg.push(unsafeWindow.formatDateByUnixTime(rpt.reportUnixTime));
          msg.push ('<BR>Rpt #');
          msg.push (rpt.reportId);
          msg.push("</div></td><TD class="+ colClass  +"><div>");
          if (rpt.marchType == 1)
            msg.push (unsafeWindow.g_js_strings.commonstr.transport);
          else if (rpt.marchType == 3)
            msg.push (unsafeWindow.g_js_strings.commonstr.scout);
          else if (rpt.marchType == 2)
            msg.push ('Renf');
          else
            msg.push (unsafeWindow.g_js_strings.commonstr.attack);
          msg.push ("</div></td><TD class="+ colClass +"><div>");
          if (parseInt(rpt.side1PlayerId) != 0)
            msg.push('<a onclick=getInfoForAnUser("'+parseInt(rpt.side1PlayerId)+'");>'+escape(playerNames["p" + rpt.side1PlayerId])+"</a>");
          else
          msg.push ('?Unknown?');
          msg.push ('&nbsp;<a href="javascript:void(0)" onclick="cm.utils.CoordinateLinkController.onClick(event)" class="coordinateLink">('+ rpt.side1XCoord +','+ rpt.side1YCoord +')</a><bR>');
          if (rpt.side1AllianceId != myAllianceId){
            msg.push (allianceNames['a'+rpt.side1AllianceId]);
            msg.push (' (');
            msg.push (getDiplomacy(rpt.side1AllianceId));
            msg.push (')');
          } else {
            msg.push ('<BR>');
          }
          msg.push ('</div></td>');
          msg.push ("<TD class="+ colClass  +"><DIV>");
          var type = parseInt(rpt.side0TileType);
          if (type < 50){                              // pour la TS
            msg.push(unsafeWindow.g_mapObject.types[type].toString().capitalize());
            msg.push(" Lvl " + rpt.side0TileLevel)
            if (parseInt(rpt.side0PlayerId) != 0) {   // IF OWNED, show owner ...
              	msg.push (' [');
  		msg.push ('<a @onclick=getInfoForAnUser("'+parseInt(rpt.side0PlayerId)+'");>' + escape(playerNames["p" + rpt.side0PlayerId])+'</a>');
              	msg.push ('] ');
            }
          } else {
            if (parseInt(rpt.side0PlayerId) == 0) {   //  barb
              msg.push(unsafeWindow.g_js_strings.commonstr.barbariancamp);
              msg.push(" Lvl " + rpt.side0TileLevel)
            } else {        // city
              msg.push ('<a onclick=getInfoForAnUser("'+ rpt.side0PlayerId+'");>' + escape(playerNames["p" + rpt.side0PlayerId])+'</a>');
              msg.push (' - ');
              msg.push (cityNames['c'+ rpt.side0CityId]);
            }
          }
          msg.push ('&nbsp;<a href="javascript:void(0)" onclick="cm.utils.CoordinateLinkController.onClick(event)" class="coordinateLink">('+ rpt.side0XCoord +','+ rpt.side0YCoord +')</a>');
          if (rpt.side0AllianceId!=0 && rpt.side0AllianceId!=myAllianceId){
            msg.push ('<BR>');
            msg.push (allianceNames['a'+rpt.side0AllianceId]);
            msg.push (' (');
            msg.push (targetDiplomacy);
            msg.push (')');
          }
          if (Options.allowAlterAR)
            msg.push("</div></td><TD class="+ colClass  +"><div><a onclick=' modal_alliance_report_view(\"");   // ONCLICK ???
          else
            msg.push("</div></td><TD class="+ colClass  +"><div><a onclick=' ById(\"modal_alliance_reports_tabledivNKA\").id=\"modal_alliance_reports_tablediv\"; modal_alliance_report_view(\"");   // ONCLICK ???
          msg.push(rpt.reportId);
          msg.push('",');
          if (parseInt(rpt.side1AllianceId) == parseInt(Seed.allianceDiplomacies.allianceId))
            msg.push(1);
          else
            msg.push(0);
          msg.push(",");
          msg.push(rpt.side0TileType);
          msg.push(",");
          msg.push(rpt.side0TileLevel);
          msg.push(",");
          msg.push(rpt.side0PlayerId);
          msg.push(',"');
          if (parseInt(rpt.side0PlayerId) != 0)
            msg.push(escape(playerNames["p" + rpt.side0PlayerId]));
          else
            msg.push(unsafeWindow.g_js_strings.commonstr.enemy);
          msg.push('","');
          if (parseInt(rpt.side0PlayerId) != 0)
            msg.push(escape(playerNames["g" + rpt.side0PlayerId]));
          else
            msg.push(0)
          msg.push('","');
          if (parseInt(rpt.side1PlayerId) > 0)
            msg.push(escape(playerNames["p" + rpt.side1PlayerId]));
          msg.push('","');
          if (parseInt(rpt.side1PlayerId) != 0)
            msg.push(escape(playerNames["g" + rpt.side1PlayerId]));
          msg.push('",');
          msg.push(rpt.marchType);
          msg.push(",");
          msg.push(rpt.side0XCoord);
          msg.push(",");
          msg.push(rpt.side0YCoord);
          msg.push(",");
          msg.push(rpt.reportUnixTime);
          msg.push(",");
          if (parseInt(rpt.reportStatus) == 2)
            msg.push(1);
          else
            msg.push(0);
          if (rpt.side1XCoord) {
            msg.push(",");
            msg.push(rpt.side1XCoord);
            msg.push(",");
            msg.push(rpt.side1YCoord)
          } else {
            msg.push(",,");
          }
          msg.push(");return false;'><img border=0 src='http://cdn1.iconfinder.com/data/icons/woothemesiconset/16/search_button.png'></a></div></td></tr>");
        }
        msg.push("</tbody></table></div>");
      }
      msg.push("</div><div id='modal_report_list_pagination'></div>");
      ById('allianceContent').innerHTML = msg.join("");
      if (pageNum) {
        unsafeWindow.ctrlPagination("modal_report_list_pagination", totalPages, "allianceReports", pageNum)
      } else {
        unsafeWindow.ctrlPagination("modal_report_list_pagination", totalPages, "allianceReports")
      }
    }
  },
}

/************************ Food Alerts  *************************/
var FoodAlerts = {
  minuteTimer:null,
  init : function (){
   var f = FoodAlerts;
   clearTimeout(f.minuteTimer);
   if (Options.enableFoodWarnTchat)
  	f.e_eachMinute();
  },
  minuteTimer : null,
  e_eachMinute : function (){
    var f = FoodAlerts;
    var now = unixTime();
    row = [];
    if (Options.enableFoodWarnTchat)  {
      for(i=0; i < Cities.numCities; i++) {
        var rp = getResourceProduction (Cities.cities[i].id);
        var foodleft = parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][0])/3600;
        var usage = rp[1];// - parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][3]);
        row[i] = rp[1];
          var timeLeft = parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][0]) / 3600 / (0-usage) * 3600;
          var msg = '';
          if (timeLeft<0){
           }
          else if (timeLeft<(Options.foodWarnHours*3600)) {
                msg += lang.FoodAlerts.msg1 + ' ' + Cities.cities[i].name.substring(0,10) + ' # ' +
                       Cities.cities[i].x +','+ Cities.cities[i].y + ' # ';
                msg += lang.FoodAlerts.msg2 + ' '+addCommasWhole(foodleft).replace(',',' ').replace(',',' ').replace(',',' ').replace(',',' ')+' ('+timestrShort(timeLeft)+') '+lang.FoodAlerts.msg3+' '+addCommas(usage).replace(',',' ').replace(',',' ').replace(',',' ').replace(',',' ')+'/h';
                sendChat ("/a " + msg);
          }
      }
     f.minuteTimer = setTimeout(function() {f.e_eachMinute() }, 1800000);
    }
  },
}

/************************ Alertes de la tour  ************************/
var TowerAlerts = {
  viewImpendingFunc : null,
  generateIncomingFunc : null,
  fixTargetEnabled : false,
  towerMarches : {},
  init : function (){
    var t = TowerAlerts;
    // uW.BOShowthrone = t.trone;
    var s = GM_getValue ('towerMarches_'+getServerId());
    if (s != null) t.towerMarches = JSON2.parse(s);
  },
  postToChatOptions : {aChat:false},
  secondTimer : null,

  setPostToChatOptions : function (obj){
    var t = TowerAlerts;
    t.postToChatOptions = obj;
    clearTimeout(t.secondTimer);
    if (obj.aChat) t.e_eachSecond();
  },
  addTowerMarch : function (m){
    var t = TowerAlerts;
    var now = unixTime();
    for (k in t.towerMarches){
      if (t.towerMarches[k].arrival < now) {
        delete t.towerMarches[k];
      }
    }
    t.towerMarches['m'+m.mid] = {added:now, arrival:parseIntNan(m.arrivalTime) };
    setTimeout (function (){GM_setValue ('towerMarches_' +getServerId(), JSON2.stringify(t.towerMarches));}, 0);
  },
  getTowerMarch : function (mid){
    var t = TowerAlerts;
    return t.towerMarches['m'+mid];
  },
  e_eachSecond : function (){
    var t = TowerAlerts;
    var now = unixTime();

    if (matTypeof(Seed.queue_atkinc) != 'array'){
      for (var k in Seed.queue_atkinc){
        var m = Seed.queue_atkinc[k];
        if (Options.alertSound.alarmActive && (now > Options.alertSound.expireTime)) {
      		Tabs.Options.stopSoundAlerts();
         	setTimeout(function() {
         	   if (ById('botowertab'))
         	     ById('botowertab').style.display="none";
         	},2000);
         }

        if ((m.marchType==3 || m.marchType==4) && parseIntNan(m.arrivalTime)>now && t.getTowerMarch(m.mid)==null){
          t.addTowerMarch (m);
          t.postToChat (m, false);
          if (Options.alertSound.enabled){
               setTimeout(function() {
		         	   if (ById('botowertab'))
		         	     ById('botowertab').style.display="block";
         	},2000);
	        Tabs.Options.soundTheAlert(m);
	        if (m.arrivalTime > Options.alertSound.expireTime)
	          Options.alertSound.expireTime = m.arrivalTime;
    	  }
          if (Options.alertConfig.raid){
	    t.StopCityRaids(m.toCityId);
	  }
	   if (Options.alertConfig.autofo){
	     Options.AttackRunning = false;
         if (Options.BORac_Dar) updatebotbutton(lang.autofo.button+' - OFF', 'pbautofstab');
	     saveOptions();
	  }
	   if (Options.alertConfig.autots){
	  	     Options.crestRunning = false;
	         if (Options.BORac_Ts) updatebotbutton(lang.crest.button+' - OFF', 'pbautotstab');
	  	     saveOptions();
	  }
	  if (Options.alertConfig.appro){
	    Tabs.TranspAuto.reapproState.running = false;
	    if (Options.BORac_App) updatebotbutton(lang.transport.labAppro+' - OFF', 'boreapprotab');

	  }
        }
      }
    }
    t.secondTimer = setTimeout (t.e_eachSecond, 3000);
  },
  StopCityRaids : function (cityId){
  	      	var t = TowerAlerts;
  	      	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  	      	params.pf = 0;
  	      	params.ctrl = 'BotManager';
  	      	params.action = 'stopAll';
  	      	params.settings = {};
  	    	params.settings.cityId = cityId;
  	      	new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  	      		  		method: "post",
  	      		         parameters: params,
  	      				 loading: true,
  	      				 onSuccess: function(transport){
  	      					var rslt = eval("(" + transport.responseText + ")");
  	      				 },
  	      		 });
  },

  postToChat: function(m, force){
   var t = TowerAlerts;
   var postOptions = t.postToChatOptions;
   var k=Seed.throne.slotEquip[Seed.throne.activeSlot],i=Seed.throne.inventory,e,faction;
   var B=0, w={}, x, C;
   for (var K in k) {
     var F = uW.kocThroneItems[k[K]];
     if (F) {
               x=0;
               for (var M in F.effects) {
               x++;
               if (F.quality >= x) {
                B++;
                I = uW.cm.thronestats.effects[F.effects[M].id];
                z = uW.cm.thronestats.tiers[F.effects[M].id][F.effects[M].tier];
                C = + z.base + (F.level * F.level + F.level) * + z.growth * 0.5;
                C = Math.ceil(C);
                if (!F.isBroken) {
                   if (!w[F.effects[M].id]) {
                     w[F.effects[M].id] = {};
                     w[F.effects[M].id].nameitem="";
                   }
                   if (!w[F.effects[M].id].percent) {
                     w[F.effects[M].id].percent = C;
                   } else {
                    w[F.effects[M].id].percent += C;
                   }
                   w[F.effects[M].id].name = I[1];
                   w[F.effects[M].id].nameitem += "(" + ThroneItemName(F) + ")<br>";
                }
               }
               }
               }
           }
   var tot = [];
   for (i = 0; i < 13; i++)
	tot[i] = 0;

   if (m.marchType == null)
		return;

	if (m.marchType == 3) {
		if (!postOptions.scouting && !force) return;
		atkType = lang.TowerAlerts.atkType;
	} else {
		if (m.marchType == 4) {
				atkType = lang.TowerAlerts.atkType1;
		} else {
				return;
		}
	}

	var target, atkType, who;
	var city = Cities.byID[m.toCityId];
	if (city.tileId == m.toTileId) {
			target = lang.TowerAlerts.targetcity+' ' + city.name + ' # ' + city.x + ',' + city.y+' #';
				if (postOptions.marechal) {
						var now = unixTime();
						marshallCombatScore = 0;
						var s = Seed.knights['city'+m.toCityId];
						if (s) {
							s = s["knt" + Seed.leaders['city'+m.toCityId].combatKnightId];
							if (s){
								marshallCombatScore = s.combat;
							}
				                 }
				           target += ' ('+lang.TowerAlerts.marshallCombat+' ' + parseInt(marshallCombatScore) + ') ';
	                }
	        }else {
			if (!postOptions.wilds && !force)
				return;
			target = lang.TowerAlerts.target1;
			for (k in Seed.wilderness['city' + m.toCityId]) {
				if (Seed.wilderness['city' + m.toCityId][k].tileId == m.toTileId) {
					target += ' ' + Seed.wilderness['city' + m.toCityId][k].xCoord + ',' + Seed.wilderness['city' + m.toCityId][k].yCoord+' ';
					break;
				}
			}
		}

		if (postOptions.defBoost) {
		 var c=unsafeWindow.unixtime();
		 var boost="";
		 if (parseInt(Seed.playerEffects.defExpire)>c)
		 {
		  var f=parseInt(Seed.playerEffects.defExpire)-c;
		  boost = "def 20%";
		 }
		 if (parseInt(Seed.playerEffects.def2Expire)>c) {
		  var f=parseInt(Seed.playerEffects.defExpire)-c;
		  boost = "def 50%";
		 }
		 target += boost;
		}
		if (postOptions.TroneRange || postOptions.TroneRangeDebuff || postOptions.TroneCombatSpeed || postOptions.TroneLife) {
		 target += ". "+lang.TowerAlerts.throne+" ";
		 if (postOptions.TroneRange) {
		  if (w[5])
		    target+= w[5].percent + " % range ";
		  else
		    target+= "0 % range ";
		 }
		 if (postOptions.TroneRangeDebuff) {
		 		  if (w[21])
		 		    target+= w[21].percent + " % range debuff ";
		 		  else
		 		    target+= "0 % range debuff ";
		 }
		  if (postOptions.TroneCombatSpeed) {
		 		  if (w[4])
		 		    target+= w[4].percent + " % speed ";
		 		  else
		 		    target+= "0 % speed ";
		 }
		  if (postOptions.TroneLife) {
		 		  if (w[3])
		 		    target+= w[3].percent + " % life ";
		 		  else
		 		    target+= "0 % life ";
		 }

		}
		var attackermight = '';
		var allianceId = '';
		if (Seed.players['u' + m.pid]) {
			who = Seed.players['u' + m.pid].n;
			attackermight = parseInt(Seed.players['u' + m.pid].m);
            	        allianceId = Seed.players['u' + m.pid].a;
		} else {
			if (m.players && m.players['u' + m.pid]) {
				who = m.players['u' + m.pid].n;
				attackermight = parseInt(m.players['u' + m.pid].m);
                	         allianceId = m.players['u' + m.pid].a;
			} else {
				who = '??';
			}
		}
		//



		if (m.fromXCoord)
			who += ' '+lang.TowerAlerts.at+' ' + m.fromXCoord + ',' + m.fromYCoord;
		if (m.knt) {
		  if (m.knt['cbt']!=undefined && m.knt['cbt']!=null) who += ' '+uW.g_js_strings.commonstr.knight+' ' + m.knt['cbt'];
		}
		var diplomacy = getDiplomacy(allianceId);
		var arrivingDatetime = new Date();
		arrivingDatetime.setTime(m.arrivalTime * 1000);
		var msg = '';
		var subject = '';

		msg = lang.TowerAlerts.Type+' ' + atkType + '. ';
		if (!postOptions.MonQG && parseIntNan(postOptions.hq)>0) {
		 var mavilleId=Cities.byID[postOptions.hq];
		 if (mavilleId)
		   msg += ' '+lang.TowerAlerts.hq+': ' + mavilleId.x + ','+mavilleId.y+' ';

		}
		if (postOptions.empennage) {
		 msg += lang.TowerAlerts.emp+' ' + parseInt(Seed.tech['tch13']) + '. ';
		}

		msg += lang.TowerAlerts.target+' ' + target + '. ';
		msg += uW.g_js_strings.commonstr.attacker + ' : ' + who + ' (' + addCommas(attackermight).replace(',',' ').replace(',',' ') + ', ' + diplomacy + ').';
		msg +=' ** '+lang.TowerAlerts.arrival+' ** : ';
		var totTroops = 0;
		for (k in m.unts) {
			var uid = parseInt(k.substr(1));
			msg += m.unts[k] + ' ' + unsafeWindow.unitcost['unt' + uid][0] + ', ';
			totTroops += m.unts[k];
		}
		if (parseIntNan(postOptions.hq)>0) {
		 if (parseInt(m.toCityId)==parseInt(postOptions.hq)) {
		  if ((totTroops < postOptions.minTroops)) return;
		 }
		 if (parseInt(m.toCityId)!=parseInt(postOptions.hq)) {
		 if ((totTroops < postOptions.minTroops2)) return;
		 }
		} else {
		 if ((totTroops < postOptions.minTroops) && !force)
			return;
		}
		msg = msg.slice(0, -2);
		msg += ' ('+lang.TowerAlerts.arrival2+' ' + unsafeWindow.timestr(parseInt(m.arrivalTime - unixTime())) + ' '+lang.TowerAlerts.arrival3+' ' + arrivingDatetime.toLocaleTimeString() +').' ;
		var msgpart1='';
		if (parseInt(Seed.citystats["city" + m.toCityId].gate) == 0 && Options.alertConfig.defence==true)
	        {
		   msg += ' ** '+lang.TowerAlerts.sanctuary+' ** ';
		}
		if (parseInt(Seed.citystats["city" + m.toCityId].gate) == 1 && Options.alertConfig.defence==true)
		{
		  msg += ' ** '+lang.TowerAlerts.defence+' ** ';
        	}
		if (city.tileId == m.toTileId) {
			var emb = getCityBuilding(m.toCityId, 8);
			if (emb.count <= 0) {
			 msg += ' '+lang.TowerAlerts.noambassy;
			 var msgpart1 = msg;
			 msg ='';
			}
			if (emb.count > 0) {
				var availSlots = emb.maxLevel;
				for (k in Seed.queue_atkinc) {
					//if (Seed.queue_atkinc[k].marchType == 2 && Cities.byID[Seed.queue_atkinc[k].fromCityId] == null) {
					if (Seed.queue_atkinc[k].marchType==2 && Seed.queue_atkinc[k].toCityId==m.toCityId && Cities.byID[Seed.queue_atkinc[k].fromCityId]==null){
						--availSlots;
					}
				}
				msg += ' '+lang.TowerAlerts.myambassy+' (' + availSlots + '/' + emb.maxLevel + ')';
				var msgpart1 = msg;
				msg ='';
				if (postOptions.embassy) {
					var rownum = 0;
					enc = {};
					numSlots = 0;
					if (matTypeof(Seed.queue_atkinc) != 'array') {
						for (k in Seed.queue_atkinc) {
							march = Seed.queue_atkinc[k];
							if (march.marchType == 2) {
								++numSlots;
								city = march.toCityId;
								from = march.fromPlayerId;
								if (!enc[city])
									enc[city] = {};
								if (!enc[city][from])
									enc[city][from] = [];
								s = [];
								s[0] = parseInt(march.knightCombat);
								for (i = 1; i < 13; i++) {
									if (Options.encRemaining)
										s[i] = parseInt(march['unit' + i + 'Return']);
									else
										s[i] = parseInt(march['unit' + i + 'Count']);
								}
								enc[city][from].push(s);
							}
						}
					}
					dest = m.toCityId;
					var embassyOccupied = false;
					if (enc[dest]) {
						embassyOccupied = true;
						msg += ' ** '+lang.TowerAlerts.ambassy+' **: ';
						for (p in enc[dest]) {
							try {
								if (Seed.players['u' +p]) {
									player = Seed.players['u' + p].n;
								} else {
									if (m.players && m.players['u' + p]) {
										player = m.players['u' + p].n;
									} else {
										player = '???';
									}
								}
							}
							catch (err) {
								player = '???';
							}
							for (j = 0; j < enc[dest][p].length; j++) {
								knight = '';
								if (enc[dest][p][j][0] > 0)
									knight = ' (' + enc[dest][p][j][0] + ')';
								var slot = j + 1;
								msg += '[slot' + slot + ': ' + player + knight + '->';
								for (i = 1; i < 13; i++) {
									num = enc[dest][p][j][i];
									if (num > 0)
										msg += '' + addCommas(num).replace(',',' ').replace(',',' ') + ' ' + uW.unitcost['unt'+i][0].substring(0,4) + ', ';
									tot[i] += num;
								}
								msg += ']';
							}//for (j=0; j<enc[dest][p].length; j++)
						}//for (p in enc[dest])
					}//if (enc[dest])

				}// if (postOptions.embassy)
			}//if (emb.count > 0)
		}
		var msgpart2 = msg;
		msg ='';
		if (postOptions.mytroops) {
		msg += ' ** '+lang.TowerAlerts.troops+' ** : ';
		cityID = 'city' + m.toCityId;
		for (r = 1; r < 13; r++) {
			num = parseInt(Seed.units[cityID]['unt' + r]);
			tot[r] += num;
			if (num > 0)
				msg += '' + addCommas(num).replace(',',' ').replace(',',' ') + ' ' + uW.unitcost['unt'+r][0].substring(0,4) + ', ';
		}
		msg += '.';
		}
		var msgpart3 = msg;
		msg ='';
		if (embassyOccupied) {
			msg += ' ** '+lang.TowerAlerts.total+' ** : ';
			for (r = 1; r < 13; r++) {
				num = parseInt(tot[r]);
				if (num > 0)
					msg += '' + addCommas(num).replace(',',' ').replace(',',' ') + ' ' + uW.unitcost['unt'+r][0].substring(0,4) + ', ';
			}
			msg += '.';
		}
		var msgpart4 = msg;
		msg='';
		if (postOptions.food) {
			var rp = getResourceProduction (m.toCityId);
      		//var usage = parseInt(Seed.resources["city" + m.toCityId]['rec1'][3]);
      		var foodIncome = rp[1];
			var food = parseInt(Seed.resources['city'+ m.toCityId]['rec'+1][0] / 3600);
			var timeLeft = parseInt(Seed.resources["city" + m.toCityId]['rec1'][0]) / 3600 / (0-foodIncome) * 3600;
			var timeLeftShort  = timestrShort(timeLeft);
			msg += ' ** '+lang.TowerAlerts.food+'  **:';
			msg += ' '+addCommas(food).replace(',',' ').replace(',',' ').replace(',',' ') + ' (' +addCommas(foodIncome).replace(',',' ').replace(',',' ').replace(',',' ')+') -> '+lang.TowerAlerts.timerem+' '+timeLeftShort+'. ';
		}
		var msgpart5 =msg;
		msg ='';
		if (Options.alertConfig.defense) {
		 msg += ' ** '+lang.TowerAlerts.defense+' **:';
          	 for (k in uW.fortcost){
			var fortiName = uW.fortcost[k][0].substring(0,6);
			var fortiVal = parseInt(Seed.fortifications['city' + m.toCityId]['fort'+k.substring(3)]);
			msg += fortiVal +' '+fortiName+', ';
   		 }
   		}
		var msgpart6 = msg;
		var msgpart7 = '';
		var msgpart8 = ' '+ postOptions.aPrefix + ' ';;
		msg = msgpart1 + msgpart2 + msgpart3 + msgpart4 + msgpart5 + msgpart6 + msgpart7 + msgpart8;
		if (postOptions.sendasWhisper) 	sendChat("/" + Seed.player.name + ' ' + msg);
		if (postOptions.sendtoAlly) sendChat("/a " + msg);
		if (postOptions.Atkpreset && Options.Atkpreset && Options.Atkpreset!=Seed.throne.activeSlot) {
			var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
			params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
			params.action = 'setPreset';
			params.presetId = Options.Atkpreset;
		  	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
				method: "post",
				parameters: params,
				loading: true,
				onSuccess: function (transport) {
					var rslt = eval("(" + transport.responseText + ")");
						if(rslt.ok){
							button = '<li id="throneInventoryPreset' + Options.Atkpreset + '" class="active">'+Options.Atkpreset+'</li>';
							unsafeWindow.cm.ThroneView.clickActivePreset(button);
					   }
				},
				onFailure: function () {
				},
			});

	        }
		if (postOptions.sendEmail) {
			var subject = uW.domainName + ' >> ' +target + ' est en train ' + atkType + ' par ' + who + ' dans '+ arrivingDatetime;
			var email = postOptions.emailAddress;
			var error = false;
			if (email=="") error = true;
			if (subject=="") error = true;
			if (msgpart1=="") error = true;
			if (!error) sendEmail(Seed.player.name, "", email, subject, msg.replace("#",""));
	       }

	}, // postToChat
} //TowerAlerts

function sendEmail (username, token, email, subject, msg){


 var query = "?user="+username+"&email="+email+"&subject="+subject+"&msg1="+msg;
 query=query.replace(/#/g,'%23');
 new MyAjaxRequest("http://ddflux.org/email.php" + query, {
	      method: "POST",
	      onSuccess: function (rslt) {},
	      onFailure: function () {},
    });
}

function getResourceProduction (cityId){
  var ret = [0,0,0,0,0];

  for (var i=1; i<5; i++){

    ret[i] = uW.cm.Resources.getProduction(i,cityId);

  }
  return ret;
}

function IsNumeric(input)
{
   return (input - 0) == input && input.length > 0;
}

function parseIntNan (n){
  x = parseInt(n, 10);
  if (isNaN(x))
    return 0;
  return x;
}
function parseIntCommas (n){
  n = n.split(',');
  n = n.join('');
  x = parseInt(n, 10);
  if (isNaN(x))
    return 0;
  return x;
}
function parseIntZero (n){
  n = n.trim();
  if (n == '')
    return 0;
  return parseInt(n, 10);
}

/*******************   KOC Map interface ****************/
Map = {
/***
 0: bog
10: grassland
11: lake
20: woods
30: hills
40: mountain
50: plain
51: city / barb
53: misted city
***/
  generateBlockList : function(left, top, width) {
    var width5 = parseInt(width / 5);
    var bl = [];
    for (x=0; x<width5; x++){
      xx = left + (x*5);
      if (xx > 745)
        xx -= 750;
      for (y=0; y<width5; y++){
        yy = top + (y*5);
        if (yy > 745)
          yy -= 750;
        bl.push ('bl_'+ xx +'_bt_'+ yy);
      }
    }
    return bl.join(",");
  },
  callback : null,
  request : function (left, top, width, cb) {
    left = parseInt(left / 5) * 5;
    top = parseInt(top / 5) * 5;
    width = parseInt((width+4) / 5) * 5;
    var blockString = this.generateBlockList(left, top, width);
    Map.callback = cb;
    if (unsafeWindow.SANDBOX)
      return RequestMAPTEST(left, top, width, callback);
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.blocks = blockString;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        Map.callback(left, top, width, rslt);
      },
      onFailure: function (rslt) {
        Map.callback(left, top, width, rslt);
      }
    });
  },
};


/******** Export to KOC Attack **********/

var exportToKOCattackBO = {
  troops : {},

  init : function (){
      var t = exportToKOCattackBO;
      var isKOCattack = !(ById('KOCAttackToggle') == null);
      if (!isKOCattack) return
      for (var b=1; b<11; b++){
        t.troops['b'+ b] = [];
        for (var trp=0; trp<12; trp++){
          t.troops['b'+ b][trp] = 0;
        }
      }
      var s = GM_getValue ('atkTroops_'+ getServerId(), null);
      if (s != '' && s!=null){
        var trp = JSON2.parse(s);
        for (var b=1; b<11; b++){
          if (trp['b'+ b] && trp['b'+ b].length == 12)
            t.troops['b'+ b] = trp['b'+ b];
        }
      }
      window.addEventListener('unload', t.onUnload, false);
  },

  onUnload : function (){
    var t = exportToKOCattackBO;
    GM_setValue ('atkTroops_'+ getServerId(),  JSON2.stringify(t.troops));
  },

  doExport : function (coordList, city){
    var t = exportToKOCattackBO;
    var popExp = null;
    var cList = coordList;
    var curLevel = 0;
    var city = city;
    var troopDef = [
      ['Ravil', 1],
      ['Wagon', 9],
      ['Archers', 6],
      ['Cavalerie', 7],
      ['Lourds', 8],
      ['Baliste', 10],
      ['Cata', 12],
    ];
    var divKOCAttackExport=ById('BOdivKOCAttackExport');
    divKOCAttackExport.style.display='block';
    divKOCAttackExport.style.border='1px solid #000';
     divKOCAttackExport.style.top='100px';
      divKOCAttackExport.style.left='50px';
     var m = '<DIV id=BOdragExport class=boStat><table width="100%" cellspacing="0" border=0><tr><td class=boStat>Exporter les barbares directement dans KOC Attack</td><td id="idp_ExportX" onmouseover="this.style.cursor=\'pointer\'" style="color: rgb(255, 255, 255); background: none repeat scroll 0% 0% rgb(85, 85, 85); padding-left: 5px; padding-right: 5px; cursor: pointer;" valign="middle" align="right">X</td></tr></table></div><BR><TABLE align=center cellpadding=0 cellspacing=0 class=pbTabPadNW>\
      <TR style="font-weight:bold; background-color:white"><TD>Type cible</td><TD style="padding:1px" align=center>#<BR>cibles</td><TD width=17></td>';
    for (var i=0; i<troopDef.length; i++)
      m += '<TD>'+ troopDef[i][0] +'</td>';
    m += '</tr>';
    for (var b=1; b<11; b++){
      m += '<TR><TD>Barb niv '+ b +'</td><TD align=right>'+ coordList['lvl'+b].length  +'&nbsp; &nbsp;</td><TD></td>';
      for (var td=0; td<troopDef.length; td++)
        m += '<TD><INPUT id=ptET_'+ b +'_'+ troopDef[td][1] +' type=text size=4 value="'+ t.troops['b'+ b][troopDef[td][1]-1] +'"></td>';
      m += '<TD width=90%><SPAN class=boldRed id=ptETerr_'+ b +'></span></tr>';
    }
    m += '</table>';
    var isKOCattack = !(ById('KOCAttackToggle') == null);
    if (isKOCattack){
      m += '<BR><CENTER>'+ strButton20('Ajouter les coordonn&eacute;es dans KOC Attack', 'id=pbSrcDoBA') +'</center>';
    } else {
      m += 'KOC Attack is not possible to export';
    }
    m += '<CENTER><DIV style="width:70%" id=pbSrcExpResult></DIV></center>';
    divKOCAttackExport.innerHTML =  m;
    new CWinDrag (ById('BOdragExport'), divKOCAttackExport, true);
     ById('idp_ExportX').addEventListener ('click', function() {
      ById('BOdivKOCAttackExport').style.display="none";
      ById('BOdivKOCAttackExport').innerHTML =  "";
     }, false);
    for (var b=1; b<11; b++)
      for (var td=0; td<troopDef.length; td++)
        ById('ptET_'+ b +'_'+ troopDef[td][1]).addEventListener ('change', validate, false);
     if (isKOCattack)
      document.getElementById ('pbSrcDoBA').addEventListener ('click', doBulkAdd, false);
    if (city != null){
      for (var i=0; i<Cities.numCities; i++)
        if (city.id == Cities.cities[i].id)
          break;
      if (i < Cities.numCities){
        setTimeout (function(){unsafeWindow.citysel_click(ById('citysel_'+ (i+1)));}, 0);
      }
    }
    function validate (e){
      var x = e.target.id.substr(5).split('_');
      var b = x[0];
      var trp = x[1];
      ById('ptETerr_'+ b).innerHTML = '';
      var x = parseIntZero (e.target.value);
      if (isNaN(x) || x<0 || x>100000){
        e.target.style.backgroundColor = 'red';
        ById('ptETerr_'+ b).innerHTML = 'Entr&eacute;e invalide';
        return;
      } else {
        e.target.style.backgroundColor = '';
        e.target.value = x;
        t.troops['b'+ b][trp-1] = x;
      }
      var tot = 0;
      for (var td=0; td<troopDef.length; td++)
        tot += parseIntZero(ById('ptET_'+ b +'_'+ [troopDef[td][1]]).value);
      if (tot<1 && cList['lvl'+ b].length>0 )
        ById('ptETerr_'+ b).innerHTML = 'No troops defined';
      if (tot>200000)
        ById('ptETerr_'+ b).innerHTML = 'Trop de troupes';
    }

    function doBulkAdd (){
      for (var b=1; b<11; b++){
        if (ById('ptETerr_'+ b).innerHTML != '')
          return;
        var tot = 0;
        for (var td=0; td<troopDef.length; td++)
          tot += t.troops['b'+b][troopDef[td][1]-1];
        if (tot<1 && cList['lvl'+ b].length>0){
          ById('ptETerr_'+ b).innerHTML = 'No troops defined';
          return;
        } else if (tot>200000) {
          ById('ptETerr_'+ b).innerHTML = 'Trop de troupes';
          return;
        }
      }
      ById('pbSrcExpResult').innerHTML = '';
      setTimeout(function() { doNextLevel (); }, 100);
    }

    function endBulkAdd (msg){
      unsafeWindow.Modal.hideModalAll();
      curLevel = 0;
      ById('pbSrcExpResult').innerHTML += msg;
    }

    function doNextLevel (){
      while ( curLevel<10 && cList['lvl'+ ++curLevel].length==0)
        ;
      if (curLevel>=10){
        unsafeWindow.Modal.hideModalAll();
	curLevel = 0;
        ById('pbSrcExpResult').innerHTML += "Fini !";
        return;
      }
      setTimeout(function() {
       unsafeWindow.Modal.hideModalAll();
       unsafeWindow.modal_attack(4,0,0);
       new CwaitForElement ('BulkAddAttackDiv', 5000, e_attackDialog );
      }, 250);
    }

    function e_attackDialog (tf){
      if (!tf){
        endBulkAdd ('<SPAN class=boldRed>ERREUR: impossible d\'ouvrir la page attaque</span>');
        return;
      }
      var div = searchDOM (ById('BulkAddAttackDiv'), 'node.tagName=="DIV" && node.style.display=="none"', 10);
      if (div==null){
        endBulkAdd ('<SPAN class=boldRed>ERREUR: Unexpected attack dialog format (1).</span>');
        return;
      }
      var ta = searchDOM (div, 'node.tagName=="TEXTAREA"', 10);
      var but = searchDOM (div, 'node.tagName=="A"', 10);
      if (ta==null || but==null){
        endBulkAdd ('<SPAN class=boldRed>ERREUR: Unexpected attack dialog format (2).</span>');
        return;
      }
      for (var trp=1; trp<13; trp++){
        var inp = ById('modal_attack_unit_ipt' +trp);
        inp.value = t.troops['b'+curLevel][trp-1];
        if (t.troops['b'+curLevel][trp-1] > 0)
          inp.style.backgroundColor = 'yellow';
        else
          inp.style.backgroundColor = 'white';
      }
      div.style.display = 'block';
      ById('KOCAttackBulkAddForce').checked = true;

        var m = '';
        var list = cList['lvl'+ (curLevel)];
        for (i=0; i<list.length; i++)
          m += list[i].x +','+ list[i].y +'\n';
        ta.value = m;
      clickWinBO(unsafeWindow, but, 'click');
      unsafeWindow.Modal.hideModal();
      setTimeout (doNextLevel, 500);
    }
  },
}


var RepairAuto = {
 timer : null,
 repairtimer: null,
 init: function (){
     if (!Options.salvageconfig.Repairrunning) return;

     RepairAuto.setEnable();
  },
 setEnable: function (){
     var t = RepairAuto;
     clearTimeout (t.repairtimer);
     t.tableau=[];
     t.repairtimer = setTimeout (t.count, 1*1000);
 },
 count:function() {
  var t = RepairAuto;
  var lignauto = Seed.throne.rowNum * 5, i=uW.kocThroneItems;
  var nbl=0;
  t.tableau=[];
  clearTimeout (t.repairtimer);
   if (!Options.salvageconfig.Repairrunning) return;

  for (var z in i) {
       if (i[z].id) {
        e=uW.kocThroneItems[i[z].id];
        if (e) {
	nbl++;
	if (e.isBroken && nbl<=lignauto ) {
	  if (Seed.queue_throne) {
	   if (Seed.queue_throne.itemId!=e.id)
	     t.tableau.push(i[z].id);
	  } else {
	   t.tableau.push(i[z].id);
	  }
	}
       }
    }
  }
  var timeLeft=-1;
  if (Seed.queue_throne) {
         if (Seed.queue_throne.end)
            timeLeft = Seed.queue_throne.end - uW.unixtime();
  }
  if (t.tableau.length>0 && timeLeft<0) {
     var itemId = t.tableau[Math.floor(Math.random()*t.tableau.length)]; // 1 au pif ^^
     actionLog("AutoRepair", "Lancement du " + ThroneItemName(uW.kocThroneItems[itemId]) + " - il y a " + t.tableau.length + " a reparer");
     t.repair(itemId);
  } else {
   if (timeLeft>0) {
     actionLog("AutoRepair", "Reparation deja en cours... attente "+timeLeft+" s +5");
    t.repairtimer = setTimeout (t.count, (timeLeft+5)*1000);
   } else {
    actionLog("AutoRepair", "Rien a reparer... attente 5 minutes");
    t.repairtimer = setTimeout (t.count, (5*60)*1000);
   }
  }


 },
 repairId:0,
 repariend:null,
 countRepair:0,
 clearRepair:function() {
   var t = RepairAuto;
     if (t.repairId != 0)
   	      {
   	    		 unsafeWindow.kocThroneItems[t.repairId].isBroken = false;
   		     unsafeWindow.cm.ThroneView.renderInventory(unsafeWindow.kocThroneItems);
   		     t.repairId = 0;
   	      }
 },
 repair: function(id) {
    var t = RepairAuto;
    clearTimeout (t.repairtimer);
    if (!Options.salvageconfig.Repairrunning) return;
    if (uW.kocThroneItems[id]) {
        var params = uW.Object.clone(uW.g_ajaxparams);
        params.action="timeRepair";
        params.ctrl="throneRoom\\ThroneRoomServiceAjax";
        params.throneRoomItemId=id;
        uW.ajax.Request(uW.g_ajaxpath+"ajax/_dispatch53.php"+uW.g_ajaxsuffix,{method:"post",parameters:params,loading:true,
         onSuccess:function(transport) {
          var m = eval("(" + transport.responseText + ")");
          if (m.ok === true){
           Seed.queue_throne.start = uW.unixtime();
           Seed.queue_throne.end = m.eta;
           Seed.queue_throne.itemId = id;
           t.repairId = id;
	   t.repairend = m.eta;
	   unsafeWindow.cm.ThroneView.renderInventory(unsafeWindow.kocThroneItems);
	   var x = m.eta - unixTime();
	   setTimeout(t.clearRepair, (x+1)*1000);
           t.countRepair=0;
           duree= Seed.queue_throne.end - Seed.queue_throne.start + 5;
           actionLog("AutoRepair", "Reparation ok de " + ThroneItemName(uW.kocThroneItems[id]) + " duree : " +duree +"s");
            t.repairtimer = setTimeout (t.count, (duree)*1000);
           } else {
            t.countRepair++;
            actionLog("AutoRepair", "<font color=red>Reparation erreur </font> de " + ThroneItemName(uW.kocThroneItems[id]));
            if (t.countRepair>5) {
              t.countRepair=0;
              t.repairtimer = setTimeout (t.count, (2*60)*1000);
            } else {
              setTimeout(function() { t.repair(id); },2000);
            }

           }
         }
    });

   } else {
     actionLog("AutoRepair", "Reparation ID inexistant");
     t.repairtimer = setTimeout (t.count, (2*60)*1000);
   }
  },
}
/*********************************** Throne Tab ***********************************/

Tabs.Throne = {
  tabOrder : 19,
  tabLabel : lang.AUTOTRONE.label,
  cont : null,
  curTabBut : null,
  curTabName : null,
  SelId:null,
  log:[],
  SalvageLog:[],
  timersalvage:null,
  setRepairTimer:null,
  setActionTimer:null,
  SalvageArray:[],
  SalvageRunning:false,
  LastDeleted:0,
  EquipType: ["Advisor","Banner","Chair","Table","Windows","Trophy"],

  init : function (div){
    var t = Tabs.Throne;
    t.cont = div;
    var a = JSON2.parse(GM_getValue ('ThroneHistory_'+getServerId(), '[]'));
    if (matTypeof(a) == 'array') t.log = a;
    var a = JSON2.parse(GM_getValue ('ThroneSalvageHistory_'+getServerId(), '[]'));
    if (matTypeof(a) == 'array') t.SalvageLog = a;

    if (Options.BORac_Salvage) AddSubTabLink('Salvage', t.toggleSalvage, 'BOautosalvagetab');
    if (Options.BORac_Salvage2) AddSubTabLink('Salv V2', t.S2togglePower, 'BOautosalvageV2');
    if (Options.BORac_Upg) AddSubTabLink('Upgrade', t.toggleThroneState, 'BOautoupgradetab');
    if (Options.ThroneDeleteItems == false) {
  			if (Options.BORac_Salvage)  updatebotbutton("Salvage - OFF", 'BOautosalvagetab');
  		}else{
  			if (Options.BORac_Salvage)  updatebotbutton("Salvage - ON", 'BOautosalvagetab');
  			t.timersalvage=setTimeout(t.salvageCheck,2*60*1000);
    }

    if (salvageData.salvageActive) {
     if (Options.BORac_Salvage2) updatebotbutton("Salv V2 - ON", 'BOautosalvageV2');
      t.timersalvage=setTimeout(t.S2start, 2000);
    } else {
     if (Options.BORac_Salvage2) updatebotbutton("Salv V2 - OFF", 'BOautosalvageV2');
    }


    if (ThroneOptions.Active == true) {
    	if (Options.BORac_Upg) updatebotbutton("Upgrade - ON", 'BOautoupgradetab');
      		}else{
  			if (Options.BORac_Upg) updatebotbutton("Upgrade - OFF", 'BOautoupgradetab');

    }
    var main = '<TABLE align=center><TR><TD><INPUT class=pbSubtab ID=ptmrchSubSal type=submit value="'+lang.AUTOTRONE.Autosalvage+'"></td><TD><INPUT class=pbSubtab ID=ptmrchSubS2l type=submit value="'+lang.AUTOTRONE.Autosalvage+' V2"></td>';
    main +='<TD><INPUT class=pbSubtab ID=ptmrchSubUE type=submit value="'+lang.AUTOTRONE.Upgrade+'"></td><TD><INPUT class=pbSubtab ID=ptmrchSubRE type=submit value="'+lang.AUTOTRONE.AutoRepair+'"></td>';
	main +='<TD><INPUT class=pbSubtab ID=ptmrchSubST type=submit value="'+lang.AUTOTRONE.Stats+'"></td><TD><INPUT class=pbSubtab ID=ptmrchSubOR type=submit value="'+lang.AUTOTRONE.equip.equip+'"></td></tr></table><HR class=ptThin>';
    main +='<DIV id=ThroneOutput style="margin-top:5px;  max-height:'+(Options.HauteurBoite-80)+'px; height:'+(Options.HauteurBoite-80)+'px; overflow-y:auto"></div>';

    t.cont.innerHTML = main;
    t.Overv = document.getElementById('ThroneOutput');

    ById('ptmrchSubSal').addEventListener('click', e_butSubtab, false);
    ById('ptmrchSubS2l').addEventListener('click', e_butSubtab, false);
    ById('ptmrchSubUE').addEventListener('click', e_butSubtab, false);
    ById('ptmrchSubST').addEventListener('click', e_butSubtab, false);
    ById('ptmrchSubRE').addEventListener('click', e_butSubtab, false);
    ById('ptmrchSubOR').addEventListener('click', e_butSubtab, false);

    setTimeout(function() {

    changeSubtab (ById(Options.curMarchTab));

    },1000);

    function e_butSubtab (evt){
      changeSubtab (evt.target);
    }

    function changeSubtab (but){
      if (but == t.curTabBut)
        return;
      if (t.curTabBut){
        t.curTabBut.className='pbSubtab';
        t.curTabBut.disabled=false;
      }
      t.curTabBut = but;
      but.className='pbSubtab pbSubtabSel';
      but.disabled=true;
      t.curTabName = but.id.substr(9);
      Options.curMarchTab = but.id;
      saveOptions();

      t.show ();
    }
    t.checkUpgradeInfo(true);
    if (ThroneOptions.Active) t.setActionTimer = setInterval(t.doAction,10000);

 },
 showLive:function() {
  var t = Tabs.Throne;
  var NotUpgrading = true,count=0,del = true,level = false, z ="";
  for (m in unsafeWindow.kocThroneItems) {
  		y =   unsafeWindow.kocThroneItems[m];

  		if (typeof(y.id) == 'number') {
  		        count++;
  			NotUpgrading = true;
  			for (k in ThroneOptions.Items) {if (ThroneOptions.Items[k]["id"] == y.id) NotUpgrading = false;}

  					del = true;
  					level = false;

  					if (y.quality >= ThroneOptions.SalvageQuality) { level=true;}
  					if (ThroneOptions.SalvageQuality == 0) level=true;

  					var rangeIndex=0;
  					if (ThroneOptions.Salvage[y.effects["slot3"].id]) rangeIndex += 1;
  					if (ThroneOptions.Salvage[y.effects["slot4"].id]) rangeIndex += 3;
  					if (ThroneOptions.Salvage[y.effects["slot5"].id]) rangeIndex += 5;
  					if (ThroneOptions.SalvageTriple && y.effects["slot3"].id==y.effects["slot4"].id && y.effects["slot4"].id==y.effects["slot5"].id) {
										 // si un item a les trois derniers items identiques

					} else {

  					if (!level && NotUpgrading && !y.isEquipped && y.level==0 && !y.isBroken && t.LastDeleted != y.id) {

  					      // test du type d'items
  					     var itemaconserver=false;
  					     if ((y.type=="advisor" && ThroneOptions.SalvageAdvisor) ||
  					 			  			     (y.type=="banner" && ThroneOptions.SalvageBanner) ||
  					 			  			     (y.type=="chair" && ThroneOptions.SalvageChair) ||
  					 			  			     (y.type=="table" && ThroneOptions.SalvageTable) ||
  					 			  			     (y.type=="window" && ThroneOptions.SalvageWindow)||
  					 			  			     (y.type=="trophy" && ThroneOptions.SalvageTrophy)) {
   			  			      itemaconserver=true;
  					      }
  					if ( rangeIndex > parseIntNan(Options.RangeSaveModeSetting) && itemaconserver) {
   			  			}else{

  						 //
  						 if (count<=(parseInt(Seed.throne.rowNum)*5)) {
  						            z+="<tr><td>" + ThroneItemName(y) +"</td><td>"+uW.cm.thronestats["effects"][y.effects["slot3"].id]["1"]+"</td><td>"+uW.cm.thronestats["effects"][y.effects["slot4"].id]["1"]+"</td><td>"+uW.cm.thronestats["effects"][y.effects["slot5"].id]["1"]+"</td></tr>";

  						 }else{
  						            z+="<tr><td><span style='text-decoration:line-through'>" + ThroneItemName(y) +"</span></td><td>"+uW.cm.thronestats["effects"][y.effects["slot3"].id]["1"]+"</td><td>"+uW.cm.thronestats["effects"][y.effects["slot4"].id]["1"]+"</td><td>"+uW.cm.thronestats["effects"][y.effects["slot5"].id]["1"]+"</td></tr>";
  						 }
  						}
  					}
  					}

  		}
  	}
	if (z=="") {
	  ById("BOItemLive").innerHTML="<br><center>"+lang.AUTOTRONE.autosalvage.nodelitem+"</center>";
	}else{
  	 var t="<table width=95%><tr><td><b>"+lang.General.name+"</td><td><b>"+lang.AUTOTRONE.effet+" 3<td><b>"+lang.AUTOTRONE.effet+" 4<td><b>"+lang.AUTOTRONE.effet+" 5</tr>" + z + "</table>";
         ById("BOItemLive").innerHTML=t;

  }
 },
 SalvageV2: function (){
      var t = Tabs.Throne;
  var m = '<Div><DIV id=trSalvage class=boStat><b>'+lang.AUTOTRONE.autosalvage2.title+'</b> - <input type=button value="?" id=boaidesalvage class=boAide></div>';
             m += "<div id='BOInfoArea'>";
             m += '</div>';
             m += '<TABLE id=tBOupgrader width =100% height=0% class=ptTab style="padding-left: 20px;">';
             if (salvageData.salvageActive == false) {
                 m += '<tr><TD><div><INPUT id=BOSalvagerPower type=submit value="Salvager = OFF"/></div></td>';
             } else {
                 m += '<tr><TD><div><INPUT id=BOSalvagerPower type=submit value="Salvager = ON"/></div></td>';
             }
             m += '<td><b> '+lang.AUTOTRONE.autosalvage2.BOSalvageCity+' </b></td>';
             m += "<td><div id='BOSalvageCity'></td><td></td></tr>";

             m += '<tr><td><div> '+lang.AUTOTRONE.autosalvage2.BOSalvageQuality+' <select id="BOSalvageQuality">';
             m += '<option value="1">Common</option>';
             m += '<option value="2">Uncommon</option>';
             m += '<option value="3">Rare</option>';
             m += '<option value="4">Epic</option>';
             m += '<option value="5">Wondrous</option>';
             m += '</select> '+lang.AUTOTRONE.autosalvage2.BOSalvageQuality2+'</div></td>';

             m += '<td>'+lang.AUTOTRONE.autosalvage2.BOSaveNum+' <INPUT id=BOSaveNum type=text size=3 maxlength=3 value="' + salvageData.throneSaveNum+ '"/> items</td>';
             m += '<td><div><INPUT id=BOSalAnyCity type=checkbox '+ (salvageData.anyCity?' CHECKED':'') +'/> '+lang.AUTOTRONE.autosalvage2.BOSalAnyCity+'</div></td>';
		     m += '<tr><td><td>'+lang.AUTOTRONE.autosalvage2.BOMaxStone+' <INPUT id=BOMaxStone type=text size=7 maxlength=7 value="' + salvageData.maxStones+ '"/><TD>'+lang.AUTOTRONE.autosalvage2.BOOverflow+' <select id=BOOverflow><option value="order">'+lang.AUTOTRONE.autosalvage2.BOOverflow1+'</option><option value="lowest">'+lang.AUTOTRONE.autosalvage2.BOOverflow2+'</option>  </select>';
             m += "</tr><tr><td colspan=3>"+lang.AUTOTRONE.autosalvage.alert+"</table><hr>";

             m += "<div id='BORulesCreate' class='trRuleCreate'>";

             // rules definition
             m += '<TABLE width=100% class=trTabPad style="padding-left: 10px;">';
             m += '<tr><td>  <b>'+lang.AUTOTRONE.autosalvage2.rulestitle+' </b> </td>';

             m += '<td alight="left"><div><span>'+uW.g_js_strings.commonstr.faction+': <select id="BOFactionType">';
             m += '  <option value="any">'+lang.AUTOTRONE.autosalvage2.any+'</option>';
             m += '  <option value="fey">Fey</option>';
             m += '  <option value="briton">Briton</option>';
             m += '  <option value="druid">Druid</option>';
             m += '</select></span></div></td>';
             m += '<td alight="left"><div><span>'+lang.AUTOTRONE.autosalvage2.BOCardType+' <select id="BOCardType">';
             m += '  <option value="any">'+lang.AUTOTRONE.autosalvage2.any+'</option>';
             m += '  <option value="chair">Chair</option>';
             m += '  <option value="table">Table</option>';
             m += '  <option value="window">Window</option>';
             m += '  <option value="banner">Banner</option>';
             m += '  <option value="advisor">Advisor</option>';
             m += '  <option value="trophy">Trophy</option>';
             m += '</select></span></div></td>';
             m += '<td align="right"><INPUT id=BOAddRule type=submit value="'+lang.AUTOTRONE.autosalvage2.BOAddRule+'"/></td>';
             m += '</tr></table>';
             m += '<TABLE  class=trTabPad width=100% id="BOConditionTable"  style="padding-left: 5px;">';
             m += '<tr><td align=left colspan=1><INPUT id=BOAddRow type=submit value="'+lang.AUTOTRONE.autosalvage2.BOAddRow+'"/></td>';
             m += '<td></td><td></td><td></td><td></td><td></td></tr>';
             m += '</table>';
             m += '</div><hr/>';
             m += '<div id="BOSalvStatus" style="text-align: center;" >'+lang.AUTOTRONE.autosalvage2.BOSalvStatus+' </div><hr/>';
             m += '<div class=trRulePane>';
             m += '<div align=center  class=boStat> <b> '+lang.AUTOTRONE.autosalvage2.explainRules+' </b></div>';
             m += "<div id='BORuleDisplay' style=' max-height:350px; height:250px; overflow-x: auto; overflow-y:scroll;'>";
             m += '</div></div>';
             t.Overv.innerHTML = m;
             new CdispCityPicker ('BOcitysel', document.getElementById('BOSalvageCity'), true, t.e_CityButton, upgradeData.sCityNum);

			 $('#BOSalAnyCity').change( function(){ salvageData.anyCity = ById('BOSalAnyCity').checked; saveSalvageData(); });
			 $("#BOMaxStone").change ( function() { salvageData.maxStones = $("#BOMaxStone").val();saveSalvageData();});
           	 ById ('BOSaveNum').addEventListener ('change', function() {
				 salvageData.throneSaveNum = parseInt($("#BOSaveNum").val());
				 if (upgradeData.retryInterval < 0) salvageData.throneSaveNum = 0;
				 saveSalvageData();
				}, false);
             $("#BOOverflow").val(salvageData.overflow);
             $("#BOOverflow").change( function() { salvageData.overflow = $("#BOOverflow").val(); saveSalvageData();});
             document.getElementById ('BOSalvageQuality').addEventListener ('click', function() {salvageData.minQuality = parseIntNan(this.value);saveSalvageData();}, false);
             document.getElementById ('BOSalvageQuality').value = salvageData.minQuality;
             document.getElementById ('BOAddRow').addEventListener ('click', function() {t.S2createRow();}, false);
             document.getElementById ('BOAddRule').addEventListener ('click', function() {t.S2createRule();}, false);
   		     ById('boaidesalvage').addEventListener('click', function(){
 	       	   window.open(sitesupport+"?page=aide_autosalvage");
    		 } , false);
    		 t.S2createRow();
             t.S2buildRuleDisplay();
 },
 rowNum:0,
 S2createRow : function()
         {
              var t = Tabs.Throne;
             var table = document.getElementById('BOConditionTable');
             var rowCount = table.rows.length;
             var row = table.insertRow(rowCount-1);
             var rowId = "BOr" + t.rowNum;
             t.rowNum++;
             row.id = rowId;

             var h  = "<td> <select id='" + rowId + "sel1'> <option value='true'> </option> <option value='false'>"+lang.AUTOTRONE.autosalvage2.row1+"</option></select></td>";
             h += "<td> <select id='" + rowId + "sel2'>";
             h += "  <option value='1'>1x</option>";
             h += "  <option value='2'>2x</option>";
             h += "  <option value='3'>3x</option>";
             h += "  <option value='4'>4x</option>";
             h += "  <option value='5'>5x</option>";
             h += "</select></td>";
             h += "<td> <select id='" + rowId + "sel3'>";
             h += "</select></td>";
             h += "<td> <select style='display:none' id='" + rowId + "sel4'>";
             h += "  <option value='e'>"+lang.AUTOTRONE.autosalvage2.Either+"</option>";
             h += "  <option value='b'>Buff</option>";
             h += "  <option value='d'>Debuff</option>";
             h += "</select></td>";

             h += "<td> "+lang.AUTOTRONE.autosalvage2.slots+" ";
             h += "  <input type=checkbox value='1' checked=true id='" + rowId + "slot1'/>1";
             h += "  <input type=checkbox value='2' checked=true id='" + rowId + "slot2'/>2";
             h += "  <input type=checkbox value='3' checked=true id='" + rowId + "slot3'/>3";
             h += "  <input type=checkbox value='4' checked=true id='" + rowId + "slot4'/>4";
             h += "  <input type=checkbox value='5' checked=true id='" + rowId + "slot5'/>5";
             h += "</td>";

             row.innerHTML = h;

             var effects = [];

             for (e in uW.cm.thronestats.effects)
             {
                 var effectName = uW.cm.thronestats.effects[e][1];//.split(" Debuff")[0];
                 //if (effects.indexOf(effectName) < 0)
                 effects.push(effectName);
             }

             var select = document.getElementById(rowId + "sel3");
             for(index in effects) {
                 if (typeof(effects[index])=="string")
                   select.options.add(new Option(effects[index], effects[index]));
             }

             var c = row.insertCell(5);
             var btn = document.createElement("input");
             btn.type = "submit";
             btn.value = "X";
             btn.onclick = function () { t.S2removeRow(row);};
             c.appendChild(btn);
        },
     pickCity : function () {
            var t = Tabs.Throne;
            var cid = upgradeData.sCityNum;
            if (!Seed.cities[cid]) {
             upgradeData.sCityNum=0;
             cid=0;
		    }
 			if ( Seed.resources["city" + Seed.cities[cid][0]]["rec5"][0] <= salvageData.maxStones) return cid;
            var ind = -1,lowest = 9999999;
            if (salvageData.anyCity)   {
			 for (i= 0; i < Seed.cities.length; i++)  {

               if (salvageData.overflow == "lowest")  {
			        if (Seed.resources["city" + Seed.cities[i][0]]["rec5"][0] < lowest ) ind = i;lowest = Seed.resources["city" + Seed.cities[ind][0]]["rec5"][0];
			   }else{
			        if ( Seed.resources["city" + Seed.cities[i][0]]["rec5"][0] <= salvageData.maxStones) return i;
               }
			 }
           }
           return ind;
        },
         S2createRule : function()
	        {
	            var t = Tabs.Throne;
	            t.S2readRows();
	            t.S2buildRuleDisplay();
        },
        S2buildRuleDisplay : function ()
	        {
	            var t = Tabs.Throne;
	            var rd = document.getElementById('BORuleDisplay');

	            var m = '<TABLE  width=100% class="trTabPad">';

	            for (i =0; i < salvageData.ruleSet.length; i++)
	            {
	                var rule = salvageData.ruleSet[i];

	                m += '<tr>';
	                m += "<td width=90%><div class='trRule'>";

	                m += "Type: " + rule.type;
	                m += " Faction: " + rule.faction;

	                for (ii = 0; ii < rule.conditions.length; ii++)
	                {
	                    var condition = rule.conditions[ii];

	                    if (ii ==0 )
	                        m += "<br> Item";
	                    else
	                        m += "<br> <u>"+lang.AUTOTRONE.autosalvage2.and+"</u>";

	                    if (condition.mustHave != "false")
	                        m += " "+lang.AUTOTRONE.autosalvage2.musthave+" ";
	                    else
	                        m += " "+lang.AUTOTRONE.autosalvage2.mustnothave+" ";

	                    m += condition.number + "x ";
	                    m += condition.effect + " ";
	                    m += " "+lang.AUTOTRONE.autosalvage2.inslot+" ";
	                    for (j = 0; j < condition.slots.length; j++)
	                    {
	                        if (condition.slots[j] ) m += (j+1) + " ";
	                    }
	                }
	                m += "</div></td>";
	                m += "<td width=20%><INPUT id=BODelRule" + i + " type=submit value='"+lang.AUTOTRONE.autosalvage2.BODelRule+"' /></td>";
	                m += '</tr>';
	            }
	            rd.innerHTML = m;
	            for (var j=0; j < salvageData.ruleSet.length; j++)
	            {
	                document.getElementById('BODelRule' +j).v1 = j;
	                document.getElementById('BODelRule' +j).addEventListener ('click', function() { t.S2deleteRule(this.v1)}, false);
	            }
	            document.getElementById('BOSalvagerPower').addEventListener('click', function(){t.S2togglePower()} , false);
	},
        S2togglePower: function(){
	            var t = Tabs.Throne;
	            if (salvageData.salvageActive == true) {
	                var btn = ById('BOSalvagerPower');
	                if (btn) btn.value = "Salvager = OFF";
	                if (Options.BORac_Salvage2) updatebotbutton("Salv V2 - OFF", 'BOautosalvageV2');
	                salvageData.salvageActive = false;
	                clearInterval(t.sTimer);
	                t.delItems = [];
	            } else {
	                salvageData.salvageActive = true;
	                if (ById('BOSalvagerPower'))  ById('BOSalvagerPower').value = "Salvager = ON";
	                if (Options.BORac_Salvage2) updatebotbutton("Salv V2 - ON", 'BOautosalvageV2');
	                t.S2start();
	            }
	            saveSalvageData();
        },
          S2start : function(){
	            var t = Tabs.Throne;
	            clearInterval(t.sTimer);
	            if(salvageData.salvageActive) {
	             t.S2doSalvage();
	             t.sTimer = setInterval(t.S2doSalvage, 1*60*1000);
	            }
        },
         S2deleteRule : function(i)
        {
            var t = Tabs.Throne;
            salvageData.ruleSet.splice(i,1);
            saveSalvageData();
            t.S2buildRuleDisplay();
        },
        S2readRows : function()
	        {
	            var t = Tabs.Throne;
	            var table = ById('BOConditionTable');
	            var rowCount = table.rows.length;

	            var cType = ById('BOCardType').value;
	            var faction = ById('BOFactionType').value;

	            var conditions = [];
	            for (i=0; i < table.rows.length; i++)
	            {
	                var row = table.rows[i];
	                if (row.id)
	                {
	                    var s1 = document.getElementById(row.id + "sel1");
	                    var s2 = document.getElementById(row.id + "sel2");
	                    var s3 = document.getElementById(row.id + "sel3");
	                    var s4 = document.getElementById(row.id + "sel4");

	                    var slots = [];
	                    for (j =1; j <= 5; j++)
	                    {
	                        var ch = document.getElementById(row.id + "slot" + j);
	                        slots.push(ch.checked);
	                    }

	                    var c = new Condition(s1.value, s2.value, s3.value, s4.value, slots );
	                    conditions.push(c);
	                }
	            }
	            var rule1 = new Rule(cType, faction, conditions);
	            t.addRule(rule1);
	        },

	        S2removeRow : function(row)
	        {
	            var table = ById('BOConditionTable');

	            for (i=0; i < table.rows.length  ; i++ )
	            {
	                if (table.rows[i] == row)
	                {
	                    table.deleteRow(i);
	                    break;
	                }
	            }
	        },
	        addRule : function(rule)
	        {
	            salvageData.ruleSet.push(rule);
	            saveSalvageData();
	        },
	        e_CityButton : function (city, x, y){
	            var t = Tabs.Throne;
	            upgradeData.sCityNum = city.idx;
	            saveUpgradeData();
	        },
   S2doSalvage : function() {
            var t = Tabs.Throne;
            if(!salvageData.salvageActive) {
                return;
            }

            if (t.deleting == true) return;
            t.deleting = true;
            t.setStatus(lang.AUTOTRONE.autosalvage2.status1);

            t.delItems = t.S2buildList(false);

            if (t.delItems.length > 0) {
                t.S2doDelete();
            } else {
                t.deleting = false;
                t.setStatus(lang.AUTOTRONE.autosalvage2.status2);
            }
 },
 S2buildList : function(test){
            var t = Tabs.Throne;
            var throneSaveNum = salvageData.throneSaveNum;
            var countItem = 0;
            var retList = [];
            for (k in uW.kocThroneItems) {
                var throne_item = uW.kocThroneItems[k];
                countItem++;
                if (throne_item.level !=0) continue;
                if (test != true)
                {
                    if (throne_item.isEquipped) continue;
                    if (throne_item.isBroken) continue;
                }
                if ( countItem <= throneSaveNum) continue;
                if (throne_item.quality >= salvageData.minQuality) continue;
                if (t.applyRules(throne_item.id)) continue;

                Upgrading=true;
                for (k in ThroneOptions.Items) {
                 if (ThroneOptions.Items[k]["id"] == throne_item.id) Upgrading = false;
                }
                if (Upgrading)
                 retList.push(throne_item.id);
            }
            return retList;
        },

        setStatus : function(msg)
        {
            if (ById('BOSalvStatus'))
               ById('BOSalvStatus').innerHTML = msg;
        },
        applyRules : function(id) {
            var t = Tabs.Throne;
            for (r in salvageData.ruleSet)
            {
                var rule = salvageData.ruleSet[r];
                if ( rule.applyRule(id)) return true;
            }
            return false;
        },
        S2doDelete : function(){
            if(!salvageData.salvageActive) {
                return;
            }


            var t = Tabs.Throne;
            var id = t.delItems[0];
            var params = uW.Object.clone(uW.g_ajaxparams);
            var num_city = t.pickCity();
            if ( num_city < 0)
            {
                t.setStatus(lang.AUTOTRONE.autosalvage2.status3);
                num_city = upgradeData.sCityNum;
            }
            var item = uW.kocThroneItems[id];
            if (item)
              t.setStatus(lang.AUTOTRONE.autosalvage2.status4+' ' + item.name);

            params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
            params.action = 'salvage';
            params.itemId = id;
            params.cityId = Seed.cities[num_city][0];
            new AjaxRequest(uW.g_ajaxpath + "ajax/_dispatch53.php" + uW.g_ajaxsuffix, {
                method: "post",
                parameters: params,
                loading: true,
                onSuccess: function (transport) {
                    var rslt = eval("(" + transport.responseText + ")");
                    var throne_item = uW.kocThroneItems[id];
                    if(rslt.ok) {
                        //trSalvageLog('Deleted Throne room item '+ throne_item.name);
                        salvageData.numSalvagedItems++;
                        saveSalvageData();
                        var tmp = uW.currentcityid;
                        uW.currentcityid = Seed.cities[num_city][0];
                        if (throne_item) throne_item.salvage();
                        uW.currentcityid = tmp;
                    }
                    else
                    {
                        t.setStatus(lang.AUTOTRONE.autosalvage2.status5+' ' + throne_item.name);
                        uW.cm.ThroneView.renderInventory(uW.kocThroneItems);
                        uW.update_seed_ajax(true, function() {uW.cm.ThroneView.renderInventory(uW.kocThroneItems);});
                    }

                    var idx = t.delItems.indexOf(id);
                    if (idx >=0)
                    {
                        t.delItems.splice(idx,1);
                    }
                    if (t.delItems.length > 0) {
                        setTimeout (t.S2doDelete, 2000);
                    } else {
                        t.deleting = false;
                        t.setStatus(lang.AUTOTRONE.autosalvage2.status6);
                        return;
                    }
                },
                onFailure: function () {
                    t.delIems = [];
                    t.deleting = false;
                    uW.cm.ThroneView.renderInventory(uW.kocThroneItems);
                    return;
                },
            });
        },
 Salvage: function (){
    var t = Tabs.Throne;
    try {
      var liste = uW.cm.thronestats.effects;
      m = '<DIV id=pbTowrtDivF class=boStat>'+lang.AUTOTRONE.autosalvage.title+'</div><TABLE width=100%>';
        m+='<TR><TD><INPUT type=submit id=pbsalvage_run value="Auto Salvage = '+(Options.ThroneDeleteItems?'ON':'OFF')+'" /><br><br>Interval : <input type=text size=3 id=BOThroneInterval value="'+ThroneOptions.IntervalMin+'"> '+lang.General.mins+'</td>';
	  m+='<TD>'+lang.AUTOTRONE.autosalvage.SalvageQuality+' ' + htmlSelector({0:uW.g_js_strings.commonstr.all, 1:uW.g_js_strings.throneRoom.common, 2:unsafeWindow.g_js_strings.throneRoom.uncommon, 3:unsafeWindow.g_js_strings.throneRoom.rare, 4:unsafeWindow.g_js_strings.throneRoom.epic, 5:unsafeWindow.g_js_strings.throneRoom.wondrous},ThroneOptions.SalvageQuality,'id=Quality')+' '+lang.AUTOTRONE.autosalvage.SalvageQuality2+'<br>\
	  '+lang.AUTOTRONE.autosalvage.RangeSaveMode+' '+ htmlSelector({0:lang.AUTOTRONE.autosalvage.SalvageKeepEffects1, 2:lang.AUTOTRONE.autosalvage.SalvageKeepEffects2, 4:lang.AUTOTRONE.autosalvage.SalvageKeepEffects3, 7:lang.AUTOTRONE.autosalvage.SalvageKeepEffects4, 8:lang.AUTOTRONE.autosalvage.SalvageKeepEffects5},Options.RangeSaveModeSetting,'id=selectRangeSaveMode') +' '+lang.AUTOTRONE.autosalvage.RangeSaveMode2+'<br>\
	  '+lang.AUTOTRONE.autosalvage.BOSType+' <input type=checkbox id=BOSType_advisor '+ (ThroneOptions.SalvageAdvisor?'CHECKED ':'') +'>advisor <input type=checkbox id=BOSType_banner '+ (ThroneOptions.SalvageBanner?'CHECKED ':'') +'> banner <input type=checkbox id=BOSType_chair '+ (ThroneOptions.SalvageChair?'CHECKED ':'') +'> chair <input type=checkbox id=BOSType_table '+ (ThroneOptions.SalvageTable?'CHECKED ':'') +'> table<input type=checkbox id=BOSType_window '+ (ThroneOptions.SalvageWindow?'CHECKED ':'') +'> window<input type=checkbox id=BOSType_trophy '+ (ThroneOptions.SalvageTrophy?'CHECKED ':'') +'> trophy<br>\
	  '+lang.AUTOTRONE.autosalvage.BOSTripleSalvage+' <input type=checkbox id=BOSTripleSalvage '+ (ThroneOptions.SalvageTriple?'CHECKED ':'') +'></td>';
     m+='<TD><INPUT id=ShowSalvageHistory type=submit value="'+lang.AUTOTRONE.history+'"></td></tr><tr><td colspan=3>'+lang.AUTOTRONE.autosalvage.alert+'</td></tr></table>'
     m+='<DIV id=pbTowrtDivF class=boStat>'+lang.AUTOTRONE.autosalvage.titleeffet+'</div><div style="overflow-y:auto; max-height:'+(Options.HauteurBoite-420)+'px; height: '+(Options.HauteurBoite-420)+'px;"><TABLE width=80% style="background-color:transparent;"><tr style="background-Color:#aaa;text-align:center"><td>&nbsp;</td><td><b>'+lang.AUTOTRONE.autosalvage.col1+'</td><td><b>'+lang.AUTOTRONE.autosalvage.col2+'</td><td></td></tr>';
     var z = uW.cm.thronestats.effects;
       for (k in liste){
	         if (liste[k] !=undefined){
		                 m+='<tr><td width=50>&nbsp;</td><td><INPUT class='+k+' id="BOS_'+k+'" type=checkbox '+ (ThroneOptions.Salvage[k]?'CHECKED ':'') +'/>&nbsp;'+liste[k][1]+'</td><td >'+z[k]["2"] +'</td><td>&nbsp;</td></tr>';
	         }
        }
      m+='</table></div><DIV class=boStat>'+lang.AUTOTRONE.autosalvage.titlelive+'&nbsp;<button id=BOActual href=javascript:void(0)>'+lang.AUTOTRONE.autosalvage.refresh+'</button></div><div id=BOItemLive style="overflow-y:auto;height:150px;max-height:150px"></div>';
      t.Overv.innerHTML = m;
      t.showLive();
      ById("BOActual").addEventListener('click',t.showLive,false);
      if (parseIntNan(ById("BOThroneInterval").value)<2) ById("BOThroneInterval").value=2;
      ById("BOThroneInterval").addEventListener('change', function(e){
		if (parseIntNan(ById("BOThroneInterval").value)<2) ById("BOThroneInterval").value=2;
		ThroneOptions.IntervalMin=ById("BOThroneInterval").value;
		saveThroneOptions();
	  },false);
	ById("BOSTripleSalvage").addEventListener('click', function(e){
		ThroneOptions.SalvageTriple=ById("BOSTripleSalvage").checked;saveThroneOptions();
	  },false);
      ById("BOSType_advisor").addEventListener('click', function(e){
		ThroneOptions.SalvageAdvisor=ById("BOSType_advisor").checked;saveThroneOptions();
	  },false);
      ById("BOSType_banner").addEventListener('click', function(e){
		ThroneOptions.SalvageBanner=ById("BOSType_banner").checked;saveThroneOptions();
	  },false);
	 ById("BOSType_chair").addEventListener('click', function(e){
		ThroneOptions.SalvageChair=ById("BOSType_chair").checked;saveThroneOptions();
	  },false);
	   ById("BOSType_table").addEventListener('click', function(e){
	  		ThroneOptions.SalvageTable=ById("BOSType_table").checked;saveThroneOptions();
	  },false);
	   ById("BOSType_window").addEventListener('click', function(e){
	  		ThroneOptions.SalvageWindow=ById("BOSType_window").checked;saveThroneOptions();
	  },false);
	     ById("BOSType_trophy").addEventListener('click', function(e){
	  	  		ThroneOptions.SalvageTrophy=ById("BOSType_trophy").checked;saveThroneOptions();
	  },false);
        ById("pbsalvage_run").addEventListener('click', function(e){
		t.toggleSalvage();
	  },false);
        ById('selectRangeSaveMode').addEventListener ('change', function(){
                 Options.RangeSaveModeSetting = document.getElementById('selectRangeSaveMode').value;
                saveOptions();
  		 },false);


  		 for (famille in uW.cm.thronestats.boosts) {
         boosts=uW.cm.thronestats.boosts[famille];
           for (k in liste){
	 	         if (liste[k] !=undefined){
	 		         for (l=0;l<liste[k]["2"].length;l++){
	 		              if (liste[k]["2"][l]==famille)

	 		                 ById('BOS_'+k).addEventListener ('change', function(e){

	 		                    ThroneOptions.Salvage[e.target['className']] = ById('BOS_'+e.target['className']).checked;
	 		                    saveThroneOptions();
	 		                 },false);
	            		 }
	 	         }
        }


         }

      document.getElementById('Quality').addEventListener  ('change', function(){ThroneOptions.SalvageQuality = this.value;saveThroneOptions();},false);
      document.getElementById('ShowSalvageHistory').addEventListener('click', function(){t.PaintSalvageHistory()} , false);


    } catch (e) {
      t.Overv.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';
    }
  },
  toggleSalvage:function() {
  var t = Tabs.Throne;
                if(Options.ThroneDeleteItems){
  			if(ById("pbsalvage_run")) ById("pbsalvage_run").value = "Auto Salvage = OFF";
  			Options.ThroneDeleteItems = false;

  			if (Options.BORac_Salvage)  updatebotbutton("Salvage - OFF", 'BOautosalvagetab');
  			saveOptions();saveThroneOptions();
  			clearTimeout(t.timersalvage);
  		  } else {
  			if (ById("pbsalvage_run")) ById("pbsalvage_run").value = "Auto Salvage = ON";
  			Options.ThroneDeleteItems = true;
  			if (Options.BORac_Salvage) updatebotbutton("Salvage - ON", 'BOautosalvagetab');
  			t.SalvageRunning=false;
  			t.SalvageArray=[];t.LastDeleted=0;
  			t.salvageCheck();
  			saveOptions();saveThroneOptions();
		  }
  },
Upgrade_Enhance :function (){
    var t = Tabs.Throne;
    //try {
      var m = '<DIV id=pbTowrtDivF class=boStat>'+lang.AUTOTRONE.upgrade.title+'</div><TABLE width=100% height=0% class=pbTab><TR align="center">';
	       if (ThroneOptions.Active == false) {
	             m += '<TD><INPUT id=Enable type=submit value="Upgrade = OFF"></td>';
	       } else {
	            m += '<TD><INPUT id=Enable type=submit value="Upgrade = ON"></td>';
	      }
      m += '<td><input type=checkbox id=BOuse20001 '+(ThroneOptions.Use20001?'CHECKED':'')+'><img width=25 title="'+uW.itemlist.i20001.name+'" src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20001.jpg">\
      <input type=checkbox id=BOuse20002 '+(ThroneOptions.Use20002?'CHECKED':'')+'><img width=25 title="'+uW.itemlist.i20002.name+'" src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20002.jpg">\
      <input type=checkbox id=BOuse20005 '+(ThroneOptions.Use20005?'CHECKED':'')+'><img width=25 title="'+uW.itemlist.i20005.name+'" src="https://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/items/70/20005.jpg"></td><TD><INPUT id=ShowHistory type=submit value="'+lang.AUTOTRONE.history+'"></td>';
      m+= '</table><DIV id=pbTowrtDivF class=boStat>'+lang.AUTOTRONE.upgrade.title2+'</div><TABLE class=ptTab><br/>';
	  m+='<TR><TD>'+lang.AUTOTRONE.upgrade.items+'</td><TD><SELECT id=ThroneItems type=list>';
	       //document.getElementById('ThroneItems').options.length=0;
	       var nb=0,couleur=0;
	  		for (i in uW.kocThroneItems){
	  		nb++

	  			var styleee="background-color:#FFF";
	  			if (unsafeWindow.kocThroneItems[i].isEquipped) {
	  			 styleee="background-color:#DC9999";
	  			 if (nb==1) couleur=1;
	  			}

	  		if (nb<=(parseInt(Seed.throne.rowNum)*5))
	  			m+="<option style='"+styleee+"' value="+unsafeWindow.kocThroneItems[i]["id"]+">"+ThroneItemName(uW.kocThroneItems[i])+"</option>";
	}

	  m+='</select></td>';
      m+='<TD><INPUT id=addEnhance type=submit value="Enhance"></td>';
	  m+='<TD><INPUT id=addUpgrade type=submit value="Upgrade"></td>';
	  m+='<TD rowspan=2><DIV id=ShowHoover></div></td>';
	  m+='</tr><tr><td colspan=2>'+lang.AUTOTRONE.upgrade.bonexttries+' <input size=3 type=text value="'+ThroneOptions.nexttries+'" id=bonexttries><br>'+lang.AUTOTRONE.upgrade.bonexttries1+'</td></tr></table><br/>';
	  m+= '<DIV id=pbTowrtDivF class=boStat>'+lang.AUTOTRONE.upgrade.title3+'</div>';
	  m+= '<br/><DIV id=ShowStatus></div></p>';
	  m+= '<DIV id=ShowTries></div><br/>';
	  m+= '<DIV id=ShowStones></div><br/>';
	  m+= '<br/><DIV id=ShowInfo></div><br/>';
      m+= '<DIV id=pbTowrtDivF class=boStat>'+lang.AUTOTRONE.upgrade.title4+'</div>';
	  m+= '<br/><DIV id=ShowQueueDiv></div>';
	  t.Overv.innerHTML = m;
        if (couleur==1) ById("ThroneItems").style.backgroundColor="#DC9999"
	ById('bonexttries').addEventListener ('change', function (){
	 ThroneOptions.nexttries = parseIntNan(ById('bonexttries').value);
	 ById('bonexttries').value=ThroneOptions.nexttries;
	 saveThroneOptions();
	},false);
	document.getElementById('addEnhance').addEventListener ('click', function (){t.addToQueue(document.getElementById('ThroneItems').value,"Enhance");},false);
	document.getElementById('addUpgrade').addEventListener ('click', function (){t.addToQueue(document.getElementById('ThroneItems').value,"Upgrade");},false);
	ById("BOuse20005").addEventListener ('click', function (){ ThroneOptions.Use20005=ById("BOuse20005").checked;saveThroneOptions();	},false);
	ById("BOuse20001").addEventListener ('click', function (){ ThroneOptions.Use20001=ById("BOuse20001").checked; saveThroneOptions();	},false);
	ById("BOuse20002").addEventListener ('click', function (){ ThroneOptions.Use20002=ById("BOuse20002").checked; saveThroneOptions();	},false);
	document.getElementById('ThroneItems').addEventListener ('change', function (){t.paintHoover();},false);

  	document.getElementById('Enable').addEventListener('click', function(){t.toggleThroneState()} , false);
  	document.getElementById('ShowHistory').addEventListener('click', function(){t.PaintHistory()} , false);

	if (ThroneOptions.Items.length ==0 && ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.noitem;
	else {
      if (ThroneOptions.Active && Seed.queue_throne.end == undefined && ById('ShowStatus')) document.getElementById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.waiting;
      if (ThroneOptions.Active && Seed.queue_throne.end != undefined && ById('ShowStatus')) t.setRepairTimer = setInterval (t.repairTimerUpdate,1000);
      if (!ThroneOptions.Active && Seed.queue_throne.end != undefined && ById('ShowStatus')) t.setRepairTimer = setInterval (t.repairTimerUpdate,1000);
      if (!ThroneOptions.Active && Seed.queue_throne.end == undefined && ById('ShowStatus')) document.getElementById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.off;
    }
   if (ThroneOptions.Tries > 0) document.getElementById('ShowTries').innerHTML = lang.AUTOTRONE.upgrade.retry+"" + ThroneOptions.Tries + "<br />"+lang.AUTOTRONE.upgrade.good+" " + ThroneOptions.Good + "  "+lang.AUTOTRONE.upgrade.bad+" " + ThroneOptions.Bad;
		else document.getElementById('ShowTries').innerHTML = lang.AUTOTRONE.upgrade.retry+" --";

	if (ThroneOptions.Items.length>0) { // && ThroneOptions.Tries > 0) {
	   t.PaintQueue();
	   t.paintInfo();
	 }
	t.paintStones();
	t.paintHoover();
   setInterval(t.paintStones,30000);
},


doPreset : function (preset){
 	ById("BOMsgOrg").innerHTML="Patientez..";
	var t = Tabs.Throne;
	var params = uW.Object.clone(unsafeWindow.g_ajaxparams);
	params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
	params.action = 'setPreset';
	params.presetId = preset;

  	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
		method: "post",
		parameters: params,
		loading: true,
		onSuccess: function (transport) {
			var rslt = eval("(" + transport.responseText + ")");
				if(rslt.ok){
					button = '<li id="throneInventoryPreset' + preset + '" class="active">'+preset+'</li>';
					uW.cm.ThroneView.clickActivePreset(button);
				        ById("BOMsgOrg").innerHTML="Patientez...";
					setTimeout(function() {
					  							ById("BOMsgOrg").innerHTML="OK";
					  							 t.Organize();

  					},4000);

			   } else {
			     ById("BOMsgOrg").innerHTML="Error";
			     ById ('PresetList').value = Seed.throne.activeSlot;
       			     t.selectPreset(Seed.throne.activeSlot);
			   }
		},
		onFailure: function () {
		   return;
		},
	});

},
itemLists : [],
itemTypes : { chair: 0, table: 1, window: 2, banner: 3, advisor: 4, trophy:5},
selectedItems : [],
Organize:function() {
 var t = Tabs.Throne;
 t.fillLists();
 var m = '<DIV class=boStat>'+lang.AUTOTRONE.equip.title2+'</div>';
 m += '<TABLE  width=95% class=trTabPad2><tr align="center"><td  width=33%><center>'+lang.AUTOTRONE.equip.preset2+'<select id="PresetList">';
 for (k= 1; k <= Seed.throne.slotNum; k++)
 	{
          m += '<option value="'+k+'">'+ k +'</option>';
	}
       m += '</select></td>';
       m += '<td><span id=BOMsgOrg></td>';
       if (Options.alertConfig.Atkpreset) {
       m+='<td width=33%>'+lang.AUTOTRONE.equip.preset3+' : <b>'+Options.Atkpreset+'</b></td></tr>';

       }
       m += '</table>';
       m += "<div id='BOScrollDiv'>";
       m += "<div id='BOTableDiv'>";
       m += '<TABLE id=BODisplayTable align=center width=100% height=0% cellpadding="4" class=trTab style=" -moz-transform: scale(' + TABLE_SCALE + ', '+ TABLE_SCALE + '); -moz-transform-origin: 0% 0%;  -webkit-transform: scale(' + TABLE_SCALE + ', '+ TABLE_SCALE + ');  -webkit-transform-origin: 0% 0%; } ">';
       m += "<th>Chairs</th><th>Tables</th><th>Windows</th><th>Banners</th><th>Advisors</th><th>Trophies</th>";
       m += '</table></div>';
       m += '</div>';
       m += '</div>';
       t.Overv.innerHTML = m;
       t.paintTable();
       ById ('PresetList').addEventListener ('change', function( ) {
         t.doPreset(this.value);
       }, false);
       uW.BOSelectCard = t.selectCard;
       ById ('PresetList').value = Seed.throne.activeSlot;
       t.selectPreset(Seed.throne.activeSlot);

},
buildCard : function(I){
     var t = Tabs.Throne;
     var D = [];
     var w=uW.cm.thronestats.mightByQuality;
     var z=uW.cm.thronestats.mightByLevel;
     if (I == null)
     {
	    D.push("<div>");
	    D.push("</div>");
	    return D.join("");
     }
     D.push(" <div class='trCard' style='white-space: normal; padding: 0px;' onclick='BOSelectCard(" + I.id + ");'> ");
     D.push("<div class='section'>");
     D.push(" <div class='title "+I.createPrefix().toLowerCase()+"' style='text-transform: capitalize;'> ");
     D.push(I.name);
     D.push(" </div> ");
     D.push(" <div class='description'> ");
     D.push(" <div style='margin-right:4px;float:left;background:transparent url(http://kabam1-a.akamaihd.net/kingdomsofcamelot/fb/e2/src/img/throne/icons/70/"+I.faction+"_"+I.type+"_normal_1_"+I.quality+".png) top left no-repeat;'> </div> ");
     D.push("<ul>");
     D.push("<li>"+uW.g_js_strings.commonstr.faction+": "+I.faction+"</li>");
     D.push("<li>"+uW.g_js_strings.commonstr.quality+": "+I.createPrefix()+"</li>");
     D.push("<li>"+uW.g_js_strings.commonstr.type+": "+I.type+"</li>");
     D.push("<li>"+uW.g_js_strings.commonstr.level+": "+I.level+"</li>");
     D.push("<li>"+uW.g_js_strings.commonstr.might+": "+(w[I.quality].Might+z[I.level].Might)+"</li>");
     D.push("</ul>");
     D.push(" </div> ");
     D.push(" <ul> ");

     for (M in I.effects)
     {
       var N = I.effects[M];
       effect=uW.cm.thronestats.effects[N.id];
       tier=uW.cm.thronestats.tiers[N.id][N.tier];
       percent=+(tier.base+((I.level*I.level+I.level)*tier.growth*0.5));
       percent=(percent>0)?"+"+percent:+percent;
       percent=Math.ceil(percent);
       css=(M%2===0)?"even":"odd";
       B=+(M.split("slot")[1]);
       if(B<=I.quality){
          D.push(" <li class='effect "+css+"' style='height:40px'> "+percent+"% "+effect[1]+" </li> ");
       }else{
          D.push(" <li class='effect disabled "+css+"' style='height:40px'> "+percent+"% "+effect[1]+" </li> ");
       }
     }
     D.push(" </ul> ");
     D.push(" </div> ");
     D.push(" </ul> ")
     D.push(" </div> ");
     return D.join("");

   },
 paintTable : function() {
	   // fill in the table
	 var t = Tabs.Throne;
	   var m = "";
       var mm;
       var tab = document.getElementById('BODisplayTable');
       var ii = Math.max(t.itemLists['chair'].length, t.itemLists['table'].length, t.itemLists['window'].length, t.itemLists['banner'].length, t.itemLists['advisor'].length, t.itemLists['trophy'].length);

       m += "<th width=16%>Chairs</th><th width=16%>Tables</th><th width=16%>Windows</th><th width=16%>Banners</th><th width=16%>Advisors</th><th width=16%>Trophy</th>";
	   for (var k= 0; k < ii ; k++)
	   {
		 mm = '<TR style="vertical-align:top;">';
		 for (i in t.itemTypes)
		 {
			var item = t.itemLists[i][k];
			var id="BOcard";
			if (item != null)
			{
				id += item.id;
			}
		    mm += '<TD style="border: 5px solid white;" id="' + id +'" >';
            mm += t.buildCard(t.itemLists[i][k]);
            mm += '</TD>';
         }
         mm += '</TR>';
         m+= mm;
	   }
	   tab.innerHTML = m;
	   // repair the height/width caused by the 2d transform
       var d = document.getElementById ('BOTableDiv');
	   var t = document.getElementById ('BODisplayTable');
       if (t.offsetHeight !=0) d.style.height = (TABLE_SCALE * t.offsetHeight) + "px";
       if (t.offsetWidth !=0) d.style.width   = (TABLE_SCALE * t.offsetWidth) + "px";
   },
   selectPreset : function (p)
   {
	   var t = Tabs.Throne;
	   t.clearCards();
	   var equipedItems = Seed.throne.slotEquip[p];
	   if (equipedItems != null)
	   {
         for (ll =0; ll < equipedItems.length; ll++)
         {
	       t.selectCard2(equipedItems[ll]);
         }
       }
   },
   fillLists : function ()
      {
   	   var t = Tabs.Throne;

   	   for (i in t.itemTypes)
   	   {
   	      t.itemLists[i] = new Array;
   	   }

   	   for (k in unsafeWindow.kocThroneItems) {
            var throne_item = unsafeWindow.kocThroneItems[k];
            if (!throne_item.isBroken) {

              t.itemLists[throne_item.type].push(throne_item);
		    }
          }
      },
     selectCard2 : function(itemId)       {
         	   var t = Tabs.Throne;
         	   var item = unsafeWindow.kocThroneItems[itemId];
         	   var td;

         	   if (t.selectedItems[item.type] != null)
         	   {
                    td = document.getElementById( "BOcard" + t.selectedItems[item.type]);
                    if (td)
         	       {
         		      td.style.borderColor = "white";
         	       }
         	   }

         	   t.selectedItems[item.type] = itemId;
         	   td = document.getElementById( "BOcard"+itemId);
         	   if (td)
         	   {

         		   if (Seed.throne.activeSlot==ById('PresetList').value) {

         		    td.style.borderColor = "green";
         	   }
         	  }
   	 },
       selectCard : function(itemId)  {
   	   var t = Tabs.Throne;
   	   var item = unsafeWindow.kocThroneItems[itemId];
   	   var td;

   	   if (t.selectedItems[item.type] != null)
   	   {
              td = document.getElementById( "BOcard" + t.selectedItems[item.type]);
              if (td)
   	       {
   		      td.style.borderColor = "white";
   	       }
   	   }

   	   t.selectedItems[item.type] = itemId;
   	   td = document.getElementById( "BOcard"+itemId);
   	   if (td)
   	   {

   		   if (Seed.throne.activeSlot==ById('PresetList').value) {

   		    //td.style.borderColor = "green";
   		    t.doEquip(itemId, ById('PresetList').value, td);

   		   }
   	   }
},
clearCards : function()
      {
   	  var t = Tabs.Throne;
   	   for (k in t.selectedItems)
   	   {
   		   var td = document.getElementById( "BOcard" + t.selectedItems[k]);
              if (td)
   	       {
   		      td.style.borderColor = "white";
   	       }
   	   }
   	   t.selectedItems = [];
},
Stats :function (){
    var t = Tabs.Throne;
    try {
    m= '<DIV class=boStat><b>'+lang.AUTOTRONE.stats.title+'</b></div><center><table border=0 width=75%><tr><td>'+lang.AUTOTRONE.stats.power+'<br><b>'+addCommas(uW.cm.ThroneController.calcMight())+'</b></td><td colspan=2 style="text-align:right"><font size=1>'+lang.pubbao+'<br><iframe src="'+sitepub+'" width=320 marginwidth=0 marginheight=0 height=50 scrolling=no frameborder=0></iframe></td></tr>';
    var k=Seed.throne.slotEquip[Seed.throne.activeSlot],i=Seed.throne.inventory,e,faction;
      var B=0, w={}, x, C;
           for (var K in k) {
            var F = uW.kocThroneItems[k[K]];
            if (F) {
            x=0;

            for (var M in F.effects) {
            x++;
            if (F.quality >= x) {
             B++;
             I = uW.cm.thronestats.effects[F.effects[M].id];
             z = uW.cm.thronestats.tiers[F.effects[M].id][F.effects[M].tier];
             C = + z.base + (F.level * F.level + F.level) * + z.growth * 0.5;
             //C = Math.ceil(C);
             if (!F.isBroken) {
                if (!w[F.effects[M].id]) {
                  w[F.effects[M].id] = {};
                  w[F.effects[M].id].nameitem="";
                }
                if (!w[F.effects[M].id].percent) {
                  w[F.effects[M].id].percent = C;
                } else {
                 w[F.effects[M].id].percent += C;
                }
                w[F.effects[M].id].name = I[1];
                w[F.effects[M].id].nameitem += "(" + ThroneItemName(F) + ")<br>";
             }
            }
            }
            }
           }
         B = 0;
         for (var K in w) {
             var Current =  Math.round(w[K].percent*100)/100;
             G="<tr><td align=right><b>"+ Current + " %</b></td><td align=left><span title='"+w[K].nameitem+"'>" + w[K].name + "</td></tr>";

              m+=G;
         }

 	var u =  Seed.throne.slotEquip[Seed.throne.activeSlot];
		var z = uW.cm.ThroneController.hasFactionBonus(u);
 	if (z.hazBonus) {
	        switch (z.faction) {
	          case "briton":
	            B = 94;
	            F = uW.cm.ThroneController.effectBonus(B);
	            break;
	          case "fey":
	            B = 95;
	            F = uW.cm.ThroneController.effectBonus(B);
	            break;
	          case "druid":
	            B = 96;
	            F = uW.cm.ThroneController.effectBonus(B);
	            break;
	          default:;
        	}
 	  m+="<tr><td align=right><b>" + F + "%</td><td align=left>"+uW.g_js_strings.throneRoom["faction_bonus_" + z.faction] + "</tr>";
 	}
       m+="</table>";
      t.Overv.innerHTML = m;


    } catch (e) {
      t.Overv.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';
    }
},

togOpt : function (checkboxId, optionName, callOnChange){
    var t = Tabs.Throne;
    var checkbox = ById(checkboxId);
    if (Options[optionName])
      checkbox.checked = true;
    checkbox.addEventListener ('change', eventHandler, false);
    function eventHandler (){
      Options[optionName] = this.checked;
      saveOptions();
      if (callOnChange)
        callOnChange (this.checked);
    }
},

changeOpt : function (valueId, optionName, callOnChange){
    var t = Tabs.Throne;
    var e = ById(valueId);
    e.value = Options[optionName];
    e.addEventListener ('change', eventHandler, false);
    function eventHandler (){
      Options[optionName] = this.value;
      saveOptions();
      if (callOnChange)
        callOnChange (this.value);
    }
},

toggleThroneState: function(){
	var t = Tabs.Throne;
	 if (Options.salvageconfig.Repairrunning ==true) {
		       alert(lang.AUTOTRONE.repair.err1);
		       return;
    	 }
	if (ThroneOptions.Active == true) {
		    ThroneOptions.Active = false;
		    if(ById("Enable")) ById('Enable').value = "Upgrade = OFF";
		    if (Options.BORac_Upg) updatebotbutton("Upgrade - OFF", 'BOautoupgradetab');
		    saveThroneOptions();
            clearTimeout(t.setActionTimer);
            if (Seed.queue_throne.end == undefined && ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.off;
	} else {
		    ThroneOptions.Active = true;
		    if(ById("Enable")) ById('Enable').value = "Upgrade = ON";
		    if (Options.BORac_Upg) updatebotbutton("Upgrade - ON", 'BOautoupgradetab');
		    saveThroneOptions();
		    t.setActionTimer = setInterval(t.doAction,5000);
            if (ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.waiting;
	}
},

_addTab: function(id,name,qualityfrom,qualityto,levelfrom,levelto,action,active,cost){
	 	var t = Tabs.Throne;
	    var a="";
	    var b="";
	    switch (qualityfrom) {
        		case 0:a = unsafeWindow.g_js_strings.throneRoom.simple;break;
        		case 1:a = unsafeWindow.g_js_strings.throneRoom.common;break;
        		case 2:a = unsafeWindow.g_js_strings.throneRoom.uncommon;break;
       			 case 3:a = unsafeWindow.g_js_strings.throneRoom.rare;break;
        		case 4:a = unsafeWindow.g_js_strings.throneRoom.epic;break;
        		case 5:a = unsafeWindow.g_js_strings.throneRoom.wondrous;break;
        		default:a = unsafeWindow.g_js_strings.throneRoom.simple;break;
        }
        switch (qualityto) {
        		case 0:b = unsafeWindow.g_js_strings.throneRoom.simple;break;
        		case 1:b = unsafeWindow.g_js_strings.throneRoom.common;break;
        		case 2:b = unsafeWindow.g_js_strings.throneRoom.uncommon;break;
       			case 3:b = unsafeWindow.g_js_strings.throneRoom.rare;break;
       			case 4:b = unsafeWindow.g_js_strings.throneRoom.epic;break;
        		case 5:b = unsafeWindow.g_js_strings.throneRoom.wondrous;break;
        		default:b = unsafeWindow.g_js_strings.throneRoom.simple;break;
        }
        if (document.getElementById('ShowQueue')) {
	     var row = ById('ShowQueue').insertRow(0);
	     row.vAlign = 'top';
	     row.style.color = "black";
	     if (active) row.style.color = "green";
	     row.insertCell(0).innerHTML = id+1;
	     // voir les effets actuelles en cliquant sur le nom
	     namef=name;
	     var y = unsafeWindow.kocThroneItems[ThroneOptions.Items[id].id];
	     if (y) {
			 namef="<span id='queueDetail_" + id + "'>" + name + "</span><span id='queueDetail2_" + id + "' style='display:none'><TABLE width=100% height=0% align='left' class=pbTab>";
			 for (i=1;i<=5;i++) {
			 			   idzz = y["effects"]["slot"+i]["id"];
			 			   tier = parseInt(y["effects"]["slot"+i]["tier"]);
			 			   level = y["level"];
			 			   p = unsafeWindow.cm.thronestats.tiers[idzz][tier];
			 			   Current = p.base + ((level * level + level) * p.growth * 0.5);
			 			   level++;
			 			   Next = p.base + ((level * level + level) * p.growth * 0.5);;
			 			   var quality = parseInt(unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]]["quality"]);
				 		   if (i<=quality) namef+='<TR><TD align=left><FONT size=1 color=black>' + Current + "% " + unsafeWindow.cm.thronestats["effects"][idzz]["1"] + '</font></td></tr>';
			 					   else namef+='<TR><TD align=left><FONT size=1 color=black>' + Current + "% " + unsafeWindow.cm.thronestats["effects"][idzz]["1"] + '</font></td></tr>';

		    }
		    namef+="</table></span>";

		 }
		 row.insertCell(1).innerHTML = namef;
	     if (action == "Enhance") {
				row.insertCell(2).innerHTML = a + " -> " + b;
	   	 		row.insertCell(3).innerHTML = levelfrom;
	     }
	     if (action == "Upgrade") {
				row.insertCell(2).innerHTML = a;
	   	 		row.insertCell(3).innerHTML = levelfrom + " -> " + levelto;
	     }
	     row.insertCell(4).innerHTML = action;
		 row.insertCell(5).innerHTML = cost;
	     row.insertCell(6).innerHTML = '<a class="button20" id="queueDelete_' + id + '"><span>'+lang.General.delete+'</span></a>&nbsp;<a class="button20" id="queueDown_' + id + '"><span>'+lang.AUTOTRONE.upgrade.last+'</span>';
		 if (ById('queueDetail_' + id)) {
			  ById('queueDetail_' + id).addEventListener('click', function(){
				 if ( ById('queueDetail2_' + id).style.display=='none') {
					 ById('queueDetail2_' + id).style.display='block';
				 }else{
					  ById('queueDetail2_' + id).style.display='none';
				 }
			  },false);

	     }
             ById('queueDown_' + id).addEventListener('click', function(){

               var action=ThroneOptions.Items[id].action;
               var tid=ThroneOptions.Items[id].id;
               ThroneOptions.Tries = 0;
	       ThroneOptions.Good = 0;
	       ThroneOptions.Bad = 0;
               ThroneOptions.Items.splice (id,1);

               t.addToQueue(tid,action);

             },false);
            ById('queueDelete_' + id).addEventListener('click', function(){
			if (ThroneOptions.Items.length ==0 && ThroneOptions.Active && ById('ShowStatus')) {
			   document.getElementById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.nothing;
			 }
			if (!ThroneOptions.Active && ById('ShowStatus')) document.getElementById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.off;
			ThroneOptions.Items.splice (id,1);
			saveThroneOptions();
			t.checkUpgradeInfo(false);
      		t.PaintQueue();
      		if (ThroneOptions.Items.length>0) t.paintInfo();
      		  else ById('ShowInfo').innerHTML = "";
        }, false);

        }
},

	 _addTabHeader: function() {
	 var t = Tabs.Throne;
	 if (ById('ShowQueue')) {
	     var row = ById('ShowQueue').insertRow(0);
	     row.vAlign = 'top';
	     row.style.color = "black";
	     row.insertCell(0).innerHTML = "Id";
	     row.insertCell(1).innerHTML = uW.g_js_strings.commonstr.nametx;
	     row.insertCell(2).innerHTML = lang.AUTOTRONE.quality;
	     row.insertCell(3).innerHTML = lang.AUTOTRONE.level;
	     row.insertCell(4).innerHTML = uW.g_js_strings.commonstr.actions;
	     row.insertCell(5).innerHTML = uW.g_js_strings.commonstr.cost;
	     row.insertCell(6).innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
	   }
	  },

PaintHistory : function() {
	var t = Tabs.Throne;
	var popHistory = null;
	popHistory = new CPopup('pbShowHistory', 0, 0, 1100, 500, true, function() {clearTimeout (1000);});
	var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbShowBarbs" id="pbBars">';
	popHistory.getMainDiv().innerHTML = '</table></div>' + m;
	popHistory.getTopDiv().innerHTML = '<TD><B>'+lang.AUTOTRONE.upgrade.popHistory+'</B></td>';
	for (i=0;i<t.log.length;i++){
		var row = ById('pbBars').insertRow(0);
		row.vAlign = 'top';
		row.style.color = "black";
		row.insertCell(0).innerHTML = t.log[i].time;
		row.insertCell(1).innerHTML = t.log[i].name;
		row.insertCell(2).innerHTML = t.log[i].action;
		row.insertCell(3).innerHTML = t.log[i].tries;
		row.insertCell(4).innerHTML = t.log[i].good;
		row.insertCell(5).innerHTML = t.log[i].bad;
	}
	var row = ById('pbBars').insertRow(0);
	row.vAlign = 'top';
	row.style.color = "black";
	row.insertCell(0).innerHTML = lang.AUTOTRONE.upgrade.popCell0;
	row.insertCell(1).innerHTML = lang.AUTOTRONE.upgrade.popCell1;
        row.insertCell(2).innerHTML = lang.AUTOTRONE.upgrade.popCell2;
        row.insertCell(3).innerHTML = lang.AUTOTRONE.upgrade.popCell3;
        row.insertCell(4).innerHTML = lang.AUTOTRONE.upgrade.popCell4;
	row.insertCell(5).innerHTML = lang.AUTOTRONE.upgrade.popCell5;
	popHistory.show(true)	;
},


PaintSalvageHistory : function() {
	var t = Tabs.Throne;
	var popHistory = null;
	popHistory = new CPopup('pbSalvageShowHistory', 0, 0, 1100, 500, true, function() {clearTimeout (1000);});
	var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbShowBarbs" id="pbBars">';
	popHistory.getMainDiv().innerHTML = '</table></div>' + m;
	popHistory.getTopDiv().innerHTML = '<TD><B>'+lang.AUTOTRONE.autosalvage.popHistory+'</td>';
	for (i=0;i<t.SalvageLog.length;i++){
		var row = ById('pbBars').insertRow(0);
		row.vAlign = 'top';
		row.style.color = "black";
		row.insertCell(0).innerHTML = t.SalvageLog[i].time;
		row.insertCell(1).innerHTML = t.SalvageLog[i].stones;
		row.insertCell(2).innerHTML = t.SalvageLog[i].msg;
	}
	var row = ById('pbBars').insertRow(0);
	row.vAlign = 'top';
	row.style.color = "black";
	row.insertCell(0).innerHTML = lang.AUTOTRONE.autosalvage.popCell0;
	row.insertCell(1).innerHTML = "<img height=18 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/aetherstone_30.png>";
	row.insertCell(2).innerHTML = lang.AUTOTRONE.autosalvage.popCell2;
	popHistory.show(true)	;
},

 	addToQueue : function (id,action){
		var t= Tabs.Throne;
		if (ById('ShowHoover')) ById('ShowHoover').innerHTML = "";
	 	ThroneOptions.Items.push ({id:id,action:action,name:ThroneItemName(uW.kocThroneItems[id]),qualityfrom:0,qualityto:0,levelfrom:0,levelto:0,cost:0,active:false});
	    saveThroneOptions();
        t.checkUpgradeInfo(false);

	if (ThroneOptions.Active && ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.letsgo;
        if (!ThroneOptions.Active && ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.off;
  },

  checkUpgradeInfo : function (firstRun){
	var t= Tabs.Throne;
    var countUpgrade = 0;
	var countEnhance = 0;
    var levelfrom = 0;
	var levelto =0;
	var qualityfrom = 0;
	var qualityto = 0;
	if (ThroneOptions.Items.length == 0) {
		 ThroneOptions.Active = false;
		 		    if(ById("Enable")) ById('Enable').value = "Upgrade = OFF";
		 		    if (Options.BORac_Upg) updatebotbutton("Upgrade - OFF", 'BOautoupgradetab');
		 		    saveThroneOptions();
		             clearTimeout(t.setActionTimer);
            if (Seed.queue_throne.end == undefined && ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.off;
		 return;
}
    for (k=0;k<ThroneOptions.Items.length;k++){
		countUpgrade = 0;
		countEnhance = 0;
		if (unsafeWindow.kocThroneItems[ThroneOptions.Items[k]["id"]] != undefined) {
				if (k>0) for (l=0;l<k;l++) {
		          	if (ThroneOptions.Items[l]["id"] == ThroneOptions.Items[k]["id"] && ThroneOptions.Items[l]["action"] == "Upgrade") {countUpgrade++;}
					if (ThroneOptions.Items[l]["id"] == ThroneOptions.Items[k]["id"] && ThroneOptions.Items[l]["action"] == "Enhance") {countEnhance++;}
		      	}
				if (ThroneOptions.Items[k]["action"] == "Upgrade") {
					ThroneOptions.Items[k]["levelfrom"] = parseInt(unsafeWindow.kocThroneItems[ThroneOptions.Items[k]["id"]]["level"]) + countUpgrade;
					ThroneOptions.Items[k]["levelto"] = parseInt(ThroneOptions.Items[k]["levelfrom"]) +1;
						ThroneOptions.Items[k]["qualityfrom"] = parseInt(unsafeWindow.kocThroneItems[ThroneOptions.Items[k]["id"]]["quality"]) + countEnhance;
					if (ThroneOptions.Items[k]["levelto"]>10 && !firstRun) {ThroneOptions.Items.splice (k,1);saveThroneOptions();alert(lang.AUTOTRONE.upgrade.upgrade10);return;}
				}
				if (ThroneOptions.Items[k]["action"] == "Enhance") {
					ThroneOptions.Items[k]["qualityfrom"] = parseInt(unsafeWindow.kocThroneItems[ThroneOptions.Items[k]["id"]]["quality"]) + countEnhance;
					ThroneOptions.Items[k]["qualityto"] = parseInt(ThroneOptions.Items[k]["qualityfrom"]) +1;
					ThroneOptions.Items[k]["levelfrom"] = parseInt(unsafeWindow.kocThroneItems[ThroneOptions.Items[k]["id"]]["level"]) + countUpgrade;
					if (ThroneOptions.Items[k]["qualityto"]>5 && !firstRun) {

					    ThroneOptions.Items.splice (k,1);
					    t.PaintQueue();
					    t.paintInfo();
    					saveThroneOptions();
    					alert(lang.AUTOTRONE.upgrade.enhance5);
					    return;
					 }
				}
				if (ThroneOptions.Items[k]["action"] == "Enhance") var lvl = parseInt(ThroneOptions.Items[k]["qualityfrom"]) +1;
				if (ThroneOptions.Items[k]["action"] == "Upgrade") var lvl = parseInt(ThroneOptions.Items[k]["levelfrom"]) +1;
				costAction = ThroneOptions.Items[k]["action"].toLowerCase();
				if (unsafeWindow.cm.thronestats[costAction][lvl] != undefined) ThroneOptions.Items[k]["cost"] = unsafeWindow.cm.thronestats[costAction][lvl].Stones;
				else ThroneOptions.Items.splice (k,1);
		} else ThroneOptions.Items.splice (k,1);
    }
    t.paintHoover();
    t.PaintQueue();
    t.paintInfo();
    saveThroneOptions();
  },


	PaintQueue : function (){
		var t= Tabs.Throne;
		if (ById('ShowQueueDiv')) ById('ShowQueueDiv').innerHTML = '<TABLE id=ShowQueue class=pbStat align="center" width=90%></table>';
		for (k=(ThroneOptions.Items.length-1);k>=0;k--){
			if (typeof(unsafeWindow.kocThroneItems[ThroneOptions.Items[k]["id"]]) == 'object') t._addTab(k,ThroneOptions.Items[k]["name"],ThroneOptions.Items[k]["qualityfrom"],ThroneOptions.Items[k]["qualityto"],ThroneOptions.Items[k]["levelfrom"],ThroneOptions.Items[k]["levelto"],ThroneOptions.Items[k]["action"],ThroneOptions.Items[k]["active"],ThroneOptions.Items[k]["cost"]);
			else ThroneOptions.Items.splice (k,1);
		}
		t._addTabHeader();
  },

  doAction : function (){
        var t= Tabs.Throne;
        var now = new Date().getTime()/1000.0;
        if (!ThroneOptions.Active) return;
		if (ThroneOptions.Items.length ==0) {
                 if ( ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.noitem;
                 return;
        }

        if (ThroneOptions.Tries>ThroneOptions.nexttries) {
          // changement d'item
	                       var action=ThroneOptions.Items["0"].action;
		               var tid=ThroneOptions.Items["0"].id;
		               ThroneOptions.Tries = 0;
			       ThroneOptions.Good = 0;
			       ThroneOptions.Bad = 0;
		               ThroneOptions.Items.splice (0,1);

	                t.addToQueue(tid,action);

	                clearTimeout(t.setActionTimer);
			t.setActionTimer = setInterval(t.doAction,5000);
			return;
        }


        ThroneOptions.Items["0"]["active"] = true;
        t.PaintQueue();
        if (unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].isBroken == true && Seed.queue_throne.end == undefined){
		          unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].isBroken = false;
		          unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].brokenType = "";
          		  setTimeout(t.doRepair,5000);
				  clearTimeout(t.setActionTimer);
				  t.setActionTimer = setInterval(t.doAction,10000);
			    return;
        }


        if (unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]].isBroken == false && Seed.queue_throne.end == undefined){
			      if (ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.trying+" " + ThroneOptions.Items["0"]["action"] + "...";
            if (ThroneOptions.Items["0"]["action"] == "Upgrade") setTimeout(t.doUpgrade,5000);
            if (ThroneOptions.Items["0"]["action"] == "Enhance") setTimeout(t.doEnhance,5000);
			clearTimeout(t.setActionTimer);
			t.setActionTimer = setInterval(t.doAction,10000);
        }
  },


  doEnhance : function() {
	var t = Tabs.Throne;
	if (typeof(unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]]) == 'object') {
				var y = unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]];
	} else return;
	var cityid = 0;
	for (var k in Cities.byID) {
			if (parseInt(Seed.resources["city"+k]["rec5"][0]) > parseInt(ThroneOptions.Items["0"]["cost"])*2)
			{
			   cityid = k;
			}
	}
	if(cityid == 0){
		   if (ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.notenough+" enhance : "+ parseInt(Seed.resources["city"+k]["rec5"][0]);
		   return;
	}
	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
	params.action = 'upgradeQuality';
	params.throneRoomItemId = ThroneOptions.Items["0"]["id"];
	params.buffItemId = 0;
	params.payment = "aetherstone";
	params.cityId = cityid;
	if (ThroneOptions.Use20001 && uW.ksoItems[20001].count > 0) {
		x = uW.ksoItems[20001];
		params.buffItemId = x.id;
		var obk = x.id;
	}else if (ThroneOptions.Use20002 && uW.ksoItems[20002].count > 0) {
							 x = uW.ksoItems[20002];
							 params.buffItemId = x.id;
					 var obk = x.id;

	} else {
			                 params.buffItemId = 0;
			                 var obk = 0;
        }
      	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			loading: true,
			onSuccess: function (transport) {
				var rslt = eval("(" + transport.responseText + ")");
				var t = Tabs.Throne;
				if(rslt.ok){
				    var gems=0;
				    if (obk != 0) {
				       uW.ksoItems[obk].subtract();
				       actionLog("AutoTrone","Utilisation Rune sur " + y.name + " ("+uW.ksoItems[obk].count+")");
				    }
				    if (rslt.gems > 0)
				    {
					    if (ById('ShowStatus')) ById('ShowStatus').innerHTML = 'Upgrader accidentally spent gems!  Turning upgrader off!!';
					    ThroneOptions.Active = false;
					    clearTimeout(t.setActionTimer);
					    if(ById("Enable")) ById('Enable').value = "Upgrade = OFF";
					    if (Options.BORac_Upg) updatebotbutton("Upgrade - OFF", 'BOautoupgradetab');
					    gems=rslt.gems;
				    }
				 Seed.resources["city" + cityid]["rec5"][0] -= rslt.aetherstones;
				 y.level = rslt.item.level;
	        		 y.quality = rslt.item.quality
				 y.status = rslt.item.status;
				 if (rslt.success){
				   y.name = y.createName();
				   ThroneOptions.Good++;
				   ThroneOptions.Tries++;
				   var action = ThroneOptions.Items["0"]["action"];
				   					   if (gems>0) {
				   					    action+="<br>gems : "+gems;
					   }
				   t.addToLog(ThroneOptions.Items["0"]["id"],action,ThroneOptions.Tries,ThroneOptions.Good,ThroneOptions.Bad);
				   ThroneOptions.Tries = 0;
				   ThroneOptions.Good = 0;
				   ThroneOptions.Bad = 0;
				   ThroneOptions.Items.splice (0,1);
				   saveThroneOptions();
				   if (Options.mailtrone) {
				    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
			   	    params.emailTo = Seed.player['name'];
			   	    params.subject = lang.AUTOTRONE.upgrade.mptitleenhance + ': '+ ThroneItemName(y);
			   	    if (gems>0)
				   	 params.subject = lang.AUTOTRONE.upgrade.mptitleenhance +": "+ ThroneItemName(y) + " GEMS:"+gems;
				     else
			   		params.subject = lang.AUTOTRONE.upgrade.mptitleenhance +": "+ ThroneItemName(y);
			   	    var effft="",x=0,s = y;
			   	    for (var u in s.effects) {
			   			          L = s.effects[u];
			   			          effect = uW.cm.thronestats.effects[L.id];
			   				  tier = uW.cm.thronestats.tiers[L.id][L.tier];
			   				  var percent = + tier.base + (s.level * s.level + s.level) * + tier.growth * 0.5;
			   				  percent = percent > 0 ? "+" + percent : + percent;
			   				  percent = Math.ceil(percent);
			   			          effft += percent + "% " + effect[1] + " %0A";
			            }
			            params.message = effft;
			   	    params.requestType = "COMPOSED_MAIL";;
			   	    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {method: "post",parameters: params,onSuccess: function (rslt) {
			   	    if(Options.alertConfig.emailAddress!="") sendEmail(Seed.player.name,"",Options.alertConfig.emailAddress,uW.domainName + ' >> ' +params.subject,effft);
			   	    },onFailure: function () {},});
			   	   }
    			    	   if (ById('ShowTries')) ById('ShowTries').innerHTML = lang.AUTOTRONE.upgrade.waiting + " --";
				  }else{
					   y.isBroken = true;
					   y.brokenType = "quality";
					   y.name = y.createName();
					   ThroneOptions.Tries++;
					   ThroneOptions.Good++;
					   if (ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.fail + ' Enhance :( <br />Item: ' + ThroneItemName(unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]]) +"<br />" + lang.AUTOTRONE.repair.repairing;
					   if (ById('ShowTries')) ById('ShowTries').innerHTML = lang.AUTOTRONE.upgrade.waiting +"" + ThroneOptions.Tries + "<br />"+ lang.AUTOTRONE.upgrade.good +" " + ThroneOptions.Good + "  "+ lang.AUTOTRONE.upgrade.bad +"" + ThroneOptions.Bad;
				    }
				    uW.cm.ThroneView.renderInventory(uW.kocThroneItems);
            			    t.checkUpgradeInfo(false);
	          		    t.PaintQueue();

				    saveThroneOptions();

				    if (gems>0) {
				        			    			 reloadKOC();
    			    			}
				} else {
				    //actionLog("AutoTrone","Erreur Requete sur "+ThroneOptions.Items["0"]["id"]+": " + transport.responseText);
				    if(rslt.error_code==256) {

				     y.isBroken = true;
				     y.brokenType = "quality";
				     y.name = y.createName();
				     uW.cm.ThroneView.renderInventory(uW.kocThroneItems);
				     ThroneOptions.Tries++;
				     saveThroneOptions();
				     t.doRepair();

				     return;
				    }
				    ThroneOptions.Bad++;
				    saveThroneOptions();
				}
				return;
			},
			onFailure: function () {
			   return;
			},
		});
	},

	doUpgrade : function() {
		var t = Tabs.Throne;
		if (typeof(uW.kocThroneItems[ThroneOptions.Items["0"]["id"]]) == 'object') {
				var y = uW.kocThroneItems[ThroneOptions.Items["0"]["id"]];
		} else return;
		var cityid = 0;
		for (var k in Cities.byID) {
			if ( parseInt(Seed.resources["city"+k]["rec5"][0]) > parseInt(ThroneOptions.Items["0"]["cost"])*2)
			{
			   cityid = k;
			   break;
			}
		}
		if(cityid == 0){
		   if (ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.notenough +" UPGRADE !!";
		   return;
		}

		var params = uW.Object.clone(uW.g_ajaxparams);
		params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
		params.action = 'upgradeLevel';
		params.throneRoomItemId = ThroneOptions.Items["0"]["id"];
		params.buffItemId = 0;
		params.payment = "aetherstone";
		params.cityId = cityid;

	if (ThroneOptions.Use20001 && uW.ksoItems[20001].count > 0) {
		x = uW.ksoItems[20001];
		params.buffItemId = x.id;
		var obk = x.id;
		}else if (ThroneOptions.Use20002 && uW.ksoItems[20002].count > 0) {
							 x = uW.ksoItems[20002];
							 params.buffItemId = x.id;
					 var obk = x.id;
	}else if (ThroneOptions.Use20005 && uW.ksoItems[20005].count > 0) {
						 x = uW.ksoItems[20005];
						 params.buffItemId = x.id;
					 var obk = x.id;
	}else if (ThroneOptions.Use20005 && uW.ksoItems[20005].count > 0) {
					 x = uW.ksoItems[20005];
					 params.buffItemId = x.id;
					 var obk = x.id;
	} else {
			                 params.buffItemId = 0;
			                 var obk = 0;
        }


      	new AjaxRequest(uW.g_ajaxpath + "ajax/_dispatch53.php" + uW.g_ajaxsuffix, { method: "post", parameters: params, loading: true, onSuccess: function (transport) {
      	               var rslt = eval("(" + transport.responseText + ")");
      	               if(rslt.ok){
			if (obk != 0) { actionLog("AutoTrone","Utilisation Rune sur " + y.name+ " ("+uW.ksoItems[obk].count+")");
			uW.ksoItems[obk].subtract(); }
			var gems=0;
			if (rslt.gems > 0) {
			if (ById('ShowStatus')) ById('ShowStatus').innerHTML = 'Upgrader accidentally spent gems!  Turning upgrader off!!';
			ThroneOptions.Active = false; clearTimeout(t.setActionTimer);
			if(ById("Enable")) ById('Enable').value = "Upgrade = OFF";
			if (Options.BORac_Upg) updatebotbutton("Upgrade - OFF", 'BOautoupgradetab');
			gems=rslt.gems;


				    }
					Seed.resources["city" +cityid]["rec5"][0] -= rslt.aetherstones;
					if (rslt.success)
					{
					   y.level = rslt.item.level;
					   ThroneOptions.Tries++;
					   ThroneOptions.Good++;
					   y.quality = rslt.item.quality;
					   y.name = y.createName();
					   var action = ThroneOptions.Items["0"]["action"];
					   if (gems>0) {
					    action+="<br>gems : "+gems;
					   }
					   t.addToLog(ThroneOptions.Items["0"]["id"],action,ThroneOptions.Tries,ThroneOptions.Good,ThroneOptions.Bad);
					   ThroneOptions.Tries = 0;
					   ThroneOptions.Good = 0;
					   ThroneOptions.Bad = 0;
					   saveThroneOptions();

             		   		ThroneOptions.Items.splice (0,1);
             		   		if (Options.mailtrone) {
             		   		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
			   		  params.emailTo = Seed.player['name'];
			   			   			     if (gems>0)
			   			   			      params.subject = lang.AUTOTRONE.upgrade.mptitleupgrade +": "+ ThroneItemName(y) + " GEMS:"+gems;
			   			   			     else
			   			   			      params.subject = lang.AUTOTRONE.upgrade.mptitleupgrade +": "+ ThroneItemName(y);
			   			   			     var effft="";
			   			   			     var x=0;
			   			   			     s = y;
			   			   			     for (var u in s.effects) {
			   			   			          L = s.effects[u];
			   			   			          effect = uW.cm.thronestats.effects[L.id];
			   			   				  tier = uW.cm.thronestats.tiers[L.id][L.tier];
			   			   				  var percent = + tier.base + (s.level * s.level + s.level) * + tier.growth * 0.5;
			   			   				  percent = percent > 0 ? "+" + percent : + percent;
			   			   				  percent = Math.ceil(percent);

			   			   			          effft += percent + "% " + effect[1] + " %0A";

			   			           		     }
			   			   			     params.message = effft;
			   			   			     params.requestType = "COMPOSED_MAIL";;
			   			   			     new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
			   			   			         method: "post",parameters: params,
			   			   			         onSuccess: function (rslt) {
			   			   			          if(Options.alertConfig.emailAddress!="") sendEmail(Seed.player.name,"",Options.alertConfig.emailAddress,uW.domainName + ' >> ' +params.subject,effft);
			   			   			         }, onFailure: function () { },});
    			    			}
    			    			if (ById('ShowTries'))ById('ShowTries').innerHTML = lang.AUTOTRONE.upgrade.retry + "--";
    			    			if (gems>0) {
    			    			 reloadKOC();
    			    			}
				    }
				    else
				    {
					   y.isBroken = true;
					   y.brokenType = "level";
					   y.status = rslt.item.status;
                       			   y.name = y.createName();
					   ThroneOptions.Tries++;
					   ThroneOptions.Good++;
					   saveThroneOptions();
					   if (ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.fail + ' Upgrade :( <br />Item: ' + ThroneItemName(unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]]) +"<br />" + lang.AUTOTRONE.upgrade.repairing;
					   if (ById('ShowTries')) ById('ShowTries').innerHTML = lang.AUTOTRONE.upgrade.retry + " " + ThroneOptions.Tries + "<br />"+lang.AUTOTRONE.upgrade.good + " " + ThroneOptions.Good + "   "+lang.AUTOTRONE.upgrade.bad + " " + ThroneOptions.Bad;
				    }
				    unsafeWindow.cm.ThroneView.renderInventory(unsafeWindow.kocThroneItems);

						t.checkUpgradeInfo(false);
		          		t.PaintQueue();

						saveThroneOptions();
				} else {
					ThroneOptions.Bad++;
					saveThroneOptions();
				}
			    return;
			},
			onFailure: function () {
			   return;
			},
		});
	},
       doRepair : function() {
		var t = Tabs.Throne;
		var params = uW.Object.clone(unsafeWindow.g_ajaxparams);
		params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
		params.action = 'timeRepair';
		params.throneRoomItemId = ThroneOptions.Items["0"]["id"];
      	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + uW.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			loading: true,
			onSuccess: function (transport) {
				var rslt = eval("(" + transport.responseText + ")");
					if(rslt.ok){
              				ThroneOptions.RepairEnd = rslt.eta;
              				var now = new Date().getTime()/1000.0;
              				var t = Tabs.Throne;
              				t.setRepairTimer = setInterval (t.repairTimerUpdate,1000);
				 	 Seed.queue_throne.itemId= ThroneOptions.Items["0"]["id"];
		             		Seed.queue_throne.start=unixTime();
					 Seed.queue_throne.end= rslt.eta;
					 t.repairId = ThroneOptions.Items["0"]["id"];
					 t.repairEnd = rslt.eta;
					 uW.cm.ThroneView.renderInventory(uW.kocThroneItems);
					 var x = rslt.eta - unixTime();
					//ThroneOptions.Good++;
					saveThroneOptions();
				   } else {
				   		//ThroneOptions.Good++;
						saveThroneOptions();
				   }
				   return;
			},
			onFailure: function () {
			   return;
			},
		});
	},
  doEquip : function(n,preset, td) {
  		var t = Tabs.Throne;
  		if (typeof(uW.kocThroneItems[n]) == 'object') {
  				var y = uW.kocThroneItems[n];
  		} else return;
  		ById("BOMsgOrg").innerHTML="Plz Wait...";
  		var params = uW.Object.clone(uW.g_ajaxparams);
  		params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
  		params.action = 'equipItem';
  		params.itemId = y.id;
  		params.presetId = preset;

        	new AjaxRequest(uW.g_ajaxpath + "ajax/_dispatch53.php" + uW.g_ajaxsuffix, {
  			method: "post",
  			parameters: params,
  			loading: true,
  			onSuccess: function (transport) {
  				var rslt = eval("(" + transport.responseText + ")");
  					if(rslt.ok){
  							uW.cm.ThroneView.clickItemEquip(y);
  							ById("BOMsgOrg").innerHTML="OK";
  							td.style.borderColor = "green";

  				   } else{
  				    ById("BOMsgOrg").innerHTML="Error";
  				   }
  			},
  			onFailure: function () {
  			   ById("BOMsgOrg").innerHTML="Error";
   			   return;
  			},
  		});
  	},

    doUnequip : function(n,preset) {
  		var t = Tabs.Throne;
  		if (typeof(uW.kocThroneItems[n]) == 'object') {
  				var y = uW.kocThroneItems[n];
  		} else return;

  		var params = uW.Object.clone(uW.g_ajaxparams);
  		params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
  		params.action = 'unequipItem';
  		params.itemId = y.id;
  		params.presetId = ById("preset").value;

        	new AjaxRequest(uW.g_ajaxpath + "ajax/_dispatch53.php" + uW.g_ajaxsuffix, {
  			method: "post",
  			parameters: params,
  			loading: true,
  			onSuccess: function (transport) {
  				var rslt = eval("(" + transport.responseText + ")");
  					if(rslt.ok){
  							uW.cm.ThroneView.clickItemUnequip(y);
  				   }
  			},
  			onFailure: function () {
  			   return;
  			},
  		});
  	},

  repairTimerUpdate :function (){
		var t = Tabs.Throne;
        if (ThroneOptions.Items.length == 0) return;
		var now = new Date().getTime()/1000.0;
        var diff = 0;
		if (Seed.queue_throne.end == undefined) return;
		else diff = Seed.queue_throne.end - now;
        if (diff <0){
            clearTimeout(t.setRepairTimer);
            if (ThroneOptions.Active && ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.waiting;
            if (!ThroneOptions.Active && ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.off;
            uW.kocThroneItems[Seed.queue_throne.itemId].isBroken = false;
            Seed.queue_throne = "";
            return;
        } else {
              if (ById('ShowStatus')) ById('ShowStatus').innerHTML = lang.AUTOTRONE.upgrade.repairing+ ' ' + ThroneItemName(uW.kocThroneItems[ThroneOptions.Items["0"]["id"]]) + "<br/>"+lang.AUTOTRONE.upgrade.timeleft+" " + timestr(diff)+ " ("+ timestr(Seed.queue_throne.end - Seed.queue_throne.start) + ")";
              if (ById('ShowTries')) ById('ShowTries').innerHTML = lang.AUTOTRONE.upgrade.retry+ ' ' + ThroneOptions.Tries + "<br />"+lang.AUTOTRONE.upgrade.good+" " + ThroneOptions.Good + " "+lang.AUTOTRONE.upgrade.bad+" " + ThroneOptions.Bad;
	}

  },

  paintInfo : function (){
		var t = Tabs.Throne;
		if (ThroneOptions.Items["0"]==undefined) ThroneOptions.Items=[];
		if (typeof(unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]]) == 'number') {
				var y = unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]];
		} else return;
		  var id =0;
		  var tier=0;
		  var Current=0;
		  var Next=0;
		  m="<TABLE width=80% height=0% align='center' class=pbTab><TR><TD><B>"+lang.AUTOTRONE.upgrade.paintCol1+"</b></td><TD><B>"+lang.AUTOTRONE.upgrade.paintCol2+"</b></td>";
		  for (i=1;i<=5;i++) {
			   id = y["effects"]["slot"+i]["id"];
			   tier = parseInt(y["effects"]["slot"+i]["tier"]);
			   level = y["level"];
			   p = unsafeWindow.cm.thronestats.tiers[id][tier];
			   Current = p.base + ((level * level + level) * p.growth * 0.5);
			   level++;
			   Next = p.base + ((level * level + level) * p.growth * 0.5);;
			   var quality = parseInt(unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]]["quality"]);
			   if (ThroneOptions.Items["0"]["action"] == "Enhance") {
					   if (i<=quality) m+='<TR><TD><FONT color=green>' + Current + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td>';
					   else m+='<TR><TD><FONT color=red>' + Current + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td>';
					   if (i<=(quality+1)) m+='<TD><FONT color=green>' + Current + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td></tr>';
					   else m+='<TD><FONT color=red>' + Current + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td></tr>';
			   }
			   if (ThroneOptions.Items["0"]["action"] == "Upgrade") {
					   if (i<=quality) m+='<TR><TD><FONT color=green>' + Current + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td>';
					   else m+='<TR><TD><FONT color=red>' + Current + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td>';
					   if (i<=quality) m+='<TD><FONT color=green>' + Next + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td></tr>';
					   else m+='<TD><FONT color=red>' + Next + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td></tr>';
			 }
		}
		m+="</table>"
		document.getElementById('ShowInfo').innerHTML = m;

  },

paintHoover : function (){
	var t = Tabs.Throne;
	if (!ById('ThroneItems')) return;
	var z = ById('ThroneItems').value;
  	var y = unsafeWindow.kocThroneItems[z];
	var id =0;
	var tier=0;
	var Current=0;
	m="<TABLE width=80% height=0% align='center' class=pbTab>";
	for (i=1;i<=5;i++) {
		id = y["effects"]["slot"+i]["id"];
		tier = parseInt(y["effects"]["slot"+i]["tier"]);
		level = y["level"];
		p = unsafeWindow.cm.thronestats.tiers[id][tier];
		Current = p.base + ((level * level + level) * p.growth * 0.5);
		Current = Math.round(Current*100)/100;
		//if (ThroneOptions.Items["0"])
		// var quality = parseInt(unsafeWindow.kocThroneItems[ThroneOptions.Items["0"]["id"]]["quality"]);
		//else
		var quality = y.quality
		if (i<=quality) m+='<TR><TD><FONT color=green>' + Current + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td></tr>';
		else m+='<TR><TD><FONT color=red>' + Current + "% " + unsafeWindow.cm.thronestats["effects"][id]["1"] + '</font></td></tr>';
	}
	m+="</table>"
	ById('ShowHoover').innerHTML = m;

},

paintStones : function (){
	var t = Tabs.Throne;
	m="<TABLE width=90% height=0% class=pbTab><TR><TD><img height=18 src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/aetherstone_30.png></td>";
	for (i=0;i<Seed.cities.length;i++) m+='<TD>' + Seed.cities[i]["1"] + '</td>';
	m+="</tr><TR><TD></td>"
	for (i=0;i<Seed.cities.length;i++) m+='<TD>' + addCommas(Seed.resources["city"+Seed.cities[i]["0"]]["rec5"][0]) + '</td>';
	m+="</tr></table>"
	if (ById('ShowStones')) ById('ShowStones').innerHTML = m;
},

addToLog : function (id,action,tries,good,bad){
	var t = Tabs.Throne;
	var now = new Date();
	var time = now.getDate() +"/"+ (now.getMonth()+1) +"/"+ now.getFullYear() +"  "+ now.getUTCHours() + ":" + now.getMinutes();
	var name = unsafeWindow.kocThroneItems[id]["name"];
	t.log.push ({time:time,name:name,action:action,tries:tries,good:good,bad:bad});
	if (t.log.length > 50) t.log.splice(0,1);
	GM_setValue ('ThroneHistory_'+getServerId(), JSON2.stringify(t.log));
},


addToSalvageLog : function (msg,stones){
	var t = Tabs.Throne;
	var now = new Date();
	D = t.addZero(now.getDate());
	M = t.addZero(now.getMonth()+1);
	Y = t.addZero(now.getFullYear());
	h = t.addZero(now.getHours());
	m = t.addZero(now.getMinutes());
	var time =  D +"/"+ M +"/"+ Y +"  "+ h + ":" + m;
	t.SalvageLog.push ({time:time,stones:stones,msg:msg});
	if (t.SalvageLog.length > 100) t.SalvageLog.splice(0,1);
	GM_setValue ('ThroneSalvageHistory_'+getServerId(), JSON2.stringify(t.SalvageLog));
},

addZero : function (i){
if (i<10)
  {
  i="0" + i;
  }
return i;
},

salvageCheck : function (){
	var t = Tabs.Throne;
	var del = true;
	var level = false;
	var type ="";
	var NotUpgrading = true;
	var count=0;
	if(!Options.ThroneDeleteItems) { clearTimeout(t.timersalvage);return; }
	if (t.SalvageRunning == true) return;
	t.SalvageRunning = true;

	for (m in unsafeWindow.kocThroneItems) {
		y =   unsafeWindow.kocThroneItems[m];

		if (typeof(y.id) == 'number') {
		        count++;
			NotUpgrading = true;
			for (k in ThroneOptions.Items) {if (ThroneOptions.Items[k]["id"] == y.id) NotUpgrading = false;}
			if (count<=(parseInt(Seed.throne.rowNum)*5)) {
					del = true;
					level = false;

					if (y.quality >= ThroneOptions.SalvageQuality) { level=true;}
					if (ThroneOptions.SalvageQuality == 0) level=true;

					var rangeIndex=0;
					if (ThroneOptions.Salvage[y.effects["slot3"].id]) rangeIndex += 1;
					if (ThroneOptions.Salvage[y.effects["slot4"].id]) rangeIndex += 3;
					if (ThroneOptions.Salvage[y.effects["slot5"].id]) rangeIndex += 5;

					if (ThroneOptions.SalvageTriple && y.effects["slot3"].id==y.effects["slot4"].id && y.effects["slot4"].id==y.effects["slot5"].id) {
					 // si un item a les trois derniers items identiques

					} else {
					if (!level && NotUpgrading && !y.isEquipped && y.level==0 && !y.isBroken && t.LastDeleted != y.id) {

					      // test du type d'items
					     var itemaconserver=false;
					     if ((y.type=="advisor" && ThroneOptions.SalvageAdvisor) ||
					 			  			     (y.type=="banner" && ThroneOptions.SalvageBanner) ||
					 			  			     (y.type=="chair" && ThroneOptions.SalvageChair) ||
					 			  			     (y.type=="table" && ThroneOptions.SalvageTable) ||
					 			  			     (y.type=="window" && ThroneOptions.SalvageWindow) ||
					 			  			     (y.type=="trophy" && ThroneOptions.SalvageTrophy)) {
 			  			      itemaconserver=true;
					      }




						if ( rangeIndex > parseIntNan(Options.RangeSaveModeSetting) && itemaconserver) {
 			  			}else{
						             t.SalvageArray.push(y.id);
						}
					}
					}
			}
		}
	}
	if (t.SalvageArray.length == 0) {
		t.SalvageRunning = false;
		actionLog("AutoSalvage",lang.AUTOTRONE.autosalvage.actionlog1 + ""+ThroneOptions.IntervalMin+" minutes");
		t.timersalvage = setTimeout(t.salvageCheck,ThroneOptions.IntervalMin*60*1000);
	} else {
	   actionLog("AutoSalvage",lang.AUTOTRONE.autosalvage.actionlog2 +" "+t.SalvageArray.length+" items");
	   setTimeout(t.doSalvage, 2000);
	}
},

doSalvage : function(){
		var t = Tabs.Throne;
		if(!Options.ThroneDeleteItems) { clearTimeout(t.timersalvage);return; }

		var u =  Seed.throne.slotEquip[Seed.throne.activeSlot];
		var z = uW.cm.ThroneController.hasFactionBonus(u);
		         var F=1;
		         if (z.hazBonus) {
		    	  if (z.faction=="fey")
		    	    F=1+(uW.cm.ThroneController.effectBonus(95)/100);
		         }

     		AetherCap=parseInt(uW.cm.features.DARK_FOREST_AETHERSTONE_CAP*F);
		var cityid = 0;
		for (var k in Cities.byID) {
			if (Seed.resources["city"+k]["rec5"][0] < AetherCap)
			{
			   cityid = k;
			   break;
			}
		}
		if (cityid == 0) cityid = Seed.cities[0][0];
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.ctrl = 'throneRoom\\ThroneRoomServiceAjax';
		params.action = 'salvage';
		params.itemId = t.SalvageArray[0];
		params.cityId = cityid;
      	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch53.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			loading: true,
			onSuccess: function (transport) {
			      try{
				var rslt = eval("(" + transport.responseText + ")");
				if(rslt.ok){
					y =  unsafeWindow.kocThroneItems[params.itemId];
					z = unsafeWindow.cm.thronestats.effects;
					var msg = (ThroneItemName(y) + " (" + z[y.effects["slot1"].id]["2"] + "/"+ z[y.effects["slot2"].id]["2"]+ "/"+ z[y.effects["slot3"].id]["2"]+ "/"+ z[y.effects["slot4"].id]["2"]+ "/"+ z[y.effects["slot5"].id]["2"] +")");
					t.addToSalvageLog(msg,rslt.aetherstones);
					unsafeWindow.kocThroneItems[params.itemId].salvage();
				}
				else {
					t.addToSalvageLog(lang.AUTOTRONE.autosalvage.Salvagelog1,0);
				}
			      } catch(err){

			      }
			},
			onFailure: function () {
					return;
			},
		});
		//actionLog("AutoSalvage","Supression ou pas de l item");
		t.SalvageArray.splice(0,1);
		t.LastDeleted = params.itemId;
		if (t.SalvageArray.length > 0) {
		 setTimeout(t.doSalvage, 5000);
		} else {
			t.SalvageRunning = false;
			t.salvageCheck();
		}
},

hide : function (){
},

show : function (){
    var t = Tabs.Throne;
    if (t.curTabName == 'Sal')
    	t.Salvage();
    else if (t.curTabName == 'S2l')
    	t.SalvageV2();
    else if (t.curTabName == 'UE')
    	t.Upgrade_Enhance();
    else if (t.curTabName == 'OR')
    	t.Organize();
    else if (t.curTabName == 'RE')
    	t.autorepair();
    	else if (t.curTabName == 'ST')
    	t.Stats();

  },
  autorepair:function() {
   var t = Tabs.Throne;
      var  m= '<DIV class=boStat><b>'+lang.AUTOTRONE.repair.title+'</b></div><TABLE class=pbTab width=750><tr><td></table><TABLE class=pbTab width=98%><TR>';
               if (Options.salvageconfig.Repairrunning == true) {
                    	                  m += '<TD><INPUT id=BOTroneRepairEnable type=submit value="Repair Auto On"></td>';
                    	                 }
                    	                 else {
                    	                  m += '<TD><INPUT id=BOTroneRepairEnable type=submit value="Repair Auto Off"></td>';
               }

             m+='<td>'+lang.AUTOTRONE.repair.title2+'<bR>'+lang.AUTOTRONE.repair.title3+'</td><tr></table>';


   t.Overv.innerHTML = m;

    ById('BOTroneRepairEnable').addEventListener ('click', function(){t.toggleRepairon(this);}, false);
  },
    toggleRepairon: function(obj){
      if (ThroneOptions.Active) {
       alert(lang.AUTOTRONE.repair.err2);
      return;
     }
         var t = Tabs.Throne;
          obj = ById('BOTroneRepairEnable');
          if (Options.salvageconfig.Repairrunning == true) {
           Options.salvageconfig.Repairrunning = false;
           if (obj) obj.value = lang.AUTOTRONE.repair.repairoff;
          }
          else {
           Options.salvageconfig.Repairrunning = true;
           if (obj) obj.value = lang.AUTOTRONE.repair.repairon;

           RepairAuto.init();
          }
          saveOptions ();
   },
}

/******************* Apothecary Tab **********************/
Tabs.Apothecary = {
  tabOrder : 20,
  tabDisabled : false,
  tabLabel : lang.BoiteLabelApothecary,
  cities : [],
  pop : null,
  pop2 : null,
  myDiv : null,
  timer : null,
  cancelTrainingBO : function (p1,p2,p3,p4,p5,p6,p7) {
     var t = Tabs.Train;
     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
       params.cityId = p2;
       params.apothecary ="true";
       params.requestType ="CANCEL_TRAINING";
       params.numtrptrn = p4;
       params.trnETA= p5;
       params.trnNeeded = p7;
       params.trnTmp = p6;
       params.typetrn= p3

    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/cancelTraining.php" + unsafeWindow.g_ajaxsuffix, {
            method: "post",
            parameters: params,
          onSuccess: function (rslt) {
           var t = Tabs.Train;
           if (rslt.ok) {

  	        unsafeWindow.seed.queue_revive["city"+p2].splice(p1,1);




           }
          },
          onFailure: function (rslt) {
           var t = Tabs.Train;

          }
      });
  },
  init : function (div){
    var t = Tabs.Apothecary;
    t.myDiv = div;
    unsafeWindow.BOAPO = t.display_action;
    uW.BOcancelTraining2 = t.cancelTrainingBO;
      setTimeout(function() {

	  if (Options.BORac_Apo) {
		AddSubTabLink(lang.Apothecary.label, t.e_toggleswitch, 'boautohealtab');
		if (ApothecaryOptions.Active == false)
		  updatebotbutton(lang.Apothecary.label+" - OFF", 'boautohealtab');
		else
		  updatebotbutton(lang.Apothecary.label+" - ON", 'boautohealtab');
	    }

    },100);
    var m = '<DIV class=boStat >'+lang.Apothecary.label+'</div><table width=100% height=0% class=pbTab><tr align=center >';
    m += '<td><input type=submit id=pbapothecary_power value="'+lang.Apothecary.power+' = '+(ApothecaryOptions.Active?'ON':'OFF')+'" /></td>\
          <td><input type=submit id=pbapothecary_show value="'+lang.Apothecary.show+'" /></td></tr></table>';
	m += '<DIV class=boStat id=pbapothecary_options >'+lang.Apothecary.options+'</div></div><table></tr>\
	      <td>'+lang.Apothecary.gold+' <INPUT type=text id="pbapothecary_gold" size=6 value='+ApothecaryOptions.goldkeep+' /></td>\
		  <td colspan=4><span id="pbapothecary_citysel"></span></td></tr><tr>\
		  <td>'+uW.g_js_strings.commonstr.troops+' : <SELECT id="pbapothecary_troops"><option value=0>--Select--</options>';
	for (y in unsafeWindow.unitcost)
		m += '<option value="'+y.substr(3)+'">'+unsafeWindow.unitcost[y][0]+'</option>';
    m += '</select></td>\
		  <td>Min.: <INPUT id=pbapothecary_min type=text size=4 \></td>\
		  <td><INPUT type=checkbox id=pbapothecary_maxcheck /> Max.: <INPUT id=pbapothecary_max type=text size=4 DISABLED \></td>\
		  <td><INPUT type=submit id=pbapothecary_save value="'+lang.Apothecary.add+'" /></td>';
	m += '</tr></table><br>';

	m +="<DIV class=boStat>"+lang.Apothecary.stat+"</div><br><span id=boapostat></span>";
    div.innerHTML = m;

     for (var cid in Cities.byID){
    		var city = 'city'+cid;
    		var x = Cities.byID[cid].idx;
    		t.cities[x] = true;
    		for (var y in Seed.buildings[city]) {
        		if (Seed.buildings[city][y][0] == 21){
    				t.cities[x] = false;
    				continue;
    			}
        		}
    	}
	t.citysel = new CdispCityPicker('BOapo_sel', ById("pbapothecary_citysel"), true, null, 0, t.cities);

    ById("pbapothecary_gold").addEventListener('change', function(){
		ApothecaryOptions.goldkeep = parseIntNan(this.value);
	},false);
    ById("pbapothecary_maxcheck").addEventListener('click', function(){
		ById("pbapothecary_max").disabled = !(ById("pbapothecary_maxcheck").checked);
	},false);
    ById("pbapothecary_save").addEventListener('click', function(){
		t.e_addqueue();
	},false);
	ById("pbapothecary_power").addEventListener('click', function(){
		t.e_toggleswitch(this);
	},false);
	ById("pbapothecary_show").addEventListener('click', function(){
		t.e_displayarray();
	},false);

	t.timer = setTimeout(t.loop,15000);
	t.displayStat();
  },
  displayStat: function() {
   var t = Tabs.Apothecary;
   var m="<table width=98% align=center  class=pbTab><tr><td>&nbsp;</td>";
	 for(var i=0; i<Cities.numCities; i++) {
    	  var cityID = 'city'+ Cities.cities[i].id;
    	         m += "<TD width=80><SPAN class=oohfancy>"+ Cities.cities[i].name.substring(0,10) +"</SPAN></td>";

    	  }
    	  m+="</tr>";
    	  var unitwounded = Seed.woundedUnits;
	  for (var r=1; r<13; r++){
	      m+='<tr><td><img height=18 title="'+unsafeWindow.unitcost['unt'+r][0]+'" src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_'+r+'_30_s34.jpg></td>';

	   for(i=0; i<Cities.numCities; i++) {
	     if (unitwounded) {
	      var a=unitwounded["city"+Cities.cities[i].id];
	      if (a) {

	       var nbunit=parseIntNan(a["unt"+r]);
	      }

	     }
	     m+="<td>"+addCommas(nbunit)+"</td>";


	   }

	   m+="</tr>";
	 }
	     // Reviving
	             m +='<TR><TD style="font-size:6px"><BR></td></tr><tr><td><img src="'+URL_HOSPITAL+'"></b></td>';
	             for(i=0; i<Cities.numCities; i++) {
	              var totTime = 0;
	              var ah=Seed.queue_revive["city" + Cities.cities[i].id];
	              var l=0;
	              if (ah) {
	               for(var an=0;an<Math.min(ah.length,1);an++){
	                  var P=uW.unixtime();
	                  l=parseInt(ah[an][3])-P;
	               }
	               var totTime = 0;
	               totTime = parseIntNan(l);
	               if (totTime < 0)
	                 totTime = 0;
	                 affuichage = timestr(totTime);

	               m +="<td><span>"+ affuichage + "</span></td>";

	              } else {
	              affuichage = timestr(totTime);

	              m +="<td><span>"+affuichage+"</span></td>";
	              }
	             }
             m +="</tr>";
              m += '<TR><TD style="font-size:6px"><BR>';
             for(i=0; i<Cities.numCities; i++) {
              var ah=Seed.queue_revive["city" + Cities.cities[i].id][0];
              m +='</td><td>';
              if (ah) {

	       	                  var P=uW.unixtime();
	       	                  l=parseInt(ah[3])-P;

	       	               var totTime = 0;
	       	               totTime = parseIntNan(l);
	       	               if (totTime < 0)
	                 totTime = 0;
	                 if (totTime>0)
              	m+='<span><a onclick="BOcancelTraining2(0,'+Cities.cities[i].id+','+ah[0]+','+ah[1]+','+ah[3]+','+ah[2]+','+ah[5]+',false);return false;" href="#" class="button20" id="button_training_cancel"><span>'+uW.g_js_strings.commonstr.cancel+'</span></a></span>';
              }
             }

	m+="</tr></table>";
     ById("boapostat").innerHTML=m;
  },

  e_addqueue : function (){
    var t = Tabs.Apothecary;
    var city = t.citysel.city.idx;
	var troopsel = ById("pbapothecary_troops").value;
	var min = parseIntNan(ById("pbapothecary_min").value);
	var max = parseIntNan(ById("pbapothecary_max").value);
	var max_sel = ById("pbapothecary_maxcheck").checked;
	try {
		if((troopsel < 1 || min < 1) || (max_sel && max < 1) || (max_sel && (max < min)))
			throw "Incomplete/Invalid Input!";
		ApothecaryOptions.city[city].push({troop:troopsel,min:min,max:max,max_sel:max_sel});
		saveApothecaryOptions();
		ById('pbapothecary_options').style.background ='#99FF99';
		setTimeout(function(){ (ById('pbapothecary_options').style.background =''); }, 1000);
	} catch (e){
		ById('pbapothecary_options').style.background ='#FF0000';
		setTimeout(function(){ (ById('pbapothecary_options').style.background =''); }, 1000);
	}
  },

  e_displayarray : function(){
    var t = Tabs.Apothecary;
    if(t.pop == null)
	t.pop = new CPopup('pbapothecary_pop',20,20,400,500,true,function(){t.pop.destroy(); t.pop = null;});
	t.pop.getTopDiv().innerHTML = '<DIV><center>'+lang.Apothecary.detail+'</center></div>';
	var m = '<div style="max-height:380px; height:380px; overflow-y:auto"><table><tr>';
	for (var city in ApothecaryOptions.city){
		if(!Cities.cities[city] || ApothecaryOptions.city[city].length < 1) continue;
		m += '<td colspan=2><b>'+Cities.cities[city].name+'</b></td>\
			  <td>Minimum</td><td>Maximum</td><tr>';
		for(var i=0; i<ApothecaryOptions.city[city].length; i++){
			var info = ApothecaryOptions.city[city][i];
			m += '<td>'+(i+1)+'</td><td>'+unsafeWindow.unitcost['unt'+info.troop][0]+'</td>\
				  <td>'+info.min+'</td><td>'+info.max+'</td><td>'+strButton20('Edit','title="'+lang.Apothecary.edit+'" onclick="BOAPO(this,'+i+','+city+')"')+'</td><td>'+strButton20('Delete','title="'+lang.Apothecary.delete+'" onclick="BOAPO(this,'+i+','+city+')"')+'</td>';
			m += '</tr><tr>';
		}
		m += '</tr><tr>';
	}
	t.pop.getMainDiv().innerHTML = m + "</table></div>";

	t.pop.show(true);
  },

  display_action : function(obj,id,city){
    var t = Tabs.Apothecary;
	var evt = null;
	if(obj.title.indexOf("edit") > 0)
		evt = "edit";
	if(obj.title.indexOf("delete") > 0)
		evt = "delete";
	if(evt == null || id == null) return;
	if(evt == "delete"){
		ApothecaryOptions.city[city].splice(id,1);
	}
	if(evt == "edit"){
		t.display_edit(id,city);
	}
	saveApothecaryOptions();
	t.e_displayarray();
  },

  display_edit : function(id, city){
	var t = Tabs.Apothecary;
    if(t.pop2 == null)
		t.pop2 = new CPopup('pbapodisp_pop',50,40,300,150,true,function(){t.pop2.destroy(); t.pop2 = null;});
	var m = '<table><tr><td><b>'+Cities.cities[city].name+'</b></td></tr>';
	var info = ApothecaryOptions.city[city][id];
	m += '<tr><td>'+uW.g_js_strings.commonstr.troops+' : </td><td>'+uW.unitcost['unt'+info.troop][0]+'</td></tr>\
		  <tr><td>Minimum: </td><td><INPUT id=pbapodisp_min type=text size=4 value="'+info.min+'" \>\
		  <tr><td><INPUT type=checkbox id=pbapodisp_maxcheck '+(info.max_sel?'CHECKED':'')+' /> Maximum: </td><td><INPUT id=pbapodisp_max type=text size=4 value="'+info.max+'" '+(info.max_sel?'':'DISABLED')+' \></td></tr>\
		  <tr><td><INPUT type=submit id=pbapodisp_save value='+uW.g_js_strings.commonstr.save+' /></td></tr>';
	t.pop2.getMainDiv().innerHTML = m;
	t.pop2.show(true);
	ById('pbapodisp_save').addEventListener('click', function(){
		var min = parseIntNan(ById("pbapodisp_min").value);
		var max = parseIntNan(ById("pbapodisp_max").value);
		var max_sel = ById("pbapodisp_maxcheck").checked;
		if(min < 1 || (max_sel && max < 1) || (max_sel && (max < min))){
			alert("Invalid/Incorrect input!");
			return;
		}
		info.min = min;
		info.max = max;
		info.max_sel = max_sel;
		saveApothecaryOptions();
		t.pop2.show(false);
		t.e_displayarray();
	},false);
  },

  loop : function(){
    var t = Tabs.Apothecary;
    clearTimeout(t.timer);
    if(!ApothecaryOptions.Active) return;
    for (var city in ApothecaryOptions.city){
		if(!Cities.cities[city] || ApothecaryOptions.city[city].length < 1) continue;
		if(t.cities[city]) continue; //Skip if Apothecary doesn't exist
		if(Seed.queue_revive['city'+Cities.cities[city].id].length > 0) continue;
		if(Seed.citystats["city" + Cities.cities[city].id].gold[0] < parseInt(ApothecaryOptions.goldkeep)) continue;
		for(var i=0; i<ApothecaryOptions.city[city].length; i++){
			var info = ApothecaryOptions.city[city][i];
			var cid = Cities.cities[city].id;
			var amt = 0;
			if(Seed.woundedUnits['city'+cid]['unt'+info.troop] < info.min) continue;
			if(Seed.woundedUnits['city'+cid]['unt'+info.troop] > info.max && info.max_sel){
				amt = info.max;
			} else {
				amt = Seed.woundedUnits['city'+cid]['unt'+info.troop];
			}
			if(cid > 0 && info.troop > 0 && amt > 0){
				t.do_revive(cid,info.troop,amt);
				break;
			}
		}
	}
	t.timer = setTimeout(t.loop, 10000);
  },

  e_toggleswitch : function(obj){
    var t = Tabs.Apothecary;
    var obj = ById("pbapothecary_power");
	if(ApothecaryOptions.Active){
		if (obj) obj.value = lang.Apothecary.power+" = OFF";
		ApothecaryOptions.Active = false;
        if (Options.BORac_Apo) updatebotbutton(lang.Apothecary.label+" - OFF", 'boautohealtab');
		clearTimeout(t.timer);
	} else {
		if (obj) obj.value = lang.Apothecary.power+" = ON";
		ApothecaryOptions.Active = true;
		if (Options.BORac_Apo) updatebotbutton(lang.Apothecary.label+" - ON", 'boautohealtab');
		t.timer = setTimeout(t.loop,5000);
	}
	saveApothecaryOptions();
  },

  do_revive : function(currentcityid,unitId,num,notify){
    var t = Tabs.Apothecary;
	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	params.cid = currentcityid;
    params.type = unitId;
    params.quant = num;
    params.apothecary = true;
	var time = unsafeWindow.cm.RevivalModel.getRevivalStats(unitId, num).time;

	new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/train.php" + unsafeWindow.g_ajaxsuffix, {
		method: "post",
		parameters: params,
		onSuccess: function(rslt) {
		  if (rslt.ok) {
			for (var i = 1; i < 5; i++) {
				var resourceLost = parseInt(unsafeWindow.unitcost["unt" + unitId][i]) * 3600 * parseInt(num);
				if(rslt.gamble) resourceLost = resourceLost*rslt.gamble[i];
				unsafeWindow.seed.resources["city" + currentcityid]["rec" + i][0] = parseInt(unsafeWindow.seed.resources["city" + currentcityid]["rec" + i][0]) - resourceLost;
			}
			if (!rslt.initTS) {
				rslt.initTS = unixTime() - 1;
			}
			Seed.queue_revive["city" + currentcityid].push([unitId, num, rslt.initTS, parseInt(rslt.initTS) + time, 0, time, null]);
			var cost = unsafeWindow.cm.RevivalModel.getRevivalStats(unitId, num).cost;
			Seed.citystats["city" + currentcityid].gold[0] -= parseInt(cost);
			unsafeWindow.update_gold();
			unsafeWindow.cm.WoundedModel.sub(unitId, num);
		  } else {

		  }
		},
	});
  },

  hide : function (){
    var t = Tabs.Apothecary;
    clearInterval(t.timerStat);
  },

  show : function (){
    var t = Tabs.Apothecary;
    t.timerStat = setInterval(t.displayStat,10000);
  },
}

Tabs.farm = {
	tabLabel: lang.BoiteLabelFarm,
	tabOrder : 22,
	myDiv : null,
	MapAjax : new CMapAjax(),
	popFirst : true,
	opt : {},
	nextattack : null,
	updateSeedTimer: null,
	searchRunning : false,
	tilesSearched : 0,
	tilesFound : 0,
	curX : 0,
	curY : 0,
	lastX : 0,
	firstX : 0,
	firstY : 0,
	lastY : 0,
	rallypointlevel:0,
	knt:{},
	helpArray:{},
	FarmArray:{},
	marchArray:[],
	lookup:1,
	city:0,
	deleteRPT:null,
	timerll:null,
	DipArray: ["friendly","hostile","friendlyToThem","friendlyToYou","neutral","unallied"],
	interval: ["Continuously","1 Hour","2 Hours","3 Hours","6 Hours","12 Hours","24 Hours"],

	init : function (div){
		var t = Tabs.farm;
		t.myDiv = div;

		if (Options.BORac_Far) AddSubTabLink('Farm', t.toggleBarbState, 'BOautoFarm');

		if(typeof(Seed.allianceDiplomacies)=='undefined'){
			t.myDiv.innerHTML ='<BR><CENTER><i><b>'+lang.autoFarm.playerMustInAlliance+'</i></b></center>';
			return;
		}


		var m = '<DIV id=pbFarmTab class=boStat>'+lang.autoFarm.farmHead+'</div><TABLE id=pbFarmOptions width=100% height=0% class=ptTab><TR align="center">';
		if (FarmOptions.Running == false) {
			m += '<TD><INPUT id=FarmAttSearch type=submit value="'+lang.autoFarm.farmButton+' = OFF"></td>';
			if (Options.BORac_Far) updatebotbutton("Farm - OFF", 'BOautoFarm');
			t.checkMarches();
		} else {
			m += '<TD><INPUT id=FarmAttSearch type=submit value="'+lang.autoFarm.farmButton+' = ON"></td>';
			if (Options.BORac_Far) updatebotbutton("Farm - ON", 'BOautoFarm');
			t.timerll=setInterval( t.checkMarches ,5000);
		}
		m +='<TD title="'+lang.autoFarm.farmShowNote+'"><INPUT id=pbpaintFarms type=submit value="'+lang.autoFarm.farmShow+'">';
		m += '<SELECT id=pbFarmcity type=list></select></td></tr></table>';
		m += '</tr></table></div>';

		m += '<DIV id=pbTraderDivD class=boStat>'+lang.autoFarm.farmHeadStats+'</div>';

		m += '<TABLE id=pbfarmstats width=95% height=0% class=ptTab><TR align="left"><TR>';
		for(i=0;i<Seed.cities.length;i++){
			m += '<TD>' + Seed.cities[i][1] +'</td>';
		}
		m+='</tr><TR>';
		for(i=0;i<Seed.cities.length;i++){
			m += '<TD><DIV><span id='+ 'pdtotalFarm' + i +'></span></div></td>';
		}
		m+='</tr><TR>';
		for(i=0;i<Seed.cities.length;i++){
			m += '<TD><DIV><span id='+ 'pddataFarm' + i +'></span></div></td>';
		}
		m+='</tr><TR>'
		for(i=0;i<Seed.cities.length;i++){
			m += '<TD><DIV><span id='+ 'pddataFarmarray' + i +'></span></div></td>';
		}
		m+='</tr></table>';

		m+='<DIV id=FarmCheck></div>';

		m += '<DIV id=pbTraderDivD class=boStat>'+lang.autoFarm.farmHeadOptions+'</div>';
		m += '<TABLE id=pbfarmstats width=90% height=0% class=ptTab>';
		m += '<TR><TD width=180>'+lang.autoFarm.farmKeepRP+' </td><TD><INPUT id=FarmRallyClip type=text size=2 maxlength=2 value=' + FarmOptions.RallyClip +'> '+lang.autoFarm.farmKeepRP2+'</td></tr>';
		m += '<TR><TD>'+lang.autoFarm.farmIntervall+'</td><TD><SELECT id=FarmInterval type=list></td></tr>';
		m += '<TR><TD>'+lang.autoFarm.farmSearchDist+'</td><TD><INPUT type=text id=FarmRadius size=3 maxlength=3 value='+ FarmOptions.MaxDistance +'><INPUT id=FarmSearch type=submit value="'+lang.autoFarm.farmSearch+'"></td><tr>';
		m += '<TR><TD>'+uW.g_js_strings.commonstr.might+':</td>';
		m += '<TD width=50>'+lang.autoFarm.shortMin+': <INPUT type=text id=FarmMinMight size=8 maxlength=8 value='+ FarmOptions.MinMight +'></td>';
		m += '<TD>'+lang.autoFarm.shortMax+': <INPUT type=text id=FarmMaxMight size=9 maxlength=9 value='+ FarmOptions.MaxMight +'></td></tr>';
		m += '<TR><TD>'+lang.autoFarm.farmInactivePlayer+' </td>';
		m += '<TD><INPUT type=text id=FarmInactive size=3 value='+ FarmOptions.Inactive +'> '+lang.autoFarm.farmInactivePlayer2+'&nbsp;<INPUT type=text id=FarmInactiveMax size=3 value='+ FarmOptions.InactiveMax +'> '+lang.autoFarm.farmInactivePlayer3+'</td></table>';

	       m += '<TABLE id=pbfarmstats width=90% height=0% class=ptTab><TR align="left"><TR><TD width=100>'+lang.autoFarm.mainCity+':</td>';
		for (i=1;i<=Seed.cities.length;i++) {
			m+='<TD class=pbCityEn><INPUT id=CityEnable'+ i +'  type=checkbox '+(FarmOptions.CityEnable[i]?'CHECKED':'')+'>'+ Seed.cities[i-1][1] +'</td>';
		}
		m += '</tr></table><TABLE id=pbfarmstats width=90% height=0% class=ptTab><TR align="left"><TD width=100>'+lang.autoFarm.farmCityLevel+'</td>';
		for (i=1;i<=12;i++) {
			m+='<TD class=pbCityOpt><INPUT id=CityLevel'+ i +'  type=checkbox '+(FarmOptions.CityLevel[i]?'CHECKED':'')+'>'+ i +'</td>';
		}
		m += '</tr></table><TABLE id=pbfarmstats width=90% height=0% class=ptTab><TR align="left"><TR><TD width=100>'+lang.autoFarm.farmDip+'</td>';
		for (i=0;i<t.DipArray.length;i++) {
			m+='<TD class=pbDipOpt><INPUT id=Diplomacy'+ t.DipArray[i] +'  type=checkbox '+(FarmOptions.Diplomacy[t.DipArray[i]]?'CHECKED':'')+'>'+ t.DipArray[i] +'</td>';
		}
		m+='</tr></table>';

		m += '<DIV id=pbTraderDivD class=boStat>'+lang.autoFarm.farmHeadTroops+'</div>';
		m += '<TABLE id=pbaddreasignroute width=100% height=0% class=ptTab><TR align="center">';
		m += '<TR><TD rowspan="2"><img height=18 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_30_s34.jpg"></td>';
		m += '<TD>'+uW.unitcost['unt1'][0]+'</td>'
		m += '<TD rowspan="2"><img height=18 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_30_s34.jpg"></td>'
		m += '<TD>'+uW.unitcost['unt2'][0]+'</td>'
		m += '<TD rowspan="2"><img height=18 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_30_s34.jpg"></td>'
		m += '<TD>'+uW.unitcost['unt3'][0]+'</td>'
		m += '<TD rowspan="2"><img height=18 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_30_s34.jpg"></td>'
		m += '<TD>'+uW.unitcost['unt4'][0]+'</td></tr>'
		m += '<TR><TD  class=pbTroopOpt><INPUT id=FarmTroop1  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[1] +'\></td>';
		m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop2  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[2] +'\></td>';
		m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop3  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[3] +'\></td>';
		m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop4  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[4] +'\></td></tr>';
		m += '<TR><TD rowspan="2"><img height=18 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_30_s34.jpg"></td>';
		m += '<TD>'+uW.unitcost['unt5'][0]+'</td>'
		m += '<TD rowspan="2"><img height=18 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_30_s34.jpg"></td>'
		m += '<TD>'+uW.unitcost['unt6'][0]+'</td>'
		m += '<TD rowspan="2"><img height=18 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_30_s34.jpg"></td>'
		m += '<TD>'+uW.unitcost['unt7'][0]+'</td>'
		m += '<TD rowspan="2"><img height=18 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_30_s34.jpg"></td>'
		m += '<TD>'+uW.unitcost['unt8'][0]+'</td></tr>'
		m += '<TR><TD  class=pbTroopOpt><INPUT id=FarmTroop5  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[5] +'\></td>';
		m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop6  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[6] +'\></td>';
		m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop7  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[7] +'\></td>';
		m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop8  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[8] +'\></td></tr>';
		m += '<TR><TD rowspan="2"><img height=18 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_30_s34.jpg"></td>';
		m += '<TD>'+uW.unitcost['unt9'][0]+'</td>'
		m += '<TD rowspan="2"><img height=18 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_30_s34.jpg"></td>'
		m += '<TD>'+uW.unitcost['unt10'][0]+'</td>'
		m += '<TD rowspan="2"><img height=18 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_30_s34.jpg"></td>'
		m += '<TD>'+uW.unitcost['unt11'][0]+'</td>'
		m += '<TD rowspan="2"><img height=18 src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_30_s34.jpg"></td>'
		m += '<TD>'+uW.unitcost['unt12'][0]+'</td></tr>'
		m += '<TR><TD  class=pbTroopOpt><INPUT id=FarmTroop9  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[9] +'\></td>';
		m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop10  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[10] +'\></td>';
		m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop11  type=text size=10 maxlength=10 value='+ FarmOptions.Troops[11] +'\></td>';
		m += '<TD  class=pbTroopOpt><INPUT id=FarmTroop12 type=text size=10 maxlength=10 value='+ FarmOptions.Troops[12] +'\></td></tr></table>';

		t.myDiv.innerHTML = m;
		t.checkFarmData();
		if(t.nextattack == null) t.nextattack = setInterval(t.getnextCity, FarmOptions.SendInterval*1000);
		document.getElementById('pbFarmcity').options.length=0;
		for (i=0;i<Seed.cities.length;i++){
			var o = document.createElement("option");
			o.text = Seed.cities[i][1]
			o.value = i+1;
			document.getElementById("pbFarmcity").options.add(o);
		}
		document.getElementById('FarmInterval').options.length=0;
		for (i=0;i<t.interval.length;i++){
			var o = document.createElement("option");
			o.text = t.interval[i];
			o.value = i;
			document.getElementById("FarmInterval").options.add(o);
		}
		document.getElementById('FarmInterval').value = FarmOptions.Interval;
		for(i=0;i<Seed.cities.length;i++){
			var elem = 'pdtotalFarm'+i;
			if (t.FarmArray[i+1] == undefined) document.getElementById(elem).innerHTML = '<i>'+lang.autoFarm.farmNoData+'</i>';
			else document.getElementById(elem).innerHTML =  ''+lang.autoFarm.farmFarms+' ' + t.FarmArray[i+1].length +'/'+ t.helpArray[i+1].length;
		}
		document.getElementById('FarmInterval').addEventListener('change', function(){
			FarmOptions.Interval = document.getElementById('FarmInterval').value;
			saveFarmOptions();
		} , false);
		document.getElementById('FarmRallyClip').addEventListener('change', function(){
			FarmOptions.RallyClip = document.getElementById('FarmRallyClip').value;
			saveFarmOptions();
		} , false);
		document.getElementById('FarmRadius').addEventListener('change', function(){
			FarmOptions.MaxDistance = parseInt(document.getElementById('FarmRadius').value);
			saveFarmOptions();
		} , false);
		document.getElementById('FarmAttSearch').addEventListener('click', function(){t.toggleBarbState(this)} , false);
		document.getElementById('FarmSearch').addEventListener('click', function(){
			for (i=1;i<=Seed.cities.length;i++) GM_deleteValue('Farms_' + Seed.player['name'] + '_city_' + i + '_' + getServerId());
			for(i=0;i<Seed.cities.length;i++){
				var elem = 'pdtotalFarm'+i;
				document.getElementById(elem).innerHTML = '<i>'+lang.autoFarm.farmNoData+'</i>';
			}
			t.checkFarmData();
		} , false);
		document.getElementById('pbpaintFarms').addEventListener('click', function(){t.showFarms(document.getElementById("pbFarmcity").value,Seed.cities[document.getElementById("pbFarmcity").value -1][1]);},false);

		document.getElementById('FarmMinMight').addEventListener('change', function(){
			FarmOptions.MinMight = parseInt(document.getElementById('FarmMinMight').value);
			t.FilterFarms();
			saveFarmOptions();
		} , false);
		document.getElementById('FarmMaxMight').addEventListener('change', function(){
			FarmOptions.MaxMight = parseInt(document.getElementById('FarmMaxMight').value);
			t.FilterFarms();
			saveFarmOptions();
		} , false);
		document.getElementById('FarmInactive').addEventListener('change', function(){
			FarmOptions.Inactive = parseInt(document.getElementById('FarmInactive').value);
			t.FilterFarms();
			saveFarmOptions();
		} , false);
		document.getElementById('FarmInactiveMax').addEventListener('change', function(){
			FarmOptions.InactiveMax = parseInt(document.getElementById('FarmInactiveMax').value);
			t.FilterFarms();
			saveFarmOptions();
		} , false);

		var element = document.getElementsByClassName('pbTroopOpt');
		for (k=0;k<element.length;k++){
			element[k].addEventListener('change', function(){
				for (i=1;i<=10;i++){
					FarmOptions.Troops[i] = document.getElementById('FarmTroop' + i).value;
					saveFarmOptions();
				}
			}, false);
		}

		element = document.getElementsByClassName('pbCityOpt');
		for (k=0;k<element.length;k++){
			element[k].addEventListener('change', function(){
				for (i=1;i<=12;i++){
					FarmOptions.CityLevel[i] = document.getElementById('CityLevel' + i).checked;
					saveFarmOptions();
				}
				t.FilterFarms();
			}, false);
		}

		element = document.getElementsByClassName('pbCityEn');
		for (k=0;k<element.length;k++){
			element[k].addEventListener('change', function(){
				for (i=1;i<=Seed.cities.length;i++){
					FarmOptions.CityEnable[i] = document.getElementById('CityEnable' + i).checked;
					saveFarmOptions();
				}
				t.FilterFarms();
			}, false);
		}

		element = document.getElementsByClassName('pbDipOpt');
		for (k=0;k<element.length;k++){
			element[k].addEventListener('change', function(){
				for (i=0;i<t.DipArray.length;i++){
					FarmOptions.Diplomacy[t.DipArray[i]] = document.getElementById('Diplomacy' + t.DipArray[i]).checked;
					saveFarmOptions();
				}
				t.FilterFarms();
			}, false);

		}


	},


	checkMarches: function () {
		var t = Tabs.farm;
		for (i=0;i<FarmOptions.FarmMarches.length;i++){
			var cityId = "city"+ FarmOptions.FarmMarches[i]["cityId"];
			var city = FarmOptions.FarmMarches[i]["city"];
			var marchId = "m" + FarmOptions.FarmMarches[i]["marchId"];
			if (Seed.queue_atkp[cityId][marchId] !=undefined){
				if (Seed.queue_atkp[cityId][marchId].marchStatus == 8  && Seed.queue_atkp[cityId][marchId].hasUpdated) {
					FarmOptions.Checks++;
					saveFarmOptions();
					document.getElementById('FarmCheck').innerHTML = "Attacks: " + FarmOptions.Attacks + " - Checks:" + FarmOptions.Checks;
					for(u=1;u<=12;u++) if (parseInt(Seed.queue_atkp[cityId][marchId]["unit"+u+"Return"]) < parseInt(Seed.queue_atkp[cityId][marchId]["unit"+u+"Count"])){
						t.FarmArray[FarmOptions.FarmMarches[i]["city"]][FarmOptions.FarmMarches[i]["number"]]["lost"] = true;
						t.FarmArray[FarmOptions.FarmMarches[i]["city"]][FarmOptions.FarmMarches[i]["number"]]["enabled"] = false;
					}
					for (a=0;a<t.helpArray[FarmOptions.FarmMarches[i]["city"]].length;a++){
						for (b=0;b<t.FarmArray[FarmOptions.FarmMarches[i]["city"]].length;b++){
							if (parseInt(t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['x']) == parseInt(t.helpArray[FarmOptions.FarmMarches[i]["city"]][b]['x']) && parseInt(t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['y']) == parseInt(t.helpArray[FarmOptions.FarmMarches[i]["city"]][b]['y'])){
								t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['gold'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['gold'];
								t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['resource1'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['resource1'];
								t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['resource2'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['resource2'];
								t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['resource3'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['resource3'];
								t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['resource4'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['resource4'];
								t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['empty'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['empty'];
								t.helpArray[FarmOptions.FarmMarches[i]["city"]][a]['lost'] = t.FarmArray[FarmOptions.FarmMarches[i]["city"]][b]['lost'];
							}
						}
					}
					GM_setValue('Farms_' + Seed.player['name'] + '_city_' + FarmOptions.FarmMarches[i]["city"] + '_' + getServerId(), JSON2.stringify(t.helpArray[FarmOptions.FarmMarches[i]["city"]]));
					FarmOptions.FarmMarches.splice(i,1);
					saveFarmOptions();
				}
			} else {
				FarmOptions.FarmMarches.splice(i,1);
				saveFarmOptions();
			}
		}
	},

	checkInactives : function (citynumber,city,FarmNumber,xcoord,ycoord,kid,uid,u1,u2,u3,u4,u5,u6,u7,u8,u9,u10,u11,u12){
		var t = Tabs.farm;
		var now = new Date().getTime()/1000.0;
		var hours = (now - t.FarmArray[city][FarmOptions.FarmNumber[city]]['LastCheck']) / 3600;
		if (t.FarmArray[city][FarmOptions.FarmNumber[city]]['DaysInactive'] == "?" || hours > 6){
			var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
			params.pid = uid;
			new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/viewCourt.php" + unsafeWindow.g_ajaxsuffix, {
				method: "post",
				parameters: params,
				onSuccess: function (transport) {
					var rslt = eval("(" + transport.responseText + ")");
					var lastLogin = rslt.playerInfo.lastLogin;
					var fullDate = lastLogin.substr(0,4) +", "+ lastLogin.substr(5,2) +", "+ lastLogin.substr(8,2) ;
					var time = new Date (fullDate).getTime()/1000;
					var days = Math.floor((now - time) / 86400);
					t.FarmArray[city][FarmOptions.FarmNumber[city]]['DaysInactive'] = days;
					for (i=0;i<t.helpArray[city].length;i++){
						if (xcoord == parseInt(t.helpArray[city][i]['x']) && ycoord == parseInt(t.helpArray[city][i]['y'])){
							t.helpArray[city][i]['DaysInactive'] = days;
							t.helpArray[city][i]['LastCheck'] = now;
						}
					}
					GM_setValue('Farms_' + Seed.player['name'] + '_city_' + city + '_' + getServerId(), JSON2.stringify(t.helpArray[city]));
					if (days >= FarmOptions.Inactive && days <= FarmOptions.InactiveMax) {
						t.doBarb(citynumber,city,FarmNumber,xcoord,ycoord,kid,u1,u2,u3,u4,u5,u6,u7,u8,u9,u10,u11,u12);
					} else 	{
						FarmOptions.FarmNumber[city]++;
						saveFarmOptions();
						t.barbing();
					}
				},
				onFailure: function (rslt) {
					notify (rslt);
				},
			});
		} else {
			if (t.FarmArray[city][FarmOptions.FarmNumber[city]]['DaysInactive'] >= FarmOptions.Inactive && t.FarmArray[city][FarmOptions.FarmNumber[city]]['DaysInactive'] <= FarmOptions.InactiveMax) {
				t.doBarb(citynumber,city,FarmNumber,xcoord,ycoord,kid,u1,u2,u3,u4,u5,u6,u7,u8,u9,u10,u11,u12);
			} 	else{
				FarmOptions.FarmNumber[city]++;
				saveFarmOptions();
				t.barbing();
			}
		}
	},

	showFarms: function (citynumber,cityname) {
		var t = Tabs.farm;
		var popTradeRoutes = null;
		t.popTradeRoutes = new CPopup('pbShowFarms', 0, 0, 1100, 485, true, function() {clearTimeout (1000);});
		var m = '<DIV style="max-height:440px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbShowBarbs" id="pbBars">';
		t.popTradeRoutes.getMainDiv().innerHTML = '</table></div>' + m;
		t.popTradeRoutes.getTopDiv().innerHTML = '<div class="popupBanner">'+lang.autoFarm.farmFarms+' '+cityname+'</div>';
		t.paintFarms(citynumber,cityname);
		t._addTabHeader(citynumber,cityname);
		t.popTradeRoutes.show(true)	;
	},


	ToggleFarms: function(citynumber) {
		var t = Tabs.farm;
		var id=0;
		var element_class = document.getElementsByClassName('Farm');
		for (d = 1; d <= t.FarmArray[citynumber].length; d++) {
			id = d-1;
			var ele = document.getElementById('FarmToggle' + d);
			if (ele.checked) {
				t.FarmArray[citynumber][id].enabled = true;
				t.FarmArray[citynumber][id].lost = false;
				t.FarmArray[citynumber][id].empty = 0;
			}
			else t.FarmArray[citynumber][id].enabled = false;
		}
		for (i=0;i<t.helpArray[citynumber].length;i++){
			for (j=0;j<t.FarmArray[citynumber].length;j++){
				if (parseInt(t.FarmArray[citynumber][j]['x']) == parseInt(t.helpArray[citynumber][i]['x']) && parseInt(t.FarmArray[citynumber][j]['y']) == parseInt(t.helpArray[citynumber][i]['y'])) t.helpArray[citynumber][i].enabled = t.FarmArray[citynumber][j].enabled;
			}
		}
		GM_setValue('Farms_' + Seed.player['name'] + '_city_' + citynumber + '_' + getServerId(), JSON2.stringify(t.helpArray[citynumber]));
	},

	paintFarms: function(i,cityname){
		var t = Tabs.farm;
		if (t.FarmArray[i] ) {
		 for (k=(t.FarmArray[i].length-1);k>=0;k--){

		  t._addTab(i,cityname,k+1,t.FarmArray[i][k]['enabled'], t.FarmArray[i][k]['x'], t.FarmArray[i][k]['y'],t.FarmArray[i][k]['dist'], t.FarmArray[i][k]['level'],t.FarmArray[i][k]['AllianceName'], t.FarmArray[i][k]['Diplomacy'], t.FarmArray[i][k]['PlayerName'], t.FarmArray[i][k]['cityName'],t.FarmArray[i][k]['might'], t.FarmArray[i][k]['cityNumber'], t.FarmArray[i][k]['attacked'],t.FarmArray[i][k]['DaysInactive'],t.FarmArray[i][k]['lost'],t.FarmArray[i][k]['empty'],t.FarmArray[i][k]['gold'],t.FarmArray[i][k]['resource1'],t.FarmArray[i][k]['resource2'],t.FarmArray[i][k]['resource3'],t.FarmArray[i][k]['resource4']);

		 }

		}
	},


	_addTab: function(citynumber,cityname,queueId,status,X,Y,dist,level,AllianceName,diplomacy,playerName,cityName,might,cityNumber,attacked,DaysInactive,lost,empty,gold,rec1,rec2,rec3,rec4){
		var t = Tabs.farm;
		var row = document.getElementById('pbBars').insertRow(0);
		row.vAlign = 'top';
		if (lost) row.style.color = "red";
		if (!lost && empty == 0) row.style.color = "black";
		if (DaysInactive  >= FarmOptions.Inactive && DaysInactive <=  FarmOptions.InactiveMax) row.style.color = "orange";
		row.insertCell(0).innerHTML = queueId;
		row.insertCell(1).innerHTML = "<a href='javascript:void(0)' onclick='cm.utils.CoordinateLinkController.onClick(event)' class='coordinateLink'>("+X+","+Y+")</a>";
		row.insertCell(2).innerHTML = dist;
		row.insertCell(3).innerHTML = level;
		row.insertCell(4).innerHTML = AllianceName;
		row.insertCell(5).innerHTML = diplomacy;
		row.insertCell(6).innerHTML = playerName;
		row.insertCell(7).innerHTML = cityName;
		row.insertCell(8).innerHTML = addCommas(might);
		row.insertCell(9).innerHTML = DaysInactive;
		row.insertCell(10).innerHTML = attacked;
		row.insertCell(11).innerHTML = '<INPUT class=Farm id="FarmToggle' + queueId + '" type=checkbox>';

		var element_class = document.getElementsByClassName('Farm');
		for (c = 0; c < element_class.length; c++) {
			element_class[c].checked = t.FarmArray[citynumber][c].enabled;
			element_class[c].addEventListener('click', function(){t.ToggleFarms(citynumber)}, false);
		}
	},

	_addTabHeader: function(citynumber,cityname) {
		var t = Tabs.farm;
		var row = document.getElementById('pbBars').insertRow(0);
		row.vAlign = 'top';
		row.insertCell(0).innerHTML = "Id";
		row.insertCell(1).innerHTML = ""+lang.autoFarm.shortCoordinate+"";
		row.insertCell(2).innerHTML = ""+lang.autoFarm.shortDistance+"";
		row.insertCell(3).innerHTML = ""+uW.g_js_strings.commonstr.level+"";
		row.insertCell(4).innerHTML = ""+lang.autoFarm.farmAllianceName+"";
		row.insertCell(5).innerHTML = ""+lang.autoFarm.mainDiplo+"";
		row.insertCell(6).innerHTML = ""+lang.autoFarm.mainPlayer+"";
		row.insertCell(7).innerHTML = ""+lang.autoFarm.mainCity+"";
		row.insertCell(8).innerHTML = ""+uW.g_js_strings.commonstr.might+"";
		row.insertCell(9).innerHTML = ""+lang.autoFarm.farmInactive+"";
		row.insertCell(10).innerHTML = ""+lang.autoFarm.farmAttacks+"";
	},
	isMyself: function(userID){
		if(!Seed.players["u"+userID])
			return false;
		if(Seed.players["u"+userID].n == Seed.player.name)
			return true;
		else
			return false;
		return false;
	},

	checkFarmData: function(){
		var t = Tabs.farm;
		for (i=1;i<=Seed.cities.length;i++){
			//GM_log("checkFarmData City "+i);
			t.helpArray[i] = [];
			var myarray = (GM_getValue('Farms_' + Seed.player['name'] + '_city_' + i + '_' + getServerId()));
			if (myarray == undefined && t.searchRunning==false && FarmOptions.CityEnable[i]) {
				t.searchRunning = true;
				t.lookup=i;
				t.opt.startX=parseInt(Seed.cities[(i-1)][2]);
				t.opt.startY=parseInt(Seed.cities[(i-1)][3]);
				t.clickedSearch();
			}
			if (myarray != undefined){
				myarray = JSON2.parse(myarray);
				//if(AttackOptions.Method == 'distance')
				t.helpArray[i] = myarray.sort(function sortBarbs(a,b) {a = a['dist'];b = b['dist'];return a == b ? 0 : (a < b ? -1 : 1);});
				//if(AttackOptions.Method == 'level') t.helpArray[i] = myarray.sort(function function (a,b) {a = parseInt(a['level']);b = parseInt(b['level']);return (a > b )? -1 : ((a < b ? 1 : t.SortDist(a,b)));});
				//if(AttackOptions.Method == 'lowlevel') t.helpArray[i] = myarray.sort(function function (a,b) {a = parseInt(a['level']);b = parseInt(b['level']);return (a < b )? -1 : ((a > b ? 1 : t.SortDist(a,b)));});
				GM_setValue('Farms_' + Seed.player['name'] + '_city_' + i + '_' + getServerId(), JSON2.stringify(t.helpArray[i]));
			}
		}
		//GM_log("checkFarmData -> t.FilterFarms()");
		t.FilterFarms();
	},

	FilterFarms: function() {
		try{
			var t = Tabs.farm;
			if (t.searchRunning) return;
			t.FarmArray = new Array();
			t.FarmArray["1"] = new Array();
			t.FarmArray["2"] = new Array();
			t.FarmArray["3"] = new Array();
			t.FarmArray["4"] = new Array();
			t.FarmArray["5"] = new Array();
			t.FarmArray["6"] = new Array();
			t.FarmArray["7"] = new Array();
			t.FarmArray["8"] = new Array();
			for (u=1;u<=Seed.cities.length;u++){



				for (i=0;i<t.helpArray[u].length;i++){
					var checkLvl = false;
					var checkMight = false;
					var checkDip = false;
					var checkAlliance = false;
					var AllianceName = "";
					for (j=1;j<=12;j++) if (FarmOptions.CityLevel[j] && t.helpArray[u][i].level == j) checkLvl=true;
					if (/*Seed.allianceDiplomacies!=undefinied &&*/ Seed.allianceDiplomacies.allianceName != undefined) AllianceName = Seed.allianceDiplomacies.allianceName;
					if (t.helpArray[u][i].AllianceName != AllianceName) checkAlliance = true;
					if (t.helpArray[u][i].might >= FarmOptions.MinMight && t.helpArray[u][i].might <= FarmOptions.MaxMight) checkMight = true;
					for (j in FarmOptions.Diplomacy) if (FarmOptions.Diplomacy[j] && t.helpArray[u][i].Diplomacy == j) checkDip=true;
					if (checkLvl && checkMight && checkDip && checkAlliance) t.FarmArray[u].push (t.helpArray[u][i]);
				}
				var elem = 'pdtotalFarm'+(u-1);
				if (t.FarmArray[u] == undefined) document.getElementById(elem).innerHTML = '<i>'+lang.autoFarm.farmNoData+'</i>';
				else
				 ById(elem).innerHTML =  ''+lang.autoFarm.farmFarms+' ' + t.FarmArray[u].length +'/'+ t.helpArray[u].length;
			 }

		} catch(e){
			GM_log(e.message);
		}
	},



	SortDist: function(a,b) {
		a = parseFloat(a['dist']);
		b = parseFloat(b['dist']);
		return (a < b )? -1 : ((a > b ? 1 : 0));
	},

	toggleBarbState: function(){
		var t = Tabs.farm;
		var obj=ById("FarmAttSearch");
		if (FarmOptions.Running == true) {
			FarmOptions.Running = false;
			if (obj) obj.value = lang.autoFarm.farmButton+' = OFF';
			if (Options.BORac_Far) updatebotbutton("Farm - OFF", 'BOautoFarm');
			saveFarmOptions();
			t.nextattack = null;
			t.updateSeedTimer = null;
			clearInterval(t.timerll);
		} else {
			FarmOptions.Running = true;
			if (obj) obj.value = lang.autoFarm.farmButton+' = ON';
			if (Options.BORac_Far) updatebotbutton("Farm - ON", 'BOautoFarm');
			saveFarmOptions();
			t.checkFarmData();
			t.timerll=setInterval( t.checkMarches ,2000);

			t.nextattack = setInterval(t.getnextCity,(FarmOptions.SendInterval*1000));
		}
	},

	barbing : function(){
		var t = Tabs.farm;
		var city = t.city;
		var u1 = FarmOptions.Troops[1];
		var u2 = FarmOptions.Troops[2];
		var u3 = FarmOptions.Troops[3];
		var u4 = FarmOptions.Troops[4];
		var u5 = FarmOptions.Troops[5];
		var u6 = FarmOptions.Troops[6];
		var u7 = FarmOptions.Troops[7];
		var u8 = FarmOptions.Troops[8];
		var u9 = FarmOptions.Troops[9];
		var u10 = FarmOptions.Troops[10];
		var u11 = FarmOptions.Troops[11];
		var u12 = FarmOptions.Troops[12];
		var now = new Date().getTime()/1000.0;
		now = now.toFixed(0);
		citynumber = Seed.cities[city-1][0];
		cityID = 'city' + citynumber;

		t.getAtkKnight(cityID);
		t.getRallypointLevel(cityID);
		var slots=0;
		if (Seed.queue_atkp[cityID] != undefined){
			for(var k in Seed.queue_atkp[cityID])
				slots++;
			if(Seed.queue_atkp[cityID].toSource() == "[]")
				slots = 0;
		}
		else slots=0;


		var element2 = 'pddataFarmarray'+(city-1);
		if (ById(element2)) ById(element2).innerHTML =  ''+lang.autoFarm.mainSRallyPoint+': (' + slots + '/' + t.rallypointlevel +')';

		if (!FarmOptions.CityEnable[city]) return;
		if ((t.rallypointlevel-FarmOptions.RallyClip) <= slots) return;
		if (t.knt.toSource() == "[]") return;
		if (u1 > parseInt(Seed.units[cityID]['unt1']) || u2 > parseInt(Seed.units[cityID]['unt2']) || u3 > parseInt(Seed.units[cityID]['unt3']) || u4 > parseInt(Seed.units[cityID]['unt4']) || u5 > parseInt(Seed.units[cityID]['unt5']) || u6 > parseInt(Seed.units[cityID]['unt6']) || u7 > parseInt(Seed.units[cityID]['unt7']) || u8 > parseInt(Seed.units[cityID]['unt8']) || u9 > parseInt(Seed.units[cityID]['unt9']) || u10 > parseInt(Seed.units[cityID]['unt10']) || u11 > parseInt(Seed.units[cityID]['unt11']) || u12 > parseInt(Seed.units[cityID]['unt12'])) return;
		if (FarmOptions.FarmNumber[city]>=t.FarmArray[city].length) {
		 // Fixe Bug ! by BeWorld
		 FarmOptions.FarmNumber[city]=0;
		 return;
		 }
		var kid = t.knt[0].ID;

		var interval = 0;
		switch(FarmOptions.Interval){
			case "1":interval = 1;break;
			case "2":interval = 2;break;
			case "3":interval = 3;break;
			case "4":interval = 6;break;
			case "5":interval = 12;break;
			case "6":interval = 24;break;
		}

		var check=0;
		while (check == 0){
			check=1;

			for (i=1;i<=12;i++){
				if (FarmOptions.Troops[i] > parseInt(Seed.units[cityID]['unt'+i])) check=0;
			}
			if (FarmOptions.Troops[1] == 0 && FarmOptions.Troops[2] == 0 && FarmOptions.Troops[3] == 0 && FarmOptions.Troops[4] == 0 && FarmOptions.Troops[5] == 0 && FarmOptions.Troops[6] == 0 && FarmOptions.Troops[7] == 0 && FarmOptions.Troops[8] == 0 && FarmOptions.Troops[9] == 0 &&FarmOptions.Troops[10] == 0 && FarmOptions.Troops[11] == 0 && FarmOptions.Troops[12] == 0) check=0;
			if (!t.FarmArray[city][FarmOptions.FarmNumber[city]]['enabled']) check=0;
			if (now < (parseInt(t.FarmArray[city][FarmOptions.FarmNumber[city]]['time']) + (3600 * interval))) check=0;



			if (check ==0) FarmOptions.FarmNumber[city]++;
			if (FarmOptions.FarmNumber[city]>=t.FarmArray[city].length) {
				FarmOptions.FarmNumber[city]=0;
				break;
			}
		}
		if (check == 0) return;

		var xcoord = t.FarmArray[city][FarmOptions.FarmNumber[city]]['x'];
		var ycoord = t.FarmArray[city][FarmOptions.FarmNumber[city]]['y'];
		var uid = t.FarmArray[city][FarmOptions.FarmNumber[city]]['UserId'];
		saveFarmOptions();
		if ((t.rallypointlevel - FarmOptions.RallyClip) > slots) {
		 t.checkInactives(citynumber,city,FarmOptions.FarmNumber[city],xcoord,ycoord,kid,uid,u1,u2,u3,u4,u5,u6,u7,u8,u9,u10,u11,u12);
		}
	},

	getnextCity: function(){
		var t = Tabs.farm;
		if (!FarmOptions.Running) return;
		if(t.searchRunning) return;
		var city = t.city+1;
		if (city>Seed.cities.length){
			city=1;
		}
		t.city = city;
		t.barbing();
	},

	getRallypointLevel: function(cityId){
		var t = Tabs.farm;
		for (var o in Seed.buildings[cityId]){
			var buildingType = parseInt(Seed.buildings[cityId][o][0]);
			var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
			if (buildingType == 12) t.rallypointlevel=parseInt(buildingLevel);
		}
	},

	getAtkKnight : function(cityID){
		var t = Tabs.farm;
		t.knt = new Array();
		t.getRallypointLevel(cityID);
		for (k in Seed.knights[cityID]){
			if (Seed.knights[cityID][k]["knightStatus"] == 1 && Seed.leaders[cityID]["resourcefulnessKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["politicsKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["combatKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["intelligenceKnightId"] != Seed.knights[cityID][k]["knightId"]){
				t.knt.push ({
					Name:   Seed.knights[cityID][k]["knightName"],
					Combat:	Seed.knights[cityID][k]["combat"],
					ID:		Seed.knights[cityID][k]["knightId"],
				});
			}
		}
		t.knt = t.knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
	},

	doBarb: function(cityID,counter,number,xcoord,ycoord,kid,u1,u2,u3,u4,u5,u6,u7,u8,u9,u10,u11,u12){
		var t = Tabs.farm;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.cid=cityID;
		params.type=4;
		params.kid=kid;
		params.xcoord = xcoord;
		params.ycoord = ycoord;
		if (u1>0) params.u1=u1;
		if (u2>0)params.u2=u2;
		if (u3>0)params.u3=u3;
		if (u4>0)params.u4=u4;
		if (u5>0)params.u5=u5;
		if (u6>0)params.u6=u6;
		if (u7>0)params.u7=u7;
		if (u8>0)params.u8=u8;
		if (u9>0)params.u9=u9;
		if (u10>0)params.u10=u10;
		if (u11>0)params.u11=u11;
		if (u12>0)params.u12=u12;
		params.gold =0;
		params.r1=0;
		params.r2=0;
		params.r3=0;
		params.r4=0;
		params.r5=0;

		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			loading: true,
			onSuccess: function (transport) {
				var rslt = eval("(" + transport.responseText + ")");
				if (rslt.ok) {
					var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
					var ut = unsafeWindow.unixtime();
					var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
					var resources=[0,0,0,0,0,0,0,0,0,0,0,0,0];
					for(i = 0; i <= unitsarr.length; i++){
						if(params["u"+i]){
							unitsarr[i] = params["u"+i];
						}
					}
					var currentcityid = params.cid;
					unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
					if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
					var slots=0;
					for(var k in Seed.queue_atkp['city'+cityID]) slots++;
					if(Seed.queue_atkp['city'+cityID].toSource() == "[]") slots = 0;
					var element1 = 'pddataFarmarray'+(counter-1);
					if (ById(element1))
					  ById(element1).innerHTML =  'RP: (' + slots + '/' + t.rallypointlevel +')';
					var now = new Date().getTime()/1000.0;
					now = now.toFixed(0);
					t.FarmArray[counter][number]['time'] = now;
					t.FarmArray[counter][number]['attacked']++;
					FarmOptions.FarmMarches.push ({city:counter,cityId:cityID,marchId:rslt.marchId,number:number});
					FarmOptions.FarmNumber[counter]++;
					FarmOptions.Attacks++;
					saveFarmOptions();
					if (ById('FarmCheck') )
					  ById('FarmCheck').innerHTML = ""+lang.autoFarm.farmAttacks+": " + FarmOptions.Attacks + " - "+lang.autoFarm.farmChecks+": " + FarmOptions.Checks;
					for (i=0;i<t.helpArray[counter].length;i++){
						for (j=0;j<t.FarmArray[counter].length;j++){
							if (parseInt(t.FarmArray[counter][j]['x']) == parseInt(t.helpArray[counter][i]['x']) && parseInt(t.FarmArray[counter][j]['y']) == parseInt(t.helpArray[counter][i]['y'])){
								t.helpArray[counter][i]['time'] = t.FarmArray[counter][j]['time'];
								t.helpArray[counter][i]['attacked'] = t.FarmArray[counter][j]['attacked'];
							}
						}
					}
					GM_setValue('Farms_' + Seed.player['name'] + '_city_' + counter + '_' + getServerId(), JSON2.stringify(t.helpArray[counter]));
				}
			},
			onFailure: function () {}
		});
		saveFarmOptions();
	},

	clickedSearch : function (){
		var t = Tabs.farm;
		t.opt.searchType = 0;
		t.opt.maxDistance = FarmOptions.MaxDistance;
		t.opt.searchShape = 'circle';
		t.mapDat = [];
		t.firstX =  t.opt.startX - t.opt.maxDistance;
		t.lastX = t.opt.startX + t.opt.maxDistance;
		t.firstY =  t.opt.startY - t.opt.maxDistance;
		t.lastY = t.opt.startY + t.opt.maxDistance;
		t.tilesSearched = 0;
		t.tilesFound = 0;
		t.curX = t.firstX;
		t.curY = t.firstY;
		var xxx = t.MapAjax.normalize(t.curX);
		var yyy = t.MapAjax.normalize(t.curY);
		var element = 'pddataFarm'+(t.lookup-1);
		document.getElementById(element).innerHTML = ''+lang.autoFarm.farmSearchAt+' '+ xxx +','+ yyy;

		setTimeout (function(){t.MapAjax.request (xxx, yyy, 15, t.mapCallback)}, MAP_DELAY);
	},

	mapCallback : function (left, top, width, rslt){
		var t = Tabs.farm;
		if (!t.searchRunning)
			return;
		if (!rslt.ok){
			t.stopSearch (''+lang.autoFarm.mainError+': '+ rslt.errorMsg);
			return;
		}
		map = rslt.data;
		for (k in map){
			var dist = distance (t.opt.startX, t.opt.startY, map[k].xCoord, map[k].yCoord);
			var who = "u" + map[k].tileUserId;
			if (rslt.userInfo === undefined) continue;
			if (rslt.userInfo[who] === undefined) continue;
			var AllianceName = "";
			if (map[k].cityName == null && map[k].misted ==false) continue;
			if (t.isMyself(map[k].tileUserId)) continue;
			if (map[k].tileType!= 51) continue;

			var Diplomacy = "neutral";
			for (DipStatus in t.DipArray) {
				var AllianceId = 0;
				if (rslt.userInfo[who] != undefined) AllianceId = "a" + rslt.userInfo[who].a;
				for (alliance in Seed.allianceDiplomacies[t.DipArray[DipStatus]]) if (Seed.allianceDiplomacies[t.DipArray[DipStatus]][AllianceId] != undefined) Diplomacy = t.DipArray[DipStatus];
			}
			if (rslt.allianceNames[AllianceId] != undefined) AllianceName = rslt.allianceNames[AllianceId];
			if (Diplomacy == "neutral" && AllianceName =="") Diplomacy = "unallied";
			t.mapDat.push ({time:0,empty:0,lost:false,enabled:'true',attacked:0,DaysInactive:"?",LastCheck:0,Diplomacy:Diplomacy,UserId:map[k].tileUserId,AllianceName:AllianceName,x:map[k].xCoord,y:map[k].yCoord,dist:dist,level:map[k].tileLevel,PlayerName:rslt.userInfo[who].n,cityName:map[k].cityName,might:rslt.userInfo[who].m,cityNumber:map[k].cityNum});
		}
		t.tilesSearched += (15*15);

		t.curX += 15;
		if (t.curX > t.lastX){
			t.curX = t.firstX;
			t.curY += 15;
			if (t.curY > t.lastY){
				var element = 'pdtotalFarm'+(t.lookup-1);
				document.getElementById(element).innerHTML = ''+lang.autoFarm.farmFound+' ' + t.mapDat.length;
				var element = 'pddataFarm'+(t.lookup-1);
				document.getElementById(element).innerHTML = "";
				GM_setValue('Farms_' + Seed.player['name'] + '_city_' + t.lookup + '_' + getServerId(), JSON2.stringify(t.mapDat));
				t.searchRunning = false;
				for (y=1;y<=8;y++) FarmOptions.FarmNumber[y] = 0;
				t.checkFarmData();
				return;
			}
		}
		var x = t.MapAjax.normalize(t.curX);
		var y = t.MapAjax.normalize(t.curY);
		var element = 'pddataFarm'+(t.lookup-1);
		document.getElementById(element).innerHTML = ''+lang.autoFarm.farmSearchAt+' '+ x +','+ y;
		setTimeout (function(){t.MapAjax.request (x, y, 15, t.mapCallback)}, MAP_DELAY);
	},

	stopSearch : function (msg){
		var t = Tabs.farm;
		var element = 'pddataFarm'+(t.lookup-1);
		document.getElementById(element).innerHTML = msg;
		t.searchRunning = false;
	},

	hide : function (){

	},

	show : function (){

	},

};

function getWallInfo (cityId, objOut){
	objOut.wallSpaceUsed = 0;
	objOut.fieldSpaceUsed = 0;
	objOut.wallLevel = 0;
	objOut.wallSpace = 0;
	objOut.fieldSpace = 0;
	objOut.Crossbows = 0;
	objOut.CrossbowsTraining = 0;
	objOut.Trebuchet = 0;
	objOut.TrebuchetTraining = 0;
	objOut.Caltrops = 0;
	objOut.CaltropsTraining = 0;
	objOut.SpikedBarrier = 0;
	objOut.SpikedBarrierTraining = 0;
	objOut.Trap = 0;
	objOut.TrapTraining = 0;
	objOut.slotsBusy = 0;
	var b = Seed.buildings["city" + cityId];
	if (b.pos1==null)
		return;
	objOut.wallLevel = parseInt(b.pos1[1]);
	var spots = 0;
	for (var i=1; i<(objOut.wallLevel+1); i++)
		spots += (i * 500);
	objOut.wallSpace = spots;
	objOut.fieldSpace = spots;

	var fort = Seed.fortifications["city" + cityId];
	for (k in fort){
		var id = parseInt(k.substr(4));
		if (id == 53)
			objOut.Crossbows = parseInt(fort[k]);
		else if (id == 55)
			objOut.Trebuchet = parseInt(fort[k]);
		else if (id == 60)
			objOut.Trap = parseInt(fort[k]);
		else if (id == 61)
			objOut.Caltrops = parseInt(fort[k]);
		else if (id == 62)
			objOut.SpikedBarrier = parseInt(fort[k]);
		if (id<60)
			objOut.wallSpaceUsed += parseInt(unsafeWindow.fortstats["unt"+ id][5]) * parseInt(fort[k]);
		else
			objOut.fieldSpaceUsed += parseInt(unsafeWindow.fortstats["unt"+ id][5]) * parseInt(fort[k]);
	}
	var q = Seed.queue_fort["city"+cityId];
	if (q && q.length>0) {
		for (qi=0; qi<q.length; qi++) {
			objOut.slotsBusy++;
			if (q[qi][0]==53)
				objOut.CrossbowsTraining += parseInt(q[qi][1]);
			if (q[qi][0]==55)
				objOut.TrebuchetTraining += parseInt(q[qi][1]);
			if (q[qi][0]==60)
				objOut.TrapTraining += parseInt(q[qi][1]);
			if (q[qi][0]==61)
				objOut.CaltropsTraining += parseInt(q[qi][1]);
			if (q[qi][0]==62)
				objOut.SpikedBarrierTraining += parseInt(q[qi][1]);
		}
	}
}


function addScript (scriptText){
	var scr = document.createElement('script');
	scr.innerHTML = scriptText;
	document.body.appendChild(scr);
}
addScript ('uwuwuwFunc = function (text){ eval (text);  }');


function distance (d, f, c, e) {
  var a = 750;
  var g = a / 2;
  var b = Math.abs(c - d);
  if (b > g)
    b = a - b;
  var h = Math.abs(e - f);
  if (h > g)
    h = a - h;
  return Math.round(100 * Math.sqrt(b * b + h * h)) / 100;
};

function setTabStyle (e, selected){
  if (selected){
    e.className = 'matTabSel';
  } else {
    e.className = 'matTabNotSel';
  }
}
function clickedTab2 (e){
  who2 = e.target.id.substring(3);
  newObj2 = myBO[who2];
   if (myBO[currentName2]==undefined) {
       currentName2 = 'Attaque';
    }
  currentObj2 = myBO[currentName2];
  if (currentName2 != who2){
    setTabStyle (document.getElementById ('ab'+currentName2), false);
    setTabStyle (document.getElementById ('ab'+who2), true);
    if (currentObj2){
      currentObj2.hide ();
      currentObj2.getContent().style.display = 'none';
    }
    currentName2 = who2;
    Options.currentTab2 = currentName2;
    cont = newObj2.getContent();
    newObj2.getContent().style.display = 'block';
  }
  newObj2.show();
}

function mouseMainTab (me){   // right-click on main button resets window location
  if (me.button == 2){
    var c = getClientCoords (ById('main_engagement_tabs'));
    mainPop.setLocation ({x: c.x+4, y: c.y+c.height});
  }
}

function eventHideShow (){
  if (mainPop.toggleHide(mainPop)){
    tabManager.showTab();
    Options.pbWinIsOpen = true;
  } else {
    tabManager.hideTab();
    Options.pbWinIsOpen = false;
  }
  saveOptions();
}

function hideMe (){
  mainPop.show (false);
  tabManager.hideTab();
  Options.pbWinIsOpen = false;
  saveOptions();
}

function showMe (){
  mainPop.show (true);
  tabManager.showTab();
  Options.pbWinIsOpen = true;
  saveOptions();
}


function mouseMainTab2 (me){
  if (me.button == 2){
    var c = getClientCoords (ById('main_engagement_tabs'));
    mainPop2.setLocation ({x: c.x+4, y: c.y+c.height});
  }
}

function eventHideShow2 (){
  if (mainPop2.toggleHide(mainPop2)){
    if (myBO[currentName2]==undefined) {
         currentName2 = 'Attaque';
    }
    myBO[currentName2].show();
    Options.ptWin2IsOpen = true;
  } else {
   if (myBO[currentName2]==undefined) {
       currentName2 = 'Attaque';
    }
    myBO[currentName2].hide();
    Options.ptWin2IsOpen = false;
  }
  saveOptions();
}

function reloadKOC (){
  var serverId = getServerId();
  if(serverId == '??') window.location.reload(true);
  var addl='';
  if (Options.Langue) {
   addl="&lang="+Options.Langue;
  }
  var goto = window.location.protocol+'//apps.facebook.com/kingdomsofcamelot/?s='+serverId+''+addl;
  if(document.URL.match(/standalone=1/i)){
 	goto = window.location.protocol+'//www.kabam.com/kingdoms-of-camelot/play?s='+serverId+''+addl;
  }
  var t = '<FORM target="_top" action="'+ goto +'" method=post><INPUT id=xxpbButReload type=submit value=RELOAD><INPUT type=hidden name=s value="'+ serverId +'"</form>';
  var e = document.createElement ('div');
  e.innerHTML = t;
  document.body.appendChild (e);
  setTimeout (function (){ById('xxpbButReload').click();}, 0);

}

function getResearchLevels () {
	for (var t=1; t < 17; t++) {
		if (t != 7) {
			researchLevels[t] = {};
			researchLevels[t].Id = t;
			researchLevels[t].Name = unsafeWindow.techcost['tch'+t][0].replace (/&#39;/img, '\'');
			researchLevels[t].Level = parseInt(Seed.tech['tch'+t]);
			researchLevels[t].NextLevelETA = 0;
		}
	}
	var q;
	var now = unixTime();
	for(var i=0; i<Cities.numCities; i++) { // each city
		var cityID = 'city'+ Cities.cities[i].id;
		q = Seed.queue_tch[cityID];
		if (q[0] != undefined)
			researchLevels[parseInt(q[0][0])].NextLevelETA = parseInt(q[0][3]) - now;
	}
}

function getTroopDefTrainEstimates (cityID,cityId){
	var b = Seed.buildings[cityID];
	city.numBarracks = 0;
	city.numHouse = 0;
	city.maxBarracks = 0;
	city.totLevelsBarracks = 0;
	city.blacksmithLevel = 0;
	city.stableLevel = 0;
	city.workshopLevel = 0;
	city.wallLevel = 0;
	for (var j=1; j<33; j++){
		if (b['pos'+j]) {
			var bname = parseIntNan(b['pos'+j][0]);
			var blvl = parseIntNan(b['pos'+j][1]);
			if (bname==5) {
				city.numHouse++;
			}
			if (bname==13) {
				city.numBarracks++;
				city.totLevelsBarracks += parseInt(blvl);
				if (blvl>city.maxBarracks) city.maxBarracks=blvl;
			}
			if (bname==16)
				city.blacksmithLevel = blvl;
			if (bname==15)
				city.workshopLevel = blvl;
			if (bname==17)
				city.stableLevel = blvl;
			if (bname==19)
				city.wallLevel = blvl;
		}
	}

	var now = unixTime();
	city.marshallCombatScore = 0;
	var s = Seed.knights[cityID];
	if (s) {
		s = s["knt" + Seed.leaders[cityID].combatKnightId];
		if (s){
			city.marshallCombatScore = s.combat;
			if (s.combatBoostExpireUnixtime > now)
				city.marshallCombatScore *= 1.25;
		}
	}
	city.foremanBasePoliticsScore = 0;
	var s = Seed.knights[cityID];
	if (s) {
		s = s["knt" + Seed.leaders[cityID].politicsKnightId];
		if (s) {
			city.foremanBasePoliticsScore = s.politics;
	 	     if (s.politicsBoostExpireUnixtime > now)
				city.foremanBasePoliticsScore *= 1.25;
	 }
	}
	city.loggingLevel = parseInt(Seed.tech["tch2"]);
	city.geometryLevel = parseInt(Seed.tech["tch5"]);
	city.eagleEyesLevel = parseInt(Seed.tech["tch6"]);
	city.poisonedEdgeLevel = parseInt(Seed.tech["tch8"]);
	city.metalAlloysLevel = parseInt(Seed.tech["tch9"]);
	city.featherweightPowderLevel = parseInt(Seed.tech["tch10"]);
	city.alloyHorseshoesLevel = parseInt(Seed.tech["tch12"]);
	city.fletchingLevel = parseInt(Seed.tech["tch13"]);
	city.giantsStrengthLevel = parseInt(Seed.tech["tch16"]);
	var bm = city.numBarracks + 0.1 * (city.totLevelsBarracks - city.numBarracks);
	var mf = city.marshallCombatScore/200;
	var gf = city.geometryLevel/10;
	var sf = city.stableLevel/10;
	var wf = city.blacksmithLevel/10;
	var isf = bm * (1+mf+gf);
	var csf = bm * (1+mf+gf+sf);
	var ssf = bm * (1+mf+gf+sf+wf);
	var pf = city.foremanBasePoliticsScore/200;
	var gsf = city.giantsStrengthLevel/10;
	var dsf = 1+pf+gsf;
	var h=EffetTronePrc(77).percent;
	var boost=(1+(h/100));
        if(uW.cm.WorldSettings.isOn("GUARDIAN_MARCH_EFFECT")){
        var SPD={0:0,1:1,2:1,3:2,4:2,5:3,6:3,7:4,8:5,9:7,10:10,11:20};
          var b=0,y=false,v=false,w=0;
          var mm=Seed.guardian;
          for (var ii in mm) {
           var ww = mm[ii];
            if (ww.cityId==cityId) {
            if (ww.type== "stone") y=true;
            if (ww.guardianCount==4) v=true;
            var level=0;
            if (ww.cityGuardianLevels.stone!=undefined) level = ww.cityGuardianLevels.stone;
            w = SPD[level] / 100;
            var bx = 0;
                if (y && v) {
                    bx = 1.5;
                }
                if (y && !v) {
                    bx = 1;
                }
                if (!y && v) {
                    bx = 0.5;
                }
                if (!y && !v) {
                    bx = 0;
                }
                b = w * bx;


                boost=boost*(1+b);
           }

         }
       }
	city.isf = isf;
	city.boost=boost;
	city.Troop1Time = ((city.maxBarracks > 0)?((parseInt(unsafeWindow.unitcost["unt1"][7])/boost)/isf):0);
	city.Troop2Time = ((city.maxBarracks > 0)?((parseInt(unsafeWindow.unitcost["unt2"][7])/boost)/isf):0);
	city.Troop3Time = ((city.maxBarracks > 1 && city.eagleEyesLevel > 0)?((parseInt(unsafeWindow.unitcost["unt3"][7])/boost)/isf):0);
	city.Troop4Time = ((city.maxBarracks > 1 && city.poisonedEdgeLevel > 0)?((parseInt(unsafeWindow.unitcost["unt4"][7])/boost)/isf):0);
	city.Troop5Time = ((city.maxBarracks > 2 && city.workshopLevel > 0 && city.metalAlloysLevel > 0)?((parseInt(unsafeWindow.unitcost["unt5"][7])/boost)/isf):0);
	city.Troop6Time = ((city.maxBarracks > 3 && city.fletchingLevel > 0)?((parseInt(unsafeWindow.unitcost["unt6"][7])/boost)/isf):0);
	city.Troop7Time = ((city.maxBarracks > 4 && city.stableLevel > 0 && city.alloyHorseshoesLevel > 0)?((parseInt(unsafeWindow.unitcost["unt7"][7])/boost)/csf):0);
	city.Troop8Time = ((city.maxBarracks > 6 && city.workshopLevel > 4 && city.stableLevel > 4 && city.alloyHorseshoesLevel > 4)?((parseInt(unsafeWindow.unitcost["unt8"][7])/boost)/csf):0);
	city.Troop9Time = ((city.maxBarracks > 5 && city.stableLevel > 0 && city.blacksmithLevel > 2 && city.featherweightPowderLevel > 0)?((parseInt(unsafeWindow.unitcost["unt9"][7])/boost)/ssf):0);
	city.Troop10Time = ((city.maxBarracks > 7 && city.stableLevel > 1 && city.blacksmithLevel > 4 && city.geometryLevel > 4 && city.fletchingLevel > 5)?((parseInt(unsafeWindow.unitcost["unt10"][7])/boost)/ssf):0);
	city.Troop11Time = ((city.maxBarracks > 8 && city.workshopLevel > 4 && city.stableLevel > 2 && city.blacksmithLevel > 6 && city.metalAlloysLevel > 7 && city.geometryLevel > 6)?((parseInt(unsafeWindow.unitcost["unt11"][7])/boost)/ssf):0);
	city.Troop12Time = ((city.maxBarracks > 9 && city.stableLevel > 1 && city.blacksmithLevel > 8 && city.geometryLevel > 9 && city.fletchingLevel > 9)?((parseInt(unsafeWindow.unitcost["unt12"][7])/boost)/ssf):0);
	city.Def53Time = ((city.wallLevel > 5 && city.blacksmithLevel > 5 && city.fletchingLevel > 4)?(180/dsf):0);
	city.Def55Time = ((city.wallLevel > 7 && city.blacksmithLevel > 7 && city.fletchingLevel > 6 && city.geometryLevel > 6)?(135/dsf):0);
	city.Def60Time = ((city.wallLevel > 3 && city.blacksmithLevel > 3 && city.poisonedEdgeLevel > 1)?(90/dsf):0);
	city.Def61Time = ((city.wallLevel > 0 && city.metalAlloysLevel > 0)?(30/dsf):0);
	city.Def62Time = ((city.wallLevel > 1 && city.blacksmithLevel > 1 && city.loggingLevel > 1)?(60/dsf):0);
}

function EffetTronePrc(effet) {
  var k=Seed.throne.slotEquip[Seed.throne.activeSlot],i=Seed.throne.inventory,e,faction;
  var B=0, w={}, x, C;
  for (var K in k) {
 	     var F = uW.kocThroneItems[k[K]];
 	     if (F) {
 	               x=0;
 	               for (var M in F.effects) {
 	               x++;
 	               if (F.quality >= x) {
 	                B++;
 	                I = uW.cm.thronestats.effects[F.effects[M].id];
 	                z = uW.cm.thronestats.tiers[F.effects[M].id][F.effects[M].tier];
 	                C = + z.base + (F.level * F.level + F.level) * + z.growth * 0.5;
 	                //C = C;
 	                if (!F.isBroken) {
 	                   if (!w[F.effects[M].id]) {
 	                     w[F.effects[M].id] = {};
 	                     w[F.effects[M].id].nameitem="";
 	                   }
 	                   if (!w[F.effects[M].id].percent) {
 	                     w[F.effects[M].id].percent = C;
 	                   } else {
 	                    w[F.effects[M].id].percent += C;
 	                   }
 	                   w[F.effects[M].id].name = I[1];
 	                }
 	               }
 	               }
 	               }
           }
           if (!w[effet]) {

            w[effet]={};
            w[effet].percent=0;

           }
           // bride le load Ã  500
           if (w[6])
            if (w[6].percent>500)
              w[6].percent=500;
  return w[effet];
}

function officerId2String (oid){
  if (oid==null)
    return '';
  else if (oid==3)
    return unsafeWindow.allianceOfficerTypeMapping[3];
  else if (oid==2)
    return unsafeWindow.allianceOfficerTypeMapping[2];
  else if (oid==1)
    return unsafeWindow.allianceOfficerTypeMapping[1];
  else if (oid==4)
      return unsafeWindow.allianceOfficerTypeMapping[4];
 return '';
}
function setCities(){
	var il = unsafeWindow.itemlist;
	for (var i=1101; i < 1115; i++)
		crestname[i] = il['i'+i].name
  getResearchLevels();
  Cities.numCities = Seed.cities.length;
  Cities.cities = [];
  Cities.byID = {};
  for (i=0; i<Cities.numCities; i++){
    city = {};
    city.idx = i;city.num = i;
    city.id = parseInt(Seed.cities[i][0]);
    city.name = Seed.cities[i][1];
    city.x = parseInt(Seed.cities[i][2]);
    city.y = parseInt(Seed.cities[i][3]);
    city.tileId = parseInt(Seed.cities[i][5]);
    city.provId = parseInt(Seed.cities[i][4]);
    getTroopDefTrainEstimates('city'+ city.id, city.id);
    Cities.cities[i] = city;
    Cities.byID[Seed.cities[i][0]] = city;
  }
}



/************************ Gold Collector ************************/
var CollectGold = {
  timer : null,
  lastCollect : {},

  init : function (){
    var t = CollectGold;
    for (var c=0; c<Cities.numCities; c++)
      t.lastCollect['c'+ Cities.cities[c].id] = 0;
    if (Options.pbGoldEnable)
      t.setEnable (true);
  },

  setEnable : function (tf){
    var t = CollectGold;
    clearTimeout (t.timer);
    if (tf)
      t.tick();
  },

  colCityName : null,
  colHappy : 0,
  tick : function (){
    var t = CollectGold;
    for (var c=0; c<Cities.numCities; c++){
      var city = Cities.cities[c];
      var happy = Seed.citystats['city'+ city.id].pop[2];
      var since = unixTime() - t.lastCollect['c'+city.id];
      if (happy>=Options.pbGoldHappy && since>15*60){
        t.lastCollect['c'+city.id] = unixTime();
        t.colCityName = city.name;
        t.colHappy = happy;
        t.ajaxCollectGold (city, t.e_ajaxDone);
        break;
      }
    }
    t.timer = setTimeout (t.tick, 60000);
  },

  e_ajaxDone : function (rslt){
    var t = CollectGold;
  },

  ajaxCollectGold : function (city, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = city.id;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/levyGold.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (notify)
          notify (rslt);
      },
      onFailure: function (rslt) {
        if (notify)
          notify (rslt);
      }
    });
  },
}


var gmtClock = {
  span : null,
  timer : null,

  init : function (){
     var t = gmtClock;

    t.setEnable (Options.gmtClock);
  },

  setEnable : function (tf){
    var t = gmtClock;
    clearInterval (t.timer);
    if (Options.gmtClock){
      t.timer = setInterval (t.everySecond, 2000);
          t.span = document.createElement ('span');
          t.span.style.fontWeight = 'bold';
          ById('kochead_time').style.display='none';
          ById('kochead_time').parentNode.appendChild (t.span);
    } else {
      if (t.span!=null) t.span.innerHTML = '';
      ById('kochead_time').style.display='';

    }
  },
  everySecond : function (){
    var t = gmtClock;
    var now = new Date();
    now.setTime(now.getTime() + (now.getTimezoneOffset()*60000));
    t.span.innerHTML = ' '+ now.toLocaleFormat('%H:%M:%S') +'';
  },
}

/************************ Refresh Every X minutes ************************/
var RefreshEvery  = {
  timer : null,
  PaintTimer : null,
  NextRefresh : 0,
  box : null,
  target : null,

  init : function (){
    var t = RefreshEvery;
	t.creatediv();
	if (Options.pbEveryMins < 1)
        Options.pbEveryMins = 1;
    RefreshEvery.setEnable (Options.pbEveryEnable);
  },

  creatediv : function(){
    var t = RefreshEvery;
	t.target = ById('comm_tabs');
	if(t.target == null){
		setTimeout(t.creatediv, 2000);
		return;
	}
	t.box = document.createElement('div');
	t.target.appendChild(t.box);
  },

  setEnable : function (tf){
    var t = RefreshEvery;
    clearTimeout (t.timer);
    if (tf) {
      t.NextRefresh = unixTime() + (Options.pbEveryMins*60);
      t.timer = setTimeout (t.Paint, 5000);
    } else {
		t.timer = null;
		t.NextRefresh = 0;
		//t.box.innerHTML = '<BR><FONT color=white><B>&nbsp;&nbsp;&nbsp;&nbsp;'+ getMyAlliance()[1] + ' (' + getServerId() +')</b></font>';
		t.box.innerHTML = '<div style="float:left;margin :2px;color:#141516;text-shadow: 1px 1px 1px #AAA;font-variant:small-caps;font-weight:bold;">&nbsp;&nbsp;&nbsp;&nbsp;'+ getMyAlliance()[1] + ' <span class="boldRed">(</span>' + getServerId() +'<span class="boldRed">)</span></div>';

	}
  },

  doit : function (){
    reloadKOC();
  },

  setTimer : function (){
    var t = RefreshEvery;
    clearTimeout (t.timer);
    if (Options.pbEveryMins < 1) Options.pbEveryMins = 1;
    RefreshEvery.setEnable (Options.pbEveryEnable);
  },

  Paint : function(){
     var t = RefreshEvery;
	 if(t.timer == null) return;
     now = unixTime();
     var text = '';
     var Left = parseInt(t.NextRefresh - now);
     if ( Left < 0){
		Left = 0;
		t.doit();
	 }
    if ( Left < 60) text += '<div style="float:left;margin :2px;color:#141516;text-shadow: 1px 1px 1px #AAA;font-variant:small-caps;font-weight:bold;">&nbsp;&nbsp;&nbsp;&nbsp;'+ getMyAlliance()[1].substr(0,12) + ' (<span class="boldRed">' + getServerId() +'</span>) - <span id=BOTaref>'+lang.General.now+'</span> '+lang.General.dans+' <FONT color=red><span id=BOTaTim>'+ timestr(Left) +'</span></font></div> </div>';
	else text += '<div style="float:left;margin :2px;color:#141516;text-shadow: 1px 1px 1px #AAA;font-variant:small-caps;font-weight:bold;">&nbsp;&nbsp;&nbsp;&nbsp;'+ getMyAlliance()[1].substr(0,12) + ' (<span class="boldRed">' + getServerId() +'</span>) - <span id=BOTaref>'+lang.General.now+'</span> '+lang.General.dans+' <span id=BOTaTim>'+ timestr(Left) +'</span></div> </div>';
     t.box.innerHTML = text;
     ById('BOTaref').addEventListener ('click', t.doit, false);
     ById('BOTaTim').addEventListener ('click', function() { t.setEnable(true); }, false);
     t.timer = setTimeout (t.Paint, 5000);
  },
}

var FairieKiller  = {
  saveFunc : null,
  init : function (tf){
    FairieKiller.saveFunc = unsafeWindow.Modal.showModalUEP;
    FairieKiller.setEnable (tf);
  },
  setEnable : function (tf){
    if (tf)
      unsafeWindow.Modal.showModalUEP = eval ('function FairieKiller (a,b,c) {logit("Blocked Faire popup");}');
    else
      unsafeWindow.Modal.showModalUEP = FairieKiller.saveFunc;
  },
}


function KOCnotFound(secs){
  var div;
  var countdownTimer = null;
  var endSecs = (new Date().getTime()/1000) + secs;
  div = document.createElement('div');
  div.innerHTML = '<DIV style="font-size:18px; background-color:#a00; color:#fff"><CENTER><BR>'+lang.General.kocnotfound+'<BR>\
      Actualisation dans <SPAN id=pbwdsecs></span><BR><INPUT id=pbwdcan type=submit value="'+lang.General.cancelact+'"><BR><BR></div>';
  document.body.insertBefore (div, document.body.firstChild);
  ById('pbwdcan').addEventListener('click', cancel, false);
  countdown();
  function countdown (){
    var secsLeft = endSecs - (new Date().getTime()/1000);
    ById('pbwdsecs').innerHTML = timestr(secsLeft);
    if (secsLeft < 0)
      reloadKOC();
    countdownTimer = setTimeout (countdown, 1000);
  }
  function cancel (){
    clearTimeout (countdownTimer);
    document.body.removeChild (div);
  }
}

var WideScreen = {
  chatIsRight : false,
  useWideMap : false,
  rail : null,

  init : function (){
    t = WideScreen;
    if (GlobalOptions.pbWideScreen){
      t.rail = searchDOM (ById('mod_maparea'), 'node.className=="maparea_rrail"', 10);
      GM_addStyle ('.modalCurtain {width:760px !important} .mod_comm_mmb{z-index:0 !important}');
      try {
        ById('progressBar').parentNode.removeChild(ById('progressBar'));
        ById('crossPromoBarContainer').parentNode.removeChild(ById('crossPromoBarContainer'));
      } catch (e) {
      }
    }
  },

  setChatOnRight : function (tf){
    t = WideScreen;
    if (tf == t.chatIsRight || !GlobalOptions.pbWideScreen)
      return;
    if (tf){
      var chat = ById('kocmain_bottom').childNodes[1];
      if (!chat || chat.className!='mod_comm')
        setTimeout (function (){t.setChatOnRight(tf)}, 1000);
      chat.style.top = '-570px';
      chat.style.left = '760px';
      chat.style.height = '720px';
      chat.style.background = 'url("'+ CHAT_BG_IMAGE +'")';
      ById('mod_comm_list1').style.height = '580px';
      ById('mod_comm_list2').style.height = '580px';
    } else {
      var chat = ById('kocmain_bottom').childNodes[1];
      chat.style.top = '0px';
      chat.style.left = '0px';
      chat.style.height = '';
      chat.style.background = '';
      ById('mod_comm_list1').style.height = '287px';
      ById('mod_comm_list2').style.height = '287px';
    }
    t.chatIsRight = tf;
  },

  useWideMap : function (tf) {
  	t = WideScreen;
  	if (tf == t.useWideMap || !GlobalOptions.pbWideScreen)
  		return;
  	if (tf){
      t.rail.style.display = 'none';
      ById('mapwindow').style.height = "436px";
      ById('mapwindow').style.width = "1220px";
      ById('mapwindow').style.zIndex = "50";
  	} else {
      t.rail.style.display = 'block';
      ById('mapwindow').style.height = "439px";
      ById('mapwindow').style.width = "760px";
      ById('mapwindow').style.zIndex = "";
  	}
  },
}

function DoUnsafeWindow(func, execute_by_embed) {
	if(this.isChrome || execute_by_embed) {
		var scr=document.createElement('script');
		scr.innerHTML=func;
		document.body.appendChild(scr);
	} else {
		try {
			eval("unsafeWindow."+func);
		} catch (error) {
			logit("A javascript error has occurred when executing a function via DoUnsafeWindow. Error description: "+error.description);
		}
	}
}
function GetDisplayName(){
	var DisplayName = ById('topnavDisplayName');
	if(DisplayName){
		DisplayName = DisplayName.innerHTML;
	}else{
		DisplayName = null;
	}
	return DisplayName;
}
var ChatPane = {
  timer:null,

  init : function(){
    var t = ChatPane;
    if(Options.HelpRequest || Options.ChatRules || Options.DeleteRequest){
     t.timer=setInterval(t.HandleChatPane, 2500);
    }
  },

  HandleChatPane : function() {
	var DisplayName = GetDisplayName();

	var AllianceChatBox=ById('mod_comm_list2');

	if(AllianceChatBox){
		var chatPosts = document.evaluate(".//div[contains(@class,'chatwrap')]", AllianceChatBox, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );

		if(chatPosts){
			for (var i = 0; i < chatPosts.snapshotLength; i++) {
				thisPost = chatPosts.snapshotItem(i);
				if(Options.HelpRequest){

					var postAuthor = document.evaluate('.//*[contains(@class,"nm")]', thisPost, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );
					if(postAuthor.snapshotItem(0)){
						var postAuthorName = postAuthor.snapshotItem(0).innerHTML;

						if(postAuthorName != DisplayName){

							var helpAllianceLinks=document.evaluate(".//a[contains(@onclick,'claimAllianceChatHelp')]", thisPost, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );
							if(helpAllianceLinks){
								for (var j = 0; j < helpAllianceLinks.snapshotLength; j++) {
									thisLink = helpAllianceLinks.snapshotItem(j);
									var alreadyClicked = thisLink.getAttribute("clicked");
									if(!alreadyClicked){
										thisLink.setAttribute('clicked', 'true');
										var myregexp = /(claimAllianceChatHelp\(.*\);)/;
										var match = myregexp.exec(thisLink.getAttribute("onclick"));

										if (match != null) {
											onclickCode = match[0];
											if(true){
												DoUnsafeWindow(onclickCode);
											}
										}
									}
								}
							}
						}
					}
				}
				if(Options.ChatRules){
				 var myregexp1 = /gles du Chat/i;
				 var myregexp2 = /Chat Rules/i;
				 if (thisPost.innerHTML.match(myregexp1) || thisPost.innerHTML.match(myregexp2)) {
				   thisPost.parentNode.removeChild(thisPost);
				 }
				}
				if(Options.DeleteRequest){
					var helpAllianceLinks=document.evaluate(".//a[contains(@onclick,'claimAllianceChatHelp')]", thisPost, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );
					if(helpAllianceLinks){
						for (var j = 0; j < helpAllianceLinks.snapshotLength; j++) {
							thisLink = helpAllianceLinks.snapshotItem(j);
							thisLink.parentNode.parentNode.parentNode.parentNode.parentNode.removeChild(thisLink.parentNode.parentNode.parentNode.parentNode);
						}
					}
					var myregexp1 = /Tu es(.*?)#/i;
					var myregexp2 = /Le projet de /i;
					var myregexp3 = /n\'a pas besoin d\'aide./i;
					var myregexp4 = /le maximum d\'aide/i;
					var myregexp5 = /ce projet avec/i;
					if (thisPost.innerHTML.match(myregexp1) || thisPost.innerHTML.match(myregexp2) || thisPost.innerHTML.match(myregexp3) || thisPost.innerHTML.match(myregexp4) || thisPost.innerHTML.match(myregexp5)) {
						thisPost.parentNode.removeChild(thisPost);
					}
					var myregexp1 = /You are #/i;
					var myregexp2 = /\'s Kingdom does not need help\./i;
					var myregexp3 = /\'s project has already been completed\./i;
					var myregexp4 = /\'s project has received the maximum amount of help\./i;
					var myregexp5 = /You already helped with (.*?)\'s project\./i;
					if (thisPost.innerHTML.match(myregexp1) || thisPost.innerHTML.match(myregexp2) || thisPost.innerHTML.match(myregexp3) || thisPost.innerHTML.match(myregexp4) || thisPost.innerHTML.match(myregexp5)) {
						thisPost.parentNode.removeChild(thisPost);
					}
				}
			}
		}
	}
  },

}

String.prototype.StripQuotes = function() {
	return this.replace(/"/g,'');
}

function entier_1dec (nombre){
	if (parseInt(nombre*10)!=0){
		return parseInt(nombre*10)/10;
	} else {
	return nombre;
	}
}

function DrawLevelIcons() {
	var maptileRe = /modal_maptile.([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+)/;
	var mapwindow=ById('mapwindow');
	if(!mapwindow) return;
	var levelIcons=ById('LevelIcons');
	if(levelIcons) return;

	var ss=document.evaluate(".//a[contains(@class,'slot')]",mapwindow,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);
	var lvRe=/_([0-9]+)/;
	var idDone=false;
	for(var s=0; s<ss.snapshotLength; s++) {
		var a=ss.snapshotItem(s);
		var onclick=a.getAttribute('onclick');
		var owner='';
				if(onclick) {
					var onclickM=maptileRe.exec(onclick);
					if(onclickM && onclickM[7]!='"null"') {
						var might=onclickM[8].StripQuotes();
						var alliance=onclickM[16].StripQuotes();
						var dip=getDiplomacy(alliance);
						owner=" "+onclickM[7].StripQuotes();
					}
				}
				var m=lvRe.exec(a.className);
				if(!m) continue;
				var sp=a.getElementsByTagName('span');
				if(sp.length==0) continue;

				if(!idDone) { a.id='levelIcons'; idDone=true; }
				sp[0].style.color='#cc0';

				if (alliance == 'null' && onclickM[13]=='"city"') sp[0].style.color='#33CCFF';
				if (dip == 'hostile' && onclickM[13]=='"city"') sp[0].style.color='#FF0000';
				if (onclickM[13]!='"city"' &&  onclickM[7]!='"null"') sp[0].style.color='#FF9900';
				if (onclickM[13]!='"city"' &&  onclickM[6]=='"null"' && onclickM[7]=='"null"' && onclickM[8]=='"null"' && onclickM[9]=='"null"' && onclickM[16]=='"null"' && onclickM[11]=='"null"') sp[0].style.color='#CC0033';
				if (onclickM && onclickM[6]!='"null"' ) sp[0].innerHTML='&nbsp;'+m[1]+owner+'<br />'+lang.map.might+''+addCommas(might);
					else sp[0].innerHTML='&nbsp;'+m[1]+addCommas(owner);

	}

}
function CdispCityPicker (id, span, dispName, notify, selbut){
  function CcityButHandler (t){
    var that = t;
    this.clickedCityBut = clickedCityBut;
    function clickedCityBut (e){
      if (that.selected != null)
        that.selected.className = "castleBut castleButNon";
      that.city = Cities.cities[e.target.id.substr(that.prefixLen)];
      if (that.dispName)
        ById(that.id+'cname').innerHTML = that.city.name;
      e.target.className = "castleBut castleButSel";
      that.selected = e.target;
      if (that.coordBoxX){
        that.coordBoxX.value = that.city.x;
        that.coordBoxY.value = that.city.y;
        that.coordBoxX.style.backgroundColor = '#ffffff';
        that.coordBoxY.style.backgroundColor = '#ffffff';
      }
      if (that.notify != null)
        that.notify(that.city, that.city.x, that.city.y);
    }
  }

  function selectBut (idx){
    ById(this.id+'_'+idx).click();
  }

  function bindToXYboxes (eX, eY){
    function CboxHandler (t){
      var that = t;
      this.eventChange = eventChange;
      if (that.city){
        eX.value = that.city.x;
        eY.value = that.city.y;
      }
      function eventChange (){
			var xValue=that.coordBoxX.value.trim();
			var xI=/^\s*([0-9]+)[\s,]+([0-9]+)/.exec(xValue);
			if(xI) {
				that.coordBoxX.value=xI[1]
				that.coordBoxY.value=xI[2]
			}
        var x = parseInt(that.coordBoxX.value, 10);
        var y = parseInt(that.coordBoxY.value, 10);
        if (isNaN(x) || x<0 || x>750){
          that.coordBoxX.style.backgroundColor = '#ff8888';
          return;
        }
        if (isNaN(y) || y<0 || y>750){
          that.coordBoxY.style.backgroundColor = '#ff8888';
          return;
        }
        that.coordBoxX.style.backgroundColor = '#ffffff';
        that.coordBoxY.style.backgroundColor = '#ffffff';
        if (that.notify != null)
          that.notify (null, x, y);
      }
    }
    this.coordBoxX = eX;
    this.coordBoxY = eY;
    var bh = new CboxHandler(this);
    eX.size=2;
    eX.maxLength=10;
    eY.size=2;
    eY.maxLength=3;
    eX.addEventListener('change', bh.eventChange, false);
    eY.addEventListener('change', bh.eventChange, false);
  }

  this.selectBut = selectBut;
  this.bindToXYboxes = bindToXYboxes;
  this.coordBoxX = null;
  this.coordBoxY = null;
  this.id = id;
  this.dispName = dispName;
  this.prefixLen = id.length+1;
  this.notify = notify;
  this.selected = null;
  this.city = null;
  var m = '';
  for (var i=0; i<Cities.cities.length; i++)
    m += '<INPUT class="castleBut castleButNon" id="'+ id +'_'+ i +'" value="'+ (i+1) +'" type=submit \>';
  if (dispName)
    m += ' &nbsp; <SPAN style="display:inline-block; width:85px; font-weight:bold;" id='+ id +'cname' +'></span>';
  span.innerHTML = m;
  var handler = new CcityButHandler(this);
  for (var i=0; i<Cities.cities.length; i++)
    document.getElementById (id+'_'+i).addEventListener('click', handler.clickedCityBut, false);
  if (selbut != null)
    this.selectBut(selbut);
}

var pop = null;

function dialogRetry (errMsg, seconds, onRetry, onCancel, errCode){
  seconds = parseInt(seconds);
  if (pop == null) {
   pop = new CPopup ('BOptretry', 0, 0, 400,300, true);

     pop.getTopDiv().innerHTML = '<CENTER><b>Boite &agrave; outils</b></center>';
     pop.getMainDiv().innerHTML = '<CENTER><BR><FONT COLOR=#550000><B>'+lang.General.dialogRetry+'</b></font><BR><BR><DIV id=BOparetryErrMsg></div>\
         <BR><BR><B>'+lang.General.Retry+'<SPAN id=BOparetrySeconds></b></span> '+lang.General.secs+' ...<BR><INPUT id=BOparetryCancel type=submit value="'+uW.g_js_strings.commonstr.cancel+'" \>';
     ById('BOparetryCancel').addEventListener ('click', doCancel, false);

  }
  pop.show(true);
  pop.centerMe(mainPop.getMainDiv());
  if(errCode && unsafeWindow.g_js_strings.errorcode['err_'+errCode])
		if (ById('BOparetryErrMsg')) ById('BOparetryErrMsg').innerHTML = unsafeWindow.g_js_strings.errorcode['err_'+errCode];
   else
	document.getElementById('BOparetryErrMsg').innerHTML = errMsg;
  if (document.getElementById('BOparetrySeconds')) document.getElementById('BOparetrySeconds').innerHTML = seconds;
  var rTimer = setTimeout (doRetry, seconds*1000);
  countdown ();

  function countdown (){
     if (document.getElementById('BOparetrySeconds')) ById('BOparetrySeconds').innerHTML = seconds--;
    if (seconds > 0)
      cdTimer = setTimeout (countdown, 1000);
  }
  function doCancel(){
    clearTimeout (rTimer);
    clearTimeout (cdTimer);
    pop.destroy();
    onCancel ();
  }
  function doRetry (){
    clearTimeout (rTimer);
    clearTimeout (cdTimer);
    pop.show(false);
    onRetry();
  }
}

function GM_AjaxGet (url, args, notify, label){
  GM_xmlhttpRequest({
    method: "get",
    url: addUrlArgs(url, args),
    onload: function (rslt) {
      notify (rslt.responseText);
    },
    onerror: function () {
      notify (null);
    },
  });
}

function GM_AjaxPost (url, args, notify, label){
  GM_xmlhttpRequest({
    method: "post",
    url: url,
    data: implodeUrlArgs(args),
    headers: { "Content-Type": "application/x-www-form-urlencoded", 'X-Requested-With': 'XMLHttpRequest', 'X-Prototype-Version': '1.6.1',
               'Accept': 'text/javascript, text/html, application/xml, text/xml, */*' },
    onload: function (rslt) {
      notify (rslt.responseText);
    },
    onerror: function () {
      notify (null);
    },
  });
}
function AjaxRequest (url, opts){
  var headers = {
    'X-Requested-With': 'XMLHttpRequest',
    'X-Prototype-Version': '1.6.1',
    'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
  };
  var ajax = null;

  if (window.XMLHttpRequest)
    ajax=new XMLHttpRequest();
  else
    ajax=new ActiveXObject("Microsoft.XMLHTTP");

  if (opts.method==null || opts.method=='')
    method = 'GET';
  else
    method = opts.method.toUpperCase();

  if (method == 'POST'){
    headers['Content-type'] = 'application/x-www-form-urlencoded; charset=UTF-8';
  } else if (method == 'GET'){
    addUrlArgs (url, opts.parameters);
  }

  ajax.onreadystatechange = function(){
    if (ajax.readyState==4) {
      if (ajax.status >= 200 && ajax.status < 305)
        if (opts.onSuccess) opts.onSuccess(ajax);
      else
        if (opts.onFailure) opts.onFailure(ajax);
    } else {
      if (opts.onChange) opts.onChange (ajax);
    }
  }
  ajax.open(method, url, true);
  for (var k in headers)
    ajax.setRequestHeader (k, headers[k]);
  if (matTypeof(opts.requestHeaders)=='object')
    for (var k in opts.requestHeaders)
      ajax.setRequestHeader (k, opts.requestHeaders[k]);

  if (method == 'POST'){
    var a = [];
    for (k in opts.parameters){
	  if(matTypeof(opts.parameters[k]) == 'object')
		for(var h in opts.parameters[k])
			a.push (k+'['+h+'] ='+ opts.parameters[k][h] );
	  else
        a.push (k +'='+ opts.parameters[k] );
	}
    ajax.send (a.join ('&'));
  } else               {
    ajax.send();
  }
}
function getOffset( el ) {
    var _x = 0;
    var _y = 0;
    while( el && !isNaN( el.offsetLeft ) && !isNaN( el.offsetTop ) ) {
        _x += el.offsetLeft - el.scrollLeft;
        _y += el.offsetTop - el.scrollTop;
        el = el.offsetParent;
    }
    return { top: _y, left: _x };
}

function implodeUrlArgs (obj){
  var a = [];
  for (var k in obj)
    a.push (k +'='+ encodeURI(obj[k]) );
  return a.join ('&');
}
function addUrlArgs (url, args){
  if (!args)
    return url;
  if (url.indexOf('?') < 0)
    url += '?';
  else if (url.substr(url.length-1) != '&')
    url += '&';
  if (matTypeof(args == 'object'))
    return url + implodeUrlArgs (args);
  return url + args;
}
function AjaxRequest2 (url, opts){
    var headers = {
        'X-Requested-With': 'XMLHttpRequest',
        'X-Prototype-Version': '1.6.1',
        'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
    };
    var ajax = null;
    if (window.XMLHttpRequest)
      ajax=new XMLHttpRequest();
    else
      ajax=new ActiveXObject("Microsoft.XMLHTTP");
    if (opts.method==null || opts.method=='')
      method = 'GET';
    else
      method = opts.method.toUpperCase();
    if (method == 'POST'){
        headers['Content-type'] = 'application/x-www-form-urlencoded; charset=UTF-8';
    } else if (method == 'GET'){
        addUrlArgs (url, opts.parameters);
    }
    ajax.onreadystatechange = function(){
        if (ajax.readyState==4) {
            if (ajax.status >= 200 && ajax.status < 305)
            if (opts.onSuccess) opts.onSuccess(ajax);
            else
                if (opts.onFailure) opts.onFailure(ajax);
            } else {
                if (opts.onChange) opts.onChange (ajax);
            }
    }
    ajax.open(method, url, true);
    for (var k in headers)
      ajax.setRequestHeader (k, headers[k]);
     if (matTypeof(opts.requestHeaders)=='object')
          for (var k in opts.requestHeaders)
            ajax.setRequestHeader (k, opts.requestHeaders[k]);
    if (method == 'POST'){
        var a = [];
        for (k in opts.parameters){
              if(matTypeof(opts.parameters[k]) == 'object'){
                  for(var h in opts.parameters[k]){
                      if(matTypeof(opts.parameters[k][h]) == 'object'){
                          for(var i in opts.parameters[k][h]){
                              if(matTypeof(opts.parameters[k][h][i]) == 'object'){
                              for(var j in opts.parameters[k][h][i]){
                                  a.push (k+'['+h+']['+i+']['+j+'] ='+ opts.parameters[k][h][i][j] );
                              }
                              } else
                              	a.push (k+'['+h+']['+i+']'+' ='+ opts.parameters[k][h][i]);
                          }
                      } else
                      a.push (k+'['+h+'] ='+ opts.parameters[k][h] );
                  }
              } else
              a.push (k +'='+ opts.parameters[k] );
        }
        ajax.send (a.join ('&'));
    } else {
        ajax.send();
    }
}
function MyAjaxRequest (url, o, noRetryX){
  //logit (" 0 myAjaxRequest: "+ url +"\n" + inspect (o, 2, 1));
  var opts = unsafeWindow.Object.clone(o);
  var wasSuccess = o.onSuccess;
  var wasFailure = o.onFailure;
  var retry = 0;
  var delay = 3;
  var show=true;
  var silentTimer;
  var noRetry = noRetry===true?true:false;
  opts.onSuccess = mySuccess;
  opts.onFailure = myFailure;
  new AjaxRequest(url, opts);
  return;

  function myRetry(){
    ++retry;
    if (retry>5) {
       actionLog(lang.General.error, "<font color=res>"+lang.General.myRetry+"</font>");
       return false;
       }
    new AjaxRequest(url, opts);

    delay = delay * 1.25;
  }
  function myFailure(){
    var o = {};
    o.ok = false;
    o.errorMsg = "AJAX Communication Failure";
    wasFailure (o);
  }
  function mySuccess (msg){
    var rslt;
   try {
    rslt = JSON2.parse(msg.responseText);
   } catch(e) {

    if (retry<2) {
      rslt = {"ok":false,"error_code":9,"errorMsg":"Failed due to invalid json"}
    } else {
      rslt = {"ok":true,"error_code":9,"data":[]};
    }

    }
    var x;
    if (window.EmulateAjaxError){
      rslt.ok = false;
      rslt.error_code=8;
    }
    if (rslt.ok){
      if (rslt.updateSeed)
        unsafeWindow.update_seed(rslt.updateSeed);
      wasSuccess (rslt);
      return;
    }

    rslt.errorMsg = unsafeWindow.printLocalError((rslt.error_code || null), (rslt.msg || null), (rslt.feedback || null));

    if (!noRetry && (rslt.error_code==0 ||rslt.error_code==8 || rslt.error_code==1 || rslt.error_code==3)){
      actionLog(lang.General.error, "<font color=res>"+ msg.responseText +"</font>");
      dialogRetry (inspect(rslt.errorMsg), delay, function(){myRetry()}, function(){wasSuccess (rslt)}, rslt.error_code);
    } else if (!noRetry && rslt.error_code==9) {
      silentTimer = setTimeout(silentRetry, delay*100);
    } else {
      wasSuccess (rslt);
    }
  }
  function silentRetry() {
   	    clearTimeout(silentTimer);
   	    myRetry();
   }
}

function getDiplomacy (aid) {
  if (Seed.allianceDiplomacies == null)
    return 'neutre';
  if (Seed.allianceDiplomacies.friendly && Seed.allianceDiplomacies.friendly['a'+aid] != null)
    return 'amicale';
  if (Seed.allianceDiplomacies.hostile && Seed.allianceDiplomacies.hostile['a'+aid] != null)
    return 'hostile';
  if (aid == Seed.allianceDiplomacies.allianceId)
    return 'allie';
  return 'neutre';
};

function getMyUserId (){return parseInt([Seed.tutorial.userId]);}
function getMyAlliance (){
  if (Seed.allianceDiplomacies==null || Seed.allianceDiplomacies.allianceName==null)
    return [0, 'None'];
  else
    return [Seed.allianceDiplomacies.allianceId, Seed.allianceDiplomacies.allianceName];
}
function UniteKMG(nb) {
          if (Math.abs(nb)>1000000000)
    	    val="<span title='"+addCommas(nb)+"'>" + (nb/1000000000).toFixed(2) +" G</span>";
    	  else if (Math.abs(nb)>1000000)
    	   val="<span title='"+addCommas(nb)+"'>" + (nb/1000000).toFixed(2) +" M</span>";
     	  else if (nb==0)
    	   val="0";
    	  else
	   val=addCommas(nb);

     return val;
}

function getMarchInfoBOT(cityID){
  var ret = {};
  ret.marchUnits = [];
  ret.returnUnits = [];
  ret.resources = [];
  for (i=0; i<13; i++){
    ret.marchUnits[i] = 0;
    ret.returnUnits[i] = 0;
  }
  for (i=0; i<6; i++){
    ret.resources[i] = 0;
  }

  for (k in Seed.queue_atkp[cityID]){
      march = Seed.queue_atkp[cityID][k];
	  if(march.marchType != 5){
		  if (typeof (march) == 'object'){
			for (ii=0; ii<13; ii++){
			  ret.marchUnits[ii] += parseInt (march['unit'+ ii +'Count']);
			  ret.returnUnits[ii] += parseInt (march['unit'+ ii +'Return']);
			}
			for (ii=1; ii<5; ii++){
			  ret.resources[ii] += parseInt (march['resource'+ ii]);
			}
			  ret.resources[0] += parseInt (march['gold']);
		  }
	  }
    }
  return ret;
}

function getMarchInfo (){
  var ret = {};
  ret.marchUnits = [];
  ret.returnUnits = [];
  ret.resources = [];
  for (i=0; i<13; i++){
    ret.marchUnits[i] = 0;
    ret.returnUnits[i] = 0;
  }
  for (i=0; i<6; i++){
    ret.resources[i] = 0;
  }
  var now = unixTime();
  for(i=0; i<Cities.numCities; i++) {   // each city
    cityID = 'city'+ Cities.cities[i].id;
    for (k in Seed.queue_atkp[cityID]){   // each march
      march = Seed.queue_atkp[cityID][k];
      if (typeof (march) == 'object'){
        for (ii=0; ii<13; ii++){
          ret.marchUnits[ii] += parseInt (march['unit'+ ii +'Count']);
          ret.returnUnits[ii] += parseInt (march['unit'+ ii +'Return']);
        }
        for (ii=1; ii<5; ii++){
          ret.resources[ii] += parseInt (march['resource'+ ii]);
        }
         ret.resources[0] += parseInt (march['gold']);
      }
    }
  }
  return ret;
}
var fortNamesShort = { 53: "Arbaletes",  55: "Trebuchet",  60: "Pieges",  61: "Chausse-trape",  62: "Palissade",}

function getCityBuilding (cityId, buildingId){
  var b = Seed.buildings['city'+cityId];
  var ret = {count:0, maxLevel:0,pos:0,id:0};
  for (var i=1; i<33; i++){
    if (b['pos'+i] && b['pos'+i][0] == buildingId){
      ++ret.count;
      ret.pos=parseInt(b['pos'+i][2]);
      ret.id=parseInt(b['pos'+i][3]);
      ret.cityId=cityId;
      if (parseInt(b['pos'+i][1]) > ret.maxLevel)
        ret.maxLevel = parseInt(b['pos'+i][1]);
    }
  }
  return ret;
}
function logit (msg){
  var serverID = getServerId();
  var now = new Date();
  GM_log (serverID +' @ '+ now.toTimeString().substring (0,8) +'.' + now.getMilliseconds() +': '+  msg);
}

function saveCrestData (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('CrestData_' + Seed.player['name'] + '_' +serverID, JSON2.stringify(CrestData));}, 0);
}
function readCrestData (){
  var serverID = getServerId();
  s = GM_getValue ('CrestData_' + Seed.player['name'] + '_' +serverID);
  if (s != null) {
    opts = JSON2.parse (s);
	for (var i = 0; i < opts.length; i++) {
		CrestData[i] = new CrestFunc(opts[i]);
	}
  }
}

function saveUpgradeData (){
    var serverID = getServerId();
    setTimeout (function (){GM_setValue ('UpgradeDataMM2_'+serverID, JSON2.stringify(upgradeData));}, 0);
}

function saveSalvageData (){
    var serverID = getServerId();
    setTimeout (function (){GM_setValue ('SalvageDataMM2_'+serverID, JSON2.stringify(salvageData));}, 0);
}
function readUpgradeData (){
    var serverID = getServerId();
    s = GM_getValue ('UpgradeDataMM2_'+serverID);
    if (s != null){
        opts = JSON2.parse (s);
        for (k in opts){
            if (matTypeof(opts[k]) == 'object')
                for (kk in opts[k])
                    upgradeData[k][kk] = opts[k][kk];
            else
                upgradeData[k] = opts[k];
        }
    }
}

function readSalvageData (){
    var serverID = getServerId();
    s = GM_getValue ('SalvageDataMM2_'+serverID);
    if (s != null){
        opts = JSON2.parse (s);
        for (k in opts){
            if (matTypeof(opts[k]) == 'object')
                for (kk in opts[k])
                    salvageData[k][kk] = opts[k][kk];
            else
                salvageData[k] = opts[k];
        }
    }

    // recreate the objects w/ functions
    for (k in salvageData.ruleSet)
    {
        var r = salvageData.ruleSet[k];
        var rule = new Rule(r.type, r.faction, r.conditions);
        for (j in rule.conditions)
        {
            rule.conditions[j].checkCondition = checkCondition;
        }
        salvageData.ruleSet[k] = rule;
    }
}

function readOptions(){var a=getServerId();s=GM_getValue("BOOptions_"+a);if(s!=null){opts=JSON2.parse(s);for(k in opts)Options[k]=opts[k]}}
function saveOptions(){var a=getServerId();GM_setValue("BOOptions_"+a,JSON2.stringify(Options))}
function saveColors (){var serverID = getServerId();GM_setValue('Colors', JSON2.stringify(Colors));}
function readColors (){
  var serverID = getServerId();
  s = GM_getValue ('Colors');
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts)
      Colors[k] = opts[k];
  }
}
function createButton (label){
  var a=document.createElement('a');
  a.className='button20';
  a.innerHTML='<span style="color: #ff6">'+ label +'</span>';
  return a;
}
function createTopButton (label){
  var a=document.createElement('a');
  a.className='button25';
  a.innerHTML='<span style="color: #f66">'+ label +'</span>';
  return a;
}
function createBlinkButton (label){
  var a=document.createElement('a');
  a.className='button20';
  a.innerHTML='<span style="color: #fff"><blink>'+ label +'</blink></span>';
  return a;
}

function AddMainTabLink(text, eventListener, mouseListener) {
  var a = createButton ("KOC BAO");
  a.className='tab';
  a.id = 'ptBoite';
  var tabs=ById('main_engagement_tabs');

  if(!tabs) {
    tabs=ById('topnav_msg');
    if (tabs)
      tabs=tabs.parentNode;
  }
  if(tabs) {
   eNew2 = document.createElement('div');
   eNew2.id = 'BOAbout';
   eNew2.style.background='#5b5';
   eNew2.className='tabs_engagement';
   eNew2.style.paddingLeft='25px';
   eNew2.style.whiteSpace='nowrap';
   if (GlobalOptions.pbWideScreen)
    eNew2.style.width='1095px';
   else
    eNew2.style.width='735px';
   tabs.parentNode.insertBefore (eNew2, tabs);
   eNew2.innerHTML="<a id=BoFlag style='float:right;margin-right:10px;'></a><a id=BoBoite class='tab'  style='float:right;margin-right:20px;'><span style='color:#ff6'>SUPPORT BAO</span></a><span style='float:right;margin-right:20px;margin-top:4px;font-size:16px;text-shadow: 1px 1px 1px #AAA; font-variant:small-caps;'><center><b>Boite &agrave; outils "+Version+" - BeWorld</b></center></span>";

   var e = tabs.parentNode;
    var eNew = null;
    for (var i=0; i<e.childNodes.length; i++){
      var ee = e.childNodes[i];

      if (ee.tagName && ee.tagName=='DIV' && ee.className=='tabs_engagement' &&  ee.id!='main_engagement_tabs' &&  ee.id!='BOAbout'){
        eNew = ee;
        break;
      }
    }
    if (eNew == null){
      eNew = document.createElement('div');
      eNew.className='tabs_engagement';
      eNew.style.background='#5a5';
      eNew.style.paddingLeft='25px';
      tabs.parentNode.insertBefore (eNew, tabs);
      eNew.id = 'gmTabs';
      eNew.style.whiteSpace='nowrap';
   if (GlobalOptions.pbWideScreen)
    eNew.style.width='1095px';
   else
    eNew.style.width='735px';
    }
    if (eNew2.firstChild){
      eNew2.insertBefore (a, eNew2.firstChild);
    }else{
      eNew2.appendChild(a);
     }


   ById("BoFlag").innerHTML="<img valign=absmiddle src='"+lang.General.flag+"' title='Support FACEBOOK'>";
  ById("BoFlag").addEventListener('click',function() {
      window.open(lang.General.supporturl);
   }, false);
   ById("BoBoite").addEventListener('click',function() {
      window.open("http://koc-bao.com/phpBB3");
   }, false);
    a.addEventListener('click',eventListener, false);
    if (mouseListener != null)
      a.addEventListener('mousedown',mouseListener, true);


     if (tabs) {
       GM_xmlhttpRequest({method:"GET",url:"http://ddflux.org/bao/bao/104299.user.js",onload:function(a){var b=/\/\/\s*@version\s+(.+)\s*\n/i.exec(a.responseText);
       var c=Version;
       if(b){

		   if(b[1]>c){
       var eNewMAJ=createBlinkButton ("BAO "+b[1]+" dispo !");
       eNewMAJ.className='tab';
       eNewMAJ.id="BOUpdate";
       eNewMAJ.title=lang.General.BOUpdate;
       eNew2.insertBefore(eNewMAJ,eNew2.firstChild);
       eNewMAJ.addEventListener('click',function() {
               window.open('http://koc-bao.com');
       }, false);

       }}},onerror:function(a){}})


      }


    return a;
  }
  return null;
}
function AddMainTabLink2(text, eventListener, mouseListener) {
  var b = createButton (lang.StatLabel);
  b.className='tab';
  b.id = 'ptBoite2';

  var tabs=ById('main_engagement_tabs');
  if(!tabs) {
    tabs=ById('topnav_msg');
    if (tabs)
      tabs=tabs.parentNode;
  }
  if(tabs) {

   var e = tabs.parentNode;
    var eNew = null;
    for (var i=0; i<e.childNodes.length; i++){
      var ee = e.childNodes[i];

      if (ee.tagName && ee.tagName=='DIV' && ee.className=='tabs_engagement' &&  ee.id!='main_engagement_tabs' &&  ee.id!='BOAbout'){
        eNew = ee;
        break;
      }
    }
    if (eNew == null){
      eNew = document.createElement('div');
      eNew.className='tabs_engagement';
      eNew.style.background='#ca5';
      tabs.parentNode.insertBefore (eNew, tabs);
      eNew.id = 'gmTabs';
      eNew.style.whiteSpace='nowrap';
      eNew.style.width='735px';
    }
    if (eNew2.firstChild){
      eNew2.insertBefore (b, eNew2.firstChild);
    }else{
      eNew2.appendChild(b);
     }

    b.addEventListener('click',eventListener, false);
    if (mouseListener != null)
      b.addEventListener('mousedown',mouseListener, true);
    return b;
  }
  return null;
}

unsafeWindow.PTscout = function (x, y){
  var a=confirm("Voulez-vous envoyer un eclaireur ?");
  if (a) {
  setTimeout (function (){
    ById('mapXCoor').value = x;
    ById('mapYCoor').value = y;
    unsafeWindow.Modal.hideModalAll();
    unsafeWindow.reCenterMapWithCoor();
    unsafeWindow.changeview_map(ById('mod_views_map'));
	unsafeWindow.modal_attack(3,x,y);
	setTimeout (function (){
	  var scouter = ById('modal_attack_unit_ipt3');
	  scouter.value=1;
	  var evt = document.createEvent("KeyboardEvent");
		  if(evt.initKeyboardEvent) {
				evt.initKeyboardEvent("keyup",true,true,null,false,false,false,false,0x10,0);
		  } else {
				evt.initKeyEvent("keyup",true,true,null,false,false,false,false,0x10,0);
		  }
	  scouter.dispatchEvent(evt);
	  unsafeWindow.modal_attack_do();
	}, 500);
   }, 0);
  }
};

function makeButton20 (label){
  var a = document.createElement('a');
  a.className = "button20 ptButton20";
  var s = document.createElement('span');
  s.innerHTML = label;
  a.appendChild (s);
  return a;
}

function strButton20 (label, tags){
  if (tags == null)
    tags = '';
  return ('<TABLE class=ptNoPad><TR><TD><A class="button20 ptButton20" '+ tags +'><SPAN>'+ label +'</span></a></td></tr></table>' );
}

function strButton14 (label, tags){
  if (tags == null)
    tags = '';
  return ('<A class="button14 ptButton20" '+ tags +'><SPAN>'+ label +'</span></a>' );
}

function cityStatusString (cs){
  if (cs==4)
    return 'Vacances';
  if (cs==3)
    return 'Paix';
  if (cs==2)
    return 'Protection Debutant';
  return 'Normal';
}

function sendChat (msg){
  document.getElementById ("mod_comm_input").value = msg;
  unsafeWindow.Chat.sendChat ();
}
function doDefTrain (cityId, siege, unitId, num, notify){
  var time = unsafeWindow.modal_walls_traintime(unitId, num);
  var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  params.cid = cityId;
  params.type = unitId;
  params.quant = num;
  params.items = siege;
  new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fortify.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (rslt.ok) {
          unsafeWindow.seed.queue_fort["city" + cityId].push([unitId, num, rslt.initTS, parseInt(rslt.initTS) + time, 0, time, rslt.fortifyId]);
          if (notify != null)
            setTimeout (function (){notify(null);}, 500);
        } else {
          if (notify != null)
            setTimeout (function (){notify(rslt.errorMsg);}, 500);
        }
      },
      onFailure: function () {
        if (notify != null)
          notify(rslt.errorMsg);
      },
  });
}
function doTrain (cityId, tut, gam, unitId, num, notify){
  var time = unsafeWindow.modal_barracks_traintime(unitId, num);
  if(tut==36){time=parseInt(time*0.7)}else{if(tut==37){time=parseInt(time*0.5)}else{if(tut==38){time=parseInt(time*0.3)}}}
  var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  params.cid = cityId;
  params.type = unitId;
  params.quant = num;
  params.items = tut;
  params.gambleId = gam;
  new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/train.php" + unsafeWindow.g_ajaxsuffix, {
    method: "post",
    parameters: params,
    onSuccess: function(rslt) {
      if (rslt.ok) {
       var resourceFactors=[],resourceLost;
       if(gam!=null){
         time=rslt.timeNeeded;
	}
        for(var i=1;i<5;i++){
        if(rslt.gamble){
         resourceFactors.push(rslt.gamble[i.toString()]);
        }else{
        resourceFactors.push(1);
        }
        resourceLost=parseInt(unsafeWindow.unitcost["unt"+unitId][i])*3600*parseInt(num);resourceLost=resourceLost*resourceFactors[i-1];
        unsafeWindow.seed.resources["city"+cityId]["rec"+i][0]=parseInt(unsafeWindow.seed.resources["city"+cityId]["rec"+i][0])-resourceLost;
       }
       unsafeWindow.seed.citystats["city"+cityId].gold[0]=parseInt(unsafeWindow.seed.citystats["city"+cityId].gold[0])-parseInt(unsafeWindow.unitcost["unt"+unitId][5])*parseInt(num);
       unsafeWindow.seed.citystats["city"+cityId].pop[0]=parseInt(unsafeWindow.seed.citystats["city"+cityId].pop[0])-parseInt(unsafeWindow.unitcost["unt"+unitId][6])*parseInt(num);
       unsafeWindow.seed.queue_unt["city"+cityId].push([unitId,num,rslt.initTS,parseInt(rslt.initTS)+time,0,time,null]);

       if (tut!=0) unsafeWindow.seed.items["i"+tut]=Number(unsafeWindow.seed.items["i"+tut])-1;
	//if(rslt.updateSeed) { unsafeWindow.update_seed(rslt.updateSeed) }
       if (notify != null)
          setTimeout (function (){notify(null);}, 100);
      } else {
        if (notify != null){
          setTimeout (function (){notify(rslt.errorMsg);}, 100);
        }
      }
    },
    onFailure: function(rslt) {
      if (notify != null)
        notify(rslt.errorMsg);
    }
  });
}

function getAbsoluteOffsets (e){
  ret = {left:0, top:0};
  while (e.offsetParent){
    if (e.style.position == 'absolute')
      break;
    ret.left += e.offsetLeft;
    ret.top += e.offsetTop;
    e = e.offsetParent;
  }
  return ret;
}

function getClientCoords(e){
  if (e==null)
    return {x:null, y:null, width:null, height:null};
  var x=0, y=0;
  ret = {x:0, y:0, width:e.clientWidth, height:e.clientHeight};
  while (e.offsetParent != null){
    ret.x += e.offsetLeft;
    ret.y += e.offsetTop;
    e = e.offsetParent;
  }
  return ret;
}

function htmlTitleLine (msg){
  return '<TABLE width=100% cellspacing=0><TR><TD style="padding:0px" width=50%><HR></td><TD style="padding:0px">[ '+ msg +' ]</td><TD style="padding:0px" width=50%><HR></td></tr></table>';
}

function CPopup (prefix, x, y, width, height, enableDrag, onClose) {
  var pop = WinManager.get(prefix);
  if (pop){
    pop.show (false);
    return pop;
  }
  this.BASE_ZINDEX = 123457;
  this.stmaxh = height;
  this.stmaxw = width;
  this.show = show;
  this.toggleHide = toggleHide;
  this.getTopDiv = getTopDiv;
  this.getMainTopDiv = getMainTopDiv;
  this.getMainDiv = getMainDiv;
  this.getLayer = getLayer;
  this.setLayer = setLayer;
  this.setEnableDrag = setEnableDrag;
  this.getLocation = getLocation;
  this.setLocation = setLocation;
  this.focusMe = focusMe;
  this.isShown = isShown;
  this.unfocusMe = unfocusMe;
  this.centerMe = centerMe;
  this.destroy = destroy;
  this.autoHeight = autoHeight;
  this.autoWidth = autoWidth;
  this.div = document.createElement('div');
  this.prefix = prefix;
  this.onClose = onClose;
  var t = this;
  this.div.className = 'BOCPopup '+ prefix +'_CPopup';
  this.div.id = prefix +'_outer';
  this.div.style.background = "#fff";
  this.div.style.zIndex = this.BASE_ZINDEX;
  this.div.style.display = 'none';
  if (Options.BOTransparence) this.div.style.opacity = '0.9';
  this.div.style.width = width + 'px';
  this.div.style.height = height + 'px';
  this.div.style.maxHeight = height + 'px';
  this.div.style.overflowY = 'hidden';
  this.div.style.position = "absolute";
  this.div.style.top = y +'px';
  this.div.style.left = x + 'px';
  this.div.style.width = width + 'px';
  this.div.style.maxWidth = width + 'px';
  topClass = 'BOCPopupTop '+ prefix +'_CPopupTop';
  var m = '<TABLE cellspacing=0 width=100% height=100%><TR id="'+ prefix +'_bar" class="'+ topClass +'"><TD width=99% valign=bottom><SPAN id="'+ prefix +'_top"></span></td>\
      <TD id='+ prefix +'_X align=right valign=middle onmouseover="this.style.cursor=\'pointer\'" style="color:#fff; background:#333; font-weight:bold; font-size:14px; padding:0px 0px">\
      <img style="margin-bottom:0px;" width=35px height=35px src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB2JJREFUeNqsWVtMFFcYPjOz6y5XERQRlYtFFqsIhVKj1CoosErBNq2Vi6aYNk1afWibKBAUmzZINeKLD1VJ0CYNafFCqg9crLVewCYYKVQtiGBRGCitVblfdnd6ZjK7PXP2nJmBdpIvM3N25pxv//8//20YoP9gZvCcoON54f9anNEY0/sHBA1ywkyJMhrkGGyc0SCodVYlzOggSSKEAyePLipg1wJhXFPizDRIimAxgqwKWRpJB+Valawe9eLEWMq1mkQdyJl0TZK0giyjkySLgSOMaRFFYcfuBQJpBVk1NaOS4jCCHAYGOeNEcXI25Bo908gKQGXnshSSBsoZlyzAFrYjsCFknfeaZBmVTYNK0KABToWog0BwCrm3YWQdpE3GqKicQ6TmhBFHSGioZ35BYfz69etWBQcFhRqNRi8GHpOTk8MDf/7F/3T1auPRsiO329vahmSCOGzYn0ClK6Cqx4niqkYJznLC29vb/E1l5WZraupWk8nk5zTK/v5+MD4+DsLCwlyGOjU1NVxTV//tzrx3a/5+8mQUDk0iwAmTNpqLIErMBOEJ4QPhDxEIsQhiCcQyiNgNG1PS+vr7fxQEgZ+YmOBPnjzJp6en815eXgokJibyR48e5UdHR3nxWb6v71ryxhSrOIc81wsQiyHmy2v5yGubMJNicKKitMwQ3hCilOZBBEOEQ0RBxKRt2myFC7eKC9fW1vIWi8WNII6YmBi+qalJIgulfS9jyxuvy2Sj5LmD5bX85LXNMhcXUZpdOkk71S3+Q/OixYt9b926VTo/MDDi9OnTYPfu3WA6R1FRESgsLASDg4OP4l9O2Pug4/5TODwBMU4wAztiBgKH+UuSbTrt0lT9/YXc6OXL19bV1YG8vLxp52vXrl8HAf7+AJrE7Li4OMOpiooWzC05CJFMmprVGY0M65KS5q1b+2rGyMiIJEl0S65cuRIkJCS4EZs3dy7YnpsLPDw8XGP5BQWgt7cXrFm9OiPNag1EbJEjRDgXP1bFPaG+lPv4k083chxnFlUON4Vr4WVRUaCxsRFcuXIFFOTnu8ZDQ0JAQ0MDOHHiBCg9eNA1brPZQElJCWBZltuzNz9dJWgohMgSkhKW5KriYmPjxQeqqqoULwwPD4OxsTHpev/+/RLZJeHh4NKlS2DhwoXSOLRJxTsXLl4EdrsdJMTHJRCCBU5SQQzdSKhdmmV4wonPQFKzFgQHu6k4NSUFVFZWulQsEvP19ZWuq6urwfYdO9wM+ObNRhAdHe2Y4++/9fmzZ2IwGEM21STuV1k9uWikxeINVTVLdOakox5KLycnB0CfKt0rSG4XSbpnct3d3dDnMGx8fLw/JQlXHKyeesk/IMAkRxjqg10PH4KhoSHF2N27d6m+QFS9eJjMZk6PazNoFGPSKl0POiUGQUFBxAcjIiJAXW0tmAt3uZME3Hhg3759wOFwgNLSUreJnXPBHGBYLWHGJapWxwgDA39MPH36bCAgIAAEL1igmMDHx0ci6Vz4/Pnz4M233nZtsOLiYvDe+x8AG/SITtghLNBbwMRlsKuzc1CjlqKqXiDlkr+0tDSLP2ZkZCgejoyMdJEUbTIX+s2amlqwdVuWi+zatYmKd5KTk8AcPz/wQ0NTq0pJotAqR3BLLCGbN3BGw+SWzMwNMG6D8vJyyR+KU/TxfdCB90juSFQ1jOfAAcc7OztBbV295NwPHykDw4j9Hj9+AoSHhYIDJYcq7jQ3PUbCp1voxNM8ViV8Ol2Ux+3m5s9eio2NKysrA8UHDshTKM1JtEmbg274OTnZ4OtTFaC1reNezLLIAsQtTdBckwhOo1ZSSPnR457e7OysZBiruYddXeDOnV/dbQZKVKAE/VWrXgHnzp4R3dLkO7k7Dz3quj+AJSN2TKIOVPW0utyN7IOOjudDI6P9aampiZmZmZL6xTCp2H0UollZ28CZqu+A2WQChZ9/eayy4qtblMTZRilHFFmTUU7pvCBmQwSIngQiRPRCECsg4vbk5++FLuh3Mb/8ra2Nh86eh76W9/Dw5E0mM2+Y9S9SrZv4azcapFwUvvN43xeHi8Q55LmWynMHyWvNltc2yVzc8lFaOMXt1eQMr6lW67KyI2Ufrlj+opj5S+VHe3s7gPkq3EyMGB6BxbJU2t3i0XLvfvfewqKT9RfOtiC2OEGon4iqZzQqUFrd5DwbPtq167WsrOykxDWro8Uwq7BZQbBdvv5za9XZczfKj5VdRgip1UvESpRULrMq5bKRcJb+kKenpwd04qGBgYEmGzCyPb29Y91dHT3jI0MjSLk8RTnbVDoomp06GlmOcM0SNqaABAy0trdPo6anNiC0yOKtHBJJhhCWSWTthNYOtf+kpw9Ka5BpZeWkto6DQs6h0oIU1NqOtL4oSwGj0c0jdfRonTxic1erP0or+hhC6aDWGndQeqVaWZOgt+Os1RJnVKSJL0Zr2urq5ev92KD2oYHR8WWEmr7p/GKiuYCaxKfzCUdQ+Uqiq4cxk49cM51D+C8fxf4RYABOlK9mhtLFVgAAAABJRU5ErkJggg%3D%3D" title="Fermer">\
      </td></tr><TR><TD height=100% valign=top class="BOCPopMain '+ prefix +'_CPopMain" colspan=2 id="'+ prefix +'_main"></td></tr></table>';
  document.body.appendChild(this.div);
  this.div.innerHTML = m;
  ById(prefix+'_X').addEventListener ('click', e_XClose, false);
  this.dragger = new CWinDrag (ById(prefix+'_bar'), this.div, enableDrag);

  this.div.addEventListener ('mousedown', e_divClicked, false);
  WinManager.add(prefix, this);

  function e_divClicked (){
    t.focusMe();
  }
  function e_XClose (){
    t.show(false);
    if (t.onClose != null)
      t.onClose();
  }
  function autoHeight (onoff){
     if (onoff) {
       t.div.style.height = '';
       t.div.style.maxHeight ='';
    } else{
       t.div.style.height = t.stmaxh;
       t.div.style.maxHeight = t.stmaxh;
       }
  }
  function autoWidth (onoff){
         if (onoff) {
           t.div.style.width = '';
           t.div.style.maxWidth ='';
        } else{
           t.div.style.width = t.stmaxw;
           t.div.style.maxWidth = t.stmaxw;
           }
  }
  function focusMe (){
    t.setLayer(5);
    for (k in unsafeWindow.cpopupWins){
      if (k != t.prefix)
        unsafeWindow.cpopupWins[k].unfocusMe();
    }
  }
  function unfocusMe (){
    t.setLayer(-5);
  }
  function getLocation (){
    return {x: parseInt(this.div.style.left), y: parseInt(this.div.style.top)};
  }
  function setLocation (loc){
    t.div.style.left = loc.x +'px';
    t.div.style.top = loc.y +'px';
  }
  function destroy (){
    document.body.removeChild(t.div);
    WinManager.delete (t.prefix);
  }
  function centerMe (parent){
    if (parent == null){
      var coords = getClientCoords(document.body);
    } else
      var coords = getClientCoords(parent);
    var x = ((coords.width - parseInt(t.div.style.width)) / 2) + coords.x;
    var y = ((coords.height - parseInt(t.div.style.height)) / 2) + coords.y;
    if (x<0)
      x = 0;
    if (y<0)
      y = 0;
    t.div.style.left = x +'px';
    t.div.style.top = y +'px';
  }
  function setEnableDrag (tf){
    t.dragger.setEnable(tf);
  }
  function setLayer(zi){
    t.div.style.zIndex = ''+ (this.BASE_ZINDEX + zi);
  }
  function getLayer(){
    return parseInt(t.div.style.zIndex) - this.BASE_ZINDEX;
  }
  function getTopDiv(){
    return ById(this.prefix+'_top');
  }
  function getMainDiv(){
    return ById(this.prefix+'_main');
  }
  function getMainTopDiv(){
  	return ById(this.prefix+'_top');
  }
  function isShown (){
    return t.div.style.display == 'block';
  }
  function show(tf){
    if (tf){
      t.div.style.display = 'block';
      t.focusMe ();
    } else {
      t.div.style.display = 'none';
    }
    return tf;
  }
  function toggleHide(t){
    if (t.div.style.display == 'block') {
      return t.show (false);
    } else {
      return t.show (true);
    }
  }
}


function CWinDrag (clickableElement, movingDiv, enabled) {
  var t=this;
  this.setEnable = setEnable;
  this.setBoundRect = setBoundRect;
  this.debug = debug;
  this.dispEvent = dispEvent;
  this.lastX = null;
  this.lastY = null;
  this.enabled = true;
  this.moving = false;
  this.theDiv = movingDiv;
  this.body = document.body;
  this.ce = clickableElement;
  this.moveHandler = new CeventMove(this).handler;
  this.outHandler = new CeventOut(this).handler;
  this.upHandler = new CeventUp(this).handler;
  this.downHandler = new CeventDown(this).handler;
  this.clickableRect = null;
  this.boundRect = null;
  this.bounds = null;
  this.enabled = false;
  if (enabled == null)
    enabled = true;
  this.setEnable (enabled);

  function setBoundRect (b){
    this.boundRect = boundRect;
    this.bounds = null;
  }

  function setEnable (enable){
    if (enable == t.enabled)
      return;
    if (enable){
      clickableElement.addEventListener('mousedown',  t.downHandler, false);
      t.body.addEventListener('mouseup', t.upHandler, false);
    } else {
      clickableElement.removeEventListener('mousedown', t.downHandler, false);
      t.body.removeEventListener('mouseup', t.upHandler, false);
    }
    t.enabled = enable;
  }

  function CeventDown (that){
    this.handler = handler;
    var t = that;
    function handler (me){
      if (t.bounds == null){
        t.clickableRect = getClientCoords(clickableElement);
        t.bodyRect = getClientCoords(document.body);
        if (t.boundRect == null)
          t.boundRect = t.clickableRect;
        t.bounds = {top:10-t.clickableRect.height, bot:t.bodyRect.height-25, left:40-t.clickableRect.width, right:t.bodyRect.width-25};
      }
      if (me.button==0 && t.enabled){
        t.body.addEventListener('mousemove', t.moveHandler, true);
        t.body.addEventListener('mouseout', t.outHandler, true);
        t.lastX = me.clientX;
        t.lastY = me.clientY;
        t.moving = true;
      }
    }
  }

  function CeventUp  (that){
    this.handler = handler;
    var t = that;
    function handler (me){
      if (me.button==0 && t.moving)
        _doneMoving(t);
    }
  }

  function _doneMoving (t){
    t.body.removeEventListener('mousemove', t.moveHandler, true);
    t.body.removeEventListener('mouseout', t.outHandler, true);
    t.moving = false;
  }

  function CeventOut  (that){
    this.handler = handler;
    var t = that;
    function handler (me){
      if (me.button==0){
        t.moveHandler (me);
      }
    }
  }

  function CeventMove (that){
    this.handler = handler;
    var t = that;
    function handler (me){
      if (t.enabled && !t.wentOut){
        var newTop = parseInt(t.theDiv.style.top) + me.clientY - t.lastY;
        var newLeft = parseInt(t.theDiv.style.left) + me.clientX - t.lastX;
        if (newTop < t.bounds.top){     // if out-of-bounds...
          newTop = t.bounds.top;
          _doneMoving(t);
        } else if (newLeft < t.bounds.left){
          newLeft = t.bounds.left;
          _doneMoving(t);
        } else if (newLeft > t.bounds.right){
          newLeft = t.bounds.right;
          _doneMoving(t);
        } else if (newTop > t.bounds.bot){
          newTop = t.bounds.bot;
          _doneMoving(t);
        }
        t.theDiv.style.top = newTop + 'px';
        t.theDiv.style.left = newLeft + 'px';
        t.lastX = me.clientX;
        t.lastY = me.clientY;
      }
    }
  }

  function debug  (msg, e){
    logit ("*************** "+ msg +" ****************");
    logit ('clientWidth, Height: '+ e.clientWidth +','+ e.clientHeight);
    logit ('offsetLeft, Top, Width, Height (parent): '+ e.offsetLeft +','+ e.offsetTop +','+ e.offsetWidth +','+ e.offsetHeight +' ('+ e.offsetParent +')');
    logit ('scrollLeft, Top, Width, Height: '+ e.scrollLeft +','+ e.scrollTop +','+ e.scrollWidth +','+ e.scrollHeight);
  }

  function dispEvent (msg, me){
    logit (msg + ' Button:'+ me.button +' Screen:'+ me.screenX +','+ me.screenY +' client:'+  me.clientX +','+ me.clientY +' rTarget: '+ me.relatedTarget);
  }
}


var WinManager = {
  wins : {},
  didHide : [],

  get : function (prefix){
    var t = WinManager;
    return t.wins[prefix];
  },

  add : function (prefix, pop){
    var t = WinManager;
    t.wins[prefix] = pop;
    if (unsafeWindow.cpopupWins == null)
      unsafeWindow.cpopupWins = {};
    unsafeWindow.cpopupWins[prefix] = pop;
  },

  hideAll : function (){
    var t = WinManager;
    t.didHide = [];
    for (k in t.wins){
      if (t.wins[k].isShown()){
        t.didHide.push (t.wins[k]);
        t.wins[k].show (false);
      }
    }
  },
  restoreAll : function (){
    var t = WinManager;
    for (var i=0; i<t.didHide.length; i++)
      t.didHide[i].show (true);
  },

  delete : function (prefix){
    var t = WinManager;
    delete t.wins[prefix];
    delete unsafeWindow.cpopupWins[prefix];
  }
}

Array.prototype.compare = function(testArr) {
    if (this.length != testArr.length) return false;
    for (var i = 0; i < testArr.length; i++) {
        if (this[i].compare) {
            if (!this[i].compare(testArr[i])) return false;
        }
        if (this[i] !== testArr[i]) return false;
    }
    return true;
}

String.prototype.entityTrans = {  '&agrave;':'\\u00e0', '&eacute;':'\\u00e9', '&':'&amp;', '<':'&lt;',  '>':'&gt;',  '\"':'&quot;', '\'':'&#039', '<':'\\u003c', '/':'\\/', '\\':'\\\\', '\"':'\\\"','{':'&#123;','}':'&#125;'};

String.prototype.htmlEntities = function() {
  var ret = this.toString();
  for (k in this.entityTrans)
     ret  = ret.split(k).join(this.entityTrans[k]);
  return ret;
}
String.prototype.htmlSpecialChars = function() {
  var ret = this.toString();
  for (k in this.entityTrans)
     ret  = ret.split(k).join(this.entityTrans[k]);
  return ret;
}
String.prototype.htmlSpecialCharsDecode = function() {
  var ret = this.toString();
  for (k in this.entityTrans)
     ret = ret.split(this.entityTrans[k]).join(k);
  return ret;
}
String.prototype.stripTags = function(){
  return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi, '');
}

String.prototype.capitalize = function(){
  return this.charAt(0).toUpperCase() + this.substring(1).toLowerCase();
}

function objectName (o){
  var s = o.toString();
  return s.substr(7,s.length-8);
}

function matTypeof (v){
  if (v == undefined)
    return 'undefined';
  if (typeof (v) == 'object'){
    if (!v)
      return 'null';
    else if (v.constructor.toString().indexOf("Array")>=0 && typeof(v.splice)=='function')
      return 'array';
    else return 'object';
  }
  return typeof (v);
}

function addCommasInt(n){
  nStr = parseInt(n) + '';
  var rgx = /(\d+)(\d{3})/;
  while (rgx.test(nStr)) {
    nStr = nStr.replace(rgx, '$1' + ',' + '$2');
  }
  return nStr;
}

function addCommas(nStr){
  nStr += '';
  x = nStr.split('.');
  x1 = x[0];
  x2 = x.length > 1 ? '.' + x[1] : '';
  var rgx = /(\d+)(\d{3})/;
  while (rgx.test(x1)) {
    x1 = x1.replace(rgx, '$1' + ',' + '$2');
  }
  return x1 + x2;
}

function htmlSelector(a,b,c){m=[];m.push("<SELECT");if(c){m.push(" ");m.push(c)}for(k in a){m.push("><OPTION ");if(k==b)m.push("SELECTED ");m.push('value="');m.push(k);m.push('">');m.push(a[k]);m.push("</option>")}m.push("</select>");return m.join("")}
function unixTime(){ return parseInt (new Date().getTime() / 1000) + unsafeWindow.g_timeoff;}
function timestrShort(a){a=parseInt(a);if(a>86400){var b=[];a/=3600;b.push(parseInt(a/24));b.push("d ");b.push(parseInt(a%24));b.push("h ");return b.join("")}else return timestr(a)}
function timestr(a,b){a=parseInt(a);var c=[];var d=a;if(d<61)return d+"s";if(d>86400){c.push(parseInt(d/86400));c.push("d ");d%=86400}if(d>3600||a>3600){c.push(parseInt(d/3600));c.push("h ");d%=3600}c.push(parseInt(d/60));c.push("m");if(b||a<=3600){c.push(" ");c.push(d%60);c.push("s")}return c.join("")}
function getMyAlliance(){if(Seed.allianceDiplomacies==null||Seed.allianceDiplomacies.allianceName==null)return[0,"None"];else return[Seed.allianceDiplomacies.allianceId,Seed.allianceDiplomacies.allianceName]}
function addCommasWhole(a){a+="";x=a.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var b=/(\d+)(\d{3})/;while(b.test(x1)){x1=x1.replace(b,"$1"+","+"$2")}return x1}
function CmatSimpleSound (playerUrl, container, attrs, onLoad, flashVars) {
  var self = this;
  this.player = null;
  this.volume = 100;
  this.isLoaded = false;
  this.onSwfLoaded = null;
  var div = document.createElement ('div');
  this.onSwfLoaded = onLoad;
  if (navigator.appName.toLowerCase().indexOf('microsoft')+1) {
    div.innerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0"><param name="movie" value="'+playerUrl+'"><param name="quality" value="high"></object>';
    this.player = div.getElementsByTagName('object')[0];
  } else {
    div.innerHTML = '<embed src="'+playerUrl+'"  bgcolor="#eeeeee" allowfullscreen=false FlashVars="'+ flashVars +'" quality="high" allowscriptaccess="always" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" ></embed>';
    this.player = div.getElementsByTagName('embed')[0].wrappedJSObject;
  }
  if (container)
    container.appendChild (div);
  else
    document.body.appendChild (div);
  for (k in attrs)
    this.player.setAttribute(k, attrs[k]);

  this.setVolume = function (chanNum, vol){
    if (!self.isLoaded)
      return;
    self.player.jsSetVolume (chanNum, vol);
    volume = vol;
  }

  this.load = function (chanNum, url, bStream, bAutoplay, bUsePolicyFile){
    self.player.jsLoad (chanNum, url, bStream, bAutoplay, bUsePolicyFile);
  }

  this.play = function (chanNum, position){
    if (this.isLoaded) {
     if (self.player.jsPlay)  self.player.jsPlay (chanNum, position);
    }
  }

  this.stop = function (chanNum){
   if (!self.isLoaded)
      return;
    self.player.jsStop (chanNum);
  }

  this.getStatus = function (chanNum){
   if (this.isLoaded)
    return self.player.jsGetStatus (chanNum);
  }

  this.debugFunc = function (msg){
  }

  this.swfDebug = function (msg){
    self.debugFunc('SWF: '+ msg);
  }
  this.swfLoaded = function (){
    self.isLoaded = true;
    self.debugFunc ('playerIsReady');
    if (self.onSwfLoaded)
      self.onSwfLoaded();
  }
  this.swfPlayComplete = function (chanNum){
  }
  this.swfLoadComplete = function (chanNum, isError){
  }
}

function SliderBar (container, width, height, value, classPrefix, margin){
  var self = this;
  this.listener = null;
  if (value==null)
    value = 0;
  if (!margin)
    margin = parseInt(width*.05);
  this.value = value;
  if (width<20) width=20;
  if (height<5) height=5;
  if (classPrefix == null){
    classPrefix = 'slider';
    var noClass = true;
  }
  var sliderHeight = parseInt(height/2);
  var sliderTop = parseInt(height/4);
  this.sliderWidth = width - (margin*2);

  this.div = document.createElement ('div');
  this.div.style.height = height +'px';
  this.div.style.width = width +'px';
  this.div.className = classPrefix +'Cont';
  if (noClass)
    this.div.style.backgroundColor='#ddd';

  this.slider = document.createElement ('div');
  this.slider.setAttribute ('style', 'position:relative;');
  this.slider.style.height = sliderHeight + 'px'
  this.slider.style.top = sliderTop + 'px';
  this.slider.style.width = this.sliderWidth +'px';
  this.slider.style.left = margin +'px';
  this.slider.className = classPrefix +'Bar';
  this.slider.draggable = true;
  if (noClass)
    this.slider.style.backgroundColor='#fff';

  this.sliderL = document.createElement ('div');
  this.sliderL.setAttribute ('style', 'width:100px; height:100%; position:relative; ');
  this.sliderL.className = classPrefix +'Part';
  this.sliderL.draggable = true;
  if (noClass)
    this.sliderL.style.backgroundColor='#0c0';

  this.knob = document.createElement ('div');
  this.knob.setAttribute ('style', 'width:3px; position:relative; left:0px; background-color:#222');
  this.knob.style.height = height +'px';
  this.knob.style.top = (0-sliderTop) +'px';
  this.knob.className = classPrefix +'Knob';
  this.knob.draggable = true;
  this.slider.appendChild(this.sliderL);
  this.sliderL.appendChild (this.knob);
  this.div.appendChild (this.slider);
  container.appendChild (this.div);
  this.div.addEventListener('mousedown',  mouseDown, false);

  this.getValue = function (){
    return self.value;
  }

  this.setValue = function (val){
    var relX = (val * self.sliderWidth);
    self.sliderL.style.width = relX + 'px';
    self.knob.style.left =  relX + 'px';
    self.value = val;
    if (self.listener)
      self.listener(self.value);
  }

  this.setChangeListener = function (listener){
    self.listener = listener;
  }

  function moveKnob (me){
    var relX = me.clientX - self.divLeft;
    if (relX < 0)
      relX = 0;
    if (relX > self.sliderWidth)
      relX = self.sliderWidth;
    self.knob.style.left = (relX - (self.knob.clientWidth/2) ) +'px';
    self.sliderL.style.width = relX + 'px';
    self.value =  relX / self.sliderWidth;
    if (self.listener)
      self.listener(self.value);
  }
  function doneMoving (){
    self.div.removeEventListener('mousemove', mouseMove, true);
    document.removeEventListener('mouseup', mouseUp, true);
  }
  function mouseUp (me){
    moveKnob (me);
    doneMoving();
  }

  function mouseDown(me){
    var e = self.slider;
    self.divLeft = 0;
    while (e.offsetParent){
      self.divLeft += e.offsetLeft;
      e = e.offsetParent;
    }
    moveKnob (me);
    document.addEventListener('mouseup',  mouseUp, true);
    self.div.addEventListener('mousemove',  mouseMove, true);
  }
  function mouseMove(me){
    moveKnob (me);
  }
}
function AddSubTabLink(text, eventListener, id) {
  var a = createYellowButton (text,'botbutton');
  a.className='tab';
  var tabs=ById('main_engagement_tabs');
  if(!tabs) {
    tabs=ById('topnav_msg');
    if (tabs)
      tabs=tabs.parentNode;
  }
  if (tabs) {
    var e = tabs.parentNode;
    var gmTabs = null;
    for (var i=0; i<e.childNodes.length; i++){
      var ee = e.childNodes[i];
      if (ee.tagName && ee.tagName=='DIV' && ee.className=='tabs_engagement' && ee.id!='main_engagement_tabs' &&  ee.id!='BOAbout'){
        gmTabs = ee;
        break;
      }
    }
    if (gmTabs == null){
      gmTabs = document.createElement('div');
      gmTabs.className='tabs_engagement';
      gmTabs.style.background='#ca5';
      tabs.parentNode.insertBefore (gmTabs, tabs);
      gmTabs.style.whiteSpace='nowrap';
      gmTabs.style.width='735px';
      gmTabs.lang = 'en_PB';
    }
    gmTabs.appendChild(a);
    a.addEventListener('click',eventListener, false);
    if (id != null)
      a.id = id;
    return a;
  }
  return null;
}
function AddTowerTab(text, eventListener, id) {
  var a = createRedButton (text,'botbutton');
  a.className='tab';
  a.style.cssFloat="right";
  a.style.marginRight="20px";
  a.title="Attention !!! "+uW.g_js_strings.modaltitles.impatks+" !";
  var tabs=ById('main_engagement_tabs');
  if(!tabs) {
    tabs=ById('topnav_msg');
    if (tabs)
      tabs=tabs.parentNode;
  }
  if (tabs) {
    var e = tabs.parentNode;
    var gmTabs = null;
    for (var i=0; i<e.childNodes.length; i++){
      var ee = e.childNodes[i];
      if (ee.tagName && ee.tagName=='DIV' && ee.className=='tabs_engagement' && ee.id!='main_engagement_tabs' &&  ee.id!='BOAbout'){
        gmTabs = ee;
        break;
      }
    }
    if (gmTabs == null){
      gmTabs = document.createElement('div');
      gmTabs.className='tabs_engagement';
      gmTabs.style.background='#ca5';
      tabs.parentNode.insertBefore (gmTabs, tabs);
      gmTabs.style.whiteSpace='nowrap';
      gmTabs.style.width='735px';
      gmTabs.lang = 'en_PB';
    }
    gmTabs.appendChild(a);
    a.addEventListener('click',eventListener, false);
    if (id != null)
      a.id = id;
    return a;
  }
  return null;
}

function estETA(dist, unit, cityID, typemarche) {
 var ret={ETA:0,etaStr:'N/D',friendETA:0,friendEtaStr:'N/D'};
 if (dist <= 0) return ret;
 var troop_type = unit;
 var horse=0;
 if(troop_type>6) horse=1;
 var troop_speed=parseInt(unsafeWindow.unitstats["unt"+troop_type][3])*(1+0.1*parseInt(Seed.tech.tch11));
 if (horse){
               troop_speed=troop_speed*(1+0.05*parseInt(Seed.tech.tch12))
 }
 var Speed = troop_speed;


  var throne67=EffetTronePrc(67).percent;
  var throne68,throne69,throne70,throne71,throne72;throne68=throne69=throne70=throne71=throne72=0;
  if(typemarche==4){
   throne68=EffetTronePrc(68).percent // attaque
  }else{
   if(typemarche==3){ //eclaireur
    throne72=EffetTronePrc(72).percent
   }else{
    if(typemarche==2){ //renforce
     throne69=EffetTronePrc(69).percent
    }else{
     if(typemarche==5){ // reassign
      throne71=EffetTronePrc(71).percent
     }else{
      if(typemarche==1){ // transport
       throne70=EffetTronePrc(70).percent
       }}}}}

  var throneBoost=throne67+throne68+throne69+throne70+throne71+throne72;

 Speed=Speed*(1+(throneBoost*0.01));

 var gi=unsafeWindow.cm.guardianModalModel.getMarchBonus();
 var multiplier=1+(gi*0.01);
 Speed=Speed*multiplier;
 var gSpeed = 0;
 var estSec;
 if (Speed>0) {
  gSpeed = Speed/6000;
  estSec = Math.ceil(parseFloat(dist)/gSpeed);
 }

 var e=1;
 if (ById("BOitem_55")) {
  var l_elem=ById("BOitem_55");
  if(l_elem&&l_elem.checked>0){ e=0.75;     }
 }
 if (ById("BOitem_57")) {
  var l_elem=ById("BOitem_57");
  if(l_elem&&l_elem.checked){   e=0.5;   }
 }
 ret.ETA = (parseInt((estSec*e+''))+30);
 if(Seed.playerEffects.returnExpire>unsafeWindow.unixtime()){
  ret.ETA=parseInt(ret.ETA*0.5);
 }
 ret.etaStr = timestr (ret.ETA,1);
 if (cityID!=0) {
  var building = getCityBuilding (cityID, 18);
  if (building) {
   fSpeed = Speed * (1 + parseInt(building.maxLevel)/2);
   gSpeed = fSpeed/6000;
   estSec = (dist/gSpeed).toFixed(0);
   ret.friendETA = parseInt((estSec*e+''))+30;
   ret.friendEtaStr = timestr ((ret.friendETA+''),1);
  }
 } else {
  ret.friendETA = ret.ETA;
  ret.friendEtaStr = timestr ((ret.friendETA+''),1);
 }
 return ret;
}

function updatebotbutton2(a,b){var c=ById(b);if(c)c.innerHTML='<span style="color: #F71F02">'+a.replace("- ON",butON).replace("- OFF",butOFF)+"</span>"}
function updatebotbutton(a,b){var c=ById(b);if(c)c.innerHTML='<span style="color: #ff6">'+a.replace("- ON",butON).replace("- OFF",butOFF)+"</span>"}
function createRedButton(a,b){var c=document.createElement("a");c.style.display='none';c.id=b;c.innerHTML='<span style="color: #ff6">'+a+"</span>";return c}
function createYellowButton(a,b){
 var c=document.createElement("a");c.className="button20";c.id=b;
 c.innerHTML='<span style="color: #ff6">'+a.replace("- ON",butON).replace("- OFF",butOFF)+'</span>';
 return c
}
var DeleteReports = {
    deleting : false,
    deletes1 : new Array(),
    deletes0 : new Array(),
    timer:null,
    init : function(){
		var t = DeleteReports;
		clearInterval(t.timer);
		if(!t.deleting && (Options.DeleteMsg || Options.DeleteMsgs0 || Options.DeleteMsgs4 || Options.DeleteMsgs1 || Options.DeleteMsgs2 || Options.DeleteMsgs3 || Options.DeleteMsgs5 || Options.DeleteMsgs6 || Options.DeleteMsgs7)){
		 if (parseIntNan(Options.DeleteTimerMinute)<4) Options.DeleteTimerMinute=4;
		 t.timer = setInterval(t.startdeletereports, Options.DeleteTimerMinute*60*1000);
		}
    },

    startdeletereports : function(){
		var t = DeleteReports;
		t.deletes1 = new Array();
		t.deletes0 = new Array();
	  	if(!t.deleting && (Options.DeleteMsg || Options.DeleteMsgs0 || Options.DeleteMsgs4 || Options.DeleteMsgs1 || Options.DeleteMsgs2 || Options.DeleteMsgs3 || Options.DeleteMsgs5 || Options.DeleteMsgs6 || Options.DeleteMsgs7)){
	  		t.deleting = true;
	  		t.fetchreport(0, t.checkreports);
	  	}
    },

    fetchreport : function(pageNo, callback){
		var t = DeleteReports;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		if(pageNo > 1)
			params.pageNo = pageNo;
		new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/listReports.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			onSuccess: function (rslt) {
				callback(rslt,pageNo);
			},
				onFailure: function () {
				callback();
			},
		});
    },

    checkreports : function(rslt, pageNo){
		var t = DeleteReports;
		try {
		 if(!rslt.ok){
			return;
		 }

		var reports = rslt.arReports;
		var totalPages = rslt.totalPages;
		for(k in reports){
			if (Options.DeleteMsgs6){
			 for (var i=1;i<=Seed.cities.length;i++){
			 var x=Seed.cities[i-1][2];
			 var y=Seed.cities[i-1][3];
			 if (Tabs.farm.FarmArray[i]) {
			 for (j=0;j<Tabs.farm.FarmArray[i].length;j++){
			   if (reports[k].side1XCoord == x && reports[k].side1YCoord == y && reports[k].side0XCoord == Tabs.farm.FarmArray[i][j]["x"] && reports[k].side0YCoord == Tabs.farm.FarmArray[i][j]["y"])
			    t.deletes1.push(k.substr(2));
			 }
			 }
			 }
			}
			if (Options.DeleteMsgs7) {
			 if (reports[k].reportType==0 && reports[k].marchType==4 && reports[k].side0XCoord==Options.DeleteMsgs7X && reports[k].side0YCoord==Options.DeleteMsgs7Y)
			  t.deletes0.push(k.substr(2));

			}
		        if (Options.DeleteMsgs5){
		         for(var i = 0; i < CrestData.length; i++) {
					if (reports[k].side0XCoord == CrestData[i].X && reports[k].side0YCoord == CrestData[i].Y) {
					 t.deletes1.push(k.substr(2));
					}
		         }
		        }
			if(Options.DeleteMsg){
				if((reports[k].marchType==9 || reports[k].marchType==4) && reports[k].side0PlayerId==0 && reports[k].side0TileType > 50)
					t.deletes1.push(k.substr(2));
				else if(reports[k].marchType==1 && t.isMyself(reports[k].side1PlayerId))
					t.deletes1.push(k.substr(2));
			}
			if (Options.DeleteMsgs0){

				if(reports[k].marchType==1 && !t.isMyself(reports[k].side1PlayerId)) {
					t.deletes0.push(k.substr(2));
				}
			}
			if (Options.DeleteMsgs1){
				if(reports[k].marchType==4 && (reports[k].side0TileType <= 50)&& reports[k].side0PlayerId==0)
					t.deletes1.push(k.substr(2));
			}
			if (Options.DeleteMsgs2){
				if(reports[k].side0TileType==54)
					t.deletes1.push(k.substr(2));
			}
			if (Options.DeleteMsgs3){
				if(reports[k].side0TileType==51 && reports[k].marchType==2 && t.isMyself(reports[k].side0PlayerId))
					t.deletes1.push(k.substr(2));
			}
			if (Options.DeleteMsgs4){
				if(reports[k].side0TileType==51 && reports[k].marchType==3)
					t.deletes1.push(k.substr(2));
			}
		}


		// }

		} catch(err) {
		 var reports = [];
		 var totalPages = 0;
		 actionLog("Rapport", "Aucune suppression de rapport necessaire (BUG Rapport)");
		 t.deleting = false;
		 return;
		}

		if ((pageNo+1)==totalPages || parseInt(pageNo+1)>6) {

		if(t.deletes1.length > 0 || t.deletes0.length > 0){
			t.deleteCheckedReports(t.deletes1, t.deletes0);
		} else {
			actionLog("Rapport", "Aucune suppression de rapport necessaire");
			t.deleting = false;
			return;
		}

		} else {
		  setTimeout(function() { t.fetchreport(pageNo+1, t.checkreports); } , 1500);
		}
    },
    deleteCheckedReports : function(deletes1, deletes0){
		var t = DeleteReports;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.s1rids = deletes1.join(",");
		params.s0rids = deletes0.join(",");
		params.cityrids = '';
		new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/deleteCheckedReports.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			onSuccess: function (rslt) {
				if(rslt.ok){
					Seed.newReportCount = parseInt(Seed.newReportCount) - parseInt(deletes1.length) - parseInt(deletes0.length);
					actionLog("Rapport", "Suppression de "+(parseInt(deletes1.length)+parseInt(deletes0.length))+" Rapports automatiquement");
				} else {
				  actionLog("Rapport", "Erreur Suppression des rapports : "+ rslt.msg);
				}
				t.deleting = false;
			},
			onFailure: function () {
			 actionLog("Rapport", "Erreur Suppression des rapports : "+ rslt.msg);
			 t.deleting = false;
			},
		});
    },
    isMyself: function(userID){
		var t = DeleteReports;
		if(!Seed.players["u"+userID])
			return false;
		if(Seed.players["u"+userID].n == Seed.player.name)
			return true;
		else
			return false;
		return false;
    },
}


var tabManager = {
  tabList : {},
  currentTab : null,
  init : function (mainDiv){
    var t = tabManager;
    var sorter = [];
    for (k in Tabs){
      if (!Tabs[k].tabDisabled){
        t.tabList[k] = {};
        t.tabList[k].name = k;
        t.tabList[k].obj = Tabs[k];
        if (Tabs[k].tabLabel != null)
          t.tabList[k].label = Tabs[k].tabLabel;
        else
          t.tabList[k].label = k;
        if (Tabs[k].tabOrder != null)
          sorter.push([Tabs[k].tabOrder, t.tabList[k]]);
        else
          sorter.push([1000, t.tabList[k]]);
        t.tabList[k].div = document.createElement('div');
      }
    }

    sorter.sort (function (a,b){return a[0]-b[0]});
    var m = '<TABLE cellspacing=0 cellpadding=0><TR>';
    for (var i=0; i<sorter.length; i++){
     m += '<TD align=center class=BOTabNotSel id=pbtc'+ sorter[i][1].name +'><A><SPAN class="matTab">'+ sorter[i][1].label +'</span></a></td>';
      if (i==8 || i==17) m+='</tr><tr>';
    }
    m+='</tr></table>';
    mainPop.getMainTopDiv().innerHTML = m;

    for (k in t.tabList) {
      if (t.tabList[k].name == Options.currentTab)
        t.currentTab =t.tabList[k] ;
      ById('pbtc'+ k).addEventListener('click', this.e_clickedTab, false);
      var div = t.tabList[k].div;
      div.style.display = 'none';
      div.style.height = '100%';
      mainDiv.appendChild(div);
      try {
        t.tabList[k].obj.init(div);
      } catch (e){

      }
    }

    if (t.currentTab == null)
      t.currentTab = sorter[0][1];
    t.setTabStyle (document.getElementById ('pbtc'+ t.currentTab.name), true);
    t.currentTab.div.style.display = 'block';
  },

  hideTab : function (){
    var t = tabManager;
    t.currentTab.obj.hide();
  },

  showTab : function (){
    var t = tabManager;
    t.currentTab.obj.show();
  },

  setTabStyle : function (e, selected){
    if (selected){
      e.className = 'BOTabSel';
    } else {
      e.className = 'BOTabNotSel';
    }
  },
  e_clickedTab : function (e){
    var t = tabManager;
    newTab = t.tabList[e.target.parentNode.parentNode.id.substring(4)];
    if (t.currentTab.name != newTab.name){
      t.setTabStyle (document.getElementById ('pbtc'+ t.currentTab.name), false);
      t.setTabStyle (document.getElementById ('pbtc'+ newTab.name), true);
      t.currentTab.obj.hide ();
      t.currentTab.div.style.display = 'none';
      t.currentTab = newTab;
      newTab.div.style.display = 'block';
      Options.currentTab = newTab.name;
    }
    newTab.obj.show();
  },
  e_clickedTab2 : function (name){
      var t = tabManager;
      newTab = t.tabList[name.substring(4)];
      if (t.currentTab.name != newTab.name){
        t.setTabStyle (document.getElementById ('pbtc'+ t.currentTab.name), false);
        t.setTabStyle (document.getElementById ('pbtc'+ newTab.name), true);
        t.currentTab.obj.hide ();
        t.currentTab.div.style.display = 'none';
        t.currentTab = newTab;
        newTab.div.style.display = 'block';
        Options.currentTab = newTab.name;
      }
      newTab.obj.show();
  },
}


ptStartup ();
