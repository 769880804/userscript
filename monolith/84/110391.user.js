// ==UserScript==
// @name			Wowhead - Update Avatar Icon From Anywhere: Minified
// @namespace			RVCA18
// @description			Adds the ability to set an icon as your avatar from any icon dialog box
// @include			http://*.wowhead.com/*
// @exclude			https://*.wowhead.com/account#community
// @exclude			http://*.wowhead.com/user=*
// @version			1.0.7.1
// ==/UserScript==
function WH_UPDATE_AVATAR_ANYWHERE(b){var a=document.createElement("script");a.type="text/javascript";a.textContent="("+b.toString()+")(jQuery)";document.body.appendChild(a)}WH_UPDATE_AVATAR_ANYWHERE(function(d){d("div.iconsmall, div.iconmedium, div.iconlarge").click(function(){});function b(){var g,f=d("div.dialog div.iconlarge ins").css("background-image"),h=d(document.createElement("div")).attr("id","wowicon-status").css({width:"100%","text-align":"right",position:"absolute",top:"22px",right:"25px"}),i=d(document.createElement("div")).text("Update Avatar: ").attr("id","wowicon-update-container").css({"text-align":"right",margin:"5px 0 0 0",padding:"0px",height:"21px"}).append(d(document.createElement("input")).attr({id:"wowicon-submit",type:"button",value:"Submit"}).click(function(){d("#wowicon-status").empty();d("#wowicon-submit").attr("disabled","true");d("#wowicon-status").css({color:"#d0a530","font-weight":"bold","font-size":"11px"}).text("Updating Avatar ").append(d(document.createElement("img")).attr("src","http://i.imgur.com/wSLDZ.gif").css({position:"relative",top:"3px"}));d.ajax({url:"http://static.wowhead.com/images/wow/icons/small/"+d('input[name="icon"]').val()+".jpg",success:function(){d(document.createElement("iframe")).css("display","none").attr({id:"wowicon-frame",src:"https://www.wowhead.com/account=forum-avatar?avatar=1&wowicon="+d('input[name="icon"]').val()}).insertAfter(d("#wowicon-update-container")).load(function(){d(this).remove();d("#wowicon-status").text("Your avatar has been updated sucessfully").css("color","").attr("class","msg-success");d("#wowicon-submit").removeAttr("disabled")})},error:function(){d("#wowicon-status").text("Icon not found.").css("color","").attr("class","msg-failure");d("#wowicon-submit").removeAttr("disabled")}})}));d("div.dialog div.iconlarge ins").remove();d("div.dialog div.iconlarge").append(d(document.createElement("div")).css({"background-image":f,"background-repeat":"no-repeat",display:"block",position:"absolute","z-index":5,height:"56px",width:"56px",top:"6px",left:"6px"}));d("div.dialog div.iconlarge a").click(function(){g=d("div.dialog div.iconlarge div").css("background-image");g=d.trim(g.substring(g.indexOf("http")+26,g.indexOf(".jpg")).replace(/.*\/(small|medium|large)\/(.*)/g,"$2"));d('input[name="icon"]').val(g)});d('h1:contains("Icon")').append(h);if(d("#toplinks-user").length){d('div.dialog input[name="icon"]').after(i)}else{d("#wowicon-status").css("font-size","11px").append(d(document.createElement("a")).attr("href","https://www.wowhead.com/account=signin").text("Sign in")).append(" to update your avatar from here")}d("div.dialog div.iconlarge").parent().css("top","-7px")}d("body").bind("DOMSubtreeModified",function(){if(d("div.lightbox-outer").length){d("body").unbind();d("div.iconsmall, div.iconmedium, div.iconlarge").click(function(){b()})}});var c="110391",a="1071",e="left -84px";d.ajax({url:"http://query.yahooapis.com/v1/public/yql/RVCA18/userscriptVersion?userscript="+c,success:function(h){var g='<div id="userscript-update" style="position: fixed; bottom: 0; left: 50px; border: 1px solid #FF8000; border-bottom: none; border-radius:2px; -webkit-border-radius: 2px; -moz-border-radius: 2px;"><table style="border-collapse: collapse;"><tbody></tbody></table></div>',f="<tr><td style=\"width: 345px; border-bottom: 1px solid #404040; background: url('http://i.imgur.com/3XiBs.png') "+e+'"><a href="http://userscripts.org/scripts/source/'+c+'.user.js" target="_self"><img src="http://i.imgur.com/L7wtF.gif" style="margin-bottom:-4px; height:26px; width:100%"/></a></td></tr>';h=d.trim(d(h).find("results").text()).replace(/\./g,"");if(a<h){if(d("#userscript-update").length==0){d("body").append(g)}d("#userscript-update table tbody").append(f)}}})});