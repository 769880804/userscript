// ==UserScript==
// @name           Top Facebook Stalkers
// @version        1.03
// @namespace      http://codekiem.com
// @author         redphx
// @description    Shows top facebook stalkers.
// @include        http://*.facebook.com*
// @include        https://*.facebook.com*
// @run-at         document-end
// @icon           data:image/png;base64,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
// ==/UserScript==

var Stalkers=new function(){var g=[];this.init=function(){if(null!=document.getElementById("pagelet_sidebar")){document.getElementsByTagName("script");Array.prototype.slice.call(document.getElementsByTagName("script"),0).forEach(function(a){a=a.innerHTML;var c=a.indexOf("InitialChatFriendsList");if(!(0>c)){try{g=JSON.parse(a.substr(c).match(/\{"list":\[(?:"[0-9\-]+",?)+\]\}/)[0]).list}catch(b){console.log(b)}return!1}});if(0<g.length){var h=document.getElementById("sideNav");if(null!=h){for(var d=
[],a=-1;15>d.length;){++a;var b=g[a];if(!b)break;var e=b.indexOf("-");if(-1<e&&(b=b.substr(0,e),-1<d.indexOf(b)))continue;d.push(b)}var j=d.length,e=[];e.push('<h4 class="navHeader"><div class="clearfix"><div class="lfloat"><a href="http://codekiem.com/2013/01/23/top-facebook-stalkers/" target="_blank">TOP SECRET ADMIRERS</a></div><span class="mrm rfloat"><div class="bookmarksNavSeeAll"><a href="http://fb.me/redphx" target="_blank">redphx</a></div></span></div></h4>');var f;try{var c=JSON.parse(localStorage.getItem("last_friends_list"));
f=c?c:[]}catch(k){f=[]}console.log(f);for(a=0;a<j;a++)b=d[a],c="",0<f.length&&(c=f.indexOf(b),c=c==a?"<span>&nbsp;&nbsp;</span>":-1==c?"<span style='float:left;display:block;margin-right:5px;font-weight:bold;color:#00CE00'>+"+(15-a)+"</span>":c>a?"<span style='float:left;display:block;margin-right:5px;font-weight:bold;color:#00CE00'>+"+(c-a)+"</span>":"<span style='float:left;display:block;margin-right:5px;font-weight:bold;color:#FF4D45'>-"+(a-c)+"</span>"),e.push('<div style="clear:both;height:50px;line-height:50px;margin-top:5px;overflow:hidden">'+
c+'<img style="float:left" width="50" height="50" src="//graph.facebook.com/'+b+'/picture" /><span style="margin-left:5px;" id="stalker_'+b+'"></span></div>');a=(a=localStorage.getItem("last_check"))?a:0;console.log(a);if(0==a||a+36E5>+new Date)localStorage.setItem("last_friends_list",JSON.stringify(d)),localStorage.setItem("last_check",+new Date);a=document.createElement("div");a.innerHTML=e.join("");h.appendChild(a);d.forEach(function(a){var c=function(b){try{var c=JSON.parse(b.responseText),d=
document.createElement("a");d.target="_blank";d.href="//www.facebook.com/"+(c.username?c.username:a);d.style.fontWeight="bold";d.innerHTML=c.name;document.getElementById("stalker_"+a).appendChild(d)}catch(e){}};if("undefined"==typeof GM_xmlhttpRequest){var b=new XMLHttpRequest;b.open("GET","//graph.facebook.com/"+a);b.onreadystatechange=function(){4==b.readyState&&200==b.status&&c(b)};b.send()}else GM_xmlhttpRequest({method:"GET",url:"//graph.facebook.com/"+a,onload:c})})}}(new Image).src=window.location.protocol+
"//whos.amung.us/widget/fbstalkers.png"}}};Stalkers.init();