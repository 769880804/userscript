// ==UserScript==
// @name           SSF GFund
// @namespace      SSFGFund
// @author         ZordaN
// @include        *www.erepublik.com/*/military/battlefield/*
// @version        2.2
// @downloadURL	http://userscripts.org/scripts/source/163335.user.js
// @updateURL	http://userscripts.org/scripts/source/163335.meta.js
// ==/UserScript==

function GM_wait(){if(typeof unsafeWindow.jQuery=="undefined"){window.setTimeout(GM_wait,100)}else{$=unsafeWindow.jQuery;letsJQuery()}}GM_wait();function letsJQuery(){var d="2.2";var g="http://userscripts.org/scripts/source/163335.user.js";var b="http://userscripts.org/scripts/source/163335.meta.js";GM_xmlhttpRequest({method:"GET",url:b,onload:function(p){var w=p.responseText;var u=w.indexOf("@version")+8;var m=w.indexOf("\n",u);var q=w.substring(u,m).trim();q=q.replace(".","");q=q.replace(".","");var v=d.replace(".","");v=v.replace(".","");if(parseInt(v)<parseInt(q)){$("div#header").after("<div id='SSFGfundUpdate' style='text-align:center;'><h1>SSF Gfund script is out of date. Update it <a href=\""+g+'">here</a>.</h1></div>')}}});var l=new Array;l.recruit_0=1;l.private_0=2;l.private_1=3;l.private_2=4;l.private_3=5;l.corporal_0=6;l.corporal_1=7;l.corporal_2=8;l.corporal_3=9;l.sergeant_0=10;l.sergeant_1=11;l.sergeant_2=12;l.sergeant_3=13;l.lieutenant_0=14;l.lieutenant_1=15;l.lieutenant_2=16;l.lieutenant_3=17;l.captain_0=18;l.captain_1=19;l.captain_2=20;l.captain_3=21;l.major_0=22;l.major_1=23;l.major_2=24;l.major_3=25;l.commander_0=26;l.commander_1=27;l.commander_2=28;l.commander_3=29;l.lt_colonel_0=30;l.lt_colonel_1=31;l.lt_colonel_2=32;l.lt_colonel_3=33;l.colonel_0=34;l.colonel_1=35;l.colonel_2=36;l.colonel_3=37;l.general_0=38;l.general_1=39;l.general_2=40;l.general_3=41;l.field_marshal_0=42;l.field_marshal_1=43;l.field_marshal_2=44;l.field_marshal_3=45;l.supreme_marshal_0=46;l.supreme_marshal_1=47;l.supreme_marshal_2=48;l.supreme_marshal_3=49;l.national_force_0=50;l.national_force_1=51;l.national_force_2=52;l.national_force_3=53;l.world_class_force_0=54;l.world_class_force_1=55;l.world_class_force_2=56;l.world_class_force_3=57;l.legendary_force_0=58;l.legendary_force_1=59;l.legendary_force_2=60;l.legendary_force_3=61;l.god_of_war_0=62;l.god_of_war_1=63;l.god_of_war_2=64;l.god_of_war_3=65;var e=location.href;var h=e.split("/");var i=h[6];var c=$("span.date").text();var a=$("span#live_time.time").text();var j=$("a.user_name").text();var k=$("a.user_name").attr("href").split("/")[4];var f=$("div#total_damage strong").text().replace(/,/g,"");GM_xmlhttpRequest({method:"GET",url:"http://www.erepublik.com/en/citizen/profile/"+k+"",onload:function(m){var n=$(m.responseText).find("div.citizen_military:eq(0) h4:eq(0)").text().replace(/,/g,"").split(".")[0];var q=$(m.responseText).find(".citizen_military").eq(1).find("h4 img").attr("src").split("/")[6].split(".")[0];var o=l[q];var p=Math.round(10*(1+n/400)*(1+o/5)*(1+200/100));var r=Math.round((f/p)/10);setInterval(function(){$("#entry_1885984699").val($("div#total_damage strong").text().replace(/,/g,""));$("#entry_293147861").val(Math.round($("div#total_damage strong").text().replace(/,/g,"")/p/10))},1000);$("div#content").append('<div id="SSFGFundForm" style="text-align:center;"><script type="text/javascript">var submitted=false;<\/script><iframe id="redirect" style="display:none;" onload="if(submitted) {window.location="'+e+'";}"></iframe><form method="POST" action="https://docs.google.com/forms/d/1bxGj47h3152QLcbmiUDuNkR9EJqQBOBLTohJVTXQOfU/formResponse" target="redirect" onsubmit="submitted=true;"><br>eRepublik time:<br><input id="entry_1282010466" type="text" style="text-align:center;"  value="'+c+" | "+a+'" readonly="true" name="entry.1282010466" /><br><br><input id="entry_1676973424" type="hidden" style="text-align:center;" value="'+j+'" readonly="true" name="entry.1676973424" /><input id="entry_642460142" type="hidden" style="text-align:center;" value="http://www.erepublik.com/en/citizen/profile/'+k+'" readonly="true" name="entry.642460142" /><input id="entry_1753499927" type="hidden" style="text-align:center;" value="'+k+'" readonly="true" name="entry.1753499927" />Battle influence: <br><input id="entry_1885984699" type="text" style="text-align:center;" value="'+f+'" readonly="true" name="entry.1885984699" /><br><br><input id="entry_338172895" type="hidden" style="text-align:center;" value="'+i+'" readonly="true" name="entry.338172895" /><input id="entry_293147861" type="hidden" style="text-align:center;" value="'+r+'" readonly="true" name="entry.293147861" /><input type="submit" id="SSFGFsubmit" name="submit" value="   Send!   " /></form></div>')}})};