// ==UserScript==
// @name       Warrior's MyBNI.NET Helpers
// @namespace  http://use.i.E.your.homepage/
// @version    1.0
// @description  enter something useful
// @match      http://mybni.net/vn/Warrior/Ban-hoi-vien/Phieu-gioi-thieu.aspx
// @copyright  02/04/2014 by Alex Nguyen (dungtn@gmail.com)
// ==/UserScript==

  // '': { f: '',        s: '', m: '', e: ''},

warriors = {
  '0000000785': { f: 'Nguyễn Mạnh Hà',        s: 'Hà Thiết bị điện  ', m: '0913511253', e: 'haquan0909@gmail.com'},	
  '0000000784': { f: 'Lê Văn Trường',         s: 'Trường Kiểm Toán  ', m: '0903284568', e: 'vantruong2008@gmail.'},
  '0000000606': { f: 'Đặng Xuân Thủy',        s: 'Thuỷ Cây Xanh     ', m: '', e: 'thanglongngannam@gmail.com'},
  '0000000687': { f: 'Lưu Minh Ngọc',         s: 'Ngọc Bất Động Sản ', m: '0947514888', e: 'ngocluuminh@bacson.vn'},
  '0000000628': { f: 'Đồng Minh Hậu',         s: 'Hậu Gỗ Óc Chó     ', m: '0989698866', e: 'ntdonggia@gmail.com'},
  '0000000627': { f: 'Nguyễn Kim Anh',    s: 'Kim Anh Văn Phòng Phẩm', m: '0988568151', e: 'ct_thanh_dat@yahoo.com'},
  '0000000368': { f: 'Nguyễn Ngọc Bích',      s: 'Bích Thời trang   ', m: '0989190646', e: 'ngocbich@nefertiti.com.vn'},
  '0000000359': { f: 'Nguyễn Thanh Biên',     s: 'Biên Led          ', m: '0945091177', e: 'biennt2002@gmail.com'},
  '0000000095': { f: 'Hoàng Ngọc Bình',    s: 'Bình Vệ sinh      ', m: '0904045044', e: 'Binhc25@gmail.com'},
  '0000000048': { f: 'Dương Thị Hải Bình',    s: 'Bình Sự kiện      ', m: '0976678999', e: 'hai_binh2003@yahoo.com'},
  '0000000049': { f: 'Nguyễn Đình Chiến',     s: 'Chiến Ô Tô        ', m: '0904999688', e: 'chienhcautotech@gmail.com'},
  '0000000050': { f: 'Đỗ Ngọc Cường',         s: 'Cường Mcrio       ', m: '0904292268', e: 'admin@ckcompany.vn'},
  '0000000051': { f: 'Đặng Quốc Cường',       s: 'Cường Bếp         ', m: '0985399999', e: 'dangquoccuong@gmail.com'},
  '0000000092': { f: 'Nguyễn Vĩnh Cường',     s: 'Cường Thương hiệu ', m: '0902209559', e: 'vinhcuong@anhoa.net'},
  '0000000052': { f: 'Nguyễn Văn Dân',        s: 'Dân Thạch cao     ', m: '0982377666', e: 'nguyendan.dceo@gmail.com'},
  '0000000053': { f: 'Nguyễn Thị Ngọc Dung',  s: 'Dung VIB          ', m: '0913036918', e: 'sumo1405@gmail.com'},
  '0000000054': { f: 'Lê Dũng',               s: 'Dũng IDT          ', m: '0984888488', e: 'ledung@idt.vn'},
  '0000000364': { f: 'Nguyễn Tiến Dũng',      s: 'Dũng Vinova       ', m: '0903068888', e: 'alex@vinova.vn'},
  '0000000055': { f: 'Vũ Thị Thùy Dương',     s: 'Dương Thêu        ', m: '0946089688', e: 'duong.qilila@vinaem.vn'},
  '0000000366': { f: 'Nguyễn Thanh Giang',    s: 'Giang Sách        ', m: '0903269899', e: 'giangbooks77@gmail.com'},
  '0000000367': { f: 'Đỗ Thu Hà',             s: 'Hà Photo / scan   ', m: '0989068845', e: 'invietlong@vietlong.net.vn'},
  '0000000057': { f: 'Đào Duy Hà',            s: 'Hà Kiho           ', m: '0904980888', e: 'kiho.rc@gmail.com'},
  '0000000058': { f: 'Nguyễn Thị Hà',         s: 'Hà Anh Sơn spec   ', m: '0989743689', e: 'Haanhpaint@gmail.com'},
  '0000000060': { f: 'Đinh Văn Hải',          s: 'Hải GS            ', m: '0917359482', e: 'haidv@gs.edu.vn'},
  '0000000061': { f: 'Lê Quang Hán',          s: 'Hán Mã vạch       ', m: '0917886988', e: 'tt06@tanphat.com.vn'},
  '0000000062': { f: 'Đào Ngọc Hiền',         s: 'Hiền Rèm          ', m: '0912419016', e: 'remanmy@gmail.com'},
  '0000000064': { f: 'Trịnh Việt Hùng',       s: 'Hùng Cửa kính     ', m: '0989881881', e: 'safewindow.vn@gmail.com'},
  '0000000065': { f: 'Trần Đăng Hùng',        s: 'Hùng Báo          ', m: '0912065819', e: 'doanhnghiephoinhap@gmail.com'},
  '0000000066': { f: 'Nguyễn Thế Hùng',       s: 'Hùng Web          ', m: '0904762534', e: 'thehung@vinades.vn'},
  '0000000068': { f: 'Đỗ Đình Hưng',          s: 'Hưng Quả (củ)     ', m: '0975285688', e: 'agriviethung@gmail.com'},
  '0000000069': { f: 'Vũ Thu Hương',          s: 'Hương Quà tặng    ', m: '0944245885', e: 'huongvt@vnbestgift.com'},
  '0000000361': { f: 'Đặng Trung Kiêu',       s: 'Kiêu Răng         ', m: '0936666988', e: 'dtkdentist@gmail.com'},
  '0000000071': { f: 'Trương Thị Phương Linh',s: 'Linh Thẩm mỹ      ', m: '0916571345', e: 'phuonglinh.auviet@gmail.com'},
  '0000000072': { f: 'Nguyễn Hoàng Long',     s: 'Long Thẻ          ', m: '0934563638', e: 'long79.nh@gmail.com'},
  '0000000073': { f: 'Vũ Hoàng Long',         s: 'Long Haven        ', m: '0904920384', e: 'EnglishWithQuyen@gmail.com'},
  '0000000045': { f: 'Phạm Thành Long',       s: 'Long Luật sư      ', m: '0913553222', e: 'longpt@luatgiapham.com.vn'},
  '0000000365': { f: 'Hoàng Mộng Long',       s: 'Long Du Học       ', m: '0947892000', e: 'longhoangvwhn@gmail.com'},
  '0000000356': { f: 'Đặng Văn Minh',         s: 'Minh IPA SmartHome', m: '0932416688', e: 'Minh.Dangvan@Ipavietnam.vn'},
  '0000000076': { f: 'Nguyễn Văn Minh',       s: 'Minh Đồ chơi      ', m: '0903402926', e: 'vanminh@dochoivanminh.vn'},
  '0000000357': { f: 'Nguyễn Phương Ngân',    s: 'Ngân Tàu nhanh    ', m: '0902128648', e: 'thegioiviet2000@gmail.com'},
  '0000000078': { f: 'Trần Xuân Phú',         s: 'Phú Bảo vệ        ', m: '0973588779', e: 'baovelongphu@gmail.com'},
  '0000000079': { f: 'Đào Lan Phương',        s: 'Phương Vmic       ', m: '0903236566', e: 'lanphuong@vmic.vn'},
  '0000000080': { f: 'Phạm Xuân Phương',      s: 'Tam Nguyên P.Thuỷ ', m: '0968689119', e: 'Phamphuong@9119.vn'},
  '0000000360': { f: 'Nguyễn Lương Phương',   s: 'Phương Tu bổ      ', m: '0902161615', e: 'luongphuong78@gmail.com'},
  '0000000067': { f: 'Nguyễn Hùng Sơn',       s: 'Sơn FSI           ', m: '0904777168', e: 'sonnh@fsivietnam.com.vn'},
  '0000000081': { f: 'Đoàn Quang Thắng',      s: 'Thắng Phương đông ', m: '0912019698', e: 'thangdq@hanhtrinh-phuongdong.com'},
  '0000000083': { f: 'Nguyễn Đăng Thắng',     s: 'Thắng AI nội thất ', m: '0908589105', e: 'thang.nguyen@aico.vn'},
  '0000000082': { f: 'Phạm Văn Thanh',        s: 'Thanh Camera      ', m: '0942942565', e: 'thanh.pv@phuongnamco.net'},
  '0000000362': { f: 'Nguyễn Đắc Thành',      s: 'Thành Kiểm toán   ', m: '0913037615', e: 'thanhdacfacom@gmail.com'},
  '0000000084': { f: 'Nguyễn Tiến Thế',       s: 'Thế Điều hoà      ', m: '0982356523', e: 'thenguyen@thedat.com.vn'},
  '0000000056': { f: 'Đoàn Thái Thiện',       s: 'Thiện Rich Media  ', m: '0988005789', e: 'doanthaithien@gmail.com'},
  '0000000085': { f: 'Nguyễn Thị Thu Thuỷ',   s: 'Thuỷ THL in ấn    ', m: '0932277811', e: 'congtythl@gmail.com'},
  '0000000358': { f: 'Đoàn Đức Tiến',         s: 'Tiến VTM GoogleAds', m: '0943999365', e: 'tien-doan@vtmgroup.com.vn'},
  '0000000094': { f: 'Lê Đức Tôn',           s: 'Tôn LLuma         ', m: '0904690266', e: 'Leton@llumar.com.vn'},
  '0000000086': { f: 'Nguyễn Mạnh Trường',    s: 'Trường Lifetek    ', m: '0904143388', e: 'truongnm@lifetek.com.vn'},
  '0000000088': { f: 'Lê Anh Tuấn',           s: 'Tuấn Tek          ', m: '0903456682', e: 'tuan@tekmobi.vn'},
  '0000000089': { f: 'Tạ Quốc Tuấn',          s: 'Tuấn Mối          ', m: '0977036666', e: 'quocphongjsc123@gmail.com'},
  '0000000046': { f: 'Hà Anh Tuấn',           s: 'Tuấn Vinalink     ', m: '0988577427', e: 'tuanha@company.vn'},
  '0000000363': { f: 'Phạm Quang Tuấn',       s: 'Tuấn Tàu          ', m: '0913234142', e: 'tuanppg@gmail.com'},
  '0000000090': { f: 'Phạm Thanh Tùng',       s: 'Tùng Rượu         ', m: '0912099800', e: 'phamtung@phugiajsc.vn'},
  '0000000370': { f: 'Phạm Thị Vân',          s: 'Vân Enterbuy      ', m: '0435510165', e: 'support@enterbuy.vn'},
  '0000000093': { f: 'Lý Kim Xuân',           s: 'Xuân Phát điện    ', m: '0903291979', e: 'xuannguyen6769@gmail.com'}
};

function warriorNick(id, name) {
  var w = warriors[id];
  if (w)
    return [w.s.replace(/\s/g, ' '), w.f].join(' | ');
  else
    console.log(id);
    if (name.indexOf('|') >= 0) return name;
    a = name.split(' ');
    firstName = a.pop();
    return [firstName, name].join(' | ');
};
    
function warriorSortOptions(selector) {
  var options = $(selector + ' option');
  var arr = options.map(function(_, o) { return { t: warriorNick(o.value, $(o).text()), v: o.value }; }).get();
  arr.sort(function(o1, o2) { return o1.t > o2.t ? 1 : o1.t < o2.t ? -1 : 0; });
  options.each(function(i, o) {
    o.value = arr[i].v;
    $(o).text(arr[i].t);
  });
};

function warriorFillDefaultInfo() {
  $('#ctl00_ContentPlaceHolder1_rdbKhachhangbenngoai, #ctl00_ContentPlaceHolder1_rdbDaguithongtin, #ctl00_ContentPlaceHolder1_rdbDathongbao').attr('checked', false);
  $('#ctl00_ContentPlaceHolder1_rdbNoibo').attr('checked', true);
  var id = $('#ctl00_ContentPlaceHolder1_ddlNguoigioithieu option:selected').attr('value');
  var w = warriors[id];
  $('#ctl00_ContentPlaceHolder1_txtThongtinkhachhang').attr('value', [w.f, w.s].join('\n'));
  $('#ctl00_ContentPlaceHolder1_txtDienthoai').attr('value', w.m);
  $('#ctl00_ContentPlaceHolder1_txtEmail').attr('value', w.e);  
}

function warriorClearDefaultInfo() {
  $('#ctl00_ContentPlaceHolder1_txtThongtinkhachhang').attr('value', '');
  $('#ctl00_ContentPlaceHolder1_txtDienthoai').attr('value', '');
  $('#ctl00_ContentPlaceHolder1_txtEmail').attr('value', '');
  $('#ctl00_ContentPlaceHolder1_txtThongtinkhachhang').focus();
}

function warriorDisableAjax() {
  document.getElementById('ctl00_ContentPlaceHolder1_ddlNguoigioithieu').onchange = undefined;
  document.getElementById('ctl00_ContentPlaceHolder1_ddlNguoinhangioithieu').onchange = undefined;
  document.getElementById('ctl00_ContentPlaceHolder1_rdbNoibo').onclick = undefined;
  document.getElementById('ctl00_ContentPlaceHolder1_rdbKhachhangbenngoai').onclick = undefined;
};

$(document).delegate('#ctl00_ContentPlaceHolder1_rdbKhachhangbenngoai', 'click', function () {
  warriorClearDefaultInfo();
});

$(document).delegate('#ctl00_ContentPlaceHolder1_ddlNguoigioithieu', 'change', function () { 
  warriorFillDefaultInfo(); 
});

$(document).delegate('#ctl00_ContentPlaceHolder1_ddlNguoigioithieu', 'mousedown', function () { 
  warriorDisableAjax();
  warriorSortOptions('#ctl00_ContentPlaceHolder1_ddlNguoigioithieu'); 
});

$(document).delegate('#ctl00_ContentPlaceHolder1_ddlNguoinhangioithieu', 'change', function () { 
  warriorFillDefaultInfo();
  $('#ctl00_ContentPlaceHolder1_txtNhanxetkhachhang').focus();
});

$(document).delegate('#ctl00_ContentPlaceHolder1_ddlNguoinhangioithieu', 'mousedown', function () {
  warriorDisableAjax();
  warriorSortOptions('#ctl00_ContentPlaceHolder1_ddlNguoinhangioithieu');
});