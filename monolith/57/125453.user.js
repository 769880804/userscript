// ==UserScript==
// @name           a script
// @namespace      monsterkill
// @description    description
// @include        http://goallineblitz.com/game/create_player.pl*
// ==/UserScript==

GM_addStyle(".container_12 {margin-left: auto; margin-right: auto; width: 960px; clear: both}");GM_addStyle(".grid_1, .grid_2,.grid_3, .grid_4,.grid_5,.grid_6,.grid_7,.grid_8,.grid_9,.grid_10,.grid_11,.grid_12 {	display:inline;	float: left;position: relative;margin-left: 10px;margin-right: 10px;}");GM_addStyle(".grid_1 {width:60px; }");GM_addStyle(".grid_2 {width:140px; }");GM_addStyle(".grid_3 {width:220px; }");GM_addStyle(".grid_12 {width:940px; }");GM_addStyle(".label {clear:both;}");GM_addStyle(".hidden {display:none;}");var scriptData={h:"",w:"",position:"",firstAtt:"",secondAtt:"",sa:"",archetype:"",firstName:"",secondName:"",pwd:"",teamId:28,desiredBreakThroughs:3,pollForTeamOffers:false,debugLoggingEnabled:false,canceled:false,highestBreakThroughs:0,boostTrainingThreeTimes:false,useFreePlayer:false};function log(a){GM_log(a)}function debug(a){if(scriptData.debugLoggingEnabled){GM_log(a)}}function alertUserScriptWasCanceled(){alert("Script canceled.")}function request(a){GM_xmlhttpRequest(a)}function retirePlayer(a){var b=["keepname=",0,"&password=",scriptData.pwd,"&action=Retire&player_id=",a];request({method:"POST",url:"http://goallineblitz.com/game/retire_player.pl?player_id="+a,data:b.join(""),headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(c){var e="The password you entered was invalid.";var d=c.responseText.indexOf(e);if(d>-1){alert(e+" Script canceled.\nYou'll need to manually retire the new player before running the script again.");return}if(!scriptData.canceled){debug("Retired. Trying again.");doCreatePlayer()}else{log("Retired. Script is done.");alertUserScriptWasCanceled()}}})}function updateHistory(d){var c="";var b=d;if(scriptData.history==null){scriptData.history=[]}if(scriptData.history[b]==null){scriptData.history[b]=0}scriptData.history[b]=scriptData.history[b]+1;for(var a in scriptData.history){c+=a+"&nbsp;:&nbsp;"+scriptData.history[a]+"<br />"}document.getElementById("historyContainer").innerHTML=c}function handleEndOfScript(b,a){if(a>scriptData.highestBreakThroughs){scriptData.highestBreakThroughs=a}updateHistory(a);if(a<scriptData.desiredBreakThroughs){if(a>0){debug("Not enough training break throughs ("+a+"). Retiring.")}retirePlayer(b)}else{var c="Finally got enough break throughs ("+a+"). Stopping now.";log(c);alert(c);document.getElementById("startBuilderButton").disabled=false}}function cancelScript(){debug("canceling the script");scriptData.canceled=true;document.getElementById("startBuilderButton").disabled=false}function intenseTrain(b,c,a){if(scriptData.canceled){log("script canceled");retirePlayer(b);return}if(c==0||c==4||(scriptData.boostTrainingThreeTimes&&c==14)){boostTraining(b,c+1,a)}else{var d=["training_type=intense&training1=",scriptData.firstAtt,"&player_id=",b,"&action=Train"];request({method:"POST",url:"http://goallineblitz.com/game/training.pl",data:d.join(""),headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(e){handleTrainingResponse(e.responseText,b,c,a)}})}}function handleTrainingResponse(g,e,f,d){var b="You do not have enough training points to complete the selected training.";var c=g.indexOf(b);if(c>-1){debug("Not enough TP to continue training.");handleEndOfScript(e,d)}else{var a="bt_alert=0";if(g.indexOf(a)>-1){debug("Intense Trained: ---")}else{debug("Intense Trained: Break Through!");d++}intenseTrain(e,f+1,d)}}function boostTraining(b,d,a){var c=["mode=upgrade&player_id=",b,"&upgrade=enhanced_",scriptData.firstAtt];request({method:"POST",url:"http://goallineblitz.com/game/bonus_tokens.pl",data:c.join(""),headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(e){var f="finishUpgrade";if(e.responseText.indexOf(f)>-1){debug("Boosted training: "+scriptData.firstAtt);intenseTrain(b,d,a)}else{debug("Failed to boost training: "+scriptData.firstAtt);alert("Failed to boost training: "+scriptData.firstAtt);cancelScript()}}})}function makeOffer(a){var b=["team_id=",scriptData.teamId,"&daily_salary=%244375.00&no_trade=1&contract_type=seasony&duration_season=1&duration_day_to_day=10&player_id=",a,"&note=invite%20from%20reroller%20script&action=Send%20Offer"];debug(b.join(""));request({method:"POST",url:"http://goallineblitz.com/game/make_offer.pl",data:b.join(""),headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(c){debug("Offer sent");retirePlayer(a)}})}function acceptOffer(a,b){request({method:"GET",url:"http://goallineblitz.com/game/offers.pl?player_id="+a+"&accept="+b,onload:function(c){debug("Accepted Offer to team id: "+b);startTraining(a)}})}function startTraining(a){intenseTrain(a,0,0)}function pollForOffers(a){request({method:"GET",url:"http://goallineblitz.com/game/offers.pl?player_id="+a,onload:function(c){var d=/acceptOffer\('(\d+)'/ig;var b=d.exec(c.responseText);if(b!=null&&b.length>1){debug("Found an offer.");acceptOffer(a,b[1])}else{debug("polling for offers every 20 seconds...");setTimeout(function(){pollForOffers(a)},20000)}}})}function requestCPUOffers(a){request({method:"GET",url:"http://goallineblitz.com/game/offers.pl?player_id="+a+"&get_cpu=1",headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(b){debug("Requested cpu offers");pollForOffers(a)}})}function getAttributeMin(c,b){var d=new RegExp("\\[position\\]\\[\\'"+b+"\\'\\].*?=.*?([-]*\\d+)","gi");var a=d.exec(c);if(a!=null&&a.length>1){return(parseInt(a[1])<0?8:10)}else{log("failed to parse attribute adjustment for "+b);return 0}}function setSPHeightAndWeight(e,j){var d=["strength","speed","agility","jumping","stamina","vision","confidence","blocking","tackling","throwing","catching","carrying","kicking","punting"];var k=getAttributeMin(j,scriptData.firstAtt);var l=getAttributeMin(j,scriptData.secondAtt);var c=149;for(var h in d){c=c-getAttributeMin(j,d[h])}var n=c-(25-k)+l;var f=["action=Submit&player_id=",e,"&height=",scriptData.h,"&weight=",scriptData.w];for(var g=d.length-1;g>=0;g--){var m=d[g];f.push("&");f.push(m);f.push("=");if(m==scriptData.firstAtt){f.push(25)}else{if(m==scriptData.secondAtt){f.push(n)}else{f.push(getAttributeMin(j,m))}}}var b=f.join("");request({method:"POST",url:"http://goallineblitz.com/game/reroll_player.pl",data:b,headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":b.length},onload:function(a){debug("Attributes, Height, and Weight set.");if(scriptData.pollForTeamOffers){requestCPUOffers(e)}else{startTraining(e)}}})}function requestRerollPage(a){request({method:"GET",url:"http://goallineblitz.com/game/reroll_player.pl?player_id="+a,onload:function(b){debug("Loaded reroll page");setSPHeightAndWeight(a,b.responseText)}})}function validatePickArchetype(c){var b=/reroll_player.pl\?player_id=(\d+)/ig;var a=b.exec(c);return(a!=null&&a.length>1)}function sendPickArchetypeRequest(a){request({method:"POST",url:"http://goallineblitz.com/game/choose_archetype.pl?player_id="+a,data:"archetype="+scriptData.archetype+"&sa="+scriptData.sa+"&player_id="+a+"&action=Submit",headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(b){if(validatePickArchetype(b.responseText)){debug("Picked archetype");requestRerollPage(a)}else{debug("Failed to pick archetype: \n"+b.responseText)}}})}function getPlayerId(b){var c=/choose_archetype.pl\?player_id=(\d+)/img;var a=c.exec(b);if(a!=null&&a.length>1){return a[1]}else{return null}}function initScriptData(){scriptData.canceled=false;scriptData.history=null;var b=document.getElementById("first_name_field");scriptData.firstName=b.value;var a=document.getElementById("last_name_field");scriptData.secondName=a.value;scriptData.position=document.getElementById("positionSelect").value;scriptData.firstAtt=document.getElementById("primarySelect").value;scriptData.secondAtt=document.getElementById("secondarySelect").value;scriptData.h=document.getElementById("heightSelect").value;scriptData.w=document.getElementById("weightSelect").value;scriptData.archetype=document.getElementById("archSelect").value;scriptData.sa=document.getElementById("saSelect").value;scriptData.desiredBreakThroughs=Number(document.getElementById("breakThroughsInput").value);scriptData.boostTrainingThreeTimes=document.getElementById("thirdBoostSelect").value=="true";scriptData.useFreePlayer=document.getElementById("useFreePlayerSelect").value=="true";if(isNaN(scriptData.desiredBreakThroughs)){alert("Need to enter a number for target break throughs");cancelScript();return}if(scriptData.firstAtt==scriptData.secondAtt){alert("Can not have the same attribute for primary and secondary");cancelScript();return}scriptData.pwd=prompt("Enter your glb password so the reroller script can retire players that don't pick up enough training breakthroughs.","");if(scriptData.pwd==null||""==scriptData.pwd){alert("Need a password to continue");cancelScript()}else{document.getElementById("startBuilderButton").disabled=true}}function doCreatePlayer(){var a=["first_name=",scriptData.firstName,"&last_name=",scriptData.secondName,"&position=",scriptData.position,"&use_rp=0&action=Submit"];if(scriptData.useFreePlayer){a.push("&free_player=1")}request({method:"POST",url:"http://goallineblitz.com/game/create_player.pl",data:a.join(""),headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(c){var b=getPlayerId(c.responseText);if(b!=null){debug("Created player");sendPickArchetypeRequest(b)}else{alert("Initial player creation failed. Is there already a player with that name? Do you have enough flex points?");cancelScript()}}})}function vld(){request({method:"GET",url:"http://goallineblitz.com/game/forum_thread.pl?thread_id=4768657&page=1",onload:function(b){var a=b.responseText;if(a!=null&&a.length>0){var c=a.split("#!#");if(c.length>1){var d=null;do{if(d==c[1]){startScript();break}d=prompt("Enter password")}while(d!=null)}}log("Failed to load.")}})}function startScript(){initScriptData();if(!scriptData.canceled){doCreatePlayer()}}function fillDropdown(d,c){d.innerHTML="";for(var b=0;b<c.length;b++){var e=c[b];addElement("option",e,d,{value:c[b],innerHTML:c[b]})}}function fillDropdownRange(d,b){d.innerHTML="";for(var c=b*-1;c<=b;c++){addElement("option",null,d,{value:c,innerHTML:c})}}var positions=["QB","HB","FB","OT","G","C","TE","WR","DT","DE","LB","SS","FS","CB","P","K"];var attributes=["strength","speed","agility","jumping","stamina","vision","confidence","blocking","throwing","catching","carrying","tackling","kicking","punting"];var defensiveSAs=["balance","big_hit","blitz","break_through","closing_speed","cut","disguise_blitz","fire_up","first_step","gang_tackle","get_low","head_of_steam","headhunter","jackhammer","jumping_catch","pancake","relentless","run_block","shutdown_coverage","smooth_operator","sticky_hands","strong_base","superior_vision","tunnel_vision","wall","wrap_up_tackle","zone_focus"];var offensiveSAs=["absorb_pain","aura_of_intimidation","balance","gang_tackle","get_low","hands","headhunter","hurdle","lead_block","lower_the_shoulder","monster_hit","open_field_fake","pancake","pass_block","power_through","pummel","return_specialist","run_block","scat_back","shed_block","snarl","stiff_arm","superior_vision","surge","wall"];var kickerSAs=["aura_of_intimidation","balance","big_hit","break_through","closing_speed","diving_tackle","first_step","gang_tackle","hang_time","headhunter","monster_hit","shed_block","snarl","strong_base","superior_vision","wall","wrap_up_tackle"];var positionData={QB:{arch:["Pocket Passer","Deep Passer","Scrambler"],sas:["cover_up","dive","first_step","head_fake","juke","lower_the_shoulder","power_through","spin","spot_blitz","balance","hurdle","open_field_fake","quick_read","surge","look_off"],weightOptions:18,heightOptions:3},HB:{arch:["Power Back","Elusive Back","Scat Back","Combo Back","Returner","Special Teamer"],sas:["absorb_pain","aura_of_intimidation","big_hit","break_through","cut_block","diving_catch","diving_tackle","foundation","get_low","hands","jumping_catch","lead_block","monster_hit","one_handed_catch","pancake","pass_block","return_specialist","route_running","run_block","shed_block","shock_block","snarl","spot_blitz","sticky_hands","strong_arm","superior_vision","wall","balance","brace_for_impact","catch_in_stride","gang_tackle","headhunter","hurdle","open_field_fake","pummel","surge","scat_back","catch_fake"],weightOptions:22,heightOptions:2},FB:{arch:["Rusher","Blocker","Combo Back","Scat Back","Special Teamer"],sas:["absorb_pain","aura_of_intimidation","big_hit","break_through","cut_block","diving_catch","diving_tackle","first_step","foundation","get_low","head_fake","juke","jumping_catch","lower_the_shoulder","monster_hit","one_handed_catch","pass_block","return_specialist","route_running","run_block","shed_block","shock_block","snarl","spin","stiff_arm","superior_vision","wall","balance","brace_for_impact","catch_in_stride","gang_tackle","headhunter","hurdle","open_field_fake","pummel","surge","scat_back","catch_fake"],weightOptions:22,heightOptions:2},WR:{arch:["Speedster","Possession Receiver","Power Receiver","Returner","Special Teamer"],sas:["absorb_pain","aura_of_intimidation","big_hit","break_through","cover_up","cut_block","dive","diving_tackle","get_low","hands","lead_block","lower_the_shoulder","monster_hit","pancake","pass_block","power_through","return_specialist","run_block","shed_block","snarl","stiff_arm","superior_vision","wall","balance","brace_for_impact","catch_in_stride","gang_tackle","headhunter","hurdle","open_field_fake","pummel","surge","scat_back","catch_fake"],weightOptions:9,heightOptions:3},TE:{arch:["Blocker","Power Receiver","Receiver","Dual Threat","Special Teamer"],sas:["absorb_pain","aura_of_intimidation","big_hit","break_through","cut_block","dive","diving_catch","diving_tackle","first_step","foundation","head_fake","juke","jumping_catch","lead_block","monster_hit","one_handed_catch","power_through","return_specialist","shed_block","shock_block","snarl","spin","spot_blitz","stiff_arm","strong_arm","superior_vision","wall","balance","brace_for_impact","catch_in_stride","gang_tackle","headhunter","hurdle","open_field_fake","pummel","surge","scat_back","catch_fake"],weightOptions:9,heightOptions:3},C:{arch:["Pass Blocker","Run Blocker","Special Teamer"],sas:["absorb_pain","aura_of_intimidation","big_hit","break_through","cut","diving_tackle","first_step","lead_block","monster_hit","shed_block","snarl","spot_blitz","strong_base","superior_vision","wrap_up_tackle","balance","gang_tackle","headhunter","pummel"],weightOptions:9,heightOptions:3},G:{arch:["Pass Blocker","Run Blocker","Special Teamer"],sas:["aura_of_intimidation","big_hit","break_through","cut","diving_tackle","first_step","lead_block","monster_hit","shed_block","snarl","spot_blitz","strong_base","superior_vision","wrap_up_tackle","balance","gang_tackle","headhunter","pummel"],weightOptions:9,heightOptions:3},OT:{arch:["Pass Blocker","Run Blocker","Special Teamer"],sas:["big_hit","aura_of_intimidation","break_through","cut","diving_tackle","first_step","lead_block","monster_hit","shed_block","snarl","spot_blitz","strong_arm","strong_base","superior_vision","wrap_up_tackle","balance","gang_tackle","headhunter","pummel"],weightOptions:9,heightOptions:3},DT:{arch:["Run Stuffer","Pass Rusher","Combo Tackle","Special Teamer"],sas:["jumping_catch","aura_of_intimidation","blitz","closing_speed","cut","defense_general","diving_catch","diving_tackle","first_step","get_low","jumping_catch","monster_hit","one_handed_catch","pancake","run_block","shutdown_coverage","smooth_operator","sticky_hands","superior_vision","trash_talk","tunnel_vision","wrap_up_tackle","balance","disguise_blitz","fire_up","gang_tackle","headhunter","head_of_steam","jackhammer","relentless","zone_focus"],weightOptions:18,heightOptions:3},DE:{arch:["Run Stuffer","Pass Rusher","Combo End","Special Teamer"],sas:["jumping_catch","aura_of_intimidation","big_hit","blitz","break_through","closing_speed","defense_general","diving_catch","d_line_general","get_low","glare","jumping_catch","one_handed_catch","pancake","run_block","shutdown_coverage","smooth_operator","snarl","sticky_hands","superior_vision","trash_talk","wrap_up_tackle","balance","disguise_blitz","fire_up","gang_tackle","headhunter","head_of_steam","jackhammer","relentless","zone_focus"],weightOptions:18,heightOptions:3},CB:{arch:["Man Specialist","Zone Specialist","Hard Hitter","Combo Corner","Returner","Special Teamer"],sas:["jumping_catch","aura_of_intimidation","big_hit","big_sack","break_through","cover_up","dive","diving_tackle","get_low","glare","head_fake","juke","lower_the_shoulder","monster_hit","pancake","power_through","run_block","shed_block","snarl","spin","stiff_arm","strong_base","trash_talk","tunnel_vision","wall","wrap_up_tackle","balance","disguise_blitz","fire_up","gang_tackle","headhunter","head_of_steam","hurdle","jackhammer","open_field_fake","relentless","zone_focus"],weightOptions:18,heightOptions:3},SS:{arch:["Man Specialist","Zone Specialist","Hard Hitter","Combo Safety","Special Teamer"],sas:["jumping_catch","aura_of_intimidation","big_sack","blitz","break_through","first_step","get_low","glare","pancake","run_block","shed_block","shutdown_coverage","smooth_operator","strong_base","trash_talk","tunnel_vision","wall","balance","disguise_blitz","fire_up","gang_tackle","headhunter","head_of_steam","jackhammer","relentless","zone_focus"],weightOptions:18,heightOptions:3},FS:{arch:["Man Specialist","Zone Specialist","Hard Hitter","Combo Safety","Special Teamer"],sas:["jumping_catch","aura_of_intimidation","big_sack","blitz","break_through","get_low","glare","monster_hit","pancake","run_block","shed_block","smooth_operator","sticky_hands","strong_base","trash_talk","tunnel_vision","wall","balance","disguise_blitz","fire_up","gang_tackle","headhunter","head_of_steam","jackhammer","relentless","zone_focus"],weightOptions:18,heightOptions:3},LB:{arch:["Coverage Linebacker","Blitzer","Hard Hitter","Combo Linebacker","Special Teamer"],sas:["jumping_catch","big_hit","blitz","break_through","closing_speed","cut","first_step","get_low","pancake","run_block","shutdown_coverage","smooth_operator","sticky_hands","strong_base","superior_vision","tunnel_vision","wall","wrap_up_tackle","balance","disguise_blitz","fire_up","gang_tackle","headhunter","head_of_steam","jackhammer","relentless","zone_focus"],weightOptions:18,heightOptions:3},K:{arch:["Boomer","Technician"],sas:["aura_of_intimidation","big_hit","break_through","closing_speed","cut","diving_tackle","first_step","hang_time","monster_hit","shed_block","snarl","strong_base","superior_vision","wall","wrap_up_tackle","balance","gang_tackle","headhunter"],weightOptions:18,heightOptions:3},P:{arch:["Boomer","Technician"],sas:["aura_of_intimidation","automatic","big_hit","break_through","closing_speed","cut","diving_tackle","first_step","monster_hit","shed_block","snarl","strong_base","superior_vision","wall","wrap_up_tackle","balance","gang_tackle","headhunter"],weightOptions:18,heightOptions:3}};function addElement(c,h,a,b,g){var d=document.createElement(c);if(h!=null){d.id=h}a.appendChild(d);if(b!=null){for(var f in b){d[f]=b[f]}}if(g!=null){d.innerHTML=g}return d}function addField(e,c,d){var b=d;if(b==null){b="grid_2"}var g=addElement("div",null,e,{className:b});var a=addElement("div",null,g,{className:"label"},c);return g}function onPositionChange(){var b=document.getElementById("positionSelect").value;var a=positionData[b];fillDropdownRange(document.getElementById("heightSelect"),100);fillDropdownRange(document.getElementById("weightSelect"),100);fillDropdown(document.getElementById("archSelect"),a.arch);fillDropdown(document.getElementById("saSelect"),a.sas)}function onLogClicked(){if(scriptData.debugLoggingEnabled){scriptData.debugLoggingEnabled=false;document.getElementById("loggingButton").value="Enable Logging";alert("Logging disabled.")}else{scriptData.debugLoggingEnabled=true;document.getElementById("loggingButton").value="Disable Logging";alert("Logging enabled. CTRL-SHIFT-J to bring up the console.")}}function addUI(){var h=document.getElementById("submit");var i=addElement("div",null,h.parentNode,{className:"container_12"});var g=addField(i,"Position","grid_1");var a=addElement("select","positionSelect",g,null);fillDropdown(a,positions);a.addEventListener("change",onPositionChange,true);g=addField(i,"Archetype");var b=addElement("select","archSelect",g,null);fillDropdown(b,positionData[document.getElementById("positionSelect").value].arch);g=addField(i,"Special Ability");b=addElement("select","saSelect",g,null);fillDropdown(b,positionData[document.getElementById("positionSelect").value].sas);g=addField(i,"Primary Attribute");b=addElement("select","primarySelect",g,null);fillDropdown(b,attributes);g=addField(i,"Secondary Attribute");b=addElement("select","secondarySelect",g,null);fillDropdown(b,attributes);g=addField(i,"Height","grid_1");b=addElement("select","heightSelect",g,null);fillDropdownRange(b,100);g=addField(i,"Weight","grid_1");b=addElement("select","weightSelect",g,null);fillDropdownRange(b,100);g=addField(i,"Target BreakThroughs","grid_3");var j=addElement("input","breakThroughsInput",g,null);j.value=3;g=addField(i,"Enable 3rd Training Boost","grid_3");b=addElement("select","thirdBoostSelect",g,null);fillDropdown(b,[false,true]);g=addField(i,"Use Free Player");b=addElement("select","useFreePlayerSelect",g,null);fillDropdown(b,[false,true]);var d=addElement("input","startBuilderButton",i,{type:"button",value:"Start Rolling for Breakthroughs",className:"grid_3"});d.addEventListener("click",vld,true);var c=addElement("input","cancelButton",i,{type:"button",value:"Cancel Script",className:"grid_2"});c.addEventListener("click",cancelScript,true);var e=addElement("input","loggingButton",i,{type:"button",value:"Enable Logging",className:"grid_2"});e.addEventListener("click",onLogClicked,true);g=addField(i,"Training History (# of breakthroughs : # of players that had that many breakthroughs)","grid_12");addElement("div","historyContainer",g,null)}addUI();

