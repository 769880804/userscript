// ==UserScript==
// @name           Neo Pimp
// @namespace      http://darkztar.com/
// @description    Pimps out neopets completely!
// @include        http://www.neopets.*/*
// ==/UserScript==

var QuickLinksBoxMaxHeight = '492';

function GSB(Source,Start,End){var xStart = Source.indexOf(Start)+Start.length;var xEnd = Source.indexOf(End,xStart);if(xStart < xEnd && xStart >= Start.length){return Source.substr(xStart,(xEnd-xStart));}else{return "";}}
function GSBR(Source,Start,End){Source = Source.reverse(); Start = Start.reverse(); End = End.reverse(); var xStart = Source.indexOf(Start)+Start.length;var xEnd = Source.indexOf(End,xStart);if(xStart < xEnd && xStart >= Start.length){return Source.substr(xStart,(xEnd-xStart)).reverse();}else{return "";}}
function GSBA(Source,Start,End){var xStart = Source.indexOf(Start)+Start.length;var xEnd = Source.indexOf(End,xStart);var d = [];while(xStart < xEnd && xStart >= Start.length && xEnd > -1){d.push(Source.substr(xStart,(xEnd-xStart)));xStart = Source.indexOf(Start,xStart)+Start.length;xEnd = Source.indexOf(End,xStart);}return d;}
document.getElementByName=function(a){var b=document.getElementsByTagName('*');for(var i=0;i<b.length;i++){if(b[i].name==a){return b[i];}}};
document.getElementByClassName=function(a,b){if(typeof b=='undefined'){b='*'}var c=document.getElementsByTagName(b);for(var i=0;i<c.length;i++){if(c[i].className==a){return c[i];}}};
document.getElementsByClassName=function(a,b){if(typeof b=='undefined'){b='*'}var c=document.getElementsByTagName(b);var d=[];for(var i=0;i<c.length;i++){if(c[i].className==a){d.push(c[i]);}}return d;};
function Strip_Tags(x){var y = x.replace(/&(lt|gt);/g, function (p1){return (p1 == "lt")? "<" : ">";});return y.replace(/<\/?[^>]+(>|$)/g, "");}
function dragStart(event, id) {var el;var x, y;if (id)dragObj.elNode = document.getElementById(id);else {if (browser.isIE)dragObj.elNode = window.event.srcElement;if (browser.isNS)dragObj.elNode = event.target;if (dragObj.elNode.nodeType == 3)dragObj.elNode = dragObj.elNode.parentNode;}if (browser.isIE) {x = window.event.clientX + document.documentElement.scrollLeft+ document.body.scrollLeft;y = window.event.clientY + document.documentElement.scrollTop+ document.body.scrollTop;}if (browser.isNS) {x = event.clientX + window.scrollX;y = event.clientY + window.scrollY;}dragObj.cursorStartX = x;dragObj.cursorStartY = y;dragObj.elStartLeft= parseInt(dragObj.elNode.style.left, 10);dragObj.elStartTop = parseInt(dragObj.elNode.style.top,10);if (isNaN(dragObj.elStartLeft)) dragObj.elStartLeft = 0;if (isNaN(dragObj.elStartTop))dragObj.elStartTop= 0;dragObj.elNode.style.zIndex = ++dragObj.zIndex;if (browser.isIE) {document.attachEvent("onmousemove", dragGo);document.attachEvent("onmouseup", dragStop);window.event.cancelBubble = true;window.event.returnValue = false;}if (browser.isNS) {document.addEventListener("mousemove", dragGo, true);document.addEventListener("mouseup", dragStop, true);event.preventDefault();}}
function dragGo(event) {var x, y;if (browser.isIE) {x = window.event.clientX + document.documentElement.scrollLeft+ document.body.scrollLeft;y = window.event.clientY + document.documentElement.scrollTop+ document.body.scrollTop;}if (browser.isNS) {x = event.clientX + window.scrollX;y = event.clientY + window.scrollY;}dragObj.elNode.style.left = (dragObj.elStartLeft + x - dragObj.cursorStartX) + "px";dragObj.elNode.style.top= (dragObj.elStartTop+ y - dragObj.cursorStartY) + "px";if (browser.isIE) {window.event.cancelBubble = true;window.event.returnValue = false;}if (browser.isNS)event.preventDefault();}
function dragStop(event) {var x, y;if (browser.isIE) {x = window.event.clientX + document.documentElement.scrollLeft+ document.body.scrollLeft;y = window.event.clientY + document.documentElement.scrollTop+ document.body.scrollTop;}if (browser.isNS) {x = event.clientX + window.scrollX;y = event.clientY + window.scrollY;}GM_setValue(dragObj.elNode.id+'_x',(dragObj.elStartLeft + x - dragObj.cursorStartX) + "px");GM_setValue(dragObj.elNode.id+'_y',(dragObj.elStartTop  + y - dragObj.cursorStartY) + "px");if (browser.isIE) {document.detachEvent("onmousemove", dragGo);document.detachEvent("onmouseup", dragStop);}if (browser.isNS) {document.removeEventListener("mousemove", dragGo, true);document.removeEventListener("mouseup", dragStop, true);}}
function Browser(){var ua, s, i;this.isIE = false;this.isNS = false; this.version = null; ua = navigator.userAgent; s = "MSIE";if ((i = ua.indexOf(s)) >= 0) {this.isIE = true; this.version = parseFloat(ua.substr(i + s.length));return;} s = "Netscape6/";if ((i = ua.indexOf(s)) >= 0){this.isNS = true; this.version = parseFloat(ua.substr(i + s.length)); return;} s = "Gecko";if ((i = ua.indexOf(s)) >= 0) { this.isNS = true;this.version = 6.1; return;}}
function AppendElement(tag, id){var tmpAE = document.createElement(tag); if(id) tmpAE.id = id; document.body.appendChild(tmpAE); return tmpAE;}
function RemoveElement(id){var tmpRE = document.getElementById(id); if(tmpRE != undefined){document.body.removeChild(tmpRE);}}
function moveQuickie(evt){dragStart(evt,'quickie');} function movePimpie(evt){dragStart(evt,'neopimp');}
String.prototype.reverse = function(){splitext = this.split("");revertext = splitext.reverse();reversed = revertext.join("");return reversed;}
function SmartHaggle(priceth){var pricelength = priceth.length;var returnval = priceth.charAt(0) + priceth.charAt(1);for (i = 2; i < pricelength; i++) {    returnval = returnval + priceth.charAt( Math.round(Math.random()) );}return returnval;}function findAttribute(attrs,attName){var i;for (i = 0; i < attrs.length ; i++){if(attrs[i].name.toLowerCase() == attName.toLowerCase()){return attrs[i];break;}}}
function updateQuickLinks(){document.getElementById('thequicklinks').innerHTML = getQuickLinks();if (document.getElementById('thequicklinks').offsetHeight >= QuickLinksBoxMaxHeight){document.getElementById('thequicklinks').style.overflowY = 'scroll';}else{document.getElementById('thequicklinks').style.overflow = 'hidden';}var qdels = document.getElementsByClassName('delquicks'); var i, id;for(i = 0; i < qdels.length; i++){id = GSB(qdels[i].id,'delquicklink_','_id');document.getElementById('delquicklink_'+id+'_id').addEventListener('click',delPage,false);}}
function addCurPage(){var nme = prompt('What do you want to call this page?',document.title);if(nme != null){curList = eval(GM_getValue("quicklinks",'[""]'));curList.push(curList.length + '||' + curURL + '||' + nme);GM_setValue('quicklinks',uneval(curList));updateQuickLinks();}}
function delPage(e){var pid = GSB(e.currentTarget.id,'delquicklink_','_id');var ip,iz;curList = eval(GM_getValue("quicklinks",'[""]'));for(ip = 0; ip < curList.length; ip++){if(curList[ip].indexOf("||") > -1){iz = curList[ip].split("||",3);if(pid == iz[0]){if(confirm('Are you sure you wish to delete the page?\nTitle: '+iz[2]+'\nURL: '+iz[1])){curList.splice(ip,1);}}}}GM_setValue('quicklinks',uneval(curList));updateQuickLinks();}
function getQuickLinks(){var ix, iy;var ir = new Array(); var ia = false;var qckl = eval(GM_getValue("quicklinks",'[""]'));for(ix = 0; ix < qckl.length; ix++){if(qckl[ix].indexOf("||") > -1){iy = qckl[ix].split("||",3);ir.push("<a href='"+iy[1]+"' id='quicklink_id"+iy[0]+"'>"+iy[2]+"</a> [<span class='delquicks' id='delquicklink_"+iy[0]+"_id' style='cursor:pointer;color:firebrick;'>x</span>]");ia = true;}}if(ia){return ir.join("<br/>");}else{document.getElementById('thequicklinks').style.overflow = 'hidden';return "No links added...";}}
function toogleShowHide(x,conf){var z = x.currentTarget;var tz = findAttribute(z.attributes,'title').value;var y = document.getElementById(tz);if(y != undefined){if(conf != null && conf != 'undefined'){z.innerHTML = (y.style.display == 'none' ? "+" : "-");}else{if(z.innerHTML == "-"){y.style.display = 'none';GM_setValue(tz+'_collapse','none');z.innerHTML = "+";}else{y.style.display = '';GM_setValue(tz+'_collapse','');z.innerHTML = "-";}}}}
function QuickLinksBox(Remv){if(Remv == true){RemoveElement('quickie');GM_setValue('noQuickLinks',true)}else{var Quickie = AppendElement('div','quickie');Quickie.innerHTML = '<div class="sidebarModule" style="margin-bottom: 7px;"><table cellpadding="3" cellspacing="0" border="0" class="sidebarTable"><tr><td valign="middle" class="sidebarHeader medText" style="cursor: move;" id="quickiemov"><center>Quick Links [<span id="toogleQuicklist" title="quickl" style="cursor:pointer;color:firebrick;">'+(GM_getValue('quickl_collapse','') == '' ? "-" : "+")+'</span>]</center></td></tr><tr><td class="neofriend" id="quickl" style="display:'+GM_getValue('quickl_collapse','')+'" align="left"></td></tr></table></div>';Quickie.style.position = 'absolute'; Quickie.style.left = GM_getValue('quickie_x','0px'); Quickie.style.top = GM_getValue('quickie_y',document.getElementById('neopimp').clientHeight+'px');var QHTML = "<div id='thequicklinks' style='max-Height:"+QuickLinksBoxMaxHeight+"px;white-space:nowrap;'></div><input type='button' class='sf' value='Add This Page' id='q_add' style='width:100%;margin:2px 0 0 0;'>";document.getElementById('quickl').innerHTML = QHTML;updateQuickLinks();document.getElementById('quickiemov').addEventListener('mousedown',moveQuickie,false);document.getElementById('q_add').addEventListener('click',addCurPage,false);document.getElementById('toogleQuicklist').addEventListener('click',toogleShowHide,false);GM_setValue('noQuickLinks',false);}}
function AutoFit(Remv){var sOverflow, sWidth, sHeight, sDisplay, sNST;if(Remv == true){sOverflow = ''; sWidth = '996px'; sHeight = ''; sDisplay = ''; sNST = '';GM_setValue('autoFit',true);}else{sOverflow = 'scroll'; sWidth = '1016px'; sHeight = (window.innerHeight - 229)+'px'; sDisplay = 'none'; sNST = '22px';GM_setValue('autoFit',false);}document.getElementById('content').style.overflowY = sOverflow; document.getElementById('content').style.textAlign = 'center'; document.getElementById('content').style.width = sWidth; document.getElementById('content').style.maxHeight = sHeight; document.getElementById('nst').style.paddingRight = sNST; document.getElementById('main').style.width = sWidth; document.getElementById('header').style.width = sWidth; document.getElementById('footer').style.width = sWidth;if(curURL.indexOf('userlookup.phtml') == -1){document.getElementById('ban').style.display = sDisplay; document.getElementById('ban_bottom').style.display = sDisplay;}}
function NeoPimpInit(){var NeoPimp = AppendElement('div','neopimp');NeoPimp.innerHTML = '<div class="sidebarModule" style="margin-bottom: 7px;"><table cellpadding="3" cellspacing="0" border="0" class="sidebarTable"><tr><td valign="middle" class="sidebarHeader medText" style="cursor: move;" id="neopimpmov"><center>Neo Pimp [<span id="toogleNeopimp" title="neopimpcont" style="cursor:pointer;color:firebrick;">'+(GM_getValue('neopimpcont_collapse','') == '' ? "-" : "+")+'</span>]</center></td></tr><tr><td class="neofriend" id="neopimpcont" style="display:'+GM_getValue('neopimpcont_collapse','')+'" align="left"></td></tr><tr><td class="neofriend"><a href="http://darkztar.com/forum/index.php" target="_visit_dz" title="Get more neopets utilities!"><b>Created by CheeSie, &copy; 2009</b></a></td></tr></table></div>';NeoPimp.style.position = 'absolute'; NeoPimp.style.left = GM_getValue('neopimp_x','0px'); NeoPimp.style.top = GM_getValue('neopimp_y','0px');var PMHTML = "<b>Applications:</b><br>";PMHTML += "<input type='checkbox' id='chkquickie' style='vertical-align:middle;' "+(GM_getValue('noQuickLinks',true) == false ? 'checked' : '')+"><label for='chkquickie'>Quick Links</label>&nbsp;";PMHTML += "<input type='checkbox' id='chkautofit' style='vertical-align:middle;' "+(GM_getValue('autoFit',true) == false ? 'checked' : '')+"><label for='chkautofit'>Fit To Screen</label>&nbsp;";PMHTML += "<br><input type='checkbox' id='chknbfuncs' style='vertical-align:middle;' "+(GM_getValue('neoboardfuncs',false) == true ? 'checked' : '')+"><label for='chknbfuncs'>NeoBoard Agent</label>&nbsp;";PMHTML += "<input type='checkbox' id='chkhagglefuncs' style='vertical-align:middle;' "+(GM_getValue('hagglefuncs',false) == true ? 'checked' : '')+"><label for='chkhagglefuncs'>Auto Haggle</label>&nbsp;";document.getElementById('neopimpcont').innerHTML = PMHTML;document.getElementById('neopimpmov').addEventListener('mousedown',movePimpie,false);document.getElementById('toogleNeopimp').addEventListener('click',toogleShowHide,false);document.getElementById('chkquickie').addEventListener('click',function(){QuickLinksBox((document.getElementById('chkquickie').checked == true ? false : true));},false);document.getElementById('chkautofit').addEventListener('click',function(){AutoFit((document.getElementById('chkautofit').checked == true ? false : true));},false);document.getElementById('chknbfuncs').addEventListener('click',function(){GM_setValue('neoboardfuncs',(document.getElementById('chknbfuncs').checked == true ? true : false));},false);document.getElementById('chkhagglefuncs').addEventListener('click',function(){GM_setValue('hagglefuncs',(document.getElementById('chkhagglefuncs').checked == true ? true : false));},false);window.addEventListener('resize',function(){AutoFit((document.getElementById('chkautofit').checked == true ? false : true));},false);}
var pHTML = document.getElementById('content').innerHTML; var curURL = location.href.toLowerCase(); var browser = new Browser();var dragObj = new Object(); dragObj.zIndex = 0;
if(curURL.indexOf("~") == -1 && curURL.indexOf("ntimes") == -1){NeoPimpInit();QuickLinksBox(GM_getValue('noQuickLinks',true));AutoFit(GM_getValue('autoFit',true));}
if(curURL.indexOf("neoboards/") > -1 && GM_getValue('neoboardfuncs',false)){var baseURL = GSB(curURL,"","neoboards/");if(pHTML.indexOf('"><strong class="medText">') > -1){var users = GSBA(pHTML,'"><strong class="medText">','</strong>');var pets = GSBA(pHTML,'<br><a href="/petlookup.phtml?pet=','"');var authors = document.getElementsByClassName('topicAuthor sf','td');var heads = document.getElementsByClassName('topicSmall','td');var posts = GSBA(pHTML.replace('badMessage=Topic:' + GSB(pHTML,'badMessage=Topic:','Message:'),'badMessage='),"badMessage=Message:",'"');var post = "";var jsQu = "document.getElementsByName('message')[0].value = '[quote]%MSG%[/quote]'; document.getElementsByName('message')[0].value = unescape(document.getElementsByName('message')[0].value).replace(/\\&\\#x27\\;/g,'\\'').replace(/\\+/g,' ');";for(i = 0; i < users.length; i++){authors[i].innerHTML = authors[i].innerHTML.replace("</b></td>","</b></td></tr><tr><td class='sf' colspan='2'>[<b><a href='"+baseURL+"neomessages.phtml?type=send&recipient="+users[i]+"' target='_nma_"+escape(users[i])+"'>NeoMail</a></b>]<br>[<b><a href='"+baseURL+"browseshop.phtml?owner="+users[i]+"' target='_shp_"+escape(users[i])+"'>Shop</a></b>] [<b><a href='"+baseURL+"gallery/index.phtml?gu="+users[i]+"' target='_gal_"+escape(users[i])+"'>Gallery</a></b>]<br>[<b><a href='"+baseURL+"island/tradingpost.phtml?type=browse&criteria=owner&search_string="+users[i]+"' target='_tra_"+escape(users[i])+"'>Trades</a></b>] [<b><a href='"+baseURL+"genie.phtml?type=find_user&auction_username="+users[i]+"' target='_auc_"+escape(users[i])+"'>Auctions</a></b>]</td>").replace("Active Neopet</td>","Active Neopet<br>[<b><a href='"+baseURL+"battledome.phtml?type=challenge&pettochallenge="+pets[i]+"' target='_cha_"+escape(users[i])+"'>Challenge</a></b>]</td>");post = posts[i];heads[(i*2)].width = '50%'; heads[(i*2) + 1].width = '50%'; heads[(i*2)+1].innerHTML = "[<b><a href='#bottom' onClick=\""+jsQu.replace("%MSG%",post.replace(/\'/g,"").replace(/\"/,""))+"\">Quote</a></b>]" + heads[(i*2)+1].innerHTML;}}}
if(curURL.indexOf("/haggle.phtml") > -1 && GM_getValue('hagglefuncs',false)){if(pHTML.indexOf("I want at least ") > 1){var haggle = GSB(pHTML,"<b>The Shopkeeper says 'I want at least "," Neopoints for this great item.'");}else if(pHTML.indexOf("I wont take less than ") > 1){var haggle = GSB(pHTML,"<b>The Shopkeeper says 'I wont take less than "," Neopoints for it.'");}else if(pHTML.indexOf("Tell you what, lets say ") > 1){var haggle = GSB(pHTML,"<b>The Shopkeeper says 'Tell you what, lets say ","... ");}else if(pHTML.indexOf(" is not enough... give me ") > 1){var haggle = GSB(pHTML," is not enough... give me ",".'</b>");}else if(pHTML.indexOf("A pox on your pets for wasting my time!  I demand") > 1){var haggle = GSB(pHTML,"A pox on your pets for wasting my time!  I demand","!!!'</b>");}else if(pHTML.indexOf("But for an item of this quality,") > 1){var haggle = GSB(pHTML,"But for an item of this quality, "," is a bargain!");}else if(pHTML.indexOf("I have to eat you know?  Lets call the price ") > 1){var haggle = GSB(pHTML,"I have to eat you know?  Lets call the price ","... ok?");}else if(pHTML.indexOf("living you know.... what about ") > 1){var haggle = GSB(pHTML,"living you know.... what about ","?'</b>");}else if(pHTML.indexOf("<b>The Shopkeeper says 'What about ") > 1){var haggle = GSB(pHTML,"<b>The Shopkeeper says 'What about "," Neopoints then?");}else if(pHTML.indexOf("<b>The Shopkeeper says 'OK. ") > 1){var haggle = GSB(pHTML,"<b>The Shopkeeper says 'OK. "," and its yours");}else if(pHTML.indexOf(" for this, so ") > 1){var haggle = GSB(pHTML," for this, so "," would be a bargain!");}if(haggle > -1){document.getElementByName("current_offer").value = SmartHaggle(haggle.replace(",",""));document.getElementByName("current_offer").focus();}}