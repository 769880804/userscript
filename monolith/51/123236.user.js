// ==UserScript==
// @name Grepolis Verlustkosten
// @author Tiax
// @version 1.0
// @namespace grepolis
// @include http://*.grepolis.com/game/index*
// ==/UserScript==

if(typeof $=="undefined"){var $=unsafeWindow.jQuery}$(function(){var a=$('<div id="grepotools" />').appendTo("body");a.ajaxSuccess(function(i,j,g){var d=g.url.toString();if(d.indexOf("game/report?action=view")!=-1){try{var f=j.responseText.match(/ReportViewer\.initialize\((.+)\);/);f[1]=f[1].replace(/"3":/g,'"x":');var h=$.parseJSON(f[1]);var c=calculateTroopCosts(h.result.att_units.x.lost,false,false);var b=calculateTroopCosts(h.result.def_units.x.lost,false,false);$("#resources").append('<hr /><h4>Verluste:</h4><table><tr><td width="50%">'+c.wood+'</td><td><div class="wood_img"/></td><td width="50%">'+b.wood+"</td></tr><tr><td>"+c.stone+'</td><td><div class="stone_img"/></td><td>'+b.stone+"</td></tr><tr><td>"+c.iron+'</td><td><div class="iron_img"/></td><td>'+b.iron+"</td></tr><tr><td>"+c.favor+'</td><td><div class="wood_img" style="background-position:0px -150px;" /></td><td>'+b.favor+"</td></tr><tr><td>"+c.pop+'</td><td><div class="pop_img"/></td><td>'+b.pop+"</td></tr></table>")}catch(i){}}else{}})});function calculateTroopCosts(h,d,e){var a=0;var g=0;var i=0;var c=0;var b=0;if(h.length!=0){for(unit in h){var f=1;if(!unitData[unit]){console.error("Unknown unit: "+unit);continue}if(d==true&&!unitData[unit].isShip){f=0.9}else{if(e==true&&unitData[unit].isShip){f=0.9}}a+=(unitData[unit]["wood"]*h[unit]*f);g+=(unitData[unit]["stone"]*h[unit]*f);i+=(unitData[unit]["iron"]*h[unit]*f);c+=(unitData[unit]["favor"]*h[unit]*f);b+=unitData[unit]["pop"]*h[unit]}}a=Math.round(a);g=Math.round(g);i=Math.round(i);return{wood:a,stone:g,iron:i,favor:c,pop:b}}var unitData={militia:{wood:0,stone:0,iron:0,favor:0,pop:0},sword:{wood:95,stone:0,iron:85,favor:0,pop:1},slinger:{wood:55,stone:100,iron:40,favor:0,pop:1},archer:{wood:120,stone:0,iron:75,favor:0,pop:1},hoplite:{wood:0,stone:75,iron:150,favor:0,pop:1},rider:{wood:240,stone:120,iron:360,favor:0,pop:3},chariot:{wood:200,stone:440,iron:320,favor:0,pop:4},catapult:{wood:1200,stone:1200,iron:1200,favor:0,pop:15},minotaur:{wood:1400,stone:600,iron:3100,favor:202,pop:30,isMytical:true},manticore:{wood:4400,stone:3000,iron:3400,favor:405,pop:45,isMytical:true},zyklop:{wood:2000,stone:4200,iron:3360,favor:360,pop:40,isMytical:true},sea_monster:{wood:5400,stone:2800,iron:3800,favor:400,pop:50,isShip:true,isMytical:true},harpy:{wood:1600,stone:400,iron:1360,favor:130,pop:14,isMytical:true},medusa:{wood:1500,stone:3800,iron:2200,favor:210,pop:18,isMytical:true},centaur:{wood:1740,stone:300,iron:700,favor:100,pop:12,isMytical:true},pegasus:{wood:2800,stone:360,iron:80,favor:180,pop:20,isMytical:true},cerberus:{wood:1250,stone:1500,iron:3000,favor:230,pop:30,isMytical:true},fury:{wood:2500,stone:5000,iron:5000,favor:480,pop:55,isMytical:true},big_transporter:{wood:500,stone:500,iron:400,favor:0,pop:7,isShip:true},bireme:{wood:800,stone:700,iron:180,favor:0,pop:8,isShip:true},attack_ship:{wood:1300,stone:300,iron:800,favor:0,pop:10,isShip:true},demolition_ship:{wood:500,stone:750,iron:150,favor:0,pop:8,isShip:true},small_transporter:{wood:800,stone:0,iron:400,favor:0,pop:5,isShip:true},trireme:{wood:2000,stone:1300,iron:900,favor:0,pop:16,isShip:true},colonize_ship:{wood:10000,stone:10000,iron:10000,favor:0,pop:170,isShip:true}};