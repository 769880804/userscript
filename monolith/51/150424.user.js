// ==UserScript==
// @name           احصاء القوات 
// @namespace      Sainz SpaiderS
// @description    قوم بأحصاء جميغع الجيوش والنوكات في القرية
// @autor          the lord
// @include        http://ae*.tribalwars.ae/game.php?screen=overview villages*
// @version        3.2.0.036
// ==/UserScript==


%20/*%20%20name:%20%D8%A7%D8%A8%D8%B1%D8%A7%D9%87%D9%8A%D9%85%20skype:%20maystrokhalid%20Notes:%20%D8%AA%D8%AD%D9%8A%D8%A7%D8%AA%D9%8A%20%D9%81%D9%8A%20%D8%AA%D8%B9%D8%B1%D9%8A%D8%A8%D8%A7%D8%AA%20%D8%AC%D8%AF%D9%8A%D8%AF%D8%A9%20%D9%88%D8%A8%D8%B1%D9%85%D8%AC%D8%A9%20%20TODO:%20*%20%D8%A7%D8%B1%D8%AC%D9%88%20%D8%A7%D9%84%D8%AF%D8%B9%D8%A7%D8%A1%20%D9%84%D9%8A%20%D9%88%D9%84%D9%84%D9%85%D8%B3%D9%84%D9%85%D9%8A%D9%86%20%D8%A7%D8%AC%D9%85%D8%B9%20____________________________________________________________%20%20Copyright%20(C)%202010%20Dale%20McKay,%20all%20rights%20reserved%20version%201.0,%209%20April%202010%20%20This%20software%20is%20provided%20'as-is',%20without%20any%20express%20or%20implied%20warranty.%20In%20no%20event%20will%20the%20author%20be%20held%20liable%20for%20any%20damages%20arising%20from%20the%20use%20of%20this%20software.%20%20Permission%20is%20granted%20to%20anyone%20to%20use%20this%20software%20for%20any%20purpose,%20including%20commercial%20applications,%20and%20to%20alter%20it%20and%20redistribute%20it%20freely,%20subject%20to%20the%20following%20restrictions:%20The%20origin%20of%20this%20software%20must%20not%20be%20misrepresented;%20you%20must%20not%20claim%20that%20you%20wrote%20the%20original%20software.%20If%20you%20use%20this%20software%20in%20a%20product,%20an%20acknowledgment%20in%20the%20product%20documentation%20would%20be%20appreciated%20but%20is%20not%20required.%20Altered%20source%20versions%20must%20be%20plainly%20marked%20as%20such,%20and%20must%20not%20be%20misrepresented%20as%20being%20the%20original%20software.%20This%20notice%20may%20not%20be%20removed%20or%20altered%20from%20any%20source%20distribution.%20____________________________________________________________%20%20*/%20%20function%20fnExecuteScript(){%20try{%20var%20strVersion="v7.6";%20%20var%20unitDesc%20=%20{%20"spear":"%D8%B1%D9%85%D8%AD",%20"sword":"%D8%B3%D9%8A%D9%81",%20"axe":"%D9%81%D8%A7%D8%B3",%20"archer":"%D8%B1%D8%A7%D9%85%D9%8A%20%D8%A7%D8%B3%D9%87%D9%85",%20"spy":"%D9%83%D8%B4%D8%A7%D9%81%D8%A9",%20"light":"%D9%81%D8%A7%D8%B1%D8%B3%20%D8%AE%D9%81%D9%8A%D9%81",%20"marcher":"%D9%81%D8%A7%D8%B1%D8%B3%20%D8%A7%D8%B3%D9%87%D9%85",%20"heavy":"%D9%81%D8%A7%D8%B1%D8%B3%20%D8%AB%D9%82%D9%8A%D9%84",%20"ram":"%D9%85%D8%AD%D8%B7%D9%85%D8%A7%D8%AA",%20"catapult":"%D9%85%D9%82%D9%84%D8%A7%D8%B9",%20"knight":"%D9%82%D8%A7%D8%A6%D8%AF%20%D8%A7%D9%84%D9%81%D8%B1%D8%B3%D8%A7%D9%86",%20"snob":"%D8%A7%D9%84%D9%86%D8%A8%D9%84%D8%A7%D8%A1",%20"militia":"%D9%85%D9%84%D9%8A%D8%B4%D9%8A%D8%A7%D8%AA",%20"offense":"%D9%87%D8%AC%D9%88%D9%85%D9%8A",%20"defense":"%D8%AF%D9%81%D8%A7%D8%B9%D9%8A"%20};%20%20function%20fnTranslate(id){%20var%20translation={%20"en":[%20"%D9%86%D8%A8%D9%84%D8%A7%D8%A1%20%D9%82%D9%8A%D8%AF%20%D8%A7%D9%84%D8%AA%D8%AF%D8%B1%D9%8A%D8%A8",%20"%D8%A7%D9%84%D9%82%D8%B7%D8%A7%D8%B1%D8%A7%D8%AA%20%D8%A7%D9%84%D8%AC%D8%A7%D9%87%D8%B2%D8%A9",%20"%D9%86%D8%A8%D9%84%D8%A7%D8%A1%20%D8%A7%D8%AE%D8%B1%D9%89",%20"%D8%A7%D9%84%D9%86%D9%8A%D9%88%D9%83%20%D8%A7%D9%84%D9%83%D8%A7%D9%85%D9%84",%20"3/4%20%D9%86%D9%8A%D9%88%D9%83",%20"1/2%20%D9%86%D9%8A%D9%88%D9%83",%20"1/4%20%D9%86%D9%8A%D9%88%D9%83",%20"%D9%86%D9%8A%D9%88%D9%83%20%D8%A7%D9%84%D9%85%D9%82%D8%A7%D9%84%D9%8A%D8%B9",%20"Full%20%D8%AF%D9%81%D8%A7%D8%B9",%20"3/4%20%D8%AF%D9%81%D8%A7%D8%B9",%20"1/2%20%D8%AF%D9%81%D8%A7%D8%B9",%20"1/4%20%D8%AF%D9%81%D8%A7%D8%B9",%20"%D9%83%D8%B4%D8%A7%D9%81%D8%A9%20%D9%83%D8%A7%D9%85%D9%84",%20"3/4%20%D9%83%D8%B4%D8%A7%D9%81%D8%A9",%20"1/2%20%D9%83%D8%B4%D8%A7%D9%81%D8%A9",%20"1/4%20%D9%83%D8%B4%D8%A7%D9%81%D8%A9",%20"%D8%A7%D8%AE%D8%B1%D9%89",%20"%D9%85%D9%84%D8%AE%D8%B5%20%D8%A7%D9%84%D9%82%D9%88%D8%A7%D8%AA",%20"%D8%AC%D9%8A%D8%B4%20%D8%A7%D9%84%D9%86%D8%A8%D9%84%D8%A7%D8%A1",%20"%D8%A7%D9%84%D8%AC%D9%8A%D9%88%D8%B4%20%D8%A7%D9%84%D9%87%D8%AC%D9%88%D9%85%D9%8A%D8%A9",%20"%D8%A7%D9%84%D8%AC%D9%8A%D9%88%D8%B4%20%D8%A7%D9%84%D8%AF%D9%81%D8%A7%D8%B9%D9%8A%D8%A9",%20"%D8%AC%D9%8A%D8%B4%20%D8%A7%D9%84%D9%83%D8%B4%D8%A7%D9%81%D8%A9",%20"%D8%AC%D9%8A%D9%88%D8%B4%20%D8%A7%D8%AE%D8%AE%D8%B1%D9%89",%20"%D8%A7%D9%84%D9%88%D8%AD%D8%AF%D8%A7%D8%AA%20%D8%A7%D9%84%D9%87%D8%AC%D9%88%D9%85%D9%8A%D8%A9",%20"%D8%A7%D9%84%D9%88%D8%AD%D8%AF%D8%A7%D8%AA%20%D8%A7%D9%84%D8%AF%D9%81%D8%A7%D8%B9%D9%8A%D8%A9",%20"%D8%A7%D9%84%D9%88%D8%AD%D8%AF%D8%A7%D8%AA%20%D8%A7%D9%84%D8%A7%D8%AE%D8%B1%D9%89",%20"%D9%85%D8%AC%D9%85%D9%88%D8%B9%20%D8%A7%D9%84%D9%88%D8%AD%D8%AF%D8%A7%D8%AA",%20"%D8%AA%D9%86%D8%B3%D9%8A%D9%82"%20]%20};%20%20/*%20Default%20to%20English%20"en".%20*/%20var%20lang=typeof(translation[win.game_data.market]=="undefined")?"en":win.game_data.market;%20if(typeof(translation[lang][id])=="undefined"){%20return%20"";%20}%20%20return%20translation[lang][id];%20}%20%20function%20fnDebugLog(msg){win.$("body").append("<span>"+msg+"</span><br/>");}%20%20/*%20sendMethod%20=%20"GET"%20||%20"POST",%20params%20=%20json,%20type%20=%20xml,json,text%20*/%20function%20fnAjaxRequest(url,sendMethod,params,type){%20var%20error=null,payload=null;%20%20win.$.ajax({%20"async":false,%20"url":url,%20"data":params,%20"dataType":type,%20"type":String(sendMethod||"GET").toUpperCase(),%20"error":function(req,status,err){error="ajax:%20"%20+%20status;},%20"success":function(data,status,req){payload=data;}%20});%20%20if(error){%20throw(error);%20}%20%20return%20payload;%20}%20%20function%20fnCreateConfig(name){return%20win.$(fnAjaxRequest("/interface.php","GET",{"func":name},"xml")).find("config");}%20function%20fnCreateWorldConfig(){return%20fnCreateConfig("get_config");}%20function%20fnCreateBuildingConfig(){return%20fnCreateConfig("get_building_info");}%20function%20fnCreateUnitConfig(){return%20fnCreateConfig("get_unit_info");}%20%20function%20fnHasArchers(){return%20(parseInt(win.game_data.worldConfig.find("game%20archer").text()||"0",10)>0);}%20function%20fnHasChurch(){return%20(parseInt(win.game_data.worldConfig.find("game%20church").text()||"0",10)>0);}%20function%20fnHasNotebook(){return%20(win.$('[src*="note.png"],[class*="note-icon"]').length>0);}%20function%20fnHasPaladin(){return%20(parseInt(win.game_data.worldConfig.find("game%20knight").text()||"0",10)>0);}%20function%20fnHasMilitia(){return%20(win.game_data.unitConfig.find("militia").length>0);}%20%20function%20fnGetTroopCount(){%20/*%20returns%20an%20array%20of:%20{"x":"xxx","y":"yyy","coords":"xxx|yyy","troops":[0,0,0,0,0,0,0,0,0,0,0,0,0]}%20*/%20%20/*%20Number%20of%20Columns%20-%20VillageColumn%20-%20ActionColumn%20*/%20var%20gameVersion%20=%20parseFloat(win.game_data.version.match(/[\d|\.]+/g)[1]);%20var%20colCount%20=%20win.$('#units_table%20'+((gameVersion>=7.1)?'thead':'tbody:eq(0)')+'%20th').length%20-%202;%20var%20villageTroopInfo=[];%20%20win.$('#units_table%20tbody'+((gameVersion<7.1)?':gt(0)':'')).each(function(row,eleRow){%20/*%20Reset%20for%20next%20Village%20*/%20var%20villageData={"troops":[0,0,0,0,0,0,0,0,0,0,0,0,0]};%20%20/*%20Village%20*/%20coords=win.$(eleRow).find("td:eq(0)").text().match(/\d+\|\d+/g);%20coords=(coords?coords[coords.length-1].match(/(\d+)\|(\d+)/):null);%20villageData.x%20=%20parseInt(coords[1],10);%20villageData.y%20=%20parseInt(coords[2],10);%20villageData.coords%20=%20coords[0];%20%20/*%20Skip%20the%20Village%20Cell%20*/%20win.$(eleRow).find("td:gt(0):not(:has(>a))").each(function(cell,eleCell){%20/*%20Skip%20the%20RowType%20Cell%20*/%20if(cell%colCount){%20/*%20Ignore%20In%20the%20village%20(your%20own%20+%20foreign)%20*/%20if(Math.floor(cell/colCount)%20!=%201){%20villageData.troops[cell%colCount-1]%20+=%20parseInt(win.$(eleCell).text()||"0",10);%20}%20}%20});%20%20/*%20Cache%20the%20Data%20*/%20villageTroopInfo.push(villageData);%20});%20%20return%20villageTroopInfo;%20}%20%20function%20fnLogVersionInfo(){%20fnDebugLog("=========================");%20fnDebugLog("%D8%B3%D9%83%D8%B1%D8%A8%D8%AA%20%D8%A7%D8%AD%D8%B5%D8%A7%D8%A1%20%D8%A7%D9%84%D9%88%D8%AD%D8%AF%D8%A7%D8%AA:%20"%20+%20strVersion);%20fnDebugLog("=========================");%20fnDebugLog("%D8%A7%D9%84%D8%B9%D8%B6%D9%88%D9%8A%D8%A9:%20"+(win.game_data.isPremium?"yes":"%D9%84%D8%A7"));%20fnDebugLog("%D8%A7%D9%84%D9%83%D9%86%D9%8A%D8%B3%D8%A9:%20"+(fnHasChurch()?"%D9%86%D8%B9%D9%85":"%D9%84%D8%A7"));%20fnDebugLog("%D8%AA%D9%85%D8%AB%D8%A7%D9%84%20%D8%A7%D9%84%D9%85%D9%84%D9%83:%20"+(fnHasPaladin()?"%D9%86%D8%B9%D9%85":"%D9%84%D8%A7"));%20fnDebugLog("%D9%81%D8%A7%D8%B1%D8%B3%20%D9%82%D9%88%D8%B3:%20"+(fnHasArchers()?"%D9%86%D8%B9%D9%85":"%D9%84%D8%A7"));%20fnDebugLog("%D9%85%D9%84%D9%8A%D8%B4%D9%8A%D8%A7%D8%AA:%20"+(fnHasMilitia()?"%D9%86%D8%B9%D9%85":"%D9%84%D8%A7"));%20fnDebugLog("%D9%85%D9%88%D9%82%D8%B9:%20"+(win.location.href.match(/t\=\d+/i)?"%D9%86%D8%B9%D9%85":"%D9%84%D8%A7"));%20fnDebugLog("=========================");%20fnDebugLog("%D8%A7%D9%84%D8%A7%D8%B5%D8%AF%D8%A7%D8%B1:%20"+win.game_data.version);%20fnDebugLog("%D8%A7%D9%84%D8%B9%D8%A7%D9%84%D9%85%20%20:%20"+win.game_data.world);%20fnDebugLog("%D8%A7%D9%84%D8%B4%D8%A7%D8%B4%D8%A9%20:%20"+win.game_data.screen);%20fnDebugLog("%D8%A7%D9%84%D9%86%D9%85%D8%B7%20%20%20:%20"+win.game_data.mode);%20fnDebugLog("%D8%B1%D8%A7%D8%A8%D8%B7%20%20%20%20:%20"+win.location.href);%20fnDebugLog("%D8%A7%D9%84%D9%85%D8%AA%D8%B5%D9%81%D8%AD:%20"+navigator.userAgent);%20fnDebugLog("=========================");%20%20return%20true;%20}%20%20function%20fnCriteriaToStr(criteria){%20var%20valueStr%20=%20"";%20%20if(criteria%20&&%20(criteria.length%20>%200)){%20for(var%20ii=0;%20ii%20<%20criteria.length;%20ii++){%20if(typeof(criteria[ii].minpop)%20!=%20"undefined"){%20valueStr%20+=%20(valueStr?"%20and%20":"")%20+%20"("%20+%20unitDesc[criteria[ii].unit]%20+%20"[pop]%20>=%20"%20+%20criteria[ii].minpop%20+%20")";%20}%20if(typeof(criteria[ii].maxpop)%20!=%20"undefined"){%20valueStr%20+=%20(valueStr?"%20and%20":"")%20+%20"("%20+%20unitDesc[criteria[ii].unit]%20+%20"[pop]%20<%20"%20+%20criteria[ii].maxpop%20+%20")";%20}%20}%20}%20%20return%20valueStr;%20}%20%20function%20fnCalculateTroopCount(){%20var%20maxGroups=17;%20var%20outputSummary%20=%20{%20"Full%20Train%20Nuke":{%20"group":"Nobles",%20"criteria":[{"unit":"snob","minpop":400},{"unit":"offense","minpop":19600}],%20"descID":0%20},%20"Full%20Defense%20Train":{%20"group":"Nobles",%20"criteria":[{"unit":"snob","minpop":400},{"unit":"defense","minpop":19600}],%20"descID":1%20},%20"Other%20Nobles":{%20"group":"Nobles",%20"criteria":[{"unit":"snob","minpop":100},{"unit":"defense","maxpop":19600},{"unit":"offense","maxpop":19600}],%20"descID":2%20},%20"Full%20Nuke":{%20"group":"Offensive",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"offense","minpop":20000}],%20"descID":3%20},%20"Semi%20Nuke":{%20"group":"Offensive",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"offense","minpop":15000,"maxpop":20000}],%20"descID":4%20},%20"Half%20Nuke":{%20"group":"Offensive",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"offense","minpop":10000,"maxpop":15000}],%20"descID":5%20},%20"Quarter%20Nuke":{%20"group":"Offensive",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"offense","minpop":5000,"maxpop":10000}],%20"descID":6%20},%20"Cat%20Nuke":{%20"group":"Offensive",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"catapult","minpop":800},{"unit":"offense","minpop":20000}],%20"descID":7%20},%20"Full%20Defense":{%20"group":"Defensive",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"defense","minpop":20000}],%20"descID":8%20},%20"Semi%20Defense":{%20"group":"Defensive",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"defense","minpop":15000,"maxpop":20000}],%20"descID":9%20},%20"Half%20Defense":{%20"group":"Defensive",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"defense","minpop":10000,"maxpop":15000}],%20"descID":10%20},%20"Quarter%20Defense":{%20"group":"Defensive",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"defense","minpop":5000,"maxpop":10000}],%20"descID":11%20},%20"Full%20Scout":{%20"group":"Scouts",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"spy","minpop":20000}],%20"descID":12%20},%20"Semi%20Scout":{%20"group":"Scouts",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"spy","minpop":15000,"maxpop":20000}],%20"descID":13%20},%20"Half%20Scout":{%20"group":"Scouts",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"spy","minpop":10000,"maxpop":15000}],%20"descID":14%20},%20"Quarter%20Scout":{%20"group":"Scouts",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"spy","minpop":5000,"maxpop":10000}],%20"descID":15%20},%20"Other":{%20"group":"Other",%20"criteria":[{"unit":"snob","maxpop":100},{"unit":"spy","maxpop":5000},{"unit":"defense","maxpop":5000},{"unit":"offense","maxpop":5000}],%20"descID":16%20}%20};%20%20var%20ii,jj,village,total,index,count,unit,item,key,criteria,condition,isValid;%20var%20defense%20=%20["spear","sword","heavy","catapult"];%20var%20offense%20=%20["axe","light","ram","catapult"];%20%20if(fnHasMilitia()){%20defense.push("militia");%20}%20%20if(fnHasArchers()){%20defense.push("archer");%20offense.push("marcher");%20}%20/*%20if(fnHasPaladin()){%20offense.push("knight");%20}%20*/%20%20/*%20Initialize%20*/%20var%20summary%20=%20{%20unitTotal:{"tally":0,"population":0},%20defense:{"tally":0,"count":0,"population":0,"coords":[]},%20offense:{"tally":0,"count":0,"population":0,"coords":[]}%20};%20%20win.$(win.game_data.unitConfig).children().each(function(i,e){%20summary[e.nodeName]={"tally":0,"count":0,"population":0,"coords":[]};%20});%20%20for(item%20in%20outputSummary){%20if(outputSummary.hasOwnProperty(item)){%20summary[item]={"tally":0,"count":0,"population":0,"coords":[]};%20}%20}%20%20var%20villageTroops%20=%20fnGetTroopCount();%20for(ii=0;ii<villageTroops.length;ii++){%20village%20=%20villageTroops[ii];%20total%20=%20{%20defense:{"tally":0,"count":0,"population":0,"coords":[]},%20offense:{"tally":0,"count":0,"population":0,"coords":[]}%20};%20%20win.$(win.game_data.unitConfig).children().each(function(i,e){%20total[e.nodeName]={"tally":0,"count":0,"population":0,"coords":[]};%20});%20%20/*%20Calculate%20total%20count%20&%20population%20for%20each%20unit%20type%20*/%20index=0;%20win.$(win.game_data.unitConfig).children().each(function(i,e){%20var%20unit=e.nodeName;%20total[unit].count%20+=%20village.troops[index];%20total[unit].population%20+=%20village.troops[index]*parseInt(win.$(e).find("pop").text(),10);%20%20/*%20Defense%20*/%20if%20(new%20RegExp('^('%20+%20defense.join('|')%20+%20')$').test(unit)){%20total.defense.count%20+=%20total[unit].count;%20total.defense.population%20+=%20total[unit].population;%20}%20%20/*%20Offense%20*/%20if%20(new%20RegExp('^('%20+%20offense.join('|')%20+%20')$').test(unit)){%20total.offense.count%20+=%20total[unit].count;%20total.offense.population%20+=%20total[unit].population;%20}%20%20/*%20Units%20*/%20summary[unit].count%20+=%20total[unit].count;%20summary[unit].population%20+=%20total[unit].population;%20%20/*%20All%20Units%20*/%20summary.unitTotal.tally%20+=%20total[unit].count;%20summary.unitTotal.population%20+=%20total[unit].population;%20%20index++;%20});%20%20summary.defense.count%20+=%20total.defense.count;%20summary.defense.population%20+=%20total.defense.population;%20%20summary.offense.count%20+=%20total.offense.count;%20summary.offense.population%20+=%20total.offense.population;%20%20/*%20Calculate%20other%20summaries%20*/%20for(item%20in%20outputSummary){%20if(outputSummary.hasOwnProperty(item)){%20isValid=true;%20%20for(jj=0;jj<outputSummary[item].criteria.length;jj++){%20criteria=outputSummary[item].criteria[jj];%20%20if(!((typeof(criteria.minpop)=="undefined")||!criteria.minpop||(total[criteria.unit].population>=criteria.minpop))){%20isValid=false;%20}%20%20if(!((typeof(criteria.maxpop)=="undefined")||!criteria.maxpop||(total[criteria.unit].population<criteria.maxpop))){%20isValid=false;%20}%20}%20%20if(isValid){%20summary[item].coords.push(village.coords);%20summary[item].tally++;%20}%20}%20}%20}%20%20var%20groupSummary={};%20for(item%20in%20outputSummary){%20if(outputSummary.hasOwnProperty(item)){%20if(typeof(groupSummary[outputSummary[item].group])=="undefined"){%20groupSummary[outputSummary[item].group]=[];%20}%20%20groupSummary[outputSummary[item].group].push(item);%20}%20}%20%20var%20curGroup=maxGroups;%20%20var%20docSource%20=%20"";%20docSource%20+=%20"<!DOCTYPE%20HTML%20PUBLIC%20\"-//W3C//DTD%20HTML%204.01//EN\"%20\"http://www.w3.org/TR/html4/strict.dtd\">\n";%20docSource%20+=%20"<html>\n";%20docSource%20+=%20"\t<head>\n";%20docSource%20+=%20"\t\t<title>%D8%B3%D9%83%D8%B1%D8%A8%D8%AA%20%D8%A7%D8%AD%D8%B5%D8%A7%D8%A1%20%D8%A7%D9%84%D9%88%D8%AD%D8%AF%D8%A7%D8%AA</title>\n";%20docSource%20+=%20"\t\t<meta%20http-equiv=\"content-type\"%20content=\"text/html;%20charset=UTF-8\"/>\n";%20%20/*%20docSource%20+=%20"\t\t<link%20rel=\"stylesheet\"%20type=\"text/css\"%20href=\"http://"%20+%20win.location.hostname%20+%20"/style.php?type=game&amp;stamm_new_menu&amp;stamm&amp;overview&amp;1273236925\"/>\n";%20*/%20docSource%20+=%20"\t\t<link%20rel=\"stylesheet\"%20type=\"text/css\"%20href=\"http://"%20+%20win.location.hostname%20+%20"/merged/game.css\"/>\n";%20%20docSource%20+=%20"\t\t<script%20type=\"text/javascript\">\n";%20docSource%20+=%20"\t\t\t<!--\n";%20docSource%20+=%20"\t\t\tfunction%20fnShowCoords(id,description){\n";%20docSource%20+=%20"\t\t\t\tvar%20coords={};\n";%20for(item%20in%20outputSummary){%20if(outputSummary.hasOwnProperty(item)){%20if(summary[item].coords.length){%20docSource%20+=%20"\t\t\t\tcoords[\""%20+%20item%20+%20"\"]%20=%20\""%20+%20summary[item].coords.join("%20")%20+%20"\";\n";%20}%20}%20}%20docSource%20+=%20"\t\t\t\tdocument.getElementById(\"coords_group\").innerHTML%20=%20description;\n";%20docSource%20+=%20"\n";%20docSource%20+=%20"\t\t\t\tvar%20eleCoords%20=%20document.getElementById(\"coords_container\");\n";%20docSource%20+=%20"\t\t\t\teleCoords.value%20=%20coords[id]?coords[id]:\"\";\n";%20docSource%20+=%20"\t\t\t\teleCoords.focus();\n";%20docSource%20+=%20"\t\t\t\teleCoords.select();\n";%20docSource%20+=%20"\t\t\t}\n";%20docSource%20+=%20"\t\t\t-->\n";%20docSource%20+=%20"\t\t</script>\n";%20docSource%20+=%20"\t</head>\n";%20docSource%20+=%20"\n";%20docSource%20+=%20"\t<body>\n";%20docSource%20+=%20"\t\t<table%20align=\"center\"><tr><td>\n";%20docSource%20+=%20"\t\t\t<table%20class=\"content-border\"><tr><td>\n";%20docSource%20+=%20"\t\t\t\t<table%20class=\"main\"%20width=\"100%\"%20align=\"center\">\n";%20docSource%20+=%20"\t\t\t\t\t<tr>\n";%20docSource%20+=%20"\t\t\t\t\t\t<td%20id=\"content_value\">\n";%20docSource%20+=%20"\t\t\t\t\t\t\t<h2>"%20+%20fnTranslate(curGroup++)%20+%20"<sup><span%20style=\"font-size:small;\">"%20+%20strVersion%20+%20"</span></sup><sub><span%20style=\"font-weight:100;font-style:italic;text-decoration:none;font-size:x-small;\"><a%20href=\"http://ae16.tribalwars.ae/guest.php?screen=info_player&id=1341163\"%20target=\"_blank\">%D9%88%D8%AD%D8%B4%20%D8%A7%D9%84%D9%83%D9%87%D9%88%D9%81</a></span></sub></h2>\n";%20docSource%20+=%20"\t\t\t\t\t\t\t<hr>\n";%20%20docSource%20+=%20"\t\t\t\t\t\t\t<table>\n";%20docSource%20+=%20"\t\t\t\t\t\t\t\t<tr><td%20width=\"450\"%20valign=\"top\"><table%20class=\"vis\"%20width=\"100%\">\n";%20for(item%20in%20groupSummary){%20if(groupSummary.hasOwnProperty(item)){%20count=0;%20docSource%20+=%20"<tr><th%20colspan=\"2\">"%20+%20fnTranslate(curGroup++)%20+%20"</th></tr>\n";%20for(jj=0;jj<groupSummary[item].length;jj++){%20docSource%20+=%20"\t\t\t\t\t\t\t\t<tr%20class=\""%20+%20((count++%2)?"row_b":"row_a")%20+%20"\">\n";%20docSource%20+=%20"\t\t\t\t\t\t\t\t\t<td%20width=\"240\"%20style=\"white-space:nowrap;\"><a%20href=\"#\"%20onclick=\"fnShowCoords('"%20+%20groupSummary[item][jj]%20+%20"','"%20+%20fnTranslate(outputSummary[groupSummary[item][jj]].descID)%20+%20"');\"%20title=\""%20+%20fnCriteriaToStr(outputSummary[groupSummary[item][jj]].criteria)%20+%20"\">&raquo;&nbsp;%20"%20+%20fnTranslate(outputSummary[groupSummary[item][jj]].descID)%20+%20"</a></td>\n";%20docSource%20+=%20"\t\t\t\t\t\t\t\t\t<td%20width=\"240\""%20+%20((summary[groupSummary[item][jj]].tally>0)?"":"%20class=\"hidden\"")%20+%20"%20style=\"text-align:right;\"><span>"%20+%20summary[groupSummary[item][jj]].tally%20+%20"</span></td>\n";%20docSource%20+=%20"\t\t\t\t\t\t\t\t</tr>\n";%20}%20}%20}%20docSource%20+=%20"\t\t\t\t\t\t\t</table>\n";%20docSource%20+=%20"\t\t\t\t\t\t\t<td%20valign=\"top\">\n";%20%20/*%20Offensive%20Units%20*/%20docSource%20+=%20"\t\t\t\t\t\t\t\t<table%20class=\"vis\"%20width=\"100%\">\n";%20docSource%20+=%20"\t\t\t\t\t\t\t\t\t<tr><th%20colspan=\"2\"%20style=\"white-space:nowrap;\">"%20+%20fnTranslate(curGroup++)%20+%20"</th></tr>\n";%20count%20=%200;%20for(key%20in%20offense){%20if(offense.hasOwnProperty(key)){%20docSource%20+=%20"\t\t\t\t\t\t\t\t\t<tr%20class=\""%20+%20((count++%2)?"row_b":"row_a")%20+%20"\"><td><img%20src=\"http://"%20+%20win.location.hostname%20+%20"/graphic/unit/unit_"%20+%20offense[key]%20+%20".png?1\"%20alt=\"\"/></td><td%20style=\"white-space:nowrap;\"><span>%20"%20+%20summary[offense[key]].count%20+%20"%20"%20+%20unitDesc[offense[key]]%20+%20"</span></td></tr>\n";%20}%20}%20docSource%20+=%20"\t\t\t\t\t\t\t\t</table>\n";%20%20/*%20Defensive%20Units%20*/%20docSource%20+=%20"\t\t\t\t\t\t\t\t<table%20class=\"vis\"%20width=\"100%\">\n";%20docSource%20+=%20"\t\t\t\t\t\t\t\t\t<tr><th%20colspan=\"2\"%20style=\"white-space:nowrap;\">"%20+%20fnTranslate(curGroup++)%20+%20"</th></tr>\n";%20count%20=%200;%20for(key%20in%20defense){%20if(defense.hasOwnProperty(key)){%20docSource%20+=%20"\t\t\t\t\t\t\t\t\t<tr%20class=\""%20+%20((count++%2)?"row_b":"row_a")%20+%20"\"><td><img%20src=\"http://"%20+%20win.location.hostname%20+%20"/graphic/unit/unit_"%20+%20defense[key]%20+%20".png?1\"%20alt=\"\"/></td><td%20style=\"white-space:nowrap;\"><span>%20"%20+%20summary[defense[key]].count%20+%20"%20"%20+%20unitDesc[defense[key]]%20+%20"</span></td></tr>\n";%20}%20}%20docSource%20+=%20"\t\t\t\t\t\t\t\t</table>\n";%20%20/*%20Other%20Units%20*/%20docSource%20+=%20"\t\t\t\t\t\t\t\t<table%20class=\"vis\"%20width=\"100%\">\n";%20docSource%20+=%20"\t\t\t\t\t\t\t\t\t<tr><th%20colspan=\"2\"%20style=\"white-space:nowrap;\">"%20+%20fnTranslate(curGroup++)%20+%20"</th></tr>\n";%20count%20=%200;%20win.$(win.game_data.unitConfig).children().each(function(i,e){%20var%20unit=e.nodeName;%20if(!new%20RegExp('^('%20+%20defense.join('|')%20+%20'|'%20+%20offense.join('|')%20+%20')$').test(unit)){%20docSource%20+=%20"\t\t\t\t\t\t\t\t\t<tr%20class=\""%20+%20((count++%2)?"row_b":"row_a")%20+%20"\"><td><img%20src=\"http://"%20+%20win.location.hostname%20+%20"/graphic/unit/unit_"%20+%20unit%20+%20".png?1\"%20alt=\"\"/></td><td%20style=\"white-space:nowrap;\"><span>%20"%20+%20summary[unit].count%20+%20"%20"%20+%20unitDesc[unit]%20+%20"</span></td></tr>\n";%20}%20});%20docSource%20+=%20"\t\t\t\t\t\t\t\t</table>\n";%20%20/*%20Total%20Units%20*/%20docSource%20+=%20"\t\t\t\t\t\t\t\t<table%20class=\"vis\"%20width=\"100%\">\n";%20docSource%20+=%20"\t\t\t\t\t\t\t\t\t<tr><th%20colspan=\"2\"%20style=\"white-space:nowrap;\">"%20+%20fnTranslate(curGroup++)%20+%20"</th></tr>\n";%20docSource%20+=%20"\t\t\t\t\t\t\t\t\t<tr%20class=\""%20+%20"row_a"%20+%20"\"><td><span>%D8%B9%D8%AF:</span></td><td%20style=\"white-space:nowrap;\"><span>%20"%20+%20summary.unitTotal.tally%20+%20"</span></td></tr>\n";%20docSource%20+=%20"\t\t\t\t\t\t\t\t\t<tr%20class=\""%20+%20"row_b"%20+%20"\"><td><span>%D8%A7%D9%84%D8%A8%D9%88%D8%A8:</span></td><td%20style=\"white-space:nowrap;\"><span>%20"%20+%20summary.unitTotal.population%20+%20"</span></td></tr>\n";%20docSource%20+=%20"\t\t\t\t\t\t\t\t</table>\n";%20%20docSource%20+=%20"\t\t\t\t\t\t\t</td>\n";%20docSource%20+=%20"\t\t\t\t\t\t</td>\n";%20docSource%20+=%20"\t\t\t\t\t</tr>\n";%20docSource%20+=%20"\t\t\t\t</table>\n";%20docSource%20+=%20"\t\t\t\t<hr>\n";%20docSource%20+=%20"\t\t\t\t<table%20id=\"coordinate_table\"%20class=\"vis\"%20style=\"width:100%;\">\n";%20docSource%20+=%20"\t\t\t\t\t<tr><th>"%20+%20fnTranslate(curGroup++)%20+%20":%20<span%20id=\"coords_group\"%20style=\"font-weight:100;\"></span>\n";%20docSource%20+=%20"\t\t\t\t\t<tr><td%20style=\"padding:1em;\"><textarea%20id=\"coords_container\"%20style=\"width:100%;\"></textarea></td></tr>\n";%20docSource%20+=%20"\t\t\t\t</table>\n";%20docSource%20+=%20"\t\t\t</table>\n";%20docSource%20+=%20"\t\t</table>\n";%20docSource%20+=%20"\t</body>\n";%20docSource%20+=%20"</html>\n";%20%20var%20popup=win.open('about:blank','dalesmckay_tw_troopsummary','width=460,height=730,scrollbars=yes');%20popup.document.open('text/html','replace');%20popup.document.write(docSource);%20popup.document.close();%20}%20%20%20%20var%20win=(window.frames.length>0)?window.main:window;%20%20/*%20HACK:%20fix%20null%20mode%20*/%20if(!win.game_data.mode){%20var%20vmode=win.$("#overview_menu%20td[class=selected]%20a").attr("href").match(/mode\=(\w*)/i);%20if(vmode){%20win.game_data.mode=vmode[1];%20}%20}%20%20win.game_data.isPremium=(win.$("#quickbar_outer").length>0);%20%20if(typeof(win.game_data.worldConfig)=="undefined"){%20win.game_data.worldConfig=fnCreateWorldConfig();%20}%20%20if(typeof(win.game_data.unitConfig)=="undefined"){%20win.game_data.unitConfig=fnCreateUnitConfig();%20}%20%20/*%20Todo:%20Handle%20different%20scripts%20by%20name%20*/%20if(typeof(win.game_data.versionDumped)=="undefined"){%20win.game_data.versionDumped=fnLogVersionInfo();%20}%20%20if(win.game_data.mode%20!=%20"units"){%20throw("This%20script%20must%20be%20run%20from\nthe%20Overviews->Troops%20page");%20}%20%20fnCalculateTroopCount();%20%20void(0);%20}%20catch(objError){%20var%20errMsg=String(objError.message||objError||"");%20if(errMsg){%20fnDebugLog("Error:%20"%20+%20errMsg);%20alert("Error:%20"%20+%20errMsg);%20}%20}}%20%20fnExecuteScript();