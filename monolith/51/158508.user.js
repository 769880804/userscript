// ==UserScript==
// @name        Battle Damage Calculator
// @namespace   http://www.urban-rivals.com
// @description A simple calculator for playing UR :)
// @include     http://www.urban-rivals.com/*/game/flash/*/
// @version     1
// @copyright   Copyright (c) 2013 Ivan Lay
// ==/UserScript==
var panel = document.createElement("div");
panel.setAttribute("id","panel");
panel.setAttribute("class","drag");
panel.setAttribute("title","drag me :)");
panel.innerHTML='<span class="nama">Opp | </span><span id="bul1" class="gambar serangan"></span> <span id="atk1">1</span> <span id="trp1" class="gambar piala"></span><br/><span class="gambar kekuatan"></span><input type="text" id="pwr1" maxlength="2" title="power" value="1"/> <span class="gambar pil"></span><input type="button" id="left1" value="<"/><input type="text" id="pil1" maxlength="2" title="pillz" value="1"/><input type="button" id="right1" value=">"/><br/><span class="gambar kemampuan"></span><select id="at1"><option value="0">No ability</option><option value="1">+ Attack</option><option value="2">+ Power</option><option value="3">- Opp Attack</option><option value="4">- Opp Power</option></select><input type="text" id="ab1" maxlength="2" title="ability"/><br/><span class="gambar bonus"></span><select id="bt1"><option value="0">No bonus</option><option value="1">+ Attack</option><option value="2">+ Power</option><option value="3">- Opp Attack</option><option value="4">- Opp Power</option></select><input type="text" id="bn1" maxlength="2" title="bonus"/><hr color="#FFD700"/><span class="nama">Me | </span><span id="bul2" class="gambar serangan"></span> <span id="atk2">1</span> <span id="trp2" class="gambar piala"></span><br/><span class="gambar kekuatan"></span><input type="text" id="pwr2" maxlength="2" title="power" value="1"/> <span class="gambar pil"></span><input type="button" id="left2" value="<"/><input type="text" id="pil2" maxlength="2" title="pillz" value="1"/><input type="button" id="right2" value=">"/><br/><span class="gambar kemampuan"></span><select id="at2"><option value="0">No ability</option><option value="1">+ Attack</option><option value="2">+ Power</option><option value="3">- Opp Attack</option><option value="4">- Opp Power</option></select><input type="text" id="ab2" maxlength="2" title="ability"/><br/><span class="gambar bonus"></span><select id="bt2"><option value="0">No bonus</option><option value="1">+ Attack</option><option value="2">+ Power</option><option value="3">- Opp Attack</option><option value="4">- Opp Power</option></select><input type="text" id="bn2" maxlength="2" title="bonus"/><div id="about">Â©Ivan Lay 2013</div>';
document.getElementById("playerMenuPseudo").appendChild(panel);
//document.body.appendChild(panel);

var style = document.createElement("style");
style.setAttribute("type","text/css");
style.innerHTML='.drag{position: relative;cursor: move;}#panel{width: 200px;height: 273px;border: 1px dashed gold;color: #ffffff;background-color: #2b6b6d;padding: 5px;top: 50px;left: 50px;z-index: 7;}input{position: relative;top: -6px;}input[type=text]{width: 30px;}select{position: relative;top: -6px;}.nama{font-weight: bold;position: relative;top: -6px;}#atk1, #atk2{position: relative;top: -6px;}#about{color: #FFD700;text-align: right;font-size: 7px;cursor: crosshair;}#bul1, #bul2{cursor: pointer;}.gambar{background: url("http://s.ccdn.ur-img.com/img/sprites/icons/icons.png?1354033872") no-repeat scroll left top transparent;display: inline-block;}.serangan{background-position: -92px -235px;height: 24px;width: 24px;}.kekuatan{background-position: -0px -380px;height: 24px;width: 24px;}.kerusakan{background-position: -38px -331px;height: 24px;width: 24px;}.kemampuan{background-position: -98px -187px;height: 24px;width: 24px;}.bonus{background-position: -66px -283px;height: 24px;width: 24px;}.pil{background-position: -175px -106px;height: 18px;width: 9px;position: relative;top: -2px;}.piala{background-position: -34px -428px;height: 21px;width: 18px;float: right;display: none;}';
document.head.appendChild(style);

function _(id){return document.getElementById(id);}function count(){console.info("counting powers...");var pwr1=parseInt(_("pwr1").value);var pil1=parseInt(_("pil1").value);var ab1=parseInt(_("ab1").value);var bn1=parseInt(_("bn1").value);var at1=_("at1").selectedIndex;var bt1=_("bt1").selectedIndex;var aap1=0;var aam1=0;var bap1=0;var bam1=0;var app1=0;var apm1=0;var bpp1=0;var bpm1=0;var pwr2=parseInt(_("pwr2").value);var pil2=parseInt(_("pil2").value);var ab2=parseInt(_("ab2").value);var bn2=parseInt(_("bn2").value);var at2=_("at2").selectedIndex;var bt2=_("bt2").selectedIndex;var aap2=0;var aam2=0;var bap2=0;var bam2=0;var app2=0;var apm2=0;var bpp2=0;var bpm2=0;if (!isNaN(pwr1) && !isNaN(pil1)){if (at1!=0 && !isNaN(ab1)){switch(at1){case 1: aap1=ab1;app1=0;aam2=0;apm2=0;break;case 2: aap1=0;app1=ab1;aam2=0;apm2=0;break;case 3: aap1=0;app1=0;aam2=ab1;apm2=0;break;case 4: aap1=0;app1=0;aam2=0;apm2=ab1;break;}}if (bt1!=0 && !isNaN(bn1)){switch(bt1){case 1: bap1=bn1;bpp1=0;bam2=0;bpm2=0;break;case 2: bap1=0;bpp1=bn1;bam2=0;bpm2=0;break;case 3: bap1=0;bpp1=0;bam2=bn1;bpm2=0;break;case 4: bap1=0;bpp1=0;bam2=0;bpm2=bn1;break;}}}if (!isNaN(pwr2) && !isNaN(pil2)){if (at2!=0 && !isNaN(ab2)){switch(at2){case 1: aap2=ab2;app2=0;aam1=0;apm1=0;break;case 2: aap2=0;app2=ab2;aam1=0;apm1=0;break;case 3: aap2=0;app2=0;aam1=ab2;apm1=0;break;case 4: aap2=0;app2=0;aam1=0;apm1=ab2;break;}}if (bt2!=0 && !isNaN(bn2)){switch(bt2){case 1: bap2=bn2;bpp2=0;bam1=0;bpm1=0;break;case 2: bap2=0;bpp2=bn2;bam1=0;bpm1=0;break;case 3: bap2=0;bpp2=0;bam1=bn2;bpm1=0;break;case 4: bap2=0;bpp2=0;bam1=0;bpm1=bn2;break;}}}if (!isNaN(pwr1) && !isNaN(pil1))_("atk1").innerHTML=((pwr1+app1+bpp1-apm1-bpm1)*pil1)+aap1+bap1-aam1-bam1;if (!isNaN(pwr2) && !isNaN(pil2))_("atk2").innerHTML=((pwr2+app2+bpp2-apm2-bpm2)*pil2)+aap2+bap2-aam2-bam2;if (!isNaN(pwr1) && !isNaN(pil1) &&!isNaN(pwr2) && !isNaN(pil2)){var atk1=parseInt(_("atk1").innerHTML);var atk2=parseInt(_("atk2").innerHTML);if (atk1 > atk2){_("trp1").style.display="block";_("trp2").style.display="none";}else if (atk1 < atk2){_("trp1").style.display="none";_("trp2").style.display="block";}else{_("trp1").style.display="none";_("trp2").style.display="none";}}}_("bul1").onclick=count;_("pwr1").onchange=count;_("pil1").onchange=count;_("ab1").onchange=count;_("bn1").onchange=count;_("at1").onchange=count;_("bt1").onchange=count;_("bul2").onclick=count;_("pwr2").onchange=count;_("pil2").onchange=count;_("ab2").onchange=count;_("bn2").onchange=count;_("at2").onchange=count;_("bt2").onchange=count;_("left1").onclick=function(){var pil=parseInt(_("pil1").value);if (!isNaN(pil)){if (pil>1) pil--;_("pil1").value=pil;}count();};_("right1").onclick=function(){var pil=parseInt(_("pil1").value);if (!isNaN(pil)){pil++;_("pil1").value=pil;}count();};_("left2").onclick=function(){var pil=parseInt(_("pil2").value);if (!isNaN(pil)){if (pil>1) pil--;_("pil2").value=pil;}count();};_("right2").onclick=function(){var pil=parseInt(_("pil2").value);if (!isNaN(pil)){pil++;_("pil2").value=pil;}count();};_("about").onclick=function(){_("atk1").innerHTML="1";_("pwr1").value="1";_("pil1").value="1";_("ab1").value="";_("bn1").value="";_("at1").selectedIndex=0;_("bn1").selectedIndex=0;_("atk2").innerHTML="1";_("pwr2").value="1";_("pil2").value="1";_("ab2").value="";_("bn2").value="";_("at2").selectedIndex=0;_("bn2").selectedIndex=0;};var _startX=0;var _startY=0;var _offsetX=0;var _offsetY=0;var _dragElement;var _oldZIndex=0;InitDragDrop();function InitDragDrop(){document.onmousedown=OnMouseDown;document.onmouseup=OnMouseUp;}function OnMouseDown(e){if (e==null) e=window.event;var target=e.target !=null ? e.target : e.srcElement;if ((e.button==1 && window.event !=null || e.button==0) && target.className=='drag'){_startX=e.clientX;_startY=e.clientY;_offsetX=ExtractNumber(target.style.left);_offsetY=ExtractNumber(target.style.top);_oldZIndex=target.style.zIndex;target.style.zIndex=10000;_dragElement=target;document.onmousemove=OnMouseMove;document.body.focus();document.onselectstart=function (){return false;};target.ondragstart=function(){return false;};return false;}}function ExtractNumber(value){var n=parseInt(value);return n==null || isNaN(n) ? 0 : n;}function OnMouseMove(e){if (e==null) var e=window.event;_dragElement.style.left=(_offsetX + e.clientX - _startX) + 'px';_dragElement.style.top=(_offsetY + e.clientY - _startY) + 'px';_debug.innerHTML='(' + _dragElement.style.left + ', ' + _dragElement.style.top + ')';}function OnMouseUp(e){if (_dragElement !=null){_dragElement.style.zIndex=_oldZIndex;document.onmousemove=null;document.onselectstart=null;_dragElement.ondragstart=null;_dragElement=null;_debug.innerHTML='mouse up';}}
