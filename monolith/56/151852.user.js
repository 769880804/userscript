// ==UserScript==
// @id             inyourcircles@lillayzie
// @name           in your circles for Google+
// @version        1.1.7
// @namespace      LilLayzie
// @author         Lil Layzie, Original by Lil Layzie
// @description    Bring back "in your circles"
// @match          https://plus.google.com/*
// @match          http://userscripts.org/scripts/source/125875.user.js
// @run-at         document-end
// ==/UserScript==
function DOMInsertedEventHandler(n) { return function (t) { t.forEach(function (t) { t.addedNodes.length == 1 && n(t.addedNodes[0]) }) } } function Settings() { this.showNotifi = !0, this.lineNumber = 3, this.columnNumber = 5 } function saveSettings() { localStorage[settingsEntry] = JSON.stringify(settings) } function checkUpdate() { var n = nav_warp[eC]("update")[0]; n[cL].contains("found") ? n[s][ds] = "block" : GM_xmlhttpRequest({ method: "GET", url: "http://userscripts.org/scripts/source/125875.user.js", onload: function (t) { var i = t.responseText.match(/(\/\/\s*@version\s+)([^\r\n]*).*/)[2]; i != version && (n[cL].add("found"), n[eC]("newVersion")[0].textContent = i, n[s][ds] = "block") } }) } function insert() { if (!d.URL.match(/https:\/\/plus\.google\.com(\/u\/\d+)?\/?stream\/circles\/.+/i) && !d.URL.match(/https:\/\/plus\.google\.com(\/u\/\d+)?\/?b\/.+/i) && d.URL.match(/https:\/\/plus\.google\.com(\/u\/\d)?/)) { var n = d.querySelector('div[class="' + cNs.parent + '"]'); n && !n.firstChild[cL].contains("iYC") && n.insertBefore(nav_warp, n.childNodes[0]) } } var version = "1.1.7", classNames = { parent: "op hu a-f-e Ala", warp: "Tr TC", language: "a-n Cna", main_div: "NB Om", sub_div: "bS Ym", header: "TP tx hp", content: "SP Ov", button: "a-n xK qu", placehoder: "XO", photo_img: "Zb HPb", photo_archor: "g-s-n-aa Wk", colume_div: "t1a a-f-e GPb g-M-n", ul: "B8 vWa", li: "Ty QK aHa", photo_box: "fSa", hover_card: "g-al-Xk", hover_card_name: "Tt" }, cNs = classNames, aC = "appendChild", aE = "addEventListener", cE = "createElement", cK = "checked", cL = "classList", cN = "className", d = document, ds = "display", dv = "div", eC = "getElementsByClassName", f = !1, MO = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver, s = "style", t = !0, tC = "textContent", settingsEntry = "inYourCirclesSettings", settings = localStorage[settingsEntry] ? JSON.parse(localStorage[settingsEntry]) : new Settings; settings.columnNumber = settings.columnNumber || 5, saveSettings(); var languagePairs = { "??(??)": { head: "???????", foot: "????", settings: "??", showNotifi: "??????", lineNumber: "??", columnNumber: "??" }, "????": { head: "???????", foot: "????", settings: "??", showNotifi: "??????", lineNumber: "??", columnNumber: "??" }, "??(??)": { head: "???????", foot: "????", settings: "??", showNotifi: "??????", lineNumber: "??", columnNumber: "??" }, "???": { head: "?????????", foot: "?????", settings: "??", showNotifi: "Show update notification", lineNumber: "Number of rows", columnNumber: "Number of columns" }, Default: { head: "In your circles", foot: "View all", settings: "Settings", showNotifi: "Show update notification", lineNumber: "Number of rows", columnNumber: "Number of columns" } }, relevanceObj = {}, nav_warp = d[cE](dv); nav_warp[cN] = cNs.warp + " iYC", GM_xmlhttpRequest({ method: "GET", url: d.URL.match(/https:\/\/plus\.google\.com(\/u\/\d+)?/)[0] + "/_/socialgraph/lookup/circles/?ct=2&rt=j&m=true&tag=fg&_reqid=" + +new Date % 1e6, onload: function (n) { function f() { var u = Math.floor(252 / settings.columnNumber - 2), f, e, n, t, r, o; for (GM_addStyle(".iYC .Zb{height: " + u + "px; width: " + u + "px}"), f = Math.min(i.length, settings.lineNumber * settings.columnNumber), e = "", n = 0; n < i.length; n++) t = i[n][2][8], i[n][3][0][2][0] != 15 && t ? (r = i[n][0][2], n < f && (o = i[n][2][0], t = t.replace("/photo.jpg", "/s" + u + "-c-k/photo.jpg"), e += '<div class="' + cNs.colume_div + '" colindex="' + n + '"><a class="' + cNs.photo_archor + '" href="./' + r + '" oid="' + r + '"><img src="' + t + '" class="' + cNs.photo_img + '" oid="' + r + '"><\/a><\/div>'), relevanceObj[r] = i[n][2][3]) : f++; return e } var i = eval("//" + n.responseText)[0][1][2], t, e = d[eC](cNs.language)[0], r, u; t = e ? languagePairs[e.innerHTML] || languagePairs.Default : languagePairs.Default, r = '<div class="' + cNs.main_div + '"><ul class="' + cNs.ul + '"><li class="' + cNs.li + '" rowindex="0"><div><div class="' + cNs.photo_box + '">', GM_addStyle(".t1a.a-f-e.GPb.g-M-n{margin-right:2px !important;line-height:13px !important;}"), r += f(), r += '<\/div><div class="' + cNs.placehoder + '"><\/div><\/div><\/li><\/ul><div class="settings" style="border-top: 1px solid rgb(233, 233, 233);border-bottom: 1px solid rgb(233, 233, 233);padding:15px 0;display:none"><div><input type="checkbox" class="showNotifi">' + t.showNotifi + '<\/div><div class="iYCSD">' + t.lineNumber + '<input type="number" min="1" max="10" value="0" size="3" class="iYCSI lineNumber"><\/div><div class="iYCSD">' + t.columnNumber + '<input type="number" min="4" max="8" value="0" size="3" class="iYCSI columnNumber"><\/div><\/div><div class="update" style="padding-top:15px; display:none">Found a new version <span class="newVersion"><\/span>, click <a target="_blank" href="http://userscripts.org/scripts/source/125875.user.js">here<\/a> to update.<\/div>', GM_addStyle(".iYCSD{padding-top:8px}.iYCSI{float:right}"), nav_warp.innerHTML = '<div class="' + cNs.main_div + '"><div class="' + cNs.sub_div + '"><h3 class="' + cNs.header + '"><span>' + t.head + '<\/span><\/h3><a href="/circles" style="float: right; position: relative !important;" role="button" class="' + cNs.button + '" title="' + t.foot + '" tabindex="0">' + t.foot + '<\/a><a class="' + cNs.button + ' switch" style="float: right; position: relative !important;" role="button">' + t.settings + "<\/a><\/span><\/div>" + r + "<\/div>", u = !1, nav_warp[eC]("switch")[0][aE]("click", function () { u = !u, nav_warp[eC]("showNotifi")[0][cK] = settings.showNotifi, nav_warp[eC]("lineNumber")[0].value = settings.lineNumber, nav_warp[eC]("columnNumber")[0].value = settings.columnNumber, nav_warp[eC]("settings")[0][s][ds] = u ? "block" : "none" }), nav_warp[eC]("showNotifi")[0][aE]("change", function () { settings.showNotifi = this[cK], settings.showNotifi ? checkUpdate() : nav_warp[eC]("update")[0][s][ds] = "none", saveSettings() }), nav_warp[eC]("lineNumber")[0][aE]("change", function () { this.value > 10 ? this.value = 10 : this.value < 1 && (this.value = 1), settings.lineNumber = this.value, saveSettings(), nav_warp[eC](cNs.photo_box)[0].innerHTML = f() }), nav_warp[eC]("columnNumber")[0][aE]("change", function () { this.value > 8 ? this.value = 8 : this.value < 4 && (this.value = 4), settings.columnNumber = this.value, saveSettings(), nav_warp[eC](cNs.photo_box)[0].innerHTML = f() }), settings.showNotifi && checkUpdate() } }), insert(), new MO(DOMInsertedEventHandler(function (n) { if (n[cN] == cNs.hover_card) { var t; (t = relevanceObj[n[eC](cNs.hover_card_name)[0].getAttribute("o")]) && (n.firstChild.innerHTML += '<div style="position: absolute; right: 1px; bottom: 0px;">' + t + "<\/div>") } })).observe(d.body, { childList: t }), new MO(DOMInsertedEventHandler(function (n) { n[cN] == cNs.warp && insert() })).observe(d.body, { childList: t, childList: t })
