// ==UserScript==
// @name           SFC BANG! HOSTED Database (SFO)
// @include        http://playstarfleet.com/options*
// @include        http://playstarfleet.com/galaxy*
// @include        http://playstarfleet.com/leaderboard*
// @version        1.6.5

// ==/UserScript==

var myParse = '\nvar version = \"1.6.5\";\nvar playerNameElem, playerName, rank\nvar planet, planetNameElem, planetName;\nvar allianceNameElem, allianceName;\nvar moon, moonNameElem, moonName, moonPlayerNameElm, moonPlayerName;\nvar coordsElem, coords;\nvar slot = 1;\nvar urlSubmit = \"\", aCls = \"\";\nvar urlSearch = \"\";\nvar svAddr = \"file:///C|\Users\Glenn\Desktop\test1.txt";\nvar activate_p = document.URL.match(\/activate_planet=([0-9]*)\/);\nvar current_p = document.URL.match(\/current_planet=([0-9]*)\/);\nvar planet_id = \"\";\nvar galaxyLink = \"\";\nvar thisSystemNum = document.URL.match(\/solar_system=([0-9]*)\/);\nvar thisGalaxyNum = document.URL.match(\/galaxy=([0-9]*)\/);\nvar planetIsHeph = false;\nvar vmode = \"\";\ncoordsElem = document.getElementsByClassName(\'current_solar_system\');\ncoords = coordsElem[0].textContent.match(\/\\d{1,2}:\\d{1,3}\/g);\n\n\n\/\/ c = coords\n\/\/ \n\n\nurlSubmitF = svAddr + \"listener.ashx?c=\" + coords + \"&vInfo=\" + version;\nvar urlSubmit = \"\";\nvar urlSubmitNext = \"\";\n\nvar active = false;\nif (document.URL.indexOf(\"http:\/\/playstarfleet.com\") != -1) {\n\tactive = true;\n}\n\nif (activate_p) {\n\tplanet_id = activate_p[1];\n}\nelse if (current_p) {\n\tplanet_id = current_p[1];\n}\n\nthisSystem = parseInt(document.getElementById(\'solar_system\').getAttribute(\'value\'))\nthisGalaxy = parseInt(document.getElementById(\'galaxy\').getAttribute(\'value\'))\n\nif (thisSystem == 499) {\n\tthisSystem = 1;\n\tif (thisGalaxy == 20) {\n\t\tthisGalaxy = 1;\n\t} else {\n\t\tthisGalaxy++;\n\t}\n\tcoordsElem[0].innerHTML = coordsElem[0].innerHTML.replace(\"499\", \"499  <a href=\\\"\/galaxy\/show?current_planet=\" + planet_id + \"&galaxy=\" + thisGalaxy + \"&solar_system=\" + thisSystem + \"\\\">>><\/a> \");\n}\n\n\n\nthisSystemA = parseInt(document.getElementById(\'solar_system\').getAttribute(\'value\'))\nthisGalaxyA = parseInt(document.getElementById(\'galaxy\').getAttribute(\'value\'))\n\n\nif (thisSystemA == 1) {\n\n\tthisSystemA = 499;\n\tif (thisGalaxyA == 1) {\n\t\tthisGalaxyA = 20;\n\t} else {\n\t\tthisGalaxyA--;\n\t}\n\tcoordsElem[0].innerHTML = coordsElem[0].innerHTML.replace(\"Solar\", \"<a href=\\\"\/galaxy\/show?current_planet=\" + planet_id + \"&galaxy=\" + thisGalaxyA + \"&solar_system=\" + thisSystemA + \"\\\"><<<\/a>  Solar\");\n\t\/\/alert(thisSystemA);\n\n}\n\nnavalign = localStorage.getItem(\"navalign\");\niownSystems = localStorage.getItem(\"iown1\");\niuseArrows = localStorage.getItem(\"iArrow1\");\n\ncoordsElem[0].style.textAlign = navalign;\n\nif (active) {\n\n\tfor (var slot = 1; slot < 16; slot++) {\n\t\tvar planetActivity = \"\";\n\t\tplanet = document.getElementById(\'planet_\' + slot);\n\t\tplanetNameElem = planet.getElementsByClassName(\'name\');\n\t\tif (planet.getElementsByClassName(\'activity\').length > 0) {\n\t\t\tplanetActivity = planet.getElementsByClassName(\'activity\')[0].textContent;\n\n\t\t}\n\t\tplanetName = planetNameElem[0].textContent.replace(\/\\((\\*|\\d{1,2} min)\\)\/g, \"\").replace(\"[ Rename ]\", \"\").trim();\n\n\t\tplanetIsHeph = false;\n\t\tif (planetNameElem[0].getElementsByTagName(\'img\')[0] != null) {\n\t\t\tplanetIsHeph = (planetNameElem[0].getElementsByTagName(\'img\')[0].getAttribute(\'title\') == \'Hephaestus Class Attack Platform\');\n\t\t}\n\n\t\tplayerNameElem = planet.getElementsByClassName(\'player\');\n\t\t\/\/\t\tplayerName = playerNameElem[0] ? playerNameElem[0].innerHTML.replace(\/<[\/]?[^>]*>\/g,\'\') : \'\'; \n\n\t\t\/\/ player name works\n\t\tplayerName = playerNameElem[0].textContent.replace(\/\\([viInNd!s]*\\)\/g, \"\").replace(\/#[\\d,]*\/g, \"\").trim();\n\n\n\t\tif (!playerNameElem[0]) {\n\t\t\tplayerName = \'\';\n\t\t\tvmode = \'\';\n\t\t} else {\n\n\t\t\t\/\/playerName = playerNameElem[0].getElementsByTagName(\'span\')[0] != null ? playerNameElem[0].getElementsByTagName(\'span\')[0].childNodes[0].textContent.trim() : \'\';\n\n\t\t\tif (playerNameElem[0].getElementsByTagName(\'span\')[0] != null) {\n\t\t\t\tif (playerNameElem[0].getElementsByTagName(\'span\')[0].childNodes[0].textContent.trim() == \'\') {\n\t\t\t\t\tplayerName = playerNameElem[0].getElementsByTagName(\'span\')[0].childNodes[1].textContent.trim();\n\t\t\t\t} else {\n\t\t\t\t\tplayerName = playerNameElem[0].getElementsByTagName(\'span\')[0].childNodes[0].textContent.trim();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar vmodeElement = planet.getElementsByClassName(\"status\")[0];\n\t\t\tif (vmodeElement.getElementsByClassName(\"symbols\").length > 0) {\n\t\t\t\tvmode = vmodeElement.getElementsByClassName(\"symbols\")[0].textContent;\n\t\t\t} else {\n\t\t\t\tvmode = \'\';\n\t\t\t}\n\n\/\/\t\t\tif (playerNameElem[0].innerHTML.replace(\/^\\s+|\\s+$\/g, \"\").length > 0) {\n\/\/\t\t\t\tif (playerNameElem[0].getElementsByTagName(\'span\')[1].getAttribute(\'class\') == \'symbols\') {\n\/\/\t\t\t\t\tvmode = playerNameElem[0].getElementsByTagName(\'span\')[1].innerHTML.replace(\/\\(|\\)\/g, \'\');\n\/\/\t\t\t\t} else { vmode = \'\' };\n\/\/\t\t\t}\n\n\n\t\t}\n\n\t\tif (playerNameElem[0].getElementsByTagName(\'span\')[0] != null) {\n\t\t\tif (playerNameElem[0].getElementsByTagName(\'span\')[0].childNodes[0].textContent.trim() == \'\') {\n\t\t\t\tf = playerNameElem[0].getElementsByTagName(\'span\')[1].childNodes[0].textContent;\n\n\t\t\t\tif (f[0] != \"(\") {\n\t\t\t\t\trank = trim(f);\n\t\t\t\t} else {\n\t\t\t\t\trank = trim(playerNameElem[0].getElementsByTagName(\'span\')[2].textContent);\n\t\t\t\t}\n\t\t\t} else {\n\n\t\t\t\tf1 = playerNameElem[0].getElementsByTagName(\'span\')[0].childNodes[1].textContent;\n\n\t\t\t\tif (f1[0] != \"(\") {\n\t\t\t\t\trank = trim(f1);\n\t\t\t\t} else {\n\t\t\t\t\trank = trim(playerNameElem[0].getElementsByTagName(\'span\')[0].textContent);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tallianceNameElem = planet.getElementsByClassName(\'alliance\');\n\t\tallianceName = allianceNameElem[0].textContent.trim();\n\t\tvar moonActivity = \"\";\n\t\tif (playerName != \"\") {\n\n\t\t\tif (slot < 9) {\n\n\t\t\t\t\/\/ n = name\n\t\t\t\t\/\/ ih = isheph\n\t\t\t\t\/\/ p = player\n\t\t\t\t\/\/ a = alliance\n\t\t\t\t\/\/ ac = activity\n\t\t\t\t\/\/ r = rank\n\t\t\t\t\/\/ v = vmode\n\t\t\t\t\/\/ m = moon\n\t\t\t\t\/\/ mac = moonactivity\n\n\n\t\t\t\turlSubmit = urlSubmit + \"&n\" + slot + \"=\" + fixedEncodeURIComponent(planetName);\n\t\t\t\turlSubmit = urlSubmit + \"&ih\" + slot + \"=\" + fixedEncodeURIComponent(planetIsHeph);\n\t\t\t\turlSubmit = urlSubmit + \"&p\" + slot + \"=\" + fixedEncodeURIComponent(playerName);\n\t\t\t\turlSubmit = urlSubmit + \"&a\" + slot + \"=\" + fixedEncodeURIComponent(allianceName);\n\t\t\t\turlSubmit = urlSubmit + \"&ac\" + slot + \"=\" + fixedEncodeURIComponent(planetActivity);\n\t\t\t\turlSubmit = urlSubmit + \"&r\" + slot + \"=\" + fixedEncodeURIComponent(rank);\n\t\t\t\turlSubmit = urlSubmit + \"&v\" + slot + \"=\" + fixedEncodeURIComponent(vmode);\n\n\t\t\t\tmoon = document.getElementById(\'planet_\' + slot + \'m\');\n\t\t\t\turlSearch = svAddr + \"authredir.ashx?action=search&by=name&p=\" + fixedEncodeURIComponent(playerName);\n\t\t\t\turlSearch = urlSearch + \"&planet_id=\" + planet_id;\n\t\t\t\turlSearch = urlSearch + \"&exactSearch=true\";\n\t\t\t\tif (moon != null) {\n\t\t\t\t\tmoonNameElem = moon.getElementsByClassName(\'name\');\n\t\t\t\t\tif (moon.getElementsByClassName(\'activity\').length > 0) {\n\t\t\t\t\t\tmoonActivity = moon.getElementsByClassName(\'activity\')[0].textContent;\n\t\t\t\t\t}\n\t\t\t\t\tmoonPlayerNameElm = moon.getElementsByClassName(\'player\');\n\t\t\t\t\tmoonName = moonNameElem[0].textContent.replace(\/\\((\\*|\\d{1,2} min)\\)\/g, \"\").replace(\"[ Rename ]\", \"\").trim();\n\t\t\t\t\tif (moonPlayerNameElm[0].innerHTML.search(\"not_attackable\") == -1) {\n\t\t\t\t\t\tmoonPlayerNameElm[0].getElementsByClassName(\"attackable\")[0].innerHTML += \"<a class=\'attackable\' href=\'\" + urlSearch + \"\' target=\'_blank\'>B!<\/a>\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmoonPlayerNameElm[0].getElementsByClassName(\"not_attackable\")[0].innerHTML += \"<a class=\'not_attackable\' href=\'\" + urlSearch + \"\' target=\'_blank\'>B!<\/a>\";\n\t\t\t\t\t}\n\t\t\t\t\turlSubmit = urlSubmit + \"&m\" + slot + \"=\" + fixedEncodeURIComponent(moonName);\n\t\t\t\t\turlSubmit = urlSubmit + \"&mac\" + slot + \"=\" + fixedEncodeURIComponent(moonActivity);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\turlSubmitNext = urlSubmitNext + \"&n\" + slot + \"=\" + fixedEncodeURIComponent(planetName);\n\t\t\t\turlSubmitNext = urlSubmitNext + \"&ih\" + slot + \"=\" + fixedEncodeURIComponent(planetIsHeph);\n\t\t\t\turlSubmitNext = urlSubmitNext + \"&p\" + slot + \"=\" + fixedEncodeURIComponent(playerName);\n\t\t\t\turlSubmitNext = urlSubmitNext + \"&a\" + slot + \"=\" + fixedEncodeURIComponent(allianceName);\n\t\t\t\turlSubmitNext = urlSubmitNext + \"&ac\" + slot + \"=\" + fixedEncodeURIComponent(planetActivity);\n\t\t\t\turlSubmitNext = urlSubmitNext + \"&r\" + slot + \"=\" + fixedEncodeURIComponent(rank);\n\t\t\t\turlSubmitNext = urlSubmitNext + \"&v\" + slot + \"=\" + fixedEncodeURIComponent(vmode);\n\n\t\t\t\tmoon = document.getElementById(\'planet_\' + slot + \'m\');\n\t\t\t\turlSearch = svAddr + \"authredir.ashx?action=search&by=name&p=\" + fixedEncodeURIComponent(playerName);\n\t\t\t\turlSearch = urlSearch + \"&planet_id=\" + planet_id;\n\t\t\t\turlSearch = urlSearch + \"&exactSearch=true\";\n\t\t\t\tif (moon != null) {\n\t\t\t\t\tmoonNameElem = moon.getElementsByClassName(\'name\');\n\t\t\t\t\tif (moon.getElementsByClassName(\'activity\').length > 0) {\n\t\t\t\t\t\tmoonActivity = moon.getElementsByClassName(\'activity\')[0].textContent;\n\t\t\t\t\t}\n\t\t\t\t\tmoonPlayerNameElm = moon.getElementsByClassName(\'player\');\n\t\t\t\t\tmoonName = moonNameElem[0].textContent.replace(\/\\((\\*|\\d{1,2} min)\\)\/g, \"\").replace(\"[ Rename ]\", \"\").trim();\n\t\t\t\t\tif (moonPlayerNameElm[0].innerHTML.search(\"not_attackable\") == -1) {\n\t\t\t\t\t\tmoonPlayerNameElm[0].getElementsByClassName(\"attackable\")[0].innerHTML += \"<a class=\'attackable\' href=\'\" + urlSearch + \"\' target=\'_blank\'>B!<\/a>\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmoonPlayerNameElm[0].getElementsByClassName(\"not_attackable\")[0].innerHTML += \"<a class=\'not_attackable\' href=\'\" + urlSearch + \"\' target=\'_blank\'>B!<\/a>\";\n\t\t\t\t\t}\n\t\t\t\t\turlSubmitNext = urlSubmitNext + \"&m\" + slot + \"=\" + fixedEncodeURIComponent(moonName);\n\t\t\t\t\turlSubmitNext = urlSubmitNext + \"&mac\" + slot + \"=\" + fixedEncodeURIComponent(moonActivity);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (playerNameElem[0].innerHTML.search(\"not_attackable\") == -1) {\n\t\t\t\tplayerNameElem[0].getElementsByClassName(\"attackable\")[0].innerHTML += \"<a class=\'attackable\' href=\'\" + urlSearch + \"\' target=\'_blank\'>B!<\/a>\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\tplayerNameElem[0].getElementsByClassName(\"not_attackable\")[0].innerHTML += \"<a class=\'not_attackable\' href=\'\" + urlSearch + \"\' target=\'_blank\'>B!<\/a>\";\n\t\t\t}\n\t\t}\n\t}\n\tvar cUrl = urlSubmitF + urlSubmit + urlSubmitNext;\n\tif (cUrl.length < 2000) {\n\t\tsend(active, cUrl, true);\n\t} else {\n\n\t\tsend(active, urlSubmitF + urlSubmit + \"&s=1\", false);\n\t\tsend(active, urlSubmitF + urlSubmitNext + \"&s=2\", true);\n\n\t}\n\n\n\n}\n\nvar vPlanet = (\/_planet=\\d+\/.test(document.location.href)) ? document.location.href.match(\/_planet=(\\d+)\/i)[1] : \'\';\nvar vGalaxy = parseInt(document.getElementById(\'galaxy\').getAttribute(\'value\'));\nvar vSystem = parseInt(document.getElementById(\'solar_system\').getAttribute(\'value\'));\n\nif (iuseArrows == \"Yes\") {\n\twindow.addEventListener(\'keydown\', KeyCheck, true);\n}\n\n\n\n\nfunction send(active, urlSubmit, show) {\n\n\tif (active) {\n\n\t\tif (iownSystems == \"Yes\") {\n\t\t\turlSubmit = urlSubmit + \"&iown=true\";\n\t\t}\n\n\t\t\/\/alert(urlSubmit.length);\n\n\t\tvar errMsgElem = document.getElementsByClassName(\'description\');\n\t\tvar errMsg = errMsgElem[0];\n\n\t\t\/\/errMsg.innerHTML += urlSubmit;\n\t\t\/\/if (urlSubmit.length > 90) {\n\n\t\tvar req = false;\n\t\tif (window.XMLHttpRequest) {\n\t\t\ttry { req = new XMLHttpRequest(); } catch (e) { req = false; }\n\t\t} else {\n\t\t\talert(\'no window.xmlhttprequest\');\n\t\t}\n\t\tif (req) {\n\t\t\treq.open(\'GET\', urlSubmit, true);\n\t\t\treq.setRequestHeader(\'User-Agent\', \'XMLHTTP\/1.0\');\n\t\t\treq.onload = function () {\n\n\t\t\t\tif (req.status == 200) {\n\t\t\t\t\tif (show) errMsg.innerHTML += \" \/\/ X2: <span style=\'color: rgb(10, 255, 10);\'>OK<\/span>\";\n\t\t\t\t} else if (req.status == 410) { errMsg.innerHTML += \" \/\/ X2: <span style=\'color: rgb(10, 255, 10);\'><a href=\'http:\/\/sfo.lytjohan.net\/X2StaticScript\/sfc_SFO_v5.user.js\'>Update required<\/a><\/span>\"; } else { if (show) errMsg.innerHTML += \" \/\/ X2: <span style=\'color: blue\'>OK<\/span>\"; }\n\t\t\t}\n\t\t\treq.send();\n\t\t\t\/\/if (show) errMsg.innerHTML += \" \/\/ X2: <span style=\'color: rgb(10, 255, 10);\'>OK<\/span>\";\n\t\t} else { if (show) errMsg.innerHTML += \" \/\/ X2: <span style=\'color: rgb(255, 10, 10);\'>Update Failed<\/span>\"; }\n\t\t\/\/} else {\n\t\t\/\/\terrMsg.innerHTML += \": <span style=\'color: rgb(255, 10, 10);\'>Bad Script or MT Syst.<\/span>\";\n\t\t\/\/}\n\n\t}\n\n}\n\nfunction KeyCheck(V) {\n\tswitch (V.keyCode) {\n\t\tcase 37:\n\t\t\t\/\/left \n\t\t\tvSystem--;\n\t\t\tif (vSystem < 1) {\n\t\t\t\tvGalaxy--;\n\t\t\t\tif (vGalaxy < 1) vGalaxy = 20;\n\t\t\t\tvSystem = 499;\n\t\t\t}\n\t\t\tGetClassItem(document, \'div\', \'current_solar_system\').innerHTML = \'<a href=\"\' + \'\/galaxy\/show?current_planet=\' + vPlanet + \'&galaxy=\' + vGalaxy + \'&solar_system=\' + vSystem + \'\">Travel to \' + vGalaxy + \':\' + vSystem + \'<a\/href>\';\n\t\t\tvar url = \'\/galaxy\/show?current_planet=\' + vPlanet + \'&galaxy=\' + vGalaxy + \'&solar_system=\' + vSystem;\n\t\t\tvar f = document.createElement(\'form\'); f.style.display = \'none\'; document.body.appendChild(f); f.method = \'POST\'; f.action = url; f.submit();\n\t\t\tbreak;\n\t\tcase 39:\n\t\t\t\/\/right\n\t\t\tvSystem++;\n\t\t\tif (vSystem > 499) {\n\t\t\t\tvGalaxy++;\n\t\t\t\tif (vGalaxy > 20) vGalaxy = 1;\n\t\t\t\tvSystem = 1;\n\t\t\t}\n\t\t\tGetClassItem(document, \'div\', \'current_solar_system\').innerHTML = \'<a href=\"\' + \'\/galaxy\/show?current_planet=\' + vPlanet + \'&galaxy=\' + vGalaxy + \'&solar_system=\' + vSystem + \'\">Travel to \' + vGalaxy + \':\' + vSystem + \'<a\/href>\';\n\t\t\tvar url = \'\/galaxy\/show?current_planet=\' + vPlanet + \'&galaxy=\' + vGalaxy + \'&solar_system=\' + vSystem;\n\t\t\tvar f = document.createElement(\'form\'); f.style.display = \'none\'; document.body.appendChild(f); f.method = \'POST\'; f.action = url; f.submit();\n\t\t\tbreak; \n\n\t\tcase 13:\n\t\t\t\/\/enter\n\t\t\t\/\/put this line above \"break\" in each of the above cases if you don\'t want to have to press enter to navigate\n\t\t\tvar url = \'\/galaxy\/show?current_planet=\' + vPlanet + \'&galaxy=\' + vGalaxy + \'&solar_system=\' + vSystem;\n\t\t\tvar f = document.createElement(\'form\'); f.style.display = \'none\'; document.body.appendChild(f); f.method = \'POST\'; f.action = url; f.submit();\n\t}\n}\n\nfunction GetClassItem(vSource, vTagname, vClass) {\n\tvar vElements = vSource.getElementsByTagName(vTagname);\n\tvar vReturn = null;\n\tfor (cnt = 0; cnt < vElements.length; cnt++) {\n\t\tif (vElements[cnt].getAttribute(\'class\') == vClass) { vReturn = vElements[cnt]; }\n\t}\n\treturn vReturn;\n}\n\nfunction fixedEncodeURIComponent(str) {\n\treturn encodeURIComponent(str).replace(\/!\/g, \'%21\').replace(\/\'\/g, \'%27\').replace(\/\\(\/g, \'%28\').\n                        replace(\/\\)\/g, \'%29\').replace(\/\\*\/g, \'%2A\');\n}\nfunction trim(stringToTrim) {\n\treturn stringToTrim.replace(\/^\\s+|\\s+$\/g, \"\");\n}\n';

var myOptionOwnIndex = '\nvar textElm = document.getElementById(\'planet_order\');\n\nif (gup(\'rI\').length > 1) {\n\tnavalign1 = gup(\'rI\');\n} else {\n\tnavalign1 = localStorage.getItem(\"iown1\");\n}\n\n\/\/ nav align START\ninputI()\n\nfunction inputI() {\n\tvar radioInput = document.createElement(\"div\");\n\tradioInput.setAttribute(\"id\", \"iOwn\");\n\tradioInput.setAttribute(\"style\", \"text-align:left;\");\n\tradioInput.innerHTML += \"<h3>Index own systems ( BANG! Galaxy tool )<\/h3><p><form id= \'prefsave1\'><Input checked=checked type = radio id=\'No\' Name =rI Value = \'No\'>No <Input type = radio id=\'Yes\' Name = rI Value = \'Yes\' >Yes  <br \/><br \/><input type =\'submit\' onclick=\'savepref1()\' value=\'Save\'> \";\n\ttextElm.appendChild(radioInput);\n}\n\nfunction savepref1() {\n\tnavalign1 = gup(\'rI\');\n\tlocalStorage.setItem(\"iown1\", navalign1);\n}\n\nlocalStorage.setItem(\"iown1\", navalign1);\ndocument.getElementById(navalign1).checked = \"checked\";\n\nfunction gup(name) {\n\tname = name.replace(\/[\\[]\/, \"\\\\\\[\").replace(\/[\\]]\/, \"\\\\\\]\");\n\tvar regexS = \"[\\\\?&]\" + name + \"=([^&#]*)\";\n\tvar regex = new RegExp(regexS);\n\tvar results = regex.exec(window.location.href);\n\tif (results == null)\n\t\treturn \"\";\n\telse\n\t\treturn results[1];\n}';

var myOptionNavigation = '\nvar textElm = document.getElementById(\'planet_order\');\n\nif (gup(\'rA\').length > 1) {\n\tiArrow1 = gup(\'rA\');\n} else {\n\tiArrow1 = localStorage.getItem(\"iArrow1\");\n}\n\ninputArrows();\n\n\/\/ arrow keys active\nfunction inputArrows() {\n\tvar radioInput = document.createElement(\"div\");\n\tradioInput.setAttribute(\"id\", \"iArrow\");\n\tradioInput.setAttribute(\"style\", \"text-align:left;\");\n\tradioInput.innerHTML += \"<h3>Use arrow keys to navigate ( BANG! Galaxy tool )<\/h3><p><form id= \'prefsave2\'><Input checked=checked type = radio id=\'NoA\' Name =rA Value = \'No\'>No <Input type = radio id=\'YesA\' Name = rA Value = \'Yes\' >Yes  <br \/><br \/><input type =\'submit\' onclick=\'savepref2()\' value=\'Save\'> \";\n\ttextElm.appendChild(radioInput);\n}\n\nfunction savepref2() {\n\tiArrow1 = gup(\'rA\');\n\tlocalStorage.setItem(\"iArrow1\", iArrow1);\n}\n\nlocalStorage.setItem(\"iArrow1\", iArrow1);\ndocument.getElementById(iArrow1 + \'A\').checked = \"checked\";\n\nfunction gup(name) {\n\tname = name.replace(\/[\\[]\/, \"\\\\\\[\").replace(\/[\\]]\/, \"\\\\\\]\");\n\tvar regexS = \"[\\\\?&]\" + name + \"=([^&#]*)\";\n\tvar regex = new RegExp(regexS);\n\tvar results = regex.exec(window.location.href);\n\tif (results == null)\n\t\treturn \"\";\n\telse\n\t\treturn results[1];\n}\n';

var myInline = '\n\tvar playerNameAElemA, playerNameA\n\tvar planetA, planetNameElemA, planetNameA;\n\tvar coordsElemA, coordsA;\n\n\tvar urlSubmitA = \"\";\n\tvar urlSubmitB = \"\";\n\tvar svAddrA = \"file:///C|\Users\Glenn\Desktop\test1.txt";\n\n\tvar activate_pA = document.URL.match(\/activate_planet=([0-9]*)\/);\n\tvar current_pA = document.URL.match(\/current_planet=([0-9]*)\/);\n\n\tvar planet_idA = \"\";\n\tvar galaxyLinkA = \"\";\n\n\tvar thisSystemA = parseInt(document.getElementById(\'solar_system\').getAttribute(\'value\'))\n\tvar thisGalaxyA = parseInt(document.getElementById(\'galaxy\').getAttribute(\'value\'))\n\tvar planetIsHephA = false;\n\n\tcoordsElemA = document.getElementsByClassName(\'current_solar_system\');\n\tcoordsA = coordsElemA[0].textContent.match(\/\\d{1,2}:\\d{1,3}\/g);\n\n\tif (document.URL.indexOf(\"http:\/\/playstarfleet.com\") != -1) {\n\t\tactive = true;\n\t}\n\n\tif (activate_pA) {\n\t\tplanet_idA = activate_pA[1];\n\t}\n\telse if (current_pA) {\n\t\tplanet_idA = current_pA[1];\n\t}\n\turlSubmitA = svAddrA + \"listener.ashx?c=\" + coordsA + \"&showCols=true&planet_id=\" + planet_idA;\n\n\tvar hasIdent = false;\n\turlSubmitB = svAddrA + \"listenerESPY.ashx?showesp=true&g=\" + thisGalaxyA + \"&s=\" + thisSystemA;\n\tvar lStorage = localStorage.getItem(\"iGroup1\");\n\tif (lStorage != \'\') {\n\t\turlSubmitB += \"&ident=\" + lStorage;\n\t\thasIdent = true;\n\t}\n\n\tfor (var slotA = 1; slotA < 16; slotA++) {\n\t\tplanetA = document.getElementById(\'planet_\' + slotA);\n\n\t\tplayerNameAElemA = planetA.getElementsByClassName(\'player\');\n\t\tplayerNameA = playerNameAElemA[0].textContent.replace(\/\\([viInNd!s]*\\)\/g, \"\").replace(\/#[\\d,]*\/g, \"\").trim();\n\n\n\t\tif (playerNameA != \"\") {\n\n\t\t\tif (playerNameAElemA[0].getElementsByTagName(\'span\')[0] != null) {\n\t\t\t\tif (playerNameAElemA[0].getElementsByTagName(\'span\')[0].childNodes[0].textContent.trim() == \'\') {\n\t\t\t\t\tplayerNameA = playerNameAElemA[0].getElementsByTagName(\'span\')[0].childNodes[1].textContent.trim();\n\t\t\t\t} else {\n\t\t\t\t\tplayerNameA = playerNameAElemA[0].getElementsByTagName(\'span\')[0].childNodes[0].textContent.trim();\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tplanetIsHephA = false;\n\t\t\tif (playerNameAElemA[0].getElementsByTagName(\'img\')[0] != null) {\n\t\t\t\tplanetIsHephA = (playerNameAElemA[0].getElementsByTagName(\'img\')[0].getAttribute(\'title\') == \'Hephaestus Class Attack Platform\');\n\t\t\t}\n\n\t\t\turl1 = urlSubmitA + \"&p=\" + fixedEncodeURIComponent(playerNameA) + \"&heph=\" + planetIsHephA + \"&po=\" + slotA + \"&s=\" + thisSystemA + \"&g=\" + thisGalaxyA;\n\t\t\tif (hasIdent)\n\t\t\t\turl1 += \"&ident=\" + lStorage;\n\t\t\t\/\/alert(url1);\n\t\t\tplanetA.getElementsByClassName(\"actions\")[0].innerHTML = planetA.getElementsByClassName(\"actions\")[0].innerHTML + \"<a href=\'javascript:void(0);\' onclick=setPos(this);getColString(\'\" + url1 + \"\');> ? <\/a>\";\n\t\t}\n\t}\n\n\tv1 = 0;\n\tv2 = 0;\n\tvar view;\n\tfunction setPos(el) {\n\t\tvar v = findPos(el);\n\t\tv1 = v[0];\n\t\tv2 = v[1];\n\t}\n\n\tfunction findPos(obj) {\n\t\tvar curleft = curtop = 0;\n\t\tif (obj.offsetParent) {\n\t\t\tdo {\n\t\t\t\tcurleft += obj.offsetLeft;\n\t\t\t\tcurtop += obj.offsetTop;\n\t\t\t} while (obj = obj.offsetParent);\n\t\t}\n\t\treturn [curleft,curtop];\n\t}\n\n\tfunction removeResult(e) {\n\n\t\tvar targ;\n\t\tif (!e) var e = window.event;\n\t\tif (e.target) targ = e.target;\n\t\telse if (e.srcElement) targ = e.srcElement;\n\t\tif (targ.nodeType == 3) \/\/ defeat Safari bug\n\t\t\ttarg = targ.parentNode;\n\n\t\tif (targ.tagName == \"A\") \/\/ Moz\n\t\t\treturn;\n\n\t\tif (view != null) {\n\t\t\tdocument.body.removeEventListener(\'click\', removeResult, true);\n\t\t\tdocument.body.removeChild(view);\n\t\t\tview = null;\n\t\t}\n\t}\n\n\tfunction showResult(str) {\n\n\t\tif (view != null) {\n\t\t\tremoveResult();\n\t\t}\n\t\tview = document.createElement(\"div\");\n\t\tview.setAttribute(\"id\", \"iPop\");\n\t\tview.setAttribute(\"style\", \"padding:10px;color:black;font-size:90%;font-family:tahoma;position:absolute;left:\" + v1 + \"px;top:\" + v2 + \"px;background-color:#f2f2f2;border:1px solid #a5a5a5;\");\n\t\tview.innerHTML = str;\n\t\t\n\t\tdocument.body.appendChild(view);\n\t\tdocument.body.addEventListener(\'click\', removeResult, true);\n\n\t\t\/\/ move it to the left of the ?\n\t\tdocument.getElementById(\'iPop\').style.left = (v1 - document.getElementById(\'iPop\').offsetWidth) + \"px\";\n\t}\n\n\tfunction getColString(urlToSend) {\n\t\tvar req = false;\n\t\tif (window.XMLHttpRequest) {\n\t\t\ttry { req = new XMLHttpRequest(); } catch (e) { req = false; }\n\t\t} else {\n\t\t\talert(\'no window.xmlhttprequest\');\n\t\t}\n\t\tif (req) {\n\t\t\treq.open(\'GET\', urlToSend, false);\n\t\t\treq.setRequestHeader(\'User-Agent\', \'XMLHTTP\/1.0\');\n\t\t\treq.onload = function () {\n\n\t\t\t\tif (req.status == 200) {\n\t\t\t\t\tif (req.status == 200) {  showResult(req.responseText); }\n\t\t\t\t\telse { obj = false; }\n\t\t\t\t} else { obj = false; }\n\t\t\t}\n\t\t\treq.send();\n\t\t} else { obj = false; }\n\t}\n\n\n\tfunction fixedEncodeURIComponent(str) {\n\t\treturn encodeURIComponent(str).replace(\/!\/g, \'%21\').replace(\/\'\/g, \'%27\').replace(\/\\(\/g, \'%28\').\n                        replace(\/\\)\/g, \'%29\').replace(\/\\*\/g, \'%2A\');\n\t}\n\n\tfunction trim(stringToTrim) {\n\t\treturn stringToTrim.replace(\/^\\s+|\\s+$\/g, \"\");\n\t}\n\n';

var myLeaderBoardPlayerLink = '\nvar playerNameElem, playerName, planet_id;\nvar svAddr = \"http:\/\/sfo.lytjohan.net\/authredir.ashx?\";\n\nvar activate_p = document.URL.match(\/activate_planet=([0-9]*)\/);\nvar current_p = document.URL.match(\/current_planet=([0-9]*)\/);\n\nif (activate_p) {\n\tplanet_id = activate_p[1];\n}\nelse if (current_p) {\n\tplanet_id = current_p[1];\n}\n\naddLink();\nsetInterval(addLink, 1000);\n\nfunction addLink() {\n\n\t\/\/ If it\'s already parsed, die\n\tif (document.getElementById(\"addLinkMsg_sig\") != null) {\n\t\treturn;\n\t}\n\tvar area = document.getElementsByClassName(\"leaderboard_entities\")[0];\n\tvar entities = area.getElementsByClassName(\'name\');\n\n\tfor (var i = 0; i < entities.length; i++) {\n\t\tif (entities[i].tagName != \"TH\") {\n\t\t\tvar en = entities[i].innerHTML;\n\t\t\tentities[i].innerHTML = en + \"<a href=\'\" + svAddr + \"current_planet=\" + planet_id + \"&p=\" + entities[i].textContent.trim() + \"&exactSearch=true\'> B! <\/a>\";\n\t\t}\n\t}\n\n\t\/\/ Write signature - from espy ++ by darth brunus\n\tvar sign = document.createElement(\"div\");\n\tsign.setAttribute(\"id\", \"addLinkMsg_sig\");\n\tsign.setAttribute(\"style\", \"display: none\");\n\t\/\/document.getElementById(\"message_table\").appendChild(sign);\n\tdocument.getElementsByClassName(\"leaderboard_entities\")[0].appendChild(sign);\n}\n\nfunction trim(stringToTrim) {\n\treturn stringToTrim.replace(\/^\\s+|\\s+$\/g, \"\");\n}\n';

if (document.location.href.match(/http:\/\/playstarfleet\.com\/galaxy/i) != null) {
	injectscriptJsColony();
}

if (document.location.href.match(/http:\/\/playstarfleet\.com\/galaxy/i) != null) {
	injectJs();
}

if (document.location.href.match(/http:\/\/playstarfleet\.com\/options/i) != null) {
	optionsJsIndexOwn();
}

if (document.location.href.match(/http:\/\/playstarfleet\.com\/options/i) != null) {
	optionsJsIndexNav();
}

if (document.location.href.match(/http:\/\/playstarfleet\.com\/leaderboard/i) != null) {
	injectLeaderboardJs();
}


function injectscriptJsColony() {
	var d = document;
	var scr = d.createElement('script');
	scr.type = "text/javascript";
	scr.innerHTML = myInline;
	d.getElementsByTagName('head')[0].appendChild(scr);
}

function injectJs() {
	var d = document;
	var scr = d.createElement('script');
	scr.type = "text/javascript";
	scr.innerHTML = myParse;
	d.getElementsByTagName('head')[0].appendChild(scr);
}

function optionsJsIndexOwn() {
	var d = document;
	var scr = d.createElement('script');
	scr.type = "text/javascript";
	scr.innerHTML = myOptionOwnIndex;
	d.getElementsByTagName('head')[0].appendChild(scr);
}

function optionsJsIndexNav() {
	var d = document;
	var scr = d.createElement('script');
	scr.type = "text/javascript";
	scr.innerHTML = myOptionNavigation;
	d.getElementsByTagName('head')[0].appendChild(scr);
}

function injectLeaderboardJs() {
	var d = document;
	var scr = d.createElement('script');
	scr.type = "text/javascript";
	scr.innerHTML = myLeaderBoardPlayerLink;
	d.getElementsByTagName('head')[0].appendChild(scr);
}