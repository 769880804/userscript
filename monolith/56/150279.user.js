// ==UserScript==
// @name           Travian4 Res
// @namespace      not available.
// @version        1.0.
// @description    Travian4 Res
// @include        http://*.travian*.*/*
// @include        http://*.vfthis*net*/*
// ==/UserScript==


var RTL=document.defaultView.getComputedStyle(document.body,null).getPropertyValue("direction");var left=(RTL=="rtl"?42:149);if(document.location.href.match(/dorf1\.php/)){function accessRequest(){var res=[0,0,0,0];function XML_Request(n){var r=new Request.HTML({url:"build.php",evalScripts:false,filter:'table[class="troop_details inReturn"] .infos div.res',onSuccess:function(rT,rE){rE.each(function(p){p.getElements("span").each(function(el,i){res[i]+=parseInt(el.get("text"));var id="tg_res"+(i+1)+"";document.id(id).set("text",res[i])})})}}).post("gid=16&filter=1&tt=1&page="+(n+1)+"")}if(!document.getElementById("tg_table")){var html="<tfoot>";html+='<tr><td><img src="img/x.gif" class="r1" />:</td><td id="tg_res1">0</td><td><img src="img/x.gif" class="r2" />:</td><td id="tg_res2">0</td></tr>';html+='<tr><td><img src="img/x.gif" class="r3" />:</td><td id="tg_res3">0</td><td><img src="img/x.gif" class="r4" />:</td><td id="tg_res4">0</td></tr>';html+="</tfoot>";var table=new Element("table#tg_table",{cellspacing:"0"}).set("html",html);$("movements").getParent().grab(table)}var rq=new Request.HTML({url:"build.php",evalScripts:false,filter:'table[class="troop_details inReturn"] .infos div.res',onSuccess:function(rT,rE,rH){rE.each(function(p){p.getElements("span").each(function(el,i){res[i]+=parseInt(el.get("text"));var id="tg_res"+(i+1)+"";document.id(id).set("text",res[i])})});if(Elements.from(rH).getElement('.paginator a[href*="tt=1&page="]').get("html")){if(Elements.from(rH).getElement('.paginator a[href*="tt=1&page="][class="last"]').get("html")){pages=parseInt(Elements.from(rH).getElement('.paginator a[href*="tt=1&page="][class="last"]').get("href")[0].split("page=")[1]);for(page=1;page<pages;page++){XML_Request(page)}}}}}).post("gid=16&tt=1&filter=1")}function createNewIMG(){var div=new Element("div#tg_stat",{styles:{position:"absolute","background-color":"white","border-radius":"20px 20px 20px 20px",border:"1px solid green",padding:"4px",left:left+"px",top:"-16px","box-shadow":"0px 0px 4px 0px green inset"}});var img=new Element("img.r0",{src:"img/x.gif",styles:{cursor:"pointer",margin:"2px"},events:{click:function(){$("tg_stat").setStyle("display","none");accessRequest()}}});img.inject(div);div.inject($("movements"),"before")}createNewIMG()};