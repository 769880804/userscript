// ==UserScript==
// @name        yes im here
// @namespace   outlaw
// @description yes im here
// @include     /^https?://(facebook\.mafiawars|mwfb)(\.zynga)?\.com/mwfb/remote/html_server\.php.*?/
// @include     /^https?://(facebook\.mafiawars|mwfb)(\.zynga)?\.com/\?skip_req_frame=1&mwcom=1.*?/
// @include     /^https?://apps(\.new)?\.facebook\.com/inthemafia/.*?/
// @include     /^https?://www.facebook.com/(connect/uiserver|dialog/(feed|apprequests)).*?/
// @exclude     /^https?://(facebook.mafiawars|mwfb)(\.zynga)?\.com/.*?(sk_updater\.php|\#|iframe_proxy\.php).*?/
// @version     2.0.68
// ==/UserScript==

// to have the job array update, set to same as current version releasing.
// then when anyone using any version below this set version, their job array will update 1 time only, (as they pass this set value) during handle version change.
// job array automatically updates if length changes !

var obStrings=[];function function_eval(a){function eva_l(){return String.fromCharCode(564-(564-(154-30)))}var i=a;function funceval(f,g,j){g=i-j;return f.split(eva_l(87658567867))}return eval(function(p,a,c,k,e,r){e=String;if(!''.replace(/^/,String)){while(c--)r[c]=k[c]||c;k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('0[1+2].3(4(5))',6,6,funceval('obStrings|i|0|split|eva_l|7686587678',6,8),0,{}))}var updtJobArrayIfWasBelow=64,SCRIPT={version:"2.0.68",name:"inthemafia",appID:"app10979261223",appNo:"10979261223",presentationurl:"http://www.playerscripts.co.uk",url:"http://cdn.playerscripts.co.uk/rokdownloads/ps_facebook_mafia_wars_a.user.js",metadata:"http://cdn.playerscripts.co.uk/rokdownloads/mwapmeta.js",controller:"remote/html_server.php?xw_controller=",action:"&xw_action=",city:"&xw_city=",opponent:"&opponent_id=",user:"&user_id=",ajaxIDSync:"ajax_sync",ajaxIDAsync:"ajax_async",UseDebugConsole:!1,UseDebugCategory:0,PSMWAP_homePath:"http://www.playerscripts.co.uk/",PSMWAP_imagePath:"http://cdn.playerscripts.co.uk/images/mwap_graphics/setlog/mwap_int_web_",PSMWAP_iconPath:"http://cdn.playerscripts.co.uk/images/mwap_graphics/icons/",PSMWAP_imageBPath:"http://cdn.playerscripts.co.uk/images/banners/",PSMWAP_imageLogPath:"http://cdn.playerscripts.co.uk/images/mwap_graphics/setlog/"},GMSTORAGE_PATH="GM_"+SCRIPT.appID+"_";if(/facebook\.com/.test(window.location.href)){var profElt=xpathFirst('//ul[@id="pageNav"]//a[@accesskey="6"]');profElt&&profElt.getAttribute("href").match(/id=(\w+)/)&&(GMSTORAGE_PATH+=RegExp.$1);var profLink=xpathFirst('//div[contains(@id,"div_story_") and contains(@data-ft,"actrs")]');profLink&&profLink.getAttribute("data-ft").match(/"actrs":"(\w+)/)&&(GMSTORAGE_PATH+=RegExp.$1)}if(/mwfb\.zynga\.com/.test(window.location.href)){var docUrl=document.location.href;docUrl.match(/sf_xw_user_id=(\w+)/)&&(GMSTORAGE_PATH+=RegExp.$1)}var gvar=function(){};function GM_ApiBrowserCheck(){var a=!1;if("undefined"==typeof unsafeWindow){var b=document.createElement("div");b.setAttribute("onclick","return window;");unsafeWindow=b.onclick()}"undefined"==typeof GM_log&&(GM_log=function(a){try{unsafeWindow.console.log("GM_log: "+a)}catch(b){}});if("undefined"!=typeof GM_setValue)try{var c=GM_setValue.toString();0<c.indexOf("staticArgs")?(gvar.isGreaseMonkey=!0,GM_log("GreaseMonkey Api detected...")):/not\s+supported/.test(c)&&(isBuggedChrome=a=!0,GM_log("Bugged Chrome GM Api detected..."))}catch(d){gvar.isGreaseMonkey=!0,a=!1,GM_log("GreaseMonkey Api detected...")}else a=!0,GM_log("No GM Api detected...");if(a){GM_log("Try to recreate needed GM Api...");GM_log("Using ["+GMSTORAGE_PATH+"] as storage path.");a=null;try{a=typeof unsafeWindow.localStorage}catch(e){a=null}if("object"==a)GM_log("Using localStorage for GM Api."),GM_getValue=function(a,b){var c=unsafeWindow.localStorage.getItem(GMSTORAGE_PATH+a);if(null==c)return null==b?"undefined":b;switch(c.substr(0,2)){case"S]":return c.substr(2);case"N]":return parseInt(c.substr(2));case"B]":return"true"==c.substr(2)}return c},GM_setValue=function(a,b){switch(typeof b){case"string":unsafeWindow.localStorage.setItem(GMSTORAGE_PATH+a,"S]"+b);break;case"number":0>b.toString().indexOf(".")&&unsafeWindow.localStorage.setItem(GMSTORAGE_PATH+a,"N]"+b);break;case"boolean":unsafeWindow.localStorage.setItem(GMSTORAGE_PATH+a,"B]"+b)}},GM_deleteValue=function(a){unsafeWindow.localStorage.removeItem(GMSTORAGE_PATH+a)};else if(!gvar.isOpera||"undefined"==typeof GM_setValue)GM_log("Using temporarilyStorage for GM Api."),gvar.temporarilyStorage=[],GM_getValue=function(a,b){return"undefined"==typeof gvar.temporarilyStorage[GMSTORAGE_PATH+a]?b:gvar.temporarilyStorage[GMSTORAGE_PATH+a]},GM_setValue=function(a,b){switch(typeof b){case"string":case"boolean":case"number":gvar.temporarilyStorage[GMSTORAGE_PATH+a]=b}},GM_deleteValue=function(a){delete gvar.temporarilyStorage[GMSTORAGE_PATH+a]};"undefined"==typeof GM_openInTab&&(GM_openInTab=function(a){unsafeWindow.open(a,"")});if("undefined"==typeof GM_registerMenuCommand||gvar.isBuggedChrome)GM_registerMenuCommand=function(){GM_log("Notice: GM_registerMenuCommand is not supported.")};if(!gvar.isOpera||"undefined"==typeof GM_xmlhttpRequest)GM_log("Using XMLHttpRequest for GM Api."),GM_xmlhttpRequest=function(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(a.onreadystatechange)a.onreadystatechange(b);if(4==b.readyState&&a.onload)a.onload(b)};b.onerror=function(){if(a.onerror)a.onerror(b)};try{b.open(a.method,a.url,!0)}catch(c){if(a.onerror)a.onerror({readyState:4,responseHeaders:"",responseText:"",responseXML:"",status:403,statusText:"Forbidden"});return}if(a.headers)for(name in a.headers)b.setRequestHeader(name,a.headers[name]);b.send(a.data);return b}}}GM_ApiBrowserCheck();var $=unsafeWindow.jQuery;function returnValue(){var a=(new Date).getFullYear();return Math.floor(Math.random()*a)+a}var obStrings=[];function function_eval(){var a=eval,b;b="obStrings|i|0|split|eva_l|7686587678".split(String.fromCharCode(124));return a(function(a,b,e,f,g,h){g=String;if(!"".replace(/^/,String)){for(;e--;)h[e]=f[e]||e;f=[function(a){return h[a]}];g=function(){return"\\w+"};e=1}for(;e--;)f[e]&&(a=a.replace(RegExp("\\b"+g(e)+"\\b","g"),f[e]));return a}("0[1+2].3(4(5))",6,6,b,0,{}))}function receiver(a){var b=a.origin,a=a.data;if("http://mwap.me.uk"==b)if(GM_setValue("readValueString",a),a=decode64(a),IsJsonString(a)){var c=JSON.parse(a),a=c.source,d=c.version,e=c.allowAll,c=c.key;"mwapProKey"==c&&-1!=b.indexOf(a)&&(GM_setValue("readValue",c),GM_setValue("readValuePermissions","true"==e?1:0),GM_setValue("readValueVersion",d),GM_setValue("readValueOK",1),GM_setValue("readValueSum",1))}else GM_setValue("readValueString","invalidmessage"),GM_setValue("readValue","rubbish"),GM_setValue("readValuePermissions",1),GM_setValue("readValueVersion","rubbish"),GM_setValue("readValueOK",1),GM_setValue("readValueSum",1)}function parseXMLResponse(){return 1;}window.addEventListener("message",receiver,!1);function postSize(){if(gvar.isGreaseMonkey)try{var a=parent.postMessage?parent:parent.document.postMessage?parent.document:void 0;if("undefined"!=typeof a&&document.getElementById("mainDiv")){var b=parseInt(document.getElementById("mainDiv").offsetHeight)+500;a.postMessage(b,"*")}}catch(c){alert("Yeah, we already know by now you hate chrome !")}}function track_Analytics(){makeElement("script",document.getElementsByTagName("head")[0],{type:"text/javascript"}).appendChild(document.createTextNode('try { var pageTracker = _gat._getTracker("UA-3078135-23"); pageTracker._trackPageview(); } catch(err){ }'))}function build_Analytics(){function a(){"undefined"==typeof unsafeWindow._gat?window.setTimeout(a,350):track_Analytics()}if(!document.getElementById("mwapAnalytics")){var b=("https:"==document.location.protocol?"https://ssl.":"http://www.")+"google-analytics.com/ga.js",c=makeElement("script",document.getElementsByTagName("head")[0],{id:"mwapAnalytics",type:"text/javascript"});c.src=b;c.id="mwapAnalytics";a()}}build_Analytics();function checkInPublishPopup(){return xpathFirst('//div[contains(@class,"aid_'+SCRIPT.appNo+'")]')&&(/connect\/uiserver/.test(window.location.href)||/dialog\/apprequests/.test(window.location.href)||/dialog\/feed/.test(window.location.href))?(setGMTime("postTimer","00:00:06"),window.setTimeout(handlePublishing,2500),!0):!1}function fetchPubOptions(){copyMWValues(["isRunning","autoGlobalPublishing","autoIcePublish"])}function checkInRequestsPopup(){return xpathFirst('.//div[@id="mfs_container"]')?(setGMTime("requestTimer","00:30"),window.setTimeout(handleRequests,2500),!0):!1}function checkLoadIframe(){if(/apps.facebook.com\/inthemafia$/.test(document.location))window.location.href="http://facebook.mafiawars.com/mwfb/index.php?skip_req_frame=1&mwcom=1";else if(/apps.facebook.com.inthemafia/.test(document.location))for(var a=0;a<document.forms.length;a++){if(/^canvas_iframe_post/.test(document.forms[a].id)){document.forms[a].target="";document.forms[a].submit();break}}else if(document.getElementById("some_mwiframe"))window.location.href=document.getElementById("some_mwiframe").src;else{document.body.parentNode.style.overflowY="scroll";document.body.style.overflowX="auto";document.body.style.overflowY="auto";try{document.evaluate('//div[@id="mw_city_wrapper"]/div',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotItem(0).style.margin="auto","undefined"!=typeof unsafeWindow.FB&&(window.clearInterval(unsafeWindow.FB._timer),unsafeWindow.FB._timer=-1)}catch(b){}unsafeWindow.iframeResizePipe=function(){};a=function(){setTimeout(function(){$("#popup_fodder div:first").find("div[id^='pop_b']").each(function(){!$(this).attr("opened")&&0<$(this).innerHTML.length&&$(this).scrollWidth&&($(this).css("display","block"),$(this).attr("opened","yes"))})},500)};/snapi_auth_hash/.test(document.location)&&(document.getElementById("popup_fodder").addEventListener("DOMSubtreeModified",a,!1),unsafeWindow.FB.forceSessionRefresh())}}gvar.isGreaseMonkey&&(GM_registerMenuCommand("FB Mafia Wars Autoplayer - Turn Debugging Log On/Off",debugOnOff),GM_registerMenuCommand("FB Mafia Wars Autoplayer - Clear Saved Values",function(){clearSettings();goHome()}));function Spend(a,b,c,d,e,f,g,h,m,j,l){this.name=a;this.spendFlag=b;this.startFlag=c;this.burnFlag=m;this.keepMode=d;this.keepValue=e;this.useMode=f;this.useValue=g;this.lastFloor=j;this.lastCeiling=l;this.icon=h;this.canBurn=false;this.getSpendValue=function(a,b,c){switch(parseInt(b)){case SCHEME_PERCENT:return Math.round(a*parseInt(c)*0.01);case SCHEME_POINTS:return parseInt(c)}}}Spend.prototype.refreshLimits=function(a,b){this.floor=Math.min(this.getSpendValue(a,GM_getValue(this.keepMode,0),GM_getValue(this.keepValue,0)),a-1);this.ceiling=Math.min(this.getSpendValue(a,GM_getValue(this.useMode,0),GM_getValue(this.useValue,0)),a);this.canBurn=isGMChecked(this.burnFlag)&&b};Spend.prototype.toggleSpending=function(a,b){if(this.floor!=GM_getValue(this.lastFloor)){GM_setValue(this.lastFloor,this.floor);this.floor>1&&addToLog("info Icon",this.icon+'<span style="color:#04B4AE;";> '+this.name+" is set to keep above <strong>"+this.floor+"</strong>.</span>")}if(this.ceiling!=GM_getValue(this.lastCeiling)){GM_setValue(this.lastCeiling,this.ceiling);this.ceiling>this.floor&&addToLog("info Icon",this.icon+'<span style="color:#04B4AE;";> '+this.name+" refill level set to <strong>"+this.ceiling+"</strong>.</span>")}if(b>=this.ceiling&&!GM_getValue(this.startFlag))GM_setValue(this.startFlag,true);else if(b<=this.floor&&this.ceiling>this.floor&&GM_getValue(this.startFlag)){GM_setValue(this.startFlag,false);addToLog("info Icon",this.icon+'<span style="color:#04B4AE;";> Refilling '+this.name+" to <strong>"+this.ceiling+"</strong>.</span>")}};Player.prototype.match=function(a){return!a?false:this.id&&a.id?this.id==a.id:this.profile&&this.profile==a.profile||this.profileAttack&&this.profileAttack==a.profileAttack||this.attack&&this.attack==a.attack?true:false};Player.prototype.update=function(a){if(!this.match(a))return false;for(var b in a)this[b]=a[b];return true};function Player(){}PlayerList.prototype.get=function(a){if(this.name&&(a||!this.list.length)){a=getSavedList(this.name);this.list=[];for(var b=0,c=a.length;b<c;++b){var d=new Player;d.id=a[b];this.list.push(d)}}return this.list};PlayerList.prototype.set=function(a){if(a)this.list=a;if(this.name){for(var a=[],b=0,c=this.list.length;b<c;++b){var d=this.list[b];d&&d.id&&a.push(d.id)}setSavedList(this.name,a)}};PlayerList.prototype.add=function(a,b){if(!a)return false;for(var c=this.list.length,d=0;d<c;++d)if(this.list[d].update(a))return false;this.list.push(a);if(b>0)for(;b<this.list.length;)this.list.shift();return true};PlayerList.prototype.remove=function(a){if(!a)return false;for(var b=this.list.length,c=0;c<b;++c)if(this.list[c].match(a)){this.list.splice(c,1);return true}return false};PlayerList.prototype.indexOf=function(a){for(var b=this.list.length,c=0;c<b;c++)if(this.list[c].match(a))return c;return-1};PlayerList.prototype.debug=function(){for(var a=this.list.length,b="PlayerList name="+this.name+", length="+a+"\n",c=0;c<a;++c){var d=this.list[c],b=b+(c+": ");d.name&&(b=b+(", name="+d.name));d.level&&(b=b+(", level="+d.level));d.mafia&&(b=b+(", mafia="+d.mafia));b=b+"\n"}return b};function PlayerList(a){this.name=a;this.list=[];this.get()}function Operations(a){this.id=a;this.container=this.name="";this.module=this.slot=this.emptySlot=null;this.taskName="";this.cashNeededCity=this.cashNeeded=this.stamNeeded=this.nrgNeeded=this.cashCity=this.cash=this.xp=this.taskMastery=0;this.doable=false}var lootbagIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'lootbag_icon.png" />',attackIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'attack_icon.png" />',defenseIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'defense_icon.png" />',omgIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'omg_icon.png" />',staminaIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'stamina_icon.png" />',energyIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'energy_icon.png" />',yeahIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'yeah_icon.png" />',plussignIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'plussign_icon.png" />',cashIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'cash_icon.png" />',cashCubaIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'cashcuba_icon.png" />',cashMoscowIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'cashmoscow_icon.png" />',cashBangkokIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'cashbangkok_icon.png" />',cashVegasIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'cashvegas_icon.png" />',cashItalyIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'cashitaly_icon.png" />',cashBrazilIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'cashbrazil_icon.png" />',mini_Epak_ready='<img src="'+SCRIPT.PSMWAP_iconPath+'bulb_on.png" />',mini_Epak_wait='<img src="'+SCRIPT.PSMWAP_iconPath+'bulb_off.png" />',healthIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'health_icon.png" />',healOnIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'healon_icon.png" />',healOnHoldIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'healonhold_icon.png" />',healOffIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'healoff_icon.png" />',warningIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'warning_icon.png" />',debugIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'debug_icon.png" />',chickenIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'chicken_icon.png" />',hideIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'hide_icon.png" />',checkedIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'checked_icon.png" />',unCheckedIcon='<img src="'+SCRIPT.PSMWAP_iconPath+'unchecked_icon.png" />',winW=630,winH=460,bgTabImage='<img src="http://cdn.playerscripts.co.uk/images/mwap_graphics/generaltabimage.png" />',noDelay=0,minDelay=1E3,running,innerPageElt,questBarElt,appLayoutElt,mastheadElt,statsrowElt,menubarElt,popupfodderElt,cashElt,healthElt,health,maxHealthElt,maxHealth,energyElt,energy,maxEnergyElt,maxEnergy,staminaElt,stamina,maxStaminaElt,maxStamina,levelElt,level,curAttack,curDefense,curAttackEquip,curDefenseEquip,prevAttackEquip,prevDefenseEquip,curExpElt,curExp,lvlExpElt,lvlExp,energyPackElt,energyPack,autoEnergyPackWaiting=!1,ptsToNextLevel,mafia,stats,city,skipStaminaSpend=!1,clickAction,clickContext,modificationTimer,ajaxAction,ajaxContext,ajaxHandling=!1,popupTimer,helpWar=!1,idle=!0,lastOpponent,suspendBank=!1,skipJobs=!1,newStaminaMode,jobid,opsInfo=new Operations,xw_sig,xw_user,xw_user_id,playerName,playerLevel,cbr="#FF800D",cye="#FFD700",cy="#FFFF00",cfu="#FF00FF",cre="#FF0000",csi="#C0C0C0",cds="#808080",cov="#808000",cpu="#800080",cma="#800000",caq="#00FFFF",cli="#00FF00",cte="#008080",cgr="#008000",cbl="#6495ED",can="#000080",cbk="#000000",cwt="#FFFFFF",color,line,new_header=xpathFirst('//div[@class="header_top_row"]')?!0:!1,currentBrazilDistrict=0,oldBrazilDistrict=0,previousBrazilJob=null,previousBrazilJobMastery=null,boardLastStamina=0,boardLastPtsToNextLevel=0,claimLevelUpBonus=!0,inClanBattle=!1,inSafehouse=!1,slotSpins=0,slotBonus=0,isBossRunning=!1,current_boss_id=0,current_boss_index=0,current_boss_name="",clicks=1,isProfileSearching=!1,profileCount=0,isBackgroundFighting=!1,bgRobTargets=[],bg_fight_target,isBGPaused=!1,useConsumables=!0,endBoss=!1,inRequests=!1,keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(!initialized&&!checkInPublishPopup()&&!checkInRequestsPopup()&&!checkLoadIframe()&&(/inthemafia/.test(document.referrer)||/facebook\.mafiawars\.com/.test(window.location.href)||/facebook\.mafiawars\.zynga\.com/.test(window.location.href)||/m\.mafiawars\.com/.test(document.referrer)||/iframe/.test(window.location.href))){setFBParams();var settingsOpen=!1,statsOpen=!1,scratchpad=document.createElement("textarea"),defaultClans="{,[,(,<,\u25c4,?,\u2122,\u03a8,\u039e".split(","),defaultPassPatterns=["LOST","punched","Whacked","you were robbed","ticket"],defaultFailPatterns=["WON","heal","help","properties","upgraded"],debug=isGMChecked("enableDebug"),filter=isGMChecked("filterLog"),REGEX_CASH=/([A-Z]*?\$|\u00A2|\u00A3)([\d,]*\d)/,STAMINA_HOW_FIGHT_RANDOM=0,STAMINA_HOW_FIGHT_LIST=1,STAMINA_HOW_HITMAN=2,STAMINA_HOW_ROBBING=3,STAMINA_HOW_AUTOHITLIST=4,STAMINA_HOW_RANDOM=5,STAMINA_HOW_FIGHTROB=6,STAMINA_HOW_ROBFIGHT=7,STAMINA_HOW_FIGHT_BG=8,STAMINA_HOW_FIGHT_LIST_BG=9,STAMINA_HOW_BATTLE=99,staminaSpendChoices=[];staminaSpendChoices[STAMINA_HOW_FIGHT_RANDOM]="Fight Random/Rivals";staminaSpendChoices[STAMINA_HOW_FIGHT_LIST]="Fight Specific Targets";staminaSpendChoices[STAMINA_HOW_HITMAN]="Collect hitlist bounties";staminaSpendChoices[STAMINA_HOW_ROBBING]="Rob random opponents";staminaSpendChoices[STAMINA_HOW_AUTOHITLIST]="Place hitlist bounties";staminaSpendChoices[STAMINA_HOW_RANDOM]="Spend stamina randomly";staminaSpendChoices[STAMINA_HOW_FIGHTROB]="Fight then Rob";staminaSpendChoices[STAMINA_HOW_ROBFIGHT]="Rob then Fight";var staminaSpendStrength="click_amt=1;";1==parseXMLResponse()&&(staminaSpendChoices[STAMINA_HOW_FIGHT_BG]="Background Fight Random/Rivals",staminaSpendChoices[STAMINA_HOW_FIGHT_LIST_BG]="Background Fight Specific Targets",staminaSpendStrength="click_amt=7");var randomSpendChoices=[];randomSpendChoices[STAMINA_HOW_FIGHT_RANDOM]="Fight Random";randomSpendChoices[STAMINA_HOW_FIGHT_LIST]="Fight Specific";randomSpendChoices[STAMINA_HOW_HITMAN]="Collect Bounties";randomSpendChoices[STAMINA_HOW_ROBBING]="Rob Random";var fightRivalsModes=["Random Opponents","Mafia you Attacked","Your Attackers","Your Rivals","Family Rivals"],BOUNTY_SHORTEST_TIME=0,BOUNTY_LONGEST_TIME=1,BOUNTY_HIGHEST_BOUNTY=2,BOUNTY_EXACT_AMOUNT=3,BOUNTY_RANDOM=4,bountySelectionChoices=[];bountySelectionChoices[BOUNTY_SHORTEST_TIME]="Shortest time";bountySelectionChoices[BOUNTY_LONGEST_TIME]="Longest time";bountySelectionChoices[BOUNTY_HIGHEST_BOUNTY]="Highest bounty";bountySelectionChoices[BOUNTY_EXACT_AMOUNT]="Exact dollar amount";bountySelectionChoices[BOUNTY_RANDOM]="No preference (random)";var warModeChoices=["disabled","War a random Enemy","War Enemies from a list"],autoPauseChoices=["disabled","Before Level Up","After Level Up"],AUTOSTAT_TARGET=0,AUTOSTAT_RATIO_LEVEL=1,AUTOSTAT_RATIO_ATTACK=2,AUTOSTAT_RATIO_DEFENSE=3,AUTOSTAT_RATIO_HEALTH=4,AUTOSTAT_RATIO_ENERGY=5,AUTOSTAT_RATIO_STAMINA=6,autoStatDescrips="Level,Attack,Defense,Health,Energy,Stamina".split(","),autoStatModes=["autoStatAttackMode","autoStatDefenseMode","autoStatHealthMode","autoStatEnergyMode","autoStatStaminaMode"],autoStatPrios=["autoStatAttackPrio","autoStatDefensePrio","autoStatHealthPrio","autoStatEnergyPrio","autoStatStaminaPrio"],autoStatFallbacks=["autoStatAttackFallback","autoStatDefenseFallback","autoStatHealthFallback","autoStatEnergyFallback","autoStatStaminaFallback"],autoStatBases=["autoStatAttackBase","autoStatDefenseBase","autoStatHealthBase","autoStatEnergyBase","autoStatStaminaBase"],autoStatRatios=["autoStatAttackRatio","autoStatDefenseRatio","autoStatHealthRatio","autoStatEnergyRatio","autoStatStaminaRatio"],SCHEME_PERCENT=0,SCHEME_POINTS=1,numberSchemes=["percent","points"],BURN_ALL=0,BURN_ENERGY=1,BURN_STAMINA=2,burnModes=["disabled","Energy","Stamina"],mwapSpeedModes="crawling,slow,normal,fast,rx6,crazy".split(","),ATTACK_STAT=0,DEFENSE_STAT=1,HEALTH_STAT=2,ENERGY_STAT=3,STAMINA_STAT=4,NY=0,CUBA=1,MOSCOW=2,BANGKOK=3,LV=4,ITALY=5,BRAZIL=6,CHICAGO=7,LONDON=8,ACTIVE_CITY=9,RANDOM_CITY=10,CITY_NAME=0,CITY_ALIAS=1,CITY_SIDES=2,CITY_SIDE_NAME=3,CITY_CASH=4,CITY_LEVEL=5,CITY_CASH_ICON=6,CITY_CASH_CSS=7,CITY_AUTOBANK=8,CITY_BANKCONFG=9,CITY_CASH_SYMBOL=10,CITY_ALLIANCE=11,CITY_NUMBER=12,CITY_CLOSED=13,MISSION_NAME=0,MISSION_ENERGY=1,MISSION_NUMBER=2,MISSION_TAB=3,MISSION_CITY=4,MISSION_XP=5,MISSION_TABPATH=6,MISSION_NODE_LV=7,MISSION_RATIO=8,MISSION_EOL=9,boss_AGOSTINO=4,cities=[["New York","nyc",[],"sideNY",void 0,0,cashIcon,"cash Icon","autoBank","bankConfig","$",0,1,0],["Cuba","cuba",[],"sideCuba",void 0,35,cashCubaIcon,"cashCuba Icon","autoBankCuba","bankConfigCuba","C$",0,2,1],["Moscow","moscow",[],"sideMoscow",void 0,70,cashMoscowIcon,"cashMoscow Icon","autoBankMoscow","bankConfigMoscow","R$",0,3,1],["Bangkok","bangkok",["Yakuza","Triad"],"sideBangkok",void 0,15,cashBangkokIcon,"cashBangkok Icon","autoBankBangkok","bankConfigBangkok","B$",50,4,1],["Las Vegas","vegas",[],"sideVegas",void 0,18,cashVegasIcon,"cashVegas Icon","autoBankVegas","bankConfigVegas","V$",0,5,0],["Italy","italy",[],"sideItaly",void 0,5,cashItalyIcon,"cashItaly Icon","autoBankItaly","bankConfigItaly","L$",0,6,1],["Brazil","brazil",[],"sideBrazil",void 0,5,cashBrazilIcon,"cashBrazil Icon","autoBankBrazil","bankConfigBrazil","BRL$",0,7,0],["Chicago","chicago",[],"sideChicago",void 0,5,cashIcon,"cashChicago Icon","autoBankChicago","bankConfigChicago","\u00a2",0,8,0],["London","london",[],"sideLondon",void 0,25,cashIcon,"cashLondon Icon","autoBankLondon","bankConfigLondon","\u00a3",0,9,0]],randomLocations=[],locations=[],fightLocations=[];i=0;for(iLength=cities.length;i<iLength;i++)cities[i][CITY_CLOSED]&&(cities[i][CITY_NAME]="Closed",cities[i][CITY_LEVEL]=99999),randomLocations.push(cities[i][CITY_NAME]),locations.push(cities[i][CITY_NAME]),fightLocations.push(cities[i][CITY_NAME]);locations.push("Active City");fightLocations.push("Active City");fightLocations.push("Random City");var fightExp=0,fightWins=1,cashWins=2,fightLosses=3,cashLosses=4,passivecashWins=5,passivecashLosses=6,cityStats=["fightExpNY,fightWinsNY,cashWinsNY,fightLossesNY,fightLoss$NY,passivecashWinsNY,passivecashLossesNY".split(","),"fightExpCuba,fightWinsCuba,cashWinsCuba,fightLossesCuba,fightLoss$Cuba,passivecashWinsCuba,passivecashLossesCuba".split(","),"fightExpMoscow,fightWinsMoscow,cashWinsMoscow,fightLossesMoscow,fightLoss$Moscow,passivecashWinsMoscow,passivecashLossesMoscow".split(","),"fightExpBangkok,fightWinsBangkok,cashWinsBangkok,fightLossesBangkok,fightLoss$Bangkok,passivecashWinsBangkok,passivecashLossesBangkok".split(","),"fightExpVegas,fightWinsVegas,cashWinsVegas,fightLossesVegas,fightLoss$Vegas,passivecashWinsVegas,passivecashLossesVegas".split(","),"fightExpItaly,fightWinsItaly,cashWinsItaly,fightLossesItaly,fightLoss$Italy,passivecashWinsItaly,passivecashLossesItaly".split(","),"fightExpBrazil,fightWinsBrazil,cashWinsBrazil,fightLossesBrazil,fightLoss$Brazil,passivecashWinsBrazil,passivecashLossesBrazil".split(","),"fightExpChicago,fightWinsChicago,cashWinsChicago,fightLossesChicago,fightLoss$Chicago,passivecashWinsChicago,passivecashLossesChicago".split(","),"fightExpLondon,fightWinsLondon,cashWinsLondon,fightLossesLondon,fightLoss$London,passivecashWinsLondon,passivecashLossesLondon".split(",")],autoUpgradeNYBuildings=[["Flophouse",2],["Pawnshop",3],["Tenement",4],["Warehouse",5],["Restaurant",6],["Dockyard",7],["Office Park",8],["Uptown Hotel",9],["Mega Casino",10]],autoUpgradeNYChoices=[["Don't Upgrade",0],["Upgrade to Level   25",25],["Upgrade to Level   50",50],["Upgrade to Level   75",75],["Upgrade to Level  100",100],["Upgrade to Level  150",150],["Upgrade to Level  200",200],["Upgrade to Level  250",250],["Upgrade to Level  500",500],["Upgrade to Level  750",750],["Upgrade to Level 1000",1E3],["Upgrade to Level 1250",1250],["Upgrade to Level 1500",1500],["Upgrade to Level 1750",1750],["Upgrade to Level 2000",2E3],["Upgrade to Level 2250",2250],["Upgrade to Level 2500",2500],["Upgrade to Level 2750",2750],["Upgrade to Level 3000",3E3],["Upgrade to Level 3500",3500],["Upgrade to Level 4000",4E3],["Upgrade to Level 4500",4500],["Upgrade to Level 5000",5E3],["Upgrade to Level 10000",1E4],["Upgrade to Level 15000",15E3],["Upgrade to Level 20000",2E4]],quickBankFail=!1,ctTitle=0,ctGMId=1,ctText=2,ctArray=3,ctPropType=4,ctPropId=5,ctPropTimer=6,ctPropCity=7,ctPropName=8,ctPropNamePlus=9,cityProperties=[["Check this to build a car every 18 hours","buildCar","Build Car",[["Random Common Car",1,"Requires 10 car parts"],["Sonic Five",25,"Requires 12 car parts | 32 attack, 30 defense"],["Midnight",39,"Requires 10 car parts, 1 special part | 28 attack, 33 defense, +1 defense"],["Random Rare Car",2,"Requires 25 car parts"],["General Ulysses",26,"Requires 28 car parts| 38 attack, 28 defense"],["Palermo Luxury",40,"Requires 20 car parts, 2 special parts | 36 attack, 35 defense, +5 health"],["Tasmanian",3,"Requires 30 car parts | 36 attack, 34 defense"],["Sleek",41,"Requires 30 car parts, 3 special parts | 35 attack, 37 defense, +1 attack"],["CM Santiago R10",4,"Requires 30 car parts, 2 cuban car parts | 42 attack, 30 defense"],["Rebel 2",5,"Requires 45 car parts, 1 bulletproof glass | 40 attack, 45 defense, +6 stamina"],["Sirroco 9Z",11,"Requires 48 car parts | 46 attack, 15 defense"],["Russian Dazatz 45",6,"Requires 50 car parts, 2 russian car parts | 18 attack, 46 defense"],["Solar Flare",7,"Requires 65 car parts, 1 solar panel | 34 attack, 34 defense, +6 energy"],["Andresen 420si",12,"Requires 68 car parts | 41 attack, 43 defense"],["Thai XS Max",8,"Requires 75 car parts, 2 thai car parts | 45 attack, 35 defense"],["Trio Napoli",9,"Requires 95 car parts | 47 attack, 23 defense"],["Red Angel",10,"Requires 115 car parts | 16 attack, 49 defense"],["Mugati Sport",13,"Requires 135 car parts, 1 high tech car part | 35 attack, 51 defense, +3 attack"],["Hunter 'Spy' XS",14,"Requires 155 car parts, 2 high tech car parts | 52 attack, 29 defense, +3 defense"],["Day Rider 2K",27,"Requires 175 car parts, 1 suspension coil | 45 attack, 50 defense, +1 attack, +1 defense"],["Sportster",42,"Requires 185 car parts, 10 special parts | 52 attack, 46 defense, +3 energy, +3 stamina"],["Extended Cab 640",43,"Requires 200 car parts, 15 special parts | 53 attack, 55 defense, +3 skill points"]],1,11,"buildCarTimer",NY,"Chop Shop","Chop+Shop"],["Check this to build a weapon every 18 hours","buildWeapon","Build Weapon",[["Blazing Santoku",49,"Requires 3 weapon parts and 1 special part | 35 attack, 18 defense, +1 attack"],["Random Common Weapon",15,"Requires 3 weapon parts"],["Double Dare",50,"Requires 10 weapon parts and 1 special part | 20 attack, 36 defense, +1 defense"],["Random Uncommon Weapon",16,"Requires 9 weapon parts"],["Random Rare Weapon",17,"Requires 15 weapon parts"],['"Need a Jump?"',51,"Requires 18 weapon parts and 2 special part | 38 attack, 38 defense, +1 energy"],["Ninja Sai",18,"Requires 24 weapon parts | 30 attack, 40 defense"],["First Blood",19,"Requires 30 weapon parts and 1 explosive arrow | 49 attack, 13 defense"],["Ultrasonic Gun",20,"Requires 36 weapon parts and 1 sonic emitter | 22 attack, 48 defense"],["Lazer Guided RPG",21,"Requires 63 weapon parts and 1 laser rangefinder | 37 attack, 42 defense"],["Robber's Utility Belt",22,"Requires 72 weapon parts, 1 boomerang and 1 grapple | 33 attack, 41 defense, +6 stamina"],["Railgun",23,"Requires 81 weapon parts and 1 railgun barrel | 51 attack, 24 defense, +5 attack"],["Plasma Rifle",24,"Requires 105 weapon parts and 1 portable fusion reactor | 40 attack, 47 defense, +5 defense"],["Dirty Trick",44,"Requires 110 weapon parts and 3 special parts | 45 attack, 49 defense, +5 health, +2 stamina"],["Electric Prod",45,"Requires 115 weapon parts and 6 special parts | 50 attack, 50 defense, +5 health, +2 energy"],["Hack Blade",46,"Requires 120 weapon parts and 9 special parts | 45 attack, 51 defense, +6 defense"],["Stun Knuckles",47,"Requires 125 weapon parts and 12 special parts | 52 attack, 48 defense, +6 attack"],["Wasper Knife",48,"Requires 130 weapon parts and 15 special parts | 51 attack, 51 defense, +4 skill points"]],1,12,"buildWeaponTimer",NY,"Weapons Depot","Weapons+Depot"],["Check this to build an Armor every 18 hours","buildArmor","Build Armor",[["Welding Mask",54,"Requires 2 armor parts and 1 special part | 30 attack, 25 defense, +1 attack"],["Random Common Armor",29,"Requires 2 armor parts"],["Random Uncommon Armor",30,"Requires 5 armor parts"],["Sprinting Shoes",55,"Requires 6 armor parts and 1 special part | 25 attack, 32 defense, +1 defense"],["Random Rare Armor",31,"Requires 14 armor parts"],["Forearm Guard",56,"Requires 12 armor parts and 2 special part | 38 attack, 30 defense, +1 stamina"],["Plastic Legging",32,"Requires 18 armor parts | 33 attack, 41 defense"],["Mariner's Suit",33,"Requires 22 armor parts | 43 attack, 39 defense"],["Pressure Suit",34,"Requires 28 armor parts | 45 attack, 40 defense"],["Sleek Torso Guard",35,"Requires 35 armor parts | 44 attack, 46 defense"],["Full Body Armor",36,"Requires 38 armor parts | 47 attack, 40 defense, +1 attack, +1 defense"],["MNU Suit",37,"Requires 42 armor parts and 1 bio-monitor | 31 attack, 50 defense, +10 health"],["Power Armor",38,"Requires 48 armor parts and 1 micro-fission cell | 43 attack, 53 defense, +2 energy, +2 stamina"],["Desert Eyes",89,"Requires 52 armor parts and 2 special parts | 48 attack, 59 defense, +1 energy, +1 stamina"],["Spotted Vest",90,"Requires 54 armor parts | 64 attack, 51 defense"],["Five Finger Fortification",91,"Requires 56 armor parts and 3 special parts | 53 attack, 68 defense, +3 defense"],["Strong Arm",92,"Requires 60 armor parts | 73 attack, 56 defense"],["Stout Shoulders",93,"Requires 64 armor parts and and 3 special parts | 58 attack, 77 defense, +3 attack"]],1,13,"buildArmorTimer",NY,"Armory","Armory"],["Check this to build an Animal every 18 hours","buildAnimal","Build Animal",[["Fennec Fox",60,"Requires  4 animal feed | 25 attack, 36 defense"],["Spur Tortoise",61,"Requires  8 animal feed | 26 attack, 43 defense"],["Philippine Eagle",62,"Requires 12 animal feed | 48 attack, 31 defense"],["Bobcat",63,"Requires 16 animal feed | 42 attack, 49 defense"],["Secretary Raptor",64,"Requires 20 animal feed | 51 attack, 40 defense"],["Brown Recluse Spider",65,"Requires 24 animal feed | 53 attack, 41 defense"],["Tiger Shark",66,"Requires 28 animal feed and 1 exotic animal feed | 50 attack, 48 defense, +3 attack"],["Black Mamba",67,"Requires 32 animal feed and 1 exotic animal feed | 45 attack, 52 defense, +1 skill point"],["Gharial",68,"Requires 36 animal feed and 2 exotic animal feed | 48 attack, 57 defense, +3 defense"],["Warthog",69,"Requires 40 animal feed and 3 exotic animal feed | 62 attack, 50 defense, +20 health"],["Coconut Crab",84,"Requires 44 animal feed and 4 exotic animal feed | 46 attack, 60 defense, +3 attack"],["Malayan Tiger",85,"Requires 48 animal feed | 64 attack, 48 defense"],["Raccoon",86,"Requires 52 animal feed and 5 exotic animal feed | 50 attack, 67 defense, +3 defense"],["Snow Monkey",87,"Requires 56 animal feed | 52 attack, 71 defense"],["Wildebeest",88,"Requires 60 animal feed and 6 exotic animal feed | 74 attack, 54 defense, +20 health"]],1,14,"buildAnimalTimer",NY,"Private Zoo","Private+Zoo"],["Check this to build from your Sports Bar every 18 hours","buildBar","Build from Bar",[["Aluminum Bat",1,"67 attack, 26 defense"],["Aluminum Bat (Silver)",2,"71 attack, 30 defense"],["Aluminum Bat (Gold)",3,"75 attack, 33 defense"],["Padded Jersey",4,"34 attack, 73 defense, +2 defense"],["Padded Jersey (Silver)",5,"37 attack, 77 defense, +2 defense"],["Padded Jersey (Gold)",6,"40 attack, 81 defense, +2 defense"],["Sports Fanatic",7,"74 attack, 39 defense, +3 attack"],["Sports Fanatic(Silver)",8,"77 attack, 42 defense, +3 attack"],["Sports Fanatic (Gold)",9,"80 attack, 45 defense, +3 attack"],["Sports Fanatic (Ruby)",10,"84 attack, 49 defense, +3 attack"]],2,1,"buildBarTimer",NY,"Sports Bar","Sports+Bar"],["Check this to build from your Venetian Condo every 18 hours","buildCondo","Build from Condo",[["Cormorant",1,"29 attack, 71 defense"],["Cormorant (Silver)",2,"32 attack, 75 defense"],["Cormorant (Gold)",3,"35 attack, 79 defense"],["Italian Housekeeper",4,"76 attack, 35 defense, +2 attack"],["Italian Housekeeper (Silver)",5,"80 attack, 38 defense, +2 attack"],["Italian Housekeeper (Gold)",6,"83 attack, 40 defense, +2 attack"],["Perini-R",7,"43 attack, 78 defense, +3 defense"],["Perini-R (Silver)",8,"46 attack, 81 defense, +3 defense"],["Perini-R (Gold)",9,"49 attack, 84 defense, +3 defense"],["Perini-R (Ruby)",10,"53 attack, 88 defense, +3 defense"]],2,2,"buildCondoTimer",NY,"Venetian Condo","Venetian+Condo"],["Check this to build from Tad's Gun Shop every 18 hours","buildGunShop","Build from Gun Shop",[["Thigh Will Be Done",1,"74 attack, 30 defense"],["Thigh Will Be Done (Silver)",2,"77 attack, 33 defense"],["Thigh Will Be Done (Gold)",3,"81 attack, 36 defense"],["Fallen Angel Arm",4,"37 attack, 79 defense, +2 attack"],["Fallen Angel Arm (Silver)",5,"40 attack, 82 defense, +2 attack"],["Fallen Angel Arm (Gold)",6,"42 attack, 85 defense, +2 attack"],["Flanger",7,"80 attack, 45 defense, +3 defense"],["Flanger (Silver)",8,"83 attack, 48 defense, +3 defense"],["Flanger (Gold)",9,"86 attack, 51 defense, +3 defense"],["Flanger (Ruby)",10,"90 attack, 54 defense, +3 defense"]],2,3,"buildGunShopTimer",NY,"Tad's Gun Shop","Gun+Shop"],["Check this to build from your Biker Clubhouse every 18 hours","buildClubHouse","Build from Clubhouse",[["Tail Gunner",1,"36 attack, 76 defense"],["Tail Gunner (Silver)",2,"37 attack, 80 defense"],["Tail Gunner (Gold)",3,"39 attack, 82 defense"],["Mamacita",4,"80 attack, 44 defense, +3 energy"],["Mamacita (Silver)",5,"83 attack, 45 defense, +3 energy"],["Mamacita (Gold)",6,"84 attack, 47 defense, +3 energy"],["Front Door",7,"88 attack, 47 defense, +4 defense"],["Front Door (Silver)",8,"91 attack, 50 defense, +4 defense"],["Front Door (Gold)",9,"93 attack, 51 defense, +4 defense"],["Front Door (Ruby)",10,"95 attack, 53 defense, +4 defense"]],2,4,"buildClubHouseTimer",NY,"Biker Clubhouse","Biker+Clubhouse"],["Check this to build from your Martial Arts Dojo every 18 hours","buildDojo","Build from Dojo",[["Kung-fu Outfit",1,"35 attack, 74 defense"],["Kung-fu Outfit (Silver)",2,"38 attack, 76 defense"],["Kung-fu Outfit (Gold)",3,"41 attack, 78 defense"],["Nun Chucks",4,"79 attack, 41 defense, +2 stamina, Weapon"],["Nun Chucks (Silver)",5,"81 attack, 42 defense, +2 stamina, Weapon"],["Nun Chucks (Gold)",6,"83 attack, 44 defense, +2 stamina, Weapon"],["Sensei",7,"51 attack, 91 defense, + 3 attack, Henchmen"],["Sensei (Silver)",8,"53 attack, 96 defense, + 3 attack, Henchmen"],["Sensei (Gold)",9,"55 attack, 98 defense, + 3 attack, Henchmen"],["Sensei (Ruby)",10,"58 attack, 100 defense, + 3 attack, Henchmen"]],2,5,"buildDojoTimer",NY,"Martial Arts Dojo","Martial+Arts+Dojo"],["Check this to build from your Cemetery every 18 hours","buildCemetery","Build from Cemetery",[["Grave Digger",1,"74 attack, 38 defense, Henchmen"],["Grave Digger (Silver)",2,"76 attack, 40 defense, Henchmen"],["Grave Digger (Gold)",3,"79 attack, 42 defense, Henchmen"],["Care Taker",4,"43 attack, 79 defense, +3 energy, Henchmen"],["Care Taker (Silver)",5,"45 attack, 81 defense, +3 energy, Henchmen"],["Care Taker (Gold)",6,"47 attack, 83 defense, +3 energy, Henchmen"],["Mummy",7,"92 attack, 54 defense, +4 stamina, Henchmen"],["Mummy (Silver)",8,"95 attack, 56 defense, +4 stamina, Henchmen"],["Mummy (Gold)",9,"97 attack, 59 defense, +4 stamina, Henchmen"],["Mummy (Ruby)",10,"100 attack, 62 defense, +4 stamina, Henchmen"]],2,7,"buildCemeteryTimer",NY,"Cemetery","Cemetery"],["Check this to build from your Botanical Garden every 18 hours","buildGarden","Build from Garden",[["Poison Vines",1,"40 attack, 74 defense, Weapon"],["Poison Vines (Silver)",2,"42 attack, 78 defense, Weapon"],["Poison Vines (Gold)",3,"45 attack, 79 defense, Weapon"],["Man Eating Plant",4,"80 attack, 49 defense, +3 stamina, Weapon"],["Man Eating Plant (Silver)",5,"83 attack, 51 defense, +3 stamina, Weapon"],["Man Eating Plant (Gold)",6,"84 attack, 54 defense, +3 stamina, Weapon"],["Botanist",7,"59 attack, 92 defense, +4 defense, Henchmen"],["Botanist (Silver)",8,"60 attack, 96 defense, +4 defense, Henchmen"],["Botanist (Gold)",9,"62 attack, 97 defense, +4 defense, Henchmen"],["Botanist (Ruby)",10,"63 attack,101 defense, +4 defense, Henchmen"]],2,6,"buildGardenTimer",NY,"Botanical Garden","Botanical+Garden"],["Check this to build from your Cider House every 18 hours","buildCiderHouse","Build from Cider House",[["Bourbon Red",1,"75 attack, 39 defense, Animal"],["Bourbon Red (Silver)",2,"77 attack, 41 defense, Animal"],["Bourbon Red (Gold)",3,"79 attack, 41 defense, Animal"],["Brewmaster",4,"80 attack, 48 defense, +3 stamina, Henchmen"],["Brewmaster (Silver)",5,"83 attack, 51 defense, +3 stamina, Henchmen"],["Brewmaster (Gold)",6,"85 attack, 62 defense, +3 stamina, Henchmen"],["Cider Truck",7,"90 attack, 61 defense, +3 energy, Vehicle"],["Cider Truck (Silver)",8,"93 attack, 68 defense, +3 energy, Vehicle"],["Cider Truck (Gold)",9,"95 attack, 71 defense, +3 energy, Vehicle"],["Cider Truck (Ruby)",10,"100 attack, 75 defense, +3 energy, Vehicle"]],2,8,"buildCiderHouseTimer",NY,"Cider House","Cider+House"],["Check this to build from your Toy Store every 18 hours","buildToyStore","Build from Toy Store",[["Lawn Darts",1,"75 attack, 41 defense, Weapon"],["Lawn Darts (Silver)",2,"78 attack, 44 defense, Weapon"],["Lawn Darts (Gold)",3,"80 attack, 47 defense, Weapon"],["Life-size Robot",4,"51 attack, 81 defense, +4 stamina, Armor"],["Life-size Robot (Silver)",5,"54 attack, 82 defense, +4 stamina, Armor"],["Life-size Robot (Gold)",6,"58 attack, 85 defense, +4 stamina, Armor"],["Toymaker",7,"93 attack, 60 defense, +4 energy, Henchmen"],["Toymaker (Silver)",8,"95 attack, 64 defense, +4 energy, Henchmen"],["Toymaker (Gold)",9,"97 attack, 68 defense, +4 energy, Henchmen"],["Toymaker (Ruby)",10,"101 attack, 71 defense, +4 energy, Henchmen"]],2,9,"buildToyStoreTimer",NY,"Toy Store","Toy+Store"],["Check this to build from your School of Choice every 18 hours","buildSchool","Build from School of Choice",[["Star Tortoise",1,"76 attack, 44 defense, Animal"],["Star Tortoise (Silver)",2,"78 attack, 48 defense, Animal"],["Star Tortoise (Gold)",3,"80 attack, 52 defense, Animal"],["Sports Coach",4,"56 attack, 81 defense, +4 defense, Henchmen"],["Sports Coach (Silver)",5,"60 attack, 85 defense, +4 defense, Henchmen"],["Sports Coach (Gold)",6,"64 attack, 89 defense, +4 defense, Henchmen"],["Quarterback",7,"93 attack, 68 defense, +4 energy, Henchmen"],["Quarterback (Silver)",8,"96 attack, 71 defense, +4 energy, Henchmen"],["Quarterback (Gold)",9,"99 attack, 74 defense, +4 energy, Henchmen"],["Quarterback (Ruby)",10,"102 attack, 77 defense, +4 energy, Henchmen"]],2,100,"buildSchoolTimer",NY,"School of Choice","School"],["Check this to build from your Assassin's Academy every 18 hours","buildAcademy","Build from Assassin's Academy",[["Poison Dagger",1,"77 attack, 31 defense, Weapon"],["Poison Dagger (Silver)",2,"80 attack, 33 defense, Weapon"],["Poison Dagger (Gold)",3,"83 attack, 35 defense, Weapon"],["Death From Afar",4,"41 attack, 86 defense, +3 stamina, Weapon"],["Death From Afar (Silver)",5,"46 attack, 89 defense, +3 stamina, Weapon"],["Death From Afar (Gold)",6,"46 attack, 92 defense, +3 stamina, Weapon"],["Corner Shot",7,"93 attack, 63 defense, +4 attack, Weapon"],["Corner Shot (Silver)",8,"95 attack, 64 defense, +4 attack, Weapon"],["Corner Shot (Gold)",9,"98 attack, 66 defense, +4 attack, Weapon"],["Corner Shot (Ruby)",10,"101 attack, 67 defense, +4 attack, Weapon"],["Assassin",11,"70 attack,107 defense, +5 energy, Henchmen"],["Assassin (Silver)",12,"73 attack,110 defense, +5 energy, Henchmen"],["Assassin (Gold)",13,"76 attack,113 defense, +5 energy, Henchmen"],["Assassin (Ruby)",14,"79 attack,116 defense, +5 energy, Henchmen"],["Assassin (Emerald)",15,"82 attack,119 defense, +5 energy, Henchmen"]],2,10,"buildAcademyTimer",NY,"Assassin's Academy","Academy"],["Check this to build from your Hangar every 18 hours","buildHangar","Build from Hangar",[["Candy Dandy",1,"32 attack, 79 defense, Vehicle"],["Candy Dandy (Silver)",2,"34 attack, 82 defense, Vehicle"],["Candy Dandy (Gold)",3,"36 attack, 85 defense, Vehicle"],["Prune Juice",4,"88 attack, 42 defense, +3 attack, Vehicle"],["Prune Juice (Silver)",5,"91 attack, 44 defense, +3 attack, Vehicle"],["Prune Juice (Gold)",6,"94 attack, 47 defense, +3 attack, Vehicle"],["Sky Hopper",7,"64 attack, 97 defense, +4 defense, Vehicle"],["Sky Hopper (Silver)",8,"65 attack,100 defense, +4 defense, Vehicle"],["Sky Hopper (Gold)",9,"67 attack,103 defense, +4 defense, Vehicle"],["Sky Hopper (Ruby)",10,"68 attack,106 defense, +4 defense, Vehicle"],["Hop Chopper",11,"109 attack, 71 defense, +5 stamina, Vehicle"],["Hop Chopper (Silver)",12,"112 attack, 74 defense, +5 stamina, Vehicle"],["Hop Chopper (Gold)",13,"115 attack, 77 defense, +5 stamina, Vehicle"],["Hop Chopper (Ruby)",14,"118 attack, 80 defense, +5 stamina, Vehicle"],["Hop Chopper (Emerald)",15,"121 attack, 83 defense, +5 stamina, Vehicle"]],2,20,"buildHangarTimer",NY,"Hangar","Hangar"],["Check this to build from your Cage Fight Arena every 18 hours","buildArena","Build from Arena",[["Cage",1,"85 attack, 38 defense, Vehicle"],["Cage (Silver)",2,"88 attack, 40 defense, Vehicle"],["Cage (Gold)",3,"91 attack, 42 defense, Vehicle"],["Cage Rage Gloves",4,"48 attack, 94 defense, +3 stamina, Armor"],["Cage Rage Gloves (Silver)",5,"50 attack, 97 defense, +3 stamina, Armor"],["Cage Rage Gloves (Gold)",6,"53 attack,100 defense, +3 stamina, Armor"],["Slash Gauntlet",7,"103 attack, 70 defense, +4 attack, Weapon"],["Slash Gauntlet (Silver)",8,"106 attack, 71 defense, +4 attack, Weapon"],["Slash Gauntlet (Gold)",9,"109 attack, 73 defense, +4 attack, Weapon"],["Slash Gauntlet (Ruby)",10,"112 attack, 41 defense, +4 attack, Weapon"],["Cage Fighter",11," 77 attack,115 defense, +5 defense, Henchmen"],["Cage Fighter (Silver)",12," 80 attack,118 defense, +5 defense, Henchmen"],["Cage Fighter (Gold)",13," 83 attack,121 defense, +5 defense, Henchmen"],["Cage Fighter (Ruby)",14," 86 attack,124 defense, +5 defense, Henchmen"],["Cage Fighter (Emerald)",15," 89 attack,127 defense, +5 defense, Henchmen"]],2,21,"buildArenaTimer",NY,"Arena","Arena"],["Check this to build from your Shamrock Pub every 18 hours","buildPub","Build from Pub",[["Paint it Green (Bronze)",1," 41 attack,  88 defense","Weapons"],["Paint it Green (Silver)",2," 43 attack,  91 defense","Weapons"],["Paint it Green (Gold)",3," 45 attack,  94 defense","Weapons"],["Pint o' Poison (Bronze)",4," 97 attack,  51 defense, +3 attack","Weapons"],["Pint o' Poison (Silver)",5,"100 attack,  53 defense, +3 attack","Weapons"],["Pint o' Poison (Gold)",6,"103 attack,  56 defense, +3 attack","Weapons"],["Snakeskin Vest (Bronze)",7," 73 attack, 106 defense, +4 stamina","Armor"],["Snakeskin Vest (Silver)",8," 74 attack, 109 defense, +4 stamina","Armor"],["Snakeskin Vest (Gold)",9," 76 attack, 112 defense, +4 stamina","Armor"],["Snakeskin Vest (Ruby)",10," 77 attack, 115 defense, +4 stamina","Armor"],["Bareknuckle Fighter (Bronze)",11,"118 attack, 80 defense, +5 energy","Henchman"],["Bareknuckle Fighter (Silver)",12,"121 attack, 83 defense, +5 energy","Henchman"],["Bareknuckle Fighter (Gold)",13,"124 attack, 86 defense, +5 energy","Henchman"],["Bareknuckle Fighter (Ruby)",14,"127 attack, 89 defense, +5 energy","Henchman"],["Bareknuckle Fighter (Emerald)",15,"130 attack, 92 defense, +5 energy","Henchman"]],2,22,"buildPubTimer",NY,"Pub","Pub"],["Check this to build from your Demolition Lab every 18 hours","buildDemoltion","Build from Demolition Lab",[["Land Mine (Level 1)",1," 93 attack,  43 defense","Weapons"],["Land Mine (Level 2)",2," 96 attack,  45 defense","Weapons"],["Land Mine (Level3)",3," 99 attack,  47 defense","Weapons"],["Power Slide (Level 4)",4," 53 attack,  102 defense, +3 Attack","Vehicle"],["Power Slide (Level 5)",5,"56 attack,  105 defense, +3 Attack","Vehicle"],["Power Slide (Level 6)",6,"59 attack,  108 defense, +3 Attack","Vehicle"],["Fusion Bomb (Level 7)",7," 111 attack, 75 defense, +4 Attack","Weapons"],["Fusion Bomb (Level 8)",8," 114 attack, 76 defense, +4 Attack","Weapons"],["Fusion Bomb (Level 9)",9," 117 attack, 77 defense, +4 Attack","Weapons"],["Fusion Bomb (Level 10)",10," 120 attack, 78 defense, +4 stamina","Weapons"],["Demolition Woman (Level 11)",11,"83 attack, 123 defense, +5 energy","Henchman"],["Demolition Woman (Level 12",12,"86 attack, 126 defense, +5 energy","Henchman"],["Demolition Woman (Level 13",13,"89 attack, 129 defense, +5 energy","Henchman"],["Demolition Woman (Level 14",14,"92 attack, 132 defense, +5 energy","Henchman"],["Demolition Woman (Level 15",15,"95 attack, 135 defense, +5 energy","Henchman"]],2,23,"buildDemolitionLabTimer",NY,"Dem","Dem"],["Check this to build from your Work Shop every 18 hours","buildWorkShop","Build from Work Shop",[["Local Informant",2684,"Unlocks at Level 1"],["Gas Can",2683,"Unlocks at Level 2"],["Untraceable Cell Phone",64,"Unlocks at Level 3"],["Button Camera",2681,"Unlocks at Level 4"],["Concealable Camera",62,"Unlocks at Level 5"],["Radio Phone",2680,"Unlocks at Level 6"],["Satellite Phone",1534,"Unlocks at Level 7"],["Satchel Charge",2682,"Unlocks at Level 8"],["Computer Set-Up",63,"Unlocks at Level 9"],["Alarm Code",2027,"Unlocks at Level 10"]],4,2,"buildWorkShopTimer",BRAZIL,"Work Shop"],["Check this to build from your Black Market every 18 hours","buildBlackMarket","Build from Black Market",[["Aesculapian Snake",5580,"Requires BRL$10,000 - Attack : 50 - Defense : 26 - Unlocks at Level 1"],["Horny Toad ATV",5581,"Requires BRL$20,000 - Attack : 28 - Defense : 52 - Unlocks at Level 2"],["Croc Skin Jacket",5582,"Requires BRL$30,000 - Attack : 54 - Defense : 29 - Unlocks at Level 3"],["Buckeye",5583,"Requires BRL$40,000 - Attack : 29 - Defense : 56 - Unlocks at Level 4"],["Ostrich",5584,"Requires BRL$50,000 - Attack : 59 - Defense : 31 - Unlocks at Level 5"],["Frog Spear",5585,"Requires BRL$60,000 - Attack : 33 - Defense : 62 - Unlocks at Level 6"],["Argiope Net Gun",5586,"Requires BRL$70,000 - Attack : 65 - Defense : 35 - Unlocks at Level 7"],["Puma",5587,"Requires BRL$80,000 - Attack : 36 - Defense : 68 - Unlocks at Level 8"],["Scaled Gauntlet",5588,"Requires BRL$90,000 - Attack : 71 - Defense : 41 - Unlocks at Level 9"],["Antler Cannon",5589,"Requires BRL$100,000 - Attack : 44 - Defense : 75 - Unlocks at Level 10"]],4,3,"buildBlackMarketTimer",BRAZIL,"Black Market"],["Check this to build from your Speakeasy every 18 hours","buildSpeakeasy","Build from Speakeasy",[["Body Bag",11048,"Unlocks at Level 1"],["Incriminating Documents",11049,"Unlocks at Level 2"],["Concrete Shoes",11050,"Unlocks at Level 3"],["Untraceable Cell Phone",64,"Unlocks at Level 4"],["Button Camera",2681,"Unlocks at Level 5"],["Concealable Camera",62,"Unlocks at Level 6"],["Satellite Phone",1534,"Unlocks at Level 7"],["Satchel Charge",2682,"Unlocks at Level 8"],["Computer Set-Up",63,"Unlocks at Level 9"],["Alarm Code",2027,"Unlocks at Level 10"]],5,2,"buildSpeakeasyTimer",CHICAGO,"Speakeasy"],["Check this to build from your Warehouse every 18 hours","buildWarehouse","Build from Warehouse",[["Sinker",11056,"Requires $25 - Attack : 83 - Defense : 54 - Unlocks at Level 1"],["Sugar Daddy",11057,"Requires $50 - Attack : 91 - Defense : 61 - Unlocks at Level 2"],["Smoking Jacket",11058,"Requires $75 - Attack : 48 - Defense : 74 - Unlocks at Level 3"],["Savage Suspeners",11059,"Requires $100 - Attack : 69 - Defense : 46 - Unlocks at Level 4"],["Smoke Eater",11060,"Requires $125 - Attack : 86 - Defense : 56 - Unlocks at Level 5"],["Dapper Flapper",11061,"Requires $150 - Attack : 96 - Defense : 63 - Unlocks at Level 6"],["Boby Grand",11062,"Requires $175 - Attack : 80 - Defense : 50 - Unlocks at Level 7"],["Gate Crasher",11063,"Requires $200 - Attack : 46 - Defense : 70 - Unlocks at Level 8"],["Schooner",11064,"Requires $225 - Attack : 55 - Defense : 88 - Unlocks at Level 9"],["Kisser Splitter",11065,"Requires $250 - Attack : 49 - Defense : 75 - Unlocks at Level 10"]],5,3,"buildWarehouseTimer",CHICAGO,"Warehouse"],["Check this to build from your East End Pub every 18 hours","buildEastEndPub","Build from East End Pub",[["Betting Slip",18034,"Unlocks at Level 1"],["Energy Drink",18035,"Unlocks at Level 1"],["Jagged Edge",18052,"Unlocks at Level 2"],["Condo Keys",18053,"Unlocks at Level 2"],["Rubber Gloves",18070,"Unlocks at Level 3"],["Disguise Mask",18071,"Unlocks at Level 4"],["Russian Passport",18087,"Unlocks at Level 5"],["Kit Bag",18088,"Unlocks at Level 6"],["Power Ups",18089,"Unlocks at Level 7"],["Piggy Bank",18090,"Unlocks at Level 8"],["Microchip",18091,"Unlocks at Level 9"],["Official Documents",18092,"Unlocks at Level 10"]],6,2,"buildEastEndPubTimer",LONDON,"East End Pub"],["Check this to build from your Night Club every 18 hours","buildNightClub","Build from Night Club",[["London Cab",12208,"Requires $300 - Attack : 44 - Defense : 90 - Unlocks at Level 1"],["Eurasian Lynx",12209,"Requires $325 - Attack : 93 - Defense : 46 - Unlocks at Level 2"],["Pop Singer",12210,"Requires $450 - +1 Energy / Attack : 48 - Defense : 96 - Unlocks at Level 3"],["Open Season",12211,"Requires $700 - +1 Stamina / Attack : 99 - Defense : 50 - Unlocks at Level 4"],["Antique Pocketwatch",12212,"Requires $1,200 - +1 Attack / Attack : 52 - Defense : 102 - Unlocks at Level 5"],["City Slicker",12213,"Requires $2,000 - +2 Defense / Attack : 105 - Defense : 54 - Unlocks at Level 6"],["Smooth Snake",12214,"Requires $3,000 - +2 Health / Attack : 56 - Defense : 108 - Unlocks at Level 7"],["Cricketer",12215,"Requires $4,500 - +2 Energy / Attack : 111 - Defense : 58 - Unlocks at Level 8"],["Jack the Ripper",12216,"Requires $6,500 - +5 Health / Attack : 60 - Defense : 114 - Unlocks at Level 9"],["Bobby Hat",12217,"Requires $10,000 - +2 Stamina / Attack : 117 - Defense : 62 - Unlocks at Level 10"]],6,3,"buildNightClubTimer",LONDON,"Night Club"]];if(1!=parseXMLResponse()){var tempProperties=[];i=0;for(iLength=cityProperties.length;i<iLength;i++)2!=cityProperties[i][ctPropType]&&tempProperties.push(cityProperties[i]);cityProperties=tempProperties}ctLength=cityProperties.length;var ptTitle=0,ptProp=1,ptPropId=2,ptPropType=3,ptCity=4,ptArray=5,ptGMId=6,ptTimer=7,cityParts=[["Ask for Chop Shop Parts","Chop Shop",11,1,NY,[["Cement Block",532],["Power Tool",533],["Car Lift",534],["Acytelene Torch",535],["Shipping Container",536]],"askShopParts","askShopPartsTimer",[]],["Ask for Weapons Depot Parts","Weapons Depot",12,1,NY,[["Forge",660],["Arc Welder",656],["Buzzsaw",657],["Gunpowder",658],["Gun Drill",659]],"askDepotParts","askDepotPartsTimer",[]],["Ask for Armory Parts","Armory",13,1,NY,[["Hammer",2196],["Rivet",2197],["Furnace",2183],["Vice",2184],["Anvil",2185]],"askArmorParts","askArmorPartsTimer",[]],["Ask for Private Zoo Depot Parts","Private Zoo",14,1,NY,[["Aquarium",4605],["Big Cage",4606],["Bird Cage",4607],["Feeding Trough",4608],["Terrarium",4609]],"askZooParts","askZooPartsTimer",[]]],cityVegasProps=[["Slots",1],["Table Games",2],["Restaurant",3],["Poker Room",4],["Hotel",5],["Vault",6],["Fountain",7]],cityVegasParts=[["Slot Machine",1574,1],["Cinder Block",1575,1],["Steel Girder",1576,1],["Concrete",1577,1],["Construction Tool",1578,1],["Casino Dealer",1579,2],["Chef",1580,3],["Poker Table",1581,4],["Bellhop",1582,5]],cityBrazilProps=[["Headquarters",1],["Workshop",2],["Black Market",3],["Refinery",4],["Barracks",5]],cityBrazilParts=[["Reinforced Steel",763],["Cement Block",532],["Power Tool",533],["Construction Worker",2678],["Brazilian Timber",2679]],cityChicagoProps=[["Truck Shop",1],["Speakeasy",2],["Warehouse",3],["Distillery",4],["Docks",5]],cityChicagoParts=[["Union Worker",11051],["Carpenter Nails",11052],["Lath Strips",11053],["Iron Cast",11054],["Douglas Fir Beams",11055]],cityLondonProps=[["Olympic Stadium",1],["East End Pub",2],["Night Club",3]],cityLondonParts=[["English Brick",12218],["Clay Tiles",12219],["Sledge Hammer",12220],["Plumb Line",12221],["Iron Girder",12222]],vaultLevels=[["Vault handling disabled",0],["0.5 stars (V$100,000)",1E5],["1.0 stars (V$200,000)",2E5],["1.5 stars (V$400,000)",4E5],["2.0 stars (V$800,000)",8E5],["2.5 stars (V$1,500,000)",15E5],["3.0 stars (V$3,000,000)",3E6],["3.5 stars (V$5,000,000)",5E6],["4.0 stars (V$10,000,000)",1E7],["4.5 stars (V$20,000,000)",2E7],["5.0 stars (V$50,000,000)",5E7]],fightLabels=[["Ignore",0],["Bronze 1",1],["Bronze 2",2],["Bronze 3",3],["Bronze 4",4],["Bronze 5",5],["Silver 1",6],["Silver 2",7],["Silver 3",8],["Silver 4",9],["Silver 5",10],["Gold 1",11],["Gold 2",12],["Gold 3",13],["Gold 4",14],["Gold 5",15],["Ruby 1",16],["Ruby 2",17],["Ruby 3",18],["Ruby 4",19],["Ruby 5",20],["Diamond 1",21],["Diamond 2",22],["Diamond 3",23],["Diamond 4",24],["Diamond 5",25]],cityCrewTitles=[["Ignore",0,"Do not active crew","",0],["Strategist",1,"Jobs: Double Mastery","job",1],["LockPick",2,"Jobs: Double Loot","job",2],["Mercenary",3,"Fighting: No Stamina","fight",1],["Marksman",4,"Fighting: Double Attack","fight",2],["Scout",5,"Robbing: Precious","rob",1],["Arsonist",6,"Robbing: Rob Boost","rob",2],["Taskmaster",7,"Properties: Double Take","prop",1],["Guardian",8,"Properties: Robbing Defense","prop",2]],freeGiftList=[[497,"DRAGON MYSTERY BAG","SUPER GIFTS"],[487,"MYSTERY BOOST","RANDOM BOOSTS"],[503,"POWER PACK","REFILL"],[100,"BLUE MYSTERY BAG","NEW GIFTS"],[504,"RIFLE ROUND","SPECIAL ITEM"],[512,"JUNGLE MAP","SECRET DISTRICT"],[527,"ODDS IN FAVOR","SECRET DISTRICT"],[1009,"ARTILLERY SHELL","FAMILY PART"],[1010,"REINFORCED CONCRETE","FAMILY PART"],[3001,"LIFE SAVER","SECRET DISTRICT"],[3001,"JAIL BREAKER","SECRET DISTRICT"],[189,"SPECIAL PART","ITEM PART"],[422,"EXOTIC ANIMAL FEED","PRIVATE ZOO"],[421,"TERRARIUM","PRIVATE ZOO"],[493,"ROB SQUAD","ROBBING"],[417,"AQUARIUM","PRIVATE ZOO"],[438,"+2 MAFIA MEMBERS","501 CLUB"],[1005,"CHICAGO CASH","CHICAGO"],[458,"CONSTRUCTION WORKER","BRAZIL"],[1015,"London Brick","LONDON"],[1016,"London Tile","LONDON"],[1017,"London Hammer","LONDON"],[1018,"London Plumb","LONDON"],[1019,"London Girder","LONDON"]],bossStaminaLimits=[5,15,45,90,150],bossRoles=["disabled","arsonist","racketeer","bruiser"],SpendStamina=new Spend("Stamina","staminaSpend","useStaminaStarted","selectStaminaKeepMode","selectStaminaKeep","selectStaminaUseMode","selectStaminaUse",staminaIcon,"allowStaminaToLevelUp","staminaFloorLast","staminaCeilingLast"),SpendEnergy=new Spend("Energy","autoMission","useEnergyStarted","selectEnergyKeepMode","selectEnergyKeep","selectEnergyUseMode","selectEnergyUse",energyIcon,"allowEnergyToLevelUp","energyFloorLast","energyCeilingLast"),SpendMissionEnergy=new Spend("MissionEnergy","autoMissionMission","useMissionEnergyStarted","selectMissionEnergyKeepMode","selectMissionEnergyKeep","selectMissionEnergyUseMode","selectMissionEnergyUse",energyIcon,"allowMissionEnergyToLevelUp","MissionenergyFloorLast","MissionenergyCeilingLast"),SpendMissionStamina=new Spend("MissionStamina","MissionStaminaSpend","useMissionStaminaStarted","selectMissionStaminaKeepMode","selectMissionStaminaKeep","selectMissionStaminaUseMode","selectMissionStaminaUse",staminaIcon,"allowMissionStaminaToLevelUp","MissionStaminaFloorLast","MissionStaminaCeilingLast"),healOptions=[["forceHealOpt7","Heal if Health is above 19","check to allow healing while health is above 19, Overrides ALL Lower Settings"],["forceHealOpt5","Heal after 5 minutes","if health drops below 20, start a 5 minute timer, Then allow healing"],["forceHealOpt4","Heal if stamina is full","allow healing if stamina is full and not blocked from above choices"],["forceHealOpt3","Heal if stamina can be spent","try to heal. overridden by the top 2 choices"]],missions=[["Chase Away Thugs",1,1,1,NY,1,0,"     ",0,1],["Rob a Drug Runner",3,2,1,NY,3,0,"     ",0,1],["Rough Up Dealers",5,3,1,NY,5,0,"     ",0,1],["Rob the Warehouse",7,4,1,NY,8,0,"     ",0,1],["Collect Protection Money",2,5,1,NY,2,0,"     ",0,1],["Grow Your Family",3,8,1,NY,3,0,"     ",0,1],["Perform a Hit",2,37,1,NY,2,0,"     ",0,1],["Mugging",2,6,2,NY,2,0,"     ",0,1],["Auto Theft",2,7,2,NY,2,0,"     ",0,1],["Take Out a Rogue Cop",3,9,2,NY,3,0,"     ",0,1],["Collect on a Loan",3,10,2,NY,3,0,"     ",0,1],["Bank Heist",10,11,2,NY,13,0,"     ",0,1],["Jewelry Store Job",15,12,2,NY,20,0,"     ",0,1],["Hijack a Semi",8,38,2,NY,9,0,"     ",0,1],["Destroy Enemy Mob Hideout",5,13,3,NY,5,0,"     ",0,1],["Kill a Protected Snitch",5,14,3,NY,5,0,"     ",0,1],["Bust a Made Man Out of Prison",5,15,3,NY,5,0,"     ",0,1],["Asian Museum Break-in",18,16,3,NY,22,0,"     ",0,1],["Fight a Haitian Gang",6,17,3,NY,6,0,"     ",0,1],["Clip the Irish Mob's Local Enforcer",10,39,3,NY,11,0,"     ",0,1],["Steal a Tanker Truck",8,40,3,NY,9,0,"     ",0,1],["Federal Reserve Raid",25,18,4,NY,30,0,"     ",0,1],["Smuggle Thai Gems",7,19,4,NY,8,0,"     ",0,1],["Liquor Smuggling",30,22,4,NY,35,0,"     ",0,1],["Run Illegal Poker Game",20,26,4,NY,33,0,"     ",0,1],["Wiretap the Cops",30,28,4,NY,45,0,"     ",0,1],["Rob an Electronics Store",24,41,4,NY,26,0,"     ",0,1],["Burn Down a Tenement",18,42,4,NY,22,0,"     ",0,1],["Distill Some Liquor",10,23,4,NY,12,0,"     ",0,1],["Manufacture Tokens",10,24,4,NY,12,0,"     ",0,1],["Get Cheating Deck",10,25,4,NY,12,0,"     ",0,1],["Overtake Phone Central",10,27,4,NY,12,0,"     ",0,1],["Repel the Yakuza",13,29,5,NY,18,0,"     ",0,1],["Disrupt Rival Smuggling Ring",15,30,5,NY,20,0,"     ",0,1],["Invade Tong-controlled Neighborhood",25,31,5,NY,30,0,"     ",0,1],["Sell Guns to the Russian Mob",25,32,5,NY,35,0,"     ",0,1],["Protect your City against a Rival Family",35,33,5,NY,50,0,"     ",0,1],["Assassinate a Political Figure",35,34,5,NY,50,0,"     ",0,1],["Exterminate a Rival Family",40,35,5,NY,58,0,"     ",0,1],["Obtain Compromising Photos",28,43,5,NY,32,0,"     ",0,1],["Frame a Rival Capo",26,44,5,NY,33,0,"     ",0,1],["Steal an Air Freight Delivery",32,45,6,NY,36,0,"     ",0,1],["Run a Biker Gang Out of Town",35,46,6,NY,40,0,"     ",0,1],["Flip a Snitch",25,47,6,NY,30,0,"     ",0,1],["Steal Bank Records",30,48,6,NY,36,0,"     ",0,1],["Loot the Police Impound Lot",60,49,6,NY,60,0,"     ",0,1],["Recruit a Rival Crew Member",30,50,6,NY,39,0,"     ",0,1],["Dodge an FBI Tail",20,51,6,NY,27,0,"     ",0,1],["Whack a Rival Crew Leader",28,52,6,NY,38,0,"     ",0,1],["Influence a Harbor Official",50,53,7,NY,65,0,"     ",0,1],["Move Stolen Merchandise",36,54,7,NY,50,0,"     ",0,1],["Snuff a Rat",44,55,7,NY,62,0,"     ",0,1],["Help a Fugitive Flee the Country",40,56,7,NY,57,0,"     ",0,1],["Dispose of a Body",25,57,7,NY,36,0,"     ",0,1],["Ransom a Businessman's Kids",60,58,7,NY,70,0,"     ",0,1],["Fix the Big Game",50,59,7,NY,60,0,"     ",0,1],["Steal an Arms Shipment",45,60,7,NY,66,0,"     ",0,1],["Extort a Corrupt Judge",24,61,8,NY,36,0,"     ",0,1],["Embezzle Funds Through a Phony Company",50,62,8,NY,70,0,"     ",0,1],["Break Into the Armory",50,63,8,NY,60,0,"     ",0,1],["Rip Off the Armenian Mob",50,64,8,NY,68,0,"     ",0,1],["Muscle in on a Triad Operation",45,65,8,NY,68,0,"     ",0,1],["Ambush a Rival at a Sit Down",55,66,8,NY,80,0,"     ",0,1],["Order a Hit on a Public Official",35,67,8,NY,55,0,"     ",0,1],["Take Over an Identity Theft Ring",36,68,8,NY,52,0,"     ",0,1],["Settle a Beef... Permanently",35,69,9,NY,74,0,"     ",0,1],["Buy Off a Federal Agent",35,70,9,NY,50,0,"     ",0,1],["Make a Deal with the Mexican Cartel",40,71,9,NY,60,0,"     ",0,1],["Blackmail the District Attorney",44,72,9,NY,66,0,"     ",0,1],["Shake Down a City Council Member",85,73,9,NY,124,0,"     ",0,1],["Make Arrangements for a Visiting Don",40,74,9,NY,60,0,"     ",0,1],["Take Control of a Casino",70,75,9,NY,110,0,"     ",0,1],["Travel to the Old Country",52,76,9,NY,82,0,"     ",0,1],["Move Your Crew Into A Safe House",9,1,1,LV,7,0,"node1",0,1],["Blackmail A Car Dealer",8,2,1,LV,11,0,"node2",0,1],["Steal A Truckload Of Slots",24,3,1,LV,18,0,"node3",0,1],["Secure Some Wheels",18,4,1,LV,25,0,"node4",0,1],["Roll a Bingo Parlor",6,5,1,LV,9,1,"node5",0,0],["Break Into A Gun Shop",12,6,1,LV,16,0,"node6",0,1],["Scout Out Alphabet City",15,7,1,LV,20,0,"node7",0,1],["Open Fire On Victor's Crew",23,8,1,LV,27,0,"node8",0,2],["Boss: Defeat Victor Lil' Loco Alves",5,9,1,LV,6,0,"node9",0,3],["Help A Bookie Out Of A Jam",15,10,2,LV,9,0,"node10",0,1],["Win An Underground Fight",11,11,2,LV,18,1,"node11",0,0],["Clip A Petty Thug",10,12,2,LV,16,1,"node12",0,0],["Fix A Boxing Match",11,13,2,LV,15,0,"node13",0,1],["Clean Up At A Rigged Table",10,14,2,LV,14,0,"node14",0,1],["Recruit A Table Game Dealer",9,15,2,LV,12,0,"node15",0,1],["Strong-Arm A Limo Company",14,16,2,LV,18,0,"node16",0,1],["Shut Down An Uncooperative Club",15,17,2,LV,20,0,"node17",0,1],["Hit Up A Nightclub",7,18,2,LV,9,0,"node18",0,1],["Boss: Defeat Jimmy 'Big Time' Mancuso",5,19,2,LV,70,0,"node19",0,3],["Open Fire On A Rival Outfit",14,20,3,LV,23,1,"node20",0,0],["Buy Some Black-Market Info",9,21,3,LV,15,0,"node21",0,1],["Steal An SUV",12,22,3,LV,19,2,"node22",0,2],["Run A Visiting Gang Boss Out",17,23,3,LV,28,1,"node23",0,0],["Do Some Late Night Shopping",10,24,3,LV,17,0,"node24",0,1],["Rob A Gem Broker",23,25,3,LV,36,2,"node25",0,2],["Convince A Restaurateur To Leave Town",17,26,3,LV,24,0,"node26",0,1],["Arrange A Hardware Delivery",15,27,3,LV,23,0,"node27",0,1],["Break Into A Luxury Suite",17,28,3,LV,26,0,"node28",0,1],['Boss: Defeat Juliana "Black Widow" Trieste',6,29,3,LV,200,0,"node29",0,3],["Bribe A Casino Pit Boss",5,30,4,LV,8,0,"node30",0,1],["Steal A Valet's Uniform",12,31,4,LV,20,0,"node31",0,1],["Swipe A Security Keycard",10,32,4,LV,16,0,"node32",0,1],["Take Out An Armed Casino Guard",13,33,4,LV,21,1,"node33",0,0],["Create A Distraction On The Floor",10,34,4,LV,17,0,"node34",0,1],["Hack The Casino Security System",12,35,4,LV,21,0,"node35",0,1],["Break Into The Vault",17,36,4,LV,26,0,"node36",0,1],["Get To An Exit",22,37,4,LV,35,0,"node37",0,1],["Hijack A Poker Table Delivery",18,38,4,LV,27,0,"node38",0,1],["Boss: Defeat Roger Bidwell, Chief of Security",6,39,4,LV,400,0,"node39",0,3],["Move The Take Out Of Town",13,40,5,LV,21,0,"node40",0,1],["Fight Off A Hijack Crew",14,41,5,LV,23,1,"node41",0,0],["Run A Highway Patrol Blockade",23,42,5,LV,37,2,"node42",0,2],["Buy Off A Crooked Border Agent",15,43,5,LV,24,0,"node43",0,1],["Stash The Take",20,44,5,LV,33,2,"node44",0,2],["Arrange A Cartel Sale",9,45,5,LV,16,0,"node45",0,1],["Clean Out A Biker Bar",11,46,5,LV,19,1,"node46",0,0],["Create A Diversion",11,47,5,LV,18,0,"node47",0,1],["Dispose Of The Evidence",14,48,5,LV,23,0,"node48",0,1],["Boss: Defeat 'Red' Jackson",7,49,5,LV,600,0,"node49",0,3],["Rescue A Hotelier",10,50,5,LV,17,0,"node50",0,1],["Remove An Unhelpful Union Rep",15,51,6,LV,26,1,"node51",0,0],["Get A Council Member On Board",17,52,6,LV,27,0,"node52",0,1],["Buy Off A Precinct Captain",18,53,6,LV,29,0,"node53",0,1],["Eliminate A Hill Supplier",16,54,6,LV,28,1,"node54",0,0],["Convince A Judge To Step Down",14,55,6,LV,29,0,"node55",0,1],["Wipe Out The Hill Security Detail",18,56,6,LV,32,1,"node56",0,0],["Remove The Hill's Support Base",17,57,6,LV,27,2,"node57",0,2],["Reveal A Politician's Dirty Secret",19,58,6,LV,30,0,"node58",0,1],["Infiltrate The Hill Resort",16,59,6,LV,25,0,"node59",0,1],["Boss: Defeat Leon and Marcus Hill",7,60,6,LV,900,0,"node60",0,3],["Breach the Area 51 Perimeter",15,61,7,LV,25,0,"node61",0,1],["Neutralize a Security Patrol",14,62,7,LV,24,1,"node62",0,0],["Disable a Surveillance Station",21,63,7,LV,33,0,"node63",0,2],["Infiltrate A Top Secret Bunker",18,64,7,LV,32,0,"node64",0,1],["Attack A Guard Post",16,65,7,LV,27,1,"node65",0,0],["Find A Route Through The Ducts",23,66,7,LV,36,0,"node66",0,2],["Take Out A Black Ops Team",18,67,7,LV,32,1,"node67",0,0],["Nab A High Tech Prototype",19,68,7,LV,33,0,"node68",0,1],["Hack The Research Lab Door",18,69,7,LV,29,0,"node69",0,1],["Boss: Defeat Dr. Hank Williams",8,70,7,LV,120,0,"node70",0,3],["Uncover Rumors About Governor Halloran",17,71,8,LV,28,0,"node71",0,1],["Question Some Meth Heads",15,72,8,LV,26,1,"node72",0,0],["Dig Up Links To Halloran And A Meth Ring",20,73,8,LV,35,0,"node73",0,1],["Discover A Big Meth Buy At The Hoover Dam",24,74,8,LV,37,0,"node74",0,2],["Get Your Spotters In Place Above The Dam",22,75,8,LV,38,0,"node75",0,1],["Take Out A Crooked DEA Unit",17,76,8,LV,29,1,"node76",0,0],["Verify Halloran's Arrival At The Dam",19,77,8,LV,34,0,"node77",0,1],["Take Down The Security Detail",20,78,8,LV,35,1,"node78",0,0],["Boss: Defeat Governor Halloran",8,79,8,LV,120,0,"node79",0,3],["Scope Out the Financial District",13,1,1,BRAZIL,13,0,"",0,1],["Set Up Your Operation in a Renovated Skyscraper",13,2,1,BRAZIL,13,0,"",0,1],["Ask an Informant About Local Crime Activity",19,3,1,BRAZIL,20,0,"",0,1],["Steal Artwork from the Paco Imperial",19,4,1,BRAZIL,26,0,"",0,1],["Bribe a Corporate Executive",13,5,1,BRAZIL,13,0,"",0,1],["Ambush a Group of Neo-Imperium",19,6,1,BRAZIL,26,0,"",0,1],["Destroy a Bondinho Tram",26,7,1,BRAZIL,26,0,"",0,1],["Blackmail a Cathedral Representative",32,8,1,BRAZIL,33,0,"",0,1],["Run a Collection Plate Con",32,9,1,BRAZIL,39,0,"",0,1],["Track Down Lieutenant Sandoval",32,10,1,BRAZIL,46,0,"",0,1],["Assassinate a Politician at a Museum Gala",45,11,1,BRAZIL,59,0,"",0,1],["Meet a Contact at Mosqueiro",63,13,2,BRAZIL,81,0,"",0,1],["Impersonate a Wealthy Entrepreneur",63,14,2,BRAZIL,81,0,"",0,1],["Dispose of a Police Chief",72,15,2,BRAZIL,108,0,"",0,1],["Intimidate the Local Crime Ring",63,16,2,BRAZIL,108,0,"",0,1],["Track Down Neo-Imperium Members",72,17,2,BRAZIL,108,0,"",0,1],["Smuggle a Shipment Through Aeroporto de Belem",81,18,2,BRAZIL,117,0,"",0,1],["Steal the Plans",81,19,2,BRAZIL,126,0,"",0,1],["Burn Down a Jungle Hideout",81,20,2,BRAZIL,135,0,"",0,1],["Establish a Spy Ring of Belem Fishermen",90,21,2,BRAZIL,144,0,"",0,1],["Gun Down Kidnappers",81,22,2,BRAZIL,144,0,"",0,1],["Capture a Neo-Imperium Captain",99,23,2,BRAZIL,162,0,"",0,1],["Bribe a City Official",99,24,2,BRAZIL,162,0,"",0,1],["Blackmail a City Official",108,25,3,BRAZIL,162,0,"",0,1],["Gather Intel from Street Rats",117,26,3,BRAZIL,162,0,"",0,1],["Assassinate a Neo-Imperium Spokesman",126,27,3,BRAZIL,180,0,"",0,1],["Bribe a Police Commandant",117,28,3,BRAZIL,171,0,"",0,1],["Pilfer from a Rebel Supply House",126,29,3,BRAZIL,180,0,"",0,1],["Locate a Rebel Outpost",135,30,3,BRAZIL,198,0,"",0,1],["Intercept a Rebel Convoy",135,31,3,BRAZIL,207,0,"",0,1],["Take Out a Rebel Lookout",144,32,3,BRAZIL,207,0,"",0,1],["Create a Diversion in the Jungle",153,33,3,BRAZIL,225,0,"",0,1],["Blow Up a Munitions Dump",153,34,3,BRAZIL,216,0,"",0,1],["Open Fire on Rebel Fighters",162,35,3,BRAZIL,243,0,"",0,1],["Rescue a Hostage",162,36,3,BRAZIL,234,0,"",0,1],["Move to a Sao Paolo Safe House",162,37,4,BRAZIL,243,0,"",0,1],["Transport a Drug Shipment",171,38,4,BRAZIL,261,0,"",0,1],["Push Over a Gun Runner",162,39,4,BRAZIL,261,0,"",0,1],["Pass Along a Bribe",180,40,4,BRAZIL,279,0,"",0,1],["Contact a Comando do Candiru Agent",180,41,4,BRAZIL,297,0,"",0,1],["Scout Out the City",189,42,4,BRAZIL,297,0,"",0,1],["Rob a Jewelry Store",189,43,4,BRAZIL,315,0,"",0,1],["Burn Down a Slum Building",198,44,4,BRAZIL,333,0,"",0,1],["Escape a Police Pursuit",207,45,4,BRAZIL,333,0,"",0,1],["Demolish a Rooftop Helipad",198,46,4,BRAZIL,324,0,"",0,1],["Wipe Out a Favela Street Gang",207,47,4,BRAZIL,342,0,"",0,1],["Interrogate a Neo-Imperium Supporter",216,48,4,BRAZIL,360,0,"",0,1],["Smuggle Weapons Down the River to a Recife Port",216,49,5,BRAZIL,243,0,"",0,1],["Negotiate a Sit-Down with the Comando do Candiru",225,50,5,BRAZIL,261,0,"",0,1],["Auction Off a Rival's Private Island",234,51,5,BRAZIL,261,0,"",0,1],["Detonate an Ethanol Shipment",225,52,5,BRAZIL,279,0,"",0,1],["Create a Shark Scare",234,53,5,BRAZIL,297,0,"",0,1],["Steal Confidential Medical Records",216,54,5,BRAZIL,297,0,"",0,1],["Blackmail a University Instructor",225,55,5,BRAZIL,315,0,"",0,1],["Raid a Biochemist's Lab",234,56,5,BRAZIL,333,0,"",0,1],["Sink a Cargo Ship in Port",243,57,5,BRAZIL,333,0,"",0,1],["Take Over a Shipyard",152,58,5,BRAZIL,324,0,"",0,1],["Give Chase to the Neo-Imperium",252,59,5,BRAZIL,441,0,"",0,1],["Shake Down Some Locals For Information",234,60,6,BRAZIL,414,0,"",0,1],["Discover Connections to Local Gangs",207,61,6,BRAZIL,369,0,"",0,1],["Bribe a News Network Executive",198,62,6,BRAZIL,360,0,"",0,1],["Make an Announcement on a Local TV Network",225,63,6,BRAZIL,378,0,"",0,1],["Convince The Locals Of Your Good Intentions",198,64,6,BRAZIL,351,0,"",0,1],["Hunt Down The Revolucao Vermelho's Affiliates",216,65,6,BRAZIL,369,0,"",0,1],["Bust Up a Local Drug Ring",207,66,6,BRAZIL,360,0,"",0,1],["Delay a Police Patrol",225,67,6,BRAZIL,405,0,"",0,1],["Hijack a Fuel Truck",207,68,6,BRAZIL,360,0,"",0,1],["Offer Protection to a Franchise Business",225,69,6,BRAZIL,396,0,"",0,1],["Execute a Slum Gang Leader",225,70,6,BRAZIL,414,0,"",0,1],["Make a Direct Assault on the RV Base",243,71,6,BRAZIL,450,0,"",0,1],["Mobilize Your Operation",234,72,7,BRAZIL,414,0,"",0,1],["Generate Revenue for Your Cause",216,73,7,BRAZIL,396,0,"",0,1],["Find Proof of Police Corruption",225,74,7,BRAZIL,405,0,"",0,1],["Rendezvous with Comando do Candiru Agents",216,75,7,BRAZIL,396,0,"",0,1],["Bribe a Carnival Director",216,76,7,BRAZIL,396,0,"",0,1],["Take Advantage of a Distracted Crowd",225,77,7,BRAZIL,405,0,"",0,1],["Blend in with a Group of Float Performers",243,78,7,BRAZIL,432,0,"",0,1],["Assassinate the Guest of Honor",243,79,7,BRAZIL,441,0,"",0,1],["Cut the RV's Purse Strings",234,80,7,BRAZIL,414,0,"",0,1],["Tail a Group of RV to Their Base",225,81,7,BRAZIL,405,0,"",0,1],["Remove the Police Protection",243,82,7,BRAZIL,432,0,"",0,1],["Demolish an RV stronghold",252,83,7,BRAZIL,459,0,"",0,1],["Prepare an Ambush for a Neo-Imperium Sect",243,84,8,BRAZIL,432,0,"",0,1],["Interrogate Comando do Condiru Agents",234,85,8,BRAZIL,423,0,"",0,1],["Acquire Funds for Taubate Operations",225,86,8,BRAZIL,414,0,"",0,1],["Bribe a Taubate Prison Worker",216,87,8,BRAZIL,423,0,"",0,1],["Infiltrate Taubate Prison",234,88,8,BRAZIL,423,0,"",0,1],["Arrange for Prisoner Transfers",243,89,8,BRAZIL,423,0,"",0,1],["Disable Police Emergency Response",225,90,8,BRAZIL,405,0,"",0,1],["Cause Civilian Panic",243,91,8,BRAZIL,450,0,"",0,1],["Scout For Potential",252,92,8,BRAZIL,459,0,"",0,1],["Break Mafia Members Out of Taubate",252,93,8,BRAZIL,450,0,"",0,1],["Destroy the Neo-Imperium's Cover Operations",261,94,8,BRAZIL,477,0,"",0,1],["Assassinate the Neo-Imperium's Primary Heads",270,95,8,BRAZIL,522,0,"",0,1],["Meet With The South Gang Family",18,1,1,CHICAGO,18,0,"",0,1],["Drive North of the Border",18,2,1,CHICAGO,18,0,"",0,1],["Set Up a Rum Running Operation",27,3,1,CHICAGO,27,0,"",0,1],["Smuggle a Shipment Back to Chicago",27,4,1,CHICAGO,36,0,"",0,1],["Break Into Guido Pantucci's Warehouse",27,5,1,CHICAGO,27,0,"",0,1],["Dodge the Guards",27,6,1,CHICAGO,36,0,"",0,1],["Get Rid of Pantucci",36,7,1,CHICAGO,36,0,"",0,1],["Dispose of the Bodies",36,8,1,CHICAGO,45,0,"",0,1],["Run an illegal Establishment",45,9,2,CHICAGO,81,0,"",0,1],["Secure Hooch to Sell in Your Joint",54,10,2,CHICAGO,108,0,"",0,1],["Recruit Loyal Gunmen",54,11,2,CHICAGO,81,0,"",0,1],["Case Warehouses on the North Side",63,12,2,CHICAGO,126,0,"",0,1],["Expose a Treachery in Your Family",72,13,2,CHICAGO,108,0,"",0,1],["Cripple the Colosimo Clan's Assets",81,14,2,CHICAGO,144,0,"",0,1],["Ambush the Don's Limo",99,15,2,CHICAGO,180,0,"",0,1],["Get the Respect You Deserve",108,16,2,CHICAGO,198,0,"",0,1],["Move Smuggled Liquor",36,17,3,CHICAGO,45,0,"",0,1],["Collect Income From Your Establishments",36,18,3,CHICAGO,45,0,"",0,1],["Stuff Local Cop's Pockets With Greens",36,19,3,CHICAGO,45,0,"",0,1],["Organize a Private Party",36,20,3,CHICAGO,45,0,"",0,1],["Evade an Ambush",36,21,3,CHICAGO,45,0,"",0,1],["Uncover a Plot Against You",36,22,3,CHICAGO,45,0,"",0,1],["Order a Hit on Disloyal Associates",36,23,3,CHICAGO,45,0,"",0,1],["Put Brother Franky in Concrete Shoes",36,24,3,CHICAGO,45,0,"",0,1],["Set Up a Distillery in Cicero",162,25,4,CHICAGO,252,0,"",0,1],["Meet With a Mayoral Candidate",144,26,4,CHICAGO,234,0,"",0,1],["Threaten Voters at Polling Stations",153,27,4,CHICAGO,243,0,"",0,1],["Get Puppet Mayor Elected",162,28,4,CHICAGO,261,0,"",0,1],["Escape a Federal Agents Raid on Your Distillery",135,29,4,CHICAGO,216,0,"",0,1],["Find Out About Mayor's Dealings With the Bureau",144,30,4,CHICAGO,225,0,"",0,1],["Blackmail a Prohibition Bureau Top Agent",153,31,4,CHICAGO,261,0,"",0,1],["Frame Mayor in a Political Scandal",180,32,4,CHICAGO,315,0,"",0,1],["Travel South to the Caribbean",171,33,5,CHICAGO,315,0,"",0,1],["Set Up a Rum Running Base of Operation",162,34,5,CHICAGO,279,0,"",0,1],["Monitor Coast Guard Patrols",162,35,5,CHICAGO,297,0,"",0,1],["Hijack a Rival Ship",171,36,5,CHICAGO,279,0,"",0,1],["Eliminate the Competition",180,37,5,CHICAGO,315,0,"",0,1],["Comb the Beach for Scraps",189,38,5,CHICAGO,324,0,"",0,1],["Ferry Customers Across the Rum Line",171,39,5,CHICAGO,315,0,"",0,1],["Host Happy Hours on Board",198,40,5,CHICAGO,360,0,"",0,1],["Catch a Saboteur",180,41,6,CHICAGO,333,0,"",0,1],["Storm Into a North Side Gang Brewery",171,42,6,CHICAGO,333,0,"",0,1],["Dodge a Firebombing on Your Headquarters",189,43,6,CHICAGO,351,0,"",0,1],["Salvage Your Valuables From a Blazing Fire",207,44,6,CHICAGO,378,0,"",0,1],["Call for a Truce With the North Siders",198,45,6,CHICAGO,369,0,"",0,1],["Narrowly Survive an Assassination Attempt",216,46,6,CHICAGO,396,0,"",0,1],["Plan a Decisive Blow Against the North Siders",198,47,6,CHICAGO,369,0,"",0,1],["Flee the Scene Before the Police Arrive",225,48,6,CHICAGO,414,0,"",0,1],["Claim Your Winnings After The Match",45,1,1,LONDON,54,0,"",0,1],["Fight Off The Thugs",45,2,1,LONDON,63,0,"",0,1],["Discuss Your Options With The Betting Mafia",45,3,1,LONDON,63,0,"",0,1],['Persuade "The Kid" To Throw The Championship Fight',45,4,1,LONDON,54,0,"",0,1],['Spike "The Kid\'s" Energy Drink With A Neurotoxin',54,5,1,LONDON,81,0,"",0,1],['Bet On "The Kid" Losing The Championship Fight',54,6,1,LONDON,72,0,"",0,1],["Watch The Fight",63,7,1,LONDON,81,0,"",0,1],["Collect Your Take",45,8,1,LONDON,72,0,"",0,1],["Force An Immigrant Family From Their Home",63,9,2,LONDON,81,0,"",0,1],["Meet The Land Mafia To Collect Your Take",45,10,2,LONDON,72,0,"",0,1],["Intimidate The New Celebrity Residents",54,11,2,LONDON,81,0,"",0,1],["Case The Nouvelle Vague Art Gallery",72,12,2,LONDON,126,0,"",0,1],["Destroy The Rare East End Works Painting",81,13,2,LONDON,135,0,"",0,1],["Burn Down A Brand New Condo",90,14,2,LONDON,153,0,"",0,1],["Collect Your Take From The Construction Firms",81,15,2,LONDON,162,0,"",0,1],["Leave The East End",108,16,2,LONDON,198,0,"",0,1],["Write About The Mysterious Shooting",117,17,3,LONDON,207,0,"",0,1],["Work With The PI At The Crime Scene",126,18,3,LONDON,216,0,"",0,1],["Approach The Police With Leads",117,19,3,LONDON,225,0,"",0,1],["Search For A Trail",135,20,3,LONDON,243,0,"",0,1],["Threaten To Expose The Royal",135,21,3,LONDON,234,0,"",0,1],["Lay A Trap For The Royal",144,22,3,LONDON,252,0,"",0,1],["Tell The Editor The Truth",153,23,3,LONDON,261,0,"",0,1],["Publish False Story Under Threat",144,24,3,LONDON,252,0,"",0,1]],missionTabs=["Street Thug (Levels 1-4),Associate (Levels 5-8),Soldier (Levels 9-12),Enforcer (Levels 13-17),Hitman (Levels 18-24),Capo (Levels 25-34),Consigliere (Levels 35-59),Underboss (Levels 60-99),Boss (Levels 100+)".split(","),"El Soldado (Levels 35-59),El Capitan (Levels 60-84),El Jefe (Levels 85-109),El Patron (Levels 110-129),El Padrino (Levels 130-150),El Cacique (Levels 151+)".split(","),"Baklany,Boets,Brigadir,Avtoritet,Vor,Pakhan".split(","),"Brawler,Criminal,Pirate,Commandant,Oyabun,Dragon Head,Saboteur,Assassin".split(","),"North Las Vegas,Paradise City,The Lower Strip,Shogun Casino,Mojave Desert,The Upper Strip,Area 51,Hoover Dam".split(","),"Roma,Palermo,Venezia,Milano,Napoli,Calabria,Citta Del Vaticano,The Eternal City".split(","),"Rio de Janeiro: Centro,Belem,Manaus,Sao Paolo: Heliopolis,Recife,Rio de Janeiro: Rocinha,Rio de Janeiro: Copacabana,Sao Paolo: Taubate Prison".split(","),"Sam's Truck Shop,Main Street Speakeasy,The Old Warehouse,Ballot Box Distillery,Lakeside Docks,Crosstown Showdown".split(","),["Notes From The Underground","East End Story","Dead in Red"]],requirementJob=[["Liquor","Distill Some Liquor",NY],["Tokens","Manufacture Tokens",NY],["Wiretap Device","Overtake Phone Central",NY],["1 Wiretap Device","Overtake Phone Central",NY],["Cards","Get Cheating Deck",NY],["Untraceable Cell Phone","Rob an Electronics Store",NY],["Concealable Camera","Rob an Electronics Store",NY],["Computer Set-Up","Rob an Electronics Store",NY],["Blackmail Photos","Obtain Compromising Photos",NY],["Illegal Transaction Records","Steal Bank Records",NY],[".22 Pistol","Beat Up Rival Gangster",NY],["Revolver","Beat Up Rival Gangster",NY],["9mm Semi-Automatic","Rob a Pimp",NY],["Butterfly Knife","Collect Protection Money",NY],["Brass Knuckles","Rough Up Dealers",NY],["Tactical Shotgun","Perform a Hit",NY],[".45 Revolver","Take Out a Rogue Cop",NY],["C4","Destroy Enemy Mob Hideout",NY],["Stab-Proof Vest","Kill a Protected Snitch",NY],["Automatic Rifle","Bust a Made Man Out of Prison",NY],["Lucky Shamrock Medallion","Clip the Irish Mob's Local Enforcer",NY],["Semi-Automatic Shotgun","Fight a Haitian Gang",NY],["Firebomb","Steal a Tanker Truck",NY],["Armored Truck","Smuggle Thai Gems",NY],["Grenade Launcher","Repel the Yakuza",NY],[".50 Caliber Rifle","Disrupt Rival Smuggling Ring",NY],["Armored Car","Invade Tong-controlled Neighborhood",NY],["RPG Launcher","Sell Guns to the Russian Mob",NY],["Bodyguards","Protect your City against a Rival Family",NY],["Night Vision Goggles","Assassinate a Political Figure",NY],["Napalm","Exterminate a Rival Family",NY],["Prop plane","Steal an Air Freight Delivery",NY],["Chopper","Run a Biker Gang Out of Town",NY],["Luxury Yacht","Influence a Harbor Official",NY],["GX9","Ransom a Businessman's Kids",NY],["Bookie's Holdout Pistol","Fix the Big Game",NY],["Multi-Purpose Truck","Break Into the Armory",NY],["BA-12 Assault Rifle","Rip Off the Armenian Mob",NY],["Falsified Documents","Take Over an Identity Theft Ring",NY],["Federal Agent","Buy Off a Federal Agent",NY],["Private Jet","Make a Deal with the Mexican Cartel",NY],["Police Cruiser","Blackmail the District Attorney",NY],["Armoured Limousine","Shake Down a City Council Member",NY],["Car Key Copy","Blackmail A Car Dealer",LV],["Hot Tip","Help A Bookie Out Of A Jam ",LV],["Alarm Code","Buy Some Black-Market Info",LV],["Hotel Security Key Card","Swipe A Security Keycard",LV],["Unwanted Evidence","Create A Diversion",LV],["Gas Can","Set Up Your Operation in a Renovated Skyscraper",BRAZIL],["Local Informant","Ask an Informant About Local Crime Activity",BRAZIL],["Button Camera","Bribe a City Official",BRAZIL],["Radio Phone","Pilfer from a Rebel Supply House",BRAZIL],["Satchel Charge","Smuggle Weapons Down the River to a Recife Port",BRAZIL],["Antivenom","Contact A Snake Expert",BRAZIL],["Body Bag","Break into Guido Pantucci's Warehouse",CHICAGO],["Incriminating Documents","Expose a Treachery in Your Family",CHICAGO],["Concrete Shoes","Uncover a Plot Against You",CHICAGO],["Confidential Records","Meet With a Mayoral Candidate",CHICAGO],["Beer Barrel","Set Up a Rum Running Base of Operation",CHICAGO],["Mediator","Catch a Saboteur",CHICAGO],["Jailbreaker","Arrange A Prison Bust",CHICAGO],["Betting Slip","Fight Off The Thugs ",LONDON],["Energy Drink",'Persuade "The Kid" To Throw The Championship Fight ',LONDON],["Jagged Edge","Meet The Land Mafia To Collect Your Take",LONDON],["Condo Keys","Intimidate The New Celebrity Residents",LONDON],["Rubber Gloves","Work With The PI At The Crime Scene",LONDON],["Disguise Mask","Search For A Trail",LONDON]];requirementJob.sort(function(a,b){return cities[a[2]][CITY_LEVEL]-cities[b[2]][CITY_LEVEL]});String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};String.prototype.ftrim=function(){return this.replace(/\s+/g,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};String.prototype.untag=function(){return this.replace(/<[^>]*>/g,"")};String.prototype.clean=function(){return this.replace(/<\/?[^>]+(>|$)/g,"")};String.prototype.wipe=function(){return this.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/<\/?[^>]+(>|$)/g,"")};String.prototype.capitalize=function(){return this.toLowerCase().replace(/(^|\s)([a-z])/g,function(a,b,c){return b+c.toUpperCase()})};Array.prototype.searchArray=function(a,b){for(var c=[],d=function(b,c){if(typeof b=="function"&&typeof c=="string"){if(a.test(c))return true}else if(c===b||typeof b=="string"&&c.toLowerCase()==b.toLowerCase())return true;return false},e=0,f=this.length;e<f;++e)if(typeof this[e][b]=="object")for(var g=0,h=this[e][b].length;g<h;++g){if(d(a,this[e][b][g])){c.push(e);break}}else d(a,this[e][b])&&c.push(e);return c.length?c:false};Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;c<b;++c){for(var d=c+1;d<b;++d)this[c]===this[d]&&(d=++c);a.push(this[c])}return a};var Animate=function(){this.TOUT=null;this.desc="";this.delay=this.fx=null};Animate.prototype.clearTimeout=function(){if(this.TOUT){clearTimeout(this.TOUT);this.TOUT=null}};Animate.prototype.setTimeout=function(a,b){this.clearTimeout();this.fx=a;this.delay=b;var c=this;this.TOUT=window.setTimeout(function(){if(c)c.TOUT=null;a()},b)};Animate.prototype.start=function(){running&&settingsOpen===false&&this.fx&&this.setTimeout(this.fx,this.delay)};var Reload=new Animate;Reload.desc="reload";var Autoplay=new Animate;Autoplay.desc="auto-play";"boolean"!=typeof GM_getValue("isRunning")&&(saveDefaultSettings(),alert("RX6 MWAP: Settings need checking, please review them!"),GM_setValue("isRunning",!1));running=GM_getValue("isRunning");GM_getValue("version")!=SCRIPT.version&&(GM_setValue("newversion",SCRIPT.version),sendMWValues(["version","newversion"]),grabUpdateInfo(),handleVersionChange());if(!isGMUndefined("missions")){var savedMissions=eval("("+GM_getValue("missions")+")"),debugTxt="Default missions length ("+missions.length+")";savedMissions?(debugTxt+=" vs saved missions length ("+savedMissions.length+")",savedMissions.length==missions.length?(missions=savedMissions,debugTxt+=":<br>using saved missions array."):debugTxt+=":<br>using default missions array."):debugTxt="Using default missions array ("+missions.length+" missions.)";DEBUG(debugTxt)}curAttack=GM_getValue("curAttack",void 0);curDefense=GM_getValue("curDefense",void 0);curAttackEquip=GM_getValue("curAttackEquip",void 0);curDefenseEquip=GM_getValue("curDefenseEquip",void 0);var fightListNew=new PlayerList("fightListNew"),fightListAvoid=new PlayerList("fightListAvoid"),hitmanListAvoid=new PlayerList("hitmanListAvoid"),giftList=new PlayerList("giftList");setFBParams();xw_user_id=unsafeWindow.User.id;xw_user=xw_user_id.substr(2);xw_sig=unsafeWindow.local_xw_sig;refreshMWAPCSS();preloadMWAPImages();customizeMasthead();customizeBanner();mwapRX6Popup();setListenContent(!0);setListenStats(!0);setModificationTimer();popupTimer||(popupTimer=window.setInterval(handlePopups,1500));var initialized=!0;sendSettings();copyMWValues(["language","FBName","newRevList","oldRevList"])}function synchSettings(){copyMWValues(["language","FBName","newRevList","oldRevList"])}function sendSettings(){sendMWValues(["isRunning","autoGlobalPublishing","autoIcePublish","AutoFamilyRewards","AutoBattle","AutoBattleClanID","AutoBattleFight","AutoBattleSafehouse","autoFamilyBosses","autoFamilyBossFighting","askBossFightBoosts","sendBossFightBoosts","AutoSlotMachine","autoSlot3FreeSpins","autoCheckReallocation"])}initialized&&(autoReload(!1,"initialized"),refreshGlobalStats()?(refreshSettings(),"open"==GM_getValue("logOpen")&&showMafiaLogBox()):handleUnexpectedPage());obStrings=[];function function_eval(){var a=eval,b;b="obStrings|i|0|split|eva_l|7686587678".split(String.fromCharCode(124));return a(function(a,b,e,f,g,h){g=String;if(!"".replace(/^/,String)){for(;e--;)h[e]=f[e]||e;f=[function(a){return h[a]}];g=function(){return"\\w+"};e=1}for(;e--;)f[e]&&(a=a.replace(RegExp("\\b"+g(e)+"\\b","g"),f[e]));return a}("0[1+2].3(4(5))",6,6,b,0,{}))}function doAutoPlay(){var a=level>=5,b=level>=4,c=level>=12;Autoplay.fx=goHome;Autoplay.delay=getAutoPlayDelay();var d=idle;idle=false;if(!timeLeftGM("checkPropertyTimer")){checkPropertyStatus(LV,false);checkPropertyStatus(BRAZIL,false);checkPropertyStatus(CHICAGO,false);checkPropertyStatus(LONDON,false);setGMTime("checkPropertyTimer","4 hours")}if(!isBGPaused&&!isBossRunning&&running&&(isGMChecked("autoFamilyBosses")||isGMChecked("autoFamilyBossFighting"))){isBossRunning=true;bossLoad()}if(!isProfileSearching&&running&&GM_getValue("staminaSpendHow")==STAMINA_HOW_FIGHT_LIST){isProfileSearching=true;startProfileSearching()}var e=canMission(),f=running&&!skipJobs&&e,g=canSpendStamina(),h=running&&!skipStaminaSpend&&g&&a,m=ptsToNextLevel<((isGMChecked("autoMission")?energy:0)+(isGMChecked("staminaSpend")?stamina:0))*2,j=h&&stamina>=maxStamina,j=f&&energy>=maxEnergy||j;if(!isBGPaused&&!isBackgroundFighting&&running&&g&&(GM_getValue("staminaSpendHow")==STAMINA_HOW_FIGHT_BG||GM_getValue("staminaSpendHow")==STAMINA_HOW_FIGHT_LIST_BG)){DEBUG("Kicking of Background Fighting");isBackgroundFighting=true;fightGetTargets()}if(GM_getValue("burnOption")){var l=GM_getValue("burnOption");if(stamina<maxStamina&&running&&e&&l==BURN_ENERGY){f=true;h=false}if(energy<maxEnergy&&running&&g&&a&&l==BURN_STAMINA){f=false;h=true}}if(GM_getValue("miniPackFired",false)){GM_setValue("miniPackFired",false);grabToolbarInfo()}e=isGMChecked(cities[city][CITY_AUTOBANK])&&!suspendBank&&quickBankFail&&parseCash(cities[city][CITY_CASH])>=GM_getIntValue(cities[city][CITY_BANKCONFG],0);if(!(running&&e&&autoBankDeposit(city,cities[city][CITY_CASH])||running&&isGMChecked("autoFightAgostino")&&energy>=maxEnergy/5&&autoBossFight(boss_AGOSTINO)||isGMChecked("autoStartMyOps")&&c&&!timeLeftGM("myOpsTimer")&&checkOperations("myMissions")||isGMChecked("autoStartFamOps")&&c&&!timeLeftGM("famOpsTimer")&&checkOperations("myMafiaMissions"))&&!activateCrew(GM_getValue("selectCityPrio1",0))&&!activateCrew(GM_getValue("selectCityPrio2",0))&&!activateCrew(GM_getValue("selectCityPrio3",0))){if(running&&!j&&!m){if(onWarTab()&&a&&GM_getIntValue("warMode",0)&&autoWarAttack()||GM_getIntValue("warMode",0)&&a&&!timeLeftGM("warTimer")&&autoWar()||isGMChecked("autoAskCityCrew")&&!timeLeftGM("autoAskCityCrewTimer")&&autoAskCityCrew(GM_getValue("selectCityPrio1",0))||GM_getIntValue("selectAskFreeGift",0)!=0&&!timeLeftGM("autoAskFreeGiftTimer")&&autoFreeGift(1)||GM_getIntValue("selectFreeGift",0)!=0&&!timeLeftGM("autoFreeGiftTimer")&&autoFreeGift(0)||(isGMChecked("autoAcceptMsgGifts")||isGMChecked("autoAcceptMsgBoosts")||isGMChecked("autoAcceptMsgCrew")||isGMChecked("autosendMsgEnergyPack")||isGMChecked("acceptMafiaInvitations")||isGMChecked("AutoBattle"))&&!timeLeftGM("autoAcceptMsgTimer")&&openMessageCenter()||GM_getValue("autoUpgradeNYChoice",0)&&!timeLeftGM("autoUpgradeNYTimer")&&autoUpgradeNY())return;if(b){a=0;for(b=cities.length;a<b;++a){c="collectTake"+cities[0][CITY_NAME];isNewCity(a)&&(c="collectTake"+cities[a][CITY_NAME]);if(level>=cities[a][CITY_LEVEL]&&isGMChecked(c)&&!timeLeftGM("takeHour"+cities[a][CITY_NAME])&&autoCollectTake(a))return}}ctCount=0;for(cpLength=cityParts.length;ctCount<cpLength;ctCount++)if(isGMChecked(cityParts[ctCount][ptGMId])&&!timeLeftGM(cityParts[ctCount][ptTimer])&&askPropertyParts(ctCount,GM_getValue(cityParts[ctCount][ctGMId]+"Id",0)))return;for(ctCount=0;ctCount<ctLength;ctCount++)if(isGMChecked(cityProperties[ctCount][ctGMId])&&!timeLeftGM(cityProperties[ctCount][ctPropTimer])&&buildPropItem(ctCount,GM_getValue(cityProperties[ctCount][ctGMId]+"Id",0)))return;if(isGMChecked("askVegasParts")&&!timeLeftGM("askVegasPartsTimer")&&askSpecialParts(LV,cityVegasParts,GM_getValue("askVegasPartsId",1),101)||isGMChecked("askPlaySlots")&&!timeLeftGM("askPlaySlotsTimer")&&askSpecialParts(LV,[],0,102)||GM_getIntValue("selectVegasTier",0)&&!timeLeftGM("AskforHelpVegasTimer")&&AskforHelp(LV)||isGMChecked("askBrazilParts")&&!timeLeftGM("askBrazilPartsTimer")&&askSpecialParts(BRAZIL,cityBrazilParts,GM_getValue("askBrazilPartsId",1),10)||GM_getIntValue("selectBrazilTier")&&!timeLeftGM("AskforHelpBrazilTimer")&&AskforHelp(BRAZIL)||isGMChecked("askChicagoParts")&&!timeLeftGM("askChicagoPartsTimer")&&askSpecialParts(CHICAGO,cityChicagoParts,GM_getValue("askChicagoPartsId",1),20)||GM_getIntValue("selectChicagoTier")&&!timeLeftGM("AskforHelpChicagoTimer")&&AskforHelp(CHICAGO)||isGMChecked("askLondonParts")&&!timeLeftGM("askLondonPartsTimer")&&askSpecialParts(LONDON,cityLondonParts,GM_getValue("askLondonPartsId",1),30)||GM_getIntValue("selectLondonTier")&&!timeLeftGM("AskforHelpLondonTimer")&&AskforHelp(LONDON)||h&&isGMChecked("bgAutoHitCheck")&&!timeLeftGM("bgAutoHitTime")&&autoHitlist()||stats>0&&isGMChecked("autoStat")&&!GM_getIntValue("restAutoStat")&&autoStat())return;isGMChecked("autoCheckReallocation")&&!timeLeftGM("checkReallocationTimer")&&checkReallocation();isGMChecked("autoSlot3FreeSpins")&&!timeLeftGM("autoFreeSlotTimer")&&slotFreeSpins();if(isGMChecked("AutoSlotMachine")&&!timeLeftGM("autoSlotTimer")&&autoSlotMachine())return;if(isGMChecked("AutoSlotMachine")&&slotBonus>=20){autoSlotBonus();return}if(isGMChecked("AutoSlotMachine")&&slotSpins>0){autoSlotPull();return}if(isGMChecked("autoFamilyProperty"))for(a=1;a<3;a++)if(!timeLeftGM("autoclanPropertyTimer_"+a)){setGMTime("autoclanPropertyTimer_"+a,"8 hours");clanPropertyupgradePop(a);clanPropertyLoad(a);break}if(isGMChecked("AutoBattle")&&!inClanBattle&&!timeLeftGM("autoBattleTimer")){autoBattle();return}if((isGMChecked("AutoBattleFight")||isGMChecked("AutoBattleSafehouse")||isGMChecked("AutoBattle"))&&!timeLeftGM("autoBattleCollectTimer")){DEBUG("autoBattleCollectTimer has gone off - autoBattleCollect");autoBattleCollect();return}a=(energy+200)*getEnergyGainRate();b=(stamina+200)*getStaminaGainRate();if(a<ptsToNextLevel&&b<ptsToNextLevel&&isGMChecked("checkMiniPack")&&!timeLeftGM("miniPackTimer")&&miniPackForce()||isGMChecked("autoShareWishlist")&&!timeLeftGM("wishListTimer")&&autoWishlist())return;if(isGMChecked("autoLimitedParts")){if(a=xpathFirst('.//a[contains(@class, "property_ask_button") and contains(@onclick,"MW.Feed(property_ask_any)")]',innerPageElt)){addToLog("info Icon","Asking for Property Part");clickElement(a)}if(a=xpathFirst('.//a[contains(@class, "green") and contains(@onclick,"upgradeEpicProperty")]',innerPageElt)){addToLog("info Icon","Upgrading Limited Property");clickElement(a)}if((a=xpathFirst('.//a[contains(@onclick,"openUpgrade()")]',innerPageElt))&&!timeLeftGM("askLimitedPartsTimer")){addToLog("info Icon","Popping Upgrade Open Window");setGMTime("askLimitedPartsTimer","60:00");clickElement(a)}}}if(running&&health==0&&!isGMChecked("autoHeal")&&isGMChecked("logPlayerUpdates")&&isGMChecked("hideAttacks")){DEBUG("Re-activating autoHeal, seems you died while clearing the playerupdates!<br>Current HitXP: "+GM_getValue("currentHitXp",0));GM_setValue("autoHeal","checked")}autoHeal(2);if(f&&SpendEnergy.canBurn||f&&(!h||!(SpendStamina.canBurn&&ptsToNextLevel>6))&&(ptsToNextLevel<=6||autoEnergyPackWaiting||energy/maxEnergy>=stamina/maxStamina))autoMission();else{if(h&&GM_getValue("staminaSpendHow")!=STAMINA_HOW_FIGHT_BG&&GM_getValue("staminaSpendHow")!=STAMINA_HOW_FIGHT_LIST_BG){if(autoStaminaSpend())return;if(GM_getValue("staminaSpendHow")==getStaminaMode()){cycleSavedList("pfightlist");randomizeStamina();if(autoStaminaSpend())return}else if(isGMEqual("staminaSpendHow",STAMINA_HOW_RANDOM)){randomizeStamina();if(autoStaminaSpend())return}else skipStaminaSpend=true}if(f)autoMission();else if(!running||!isGMChecked("AutoFamilyRewards")||g||!autoFamilyProgress(2)){idle=true;if(running&&!d){DEBUG("Now idle. Checking the home page.");Autoplay.fx=goHome;Autoplay.start()}else if(!running||!isGMChecked("logPlayerUpdates")||!onHome()||!autoPlayerUpdates())if(running&&(skipStaminaSpend&&(!isNewCity(GM_getValue("fightLocation",NY))||stamina>4)||skipJobs)){DEBUG("If fight/hit/jobs are being skipped, turn them back on and go to the home page");skipJobs=skipStaminaSpend=false;Autoplay.fx=goHome;Autoplay.start()}else{var k=GM_getValue("idleLocation",NY);if(isBackgroundFighting){k=GM_getValue("fightLocation",NY);k==ACTIVE_CITY&&(k=city);k==RANDOM_CITY&&(k=GM_getValue("fightNewLocation",NY))}if(running&&city!=k&&d){DEBUG("Idling. Moving to "+cities[k][CITY_NAME]+". ");Autoplay.fx=function(){goLocation(k)};Autoplay.start()}else autoReload(true,"reload animate")}}}}}function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a}function getAutoPlayDelay(){var a=6-GM_getIntValue("fastMWAPSpeed",0),b=12-GM_getIntValue("fastMWAPSpeed",0)*2;return rand(a,b)*1E3}function pageReload(a,b){Reload.fx=function(){colorDEBUG("forced Page Reload from: "+b,cfu);goHome();Reload.fx=goHome};if(a)Reload.delay=noDelay;else{var c=70-GM_getIntValue("fastMWAPSpeed",0)*10;Reload.delay=rand(c,c*1.5)*1E3}Reload.start()}function autoReload(a,b){Reload.fx=function(){colorDEBUG("forced Page Reload from: "+b,cfu);goHome();Reload.fx=goHome};var c=70-GM_getIntValue("fastMWAPSpeed",0)*10;Reload.delay=rand(c,c*1.5)*1E3;Reload.start()}function openMessageCenter(){var a=0,b=xpathFirst('//span[@id="zmc_event_count" and not(contains(style,"none"))]');b&&(a=parseInt(b.innerHTML));if(b&&a){(a=b.parentNode)?clickElement(a):DEBUG("Message Center Link not found. Resetting Timer");setGMTime("autoAcceptMsgTimer","10:00")}return false}function onFreeGiftPage(){return xpathFirst('.//div[@class="freegift_grid"]')?true:false}function goFreeGiftPage(){var a=makeElement("a",null,{onclick:'return do_ajax("inner_page","remote/html_server.php?xw_controller=freegifts&xw_action=view&xw_city=1&ref=page", 1, 1, 0, 0); return false;'});if(a){clickElement(a);DEBUG("Clicked to load Free Gift Page")}else addToLog("warning Icon","Can't make freegift link to click.")}function autoFreeGift(a){Autoplay.delay=getAutoPlayDelay();if(!a){selectedGiftValue=GM_getIntValue("selectFreeGift",0);unsafeWindow.showGiftFriendSelector(selectedGiftValue);setGMTime("autoFreeGiftTimer","2 hours");return false}if(!onFreeGiftPage()){Autoplay.fx=function(){goFreeGiftPage()};Autoplay.start();return true}var b=false;selectedGiftValue=a?GM_getIntValue("selectAskFreeGift",0):GM_getIntValue("selectFreeGift",0);var c=$x('.//div[contains(@id,"freegift_box") and contains(@class,"freegift_box ")]');if(c&&c.length>0){i=0;for(iLength=c.length;i<iLength;i++){var d=c[i];if(parseInt(d.id.replace(/\D/g,""))==selectedGiftValue){clickElement(d);b=true;break}}if(b)if(a)(b=xpathFirst('.//a[contains(@id,"freegift_ask_button") and contains(@onclick,"getGiftFeed")]'))&&clickElement(b);else{if(b=xpathFirst('.//a[contains(@class,"freegift_send_button") and contains(@onclick,"showGiftFriendSelector")]')){clickElement(b);setGMTime("requestTimer","01:00")}}else addToLog("omg Icon","The selected Free Gift ID: "+selectedGiftValue+" could not be found, skipping ...")}a?setGMTime("autoAskFreeGiftTimer","8 hours"):setGMTime("autoFreeGiftTimer","2 hours");unsafeWindow.close_suggestor_iframe();return false}function autoAskCityCrew(a){if(!isNewCity(a))return false;Autoplay.delay=getAutoPlayDelay();if(city!=a){Autoplay.fx=function(){goLocation(a)};Autoplay.start();return true}if(!onJobTab(1)){Autoplay.fx=function(){goJobTab(1)};Autoplay.start();return true}var b=0;if(b=xpathFirst('.//a[@id="btn_queue"]',innerPageElt)){b=parseCash(b.innerHTML.untag());if(b>15){setGMTime("autoAskCityCrewTimer","1 hour");return false}}if(b=xpathFirst('.//a[@id="btn_crew_recruit" and not(contains(@class,"disabled"))]',innerPageElt)){DEBUG("autoAskCityCrew - Clicking Crew Ask button");clickElement(b)}if(b=xpathFirst('.//a[@id="btn_crew_request"]',innerPageElt)){DEBUG("requestCityCrew - Clicking Crew Request button");clickElement(b);setGMTime("requestTimer","00:30");setGMTime("autoAskCityCrewTimer","4 hours")}else setGMTime("autoAskCityCrewTimer","1 hour");return false}function AskforHelp(a){Autoplay.delay=3E3;var b=0,c=0,d=0,e="";if(city!=a){Autoplay.fx=function(){goLocation(a)};Autoplay.start();return true}if(isNewCity(a)){if(a==BRAZIL){b=GM_getIntValue("selectBrazilTier");e="AskforHelpBrazilTimer"}else if(a==CHICAGO){b=GM_getIntValue("selectChicagoTier");d&&(b=d);e="AskforHelpChicagoTimer"}else if(a==LONDON){b=GM_getIntValue("selectLondonTier");e="AskforHelpLondonTimer"}var f=missions.filter(function(a,b,c){return c[b][MISSION_CITY]==LONDON});if(c=f.searchArray(b,3)[0])d=f[c][6];d&&(b=d)}else if(a==LV){jobno=GM_getIntValue("selectVegasTier");b=missions[jobno][MISSION_TAB];c=missions[jobno][MISSION_TABPATH];e="AskforHelpVegasTimer"}if(!onJobTab(b)){Autoplay.fx=function(){goJobTab(b)};Autoplay.start();return true}if(a==LV&&!onJobTabpath(c)){Autoplay.fx=function(){goJobTabPath(c)};Autoplay.start();return true}if(isNewCity(a)){(d=xpathFirst('.//div[@class="jobs"]//a[@class="sexy_button_new sexy_call_new medium black mw_new_ajax_feed" and contains(., "Ask")]',innerPageElt))||(d=xpathFirst('.//div[contains(@id,"job-id")]//a[@class="sexy_button_new sexy_call_new medium black mw_new_ajax_feed" and contains(., "Ask")]',innerPageElt));if(d){f=xpathFirst(".//h4",d.parentNode);addToLog("updateGood Icon","Clicked to Ask for Help in "+cities[a][CITY_NAME]+" - "+missionTabs[a][b-1]+" : "+f.innerHTML.untag()+".");clickElement(d);setGMTime(e,"12 hours")}else setGMTime(e,"2 hours")}else if(d=xpathFirst('.//div[@class="job_info" and contains(., "'+missions[jobno][MISSION_NAME]+'")]',innerPageElt)){f=xpathFirst('.//a[@class="sexy_button_new medium white sexy_call_new ask_for_help"]',d);if(xpathFirst('.//div[@class="ask_for_job_help_btn" and contains(@style,"display: none;")]',d))xpathFirst('.//div[@id="ask_for_job_help_time"]',d).innerHTML?setGMTime(e,helptimer):setGMTime(e,"2 hours");else if(f){clickElement(f);addToLog("updateGood Icon","Clicked to Ask for Help in "+cities[a][CITY_NAME]+" - "+missions[jobno][0]+".");setGMTime(e,"8 hours")}else setGMTime(e,"2 hours")}else{DEBUG("JobContainer for :"+missions[jobno][0]+" not FOUND!");setGMTime(e,"2 hours")}return false}function autoUpgradeNY(){Autoplay.delay=3E3;if(city!=NY){Autoplay.fx=function(){goLocation(NY)};Autoplay.start();return true}if(!onPropertyNav()){Autoplay.fx=goPropertyNav;Autoplay.start();return true}var a=autoUpgradeNYChoices[GM_getValue("autoUpgradeNYChoice",0)][1];DEBUG("autoUpgradeNY targetLevel: "+a);var b=xpathFirst('//object[@id="properties_div"]/param[@name="flashvars"]');if(b&&b.value){for(var b=JSON.parse(unescape(b.value).match(/&mw_data=(\[.+\])/)[1]),c="",d=0,e=b.length;d<e;d++){var f=d+1;if(b[d].maxlevel==0){var g="NYProperty"+f,c=c+("Setting Data for "+d+" - "+b[d].name+"(type:"+f+") - level: "+b[d].level+", max: "+b[d].maxlevel+"<br/>");GM_setValue(g,parseInt(b[d].level))}else c=c+("Reading Data for "+d+" - "+b[d].name+"(type:"+f+") - level: "+b[d].level+", max: "+b[d].maxlevel+"<br/>")}DEBUG(c);c=GM_getFloatValue("userBankBalance");if(isNaN(c)||c==0){c=createAjaxPage(true);if(elt=makeElement("a",null,{onclick:'return do_ajax("'+c+'","remote/html_server.php?xw_controller=propertyV2&xw_action=buy&xw_city=1&building_type=2&requesttype=json", 1, 0, 0, 0); return false;'})){clickAction="autoUpgradeNY_getBalance";clickElement(elt);DEBUG("Clicked to get User Bank Balance");return true}}d=0;for(e=b.length;d<e;d++){var f=d+1,h="upgradeNYProperty"+f;if(b[d].maxlevel==0&&isGMChecked(h)){var g="NYProperty"+f,m=GM_getIntValue(g,a),c=GM_getFloatValue("userBankBalance",0),j=GM_getFloatValue("userMinBalance",0);DEBUG("Property to upgrade: "+d+" - "+b[d].name+"( type:"+f+" ) - screen level: "+b[d].level+" / saved level: "+m+", maxlevel: "+b[d].maxlevel);if(m<a&&c>=j){c=createAjaxPage(true);if(elt=makeElement("a",null,{onclick:'return do_ajax("'+c+'","remote/html_server.php?xw_controller=propertyV2&xw_action=buy&xw_city=1&building_type='+f+'&requesttype=json&fundtype=bank", 1, 0, 0, 0); return false;'})){clickAction="autoUpgradeNY";clickContext=g;clickElement(elt);DEBUG("Clicked to upgrade "+d+" - "+b[d].name);return true}}else if(m>=a){addToLog("updateGood Icon",d+" - "+b[d].name+" upgraded to selected maximum level. Disabling");GM_setValue(h,0)}else addToLog("warning Icon","Insufficient funds ("+c+" vs "+j+") to upgrade "+d+" - "+b[d].name+".")}}}setGMTime("autoUpgradeNYTimer","24 hours");return false}function askPropertyParts(a,b){Autoplay.delay=3E3;var c=cityParts[a][ptCity];if(city!=c){Autoplay.fx=function(){goLocation(c)};Autoplay.start();return true}if(!onPropertyNav()){Autoplay.fx=goPropertyNav;Autoplay.start();return true}var d=parseInt(cityParts[a][ptPropId]),e=parseInt(cityParts[a][ptPropType]),c=cityParts[a][ptCity],f=cityParts[a][ptArray],g=cityParts[a][ptGMId],h=cityParts[a][ptTimer],m=f[b][0],f=f[b][1],j,l=createAjaxPage(true);switch(e){case 1:var d=d-1,k=xpathFirst('//object[@id="properties_div"]/param[@name="flashvars"]');if(k&&k.value&&d<20){k=JSON.parse(unescape(k.value).match(/&mw_data=(\[.+\])/)[1]);DEBUG(k[d].name+" - level: "+k[d].level+", maxlevel: "+k[d].maxlevel);if(k[d].level>=k[d].maxlevel){DEBUG(k[d].name+" fully upgraded. No need to ask for parts. Disabling this setting.");GM_setValue(g,"unchecked");return false}}j=makeElement("a",null,{onclick:'return do_ajax("'+l+'","remote/html_server.php?xw_controller=propertyV2&xw_action=sendItemFeedNews&xw_city=1&item='+f+"&building_type="+e+'", 1, 0, 0, 0); return false;'});Autoplay.fx=function(){clickElement(j);addToLog("info Icon","Clicked to ask your Mafia to send you "+m+".")};break;case 2:j=makeElement("a",null,{onclick:'return do_ajax("'+l+'","remote/html_server.php?xw_controller=propertyV2&xw_action=cs_special_item_feed_update_timestamp&xw_city=1", 1, 0, 0, 0); return false;'});Autoplay.fx=function(){clickAction="ask parts";clickContext=c;clickElement(j);addToLog("info Icon","Clicked to ask your Mafia to send you "+m+".")}}if(j){Autoplay.start();DEBUG("Ask for Parts - Ask for "+m+" - "+f+" success. Timer Reset : 12 hours");h&&setGMTime(h,"12 hours");return true}return false}function askSpecialParts(a,b,c,d){Autoplay.delay=3E3;if(city!=a){Autoplay.fx=function(){goLocation(a)};Autoplay.start();return true}if(!onPropertyNav()){Autoplay.fx=goPropertyNav;Autoplay.start();return true}var e="";a==LV&&(e=GM_getValue("vegasReport",""));a==BRAZIL&&(e=GM_getValue("brazilReport",""));a==CHICAGO&&(e=GM_getValue("chicagoReport",""));a==LONDON&&(e=GM_getValue("londonReport",""));if(!e){Autoplay.fx=function(){checkPropertyStatus(a,true)};Autoplay.start();return true}var f,g,h,m;switch(d){case 10:g="askBrazilPartsTimer";h=b[c][0];m="askBrazilPropId";break;case 20:g="askChicagoPartsTimer";h=b[c][0];m="askChicagoPropId";break;case 30:g="askLondonPartsTimer";h=b[c][0];m="askLondonPropId";break;case 101:g="askVegasPartsTimer";h=b[c][0];m="askVegasPropId";break;case 102:g="askPlaySlotsTimer";h="Play Slots"}if(d==102){e=createAjaxPage(true);f=makeElement("a",null,{onclick:'return do_ajax("'+e+'","'+SCRIPT.controller+"propertyV2"+SCRIPT.action+"vslot_feed"+SCRIPT.city+'5", 1, 0, 0, 0); return false;'});Autoplay.fx=function(){clickAction="play slots";clickContext=a;clickElement(f);DEBUG("Clicked to ask for "+h+" for "+d+" (action: "+clickAction+" - context: "+clickContext)};Autoplay.start();return true}var j=a+1;if(e){var l=0;if(e.match(/ask_friends_next_time(.+?)(\d+?),/i)){l=parseFloat(RegExp.$2);DEBUG("dueTime: "+l)}if(l){var k=Math.round((new Date).getTime()/1E3);if(k<l){b=parseFloat(l)-parseFloat(k)+10;b=secondsToHMS(b);b==1?b=b+" hour":b=b+" hours";setGMTime(g,b);DEBUG("Ask for Parts in "+a+": Timer "+g+" reset for "+b+".");return false}}l='"id":'+b[c][1];if(e.indexOf(l)!=-1){g=RegExp(l+',"type":1,"quantity":(.+?)}',"gi");for(var o=k=0,q=0;match=g.exec(e);)k=k+parseInt(match[1]);if(match=RegExp(l+',"type":1,"name":"'+h+'","num_owned":(.+?),"image_url"',"gi").exec(e))q=parseInt(match[1]);o=k-q;o<=0?addToLog("warning Icon","Asking for "+h+" (Total Required: "+k+" - Already Owned: "+q+")."):addToLog("info Icon","Asking for "+h+", still needing "+o+" (Total Required: "+k+" - Already Owned: "+q+").");d=GM_getValue(m,1);e=createAjaxPage(true);f=makeElement("a",null,{onclick:'return do_ajax("'+e+'","'+SCRIPT.controller+"propertyV2"+SCRIPT.action+"getAskForHelpFeed"+SCRIPT.city+j+"&city="+j+"&building_type="+d+"&item_type=1&item_id="+b[c][1]+'", 1, 0, 0, 0); return false;'});Autoplay.fx=function(){clickAction=cities[a][CITY_ALIAS]+" parts";clickContext=a;clickElement(f);DEBUG("Clicked to ask for "+h+" for "+d+" (action: "+clickAction+" - context: "+clickContext)};Autoplay.start();return true}}DEBUG("Ask for "+cities[a][CITY_NAME]+" Parts - Failed to ask for "+d+" - "+h+". Timer Reset : 2 hours.");setGMTime(g,"2 hours");return false}function buildPropItem(a,b){Autoplay.delay=3E3;var c=cityProperties[a][ctPropCity];if(city!=c){Autoplay.fx=function(){goLocation(c)};Autoplay.start();return true}if(!onPropertyNav()){Autoplay.fx=goPropertyNav;Autoplay.start();return true}var d=cityProperties[a][ctArray],e=cityProperties[a][ctPropId],f=cityProperties[a][ctPropName],g=cityProperties[a][ctPropNamePlus];switch(cityProperties[a][ctPropType]){case 1:var h=makeElement("a",null,{onclick:'return do_ajax("inner_page","remote/html_server.php?xw_controller=propertyV2&xw_action=craft&xw_city=1&recipe='+d[b][1]+"&building_type="+e+'", 1, 0, 0, 0); return false;'});if(h){Autoplay.fx=function(){clickAction="build item";clickContext={itemName:d[b][0],buildType:e,propCount:a};clickElement(h);DEBUG("Clicked to build "+clickContext.itemName+".")};Autoplay.start();return true}break;case 2:var m=xpathFirst('//object[@id="properties_div"]/param[@name="flashvars"]');if(m&&m.value){propValue=JSON.stringify(JSON.parse(unescape(m.value).match(/&mw_data=(\[.+\])/)[1]));if(propValue.indexOf(g)!=-1)DEBUG("propId: "+e+" - "+f+" already active.");else{var j="armory,chop_shop,private_zoo,weapons_depot,"+e,f=createAjaxPage(true);if(h=makeElement("a",null,{onclick:'return do_ajax("'+f+'","'+SCRIPT.controller+"LimitedTimeProperty"+SCRIPT.action+"saveProperties"+SCRIPT.city+"1&city=1&properties="+j+'", 1, 0, 0, 0); return false;'})){Autoplay.fx=function(){clickAction="save properties";clickContext=j;clickElement(h);DEBUG("Clicked to save "+j+".")};Autoplay.start();return true}}}f=createAjaxPage(true);if(h=makeElement("a",null,{onclick:'return do_ajax("'+f+'","'+SCRIPT.controller+"limitedTimeProperty"+SCRIPT.action+"build"+SCRIPT.city+"1&city=1&prop_id="+e+"&rec_id="+d[b][1]+'", 1, 0, 0, 0); return false;'})){Autoplay.fx=function(){clickAction="build limited";clickContext={itemName:d[b][0],buildType:e,propCount:a};clickElement(h);DEBUG("Clicked to build "+clickContext.itemName+" from "+clickContext.buildType+" = "+e+".")};Autoplay.start();return true}break;case 3:case 4:case 5:case 6:g=c+1;f=createAjaxPage(true);if(h=makeElement("a",null,{onclick:'return do_ajax("'+f+'","'+SCRIPT.controller+"propertyV2"+SCRIPT.action+"portBuyItem"+SCRIPT.city+g+"&city="+g+"&building_type="+e+"&id="+d[b][1]+'", 1, 1, 0, 0); return false;'})){Autoplay.fx=function(){clickAction="build other";clickContext={itemName:d[b][0],buildType:e,propCount:a};clickElement(h);DEBUG("Clicked to build "+clickContext.itemName+" from "+clickContext.buildType+" = "+e+".")};Autoplay.start();return true}}return false}function checkPropertyStatus(a,b){if(a){var c=a+1;mwap_do_ajax("propertyV2","createData",c,"&city="+c,b,checkPropertyCallBack)}}function autoBossFight(a){Autoplay.delay=getAutoPlayDelay();if(city!=NY){Autoplay.fx=function(){goLocation(NY)};Autoplay.start();return true}var b=xpathFirst('.//table[@class="boss_fight"]');if(b){Autoplay.delay=noDelay;if(c=xpathFirst('.//a[contains(@href,"xw_controller=bossfight") and contains(@href,"boss='+a+'")]',b)){clickElement(c);return true}if(c=xpathFirst('.//a[contains(@href,"xw_controller=job") and contains(.,"Back to Jobs")]',b)){b=c.parentNode.innerHTML;if(b.match(/(.+)<a/))b=RegExp.$1;b=b.replace(/^<br><br>/,"");b=b.replace(/<br><br>/g,"<br>");addToLog("yeah Icon",b);clickElement(c)}}else{if(!onJobTab(a)){Autoplay.fx=function(){goJobTab(a)};Autoplay.start();return true}health<maxHealth&&autoHeal();var c=xpathFirst('.//a[contains(@href,"xw_controller=bossfight") and contains(@href,"boss='+a+'")]');if(c){clickElement(c);return true}}return false}function activateCrew(a){if(!isNewCity(a))return false;var b=cities[a][CITY_ALIAS].capitalize(),c="activate"+b+"CrewTimer";if(timeLeftGM(c))return false;b="select"+b+"Crew";if(city!=a){Autoplay.fx=function(){goLocation(a)};Autoplay.start();return true}if(!onJobTab(1)){Autoplay.fx=function(){goJobTab(1)};Autoplay.start();return true}var d=0,e=xpathFirst('.//a[@id="btn_queue"]',innerPageElt);if(e){d=parseCash(e.innerHTML.untag());DEBUG("activateCrew - We have the following count for crew members:  "+d)}e=0;if(d)for(i=1;i<=8;i++){if(e>d)break;var f=b+i,g=GM_getIntValue(f,0);if(g)if(g=xpathFirst('.//a[contains(@href,"crew_type='+cityCrewTitles[g][3]+'") and contains(@href,"crew_slot='+cityCrewTitles[g][4]+'")]',innerPageElt)){DEBUG("activateCrew - Clicking Slot: "+i+" - "+GM_getValue(f,0));clickElement(g);e++}}setGMTime(c,"1 hour");return false}function autoSlotMachine(){setGMTime("autoSlotTimer","4 hours");var a;a="ajax=1&liteload=1&clicks=1"+("&sf_xw_user_id="+xw_user_id+"&sf_xw_sig="+xw_sig);ts=parseInt((new Date).getTime().toString().substring(0,10));cb=xw_user+ts;GM_xmlhttpRequest({method:"POST",url:document.location.protocol+"//facebook.mafiawars.zynga.com/mwfb/"+SCRIPT.controller+"slotmachine"+SCRIPT.action+"view"+SCRIPT.city+"&xw_person="+xw_user+"&xw_client_id=8&cb="+cb+"&tmp="+ts,data:a,headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(a){var c,d=a.responseText,a=d.indexOf("flashvars = {");if(a!=-1){c=d.indexOf("};",a);d=d.slice(a,c+2);eval(d)}}});return false}function autoSlotBonus(){if(slotBonus>=20){slotBonus=0;var a=createAjaxPage(true),b=makeElement("a",null,{onclick:'return do_ajax("'+a+'","'+SCRIPT.controller+"slotmachine"+SCRIPT.action+'award_bonus", 1, 1, 0, 0); return false;'});Autoplay.fx=function(){clickAction="collect slotbonus";clickElement(b)};Autoplay.start();return true}DEBUG("Not at the correct bonus level");return false}function autoSlotPull(){if(slotSpins>0){slotSpins--;var a=createAjaxPage(true),b=makeElement("a",null,{onclick:'return do_ajax("'+a+'","'+SCRIPT.controller+"slotmachine"+SCRIPT.action+'spin&betAmt=1&friend_id=none", 1, 1, 0, 0); return false;'});Autoplay.fx=function(){clickAction="collect slot";clickElement(b)};Autoplay.start();return true}DEBUG("No spins left on the slot machine");return false}function autoBattleCollect(){if(!onBattlePage(1)){DEBUG("NOT on Battle Collect Page - going there");goBattlePage(1)}}function autoBattle(){var a=GM_getValue("AutoBattleClanID",0);if(a>0&&!onClanNav(a)){DEBUG("Not on Clan Page - going there");goClanPage(a)}else a==0?DEBUG("No clan specified for AutoBattle"):DEBUG("We passed going to the clan page")}function goBattlePage(a){var b=makeElement("a",null,{onclick:'return do_ajax("inner_page","remote/html_server.php?xw_controller=EpicBattle&xw_action='+(a==1?"view_no_battle":"view")+'", 1, 1, 0, 0); return false;'});if(b){clickAction=a==1?"load battlecollect":"load battlepage";clickElement(b);DEBUG("Clicked to load Battle Page.")}else addToLog("warning Icon","Can't make battle link to click.")}function onBattlePage(a){a=a==1?"battle_history":"battle_target_list";if(xpathFirst('.//div[@id="'+a+'"]',innerPageElt)){DEBUG("Element :"+a+" found");return true}DEBUG("Element :"+a+" NOT FOUND");return false}function goClanPage(a){a=btoa(a);if(a=makeElement("a",null,{onclick:'return do_ajax("inner_page","remote/html_server.php?xw_controller=clan&xw_action=view&id='+a+'", 1, 1, 0, 0); return false;'})){clickAction="load clan";clickElement(a);DEBUG("Clicked to load Clan Page.")}else addToLog("warning Icon","Can't make Clan link to click.")}function onClanNav(a){if(a){if(xpathFirst('.//div[@id="clan_main"]',innerPageElt)){if($("#profile_link").length)DEBUG("On this clan page: "+$("#profile_link").text().replace(/"/g,"").trim());else{DEBUG("On the wrong clan page?");return false}return true}}else if(xpathFirst('.//div[@id="clan_main"]',innerPageElt))return true;return false}function autoFamilyProgress(a){if(!running)return 0;var b=0,c=0,d=0,e=[];if(e=xpathFirst('.//li[contains(@class, "quest_reward experience") and contains(., "Experience")]//dd',questBarElt))e=e.innerHTML.untag().replace('"',"").trim().split(/\s+/);else return 0;var f=$x('.//li[contains(@class, "box_middle") and contains(@class, "complete") and not (contains(@class, "mastered")) and contains (., "Collect")]',questBarElt);if(f){var g;a==2&&DEBUG("We have "+f.length+" complete family progressions");for(var h=0,m=f.length;h<m;++h){var j=xpathFirst('.//span[contains(@class, "_star")]',f[h]);if(j){d=j.getAttribute("class");if(/bronze/.test(d))d=parseInt(e[0]);else if(/silver/.test(d))d=parseInt(e[1]);else if(/gold/.test(d))d=parseInt(e[2]);else{DEBUG("Unknown mastery family experience level: "+d);d=0}}b=b+d;if((j=xpathFirst('.//a[contains(@href, "xw_action=collectProgress") and contains (., "Collect")]',f[h]))&&a==2&&(c==0||ptsToNextLevel<=d&&c>d||ptsToNextLevel>d&&d>c)){c=d;g=j}}if(a==2&&g&&c>0){addToLog("info Icon","Collecting Family Experience: "+c);clickElement(g);return false}}else if(a==1)return 0;if(a==1)return b}function autoCollectTake(a){isGMUndefined("collectCityAttempt")&&GM_setValue("collectCityAttempt",false);isGMUndefined("propertyNavAttempt")&&GM_setValue("propertyNavAttempt",false);if(city!=a){if(GM_getValue("collectCityAttempt",false)){a!=0&&setGMTime("takeHour"+cities[a][CITY_NAME],"1 hour");GM_setValue("collectCityAttempt",false);return false}GM_setValue("collectCityAttempt",true);Autoplay.fx=function(){goLocation(a)};Autoplay.start();return true}GM_setValue("collectCityAttempt",false);if(!onPropertyNav()){if(GM_getValue("propertyNavAttempt",false)){a!=0&&setGMTime("takeHour"+cities[a][CITY_NAME],"8 hours");GM_setValue("propertyNavAttempt",false);return false}GM_setValue("propertyNavAttempt",true);Autoplay.fx=goPropertyNav;Autoplay.start();return true}GM_setValue("propertyNavAttempt",false);var b=createAjaxPage(true),c=makeElement("a",null,{onclick:'return do_ajax("'+b+'","'+SCRIPT.controller+"propertyV2"+SCRIPT.action+"collectall"+SCRIPT.city+(a+1)+'&requesttype=json", 1, 1, 0, 0); return false;'});Autoplay.fx=function(){clickAction="collect take";clickContext=a;clickElement(c)};Autoplay.start();return true}function autoPlayerUpdates(){var a=xpath('.//div[@id="player_updates_all"]/div[@class="update_item"]',innerPageElt),b=a.snapshotLength,c=GM_getValue("logPlayerUpdatesCount");if(isUndefined(c)){c=b;GM_setValue("logPlayerUpdatesCount",c)}if(b>0&&c>b||b==0&&c>0){b>0&&c>b?DEBUG("Discrepancy in player updates; new count: "+b+", old count: "+c):DEBUG("Player updates were cleared.");c=0;GM_setValue("logPlayerUpdatesCount",0)}if(c<b){DEBUG("Parsing new player updates.");for(var d=b-c-1;d>=0;d--){if(!parsePlayerUpdates(a.snapshotItem(d)))return true;GM_setValue("logPlayerUpdatesCount",++c)}}if(b>GM_getValue("logPlayerUpdatesMax",25)&&c==b){Autoplay.fx=goDeleteNews;Autoplay.start();return true}return false}function miniPackForce(){timeLeftGM("miniPackTimer")||setGMTime("miniPackTimer","1 hour");GM_setValue("miniPackFired",true);DEBUG("Redirecting to use mini pack...");GM_xmlhttpRequest({method:"GET",url:"http://toolbar.zynga.com/game_iframe_proxy.php?playing=true",onload:function(a){a.status==200&&GM_xmlhttpRequest({method:"HEAD",url:"http://toolbar.zynga.com/click.php?to=mwgamestatsplaynow",onload:function(a){if(a.status==302)if(a=/Location: ([^\n]*)\n/.exec(response.responseHeaders)[1])document.location.href=a}})}});return false}function autoStatVars(a){for(var b=[],c="",d=[curAttack,curDefense,maxHealth,maxEnergy,maxStamina],e=[level,curAttack,curDefense,maxHealth,maxEnergy,maxStamina],f=Array(d.length),g=0,h=0,m=autoStatPrios.length,j=0,l=d.length;j<l;++j){var k=new Number(GM_getValue(autoStatRatios[j])),o=new Number(GM_getValue(autoStatBases[j])),q=new Number(GM_getValue(autoStatPrios[j])),k=Math.max(0,k*e[GM_getValue(autoStatModes[j])]+o-d[j]);if(k>0&&q<m||k>g&&q<=m){g=k;h=j;m=q}f[j]=isGMChecked(autoStatFallbacks[j])?j:""}if(g<=0&&isGMChecked("autoStatDisable")){addToLog("info Icon","All status goals met, please update your goals.");GM_setValue("autoStat",0)}if(g<=0)if(f.join("")!=""){DEBUG("Status GOALS reached, using fallback method.",10);for(e=GM_getIntValue("nextStat",ATTACK_STAT);f.indexOf(e)==-1;)e=(e+1)%d.length;h=e}else{DEBUG("Status GOALS reached, waiting till next level up.");GM_setValue("restAutoStat",1)}else{DEBUG("Next stat to increment : "+autoStatDescrips[h+1]+" ("+g+" points to goal) ");GM_setValue("restAutoStat",0)}switch(h){case ATTACK_STAT:c="attack";break;case DEFENSE_STAT:c="defense";break;case HEALTH_STAT:c="max_health";break;case ENERGY_STAT:c="max_energy";break;case STAMINA_STAT:c="max_stamina"}b[0]=c;b[1]=a>4&&(g>4||g<=0)?5:1;return b}function autoStat(){if(!onProfileNav()||isUndefined(curAttack)){Autoplay.fx=goMyProfile;Autoplay.start();return true}if(onProfileNav()){var a=xpathFirst('.//div[@class="stats_title_text"]');if(a&&a.innerHTML.untag().match(/"(.+)"\s?level\s?(\d+)/i)){GM_setValue("playerName",RegExp.$1);GM_setValue("playerLevel",RegExp.$2)}var b=[],a=xpathFirst('.//span[@id="user_skill"]'),c=0;a&&(c=parseInt(a.innerHTML));b=autoStatVars(c);DEBUG("AutoStat upgrading "+b[0]+" - "+b[1]);if(b[0]!=""&&b[1]!=0){var d=xpathFirst('.//a[contains(@onclick,"upgrade_key='+b[0]+'") and contains(@onclick,"upgrade_amt='+b[1]+'")]',innerPageElt);d||(d=xpathFirst('.//a[contains(@onclick,"upgrade_key='+b[0]+'")]',innerPageElt));if(!d){DEBUG("Couldn't find link to upgrade stat.");return false}Autoplay.fx=function(){clickAction="stats";clickElement(d);DEBUG("Clicked to upgrade: "+b[0]+" ("+b[1]+")")};Autoplay.delay=getAutoPlayDelay();Autoplay.start();return true}return false}GM_setValue("autoStat",0);colorDEBUG("BUG DETECTED: Unable to load Profile page, autostat disabled.");return false}function calcJobratio(a){var b=Math.round(missions[a][MISSION_XP]/missions[a][MISSION_ENERGY]*100)/100,b=isNaN(b)?0:b;missions[a][MISSION_RATIO]=b;GM_setValue("missions",JSON.stringify(missions));return b}function canSalvageEnergy(a){if(energy<=maxEnergy)return false;a=energy-Math.ceil(ptsToNextLevel/missions[a][MISSION_XP])*missions[a][MISSION_ENERGY]-maxEnergy;return a>0?a:false}function canSalvageStamina(a){if(stamina<=maxStamina)return false;a=stamina-Math.ceil(ptsToNextLevel/missions[a][MISSION_XP])*missions[a][MISSION_ENERGY]-maxStamina;return a>0?a:false}function canMission(){function a(a){c=0;for(p=a.length;c<p;++c){d=a[c];var b=missions[d],h=energy,j=0;if(b[MISSION_EOL]==0||b[MISSION_EOL]==3){h=stamina;j=1}var k=b[MISSION_TAB];isNewCity(b[MISSION_CITY])&&b[MISSION_TABPATH]&&(k=b[MISSION_TABPATH]);if(b){var m=false;if(!(e[b[MISSION_CITY]][k]!=null&&e[b[MISSION_CITY]][k].indexOf(parseInt(d))==-1)){if(isNaN(b[MISSION_RATIO])||!b[MISSION_RATIO])b[MISSION_RATIO]=calcJobratio(d);if(b[MISSION_ENERGY]<=h){q=true;if(b[MISSION_XP]>=g){o.push([d,b[MISSION_ENERGY],b[MISSION_XP]]);m=true}}if(isGMChecked("repeatJob")||!(f[b[MISSION_CITY]][k]!=null&&f[b[MISSION_CITY]][k].indexOf(parseInt(d))!=-1&&m==false)){j&&(!s&&canSalvageStamina(d)?s=true:!s&&canSalvageEnergy(d)&&(s=true));l.push(d)}}}}}if(!energy||!isGMChecked("autoMission"))return false;var b=GM_getValue("selectMission",1),c,d;if(getSavedList("jobsToDo").length==0){var e=eval("("+GM_getValue("availableJobs","({0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{}})")+")"),f=eval("("+GM_getValue("masteredJobs","({0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{}})")+")"),g=ptsToNextLevel,h=Math.ceil(g/energy*100)/100,m=Math.ceil(g/stamina*100)/100,j=getSavedList("selectMissionMultiple"),l=[],k=[],o=[],q=false,s=false,r=getSavedList("masteryJobsList");c=0;for(p=r.length;c<p;++c){d=r[c];j.indexOf(d)==-1&&j.push(d)}a(j);if(!q)if(isGMChecked("endLevelOptimize")&&h<=2.2){j=[];c=0;for(p=missions.length;c<p;++c){r=true;isGMChecked("endLevelNYOnly")&&missions[c][MISSION_CITY]!=NY&&(r=false);missions[c][MISSION_EOL]==1&&missions[c][MISSION_RATIO]>=h&&missions[c][MISSION_ENERGY]<energy&&r&&j.push(c)}a(j);if(!q)return false}else if(isGMChecked("endLevelOptimize")&&m<=2.2&&!isGMChecked("staminaSpend")){j=[];c=0;for(p=missions.length;c<p;++c){r=true;isGMChecked("endLevelNYOnly")&&missions[c][MISSION_CITY]!=NY&&(r=false);missions[c][MISSION_EOL]==0&&missions[c][MISSION_RATIO]>=m&&missions[c][MISSION_ENERGY]<stamina&&r&&j.push(c)}a(j);if(!q)return false}else return false;j=void 0;l.sort(function(a,b){return missions[b][MISSION_RATIO]-missions[a][MISSION_RATIO]});if(o.length>0&&!s){o.sort(function(a,b){return b[2]-a[2]});j=o[0][0];if(isGMChecked("endLevelOptimize")){h=isGMChecked("endLevelNYOnly")?function(a,b,c){return b>6&&b<o[0][0]&&(c[b][MISSION_EOL]==1||c[b][MISSION_EOL]==2)&&c[b][MISSION_CITY]==NY&&c[b][MISSION_ENERGY]<o[0][1]*0.5?1:0}:function(a,b,c){return b>6&&b<o[0][0]&&(c[b][MISSION_EOL]==1||c[b][MISSION_EOL]==2)&&c[b][MISSION_ENERGY]<o[0][1]*0.5?1:0};h=missions.filter(h);h.sort(function(a,b){return b[MISSION_XP]-a[MISSION_XP]});c=0;for(var p=h.length;c<p;++c){m=h[c];if(energy-o[0][1]>m[1]&&g>=Math.floor(m[5])*1.5+1){j=missions.searchArray(m[0],0)[0];break}}}}else{for(c=0;c<l.length;c++)missions[l[c]][MISSION_EOL]==0||missions[l[c]]==3?stamina>=missions[l[c]][MISSION_ENERGY]&&m<=missions[l[c]][MISSION_RATIO]&&k.push(l[c]):energy>=missions[l[c]][MISSION_ENERGY]&&h<=missions[l[c]][MISSION_RATIO]&&k.push(l[c]);if(k.length==0){if(l.length){j=l[0];if(missions[j][MISSION_TABPATH]==1||missions[j][MISSION_EOL]==3){c=0;for(p=l.length;c<p;c++){newJob=l[c];if(missions[newJob][MISSION_TABPATH]!=1&&energy>missions[newJob][MISSION_ENERGY]){j=newJob;break}}}if(missions[j][MISSION_TABPATH]!=1){c=0;for(p=l.length;c<p;c++){newJob=l[c];if(missions[newJob][MISSION_TABPATH]==1&&stamina>missions[newJob][MISSION_ENERGY]){j=newJob;break}}}}}else j=s?k[0]:k[k.length-1]}if(b!=j){if(isUndefined(j)){DEBUG("canMission : currently no jobs available");return false}addToLog("info Icon",'Switching job to <span class="job">'+missions[j][MISSION_NAME]+"</span>. (canMission)");GM_setValue("selectMission",j);b=j}}if(missions[b][MISSION_EOL]==0||missions[b][MISSION_EOL]==3){if(stamina<missions[b][MISSION_ENERGY]){DEBUG("Skipping jobs: stamina="+stamina+", cost="+missions[b][MISSION_ENERGY]);return false}b=missions[b][MISSION_ENERGY];if(stamina-b<SpendStamina.floor&&!SpendStamina.canBurn){DEBUG("Not spending Job Stamina: Stamina="+stamina+", floor="+SpendStamina.floor+", nextJobStamina="+b+", burn="+SpendStamina.canBurn);return false}if(stamina<SpendStamina.ceiling&&!SpendStamina.canBurn&&!GM_getValue("useStaminaStarted")){DEBUG("Rebuilding energy: Stamina="+stamina+", ceiling="+SpendStamina.ceiling+", burn="+SpendStamina.canBurn);return false}}else{if(energy<missions[b][MISSION_ENERGY]){DEBUG("Skipping jobs: energy="+energy+", cost="+missions[b][MISSION_ENERGY]);return false}b=missions[b][MISSION_ENERGY];if(energy-b<SpendEnergy.floor&&!SpendEnergy.canBurn){DEBUG("Not spending Job energy: energy="+energy+", floor="+SpendEnergy.floor+", nextJobEnergy="+b+", burn="+SpendEnergy.canBurn);return false}if(energy<SpendEnergy.ceiling&&!SpendEnergy.canBurn&&!GM_getValue("useEnergyStarted")){DEBUG("Rebuilding energy: energy="+energy+", ceiling="+SpendEnergy.ceiling+", burn="+SpendEnergy.canBurn);return false}}return true}function autoMission(){Autoplay.delay=getAutoPlayDelay();jobid=GM_getValue("selectMission",1);var a=missions[jobid][MISSION_NAME],b=missions[jobid][MISSION_NUMBER],c=missions[jobid][MISSION_TAB],d=missions[jobid][MISSION_CITY],e=missions[jobid][MISSION_TABPATH]?missions[jobid][MISSION_TABPATH]:0;if(SpendEnergy.floor&&isGMChecked("allowEnergyToLevelUp")&&GM_getValue("autoEnergyBurn")!==SpendEnergy.canBurn){GM_setValue("autoEnergyBurn",SpendEnergy.canBurn);SpendEnergy.canBurn?addToLog("process Icon",energyIcon+'<span style="color:#009966; font-weight: bold;">Burning through energy reserve to level up.</span>'):DEBUG("Not within reach of a level up. Energy burning is off.")}if(city!=d){Autoplay.fx=function(){goLocation(d)};Autoplay.start();return true}var f=c;isNewCity(city)&&e&&(f=e);if(!onJobTab(f)){Autoplay.fx=function(){goJobTab(f)};Autoplay.start();return true}if(city==LV&&!onJobTabpath(e)){Autoplay.fx=function(){goJobTabPath(e)};Autoplay.start();return true}if(getJobRowItems(a)){DEBUG(" - - need items jobid="+jobid+" selectMission="+GM_getValue("selectMission",1));if(jobid!=GM_getValue("selectMission",1))Autoplay.fx=autoMission;Autoplay.start()}else{colorDEBUG("autoMission - City: "+cities[d][CITY_NAME]+" ("+missionTabs[d][c-1]+") - job :"+a+" (jobNo: "+b+")");Autoplay.fx=function(){if(!goJob(b)){addToLog("warning Icon",'Unable to perform <span class="job">'+a+"</span>.");if(getSavedList("jobsToDo","").length==0){DEBUG("No more jobs to perform.");skipJobs=true;goHome()}else{DEBUG("Looking for the next job to perform.");popJob()}}};Autoplay.start();return true}}function getCurrentBrazilDistrict(){currentBrazilDistrict=0;var a=xpathFirst('.//div[@id="brazil_jobs"]//div[@class="jobs" and not(contains(@style,"none"))]',innerPageElt);a||(a=xpathFirst('.//div[@id="brazil_jobs"]//div[contains(@id,"job-id") and not(contains(@style,"none"))]',innerPageElt));if(a){a=a.parentNode;a.hasAttribute("district_id")&&(currentBrazilDistrict=a.getAttribute("district_id"))}if(!currentBrazilDistrict)(a=xpathFirst('.//div[@id="brazil_jobs"]/div[@class="districts"]',innerPageElt))&&a.hasAttribute("style")&&a.getAttribute("style").match(/: -?(\d+)px/)&&RegExp.$2&&(currentBrazilDistrict=parseInt(RegExp.$1/54+1));return currentBrazilDistrict}function currentJobTab(){if(isNewCity(city))return parseInt(getCurrentBrazilDistrict());var a=xpathFirst('.//li[contains(@class, "tab_on")]//a',innerPageElt);return a&&a.getAttribute("onclick").match(/tab=(\d+)/)?parseInt(RegExp.$1):-1}function currentJobTabPath(){var a=xpathFirst('.//div[@id="job_paths"]//div[contains(@class, "path_on")]',innerPageElt);return a&&a.id.match(/(\d+)/)?RegExp.$1:-1}function onJobTab(a){return currentJobTab()==parseInt(a)?true:false}function onJobTabpath(a){return currentJobTabPath()==parseInt(a)?true:false}function canHeal(){if(unsafeWindow.User.stamina)stamina=unsafeWindow.User.stamina;if(unsafeWindow.User.health)health=unsafeWindow.User.health;if(!running||!isGMChecked("autoHeal")||health>=GM_getValue("healthLevel",0)||stamina<=GM_getValue("stamina_min_heal"))return false;switch(GM_getValue("staminaSpendHow")){case STAMINA_HOW_ROBFIGHT:if(stamina>GM_getValue("robFightStaminaFloor")){DEBUG(" STAMINA_HOW_ROBFIGHT - blocked autoheal because you are above the RobFight stamina level.");return false}}if(!isGMChecked("hideInHospital"))return true;if(health>19&&isGMChecked("forceHealOpt7")){DEBUG("heal if above 19 is checked, and true, in canforceheal ");return true}if(SpendStamina.canBurn&&stamina>0&&isGMChecked("allowStaminaToLevelUp")){DEBUG("enough stamina left to level up, and burn to level up, checked in canforceheal ");return true}if(isGMChecked("forceHealOpt5")&&GM_getValue("healWaitStarted")&&timeLeftGM("healWaitTime")){DEBUG(" healing blocked "+GM_getValue("healWaitStarted")+" due to 5 minute wait timer. remaining:"+timeLeftGM("healWaitTime"));return false}if(isGMChecked("forceHealOpt5")){DEBUG("5 minute timer is up, Allowing Heal");GM_setValue("healWaitStarted",false);return true}return isGMChecked("forceHealOpt4")&&stamina>=maxStamina||isGMChecked("forceHealOpt3")&&canSpendStamina(0)?true:false}function canSpendStamina(a){if(unsafeWindow.User.stamina)stamina=unsafeWindow.User.stamina;if(unsafeWindow.User.health)health=unsafeWindow.User.health;if(!stamina||!isGMChecked("staminaSpend"))return false;if(stamina<5&&isNewCity(GM_getValue("fightLocation",NY))){DEBUG("Not spending stamina: stamina = "+stamina+", fight city = "+cities[GM_getValue("fightLocation",NY)][CITY_NAME]);return false}isNaN(a)&&(a=isGMChecked("attackCritical")?21:29);var b=getStaminaMode();switch(b){case STAMINA_HOW_AUTOHITLIST:case STAMINA_HOW_ROBBING:a=0;break;case STAMINA_HOW_FIGHTROB:stamina>25&&(a=0);break;case STAMINA_HOW_ROBFIGHT:stamina>GM_getValue("robFightStaminaFloor")&&(a=0)}if(health<a){DEBUG("Not spending stamina: health="+health+", minimum="+a);return false}if(stamina<=SpendStamina.floor&&!SpendStamina.canBurn){DEBUG("Not spending stamina: stamina="+stamina+", floor="+SpendStamina.floor+", burn="+SpendStamina.canBurn);return false}if(stamina<SpendStamina.ceiling&&!SpendStamina.canBurn&&!GM_getValue("useStaminaStarted")){DEBUG("Rebuilding stamina: stamina="+stamina+", ceiling="+SpendStamina.ceiling+", burn="+SpendStamina.canBurn);return false}if(GM_getValue("staminaSpendHow")!=STAMINA_HOW_RANDOM&&(b==STAMINA_HOW_ROBBING||b==STAMINA_HOW_FIGHTROB))return stamina>=25;if((b==STAMINA_HOW_ROBBING||b==STAMINA_HOW_FIGHTROB)&&!(stamina>=25)){randomizeStamina();return canSpendStamina()}return true}function autoHitlist(){var a=GM_getValue("autoHitListLoc",NY);if(a<=cities.length-1&&city!=a){Autoplay.fx=function(){goLocation(a)};Autoplay.delay=getAutoPlayDelay();Autoplay.start();return true}if(!onFightTab()&&!autoHitlist.profileSearch&&!autoHitlist.setBounty){Autoplay.fx=goFightTab;Autoplay.start();return true}var b=GM_getIntValue("pautoHitOpponentList","");if(!b){if(isGMEqual("staminaSpendHow",STAMINA_HOW_RANDOM))return false;addToLog("warning Icon","Can't autohit because the list of opponents is empty or invalid. Turning automatic hitlisting off.");GM_setValue("staminaSpend",0);isGMChecked("bgAutoHitCheck")&&GM_setValue("bgAutoHitCheck",0);return false}opponent=new Player;opponent.id=""+b;if(!onProfileNav()&&!autoHitlist.setBounty){autoHitlist.profileSearch=opponent;Autoplay.fx=function(){goProfileNav(opponent)};Autoplay.start();return true}if(autoHitlist.profileSearch&&onProfileNav()){opponent=autoHitlist.profileSearch;autoHitlist.profileSearch=void 0;opponent.profileHitlist=xpathFirst('.//a[contains(., "Add to Hitlist")]',innerPageElt);DEBUG("Hitlisting from profile");autoHitlist.setBounty=true;var c=xpathFirst('.//a[contains(., "Add to Hitlist")]',innerPageElt);if(c){Autoplay.fx=function(){clickAction="autohit";clickContext=opponent;clickElement(c);DEBUG('Clicked "Add to Hitlist".')};Autoplay.start();return true}}b=parseCash(GM_getValue("autoHitListBounty",0))-cities[NY][CITY_CASH];if(b>0){DEBUG("We need "+b+" for hitlisting. Going to the bank of "+cities[NY][CITY_NAME]);suspendBank=true;return autoBankWithdraw(b)}if(autoHitlist.setBounty){autoHitlist.setBounty=void 0;var b=xpathFirst('.//form[@id="createhit"]',innerPageElt),d=xpathFirst('.//input[@type="text"]',b);if(!d){isGMChecked("bgAutoHitCheck")&&setGMTime("bgAutoHitTime","01:00");return true}d.value=isGMChecked("autoHitListRandom")?Math.pow(10,Math.floor(Math.random()*4)+4):parseCash(GM_getValue("autoHitListBounty",0));var e=xpathFirst('.//button[@type="submit"]',b);if(!e){isGMChecked("bgAutoHitCheck")&&setGMTime("bgAutoHitTime","01:00");return true}Autoplay.fx=function(){clickAction="autohit";clickContext=opponent;e.click();DEBUG("Clicked to Set Bounty")};Autoplay.start();return true}}function autoFight(a){Autoplay.delay=noDelay;var b=GM_getValue("fightLocation",NY);b==RANDOM_CITY&&(b=GM_getValue("fightNewLocation",NY));if(b!=ACTIVE_CITY&&city!=b){Autoplay.fx=function(){goLocation(b)};Autoplay.start();return true}if(!onFightTab()&&!autoFight.profileSearch&&a!=STAMINA_HOW_BATTLE){Autoplay.fx=goFightTab;Autoplay.start();return true}if(a!=STAMINA_HOW_FIGHT_LIST){if(a==STAMINA_HOW_BATTLE&&!onBattlePage(2)){Autoplay.fx=goBattlePage(2);Autoplay.start();return true}if(a==STAMINA_HOW_BATTLE&&xpathFirst('//a[contains(@href,"xw_controller=epicBattle") and contains(@href,"xw_action=optIn")]',innerPageElt)){elt=xpathFirst('//a[contains(@href,"xw_controller=epicBattle") and contains(@href,"xw_action=optIn")]',innerPageElt);clickElement(elt);Autoplay.start();return true}var c=GM_getValue("fightRivalsMode",0);if(onFightersTab()&&!autoFight.profileSearch&&c&&a!=STAMINA_HOW_BATTLE){Autoplay.fx=goRivalsTab;Autoplay.start();return true}if(onRivalsTab()&&!autoFight.profileSearch&&!c&&a!=STAMINA_HOW_BATTLE){Autoplay.fx=goFightersTab;Autoplay.start();return true}}var d;if(autoFight.revengeTarget){colorDEBUG("autoFight - We already have a target : revengeTarget");d=autoFight.revengeTarget;lastOpponent=autoFight.revengeTarget=void 0}else if(autoFight.profileSearch&&onProfileNav()){d=autoFight.profileSearch;if(xpathFirst('.//a[contains(., "Remove from Mafia")]',innerPageElt)){removeSavedListItem("pfightlist",d.id);lastOpponent=autoFight.profileSearch=void 0;return false}lastOpponent=autoFight.profileSearch=void 0;if(isGMChecked("staminaPowerattack")&&(isGMChecked("stopPA")&&health>=GM_getValue("stopPAHealth")||!isGMChecked("stopPA")))d.profileAttack=xpathFirst('.//a[(contains(@onclick,"xw_action=power_attack") or contains(@href,"xw_action=power_attack")) and contains(., "Power Attack")]',innerPageElt);if(!d.profileAttack)d.profileAttack=xpathFirst('.//a[(contains(@onclick,"xw_action=attack") or contains(@href,"xw_action=attack")) and contains(., "Attack")]',innerPageElt);if((a=xpathFirst('//div[@class="stats_title_text"]'))&&a.innerHTML.match(/[^"]"(.+)" level (\d+)/)){d.name=RegExp.$1;d.level=RegExp.$2}d.mafia="unknown"}else if(a==STAMINA_HOW_FIGHT_LIST){id=parseInt(GM_getValue("pfightlist",""));if(!id){if(isGMEqual("staminaSpendHow",STAMINA_HOW_RANDOM))return false;addToLog("warning Icon","Can't fight because the list of opponents is empty or invalid. Turning automatic fighting off.");GM_setValue("staminaSpend",0);return false}d=new Player;d.id=""+id;a=GM_getValue("profileList","");a=IsJsonString(a)?JSON.parse(a):[];c=a.searchArray(d.id,0)[0];if(!isNaN(c))d.profileAttack=makeElement("a",null,{href:a[c][1]})}else{d=findFightOpponent(innerPageElt,a);if(d===-1){DEBUG("No opponents even after seeing the fight list.");setNextFightCity();return false}}if(!d)return false;a=d.profileAttack;if(!a&&d.attack)a=d.attack;if(lastOpponent&&lastOpponent.attackAgain&&d.match(lastOpponent))a=lastOpponent.attackAgain;if(!a){if(d.id&&!onProfileNav()){autoFight.profileSearch=d;Autoplay.fx=function(){goProfileNav(d)};Autoplay.start();return true}DEBUG("No way to attack opponent, id="+d.id);return false}if(a.hasAttribute("href")){c=a.getAttribute("href");c=c.replace(/attack_pop/,"attack_true_pop");if(c!="javascript://"){var e=makeElement("a",null,null);e.setAttribute("onclick","do_ajax('inner_page','"+c+"',1);return false;");e.innerHTML=a.innerHTML}}else e=a;Autoplay.fx=function(){clickAction=isNewCity(city)||e.innerHTML.match(/(\d+)/i)?"multifight":"fight";clickContext=d;clickElement(e);isGMChecked("staminaLogDetails")&&addToLog("process Icon","Clicked to "+clickAction+" : name="+d.name+", level="+d.level+", mafia="+d.mafia+", badge: "+d.fightlabel)};Autoplay.delay=noDelay;Autoplay.start();return true}function setNextFightCity(){if(GM_getValue("fightLocation",NY)==RANDOM_CITY){var a;do a=Math.floor(Math.random()*(cities.length-1));while(a==1||level<cities[a][CITY_LEVEL]||isGMEqual("fightNewLocation",a));DEBUG("Changing to "+cities[a][CITY_NAME]+" for next fight.");GM_setValue("fightNewLocation",a)}}function autoRob(){var a=GM_getValue("robLocation",NY),b=1750-GM_getIntValue("fastRobSpeed",0)*250;1!=parseXMLResponse()&&(b=robspeed*2);Autoplay.delay=noDelay;if(city!=a){Autoplay.fx=function(){goLocation(a)};Autoplay.start();return true}if(!onRobbingTab()){Autoplay.fx=goRobbingTab;Autoplay.start();return true}var c=xpathFirst('//a[@class="sexy_button_new short white" and contains(., "Ask for More") and not(contains(@style, "none"))]');c||(c=xpathFirst('//a[@class="rob_post_phone_button sexy_button_new short white" and contains(., "Ask") and not(contains(@style, "none"))]'));c&&clickElement(c);if(needToRefresh()){Autoplay.fx=refreshRobbingGrid;Autoplay.start();return true}c=true;if(isGMChecked("useRobSquads")){var d=xpathFirst('.//div[@class="rob_counter_spree"]//span[@id="call_sprees_left"]'),e=0;d&&(e=parseInt(d.innerHTML.untag()));if(e>0){DEBUG(" Currently : "+e+" Rob Squads available");var f=xpathFirst('.//a[@id="oneClickRobAll" and contains(@onclick,"RobbingController.robAllHelper")]');eltRobButtonInner=f.innerHTML.untag();eltRobButtonInner.match(/(\d+)/)&&(stamReqRobSquad=parseInt(RegExp.$1))}if(e>0&&stamReqRobSquad<stamina){c=false;Autoplay.fx=function(){DEBUG(" clicked to use Rob Squad");clickAction="autoRob";clickContext={elt:f.id,name:"RobSquads"};clickElement(f)}}}if(c)Autoplay.fx=function(){var a,c=getCurRobButton(),d=getCurRobSlotId(c);xpathFirst('.//div[@id="'+d+'" and @class="rob_slot"]');var e=xpathFirst('.//div[@id="'+d+'" and @class="rob_slot"]//div[@class="rob_prop_name_short"]');if(e)a=e.innerHTML;clickAction="autoRob";clickContext={elt:d,name:a};doRob(c,b)};Autoplay.start();return true}function onRobbingTab(){return xpathFirst('.//li[contains(@class, "tab_on")]//a[contains(., "Robbing")]')?true:false}function goRobbingTab(){var a=xpathFirst('.//div[@class="tab_content"]//a[contains(., "Robbing")]');a?clickElement(a):goFightNav()}function needToRefresh(){var a=$x('.//div[@class="rob_btn"]//a[@class="sexy_button_new sexy_button_new short red impulse_buy"]'),b=xpathFirst('.//a[@id="rob_refresh_cost"]//span[contains(.,"0 stamina")]');b||(b=xpathFirst('.//a[@id="rob_refresh_cost"]//span[contains(.,"Refresh: 0")]'));return b&&a.length==0?true:false}function refreshRobbingGrid(){var a=xpathFirst('.//a[@id="rob_refresh_cost"]//span[contains(.,"0 stamina")]');a||(a=xpathFirst('.//a[@id="rob_refresh_cost"]//span[contains(.,"Refresh: 0")]'));a&&clickElement(a)}function doRob(a,b){function c(){if(f.length>0){var a=f.shift();clickElement(a)}else window.clearInterval(g)}useBurnersFirst=false;var d=xpathFirst('.//span[@id="call_backup_phones_left"]',innerPageElt);if(d)var e=parseInt(d.innerHTML.untag());if(e&&isGMChecked("useBurners")){DEBUG("doRob : you still have "+e+" burners ... using these first");useBurnersFirst=true}if(isGMChecked("fastRob")&&!useBurnersFirst){var f=$x('.//div[@class="rob_btn"]//a[@class="sexy_button_new sexy_button_new short red impulse_buy"]');if(f&&f.length!=0){DEBUG("Starting fastRob: Clicking "+f.length+" rob buttons at "+b+" interval");var g=window.setInterval(c,b)}}else{a||(a=xpathFirst('//div[@class="rob_btn"]//a[@class="sexy_button_new sexy_button_new short red impulse_buy"]'));if(a){var h;if((d=xpathFirst('./div[@class="rob_prop_stamina"]',a.parentNode.parentNode))&&(h=/(.*)/.exec(d.innerHTML)))GM_setValue("totalRobStamInt",isNaN(GM_getIntValue("totalRobStamInt",0))?0:GM_getIntValue("totalRobStamInt",0)+parseInt(h[1].replace(/[\D]/g,"")));clickElement(a);DEBUG("Clicked to rob.")}}}function getCurRobButton(){if(isGMChecked("useBurners")){var a=$x('//a[@class="sexy_button_new short white" and contains(., "Call For Backup") and not(contains(@style, "none"))]'),b=xpathFirst('.//div[@class="rob_board"]');if(a&&a.length>0){i=0;for(iLength=a.length;i<iLength;i++){var c=a[i],d=getCurRobSlotId(c),e=d.replace(/[^0-9]/g,"");xpathFirst('./div[@id="'+d+'"]');d="rob_flag_"+e;if(c&&!xpathFirst('./div[@id="'+d+'"]',b)){setListenContent(false);makeElement("div",b,{id:d,style:"display: none;"});setListenContent(true);return c}}}}if(eltRob=xpathFirst('//div[@class="rob_btn"]//a[@class="sexy_button_new sexy_button_new short red impulse_buy"]')){DEBUG("Clicking 'Rob'-button.");return eltRob}}function getCurRobSlotId(a){return a.innerHTML.untag()=="Rob"?a.parentNode.parentNode.parentNode.id:a.innerHTML.untag()!="Rob"?a.parentNode.parentNode.parentNode.parentNode.id:null}function logRobResponse(a,b,c){var b=c.name,d,a=false;if(c=xpathFirst('//div[@id="'+c.elt+'" and @class="rob_slot"]')){var e="",f=false,g=xpathFirst('.//div[@class="rob_res_target_name"]/a[contains(@href,"xw_controller=clan")]',c);g&&(e=e+linkToString(g,"user"));if(g=xpathFirst('.//div[@class="rob_res_target_name"]/a[contains(@href,"xw_controller=stats")]',c))e=e+linkToString(g,"user");else e=(g=xpathFirst('.//div[@class="rob_res_target_pic"]//a//img',c))?'<span class="user">'+g.title+"</span>":'<span class="user">Unknown Target</span>';var h=xpathFirst('.//div[@class="rob_res_expanded_details_exp"]',c),g=xpathFirst('.//div[@class="rob_res_expanded_details_cash"]',c),m=xpathFirst('.//div[@class="rob_res_expanded_details_energy"]',c),j=xpathFirst('.//div[@class="rob_res_expanded_details_stamina"]',c),l=xpathFirst('.//div[@class="rob_res_expanded_details_item"]',c),e="Robbed "+e,e=b?e+('\'s <span class="property">'+b+"</span> "):e+" ";if(xpathFirst('.//div[@class="rob_res_outcome good"]',c)){e=e+' with <span class="good">Success</span> gaining ';f=true;g&&(e=e+(' <span class="good">'+g.innerHTML+"</span>"));l&&(e=e+(' <span class="loot">'+l.innerHTML+"</span>"));m&&(e=e+(' and <span class="user">'+m.innerHTML+"</span>"));j&&(e=e+(' and <span class="bad">'+j.innerHTML+"</span>"));h&&(e=e+" and ");b="yeah Icon"}else{e=e+' and <span class="bad">Failed</span>, gaining ';b="updateBad Icon"}if(h){e=e+('<span class="good">'+h.innerHTML+"</span>");if(d=/(\d+) experience/i.exec(h.innerHTML)){updateRobStatistics(f,parseInt(d[1].replace(/[\D]/g,"")));a=true}}addToLog(b,e+".");c&&(d=/alt="(.*?)"/.exec(c.innerHTML))&&addToLog("lootbag Icon",'Found <span class="loot">'+d[1]+"</span> in robbing.");if(g&&g.innerHTML){d=parseCash(g.innerHTML);a=parseCashLoc(g.innerHTML);GM_setValue("totalWinDollarsInt",""+(GM_getIntValue("totalWinDollarsInt",0)+d));GM_setValue(cityStats[a][cashWins],""+(GM_getIntValue(cityStats[a][cashWins],0)+d));a=true}}randomizeStamina();a&&!isGMChecked("noStats")&&updateLogStats()}function updateFastRobStatistics(a,b){a?GM_setValue("robSuccessCountInt",""+(GM_getIntValue("robSuccessCountInt",0)+b)):a==false&&GM_setValue("robFailedCountInt",""+(GM_getIntValue("robFailedCountInt",0)+b))}function updateRobStatistics(a,b){a?GM_setValue("robSuccessCountInt",""+(GM_getIntValue("robSuccessCountInt",0)+1)):a==false&&GM_setValue("robFailedCountInt",""+(GM_getIntValue("robFailedCountInt",0)+1));if(b){GM_setValue("totalRobExpInt",""+(GM_getIntValue("totalRobExpInt",0)+parseInt(b)));GM_setValue("totalExpInt",""+(GM_getIntValue("totalExpInt",0)+parseInt(b)))}}function autoHitman(){Autoplay.delay=noDelay;var a,b=GM_getValue("hitmanLocation",NY);if(b<=cities.length-1&&city!=b){Autoplay.fx=function(){goLocation(b)};Autoplay.start();return true}if(!onHitlistTab()){Autoplay.fx=goHitlistTab;Autoplay.start();return true}opponentsQualified=findFightOpponent(innerPageElt,STAMINA_HOW_HITMAN);if(!opponentsQualified.length)return false;var c=0;switch(GM_getValue("bountySelection",BOUNTY_HIGHEST_BOUNTY)){case BOUNTY_LONGEST_TIME:c=opponentsQualified.length-1;break;case BOUNTY_HIGHEST_BOUNTY:var d=0;a=0;for(iLength=opponentsQualified.length;a<iLength;a++)if(parseCash(opponentsQualified[a].bounty)>d){c=a;d=parseCash(opponentsQualified[a].bounty)}break;case BOUNTY_RANDOM:c=Math.floor(Math.random()*opponentsQualified.length);break;default:c=0}Autoplay.fx=function(){clickAction="hitman";clickContext=opponentsQualified[c];clickElement(clickContext.attack);DEBUG("Clicked to hit "+clickContext.name+" ("+clickContext.id+").")};Autoplay.start();return true}function getStaminaMode(){var a=GM_getValue("staminaSpendHow");if(a==STAMINA_HOW_RANDOM){isUndefined(newStaminaMode)&&(newStaminaMode=Math.floor(Math.random()*(staminaSpendChoices.length-1)));a=newStaminaMode}else newStaminaMode=void 0;return parseInt(a)}function autoStaminaSpend(){if(!isGMChecked("staminaSpend")){DEBUG("staminaSpend DISABLED - returning false",10);return false}if(stamina<5){var a=GM_getValue("fightLocation",NY);a==RANDOM_CITY&&(a=GM_getValue("fightNewLocation",NY));if(isNewCity(a)){DEBUG("staminaSpend DISABLED: stamina="+stamina+", city="+cities[BRAZIL][CITY_NAME],10);return false}}if(SpendStamina.floor&&isGMChecked("allowStaminaToLevelUp")&&GM_getValue("autoStamBurn")!==SpendStamina.canBurn){GM_setValue("autoStamBurn",SpendStamina.canBurn);if(SpendStamina.canBurn){addToLog("process Icon",staminaIcon+'<span style="color:#009966; font-weight: bold;">Burning through stamina reserve to level up.</span>');autoHeal(2)}else DEBUG("Not within reach of a level up. Stamina burning is off.",10)}a=getStaminaMode();switch(a){case STAMINA_HOW_FIGHT_RANDOM:case STAMINA_HOW_FIGHT_LIST:inClanBattle&&isGMChecked("AutoBattleFight")&&(a=STAMINA_HOW_BATTLE);return autoFight(a);case STAMINA_HOW_FIGHTROB:if(health<21&&stamina>25)return autoRob();inClanBattle&&isGMChecked("AutoBattleFight")&&(a=STAMINA_HOW_BATTLE);return autoFight(a);case STAMINA_HOW_ROBFIGHT:if(stamina>GM_getValue("robFightStaminaFloor"))return autoRob();inClanBattle&&isGMChecked("AutoBattleFight")&&(a=STAMINA_HOW_BATTLE);return autoFight(a);case STAMINA_HOW_ROBBING:return autoRob();case STAMINA_HOW_HITMAN:return autoHitman(a);case STAMINA_HOW_AUTOHITLIST:return autoHitlist();default:colorDEBUG("BUG DETECTED: Unrecognized stamina setting: staminaSpendHow="+a,cre)}return false}function autoBankDeposit(a,b){if(!quickBankFail||!b||b<10)return false;if(a==LV)return quickBankFail=false;var c=xpathFirst('.//div[@id="bank_popup"]',popupfodderElt);if(!c||c.parentNode.style.display=="none"){Autoplay.fx=goBank;Autoplay.start();return true}if(b){var d=xpathFirst('.//input[@id="deposit_amount"]',c);if(!d){DEBUG("BUG DETECTED: No text input at bank.");return false}d.value=b}var e=xpathFirst('.//div[@id="bank_dep_button"]/a[contains(@onclick,"deposit(")]',c);if(!e){DEBUG("BUG DETECTED: No submit input at bank.");return false}if(city!=a){DEBUG("Switching city too fast, not banking cash.");return false}Autoplay.fx=function(){clickContext=a;clickAction="deposit";clickElement(e);DEBUG("Clicked to deposit.")};Autoplay.start();return true}function autoBankWithdraw(a){if(city==LV){var a="xw_controller=propertyV2&xw_action=doaction&xw_city=5&doaction=ActionBankWithdrawal&building_type=6&city=5&amount="+a,b=createAjaxPage(false,"quick withdraw",LV),a=makeElement("a",null,{onclick:'return do_ajax("'+b+'","remote/html_server.php?'+a+'", 1, 1, 0, 0); return false;'});clickElement(a);DEBUG("Clicked to withdraw from the vault.");return true}b=xpathFirst('.//div[@id="bank_popup"]');if(!b||b.parentNode.style.display=="none"){Autoplay.fx=goBank;clickAction="withdraw";clickContext=a;Autoplay.start();return true}if(a){var c=xpathFirst('.//input[@id="withdraw_amount"]',b);if(!c){DEBUG("BUG DETECTED: No text input at bank.");return false}c.value=a}var d=xpathFirst('.//div[@id="bank_with_button"]//a',b);if(!d)return false;Autoplay.fx=function(){clickAction="withdraw";clickElement(d);DEBUG("autoBankWithdraw: Clicked to withdraw.")};Autoplay.delay=getAutoPlayDelay();Autoplay.start();return true}function getDisplayedOpponents(a,b,c,d){getDisplayedOpponents.opponents=[];var e,f;if(running&&(c==STAMINA_HOW_RANDOM||c==STAMINA_HOW_FIGHT_RANDOM||c==STAMINA_HOW_FIGHT_BG||c==STAMINA_HOW_ROBFIGHT||c==STAMINA_HOW_FIGHTROB))if(GM_getValue("fightRivalsMode",0)&&(!d||d==0)){c=true;d=fightRivalsModes[GM_getValue("fightRivalsMode",0)];f=$x('.//table[@class="main_table fight_table"]//tr',a);for(b=0;b<f.length;b++){rowElt=f[b];if(e=xpathFirst(".//th",rowElt))c=e.innerHTML.indexOf(d)!=-1?false:true;else if(c){rowEltContent=rowElt.innerHTML.untag();rowElt.parentNode.removeChild(rowElt)}}}c=$x('.//table[@class="main_table fight_table"]//a[(contains(@href,"opponent_id") or contains(@href, "NPC_id")) and not(contains(@href,"challengePop"))]',a);if(!c||c.length==0)c=$x('.//div[@id="battle_target_list"]//a[contains(@href, "opponent_id")]',a);if(!c||c.length==0)c=$x('.//table[@class="hit_list"]//a[contains(@href,"target_pid") and not(contains(@href,"challengePop"))]',a);if(c&&c.length>0){b=0;for(iLength=c.length;b<iLength;b++){e=c[b];f=new Player;a=e.parentNode.parentNode;rowInnerUntag=a.innerHTML.untag();d=a.getElementsByTagName("td");d.length||(d=a.getElementsByTagName("div"));nameAndLevel=d[0];f.mafia=-1;f.level=-1;f.charClass="";if(e.href.indexOf("NPC")!=-1){f.a_type="attack";f.nameElt=xpathFirst(".//span",nameAndLevel);f.name=f.nameElt.innerHTML;f.profile=e;f.linkedName=f.name;f.attack=e;f.fightlabel=0;f.iced=false;f.title="";var g;f.profile.hasAttribute("href")&&(g=f.profile.getAttribute("href"));if(g.match(/NPC_id\=(\d+)&+/))f.id=decodeID(RegExp.$1);f.button=e.getAttribute("href").replace(/&amp;/g,"&").replace(/remote\/html_server.php\?/,"");if(f.id){getDisplayedOpponents.opponents=[];getDisplayedOpponents.opponents.push(f);break}}else{if(xpathFirst('.//a[contains(@href,"xw_controller=stats")]',nameAndLevel))f.mafia=d[1]?parseInt(d[1].innerHTML):0;else{nameAndLevel=d[1];f.payer=d[2].innerHTML;if(d[3].innerHTML.match(REGEX_CASH))f.bounty=RegExp.lastMatch;f.time=d[4].innerHTML.untag().trim()}nalInnerUntag=nameAndLevel.innerHTML.untag();f.familyElt=xpathFirst('.//a[contains(@href,"xw_controller=clan")]',nameAndLevel);f.nameElt=xpathFirst('.//a[contains(@href,"xw_controller=stats")]',nameAndLevel);f.titleElt=xpathFirst('.//div[@class="fight_list_name_area"]//span',nameAndLevel);if(f.titleElt)f.title=f.titleElt.innerHTML.untag().trim();f.profile=f.nameElt;if(f.profile){f.profile.hasAttribute("href")&&(g=f.profile.getAttribute("href"));if(g.match(/(user|opponent_id|target_pid)\=(.+)&?/))f.id=decodeID(RegExp.$2);if(f.id){f.a_type="attack_pop";f.attack=e;f.button=e.getAttribute("href").replace(/&amp;/g,"&").replace(/remote\/html_server.php\?/,"");if(!f.mafia&&rowInnerUntag.match(/Mafia.*?(\d+)/i))f.mafia=parseInt(RegExp.$1);if(nalInnerUntag.match(/level\s*?(\d+)\s*(.+)/i)){f.level=parseInt(RegExp.$1);f.charClass=RegExp.$2.trim()}else if(nalInnerUntag.match(/level.*?(\d+)/i/b))f.level=parseInt(RegExp.$1);if(f.familyElt){f.name=f.familyElt.innerHTML;f.linkedName=linkToString(f.familyElt,"user")}if(f.name){f.name=f.name+(" "+f.nameElt.innerHTML);f.linkedName=f.linkedName+linkToString(f.nameElt,"user")}else{f.name=f.nameElt.innerHTML;f.linkedName=linkToString(f.nameElt,"user")}f.fightlabel=0;if(e=xpathFirst(".//img",d[0])){userBadge=e.title;e=fightLabels.searchArray(userBadge,0)[0];if(!isNaN(e))f.fightlabel=e}if(d[0].style.color=="rgb(102, 102, 102)"||d[0].className=="fight_list_player_dead"){f.iced=true;if(!running&&isGMChecked("showPulse"))a.style.display="none"}else f.iced=false;if(f.profile.previousSibling&&f.profile.previousSibling.nodeValue.match(/\w+(?: \w+)*/))f.title=RegExp.lastMatch;getDisplayedOpponents.opponents.push(f)}}}}}DEBUG(getDisplayedOpponents.opponents.length+" opponents listed.");return!getDisplayedOpponents.opponents.length?[]:getDisplayedOpponents.opponents}function findFightOpponent(a,b,c){fightListNew.set([]);var d=getDisplayedOpponents(a,true,b,c);if(!d)return-1;if(b==STAMINA_HOW_HITMAN)var e=isGMChecked("hitmanNames"),f=isGMChecked("hitmanAvoidNames"),g=isGMChecked("hitmanOnlyNames"),h=parseCash(GM_getValue("hitmanBountyMin",0)),m=GM_getValue("bountySelection",BOUNTY_HIGHEST_BOUNTY)==BOUNTY_EXACT_AMOUNT;else{e=isGMChecked("fightNames");f=isGMChecked("fightAvoidNames");g=isGMChecked("fightOnlyNames")}var j=GM_getIntValue("fightLevelMax",100),l=GM_getIntValue("fightMafiaMax",501),k=GM_getIntValue("fightMafiaMin",1),o=GM_getIntValue("fightLabelCriteria",0);GM_getValue("fightLevelMaxRelative",false)&&(j=j+level);GM_getValue("fightMafiaMaxRelative",false)&&(l=l+mafia);GM_getValue("fightMafiaMinRelative",false)&&(k=mafia-k);k>501&&(k=501);DEBUG("Applying criteria to displayed opponents ("+d.length+"): level <= "+j+", mafia between "+k+" and "+l+".");for(var q=c=a=0,s=0,r=0,p=0,u=0,w=0,v=d.length,x=GM_getValue("fightRivalsMode",0),y=0;y<v;++y){var n=d[y];if(n.id)if(o&&o<n.fightlabel)u++;else{if(GM_getValue("fightMobMode")){if(n.level>j*501/n.mafia&&n.level>0){a++;continue}}else if(n.level>j&&n.level>0){a++;continue}if(n.mafia>l&&n.mafia>0)c++;else if(n.mafia<k&&n.mafia>0)q++;else if(e&&f&&isFamily(decodeHTMLEntities(n.linkedName),b))s++;else if(e&&g&&!isFamily(decodeHTMLEntities(n.linkedName),b))s++;else if(isGMChecked("iceCheck")&&n.iced)p++;else{var t=parseCash(n.bounty);if(t&&(t<h||m&&t>h))w++;else{t=fightListAvoid.indexOf(n);if(t!=-1&&isGMChecked("fightRemoveStronger")){fightListAvoid.get()[t].update(n);r++}else{t=hitmanListAvoid.indexOf(n);if(t!=-1&&isGMChecked("fightRemoveStronger")){hitmanListAvoid.get()[t].update(n);r++}else if(fightListNew.add(n)){if(!x&&b!=STAMINA_HOW_HITMAN||1!=parseXMLResponse())break}else r++}}}}}if(h=a+c+q+s+p+r+u+w){DEBUG("Out of the "+v+" opponent(s) listed on the fight page "+h+" disqualified.");DEBUG(a+" on max level, "+c+" on max mafia, "+q+" on min mafia,<br>"+s+" on name pattern, "+p+" already iced, "+w+" on bounty<br>"+u+" on fight label, "+r+" by blacklisting (stronger opponents).")}newOpponents=fightListNew.get();if(!newOpponents.length)return-1;newOpponents.sort(function(a,b){return a.mafia*a.level/501-b.mafia*b.level/501});h=newOpponents.length;h>3&&(h=3);return b!=STAMINA_HOW_HITMAN?newOpponents[Math.floor(Math.random()*h)]:newOpponents}function setFightOpponentAvoid(a){if(a){DEBUG("Marking fight opponent avoid, name: "+a.name);fightListAvoid.add(a,100);fightListAvoid.set();fightListNew.remove(a)&&fightListNew.set();DEBUG("Fightlists updated for fight opponent (name: "+a.name+")");removeSavedListItem("pfightlist",a.id)}}function setHitmanOpponentAvoid(a){if(a){DEBUG("Marking hitlist opponent "+a.name+" avoid.");hitmanListAvoid.add(player,100);fightListAvoid.set()}}function toggleSettings(){updateMastheadMenu();if(settingsOpen===false){destroyByID("apimg");makeElement("img",document.getElementById("ap_img"),{id:"apimg",src:"http://cdn.playerscripts.co.uk/images/mwap_graphics/32_grey.png"});Autoplay.clearTimeout();Reload.clearTimeout();settingsOpen=true;createSettingsBox();showSettingsBox()}else{settingsOpen=false;destroyByID("MWAPSettingsBox");Autoplay.delay=150;Autoplay.start();autoReload(false,"toggle settings")}}function showSettingsBox(){var a=document.getElementById("MWAPSettingsBox");if(a)a.style.display="block"}function showMafiaLogBox(){document.getElementById("mafiaLogBox")?document.getElementById("mafiaLogBox").style.display="block":createLogBox();!debug&&GM_getValue("logOpen")!="open"&&!isGMChecked("autoLog")&&alert('Logging is not enabled. To see new activity here, please open your settings and check "Enable logging" in the General tab.');GM_setValue("logOpen","open")}function hideMafiaLogBox(){isGMChecked("autoLog")?document.getElementById("mafiaLogBox").style.display="none":destroyByID("mafiaLogBox");GM_setValue("logOpen","closed")}function handleVersionChange(){var a=SCRIPT.version.split(".");cmain_ver=parseInt(a[0]);csub_ver=parseInt(a[1]);curbuild=parseInt(a[2]);a=GM_getValue("version","1.1.1000").split(".");lmain_ver=parseInt(a[0]);lsub_ver=parseInt(a[1]);lastbuild=parseInt(a[2]);if(lastbuild<updtJobArrayIfWasBelow||lsub_ver<csub_ver||lmain_ver<cmain_ver){GM_setValue("missions",0);addToLog("process Icon","Builds, Loading :"+curbuild+" Upgrade Jobs If We Were Below :"+updtJobArrayIfWasBelow+" Clearing stored missions array to reload")}else addToLog("info Icon","Builds, Loading :"+curbuild+" Was Running :"+lastbuild+" Upgrade Jobs If We Were Below :"+updtJobArrayIfWasBelow);GM_setValue("version",SCRIPT.version);addToLog("updateGood Icon","Now running version "+SCRIPT.version+".")}function saveDefaultSettings(){try{var a;defaultCheckBoxElementArray(["autoPauseBefore"],"checked");defaultCheckBoxElementArray(["autoPause","autoPauseAfter","autoProcessPopups","AutoSlotMachine"],"unchecked");GM_setValue("fastMWAPSpeed",3);GM_setValue("autoPauseExp","50");GM_setValue("idleLocation",NY);GM_setValue("burnOption",0);defaultCheckBoxElementArray(["autoLog","playMWAP"],"checked");defaultCheckBoxElementArray(["textOnlyMode","filterLog","leftAlign","mastheadOnTop","fbwindowtitle","showPulse","showLevel","hideAll","hideZyngaBanner","hideClanChat","noStats","playMWCom","playMWAPLite","playMWAPRX2","playMWAPLiteRX2"],"unchecked");GM_setValue("autoLogLength","300");GM_setValue("logPlayerUpdatesMax",50);GM_setValue("filterLog",0);GM_setValue("filterOpt",0);logFilterOnOff(1);GM_setValue("filterPass",defaultPassPatterns.join("\n"));GM_setValue("filterFail",defaultFailPatterns.join("\n"));defaultCheckBoxElementArray(["autoAskJobHelp","acceptMafiaInvitations","autoAskCityCrew","logPlayerUpdates","autoGlobalPublishing","autoIcePublish","autoShareWishlist","autoAcceptMsgGifts","autoAcceptMsgBoosts","autoAcceptMsgCrew","autosendMsgEnergyPack"],"unchecked");GM_setValue("autoAskJobHelpMinExp",0);GM_setValue("selectBrazilTier",0);GM_setValue("selectChicagoTier",0);GM_setValue("selectLondonTier",0);GM_setValue("selectVegasTier",0);GM_setValue("autoIcePublishFrequency",1);GM_setValue("autoShareWishlistTime",1);GM_setValue("warMode",0);GM_setValue("autoWarTargetList","");defaultCheckBoxElementArray(["autoStartFamOps","autoStartMyOps","AutoFamilyRewards","AutoBattle","AutoBattleFight","AutoBattleSafehouse","autoFamilyBosses","autoFamilyBossFighting","askBossFightBoosts","sendBossFightBoosts"],"unchecked");GM_setValue("bossRole",0);GM_setValue("bossStaminaLimit",0);GM_setValue("bossRageLimit",250);GM_setValue("selectFreeGift",0);GM_setValue("selectAskFreeGift",0);GM_setValue("autoStat",0);GM_setValue("autoStatDisable",0);a=0;for(iLength=autoStatModes.length;a<iLength;++a)GM_setValue(autoStatModes[a],0);a=0;for(iLength=autoStatPrios.length;a<iLength;++a)GM_setValue(autoStatPrios[a],0);a=0;for(iLength=autoStatBases.length;a<iLength;++a)GM_setValue(autoStatBases[a],0);a=0;for(iLength=autoStatRatios.length;a<iLength;++a)GM_setValue(autoStatRatios[a],0);a=0;for(iLength=autoStatFallbacks.length;a<iLength;++a)GM_setValue(autoStatFallbacks[a],0);for(a=1;a<=3;a++){id="selectCityPrio"+a;GM_setValue(id,0)}for(a=1;a<cityCrewTitles.length;a++){id="selectBrazilCrew"+a;GM_setValue(id,0);id="selectChicagoCrew"+a;GM_setValue(id,0);id="selectLondonCrew"+a;GM_setValue(id,0)}GM_setValue("activateBrazilCrew",0);GM_setValue("activateChicagoCrew",0);GM_setValue("activateLondonCrew",0);defaultCheckBoxElementArray(["autoMission","repeatJob","endLevelOptimize","endLevelNYOnly","autoWithDraw","skipfight","autoFightAgostino","checkMiniPack","autoEnergyPack","autoEnergyPackForce","allowEnergyToLevelUp"],"unchecked");GM_setValue("selectTier","0.0");GM_setValue("estimateJobRatio","2");GM_setValue("autoEnergyPackForcePts",0);GM_setValue("selectEnergyKeep",0);GM_setValue("selectEnergyUse",0);GM_setValue("selectEnergyKeepMode",0);GM_setValue("selectEnergyUseMode",0);GM_setValue("selectMissionEnergyKeep",0);GM_setValue("selectMissionEnergyKeepMode",0);setSavedList("jobsToDo",[]);setSavedList("itemList",[]);GM_setValue("masteredJobs","({0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{}})");GM_setValue("availableJobs","({0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{}})");defaultCheckBoxElementArray(["iceCheck","staminaPowerattack","fightRemoveStronger","fightNames","fightAvoidNames","hitmanNames","hitmanAvoidNames","fightFallback"],"checked");defaultCheckBoxElementArray(["staminaSpend","staminaLogDetails","fightLevelMaxRelative","fightMafiaMaxRelative","fightMafiaMinRelative","fightMobMode","fightIceStealers","fightOnlyNames","allowStaminaToLevelUp"],"unchecked");GM_setValue("staminaSpendHow",STAMINA_HOW_FIGHT_RANDOM);GM_setValue("fightLocation",NY);GM_setValue("reattackThreshold",0);GM_setValue("fightLevelMax",level);GM_setValue("fightHealthMax",0);GM_setValue("fightHealthPctMax",0);GM_setValue("fightLabelCriteria",0);GM_setValue("fightMaxAttacks",0);GM_setValue("fightMafiaMax",501);GM_setValue("fightMafiaMin",1);GM_setValue("hitmanLocation",NY);GM_setValue("fightClanName",defaultClans.join("\n"));GM_setValue("hitmanClanName",defaultClans.join("\n"));GM_setValue("randomFightLocations","10000000");GM_setValue("randomRobLocations","10000000");GM_setValue("randomHitmanLocations","10000000");GM_setValue("randomSpendModes","100000");GM_setValue("robLocation",NY);GM_setValue("fastRobSpeed",0);1==parseXMLResponse()&&GM_setValue("fastBGFSpeed",0);GM_setValue("selectStaminaKeep",0);GM_setValue("selectStaminaKeepMode",0);GM_setValue("selectStaminaUse",0);GM_setValue("selectStaminaUseMode",0);GM_setValue("selectMissionStaminaKeep",0);GM_setValue("selectMissionStaminaKeepMode",0);GM_setValue("robFightStaminaFloor",25);update_nrg_stam();defaultCheckBoxElementArray(["autoHeal","autoHealBackup","attackCritical","hideInHospital","forceHealOpt1","forceHealOpt3","forceHealOpt4","forceHealOpt5","forceHealOpt7","stopPA","hideAttacks"],"unchecked");GM_setValue("healLocation",NY);GM_setValue("healthLevel","50");GM_setValue("stamina_min_heal",0);GM_setValue("stopPAHealth",29);GM_setValue("rideHitlistXP",0);defaultCheckBoxElementArray(["collectTakeNew York","collectTakeBrazil","collectTakeChicago","collectTakeLondon","collectParts","autoBank","autoBankVegas","autoBankBrazil","autoBankChicago","autoBankLondon","askVegasParts","askPlaySlots","askBrazilParts","askChicagoParts","askLondonParts","autoLimitedParts","autoFamilyProperty"],"unchecked");for(ctCount=0;ctCount<ctLength;ctCount++){propItemId=cityProperties[ctCount][ctGMId]+"Id";defaultCheckBoxElementArray([cityProperties[ctCount][ctGMId]],"unchecked");GM_setValue(propItemId,0)}defaultCheckBoxElementArray(autoUpgradeNYBuildings,"unchecked");ctCount=0;for(cpLength=cityParts.length;ctCount<cpLength;ctCount++){defaultCheckBoxElementArray([cityParts[ctCount][ptGMId]],"unchecked");if(cityParts[ctCount][ptPropId]){propItemId=cityParts[ctCount][ptGMId]+"Id";GM_setValue(propItemId,0)}}GM_setValue("askVegasPartsId",1);GM_setValue("askVegasPropId",1);GM_setValue("askBrazilPartsId",1);GM_setValue("askBrazilPropId",1);GM_setValue("askChicagoPartsId",1);GM_setValue("askChicagoPropId",1);GM_setValue("askLondonPartsId",1);GM_setValue("askLondonPropId",1);GM_setValue("bankConfig","50000");GM_setValue("bankConfigVegas","50000");GM_setValue("vaultHandling",0);GM_setValue("bankConfigBrazil","50000");GM_setValue("bankConfigChicago","5000");GM_setValue("bankConfigLondon","5000");GM_setValue("autoUpgradeNYChoice",0);GM_setValue("userMinBalance",0);defaultCheckBoxElementArray(["TestChanges"],"unchecked");GM_setValue("logOpen","open");fightListNew.set([]);skipStaminaSpend=false}catch(b){DEBUG("Using defaults failed on "+b)}destroyByID("mafiaLogBox");createLogBox();toggleSettings();isGMChecked("noStats")||updateLogStats();refreshMWAPCSS();sendSettings();logFilterOnOff(1);addToLog("process Icon","Options reset to defaults.")}function saveSettings(){try{var a;saveCheckBoxElementArray(["autoPause","autoProcessPopups","AutoSlotMachine","autoSlot3FreeSpins","autoCheckReallocation"]);if(saveCheckBoxElement("autoPauseBefore")){GM_setValue("autoPauselvlExp",ptsToNextLevel);GM_setValue("autoPauseActivated",false)}saveCheckBoxElement("autoPauseAfter")&&GM_setValue("autoPauselvlExp",ptsToNextLevel);var b=parseInt(document.getElementById("autoPauseExp").value);isNaN(b)&&(b=0);GM_setValue("autoPauseExp",b);saveElementArray([["fastMWAPSpeed",1],["autoPauseMode",1],["idleLocation",1],["burnOption",2]]);saveCheckBoxElementArray(["autoLog","textOnlyMode","filterLog","leftAlign","mastheadOnTop","fbwindowtitle","showPulse","showLevel","hideZyngaBanner","hideClanChat","noStats","hideAll","playMWCom","playFB","playMWAP","playMWAPLite","playMWAPRX2","playMWAPLiteRX2"]);var c=parseInt(document.getElementById("autoLogLength").value);isNaN(c)&&(c=3E3);GM_setValue("autoLogLength",c);var d=document.getElementById("filterOpt").value;GM_setValue(d==0?"filterPass":"filterFail",document.getElementById("filterPatterns").value);GM_setValue("filterOpt",d);saveCheckBoxElementArray(["autoAskJobHelp","acceptMafiaInvitations","logPlayerUpdates","autoGlobalPublishing","autoIcePublish","autoShareWishlist","autoAcceptMsgGifts","autoAcceptMsgBoosts","autoAcceptMsgCrew","autosendMsgEnergyPack","autoAskCityCrew"]);GM_setValue("logPlayerUpdatesMax",50);var e=parseInt(document.getElementById("autoShareWishlistTime").value);if(isNaN(e)||parseFloat(e)<1){alert('The share wishlist timer has to be at least 1 hour. For decimal numbers please use ".", e.g. 1.5.\nDefaulting it to 1 hour.');document.getElementById("autoShareWishlistTime").value=1;return}GM_setValue("autoShareWishlistTime",e);var f=parseInt(document.getElementById("autoAskJobHelpMinExp").value);isNaN(f)&&(f=0);GM_setValue("autoAskJobHelpMinExp",f);var g=parseInt(document.getElementById("autoIcePublishFrequency").value);isNaN(g)&&(g=1);GM_setValue("autoIcePublishFrequency",g);saveElementArray([["selectBrazilTier",2],["selectChicagoTier",2],["selectLondonTier",2],["selectVegasTier",2],["warMode",2],["autoWarTargetList",2]]);saveCheckBoxElementArray(["autoStartFamOps","autoStartMyOps","AutoFamilyRewards","AutoBattle","AutoBattleFight","AutoBattleSafehouse","autoFamilyBosses","autoFamilyBossFighting","askBossFightBoosts","sendBossFightBoosts"]);saveElementArray([["AutoBattleClanID",2],["bossRole",2],["bossStaminaLimit",2],["bossRageLimit",2],["selectFreeGift",2],["selectAskFreeGift",2]]);saveCheckBoxElementArray(["autoStat","autoStatDisable","autoStatAttackFallback","autoStatDefenseFallback","autoStatHealthFallback","autoStatEnergyFallback","autoStatStaminaFallback"]);GM_setValue("restAutoStat",0);a=0;for(iLength=autoStatBases.length;a<iLength;++a)GM_setValue(autoStatBases[a],document.getElementById(autoStatBases[a]).value);a=0;for(iLength=autoStatRatios.length;a<iLength;++a)GM_setValue(autoStatRatios[a],document.getElementById(autoStatRatios[a]).value);a=0;for(iLength=autoStatModes.length;a<iLength;++a)GM_setValue(autoStatModes[a],document.getElementById(autoStatModes[a]).value);a=0;for(iLength=autoStatPrios.length;a<iLength;++a)GM_setValue(autoStatPrios[a],document.getElementById(autoStatPrios[a]).value);var h=document.getElementById("autoStat").checked===true;a=0;for(iLength=autoStatBases.length;a<iLength;++a)if(h&&isNaN(document.getElementById(autoStatBases[a]).value)){alert("Please enter valid numbers for auto-stat "+autoStatDescrips[a+1]+" (Misc tab). : "+document.getElementById(autoStatBases[a]).value);return}a=0;for(iLength=autoStatRatios.length;a<iLength;++a)if(h&&isNaN(document.getElementById(autoStatRatios[a]).value)){alert("Please enter valid numbers for auto-stat "+autoStatDescrips[a+1]+" (Misc tab).");return}if(1!=parseXMLResponse()){for(a=1;a<=3;a++){id="selectCityPrio"+a;GM_setValue(id,0)}for(a=1;a<cityCrewTitles.length;a++){id="selectBrazilCrew"+a;GM_setValue(id,0);id="selectChicagoCrew"+a;GM_setValue(id,0);id="selectLondonCrew"+a;GM_setValue(id,0)}GM_setValue("activateBrazilCrew",0);GM_setValue("activateChicagoCrew",0);GM_setValue("activateLondonCrew",0)}else{for(a=1;a<=3;a++){id="selectCityPrio"+a;GM_setValue(id,document.getElementById(id).value)}b=0;for(a=1;a<cityCrewTitles.length;a++){id="selectBrazilCrew"+a;document.getElementById(id).value&&(b=1);GM_setValue(id,document.getElementById(id).value)}GM_setValue("activateBrazilCrew",b);b=0;for(a=1;a<cityCrewTitles.length;a++){id="selectChicagoCrew"+a;document.getElementById(id).value&&(b=1);GM_setValue(id,document.getElementById(id).value)}GM_setValue("activateChicagoCrew",b);b=0;for(a=1;a<cityCrewTitles.length;a++){id="selectLondonCrew"+a;document.getElementById(id).value&&(b=1);GM_setValue(id,document.getElementById(id).value)}GM_setValue("activateLondonCrew",b)}saveCheckBoxElementArray(["autoMission","endLevelOptimize","endLevelNYOnly","autoWithDraw","checkMiniPack","autoEnergyPack","autoEnergyPackForce","allowEnergyToLevelUp","skipfight","autoFightAgostino"]);b=[];c=[];selectedTierValue=document.getElementById("selectTier").value.split(".");masteryCity=parseInt(selectedTierValue[0]);masteryTier=parseInt(selectedTierValue[1]);a=0;for(iLength=missions.length;a<iLength;a++){document.getElementById(missions[a][MISSION_NAME]).checked&&b.push(a);masteryCity==missions[a][MISSION_CITY]&&masteryTier==missions[a][MISSION_TAB]&&c.push(a)}var m=b.length,j=document.getElementById("selectTier").value;if(m&&j!="0.0"){GM_setValue("autoMission",0);alert("Please choose either jobs to master or a tier to master, not both ...")}if(document.getElementById("autoMission").checked===true)if(m)GM_setValue("repeatJob","checked");else if(j!="0.0")GM_setValue("repeatJob",0);else{GM_setValue("autoMission",0);alert("Please choose either jobs to master or a tier to master ... autoMission disabled")}setSavedList("selectMissionMultiple",b);setSavedList("masteryJobsList",c);GM_setValue("selectTier",j);var l=document.getElementById("autoEnergyPack").checked===true,k=parseFloat(document.getElementById("estimateJobRatio").value);if(l&&isNaN(k)){alert("Please enter a number between 0 and 3 for your estimated job xp to energy ratio");return}GM_setValue("estimateJobRatio",document.getElementById("estimateJobRatio").value);var o=parseInt(document.getElementById("autoEnergyPackForcePts").value);isNaN(o)&&(o=0);GM_setValue("autoEnergyPackForcePts",o);var q=parseInt(document.getElementById("selectEnergyUse").value),s=parseInt(document.getElementById("selectEnergyKeep").value);if(isNaN(q)||isNaN(s)){alert("Please enter numeric values for Energy reserve and Energy threshold.");return}var r=parseInt(document.getElementById("selectMissionEnergyKeep").value);if(isNaN(r)){alert("Please Enter Numeric Values For The Mission Energy Threshold.");return}GM_setValue("selectEnergyUse",q);GM_setValue("selectEnergyKeep",s);GM_setValue("selectEnergyUseMode",document.getElementById("selectEnergyUseMode").selectedIndex);GM_setValue("selectEnergyKeepMode",document.getElementById("selectEnergyKeepMode").selectedIndex);GM_setValue("selectMissionEnergyKeep",r);GM_setValue("selectMissionEnergyKeepMode",document.getElementById("selectMissionEnergyKeepMode").selectedIndex);var p=validateStaminaTab();if(!p)return;for(var u in p)GM_setValue(u,p[u]);update_nrg_stam();saveCheckBoxElementArray(["autoHeal","autoHealBackup","attackCritical","hideInHospital","forceHealOpt3","forceHealOpt4","forceHealOpt5","forceHealOpt7","hideAttacks","stopPA"]);var w=document.getElementById("autoHeal").checked===true,v=parseInt(document.getElementById("healthLevel").value);if(w&&(!v||v<1)){alert("Health level for automatic healing must be 1 or more.");return}GM_setValue("healthLevel",v);GM_setValue("healLocation",document.getElementById("healLocation").value);var x=parseInt(document.getElementById("stamina_min_heal").value);isNaN(x)&&(x=0);GM_setValue("stamina_min_heal",x);var y=document.getElementById("hideAttacks").checked===true,n=parseInt(document.getElementById("rideHitlistXP").value);if(y){if(isNaN(n)||n<0||n>50){alert("For the hitlistride XP please enter a number between 0 and 50 (default: 0).");return}GM_setValue("rideHitlistXP",n)}var t=parseInt(document.getElementById("stopPAHealth").value);if(t){if(isNaN(t)||t<0){alert("Please enter a Power Attack Health level >= 0");return}GM_setValue("stopPAHealth",t)}if(isGMChecked("autoHeal"))if(GM_getValue("staminaSpendHow")==STAMINA_HOW_FIGHTROB||GM_getValue("staminaSpendHow")==STAMINA_HOW_ROBFIGHT){document.getElementById("mwap_toggleheal").innerHTML=healOnHoldIcon;document.getElementById("mwap_toggleheal").title="autoHeal checked BUT OVERRULED - healing in "+locations[GM_getValue("healLocation")]+" when health falls below "+GM_getValue("healthLevel")+".";addToLog("healOnHoldIcon Icon","autoHeal turned ON by User, but OVERRULED")}else{document.getElementById("mwap_toggleheal").innerHTML=healOnIcon;document.getElementById("mwap_toggleheal").title="autoHeal checked - healing in "+locations[GM_getValue("healLocation")]+" when health falls below "+GM_getValue("healthLevel")+".";addToLog("healOnIcon Icon","autoHeal turned ON by User")}else{document.getElementById("mwap_toggleheal").innerHTML=healOffIcon;document.getElementById("mwap_toggleheal").title="autoHeal unchecked";addToLog("healOffIcon Icon","autoHeal turned OFF by User")}saveCheckBoxElementArray(["collectTakeNew York","collectTakeBrazil","collectTakeChicago","collectTakeLondon","collectParts","autoBank","autoBankVegas","autoBankBrazil","autoBankChicago","autoBankLondon","askVegasParts","askPlaySlots","askBrazilParts","askChicagoParts","askLondonParts","autoLimitedParts","autoFamilyProperty"]);for(ctCount=0;ctCount<ctLength;ctCount++){propItemId=cityProperties[ctCount][ctGMId]+"Id";saveCheckBoxElementArray([cityProperties[ctCount][ctGMId]]);GM_setValue(propItemId,document.getElementById(propItemId).selectedIndex)}ctCount=0;for(cpLength=cityParts.length;ctCount<cpLength;ctCount++){saveCheckBoxElementArray([cityParts[ctCount][ptGMId]]);if(cityParts[ctCount][ptPropId]){propItemId=cityParts[ctCount][ptGMId]+"Id";GM_setValue(propItemId,document.getElementById(propItemId).selectedIndex)}}GM_setValue("askVegasPartsId",document.getElementById("askVegasPartsId").selectedIndex);GM_setValue("askVegasPropId",document.getElementById("askVegasPropId").selectedIndex);GM_setValue("askBrazilPartsId",document.getElementById("askBrazilPartsId").selectedIndex);GM_setValue("askBrazilPropId",document.getElementById("askBrazilPropId").selectedIndex);GM_setValue("askChicagoPartsId",document.getElementById("askChicagoPartsId").selectedIndex);GM_setValue("askChicagoPropId",document.getElementById("askChicagoPropId").selectedIndex);GM_setValue("askLondonPartsId",document.getElementById("askLondonPartsId").selectedIndex);GM_setValue("askLondonPropId",document.getElementById("askLondonPropId").selectedIndex);var K=document.getElementById("autoBank").checked===true,L=document.getElementById("autoBankVegas").checked===true,M=document.getElementById("autoBankBrazil").checked===true,N=document.getElementById("autoBankChicago").checked===true,O=document.getElementById("autoBankLondon").checked===true,z=document.getElementById("bankConfig").value,A=document.getElementById("bankConfigVegas").value,B=document.getElementById("bankConfigBrazil").value,C=document.getElementById("bankConfigChicago").value,D=document.getElementById("bankConfigLondon").value,E=parseInt(z),F=parseInt(A),G=parseInt(B),H=parseInt(C),I=parseInt(D),J=document.getElementById("userMinBalance").value;GM_setValue("vaultHandling",document.getElementById("vaultHandling").selectedIndex);GM_setValue("autoUpgradeNYChoice",document.getElementById("autoUpgradeNYChoice").selectedIndex);a=0;for(iLength=autoUpgradeNYBuildings.length;a<iLength;a++){eltId="upgradeNYProperty"+autoUpgradeNYBuildings[a][1];saveCheckBoxElement(eltId)}if(K&&(isNaN(E)||E<10)){alert("Minimum New York auto-bank amount must be 10 or higher.");return}if(L&&(isNaN(F)||F<10)){alert("Minimum Las Vegas auto-bank amount must be 10 or higher.");return}if(M&&(isNaN(G)||G<10)){alert("Minimum Brazil auto-bank amount must be 10 or higher.");return}if(N&&(isNaN(H)||H<10)){alert("Minimum Chicago auto-bank amount must be 10 or higher.");return}if(O&&(isNaN(I)||I<10)){alert("Minimum Chicago auto-bank amount must be 10 or higher.");return}if(J<0){alert("Minimum NY Bank Balance amount must be 0 or higher.");return}GM_setValue("bankConfig",z);GM_setValue("bankConfigVegas",A);GM_setValue("bankConfigBrazil",B);GM_setValue("bankConfigChicago",C);GM_setValue("bankConfigLondon",D);GM_setValue("userMinBalance",J);saveCheckBoxElementArray(["TestChanges"]);setSavedList("jobsToDo",[]);setSavedList("itemList",[]);GM_setValue("masteredJobs","({0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{}})");GM_setValue("availableJobs","({0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{}})");fightListNew.set([]);skipStaminaSpend=false}catch(P){DEBUG("Save Settings failed on "+P)}destroyByID("mafiaLogBox");createLogBox();toggleSettings();isGMChecked("noStats")||updateLogStats();refreshMWAPCSS();sendSettings();logFilterOnOff(1)};function updateMastheadMenu(){var b=document.getElementById("ap_menu");if(b){var c=document.getElementById("ap_img")?document.getElementById("ap_img"):makeElement("div",b.parentNode,{id:"ap_img",style:"position: absolute; top: 23px; right:135px;"}),a=document.getElementById("pauseButton");running?(destroyByID("apimg"),makeElement("img",c,{id:"apimg",src:"http://cdn.playerscripts.co.uk/images/mwap_graphics/32_green.png"}),a||(destroyByID("resumeButton"),a=makeElement("span",null,{id:"pauseButton",style:"color:#33FF00;",title:"RX6 MWAP is RUNNING, click to pause ..."}),a.appendChild(document.createTextNode("Pause")),a.addEventListener("click",pause,!1),b.insertBefore(a,b.firstChild))):(a&&a.parentNode.removeChild(a),a=document.getElementById("resumeButton"),destroyByID("apimg"),makeElement("img",c,{id:"apimg",src:"http://cdn.playerscripts.co.uk/images/mwap_graphics/32_red.png"}),a||(a=makeElement("span",null,{id:"resumeButton",style:"color:#FF0000;",title:"RX6 MWAP is PAUSED, click to resume ..."}),a.appendChild(document.createTextNode("Resume")),b.insertBefore(a,b.firstChild),a.addEventListener("click",unPause,!1)))}}function update_nrg_stam(){setListenStats(!1);if(document.getElementById("mwap_nrg")){var b=document.getElementById("mwap_nrg"),c=xpathFirst('./div[@class="mw_header"]//div[@class="mid_row_text energy_text_bg" and contains(text(), "ENERGY")]',statsrowElt);c||(c=xpathFirst('.//div[@id="game_stats"]//h4[@class="energy" and contains(text(), "Energy")]',statsrowElt));c||(c=xpathFirst('.//div[@id="game_stats"]//span[@class="stat_title" and contains(text(),"Energy")]',statsrowElt));if(c){if(isGMChecked("autoMission")){var a="Spend Energy ON.  ";c.style.color="#33FF00"}else a="Spend Energy OFF.  ",c.style.color="#FF0000";selectedTierValue=GM_getValue("selectTier","0.0").split(".");masteryCity=parseInt(selectedTierValue[0]);masteryTier=parseInt(selectedTierValue[1]);a=0==masteryCity&&(0==masteryTier||void 0==masteryTier)?a+" Mastering- Turned OFF ":a+(" Mastering-"+cities[masteryCity][CITY_NAME]+", District/Region-"+masteryTier+" "+missionTabs[masteryCity][masteryTier-1]);c.style.textDecoration="underline";b.title=a}}if(document.getElementById("mwap_nrg")&&(b=document.getElementById("mwap_stam"),(c=xpathFirst('./div[@class="mw_header"]//div[@class="mid_row_text stamina_text_bg" and contains(text(), "STAMINA")]',statsrowElt))||(c=xpathFirst('.//div[@id="game_stats"]//h4[contains(text(), "Stamina")]',statsrowElt)),c||(c=xpathFirst('.//div[@id="game_stats"]//span[@class="stat_title" and contains(text(),"Stamina")]',statsrowElt)),c)){isGMChecked("staminaSpend")?(a="Spend Stamina ON.  ",c.style.color="#33FF00"):(a="Spend Stamina OFF.  ",c.style.color="#FF0000");var a=a+("Minimum Stamina for auto-healing set at "+GM_getValue("stamina_min_heal")+" points."),d=GM_getValue("staminaSpendHow"),a=a+(" Stamina Spend Mode: "+staminaSpendChoices[d]);c.style.textDecoration="underline";b.title=a}setListenStats(!0)}function pause(){!1===GM_getValue("isRunning")&&refreshLog();GM_setValue("isRunning",!1);running=!1;sendMWValues(["isRunning"]);Autoplay.clearTimeout();Reload.clearTimeout();addToLog("pause Icon","Autoplayer is paused. Log & stats do not track manual activity.");ajaxHandling=!1;mwapOnOffMenu();updateMastheadMenu();customizeHome()}function unPause(){!0===GM_getValue("isRunning")&&refreshLog();GM_setValue("masteredJobs","({0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{}})");GM_setValue("availableJobs","({0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{}})");GM_setValue("isRunning",!0);running=!0;sendMWValues(["isRunning"]);addToLog("play Icon",'Autoplayer resuming.<br/>If you like RX6 MWAP Click Like <iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.facebook.com%2Fpages%2FPS-Mafia-Wars-Autoplayer%2F160393374005267&amp;layout=button_count&amp;show_faces=true&amp;width=80&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:80px; height:21px;" allowTransparency="true"></iframe><br/>RX6 MWAP FB Fanpage - help us to be an authorised Zynga script.');mwapOnOffMenu();updateMastheadMenu();autoReload(!1,"unpause");DEBUG("Unpause.");Autoplay.fx=goHome;Autoplay.delay=150;Autoplay.start()}1!=parseXMLResponse()&&setInterval(recurringLogText,3E5);function recurringLogText(){addToLog("info Icon",'<div style="width: 320px; background: #000; padding: 2px; border: 1px solid #fff; opacity: .8;"><a href="http://mwap.me.uk/sign-up/rx6-1-year-membership.html" target="_blank" title="Why have a RX6 PRO Membership?"><img style="position: relative;" src="http://rx6.tinhatsoftwarelt.netdna-cdn.com/images/mwap-images/rx6-signuptoday-mwap.jpg" alt="" /></a><div style="text-align: center; text-decoration:blink"><span class="good"><span style="font-size: 12pt;"><strong>Upgrade to RX6 MWAP PRO Now!</strong></span></span></div><div style = "padding:10px"><span class="good">** Stick to the target like glue until ICED or KILLED!<br>** Get the Crazy Speed option that only Pro provides<br>** BGF (Back Ground Fighting) does jobs and collects whilst ICEING!</span></div></div>')}function mwapOnOffMenu(){var b=document.getElementById("pauseLink"),c=document.getElementById("resumeLink");b&&c&&(!1===GM_getValue("isRunning")?(b.style.display="none",c.style.display="block"):(b.style.display="block",c.style.display="none"));b=document.getElementById("mafiaLogBox");c=document.getElementById("ap_mwap_pause");b&&c&&(!1===GM_getValue("isRunning")?(destroyByID("ap_mwap_pause"),title="Click to resume RX6 MWAP",c=makeElement("div",b,{"class":"mouseunderline",title:title,id:"ap_mwap_pause","class":"ap_mwap_pause"}),c.appendChild(document.createTextNode("RX6 MWAP is PAUSED, click to resume"))):(destroyByID("ap_mwap_pause"),title="Click to pause RX6 MWAP",c=makeElement("div",b,{"class":"mouseunderline",title:title,id:"ap_mwap_pause","class":"ap_mwap_pause"}),c.appendChild(document.createTextNode("RX6 MWAP is RUNNING, click to pause"))),c.addEventListener("click",mwapOnOff,!1))}function mwapOnOff(){!0===GM_getValue("isRunning")?pause():unPause()}function isFamily(b,c){var a="";b.match(/id\=(.+)\&from_red_link/)&&(a=decodeID(RegExp.$1));for(var d=c==STAMINA_HOW_FIGHT_RANDOM||STAMINA_HOW_FIGHT_BG?getSavedList("fightClanName"):getSavedList("hitmanClanName"),e=0,f=d.length;e<f;++e){var g=d[e];if(g&&(-1!=b.untag().indexOf(g)||g==a))return!0}return!1}function isLoggable(b){var c=GM_getIntValue("filterOpt",0);if(!b||debug||!isGMChecked("filterLog")||isNaN(c)||-1!=b.indexOf("Log filtering")||-1!=b.indexOf('"good">Patterns '))return!0;for(var a=getSavedList(0==c?"filterPass":"filterFail"),d=0,e=a.length;d<e;++d){var f=a[d];if(f&&-1!=b.indexOf(f))return 0==c}return 1==c}function timeStamp(){var b=new Date,c="Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(",")[b.getMonth()]+" "+b.getDate(),b=(10>b.getHours()?0:"")+b.getHours()+":"+(10>b.getMinutes()?0:"")+b.getMinutes()+":"+(10>b.getSeconds()?0:"")+b.getSeconds()+" ";return c+" - "+b+" "}function addToLog(b,c){if((debug||isGMChecked("autoLog"))&&isLoggable(c)){var a=document.getElementById("logBox");a||(addToLog.logBox||(addToLog.logBox=document.createElement("div"),addToLog.logBox.innerHTML=GM_getValue("itemLog","")),a=addToLog.logBox);var d=a.childNodes.length,e;if(d){var f=a.firstChild.childNodes[1];if(f&&f.innerHTML&&(f=f.innerHTML.untag().match(/^(.+?)(?:\s\((\d+) times\))?$/))&&f[1]==(""+c).untag())e=f[2]?parseInt(f[2])+1:2,c+=" ("+e+" times)"}f=document.createElement("div");f.className="logEvent "+b;f.innerHTML='<div class="eventTime">'+timeStamp()+'</div><div class="eventBody">'+c+'</div><div class="clear"></div>';if(e)a.replaceChild(f,a.firstChild);else{a.insertBefore(f,a.firstChild);f=GM_getIntValue("autoLogLength",300);if(500<f||debug)f=500;if(0<f)for(;d-->f;)a.removeChild(a.lastChild)}GM_setValue("itemLog",a.innerHTML);10<e&&goHome()}}function updateLogStats(){var b=document.getElementById("fightCount");b&&(b.firstChild.nodeValue=makeCommaValue(GM_getIntValue("fightWinCountInt",0)+GM_getIntValue("fightLossCountInt",0)),document.getElementById("fightWinCount").firstChild.nodeValue=makeCommaValue(GM_getIntValue("fightWinCountInt",0)),b=(100*(GM_getIntValue("fightWinCountInt",0)/(GM_getIntValue("fightWinCountInt",0)+GM_getIntValue("fightLossCountInt",0)))).toFixed(1),document.getElementById("fightWinPct").firstChild.nodeValue=isNaN(b)?"0.0%":b+"%",document.getElementById("fightLossCount").firstChild.nodeValue=makeCommaValue(GM_getIntValue("fightLossCountInt",0)),b=(100*(GM_getIntValue("fightLossCountInt",0)/(GM_getIntValue("fightWinCountInt",0)+GM_getIntValue("fightLossCountInt",0)))).toFixed(1),document.getElementById("fightLossPct").firstChild.nodeValue=isNaN(b)?"0.0%":b+"%");if(b=document.getElementById("passivefightCount"))b.firstChild.nodeValue=makeCommaValue(GM_getIntValue("passivefightWinCountInt",0)+GM_getIntValue("passivefightLossCountInt",0)),document.getElementById("passivefightWinCount").firstChild.nodeValue=makeCommaValue(GM_getIntValue("passivefightWinCountInt",0)),b=(100*(GM_getIntValue("passivefightWinCountInt",0)/(GM_getIntValue("passivefightWinCountInt",0)+GM_getIntValue("passivefightLossCountInt",0)))).toFixed(1),document.getElementById("passivefightWinPct").firstChild.nodeValue=isNaN(b)?"0.0%":b+"%",document.getElementById("passivefightLossCount").firstChild.nodeValue=makeCommaValue(GM_getIntValue("passivefightLossCountInt",0)),b=(100*(GM_getIntValue("passivefightLossCountInt",0)/(GM_getIntValue("passivefightWinCountInt",0)+GM_getIntValue("passivefightLossCountInt",0)))).toFixed(1),document.getElementById("passivefightLossPct").firstChild.nodeValue=isNaN(b)?"0.0%":b+"%";if(b=document.getElementById("totalPassiveWinDollars")){var c=0,a=0,d="|",e="|";i=0;for(iLength=cityStats.length;i<iLength;i++)c+=GM_getIntValue(cityStats[i][passivecashWins],0),a+=GM_getIntValue(cityStats[i][passivecashLosses],0),d+=" "+cities[i][CITY_CASH_SYMBOL]+makeCommaValue(GM_getIntValue(cityStats[i][passivecashWins],0))+" |",e+=""+cities[i][CITY_CASH_SYMBOL]+makeCommaValue(GM_getIntValue(cityStats[i][passivecashLosses],0))+" |";b.firstChild.nodeValue=getDollarsUnit(c);document.getElementById("totalPassiveLossDollars").firstChild.nodeValue=getDollarsUnit(a);document.getElementById("totalPassiveWinDollars").setAttribute("title",d);document.getElementById("totalPassiveLossDollars").setAttribute("title",e)}document.getElementById("whackedCount")&&(document.getElementById("whackedCount").firstChild.nodeValue=GM_getIntValue("whackedCount",0));document.getElementById("snuffCount")&&(document.getElementById("snuffCount").firstChild.nodeValue=GM_getIntValue("snuffCount",0));if(b=document.getElementById("passivetotalExp"))b.firstChild.nodeValue=makeCommaValue(GM_getIntValue("passivetotalFightExpInt",0)+GM_getIntValue("passivetotalJobExpInt",0)),document.getElementById("passivetotalFightExp").firstChild.nodeValue=makeCommaValue(GM_getIntValue("passivetotalFightExpInt",0)),document.getElementById("passivetotalJobExp").firstChild.nodeValue=makeCommaValue(GM_getIntValue("passivetotalJobExpInt",0));document.getElementById("hitmanCount")&&(document.getElementById("hitmanCount").firstChild.nodeValue=makeCommaValue(GM_getIntValue("hitmanWinCountInt",0)+GM_getIntValue("hitmanLossCountInt",0)),document.getElementById("hitmanWinCount").firstChild.nodeValue=makeCommaValue(GM_getIntValue("hitmanWinCountInt",0)),b=(100*(GM_getIntValue("hitmanWinCountInt",0)/(GM_getIntValue("hitmanWinCountInt",0)+GM_getIntValue("hitmanLossCountInt",0)))).toFixed(1),document.getElementById("hitmanWinPct").firstChild.nodeValue=isNaN(b)?"0.0%":b+"%",document.getElementById("hitmanLossCount").firstChild.nodeValue=makeCommaValue(GM_getIntValue("hitmanLossCountInt",0)),b=(100*(GM_getIntValue("hitmanLossCountInt",0)/(GM_getIntValue("hitmanWinCountInt",0)+GM_getIntValue("hitmanLossCountInt",0)))).toFixed(1),document.getElementById("hitmanLossPct").firstChild.nodeValue=isNaN(b)?"0.0%":b+"%");document.getElementById("robCount")&&(document.getElementById("robCount").firstChild.nodeValue=makeCommaValue(GM_getIntValue("robSuccessCountInt",0)+GM_getIntValue("robFailedCountInt",0)),document.getElementById("robWinCount").firstChild.nodeValue=makeCommaValue(GM_getIntValue("robSuccessCountInt",0)),b=(100*(GM_getIntValue("robSuccessCountInt",0)/(GM_getIntValue("robSuccessCountInt",0)+GM_getIntValue("robFailedCountInt",0)))).toFixed(1),document.getElementById("robWinPct").firstChild.nodeValue=isNaN(b)?"0.0%":b+"%",document.getElementById("robLossCount").firstChild.nodeValue=makeCommaValue(GM_getIntValue("robFailedCountInt",0)),b=(100*(GM_getIntValue("robFailedCountInt",0)/(GM_getIntValue("robSuccessCountInt",0)+GM_getIntValue("robFailedCountInt",0)))).toFixed(1),document.getElementById("robLossPct").firstChild.nodeValue=isNaN(b)?"0.0%":b+"%");if(b=document.getElementById("totalWinDollars")){b.firstChild.nodeValue=getDollarsUnit(GM_getIntValue("totalWinDollarsInt",0));document.getElementById("totalLossDollars").firstChild.nodeValue=getDollarsUnit(GM_getIntValue("totalLossDollarsInt",0));c=b="|";i=0;for(iLength=cityStats.length;i<iLength;i++)b+=" "+cities[i][CITY_CASH_SYMBOL]+makeCommaValue(GM_getIntValue(cityStats[i][cashWins],0))+" |",c+=" "+cities[i][CITY_CASH_SYMBOL]+makeCommaValue(GM_getIntValue(cityStats[i][cashWins],0))+" |";document.getElementById("totalWinDollars").setAttribute("title",b);document.getElementById("totalLossDollars").setAttribute("title",c);document.getElementById("totalExp").firstChild.nodeValue=makeCommaValue(GM_getIntValue("totalExpInt",0))}}function logFilterOnOff(b){var c;c=1!=b?toggleCheckElt("filterLog"):isGMChecked("filterLog");var a=document.getElementById("filterOn"),d=document.getElementById("filterOff");a&&d&&(c?(a.style.display="block",d.style.display="none"):(a.style.display="none",d.style.display="block"));1!=b&&(b=1!=GM_getValue("filterOpt"),a=getSavedList(b?"filterPass":"filterFail"),c=c?'Log filtering disabled. <span class="good">Patterns '+(b?"accepted":"rejected")+"</span>:<br>"+a.join(", "):"Log filtering disabled.",addToLog("info Icon",c),"open"!=GM_getValue("logOpen")&&alert(c))}function debugOnOff(){var b=document.getElementById("debugOn"),c=document.getElementById("debugOff");b&&c&&(isGMChecked("enableDebug")?(addToLog("info Icon","Debug logging disabled.<br>[code]"),GM_setValue("enableDebug",0),debug=!1,"open"!=GM_getValue("logOpen")?alert("Debug logging disabled."):(b.style.display="none",c.style.display="block")):(GM_setValue("enableDebug","checked"),debug=!0,showMafiaLogBox(),addToLog("info Icon","[/code]<br>Debug logging enabled."),b.style.display="block",c.style.display="none",debugDumpSettings()))}function colorDEBUG(b,c,a){isGMChecked("TestChanges")&&(c?DEBUG('<span style="color:'+c+'">'+b+"</span>",a):DEBUG('<span style="color:#FF8C00">'+b+"</span>",a))}function colorLOG(b,c){isGMChecked("TestChanges")&&(c?addToLog("debug Icon",'<span style="color:'+c+'">'+b+"</span>"):addToLog("debug Icon",'<span style="color:#FF8C00">'+b+"</span>"))}function DEBUG(b,c){c=null==c||0==SCRIPT.UseDebugCategory?0:c;debug&&c==SCRIPT.UseDebugCategory&&addToLog("debug Icon",b);SCRIPT.UseDebugConsole&&GM_log(b,c)}function refreshLog(){var b=document.getElementById("logBox");b&&(b.innerHTML=GM_getValue("itemLog",""))}function clearLog(){GM_setValue("itemLog","");document.getElementById("logBox").innerHTML="";addToLog("process Icon","RX6 MWAP Log Cleared")}function clearStats(){GM_setValue("fightWinCountInt",0);GM_setValue("fightLossCountInt",0);GM_setValue("passivefightWinCountInt",0);GM_setValue("passivefightLossCountInt",0);GM_setValue("passivetotalJobExpInt",0);GM_setValue("passivetotalFightExpInt",0);GM_setValue("snuffCount",0);GM_setValue("whackedCount",0);GM_setValue("robSuccessCountInt",0);GM_setValue("robFailedCountInt",0);GM_setValue("hitmanWinCountInt",0);GM_setValue("hitmanWinDollarsInt","0");GM_setValue("hitmanLossCountInt",0);GM_setValue("hitmanLossDollarsInt","0");GM_setValue("totalExpInt",0);GM_setValue("totalRobStamInt",0);GM_setValue("totalWinDollarsInt","0");GM_setValue("totalLossDollarsInt","0");GM_setValue("lastHitXp",0);GM_setValue("totalHits",0);GM_setValue("totalXp",0);GM_setValue("currentHitXp",0);GM_setValue("currentHitDollars","0");i=0;for(iLength=cityStats.length;i<iLength;i++){var b=cityStats[i];j=0;for(jLength=b.length;j<jLength;j++)GM_setValue(b[j],0)}updateLogStats();addToLog("process Icon","RX6 MWAP Stats Cleared")}function showPrimaryStats(){var b=document.getElementById("statPassive"),c=document.getElementById("statPrimary"),a=document.getElementById("btnPrimaryStat"),d=document.getElementById("btnPassiveStat");b&&c&&(b.style.display="none",c.style.display="block",d.style.color="rgb(0, 128, 0)",a.style.color="rgb(0, 255, 0)")}function showPassiveStats(){var b=document.getElementById("statPassive"),c=document.getElementById("statPrimary"),a=document.getElementById("btnPrimaryStat"),d=document.getElementById("btnPassiveStat");b&&c&&(c.style.display="none",b.style.display="block",a.style.color="rgb(0, 128, 0)",d.style.color="rgb(0, 255, 0)")}function resetMDK(){GM_setValue("myIces",0);GM_setValue("myKills",0);GM_setValue("mdkStart",timeStamp());GM_setValue("myFeeds",JSON.stringify([]));updateMDK()}function logMDK(){var b=document.getElementById("logBox"),c=document.getElementById("altlogBox");if(b&&"block"==b.style.display){var a="",d=JSON.parse(GM_getValue("myFeeds",JSON.stringify([])));if(d&&0<d.length)for(i=d.length-1;0<=i;i--)a+='<div style="padding-bottom:3px">'+d[i]+"</div>";else a+="<div>MDK Log Empty!</div>";b.style.display="none";c&&(c.innerHTML=a,c.style.display="block")}else if(b&&(b.style.display="block"),c)c.style.display="none"}function updateMDK(){var b=xpathFirst('.//span[@id="mdkIces"]');b&&(b.innerHTML=GM_getValue("myIces",0));if(b=xpathFirst('.//span[@id="mdkKills"]'))b.innerHTML=GM_getValue("myKills",0);if(b=xpathFirst('.//span[@id="mdkStart"]'))b.innerHTML=GM_getValue("mdkStart",timeStamp())}function createLogBox(){GM_setValue("toggleLog",0);if(!document.getElementById("mafiaLogBox")&&document.body){var b=makeElement("div",document.body,{id:"mafiaLogBox"});eltRow=makeElement("ul",b,{style:"height:15px;"});eltCol=makeElement("li",eltRow,{style:"width:18px;height:15px;"});elt=makeElement("img",eltCol,{src:SCRIPT.PSMWAP_imagePath+"r1_c1.png",style:"width:18px;height:15px;"});eltCol=makeElement("li",eltRow,{style:"width:460px;height:15px;"});elt=makeElement("img",eltCol,{src:SCRIPT.PSMWAP_imagePath+"r1_c2.png",style:"width:460px;height:15px;"});eltCol=makeElement("li",eltRow,{style:"width:20px;height:15px;"});elt=makeElement("img",eltCol,{src:SCRIPT.PSMWAP_imagePath+"r1_c16.png",style:"width:20px;height:15px;"});eltRow=makeElement("ul",b,{style:"height:30px;"});eltCol=makeElement("li",eltRow,{style:"width:18px;height:31px;"});elt=makeElement("img",eltCol,{src:"http://cdn.playerscripts.co.uk/images/mwap_graphics/setlog/left_corner.png",style:"width:18px;height:31px;"});eltCol=makeElement("li",eltRow,{style:"width:46px;height:30px;background-image:url('http://cdn.playerscripts.co.uk/images/mwap_graphics/setlog/placeholder.png');"});eltCol.addEventListener("click",mwapOnOff,!1);eltA=makeElement("a",eltCol,{href:"#","class":"pauseLink",alt:"pause",title:"pause",id:"pauseLink",style:running?"display:block;":"display:none;"});isGMChecked("textOnlyMode")&&eltA.appendChild(document.createTextNode("Pause"));eltA=makeElement("a",eltCol,{href:"#","class":"resumeLink",alt:"resume",title:"resume",id:"resumeLink",style:running?"display:none;":"display:block;"});isGMChecked("textOnlyMode")&&eltA.appendChild(document.createTextNode("Resume"));eltCol=makeElement("li",eltRow);eltCol.addEventListener("click",clearLog,!1);eltA=makeElement("a",eltCol,{href:"#","class":"clearLogLink",alt:"clear log",title:"clear log"});isGMChecked("textOnlyMode")&&eltA.appendChild(document.createTextNode("...Clear Log"));eltCol=makeElement("li",eltRow);eltCol.addEventListener("click",clearStats,!1);eltA=makeElement("a",eltCol,{href:"#","class":"clearStatsLink",alt:"clear stats",title:"clear stats"});isGMChecked("textOnlyMode")&&eltA.appendChild(document.createTextNode("...Clear Stats"));eltCol=makeElement("li",eltRow);eltCol.addEventListener("click",toggleSettings,!1);eltA=makeElement("a",eltCol,{href:"#","class":"toggleSettingsLink",alt:"settings",title:"settings"});isGMChecked("textOnlyMode")&&eltA.appendChild(document.createTextNode("...Settings"));eltCol=makeElement("li",eltRow);eltCol.addEventListener("click",logFilterOnOff,!1);eltA=makeElement("a",eltCol,{href:"#",id:"filterOn","class":"filterActiveLink",alt:"filter off",title:"filter on",style:filter?"display:block;":"display:none;"});isGMChecked("textOnlyMode")&&eltA.appendChild(document.createTextNode(".Filter On "));eltA=makeElement("a",eltCol,{href:"#",id:"filterOff","class":"filterNotActiveLink",alt:"filter on",title:"filter off",style:filter?"display:none;":"display:block;"});isGMChecked("textOnlyMode")&&eltA.appendChild(document.createTextNode(".Filter Off"));eltCol=makeElement("li",eltRow);eltCol.addEventListener("click",debugOnOff,!1);eltA=makeElement("a",eltCol,{href:"#",id:"debugOn","class":"debugActiveLink",alt:"debug off",title:"debug on",style:debug?"display:block;":"display:none;"});isGMChecked("textOnlyMode")&&eltA.appendChild(document.createTextNode("Debug On "));eltA=makeElement("a",eltCol,{href:"#",id:"debugOff","class":"debugNotActiveLink",alt:"debug on",title:"debug off",style:debug?"display:none;":"display:block;"});isGMChecked("textOnlyMode")&&eltA.appendChild(document.createTextNode("Debug Off"));eltCol=makeElement("li",eltRow,{style:"width:40px;height:30px;background-image:url('http://cdn.playerscripts.co.uk/images/mwap_graphics/setlog/placeholder.png');"});eltCol=makeElement("li",eltRow);eltCol.addEventListener("click",hideMafiaLogBox,!1);eltA=makeElement("a",eltCol,{href:"#","class":"closeLink",alt:"close",title:"close"});isGMChecked("textOnlyMode")&&eltA.appendChild(document.createTextNode(".X"));eltCol=makeElement("li",eltRow,{style:"width:20px;height:31px;"});elt=makeElement("img",eltCol,{src:"http://cdn.playerscripts.co.uk/images/mwap_graphics/setlog/right_corner.png",style:"width:20px;height:31px;"});eltRow=makeElement("ul",b);eltCol=makeElement("li",eltRow,{style:"width:479px;padding: 0px;margin:0px;border-left:3px solid #B70B0B;border-right:3px solid #B70B0B;float:left;position: absolute; right: 0px; top: 45px; bottom: 15px; margin-left:0px;margin-right:8px;"});topOffSet="0px";if(1==parseXMLResponse()){GM_getValue("mdkStart","")||GM_setValue("mdkStart",timeStamp());var c=makeElement("div",eltCol,{id:"mdkContainer",style:"float:left;position: absolute; left: 0px; top: 0px; width: 469px;padding:5px;height:18px;background-color: #000000; font-size:12px; color: #BCD2EA; text-align:left;border-bottom:2px solid #B70B0B;"}),a=makeElement("span",c).appendChild(document.createTextNode(" MDK Start: "));makeElement("span",c,{id:"mdkStart",style:"font-weight:bold;"}).appendChild(document.createTextNode(GM_getValue("mdkStart",timeStamp())));makeElement("span",c).appendChild(document.createTextNode(" | Ices: "));makeElement("span",c,{id:"mdkIces",style:"color:#00FFFF;font-weight:bold;"}).appendChild(document.createTextNode(GM_getIntValue("myIces",0)));makeElement("span",c).appendChild(document.createTextNode(" | Kills: "));makeElement("span",c,{id:"mdkKills",style:"color:#FF0000;font-weight:bold;"}).appendChild(document.createTextNode(GM_getIntValue("myKills",0)));makeElement("span",c).appendChild(document.createTextNode("  "));a=makeElement("span",c);a.addEventListener("click",resetMDK,!1);eltA=makeElement("a",a,{href:"#","class":"mouseunderline",alt:"reset MDK",title:"resetMDK",style:"font-weight:bold;padding:0px 10px 0px 10px;border:1px solid;margin-left:10px;margin-right:5px"});eltA.appendChild(document.createTextNode("RESET"));makeElement("span",c).appendChild(document.createTextNode(" "));a=makeElement("span",c);a.addEventListener("click",logMDK,!1);eltA=makeElement("a",a,{href:"#","class":"mouseunderline",alt:"toggle log",title:"toggle log",style:"font-weight:bold;padding:0px 10px 0px 10px;border:1px solid;"});eltA.appendChild(document.createTextNode("SWITCH"));topOffSet="30px"}if(isGMChecked("noStats"))c=makeElement("div",eltCol,{id:"logContainer",style:"float:left;position: absolute; left: 0px; top: "+topOffSet+"; bottom: 0px; width: 479px; background-color: #000000; font-size:11px; color: #BCD2EA; text-align:left;"}),a=makeElement("div",c,{id:"logBox",style:"float:left;position: absolute; overflow:scroll; overflow-x: hidden;left: 0px; top: 8px; bottom: 0px; width: 465px;padding:5px;margin-bottom:5px;background-image:url('http://cdn.playerscripts.co.uk/images/mwap_graphics/setlog/logbox2_15.png');background-position:center top;display:block;"}),makeElement("div",c,{id:"altlogBox",style:"float:left;position: absolute; overflow:scroll; overflow-x: hidden;left: 0px; top: 8px; bottom: 0px; width: 465px;padding:5px;margin-bottom:5px;background-image:url('http://cdn.playerscripts.co.uk/images/mwap_graphics/setlog/logbox2_15.png');background-position:center top;display:none;"}),a.innerHTML=GM_getValue("itemLog","");else{c=makeElement("div",eltCol,{id:"logContainer",style:"float:left;position: absolute; left: 0px; top: "+topOffSet+"; bottom: 75px; width: 479px; background-color: #000000; font-size:11px; color: #BCD2EA; text-align:left;border-bottom:2px solid #B70B0B;"});a=makeElement("div",c,{id:"logBox",style:"float:left;position: absolute; overflow:scroll; overflow-x: hidden;left: 0px; top: 8px; bottom: 0px; width: 465px;padding:5px;margin-bottom:5px;background-image:url('http://cdn.playerscripts.co.uk/images/mwap_graphics/setlog/logbox2_15.png');background-position:center top;display:block;"});makeElement("div",c,{id:"altlogBox",style:"float:left;position: absolute; overflow:scroll; overflow-x: hidden;left: 0px; top: 8px; bottom: 0px; width: 465px;padding:5px;margin-bottom:5px;background-image:url('http://cdn.playerscripts.co.uk/images/mwap_graphics/setlog/logbox2_15.png');background-position:center top;display:none;"});a.innerHTML=GM_getValue("itemLog","");var c=makeElement("div",b,{id:"statPrimary",style:"display: block;"}),a=makeElement("div",b,{id:"statPassive",style:"display: none;"}),d=makeElement("div",b,{id:"btnPrimaryStat","class":"mouseunderline",style:"position: absolute; left: 10px; bottom: 76px; font-weight: 600; cursor: pointer; color: rgb(0, 255, 0);"});d.appendChild(document.createTextNode("primary"));d.addEventListener("click",showPrimaryStats,!1);d=makeElement("div",b,{id:"btnPassiveStat","class":"mouseunderline",style:"position: absolute; left: 90px; bottom: 76px; font-weight: 600; cursor: pointer; color: rgb(0, 128, 0);"});d.appendChild(document.createTextNode("passive"));d.addEventListener("click",showPassiveStats,!1);makeElement("div",a,{style:"position: absolute; left: 15px; bottom: 65px; font-size: 10px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Exp Gained:"));makeElement("div",a,{id:"passivetotalExp",style:"position: absolute; right: 325px; bottom: 65px; font-size: 10px; font-weight: 600;color: #52E259;"}).appendChild(document.createTextNode(makeCommaValue(GM_getValue("passivetotalFightExpInt",0)+GM_getValue("passivetotalJobExpInt",0))));makeElement("div",a,{style:"position: absolute; right: 262px; bottom: 65px; font-size: 10px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Fights:"));makeElement("div",a,{id:"passivetotalFightExp",style:"position: absolute; right: 225px; bottom: 65px; font-size: 10px; font-weight: 600;color: #52E259;"}).appendChild(document.createTextNode(makeCommaValue(GM_getValue("passivetotalFightExpInt",0))));makeElement("div",a,{style:"position: absolute; right: 175px; bottom: 65px; font-size: 10px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Jobs:"));makeElement("div",a,{id:"passivetotalJobExp",style:"position: absolute; right: 135px; bottom: 65px; font-size: 10px; font-weight: 600;color: #52E259;"}).appendChild(document.createTextNode(makeCommaValue(GM_getValue("passivetotalJobExpInt",0))));makeElement("hr",a,{style:"position: absolute; left: 0; bottom: 57px; height: 1px; border: 0px; width: 475px; margin-left:10px; color: #666666; background-color: #666666"});makeElement("div",a,{style:"position: absolute; left: 15px; bottom: 48px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Attacks:"));makeElement("div",a,{id:"passivefightCount",style:"position: absolute; right: 360px; bottom: 48px; font-weight: 600;color: #BCD2EA;"}).appendChild(document.createTextNode(makeCommaValue(GM_getIntValue("passivefightWinCountInt",0)+GM_getIntValue("passivefightLossCountInt",0))));makeElement("div",a,{style:"position: absolute; left: 15px; bottom: 33px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Won:"));makeElement("div",a,{id:"passivefightWinCount",style:"position: absolute; right: 360px; bottom: 33px; font-weight: 600;color: #52E259;"}).appendChild(document.createTextNode(makeCommaValue(GM_getValue("passivefightWinCountInt",0))));d=(100*(GM_getValue("passivefightWinCountInt",0)/(GM_getValue("passivefightWinCountInt",0)+GM_getValue("passivefightLossCountInt",0)))).toFixed(1);makeElement("div",a,{id:"passivefightWinPct",style:"position: absolute; right: 325px; bottom: 33px; font-size: 10px; font-weight: 100;color: #52E259;"}).appendChild(document.createTextNode(isNaN(d)?"0.0%":d+"%"));makeElement("div",a,{style:"position: absolute; left: 15px; bottom: 18px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Lost:"));makeElement("div",a,{id:"passivefightLossCount",style:"position: absolute; right: 360px; bottom: 18px; font-weight: 600;color: #EC2D2D;"}).appendChild(document.createTextNode(makeCommaValue(GM_getValue("passivefightLossCountInt",0))));d=(100*(GM_getValue("passivefightLossCountInt",0)/(GM_getValue("passivefightWinCountInt",0)+GM_getValue("passivefightLossCountInt",0)))).toFixed(1);makeElement("div",a,{id:"passivefightLossPct",style:"position: absolute; right: 325px; bottom: 18px; font-size: 10px; font-weight: 100;color: #EC2D2D;"}).appendChild(document.createTextNode(isNaN(d)?"0.0%":d+"%"));makeElement("div",a,{style:"position: absolute; left: 190px; bottom: 48px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("HitListed:"));makeElement("div",a,{id:"whackedCount",style:"position: absolute; right: 220px; bottom: 48px; font-weight: 600;color: #BCD2EA;"}).appendChild(document.createTextNode(GM_getValue("whackedCount",0)));makeElement("div",a,{style:"position: absolute; left: 190px; bottom: 33px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Snuffed:"));makeElement("div",a,{id:"snuffCount",style:"position: absolute; right: 220px; bottom: 33px; font-weight: 600;color: #52E259;"}).appendChild(document.createTextNode(GM_getValue("snuffCount",0)));makeElement("div",a,{style:"position: absolute; right: 15px; bottom: 48px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Total $ Won/Lost"));var e=d=0,f="|",g="|";i=0;for(iLength=cityStats.length;i<iLength;i++)d+=GM_getIntValue(cityStats[i][passivecashWins],0),e+=GM_getIntValue(cityStats[i][passivecashLosses],0),f+=" "+cities[i][CITY_CASH_SYMBOL]+makeCommaValue(GM_getValue(cityStats[i][passivecashWins],0))+" |",g+=""+cities[i][CITY_CASH_SYMBOL]+makeCommaValue(GM_getValue(cityStats[i][passivecashLosses],0))+" |";makeElement("div",a,{id:"totalPassiveWinDollars",title:f,style:"position: absolute; right: 15px; bottom: 33px; font-weight: 600;color: #52E259;"}).appendChild(document.createTextNode(getDollarsUnit(d)));makeElement("div",a,{id:"totalPassiveLossDollars",title:g,style:"position: absolute; right: 15px; bottom: 18px; font-weight: 600;color: #EC2D2D;"}).appendChild(document.createTextNode(getDollarsUnit(e)));makeElement("div",c,{style:"position: absolute; left: 15px; bottom: 43px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Fights:"));makeElement("div",c,{id:"fightCount",style:"position: absolute; right: 380px; bottom: 43px; font-weight: 600;color: #BCD2EA;"}).appendChild(document.createTextNode(makeCommaValue(GM_getIntValue("fightWinCountInt",0)+GM_getIntValue("fightLossCountInt",0))));makeElement("div",c,{style:"position: absolute; left: 15px; bottom: 28px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Won:"));makeElement("div",c,{id:"fightWinCount",style:"position: absolute; right: 380px; bottom: 28px; font-weight: 600;color: #52E259;"}).appendChild(document.createTextNode(makeCommaValue(GM_getValue("fightWinCountInt",0))));a=(100*(GM_getValue("fightWinCountInt",0)/(GM_getValue("fightWinCountInt",0)+GM_getValue("fightLossCountInt",0)))).toFixed(1);makeElement("div",c,{id:"fightWinPct",style:"position: absolute; right: 345px; bottom: 28px; font-size: 10px; font-weight: 100;color: #52E259;"}).appendChild(document.createTextNode(isNaN(a)?"0.0%":a+"%"));makeElement("div",c,{style:"position: absolute; left: 15px; bottom: 13px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Lost:"));makeElement("div",c,{id:"fightLossCount",style:"position: absolute; right: 380px; bottom: 13px; font-weight: 600;color: #EC2D2D;"}).appendChild(document.createTextNode(makeCommaValue(GM_getValue("fightLossCountInt",0))));a=(100*(GM_getValue("fightLossCountInt",0)/(GM_getValue("fightWinCountInt",0)+GM_getValue("fightLossCountInt",0)))).toFixed(1);makeElement("div",c,{id:"fightLossPct",style:"position: absolute; right: 345px; bottom: 13px; font-size: 10px; font-weight: 100;color: #EC2D2D;"}).appendChild(document.createTextNode(isNaN(a)?"0.0%":a+"%"));makeElement("div",c,{style:"position: absolute; left: 170px; bottom: 43px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Hits:"));makeElement("div",c,{id:"hitmanCount",style:"position: absolute; right: 260px; bottom: 43px; font-weight: 600;color: #BCD2EA;"}).appendChild(document.createTextNode(makeCommaValue(GM_getIntValue("hitmanWinCountInt",0)+GM_getIntValue("hitmanLossCountInt",0))));makeElement("div",c,{style:"position: absolute; left: 170px; bottom: 28px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Succ:"));makeElement("div",c,{id:"hitmanWinCount",style:"position: absolute; right: 260px; bottom: 28px; font-weight: 600;color: #52E259;"}).appendChild(document.createTextNode(makeCommaValue(GM_getValue("hitmanWinCountInt",0))));a=(100*(GM_getValue("hitmanWinCountInt",0)/(GM_getValue("hitmanWinCountInt",0)+GM_getValue("hitmanLossCountInt",0)))).toFixed(1);makeElement("div",c,{id:"hitmanWinPct",style:"position: absolute; right: 225px; bottom: 28px; font-size: 10px; font-weight: 100;color: #52E259;"}).appendChild(document.createTextNode(isNaN(a)?"0.0%":a+"%"));makeElement("div",c,{style:"position: absolute; left: 170px; bottom: 13px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Fail:"));makeElement("div",c,{id:"hitmanLossCount",style:"position: absolute; right: 260px; bottom: 13px; font-weight: 600;color: #EC2D2D;"}).appendChild(document.createTextNode(makeCommaValue(GM_getValue("hitmanLossCountInt",0))));a=(100*(GM_getValue("hitmanLossCountInt",0)/(GM_getValue("hitmanWinCountInt",1)+GM_getValue("hitmanLossCountInt",0)))).toFixed(1);makeElement("div",c,{id:"hitmanLossPct",style:"position: absolute; right: 225px; bottom: 13px; font-size: 10px; font-weight: 100;color: #EC2D2D;"}).appendChild(document.createTextNode(isNaN(a)?"0.0%":a+"%"));makeElement("div",c,{style:"position: absolute; left: 280px; bottom: 43px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Robs:"));makeElement("div",c,{id:"robCount",style:"position: absolute; right: 135px; bottom: 43px; font-weight: 600;color: #BCD2EA;"}).appendChild(document.createTextNode(makeCommaValue(GM_getIntValue("robSuccessCountInt",0)+GM_getIntValue("robFailedCountInt",0))));makeElement("div",c,{style:"position: absolute; left: 280px; bottom: 28px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Succ:"));makeElement("div",c,{id:"robWinCount",style:"position: absolute; right: 135px; bottom: 28px; font-weight: 600;color: #52E259;"}).appendChild(document.createTextNode(makeCommaValue(GM_getValue("robSuccessCountInt",0))));a=(100*(GM_getValue("robSuccessCountInt",0)/(GM_getValue("robSuccessCountInt",0)+GM_getValue("robFailedCountInt",0)))).toFixed(1);makeElement("div",c,{id:"robWinPct",style:"position: absolute; right: 100px; bottom: 28px; font-size: 10px; font-weight: 100;color: #52E259;"}).appendChild(document.createTextNode(isNaN(a)?"0.0%":a+"%"));makeElement("div",c,{style:"position: absolute; left: 280px; bottom: 13px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Fail:"));makeElement("div",c,{id:"robLossCount",style:"position: absolute; right: 135px; bottom: 13px; font-weight: 600;color: #EC2D2D;"}).appendChild(document.createTextNode(makeCommaValue(GM_getValue("robFailedCountInt",0))));a=(100*(GM_getValue("robFailedCountInt",0)/(GM_getValue("robSuccessCountInt",1)+GM_getValue("robFailedCountInt",0)))).toFixed(1);makeElement("div",c,{id:"robLossPct",style:"position: absolute; right: 100px; bottom: 13px; font-size: 10px; font-weight: 100;color: #EC2D2D;"}).appendChild(document.createTextNode(isNaN(a)?"0.0%":a+"%"));makeElement("div",c,{style:"position: absolute; right: 15px; bottom: 43px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Total $ Won/Lost"));d=a="|";i=0;for(iLength=cityStats.length;i<iLength;i++)a+=" "+cities[i][CITY_CASH_SYMBOL]+makeCommaValue(GM_getValue(cityStats[i][cashWins],0))+" |",d+=""+cities[i][CITY_CASH_SYMBOL]+makeCommaValue(GM_getValue(cityStats[i][cashLosses],0))+" |";makeElement("div",c,{id:"totalWinDollars",title:a,style:"position: absolute; right: 15px; bottom: 28px; font-weight: 600;color: #52E259;"}).appendChild(document.createTextNode(getDollarsUnit(GM_getIntValue("totalWinDollarsInt",0))));makeElement("div",c,{id:"totalLossDollars",title:d,style:"position: absolute; right: 15px; bottom: 13px; font-weight: 600;color: #EC2D2D;"}).appendChild(document.createTextNode(getDollarsUnit(GM_getIntValue("totalLossDollarsInt",0))));makeElement("div",c,{style:"position: absolute; left: 15px; bottom: 65px; font-size: 10px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Exp Gained:"));makeElement("div",c,{id:"totalExp",style:"position: absolute; right: 369px; bottom: 65px; font-size: 10px; font-weight: 600;color: #52E259;"}).appendChild(document.createTextNode(makeCommaValue(GM_getValue("totalExpInt",0))));makeElement("hr",c,{style:"position: absolute; left: 0; bottom: 57px; height: 1px; border: 0px; width: 475px; margin-left:10px; color: #666666; background-color: #666666"});makeElement("div",c,{style:"position: absolute; right: 287px; bottom: 65px; font-size: 10px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Gain Rate:"));a=getStaminaGainRate();makeElement("div",c,{id:"expRate",style:"position: absolute; right: 260px; bottom: 65px; font-size: 10px; font-weight: 600;color: #04B4AE;"}).appendChild(document.createTextNode(a.toFixed(2)));makeElement("div",c,{style:"position: absolute; right: 195px; bottom: 65px; font-size: 10px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Nxt Lvl In:"));makeElement("div",c,{id:"expToNext",style:"position: absolute; right: 161px; bottom: 65px; font-size: 10px; font-weight: 600;color: #04B4AE;"}).appendChild(document.createTextNode(makeCommaValue(ptsToNextLevel)));makeElement("div",c,{style:"position: absolute; right: 56px; bottom: 65px; font-size: 10px; font-weight: 100;color: #666666;"}).appendChild(document.createTextNode("Stam Req'd to Lvl:"));makeElement("div",c,{id:"stamToNext",style:"position: absolute; right: 22px; bottom: 65px; font-size: 10px; font-weight: 600;color: #04B4AE;"}).appendChild(document.createTextNode(a?(ptsToNextLevel/a).toFixed(0):"n/a"))}eltRow=makeElement("ul",b,{style:"height:15px;position: absolute; overflow: hidden; right: 0px; bottom: 0px;margin:0px;padding:0px;"});eltCol=makeElement("li",eltRow,{style:"width:18px;height:15px;"});elt=makeElement("img",eltCol,{src:SCRIPT.PSMWAP_imagePath+"r6_c1.png",style:"width:18px;height:15px;"});eltCol=makeElement("li",eltRow,{style:"width:460px;height:15px;"});elt=makeElement("img",eltCol,{src:SCRIPT.PSMWAP_imagePath+"r6_c2.png",style:"width:460px;height:15px;"});eltCol=makeElement("li",eltRow,{style:"width:20px;height:15px;"});elt=makeElement("img",eltCol,{src:SCRIPT.PSMWAP_imagePath+"r6_c16.png",style:"width:20px;height:15px;"})}}function getDollarsUnit(b){for(var c=0;1E3<b;)b/=1E3,c++;return",K,M,G,T,P".split(",")[c]+"$"+b.toFixed(3)}function createSettingsBox(){var b=[["General_Tab","generalTab","generalLink","General"],["Display_Tab","displayTab","displayLink","Display"],["Mafia_Tab","mafiaTab","mafiaLink","Mafia"],["Help_Missions_Tab","familyTab","helpmissionsLink","Family"],["Autostat_Tab","autostatTab","autostatLink","Auto Stat"],["Energy_Tab","energyTab","energyLink","Energy"],["Stamina_Tab","staminaTab","staminaLink","Stamina"],["Heal_Tab","healTab","healLink","Health"],["Cash_Tab","cashTab","cashLink","Cash"],["About_Tab","aboutTab","aboutLink","About"]];if(!document.getElementById("MWAPSettingsBox")&&document.body){var c=makeElement("div",document.body,{id:"MWAPSettingsBox"}),a=makeElement("ul",c,{style:"height:15px;"}),d=makeElement("li",a,{style:"width:18px;height:15px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r1_c1.png",style:"width:18px;height:15px;"});d=makeElement("li",a,{style:"width:762px;height:15px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r1_c2.png",style:"width:762px;height:15px;"});d=makeElement("li",a,{style:"width:20px;height:15px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r1_c16.png",style:"width:20px;height:15px;"});a=makeElement("ul",c,{id:"tabNav",style:"height:31px;"});d=makeElement("li",a,{style:"width:18px;height:31px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r2_c1.png",style:"width:18px;height:31px;"});i=0;for(iLength=b.length;i<iLength;i++){var e=b[i],d=makeElement("li",a,{"class":0==i?"selected":"",id:e[0]}),d=makeElement("a",d,{href:"#",rel:e[1],"class":e[2],alt:e[3],title:e[3]});isGMChecked("textOnlyMode")&&d.appendChild(document.createTextNode("."+e[3]))}d=makeElement("li",a);d.addEventListener("click",toggleSettings,!1);d=makeElement("a",d,{href:"#","class":"closeLink",alt:"close",title:"close"});isGMChecked("textOnlyMode")&&d.appendChild(document.createTextNode("..........X"));d=makeElement("li",a,{style:"width:20px;height:31px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r2_c16.png",style:"width:20px;height:31px;"});a=makeElement("ul",c,{style:"height:20px;"});d=makeElement("li",a,{style:"width:18px;height:20px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r3_c1.png",style:"width:18px;height:20px;float:left;"});makeElement("li",a,{style:"width:200px; height:20px;text-align:center;"});d=makeElement("li",a,{style:"width:85px; height:20px;text-align:center;"});d=makeElement("a",d,{href:"#",alt:"default settings",title:"default setttings",style:"width:85px;","class":"settingsLink"});d.appendChild(document.createTextNode("Use Defaults"));d.addEventListener("click",saveDefaultSettings,!1);d=makeElement("li",a,{style:"width:85px; height:20px;text-align:center;"});d=makeElement("a",d,{href:"#",alt:"save settings",title:"save setttings",style:"width:85px;","class":"settingsLink"});d.appendChild(document.createTextNode("Save Settings"));d.addEventListener("click",saveSettings,!1);gvar.isGreaseMonkey?(d=makeElement("li",a,{style:"width:60px; height:20px;text-align:center;"}),d=makeElement("a",d,{href:"#",alt:"update",title:"update",style:"width:60px;","class":"settingsLink"}),d.appendChild(document.createTextNode("Update")),d.addEventListener("click",updateScript,!1)):makeElement("li",a,{style:"width:55px; height:20px;"});makeElement("li",a,{id:"tabHeaderTitle",style:"width:242px; height:20px;"});d=makeElement("li",a,{style:"width:90px; height:20px;"});makeElement("a",d,{href:"http://mwap.me.uk/forum.html",target:"_none","class":"helpLink"});d=makeElement("li",a,{style:"width:20px;height:20px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r3_c16.png",style:"width:20px;height:20px;"});a=makeElement("ul",c,{style:"height:464px;"});d=makeElement("li",a,{style:"width:18px;height:464px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r3_c1.png",style:"width:18px;height:464px;float:left;"});d=makeElement("li",a,{style:"width:762px;height:464px;"});b=makeElement("div",d,{id:"settingsBox"});e=createGeneralTab();b.appendChild(e);e=createDisplayTab();b.appendChild(e);e=createMafiaTab();b.appendChild(e);e=createFamilyTab();b.appendChild(e);e=createAutostatTab();b.appendChild(e);e=createEnergyTab();b.appendChild(e);e=createStaminaTab();b.appendChild(e);e=createHealTab();b.appendChild(e);e=createCashTab();b.appendChild(e);e=createAboutTab();b.appendChild(e);d=makeElement("li",a,{style:"width:20px;height:15px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r3_c16.png",style:"width:20px;height:464px;"});a=makeElement("ul",c,{style:"height:70px;"});d=makeElement("li",a,{style:"width:18px;height:70px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r5_c1.png",style:"width:18px;height:70px;"});d=makeElement("li",a);makeElement("a",d,{href:"http://mwap.me.uk/sign-up-today/pro-compare.html",target:"_blank","class":"mwapLink",alt:"mwap.me.uk",title:"mwap.me.uk"});d=makeElement("li",a,{style:"width:147px;height:70px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r5_c4.png",style:"width:147px;height:70px;"});makeElement("li",a,{style:"width:155px;height:70px;"});gvar.isGreaseMonkey?(d=makeElement("li",a),d=makeElement("a",d,{href:"#","class":"updateButton",alt:"update",title:"update"}),d.addEventListener("click",updateScript,!1)):(d=makeElement("li",a,{style:"width:152px;height:70px;"}),makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"mwap_int_web_r5_c4.png",style:"width:152px;height:70px;"}));d=makeElement("li",a);d=makeElement("a",d,{href:"#","class":"saveButton",alt:"save settings",title:"save settings"});d.addEventListener("click",saveSettings,!1);d=makeElement("li",a);makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r5_c16.png",style:"width:20px;height:70px;"});a=makeElement("ul",c,{style:"height:15px;"});d=makeElement("li",a,{style:"width:18px;height:15px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r6_c1.png",style:"width:18px;height:15px;"});d=makeElement("li",a,{style:"width:762px;height:15px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r6_c2.png",style:"width:762px;height:15px;"});d=makeElement("li",a,{style:"width:20px;height:15px;"});makeElement("img",d,{src:SCRIPT.PSMWAP_imagePath+"r6_c16.png",style:"width:20px;height:15px;"});createDynamicDrive()}}function createDynamicDrive(){function b(){if(!document.getElementById("ddriveCode")){var a=makeElement("script",document.getElementsByTagName("head")[0],{id:"ddriveCode",type:"text/javascript"});a.src="http://cdn.playerscripts.co.uk/psmwap/tabURI.js";a.id="ddriveCode";window.setTimeout(b,350)}}var c=document.getElementById("ddriveCode");c&&c.parentNode.removeChild(c);b()}function createGeneralTab(){function b(a){d=makeElement("div",a);f=makeElement("div",d,{"class":"lhs"});g=makeElement("div",d,{"class":"rhs"});makeElement("br",d,{"class":"hide"})}var c,a,d,e,f,g,h,k=makeElement("div",null,{id:"generalTab","class":"tabcontent"});makeElement("div",k,{style:"width:762px;height:20px;border:none #FFFFFF;float:left;font-size: 18px; font-weight: bold;"}).appendChild(document.createTextNode("General Settings:"));var l=makeElement("div",k,{style:"position: relative; top: 10px; margin-left: auto; margin-right: auto; width: 100%; line-height:120%;"});b(l);makeElement("label",f,{"for":a,title:c}).appendChild(document.createTextNode(" General MWAP speed: "));a=makeElement("select",g,{id:"fastMWAPSpeed"});iLength=mwapSpeedModes.length;1!=parseXMLResponse()&&(iLength-=2);for(e=0;e<iLength;++e)h=document.createElement("option"),h.value=e,h.appendChild(document.createTextNode(mwapSpeedModes[e])),a.appendChild(h);a.selectedIndex=GM_getValue("fastMWAPSpeed",0);b(l);c="Check this to enable auto-pause before or after level up.";a="autoPause";e=makeElement("input",f,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",f,{"for":a}).appendChild(document.createTextNode(" Enable auto-pause:"));e.addEventListener("click",clickAutoPause,!1);a="autoPauseBefore";c=" Before level up ";makeElement("input",g,{type:"radio",name:"r3",id:a,value:"checked"},a);makeElement("label",g,{"for":a}).appendChild(document.createTextNode(c));a="autoPauseAfter";c=" After level up ";makeElement("input",g,{type:"radio",name:"r3",id:a,value:"checked"},a);makeElement("label",g,{"for":a}).appendChild(document.createTextNode(c));b(l);a="autoPauseExp";g.appendChild(document.createTextNode("  Experience left to pause at: "));makeElement("input",g,{style:"text-align: right;",type:"text",value:GM_getValue(a,"50"),id:a,size:"2"});b(l);makeElement("label",f,{"for":"idleLocation",title:"Check to idle in preferred city"}).appendChild(document.createTextNode(" When idle, fly to:"));a=makeElement("select",g,{id:"idleLocation"});e=0;for(iLength=cities.length;e<iLength;++e)h=document.createElement("option"),h.value=e,e<cities.length&&cities[e][CITY_CLOSED]&&(h.style.display="none"),h.appendChild(document.createTextNode(cities[e][CITY_NAME])),GM_getIntValue("idleLocation",NY)==e&&(a.selected=!0),a.appendChild(h);a.selectedIndex=GM_getValue("idleLocation",NY);b(l);c="Prioritise Energy / Stamina:";a="burnOption";makeElement("label",f,{"for":a,title:c}).appendChild(document.createTextNode(c));var n=makeElement("select",g,{id:a});e=0;for(iLength=burnModes.length;e<iLength;++e)h=document.createElement("option"),h.value=e,h.appendChild(document.createTextNode(burnModes[e])),n.appendChild(h);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" burning."));n.selectedIndex=GM_getValue("burnOption",BURN_ALL);b(l);makeElement("br",d,{"class":"hide"});a="autoProcessPopups";c=" Try to process all popups when RX6 MWAP is running";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a}).appendChild(document.createTextNode(c));if(1!=parseXMLResponse())return b(l),makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Enable Auto Slot Machine Collection (PRO VERSION)")),b(l),makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Enable Free 3 Slot Spins Daily Collection (PRO VERSION)")),b(l),makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Enable Reallocation Check (Popup) (PRO VERSION)")),k;b(l);a="AutoSlotMachine";c="Enable AutoSlotMachine";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Enable Auto Slot Machine Collection"));b(l);a="autoSlot3FreeSpins";c="Enable Auto 3 Free Spin Collect";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Enable Free 3 Slot Spins Daily Collection"));b(l);a="autoCheckReallocation";c="Enable Reallocation Check";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Enable Reallocation Check (Popup)"));return k}function createDisplayTab(){function b(a){d=makeElement("div",a);f=makeElement("div",d,{"class":"lhs"});g=makeElement("div",d,{"class":"rhs"});makeElement("br",d,{"class":"hide"})}var c,a,d,e,f,g,h=makeElement("div",null,{id:"displayTab","class":"tabcontent"});makeElement("div",h,{style:"width:762px;height:20px;border:none #FFFFFF;float:left;font-size: 18px; font-weight: bold;"}).appendChild(document.createTextNode("Display Settings:"));var k=makeElement("div",h,{style:" top: 10px; margin-left: auto; margin-right: auto; width: 100%; line-height:120%;"});b(k);a="textOnlyMode";c="Use text labels when Images are Blocked";makeElement("input",g,{type:"checkbox",id:a},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Use text labels when Images are Blocked."));b(k);a="autoLog";c="Check this to enable logging.";makeElement("input",f,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",f,{"for":a,title:c}).appendChild(document.createTextNode(" Enable logging:"));a="autoLogLength";makeElement("input",g,{type:"text",id:a,value:GM_getValue(a,"300"),size:"2",style:"text-align: left"});g.appendChild(document.createTextNode(" max # of messages in log"));b(k);a="filterLog";makeElement("input",f,{type:"checkbox",title:"Check this to enable log filtering",id:a,value:"checked"},a);makeElement("label",f,{"for":a}).appendChild(document.createTextNode(" Enable log filtering:"));a="filterOpt";var l=makeElement("select",g,{id:a}),n=["Accept patterns","Reject patterns"];c=0;for(iLength=n.length;c<iLength;++c)e=document.createElement("option"),e.value=c,e.appendChild(document.createTextNode(n[c])),l.appendChild(e);l.selectedIndex=GM_getValue(a,0);b(k);var o=makeElement("textarea",g,{style:"position: static; width: 15em; height: 7em;",id:"filterPatterns",title:"Enter each pattern on a separate line."});o.appendChild(document.createTextNode(""));makeElement("br",g);makeElement("font",g,{style:"font-size: 10px;"}).appendChild(document.createTextNode("Enter each name pattern on a separate line."));a=function(){var a=0==l.selectedIndex?defaultPassPatterns.join("\n"):defaultFailPatterns.join("\n");o.firstChild.nodeValue=GM_getValue(0==l.selectedIndex?"filterPass":"filterFail",a)};a();l.addEventListener("change",a,!1);b(k);a="leftAlign";c="Align game to the left";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Align game to the left"));b(k);a="mastheadOnTop";c="Enable to elevate RX6 MWAP-Header (pause/resume/settings etc) so that it's always on top";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Elevate RX6 MWAP-Header"));b(k);a="fbwindowtitle";c="Set window title to name on Facebook account";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Set window title to name on Facebook account"));b(k);a="showPulse";c="Hide iced targets on the fight list page";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Hide iced targets on the fight list page"));b(k);a="showLevel";c="Show player level on the hit list page";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Show level on the hit list page"));b(k);makeElement("label",f).appendChild(document.createTextNode(" Hide game elements "));a="hideAll";c="Hide All MW Icons";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Hide All MW Icons "));a="hideZyngaBanner";c=" Hide Z Promo Banner ";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" MW Promo Banner "));a="hideClanChat";c=" Hide Clan Chat ";makeElement("input",g,{type:"checkbox",id:a},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" ClanChat "));b(k);a="noStats";c="Disable MWAP Stats";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" MWAP Stats Tracking disabled"));b(k);makeElement("label",f).appendChild(document.createTextNode(" Choose where to play "));1!=parseXMLResponse()?(a="playMWAPLite",c="RX6 MWAP LITE Page Play",makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a),makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Play on mwap.me.uk (LITE) ")),a="playMWAPLiteRX2",c="RX6 MWAP LITE (2) Link, this resolves problems for clicking in-game",makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a),makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Use RX6 LITE 2nd Link")),playMWAPRX2=playMWAP=0):(a="playMWAP",c="RX6 MWAP Pro Page Play",makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a),makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Play on mwap.me.uk (PRO) ")),a="playMWAPRX2",c="RX6 MWAP Pro (2) Link, this resolves problems for clicking in-game",makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a),makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Use RX6 PRO 2nd Link ")),playMWAPLiteRX2=playMWAPLite=0);b(k);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode("RX6 2nd Link - use if you have probs clicking in-game such as Daily Take. Playing on mwap.me.uk is faster than facebook, but if you do have any problems, unclick both and play on FACEBOOK."));return h}function createDisplayTabNew2012(){function b(a){d=makeElement("div",a);jqRX6buttonId1=makeElement("div",d,{"class":"jqRX6buttonId1"})}var c,a,d,e,f=makeElement("div",null,{id:"displayTab","class":"tabcontent"});makeElement("div",f,{"class":"jsRX6TabHeading"}).appendChild(document.createTextNode("Display Settings"));var g=makeElement("div",f,{"class":"jsRX6Tabs"});b(g);a="autoLog";c="Check this to enable logging.";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Enable logging:"));a="autoLogLength";makeElement("input",jqRX6buttonId1,{type:"text",id:a,value:GM_getValue(a,"300"),size:"2",style:"text-align: left"});jqRX6buttonId1.appendChild(document.createTextNode(" max # of messages in log"));makeElement("br",jqRX6buttonId1,{"class":"hide"});makeElement("br",jqRX6buttonId1,{"class":"hide"});a="filterLog";makeElement("input",jqRX6buttonId1,{type:"checkbox",title:"Check this to enable log filtering",id:a,value:"checked"},a);makeElement("label",jqRX6buttonId1,{"for":a,"class":"jqSpacer"}).appendChild(document.createTextNode("Enable log filtering:"));a="filterOpt";var h=makeElement("select",jqRX6buttonId1,{id:a}),k=["Accept patterns","Reject patterns"];c=0;for(iLength=k.length;c<iLength;++c)e=document.createElement("option"),e.value=c,e.appendChild(document.createTextNode(k[c])),h.appendChild(e);h.selectedIndex=GM_getValue(a,0);makeElement("br",jqRX6buttonId1,{"class":"hide"});var l=makeElement("textarea",jqRX6buttonId1,{style:"position: static; margin-left:128px;width: 15em; height: 7em;",id:"filterPatterns",title:"Enter each pattern on a separate line."});l.appendChild(document.createTextNode(""));makeElement("br",jqRX6buttonId1);makeElement("font",jqRX6buttonId1,{style:"font-size: 10px;"}).appendChild(document.createTextNode("Enter each name pattern on a separate line."));a=function(){var a=0==h.selectedIndex?defaultPassPatterns.join("\n"):defaultFailPatterns.join("\n");l.firstChild.nodeValue=GM_getValue(0==h.selectedIndex?"filterPass":"filterFail",a)};a();h.addEventListener("change",a,!1);b(g);a="leftAlign";c="Align game to the left";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Align game to the left "));a="mastheadOnTop";c="Enable to elevate RX6 MWAP-Header (pause/resume/settings etc) so that it's always on top";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Elevate RX6 MWAP-Header "));a="fbwindowtitle";c="Set window title to name on Facebook account";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode(" Set window title to name on Facebook account"));b(g);a="showPulse";c="Hide iced targets on the fight list page";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode(" Hide iced targets on the fight list page "));a="showLevel";c="Show player level on the hit list page";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Show level on the hit list page"));b(g);a="hideAll";c="Hide All MW Icons";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Hide All MW Icons "));a="hideZyngaBanner";c=" Hide Z Promo Banner ";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("MW Promo Banner "));a="hideClanChat";c=" Hide Clan Chat ";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a},a);makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("ClanChat "));b(g);a="noStats";c="Disable MWAP Stats";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Disable MWAP Stats Tracking"));b(g);makeElement("label",jqRX6buttonId1).appendChild(document.createTextNode("Choose where to play "));makeElement("br",jqRX6buttonId1,{"class":"hide"});makeElement("br",jqRX6buttonId1,{"class":"hide"});1!=parseXMLResponse()?(a="playMWAPLite",c="RX6 MWAP LITE Page Play",makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a),makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Play on mwap.me.uk (LITE) ")),a="playMWAPLiteRX2",c="RX6 MWAP LITE (2) Link, this resolves problems for clicking in-game",makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a),makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Use RX6 LITE 2nd Link")),playMWAPRX2=playMWAP=0):(a="playMWAP",c="RX6 MWAP Pro Page Play",makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a),makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Play on mwap.me.uk (PRO) ")),a="playMWAPRX2",c="RX6 MWAP Pro (2) Link, this resolves problems for clicking in-game",makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a),makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Use RX6 PRO 2nd Link ")),playMWAPLiteRX2=playMWAPLite=0);makeElement("br",jqRX6buttonId1,{"class":"hide"});makeElement("br",jqRX6buttonId1,{"class":"hide"});makeElement("font",jqRX6buttonId1,{style:"width:760px;font:size:10px;color:yellow"}).appendChild(document.createTextNode("RX6 2nd Link - use if you have probs clicking in-game such as Daily Take. Playing on mwap.me.uk is faster than facebook,"));makeElement("p",jqRX6buttonId1,{"class":"hide"});makeElement("br",jqRX6buttonId1,{"class":"hide"});makeElement("font",jqRX6buttonId1,{style:"width:760px;font:size:10px;color:yellow"}).appendChild(document.createTextNode("but if you do have any problems, unclick both and play on FACEBOOK."));return f}function createGeneralTabNew2012(){function b(a){d=makeElement("div",a);g=makeElement("div",d,{"class":"jqRX6buttonId1"})}var c,a,d,e,f,g,h=makeElement("div",null,{id:"generalTab","class":"tabcontent"});makeElement("div",h,{"class":"jsRX6TabHeading"}).appendChild(document.createTextNode("General Settings"));var k=makeElement("div",h,{"class":"jsRX6Tabs"});b(k);makeElement("font",g,{style:"padding-left:29px;padding-right:2px"}).appendChild(document.createTextNode("General MWAP Speed:"));a=makeElement("select",g,{id:"fastMWAPSpeed","class":"jqDrop70",type:"text"});iLength=mwapSpeedModes.length;1!=parseXMLResponse()&&(iLength-=2);for(e=0;e<iLength;++e)f=document.createElement("option"),f.value=e,f.appendChild(document.createTextNode(mwapSpeedModes[e])),a.appendChild(f);a.selectedIndex=GM_getValue("fastMWAPSpeed",0);b(k);c="Check to idle in preferred city";a="idleLocation";makeElement("font",g,{style:"padding-left:60px;padding-right:2px"}).appendChild(document.createTextNode("When idle, fly to:"));a=makeElement("select",g,{id:"idleLocation","class":"jqDrop70",type:"text"});e=0;for(iLength=cities.length;e<iLength;++e)f=document.createElement("option"),f.value=e,e<cities.length&&cities[e][CITY_CLOSED]&&(f.style.display="none"),f.appendChild(document.createTextNode(cities[e][CITY_NAME])),GM_getIntValue("idleLocation",NY)==e&&(a.selected=!0),a.appendChild(f);a.selectedIndex=GM_getValue("idleLocation",NY);b(k);c=" Prioritise Energy / Stamina: ";a="burnOption";makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(c));var l=makeElement("select",g,{id:a,"class":"jqDrop70",type:"text"});e=0;for(iLength=burnModes.length;e<iLength;++e)f=document.createElement("option"),f.value=e,f.appendChild(document.createTextNode(burnModes[e])),l.appendChild(f);makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("burning."));l.selectedIndex=GM_getValue("burnOption",BURN_ALL);b(k);c="Check this to enable auto-pause before or after level up.";a="autoPause";e=makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,"class":"jqSpacer"}).appendChild(document.createTextNode("Enable auto-pause:"));e.addEventListener("click",clickAutoPause,!1);a="autoPauseBefore";c=" Before level up  ";makeElement("input",g,{type:"radio",name:"r3",id:a,value:"checked"},a);makeElement("label",g,{"for":a}).appendChild(document.createTextNode(c));a="autoPauseAfter";c=" After level up ";makeElement("input",g,{type:"radio",name:"r3",id:a,value:"checked"},a);makeElement("label",g,{"for":a}).appendChild(document.createTextNode(c));makeElement("br",g,{"class":"hide"});makeElement("br",g,{"class":"hide"});a="autoPauseExp";g.appendChild(document.createTextNode(" Experience left to pause at: "));makeElement("input",g,{"class":"jqDrop70",type:"text",value:GM_getValue(a,"50"),id:a,size:"2"});b(k);makeElement("br",d,{"class":"hide"});a="autoProcessPopups";c=" Try to process all popups when RX6 MWAP is running";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a}).appendChild(document.createTextNode(c));if(1!=parseXMLResponse())return b(k),makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Enable Auto Slot Machine Collection (PRO VERSION)")),b(k),makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Enable Free 3 Slot Spins Daily Collection (PRO VERSION)")),b(k),makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" Enable Reallocation Check (Popup) (PRO VERSION)")),h;b(k);a="AutoSlotMachine";c="Enable AutoSlotMachine";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Auto Slot Machine Collection"));a="autoSlot3FreeSpins";c="Enable Auto 3 Free Spin Collect";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Free 3 Slot Spins Daily Collection"));a="autoCheckReallocation";c="Enable Reallocation Check";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Reallocation Check (Popup)"));return h}function createMafiaTab(){function b(a){e=makeElement("div",a);f=makeElement("div",e,{"class":"lhs"});g=makeElement("div",e,{"class":"rhs"});makeElement("br",e,{"class":"hide"})}var c,a,d,e,f,g,h,k=makeElement("div",null,{id:"mafiaTab","class":"tabcontent"});makeElement("div",k,{style:"width:762px;height:20px;border:none #FFFFFF;float:left;font-size: 18px; font-weight: bold;"}).appendChild(document.createTextNode("Mafia Settings:"));h=makeElement("div",k,{style:"position: relative; top: 10px; margin-left: 40px; margin-right: auto; width: 95%; line-height:120%;"});b(h);c="Check if you want to ask for help automatically with jobs.";a="autoAskJobHelp";makeElement("input",f,{type:"checkbox",id:a,title:c,value:"checked"},a);d=makeElement("label",f,{"for":a,title:c});d.appendChild(document.createTextNode(" Ask for job help at:"));c="Enter the minimum experience to ask for job help, or 0 for no minimum.";a="autoAskJobHelpMinExp";makeElement("input",g,{type:"text",value:GM_getValue(a,"0"),title:c,id:a,size:"2"});g.appendChild(document.createTextNode(" minimum experience"));c=makeElement("div",h);f=makeElement("div",c,{"class":"lhs"});g=makeElement("div",c,{"class":"rhs"});makeElement("br",c,{"class":"hide"});c="Ask for Help on Brazil Jobs - Be carefull to only choose available Jobs / Tiers !";a="selectBrazilTier";d=makeElement("label",f,{"for":a,title:c});d.appendChild(document.createTextNode("Ask for Brazil help:"));c=makeElement("select",g,{id:a,title:c});choiceBrazilTier=document.createElement("option");choiceBrazilTier.text="no Help in Brazil";choiceBrazilTier.value="0";"0"==GM_getValue("selectBrazilTier")&&(choiceBrazilTier.selected=!0);c.appendChild(choiceBrazilTier);for(j=0;j<missionTabs[BRAZIL].length;j++)choiceBrazilTier=document.createElement("option"),choiceBrazilTier.text=missionTabs[BRAZIL][j],choiceBrazilTier.value=j+1,GM_getValue("selectBrazilTier",0)-1==j&&(choiceBrazilTier.selected=!0),c.appendChild(choiceBrazilTier);c=makeElement("div",h);f=makeElement("div",c,{"class":"lhs"});g=makeElement("div",c,{"class":"rhs"});makeElement("br",c,{"class":"hide"});c="Ask for Help on Chicago Jobs - Be carefull to only choose available Jobs / Tiers !";a="selectChicagoTier";d=makeElement("label",f,{"for":a,title:c});d.appendChild(document.createTextNode("Ask for Chicago help:"));c=makeElement("select",g,{id:a,title:c});choiceChicagoTier=document.createElement("option");choiceChicagoTier.text="no Help in Chicago";choiceChicagoTier.value="0";"0"==GM_getValue("selectChicagoTier")&&(choiceChicagoTier.selected=!0);c.appendChild(choiceChicagoTier);for(j=0;j<missionTabs[CHICAGO].length;j++)choiceChicagoTier=document.createElement("option"),choiceChicagoTier.text=missionTabs[CHICAGO][j],choiceChicagoTier.value=j+1,GM_getValue("selectChicagoTier",0)-1==j&&(choiceChicagoTier.selected=!0),c.appendChild(choiceChicagoTier);c=makeElement("div",h);f=makeElement("div",c,{"class":"lhs"});g=makeElement("div",c,{"class":"rhs"});makeElement("br",c,{"class":"hide"});c="Ask for Help on London Jobs - Be carefull to only choose available Jobs / Tiers !";a="selectLondonTier";d=makeElement("label",f,{"for":a,title:c});d.appendChild(document.createTextNode("Ask for London help:"));c=makeElement("select",g,{id:a,title:c});choiceLondonTier=document.createElement("option");choiceLondonTier.text="no Help in London";choiceLondonTier.value="0";"0"==GM_getValue("selectLondonTier")&&(choiceLondonTier.selected=!0);c.appendChild(choiceLondonTier);for(j=0;j<missionTabs[LONDON].length;j++)choiceLondonTier=document.createElement("option"),choiceLondonTier.text=missionTabs[LONDON][j],choiceLondonTier.value=j+1,GM_getValue("selectLondonTier",0)-1==j&&(choiceLondonTier.selected=!0),c.appendChild(choiceLondonTier);c=makeElement("div",h);f=makeElement("div",c,{"class":"lhs"});g=makeElement("div",c,{"class":"rhs"});makeElement("br",c,{"class":"hide"});c="Ask for Help on Vegas Tier Jobs - Be carefull to only choose available Jobs / Tiers !";a="selectVegasTier";d=makeElement("label",f,{"for":a,title:c});d.appendChild(document.createTextNode("Ask for Vegas help:"));a=makeElement("select",g,{id:a,title:c});choiceVegasTier=document.createElement("option");choiceVegasTier.text="no Help in Vegas";choiceVegasTier.value="0";"0"==GM_getValue("selectVegasTier")&&(choiceVegasTier.selected=!0);a.appendChild(choiceVegasTier);for(c=0;c<missions.length;c++)missions[c][MISSION_CITY]==LV&&2==missions[c][MISSION_EOL]&&(choiceVegasTier=document.createElement("option"),choiceVegasTier.text=missions[c][MISSION_NAME],choiceVegasTier.value=c,GM_getValue("selectVegasTier")==c&&(choiceVegasTier.selected=!0),a.appendChild(choiceVegasTier));b(h);1==parseXMLResponse()&&(c="Automatically ask to join City Crews",a="autoAskCityCrew",makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a),d=makeElement("label",g,{"for":a,title:c}),d.appendChild(document.createTextNode(" Ask to Join City Crews")));makeElement("br",g);c="Automatically accept mafia invitations.";a="acceptMafiaInvitations";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);d=makeElement("label",g,{"for":a,title:c});d.appendChild(document.createTextNode(" Accept mafia invitations"));b(h);d=makeElement("label",f);d.appendChild(document.createTextNode("autoProcess Player Updates:"));c="Process and Log Player Updates";a="logPlayerUpdates";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);d=makeElement("label",g,{"for":a,title:c});d.appendChild(document.createTextNode(" (autoHelp mafia on wars, burners, jobs, ...)"));b(h);d=makeElement("label",f);d.appendChild(document.createTextNode("Enable publishing to FB Wall :"));c="Automatically click Publish on every Post Popup.";a="autoGlobalPublishing";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);d=makeElement("label",g,{"for":a,title:c});d.appendChild(document.createTextNode(" Global Publishing "));b(h);c="Automatically post iced opponent bonus.";a="autoIcePublish";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);d=makeElement("label",g,{"for":a,title:c});d.appendChild(document.createTextNode(" Ice bonus, every "));c="Enter the publishing Frequency";a="autoIcePublishFrequency";makeElement("input",g,{type:"text",value:GM_getValue(a,"1"),title:c,id:a,size:"1"});g.appendChild(document.createTextNode(" th time"));makeElement("br",g,{"class":"hide"});c="Check if you want to share wishlist.";a="autoShareWishlist";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);d=makeElement("label",g,{"for":a,title:c});d.appendChild(document.createTextNode(" Wishlist every: "));c="Enter the number of hours to wait before sharing wishlist again. Has to be at least 1 hour, and can be decimal (e.g. 1.5).";a="autoShareWishlistTime";makeElement("input",g,{type:"text",value:GM_getValue(a,"1"),title:c,id:a,size:"2"});g.appendChild(document.createTextNode(" hour(s)"));b(h);d=makeElement("label",f);d.appendChild(document.createTextNode(" Message Center: "));c="Check to autoAccept Message Center Gifts";a="autoAcceptMsgGifts";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" autoAccept Gifts "));c="Check to autoAccept Message Center Boosts";a="autoAcceptMsgBoosts";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" autoAccept Boosts "));c="Check to autoAccept Message Crew Members";a="autoAcceptMsgCrew";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" autoAccept Crew "));c="Send Energy Packs from Message Center";a="autosendMsgEnergyPack";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);makeElement("label",g,{"for":a,title:c}).appendChild(document.createTextNode(" autoSend Energy Packs"));b(h);d=makeElement("label",f);d.appendChild(document.createTextNode(" enable autoWar: "));var l=makeElement("select",g,{id:"warMode"});c=0;for(iLength=warModeChoices.length;c<iLength;++c)h=document.createElement("option"),h.value=c,h.appendChild(document.createTextNode(warModeChoices[c])),l.appendChild(h);l.selectedIndex=GM_getValue("warMode",0);c="Enter opponents Mafia Wars ID";a="autoWarTargetList";var n=makeElement("font",g,{style:"font-size: 10px;"});n.appendChild(document.createTextNode("Enter each target on a separate line. Add the userid part of the p|userid."));makeElement("br",g,{"class":"hide"});var o=makeElement("textarea",g,{style:"width: 12em; height: 6em;",id:a,title:"Enter each Mafia Wars ID on a separate line. This will not work with the Facebook ID."});o.appendChild(document.createTextNode(GM_getValue("autoWarTargetList","")));makeElement("br",g,{"class":"hide"});h=function(){o.style.display=l.selectedIndex==2?"":"none";n.style.display=l.selectedIndex==2?"":"none"};h();l.addEventListener("change",h,!1);return k}function createMafiaTabNew2012(){function b(a){e=makeElement("div",a);g=makeElement("div",e,{"class":"jqRX6buttonId1"})}var c,a,d,e,f,g,h=makeElement("div",null,{id:"mafiaTab","class":"tabcontent"});makeElement("div",h,{"class":"jsRX6TabHeading"}).appendChild(document.createTextNode("Mafia Settings"));f=makeElement("div",h,{"class":"jsRX6Tabs"});b(f);c="Check if you want to ask for help automatically with jobs.";a="autoAskJobHelp";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);d=makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"});d.appendChild(document.createTextNode("Ask for job help at:  "));c="Enter the minimum experience to ask for job help, or 0 for no minimum.";a="autoAskJobHelpMinExp";makeElement("input",g,{type:"text",value:GM_getValue(a,"0"),title:c,id:a,size:"2"});g.appendChild(document.createTextNode(" minimum experience"));makeElement("div",f);makeElement("br",g,{"class":"hide"});makeElement("br",g,{"class":"hide"});c="Ask for Help on Brazil Jobs - Be carefull to only choose available Jobs / Tiers !";a="selectBrazilTier";d=makeElement("label",g,{"for":a,title:c});d.appendChild(document.createTextNode("Brazil:"));c=makeElement("select",g,{id:a,title:c,style:"margin-left:24px;margin-right:31px"});choiceBrazilTier=document.createElement("option");choiceBrazilTier.text="no Help in Brazil";choiceBrazilTier.value="0";"0"==GM_getValue("selectBrazilTier")&&(choiceBrazilTier.selected=!0);c.appendChild(choiceBrazilTier);for(j=0;j<missionTabs[BRAZIL].length;j++)choiceBrazilTier=document.createElement("option"),choiceBrazilTier.text=missionTabs[BRAZIL][j],choiceBrazilTier.value=j+1,GM_getValue("selectBrazilTier",0)-1==j&&(choiceBrazilTier.selected=!0),c.appendChild(choiceBrazilTier);makeElement("div",f);c="Ask for Help on Chicago Jobs - Be carefull to only choose available Jobs / Tiers !";a="selectChicagoTier";d=makeElement("label",g,{"for":a,title:c});d.appendChild(document.createTextNode("Chicago:"));c=makeElement("select",g,{id:a,title:c,style:"margin-left:12px;margin-right:17px"});choiceChicagoTier=document.createElement("option");choiceChicagoTier.text="no Help in Chicago";choiceChicagoTier.value="0";"0"==GM_getValue("selectChicagoTier")&&(choiceChicagoTier.selected=!0);c.appendChild(choiceChicagoTier);for(j=0;j<missionTabs[CHICAGO].length;j++)choiceChicagoTier=document.createElement("option"),choiceChicagoTier.text=missionTabs[CHICAGO][j],choiceChicagoTier.value=j+1,GM_getValue("selectChicagoTier",0)-1==j&&(choiceChicagoTier.selected=!0),c.appendChild(choiceChicagoTier);makeElement("div",f);makeElement("br",g,{"class":"hide"});makeElement("br",g,{"class":"hide"});c="Ask for Help on London Jobs - Be carefull to only choose available Jobs / Tiers !";a="selectLondonTier";d=makeElement("label",g,{"for":a,title:c});d.appendChild(document.createTextNode("London:"));c=makeElement("select",g,{id:a,title:c,style:"margin-left:12px;margin-right:29px"});choiceLondonTier=document.createElement("option");choiceLondonTier.text="no Help in London";choiceLondonTier.value="0";"0"==GM_getValue("selectLondonTier")&&(choiceLondonTier.selected=!0);c.appendChild(choiceLondonTier);for(j=0;j<missionTabs[LONDON].length;j++)choiceLondonTier=document.createElement("option"),choiceLondonTier.text=missionTabs[LONDON][j],choiceLondonTier.value=j+1,GM_getValue("selectLondonTier",0)-1==j&&(choiceLondonTier.selected=!0),c.appendChild(choiceLondonTier);makeElement("div",f);c="Ask for Help on Vegas Tier Jobs - Be carefull to only choose available Jobs / Tiers !";a="selectVegasTier";d=makeElement("label",g,{"for":a,title:c});d.appendChild(document.createTextNode("Vegas:"));a=makeElement("select",g,{id:a,title:c,style:"margin-left:12px;margin-right:17px"});choiceVegasTier=document.createElement("option");choiceVegasTier.text="no Help in Vegas";choiceVegasTier.value="0";"0"==GM_getValue("selectVegasTier")&&(choiceVegasTier.selected=!0);a.appendChild(choiceVegasTier);for(c=0;c<missions.length;c++)missions[c][MISSION_CITY]==LV&&2==missions[c][MISSION_EOL]&&(choiceVegasTier=document.createElement("option"),choiceVegasTier.text=missions[c][MISSION_NAME],choiceVegasTier.value=c,GM_getValue("selectVegasTier")==c&&(choiceVegasTier.selected=!0),a.appendChild(choiceVegasTier));b(f);1==parseXMLResponse()&&(c="Automatically ask to join City Crews",a="autoAskCityCrew",makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a),d=makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"}),d.appendChild(document.createTextNode("Ask to Join City Crews ")));makeElement("br",void 0);c="Automatically accept mafia invitations.";a="acceptMafiaInvitations";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);d=makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"});d.appendChild(document.createTextNode("Accept mafia invitations "));b(f);d=makeElement("label",g,{"class":"jqSpacer"});d.appendChild(document.createTextNode("AutoProcess Player Updates: "));c="Process and Log Player Updates";a="logPlayerUpdates";makeElement("input",g,{type:"checkbox",id:a,value:"checked"},a);d=makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"});d.appendChild(document.createTextNode(" (Auto Help mafia on wars, burners, jobs, ... )"));b(f);d=makeElement("label",g,{"class":"jqSpacer"});d.appendChild(document.createTextNode("Enable publishing to FB Wall:"));c="Automatically click Publish on every Post Popup.";a="autoGlobalPublishing";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);d=makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"});d.appendChild(document.createTextNode("Global Publishing "));b(f);c="Automatically post iced opponent bonus.";a="autoIcePublish";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);d=makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"});d.appendChild(document.createTextNode("Ice bonus, every"));c="Enter the publishing Frequency";a="autoIcePublishFrequency";makeElement("input",g,{type:"text",value:GM_getValue(a,"1"),title:c,id:a,size:"1"});g.appendChild(document.createTextNode(" th time"));makeElement("list",g,{"class":"hide"});c="Check if you want to share wishlist.";a="autoShareWishlist";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);d=makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"});d.appendChild(document.createTextNode("Wishlist every"));c="Enter the number of hours to wait before sharing wishlist again. Has to be at least 1 hour, and can be decimal (e.g. 1.5).";a="autoShareWishlistTime";makeElement("input",g,{type:"text",value:GM_getValue(a,"1"),title:c,id:a,size:"1"});g.appendChild(document.createTextNode(" hour(s)"));b(f);d=makeElement("label",g);d.appendChild(document.createTextNode("Message Center: "));c="Check to autoAccept Message Center Gifts";a="autoAcceptMsgGifts";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Auto Accept Gifts"));c="Check to autoAccept Message Center Boosts";a="autoAcceptMsgBoosts";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Auto Accept Boosts"));c="Check to autoAccept Message Crew Members";a="autoAcceptMsgCrew";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Auto Accept Crew"));c="Send Energy Packs from Message Center";a="autosendMsgEnergyPack";makeElement("input",g,{type:"checkbox",id:a,title:c,value:"checked"},a);makeElement("label",g,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Auto Send Energy Packs"));b(f);d=makeElement("label",g,{"class":"jqSpacer"});d.appendChild(document.createTextNode("Enable Auto-War:"));var k=makeElement("select",g,{id:"warMode"});c=0;for(iLength=warModeChoices.length;c<iLength;++c)f=document.createElement("option"),f.value=c,f.appendChild(document.createTextNode(warModeChoices[c])),k.appendChild(f);k.selectedIndex=GM_getValue("warMode",0);c="Enter opponents Mafia Wars ID";a="autoWarTargetList";var l=makeElement("font",g,{style:"font-size: 10px;"});l.appendChild(document.createTextNode("Enter each target on a separate line. Add the userid part of the p|userid."));makeElement("br",g,{"class":"hide"});var n=makeElement("textarea",g,{style:"width: 12em; height: 6em;margin-left:50px:margin-top:5px",id:a,title:"Enter each Mafia Wars ID on a separate line. This will not work with the Facebook ID."});n.appendChild(document.createTextNode(GM_getValue("WarTargetList","")));f=function(){n.style.display=k.selectedIndex==2?"":"none";l.style.display=k.selectedIndex==2?"":"none"};f();k.addEventListener("change",f,!1);return h}function createFamilyTab(){var b,c,a=makeElement("div",null,{id:"familyTab","class":"tabcontent"});makeElement("div",a,{style:"width:762px;height:20px;border:none #FFFFFF;float:left;font-size: 18px; font-weight: bold;"}).appendChild(document.createTextNode("Family : Operations, Boss, Battle and Free Gift:"));makeElement("h2",a,{style:"position: absolute; width: 100%; left: 30px; top: 25px;"}).appendChild(document.createTextNode(" Operations Settings "));var d=makeElement("div",a,{style:"position: absolute; width: 100%; left: 40px; top: 35px;"});c="autoStartMyOps";b="Enable Personal Operations";var e=makeElement("div",d,{style:"position: absolute; text-align: left; top: 20px; left: 10px;"});makeElement("input",e,{type:"checkbox",id:c,value:"checked"},c);makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Enable Personal Operations "));c="autoStartFamOps";b="Participate In Family Operations";e=makeElement("div",d,{style:"position: absolute; text-align: left; top: 20px; left: 200px;"});makeElement("input",e,{type:"checkbox",id:c,value:"checked"},c);makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Participate In Family Operations "));if(1==parseXMLResponse()){makeElement("h2",a,{style:"position: absolute; width: 100%; left: 30px; top: 85px;"}).appendChild(document.createTextNode(" Family Rewards "));c="AutoFamilyRewards";b="Enable Auto Family Rewards Collection";e=makeElement("div",d,{style:"position: absolute; text-align: left; top: 80px; left: 10px;"});makeElement("input",e,{type:"checkbox",id:c,value:"checked"},c);makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Enable Auto Family Rewards Collect"));makeElement("h2",a,{style:"position: absolute; width: 100%; left: 30px; top: 145px;"}).appendChild(document.createTextNode(" Family Boss Fight Settings "));c="autoFamilyBosses";b="Enable Family Bosses";e=makeElement("div",d,{style:"position: relative; text-align: left; top: 135px; left: 10px;"});makeElement("input",e,{type:"checkbox",id:c,value:"checked"},c);makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Enable Family Bosses "));c="autoFamilyBossFighting";b="Enable Family Boss Fighting";e=makeElement("div",d,{style:"position: relative; text-align: left; top: 135px; left: 10px;"});makeElement("input",e,{type:"checkbox",id:c,value:"checked"},c);makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Enable Auto Family Boss Fighting "));c="bossRole";b="Boss Role";e=makeElement("div",d,{style:"position: relative; text-align: left; top: 140px; left: 35px;"});makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Boss Role "));e=makeElement("select",e,{id:c,style:"margin-left:5px;"});iLength=bossRoles.length;for(b=0;b<iLength;++b)c=document.createElement("option"),c.value=b,c.appendChild(document.createTextNode(bossRoles[b].capitalize())),e.appendChild(c);e.selectedIndex=GM_getValue("bossRole",0);c="bossStaminaLimit";b="Boss Stamina Limit";e=makeElement("div",d,{style:"position: relative; text-align: left; top: 120px; left: 240px;"});makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Boss Stamina Limit "));e=makeElement("select",e,{id:c,style:"margin-left:5px;"});iLength=bossStaminaLimits.length;for(b=0;b<iLength;++b)c=document.createElement("option"),c.value=b,c.appendChild(document.createTextNode(bossStaminaLimits[b])),e.appendChild(c);e.selectedIndex=GM_getValue("bossStaminaLimit",0);c="bossRageLimit";b="Boss Rage Limit (0 - 1000)";e=makeElement("div",d,{style:"position: relative; text-align: left; top: 100px; left: 440px;"});makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Boss Rage Limit "));makeElement("input",e,{style:"text-align: right;",type:"text",value:GM_getValue(c,"0"),id:c,size:"6",style:"margin-left:5px;"});c="askBossFightBoosts";b="Ask for Family Boss Boosts";e=makeElement("div",d,{style:"position: relative; text-align: left; top: 105px; left: 10px;"});makeElement("input",e,{type:"checkbox",id:c,value:"checked"},c);makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Ask for Family Boss Boosts "));c="sendBossFightBoosts";b="Send Family Boss Boosts";e=makeElement("div",d,{style:"position: relative; text-align: left; top: 85px; left: 230px;"});makeElement("input",e,{type:"checkbox",id:c,value:"checked"},c);makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Send Family Boss Boosts "));makeElement("h2",a,{style:"position: absolute; width: 100%; left: 35px; top: 275px;"}).appendChild(document.createTextNode("Family Battle Settings"));c="AutoBattleFight";b="Enable AutoBattle Fighting";e=makeElement("div",d,{style:"position: absolute; text-align: left; top: 270px; left: 10px;"});makeElement("input",e,{type:"checkbox",id:c,value:"checked"},c);makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Enable AutoBattle Fighting"));c="AutoBattleSafehouse";b="Enable Battle Safehouse Attacking";e=makeElement("div",d,{style:"position: absolute; text-align: left; top: 270px; left: 280px;"});makeElement("input",e,{type:"checkbox",id:c,value:"checked"},c);makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Enable Battle Safehouse Attacking"));c="AutoBattle";b="Enable AutoBattle";e=makeElement("div",d,{style:"position: absolute; text-align: left; top: 295px; left: 10px;"});makeElement("input",e,{type:"checkbox",id:c,value:"checked"},c);makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Enable AutoBattle (Only if Underboss/GF)"));c="AutoBattleClanID";b="ClanID";e=makeElement("div",d,{style:"position: absolute; text-align: left; top: 295px; left: 280px;"});makeElement("input",e,{style:"text-align: right;",type:"text",value:GM_getValue(c,"0"),id:c,size:"6"});makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(" Clan / Family ID"));makeElement("input",d,{type:"text",id:"familyListSingleLink",title:"Enter MW Family Link",style:"position: absolute; text-align: left; top: 315px; left: 280px;width: 300px;"});b="Add Family ID from MW Family Link";eltA=makeElement("a",d,{id:"familySingleAdd",href:"#",alt:b,title:b,style:"position: absolute; text-align: left; top: 315px; left: 585px;"});eltA.appendChild(document.createTextNode("Add Family ID"));eltA.addEventListener("click",addSingleFamilyID,!1);makeElement("h2",a,{style:"position: absolute; text-align:left; left: 35px; top: 380px;"}).appendChild(document.createTextNode(" Free Gifts "));c="autoFreeGift";b="Enable Auto Free Gifting";e=makeElement("div",d,{style:"position: absolute; text-align: left; top: 375px; left: 10px;"});makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(b));c=makeElement("select",d,{id:"selectFreeGift",title:b,style:"position: absolute; text-align: left; top: 375px; left: 160px;"});choiceFreeGift=document.createElement("option");choiceFreeGift.text="don't send free gifts";choiceFreeGift.value=0;0==GM_getValue("selectFreeGift",0)&&(choiceFreeGift.selected=!0);c.appendChild(choiceFreeGift);for(b=0;b<freeGiftList.length;b++)choiceFreeGift=document.createElement("option"),choiceFreeGift.text=freeGiftList[b][1].capitalize(),choiceFreeGift.value=freeGiftList[b][0],GM_getValue("selectFreeGift",0)==freeGiftList[b][0]&&(choiceFreeGift.selected=!0),c.appendChild(choiceFreeGift);c="autoAskFreeGift";b="Enable Asking for Free Gifts";e=makeElement("div",d,{style:"position: absolute; text-align: left; top: 355px; left: 320px;"});makeElement("label",e,{"for":c,title:b}).appendChild(document.createTextNode(b));d=makeElement("select",d,{id:"selectAskFreeGift",title:b,style:"position: absolute; text-align: left; top: 355px; left: 490px;"});choiceAskFreeGift=document.createElement("option");choiceAskFreeGift.text="don't ask for free gifts";choiceAskFreeGift.value=0;0==GM_getValue("selectAskFreeGift",0)&&(choiceAskFreeGift.selected=!0);d.appendChild(choiceAskFreeGift);for(b=0;b<freeGiftList.length;b++)choiceAskFreeGift=document.createElement("option"),choiceAskFreeGift.text=freeGiftList[b][1].capitalize(),choiceAskFreeGift.value=freeGiftList[b][0],GM_getValue("selectAskFreeGift",0)==freeGiftList[b][0]&&(choiceAskFreeGift.selected=!0),d.appendChild(choiceAskFreeGift)}return a}function createFamilyTabNew2012(){function b(a){d=makeElement("div",a);e=makeElement("div",d,{"class":"jqRX6buttonId1"})}var c,a,d,e,f=makeElement("div",null,{id:"familyTab","class":"tabcontent"});makeElement("div",f,{"class":"jsRX6TabHeading"}).appendChild(document.createTextNode("Family | Operations, Boss, Battle and Free Gifts"));var g=makeElement("div",f,{"class":"jsRX6Tabs"});b(g);makeElement("font",e).appendChild(document.createTextNode("Operations Settings"));makeElement("br",e,{"class":"hide"});a="autoStartMyOps";c="Enable Personal Operations";makeElement("div",e,{style:"position: absolute; text-align: left; top: 20px; left: 10px;"});makeElement("input",e,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",e,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Enable Personal Operations"));a="autoStartFamOps";c="Participate In Family Operations";makeElement("div",e,{style:"position: absolute; text-align: left; top: 20px; left: 200px;"});makeElement("input",e,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",e,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Participate In Family Operations"));if(1==parseXMLResponse()){b(g);makeElement("font",e).appendChild(document.createTextNode("Family Rewards"));makeElement("br",e,{"class":"hide"});a="AutoFamilyRewards";c="Enable Auto Family Rewards Collection";makeElement("input",e,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",e,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Enable Auto Family Rewards Collect"));b(g);makeElement("font",e).appendChild(document.createTextNode("Family Boss Fight Settings"));makeElement("br",e,{"class":"hide"});a="autoFamilyBosses";c="Enable Family Bosses";makeElement("input",e,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",e,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Enable Family Bosses"));a="autoFamilyBossFighting";c="Enable Family Boss Fighting";makeElement("input",e,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",e,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Enable Auto Family Boss Fighting"));makeElement("br",e,{"class":"hide"});a="bossRole";makeElement("label",e,{"for":a,title:"Boss Role","class":"jqSpacer"}).appendChild(document.createTextNode(" Boss Role "));var h=makeElement("select",e,{id:a,style:"margin-left:5px;"});iLength=bossRoles.length;for(c=0;c<iLength;++c)a=document.createElement("option"),a.value=c,a.appendChild(document.createTextNode(bossRoles[c].capitalize())),h.appendChild(a);h.selectedIndex=GM_getValue("bossRole",0);a="bossStaminaLimit";makeElement("label",e,{"for":a,title:"Boss Stamina Limit","class":"jqSpacer"}).appendChild(document.createTextNode("Boss Stamina Limit"));h=makeElement("select",e,{id:a,style:"margin-left:5px;"});iLength=bossStaminaLimits.length;for(c=0;c<iLength;++c)a=document.createElement("option"),a.value=c,a.appendChild(document.createTextNode(bossStaminaLimits[c])),h.appendChild(a);h.selectedIndex=GM_getValue("bossStaminaLimit",0);a="bossRageLimit";makeElement("label",e,{"for":a,title:"Boss Rage Limit (0 - 1000)"}).appendChild(document.createTextNode(" Boss Rage Limit "));makeElement("input",e,{style:"text-align: right;",type:"text",value:GM_getValue(a,"0"),id:a,size:"6",style:"margin-left:5px;"});makeElement("br",e,{"class":"hide"});a="askBossFightBoosts";c="Ask for Family Boss Boosts";makeElement("input",e,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",e,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Ask for Family Boss Boosts"));a="sendBossFightBoosts";c="Send Family Boss Boosts";makeElement("input",e,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",e,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Send Family Boss Boosts"));b(g);makeElement("font",e).appendChild(document.createTextNode("Family Battle Settings"));makeElement("br",e,{"class":"hide"});a="AutoBattleFight";c="Enable AutoBattle Fighting";makeElement("input",e,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",e,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Enable AutoBattle Fighting"));a="AutoBattleSafehouse";c="Enable Battle Safehouse Attacking";makeElement("input",e,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",e,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Enable Battle Safehouse Attacking"));makeElement("br",e,{"class":"hide"});a="AutoBattle";c="Enable AutoBattle";makeElement("input",e,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",e,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Enable AutoBattle (Only if Underboss/GF)"));a="AutoBattleClanID";c="ClanID";makeElement("input",e,{style:"text-align: right;",type:"text",value:GM_getValue(a,"0"),id:a,size:"6"});makeElement("label",e,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Clan / Family ID"));makeElement("br",e,{"class":"hide"});makeElement("input",e,{type:"text",id:"familyListSingleLink",title:"Enter MW Family Link",style:"text-align: left;width: 250px;margin-left;margin-left:252px;margin-top:3px"});c="Add Family ID from MW Family Link";eltA=makeElement("a",e,{id:"familySingleAdd",href:"#",alt:c,title:c,"class":"jqSpacer"});eltA.appendChild(document.createTextNode("Add Family ID"));eltA.addEventListener("click",addSingleFamilyID,!1);b(g);makeElement("font",e).appendChild(document.createTextNode("Free Gifts"));makeElement("br",e,{"class":"hide"});c="Enable Auto Free Gifting";makeElement("label",e,{"for":"autoFreeGift",title:c,"class":"jqSpacer"}).appendChild(document.createTextNode(c));g=makeElement("select",e,{id:"selectFreeGift",title:c,"class":"jqSpacer"});choiceFreeGift=document.createElement("option");choiceFreeGift.text="don't send free gifts";choiceFreeGift.value=0;0==GM_getValue("selectFreeGift",0)&&(choiceFreeGift.selected=!0);g.appendChild(choiceFreeGift);for(c=0;c<freeGiftList.length;c++)choiceFreeGift=document.createElement("option"),choiceFreeGift.text=freeGiftList[c][1].capitalize(),choiceFreeGift.value=freeGiftList[c][0],GM_getValue("selectFreeGift",0)==freeGiftList[c][0]&&(choiceFreeGift.selected=!0),g.appendChild(choiceFreeGift);a="autoAskFreeGift";c="Enable Asking for Free Gifts";makeElement("div",e);makeElement("label",e,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode(c));a="selectAskFreeGift";g=makeElement("select",e);choiceAskFreeGift=document.createElement("option");choiceAskFreeGift.text="don't ask for free gifts";choiceAskFreeGift.value=0;0==GM_getValue("selectAskFreeGift",0)&&(choiceAskFreeGift.selected=!0);g.appendChild(choiceAskFreeGift);for(c=0;c<freeGiftList.length;c++)choiceAskFreeGift=document.createElement("option"),choiceAskFreeGift.text=freeGiftList[c][1].capitalize(),choiceAskFreeGift.value=freeGiftList[c][0],GM_getValue("selectAskFreeGift",0)==freeGiftList[c][0]&&(choiceAskFreeGift.selected=!0),g.appendChild(choiceAskFreeGift)}return f}function addSingleFamilyID(){var b,c=document.getElementById("AutoBattleClanID");decodeURIComponent(document.getElementById("familyListSingleLink").value).match(/"id":"(.+)"/)?(b=decodeID(RegExp.$1).replace(/\D/g,""),c.value=b,c.innerHTML=b):alert("Invalid family link.");document.getElementById("familyListSingleLink").value=""}function createAutostatTab(){var b,c,a,d,e=makeElement("div",null,{id:"autostatTab","class":"tabcontent"});makeElement("div",e,{style:"width:762px;height:20px;border:none #FFFFFF;float:left;font-size: 18px; font-weight: bold;"}).appendChild(document.createTextNode("Autostat Settings:"));var f=makeElement("div",e,{style:"position: absolute; width: 100%; left: 25px; top: 40px;"});c="autoStat";b="Check this this to enable auto-statting";d=makeElement("div",f,{style:"position: absolute; text-align: left; left: 20px;"});makeElement("input",d,{type:"checkbox",id:c,value:"checked"},c);makeElement("img",d,{src:stripURI(plussignIcon)});makeElement("label",d,{"for":c,title:b}).appendChild(document.createTextNode(" Enable auto-stat"));b=" Disable AutoStat when status goals are reached";c="autoStatDisable";d=makeElement("div",f,{style:"position: absolute; text-align: left; left: 200px; "});makeElement("input",d,{type:"checkbox",id:c,title:b,value:"checked"},c);makeElement("label",d,{"for":c,title:b}).appendChild(document.createTextNode(b));var g=30,h=32;d=0;for(iLength=autoStatRatios.length;d<iLength;++d)a=makeElement("div",f,{style:"position: absolute; top:"+h+"px; left:"+g+"px;"}),a.appendChild(document.createTextNode(autoStatDescrips[d+1])),h+=25;g=85;h=30;d=0;for(iLength=autoStatRatios.length;d<iLength;++d)b="Please set ratio of "+autoStatDescrips[d+1]+" stat",c=autoStatRatios[d],a=makeElement("div",f,{style:"position: absolute; top:"+h+"px; left:"+g+"px;",title:b}),a.appendChild(document.createTextNode(" = ")),makeElement("input",a,{type:"text",style:"width: 40px;",value:GM_getValue(c,0),id:c,size:"1"}),a.appendChild(document.createTextNode(" x ")),h+=25;g=160;h=30;d=0;for(iLength=autoStatModes.length;d<iLength;++d){b="Please select where to base "+autoStatDescrips[d+1]+" stat";c=autoStatModes[d];var k=makeElement("select",f,{id:c,title:b,style:"position: absolute; width:60px; top: "+h+"px; left: "+g+"px;"}),h=h+25;a=0;for(jLength=autoStatDescrips.length;a<jLength;++a)c=document.createElement("option"),c.value=a,c.appendChild(document.createTextNode(autoStatDescrips[a])),k.appendChild(c);k.selectedIndex=GM_getValue(autoStatModes[d],0)}g=225;h=30;d=0;for(iLength=autoStatBases.length;d<iLength;++d)b="add these for total ",c=autoStatBases[d],a=makeElement("div",f,{style:"position: absolute; top:"+h+"px; left:"+g+"px;",title:b}),a.appendChild(document.createTextNode("+")),makeElement("input",a,{type:"text",style:"width: 40px;",value:GM_getValue(c,0),id:c,size:"1"}),h+=25;g=290;h=30;d=0;for(iLength=autoStatFallbacks.length;d<iLength;++d)b="Check this to distribute points to "+autoStatDescrips[d+1]+" when goals are reached",c=autoStatFallbacks[d],a=makeElement("div",f,{style:"position: absolute; top: "+h+"px; left:"+g+"px; "}),makeElement("input",a,{type:"checkbox",id:c,title:b,value:"checked"},autoStatFallbacks[d]),a=makeElement("label",a,{"for":c,title:b}),a.appendChild(document.createTextNode(" "+autoStatDescrips[d+1]+" as fallback")),h+=25;b="Please select priority level for stat distribution";g=470;h=30;d=0;for(iLength=autoStatPrios.length;d<iLength;++d){c=autoStatPrios[d];k=makeElement("select",f,{id:c,title:b,style:"position: absolute; top: "+h+"px; left: "+g+"px;"});h+=25;a=0;for(jLength=autoStatRatios.length;a<jLength;++a)c=document.createElement("option"),c.value=a,c.appendChild(document.createTextNode("Priority "+(a+1))),k.appendChild(c);k.selectedIndex=GM_getValue(autoStatPrios[d],0)}if(1==parseXMLResponse()){f=makeElement("div",e,{"class":"rx6",style:"position: absolute; width: 100%; left: 25px; top: 220px;height:210px;"});g=makeElement("div",f,{"class":"rx6",style:"position: relative; top: 0px; margin-left: 0px; width: 200px; height:200px;line-height:180%;"});b="Select City Priority";a=makeElement("label",g,{"for":"selectCityPrio",title:b});a.appendChild(document.createTextNode(b));makeElement("br",g,{"class":"hide"});h=BRAZIL;for(d=1;3>=d;d++){c="selectCityPrio"+d;b="City Priority "+d+": ";a=makeElement("label",g,{"for":c,title:b});a.appendChild(document.createTextNode(b));b=makeElement("select",g,{id:c,title:b});for(a=BRAZIL;a<=LONDON;a++)choiceSelectCity=makeElement("option",null,{title:cities[a][CITY_NAME]}),choiceSelectCity.text=cities[a][CITY_NAME],choiceSelectCity.value=a,GM_getValue(c,h)==a&&(choiceSelectCity.selected=!0),b.appendChild(choiceSelectCity);h++;makeElement("br",g,{"class":"hide"})}g=makeElement("div",f,{"class":"rx6",style:"position: relative; top: -200px; margin-left: 180px; width: 200px; height:200px;line-height:180%;"});b="Activate Brazil Crew Members";a=makeElement("label",g,{"for":"selectBrazilCrew",title:b});a.appendChild(document.createTextNode(b));makeElement("br",g,{"class":"hide"});for(d=1;d<cityCrewTitles.length;d++){c="selectBrazilCrew"+d;b="Crew Priority "+d+": ";a=makeElement("label",g,{"for":c,title:b,style:"float:left;width:100px;"});a.appendChild(document.createTextNode(b));b=makeElement("select",g,{id:c,title:b});for(a=0;a<cityCrewTitles.length;a++)choiceBrazilCrew=makeElement("option",null,{title:cityCrewTitles[a][2]}),choiceBrazilCrew.text=cityCrewTitles[a][0],choiceBrazilCrew.value=a,GM_getValue(c,0)==a&&(choiceBrazilCrew.selected=!0),b.appendChild(choiceBrazilCrew);makeElement("br",g,{"class":"hide"})}g=makeElement("div",f,{"class":"rx6",style:"position: relative; top: -400px; margin-left: 405px; width: 200px;height:200px; line-height:180%;"});b="Chicago Crew Members";a=makeElement("label",g,{"for":"selectChicagoCrew",title:b});a.appendChild(document.createTextNode(b));makeElement("br",g,{"class":"hide"});for(d=1;d<cityCrewTitles.length;d++){c="selectChicagoCrew"+d;h=makeElement("select",g,{id:c,title:b});for(a=0;a<cityCrewTitles.length;a++)choiceChicagoCrew=makeElement("option",null,{title:cityCrewTitles[a][2]}),choiceChicagoCrew.text=cityCrewTitles[a][0],choiceChicagoCrew.value=a,GM_getValue(c,0)==a&&(choiceChicagoCrew.selected=!0),h.appendChild(choiceChicagoCrew);makeElement("br",g,{"class":"hide"})}f=makeElement("div",f,{"class":"rx6",style:"position: relative; top: -600px; margin-left: 560px; width: 200px;height:200px; line-height:180%;"});b="London Crew Members";a=makeElement("label",f,{"for":"selectLondonCrew",title:b});a.appendChild(document.createTextNode(b));makeElement("br",f,{"class":"hide"});for(d=1;d<cityCrewTitles.length;d++){c="selectLondonCrew"+d;g=makeElement("select",f,{id:c,title:b});for(a=0;a<cityCrewTitles.length;a++)choiceLondonCrew=makeElement("option",null,{title:cityCrewTitles[a][2]}),choiceLondonCrew.text=cityCrewTitles[a][0],choiceLondonCrew.value=a,GM_getValue(c,0)==a&&(choiceLondonCrew.selected=!0),g.appendChild(choiceLondonCrew);makeElement("br",f,{"class":"hide"})}}return e}function createAutostatTabNew2012(){function b(a){g=makeElement("div",a);h=makeElement("div",g,{"class":"jqRX6buttonId1"})}var c,a,d,e,f,g,h,k=makeElement("div",null,{id:"autostatTab","class":"tabcontent"});makeElement("div",k,{"class":"jsRX6TabHeading"}).appendChild(document.createTextNode("Autostat Settings"));var l=makeElement("div",k,{"class":"jsRX6Tabs"});b(l);a="autoStat";c="Check this this to enable auto-statting";makeElement("input",h,{type:"checkbox",id:a,value:"checked"},a);makeElement("img",h,{src:stripURI(plussignIcon)});makeElement("label",h,{"for":a,title:c}).appendChild(document.createTextNode("Enable auto-stat"));c="Disable AutoStat when status goals are reached";a="autoStatDisable";makeElement("div",h,{style:"position: absolute; text-align: left; left: 200px; "});makeElement("input",h,{type:"checkbox",id:a,title:c,value:"checked"},a);makeElement("label",h,{"for":a,title:c}).appendChild(document.createTextNode(c));b(l);e=0;for(iLength=autoStatRatios.length;e<iLength;++e){makeElement("div",h,{style:"width:50px;float:left;padding-top:5px"}).appendChild(document.createTextNode(autoStatDescrips[e+1]));h.appendChild(document.createTextNode(" = "));makeElement("input",h,{type:"text",style:"width: 40px;margin-top:3px;",value:GM_getValue(a,0),id:a,size:"1"});h.appendChild(document.createTextNode(" x "));a=autoStatModes[e];var n=makeElement("select",h,{id:a,title:c});d=0;for(jLength=autoStatDescrips.length;d<jLength;++d)f=document.createElement("option"),f.value=d,f.appendChild(document.createTextNode(autoStatDescrips[d])),n.appendChild(f);n.selectedIndex=GM_getValue(autoStatModes[e],0);c="add these for total ";a=autoStatBases[e];h.appendChild(document.createTextNode("+"));makeElement("input",h,{type:"text",style:"width: 40px;",value:GM_getValue(a,0),id:a,size:"1"});c="Check this to distribute points to "+autoStatDescrips[e+1]+" when goals are reached";a=autoStatFallbacks[e];makeElement("input",h,{type:"checkbox",id:a,title:c,value:"checked"},autoStatFallbacks[e]);d=makeElement("label",h,{"for":a,title:c,style:"display:inline-block;width:115px;margin-left:10px"});d.appendChild(document.createTextNode(" "+autoStatDescrips[e+1]+" as fallback"));c="Please select priority level for stat distribution";a=autoStatPrios[e];n=makeElement("select",h,{id:a,title:c});d=0;for(jLength=autoStatRatios.length;d<jLength;++d)f=document.createElement("option"),f.value=d,f.appendChild(document.createTextNode("Priority "+(d+1))),n.appendChild(f);n.selectedIndex=GM_getValue(autoStatPrios[e],0);makeElement("br",h,{"class":"hide"})}if(1==parseXMLResponse()){b(l);l=makeElement("div",h,{style:"float:left;width:155px"});c="Select City Priority";d=makeElement("label",l,{"for":"selectCityPrio",title:c,style:"color: #3A8AC0"});d.appendChild(document.createTextNode(c));makeElement("br",l,{"class":"hide"});f=BRAZIL;for(e=1;3>=e;e++){a="selectCityPrio"+e;c="City Priority "+e+": ";d=makeElement("label",l,{"for":a,title:c});d.appendChild(document.createTextNode(c));c=makeElement("select",l,{id:a,title:c,style:"margin-top:3px"});for(d=BRAZIL;d<=LONDON;d++)choiceSelectCity=makeElement("option",null,{title:cities[d][CITY_NAME]}),choiceSelectCity.text=cities[d][CITY_NAME],choiceSelectCity.value=d,GM_getValue(a,f)==d&&(choiceSelectCity.selected=!0),c.appendChild(choiceSelectCity);f++;makeElement("br",l,{"class":"hide"})}l=makeElement("div",h,{style:"float:left;width:180px"});c="Activate Brazil Crew Members";d=makeElement("label",l,{"for":"selectBrazilCrew",title:c,style:"color: #3A8AC0"});d.appendChild(document.createTextNode(c));makeElement("br",l,{"class":"hide"});for(e=1;e<cityCrewTitles.length;e++){a="selectBrazilCrew"+e;c="Crew Priority "+e+": ";d=makeElement("label",l,{"for":a,title:c,style:"float:left;width:90px;margin-top:5px"});d.appendChild(document.createTextNode(c));c=makeElement("select",l,{id:a,title:c,style:"margin-top:3px;"});for(d=0;d<cityCrewTitles.length;d++)choiceBrazilCrew=makeElement("option",null,{title:cityCrewTitles[d][2]}),choiceBrazilCrew.text=cityCrewTitles[d][0],choiceBrazilCrew.value=d,GM_getValue(a,0)==d&&(choiceBrazilCrew.selected=!0),c.appendChild(choiceBrazilCrew);makeElement("br",l,{"class":"hide"})}l=makeElement("div",h,{style:"float:left",style:"float:left;width:150px;"});c="Chicago Crew Members";d=makeElement("label",l,{"for":"selectChicagoCrew",title:c,style:"color: #3A8AC0"});d.appendChild(document.createTextNode(c));makeElement("br",l,{"class":"hide"});for(e=1;e<cityCrewTitles.length;e++){a="selectChicagoCrew"+e;f=makeElement("select",l,{id:a,title:c,style:"margin-top:3px;margin-left:60px"});for(d=0;d<cityCrewTitles.length;d++)choiceChicagoCrew=makeElement("option",null,{title:cityCrewTitles[d][2]}),choiceChicagoCrew.text=cityCrewTitles[d][0],choiceChicagoCrew.value=d,GM_getValue(a,0)==d&&(choiceChicagoCrew.selected=!0),f.appendChild(choiceChicagoCrew);makeElement("br",l,{"class":"hide"})}l=makeElement("div",h,{style:"float:left",style:"float:left;width:150px;"});c="London Crew Members";d=makeElement("label",l,{"for":"selectLondonCrew",title:c,style:"color: #3A8AC0"});d.appendChild(document.createTextNode(c));makeElement("br",l,{"class":"hide"});for(e=1;e<cityCrewTitles.length;e++){a="selectLondonCrew"+e;f=makeElement("select",l,{id:a,title:c,style:"margin-top:3px;margin-left:60px"});for(d=0;d<cityCrewTitles.length;d++)choiceLondonCrew=makeElement("option",null,{title:cityCrewTitles[d][2]}),choiceLondonCrew.text=cityCrewTitles[d][0],choiceLondonCrew.value=d,GM_getValue(a,0)==d&&(choiceLondonCrew.selected=!0),f.appendChild(choiceLondonCrew);makeElement("br",l,{"class":"hide"})}}return k}function createEnergyTab(){function b(a){f=makeElement("div",a);h=makeElement("div",f,{"class":"lhs"});g=makeElement("div",f,{"class":"rhs"});makeElement("br",f,{"class":"hide"})}var c,a,d,e,f,g,h,k,l=makeElement("div",null,{id:"energyTab","class":"tabcontent"});makeElement("div",l,{style:"width:762px;height:20px;border:none #FFFFFF;float:left;font-size: 18px; font-weight: bold;"}).appendChild(document.createTextNode("Energy Settings:"));var n=makeElement("div",l,{style:"position: relative; top: 0px; margin-left: auto; margin-right: auto; width: 95%; line-height:120%;"});b(n);a="Spend energy automatically.";d="autoMission";makeElement("input",g,{type:"checkbox",id:d,title:a,value:"checked"},"autoMission");e=makeElement("label",g,{"for":d,title:a});e.appendChild(document.createTextNode(" Spend energy to perform any combination of jobs"));makeElement("br",g,{"class":"hide"});d="endLevelOptimize";a="Optimize at end level";makeElement("input",g,{type:"checkbox",id:d,title:a,value:"checked"},d);e=makeElement("label",g,{"for":d,title:a});e.appendChild(document.createTextNode(" "+a+" "));d="endLevelNYOnly";a="use NY jobs only";makeElement("input",g,{type:"checkbox",id:d,title:a,value:"checked"},d);e=makeElement("label",g,{"for":d,title:a});e.appendChild(document.createTextNode(" "+a));b(n);d="autoWithDraw";a="Force Auto Withdraw for Jobs";makeElement("input",g,{type:"checkbox",id:d,title:a},d);e=makeElement("label",g,{"for":d,title:a});e.appendChild(document.createTextNode(" "+a));b(n);c=makeElement("input",h,{id:"unCheckAll",style:"font-size: 10px;padding:2px;",type:"button",value:"Uncheck All"});k=makeElement("div",g,{id:"MissionArray",title:"Missions Array",style:"overflow: auto; width: 300px; height: 150px; border:1px solid #999999; padding: 2px 2px 2px 2px"});b(n);a="Master Tier";d="selectTier";e=makeElement("label",h,{"for":d,title:a});e.appendChild(document.createTextNode("Master tier:"));var o=makeElement("select",g,{id:d,title:a});choiceTier=document.createElement("option");choiceTier.text="Do not master anything";choiceTier.value="0.0";o.appendChild(choiceTier);var p=-1,q=-1,u,A=function(){var a=this.getAttribute("chkId"),b=document.getElementById(a),a=document.getElementById("img"+a);b&&(b.checked?(b.checked=!1,a.src=stripURI(unCheckedIcon)):(b.checked="checked",a.src=stripURI(checkedIcon)))},v=getSavedList("selectMissionMultiple");e=0;for(var w=missions.length;e<w;++e){u=missions[e];u[MISSION_CITY]!=p&&(p=u[MISSION_CITY],d=makeElement("div"),d.innerHTML="=== "+cities[p][CITY_NAME].toUpperCase()+" MISSIONS ===",d.className="ap_optgroup1",k.appendChild(d),choiceTier=document.createElement("optgroup"),choiceTier.label=cities[p][CITY_NAME].toUpperCase(),choiceTier.className="ap_optgroup1",o.appendChild(choiceTier));u[MISSION_TAB]!=q&&(q=u[MISSION_TAB],d=makeElement("div"),d.innerHTML=missionTabs[p][q-1],d.className="ap_optgroup2",k.appendChild(d),choiceTier=document.createElement("option"),choiceTier.text=missionTabs[p][q-1],choiceTier.value=p+"."+q,o.appendChild(choiceTier),GM_getValue("selectTier","0.0")==choiceTier.value&&(choiceTier.selected=!0));a=isNaN(u[MISSION_RATIO])||!u[MISSION_RATIO]?calcJobratio(e):u[MISSION_RATIO];d=missions[e][MISSION_NAME];a=u[MISSION_NAME]+" ("+parseFloat(a)+")";var G=!1;-1!=v.indexOf(""+e)&&(G=!0);u=0==u[MISSION_TABPATH]||100<u[MISSION_TABPATH]?makeElement("div",null,{"class":"ap_option",chkid:d}):makeElement("div",null,{"class":"ap_option",chkid:d,style:"color: red"});u.addEventListener("click",A,!1);makeElement("img",u,{style:"width: 15px; height: 15px;",id:"img"+d,src:G?stripURI(checkedIcon):stripURI(unCheckedIcon)});d=makeElement("input",u,{type:"checkbox",id:d,title:a,style:"display: none",value:"checked"});d.checked=G;u.appendChild(document.createTextNode(" "+a));k.appendChild(u)}c.addEventListener("click",function(){for(var a,b,c=0,d=missions.length;c<d;++c){b=missions[c][MISSION_NAME];a=document.getElementById(b);if((b=document.getElementById("img"+b))&&a.checked)b.src=stripURI(unCheckedIcon);a&&a.checked&&(a.checked=!1)}alert("All Jobs Removed from Selection")},!1);makeElement("br",g,{"class":"hide"});d="skipfight";a="Check this to skip Fighting Style Jobs In Tier Mastery.";makeElement("input",g,{type:"checkbox",id:d,value:"checked"},d);makeElement("label",g,{"for":d}).appendChild(document.createTextNode(" Skip Fighting In Job Tier Mastery "));1==parseXMLResponse()&&(b(n),e=makeElement("label",h,{"for":d,title:a}),e.appendChild(document.createTextNode(" enable Boss Fight:")),a="Boss Fight - Confront Agostino Cleto",d="autoFightAgostino",makeElement("input",g,{type:"checkbox",id:d,title:a,value:"checked"},"autoFightAgostino"),e=makeElement("label",g,{"for":d,title:a}),e.appendChild(document.createTextNode(" Confront Agostino Cleto ")),b(n),e=makeElement("label",h,{"for":d,title:a}),e.appendChild(document.createTextNode(" Spend buff packs:")));a="Periodically check for mini buffs.";d="checkMiniPack";makeElement("input",g,{type:"checkbox",id:d,title:a,value:"checked"},"checkMiniPack");e=makeElement("label",g,{"for":d,title:a});e.appendChild(document.createTextNode(" Mini packs "));makeElement("br",g);a="Spend energy packs if it will not waste energy, as determined by the estimated job ratio setting and your stamina statistics.";d="autoEnergyPack";makeElement("input",g,{type:"checkbox",id:d,title:a,value:"checked"},"autoEnergyPack");e=makeElement("label",g,{"for":d,title:a});a="Estimate the average experience-to-energy ratio of the jobs you will be performing. For example, a job that paid 10 experience points and required 5 energy would have a ratio of 2. Enter 0 if you prefer to have energy packs fire regardless of waste.";d="estimateJobRatio";e.appendChild(document.createTextNode(" Estimated Job Ratio: "));makeElement("input",g,{type:"text",id:d,title:a,style:"width: 2em; ",value:GM_getValue("estimateJobRatio","2")});a="Maximum Amount of energy remaining to trigger the firing of the energy pack.";d="autoEnergyPackForcePts";e.appendChild(document.createTextNode(" Force Energy when energy  falls below "));makeElement("input",g,{type:"text",id:d,title:a,style:"width: 2em; ",value:GM_getValue("autoEnergyPackForcePts","0")});g.appendChild(document.createTextNode(" points "));f=makeElement("div",n,{"class":"single"});f=makeElement("div",n,{"class":"single"});a="Start spending energy For Jobs when energy level is reached";d="selectEnergyUse";f.appendChild(document.createTextNode("Start spending energy for jobs when "));makeElement("input",f,{type:"text",id:d,title:a,style:"width: 2em; ",value:GM_getValue(d,"0")});d="selectEnergyUseMode";f.appendChild(document.createTextNode(" "));c=makeElement("select",f,{id:d,title:a});e=0;for(w=numberSchemes.length;e<w;++e)k=document.createElement("option"),k.value=e,k.appendChild(document.createTextNode(numberSchemes[e])),c.appendChild(k);c.selectedIndex=GM_getValue(d,0);f.appendChild(document.createTextNode(" of energy has accumulated."));f=makeElement("div",n,{"class":"single"});a="Suspend automatic Job play below this level of energy.  NOTE: Mission & Job LOWER limits are completely INDEPENDENT Of Each Other.";d="selectEnergyKeep";f.appendChild(document.createTextNode("While Energy Is Below "));makeElement("input",f,{type:"text",id:d,title:a,style:"width: 2em; ",value:GM_getValue(d,"0")});d="selectEnergyKeepMode";f.appendChild(document.createTextNode(" "));c=makeElement("select",f,{id:d,title:a});e=0;for(w=numberSchemes.length;e<w;++e)k=document.createElement("option"),k.value=e,k.appendChild(document.createTextNode(numberSchemes[e])),c.appendChild(k);c.selectedIndex=GM_getValue(d,0);f.appendChild(document.createTextNode(" Suspend Energy Spending For Above Jobs."));f=makeElement("div",n,{"class":"single"});f=makeElement("div",n,{"class":"single"});a="Suspend automatic operations below this level of energy.  NOTE: Operations & Job LOWER limits are completely INDEPENDENT Of Each Other.";d="selectMissionEnergyKeep";f.appendChild(document.createTextNode("While Energy Is Below "));makeElement("input",f,{type:"text",id:d,title:a,style:"width: 2em; ",value:GM_getValue(d,"0")});d="selectMissionEnergyKeepMode";f.appendChild(document.createTextNode(" "));c=makeElement("select",f,{id:d,title:a});e=0;for(w=numberSchemes.length;e<w;++e)k=document.createElement("option"),k.value=e,k.appendChild(document.createTextNode(numberSchemes[e])),c.appendChild(k);c.selectedIndex=GM_getValue(d,0);f.appendChild(document.createTextNode(" Suspend Energy Spending For Operations."));f=makeElement("div",n,{"class":"single"});a="Ignore minimum energy settings if a level up is within reach.";d="allowEnergyToLevelUp";makeElement("input",f,{type:"checkbox",id:d,title:a,value:"checked"},d);e=makeElement("label",f,{"for":d,title:a});e.appendChild(document.createTextNode(" Don't reserve energy if within reach of the next level."));return l}function createEnergyTabNew2012(){function b(a){f=makeElement("div",a);jqRX6buttonId1=makeElement("div",f,{"class":"jqRX6buttonId1"})}var c,a,d,e,f,g,h=makeElement("div",null,{id:"energyTab","class":"tabcontent"});makeElement("div",h,{"class":"jsRX6TabHeading"}).appendChild(document.createTextNode("Energy Settings"));var k=makeElement("div",h,{"class":"jsRX6Tabs"});b(k);a="Spend energy automatically.";d="autoMission";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:d,title:a,value:"checked"},"autoMission");e=makeElement("label",jqRX6buttonId1,{"for":d,title:a,"class":"jqSpacer"});e.appendChild(document.createTextNode("Spend energy to perform any combination of jobs"));makeElement("br",jqRX6buttonId1,{"class":"hide"});d="endLevelOptimize";a="Optimize at end level";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:d,title:a,value:"checked"},d);e=makeElement("label",jqRX6buttonId1,{"for":d,title:a,"class":"jqSpacer"});e.appendChild(document.createTextNode(" "+a+" "));d="endLevelNYOnly";a="Use NY jobs only";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:d,title:a,value:"checked"},d);e=makeElement("label",jqRX6buttonId1,{"for":d,title:a,"class":"jqSpacer"});e.appendChild(document.createTextNode(" "+a));d="autoWithDraw";a="Force Auto Withdraw for Jobs";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:d,title:a},d);e=makeElement("label",jqRX6buttonId1,{"for":d,title:a,"class":"jqSpacer"});e.appendChild(document.createTextNode(" "+a));d="allowEnergyToLevelUp";a="Ignore minimum energy settings if a level up is within reach.";f=makeElement("div",jqRX6buttonId1);makeElement("input",jqRX6buttonId1,{type:"checkbox",id:d,title:a,value:"checked"},d);e=makeElement("label",jqRX6buttonId1,{"for":d,title:a,"class":"jqSpacer"});e.appendChild(document.createTextNode(" Don't reserve energy if within reach of the next level."));makeElement("br",jqRX6buttonId1,{"class":"hide"});c=makeElement("input",jqRX6buttonId1,{id:"unCheckAll",style:"font-size: 10px;padding:2px;",type:"button",value:"Uncheck All"});g=makeElement("div",jqRX6buttonId1,{id:"MissionArray",title:"Missions Array",style:"overflow: auto; width: 330px; height: 150px; border:1px solid #999999; padding: 2px; margin-right:5px"});makeElement("br",jqRX6buttonId1,{"class":"hide"});a="Master Tier";d="selectTier";e=makeElement("label",jqRX6buttonId1,{"for":d,title:a,"class":"jqSpacer"});e.appendChild(document.createTextNode("Master tier:"));var l=makeElement("select",jqRX6buttonId1,{id:d,title:a,style:"margin-right:5px"});choiceTier=document.createElement("option");choiceTier.text="Do not master anything";choiceTier.value="0.0";l.appendChild(choiceTier);var n=-1,o=-1,p,q=function(){var a=this.getAttribute("chkId"),b=document.getElementById(a),a=document.getElementById("img"+a);b&&(b.checked?(b.checked=!1,a.src=stripURI(unCheckedIcon)):(b.checked="checked",a.src=stripURI(checkedIcon)))},u=getSavedList("selectMissionMultiple");e=0;for(var A=missions.length;e<A;++e){p=missions[e];p[MISSION_CITY]!=n&&(n=p[MISSION_CITY],d=makeElement("div"),d.innerHTML="=== "+cities[n][CITY_NAME].toUpperCase()+" MISSIONS ===",d.className="ap_optgroup1",g.appendChild(d),choiceTier=document.createElement("optgroup"),choiceTier.label=cities[n][CITY_NAME].toUpperCase(),choiceTier.className="ap_optgroup1",l.appendChild(choiceTier));p[MISSION_TAB]!=o&&(o=p[MISSION_TAB],d=makeElement("div"),d.innerHTML=missionTabs[n][o-1],d.className="ap_optgroup2",g.appendChild(d),choiceTier=document.createElement("option"),choiceTier.text=missionTabs[n][o-1],choiceTier.value=n+"."+o,l.appendChild(choiceTier),GM_getValue("selectTier","0.0")==choiceTier.value&&(choiceTier.selected=!0));a=isNaN(p[MISSION_RATIO])||!p[MISSION_RATIO]?calcJobratio(e):p[MISSION_RATIO];d=missions[e][MISSION_NAME];a=p[MISSION_NAME]+" ("+parseFloat(a)+")";var v=!1;-1!=u.indexOf(""+e)&&(v=!0);p=0==p[MISSION_TABPATH]||100<p[MISSION_TABPATH]?makeElement("div",null,{"class":"ap_option",chkid:d}):makeElement("div",null,{"class":"ap_option",chkid:d,style:"color: red"});p.addEventListener("click",q,!1);makeElement("img",p,{style:"width: 15px; height: 15px;",id:"img"+d,src:v?stripURI(checkedIcon):stripURI(unCheckedIcon)});d=makeElement("input",p,{type:"checkbox",id:d,title:a,style:"display: none",value:"checked"});d.checked=v;p.appendChild(document.createTextNode(" "+a));g.appendChild(p)}c.addEventListener("click",function(){for(var a,b,c=0,d=missions.length;c<d;++c){b=missions[c][MISSION_NAME];a=document.getElementById(b);if((b=document.getElementById("img"+b))&&a.checked)b.src=stripURI(unCheckedIcon);a&&a.checked&&(a.checked=!1)}alert("All Jobs Removed from Selection")},!1);d="skipfight";a="Check this to skip Fighting Style Jobs In Tier Mastery.";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:d,value:"checked"},d);makeElement("label",jqRX6buttonId1,{"for":d,"class":"jqSpacer"}).appendChild(document.createTextNode("Skip Fighting In Job Tier Mastery"));1==parseXMLResponse()&&(b(k),a="Boss Fight - Confront Agostino Cleto",d="autoFightAgostino",makeElement("input",jqRX6buttonId1,{type:"checkbox",id:d,title:a,value:"checked"},"autoFightAgostino"),e=makeElement("label",jqRX6buttonId1,{"for":d,title:a,"class":"jqSpacer"}),e.appendChild(document.createTextNode("Boss Fight: Confront Agostino Cleto")));a="Periodically check for mini buffs.";d="checkMiniPack";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:d,title:a,value:"checked"},"checkMiniPack");e=makeElement("label",jqRX6buttonId1,{"for":d,title:a,"class":"jqSpacer"});e.appendChild(document.createTextNode("Mini packs"));makeElement("br",jqRX6buttonId1);b(k);a="Spend energy packs if it will not waste energy, as determined by the estimated job ratio setting and your stamina statistics.";d="autoEnergyPack";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:d,title:a,value:"checked"},"autoEnergyPack");e=makeElement("label",jqRX6buttonId1,{"for":d,title:a,"class":"jqSpacer"});a="Estimate the average experience-to-energy ratio of the jobs you will be performing. For example, a job that paid 10 experience points and required 5 energy would have a ratio of 2. Enter 0 if you prefer to have energy packs fire regardless of waste.";d="estimateJobRatio";e.appendChild(document.createTextNode("Estimated Job Ratio:"));makeElement("input",jqRX6buttonId1,{type:"text",id:d,title:a,style:"width: 2em; ",value:GM_getValue("estimateJobRatio","2")});a="Maximum Amount of energy remaining to trigger the firing of the energy pack.";d="autoEnergyPackForcePts";e.appendChild(document.createTextNode(" Force Energy when energy  falls below "));makeElement("input",jqRX6buttonId1,{type:"text","class":"jqSpacer",id:d,title:a,style:"width: 12px; ",value:GM_getValue("autoEnergyPackForcePts","0")});jqRX6buttonId1.appendChild(document.createTextNode(" points "));f=makeElement("div",k,{"class":"single"});f=makeElement("div",jqRX6buttonId1);a="Start spending energy For Jobs when energy level is reached";d="selectEnergyUse";f.appendChild(document.createTextNode("Start spending energy for jobs when "));makeElement("input",f,{type:"text",id:d,title:a,style:"width: 2em; ",value:GM_getValue(d,"0")});d="selectEnergyUseMode";f.appendChild(document.createTextNode(" "));c=makeElement("select",f,{id:d,title:a});e=0;for(A=numberSchemes.length;e<A;++e)g=document.createElement("option"),g.value=e,g.appendChild(document.createTextNode(numberSchemes[e])),c.appendChild(g);c.selectedIndex=GM_getValue(d,0);f.appendChild(document.createTextNode(" of energy has accumulated."));f=makeElement("div",jqRX6buttonId1,{style:"margin-left:82px;margin-top:2px"});a="Suspend automatic Job play below this level of energy.  NOTE: Mission & Job LOWER limits are completely INDEPENDENT Of Each Other.";d="selectEnergyKeep";f.appendChild(document.createTextNode("While Energy Is Below "));makeElement("input",f,{type:"text",id:d,title:a,style:"width: 2em; ",value:GM_getValue(d,"0")});d="selectEnergyKeepMode";f.appendChild(document.createTextNode(" "));c=makeElement("select",f,{id:d,title:a});e=0;for(A=numberSchemes.length;e<A;++e)g=document.createElement("option"),g.value=e,g.appendChild(document.createTextNode(numberSchemes[e])),c.appendChild(g);c.selectedIndex=GM_getValue(d,0);f.appendChild(document.createTextNode(" suspend Energy Spending for above Jobs."));f=makeElement("div",k,{"class":"single"});f=makeElement("div",jqRX6buttonId1,{style:"margin-left:82px;margin-top:2px"});a="Suspend automatic operations below this level of energy.  NOTE: Operations & Job LOWER limits are completely INDEPENDENT Of Each Other.";d="selectMissionEnergyKeep";f.appendChild(document.createTextNode("While Energy Is Below "));makeElement("input",f,{type:"text",id:d,title:a,style:"width: 2em; ",value:GM_getValue(d,"0")});d="selectMissionEnergyKeepMode";f.appendChild(document.createTextNode(" "));c=makeElement("select",f,{id:d,title:a});e=0;for(A=numberSchemes.length;e<A;++e)g=document.createElement("option"),g.value=e,g.appendChild(document.createTextNode(numberSchemes[e])),c.appendChild(g);c.selectedIndex=GM_getValue(d,0);f.appendChild(document.createTextNode(" suspend Energy Spending for Operations."));return h}function tabContainerDivs(b){item=makeElement("div",b);lhs=makeElement("div",item,{"class":"lhs"});rhs=makeElement("div",item,{"class":"rhs"});makeElement("br",item,{"class":"hide"})}function clearStronger(){fightListAvoid.set([]);hitmanListAvoid.set([]);alert("Stronger Opponents Lists cleared")}function removeStrongerOpponents(b){tabContainerDivs(b);title="Remove stronger opponents from the list automatically.";id="fightRemoveStronger";makeElement("input",rhs,{type:"checkbox",id:id,title:title,style:"vertical-align:middle",value:"checked"},"fightRemoveStronger","checked");label=makeElement("label",rhs,{"for":id,title:title});label.appendChild(document.createTextNode(" Remove stronger opponents "));1==parseXMLResponse()&&(title="Clear Stronger Opponents List",id="clearRemoveStronger",eltA=makeElement("a",rhs,{id:id,href:"#",alt:title,title:title,style:"float:right;margin:2px 0px 0px 20px;"}),eltA.appendChild(document.createTextNode("Clear 'Stronger Opponents' Lists")),eltA.addEventListener("click",clearStronger,!1),makeElement("br",rhs),title="Revert to Fightlist if no Rivals.",id="fightFallback",makeElement("input",rhs,{type:"checkbox",id:id,title:title,style:"vertical-align:middle",value:"checked"},"fightFallback","checked"),label=makeElement("label",rhs,{"for":id,title:title}),label.appendChild(document.createTextNode(" Revert to Fightlist if no Rivals")))}function createStaminaSubTab_FightRandom(b){tabContainerDivs(b);makeElement("label",lhs).appendChild(document.createTextNode("Fight in: "));id="fightRandomLoc";var c=makeElement("select",lhs,{id:id});i=0;for(iLength=fightLocations.length;i<iLength;++i)a=document.createElement("option"),a.value=i,a.appendChild(document.createTextNode(fightLocations[i])),i<cities.length&&cities[i][CITY_CLOSED]&&(a.style.display="none"),c.appendChild(a);c.selectedIndex=GM_getValue("fightLocation",NY);rhs.appendChild(document.createTextNode(" while gaining: "));title="Reattack if this amount is gained";id="reattackThreshold";makeElement("input",rhs,{type:"text",id:id,title:title,maxlength:6,style:"width: 45px; border: 1px solid #781351;",value:GM_getValue(id,"10000"),size:"1"});label=makeElement("label",rhs,{"for":id,title:title,style:"margin-left: 0.5em;"});title="Attack ONLY live targets";id="iceCheck";makeElement("input",rhs,{type:"checkbox",id:id,title:title,style:"margin-left: 0.5em;",value:"checked"},"iceCheck");label=makeElement("label",rhs,{"for":id,title:title});label.appendChild(document.createTextNode(" Skip iced targets"));title="Power Attack";id="staminaPowerattack";makeElement("input",rhs,{type:"checkbox",id:id,title:title,style:"margin-left: 0.5em;",value:"checked"},id);label=makeElement("label",rhs,{"for":id,title:title,style:"margin-left: 0.5em;"});label.appendChild(document.createTextNode("Powerattack"));if(1==parseXMLResponse()){tabContainerDivs(b);makeElement("label",lhs,{"for":id,title:title}).appendChild(document.createTextNode(" Back Ground Speed: "));c=makeElement("select",rhs,{id:"fastBGFSpeed"});iLength=mwapSpeedModes.length;for(i=0;i<iLength;++i)a=document.createElement("option"),a.value=i,a.appendChild(document.createTextNode(mwapSpeedModes[i])),c.appendChild(a);c.selectedIndex=GM_getValue("fastBGFSpeed",0);makeElement("label",rhs,{"for":id,title:title}).appendChild(document.createTextNode(" *is ignored in normal fight mode "))}tabContainerDivs(b);makeElement("label",lhs).appendChild(document.createTextNode("Fight (Rivals) Mode: "));id="fightRivalsMode";c=makeElement("select",rhs,{id:id});i=0;for(iLength=fightRivalsModes.length;i<iLength;++i)a=document.createElement("option"),a.value=i,a.appendChild(document.createTextNode(fightRivalsModes[i])),c.appendChild(a);c.selectedIndex=GM_getValue("fightRivalsMode",0);removeStrongerOpponents(b);tabContainerDivs(b);title="Avoid opponents higher than this level.";id="fightLevelMax";label=makeElement("label",lhs,{"for":id,title:title});label.appendChild(document.createTextNode("Maximum level:"));makeElement("input",rhs,{type:"text",id:id,title:title,maxlength:5,style:"width: 30px; border: 1px solid #781351;",value:GM_getValue("fightLevelMax","100"),size:"1"});title="Make the maximum level be relative to your own. For example, if your level is 10, and maximum level is set to 5, opponents higher than level 15 will be avoided.";id="fightLevelMaxRelative";makeElement("input",rhs,{type:"checkbox",id:id,title:title,style:"margin-left: 0.5em;",value:"checked"},"fightLevelMaxRelative");label=makeElement("label",rhs,{"for":id,title:title});label.appendChild(document.createTextNode(" Add my level"));tabContainerDivs(b);makeElement("label",lhs).appendChild(document.createTextNode("Fight Label Criteria: "));id="fightLabelCriteria";c=makeElement("select",rhs,{id:id});i=0;for(iLength=fightLabels.length;i<iLength;++i){var a=document.createElement("option");a.value=i;a.appendChild(document.createTextNode(fightLabels[i][0]));c.appendChild(a)}c.selectedIndex=GM_getValue("fightLabelCriteria",0);1==parseXMLResponse()&&(tabContainerDivs(b),title="Avoid opponents with higher health than this setting - Set 0 for unlimited",id="fightHealthMax",label=makeElement("label",lhs,{"for":id,title:title}),label.appendChild(document.createTextNode("Maximum Health / ")),makeElement("input",rhs,{type:"text",id:id,title:title,maxlength:5,style:"width: 30px; border: 1px solid #781351;",value:GM_getValue("fightHealthMax","0"),size:"1"}),title="Avoid opponents with higher health pct left than this setting - Set 0 for unlimited",id="fightHealthPctMax",label=makeElement("label",lhs,{"for":id,title:title}),label.appendChild(document.createTextNode(" Maximum Health Pct:")),makeElement("input",rhs,{type:"text",id:id,title:title,maxlength:5,style:"margin-left:5px;width: 30px; border: 1px solid #781351;",value:GM_getValue("fightHealthPctMax","0"),size:"1"}),tabContainerDivs(b),title="Maximum number of Attacks per Opponenent - Set 0 for unlimited",id="fightMaxAttacks",label=makeElement("label",lhs,{"for":id,title:title}),label.appendChild(document.createTextNode("Maximum # Attacks:")),makeElement("input",rhs,{type:"text",id:id,title:title,maxlength:3,style:"width: 30px; border: 1px solid #781351;",value:GM_getValue("fightMaxAttacks","100"),size:"1"}));tabContainerDivs(b);id="fightMafiaMax";title="Avoid opponents with mafia sizes larger than this.";label=makeElement("label",lhs,{"for":id,title:title});label.appendChild(document.createTextNode("Maximum mafia:"));makeElement("input",rhs,{type:"text",id:id,title:title,style:"width: 30px; border: 1px solid #781351;",value:GM_getValue("fightMafiaMax","501"),size:"1"});title="Make the maximum mafia size be relative to your own. For example, if you have 300 mafia members, and maximum mafia is set to 50, opponents with more than 350 mafia members will be avoided.";id="fightMafiaMaxRelative";makeElement("input",rhs,{type:"checkbox",id:id,title:title,style:"margin-left: 0.5em;",value:"checked"},"fightMafiaMaxRelative");label=makeElement("label",rhs,{"for":id,title:title});label.appendChild(document.createTextNode(" Relative  |  Minimum Mafia: "));id="fightMafiaMin";title="Avoid opponents with mafia sizes smaller than this.";label=makeElement("label",lhs,{"for":id,title:title});makeElement("input",rhs,{type:"text",id:id,title:title,style:"width: 30px; border: 1px solid #781351;",value:GM_getValue("fightMafiaMin","1"),size:"1"});title="Make the minimum mafia size be relative to your own. For example, if you have 300 mafia members, and minimum mafia is set to 50, opponents with less than 250 mafia members will be avoided.";id="fightMafiaMinRelative";makeElement("input",rhs,{type:"checkbox",id:id,title:title,style:"margin-left: 0.5em;",value:"checked"},"fightMafiaMinRelative");label=makeElement("label",rhs,{"for":id,title:title});label.appendChild(document.createTextNode(" Relative"));tabContainerDivs(b);title="Fight higher levels if the mafia is smaller.  You mob them, overwhelm the smaller numbers";id="fightMobMode";makeElement("input",rhs,{type:"checkbox",id:id,title:title,value:"checked"},"fightMobMode");label=makeElement("label",rhs,{"for":id,title:title});label.appendChild(document.createTextNode(" Mob Fight  "));title="Fight Ice Stealers";id="fightIceStealers";makeElement("input",rhs,{type:"checkbox",id:id,title:title,value:"checked"},"fightIceStealers");label=makeElement("label",rhs,{"for":id,title:title});label.appendChild(document.createTextNode(" Attack Ice Stealers "));tabContainerDivs(b);title=" Use Mafia Family Patterns when fighting";id="fightNames";b=makeElement("input",lhs,{type:"checkbox",id:id,value:"checked"},id);makeElement("label",lhs,{"for":id}).appendChild(document.createTextNode(" Use Patterns when fighting:"));b.addEventListener("click",clickUseFightNames,!1);makeElement("br",lhs);id="fightAvoidNames";title=" Avoid mafia families";makeElement("input",lhs,{type:"radio",name:"rm3",id:id,value:"checked"},id);makeElement("label",lhs,{"for":id}).appendChild(document.createTextNode(title));makeElement("br",lhs);id="fightOnlyNames";title=" Only Fight Mafia Families ";makeElement("input",lhs,{type:"radio",name:"rm3",id:id,value:"checked"},id);makeElement("label",lhs,{"for":id}).appendChild(document.createTextNode(title));makeElement("textarea",rhs,{style:"position: static; width: 15em; height: 6em;",id:"fightClanName",title:"Enter each pattern (such as a clan name) on a separate line."}).appendChild(document.createTextNode(GM_getValue("fightClanName",defaultClans.join("\n"))));makeElement("br",rhs);makeElement("font",rhs,{style:"font-size: 10px;"}).appendChild(document.createTextNode("Enter each name pattern on a separate line."))}function createStaminaSubTab_FightSpecific(b){tabContainerDivs(b);makeElement("label",lhs).appendChild(document.createTextNode("Fight in: "));id="fightListLoc";var c=makeElement("select",lhs,{id:id});i=0;for(iLength=fightLocations.length;i<iLength;++i)choice=document.createElement("option"),choice.value=i,choice.appendChild(document.createTextNode(fightLocations[i])),i<cities.length&&cities[i][CITY_CLOSED]&&(choice.style.display="none"),c.appendChild(choice);c.selectedIndex=GM_getValue("fightLocation",NY);rhs.appendChild(document.createTextNode(" while gaining: "));title="Reattack if this amount is gained";id="reattackThresholdList";makeElement("input",rhs,{type:"text",id:id,title:title,maxlength:6,style:"width: 45px;",value:GM_getValue(id,"10000"),size:"2"});label=makeElement("label",rhs,{"for":id,title:title,style:"margin-left: 0.5em;"});title="Attack ONLY live targets";id="iceCheck";makeElement("input",rhs,{type:"checkbox",id:id,title:title,style:"margin-left: 0.5em;",value:"checked"},"iceCheck");label=makeElement("label",rhs,{"for":id,title:title});label.appendChild(document.createTextNode(" Skip iced targets"));title="Power Attack";id="staminaPowerattack";makeElement("input",rhs,{type:"checkbox",id:id,title:title,style:"margin-left: 0.5em;",value:"checked"},id);label=makeElement("label",rhs,{"for":id,title:title,style:"margin-left: 0.5em;"});label.appendChild(document.createTextNode("Powerattack"));tabContainerDivs(b);lhs.appendChild(document.createTextNode("Fight these opponents:"));makeElement("textarea",rhs,{style:"position: static; width: 180px; height: 105px;",id:"pfightlist",title:"Enter each opponent's ID (not their name) on a separate line."}).appendChild(document.createTextNode(GM_getValue("pfightlist","")));makeElement("br",rhs);makeElement("font",rhs,{style:"font-size: 10px;"}).appendChild(document.createTextNode("Enter each target on a separate line. Add the userid part of the p|userid."));tabContainerDivs(b);lhs.appendChild(document.createTextNode("Add ID's from Family Page:"));title="Clear Fight List";id="fightListClear";eltA=makeElement("a",rhs,{id:id,href:"#",alt:title,title:title});eltA.appendChild(document.createTextNode("Clear MW Id's"));eltA.addEventListener("click",clearFight,!1);title="Load MW Id's from family Page";id="fightListUpdate";eltA=makeElement("a",rhs,{id:id,href:"#",alt:title,title:title,style:"margin-left:10px;"});eltA.appendChild(document.createTextNode("Add MW Id's"));eltA.addEventListener("click",addPageToFight,!1);tabContainerDivs(b);lhs.appendChild(document.createTextNode("Enter MW Profile Link:"));title="Enter MW Profile Link";id="fightListSingleLink";makeElement("input",rhs,{type:"text",id:id,title:title,style:"width: 300px;"});makeElement("br",rhs);id="fightListSingleAdd";eltA=makeElement("a",rhs,{id:id,href:"#",alt:title,title:title});eltA.appendChild(document.createTextNode("Add Single ID"));eltA.addEventListener("click",addSingleID,!1);tabContainerDivs(b);removeStrongerOpponents(b)}function addSingleID(){var b,c=document.getElementById("pfightlist"),a=c.innerHTML;decodeURIComponent(document.getElementById("fightListSingleLink").value).match(/user(.+)/)?(b=decodeID(RegExp.$1).replace(/\D/g,""))&&b!=xw_user&&-1==a.indexOf(b)?c.innerHTML=""!=a?a+("\n"+b):b:alert("You can not add/already added this profile link: "+b):alert("Invalid profile link.");document.getElementById("fightListSingleLink").value=""}function clearFight(){var b=document.getElementById("pfightlist");b&&(b.value="",b.innerHTML="")}function addPageToFight(){var b="",c=0,a,d=document.getElementById("pfightlist");if(d)if(b=d.innerHTML,(a=xpathFirst('.//ul[id="member_list"]'))||(a=document.getElementById("member_list")),a){var e=$x('.//div[@class="name_n_rank"]//a[contains(@href,"user=")]',a);if(e&&0<e.length){i=0;for(iLength=e.length;i<iLength;++i)if(e[i].getAttribute("href").match(/(user|opponent_id)\=(.+)/)&&(a=decodeID(RegExp.$2).replace(/\D/g,""))&&a!=xw_user&&-1==b.indexOf(a))b=""!=b?b+("\n"+a):a,c++;d.value=b;d.innerHTML=b;alert("Added "+c+" out of "+e.length+" members")}else alert("Found NO members")}else alert("Adding MW Id's is only possible from a Family Page")}function createStaminaSubTab_RobFight(b){tabContainerDivs(b);title="Switch from Robbing to Fighting when falling below this stamina (min 25).";id="robFightStaminaFloor";lhs.appendChild(document.createTextNode(" Stamina to switch from robbing to fighting: "));makeElement("input",rhs,{type:"text",id:id,value:GM_getValue(id,"25"),title:title,size:"6",maxlength:6,style:"text-align: right;"});createStaminaSubTab_Rob(b);makeElement("hr",b);createStaminaSubTab_FightRandom(b)}function createStaminaSubTab_FightRob(b){createStaminaSubTab_Rob(b);makeElement("hr",b);makeElement("font",b,{style:"font-size: 10px;text-align:center;color:yellow;"}).appendChild(document.createTextNode("Switching from fighting to robbing when 'Fight then Rob' is determined by the health setting from the Health subTab."));createStaminaSubTab_FightRandom(b)}function createStaminaSubTab_Rob(b){tabContainerDivs(b);item.appendChild(document.createTextNode("     Rob in:"));id="robLocation";b=makeElement("select",item,{id:id});i=0;for(iLength=locations.length;i<iLength;++i)choice=document.createElement("option"),choice.value=i,choice.appendChild(document.createTextNode(locations[i])),i<cities.length&&cities[i][CITY_CLOSED]&&(choice.style.display="none"),b.appendChild(choice);b.selectedIndex=GM_getValue("robLocation",NY);title="Fast rob, does not log / does not spend burners";id="fastRob";makeElement("input",item,{type:"checkbox",id:id,title:title,value:"checked",style:"margin-left: 10px;"},id);label=makeElement("label",item,{"for":id,title:title});label.appendChild(document.createTextNode(" Fast Rob?"));makeElement("label",item,{"for":id,title:title}).appendChild(document.createTextNode(" Speed: "));b=makeElement("select",item,{id:"fastRobSpeed"});iLength=mwapSpeedModes.length;1!=parseXMLResponse()&&(iLength-=2);for(i=0;i<iLength;++i)choice=document.createElement("option"),choice.value=i,choice.appendChild(document.createTextNode(mwapSpeedModes[i])),b.appendChild(choice);b.selectedIndex=GM_getValue("fastRobSpeed",0);title="Use Burners (one per property)";id="useBurners";makeElement("input",item,{type:"checkbox",id:id,title:title,value:"checked",style:"margin-left: 10px;"},id);label=makeElement("label",item,{"for":id,title:title});label.appendChild(document.createTextNode(" Use Burners?"));title="Use RobSquads";id="useRobSquads";makeElement("input",item,{type:"checkbox",id:id,title:title,value:"checked",style:"margin-left: 10px;"},id);label=makeElement("label",item,{"for":id,title:title});label.appendChild(document.createTextNode(" Use Rob Squads?"))}function createStaminaSubTab_CollectBounties(b){tabContainerDivs(b);lhs.appendChild(document.createTextNode("Collect bounties in:"));id="hitmanLocation";var c=makeElement("select",rhs,{id:id});i=0;for(iLength=locations.length;i<iLength;++i)choice=document.createElement("option"),choice.value=i,choice.appendChild(document.createTextNode(locations[i])),i<cities.length&&cities[i][CITY_CLOSED]&&(choice.style.display="none"),c.appendChild(choice);c.selectedIndex=GM_getValue("hitmanLocation",NY);tabContainerDivs(b);id="hitmanBountyMin";title="Ignore targets with bounties below this measly amount.";label=makeElement("label",lhs,{"for":id,title:title});label.appendChild(document.createTextNode("Minimum bounty:"));makeElement("input",rhs,{type:"text",id:id,title:title,style:"width: 7em; border: 1px solid #781351;",value:GM_getValue("hitmanBountyMin","0")});tabContainerDivs(b);lhs.appendChild(document.createTextNode("Prefer targets with:"));id="bountySelection";c=makeElement("select",rhs,{id:id});i=0;for(iLength=bountySelectionChoices.length;i<iLength;++i)choice=document.createElement("option"),choice.value=i,choice.appendChild(document.createTextNode(bountySelectionChoices[i])),c.appendChild(choice);c.selectedIndex=GM_getValue("bountySelection",BOUNTY_HIGHEST_BOUNTY);tabContainerDivs(b);title=" Use Mafia Family Patterns for collecting bounties";id="hitmanNames";c=makeElement("input",lhs,{type:"checkbox",id:id,value:"checked"},id);makeElement("label",lhs,{"for":id}).appendChild(document.createTextNode(" Use Patterns when collecting:"));c.addEventListener("click",clickUseHitmanNames,!1);makeElement("br",lhs);id="hitmanAvoidNames";title=" Avoid mafia families";makeElement("input",lhs,{type:"radio",name:"rm3",id:id,value:"checked"},id);makeElement("label",lhs,{"for":id}).appendChild(document.createTextNode(title));makeElement("br",lhs);id="hitmanOnlyNames";title=" Only Fight Mafia Families ";makeElement("input",lhs,{type:"radio",name:"rm3",id:id,value:"checked"},id);makeElement("label",lhs,{"for":id}).appendChild(document.createTextNode(title));makeElement("textarea",rhs,{style:"position: static; width: 15em; height: 6em;",id:"hitmanClanName",title:"Enter each pattern (such as a clan name) on a separate line."}).appendChild(document.createTextNode(GM_getValue("hitmanClanName",defaultClans.join("\n"))));makeElement("br",rhs);makeElement("font",rhs,{style:"font-size: 10px;"}).appendChild(document.createTextNode("Enter each name pattern on a separate line."));tabContainerDivs(b);removeStrongerOpponents(b)}function createStaminaSubTab_SetBounties(b){tabContainerDivs(b);lhs.appendChild(document.createTextNode("Place bounties in:"));id="autoHitListLoc";var c=makeElement("select",rhs,{id:id});i=0;for(iLength=locations.length;i<iLength;++i)choice=document.createElement("option"),choice.value=i,choice.appendChild(document.createTextNode(locations[i])),i<cities.length&&cities[i][CITY_CLOSED]&&(choice.style.display="none"),c.appendChild(choice);c.selectedIndex=GM_getValue("autoHitListLoc",NY);title="Set Bounties in background";id="bgAutoHitCheck";makeElement("input",rhs,{type:"checkbox",id:id,title:title,style:"margin-left: 0.5em;",value:"checked"},"bgAutoHitCheck");label=makeElement("label",rhs,{"for":id,title:title});label.appendChild(document.createTextNode(" Enable Background mode"));tabContainerDivs(b);id="autoHitListBounty";title="Place a fixed bounty or check random";label=makeElement("label",lhs,{"for":id,title:title});label.appendChild(document.createTextNode("Bounty:"));makeElement("input",rhs,{type:"text",id:id,title:title,style:"width: 7em; border: 1px solid #781351;",value:GM_getValue("autoHitListBounty","0")});title="Place Random Bounties";id="autoHitListRandom";makeElement("input",rhs,{type:"checkbox",id:id,title:title,style:"margin-left: 0.5em;",value:"checked"},"autoHitListRandom");label=makeElement("label",rhs,{"for":id,title:title});label.appendChild(document.createTextNode(" random"));tabContainerDivs(b);lhs.appendChild(document.createTextNode("Hitlist these opponents:"));makeElement("textarea",rhs,{style:"position: static; width: 180px; height: 105px;",id:"pautoHitOpponentList",title:"Enter each opponent's ID (not their name) on a separate line."}).appendChild(document.createTextNode(GM_getValue("pautoHitOpponentList","")));makeElement("br",rhs);makeElement("font",rhs,{style:"font-size: 10px;"}).appendChild(document.createTextNode("Enter each target on a separate line. Add the userid part of the p|userid."))}function createStaminaSubTab_Random(b){var c=GM_getValue("randomSpendModes");c||(c="1000");var a=makeElement("div",b,{style:"margin-left:0.5em;"});makeElement("br",a);title="Stamina Spend Choice selection";name="randomSpendModes[]";i=0;for(iLength=randomSpendChoices.length;i<iLength;++i)randomSpendChoices[i]?("0"!=c[i]?makeElement("input",a,{type:"checkbox",name:name,title:randomSpendChoices[i],style:"margin-left: 0.5em;margin-right: 0.5em;",value:c[i],checked:"checked"}):makeElement("input",a,{type:"checkbox",name:name,title:randomSpendChoices[i],style:"margin-left: 0.5em;margin-right: 0.5em;",value:c[i]}),label=makeElement("label",a,{"for":name,title:title}),label.appendChild(document.createTextNode(randomSpendChoices[i]))):makeElement("input",a,{type:"checkbox",name:name,title:"invalid option",style:"display:none;",value:"0"});makeElement("br",a);var d=GM_getValue("randomFightLocations");d||(d="100000000");a=makeElement("div",b,{style:"margin-left:0.5em;margin-top:1em;"});a.appendChild(document.createTextNode("Location Settings :"));makeElement("br",a);a.appendChild(document.createTextNode("Fight in:"));makeElement("br",a);title="Fighting cities selection";name="randomFightLocations[]";i=0;for(iLength=randomLocations.length;i<iLength;++i){var e=!1;i<cities.length&&cities[i][CITY_CLOSED]&&(e=!0);c="1"==d[i]&&!e?makeElement("input",a,{type:"checkbox",name:name,title:locations[i],style:"margin-left: 0.5em;margin-right: 0.5em;",value:locations[i],checked:"checked"}):makeElement("input",a,{type:"checkbox",name:name,title:locations[i],style:"margin-left: 0.5em;margin-right: 0.5em;",value:locations[i]});e&&(c.style.display="none");label=makeElement("label",a,{"for":name,title:title});label.appendChild(document.createTextNode(locations[i]))}makeElement("br",a);(d=GM_getValue("randomRobLocations"))||(d="100000000");a=makeElement("div",b,{style:"margin-left:0.5em;"});a.appendChild(document.createTextNode("Rob in:"));makeElement("br",a);title="Robbing cities selection";name="randomRobLocations[]";i=0;for(iLength=randomLocations.length;i<iLength;++i)e=!1,i<cities.length&&cities[i][CITY_CLOSED]&&(e=!0),c="1"==d[i]&&!e?makeElement("input",a,{type:"checkbox",name:name,title:locations[i],style:"margin-left: 0.5em;margin-right: 0.5em;",value:locations[i],checked:"checked"}):makeElement("input",a,{type:"checkbox",name:name,title:locations[i],style:"margin-left: 0.5em;margin-right: 0.5em;",value:locations[i]}),e&&(c.style.display="none"),label=makeElement("label",a,{"for":name,title:title}),label.appendChild(document.createTextNode(locations[i]));makeElement("br",a);(d=GM_getValue("randomHitmanLocations"))||(d="100000000");a=makeElement("div",b,{style:"margin-left:0.5em;"});a.appendChild(document.createTextNode("Collect Bounties in:"));makeElement("br",a);title="Hitman cities selection";name="randomHitmanLocations[]";i=0;for(iLength=randomLocations.length;i<iLength;++i)e=!1,i<cities.length&&cities[i][CITY_CLOSED]&&(e=!0),c="1"==d[i]&&!e?makeElement("input",a,{type:"checkbox",name:name,title:locations[i],style:"margin-left: 0.5em;margin-right: 0.5em;",value:locations[i],checked:"checked"}):makeElement("input",a,{type:"checkbox",name:name,title:locations[i],style:"margin-left: 0.5em;margin-right: 0.5em;",value:locations[i]}),e&&(c.style.display="none"),label=makeElement("label",a,{"for":name,title:title}),label.appendChild(document.createTextNode(locations[i]));makeElement("br",a,{style:"margin-bottom:1em;"});a.appendChild(document.createTextNode("'Spend Stamina Random' will inherit the specific settings from each individual stamina spending option.<br/>"));a.appendChild(document.createTextNode("Please verify these specific settings before saving!"));makeElement("br",a,{style:"margin-bottom:1em;"})}function createStaminaTab(){var b,c,a,d,e,f=makeElement("div",null,{id:"staminaTab","class":"tabcontent"});makeElement("div",f,{style:"width:762px;height:20px;border:none #FFFFFF;float:left;font-size: 18px; font-weight: bold;"}).appendChild(document.createTextNode("Stamina Settings:"));var g=makeElement("div",f,{style:"position: relative; top: 5px; margin-left: auto; margin-right: auto; width: 95%; line-height:120%;"});d=makeElement("div",g);c=makeElement("div",d,{"class":"lhs"});rhs=makeElement("div",d,{"class":"rhs"});makeElement("br",d,{"class":"hide"});b="Spend stamina automatically.";a="staminaSpend";makeElement("input",c,{type:"checkbox",id:a,title:b,value:"checked"},"staminaSpend");a=makeElement("label",c,{"for":a,title:b});a.appendChild(document.createTextNode(" Spend stamina to:"));var h=makeElement("select",rhs,{id:"staminaSpendHow"});b=0;for(iLength=staminaSpendChoices.length;b<iLength;++b)e=document.createElement("option"),e.value=b,e.appendChild(document.createTextNode(staminaSpendChoices[b])),h.appendChild(e);b="Log Details";a="staminaLogDetails";makeElement("input",rhs,{type:"checkbox",id:a,title:b,style:"margin-left: 0.5em;",value:"checked"},"staminaLogDetails");a=makeElement("label",rhs,{"for":a,title:b});a.appendChild(document.createTextNode(" Log Details"));var k=makeElement("div",g,{id:"staminaTabSub",style:"position: static; border: 1px inset #FFD927; margin-left: auto; margin-right: auto; margin-top: 5px; margin-bottom: 5px;"});d=makeElement("div",g,{"class":"single"});b="Start spending stamina when stamina level is reached";a="selectStaminaUse";d.appendChild(document.createTextNode("Start spending stamina when "));makeElement("input",d,{type:"text",id:a,title:b,style:"width: 2em; ",value:GM_getValue(a,"0")});a="selectStaminaUseMode";d.appendChild(document.createTextNode(" "));c=makeElement("select",d,{id:a,title:b});b=0;for(iLength=numberSchemes.length;b<iLength;++b)e=document.createElement("option"),e.value=b,e.appendChild(document.createTextNode(numberSchemes[b])),c.appendChild(e);c.selectedIndex=GM_getValue(a,0);d.appendChild(document.createTextNode(" of stamina has accumulated."));d=makeElement("div",g,{"class":"single"});b="Suspend spending stamina for above choices while below this level.  NOTE: Operations & Stamina LOWER limits are completely INDEPENDENT Of Each Other.";a="selectStaminaKeep";d.appendChild(document.createTextNode("While Stamina Is Below "));makeElement("input",d,{type:"text",id:a,title:b,style:"width: 2em; ",value:GM_getValue(a,"0")});a="selectStaminaKeepMode";d.appendChild(document.createTextNode(" "));c=makeElement("select",d,{id:a,title:b});b=0;for(iLength=numberSchemes.length;b<iLength;++b)e=document.createElement("option"),e.value=b,e.appendChild(document.createTextNode(numberSchemes[b])),c.appendChild(e);c.selectedIndex=GM_getValue(a,0);d.appendChild(document.createTextNode(" Suspend Stamina Spending For Jobs & Fighting."));d=makeElement("div",g,{"class":"single"});b="Suspend automatic play and operations processing while below this level of stamina.  NOTE: Operations & Stamina LOWER limits are completely INDEPENDENT Of Each Other.";a="selectMissionStaminaKeep";d.appendChild(document.createTextNode("While Stamina Is Below "));makeElement("input",d,{type:"text",id:a,title:b,style:"width: 2em; ",value:GM_getValue(a,"0")});a="selectMissionStaminaKeepMode";d.appendChild(document.createTextNode(" "));c=makeElement("select",d,{id:a,title:b});b=0;for(iLength=numberSchemes.length;b<iLength;++b)e=document.createElement("option"),e.value=b,e.appendChild(document.createTextNode(numberSchemes[b])),c.appendChild(e);c.selectedIndex=GM_getValue(a,0);d.appendChild(document.createTextNode(" Suspend Stamina Spending For Operations."));d=makeElement("div",g,{"class":"single"});b="Ignore minimum stamina settings if a level up is within reach.";a="allowStaminaToLevelUp";makeElement("input",d,{type:"checkbox",id:a,title:b,value:"checked"},"allowStaminaToLevelUp");a=makeElement("label",d,{"for":a,title:b});a.appendChild(document.createTextNode(" Don't reserve stamina if within reach of the next level."));g=function(){k.innerHTML="";switch(h.selectedIndex){case STAMINA_HOW_FIGHT_RANDOM:createStaminaSubTab_FightRandom(k);break;case STAMINA_HOW_FIGHT_BG:createStaminaSubTab_FightRandom(k);break;case STAMINA_HOW_FIGHT_LIST:createStaminaSubTab_FightSpecific(k);break;case STAMINA_HOW_FIGHT_LIST_BG:createStaminaSubTab_FightSpecific(k);break;case STAMINA_HOW_HITMAN:createStaminaSubTab_CollectBounties(k);break;case STAMINA_HOW_ROBBING:createStaminaSubTab_Rob(k);break;case STAMINA_HOW_AUTOHITLIST:createStaminaSubTab_SetBounties(k);break;case STAMINA_HOW_RANDOM:createStaminaSubTab_Random(k);break;case STAMINA_HOW_FIGHTROB:createStaminaSubTab_FightRob(k);break;case STAMINA_HOW_ROBFIGHT:createStaminaSubTab_RobFight(k);break;default:createStaminaSubTab_Random(k)}};h.selectedIndex=GM_getValue("staminaSpendHow",0);g();h.addEventListener("change",g,!1);return f}function createStaminaTabNew2012(){var b,c,a,d,e,f,g=makeElement("div",null,{id:"staminaTab","class":"tabcontent"});makeElement("div",g,{"class":"jsRX6TabHeading"}).appendChild(document.createTextNode("Stamina Settings"));c=makeElement("div",g,{"class":"jsRX6Tabs"});d=makeElement("div",c);f=makeElement("div",d,{"class":"jqRX6buttonId1"});b="Spend stamina automatically.";a="staminaSpend";makeElement("input",f,{type:"checkbox",id:a,title:b,value:"checked"},"staminaSpend");a=makeElement("label",f,{"for":a,title:b,"class":"jqSpacer"});a.appendChild(document.createTextNode("Spend stamina to:"));var h=makeElement("select",f,{id:"staminaSpendHow"});b=0;for(iLength=staminaSpendChoices.length;b<iLength;++b)e=document.createElement("option"),e.value=b,e.appendChild(document.createTextNode(staminaSpendChoices[b])),h.appendChild(e);b="Log Details";a="staminaLogDetails";makeElement("input",f,{type:"checkbox",id:a,title:b,style:"margin-left: 0.5em;",value:"checked"},"staminaLogDetails");a=makeElement("label",f,{"for":a,title:b,"class":"jqSpacer"});a.appendChild(document.createTextNode("Log Details"));f=makeElement("div",d,{"class":"jqRX6buttonId1"});var k=makeElement("div",c,{id:"staminaTabSub","class":"jsRX6Tabs"});makeElement("br",d,{"class":"hide"});d=makeElement("div",f,{"class":"single"});b="Start spending stamina when stamina level is reached";a="selectStaminaUse";d.appendChild(document.createTextNode("Start spending stamina when "));makeElement("input",d,{type:"text",id:a,title:b,style:"width: 2em; ",value:GM_getValue(a,"0")});a="selectStaminaUseMode";d.appendChild(document.createTextNode(" "));c=makeElement("select",d,{id:a,title:b});b=0;for(iLength=numberSchemes.length;b<iLength;++b)e=document.createElement("option"),e.value=b,e.appendChild(document.createTextNode(numberSchemes[b])),c.appendChild(e);c.selectedIndex=GM_getValue(a,0);d.appendChild(document.createTextNode(" of stamina has accumulated."));d=makeElement("div",f,{"class":"single"});b="Suspend spending stamina for above choices while below this level.  NOTE: Operations & Stamina LOWER limits are completely INDEPENDENT Of Each Other.";a="selectStaminaKeep";d.appendChild(document.createTextNode("While Stamina Is Below "));makeElement("input",d,{type:"text",id:a,title:b,style:"width: 2em; ",value:GM_getValue(a,"0")});a="selectStaminaKeepMode";d.appendChild(document.createTextNode(" "));c=makeElement("select",d,{id:a,title:b});b=0;for(iLength=numberSchemes.length;b<iLength;++b)e=document.createElement("option"),e.value=b,e.appendChild(document.createTextNode(numberSchemes[b])),c.appendChild(e);c.selectedIndex=GM_getValue(a,0);d.appendChild(document.createTextNode(" Suspend Stamina Spending For Jobs & Fighting."));d=makeElement("div",f,{"class":"single"});b="Suspend automatic play and operations processing while below this level of stamina.  NOTE: Operations & Stamina LOWER limits are completely INDEPENDENT Of Each Other.";a="selectMissionStaminaKeep";d.appendChild(document.createTextNode("While Stamina Is Below "));makeElement("input",d,{type:"text",id:a,title:b,style:"width: 2em; ",value:GM_getValue(a,"0")});a="selectMissionStaminaKeepMode";d.appendChild(document.createTextNode(" "));c=makeElement("select",d,{id:a,title:b});b=0;for(iLength=numberSchemes.length;b<iLength;++b)e=document.createElement("option"),e.value=b,e.appendChild(document.createTextNode(numberSchemes[b])),c.appendChild(e);c.selectedIndex=GM_getValue(a,0);d.appendChild(document.createTextNode(" Suspend Stamina Spending For Operations."));d=makeElement("div",f,{"class":"single"});b="Ignore minimum stamina settings if a level up is within reach.";a="allowStaminaToLevelUp";makeElement("input",d,{type:"checkbox",id:a,title:b,value:"checked"},"allowStaminaToLevelUp");a=makeElement("label",d,{"for":a,title:b});a.appendChild(document.createTextNode(" Don't reserve stamina if within reach of the next level."));d=function(){k.innerHTML="";switch(h.selectedIndex){case STAMINA_HOW_FIGHT_RANDOM:createStaminaSubTab_FightRandom(k);break;case STAMINA_HOW_FIGHT_BG:createStaminaSubTab_FightRandom(k);break;case STAMINA_HOW_FIGHT_LIST:createStaminaSubTab_FightSpecific(k);break;case STAMINA_HOW_FIGHT_LIST_BG:createStaminaSubTab_FightSpecific(k);break;case STAMINA_HOW_HITMAN:createStaminaSubTab_CollectBounties(k);break;case STAMINA_HOW_ROBBING:createStaminaSubTab_Rob(k);break;case STAMINA_HOW_AUTOHITLIST:createStaminaSubTab_SetBounties(k);break;case STAMINA_HOW_RANDOM:createStaminaSubTab_Random(k);break;case STAMINA_HOW_FIGHTROB:createStaminaSubTab_FightRob(k);break;case STAMINA_HOW_ROBFIGHT:createStaminaSubTab_RobFight(k);break;default:createStaminaSubTab_Random(k)}};h.selectedIndex=GM_getValue("staminaSpendHow",0);d();h.addEventListener("change",d,!1);return g}function createHealTab(){var b,c,a,d,e=makeElement("div",null,{id:"healTab","class":"tabcontent"});makeElement("div",e,{style:"width:762px;height:20px;border:none #FFFFFF;float:left;font-size: 18px; font-weight: bold;"}).appendChild(document.createTextNode("Health Settings:"));var f=makeElement("div",e,{style:"position: relative; top: 10px; margin-left: 0px; margin-right: auto; width: 95%; line-height:120%;"});c=makeElement("div",f);d=makeElement("div",c,{"class":"lhs"});b=makeElement("div",c,{"class":"rhs"});makeElement("br",c,{"class":"hide"});c="Heal when health lands below indicated health.";a="autoHeal";makeElement("input",d,{type:"checkbox",id:a,value:"checked"},a,"checked");makeElement("img",d,{style:"padding-left: 5px;",src:stripURI(healthIcon)});makeElement("label",d,{"for":a,title:c}).appendChild(document.createTextNode(" Heal in:"));var g=makeElement("select",b,{id:"healLocation"});d=0;for(iLength=locations.length;d<iLength;++d)a=document.createElement("option"),a.value=d,d<cities.length&&cities[d][CITY_CLOSED]&&(a.style.display="none"),a.appendChild(document.createTextNode(locations[d])),g.appendChild(a);g.selectedIndex=GM_getValue("healLocation",NY);makeElement("label",b,{title:c}).appendChild(document.createTextNode(" when health falls below "));makeElement("input",b,{style:"text-align: center",type:"text",value:GM_getValue("healthLevel","50"),id:"healthLevel",size:"1"});makeElement("label",b,{title:c}).appendChild(document.createTextNode(" points"));c=makeElement("div",f);d=makeElement("div",c,{"class":"lhs"});b=makeElement("div",c,{"class":"rhs"});makeElement("br",c,{"class":"hide"});c="Heal in NY when backgroundfighting";a="autoHealBackup";makeElement("input",b,{type:"checkbox",id:a,value:"checked"},a,"checked");makeElement("label",b,{"for":a,title:c}).appendChild(document.createTextNode(" Heal in NY when backgroundfighting"));c=makeElement("div",f);d=makeElement("div",c,{"class":"lhs"});b=makeElement("div",c,{"class":"rhs"});makeElement("br",c,{"class":"hide"});a=makeElement("label",b,{title:"Set the minimum Stamina Points Needed for Auto-Heal."});a.appendChild(document.createTextNode("Disable Auto-Heal when Stamina falls below "));makeElement("input",b,{type:"text",value:GM_getValue("stamina_min_heal","22"),id:"stamina_min_heal",size:"3"});b.appendChild(document.createTextNode(" points."));makeElement("br",b,{"class":"hide"});makeElement("font",b,{style:"font-size: 10px;color:yellow;"}).appendChild(document.createTextNode("This setting determins switching from fighting to robbing when 'Fight then Rob' is chosen from the Stamina subTab."));c=makeElement("div",f);d=makeElement("div",c,{"class":"lhs"});b=makeElement("div",c,{"class":"rhs"});makeElement("br",c,{"class":"hide"});c="Check to attack even when at critical health (21-28 health points) ";a="attackCritical";makeElement("input",b,{type:"checkbox",id:a,title:c,value:"checked"},a);makeElement("img",b,{style:"padding-left: 5px;",src:stripURI(attackIcon)});makeElement("label",b,{"for":a,title:c}).appendChild(document.createTextNode(" Attack at critical health"));c=makeElement("div",f);d=makeElement("div",c,{"class":"lhs"});b=makeElement("div",c,{"class":"rhs"});makeElement("br",c,{"class":"hide"});a="hideInHospital";g=makeElement("input",b,{type:"checkbox",title:"Hide in hospital ",id:a,value:"checked"},a);makeElement("img",b,{style:"padding-left: 5px;",src:stripURI(hideIcon)});c=g.checked?" Hide in hospital but...":" Hide in hospital";makeElement("label",b,{id:"hideLabel","for":a,title:c}).appendChild(document.createTextNode(c));b=makeElement("div",b,{style:"line-height: 135%;",id:"hideOpts"});d=0;for(iLength=healOptions.length;d<iLength;d++){a=healOptions[d][0];c=healOptions[d][1];var h=healOptions[d][2],k=makeElement("div",b);makeElement("input",k,{type:"checkbox",id:a,title:h,value:"checked",style:"margin-left: 15px;"},a);a=makeElement("label",k,{"for":a,title:h});a.appendChild(document.createTextNode(" "+c))}b.style.display=g.checked?"":"none";g.addEventListener("click",function(){var a=document.getElementById("hideOpts"),b=document.getElementById("hideLabel");if(!a)return!1;this.checked?(a.style.display="",b.firstChild.nodeValue=" Hide in hospital but..."):(a.style.display="none",b.firstChild.nodeValue=" Hide in hospital");return!0},!1);c=makeElement("div",f);d=makeElement("div",c,{"class":"lhs"});b=makeElement("div",c,{"class":"rhs"});makeElement("br",c,{"class":"hide"});a="stopPA";c="do not use Powerattack when health is below treshold";makeElement("input",b,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",b,{"for":a,title:c}).appendChild(document.createTextNode(" Do not use Power Attack when health falls below  "));a="stopPAHealth";c="Enter min health level";makeElement("input",b,{type:"text",value:GM_getValue(a,"0"),title:c,id:a,style:"width: 25px"});c=makeElement("div",f);d=makeElement("div",c,{"class":"lhs"});b=makeElement("div",c,{"class":"rhs"});makeElement("br",c,{"class":"hide"});a="hideAttacks";c="Enable hitlist riding: RX6 MWAP disables autoHeal after you got XP from attacks; it enables it again after parsing a snuffed message.";makeElement("input",b,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",b,{"for":a,title:c}).appendChild(document.createTextNode(" Hitlist riding, turn off autoHeal after "));a="rideHitlistXP";c="Enter the XP you want to gain before RX6 MWAP turns off autoHeal. Enter '0' if you want RX6 MWAP to turn off autoHeal after it detected a 0 xp attack.";makeElement("input",b,{type:"text",value:GM_getValue(a,"0"),title:c,id:a,style:"width: 25px"});b.appendChild(document.createTextNode(" xp"));return e}function createHealTabNew2012(){var b,c,a,d,e=makeElement("div",null,{id:"healTab","class":"tabcontent"});makeElement("div",e,{"class":"jsRX6TabHeading"}).appendChild(document.createTextNode("Health Settings"));var f=makeElement("div",e,{"class":"jsRX6Tabs"});c=makeElement("div",f);jqRX6buttonId1=makeElement("div",c,{"class":"jqRX6buttonId1"});c="Heal when health lands below indicated health.";a="autoHeal";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a,"checked");makeElement("img",jqRX6buttonId1,{style:"padding-left: 5px;",src:stripURI(healthIcon)});makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Heal in:"));var g=makeElement("select",jqRX6buttonId1,{id:"healLocation","class":"jqDrop70"});d=0;for(iLength=locations.length;d<iLength;++d)b=document.createElement("option"),b.value=d,d<cities.length&&cities[d][CITY_CLOSED]&&(b.style.display="none"),b.appendChild(document.createTextNode(locations[d])),g.appendChild(b);g.selectedIndex=GM_getValue("healLocation",NY);makeElement("label",jqRX6buttonId1,{title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("when health falls below "));makeElement("input",jqRX6buttonId1,{"class":"jqDrop70",type:"text",value:GM_getValue("healthLevel","50"),id:"healthLevel",size:"1"});makeElement("label",jqRX6buttonId1,{title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("points"));c=makeElement("div",f);jqRX6buttonId1=makeElement("div",c,{"class":"jqRX6buttonId1"});c="Heal in NY when backgroundfighting";a="autoHealBackup";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a,"checked");makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Heal in NY when backgroundfighting"));c=makeElement("div",f);jqRX6buttonId1=makeElement("div",c,{"class":"jqRX6buttonId1"});a=makeElement("label",jqRX6buttonId1,{title:"Set the minimum Stamina Points Needed for Auto-Heal.","class":"jqSpacer"});a.appendChild(document.createTextNode("Disable Auto-Heal when Stamina falls below"));makeElement("input",jqRX6buttonId1,{"class":"jqDrop70",type:"text",value:GM_getValue("stamina_min_heal","22"),id:"stamina_min_heal",size:"3"});jqRX6buttonId1.appendChild(document.createTextNode(" points."));makeElement("br",jqRX6buttonId1,{"class":"hide"});makeElement("font",jqRX6buttonId1,{style:"font-size: 10px;color:yellow;padding-top:3px"}).appendChild(document.createTextNode("This setting determins switching from fighting to robbing when 'Fight then Rob' is chosen from the Stamina subTab."));c=makeElement("div",f);jqRX6buttonId1=makeElement("div",c,{"class":"jqRX6buttonId1"});c="Check to attack even when at critical health (21-28 health points) ";a="attackCritical";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,title:c,value:"checked"},a);makeElement("img",jqRX6buttonId1,{style:"padding-left: 5px;",src:stripURI(attackIcon)});makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Attack at critical health"));c=makeElement("div",f);jqRX6buttonId1=makeElement("div",c,{"class":"jqRX6buttonId1"});a="hideInHospital";g=makeElement("input",jqRX6buttonId1,{type:"checkbox",title:"Hide in hospital ",id:a,value:"checked"},a);makeElement("img",jqRX6buttonId1,{style:"padding-left: 5px;",src:stripURI(hideIcon)});c=g.checked?" Hide in hospital but...":" Hide in hospital";makeElement("label",jqRX6buttonId1,{id:"hideLabel","for":a,title:c}).appendChild(document.createTextNode(c));b=makeElement("div",jqRX6buttonId1,{style:"line-height: 135%;",id:"hideOpts"});d=0;for(iLength=healOptions.length;d<iLength;d++){a=healOptions[d][0];c=healOptions[d][1];var h=healOptions[d][2],k=makeElement("div",b);makeElement("input",k,{type:"checkbox",id:a,title:h,value:"checked",style:"margin-left: 15px;"},a);a=makeElement("label",k,{"for":a,title:h});a.appendChild(document.createTextNode(" "+c))}b.style.display=g.checked?"":"none";g.addEventListener("click",function(){var a=document.getElementById("hideOpts"),b=document.getElementById("hideLabel");if(!a)return!1;this.checked?(a.style.display="",b.firstChild.nodeValue=" Hide in hospital but..."):(a.style.display="none",b.firstChild.nodeValue=" Hide in hospital");return!0},!1);c=makeElement("div",f);jqRX6buttonId1=makeElement("div",c,{"class":"jqRX6buttonId1"});a="stopPA";c="Do not use Powerattack when health is below treshold";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Do not use Power Attack when health falls below"));a="stopPAHealth";c="Enter min health level";makeElement("input",jqRX6buttonId1,{type:"text",value:GM_getValue(a,"0"),title:c,id:a,"class":"jqDrop70"});c=makeElement("div",f);jqRX6buttonId1=makeElement("div",c,{"class":"jqRX6buttonId1"});a="hideAttacks";c="Enable hitlist riding: RX6 MWAP disables autoHeal after you got XP from attacks; it enables it again after parsing a snuffed message.";makeElement("input",jqRX6buttonId1,{type:"checkbox",id:a,value:"checked"},a);makeElement("label",jqRX6buttonId1,{"for":a,title:c,"class":"jqSpacer"}).appendChild(document.createTextNode("Hitlist riding, turn off autoHeal after"));a="rideHitlistXP";c="Enter the XP you want to gain before RX6 MWAP turns off autoHeal. Enter '0' if you want RX6 MWAP to turn off autoHeal after it detected a 0 xp attack.";makeElement("input",jqRX6buttonId1,{type:"text",value:GM_getValue(a,"0"),title:c,id:a,"class":"jqDrop70"});jqRX6buttonId1.appendChild(document.createTextNode(" xp"));return e}function createCashTab(){var b,c,a,d=makeElement("div",null,{id:"cashTab","class":"tabcontent",style:"height:460px;overflow-y:auto;overflow-x:hidden"});makeElement("div",d,{style:"width:762px;height:20px;border:none #FFFFFF;float:left;font-size: 18px; font-weight: bold;"}).appendChild(document.createTextNode("Cash / Properties Settings:"));var e=0;for(ctCount=0;ctCount<ctLength;ctCount++){e+=23;c=cityProperties[ctCount][ctTitle];a=cityProperties[ctCount][ctGMId];var f=makeElement("div",d,{style:"top: "+e+"px;"});makeElement("input",f,{type:"checkbox",id:a,value:"checked"},a);a=makeElement("label",f,{"for":a,title:c});a.appendChild(document.createTextNode(cityProperties[ctCount][ctText]));a=cityProperties[ctCount][ctGMId]+"Id";b=makeElement("select",f,{id:a,style:"position: static; margin-left: 5px;"});f=0;for(h=cityProperties[ctCount][ctArray].length;f<h;++f)c=makeElement("option",null,{value:f,title:cityProperties[ctCount][ctArray][f][2]}),c.appendChild(document.createTextNode(cityProperties[ctCount][ctArray][f][0])),b.appendChild(c);b.selectedIndex=GM_getValue(a,0);b.setAttribute("title",cityProperties[ctCount][ctArray][b.selectedIndex][2])}e+=33;ctCount=0;for(cpLength=cityParts.length;ctCount<cpLength;ctCount++)if(e+=23,c=cityParts[ctCount][ptTitle],a=cityParts[ctCount][ptGMId],f=makeElement("div",d,{style:"top: "+e+"px;"}),makeElement("input",f,{type:"checkbox",id:a,value:"checked"},a),a=makeElement("label",f,{"for":a,title:c}),a.appendChild(document.createTextNode(cityParts[ctCount][ptProp])),cityParts[ctCount][ptPropId]){a=cityParts[ctCount][ptGMId]+"Id";b=makeElement("select",f,{id:a,style:"position: static; margin-left: 5px;"});f=0;for(h=cityParts[ctCount][ptArray].length;f<h;++f)c=makeElement("option",null,{value:f,title:cityParts[ctCount][ptArray][f][0]}),c.appendChild(document.createTextNode(cityParts[ctCount][ptArray][f][0])),b.appendChild(c);b.selectedIndex=GM_getValue(a,0)}e+=23;c="Check this to Ask for Vegas Parts every 2 hours, since no MW timer available";a="askVegasParts";b=makeElement("div",d,{style:"top: "+e+"px;"});makeElement("input",b,{type:"checkbox",id:a,value:"checked"},a);a=makeElement("label",b,{"for":a,title:c});a.appendChild(document.createTextNode("Ask for Vegas Parts"));a="askVegasPartsId";for(var g=makeElement("select",b,{id:a,style:"position: static; margin-left: 5px;"}),f=0,h=cityVegasParts.length;f<h;++f)c=makeElement("option",null,{value:f,title:cityVegasParts[f][0]}),c.appendChild(document.createTextNode(cityVegasParts[f][0])),g.appendChild(c);g.selectedIndex=GM_getValue(a,0);b.appendChild(document.createTextNode(" to upgrade "));a="askVegasPropId";b=makeElement("select",b,{id:a,style:"position: static; margin-left: 5px;"});f=0;for(h=cityVegasProps.length;f<h;++f)c=makeElement("option",null,{value:cityVegasProps[f][1],title:cityVegasProps[f][0]}),c.appendChild(document.createTextNode(cityVegasProps[f][0])),b.appendChild(c);b.selectedIndex=GM_getValue(a,0);e+=23;c="Check this to Ask Friends to Play your Slots every 4 hours";a="askPlaySlots";f=makeElement("div",d,{style:"top: "+e+"px;"});makeElement("input",f,{type:"checkbox",id:a,value:"checked"},a);a=makeElement("label",f,{"for":a,title:c});a.appendChild(document.createTextNode("Ask to Play your Slots"));e+=23;c="Check this to Ask for Brazil Parts every 2 hours, since no MW timer available";a="askBrazilParts";b=makeElement("div",d,{style:"top: "+e+"px;"});makeElement("input",b,{type:"checkbox",id:a,value:"checked"},a);a=makeElement("label",b,{"for":a,title:c});a.appendChild(document.createTextNode("Ask for Brazil Parts"));a="askBrazilPartsId";g=makeElement("select",b,{id:a,style:"position: static; margin-left: 5px;"});f=0;for(h=cityBrazilParts.length;f<h;++f)c=makeElement("option",null,{value:f,title:cityBrazilParts[f][0]}),c.appendChild(document.createTextNode(cityBrazilParts[f][0])),g.appendChild(c);g.selectedIndex=GM_getValue(a,0);b.appendChild(document.createTextNode(" to upgrade "));a="askBrazilPropId";b=makeElement("select",b,{id:a,style:"position: static; margin-left: 5px;"});f=0;for(h=cityBrazilProps.length;f<h;++f)c=makeElement("option",null,{value:cityBrazilProps[f][1],title:cityBrazilProps[f][0]}),c.appendChild(document.createTextNode(cityBrazilProps[f][0])),b.appendChild(c);b.selectedIndex=GM_getValue(a,0);e+=23;c="Check this to Ask for Chicago Parts every 2 hours, since no MW timer available";a="askChicagoParts";b=makeElement("div",d,{style:"top: "+e+"px;"});makeElement("input",b,{type:"checkbox",id:a,value:"checked"},a);a=makeElement("label",b,{"for":a,title:c});a.appendChild(document.createTextNode("Ask for Chicago Parts"));a="askChicagoPartsId";g=makeElement("select",b,{id:a,style:"position: static; margin-left: 5px;"});f=0;for(h=cityChicagoParts.length;f<h;++f)c=makeElement("option",null,{value:f,title:cityChicagoParts[f][0]}),c.appendChild(document.createTextNode(cityChicagoParts[f][0])),g.appendChild(c);g.selectedIndex=GM_getValue(a,0);b.appendChild(document.createTextNode(" to upgrade "));a="askChicagoPropId";b=makeElement("select",b,{id:a,style:"position: static; margin-left: 5px;"});f=0;for(h=cityChicagoProps.length;f<h;++f)c=makeElement("option",null,{value:cityChicagoProps[f][1],title:cityChicagoProps[f][0]}),c.appendChild(document.createTextNode(cityChicagoProps[f][0])),b.appendChild(c);b.selectedIndex=GM_getValue(a,0);c="Check this to Ask for London Parts every 2 hours, since no MW timer available";a="askLondonParts";e=makeElement("div",d,{style:"top: "+(e+23)+"px;"});makeElement("input",e,{type:"checkbox",id:a,value:"checked"},a);a=makeElement("label",e,{"for":a,title:c});a.appendChild(document.createTextNode("Ask for London Parts"));a="askLondonPartsId";b=makeElement("select",e,{id:a,style:"position: static; margin-left: 5px;"});f=0;for(h=cityLondonParts.length;f<h;++f)c=makeElement("option",null,{value:f,title:cityLondonParts[f][0]}),c.appendChild(document.createTextNode(cityLondonParts[f][0])),b.appendChild(c);b.selectedIndex=GM_getValue(a,0);e.appendChild(document.createTextNode(" to upgrade "));a="askLondonPropId";e=makeElement("select",e,{id:a,style:"position: static; margin-left: 5px;"});f=0;for(h=cityLondonProps.length;f<h;++f)c=makeElement("option",null,{value:cityLondonProps[f][1],title:cityLondonProps[f][0]}),c.appendChild(document.createTextNode(cityLondonProps[f][0])),e.appendChild(c);e.selectedIndex=GM_getValue(a,0);e=23;c="Automatically collect from properties";a="collectTake"+cities[0][CITY_NAME];f=makeElement("div",d,{style:"top: "+e+"px; left: 425px;"});makeElement("input",f,{type:"checkbox",id:a,value:"checked"},a);a=makeElement("label",f,{"for":a,title:c});a.appendChild(document.createTextNode(" autoCollect Cash from Properties"));e+=23;c="Automatically collect in BRAZIL";a="collectTakeBrazil";f=makeElement("div",d,{style:"top: "+e+"px; left: 425px;"});makeElement("input",f,{type:"checkbox",id:a,value:"checked"},a);a=makeElement("label",f,{"for":a,title:c});a.appendChild(document.createTextNode(" autoCollect in BRAZIL"));e+=23;c="Automatically collect in CHICAGO";a="collectTakeChicago";f=makeElement("div",d,{style:"top: "+e+"px; left: 425px;"});makeElement("input",f,{type:"checkbox",id:a,value:"checked"},a);a=makeElement("label",f,{"for":a,title:c});a.appendChild(document.createTextNode(" autoCollect in CHICAGO"));e+=23;c="Automatically collect in LONDON";a="collectTakeLondon";f=makeElement("div",d,{style:"top: "+e+"px; left: 425px;"});makeElement("input",f,{type:"checkbox",id:a,value:"checked"},a);a=makeElement("label",f,{"for":a,title:c});a.appendChild(document.createTextNode(" autoCollect in London"));e+=23;c="Automatically collect Parts from properties";a="collectParts";f=makeElement("div",d,{style:"top: "+e+"px; left: 425px;"});makeElement("input",f,{type:"checkbox",id:a,value:"checked"},a);a=makeElement("label",f,{"for":a,title:c});a.appendChild(document.createTextNode(" autoCollect Parts from Properties"));1==parseXMLResponse()&&(e+=23,c="Automatically Upgrade/Collect Limited properties",a="autoLimitedParts",f=makeElement("div",d,{style:"top: "+e+"px; left: 425px;"}),makeElement("input",f,{type:"checkbox",id:a,value:"checked"},a),a=makeElement("label",f,{"for":a,title:c}),a.appendChild(document.createTextNode(" autoUpgrade Limited Property")),e+=23,c="Automatically Ask/Upgrade Family properties",a="autoFamilyProperty",f=makeElement("div",d,{style:"top: "+e+"px; left: 425px;"}),makeElement("input",f,{type:"checkbox",id:a,value:"checked"},a),a=makeElement("label",f,{"for":a,title:c}),a.appendChild(document.createTextNode(" auto Ask/Upgrade Family Property")));for(var e=e+69,f=0,h=cities.length;f<h;++f)if((1>f||3<f)&&5!=f)a=cities[f][CITY_AUTOBANK],c="Enable "+cities[f][CITY_NAME]+" banking",b=makeElement("div",d,{style:"top: "+e+"px; left: 425px; width: 280px; text-align: left;"}),makeElement("input",b,{type:"checkbox",id:a,value:"checked"},a),makeElement("label",b,{"for":a}).appendChild(document.createTextNode(c)),makeElement("img",b,{style:"position: absolute; right: 95px; margin-top: 3px;",src:stripURI(cities[f][CITY_CASH_ICON])}),a=cities[f][CITY_BANKCONFG],c="Minimum deposit amount in "+cities[f][CITY_NAME],makeElement("input",b,{type:"text",style:"position: absolute; right: 0px; width: 110px; text-align: right;",title:c,value:GM_getValue(a,"50000"),id:a,size:"5"}),e+=23,4==f&&(e+=23);e-=92;f=makeElement("div",d,{style:"top: "+e+"px; left: 475px;"});c="Las Vegas: disable automatic vault handling, or select the level of your vault and let RX6 MWAP handle it.";a="vaultHandling";makeElement("img",f,{src:stripURI(cashVegasIcon),style:"margin-right: 5px;"});b=makeElement("select",f,{id:a,title:c,style:"position: static; text-align: left;"});f=0;for(h=vaultLevels.length;f<h;++f)c=makeElement("option",null,{value:f}),c.appendChild(document.createTextNode(vaultLevels[f][0])),b.appendChild(c);b.selectedIndex=GM_getValue(a,0);e+=100;makeElement("div",d,{style:"top: "+e+"px;left: 425px; width: 150px; text-align: left;"}).appendChild(document.createTextNode("autoUpgrade New York Properties:"));e+=20;a=makeElement("div",d,{style:"top: "+e+"px;left: 580px; width: 150px; text-align: left;"});c=makeElement("ul",a,{style:"border: 1px solid rgb(204, 204, 204); width: 150px; height: 90px; list-style: none outside none; overflow: auto;"});f=0;for(h=autoUpgradeNYBuildings.length;f<h;f++)buildingListItem=makeElement("li",c,{style:"z-index:99999;"}),a="upgradeNYProperty"+autoUpgradeNYBuildings[f][1],buildingListSelectItem=makeElement("input",buildingListItem,{type:"checkbox",id:a,value:"unchecked"},a),makeElement("label",buildingListItem,{"for":a,title:autoUpgradeNYBuildings[f][0]}).appendChild(document.createTextNode(autoUpgradeNYBuildings[f][0]));a=makeElement("div",d,{style:"top: "+e+"px; left: 425px; width: 150px; text-align: left;"});a=makeElement("select",a,{id:"autoUpgradeNYChoice",title:"autoUpgrade NY Properties.",style:"position: static; text-align: left;"});f=0;for(h=autoUpgradeNYChoices.length;f<h;++f)c=document.createElement("option"),c.value=f,c.appendChild(document.createTextNode(autoUpgradeNYChoices[f][0])),a.appendChild(c);a.selectedIndex=GM_getValue("autoUpgradeNYChoice",0);c="Minimum NY Bank Balance";e+=25;makeElement("div",d,{style:"top: "+e+"px;left: 425px; width: 150px; text-align: left;"}).appendChild(document.createTextNode(c));a="userMinBalance";e=makeElement("div",d,{style:"top: "+(e+20)+"px; left: 425px; width: 150px; text-align: left;"});makeElement("input",e,{type:"text",style:"position: static; text-align: right;",title:c,value:GM_getValue(a,"100000000"),id:a,size:"15"});return d}function createAboutTab(){var b=makeElement("div",null,{id:"aboutTab","class":"tabcontent"});makeElement("div",b,{style:"width:762px;height:20px;border:none #FFFFFF;float:left;font-size: 18px; font-weight: bold;"}).appendChild(document.createTextNode("Version RX6 "+SCRIPT.version));var c=makeElement("div",b,{style:"top: 50px; width: 550px; left: 10px; font-size: 12px; font-weight: bold;"});c.appendChild(document.createTextNode("Contributors:"));makeElement("br",c);devList=makeElement("p",c,{style:"position: relative; left: 15px;"});devList.appendChild(document.createTextNode("RX6 MWAP Development Team"));item=makeElement("div",b,{style:"border:1px solid #999999; padding: 2px 2px 2px 2px; overflow: auto; width: 530px; height: 120px; top: 160px; left: 30px; font-size: 10px;"});item.innerHTML='<span class="good">Release changes:</span> <br><br>'+GM_getValue("newRevList")+'<br><span class="bad">Previous changes:</span> <br><br>'+GM_getValue("oldRevList");item.innerHTML="Please refer to mwap.me.uk for current update information.<br><br><br>RX6 MWAP Team";c=makeElement("div",b,{style:"top: 350px; left: 10px; font-size: 12px;"});makeElement("input",c,{type:"checkbox",id:"TestChanges",value:"checked"},"TestChanges");makeElement("label",c,{"for":"TestChanges",title:"Enable Script Modifications In Testing Phase"}).appendChild(document.createTextNode("BETA TESTING ONLY : VERBOSITY ALERT - USE AT OWN RISK !"));return b}function grabToolbarInfo(b){var c=function(){var a=function(a){window.open(a,"toolbar","resizable=yes,scrollbars=yes,status=yes")};window.setTimeout(function(){a("http://toolbar.zynga.com/game_iframe_proxy.php?playing=true")},1E3);window.setTimeout(function(){a("http://toolbar.zynga.com/game_iframe_proxy.php")},5E3)};gvar.isGreaseMonkey?GM_xmlhttpRequest({method:"GET",url:"http://toolbar.zynga.com/game_stats_proxy.php?src=mw",headers:{Accept:"application/atom+xml"},onload:function(a){if(200==a.status){var b=JSON.parse(a.responseText);DEBUG("Toolbar response: "+a.responseText);!b||b.error?window.confirm("Error retrieving Toolbar info, probably because its the first time you are trying to fire the miniPack in this browser/-profile.\n\nDo you want MWAP to create the necessary cookies for you? If not, you have to install the Zynga Toolbar.\nPS: For this to work, you need to allow popups in your browser, and wait for ca. 10 secs before closing the popup (after confirming this dialog).")&&c():(a=new Date,a.setMilliseconds(0),b=b.toolbar_energy_timestamp-a.getTime()/1E3+28800,setGMTime("miniPackTimer",b+" seconds"))}}}):b&&window.confirm("Can't retrieve Toolbar info with this browser.\n\nIn case the miniPack doesn't work here at all,\nyou could let MWAP create the necessary cookies for you.\nPS: For this to work, you need to allow popups in your browser, and wait for ca. 10 secs before closing the popup (after confirming this dialog).")&&c()}function grabUpdateInfo(){gvar.isGreaseMonkey&&(GM_setValue("newRevList",""),GM_setValue("oldRevList",""))}function validateStaminaTab(){var b=function(a){return!0===document.getElementById(a).checked?"checked":0},c={};c.staminaSpend=b("staminaSpend");c.staminaSpendHow=document.getElementById("staminaSpendHow").selectedIndex;c.staminaLogDetails=b("staminaLogDetails");var a=parseInt(document.getElementById("selectStaminaUse").value);isNaN(a)&&(a=0);c.selectStaminaUse=a;c.selectStaminaUseMode=document.getElementById("selectStaminaUseMode").selectedIndex;a=parseInt(document.getElementById("selectStaminaKeep").value);isNaN(a)&&(a=0);c.selectStaminaKeep=a;c.selectStaminaKeepMode=document.getElementById("selectStaminaKeepMode").selectedIndex;a=parseInt(document.getElementById("selectMissionStaminaKeep").value);isNaN(a)&&(a=0);c.selectMissionStaminaKeep=a;c.selectMissionStaminaKeepMode=document.getElementById("selectMissionStaminaKeepMode").selectedIndex;c.allowStaminaToLevelUp=b("allowStaminaToLevelUp");if(isNaN(c.selectStaminaUse)||isNaN(c.selectStaminaKeep)||isNaN(c.selectMissionStaminaKeep))return alert("Please enter numeric values for Stamina reserve and Stamina threshold."),!1;switch(c.staminaSpendHow){case STAMINA_HOW_ROBFIGHT:c.robFightStaminaFloor=parseInt(document.getElementById("robFightStaminaFloor").value);if(isNaN(c.robFightStaminaFloor))return alert("Please enter the threshold for switching from robbing to fighting."),!1;if(25>c.robFightStaminaFloor||c.robFightStaminaFloor>maxStamina)return alert("Please enter a stamina between 25 and "+maxStamina),!1;case STAMINA_HOW_FIGHTROB:c.robLocation=document.getElementById("robLocation").selectedIndex,c.fastRob=b("fastRob"),c.fastRobSpeed=document.getElementById("fastRobSpeed").selectedIndex,c.useRobSquads=b("useRobSquads"),c.useBurners=b("useBurners");case STAMINA_HOW_FIGHT_RANDOM:case STAMINA_HOW_FIGHT_BG:c.fightLocation=document.getElementById("fightRandomLoc").selectedIndex;c.reattackThreshold=parseInt(document.getElementById("reattackThreshold").value);c.iceCheck=b("iceCheck");c.staminaPowerattack=b("staminaPowerattack");1==parseXMLResponse()&&(c.fastBGFSpeed=document.getElementById("fastBGFSpeed").selectedIndex,c.fightFallback=b("fightFallback"));c.fightLevelMax=parseInt(document.getElementById("fightLevelMax").value);c.fightLevelMaxRelative=b("fightLevelMaxRelative");c.fightMafiaMax=parseInt(document.getElementById("fightMafiaMax").value);c.fightMafiaMaxRelative=b("fightMafiaMaxRelative");c.fightMafiaMin=parseInt(document.getElementById("fightMafiaMin").value);c.fightMafiaMinRelative=b("fightMafiaMinRelative");1==parseXMLResponse()?(c.fightHealthMax=parseInt(document.getElementById("fightHealthMax").value),c.fightHealthPctMax=parseInt(document.getElementById("fightHealthPctMax").value)):(c.fightHealthMax=0,c.fightHealthPctMax=0);c.fightMobMode=b("fightMobMode");c.fightIceStealers=b("fightIceStealers");c.fightNames=b("fightNames");c.fightAvoidNames=b("fightAvoidNames");c.fightOnlyNames=b("fightOnlyNames");c.fightClanName=document.getElementById("fightClanName").value;c.fightRemoveStronger=b("fightRemoveStronger");document.getElementById("fightRivalsMode")&&(c.fightRivalsMode=document.getElementById("fightRivalsMode").selectedIndex);c.fightMaxAttacks=1==parseXMLResponse()?parseInt(document.getElementById("fightMaxAttacks").value):0;document.getElementById("fightLabelCriteria")&&(c.fightLabelCriteria=document.getElementById("fightLabelCriteria").selectedIndex);if(1==parseXMLResponse()){if(isNaN(c.fightMaxAttacks))return alert("Please enter the threshold for maximum # attacks per opponent."),!1;if(0>c.fightMaxAttacks)return alert("Please enter a maximum # attacks per opponent threshold of zero or more."),!1}if(isNaN(c.reattackThreshold))return alert("Please enter the threshold for reattacking opponents."),!1;if(0>c.reattackThreshold)return alert("Please enter a reattack threshold of zero or more."),!1;if(isNaN(c.fightLevelMax))return alert("Please enter a maximum level for fighting."),!1;if(c.fightLevelMaxRelative&&0>c.fightLevelMax)return alert("Please enter a maximum relative level of zero or more."),!1;!c.fightLevelMaxRelative&&c.fightLevelMax<level&&(c.fightLevelMax=parseInt(0.9*level),addToLog("warning Icon","Maximum level for fighting is set to "+c.fightLevelMax+" (90% of your current level:"+level+"."));if(1==parseXMLResponse()){if(isNaN(c.fightHealthMax))return alert("Please enter a maximum oppononent health for fighting."),!1;if(0>c.fightHealthMax)return alert("Please enter a maximum oppononent health for fighting of zero or more."),!1;if(isNaN(c.fightHealthPctMax))return alert("Please enter a maximum oppononent health for fighting."),!1;if(0>c.fightHealthPctMax)return alert("Please enter a maximum oppononent health for fighting of zero or more."),!1}if(isNaN(c.fightMafiaMax))return alert("Please enter a maximum mafia size for fighting."),!1;if(!c.fightMafiaMaxRelative&&1>c.fightMafiaMax)return alert("Please enter a maximum mafia size of one or more for fighting."),!1;if(c.fightMafiaMaxRelative&&1>c.fightMafiaMax+mafia)return alert("Please enter a larger relative mafia size for fighting."),!1;if(isNaN(c.fightMafiaMin))return alert("Please enter a minimum mafia size for fighting."),!1;if(!c.fightMafiaMinRelative&&1>c.fightMafiaMin)return alert("Please enter a minimum mafia size of one or more for fighting."),!1;if(c.fightMafiaMinRelative&&1>mafia-c.fightMafiaMin)return alert("Please enter a smaller relative mafia size for fighting."),!1;if("checked"==c.fightNames&&(b=c.fightClanName.split("\n"),!b[0]))return alert("Enter at least one clan name/symbol in the list"),!1;break;case STAMINA_HOW_FIGHT_LIST:case STAMINA_HOW_FIGHT_LIST_BG:c.fightLocation=document.getElementById("fightListLoc").selectedIndex;c.reattackThresholdList=parseInt(document.getElementById("reattackThresholdList").value);c.iceCheck=b("iceCheck");c.staminaPowerattack=b("staminaPowerattack");c.pfightlist=document.getElementById("pfightlist").value;c.fightRemoveStronger=!0===document.getElementById("fightRemoveStronger").checked?"checked":0;1==parseXMLResponse()&&(c.fightFallback=!0===document.getElementById("fightFallback").checked?"checked":0);isNaN(c.reattackThresholdList)?alert("Please enter the threshold for reattacking opponents."):0>c.reattackThresholdList&&alert("Please enter a reattack threshold of zero or more.");b=c.pfightlist.split("\n");if(!b[0])return alert("Enter the Facebook ID of at least one opponent to fight."),!1;break;case STAMINA_HOW_HITMAN:c.hitmanLocation=document.getElementById("hitmanLocation").selectedIndex;c.hitmanBountyMin=document.getElementById("hitmanBountyMin").value;c.bountySelection=document.getElementById("bountySelection").selectedIndex;c.hitmanNames=b("hitmanNames");c.hitmanAvoidNames=b("hitmanAvoidNames");c.hitmanOnlyNames=b("hitmanOnlyNames");c.hitmanClanName=document.getElementById("hitmanClanName").value;c.fightRemoveStronger=b("fightRemoveStronger");1==parseXMLResponse()&&(c.fightFallback=b("fightFallback"));b=parseCash(c.hitmanBountyMin);if(isNaN(b)||0>b)return alert("Please enter a minimum bounty amount."),!1;if("checked"==c.hitmanNames&&(b=c.hitmanClanName.split("\n"),!b[0]))return alert("Enter at least one clan name/symbol in the list"),!1;break;case STAMINA_HOW_ROBBING:c.robLocation=document.getElementById("robLocation").selectedIndex;c.fastRob=b("fastRob");c.fastRobSpeed=document.getElementById("fastRobSpeed").selectedIndex;c.useRobSquads=b("useRobSquads");c.useBurners=b("useBurners");break;case STAMINA_HOW_AUTOHITLIST:c.autoHitListLoc=document.getElementById("autoHitListLoc").selectedIndex;c.autoHitListBounty=document.getElementById("autoHitListBounty").value;c.autoHitListRandom=b("autoHitListRandom");c.pautoHitOpponentList=document.getElementById("pautoHitOpponentList").value;c.bgAutoHitCheck=b("bgAutoHitCheck");b=parseCash(c.autoHitListBounty);if(isNaN(b)||1E4>b&&!c.autoHitListRandom)return alert("Please enter a minimum bounty amount of at least $10,000"),!1;b=c.pautoHitOpponentList.split("\n");if(!b[0])return alert("Enter the Facebook ID of at least one opponent to hitlist."),!1;break;case STAMINA_HOW_RANDOM:for(var a="",d=document.getElementsByName("randomSpendModes[]"),b=0;b<d.length;++b)a=d[b].checked?a+"1":a+"0";parseInt(a)||(a="1"+a.substr(1));c.randomSpendModes=a;a="";d=document.getElementsByName("randomFightLocations[]");for(b=0;b<d.length;++b)a=d[b].checked?a+"1":a+"0";parseInt(a)||(a="1"+a.substr(1));c.randomFightLocations=a;a="";d=document.getElementsByName("randomRobLocations[]");for(b=0;b<d.length;++b)a=d[b].checked?a+"1":a+"0";parseInt(a)||(a="1"+a.substr(1));c.randomRobLocations=a;a="";d=document.getElementsByName("randomHitmanLocations[]");for(b=0;b<d.length;++b)a=d[b].checked?a+"1":a+"0";parseInt(a)||(a="1"+a.substr(1));c.randomHitmanLocations=a;break;default:colorDEBUG("BUG DETECTED: Unrecognized stamina setting here: staminaSpendHow="+c.staminaSpendHow,cre)}return c}function clickAutoPause(){this.checked&&!1===document.getElementById("autoPauseBefore").checked&&!1===document.getElementById("autoPauseAfter").checked&&(document.getElementById("autoPauseBefore").checked=!0)}function clickUseFightNames(){this.checked&&!1===document.getElementById("fightAvoidNames").checked&&!1===document.getElementById("fightOnlyNames").checked&&(document.getElementById("fightAvoidNames").checked=!0)}function clickUseHitmanNames(){this.checked&&!1===document.getElementById("hitmanAvoidNames").checked&&!1===document.getElementById("hitmanOnlyNames").checked&&(document.getElementById("hitmanAvoidNames").checked=!0)}function handleUnexpectedPage(){DEBUG("Unexpected page.");var b=document.getElementById("try_again_button");if(b){var c=10,a=document.createElement("p"),d=function(){if(!c)return b.click();a.innerHTML="RX6 MWAP will automatically try again in "+c--+" seconds.";window.setTimeout(d,1E3);return!1};DEBUG('Service interruption: "Try Again" button seen.');b.parentNode.appendChild(document.createElement("br"));b.parentNode.appendChild(a);d()}else{var e=xpathFirst('//a[contains(., "Skip")]');e?(Autoplay.fx=function(){clickElement(e)},Autoplay.delay=getAutoPlayDelay()):(Autoplay.fx=function(){document.body?DEBUG("Can't read page. Possible white out?"):DEBUG("No body. Possible redirect, white out or slow load?");goHome()},Autoplay.delay=5E3);Autoplay.start()}}var fightCount=0,ajaxCount=0;function handleModificationTimer(b){function c(a){if(a&&0<a.length&&!onProfileNav())for(var b=0,c=a.length;b<c;++b)if(a[b].scrollWidth&&0<a[b].innerHTML.length){d=!0;break}}try{if(ajaxHandling)colorDEBUG("waiting for ajax repsonse",cli),10<ajaxCount++&&(ajaxHandling=!1,ajaxCount=0);else{var a=new_header?xpathFirst('//div[@class="header_top_row"]'):xpathFirst('//div[contains(@id,"mw_masthead")]');if(!a||!a.scrollWidth||!refreshGlobalStats())handleUnexpectedPage();else{refreshSettings();synchSettings();var d=!1,a=!1,e=innerPageElt;if(innerPageElt=document.getElementById("inner_page")){appLayoutElt=document.getElementById("mw_city_wrapper");statsrowElt=document.getElementById("stats_row");menubarElt=document.getElementById("menubar");popupfodderElt=document.getElementById("popup_fodder");questBarElt=document.getElementById("quest");contentRoweElt=document.getElementById("content_row");xpathFirst('./div[@id="inner_flag"]',innerPageElt)?e!=innerPageElt&&(d=!0):(setListenContent(!1),makeElement("div",innerPageElt,{id:"inner_flag",style:"display: none;"}),setListenContent(!0),d=!0);if(xpathFirst('.//div[@id="brazil_jobs"]',innerPageElt)&&(currentBrazilDistrict=getCurrentBrazilDistrict(),currentBrazilDistrict!=oldBrazilDistrict&&(oldBrazilDistrict=currentBrazilDistrict,d=!0),currentBrazilDistrict)){var f=xpathFirst('.//div[@id="brazil_district_'+currentBrazilDistrict+'"]//div[@class="jobs"]//div[@class="job" and contains (@style,"fff")]//div[@class="mastery_bar"]',innerPageElt);f||(f=xpathFirst('.//div[@id="brazil_district_'+currentBrazilDistrict+'"]//div[contains(@id,"job-id")]//div[@class="job" and contains (@style,"fff")]//div[@class="mastery_bar"]',innerPageElt));f||(f=xpathFirst('.//div[@id="brazil_district_'+currentBrazilDistrict+'"]//div[@class="jobs"]//div[@class="job" and contains (@style,"255")]//div[@class="mastery_bar"]',innerPageElt));f||(f=xpathFirst('.//div[@id="brazil_district_'+currentBrazilDistrict+'"]//div[contains(@id,"job-id")]//div[@class="job" and contains (@style,"255")]//div[@class="mastery_bar"]',innerPageElt));if(f){var e=!1,g=previousBrazilJobMastery;f.innerHTML.untag().match(/(\d+)%/i)&&(g=parseInt(RegExp.$1));previousBrazilJob!=f&&(previousBrazilJob=f,previousBrazilJobMastery=0,e=!0);g!=previousBrazilJobMastery&&(previousBrazilJobMastery=g,e=!0);e&&(xpathFirst('.//div[@id="job_flag"]',f)||(setListenContent(!1),makeElement("div",f,{id:"job_flag",style:"display: none;"}),setListenContent(!0)),d=!0)}}var h=xpathFirst('.//div[@id="new_user_jobs"]//div[@class="job_results"]',innerPageElt);h&&!xpathFirst('.//div[@id="job_flag"]',h)&&(setListenContent(!1),makeElement("div",h,{id:"job_flag",style:"display: none;"}),setListenContent(!0),d=!0);var k=xpathFirst('.//div[@id="job_paths"]//div[contains(@class, "path_on")]',innerPageElt);k&&!xpathFirst('.//div[@id="job_path_flag"]',k)&&(setListenContent(!1),makeElement("div",k,{id:"job_path_flag",style:"display: none;"}),setListenContent(!0),DEBUG("Detected new-style job path changes"),d=!0);var l=$x('.//div[@id="map_panels"]/div[@id="side_container"]//div[@class="job_results"]',innerPageElt);if(l&&0<l.length)for(var f=0,n=l.length;f<n;++f)l[f]&&!xpathFirst('./div[@id="job_flag"]',l[f])&&(setListenContent(!1),makeElement("div",l[f],{id:"job_flag",style:"display: none;"}),setListenContent(!0),d=!0);var o=xpathFirst('.//div[@class="task_results"]',innerPageElt);o&&o&&!xpathFirst('./div[@id="task_flag"]',o)&&(setListenContent(!1),makeElement("div",o,{id:"task_flag",style:"display: none;"}),setListenContent(!0),d=!0);var p=xpathFirst('.//a[@id="rob_refresh_cost"]',innerPageElt);p&&!xpathFirst('.//div[@id="rob_flag"]',p)&&(setListenContent(!1),makeElement("div",p,{id:"rob_flag",style:"display: none;"}),setListenContent(!0),d=!0,running&&(a=!0));var q=$x('.//div[contains(@id, "pop_b") and not(contains(@style, "none"))]',popupfodderElt);showPopups(q);q=$x('.//div[@class="fight_true_popup"]//div[contains(@id, "pop_b") and not(contains(@style, "none"))]',innerPageElt);showPopups(q);q=$x('.//div[contains(@id, "pop_b") and contains(@style, "block")]',popupfodderElt);c(q);q=$x('.//div[@class="fight_true_popup"]//div[contains(@id, "pop_b") and contains(@style, "block")]',innerPageElt);c(q);if(d){running||postSize();try{innerPageChanged(a)}catch(u){DEBUG("BUG DETECTED (pageChanged): "+u)}}else running&&b&&("cur_cash"==b.className||b.parentNode&&"cur_cash"==b.parentNode.className)&&doQuickBank()}}}}catch(A){colorDEBUG("ModTimeError: "+A,cre)}}function setModificationTimer(b){modificationTimer&&window.clearTimeout(modificationTimer);modificationTimer=window.setTimeout(function(){handleModificationTimer(b)},400)}function handleContentModified(b){ignoreElement(b.target)||setModificationTimer(b.target)}var crewList="";function handleRequests(){function b(){var b=$x('.//div[@class="mfs_selectable"]//li[@class="mfs_add" and not (contains(@style,"none"))]');if(b&&0<b.length)for(i=0;i<b.length;i++)eltID="addCrew"+i,document.getElementById(eltID)||(b[i].innerHTML+='   <a id="'+eltID+'" href="#">Add</a>',b[i].addEventListener("click",c,!1));destroyByID("showCrewList");eltID="addCrewList";document.getElementById(eltID)||(d.innerHTML+='<a id="'+eltID+'" href="#">Save Crew List</a>',document.getElementById(eltID).addEventListener("click",a,!1))}function c(){crewMemberId=this.id.replace(/\D/g,"");crewList=crewList?crewList+(crewMemberId+"|"):crewMemberId+"\n";d.innerHTML=crewList}function a(){GM_setValue("giftCrewList",crewList);alert("crewList "+crewList+" saved")}var d=xpathFirst('.//div[@class="freegift_title"]');d||(d=xpathFirst('.//div[contains(.,"crew requests"]'));try{if(GM_getValue("isRunning")){if(inRequests)return;var e=$x('.//div[@class="mfs_selectable"]//li[@class="mfs_add" and not(contains(@style,"none"))]'),f=xpathFirst('.//div[@id="mfs_tab_2" and contains(@class,"inactive")]');if(0==e.length||21>e.length&&f)d.innerHTML="going to open mfs_tab_2 for more mafia members",f=xpathFirst('.//div[@id="mfs_tab_2"]'),clickElement(f);d.innerHTML="we are on mfs_tab_2 - selecting mafia";var g=xpathFirst('.//a[@class="sexy_button_new medium orange" and contains(@onclick,"MW.Request.submitMFS") and contains(.,"SEND REQUESTS")]'),e=$x('.//div[@class="mfs_selectable"]//li[@class="mfs_add" and not(contains(@style,"none"))]');if(0<e.length&&g&&!inRequests){d.innerHTML+="<br>mafia members and request button found";var h=xpathFirst('.//a[@id="selectMaxButton" and not (contains(@class,"disabled"))]');if(h)d.innerHTML+="<br>randombutton found and clicked",clickElement(h);else{d.innerHTML+="<br>randombutton not found clicking single mafia";var k=50<e.length?50:e.length;for(i=0;i<k;i++)clickElement(e[i])}d.innerHTML+="<br>mafia selected clicking requestbutton";clickElement(g);inRequests=!0;setGMTime("requestTimer","00:30")}else d.innerHTML+="<br>no mafia selected - closing popup",setGMTime("requestTimer","00:05"),setGMTime("autoFreeGiftTimer","1 hour"),unsafeWindow.close_suggestor_iframe()}else eltID="showCrewList",document.getElementById(eltID)||(d.innerHTML+='<a id="'+eltID+'" href="#">Show Crew List</a>',document.getElementById(eltID).addEventListener("click",b,!1))}catch(l){d.innerHTML="Requests error: "+l}window.setTimeout(handleRequests,2500)}function handlePublishing(){fetchPubOptions();if(GM_getValue("isRunning"))try{var b=xpathFirst('//input[@type="submit" and @name="cancel"]'),c=xpathFirst('//input[@type="submit" and @name="publish"]'),a=xpathFirst('//input[@type="submit" and @name="ok"]'),d=xpathFirst('//input[@type="submit" and @name="ok_clicked"]'),e=xpathFirst('//a[@class="fb_dialog_close_icon"]');if(d)clickElement(d);else if(a)clickElement(a);else if(!c||!timeLeftGM("postTimer"))b?clickElement(b):e&&clickElement(e);if(b&&c)return isGMChecked("autoGlobalPublishing")?clickElement(c):clickElement(b),window.setTimeout(handlePublishing,2500),!0}catch(f){DEBUG("Publishing error: "+f)}DEBUG("Publish: Try again in 2.5 seconds.");window.setTimeout(handlePublishing,2500)}function setListenContent(b){var c=document.getElementById("inner_page");c&&(b?c.addEventListener("DOMSubtreeModified",handleContentModified,!1):c.removeEventListener("DOMSubtreeModified",handleContentModified,!1))}function setListenStats(b){var c=document.getElementById("game_stats");c&&(b?c.addEventListener("DOMNodeInserted",statsInserted,!1):c.removeEventListener("DOMNodeInserted",statsInserted,!1))}function statsInserted(b){if(!ignoreElement(b.target)){var c=b.target.parentNode;c&&(c==energyElt?(energy=parseInt(b.target.nodeValue),energyElt.style.textDecoration=energy==maxEnergy?"blink":"none"):c==staminaElt?(stamina=parseInt(b.target.nodeValue),staminaElt.style.textDecoration=stamina==maxStamina?"blink":"none"):c==healthElt&&(health=parseInt(b.target.nodeValue),health=0>health?0:health,healthElt.style.textDecoration=19<health&&29>health?"blink":"none"))}}function doQuickBank(){isGMChecked(cities[city][CITY_AUTOBANK])&&!suspendBank&&!quickBankFail&&cities[city][CITY_CASH]>=GM_getIntValue(cities[city][CITY_BANKCONFG])&&!isNaN(city)&&!isNaN(cities[city][CITY_CASH])&&quickBank(city,cities[city][CITY_CASH])}function innerPageChanged(b){autoReload(!1,"innerpagechanged");doParseMessages();customizeBanner();mwapRX6Popup();getPlayerEquip();if(running&&(doQuickBank(),doQuickClicks(),questBarElt&&(inClanBattle=xpathFirst('.//div[contains(@class, "userInClanBattleShow") and not (contains(@style,"none"))]')?!0:!1)&&!inSafehouse&&isGMChecked("AutoBattleSafehouse")))inSafehouse=!0,battleLoad();if(!running||!b)postSize(),setListenContent(!1),customizeMasthead(),customizeStats(),!customizeHome()&&!customizeJobs()&&!customizeProfile()&&customizeFightLists(),setListenContent(!0);try{if(clickAction){var b=clickAction,c=clickContext;clickContext=clickAction=void 0;logResponse(innerPageElt,b,c)||doAutoPlay()}else doAutoPlay()}catch(a){addToLog("warning Icon","BUG DETECTED (doAutoPlay): "+a+". Reloading."),autoReload(!0,"error")}}function closeFBPopup(){if(running){var b=document.getElementById("fb_dialog_cancel_button");b&&clickElement(b)}}function refreshGlobalStats(){var b=document.getElementById("mw_city_wrapper");if(!b)return!1;city=b.className.match(/mw_city(\d+)/)?parseInt(b.className.replace("mw_city",""))-1:NY;b=document.getElementById("fb_dialog_cancel_button");running&&b&&window.setTimeout(closeFBPopup,4E3);cashElt=document.getElementById("user_cash_"+cities[city][CITY_ALIAS]);healthElt=document.getElementById("user_health");maxHealthElt=document.getElementById("user_max_health");energyElt=document.getElementById("user_energy");maxEnergyElt=document.getElementById("user_max_energy");staminaElt=document.getElementById("user_stamina");maxStaminaElt=document.getElementById("user_max_stamina");levelElt=document.getElementById("user_level");level=parseInt(levelElt.innerHTML);cities[city][CITY_CASH]=parseInt(unsafeWindow.User.cash);health=parseInt(unsafeWindow.User.health);health=0>health?0:health;maxHealth=parseInt(unsafeWindow.User.max_health);energy=parseInt(unsafeWindow.User.energy);maxEnergy=parseInt(unsafeWindow.User.max_energy);stamina=parseInt(unsafeWindow.User.stamina);maxStamina=parseInt(unsafeWindow.User.max_stamina);level=parseInt(levelElt.innerHTML);ptsToNextLevel=parseInt(unsafeWindow.User.exp_to_next_level);boardLastStamina||(boardLastStamina=stamina);boardLastPtsToNextLevel||(boardLastPtsToNextLevel=ptsToNextLevel);mafia=GM_getValue("userMafiaSize",0);if(!mafia||501>mafia)b=parseInt(unsafeWindow.User.mafia_size),mafia!=b&&(DEBUG("setting Mafia Size to: "+b),GM_setValue("userMafiaSize",b));(b=document.getElementById("user_skill"))?(stats=parseInt(b.innerHTML),isNaN(stats)&&(stats=0)):stats=0;isGMUndefined("currentLevel")&&(GM_setValue("currentLevel",level),GM_setValue("restAutoStat",0));level>GM_getValue("currentLevel")&&(GM_setValue("currentLevel",level),addToLog("experience Icon",'<span style="color:#00FFCC;"> Congratulations on reaching level <strong>'+level+"</strong>!</span>"),GM_setValue("restAutoStat",0),GM_setValue("availableJobs","({0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{}})"));customizeStatsRow();return!0}function refreshSettings(){var b=ptsToNextLevel<stamina*getStaminaGainRate()+energy*getEnergyGainRate()+autoFamilyProgress(1);SpendStamina.refreshLimits(maxStamina,b);SpendEnergy.refreshLimits(maxEnergy,b);SpendMissionStamina.refreshLimits(maxStamina,b);SpendMissionEnergy.refreshLimits(maxEnergy,b);running&&(isGMChecked(SpendStamina.spendFlag)&&SpendStamina.toggleSpending(maxStamina,stamina),isGMChecked(SpendEnergy.spendFlag)&&SpendEnergy.toggleSpending(maxEnergy,energy),isGMChecked("autoStartFamOps")&&SpendMissionStamina.toggleSpending(maxStamina,stamina),isGMChecked("autoStartFamOps")&&SpendMissionEnergy.toggleSpending(maxEnergy,energy));!0===GM_getValue("autoPauseActivated")&&isGMChecked("autoPauseBefore")&&GM_getValue("autoPauselvlExp")<ptsToNextLevel&&(GM_setValue("autoPauselvlExp",ptsToNextLevel),GM_setValue("autoPauseActivated",!1));running&&isGMChecked("autoPause")&&(isGMChecked("autoPauseBefore")&&GM_getValue("autoPauseExp","")>=ptsToNextLevel&&!1===GM_getValue("autoPauseActivated",!1)?(addToLog("pause Icon","Auto-pause in effect. Experience threshold reached."),GM_setValue("autoPauseActivated",!0),pause()):isGMChecked("autoPauseAfter")&&GM_getValue("autoPauselvlExp","")<ptsToNextLevel&&(addToLog("pause Icon","Auto-pause in effect. Leveled up."),GM_setValue("autoPauselvlExp",ptsToNextLevel),pause()))}function getStaminaGainRate(){var b=GM_getIntValue("totalExpInt",0),c=GM_getIntValue("fightWinCountInt",0)+GM_getIntValue("fightLossCountInt",0)+GM_getIntValue("hitmanWinCountInt",0)+GM_getIntValue("hitmanLossCountInt",0)+GM_getIntValue("totalRobStamInt",0);return!b||!c?2:b/c}function getEnergyGainRate(){var b=GM_getFloatValue("estimateJobRatio","2");return!isNaN(b)?b:2}function setFBParams(){var b=document.getElementById("navAccountName");b&&GM_setValue("FBName",b.innerHTML);GM_setValue("language",document.documentElement.lang);sendMWValues(["language","FBName"])}function copyMWValues(b){if(!gvar.isGreaseMonkey){var c={},a;for(a in b)c[b[a]]="";c.action="getGM";chrome.extension.sendRequest(c,function(a){for(var b in a)GM_setValue(b,a[b])})}}function sendMWValues(b){if(!gvar.isGreaseMonkey){var c={},a;for(a in b)c[b[a]]=GM_getValue(b[a]);c.action="setGM";chrome.extension.sendRequest(c)}}function MWAP_RX6_PopupOpen(b,c,a,d){a='<div id="MWAP_RX6_Popup_BG" class="pop_box" style="display: block; top:0px;left: 0px; width:100%;height:100%;z-index:99994;"><div id="MWAP_RX6_Popup" class="pop_box" style="display: block; top:25px;left: 200px; width:350px;height:'+a+'px;z-index:99995;"><a id="MWAP_RX6_Popup_CloseLink" href="#" class="pop_close"></a><div style="z-index:99996" class="mini_EP_info_pop"><div class="mini_EP_body"><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/empire/container_social.png" style="position:absolute;top:-83px;left:-152px;" height="60" width="350">';d&&(a+='<center><img style="position:relative;left:-172px;top:-83px" src="http://mwap.me.uk/images/mwap-images/rx6-signuptoday-mwap.jpg"></center><br>');document.getElementById("popup_fodder").innerHTML=a+('<div style="position:relative;top:-73px;left:-158px;width:340px;height:25px" class="empire_module_title"><span style="position:relative;top:-5px;left:-10px;">'+b+'</span></div><div style="position:relative;left:-160px;top:-68px">'+c+"</div></div></div></div></div>")}function MWAP_RX6_PopupActivate(b){document.getElementById("MWAP_RX6_Popup_CloseButton").addEventListener("click",MWAP_RX6_PopupClose,!1);document.getElementById("MWAP_RX6_Popup_CloseLink").addEventListener("click",MWAP_RX6_PopupClose,!1);b&&(document.getElementById("MWAP_RX6_Popup_CloseLink").setAttribute("rel","mwap"),b=GM_getValue("mwapRX6PopupCounter",0)-1,GM_setValue("mwapRX6PopupCounter",b),0>=b&&(addToLog("process Icon","RX6 MWAP auto-paused. Upgrade to RX6 MWAP PRO Now to play 24/7!"),pause()))}function MWAP_RX6_PopupClose(){document.getElementById("MWAP_RX6_Popup_CloseLink").hasAttribute("rel")&&0>=GM_getValue("mwapRX6PopupCounter",0)&&(GM_setValue("mwapRX6PopupCounter",5),unpause());$("#MWAP_RX6_Popup").hide();$("#MWAP_RX6_Popup_BG").hide();$("#content_row").height("auto");$("#MWAP_RX6_Popup").remove();$("#MWAP_RX6_Popup_BG").remove();setGMTime("mwapRX6PopupTimer","5 hours")}function mwapRX6Popup(){1!=parseXMLResponse()&&!timeLeftGM("mwapRX6PopupTimer")&&!document.getElementById("MWAP_RX6_Popup")&&(MWAP_RX6_PopupOpen("!!! UPGRADE TO RX6 MWAP PRO !!!",'Stick to the target like glue until ICED or KILLED!<br>Get the Crazy Speed option that only RX6 MWAP Pro provides! BGF (Back Ground Fighting) does jobs and collects whilst ICING!<br><br>Only possible with RX6 MWAP Pro!<br><br>Sign Up today to get all RX6 MWAP Pro features<br><a href="http://mwap.me.uk/sign-up-today/pro-compare.html" target="_blank">mwap.me.uk</a><br><a id="MWAP_RX6_Popup_CloseButton" href="javascript:void(0)" style="position:relative;top:10px" class="sexy_button_new black"><span><span>Close Popup</span</span></a>',"430",!0),MWAP_RX6_PopupActivate(!0))}function customizeBanner(){var b=document.location.protocol;if(1!=parseXMLResponse()){var c=document.getElementById("quest"),a=null;c&&(a=document.getElementById("ps_mwap_promo_banner_top")?document.getElementById("ps_mwap_promo_banner_top"):makeElement("div",c,{id:"ps_mwap_promo_banner_top"}),document.getElementById("mwapiFrame")||makeElement("iframe",a,{id:"mwapiFrame",src:b+"//playerscripts.co.uk/ps-adbanner/ps-adbanner.html",scrolling:"no",frameborder:"0",style:"margin:0px;padding:0px; border:none; overflow:hidden; width:750px; height:95px;",allowTransparency:"false"}));if(c=document.getElementById("mw_city_wrapper"))a=document.getElementById("ps_mwap_promo_banner_bottom")?document.getElementById("ps_mwap_promo_banner_bottom"):makeElement("div",c,{id:"ps_mwap_promo_banner_bottom"}),document.getElementById("mwap2iFrame")||makeElement("iframe",a,{id:"mwap2iFrame",src:b+"//playerscripts.co.uk/ps-adbanner/ps-adbanner_bottom.html",scrolling:"no",frameborder:"0",style:"margin:0px;padding:0px; border:none; overflow:hidden; width:750px; height:120px;",allowTransparency:"false"});getBrowserWindowSize();if(1024<winW||isGMChecked("leftAlign"))if(c=document.getElementById("final_wrapper"))a=document.getElementById("ps_mwap_promo_banner_sky")?document.getElementById("ps_mwap_promo_banner_sky"):makeElement("div",c,{id:"ps_mwap_promo_banner_sky"}),document.getElementById("mwap3iFrame")||makeElement("iframe",a,{id:"mwap3iFrame",src:b+"//playerscripts.co.uk/ps-adbanner/ps-adbanner_sky.html",scrolling:"no",frameborder:"0",style:"position:fixed;margin:0px;padding:0px; border:none; overflow:hidden; width:165px; height:650px;z-index:1",allowTransparency:"false"})}else destroyByID("mwapiFrame"),destroyByID("ps_mwap_promo_banner_top"),destroyByID("mwapi2Frame"),destroyByID("ps_mwap_promo_banner_bottom"),destroyByID("mwapi3Frame"),destroyByID("ps_mwap_promo_banner_sky")}function refreshMWAPCSS(){try{var b=function(){if(document.getElementById("mwapStatCSS")){var a=document.getElementById("mwapDynCSS"),c="";a&&(c=a.innerHTML);a=' iframe[name="mafiawars_zbar"] {display: none;} div[class="footer_text"] {display: none;} div[id="zbar"] {display: none;} div[id="cpa_fights_banner"] {display: none;} div[id="cpa_jobs_banner"] {display: none;} div[style="background-color: #fff; height: 85px; padding: 0; margin: 0;"] {display: none;} #mafia_two_banner {display: none;}'+(isGMChecked("mastheadOnTop")?" #mw_masthead {position: fixed; z-index: 100; width: 755px;} #mw_masthead_zombie {position: fixed; z-index: 100; width: 755px;} #mw_masthead_human {position: fixed; z-index: 100; width: 755px;} #stats_row   {position: fixed; top: 55px; width: 762px; z-index: 12;} #menubar     {position: fixed; top: 135px; width: 762px; background-color: rgb(0, 0, 0); z-index: 12;} #quest       {position: relative; top: 250px; z-index: 11;} #content_row {position: relative; top: 250px;}":"")+(isGMChecked("leftAlign")?" #ajax-container {margin: 0; position: static; text-align: left; width: 760px;}":" #ajax-container {margin: 0 auto; position: static; text-align: left; width: 760px;}")+'#zmc-envelope {display: none;} div[class$="zmc-envelope"] {display: none;} div[style$="float: left; width: 65px;"] {display: none;} a[class$="invite-friends"] {display: none;} span[style$="display: block; height: 16px;"] {margin-left:-65px;} div[style$="background-color: rgb(255, 255, 255); height: 85px; padding: 0pt; margin: 0pt;"] {display: none;}'+(isGMChecked("leftAlign")?" #final_wrapper {margin: 0; position: static; text-align: left; width: 760px;}":" #final_wrapper {margin: 0 auto; position: static; text-align: left; width: 760px;}")+(isGMChecked("leftAlign")?" #mwap3iFrame {top:10px;left:810px;z-index:100}":" #mwap3iFrame {top:10px;left:10px;z-index:100}")+(isGMChecked("hideAll")?' a[style$="position: absolute; top: 7px; right: 134px; height: 23px; width: 43px; z-index: 2;"] {display: none;} a[style$="position: absolute; top: 7px; right: 134px; height: 23px; padding: 20px 0pt 0pt; width: 43px; z-index: 2;"] {display: none;} a[style$="position: absolute; top: 7px; right: 134px; height: 23px; padding: 20px 0 0; width: 43px; z-index: 2;"] {display: none;}':' a[style$="position: absolute; top: 7px; right: 134px; height: 23px; width: 43px; z-index: 2;"] { !important; left: 760px !important; z-index: 2 !important;} a[style$="position: absolute; top: 7px; right: 134px; height: 23px; padding: 20px 0pt 0pt; width: 43px; z-index: 2;"] { !important; left: 760px !important; z-index: 2 !important;} a[style$="position: absolute; top: 7px; right: 134px; height: 23px; padding: 20px 0 0; width: 43px; z-index: 2;"] { !important; left: 760px !important; z-index: 2 !important;}')+(isGMChecked("hideAll")?" #zstream_icon {display: none;}":" #zstream_icon {position: absolute; top: 65px; left:755px; z-index: 100;} ")+(isGMChecked("hideAll")?" #slots_icon_container  {display: none;} #slots_icon_cover      {display: none;}":" #slots_icon_container  {position: absolute; top: 85px; left: 755px; z-index: 99;}  #slots_icon_cover      {position: absolute; top:85px; left: 755px; z-index: 100;} ")+(isGMChecked("hideAll")?" #gifticon_container {display: none;}":" #gifticon_container {position: absolute; top: 135px; left: 755px; z-index: 100;} ")+(isGMChecked("hideAll")?" #buyframe_link_container_anim  {display: none;} #buyframe_link_cover_anim      {display: none;}":" #buyframe_link_container_anim  {position: absolute; top: 180px; left: 755px; z-index: 100;}  #buyframe_link_cover_anim      {position: absolute; top: 180px; left: 755px; z-index: 100;} ")+(isGMChecked("hideAll")?" #promoicon_container {display: none;}":" #promoicon_container {position: absolute; top: 220px; left: 755px; z-index: 100;} ")+(isGMChecked("hideAll")?" #buyframe_link_container  {display: none;} #buyframe_link_cover      {display: none;}":" #buyframe_link_container  {position: absolute; top: 265px; left: 755px; z-index: 100;}  #buyframe_link_cover      {position: absolute; top: 265px; left: 755px; z-index: 100;} ")+(isGMChecked("hideAll")?' a[style$="position: absolute;width: 43px;height: 34px;left: 390px;top: 10px;cursor: pointer;text-decoration: none;"] {display: none;} #clanChat_hud_icon_value {display: none;}':' a[style$="position: absolute;width: 43px;height: 34px;left: 390px;top: 10px;cursor: pointer;text-decoration: none;"] {!important; position: absolute; top: 285px !important; left: 755px !important; z-index: 100 !important;}  #clanChat_hud_icon_value {!important, position: absolute; top: 285px !important; left: 755px !important; z-index: 100 !important;} ')+(isGMChecked("hideAll")?' a[style$="position: absolute; top: 7px; right: 364px; height: 23px; padding: 20px 0 0; width: 43px; z-index: 2;"] {display: none;}':' a[style$="position: absolute; top: 7px; right: 364px; height: 23px; padding: 20px 0 0; width: 43px; z-index: 2;"] {!important; position: absolute; top: 325px !important; left: 755px !important; z-index: 100 !important;} ')+(isGMChecked("hideAll")?" .header_mid_row div.header_various {display: none;}":" .header_mid_row div.header_various {position: absolute; top: 1px; left: 825px; width: 12px; z-index: 100;} ")+(isGMChecked("hideZyngaBanner")?' div[id="header_top_promo_banner"] {display: none !important;}':"")+(isGMChecked("hideClanChat")?' div[id="clanChat"] {display: none !important;}':"")+(isGMChecked("hideAll")?' div[class="tab_box_content"][style*="padding: 5px; text-align: center; margin-bottom: 420px;"], ':"")+(isGMChecked("hideAll")?" .message_box_full, ":"")+(isGMChecked("hideAll")?" .menu_divider, ":"")+(isGMChecked("hideAll")?' div[class="tab_box"][style*="left"], ':"")+(isGMChecked("hideAll")?' img[alt="Free Holiday Gifts!"],  img[alt="Gift Safe House"],  img[alt="Free Mystery Bag!"], ':"")+" div.lootImg {float:left;width:45px;} div.lootImg img {width:40px;height:40px;}";a=1!=parseXMLResponse()?a+" #fv2_widget_wrapper {margin-top:350px !important;}":a+" #fv2_widget_wrapper {margin-top:150px !important;}";$("#spockholm_toolbar").length&&(a+=" #mainDiv {top:35px;}");a!=c&&remakeElement("style",document.getElementsByTagName("head")[0],{id:"mwapDynCSS",type:"text/css"}).appendChild(document.createTextNode(a))}else c=makeElement("link",document.getElementsByTagName("head")[0],{id:"mwapStatCSS",type:"text/css",rel:"stylesheet"}),c.id="mwapStatCSS",c.setAttribute("href","http://cdn.playerscripts.co.uk/psmwap/mwapCSS.css"),window.setTimeout(b,350)};b()}catch(c){addToLog("warning Icon","BUG DETECTED (refreshMWAPCSS): "+c)}}function showTimers(){var b="<br>  miniPackTimer: "+getHoursTime("miniPackTimer")+"<br>  askEventPartsTimer: "+getHoursTime("askEventPartsTimer")+"<br>  askHomePartsTimer: "+getHoursTime("askHomePartsTimer")+"<br>  askRobSquadsTimer: "+getHoursTime("askRobSquadsTimer")+"<br>  checkPropertyTimer: "+getHoursTime("checkPropertyTimer")+"<br>  askVegasPartsTimer: "+getHoursTime("askVegasPartsTimer")+"<br>  askPlaySlotsTimer: "+getHoursTime("askPlaySlotsTimer")+"<br>  askBrazilPartsTimer: "+getHoursTime("askBrazilPartsTimer")+"<br>  askChicagoPartsTimer: "+getHoursTime("askChicagoPartsTimer")+"<br>  askLondonPartsTimer: "+getHoursTime("askLondonPartsTimer")+"<br>  resetHomePropTimer: "+getHoursTime("resetHomePropTimer");ctCount=0;for(cpLength=cityParts.length;ctCount<cpLength;ctCount++)b+="<br>  "+cityParts[ctCount][ptTimer]+": "+getHoursTime(cityParts[ctCount][ptTimer]);for(ctCount=0;ctCount<ctLength;ctCount++)b+="<br>  "+cityProperties[ctCount][ctPropTimer]+": "+getHoursTime(cityProperties[ctCount][ctPropTimer]);b+="<br>  autoUpgradeNYTimer: "+getHoursTime("autoUpgradeNYTimer")+"<br>  takeHourNew York: "+getHoursTime("takeHourNew York")+"<br>  takeHourLas Vegas: "+getHoursTime("takeHourLas Vegas")+"<br>  takeHourBrazil: "+getHoursTime("takeHourBrazil")+"<br>  takeHourChicago: "+getHoursTime("takeHourChicago")+"<br>  takeHourLondon: "+getHoursTime("takeHourLondon")+"<br>  partsHour: "+getHoursTime("partsHour")+"<br>  Check myMissions Timer: "+getHoursTime("myOpsTimer")+"<br>  Check FamilyMissionsTimer: "+getHoursTime("famOpsTimer")+"<br>  autoAskCityCrewTimer: "+getHoursTime("autoAskCityCrewTimer")+"<br>  activateBrazilCrewTimer: "+getHoursTime("activateBrazilCrewTimer")+"<br>  activateChicagoCrewTimer: "+getHoursTime("activateChicagoCrewTimer")+"<br>  activateLondonCrewTimer: "+getHoursTime("activateLondonCrewTimer")+"<br>  AskforHelpBrazilTimer: "+getHoursTime("AskforHelpBrazilTimer")+"<br>  AskforHelpChicagoTimer: "+getHoursTime("AskforHelpChicagoTimer")+"<br>  AskforHelpLondonTimer: "+getHoursTime("AskforHelpLondonTimer")+"<br>  AskforHelpVegasTimer: "+getHoursTime("AskforHelpVegasTimer")+"<br>  wishListTimer: "+getHoursTime("wishListTimer")+"<br>  warTimer: "+getHoursTime("warTimer")+"<br>  askEnergyPackTimer: "+getHoursTime("askEnergyPackTimer")+"<br>  askStaminaPackTimer: "+getHoursTime("askStaminaPackTimer")+"<br>  autoAcceptMsgTimer: "+getHoursTime("autoAcceptMsgTimer")+"<br>  askFightBoostsTimer: "+getHoursTime("askFightBoostsTimer");addToLog("info Icon",'<span style="color:#04B4AE;">Time left on RX6 MWAP Timers:'+b+"</span>")}function resetTimers(b){var c=function(a,c){(b||timeLeftGM(a)<c)&&setGMTime(a,0)};c("miniPackTimer",300);c("wishListTimer",300);c("warTimer",900);c("buildCarTimer",900);c("askVegasPartsTimer",900);c("askPlaySlotsTimer",900);c("askBrazilPartsTimer",900);c("askChicagoPartsTimer",900);c("askLondonPartsTimer",900);c("resetHomePropTimer",900);for(ctCount=0;ctCount<ctLength;ctCount++)c(cityProperties[ctCount][ctPropTimer],900);ctCount=0;for(cpLength=cityParts.length;ctCount<cpLength;ctCount++)c(cityParts[ctCount][ptTimer],900);c("partsHour",900);c("autoUpgradeNYTimer",3600);c("takeHourNew York",300);c("takeHourLas Vegas",300);c("takeHourBrazil",300);c("takeHourChicago",300);c("takeHourLondon",300);c("askEnergyPackTimer",900);c("askStaminaPackTimer",900);c("askEventPartsTimer",900);c("askHomePartsTimer",900);c("askRobSquadsTimer",900);c("autoAskCityCrewTimer",3600);c("activateBrazilCrewTimer",3600);c("activateChicagoCrewTimer",3600);c("activateLondonCrewTimer",3600);c("AskforHelpBrazilTimer",1800);c("AskforHelpChicagoTimer",1800);c("AskforHelpLondonTimer",1800);c("AskforHelpVegasTimer",1800);c("checkVaultTimer",900);c("myOpsTimer",0);c("famOpsTimer",0);c("autoAcceptMsgTimer",3600);c("askFightBoostsTimer",3600);c("autoBattleTimer",300);c("autoSlotTimer",300);c("autoFreeGiftTimer",900);c("autoAskFreeGiftTimer",900);c("requestTimer",300);c("checkPropertyTimer",3600);addToLog("warning Icon","All active timers have been reset.");b&&(alert("All active timers have been reset."),Autoplay.delay=150,Autoplay.start(),autoReload(!1,"reset timers"))}function doQuickClicks(){try{var b=function(a){return(a=xpathFirst(a))?(clickElement(a),!0):!1};if(!b('//a[@class="sexy_button_new short white" and contains(@onclick,"travel") and contains(.,"Go to")]')&&(!isGMChecked("autoGlobalPublishing")||!b('//a[contains(@onclick,"postLevelUpFeedAndSend(); levelUpBoost();")]')&&!b('//a[contains(.,"Share the wealth!")]')&&!b('//div//a[@class="sexy_button" and contains(text(),"Reward Friends")]')&&!b('//div//a[@class="sexy_button_new short white sexy_call_new" and contains(text(),"Reward Friends")]')&&!b('//div//a[@class="sexy_button_new short white sexy_call_new" and contains(.,"Ask Friends for Help!")]')&&!b('//div//a[@class="sexy_button_new short white sexy_call_new" and contains(text(),"Rally More Help")]')&&!b('//div[@class="boss_operations"]//a[contains(@class,"boss_consumable_feed") and contains(.,"Ask")]')&&!b('//a[@id="collect_share_feed_btn" and contains(.,"Share")]')&&!b('//a[@id="fotd_share_button" and contains(.,"Share") and contains(@onclick, "var feed")]'))){if(onHome()){if(!timeLeftGM("resetHomePropTimer")){var c=cityProperties.filter(function(a,b,c){return 1==c[b][ctPropType]});if(0<c.length){v=0;for(w=c.length;v<w;v++){var a="bye_"+c[v][ctPropName].ftrim()+"_build_timer",d=xpathFirst('//span[@id="'+a+'"]');d&&setGMTime(c[v][ctPropTimer],d.innerHTML.untag())}isGMChecked("collectTakeNew York")&&(document.getElementById("bcm_timer_countdown_nyc")&&setGMTime("takeHourNew York",document.getElementById("bcm_timer_countdown_nyc").innerHTML.untag()),document.getElementById("bcm_timer_countdown_vegas")&&setGMTime("takeHourLas Vegas",document.getElementById("bcm_timer_countdown_vegas").innerHTML.untag()));setGMTime("resetHomePropTimer","1 hours")}return}if(isGMChecked("autoGlobalPublishing")&&!timeLeftGM("askHomePartsTimer")){var e=xpathFirst('.//a[contains(@class,"sexy_call_new") and contains(.,"Ask for parts")]',innerPageElt);e||(e=xpathFirst('.//a[contains(@class,"build_event_post_feed") and contains(.,"Ask for all parts") and not(contains(@style,"opacity: 0.5"))]',innerPageElt));if(e){clickElement(e);addToLog("info Icon","Clicked to ask your mafia to send you Parts.");setGMTime("askHomePartsTimer","4 hours");return}}if(isGMChecked("autoGlobalPublishing")&&!timeLeftGM("askRobSquadsTimer")){var f=xpathFirst('.//a[contains(@class,"build_event_post_feed_btn") and contains(@onclick,"showOneClickFeed") and contains(.,"Ask")]',innerPageElt);if(f){clickElement(f);addToLog("info Icon","Clicked to ask your mafia to send you Rob Squads.");setGMTime("askRobSquadsTimer","4 hours");return}}if(isGMChecked("autoGlobalPublishing")&&!timeLeftGM("askEventPartsTimer")){var g=xpathFirst('.//a[contains(@class,"sexy_call_new") and contains(.,"Ask") and contains(@onclick,"BuildEventModule")]',innerPageElt);if(g){DEBUG("Asking for Event Parts - Ask button Found");clickElement(g);addToLog("info Icon","Clicked to Ask your mafia for Event Parts.");setGMTime("askEventPartsTimer","4 hours");return}}if(isGMChecked("collectParts")&&!timeLeftGM("partsHour")){var h=xpathFirst('.//a[@class="sexy_button_new short green" and contains(@onclick,"collectAllButton") and not(contains(@style,"none"))]',innerPageElt);if(h){DEBUG("Collecting Parts from Properties");clickElement(h);addToLog("info Icon","Clicked to Collect All Parts from Properties.");setGMTime("partsHour","4 hours");return}if(h=xpathFirst('.//span[@id="bcm_timer_countdown"]',innerPageElt)){setGMTime("partsHour",h.innerHTML);DEBUG("Collecting Parts from Properties - Resetting Timer: "+h.innerHTML);return}}if(!timeLeftGM("askEnergyPackTimer")){var k=xpathFirst('.//div[@class="module_subtitle" and contains(.,"ENERGY")]',innerPageElt);if(k){var k=k.parentNode,l=xpathFirst('.//span[@id="cur_energy"]',k),n=xpathFirst('.//span[contains(@style,"white")]',l.parentNode);curNRG=parseInt(l.innerHTML);maxNRG=parseInt(n.innerHTML);if(curNRG<maxNRG){var o=xpathFirst('.//a[@class="empire_wait_ask_button sexy_button_new fl" and contains(.,"Ask")]',k);o&&(clickElement(o),addToLog("info Icon","Clicked to ask your mafia for Energy Packs."),setGMTime("askEnergyPackTimer","4 hours"))}else DEBUG("at Max for Energy Packs - not asking"),setGMTime("askEnergyPackTimer","4 hours");return}}if(!timeLeftGM("askStaminaPackTimer")&&(k=xpathFirst('.//div[@class="module_subtitle" and contains(.,"POWER")]',innerPageElt))){k=k.parentNode;l=xpathFirst('.//span[@id="cur_power"]',k);n=xpathFirst('.//span[contains(@style,"white")]',l.parentNode);curNRG=parseInt(l.innerHTML);maxNRG=parseInt(n.innerHTML);if(curNRG<maxNRG){if(o=xpathFirst('.//a[@class="empire_wait_ask_button sexy_button_new fl" and contains(.,"Ask")]',k))clickElement(o),addToLog("info Icon","Clicked to ask your mafia for Power Packs."),setGMTime("askStaminaPackTimer","4 hours")}else DEBUG("at Max for Power Packs - not asking"),setGMTime("askStaminaPackTimer","4 hours");return}if(running&&(isGMChecked("autoEnergyPack")||GM_getIntValue("autoEnergyPackForcePts",0))){colorDEBUG("autoEnergyPack",caq);energyPack=!1;if(energyPackElt=xpathFirst('.//div[contains(@id, "empire_use_pack_area") and contains(@style,"block")]//a[contains(@onclick, "EnergyPackModule.use()")]',innerPageElt)){colorDEBUG("autoEnergyPack - elt found",caq);energyPack=energyPackElt&&onHome()?!0:!1;var p=xpathFirst('.//div[contains(@id, "mbox_energy_timer_container")]',innerPageElt);p&&(colorDEBUG("autoEnergyPack - countdown elt found",caq),"block"==p.style.display&&(energyPack=!1,colorDEBUG("autoEnergyPack - can not use pack",caq)))}var q=1.25*maxEnergy*getEnergyGainRate();colorDEBUG("autoEnergyPack - estimated xp from pack: "+q,caq);var u=ptsToNextLevel-parseInt(stamina*getStaminaGainRate());colorDEBUG("autoEnergyPack - xp to next level left after stamina is used: "+u,caq);if((autoEnergyPackWaiting=energyPack&&q<=u)&&isGMChecked("autoEnergyPack")||energyPack&&energy<=GM_getIntValue("autoEnergyPackForcePts",0)){if(colorDEBUG("energyPack="+energyPack+"  energy="+energy+"  ptsToNextLevel="+ptsToNextLevel+"  ptsToLevelProjStaminaUse="+u),autoEnergyPackWaiting&&addToLog("energyPack Icon","This energy pack should give you approximately "+parseInt(q)+" xp of your "+parseInt(u)+" projected remaining xp."),energyPackElt){Autoplay.fx=function(){clickAction="energypack";colorDEBUG("Clicked to use energy pack")};Autoplay.start();return}}else colorDEBUG("autoEnergyPack - not using pack",cre)}}for(var A=xpath('.//a[contains(@onclick,"xw_action=dismiss_message")]',innerPageElt),v=0,w=A.snapshotLength;v<w;++v)A.snapshotItem(v)&&clickElement(A.snapshotItem(v));for(var G=xpath('.//div[@class="msg_box_div_contents" and contains(.,"Mystery")]',innerPageElt),v=0,w=G.snapshotLength;v<w;++v)if(G.snapshotItem(v)&&!/display: none/.test(G.snapshotItem(v).innerHTML)){var y=getActionLink(G.snapshotItem(v),"Open It!");y&&clickElement(y)}}}catch(F){DEBUG("Error @doQuickClicks: "+F)}}function doParseMessages(){var b=$x('//td[@class="message_body"]');if(b&&0<b.length)for(var c=0,a=b.length;c<a;++c)if(/Mini[\s\w]+Buff/i.test(b[c].innerHTML)){addToLog("yeah Icon",b[c].innerHTML);setGMTime("miniPackTimer","8 hours");break}}function preloadMWAPImages(){!document.getElementById("PreLoadImages")&&document.body&&document.getElementById("verytop")&&(makeElement("div",document.body,{id:"PreLoadImages",style:"position: absolute; top: -9999px; left:-9999px;"}).innerHTML='<img src="'+SCRIPT.PSMWAP_imagePath+'r1_c1.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r1_c2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r1_c16.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c1.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c3.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c4.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c5.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c6.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c8.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c9.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c11.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c12.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c14.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c15.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c16.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r3_c1.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r3_c15.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r3_c16.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r5_c1.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r5_c2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r5_c4.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r5_c7.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r5_c10.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r5_c13.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r5_c16.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r6_c1.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r6_c2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r6_c16.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c2_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c3_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c4_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c5_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c6_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c8_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c9_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c11_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c12_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c14_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r2_c15_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r3_c15_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r5_c2_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r5_c7_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r5_c10_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'r5_c13_f2.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_10.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_11.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_05.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_06.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_07.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_08.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_08.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_09.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_12.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_10-over.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_11-over.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_05-over.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_06-over.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_07-over.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_08-over.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_08-over.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_09-over.png"><img src="'+SCRIPT.PSMWAP_imagePath+'logbox2_12-over.png">')}function customizeStatsRow(){document.getElementById("level_up_ratio_stats")||(elt=makeElement("div",statsrowElt,{id:"level_up_ratio_stats",title:"Ratios needed to level up: combined, on energy only, on stamina only.",style:"float:left;width:450px;"}));setLevelUpRatioStats();if(!document.getElementById("mwapSpringBoard")){var b=makeElement("select",statsrowElt,{id:"mwapSpringBoard",title:"mwapSpringBoard",style:"font-size:10px;float:right;width:200px;"});choiceTier=document.createElement("option");choiceTier.text="RX6 MWAP SpringBoard";choiceTier.value="";b.appendChild(choiceTier);i=0;for(iLength=cities.length;i<iLength;i++)if(!cities[i][CITY_CLOSED]){choiceTier=document.createElement("optgroup");choiceTier.label=cities[i][CITY_NAME].toUpperCase();choiceTier.className="ap_optgroup1";b.appendChild(choiceTier);j=0;for(jLength=missionTabs[i].length;j<jLength;j++){var c=j+1;choiceTier=document.createElement("option");choiceTier.text=missionTabs[i][j];choiceTier.value=i+"|"+c;b.appendChild(choiceTier)}}b.addEventListener("change",mwapSpring,!1)}}function mwapSpring(){var b=document.getElementById("mwapSpringBoard").value;mwapJump(b)}function customizeMasthead(){function b(){var a=document.getElementById("mwapHelpMenu");a&&(a.style.display="block")}function c(){var a=document.getElementById("mwapHelpMenu");a&&(a.style.display="none")}function a(){var a=document.getElementById("mwapHelpMenu");if(a&&("none"==a.style.display&&(a.style.display="block"),"block"==a.style.display))a.style.display="none"}function d(){var a=makeElement("script",document.getElementsByTagName("head")[0],{id:"chuckerLink",type:"text/javascript"});a.src="http://simony.dk/gs/Chucker.js";a.id="chuckerLink"}function e(){var a=makeElement("script",document.getElementsByTagName("head")[0],{id:"analyserLink",type:"text/javascript"});a.src="http://www.playerscripts.co.uk/psbm/analyser/ps-inneed2.js";a.id="analyserLink"}var f=document.getElementById("snapi_zbar");f&&(f.style.display="none",f.parentNode&&f.parentNode.parentNode&&f.parentNode.parentNode.removeChild(f.parentNode));if(f=document.getElementById("mw_like_button"))f.style.display="none",f.parentNode&&f.parentNode.removeChild(f);odiv=xpathFirst('.//iframe[@name="mafiawars_zbar"]');f&&(f.style.display="none",f.parentNode&&f.parentNode.removeChild(f));var g=$x('.//div[contains(@id,"cpa") and contains(@id,"banner")]');for(i=0;i<g.length;i++)if(f=g[i])f.style.display="none",f.parentNode&&f.parentNode.removeChild(f);document.title="Mafia Wars on Facebook";isGMChecked("fbwindowtitle")&&GM_getValue("FBName")&&(document.title=GM_getValue("FBName"));if(!document.getElementById("ap_menu")){g=new_header?xpathFirst('//div[@class="header_top_row"]'):xpathFirst('.//div[contains(@id,"mw_masthead")]');f=makeElement("div",g,{id:"ap_links",style:"position: absolute; top: 4px; right: 0px; text-align: left;font-size: 10px; font-weight: bold;"});makeElement("a",f,{href:"http://www.playerscripts.co.uk/mwap-script/mwap-ff-download.html",target:"_blank"}).appendChild(document.createTextNode("For Firefox"));f.appendChild(document.createTextNode(" | "));makeElement("a",f,{href:"https://chrome.google.com/extensions/detail/cgagpckjofhomehafhognmangbjdiaap",target:"_blank"}).appendChild(document.createTextNode("For Chrome"));f="RX6 MWAP ";f+=SCRIPT.version;new_header&&(f+=" (nH)");makeElement("div",g,{style:"position: absolute; top: 20px; right: 10px; text-align: left; font-size: 10px; font-weight: bold; color: white"}).innerHTML=f;f=makeElement("div",g,{id:"mwapLikeElt",style:"position: absolute; top: 20px; right: 500px;z-index:5000;"});f.innerHTML='<iframe src="http://playerscripts.co.uk/ps-adbanner/ps-adbanner.html" scrolling="no" frameborder="0" style="margin:0px;padding:0px; border:none; overflow:hidden; width:0px; height:0px;" allowTransparency:"true"></iframe>';f.innerHTML+='<iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.facebook.com%2Fpages%2FPS-Mafia-Wars-Autoplayer%2F160393374005267&amp;layout=button_count&amp;show_faces=true&amp;width=80&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:80px; height:21px;" allowTransparency="true"></iframe>';g.insertBefore(f,g.firstChild);var f=makeElement("div",g,{id:"ap_menu",style:"position: absolute; top: 38px; font-size: 10px; right: 0px; text-align: left;"}),h=makeElement("div",null,{id:"mwapHelpElt",style:"position: absolute; top: 18px; right:170px; width: 110px; z-index: 1;"}),k=makeElement("div",h,{id:"help_container",style:"width: 110px;"}),l=makeElement("a",k,{"class":"sexy_button_new short black_white_border",style:"width: 110px; outline-color: -moz-use-text-color; outline-style: none; outline-width: medium;"}),l=makeElement("span",l);makeElement("span",l,{style:"background: transparent url(http://mwfb.static.zynga.com/mwfb/graphics/dropdown_travel_arrow.gif) no-repeat scroll 75px 50%; text-align: left; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous;"}).appendChild(document.createTextNode(" RX6 MWAP "));k=makeElement("div",k,{style:"z-index: 20; display: none;margin-top:-2px;width:154px;",id:"mwapHelpMenu"});k.innerHTML+='<div><b>Downloads</b></div> <a href="http://www.playerscripts.co.uk/mwap-script/mwap-ff-download.html" target="_blank"> For Firefox</a> <a href="https://chrome.google.com/extensions/detail/cgagpckjofhomehafhognmangbjdiaap" target="_blank"> For Chrome</a> <div><b>Websites</b></div> <a href="http://www.playerscripts.co.uk/" target="_blank"  title="Playerscripts Home"> PlayerScripts</a><a href="http://www.mwap.me.uk/" target="_blank"  title="RX6 MWAP Home"> RX6 MWAP</a><div><b>PS Scripts</b></div> <a href="http://playerscripts.co.uk/pswiki/index.php?title=PS_WS_About" target="_blank" title="PS NFS : News Feed Scanner"> PS NFS</a><a id="mwapChuckerLink" href="#">PS Chucker</a><a style="border-bottom:1px solid #FFF" id="PSanalyserLink" href="#">PS Analyser</a><a id="mwapBorkaVatorSelect" href="#">PS BorkaVator List</a><a style="border-bottom:1px solid #FFF" id="mwapBorkaVatorMap" href="#">PS BorkaVator Map</a><a id="mwapNewSettingsLink" href="#">RX6 MWAP Settings 2</a>';g.insertBefore(h,g.firstChild);document.getElementById("mwapChuckerLink").addEventListener("click",d,!1);document.getElementById("PSanalyserLink").addEventListener("click",e,!1);l=document.getElementById("mwapBorkaVatorSelect");l.addEventListener("click",addBorkaVatorSelect,!1);l=document.getElementById("mwapBorkaVatorMap");l.addEventListener("click",addBorkaVatorMap,!1);l=document.getElementById("mwapNewSettingsLink");g.insertBefore(h,g.firstChild);h.addEventListener("click",a,!1);h.addEventListener("mouseover",b,!1);h.addEventListener("mouseout",c,!1);g=makeElement("a",null,{id:"checkPack"});g.innerHTML='<span id="checkPack">Grab Toolbar info</span>';g.addEventListener("click",grabToolbarInfo,!1);k.insertBefore(g,k.firstChild);g=makeElement("a",null,{id:"resetTimers"});g.innerHTML='<span id="resetTimers">Reset Timers</span>';g.addEventListener("click",resetTimers,!1);k.insertBefore(g,k.firstChild);g=makeElement("a",null,{id:"showTimers"});g.innerHTML='<span id="showTimers">Show Timers</span>';g.addEventListener("click",showTimers,!1);k.insertBefore(g,k.firstChild);g=makeElement("a",null,{id:"autoPlay"});g.innerHTML='<span id="autoPlayspan">Settings</span>';g.addEventListener("click",toggleSettings,!1);k.insertBefore(g,k.firstChild);f.appendChild(document.createTextNode(" | "));g=makeElement("span",f);g.appendChild(document.createTextNode("Settings"));g.addEventListener("click",toggleSettings,!1);f.appendChild(document.createTextNode(" | "));f=makeElement("span",f);f.appendChild(document.createTextNode("Log"));f.addEventListener("click",showMafiaLogBox,!1)}updateMastheadMenu()}function addBorkaVatorMap(){$("head").append('<script src="http://www.mwap.me.uk/mwap-bm/jquery.ui.widget.js><\/script>');$("#popup_fodder").append("<div id='map_content'></div>");var b=document.getElementById("map_content");if(!document.getElementById("mwapSpringMap")){b=makeElement("div",b,{id:"mwapSpringMap",title:"mwapSpringMap",style:"width:290px;padding:10px;"});i=0;for(iLength=cities.length;i<iLength;i++)if(!cities[i][CITY_CLOSED]){choiceTier=document.createElement("p");choiceTier.appendChild(document.createTextNode(cities[i][CITY_NAME].toUpperCase()));b.appendChild(choiceTier);j=0;for(jLength=missionTabs[i].length;j<jLength;j++){var c=j+1;choiceTier=makeElement("a",b,{title:missionTabs[i][j],style:"border:1px solid;padding:0px 5px 0px 5px;margin:5px;"});choiceTier.text=c;choiceTier.name=i+"|"+c;b.appendChild(choiceTier);choiceTier.addEventListener("click",mwapSpringMap,!1)}}}$("#map_content").dialog({title:"RX6 MWAP BorkaVator Map",hide:"fade",show:"blind",close:function(){$("#map_content").remove()},width:325,zIndex:999999,position:["center",80],resizable:!1})}function addBorkaVatorSelect(){$("head").append('<script src="http://www.mwap.me.uk/mwap-bm/jquery.ui.widget.js><\/script>');$("#popup_fodder").append("<div id='list_content'></div>");var b=document.getElementById("list_content");if(!document.getElementById("mwapSpringList")){b=makeElement("select",b,{id:"mwapSpringList",title:"mwapSpringList",style:"width:220px;"});choiceTier=document.createElement("option");choiceTier.text="RX6 MWAP Borka-Vator List";choiceTier.value="";b.appendChild(choiceTier);i=0;for(iLength=cities.length;i<iLength;i++)if(!cities[i][CITY_CLOSED]){choiceTier=document.createElement("optgroup");choiceTier.label=cities[i][CITY_NAME].toUpperCase();choiceTier.className="ap_optgroup1";b.appendChild(choiceTier);j=0;for(jLength=missionTabs[i].length;j<jLength;j++){var c=j+1;choiceTier=document.createElement("option");choiceTier.text=missionTabs[i][j];choiceTier.value=i+"|"+c;b.appendChild(choiceTier)}}b.addEventListener("change",mwapSpringList,!1)}$("#list_content").dialog({title:"RX6 MWAP BorkaVator List",hide:"fade",show:"blind",close:function(){$("#list_content").remove()},width:240,height:85,zIndex:999999,position:["center",80],resizable:!1})}function mwapSpringList(){var b=document.getElementById("mwapSpringList").value;mwapJump(b)}function mwapSpringMap(){mwapJump(this.name)}function mwapJump(b){var b=b.split("|"),c=b[0],a=parseInt(b[1]),b=a-1;if(isNewCity(c)){var d=missions.filter(function(b,d,g){return g[d][MISSION_CITY]==c&&g[d][MISSION_TAB]==a});d[0][MISSION_TABPATH]&&(a=d[0][MISSION_TABPATH])}if(d=makeElement("a",null,{onclick:'return do_ajax("inner_page","remote/html_server.php?xw_controller=travel&xw_action=travel&xw_city='+city+"&from=job&zone=1&destination="+cities[c][CITY_NUMBER]+"&tab="+a+'", 1, 1 ,0, 0); return false;'}))return clickElement(d),addToLog("info Icon","Springboard used to go to "+cities[c][CITY_NAME]+" - "+missionTabs[c][b]),!0}function mwapNewSettings(){function b(a){var b=$x('.//div[@class="tabcontent"]');if(b&&b.length){i=0;for(iLength=b.length;i<iLength;i++)b[i].id==a?(b[i].style.display="block",$("#currentTab").html(""),$("#currentTab").append(b[i].id)):b[i].style.display="none"}}$.fx.speeds._default=700;$("head").append('<script src="http://www.mwap.me.uk/mwap-bm/jquery.ui.tabs.js"><\/script>');$("head").append('<script src="http://www.mwap.me.uk/mwap-bm/jquery.ui.widget.js><\/script>');$("#popup_fodder").append("<div id='currentTab' style='display:none;'></div>");$("#popup_fodder").append("<div id='mwapNewSettings'></div>");var c=document.getElementById("mwapNewSettings");$("#mwapNewSettings").dialog({title:"RX6 MWAP Settings - mwap.me.uk",hide:"fade",show:"fade",buttons:[{text:"Cash",click:function(){b("cashTab")}},{text:"Health",click:function(){b("healTab")}},{text:"Stamina",click:function(){b("staminaTab")}},{text:"Energy",click:function(){b("energyTab")}},{text:"AutoStat",click:function(){b("autostatTab")}},{text:"Family",click:function(){b("familyTab")}},{text:"Mafia",click:function(){b("mafiaTab")}},{text:"Display",click:function(){b("displayTab")}},{text:"General",click:function(){b("generalTab")}}],close:function(){$("#mwapNewSettings").remove()},width:805,height:550,zIndex:999999,position:["center",80]});var a=createGeneralTabNew2012();c.appendChild(a);a=createDisplayTabNew2012();c.appendChild(a);a=createMafiaTabNew2012();c.appendChild(a);a=createFamilyTabNew2012();c.appendChild(a);a=createAutostatTabNew2012();c.appendChild(a);a=createEnergyTabNew2012();c.appendChild(a);a=createStaminaTabNew2012();c.appendChild(a);a=createHealTabNew2012();c.appendChild(a);a=createCashTab();c.appendChild(a);var d;document.getElementById("currentTab")&&(d=document.getElementById("currentTab").innerHTML);d||(d=GM_getValue("currentTab","generalTab"));b(d)}function customizeStats(){setListenStats(!1);var b=xpathFirst('.//div[@id="game_stats"]//div[@id="cash_stats_'+cities[city][CITY_ALIAS]+'"]/h4/a[@id="mwap_bank"]',statsrowElt),c=xpathFirst('.//div[@id="game_stats"]//div[@id="cash_stats_'+cities[city][CITY_ALIAS]+'"]/h4/text()',statsrowElt);c&&!b&&(b=makeElement("a",null,{id:"mwap_bank",title:"Click to bank immediately."}),c.parentNode.insertBefore(b,c),b.appendChild(c),b.addEventListener("click",quickBank,!1));b=document.getElementById("mwap_nrg");(c=xpathFirst('./div[@class="mw_header"]//div[@class="mid_row_text energy_text_bg" and contains(text(), "ENERGY")]',statsrowElt))||(c=xpathFirst('.//div[@id="game_stats"]//h4[@class="energy" and contains(text(), "Energy")]',statsrowElt));c||(c=xpathFirst('.//div[@id="game_stats"]//span[@class="stat_title" and contains(text(),"Energy")]',statsrowElt));if(c&&!b){isGMChecked("autoMission")?(b="Spend Energy ON.  ",c.style.color="#33FF00"):(b="Spend Energy OFF.  ",c.style.color="#FF0000");selectedTierValue=GM_getValue("selectTier","0.0").split(".");masteryCity=parseInt(selectedTierValue[0]);masteryTier=parseInt(selectedTierValue[1]);b=0==masteryCity&&(0==masteryTier||void 0==masteryTier)?b+" Mastering- Turned OFF ":b+(" Mastering-"+cities[masteryCity][CITY_NAME]+", District/Region-"+masteryTier+" "+missionTabs[masteryCity][masteryTier-1]);c.style.textDecoration="underline";b=makeElement("a",null,{id:"mwap_nrg",title:b});c.parentNode.insertBefore(b,c);b.appendChild(c);b.addEventListener("click",toggleNrgSpend,!1);var a=document.getElementById("mwap_epack");if(!a){var c=getHoursTime("miniPackTimer"),a=(0==c||void 0==c?"Mini-Pack available now. ":c+" until Mini-Pack is available. ")+" Click to attempt to fire immediately.",d=isGMChecked("mastheadOnTop")?"0px":"60px",a=makeElement("a",null,{id:"mwap_Fire_epak",title:a,style:"position:absolute; top:"+d+"; right:384px;"});0==c||void 0==c?(a.innerHTML=mini_Epak_ready,c="EP"):(a.innerHTML=mini_Epak_wait,c="na");mepakParent=b.parentNode;mepakParent.insertBefore(a,mepakParent.childNodes[2]);a.appendChild(document.createTextNode(c));a.addEventListener("click",miniPackForce,!1)}}c=document.getElementById("mwap_stam");(b=xpathFirst('./div[@class="mw_header"]//div[@class="mid_row_text stamina_text_bg" and contains(text(), "STAMINA")]',statsrowElt))||(b=xpathFirst('.//div[@id="game_stats"]//h4[contains(text(), "Stamina")]',statsrowElt));b||(b=xpathFirst('.//div[@id="game_stats"]//span[@class="stat_title" and contains(text(),"Stamina")]',statsrowElt));b&&!c&&(isGMChecked("staminaSpend")?(c="Spend Stamina ON.  ",b.style.color="#33FF00"):(c="Spend Stamina OFF.  ",b.style.color="#FF0000"),c+="Minimum Stamina for auto-healing set at "+GM_getValue("stamina_min_heal")+" points.",a=GM_getValue("staminaSpendHow"),c+=" Stamina Spend Mode: "+staminaSpendChoices[a],b.style.textDecoration="underline",c=makeElement("a",null,{id:"mwap_stam",title:c}),b.parentNode.insertBefore(c,b),c.appendChild(b),c.addEventListener("click",toggleStamSpend,!1));b=xpathFirst('.//div[@id="game_stats"]//a[@class="heal_link" or @class="heal_link vt-p"]',statsrowElt);c=document.getElementById("mwap_heal");(a=xpathFirst('./div[@class="mw_header"]//div[@class="mid_row_text health_text_bg" and contains(text(), "HEALTH")]',statsrowElt))||(a=xpathFirst('.//div[@id="game_stats"]//h4[@class="health" and contains(text(), "Health")]',statsrowElt));a||(a=xpathFirst('.//div[@id="game_stats"]//span[@class="stat_title" and contains(text(),"Health")]',statsrowElt));a&&(c||(a.style.color="#FF0000",a.style.textDecoration="underline",a.style.display="inline-block",c=makeElement("a",null,{id:"mwap_heal",title:"Click to heal immediately."}),a.parentNode.insertBefore(c,a),c.appendChild(a),c.style.textDecoration="none",d=document.getElementById("mwap_toggleheal"),d||(newLinkTitle=isGMChecked("autoHeal")?GM_getValue("staminaSpendHow")==STAMINA_HOW_FIGHTROB?"autoHeal checked BUT OVERRULED - healing in "+locations[GM_getValue("healLocation")]+" when health falls below "+GM_getValue("healthLevel")+".":"autoHeal checked - healing in "+locations[GM_getValue("healLocation")]+" when health falls below "+GM_getValue("healthLevel")+".":"autoHeal unchecked",d=makeElement("a",null,{id:"mwap_toggleheal",title:newLinkTitle}),d.innerHTML=isGMChecked("autoHeal")?GM_getValue("staminaSpendHow")==STAMINA_HOW_FIGHTROB?healOnHoldIcon:healOnIcon:healOffIcon,d.style.padding="5px 0px 0px 8px",d.style.position="absolute",healParent=c.parentNode,healParent.insertBefore(d,healParent.childNodes[2]),d.addEventListener("click",toggleHeal,!1))),d=/transparent url/i.test(a.getAttribute("style")),20>health&&isGMChecked("hideInHospital")?d||(a.style.background="transparent url("+stripURI(hideIcon)+") no-repeat scroll 0 50%",a.title="Currently hiding in the hospital. Click to heal immediately."):d&&(a.style.background="",a.title="Click to heal immediately."),b&&c.addEventListener("click",autoHeal,!1));energyElt.style.textDecoration=energy==maxEnergy?"blink":"none";staminaElt.style.textDecoration=stamina==maxStamina?"blink":"none";healthElt.style.textDecoration=19<health&&29>health?"blink":"none";isGMChecked("forceHealOpt5")&&20>health&&!0!=GM_getValue("healWaitStarted")&&(setGMTime("healWaitTime","05:00"),GM_setValue("healWaitStarted",!0));setListenStats(!0)}function toggleHeal(){document.getElementById("mwap_toggleheal")&&(isGMChecked("autoHeal")?(GM_setValue("autoHeal",0),document.getElementById("mwap_toggleheal").innerHTML=healOffIcon,document.getElementById("mwap_toggleheal").title="autoHeal unchecked",addToLog("healOffIcon Icon","autoHeal turned OFF by User")):(GM_setValue("autoHeal","checked"),GM_getValue("staminaSpendHow")==STAMINA_HOW_FIGHTROB?(document.getElementById("mwap_toggleheal").innerHTML=healOnHoldIcon,document.getElementById("mwap_toggleheal").title="autoHeal checked BUT OVERRULED - healing in "+locations[GM_getValue("healLocation")]+" when health falls below "+GM_getValue("healthLevel")+".",addToLog("healOnHoldIcon Icon","autoHeal turned ON by User, but overruled")):(document.getElementById("mwap_toggleheal").innerHTML=healOnIcon,document.getElementById("mwap_toggleheal").title="autoHeal checked - healing in "+locations[GM_getValue("healLocation")]+" when health falls below "+GM_getValue("healthLevel")+".",addToLog("healOnIcon Icon","autoHeal turned ON by User"))))}function toggleNrgSpend(){isGMChecked("autoMission")?(GM_setValue("autoMission",0),addToLog("info Icon","Energy Spend turned OFF by User")):(GM_setValue("autoMission","checked"),addToLog("info Icon","Energy turned ON by User"));update_nrg_stam()}function toggleStamSpend(){isGMChecked("staminaSpend")?(GM_setValue("staminaSpend",0),addToLog("info Icon","staminaSpend turned OFF by User")):(GM_setValue("staminaSpend","checked"),addToLog("info Icon","staminaSpend turned ON by User"));update_nrg_stam()}function quickBank(b,c){isNaN(c)&&(isNaN(b)&&(b=city),c=(cashElt=document.getElementById("user_cash_"+cities[b][CITY_ALIAS]))?parseCash(cashElt.innerHTML):cities[b][CITY_CASH]);if(b==LV){if(GM_getValue("vaultHandling",0)){var a=GM_getIntValue("vaultSpace",0);if((0>=a||!GM_getValue("vegasReport",""))&&!timeLeftGM("checkVaultTimer"))return addToLog("info Icon","Your vault appears to be full, rechecking..."),setGMTime("checkVaultTimer","2 hours"),checkPropertyStatus(LV,!1),!1;c=c>a?a:c}a="xw_controller=propertyV2&xw_action=doaction&xw_city=5&doaction=ActionBankDeposit&building_type=6&city=5&amount="+c}else a="xw_controller=bank&xw_action=deposit_all&xw_city="+(b+1);if(10>c)return!1;if(1E11<c)return addToLog("updateBad Icon",'Depositing <strong class="good">'+cities[b][CITY_CASH_SYMBOL]+makeCommaValue(c)+'</strong>!?!<strong class="bad"> HELL NO!</strong> Sink it from the banking page.'),quickBankFail=!0,!1;if(city!=b)return DEBUG("Switching city too fast, not quick-banking."),!1;var d=createAjaxPage(!1,"quick deposit",b),a=makeElement("a",null,{onclick:'return do_ajax("'+d+'","remote/html_server.php?'+a+'", 1, 1, 0, 0); return false;'});clickElement(a);DEBUG("Clicked to quickbank.");return!1}function customizeHome(){var b=document.getElementById("snapi_zbar");b&&b.parentNode.parentNode.removeChild(b.parentNode);if(b=document.getElementById("mw_like_button"))b.style.display="none";odiv=xpathFirst('.//iframe[@name="mafiawars_zbar"]');b&&(b.style.display="none",b.parentNode&&b.parentNode.removeChild(b));var c=$x('.//div[contains(@id,"cpa") and contains(@id,"banner")]');for(i=0;i<c.length;i++)if(b=c[i])b.style.display="none",b.parentNode&&b.parentNode.removeChild(b);if(!onHome())return!1;b=xpathFirst('//div[@id="marketInfo"]');if(!running&&!b){if(b=xpathFirst('.//div[@id="MainModule"]',innerPageElt))b.style.height="";b=xpathFirst('.//div[@class="empire_main_module"]',innerPageElt);b=createAjaxPage(!1,"marketplace",b);b=makeElement("a",null,{onclick:'return do_ajax("'+b+'","'+SCRIPT.controller+"marketplace"+SCRIPT.action+'marketplace_category&category=8", 1, 1, 0, 0); return false;'});clickElement(b)}return!0}function getPlayerStats(){var b=xpathFirst('.//table[contains(.,"Attack:") and contains(.,"Defense:")]',innerPageElt);if(b){DEBUG("Fetching stats from profile page");var c=xpathFirst('.//tr[contains(.,"Attack:")]',b);c&&c.innerHTML.match(/>\s*(\d+)/)&&(curAttack=parseInt(RegExp.$1),GM_setValue("curAttack",curAttack));if((b=xpathFirst('.//tr[contains(.,"Defense:")]',b))&&b.innerHTML.match(/>\s*(\d+)/))curDefense=parseInt(RegExp.$1),GM_setValue("curDefense",curDefense);if(isUndefined(curAttack)||isUndefined(curDefense))addToLog("info icon","Current status attributes cannot be detected, turning off auto-stat."),GM_setValue("autoStat",0)}}function getPlayerEquip(){if(onFightTab()||onInventoryTab()||onLootTab()){var b=xpathFirst('.//div[@id="mafia_attack_strength"]',innerPageElt);b&&(prevAttackEquip=curAttackEquip,b.innerHTML.untag().match(/(.+)\(/)&&(curAttackEquip=parseInt(RegExp.$1.replace(/\D/g,""))),(b=xpathFirst('.//span[@title="Family Property Bonus"]',b))&&(curAttackEquip+=parseInt(b.innerHTML.replace(/\D/g,""))),GM_setValue("curAttackEquip",curAttackEquip));if(b=xpathFirst('.//div[@id="mafia_defense_strength"]',innerPageElt))prevDefenseEquip=curDefenseEquip,b.innerHTML.untag().match(/(.+)\(/)&&(curDefenseEquip=parseInt(RegExp.$1.replace(/\D/g,""))),(b=xpathFirst('.//span[@title="Family Property Bonus"]',b))&&(curDefenseEquip+=parseInt(b.innerHTML.replace(/\D/g,""))),GM_setValue("curDefenseEquip",curDefenseEquip);(isUndefined(curAttackEquip)||isUndefined(curDefenseEquip))&&DEBUG("Current equipment attributes cannot be detected.")}}function customizeProfile(){if(!xpathFirst('.//td[@class="stats_left"]',innerPageElt))return!1;getPlayerStats();this.buildAnchor=function(a){var c={};c.href=a.URLSegment?"http://mwfb.zynga.com/mwfb/remote/html_server.php?"+a.URLSegment:a.href?a.href:"#";!a.clickEvent&&a.URLSegment&&(c.onclick="return do_ajax('inner_page', '/remote/html_server.php?"+a.URLSegment+"', 1, 1, 0, 0); return false; ");a.id&&(c.id=a.id);c=makeElement("a",b,c);a.AnchorText&&c.appendChild(document.createTextNode(a.AnchorText));a.clickEvent&&c.addEventListener("click",a.clickEvent,!1);return c};var b=xpathFirst('.//a[contains(., "Sucker Punch")]/..',innerPageElt);if(b){var c=xpathFirst('.//li[contains(@class, "tab_on")]//a[contains(text(), "Profile")]',innerPageElt);if(c){var a,d,e,f;c.getAttribute("onclick").match(/tmp=([\d,a-z]+)&cb=([\d,a-z]+)&user=p\|(\d+)/)&&(e="tmp="+RegExp.$1+"&",f="cb="+RegExp.$2+"&",a="p|"+RegExp.$3);!a&&c.getAttribute("onclick").match(/user=p\|(\d+)/)&&(a="p|"+RegExp.$1);if(m=/xw_controller=robbing.*?target=([0-9]+)/.exec(document.getElementById("inner_page").innerHTML))d=m[1];if(m=/xw_controller=stats.*?user=([0-9]+)/.exec(document.getElementById("inner_page").innerHTML))d=m[1];if(m=/xw_action=gift_wishlist.*?user=([0-9]+)/.exec(document.getElementById("inner_page").innerHTML))d=m[1];if(m=/q([0-9]+)_(\d+)\.jpg/.exec(document.getElementById("inner_page").innerHTML))d=m[1];1<document.getElementsByClassName("fightres_image").length&&(d=/(\d+)_(\d+)_q.jpg/.exec(document.getElementsByClassName("fightres_image")[1].innerHTML)[1]);if(m=/xw_controller=VegasSlots.+?friend_id=([0-9]+)/i.exec(document.getElementById("inner_page").innerHTML))d=m[1];if(m=/([0-9]+)_(\d+)\_q.jpg/.exec(document.getElementById("inner_page").innerHTML))d=m[1];if((m=/user%2522.*?%2522([0-9A-Za-z%]+)%2522/.exec(document.getElementById("mainDiv").innerHTML))||(m=/user%22.*?%22([0-9A-Za-z%]+)%22/.exec(document.getElementById("mainDiv").innerHTML)))d=atob(m[1].replace(/%253D/g,"=").replace(/%3D/g,"="));!e&&c.getAttribute("onclick").match(/tmp=([\d,a-z]+)&/)&&(e="tmp="+RegExp.$1+"&");!f&&c.getAttribute("onclick").match(/cb=([\d,a-z]+)&/)&&(f="cb="+RegExp.$2+"&");DEBUG("Profile: Mafia Wars ID: "+a+" Facebook ID: "+d);var c=a.replace("p|",""),g=xpathFirst('.//a[contains(., "Remove from Mafia")]',b);if(!running&&!g){var h=xpathFirst('./div[@class="title stats_title"]',innerPageElt);h&&h.setAttribute("style","background: black;");var h=createAjaxPage(!1,"icecheck profile",h),k=xpathFirst('.//a[contains(., "Add to Hitlist")]',innerPageElt),l=makeElement("a",null,null),k=k.getAttribute("onclick"),k=k.replace("inner_page",h);l.setAttribute("onclick",k);clickElement(l)}if(document.getElementById("where_are_my_links"))return!0;h=!1;makeElement("a",b,{id:"where_are_my_links",href:'javascript:alert("Due to the way Mafia Wars links to Facebook there are times where RX6 MWAP cannot find the Facebook profile ID. In those situations RX6 MWAP will not display buttons that require that ID. You can make the Facebook ID available by refreshing the profile page.");'}).appendChild(document.createTextNode("Where are my links?"));b.appendChild(document.createTextNode(" | "));makeElement("a",b,{href:"http://facebook.mafiawars.com/mwfb/remote/html_server.php?xw_controller=stats&xw_action=view&xw_city=1&user="+a}).appendChild(document.createTextNode("Refresh this profile!"));h=!0;d&&(h&&b.appendChild(document.createTextNode(" | ")),makeElement("a",b,{href:"http://www.facebook.com/profile.php?id="+d,target:"_blank"}).appendChild(document.createTextNode("Facebook Profile")),b.appendChild(document.createTextNode(" | ")),makeElement("a",b,{href:"http://www.facebook.com/addfriend.php?id="+d,target:"_blank"}).appendChild(document.createTextNode("Add as Friend")),h=!0);g&&(h&&b.appendChild(document.createTextNode(" | ")),this.buildAnchor({AnchorText:"Promote",URLSegment:"xw_controller=group&xw_action=view&xw_city="+(city+1)+"&"+e+f+"promote=yes&pid="+a}),h=!0);h&&makeElement("br",b,{});h=!1;g&&(a=-1!=getSavedList("autoWarTargetList").indexOf(c),this.buildAnchor({AnchorText:a?"Remove from War List":"Add to AutoWar List",id:c,title:"In the settings box, under the mafia tab\nIf you have selected war friends from a list\nupdates the friends ids in the box",clickEvent:a?clickWarListRemove:clickWarListAdd}),h=!0);h&&b.appendChild(document.createTextNode(" | "));a=-1!=getSavedList("pautoHitOpponentList").indexOf(c);this.buildAnchor({AnchorText:a?"Remove from AutoHit List":"Add to AutoHit List",id:c,title:"In the settings box, under the stamina tab\nIf you have selected hitlist opponents \nHitlist these opponents:",clickEvent:a?clickAutoHitListRemove:clickAutoHitListAdd});h=!0;g||(h&&b.appendChild(document.createTextNode(" | ")),h=!0,g=-1!=getSavedList("pfightlist").indexOf(c),this.buildAnchor({AnchorText:g?"Remove from Fight List":"Add to AutoFight List",id:c,title:"In the settings box, under the stamina tab\nIf you have selected fight specific opponents\nFight these opponents:",clickEvent:g?clickFightListRemove:clickFightListAdd}));h&&makeElement("br",b,{})}}return!0}function getBrazilJobMastery(b){if(b.innerHTML.untag().match(/(\d+)%/i)||b.innerHTML.untag().match(/(\d+)%\s?mastered/i))return parseInt(RegExp.$1);DEBUG("No mastery items found. Assuming 0% mastery level.");return 0}function getJobMastery(b,c){if(c){var a=100;if(isJobFight(b)&&isGMChecked("skipfight"))return 100;b.innerHTML.untag().match(/>(\d+)%\s+Job\s+Mastery/i)||b.innerHTML.untag().match(/(\d+)%/i)||b.innerHTML.match(/Job\s+Mastery\s+(\d+)%/i)||b.innerHTML.match(/>(\d+)%/i)?a=parseInt(RegExp.$1):b.innerHTML.untag().match(/margin-right:\s+(\d+)%/i)&&(a=100-parseInt(RegExp.$1));return a}if(/Mastered/i.test(b.innerHTML)||isJobLocked(b))return 100;if(b.innerHTML.match(/Job\s+Mastery\s+(\d+)%/i)||b.innerHTML.match(/>(\d+)%/i))return a=parseInt(RegExp.$1);DEBUG("No mastery items found. Assuming 0% mastery level.");return 0}function jobMastery(b,c){if(!isGMChecked("repeatJob")){var a=GM_getIntValue("selectMission",1),d=missions[a][MISSION_NAME],e=missions[a][MISSION_TAB],f=missions[a][MISSION_TABPATH],g=missions[a][MISSION_CITY],h=e;isNewCity(city)&&f&&(h=f);if(city==g&&onJobTab(h)){var k=getJobRow(d,b),f=0,h=-1;k&&(h=getJobMastery(k,c));DEBUG("Job '"+d+"' is "+h+" % complete");var l=100==h;k&&(c&&k.className.match(/level_(\d+)/i)?f=RegExp.$1:k.innerHTML.match(/level (\d+)/i)&&(f=RegExp.$1));for(var n=k=0,o=a,p=!1,q=0,u=missions.length;q<u;q++)if(city==missions[q][MISSION_CITY]&&e==missions[q][MISSION_TAB]){var A=getJobRow(missions[q][MISSION_NAME]);if(A){var v=getJobMastery(A,c);if(isGMChecked("skipfight")&&!isJobFight(A)||!isGMChecked("skipfight"))k+=v,n++,!p&&100>v&&(p=!0,o=q,DEBUG("firstUnmastered job is "+missions[q][MISSION_NAME]))}}0<n&&(k=Math.floor(k/n));GM_getValue("tierCompleteStatus")!=f+"|"+k&&GM_setValue("tierCompleteStatus",f+"|"+k);DEBUG("Job tier level "+f+" is "+k+"% complete.",caq);if(l||-1==h)if(0==getSavedList("jobsToDo").length)if(DEBUG("There are no more jobs in the to-do list."),l?addToLog("info Icon",'You have mastered <span class="job">'+d+"</span>."):addToLog("info Icon",'Job <span class="job">'+d+"</span> is not available."),100==k||isGMChecked("skipfight")){for(var w,q=a+1,u=missions.length;q<u;q++){if(missions[q][MISSION_CITY]!=g){w=q;addToLog("info Icon","You have mastered the final job tier in "+cities[g][CITY_NAME]+"! Moving to the next tier in "+cities[missions[w][MISSION_CITY]][CITY_NAME]+".");break}if(missions[q][MISSION_TAB]!=e){w=q;addToLog("info Icon","Current job tier is mastered. Moving to next tier in "+cities[g][CITY_NAME]+".");break}}w?(GM_setValue("selectMission",w),DEBUG("Next Job in Tier Mastery Sequence: "+missions[GM_getValue("selectMission",1)][MISSION_NAME])):addToLog("info Icon","You have mastered all jobs!")}else GM_setValue("selectMission",o),DEBUG("Next Job in Tier Mastery Sequence: "+missions[GM_getValue("selectMission",1)][MISSION_NAME]);else DEBUG("There are still jobs in the to-do list.");else GM_getValue("jobCompleteStatus")!=d+"|"+(""+h)&&(GM_setValue("jobCompleteStatus",d+"|"+(""+h)),DEBUG("Job '"+d+"' is "+h+"% complete."))}}}function highlightJobs(b,c,a,d){if(b!=c){for(;a.length;)b=a.pop(),xpathFirst('.//span[@class="job_best"]',b)||(city==LV&&(b.setAttribute("style","height:32px;"),makeElement("br",b)),b=makeElement("span",b,{"class":"job_best",style:"color:#52E259; font-size: 10px;margin-left:5px;"}),makeElement("img",b,{src:stripURI(yeahIcon),width:"12",height:"12",style:"vertical-align:middle"}),b.appendChild(document.createTextNode(" BEST")));for(;d.length;)b=d.pop(),xpathFirst('.//span[@class="job_worst"]',b)||(city==LV&&(b.setAttribute("style","height:32px;"),makeElement("br",b)),b=makeElement("span",b,{"class":"job_worst",style:"color:#EC2D2D; font-size: 10px;margin-left:5px;"}),makeElement("img",b,{src:stripURI(omgIcon),width:"12",height:"12",style:"vertical-align:middle"}),b.appendChild(document.createTextNode(" WORST")))}}function isJobFight(b){return xpathFirst('.//div[@id="fight_opponents"]',b)?!0:!1}function isJobBoss(b){return xpathFirst('.//a[contains(@class,"attack_boss")]',b)?!0:!1}function isJobLocked(b){return(/lock/i.test(b.innerHTML.untag())||/complete/i.test(b.innerHTML.untag()))&&!/help/i.test(b.innerHTML.untag())}function customizeJobs(){try{colorDEBUG("customizeJobs",cpu);if(0>=currentJobTab())return!1;colorDEBUG("customizeJobs - jobPage TRUE",cpu);var b,c=!1;switch(city){case NY:b=$x('.//table[@class="job_list"]//td[contains(@class,"job_name") or contains(@class,"job_title")]',innerPageElt);if(!b||0==b.length)b=$x('.//div[@id="new_user_jobs"]//div[contains(@class, "job clearfix")]',innerPageElt),c=!0;break;case LV:b=$x('.//div[@id="map_panels"]//div[contains(@class,"job_info")]',innerPageElt);break;case BRAZIL:case CHICAGO:case LONDON:var a=xpathFirst('.//div[(@id="brazil_district_'+currentBrazilDistrict+'")]',innerPageElt);b=$x('.//div[contains(@id,"job-id")]',a);if(!b||0==b.length)b=$x('.//div[@id="brazil_jobs"]//div[contains(@id,"job-id")]',innerPageElt);break;default:return!1}if(!b||0==b.length)return!1;colorDEBUG("customizeJobs - jobTables FOUND",cpu);colorDEBUG("customizeJobs: Found "+b.length+" new "+cities[city][CITY_NAME]+" jobs in customize "+cities[city][CITY_NAME]+" jobs.",cgr);var d=eval("({0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{}})"),e=eval("({0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{}})");try{d=eval("("+GM_getValue("availableJobs")+")"),e=eval("("+GM_getValue("masteredJobs")+")")}catch(f){}var g=currentJobTab();d[city][g]=[];e[city][g]=[];for(var a=[],h=[],k=0,l=10,n=[],o=[],p=0,q=10,u=getSavedList("masteryJobsList"),A=0,v=0,w=0,G=b.length;w<G;w++){var y=b[w],F=!1,C=!1,r=!1,t=!1,O=energy,E=0;switch(city){case NY:if(c){var D=xpathFirst('.//div[@class="title_results"]//h3',y);if(!D)continue;if(c)var K=D.innerHTML.clean().trim()}else D=y,K=y.innerHTML.split("<br>")[0].clean().trim().untag();var K=K.replace(/ x(\d+).*/,""),B=getJobRow(K);if(!B)continue;break;case LV:D=xpathFirst('.//div[@class="job_title"]//h3',y);if(!D)continue;K=D.innerHTML.clean().trim().untag();break;case BRAZIL:case CHICAGO:case LONDON:D=xpathFirst('.//div[@class="job_details clearfix"]//h4',y);if(!D)continue;K=D.innerHTML.clean().trim().untag();break;default:return!1}var K=K.replace(/ x(\d+).*/,""),Q=missions.searchArray(K,0)[0];if(isNaN(Q))DEBUG("--\> jobInfo: "+K+" not found in missions array. ");else{v++;switch(city){case NY:if(c){var M=xpathFirst('.//div[@class="use_pay"]//dl[contains(.,"Uses")]',y),L=xpathFirst('.//div[@class="use_pay"]//dl[contains(.,"Pays")]',y),P=xpathFirst(".//a",y),J=getJobMastery(y,!0),z=xpathFirst('.//dd[@class="energy"]',M);z&&(E=parseCash(z.innerHTML))}else M=xpathFirst('.//td[contains(@class,"job_energy")]',B),L=xpathFirst('.//td[contains(@class,"job_reward")]',B),P=xpathFirst('.//td[contains(@class,"job_action")]',B),J=getJobMastery(B,!1),(z=xpathFirst('.//span[@class="bold_number"]',M))||(z=xpathFirst('.//span[@class="energy"]',M)),z&&(E=parseInt(z.innerHTML.untag()));break;case LV:M=xpathFirst('.//div[@class="job_uses"]',y);L=xpathFirst('.//div[@class="job_pays"]',y);P=xpathFirst('.//a[contains(@class,"sexy_button_new") and not(contains(.,"Ask"))]',y);J=getJobMastery(y,!0);(F=isJobFight(y))&&isGMChecked("skipfight")&&(t=!0);C=isJobBoss(y);F||C?(z=xpathFirst('.//dd[@class="stamina"]',M),O=stamina):z=xpathFirst('.//dd[@class="energy"]',M);z&&(E=parseInt(z.innerHTML.untag()));break;case BRAZIL:case CHICAGO:case LONDON:M=xpathFirst('.//ul[@class="uses clearfix"]',y);(z=xpathFirst('.//li[@class="energy"]',M))&&(z.hasAttribute("current_value")?E=parseInt(z.getAttribute("current_value")):z.hasAttribute("base_value")&&(E=parseInt(z.getAttribute("base_value"))));L=xpathFirst('.//ul[@class="pays clearfix"]',y);P=xpathFirst('.//a[contains(@id, "btn_dojob")]',y);J=getBrazilJobMastery(y);break;default:return!1}P&&isJobLocked(P)&&(r=!0);if(100==J||!E)0<u.length&&-1!=u.indexOf(""+Q)&&e[city][g].push(Q),A++,DEBUG("Job: '"+K+"' mastered ... skipping");if(!E||!z||E>O)r=!0,DEBUG("Job: '"+K+"' lacking stats ... skipping");t&&(r=!0,e[city][g].push(Q),A++,DEBUG("Job: '"+K+"' if Fight Job ... skipping"));C&&A<b.length-1&&(r=!0,DEBUG("Not all jobs are mastered yet, skip current boss job"));r||d[city][g].push(Q);var O=t=r=C=0,S=cities[city][CITY_CASH_SYMBOL],H,s,I;switch(city){case NY:(H=xpathFirst('.//span[@class="bold_number"]',L))||(H=xpathFirst('.//span[@class="experience"]',L));H||(H=xpathFirst('.//dd[@class="experience"]',L));H&&(C=parseInt(H.innerHTML),c||(H=z.parentNode,xpathFirst('.//span[@id="ratio_xp"]',H)||makeElement("br",H)));(s=xpathFirst('.//span[@class="money"]/strong',L))||(s=xpathFirst('.//strong[@class="money"]',L));s||(s=xpathFirst('.//dd[contains(@class,"cash cash")]',L));s&&(t=parseCash(s.innerHTML.untag()),c||(s=s.parentNode));I=c?H:z;break;case LV:if(H=xpathFirst('.//dd[@class="experience"]',L))C=parseInt(H.innerHTML),I=H;(s=xpathFirst('.//dd[contains(@class,"cash_icon")]',L))&&(t=parseCash(s.innerHTML.untag()));break;case BRAZIL:case CHICAGO:case LONDON:(H=xpathFirst('.//li[@class="experience"]',L))&&(C=parseInt(H.getAttribute("current_value")));(s=xpathFirst('.//li[contains(@class, "cash_icon_jobs")]',L))&&(t=parseCash(s.getAttribute("current_value")));I=H;break;default:return!1}if(z&&E&&(r=Math.round(100*(C/E))/100,!running))(I&&(xpathFirst('.//span[@id="ratio_xp"]',I)||makeElement("span",I,{id:"ratio_xp",style:"color:red; font-size: 10px;"}).appendChild(document.createTextNode(" ("+r+")"))),s&&(O=Math.round(t/E),0==O&&(O=Math.round(100*(t/E))/100),O=makeCommaValue(O),xpathFirst('.//span[@id="ratio_money"]',s)||makeElement("span",s,{id:"ratio_money",style:"color:red; font-size: 10px;"}).appendChild(document.createTextNode(" ("+S+" "+O+")"))),c&&(I=D),F)?(r>p?(p=r,n=[I]):r==p&&n.push(I),r<q)?(q=r,o=[I]):r==q&&o.push(I):(r>k?(k=r,a=[I]):r==k&&a.push(I),r<l)?(l=r,h=[I]):r==l&&h.push(I);updateJobInfo(Q,E,C,r)}}running||(highlightJobs(l,k,a,h),n&&highlightJobs(l,k,n,o));GM_setValue("availableJobs",JSON.stringify(d));GM_setValue("masteredJobs",JSON.stringify(e));switch(city){case NY:c?jobMastery(innerPageElt,!0):jobMastery(innerPageElt,!1);break;case LV:case BRAZIL:case CHICAGO:case LONDON:jobMastery(innerPageElt,!0);break;default:return!1}tierMastery(v,A,g);return!0}catch(N){colorDEBUG("customizeJobs: "+N)}}function updateJobInfo(b,c,a,d){var e=missions[b];if(!isNaN(b)&&(e[MISSION_ENERGY]!=c||e[MISSION_XP]!=a||e[MISSION_RATIO]!=d))missions[b][MISSION_ENERGY]=c,missions[b][MISSION_XP]=a,missions[b][MISSION_RATIO]=d,GM_setValue("missions",JSON.stringify(missions))}function tierMastery(b,c,a){if(running&&"0.0"!=GM_getValue("selectTier","0.0")&&(selectedTierValue=GM_getValue("selectTier","0.0").split("."),masteryCity=parseInt(selectedTierValue[0]),masteryTier=parseInt(selectedTierValue[1]),city==masteryCity&&masteryTier==a&&b<=c)){selectTier=cities[masteryCity][0]+" - "+missionTabs[masteryCity][masteryTier-1];addToLog("info Icon","Tier "+selectTier+" is already mastered. Moving on to the next tier.");if(missionTabs[masteryCity].length<=masteryTier)if(cities.length<masteryCity)GM_setValue("selectTier","0.0");else{for(masteryCity++;level<cities[masteryCity][CITY_LEVEL]&&cities.length>masteryCity;){masteryCity++;if(cities.length<=masteryCity){DEBUG("We are out of cities to check so turning off mastery ");GM_setValue("selectTier","0.0");return}DEBUG(cities[masteryCity-1][CITY_NAME]+" Unavailable, Checking "+cities[masteryCity][CITY_NAME])}masteryTier=1}else masteryTier++,isNewCity(city)&&(b=missions.filter(function(a,b,c){return c[b][MISSION_CITY]==masteryCity&&c[b][MISSION_TAB]==masteryTier}),b[0][MISSION_TABPATH]&&(masteryTier=b[0][MISSION_TABPATH]));if("0.0"!=GM_getValue("selectTier","0.0")){b=[];i=0;for(iLength=missions.length;i<iLength;i++)masteryCity==missions[i][MISSION_CITY]&&masteryTier==missions[i][MISSION_TAB]&&b.push(i);setSavedList("masteryJobsList",b);GM_setValue("selectTier",masteryCity+"."+masteryTier)}}}function customizeFightLists(){if(running||!onHitlistTab()&&!onFightTab()&&!onBattlePage(2))return!0;var b=getDisplayedOpponents(innerPageElt,!0,getStaminaMode());if(!b)return!0;for(var c=hitmanListAvoid.get().concat(fightListAvoid.get()),a=getSavedList("hitmanListKilled"),d=0,e=b.length;d<e;++d){var f=b[d];if(f.profile){var g,h;-1!=c.indexOf(f.id)&&(h=f.profile.parentNode,g=makeElement("img",null,{src:stripURI(omgIcon),width:"12",height:"12",style:"vertical-align:middle",title:"You have already lost to this opponent during automatic play."}),h.insertBefore(g,h.firstChild));-1!=a.indexOf(f.id)&&(h=f.profile.parentNode,g=makeElement("img",null,{src:stripURI(lootbagIcon),width:"12",height:"12",style:"vertical-align:middle",title:"You have already collected a bounty on this target during automatic play."}),h.insertBefore(g,h.firstChild))}}return!0}function setLevelUpRatioStats(){var b=document.getElementById("level_up_ratio_stats");if(b){var c="Level Up Ratio's: ";if(stamina||energy){var a=Math.ceil(100*(ptsToNextLevel/(energy+stamina)))/100,c=c+("Combined: "+(25<a?"> 25":a)+"x");if(energy)var d=Math.ceil(100*(ptsToNextLevel/energy))/100,c=c+(" | Energy: "+(25<d?"> 25":d)+"x");stamina&&(d=Math.ceil(100*(ptsToNextLevel/stamina))/100,c+=" | Stamina: "+(25<d?"> 25":d)+"x")}b.innerHTML=c;b.style.display=a?"block":"none"}if(!isGMChecked("noStats")){c=getStaminaGainRate();if(b=xpathFirst('.//div[@id="expRate"]'))b.firstChild.nodeValue=c.toFixed(2);if(b=xpathFirst('.//div[@id="expToNext"]'))b.firstChild.nodeValue=makeCommaValue(ptsToNextLevel);if(b=xpathFirst('.//div[@id="stamToNext"]'))b.firstChild.nodeValue=c?(ptsToNextLevel/c).toFixed(0):"n/a"}}function clickFightListAdd(){addSavedListItem("pfightlist",this.id);this.firstChild.nodeValue="Remove from Fight List";this.removeEventListener("click",clickFightListAdd,!1);this.addEventListener("click",clickFightListRemove,!1);var b=document.getElementById("pfightlist");b&&(b.value=GM_getValue("pfightlist",""))}function clickFightListRemove(){for(;removeSavedListItem("pfightlist",this.id);)this.firstChild.nodeValue="Add to Fight List";this.removeEventListener("click",clickFightListRemove,!1);this.addEventListener("click",clickFightListAdd,!1);var b=document.getElementById("pfightlist");b&&(b.value=GM_getValue("pfightlist",""))}function clickAutoHitListAdd(){addSavedListItem("pautoHitOpponentList",this.id);this.firstChild.nodeValue="Remove from AutoHit List";this.removeEventListener("click",clickAutoHitListAdd,!1);this.addEventListener("click",clickAutoHitListRemove,!1);var b=document.getElementById("pautoHitOpponentList");b&&(b.value=GM_getValue("pautoHitOpponentList",""))}function clickAutoHitListRemove(){for(;removeSavedListItem("pautoHitOpponentList",this.id);)this.firstChild.nodeValue="Add to AutoHit List";this.removeEventListener("click",clickAutoHitListRemove,!1);this.addEventListener("click",clickAutoHitListAdd,!1);var b=document.getElementById("pautoHitOpponentList");b&&(b.value=GM_getValue("pautoHitOpponentList",""))}function clickWarListAdd(){addSavedListItem("autoWarTargetList",this.id);this.firstChild.nodeValue="Remove from War List";this.removeEventListener("click",clickWarListAdd,!1);this.addEventListener("click",clickWarListRemove,!1);var b=document.getElementById("autoWarTargetList");b&&(b.value=GM_getValue("autoWarTargetList",""))}function clickWarListRemove(){for(;removeSavedListItem("autoWarTargetList",this.id);)this.firstChild.nodeValue="Add to War List";this.removeEventListener("click",clickWarListRemove,!1);this.addEventListener("click",clickWarListAdd,!1);var b=document.getElementById("autoWarTargetList");b&&(b.value=GM_getValue("autoWarTargetList",""))}function getJobRow(b,c){c||(c=innerPageElt);var a,d="",e=0;try{var f=missions.searchArray(b,0)[0];if(!isNaN(f)){var g=missions[f][MISSION_NUMBER];(a=xpathFirst('.//table[@class="job_list"]//a[contains(@onclick, "job='+g+'&")]',c))||(a=xpathFirst('.//table[@class="job_list"]//a[contains(@href, "job='+g+'&")]',c));!a&&city==LV&&(a=xpathFirst('.//div[@id="job'+g+'"]',c),e=1)}var h=xpathFirst('.//a[contains(@onclick, "MapController.buyItems('+g+'); return false;")]');h&&(DEBUG("Cheating on buying for now found a link to click - - jobno="+g),clickElement(h),addToLog("info Icon","Buying necessary items to be able to perform: '"+missions[f][MISSION_NAME]+"'."));if(!a){for(var k=b.replace(/"/g," ").replace(/'/g," ").split(" "),f=0;f<k.length;++f)1<k[f].length&&(0<d.length&&(d+=" and "),d+='contains(., "'+k[f]+'")');a=xpathFirst('.//table[@class="job_list"]//tr//td['+d+"]",c)}if(a&&!e)for(;"TR"!=a.tagName;)a=a.parentNode;a||(a=xpathFirst('.//div[@id="new_user_jobs"]//div[contains(@class, "job clearfix") and '+d+"]",c));a||((a=xpathFirst('.//div[@class="job"]//a[contains(@href,"job='+g+'&")]',c))||(a=xpathFirst('.//div[@id="job-id-'+g+'"]//a[contains(@href,"job='+g+'&")]',c)),a&&(a=a.parentNode.parentNode))}catch(l){DEBUG("BUG DETECTED (getJobRow): [exception: "+l+"], [conTxt: "+d+"], [jobName: "+b+"]")}return!a?(colorDEBUG("getJobRow: "+b+" - NO ROWELT FOUND - RETURNING FALSE",cre),!1):a}function getJobRowItems(b){try{var c=getJobRow(b,innerPageElt);if(!c)return!1;if((innerPageElt?innerPageElt.innerHTML:"").untag().match(/You do not have enough cash to buy/i)){addToLog("warning Icon","You don't have enough cash to buy necessary equipment.");var a=getSavedList("jobsToDo","");return-1==a.indexOf(b)?(a.push(b),DEBUG("Saving "+b+" for later. Need to farm cash first."),setSavedList("jobsToDo",a),!0):!1}var d=$x('.//a[contains(@onclick, "xw_action=buy_item")]',c);d||(d=$x('.//a[contains(@onclick, "MapController.buyItems")]',c));if(0<d.length){addToLog("search Icon","Attempting to purchase required items.");for(var e=0,f=d.length;e<f;){Autoplay.fx=function(){clickAction="buy item";clickElement(d[e]);DEBUG("Clicked to buy item.")};break}return!0}if(isGMChecked("autoWithDraw")){var g=xpathFirst('.//strong[@class="cash cash_'+cities[city][CITY_ALIAS]+'"]',c);g||(g=xpathFirst('.//div[@class="job_uses"]//dd[contains(@class,"cash_icon")]',c));if(g){var h=parseCash(g.innerHTML.untag().trim())-cities[city][CITY_CASH];if(0<h)return DEBUG("We need "+h+" for this job. Going to the bank/vault of "+city),suspendBank=!0,autoBankWithdraw(h)}}var k=$x('.//div[@class="req_item"]//img',c);if(0<k.length){DEBUG("Some Items Required for this job - req_item");var l=getSavedList("itemList"),a=getSavedList("jobsToDo","");-1==a.indexOf(b)&&(a.push(b),DEBUG("Saving "+b+" for later. Need to fetch pre-req items first."),setSavedList("jobsToDo",a));var n=!1;k.forEach(function(b){var c=b.alt,c=c.replace(/set of/i,""),c=c.replace(/\[(.+?)\]/i,""),c=c.trim();DEBUG(c);var d=false;requirementJob.forEach(function(b){if(level>=cities[b[2]][CITY_LEVEL]&&b[0].toUpperCase().trim()==c.toUpperCase().trim()){a.push(b[1]);l.push(c);d=true}});d?n=true:DEBUG(c+" not found in the requirement job array.")});if(n)return setSavedList("itemList",l.unique()),setSavedList("jobsToDo",a),popJob(),!0}else{k=xpathFirst('.//span[@class="missing_req_items"]',c);itmSearch="";if(k)DEBUG("Some Items Required for this job - missing_req_items"),itmSearch=k.innerHTML,itmSearch.match(/(.+?),/i)&&(itmSearch=RegExp.$1),DEBUG("Missing Item: "+itmSearch),itmSearch=itmSearch.replace(/\(.+?\)/gi,"").trim(),DEBUG("Parsed Missing Item: "+itmSearch);else if((k=xpathFirst('.//div[@class="needed_gate_loot_container"]',c))||(k=xpathFirst('.//div[@class="needed_gate_loot"]',c)),k){DEBUG("Some Items Required for this job - needed_gate_loot");messages=$x(".//img",k);numMessages=messages.length;for(e=0;e<numMessages;e++){var o=messages[e].title;o.match(/Gift this/i)||(itmSearch=""==itmSearch?o:itmSearch+", "+o)}DEBUG("Missing Item(s): "+itmSearch)}if(""!=itmSearch){DEBUG("Item(s) Required for this job : "+itmSearch);l=getSavedList("itemList");a=getSavedList("jobsToDo","");DEBUG("Current Job List: "+a);-1==a.indexOf(b)?(a.push(b),DEBUG("Saving "+b+" for later. Need to fetch pre-req items first."),setSavedList("jobsToDo",a)):DEBUG(b+" already saved for later. Need to fetch pre-req items first.");var p=!1;requirementJob.forEach(function(b){if(level>=cities[b[2]][CITY_LEVEL]&&b[0].toUpperCase().trim()==itmSearch.toUpperCase().trim()){a.push(b[1]);l.push(itmSearch.trim());p=true;jobFound=b[1]}});if(p)return setSavedList("itemList",l.unique()),setSavedList("jobsToDo",a),popJob(),!0;DEBUG(itmSearch+" not found in the requirement job array.")}}if(g=xpathFirst('.//td[contains(@class,"job_energy")]//span[@class="money" or @class="bad"]',c))if(h=parseCash(g.innerHTML)-cities[city][CITY_CASH],0<h)return suspendBank=!0,autoBankWithdraw(h);return!1}catch(q){DEBUG("getJobRowItems Error :"+q)}}function popJob(){var b=getSavedList("jobsToDo",""),c=b.pop();setSavedList("jobsToDo",b);var a=0;missions.forEach(function(b){b[0].toUpperCase().trim()==c.toUpperCase().trim()&&(GM_setValue("selectMission",a),addToLog("info Icon",'Switching job to <span class="job">'+c+"</span> (popJob)."));a++})}function jobCombo(){var b,c=eval("("+GM_getValue("availableJobs","{0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{}}")+")"),a=getSavedList("selectMissionMultiple"),d={};b=0;for(iLength=a.length;b<iLength;++b){var e=a[b],f=missions[e];f&&(null!=c[f[MISSION_CITY]][f[MISSION_TAB]]&&-1==c[f[MISSION_CITY]][f[MISSION_TAB]].indexOf(parseInt(e))&&(f[MISSION_RATIO]=0),null==d[f[MISSION_RATIO]]&&(d[f[MISSION_RATIO]]=[]),d[f[MISSION_RATIO]].push(a[b]))}a=[];for(b in d)if(1<d[b].length){missions[GM_getValue("selectMission",1)][MISSION_RATIO]==b&&d[b].push(d[b].shift());c=0;for(e=d[b].length;c<e;++c)a.push(d[b][c])}else a.push(d[b][0]);setSavedList("selectMissionMultiple",a)}function jobLoot(b){var c,a=[],d="",e="",f=$x('.//td[class="message_body"]',b),g=f.length;for(c=1;c<g;c++){var h=f[c].innerHTML.untag();if(h.match(/you\s+?gained:\s+?an?\s+?(.+)\./i)||h.match(/you\s+gained(?:\s+an?)?\s+(.+)\./i)||h.match(/found(?:\s+an?)?\s+(.*?)\s+on\s+the/i)||h.match(/earned(?:\s+an?)?\s+(.*?)\.\s+you\s+/i))h=RegExp.$1,h.match(/(.+?)\s+?was(.+?)(\d+)/i)?h=RegExp.$1+" x "+RegExp.$3:h.match(/(.+?)\s+?(\.|-)?\s+?used?(.+?)(\d+)/i)&&(h=RegExp.$1+" x "+RegExp.$4),d=d?d+('<br/>Found <span class="loot">'+h+"</span> in the job."):'Found <span class="loot">'+h+"</span> in the job.",a.push(h)}0<g&&""!=d&&addToLog("lootbag Icon",d);if(city==NY||city==CUBA){f=$x('.//dd[@class="message_item"]',b);g=f.length;for(c=0;c<g;c++)h=f[c].innerHTML.untag(),-1==h.indexOf("remaining")?(d=d?d+('<br/>Found <span class="loot">'+h+"</span> in the job."):'Found <span class="loot">'+h+"</span> in the job.",a.push(h)):e=e?e+('<br/>You used <span class="loot">'+h+"</span> in the job."):'You used <span class="loot">'+h+"</span> in the job.";0<g&&""!=d&&addToLog("lootbag Icon",d);0<g&&""!=e&&addToLog("lootbag Icon",e)}if(city==LV){c=xpathFirst('.//div[@class="job_results"]',b);d="";f=$x(".//img",c);g=f.length;for(c=0;c<g;c++)f[c].title&&(h=f[c].title,b=f[c].parentNode.innerHTML.untag(),b.match(/(\d+)/)&&(b=" x "+RegExp.$1),h.match(/(.+?)(\.|-)?\s+?(was|used?)/i)&&(h=RegExp.$1),d=d?d+('<br/>Found <span class="loot">'+h+" "+b+"</span> in the job."):'Found <span class="loot">'+h+" "+b+"</span> in the job.",a.push(h));0<g&&""!=d&&addToLog("lootbag Icon",d)}d=getSavedList("itemList");if("undefined"==typeof d[0]||0==d.length)DEBUG("No items in required item list.");else for(;f=a.pop();){DEBUG("Looking for "+f+" in needed items list. We need "+d.length+" item(s).");for(c=0;c<d.length;c++)if(-1!=f.indexOf(d[c].trim()))return DEBUG('<span class="loot">'+f+"</span> is the item we were looking for!"),removeSavedListItem("itemList",f),removeJobForItem("jobsToDo",f),popJob(),!0}}function debugDumpSettings(){try{var b=function(a){for(var a=getSavedList(a),b=[],c=0,d=a.length;c<d;++c)b.push(missions[a[c]][MISSION_NAME]);return b.join(", ")}("selectMissionMultiple"),c="None";"0.0"!=GM_getValue("selectTier","0.0")&&(selectedTierValue=GM_getValue("selectTier","0.0").split("."),c=cities[parseInt(selectedTierValue[0])][0]+" - "+missionTabs[NY][parseInt(selectedTierValue[1])-1]);"en"!=GM_getValue("language","en")&&(DEBUG('Language is "'+GM_getValue("language","undefined")+'".'),addToLog("warning Icon","Unfortunately, only the English version of the game is fully supported. If you experience problems, set your Facebook language to English and try again."));var a={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].subString)!=-1)return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(b!=-1)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};a.init();getBrowserWindowSize();var d="PRO PLAYER";1!=parseXMLResponse()&&(d="LITE PLAYER");var e="-  -  -  -  -  BEGIN SETTINGS DUMP  -  -  -  -  -<br>------------------ End-User System -------------------<br>Browser Name: <strong>"+a.browser+"</strong><br>Browser Version: <strong>"+a.version+"</strong><br>Operating System: <strong>"+a.OS+"</strong><br>New Layout: <strong>"+new_header+"</strong><br>Browser Window Size: <strong>"+winW+" / "+winH+"</strong><br>------------------ RX6 MWAP Settings---------------------<br>Script Version: <strong>"+SCRIPT.version+" "+d+"</strong><br>Language: <strong>"+GM_getValue("language")+"</strong><br>isRunning: <strong>"+running+"</strong><br>Player current level: <strong>"+level+"</strong><br>Player points to next level: <strong>"+ptsToNextLevel+"</strong><br>Player mafia size: <strong>"+mafia+"</strong><br>Player attack profile: <strong>"+curAttack+"</strong><br>Player defense profile: <strong>"+curDefense+"</strong><br>Player attack equip: <strong>"+curAttackEquip+"</strong><br>Player defense equip: <strong>"+curDefenseEquip+"</strong><br>Player health: <strong>"+health+"/"+maxHealth+"</strong><br>Player energy: <strong>"+energy+"/"+maxEnergy+"</strong><br>Player stamina: <strong>"+stamina+"/"+maxStamina+"</strong><br>Player skill points: <strong>"+stats+"</strong><br>Energy pack waiting? <strong>"+energyPack+"</strong><br>Current location: <strong>"+cities[city][CITY_NAME]+"</strong><br>";i=0;for(iLength=cities.length;i<iLength;i++)dumpText=isUndefined(cities[i][CITY_CASH])?"unknown":cities[i][CITY_CASH_SYMBOL]+makeCommaValue(cities[i][CITY_CASH]),e+=cities[i][CITY_NAME]+" cash: <strong>"+dumpText+"</strong><br>";e+="-------------------General Tab--------------------------<br>Standard MWAP Speed: <strong>"+GM_getValue("fastMWAPSpeed")+"</strong><br>Enable auto-pause: <strong>"+showIfUnchecked(GM_getValue("autoPause"))+"</strong><br>  -After level up: <strong>"+showIfSelected(GM_getValue("autoPauseAfter"))+"</strong><br>  -Before level up: <strong>"+showIfSelected(GM_getValue("autoPauseBefore"))+"</strong><br>  -Exp to pause at: <strong>"+GM_getValue("autoPauseExp")+"</strong><br>  -Exp to pause at: <strong>"+GM_getValue("autoPauseExp")+"</strong><br>Idle in Selected city: <strong>"+cities[GM_getValue("idleLocation",NY)][CITY_NAME]+"</strong><br>Prioritise Energy / Stamina burning: <strong>"+burnModes[GM_getValue("burnOption")]+"</strong><br>Popup Processing: <strong>"+showIfUnchecked(GM_getValue("autoProcessPopups"))+"</strong><br>---------------------Display Tab--------------------<br>Show Text Labels: <strong>"+showIfUnchecked(GM_getValue("textOnlyMode"))+"</strong><br>Enable logging: <strong>"+showIfUnchecked(GM_getValue("autoLog"))+"</strong><br>  -Logging length: <strong>"+GM_getValue("autoLogLength")+"</strong><br>Enable log filtering: <strong>"+showIfUnchecked(GM_getValue("filterLog"))+"</strong><br>  Filter mode: <strong>"+GM_getValue("filterOpt")+"</strong><br>  Filter pass: <strong>"+GM_getValue("filterPass")+"</strong><br>  Filter fail: <strong>"+GM_getValue("filterFail")+"</strong><br>Left-align main frame: <strong>"+showIfUnchecked(GM_getValue("leftAlign"))+"</strong><br>Elevate RX6 MWAP-Header: <strong>"+showIfUnchecked(GM_getValue("mastheadOnTop"))+"</strong><br>Hide All: <strong>"+showIfUnchecked(GM_getValue("hideAll"))+"</strong><br>Show pulse on the fight page: <strong>"+showIfUnchecked(GM_getValue("showPulse"))+"</strong><br>Show level on the hitlist page: <strong>"+showIfUnchecked(GM_getValue("showLevel"))+"</strong><br>Set window title to name on Facebook account: <strong>"+showIfUnchecked(GM_getValue("fbwindowtitle"))+"</strong><br>---------------------Mafia Tab--------------------<br>Automatically asks for job help: <strong>"+showIfUnchecked(GM_getValue("autoAskJobHelp"))+"</strong><br>Minimum experience for job help: <strong>"+GM_getValue("autoAskJobHelpMinExp")+"</strong><br>Ask for Vegas help: <strong>"+GM_getValue("selectVegasTier")+"</strong><br>Ask for Brazil help: <strong>"+GM_getValue("selectBrazilTier")+"</strong><br>Ask for Chicago help: <strong>"+GM_getValue("selectChicagoTier")+"</strong><br>Ask for London help: <strong>"+GM_getValue("selectLondonTier")+"</strong><br>Process and Log Player Updates: <strong>"+showIfUnchecked(GM_getValue("logPlayerUpdates"))+"</strong><br>Miscellaneous publishing: <br>  Enable FB Wall Publishing: <strong>"+showIfUnchecked(GM_getValue("autoGlobalPublishing"))+"</strong><br>  Ice bonus: <strong>"+showIfUnchecked(GM_getValue("autoIcePublish"))+"</strong><br>  Ice bonus Frequency: <strong>"+GM_getValue("autoIcePublishFrequency")+"</strong><br>  Automatically share wishlist: <strong>"+showIfUnchecked(GM_getValue("autoShareWishlist"))+"</strong><br>  Hour interval for sharing wishlist: <strong>"+GM_getValue("autoShareWishlistTime")+"</strong><br>Accept mafia invitations: <strong>"+showIfUnchecked(GM_getValue("acceptMafiaInvitations"))+"</strong><br>Automatically ask to Join City Crew: <strong>"+showIfUnchecked(GM_getValue("autoAskCityCrew"))+"</strong><br>Message Center : Auto Accept Gifts: <strong>"+showIfUnchecked(GM_getValue("autoAcceptMsgGifts"))+"</strong><br>Message Center : Auto Accept Boosts: <strong>"+showIfUnchecked(GM_getValue("autoAcceptMsgBoosts"))+"</strong><br>Message Center : Auto Accept Crew: <strong>"+showIfUnchecked(GM_getValue("autoAcceptMsgCrew"))+"</strong><br>Message Center : Auto Send Eneryg: <strong>"+showIfUnchecked(GM_getValue("autosendMsgEnergyPack"))+"</strong><br>War Mode: <strong>"+warModeChoices[GM_getValue("warMode",0)]+"</strong><br>  Auto War Target List: <strong>"+GM_getValue("autoWarTargetList",0)+"</strong><br>-----------------Family-----------------<br>Enable Personal Operations: <strong>"+showIfUnchecked(GM_getValue("autoStartMyOps"))+"</strong><br>  -Check My Operations Timer: "+getHoursTime("myOpsTimer")+"</strong><br>Enable Family Operations: <strong>"+showIfUnchecked(GM_getValue("autoStartFamOps"))+"</strong><br>  -Check Family Operations Timer: "+getHoursTime("famOpsTimer")+"</strong><br>";1==parseXMLResponse()&&(e+="Enable Auto Family Rewards Collect: <strong>"+showIfUnchecked(GM_getValue("AutoFamilyRewards"))+"</strong><br>Enable Family Bosses : <strong>"+showIfUnchecked(GM_getValue("autoFamilyBosses"))+"</strong><br>Enable Family Bosses - Fighting: <strong>"+showIfUnchecked(GM_getValue("autoFamilyBossFighting"))+"</strong><br>Enable Family Bosses - Role: <strong>"+bossRoles[GM_getValue("bossRole",0)]+"</strong><br>Enable Family Bosses - Stamina: <strong>"+bossStaminaLimits[GM_getValue("bossStaminaLimit",0)]+"</strong><br>Enable Family Bosses - Rage: <strong>"+GM_getValue("bossRageLimit",0)+"</strong><br>Enable Family Bosses - send Boosts: <strong>"+showIfUnchecked(GM_getValue("sendBossFightBoosts"))+"</strong><br>Enable Family Bosses - ask Boosts: <strong>"+showIfUnchecked(GM_getValue("askBossFightBoosts"))+"</strong><br>Enable AutoBattle Fighting: <strong>"+showIfUnchecked(GM_getValue("AutoBattleFight"))+"</strong><br>Enable Battle Safehouse Attacking: <strong>"+showIfUnchecked(GM_getValue("AutoBattleSafehouse"))+"</strong><br>Enable AutoBattle (GF only): <strong>"+showIfUnchecked(GM_getValue("AutoBattle"))+"</strong><br>Enable AutoBattle clanID: <strong>"+GM_getValue("AutoBattleClanID",0)+"</strong><br>Enable Auto Free Gifting: Item no <strong>"+GM_getIntValue("selectFreeGift",0)+"</strong><br>Enable Asking for uto Free Gifts: Item no <strong>"+GM_getIntValue("selectAskFreeGift",0)+"</strong><br>");e+="-------------------Autostat Tab--------------------<br>Enable auto-stat: <strong>"+showIfUnchecked(GM_getValue("autoStat"))+"</strong><br>Disable auto-stat: <strong>"+showIfUnchecked(GM_getValue("autoStatDisable"))+"</strong><br>  -Attack Base: <strong>"+GM_getValue("autoStatAttackBase")+"</strong><br>  -Defense Base: <strong>"+GM_getValue("autoStatDefenseBase")+"</strong><br>  -Health Base: <strong>"+GM_getValue("autoStatHealthBase")+"</strong><br>  -Energy Base: <strong>"+GM_getValue("autoStatEnergyBase")+"</strong><br>  -Stamina Base: <strong>"+GM_getValue("autoStatStaminaBase")+"</strong><br>  -Attack Ratio: <strong>"+GM_getValue("autoStatAttackRatio")+"</strong><br>  -Defense Ratio: <strong>"+GM_getValue("autoStatDefenseRatio")+"</strong><br>  -Health Ratio: <strong>"+GM_getValue("autoStatHealthRatio")+"</strong><br>  -Energy Ratio: <strong>"+GM_getValue("autoStatEnergyRatio")+"</strong><br>  -Stamina Ratio: <strong>"+GM_getValue("autoStatStaminaRatio")+"</strong><br>  -Attack Mode: <strong>"+GM_getValue("autoStatAttackMode")+"</strong><br>  -Defense Mode: <strong>"+GM_getValue("autoStatDefenseMode")+"</strong><br>  -Health Mode: <strong>"+GM_getValue("autoStatHealthMode")+"</strong><br>  -Energy Mode: <strong>"+GM_getValue("autoStatEnergyMode")+"</strong><br>  -Stamina Mode: <strong>"+GM_getValue("autoStatStaminaMode")+"</strong><br>  -Attack Prio: <strong>"+GM_getValue("autoStatAttackPrio")+"</strong><br>  -Defense Prio: <strong>"+GM_getValue("autoStatDefensePrio")+"</strong><br>  -Health Prio: <strong>"+GM_getValue("autoStatHealthPrio")+"</strong><br>  -Energy Prio: <strong>"+GM_getValue("autoStatEnergyPrio")+"</strong><br>  -Stamina Prio: <strong>"+GM_getValue("autoStatStaminaPrio")+"</strong><br>  -Attack Fallback: <strong>"+GM_getValue("autoStatAttackFallback")+"</strong><br>  -Defense Fallback: <strong>"+GM_getValue("autoStatDefenseFallback")+"</strong><br>  -Health Fallback: <strong>"+GM_getValue("autoStatHealthFallback")+"</strong><br>  -Energy Fallback: <strong>"+GM_getValue("autoStatEnergyFallback")+"</strong><br>  -Stamina Fallback: <strong>"+GM_getValue("autoStatStaminaFallback")+"</strong><br>  -Rest AutoStat: <strong>"+GM_getValue("restAutoStat")+"</strong><br>  -Next Stat: <strong>"+GM_getValue("nextStat")+"</strong><br>-------------------Energy Tab--------------------<br>Enable auto-mission: <strong>"+showIfUnchecked(GM_getValue("autoMission"))+"</strong><br>  -Repeat Job: <strong>"+showIfUnchecked(GM_getValue("repeatJob"))+"</strong><br>  -Job selected: <strong>"+missions[GM_getValue("selectMission")][MISSION_NAME]+"</strong><br>    -Jobs: <strong>"+b+"</strong><br>    -Mastery Tier: <strong>"+c+"</strong><br>    -Optimize at end level: <strong>"+showIfUnchecked(GM_getValue("endLevelOptimize"))+"</strong><br>    -Optimize at end level NY Only: <strong>"+showIfUnchecked(GM_getValue("endLevelNYOnly"))+"</strong><br>    -Force Autowithdraw: <strong>"+showIfUnchecked(GM_getValue("autoWithDraw"))+"</strong><br>Enable Boss Fights: <strong>"+showIfUnchecked(GM_getValue("autoFightAgostino"))+"</strong><br>Skip Fighting In Job Tier Mastery: <strong>"+showIfUnchecked(GM_getValue("skipfight"))+"</strong><br>Check for mini Energy Packs: <strong>"+showIfUnchecked(GM_getValue("checkMiniPack"))+"</strong><br>Enable auto-energy pack: <strong>"+showIfUnchecked(GM_getValue("autoEnergyPack"))+"</strong><br>  - Estimated job ratio: <strong>"+GM_getValue("estimateJobRatio")+"</strong><br>  - autoEnergyPackForcePts: <strong>"+GM_getValue("autoEnergyPackForcePts")+"</strong><br>Energy threshold: <strong>"+GM_getValue("selectEnergyUse")+" "+numberSchemes[GM_getValue("selectEnergyUseMode",0)]+" (refill to "+SpendEnergy.ceiling+")</strong><br>Energy reserve: <strong>"+ +GM_getValue("selectEnergyKeep")+" "+numberSchemes[GM_getValue("selectEnergyKeepMode",0)]+" (keep above "+SpendEnergy.floor+")</strong><br>  -Energy use started: <strong>"+GM_getValue("useEnergyStarted")+"</strong><br>  Ignore reserve to level-up: <strong>"+showIfUnchecked(GM_getValue("allowEnergyToLevelUp"))+"</strong><br>Mission Energy reserve: <strong>"+ +GM_getValue("selectMissionEnergyKeep")+" "+numberSchemes[GM_getValue("selectMissionEnergyKeepMode",0)]+" (keep above "+SpendMissionEnergy.floor+")</strong><br>  Ignore reserve to level-up: <strong>"+showIfUnchecked(GM_getValue("allowMissionEnergyToLevelUp"))+"</strong><br>-------------------Stamina Tab-------------------<br>Spend stamina: <strong>"+showIfUnchecked(GM_getValue("staminaSpend"))+"</strong><br>Log Details: <strong>"+showIfUnchecked(GM_getValue("staminaLogDetails"))+"</strong><br>How: <strong>"+staminaSpendChoices[GM_getValue("staminaSpendHow",0)]+"</strong><br>  Fast Rob?: <strong>"+showIfUnchecked(GM_getValue("fastrob"))+"</strong><br>  Use Burners?: <strong>"+showIfUnchecked(GM_getValue("useBurners"))+"</strong><br>  Use Rob Squads?: <strong>"+showIfUnchecked(GM_getValue("useRobSquads"))+"</strong><br>  RobFight StaminaFloor?: <strong>"+GM_getValue("robFightStaminaFloor")+"</strong><br>  Skip iced targets: <strong>"+showIfUnchecked(GM_getValue("iceCheck"))+"</strong><br>  -Fight in: <strong>"+fightLocations[GM_getValue("fightLocation",0)]+"</strong><br>  -Reattack threshold:<strong>"+GM_getValue("reattackThreshold")+"</strong><br>  -Powerattack <strong>"+showIfUnchecked(GM_getValue("staminaPowerattack"))+"</strong><br>  -Max Number of Attacks per Opponent: <strong>"+GM_getValue("fightMaxAttacks")+")</strong><br>  -Random fight max level: <strong>"+GM_getValue("fightLevelMax")+" ("+showIfRelative("fightLevelMaxRelative")+")</strong><br>  -Random fight max mafia: <strong>"+GM_getValue("fightMafiaMax")+" ("+showIfRelative("fightMafiaMaxRelative")+")</strong><br>  -Random fight min mafia: <strong>"+GM_getValue("fightMafiaMin")+" ("+showIfRelative("fightMafiaMinRelative")+")</strong><br>  -Random fight max health: <strong>"+GM_getValue("fightHealthMax")+")</strong><br>  -Random fight max health pct: <strong>"+GM_getValue("fightHealthPctMax")+")</strong><br>  -Fight Labels: <strong>"+fightLabels[GM_getValue("fightLabelCriteria",0)]+"</strong><br>  -Random fight use Patterns: <strong>"+showIfUnchecked(GM_getValue("fightNames"))+"</strong><br>  -Random fight avoid names: <strong>"+showIfUnchecked(GM_getValue("fightAvoidNames"))+"</strong><br>  -Random fight specific names: <strong>"+showIfUnchecked(GM_getValue("fightOnlyNames"))+"</strong><br>Families list: <strong>"+encodeURI(GM_getValue("fightClanName"))+"</strong><br>  -List fight opponents: <strong>"+GM_getValue("pfightlist")+"</strong><br>  -List fight remove stronger: <strong>"+showIfUnchecked(GM_getValue("fightRemoveStronger"))+"</strong><br>  -List fight fightlist fallback: <strong>"+showIfUnchecked(GM_getValue("fightFallback"))+"</strong><br>  -Collect hitman bounties in: <strong>"+locations[GM_getValue("hitmanLocation",0)]+"</strong><br>  -Hitman min bounty: <strong>"+parseCash(GM_getValue("hitmanBountyMin"))+"</strong><br>  -Hitman bounty selection: <strong>"+bountySelectionChoices[GM_getValue("bountySelection")]+"</strong><br>  -Hitman use Patterns: <strong>"+showIfUnchecked(GM_getValue("hitmanNames"))+"</strong><br>  -Hitman avoid names: <strong>"+showIfUnchecked(GM_getValue("hitmanAvoidNames"))+"</strong><br>  -Hitman specific names: <strong>"+showIfUnchecked(GM_getValue("hitmanOnlyNames"))+"</strong><br>Families list: <strong>"+encodeURI(GM_getValue("hitmanClanName"))+"</strong><br>  -Rob in: <strong>"+locations[GM_getValue("robLocation",NY)]+"</strong><br>  -AutoHit bounty: <strong>"+parseCash(GM_getValue("autoHitListBounty"))+"</strong><br>  -Set Bounties in: <strong>"+locations[GM_getValue("autoHitListLoc",0)]+"</strong><br>  -Random <strong>"+showIfUnchecked(GM_getValue("autoHitListRandom"))+"</strong><br>  -AutoHit opponents: <strong>"+GM_getValue("pautoHitOpponentList")+"</strong><br>  -AutoHit background: <strong>"+showIfUnchecked(GM_getValue("bgAutoHitCheck"))+"</strong><br>  -Random Stam Spend - Fight in: <strong>"+GM_getValue("randomFightLocations")+"</strong><br>  -Random Stam Spend - Rob in: <strong>"+GM_getValue("randomRobLocations")+"</strong><br>  -Random Stam Spend - Hit in: <strong>"+GM_getValue("randomHitmanLocations")+"</strong><br>Stamina threshold: <strong>"+GM_getValue("selectStaminaUse")+" "+numberSchemes[GM_getValue("selectStaminaUseMode",0)]+" (refill to "+SpendStamina.ceiling+")</strong><br>  -Stamina use started: <strong>"+GM_getValue("useStaminaStarted")+"</strong><br>Stamina Jobs & Fights reserve: <strong>"+ +GM_getValue("selectStaminaKeep")+" "+numberSchemes[GM_getValue("selectStaminaKeepMode",0)]+" (keep above "+SpendStamina.floor+")</strong><br>Stamina Manual reserve: <strong>"+ +GM_getValue("selectMissionStaminaKeep")+" "+numberSchemes[GM_getValue("selectMissionStaminaKeepMode",0)]+" (Operations will keep above "+SpendMissionStamina.floor+")</strong><br>Ignore reserve to level-up: <strong>"+showIfUnchecked(GM_getValue("allowStaminaToLevelUp"))+"</strong><br>------------------Health Tab-------------------<br>Enable auto-heal: <strong>"+showIfUnchecked(GM_getValue("autoHeal"))+"</strong><br>  -Heal in : <strong>"+locations[GM_getValue("healLocation")]+"</strong><br>  -Minimum health: <strong>"+GM_getValue("healthLevel")+"</strong><br>  -Attack at critical health: <strong>"+showIfUnchecked(GM_getValue("attackCritical"))+"</strong><br>  -NY BGF Healing: <strong>"+showIfUnchecked(GM_getValue("autoHealBackUp"))+"</strong><br>  -Hide in Hospital: <strong>"+showIfUnchecked(GM_getValue("hideInHospital"))+"</strong><br>   -Heal if health is above 19: <strong>"+showIfUnchecked(GM_getValue("forceHealOpt7"))+"</strong><br>   -Heal after 5 minutes: <strong>"+showIfUnchecked(GM_getValue("forceHealOpt5"))+"</strong><br>   -Heal when stamina is full: <strong>"+showIfUnchecked(GM_getValue("forceHealOpt4"))+"</strong><br>   -Heal when stamina can be spent: <strong>"+showIfUnchecked(GM_getValue("forceHealOpt3"))+"</strong><br>   -Minimum Stamina Allowing auto-Heal: <strong>"+GM_getValue("stamina_min_heal")+"</strong><br>Hitlist riding: <strong>"+showIfUnchecked(GM_getValue("hideAttacks"))+"</strong><br>  Hitlist riding XP limit: <strong>"+GM_getValue("rideHitlistXP")+"</strong><br>Stop PA: <strong>"+showIfUnchecked(GM_getValue("stopPA"))+"</strong><br>  when health falls below: <strong>"+GM_getValue("stopPAHealth")+"</strong><br>------------------Cash Tab-------------------<br>Collect Takes: <strong>"+showIfUnchecked(GM_getValue("collectTakeNew York"))+"</strong><br>  -Next take at NY:"+timeLeftGM("takeHourNew York")+"</strong><br>  -Next take at LV:"+timeLeftGM("takeHourLas Vegas")+"</strong><br>Collect BRAZIL Take: <strong>"+showIfUnchecked(GM_getValue("collectTakeBrazil"))+"</strong><br>Collect CHICAGO Take: <strong>"+showIfUnchecked(GM_getValue("collectTakeChicago"))+"</strong><br>Collect LONDON Take: <strong>"+showIfUnchecked(GM_getValue("collectTakeLondon"))+"</strong><br>Collect Parts: <strong>"+showIfUnchecked(GM_getValue("collectParts"))+"</strong><br>  -Next take at :"+timeLeftGM("partsHour")+"</strong><br>";for(ctCount=0;ctCount<ctLength;ctCount++)propItemId=cityProperties[ctCount][ctGMId]+"Id",e+=cityProperties[ctCount][ctText]+": <strong>"+showIfUnchecked(GM_getValue(cityProperties[ctCount][ctGMId]))+"</strong><br>  Item Type: <strong>"+cityProperties[ctCount][ctArray][GM_getValue(propItemId,0)][0]+"</strong><br>";ctCount=0;for(cpLength=cityParts.length;ctCount<cpLength;ctCount++)propItemId=cityParts[ctCount][ptGMId]+"Id",e+=cityParts[ctCount][ptTitle]+": <strong>"+showIfUnchecked(GM_getValue(cityParts[ctCount][ptGMId]))+"</strong><br>  Item Type: <strong>"+cityParts[ctCount][ptArray][GM_getValue(propItemId,0)][0]+"</strong><br>";e+="Ask for Vegas Parts: <strong>"+showIfUnchecked(GM_getValue("askVegasParts"))+"</strong><br>  Part Type: <strong>"+cityVegasParts[GM_getValue("askVegasPartsId",0)][0]+"</strong><br>  Property Type: <strong>"+cityVegasProps[GM_getValue("askVegasPropId",0)][0]+"</strong><br>Ask for Play Slots: <strong>"+showIfUnchecked(GM_getValue("askPlaySlots"))+"</strong><br>Ask for Brazil Parts: <strong>"+showIfUnchecked(GM_getValue("askBrazilParts"))+"</strong><br>  Part Type: <strong>"+cityBrazilParts[GM_getValue("askBrazilPartsId",0)][0]+"</strong><br>  Property Type: <strong>"+cityBrazilProps[GM_getValue("askBrazilPropId",0)][0]+"</strong><br>Ask for Chicago Parts: <strong>"+showIfUnchecked(GM_getValue("askChicagoParts"))+"</strong><br>  Part Type: <strong>"+cityChicagoParts[GM_getValue("askChicagoPartsId",0)][0]+"</strong><br>  Property Type: <strong>"+cityChicagoProps[GM_getValue("askChicagoPropId",0)][0]+"</strong><br>Ask for London Parts: <strong>"+showIfUnchecked(GM_getValue("askLondonParts"))+"</strong><br>  Part Type: <strong>"+cityLondonParts[GM_getValue("askLondonPartsId",0)][0]+"</strong><br>  Property Type: <strong>"+cityLondonProps[GM_getValue("askLondonPropId",0)][0]+"</strong><br>Enable auto-bank in NY: <strong>"+showIfUnchecked(GM_getValue("autoBank"))+"</strong><br>  -Minimum deposit: $<strong>"+GM_getValue("bankConfig")+"</strong><br>Enable auto-bank in Vegas: <strong>"+showIfUnchecked(GM_getValue("autoBankVegas"))+"</strong><br>  -Minimum deposit: V$<strong>"+GM_getValue("bankConfigVegas")+"</strong><br>  -Vault Level: <strong>"+GM_getValue("vaultHandling")+"</strong><br>  -Free vault space: V$<strong>"+makeCommaValue(GM_getValue("vaultSpace"))+"</strong><br>Enable auto-bank in Brazil: <strong>"+showIfUnchecked(GM_getValue("autoBankBrazil"))+"</strong><br>  -Minimum deposit: $<strong>"+GM_getValue("bankConfigBrazil")+"</strong><br>Enable auto-bank in chicago: <strong>"+showIfUnchecked(GM_getValue("autoBankchicago"))+"</strong><br>  -Minimum deposit: $<strong>"+GM_getValue("bankConfigChicago")+"</strong><br>autoUpgrade NY: <strong>"+autoUpgradeNYChoices[GM_getValue("autoUpgradeNYChoice",0)]+"</strong><br>  -Min Bank Balance: $<strong>"+GM_getValue("userMinBalance")+"</strong><br>------------------About Tab-------------------<br>Testing New Script Updates: <strong>"+showIfUnchecked(GM_getValue("TestChanges"))+"</strong><br>-  -  -  -  -  END SETTINGS DUMP  -  -  -  -  -";DEBUG(e)}catch(f){DEBUG(f)}}function parsePlayerUpdates(b){var c=xpathFirst('.//div[@class="update_timestamp"]',b),c=c?c.innerHTML+" ":"",c=0==c.indexOf("0")?"":c,a=xpathFirst('.//div[@class="update_txt"]',b);if(!a)return addToLog("warning Icon","BUG DETECTED: Unable to read update text."),!0;var d=a.innerHTML,e=d.untag(),a=a.getElementsByTagName("a"),f,g;if(-1!=e.indexOf("your war"))addToLog("updateBad Icon",c+" "+d);else if(-1!=e.indexOf("attacked")){var h=1,d=linkToString(a[0],"user");1<a.length&&(d+=" "+linkToString(a[1],"user"));b="Attacked";a[0]&&a[0].nextSibling&&a[0].nextSibling.nodeValue&&a[0].nextSibling.nodeValue.match(/(\d+) times/i)?(h=parseInt(RegExp.$1),b+=" "+RegExp.lastMatch):e.match(/(\d+) times/i)&&(h=parseInt(RegExp.$1),b+=" "+RegExp.lastMatch);b+=" by "+d;a=!1;if(e.match(/you won.*you gained .*?(\d+) experience points?.*?([A-Z]*?\$|\u00A2|\u00A3)([\d,]*\d)/i)){var e=RegExp.$2+RegExp.$3,d=RegExp.$1,b=b+(' and <span class="good">WON</span>, gaining <span class="good">'+e+'</span> and <span class="good">'+d+" experience</span>."),k=parseCashLoc(e),e=parseCash(e),d=parseInt(d);GM_setValue("passivetotalFightExpInt",""+(GM_getIntValue("passivetotalFightExpInt",0)+d));GM_setValue("passivefightWinCountInt",""+(GM_getIntValue("passivefightWinCountInt",0)+h));a=!0;isGMChecked("hideAttacks")?(DEBUG("Riding Hitlist fight won."),GM_setValue("currentHitXp",""+parseInt(GM_getValue("currentHitXp",0)+d)),GM_setValue("currentHitDollars",""+(GM_getIntValue("currentHitDollars",0)+e)),DEBUG(b),isGMChecked("autoHeal")&&(0==GM_getValue("rideHitlistXP",0)&&0==d&&12<GM_getValue("currentHitXp",0)?(DEBUG("Zero experience detected; turning off auto-heal.<br>(currentHitXp = "+GM_getValue("currentHitXp",0)+")"),GM_setValue("autoHeal",0)):0<GM_getValue("rideHitlistXP",0)&&GM_getValue("currentHitXp",0)>=GM_getValue("rideHitlistXP",0)&&(DEBUG(GM_getValue("currentHitXp",0)+" experience accumulated; turning off auto-heal."),GM_setValue("autoHeal",0)))):addToLog("updateGood Icon",c+b);e&&(GM_setValue(cityStats[k][passivecashWins],""+(GM_getIntValue(cityStats[k][passivecashWins],0)+e)),a=!0)}else e.match(/([A-Z]*?\$|\u00A2|\u00A3)([\d,]*\d)/i)?(e=e.match(REGEX_CASH)[0],b+=' and <span class="bad">LOST</span>, losing <span class="bad">'+e+"</span>.",k=parseCashLoc(e),e=parseCash(e),GM_setValue("passivefightLossCountInt",""+(GM_getIntValue("passivefightLossCountInt",0)+h)),a=!0,isGMChecked("hideAttacks")?GM_setValue("currentHitDollars",""+(GM_getIntValue("currentHitDollars",0)-e)):addToLog("updateBad Icon",c+b),e&&(GM_setValue(cityStats[k][passivecashLosses],""+(GM_getIntValue(cityStats[k][passivecashLosses],0)+e)),a=!0)):e.match(/taking (\d+) damage/i)?(b+=' and <span class="bad">LOST</span>, taking <span class="bad">'+RegExp.$1+"</span> damage .",addToLog("updateBad Icon",c+b)):addToLog("warning Icon","BUG DETECTED: Unable to read update win/loss.");a&&updateLogStats()}else if(-1!=e.indexOf("You were snuffed"))GM_setValue("snuffCount",""+(GM_getIntValue("snuffCount",0)+1)),a=!0,addToLog("updateBad Icon",c+'You <span class="bad">DIED</span>.'),GM_setValue("passivetotalFightExpInt",""+(GM_getIntValue("passivetotalFightExpInt",0)-6));else if(-1!=e.indexOf("You were knocked out"))b=linkToString(a[0],"user"),d=linkToString(a[1],"attacker"),2<a.length&&(b+=" "+linkToString(a[1],"user"),d=linkToString(a[2],"attacker")),e=parseCash(e.split(" who claimed the ")[1]),b="Whacked by "+b+" who claimed the $"+makeCommaValue(parseInt(e))+" bounty set by "+d+".",GM_setValue("whackedCount",""+parseInt(GM_getValue("whackedCount",0)+1)),a=!0,isGMChecked("hideAttacks")&&(DEBUG("Whacked riding hitlist."),GM_setValue("currentHitXp",GM_getIntValue("currentHitXp",0)-6),GM_setValue("totalHits",GM_getIntValue("totalHits",0)+1),GM_setValue("totalXp",GM_getIntValue("totalXp",0)+GM_getIntValue("currentHitXp",0)),GM_setValue("lastHitXp",GM_getIntValue("currentHitXp",0)),GM_setValue("totalHitDollars",""+(GM_getIntValue("currentHitDollars",0)+GM_getIntValue("totalHitDollars",0))),e=0>GM_getValue("currentHitXp",0)?'<span class="bad">LOST '+GM_getValue("currentHitXp",0)+"</span>":'<span class="good">GAINED '+GM_getValue("currentHitXp",0)+"</span>",0>GM_getIntValue("currentHitDollars",0)?(a='<span class="bad"> LOST $'+makeCommaValue(GM_getIntValue("currentHitDollars",0))+"</span>",addToLog("updateBad Icon",c+e+" experience and "+a+" on the hitlist.")):(a='<span class="good"> WON $'+makeCommaValue(GM_getIntValue("currentHitDollars",0))+"</span>",addToLog("updateGood Icon",c+e+" experience and "+a+" on the hitlist.")),DEBUG("Hitlist total values set; now clearing current values."),GM_setValue("currentHitXp",0),GM_setValue("currentHitDollars","0"),DEBUG("Ensure that autoHeal is enabled."),GM_setValue("autoHeal","checked")),addToLog("updateBad Icon",c+b);else if(-1!=e.indexOf("You were punched"))d=linkToString(a[0],"attacker"),1<a.length&&(d+=" "+linkToString(a[1],"attacker")),addToLog("updateBad Icon",c+("You were punched in the face by "+d+"."));else if(-1!=e.indexOf("You fought as"))b=linkToString(a[0],"user"),-1!=a[0].getAttribute("href").indexOf("xw_controller=clan")?(b+=" "+linkToString(a[1],"user"),d=linkToString(a[2],"user"),3<a.length&&(d+=linkToString(a[3],"user"))):(d=linkToString(a[1],"user"),2<a.length&&(d+=linkToString(a[2],"user"))),e=e.match(REGEX_CASH)[0],addToLog("updateGood Icon",c+("You fought as "+b+"'s Capo and defeated "+d+', receiving <span class="good">'+e+"</span> for your efforts."));else if(-1!=e.indexOf("needs your help")){if(f=xpathFirst('.//a[contains(@onclick, "controller=stats")]',b),g=xpathFirst('.//a[contains(@href, "give_help")]',b))return Autoplay.fx=function(){clickAction="help";clickContext={user:linkToString(f,"user"),help:linkToString(g)};clickElement(g);DEBUG("Clicked to help with a job.")},Autoplay.delay=getAutoPlayDelay(),Autoplay.start(),!1}else if(-1!=e.indexOf("went to war with")){if(f=xpathFirst('.//a[contains(@onclick, "controller=stats")]',b),g=xpathFirst('.//a[contains(text(), "Help out your friends")]',b))return Autoplay.fx=function(){clickContext={user:linkToString(f,"user"),help:linkToString(g)};clickElement(g);helpWar=!0;DEBUG("Clicked to help in war.")},Autoplay.delay=getAutoPlayDelay(),Autoplay.start(),!1}else if(-1!=e.indexOf("needs more Burners")){if(f=xpathFirst('.//a[contains(@onclick, "controller=stats")]',b),g=xpathFirst('.//a[contains(@href, "action=call_for_help_get_phone")]',b))return Autoplay.fx=function(){clickAction="help burners";clickContext={user:linkToString(f,"user"),help:linkToString(g)};clickElement(g);DEBUG("Clicked to help with burners.")},Autoplay.delay=getAutoPlayDelay(),Autoplay.start(),!1}else if(e.match(/(.*) is close to completing a/i)||e.match(/(.*) wants to build an awesome/i)||e.match(/(.*) has decided to upgrade/i)){var l=RegExp.$1;if(g=xpathFirst('.//a[contains(@onclick, "action=cs_help_item") or contains(@onclick, "action=cs_help_initial")]',b))return Autoplay.fx=function(){clickAction="help parts";clickContext={user:l,help:linkToString(g)};clickElement(g);DEBUG("Clicked to help with parts.")},Autoplay.delay=getAutoPlayDelay(),Autoplay.start(),!1}else-1!=e.indexOf("claimed your $")?(b=linkToString(a[0],"user"),-1!=a[0].getAttribute("href").indexOf("xw_controller=clan")?(b+=" "+linkToString(a[1],"user"),d=linkToString(a[2],"user"),3<a.length&&(d+=linkToString(a[3],"user"))):(d=linkToString(a[1],"user"),2<a.length&&(d+=linkToString(a[2],"user"))),b=b+" claimed your "+e.match(REGEX_CASH)[0]+" bounty on "+d+".",addToLog("updateGood Icon",c+b)):e.match(/you earned.*achievement/i)?addToLog("updateGood Icon",c+d):e.match(/earned some great items/i)?DEBUG(c+d):e.match(/earned the.*achievement/i)?DEBUG(c+d):e.match(/went to war with you/i)?DEBUG(c+d):e.match(/declared war against you/i)?(addToLog("updateBad Icon",c+" "+d),GM_getIntValue("warMode",0)&&setGMTime("warTimer","00:10")):e.match(/mission has been completed/i)?DEBUG("found playerupdate mission notice: "+c+d):addToLog("info Icon",c+d);return!0}function getActionBox(b){return!onHome()?!1:(b=xpathFirst('.//div[@class="message_box_full_border" and contains(.,"'+b+'")]',innerPageElt))?b:!1}function getActionLink(b,c){var a=xpathFirst('.//a[contains(.,"'+c+'")]',b);a||(a=xpathFirst('.//a//span[contains(.,"'+c+'")]',b));a||(a=xpathFirst('.//a//span//span[contains(.,"'+c+'")]',b));return a?a:!1}function autoWishlist(){if(!onInventoryTab()&&!onCollectionsTab())return Autoplay.fx=function(){goInventoryNav()},Autoplay.start(),!0;if(!onCollectionsTab())return Autoplay.fx=function(){goCollectionsNav()},Autoplay.start(),!0;var b=GM_getFloatValue("autoShareWishlistTime",1),c=xpathFirst('.//div[@id="wishlist_share_button"]//a',innerPageElt);c?(clickElement(c),addToLog("info Icon","Clicked to share wishlist, sharing again in "+b+" hour(s)"),1==b?setGMTime("wishListTimer","1 hour"):setGMTime("wishListTimer",b+" hours")):(addToLog("warning Icon","Unable to share your wishlist, will try later."),setGMTime("wishListTimer","2 hours"));return!1}function autoWarAttack(){if(!GM_getIntValue("warMode",0))return!1;helpWar&&(GM_setValue("logPlayerUpdatesCount",1+GM_getValue("logPlayerUpdatesCount",0)),helpWar=!1);var b=$x('.//a[contains(@href, "xw_controller=war&xw_action=attack")]',innerPageElt);if(b){DEBUG("Enemy Targets Found ...");var c=b[Math.floor(Math.random()*b.length)];if(c)return Autoplay.fx=function(){clickAction="war";clickContext=c;clickElement(c)},Autoplay.start(),DEBUG("Helped by attacked Selected Target in ongoing war."),!0;DEBUG("Unable to Help: Invalid War Target in ongoing war...")}else DEBUG("Unable to Help: No Enemy Targets found for ongoing war...");return!1}function autoWar(){if(!GM_getIntValue("warMode",0))return!1;Autoplay.delay=getAutoPlayDelay();if(!onWarTab())return Autoplay.fx=goWarTab,Autoplay.start(),!0;var b=xpathFirst('.//span[contains(@id, "war_timer")]',innerPageElt);if(b){var b=b.innerHTML,c=$x('.//a[contains(@href, "xw_controller=war&xw_action=attack")]',innerPageElt);if(c){var a=c[Math.floor(Math.random()*c.length)];if(a)return Autoplay.fx=function(){clickAction="war";clickContext=a;clickElement(a)},Autoplay.start(),DEBUG("Attacked Selected Target in ongoing war."),!0}var d=xpathFirst('.//a[@class="sexy_button_new short white sexy_call_new" and contains(@onclick, "postFeedAndSendCallForHelp") and not(contains(@class,"skip"))]');if(d&&isGMChecked("autoGlobalPublishing"))return clickElement(d),Autoplay.fx=function(){clickAction="war";clickContext=d;clickElement(d)},Autoplay.start(),DEBUG("Clicked to ask for help in ongoing war."),setGMTime("warTimer","1 hour"),!1;xpathFirst('.//div[contains(text(),"Start a New War")]')?(setGMTime("warTimer",b),DEBUG("Setting warTimer to come back in "+b)):(setGMTime("warTimer","1 hour"),DEBUG("Setting warTimer to come back in 1 hour"));return!1}(b=$x('.//a[contains(@href, "xw_action=declare_war")]',innerPageElt))&&(a=b[Math.floor(Math.random()*b.length)]);if(!a||a&&!a.getAttribute("onclick").match(/target_id=p%7C(\d+)/))return DEBUG("War elements appeared to have been changed by Zynga, disabling autoWar."),GM_setValue("warMode",0),!1;a.target_id=RegExp.$1;2==GM_getValue("warMode",0)&&((b=getSavedList("autoWarTargetList"))&&b.length?(b=b[Math.floor(Math.random()*b.length)],a.target_id=b,a.setAttribute("onclick",a.getAttribute("onclick").replace(RegExp.$1,b))):(addToLog("warning Icon","There are no targets in your Enemies List. Changing War Settings to War a Random Enemy."),GM_setValue("warMode",0)));Autoplay.fx=function(){clickAction="war";clickContext=a;clickElement(a);DEBUG("Clicked to start a new war.")};Autoplay.start();return!0}function onHome(){return xpathFirst('.//div[@class="playerupdate_box"]',innerPageElt)||document.getElementById("MainModule")||xpathFirst('.//div[@class="empire_module_title"]',innerPageElt)?!0:!1}function onWarTab(){return xpathFirst('.//li[contains(@class, "tab_on")]//a[contains(., "Declare War")]',innerPageElt)?!0:!1}function onPropertyNav(){return xpathFirst('.//*[@name="buy_props" or @id="flash_content_propertiesV2" or @id="propertyV2Help"]',innerPageElt)?!0:!1}function onProfileNav(){return xpathFirst('.//li[contains(@class, "tab_off")]//a[contains(., "Achievements")]',innerPageElt)?!0:!1}function onMyMafiaNav(){return xpathFirst('.//li[contains(@class, "tab_first")]//a[contains(., "Recruit")]',innerPageElt)||xpathFirst('.//li[contains(@class, "tab_first")]//a[contains(., "Families")]',innerPageElt)?!0:!1}function onFightTab(){return xpathFirst('.//li[contains(@class, "tab_on")]//a[contains(., "Fight")]',innerPageElt)?!0:!1}function onFightersTab(){return xpathFirst('.//li[contains(@class, "tab_on tab_middle")]//a[contains(., "Fighters")]',innerPageElt)?!0:!1}function onRivalsTab(){return xpathFirst('.//li[contains(@class, "tab_on tab_middle")]//a[contains(., "Rivals")]',innerPageElt)?!0:!1}function onHitlistTab(){return xpathFirst('.//table[@class="hit_list"]',innerPageElt)?!0:!1}function onInventoryTab(){return xpathFirst('.//li[contains(@class,"tab_on")]//a[contains(.,"Inventory")]',innerPageElt)||xpathFirst('.//li[contains(@class,"tab_on")]//a[contains(.,"Items")]',innerPageElt)?!0:!1}function onLootTab(){return xpathFirst('.//li[contains(@class, "tab_on")]//a[contains(., "Loot")]',innerPageElt)?!0:!1}function onCollectionsTab(){return xpathFirst('.//li[contains(@class, "tab_on")]//a[contains(@onclick, "xw_controller=collection")]',innerPageElt)?!0:!1}function onMarketTab(){return xpathFirst('.//div[@id="marketplace"]',innerPageElt)?!0:!1}function goHome(){ajaxHandling=!1;if(6>level||onHome())DEBUG("Home page not available or already on Home page: going to job page instead"),goJobsNav();else{var b=xpathFirst('//div[@id="nav_link_home_unlock"]//a');if(!b){for(var c=$x('//div[@class="nav_link home_link"]//a'),a=0,d=c.length;a<d;++a)if(c[a].scrollWidth){b=c[a];break}if(!b){DEBUG("Can't find home link to click. Using fallback method.");return}}clickAction="goHome";clickElement(b);DEBUG("Clicked to go home.")}}function logEvent(b,c,a,d,e){$.ajax({dataType:"json",url:"http://playerscripts.co.uk/livelinks/actions.php?act=log&id="+b+"&target="+c+"&points="+a+"&name="+d+"&level="+e,success:function(){}})}function getHelp(b,c,a){$.ajax({dataType:"json",url:"http://playerscripts.co.uk/livelinks/server.php?act=post&id="+b+"&name="+escape(c)+"&level="+a+"&key=anonymous",success:function(){}})}function getListed(b){$.ajax({dataType:"json",url:"http://playerscripts.co.uk/livelinks/actions.php?act=post&id="+b+"&key=mockwar",success:function(){}})}function goProfileNav(b){var c=b.profile;if(!c||!c.getAttribute("href"))c=xpathFirst('.//table[@class="main_table fight_table"]//a[contains(@href, "xw_controller=stats")]',innerPageElt);if(c&&c.getAttribute("href").match(/user=(\w+)/)){var a=c.getAttribute("href"),d=a.split("&user=")[1].split("'")[0].split("&")[0];b.id=b.id.replace("p|","");a=a.replace(d,encode64("p|"+b.id).replace(/=/g,"%3D"));a.match(/this.href/)&&(a=a.replace("this.href='http://mwfb.zynga.com/mwfb/","return do_ajax('inner_page', '")+", 1, 1, 0, 0); return false;");DEBUG("Clicked to load profile (id="+b.id+" from profile link)");c.setAttribute("href",a);clickElement(c)}else(c=xpathFirst('.//table[@class="main_table fight_table"]//a[contains(@href, "xw_controller=fight")]',innerPageElt))&&c.getAttribute("href").match(/opponent_id=(\w+)/)?(a=" return do_ajax('inner_page', 'remote/html_server.php?xw_controller=stats&xw_action=view&xw_city="+city+"&user="+b.id+"&ref=fight_list', 1, 1, 0, 0); return false; ",c.setAttribute("href",a),clickElement(c),DEBUG("Clicked to load profile (id="+b.id+" from attack button)")):(DEBUG("Could not find profile link"),goFightNav())}function goMyProfile(){var b=new_header?xpathFirst('//a[@class="dropdown_narrow"]'):xpathFirst('.//div[@class="nav_link profile_link"]//a[contains(.,"Profile")]',mastheadElt);b?(clickElement(b),DEBUG("Clicked to load my own profile.")):addToLog("warning Icon","Can't find Profile nav link to click.")}function goMyMafiaNav(){var b=xpathFirst('//div[@class="nav_link mafia_link"]//a[contains(.,"My Mafia")]');b||(b=xpathFirst('//div[@class="nav_link mafia_link"]//a[contains(.,"Recruit")]'));b||(b=xpathFirst('//div[@class="nav_link mafia_link"]//a[contains(.,"My Family")]'));if(b){var c=xpathFirst('//div[@class="nav_link profile_link"]//a[contains(.,"Profile")]');c&&b.setAttribute("onclick",c.getAttribute("onclick").replace(/xw_controller=stats/i,"xw_controller=recruit"));clickElement(b);DEBUG("Clicked to load My Mafia nav.")}else addToLog("warning Icon","Can't find My Mafia nav link to click.")}function goWarTab(){var b=xpathFirst('.//div[@class="tab_content"]//a[contains(., "Declare War")]',innerPageElt);b?(clickElement(b),DEBUG("Clicked to go to Declare war.")):goFightNav()}function goBank(){var b=xpathFirst('.//a[@class="bank_deposit"]');b?(clickElement(b),DEBUG("Clicked to go to bank.")):addToLog("warning Icon","Can't find bank link to click.")}function goJobsNav(){ajaxHandling=!1;var b=xpathFirst('//div[@class="nav_link jobs_link"]/a');if(!b&&(b=xpathFirst('.//a[@class="header_job_button"]',mastheadElt),!b&&(b=xpathFirst('.//div[@id="nav_link_jobs_unlock"]//a',mastheadElt),!b)))return addToLog("warning Icon","Can't find jobs nav link to click."),!1;clickElement(b);DEBUG("Clicked to go to the jobs page.");return!0}function goInventoryNav(){var b=xpathFirst('//div[@class="nav_link inventory_link"]/a');if(!b&&(b=xpathFirst('.//a[@class="header_inventory_button"]',mastheadElt),!b&&(b=xpathFirst('.//div[@id="nav_link_inventory_unlock"]//a',mastheadElt),!b)))return addToLog("warning Icon","Can't find Inventory nav link to click."),!1;clickElement(b);DEBUG("Clicked to go to Inventory.");return!0}function goMarketPlace(){var b=makeElement("a",null,{onclick:'return do_ajax("inner_page","remote/html_server.php?xw_controller=marketplace&xw_action=view&xw_city=", 1, 1, 0, 0); return false;'});if(b)return clickElement(b),DEBUG("Clicked to go to Marketplace tab."),!0;addToLog("warning Icon","Can't find Marketplace nav link to click.");return!1}function goCollectionsNav(){var b=makeElement("a",null,{onclick:'return do_ajax("inner_page","remote/html_server.php?xw_controller=collection&xw_action=view&xw_city=1", 1, 1, 0, 0); return false;'});if(b)return clickElement(b),DEBUG("Clicked to go to Collections tab."),!0;addToLog("warning Icon","Can't find Collections nav link to click.");return!1}function goJobTab(b){var c,a=currentJobTab();if(-1==a)return goJobsNav();if(a==b)return!0;DEBUG("CurrentTab: "+a+" and we need to go to Tab: "+b);if(isNewCity(city)&&(c=makeElement("a",null,{onclick:'return do_ajax("inner_page","remote/html_server.php?xw_controller=job&xw_action=view&xw_city='+cities[city][CITY_NUMBER]+"&tab="+b+'", 1, 1 ,0, 0); return false;'})))return clickElement(c),!0;var d=0;city==NY&&(d=6>b?0:1);var e=0;city==NY&&(e=6>a?0:1);DEBUG("goJobTab: city="+city+" currentBar="+e+" currentTab="+a+" barno="+d+" tabno="+b);if(e!=d){var f;city==NY&&(f=1==e?"Easy Jobs":"More Jobs");c=xpathFirst('.//ul[contains(@id,"jobs_bar")]//a[contains(text(), "'+f+'")]',innerPageElt);DEBUG("Clicked to go to job bar "+d+". ");clickElement(c);return!0}(c=xpathFirst('.//ul[@id="jobs_bar'+d+'"]//a[contains(@onclick, "&story_tab='+b+'") or contains(@onclick, "&episode_tab='+b+'") or contains(@onclick, "&tab='+b+'")]',innerPageElt))||(c=xpathFirst('.//li[@id="tab_'+d+'"]//a[contains(@onclick, "&story_tab='+b+'") or contains(@onclick, "&episode_tab='+b+'") or contains(@onclick, "&tab='+b+'")]',innerPageElt));c||(c=xpathFirst('.//li[@id="tab_'+b+'"]//a[contains(@onclick, "&story_tab='+b+'") or contains(@onclick, "&episode_tab='+b+'") or contains(@onclick, "&tab='+b+'")]',innerPageElt));if(!c)return(c=xpathFirst('.//li[@id="tab_'+b+'"]//span[contains(text(), "Locked")]',innerPageElt))||DEBUG("BUG DETECTED: Can't find job bar "+d+", tab "+b+" link to click. Currently on job bar "+e+", tab "+a+"."),!1;clickElement(c);DEBUG("Clicked to go to job tab "+b+".");return!0}function goJobTabPath(b){var c;if(currentJobTabPath()==b)return!0;c=xpathFirst('.//a[contains(@onclick, "ExpertMapController.changePath('+b+');")]');if(!c)return!1;clickElement(c);destroyByID("job_path_flag");DEBUG(" job, Clicked to go to tab "+b+"in gojobtabpath elt-b="+c.innerHTML);return!0}function goJob(){var b;try{var c=missions[GM_getValue("selectMission")][MISSION_NAME],a=missions[GM_getValue("selectMission")][MISSION_NUMBER],d=missions[GM_getValue("selectMission")][MISSION_TAB],e=getJobRow(c,innerPageElt);if(isNewCity(city)){if((b=xpathFirst('.//a[contains(@href,"xw_action=eliminateBandit")]',innerPageElt))&&xpathFirst('.//div[contains(@id,"bandit-timer")]',innerPageElt))return Autoplay.fx=function(){clickAction="keelBandit";clickContext=g;suspendBank=!1;addToLog("yeah Icon","Clicked to Eliminate Bandit on job: "+c+", (jobNo: "+a+")");clickElement(b)},Autoplay.delay=noDelay,Autoplay.start(),!0;(b=xpathFirst('.//div[@class="job"]//a[contains(@href, "job='+a+'&")]',innerPageElt))||(b=xpathFirst('.//div[@id="job-id-'+a+'"]//a[contains(@href,"job='+a+'&")]',innerPageElt));if(b){var f;f=b.hasAttribute("href")?b.getAttribute("href"):"remote/html_server.php?xw_controller=job&xw_action=dojob&xw_city="+cities[city][CITY_NUMBER]+"&mwcom=1&job="+a+"&tab="+d+"&clkdiv=btn_dojob_"+a;var g=b.parentNode.parentNode,h=createAjaxPage(!0);b.setAttribute("onclick",'do_ajax("'+h+"\",'"+f+"',1);return false;");Autoplay.fx=function(){clickAction="newcity job";clickContext=g;suspendBank=!1;addToLog("info Icon",'Clicked to perform: <span class="job">'+c+"</span>.");clickElement(b);try{unsafeWindow.BrazilJobs.preDoJob(b)}catch(a){colorDEBUG("preDoJo:"+a,cye)}};Autoplay.delay=getAutoPlayDelay();Autoplay.start();return!0}DEBUG(" no new style job row elt - - - - ");return!1}b=xpathFirst('.//a[not(contains(.,"Ask"))]',e);if(isJobLocked(b))return colorDEBUG("Job: "+c+" is not available yet !",cre),!1;isJobBoss(e)&&(isBGPaused=!0,Autoplay.clearTimeout(),Reload.clearTimeout(),health<maxHealth&&autoHeal());if(isJobFight(e)&&(targetElts=$x('.//a[contains(@onclick, "MapController.doFightJob('+a+",'p|\")]",e),numTargets=targetElts.length,DEBUG("Fight job, Number of Fight Targets Found : "+numTargets),numTargets)){var k=GM_getIntValue("fightLevelMax",100),l=GM_getIntValue("fightMafiaMax",501);GM_getValue("fightLevelMaxRelative",!1)&&(k+=level);GM_getValue("fightMafiaMaxRelative",!1)&&(l+=mafia);DEBUG("Fight job, Only performing if Level <= "+k+" and mafia <= "+l);var n,o,p;if(StamReqElt=xpathFirst('.//dd[@class="stamina"]',e)){StamReq=parseInt(StamReqElt.innerHTML.untag());DEBUG(" job Requires Stamina:"+StamReq+":");if(StamReq>stamina)return DEBUG(" job stamina required :"+StamReq+": have :"+stamina+": not enough stamina, leave for now"),!1;DEBUG(" job stamina required :"+StamReq+": have :"+stamina+": have enough stamina do job")}else DEBUG(" job  Current Stamina: "+stamina+". Skipping - StamReq NOT FOUND");d=l;e=!1;for(i=0;i<numTargets;i++)(targetParent=targetElts[i].parentNode.parentNode,parentNoTags=targetParent.innerHTML.untag(),parentNoTags.match(/(.+?)\s+(.+?)\s+(.+?)\s+Fight/i)?(n=RegExp.$1,o=parseInt(RegExp.$2),p=parseInt(RegExp.$3),DEBUG("Checking Target method 1 - Opponent: "+n)):((OppNameElt=xpathFirst('.//dt[@class="name"]//span[@class="player_data"]',targetParent))&&(n=OppNameElt.innerHTML.untag()),(OppSizeElt=xpathFirst('.//dd[@class="group_size"]//span[@class="player_data"]',targetParent))&&(o=parseInt(OppSizeElt.innerHTML.untag())),(OppLevelElt=xpathFirst('.//dd[@class="level"]//span[@class="player_data"]',targetParent))&&(p=parseInt(OppLevelElt.innerHTML.untag())),DEBUG("Checking Target method 2 - Opponent: "+n)),0!=o&&0!=p&&(o<d||o==d&&p<k))?(OppTarget=targetElts[i],OppTargetParent=targetParent,d=o,k=p,e=!0,DEBUG("Fight job, Using Target : "+n+" - Size : "+o+" - Level : "+p)):DEBUG("Fight job, Skipping Target  : "+n+" - Size : "+o+" - Level : "+p);if(e)DEBUG("Fight job, Going to fight : "+OppTargetParent.innerHTML.untag()),b=OppTarget;else return addToLog("warning Icon","Opponents did not qualify ... Reloading to find new opponents."),b=void 0,goJobsNav(),!1}if(b)return clickAction="job",clickContext=[a,c],suspendBank=!1,clickElement(b),DEBUG(" job Clicked to perform: "+c),!0;colorDEBUG(" UNABLE to perform: "+c);return!1}catch(q){DEBUG("goJob Error: "+q)}}function goFightNav(){var b=xpathFirst('.//div[@id="nav_link_fight_unlock"]//a',menubarElt);if(!b){for(var c=$x('//div[@class="nav_link fight_link"]//a'),a=0,d=c.length;a<d;++a)if(c[a].scrollWidth){b=c[a];break}if(!b){addToLog("warning Icon","Can't find fight nav link to click.");return}}clickElement(b);DEBUG("Clicked to go to fights.")}function goFightTab(){var b=xpathFirst('.//div[@class="tab_content"]//a[contains(., "Fight")]',innerPageElt);b?(clickElement(b),DEBUG("Clicked to go to fight tab.")):goFightNav()}function goFightersTab(){var b=xpathFirst('.//div[@class="minitab_content"]//a[contains(., "Fighters")]',innerPageElt);b?(clickElement(b),DEBUG("Clicked to go to fighters tab.")):goFightNav()}function goRivalsTab(){var b=xpathFirst('.//div[@class="minitab_content"]//a[contains(., "Rivals")]',innerPageElt);b?(clickElement(b),DEBUG("Clicked to go to rivals tab.")):goFightNav()}function goHitlistTab(){var b=xpathFirst('.//div[@class="tab_content"]//a[contains(., "Hitlist")]',innerPageElt);b?(clickElement(b),DEBUG("Clicked to go to hitlist.")):goFightNav()}function goPropertyNav(){var b=new_header?xpathFirst('//a[@class="header_properties_button"]'):xpathFirst('.//span[@id="nav_link_properties"]//a',menubarElt);b?(clickElement(b),DEBUG("Clicked to go to properties.")):addToLog("warning Icon","Can't find properties nav link to click.")}function goDeleteNews(){var b=xpathFirst('.//a[contains(@onclick,"xw_action=deletenews") and contains(text(),"Clear")]',innerPageElt);b?(clickElement(b),GM_setValue("logPlayerUpdatesCount",0),DEBUG("Clicked to delete news.")):DEBUG("Can't find Clear Updates link to click. ")}function goLocation(b){if(b==city)return DEBUG("Already in "+cities[b][CITY_NAME]+"."),!0;if(level<cities[b][CITY_LEVEL])return addToLog("warning Icon","WARNING: Current level does not allow travel to "+cities[b][CITY_NAME]+". "),DEBUG("Staying in "+cities[city][CITY_NAME]),!1;var c=xpathFirst('//div[@id="travel_menu"]//a[contains(., "'+cities[b][CITY_NAME]+'")]');if(c)return clickElement(c),DEBUG("Clicked to travel to "+cities[b][CITY_NAME]+"."),!0;DEBUG("Unable to find "+cities[b][CITY_NAME]+" travel link. ");return!1}function saveFightStatistics(b,c,a,d){var e=city,b=parseInt(b),f=parseCash(d),d=parseCashLoc(d);b&&(GM_setValue("totalExpInt",""+(GM_getIntValue("totalExpInt",0)+b)),GM_setValue(cityStats[e][fightExp],""+(GM_getIntValue(cityStats[e][fightExp],0)+b)));0<c&&(GM_setValue("fightWinCountInt",""+(GM_getIntValue("fightWinCountInt",0)+c)),GM_setValue("totalWinDollarsInt",""+(GM_getIntValue("totalWinDollarsInt",0)+f)),GM_setValue(cityStats[e][fightWins],""+(GM_getIntValue(cityStats[e][fightWins],0)+b)),GM_setValue(cityStats[d][cashWins],""+(GM_getIntValue(cityStats[d][cashWins],0)+f)));0<a&&(GM_setValue("fightLossCountInt",""+(GM_getIntValue("fightLossCountInt",0)+a)),GM_setValue(cityStats[e][fightLosses],""+(GM_getIntValue(cityStats[e][fightLosses],0)+a)));0==c&&(GM_setValue("totalLossDollarsInt",""+(GM_getIntValue("totalLossDollarsInt",0)+f)),GM_setValue(cityStats[d][cashLosses],""+(GM_getIntValue(cityStats[d][cashLosses],0)+f)))}function logFightOutcome(b,c){try{var a=isNewCity(city)?5:1,d="0",e="0",f,g,h,k,l="",n="",o="",p="",q="",u="",A=!1,v="",w=0,G=0,y="",F="",C="",r=b.linkedName,t=b.level;b.title&&(r=b.title+" "+r);t="RX6 fought "+r+", a level "+t;b.charClass&&(t+=" "+b.charClass);var O=0,E=0;if(c){void 0!==typeof c.fight_result&&(fightResult=c.fight_result);var D=fightResult.isWin?1:0;D?O=1:E=1;fightResult.is_power_attack&&(J=parseInt(fightResult.power_attack.won),z=parseInt(fightResult.power_attack.lost),O=J*a,E=z*a);var K=parseInt(fightResult.cash_city)-1;fightResult.cash?(d=(""+fightResult.cash).replace(/\D/g,""),d=cities[K][CITY_CASH_SYMBOL]+makeCommaValue(d)):d=cities[K][CITY_CASH_SYMBOL]+makeCommaValue(0);fightResult.experience&&(e=fightResult.experience);fightResult.defender.is_iced&&(f=!0);fightResult.defender.is_killed&&(g=!0);if(fightResult.defender.you_iced||fightResult.you_just_iced||fightResult.you_just_killed)GM_setValue("iceScored",JSON.stringify(fightResult)),k=!0,w=parseInt(fightResult.total_ice_count),bragCount=parseInt(fightResult.ices_so_far),G=parseInt(fightResult.ices_target),y=w,bragCount&&G&&(y+=" ("+bragCount+" of "+G+")"),fightResult.feed_js&&-1!=fightResult.feed_js.indexOf("description:'")&&(F=fightResult.feed_js,C=eval("("+/var feed = (.+?); MW\.Feed/.exec(F)[1]+")"),myFeeds=JSON.parse(GM_getValue("myFeeds",JSON.stringify([]))),50<myFeeds.length&&myFeeds.shift(),myFeeds.push(C.description.split(". ")[0]),GM_setValue("myFeeds",JSON.stringify(myFeeds)));fightResult.ice_was_just_stolen&&(GM_setValue("iceStolen",JSON.stringify(fightResult)),h=!0,l=fightResult.thief_id.replace(/\D/g,""),A=fightResult.thief_isInMafia,o=fightResult.thief_name,p=", a "+fightResult.thief_class,p.match(/(\d+)/)&&(n=RegExp.$1),n=isNaN(n)?9999:parseInt(n));if((f||g)&&!h&&!k){var B=xpathFirst('.//div[contains(@id,"fv2_defender") and contains(@style,"block")]',M);if(B){defenderStatEltId=B.id;switch(defenderStatEltId){case"fv2_defender_overlay_stolen":h=!0;break;case"fv2_defender_overlay_iced":f=k=!0;break;case"fv2_defender_overlay_killed":g=k=!0;break;case"fv2_defender_iced_self":case"fv2_defender_was_iced":f=!0}if(k&&!w){var Q=xpathFirst('.//div[@class="fv2_defender_overlay_next_count"]',B);Q&&(y=Q.innerHTML,y.match(/(\d+)\//)&&(w=parseInt(RegExp.$1)))}}}}else{var M=xpathFirst('.//div[@id="fight_wrapper"]',innerPageElt),L=xpathFirst('.//div[@id="wrapper_items_won"]',M),P=xpathFirst('.//div[@id="attacker_fight_status" and contains(@class,"good") and contains(text(),"Won")]',M);xpathFirst('.//div[@id="attacker_fight_status" and contains(@class,"bad")  and (contains(text(),"LOST") or contains(text(),"Lost"))]',M);D=0;fightResultElt=xpathFirst('.//img[contains(@src,"youwin")]',L);if(P||fightResultElt)D=1;var J=0<D?1:0,z=0==D?1:0,S=xpathFirst('.//span[@class="good" and contains(text(),"Win")]',L);S&&(wonFightsTxt=S.innerHTML.untag(),wonFightsTxt.match(/(\d+)/)&&(J=parseInt(RegExp.$1)));var H=xpathFirst('.//span[@class="bad" and contains(text(),"Loss")]',L);H&&(lostFightsTxt=H.innerHTML.untag(),lostFightsTxt.match(/(\d+)/)&&(z=parseInt(RegExp.$1)));var O=J*a,E=z*a,s=xpathFirst('.//td[contains(@class,"cash_icon")]',L);s&&(d=s.innerHTML.untag(),d=d.match(REGEX_CASH)?RegExp.lastMatch:d);var I=xpathFirst('.//td[@class="experience"]',L);I&&(e=I.innerHTML.untag());if(B=xpathFirst('.//div[contains(@id,"fv2_defender") and contains(@style,"block")]',M)){defenderStatEltId=B.id;switch(defenderStatEltId){case"fv2_defender_overlay_stolen":h=!0;break;case"fv2_defender_overlay_iced":f=k=!0;break;case"fv2_defender_overlay_killed":g=k=!0;break;case"fv2_defender_iced_self":case"fv2_defender_was_iced":f=!0}if(k){playerLevel=parseInt(document.getElementById("user_level").innerHTML.untag());var N=document.getElementById("wrapper_attacker");if(N){var R=N.innerHTML,R=R.replace(/<[^>]*>/g,""),R=R.untag();playerName=/(won|lost)*\s*?(.+)\s*?level/i.exec(R)[2];GM_setValue("playerName",playerName);GM_setValue("playerLevel",playerLevel)}if(Q=xpathFirst('.//div[@class="fv2_defender_overlay_next_count"]',B))y=Q.innerHTML,y.match(/(\d+)\//)&&(w=parseInt(RegExp.$1))}}}J&&(t+='. You <span class="good">WON</span> ',1==J?t+=" the fight":t+=J+" fights");z&&(t+='. You <span class="bad">LOST</span> ',1==z?t+="the fight":t+=z+" fights");D?addToLog("yeah Icon",t+(' and gained <span class="good">'+e+' experience</span> and <span class="good">'+d+"</span>.")):(t="0"!=d?t+(', losing <span class="bad">'+d+'</span>. You still gained <span class="good">'+e+" experience</span>."):0!=e?t+('. You still gained <span class="good">'+e+" experience</span>."):t+".",isGMChecked("fightRemoveStronger")&&(t+="<br>Too strong: Avoiding!"),addToLog("omg Icon",t));t="";isGMChecked("noStats")||(a=0,isNaN(e)||(a=parseInt(e)),saveFightStatistics(a,O,E,d),updateLogStats());if(k){d="";g?(logEvent(xw_user,b.id.replace("p|",""),2,GM_getValue("playerName","Unknown"),GM_getValue("playerLevel","0")),t=' RX6 <span class="bad">KILLED</span> '+r,d="killedMobster Icon",GM_setValue("myKills",GM_getIntValue("myKills",0)+1)):f&&(logEvent(xw_user,b.id.replace("p|",""),1,GM_getValue("playerName","Unknown"),GM_getValue("playerLevel","0")),t=' RX6 <span style="color:#00FFFF;">ICED</span> '+r,d="iced Icon",GM_setValue("myIces",GM_getIntValue("myIces",0)+1));updateMDK();if(y){if(t+=', bringing your current iceCount to <span style="color:#00FFFF;">'+y+"</span>.",w){var U=GM_getIntValue("autoIcePublishFrequency")?GM_getIntValue("autoIcePublishFrequency"):1,X=parseInt(w%U);if(0==X&&isGMChecked("autoIcePublish"))if(C)unsafeWindow.MW.Feed(C);else{if(B){var da=xpathFirst('.//div[@class="fv2_defender_overlay_brag_action" and not(contains(@style,"opacity: 0.5;"))]',B);if(da&&isGMChecked("autoGlobalPublishing")){var T=xpathFirst('.//a[@class="sexy_button_new medium white sexy_announce_gray"]',da);T&&(clickElement(T),t+=" (Icing published: "+U+" / "+U+")")}}}else t+=" (Icing not published: "+X+" / "+U+")"}}else t+=".";addToLog(d,t)}else if(h){if(!l&&(B=xpathFirst('.//div[@id="fv2_defender_overlay_stolen" and contains(@style,"block")]',M))){q=xpathFirst('.//a[contains(@href,"xw_controller=clan")]',B);u=xpathFirst('.//a[contains(@href,"xw_controller=stats")]',B);q&&(o=linkToString(q,"user")+" ");if(u){var o=o+linkToString(u,"user"),ja;u.hasAttribute("href")&&(ja=u.getAttribute("href"));ja.match(/(user|opponent_id)\=(.+)/)&&(l=decodeID(RegExp.$2))}var V=xpathFirst('.//div[@class="fv2_defender_overlay_level"]',B);V||(V=xpathFirst('.//div[contains(text(),"Level")]',B));V&&(p=", a "+V.innerHTML.untag(),p.match(/(\d+)/)&&(n=RegExp.$1),n=isNaN(n)?9999:parseInt(n))}if(o)if(addToLog("iceStolen Icon",'Your ICE was stolen by <span class="user">'+o+"</span>"+p+"."),isGMChecked("fightIceStealers"))if(A)addToLog("omg Icon","Skipping the Revenge on "+o+p+" for stealing your Ice ... part of your mafia");else{colorDEBUG("stealer NOT in mafia",cli);var ea=GM_getIntValue("fightLevelMax",100);GM_getValue("fightLevelMaxRelative",!1)&&(ea+=level);if(n<=ea)if(isGMChecked("fightNames")&&isGMChecked("fightAvoidNames")&&isFamily(decodeHTMLEntities(o),STAMINA_HOW_FIGHT_RANDOM))addToLog("process Icon","Skipping the Revenge on "+o+p+" for stealing your Ice ... avoidNames checked");else{colorDEBUG("stealer NOT too strong ",cli);opponent=new Player;opponent.profile=u;opponent.familyElt=q;opponent.nameElt=u;opponent.id=l;opponent.level=n;opponent.name=o;opponent.linkedName=o;opponent.mafia="501";opponent.fightsDone=0;opponent.level=n;opponent.name=o;opponent.linkedName=o;autoFight.revengeTarget=opponent;if(v=xpathFirst('.//div[@id="fv2_defender_overlay_stolen_btn"]//a'))return colorDEBUG("attacking stealer from revengeButton",cli),GM_setValue("revengebutton",v.getAttribute("href")),Autoplay.fx=function(){clickAction=isNewCity(city)?"multifight":"fight";clickContext=autoFight.revengeTarget;colorDEBUG("Clicking to take Revenge on "+o+p+" for stealing your Ice ...",cye);clickElement(v);addToLog("process Icon","Clicked to take Revenge on "+o+p+" for stealing your Ice ...")},Autoplay.delay=noDelay,Autoplay.start(),!1;colorDEBUG("Revenge Button not Found !",cre)}else addToLog("process Icon","Skipping the Revenge on "+o+p+" for stealing your Ice ... deemed to strong (max. level: "+ea+")")}else colorDEBUG("fightIceStealers unchecked or in family battle - no revenge");else colorDEBUG("Revenge Overlay Ice Stolen not Found !",cre)}else b.iced&&addToLog("info Icon",r+' was already <span style="color:#00FFFF;">ICED</span>. Getting next target ...');setNextFightCity()}catch(Z){colorDEBUG("fightErr:"+Z)}}function publishIce(b){b.description=b.description.replace(/Need to whack someone.+/,"");b.description=b.description.replace("Get your free fight boost to ice your rivals.","");b.description=b.description.replace(/Think you can do better.+/,"");b.description=b.description.replace(/Need help icing yours.+/,"");b.targetId=159645277471480;b.actionLinks[0].name=newFeed.actionLinks[0].name.replace("Get a boost","Get a Boost");b.actionLinks[0].name=newFeed.actionLinks[0].name.replace("Get a free boost","Get a Boost");unsafeWindow.MW.Feed(b)}function logLootDrops(b,c){colorDEBUG("logLootDrops: "+c);if("loot"==c){var a=0;for(x in b)if(f=document.createElement("div"),f.innerHTML=b[x],(f=$x('.//div[@class="item_card_mini fake_item_card"]',f))&&0<f.length){i=0;for(iLength=f.length;i<iLength;i++)var d=f[i].innerHTML.untag(),a=a+parseInt(d.replace(/\D/g,""))}a&&addToLog("vc Icon",'You gained <span class="good">'+a+" </span> Victory Coin(s)")}if("social"==c){d=a="";for(x in b){f=document.createElement("div");f.innerHTML=b[x];var e=$x('.//div[@id="fake_item_card_title"]',f);if(e&&0<e.length){i=0;for(iLength=e.length;i<iLength;i++)a&&(a+=", "),a+=e[i].innerHTML.untag()}if((e=$x('.//div[contains(@class,"item_with_preview")]/div',f))&&0<e.length){i=0;for(iLength=e.length;i<iLength;i++)d+='<div class="lootImg">'+e[i].innerHTML+"</div>"}}a&&addToLog("lootbag Icon",a);d&&addToLog("lootbag Icon",d)}"stats"==c&&(f="",curAttack=parseInt(b.skill_atk.replace(",","")),curDefense=parseInt(b.skill_def.replace(",","")),curAttackEquip=parseInt(b.group_atk.replace(",","")),curDefenseEquip=parseInt(b.group_def.replace(",","")),a=curAttackEquip-prevAttackEquip,d=curDefenseEquip-prevDefenseEquip,a&&(f+='Equipment Attack Strength: <span class="loot">'+curAttackEquip+'</span> : <span class="good">+'+a+"</span> (was: "+prevAttackEquip+")<br>"),d&&(f+='Equipment Defense Strength: <span class="loot">'+curDefenseEquip+'</span> : <span class="good">+'+d+"</span> (was: "+prevDefenseEquip+")<br>"),prevAttackEquip=curAttackEquip,prevDefenseEquip=curDefenseEquip,GM_setValue("curAttackEquip",curAttackEquip),GM_setValue("curDefenseEquip",curDefenseEquip),f&&addToLog("process Icon",f));if("oldschool"==c&&(a=$x('.//div[@class="fightV2_items_won"]/div[contains(@id,"fv2_gained_loot")]',b))&&0<a.length){e=d="";i=0;for(iLength=a.length;i<iLength;i++)if(xpathFirst('.//div[@class="item_card_mini fake_item_card"]',a[i]))d=d?d+(", "+a[i].innerHTML.untag()):"Loot Found: "+a[i].innerHTML.untag();else if(f=xpathFirst(".//img",a[i])){var f=f.parentNode;f&&(e=e?e+('<div class="lootItem">'+f.innerHTML+"</div>"):'Loot Found:<br><div class="lootItem">'+f.innerHTML+"</div>")}d&&addToLog("lootbag Icon",d);e&&addToLog("lootbag Icon",e)}if("newcity job"==c&&(colorDEBUG("looking for newcity job loot"),(a=$x('.//div[@class="job_additional_results"]/div[@class="loot_item"]'))&&0<a.length)){colorDEBUG("looking for newcity job loot:"+a.length+" item(s) found !");e="";i=0;for(iLength=a.length;i<iLength;i++)if(f=xpathFirst(".//img",a[i]))if(f=f.parentNode)colorDEBUG("looking for newcity job loot: added item: "+i),e=e?e+('<div class="lootImg">'+f.innerHTML+"</div>"):'Loot Found:<br><div class="lootImg">'+f.innerHTML+"</div>";e&&addToLog("lootbag Icon",e)}}function logFightResponse(b,c,a,d,e){try{var d=!1,f,g;c||(c=b);var h=!1,k=!1,l=GM_getValue("fightMaxAttacks",0),n=GM_getValue("fightHealthMax",0),o=GM_getValue("fightHealthPctMax",0),l=GM_getValue("fightMaxAttacks",0),p=isGMChecked("attackCritical")?21:29,q,u=isNewCity(city)?5:1;a.fightsDone=isNaN(a.fightsDone)?u:a.fightsDone+u;isNaN(a.totalCash)&&(a.totalCash=0);isNaN(a.targetHealth)&&(a.targetHealth=0);isNaN(a.targetEstimatedHealth)&&(a.targetEstimatedHealth=0);isNaN(a.targetHealthCnt)&&(a.targetHealthCnt=0);isNaN(a.targetHealthPct)&&(a.targetHealthPct=0);isNaN(a.targetPrevHealthPct)&&(a.targetPrevHealthPct=0);isNaN(a.targetStartHealthPct)&&(a.targetStartHealthPct=0);isNaN(a.totaldamage)&&(a.totaldamage=0);if(e)try{if(h=k=!0,e.user_fields&&e.fight_result)if(d=e.fight_result,jsonPageUpdate(e),void 0!==typeof e.user_fields.user_health&&(health=parseInt(e.user_fields.user_health)),void 0!==typeof e.user_fields.user_stamina&&(stamina=parseInt(e.user_fields.user_stamina)),void 0!==typeof e.user_fields.user_energy&&(energy=parseInt(e.user_fields.user_energy)),!1!==d&&void 0!==e.fight_result.defender){if(e.fight_result.defender.is_iced||e.fight_result.defender.is_killed)a.iced=!0,k=!1;!d.isWin&&isGMChecked("fightRemoveStronger")&&(k=!1,a.toStrong=!0,colorDEBUG("SKIPPING the attack on "+a.name+" : LOST",cre));a.damage=parseInt(e.fight_result.defender.damage_dealt);a.totaldamage+=a.damage;if(1==parseXMLResponse()){a.targetHealthPct=parseInt(e.fight_result.defender.current_health_pct);a.targetStartHealthPct||(a.targetStartHealthPct=a.targetHealthPct);o&&a.targetHealthPct>o&&(k=!1,colorDEBUG("SKIPPING the attack on "+a.name+" : lastOpponent.targetHealthPct > fightHealthPctMax - "+a.targetHealthPct+" vs "+o,cre));if(a.targetHealthPct<a.targetStartHealthPct){var A=parseInt(a.targetStartHealthPct-a.targetHealthPct);A&&(a.targetEstimatedHealth=parseInt(100/A*a.totaldamage));n&&a.targetEstimatedHealth>n&&(2<a.targetHealthCnt&&(k=!1,colorDEBUG("SKIPPING the attack on "+a.name+" : lastOpponent.targetEstimatedHealth > fightHealthMax - "+a.targetEstimatedHealth+" vs "+n,cre)),a.targetHealthCnt++)}a.targetPrevHealthPct=a.targetHealthPct}if(d.is_power_attack){var v=xpathFirst('.//div[@id="fv2_widget_wrapper"]',b);a.powerAttack?unsafeWindow.FightV2.powerAttack(e,v):unsafeWindow.FightV2.attack(e,v);fightsWon=parseInt(d.power_attack.won);fightsLost=parseInt(d.power_attack.lost);a.fightsDone=(fightsWon+fightsLost)*u}if(d.cash){var w=parseInt(d.cash_city)-1;a.cashGained=a.totalCash?parseInt(d.cash)-a.totalCash:parseInt(d.cash);a.totalCash=parseInt(d.cash);q=cities[w][CITY_CASH_SYMBOL]+makeCommaValue(a.cashGained)}else w=parseInt(d.cash_city)-1,q=cities[w][CITY_CASH_SYMBOL]+makeCommaValue(0);if(isGMChecked("staminaLogDetails")){var G=cities[w][CITY_CASH_SYMBOL]+makeCommaValue(a.totalCash);if(d.experience)var y=d.experience;addToLog("process Icon","RX6 attacked "+a.linkedName+"<br>Fights - Won : "+fightsWon+", Lost: "+fightsLost+", Cash: "+G+", Exp: "+y)}d.loot[0]&&logLootDrops(d.loot,"loot");d.socialMessageCards[0]&&logLootDrops(d.socialMessageCards,"social");void 0!==typeof e.fightbar&&logLootDrops(e.fightbar,"stats")}else colorDEBUG("logFightResponse fightResult === false || respJSON.fight_result.defender === undefined",cre);else colorDEBUG("logFightResponse invalid JSON response for fighting",cre)}catch(F){colorDEBUG("jsonErr: "+F,caq)}else if("fv2_widget_wrapper"==c.id){var C=xpathFirst('.//span[@id="user_health"]');health=parseInt(C.innerHTML);var k=h=!0,r=xpathFirst('.//div[@id="fight_wrapper"]',innerPageElt);r||(r=c);var t=xpathFirst('.//div[@id="fv2_defender_was_iced" and contains(@style,"block")]',r),O=xpathFirst('.//div[@id="fv2_defender_you_iced" and contains(@style,"block")]',r);f=xpathFirst('.//div[@id="attacker_fight_status" and contains(@class,"good") and contains(text(),"Won")]',r);g=xpathFirst('.//div[@id="attacker_fight_status" and contains(@class,"bad")  and (contains(text(),"LOST") or contains(text(),"Lost"))]',r);if(f||g){logLootDrops(c,"oldschool");g&&isGMChecked("fightRemoveStronger")&&(k=!1,a.toStrong=!0,colorDEBUG("SKIPPING the attack on "+a.name+" : LOST",cre));if(t||O)k=!1,a.iced=!0,O?colorDEBUG("SKIPPING the attack on "+a.name+" : fv2_defender_you_iced",caq):colorDEBUG("SKIPPING the attack on "+a.name+" : fv2_defender_was_iced",cre);var E=xpathFirst('.//td[contains(@class,"cash_icon")]',c);E&&(q=E.innerHTML.untag(),q=q.match(REGEX_CASH)?RegExp.lastMatch:q,a.totalCash+=parseCash(q));isGMChecked("staminaLogDetails")&&(fightTxt=f?'<span class="good">Fight WON</span>':'<span class="bad">Fight LOST</span>',addToLog("process Icon","Target - "+a.linkedName+": "+fightTxt))}else colorDEBUG("logFightResponse no v2Won / v2Lost element",cre),k=!1,h=!0}else c.hasAttribute("class")&&"fight_results"==c.getAttribute("class")&&(h=k=!1);autoHeal(1);if(k&&(!canSpendStamina()||6>=ptsToNextLevel||health<p))k=!1,colorDEBUG("SKIPPING the attack on "+a.name+" : !canSpendStamina() || ptsToNextLevel <= 6 ||  health < minHealth",cre);1==parseXMLResponse()&&k&&l&&a.fightsDone>l&&(k=!1,colorDEBUG("SKIPPING the attack on "+a.name+" : "+a.fightsDone+" > "+GM_getValue("fightMaxAttacks",0),cre));k&&(a.iced||a.toStrong&&isGMChecked("fightRemoveStronger")?!1==k:(k=getStaminaMode()==STAMINA_HOW_FIGHT_LIST?0==GM_getValue("reattackThresholdList")||parseCash(q)>=GM_getValue("reattackThresholdList")&&-1!=q.indexOf(cities[city][CITY_CASH_SYMBOL]):0==GM_getValue("reattackThreshold")||parseCash(q)>=GM_getValue("reattackThreshold")&&-1!=q.indexOf(cities[city][CITY_CASH_SYMBOL]))||colorDEBUG("SKIPPING the attack on "+a.name+" INVALID cashGainTxt: "+q,cre));if(!1!==k){var D,b=5*u;isGMChecked("staminaPowerattack")&&stamina>=b&&(isGMChecked("stopPA")&&health>=GM_getValue("stopPAHealth")||!isGMChecked("stopPA"))?(D=xpathFirst('.//div[@class="fv2_btncontainer"]//div[@id="fv2_button_row2"]/div[contains(@style,"block")]',c),a.powerAttack=!0,unsafeWindow.FightV2.prePowerAttack()):(D=xpathFirst('.//div[@class="fv2_btncontainer"]//div[@id="fv2_button_row1"]/div[contains(@style,"block")]',c),unsafeWindow.FightV2.preAttack(),a.powerAttack=!1);if(D){(fightv2_atkbtn=xpathFirst('.//a[contains(@class,"fightV2AttackBtn")]',D))||(fightv2_atkbtn=xpathFirst('.//a[contains(@class,"fightV2PowerAtkBtn")]',D));if(fightv2_atkbtn){var K=fightv2_atkbtn.getAttribute("href"),K=K.replace(/click_amt=\d+/,staminaSpendStrength),B=createAjaxPage(!0);fightv2_atkbtn.setAttribute("onclick",'do_ajax("'+B+"\",'"+K+"',1);return false;");autoReload(!1,"fight box attacking");a.attackAgain=fightv2_atkbtn;Autoplay.fx=function(){clickAction=isNewCity(city)||fightv2_atkbtn.innerHTML.match(/\d/i)?"multifight":"fight";clickContext=a;clickElement(fightv2_atkbtn);colorDEBUG("autoFight - Clicked to REPEAT the "+fightv2_atkbtn.innerHTML+" attack on "+a.name+".",cye)};Autoplay.delay=noDelay;Autoplay.start();return!0}colorDEBUG("SKIPPING the attack on "+a.name+" : fightv2_atkbtn NOT FOUND.",cre)}else colorDEBUG("SKIPPING the attack on "+a.name+" : fv2_btn_div / row INVALID / NOT FOUND.",cre)}if(h){a.toStrong&&setFightOpponentAvoid(a);if(!e&&g&&!a.iced&&-1!=a.id.indexOf("p|")){var Q=a.id.replace(/\D/g,"");getHelp(Q,a.name,a.level);colorDEBUG("Fight Response : liveTarget detected and LiveLinks feed entry sent")}try{(d||f||g)&&logFightOutcome(a,e);if(!autoFight.revengeTarget){var M=xpathFirst('.//a[@class="close" and contains(@onclick,"CloseJS")]',r);M&&(clickElement(M),xpathFirst('.//div[@id="fv2_widget_wrapper" and contains(@style,"none")]',innerPageElt)&&destroyByID("fv2_widget_wrapper"))}if(isGMChecked("autoGlobalPublishing")&&!timeLeftGM("askFightBoostsTimer")&&xpathFirst('.//div[@class="fv2_boost_ask_allowed" and not(contains(@style,"none"))]',r)){var L=xpathFirst('.//div[@class="fv2_boost_ask_action"]//a',r);L&&(clickElement(L),setGMTime("askFightBoostsTimer","01:00:05"))}GM_getValue("staminaSpendHow")==getStaminaMode()&&cycleSavedList("pfightlist");randomizeStamina();Autoplay.delay=getAutoPlayDelay();return!1}catch(P){}}else return a.fightsDone&&logFightOutcome(a,e),GM_getValue("staminaSpendHow")==getStaminaMode()&&cycleSavedList("pfightlist"),randomizeStamina(),Autoplay.delay=getAutoPlayDelay(),!1;var J=c.innerHTML,z=J.untag();if(z.match(/you won/i)){var S=xpathFirst('.//div[@class="fightres_stats"]',c);if(S){var H=xpathFirst('.//div[@class="sexy_cash good"]',S),s=xpathFirst('.//div[@class="fightres_experience good"]',S),I=xpathFirst('.//div[@class="fightres_damage"]',S);addToLog("yeah Icon","You"+I.innerHTML+', gaining <span class="good">'+H.innerHTML+'</span> and <span class="good">'+s.innerHTML+"</span>")}}else if(z.match(/you cannot fight|part of your mafia/i))a.id&&(DEBUG("Opponent ("+a.id+") is part of your mafia. Avoiding."),setFightOpponentAvoid(a));else if(z.match(/You just set/)){cycleSavedList("pautoHitOpponentList");addToLog("yeah Icon",J);isGMChecked("bgAutoHitCheck")&&setGMTime("bgAutoHitTime","01:00");var N=xpathFirst('//a[@id="fb_dialog_cancel_button"]');if(N)return Autoplay.fx=function(){clickElement(N);DEBUG("Clicked Dismissed Popup!")},Autoplay.start(),!0}else z.match(/There is already a bounty/)||z.match(/You can\'t add/)?(cycleSavedList("pautoHitOpponentList"),isGMChecked("bgAutoHitCheck")&&setGMTime("bgAutoHitTime","01:00")):-1!=z.indexOf("too weak")?addToLog("info Icon",'<span style="color:#FF9999;">Too weak to fight.</span>'):DEBUG("Unrecognized fight response:"+z);randomizeStamina();GM_getValue("staminaSpendHow")==getStaminaMode()&&cycleSavedList("pfightlist")}catch(R){colorDEBUG("respError: "+R)}return!1}function randomizeStamina(){if(isGMEqual("staminaSpendHow",STAMINA_HOW_RANDOM)){for(var b=GM_getValue("randomSpendModes"),c=Math.floor(Math.random()*STAMINA_HOW_ROBBING);"1"!=b[c];)c=Math.floor(Math.random()*STAMINA_HOW_ROBBING);DEBUG("Stamina Spend Mode Randomize set to : "+c+" was "+newStaminaMode);newStaminaMode=c;for(b=GM_getValue("randomFightLocations");c==STAMINA_HOW_FIGHT_RANDOM||c==STAMINA_HOW_FIGHT_LIST;){var a=Math.floor(Math.random()*(cities.length-1));DEBUG("Fight City Randomize set to : "+a+" was "+GM_getValue("fightLocation"));if("1"==b[a]&&!cities[a][CITY_CLOSED]){GM_setValue("fightLocation",a);DEBUG("Fight location set to : "+cities[a][CITY_NAME]);break}else DEBUG("Fight location did not qualify")}for(b=GM_getValue("randomRobLocations");c==STAMINA_HOW_ROBBING;)if(a=Math.floor(Math.random()*(cities.length-1)),DEBUG("Rob City Randomize set to : "+a+" was "+GM_getValue("robLocation")),"1"==b[a]&&!cities[a][CITY_CLOSED]){GM_setValue("robLocation",a);DEBUG("Robbing location set to : "+cities[a][CITY_NAME]);break}else DEBUG("Rob location did not qualify");for(b=GM_getValue("randomHitmanLocations");c==STAMINA_HOW_HITMAN;)if(a=Math.floor(Math.random()*(cities.length-1)),DEBUG("Hitman City Randomize set to : "+a+" was "+GM_getValue("hitmanLocation")),"1"==b[a]&&!cities[a][CITY_CLOSED]){GM_setValue("hitmanLocation",a);DEBUG("Hitman location set to : "+cities[a][CITY_NAME]);break}else DEBUG("Hitman location did not qualify")}}function createAjaxPage(b,c,a){b&&(ajaxHandling=!0);var d=b?SCRIPT.ajaxIDSync:SCRIPT.ajaxIDAsync,e=document.getElementById(d);e&&(e.removeEventListener("DOMSubtreeModified",handleAjaxModified,!1),e.parentNode.removeChild(e));e=makeElement("div",null,{id:d,style:"display: none;"});b||(ajaxAction=c,ajaxContext=a);e.addEventListener("DOMSubtreeModified",handleAjaxModified,!1);document.getElementById("verytop").appendChild(e);return d}function handleAjaxModified(b){var c=b.target;c.removeEventListener("DOMSubtreeModified",handleAjaxModified,!1);window.setTimeout(function(){ajaxPageChanged(c)},350)}function ajaxPageChanged(b){if(b){var c=b.id==SCRIPT.ajaxIDSync?!0:!1,a=b.innerHTML;b.parentNode.removeChild(b);var d;c?(b=clickAction,d=clickContext,clickContext=clickAction=void 0):(b=ajaxAction,d=ajaxContext,ajaxContext=ajaxAction=void 0);ajaxHandling=!1;if(!logJSONResponse(c,a,b,d))try{doAutoPlay()}catch(e){DEBUG("BUG DETECTED (ajaxPageChanged->doAutoPlay): "+e+". Reloading."),autoReload(!0,"error !logJSONResponse")}}}function logJSONResponse(b,c,a,d){ajaxHandling=!1;if("goHome"==a)return!1;colorDEBUG("logJSONResponse ("+a+") default fx: goHome, delay: "+Autoplay.delay,cfu);autoReload(!1,"logJSONResponse");var e=c.untag(),f,g,h,k;try{if(IsJsonString(e))try{h=JSON.parse(e),h.data&&IsJsonString(h.data)&&(k=JSON.parse(h.data)),jsonPageUpdate(h),void 0!==typeof h.user_fields.user_health&&(health=parseInt(h.user_fields.user_health)),void 0!==typeof h.user_fields.user_stamina&&(stamina=parseInt(h.user_fields.user_stamina)),void 0!==typeof h.user_fields.user_energy&&(energy=parseInt(h.user_fields.user_energy))}catch(l){DEBUG("Invalid JSON response."),colorDEBUG("Invalid JSON response<br>"+e)}if("collect take"==a||"quick deposit"==a||"quick withdraw"==a){isNaN(d)||(d=parseInt(d),cashElt=document.getElementById("user_cash_"+cities[d][CITY_ALIAS]));if("quick deposit"==a&&d!=LV)f=isNaN(h.user_cash)?null:parseInt(h.user_cash);else if(f=isNaN(k.cash)?null:parseInt(k.cash),"collect take"!=a&&(g=parseInt(k.acct_balance),GM_getValue("vaultHandling",0)||"check property"==a))try{colorDEBUG("parsing json response for: "+a);var n=k.properties;if(void 0===typeof k.success_message){colorDEBUG("respProp:"+JSON.stringify(n));var o=parseInt(n[5].level),p=vaultLevels[o][1]-g;"check property"==a&&(o!=GM_getValue("vaultHandling",0)||p!=GM_getValue("vaultSpace",0))?addToLog(cities[LV][CITY_CASH_CSS],"Parsed new vault status: Level "+o+", free vault space: V$"+makeCommaValue(p)):"check property"==a&&addToLog(cities[LV][CITY_CASH_CSS],"No change in your vault: Level "+o+", free vault space: V$"+makeCommaValue(p));GM_setValue("vaultHandling",o);GM_setValue("vaultSpace",""+p)}else addToLog(cities[LV][CITY_CASH_CSS],"Check vault status : "+k.success_message)}catch(q){colorDEBUG("vaultErr: "+q)}null!=f&&(cashElt&&(cashElt.innerHTML=cities[d][CITY_CASH_SYMBOL]+makeCommaValue(f)),cities[d][CITY_CASH]=f)}switch(a){case"ask parts":return DEBUG("logJSONResponse for ask parts"),!1;case"autoStatAllocation":return DEBUG("autoStatAllocation results "+e),!1;case"load battlepage":return!1;case"collect slotbonus":slotBonus=0;addToLog("info Icon","Slot Bonus Collect Result: "+k.json_data.dialog_message+" itemName:  "+k.json_data.itemName);break;case"collect slot":slotSpins=k.json_data.freeSpins;slotBonus=k.json_data.bonusMeter;e="";e=k.json_data.isJackpot?e+("You won on the slots! Payout: "+k.json_data.payout+"  jackpotWinAmt: "+k.json_data.jackpotWinAmt):e+("You did not win on this slot pull.  Remaining Spins: "+slotSpins);addToLog("info Icon",e);DEBUG("Result: "+k.json_data.result+" bonusMeter:"+k.json_data.bonusMeter+" payout:"+k.json_data.payout+" isJackpot:"+k.json_data.isJackpot+" jackpotWinAmt:"+k.json_data.jackpotWinAmt+" freeSpins"+k.json_data.freeSpins);break;case"autoStatReward":return DEBUG("autoStatReward results "+e),!1;case"autoUpgradeNY_getBalance":var u=h.user_fields.user_bank_balance+"";GM_setValue("userBankBalance",u);addToLog("updateGood Icon","Current NY Bank Balance: $"+u);return!1;case"autoUpgradeNY":var A=JSON.stringify(k),e="",u=h.user_fields.user_bank_balance+"";GM_setValue("userBankBalance",u);if(-1!=A.indexOf("description")){if(e=k.description,-1!=e.indexOf("You have purchased")){var v=GM_getIntValue(d,999);v++;GM_setValue(d,v);addToLog("updateGood Icon",e+". Current Level: "+v+'. Current NY Bank Balance: <span class="good">$'+makeCommaValue(u)+"</span>.")}}else addToLog("updateBad Icon",e+'. Current NY Bank Balance: <span class="good">$'+makeCommaValue(u)+"</span>."),GM_setValue(d,999);goPropertyNav();return!1;case"icecheck profile":var w=!/is already dead or too weak!/.test(e);d&&(d.setAttribute("style","background: "+(w?"green;":"red;")),d.setAttribute("title",(w?"Target is alive":"Target is iced")+", click to refresh."),d.addEventListener("click",customizeProfile,!1),DEBUG("Successfully set target status: "+(w?"alive.":"iced.")));return!1;case"fight":var G=xpathFirst('.//div[@id="fv2_widget_wrapper"]',innerPageElt);return logFightResponse(innerPageElt,G,d,0,h);case"multifight":return G=xpathFirst('.//div[@id="fv2_widget_wrapper"]',innerPageElt),logFightResponse(innerPageElt,G,d,1,h);case"keelBandit":return!1;case"newcity job":k=!1;var y,F,C,r,t,O,E;if(IsJsonString(e)){colorDEBUG("jobResult for 'newcity job' is a json string ...",cgr);var D=xpathFirst('.//a[contains(@id, "btn_dojob")]',d);try{unsafeWindow.BrazilJobs.doJob(h,D)}catch(K){colorDEBUG("doJob:"+K,cye)}try{if(void 0!==typeof h.jobResult){var B=h.jobResult;colorDEBUG(JSON.stringify(B));y=B.city;y-=1;F=B.name;C=B.experience;r=makeCommaValue(parseCash(B.cash));t=makeCommaValue(parseCash(B.cashUsed));O=B.loot[0];colorDEBUG("Loot:<br>"+JSON.stringify(B.loot));var Q=parseInt(B.masteryTotal),M=parseInt(B.masteryIncrease);E=Q+M;var L=B.mastered;if(100<=E||L)k=!0,E=100;logTxt=r&&"0"!=r?'RX6 performed <span class="job">'+F+'</span>, earning <span class="good">'+cities[y][CITY_CASH_SYMBOL]+r+'</span> and <span class="good">'+C+" experience</span>":C?'RX6 performed <span class="job">'+F+'</span>, earning <span class="good">'+C+' experience</span>. RX6 spent <span class="bad">'+cities[y][CITY_CASH_SYMBOL]+t+"</span>":'RX6 performed <span class="job">'+F+"</span>";if(void 0!==typeof B.itemsUsed){itemsUsed=B.itemsUsed;var P=itemsUsed.length;if(0<P){e="";logTxt+=" and used ";for(s=0;s<P;s++)usedQty=itemsUsed[s].quantity,1==usedQty?(usedItem=itemsUsed[s].item.quantified_singular_name,logTxt+=e+'<span class="bad">'+usedItem+"</span>"):(usedItem=itemsUsed[s].item.name,logTxt+=e+'<span class="bad">'+usedQty+" x "+usedItem+"</span>"),e=" and "}}logTxt+=".";DEBUG("Job "+F+" ("+Q+"%) is now "+E+"% mastered, mastery increased by "+M+"%.");logTxt&&addToLog("process Icon",logTxt);if(O){colorDEBUG("jobLoot detected");logLootDrops(d,"newcity job");var J,z=!0,S=[];requirementJob.forEach(function(a){a[1].toUpperCase().trim()==F.toUpperCase().trim()&&(S.push(a[0]),DEBUG("Matching Item: "+a[0]+" from "+a[1]))});var H=getSavedList("itemList");if(0==S.lenght||"undefined"==typeof H[0]||0==H.length||!1==z)DEBUG("No relevant loot found or no needed items in required item list.");else for(;J=S.pop();){DEBUG("Checking to see if "+J+" is needed ...");for(var s=0;s<H.length;s++){if(-1!=J.indexOf(H[s].trim()))return DEBUG("Check ! "+J+" is the item we are looking for."),removeSavedListItem("itemList",J),removeJobForItem("jobsToDo",J),popJob(),!1;DEBUG("Oops ! "+J+" is NOT the item we are looking for.")}}}}}catch(I){}try{if(void 0!==typeof h.data.impulseBuy.message){var N=h.data.impulseBuy.message;if(-1!=N.indexOf("loot drops")){var R=xpathFirst(".//h4",d).innerHTML.trim();DEBUG("Seems RX6 needs (some) items to perform: "+R);var U=/p&gt;(.+)\u00D7/i.exec(N)[1];if(U){addToLog("info Icon",'Item(s) required to perform <span class="job">'+R+'</span>: <span class="loot">'+U+"</span>.");var H=getSavedList("itemList"),X=getSavedList("jobsToDo","");-1==X.indexOf(R)?(X.push(R),DEBUG("Saving "+R+" for later. Fetching pre-req items first."),setSavedList("jobsToDo",X)):DEBUG(R+" already saved for later. Fetching pre-req items first.");z=!1;requirementJob.forEach(function(a){if(level>=cities[a[2]][CITY_LEVEL]&&a[0].toUpperCase().trim()==U.toUpperCase().trim()){X.push(a[1]);H.push(U.trim());z=true;jobFound=a[1]}});if(z)return setSavedList("itemList",H.unique()),setSavedList("jobsToDo",X),popJob(),!1;DEBUG(U+" not found in the requirement job array.")}}if(-1!=N.indexOf("following items")){var N=N.wipe(),da=D.id;da.match(/dojob_(\d+)/i)&&(da=RegExp.$1);N.match(/job:(.+)Cost/)?addToLog("warning Icon",'RX6 needs to buy these item(s): <span class="loot">'+RegExp.$1+"</span>."):addToLog("warning Icon",N);var T=D.getAttribute("href");if(T&&da){/tab=([\d]+)/.exec(T);var ja=/tmp=([\da-f]+)/.exec(T)[1],V=/cb=([\da-f]+)/.exec(T)[1],ea=/xw_person=([\d]+)/.exec(T)[1],Z=createAjaxPage(!0),na=makeElement("a",null,{onclick:'return do_ajax("'+Z+'","remote/html_server.php?xw_controller=job&xw_action=buy_required_items&xw_city='+cities[city][CITY_NUMBER]+"&tmp="+ja+"&cb="+V+"&xw_person="+ea+"&jobId="+da+"&cityId="+cities[city][CITY_NUMBER]+'&xw_client_id=8", 1, 1, 0, 0); return false;'});if(na)return clickAction="newcity buy",clickContext=city,clickElement(na),!1}}}}catch(ta){}}else colorDEBUG("jobResult for 'newcity job' is not a json string ...",cre),F=xpathFirst(".//h4",d).innerHTML.untag().trim(),(C=xpathFirst('.//ul[contains(@class,"pays")]//li[@class="experience"]',d))&&(C=parseInt(C.getAttribute("base_value"))),(r=xpathFirst('.//ul[contains(@class,"pays")]//li[contains(@class,"cash_icon_jobs")]',d))&&parseInt(r=r.getAttribute("base_value")),(t=xpathFirst('.//ul[contains(@class,"uses")]//li[contains(@class,"cash_icon_jobs")]',d))?(t=parseInt(t.getAttribute("base_value")),logTxt='RX6 performed <span class="job">'+F+'</span>, earning <span class="good">'+C+' experience</span>. RX6 spent <span class="bad">'+cities[city][CITY_CASH_SYMBOL]+makeCommaValue(t)+"</span>."):logTxt='RX6 performed <span class="job">'+F+'</span>, earning <span class="good">'+cities[city][CITY_CASH_SYMBOL]+makeCommaValue(r)+'</span> and <span class="good">'+C+" experience</span>.",logTxt&&addToLog("process Icon",logTxt),E=getBrazilJobMastery(d),100<=E&&(k=!0,E=100),DEBUG("Job "+F+" is "+E+"% mastered.");k&&!isGMChecked("repeatJob")&&goJobsNav();return!1;case"newcity buy":DEBUG("newcity buy results<br>"+e);try{void 0!==typeof h.data.impulseBuy.message&&(N=h.data.impulseBuy.message,DEBUG("newcity buy jobMessage:"+N),N=N.wipe(),N.match(/You bought:(.+)/)?addToLog("info Icon",'RX6 bought these item(s): <span class="loot">'+RegExp.$1+"</span>."):addToLog("info Icon",N))}catch(ra){colorDEBUG("Error no MessageResult: "+ra,cre)}return!1;case"check property":switch(d){case LV:GM_setValue("vegasReport",JSON.stringify(k));case BRAZIL:GM_setValue("brazilReport",JSON.stringify(k));case CHICAGO:GM_setValue("chicagoReport",JSON.stringify(k));case LONDON:GM_setValue("londonReport",JSON.stringify(k))}return!1;case"vegas parts":return setGMTime("askVegasPartsTimer","2 hours"),DEBUG("Parsed JSONResponse for clicking askVegasParts. Timer Reset for 2 hours."),!1;case"play slots":return setGMTime("askPlaySlotsTimer","4 hours"),DEBUG("Parsed JSONResponse for clicking AskPlaySlots. Timer Reset for 4 hours."),!1;case"brazil parts":return setGMTime("askBrazilPartsTimer","2 hours"),DEBUG("Parsed JSONResponse for clicking AskBrazilParts. Timer Reset for 2 hours."),!1;case"chicago parts":return setGMTime("askChicagoPartsTimer","2 hours"),DEBUG("Parsed JSONResponse for clicking AskChicagoParts. Timer Reset for 2 hours."),!1;case"london parts":return setGMTime("askLondonPartsTimer","2 hours"),DEBUG("Parsed JSONResponse for clicking AskLondonParts. Timer Reset for 2 hours."),!1;case"save properties":return!1;case"build limited":var aa=d.propCount,ka=cityProperties[aa][ctPropName],ba=cityProperties[aa][ctPropTimer];""!=e?(addToLog("process Icon",ka+": "+e),setGMTime(ba,"18 hours")):(addToLog("warning Icon",ka+": RX6 can not craft yet."),setGMTime(ba,"1 hour"));return!1;case"build other":var aa=d.propCount,oa=cityProperties[aa][ctGMId],ka=cityProperties[aa][ctPropName],ba=cityProperties[aa][ctPropTimer],fa=cities[cityProperties[aa][ctPropCity]][CITY_NAME];DEBUG("Make "+fa+": "+d.itemName+" - "+d.buildType+".");s=h=0;addToLog("lootbag Icon",k.purchase_message);if(e.match(/cannot be purchased/i))return DEBUG(d.itemName+" can not be build, disabling"),GM_setValue(oa,0),!1;if(e.match(/available_purchases(.+?)(\d+?),/i)&&(h=parseFloat(RegExp.$2),DEBUG("Available Purchases Left: "+RegExp.$2),h))return!1;e.match(/purchase_refresh_rate(.+?)(\d+?),/i)&&(h=parseFloat(RegExp.$2),DEBUG("Refresh Rate: "+RegExp.$2));e.match(/last_purchase_time_stamp(.+?)(\d+?),/i)&&(s=parseFloat(RegExp.$2),DEBUG("timeStamp: "+RegExp.$2));if(h&&s){k=s+h;var Y=Math.round((new Date).getTime()/1E3);DEBUG("Current: "+Y);if(Y<k){var la=parseFloat(k)-parseFloat(Y)+10;DEBUG("timeLeft: "+la);var ca=secondsToHMS(la);1==ca?ca+=" hour":ca+=" hours";setGMTime(ba,ca);DEBUG("Parsed JSONResponse for "+fa+" Item. Timer "+ba+" reset for "+ca+".")}else setGMTime(ba,"2 hours"),DEBUG("Parsed JSONResponse for "+fa+" Item. Timer reset for 2 hours."),colorDEBUG(e)}else setGMTime(ba,"2 hours"),DEBUG("Parsing JSONResponse for "+fa+" Item FAILED. Timer reset for 2 hours."),colorDEBUG(e);return!1;case"collect take":var ga=JSON.stringify(k),e="",e=-1!=ga.indexOf("description")?k.description:k.success_message;if(e.match(/collected (.+?) from your properties/i)){var W='RX6 have collected <span class="money">'+RegExp.$1+"</span> from your properties.";addToLog(cities[d][CITY_CASH_CSS],W)}if(e.match(/you have also received:/i)){var pa=k.success_image_names;if(0<pa.length){W="You have also received : ";collectHelp="";s=0;for(P=pa.length;s<P;s++)W+=collectHelp+pa[s].untag(),collectHelp=s==P-1?", ":" and ";addToLog(cities[d][CITY_CASH_CSS],W)}}switch(d){case NY:if(-1!=ga.indexOf("shopname")&&-1!=ga.indexOf("vehicleamount")&&-1!=ga.indexOf("vehiclename")){var ua=k.shopname,qa=k.vehicleamount,Da=k.vehiclename;if(0<qa.length){W="RX6 also collected ";collectHelp="";s=0;for(P=qa.length;s<P;s++)W+=collectHelp+'<span class="property">'+qa[s]+'</span> <span class="loot">'+Da[s]+'</span> items from your <span class="property">'+ua[s]+"</span>",collectHelp=s==P-1?", ":" and ";addToLog(cities[d][CITY_CASH_CSS],W)}}}setGMTime("takeHour"+cities[d][CITY_NAME],"1 hour");return!1;case"quick withdraw":var xa="<br>Remaining Bank Balance: "+cities[d][CITY_CASH_SYMBOL]+makeCommaValue(g);/You Withdrew/i.test(k.success_message)?addToLog("cashVegas Icon",k.success_message+xa):(addToLog("warning Icon","Disabling autoMission:<br>You don't have enough money to do "+missions[GM_getValue("selectMission",1)][MISSION_NAME]+"."+xa),GM_setValue("autoMission",0),update_nrg_stam());return!1;case"quick deposit":city!=d&&addToLog("warning Icon","Warning! You have traveled from "+cities[d][CITY_NAME]+" to "+cities[city][CITY_NAME]+" while banking. Check your money.");s="";s=d==LV?k.success_message:h.deposit_message;if(s.match(/([0-9,,]+).+?was deposited/i)||s.match(/You Deposited .\$([0-9,,]+) into your Vault/i))quickBankFail=!1,addToLog(cities[d][CITY_CASH_CSS],'<span class="money">'+cities[d][CITY_CASH_SYMBOL]+RegExp.$1+"</span> was deposited "+(d==LV?"into your vault.":"in your account after the bank's fee."));else if(/cannot deposit this much/i.test(s)||/cannot deposit that much/i.test(s)){quickBankFail=!1;var ha="You can't deposit this much (you don't have enough cash or your vault is to small).";GM_getValue("vaultHandling",0)||(ha+="<br>Please consider enabling RX6 MWAP vault handling.");addToLog(cities[d][CITY_CASH_CSS],ha)}else/cannot deposit any more/i.test(s)?(quickBankFail=!1,ha="You can't deposit anymore, your vault is full!",GM_getValue("vaultHandling",0)||(ha+="<br>Please consider enabling RX6 MWAP vault handling."),addToLog(cities[d][CITY_CASH_CSS],ha),GM_getValue("vaultHandling",0)&&GM_setValue("vaultSpace","0")):/invalid amount/i.test(s)?quickBankFail=!1:/have enough money/.test(s)?quickBankFail=!1:/deposit at least/.test(s)&&s.match(/([0-9,,]+)/)?quickBankFail=!1:null==k.result||0==g?(quickBankFail=!1,addToLog(cities[d][CITY_CASH_CSS],"Depositing failed without a response; if you are in Las Vegas, perhaps you don't have a vault yet?"),GM_getValue("vaultHandling",0)&&GM_setValue("vaultSpace","0")):(quickBankFail=!0,addToLog("warning Icon","Quick Deposit failed: Unknown JSON response:<br>"+e));return!1;case"marketplace":var ma=xpathFirst('.//div[@id="responseContainer"]');ma||(ma=makeElement("div",document.getElementById("final_wrapper"),{id:"responseContainer",style:"display:none;"}));ma.innerHTML=c;var ia=makeElement("div",null,{id:"marketInfo",style:"clear:both; width: 745px;","class":"clearfix"}),ya=makeElement("div",ia,{id:"FightClubModule",style:"float: left; width: 735px;","class":"empire_module_header"}),va=makeElement("div",ya,{"class":"empire_module_title"});makeElement("span",va).appendChild(document.createTextNode("Fight Club"));var za=xpathFirst('.//img[contains(@src,"victory_icon.gif")]',ma);za&&(vcElt=za.parentNode)&&(makeElement("div",va,{style:"float:right;margin-right:15px"}).innerHTML+=vcElt.innerHTML);var Aa=xpathFirst('.//div[@class="fightmastery_meter"]',ma);Aa&&(makeElement("div",va,{"class":"fightmastery_meter",style:"float:right;margin-right:45px;margin-top:-1px;"}).innerHTML+=Aa.innerHTML);var Ba=xpathFirst('.//div[@id="full_list"]',ma);if(Ba){var Ea=makeElement("div",ya,{style:"width: 729px; padding: 5px; float: none;","class":"playerupdate_box"}),wa=makeElement("div",Ea),sa=$x('.//div[contains(@style,"relative")]',Ba);if(0<sa.length){k=0;for(s=sa.length-1;0<=s;s--)9<=k&&1<s||(secondElt=sa[s].firstChild.nextSibling,fourthElt=sa[s].firstChild.nextSibling.nextSibling.nextSibling,1<s?(itemListElt=makeElement("div",null,{style:"float: left; width: 220px;height:135px;border:1px dotted #484848;padding:10px;"}),wa.appendChild(itemListElt)):(itemListElt=makeElement("div",null,{style:"float: left; width: 340px;height:125px;border:1px dotted #484848;padding:10px;"}),wa.insertBefore(itemListElt,wa.firstChild)),itemListElt.innerHTML=secondElt.innerHTML+fourthElt.innerHTML,k++);makeElement("div",ia,{style:'float: left; background: url("http://mwfb.static.zgncdn.com/mwfb/graphics/empire/shadow_upper_right.png") no-repeat scroll 0% 0% transparent; height: 8px; width: 8px;'});makeElement("div",ia,{style:'float: left; background: url("http://mwfb.static.zgncdn.com/mwfb/graphics/empire/shadow_right_side.png") repeat-y scroll 0% 0% transparent; height: 310px; width: 8px;'});makeElement("div",ia,{style:'float: left; background: url("http://mwfb.static.zgncdn.com/mwfb/graphics/empire/shadow_lower_left.png") repeat scroll 0% 0% transparent; height: 8px; width: 8px;'});makeElement("div",ia,{style:'float: left; background: url("http://mwfb.static.zgncdn.com/mwfb/graphics/empire/shadow_bottom.png") repeat scroll 0% 0% transparent; height: 8px; width: 727px;'});makeElement("div",ia,{style:'float: left; background: url("http://mwfb.static.zgncdn.com/mwfb/graphics/empire/shadow_lower_right.png") repeat scroll 0% 0% transparent; height: 8px; width: 8px;'})}}d.appendChild(ia);postSize();return!1;default:return colorDEBUG('BUG DETECTED: Unrecognized JSON action "'+a+'".<br>'+e),!1}}catch(Ca){return DEBUG("Exception (logJSONResponse): "+Ca+", autoplay: "+b+", action: "+a),colorDEBUG("Exception (logJSONResponse): "+Ca+", autoplay: "+b+", action: "+a+", context: "+d+", response: <br>"+c),!1}}function logResponse(b,c,a){if("goHome"==c)return!1;var d;Autoplay.fx=goHome;Autoplay.delay=getAutoPlayDelay();colorDEBUG("logResponse ("+c+") default fx: goHome, delay: "+Autoplay.delay,cfu);if("fight"==c||"multifight"==c){autoReload(!1,"logResponse - fight");var e=xpathFirst('.//div[@id="fv2_widget_wrapper"]',b);e||(e=xpathFirst('.//div[@class="fight_results"]',b));if(!e&&GM_getValue("staminaSpendHow")==getStaminaMode())return cycleSavedList("pfightlist"),!1;switch(c){case"fight":return logFightResponse(innerPageElt,e,a,0);case"multifight":return logFightResponse(innerPageElt,e,a,1)}}if("load clan"==c&&(DEBUG("Are we on the clan page we want to be on?"),onClanNav(GM_getValue("AutoBattleClanID",0))))if(DEBUG("Looking for Challenge Link"),e=xpathFirst('.//a[contains(@href,"xw_controller=epicBattle&xw_action=challengePop")]',b))DEBUG("We found the challenge button, clicking it"),setGMTime("autoBattleTimer","60:00"),clickAction="battlePop",clickElement(e);else return DEBUG("No Challenge Popup found check again in 10 minutes"),setGMTime("autoBattleTimer","10:00"),Autoplay.delay=getAutoPlayDelay(),Autoplay.start(),!0;if("load battlepage"==c)return!1;if("load battlecollect"==c&&onBattlePage(1))return DEBUG("Looking for Battle Collect Link"),(e=xpathFirst('.//a[contains(@onclick,"xw_controller=epicBattle&xw_action=getResults") and contains(.,"Collect")]'))?(DEBUG("Found a Battle Collect link clicking it"),setGMTime("autoBattleCollectTimer","05:00"),clickElement(e)):(DEBUG("No Battle Collect link found"),setGMTime("autoBattleCollectTimer","60:00")),Autoplay.delay=getAutoPlayDelay(),Autoplay.start(),!0;d||(d=xpathFirst('.//div[@id="default_id_box"]',b));d||(d=xpathFirst('.//div[contains(@class,"message_body")]',b));d||(d=xpathFirst('.//div[@class="job_results"]',b));d||(d=xpathFirst('.//div[contains(@class,"job_controller")]',contentRoweElt));d||(d=xpathFirst('.//div[@id="msg_box_div_1"]',b));d||(d=xpathFirst('.//div[@id="mbox_generic_1"]',b));d||(d=xpathFirst('.//div[@id="bank_messages"]',appLayoutElt));d||(d=xpathFirst('.//div[@id="hospital_message"]',appLayoutElt));d||(d=xpathFirst('.//div[@id="'+a+'" and @class="rob_slot"]',b));d||(d=xpathFirst('.//div[@class="rob_board"]',b));d||(d=xpathFirst('.//div[@class="chop_build_final"]',appLayoutElt));d||(d=xpathFirst('.//table[@class="messages"]',b));if("withdraw"==c&&a)return autoBankWithdraw(a),Autoplay.start(),!0;if(!d){if("load clan"==c||"load battlecollect"==c||"battlePop"==c)return!0;if("autohit"==c)return!1;if("fight"==c||"multifight"==c)return colorDEBUG(" we have passed all message boxes but have action (multi)fight  ",cbl),GM_getValue("staminaSpendHow")==getStaminaMode()&&cycleSavedList("pfightlist"),!1;d=b}skipStaminaSpend=!1;var f=d?d.innerHTML:"",e=f.untag(),g;switch(c){case"autohit":case"fight":return e=xpathFirst('.//div[@id="fv2_widget_wrapper"]',innerPageElt),logFightResponse(innerPageElt,e,a,0);case"multifight":return e=xpathFirst('.//div[@id="fv2_widget_wrapper"]',innerPageElt),logFightResponse(innerPageElt,e,a,1);case"load battlecollect":DEBUG("We have a load battlecollect message box to handle.. doing nothing..");break;case"keelBandit":colorDEBUG("normal LogResponse Action : Bandit Keel'ed");break;case"newcity job":break;case"autoStatAllocation":DEBUG("autoStatAllocation results");break;case"autoStatReward":DEBUG("autoStatReward results");break;case"autoRob":return isGMChecked("fastRob")?(randomizeStamina(),Autoplay.fx=goRobbingTab,Autoplay.delay=noDelay,Autoplay.start(),!0):logRobResponse(b,d,a);case"operationsTask":n=!1;if(opsInfo=getOperationsInfo(a,a.slot,"result"))opsInfo.taskFailed?(e='RX6 failed to performed <span class="job">'+opsInfo.name+"/"+opsInfo.taskName+"</span>.",addToLog("bad Icon",e+".")):(e='RX6 performed <span class="job">'+opsInfo.name+"/"+opsInfo.taskName+'</span>, gaining <span class="good">'+opsInfo.xp+" experience</span>",opsInfo.cash&&(e+=' and <span class="good">'+cities[opsInfo.cashCity][CITY_CASH_SYMBOL]+opsInfo.cash+"</span>"),opsInfo.cashNeeded&&(e+='. RX6 used <span class="bad">'+cities[opsInfo.cashNeededCity][CITY_CASH_SYMBOL]+opsInfo.cashNeeded+"</span>"),DEBUG("Operation is "+opsInfo.taskMastery+" % Mastered"),addToLog("process Icon",e+"."));break;case"job":try{var h;xpGainElt=(xpGainElt=xpathFirst('.//dd[@class="message_experience"]',d))?xpGainElt:xpathFirst('.//dd[@class="experience"]',d);var k="job"+a[0];jobName=a[1];var l=xpathFirst('.//div[@id="'+k+'"]',b);h=xpathFirst('.//div[@id="'+k+'"]//div[@class="mastery_bar"]//p',b);var k="",n=!1;h&&"0.0"!=GM_getValue("selectTier","0.0")&&(k=parseInt(h.innerHTML.replace(/\D/g,"")),DEBUG(" Job "+jobName+" is "+k+"% Mastered."),100==k&&(k=". Job 100% Mastered",n=!0));if(xpGainElt){var o=parseInt(xpGainElt.innerHTML);if(o){var p=xpathFirst('.//div[@class="message_experience"]',d);p&&(o+="+"+parseInt(p.innerHTML));o+=" Experience"}g='RX6 performed <span class="job">'+jobName+'</span> earning <span class="good">'+o+"</span>";var f="",q=$x('.//dd[@class="message_cash"]',d);for(i=0;i<q.length;i++)f+=q[i].innerHTML;if(0==q.length&&(cashGainElt=xpathFirst('.//dd[contains(@class,"cash_icon")]',d)))f=cashGainElt.innerHTML,f=f.match(REGEX_CASH)?cities[city][CITY_CASH_SYMBOL]+RegExp.lastMatch:cities[city][CITY_CASH_SYMBOL]+f;f.match(/(.+?)\s+?\(You now have/i)&&(f=RegExp.$1);f&&(g+=' and <span class="good">'+f+"</span>");var u=xpathFirst('.//dt[@class="message_cash bad"]',d);u||(u=xpathFirst('.//div[@class="job_uses"]//dd[contains(@class,"cash_icon")]',d));if(u){var A=u.innerHTML.untag();A.match(/(.+?)\s+?Bribes/)&&(A=RegExp.$1);g+=', spending <span class="bad">'+cities[city][CITY_CASH_SYMBOL]+A+"</span>"}h&&(g+=k);g+=".";if(-1!=e.indexOf("you spent no energy")||-1!=e.indexOf("No energy cost")||-1!=e.indexOf("You Spent: 0"))g+=" RX6 spent no energy on this job.";var v=xpathFirst('.//dd[@class="stamina"]',d);v&&(g+=" Stamina spent: "+v.innerHTML.untag()+".");var w=xpathFirst('.//dd[@class="energy"]',d);w&&(nrgSpendTxt=w.innerHTML.untag(),g=-1!=nrgSpendTxt.indexOf("Mastery")?g+(" "+w.innerHTML.untag()+"."):g+(" Energy spent: "+w.innerHTML.untag()+"."));addToLog("process Icon",g);jobCombo(b);h?jobLoot(l):jobLoot(b);e.match(/.*(An* .+ was added to your inventory[^.]*.)/i)&&addToLog("lootbag Icon",RegExp.$1);var G=parseInt(xpGainElt.innerHTML),y=GM_getIntValue("autoAskJobHelpMinExp");if(isGMChecked("autoAskJobHelp")&&(!y||G>=y)){var F=xpathFirst('.//div[@class="message_buttons"]//span[@class="sexy_jobhelp"]',d);F||(F=xpathFirst('.//div[@class="message_buttons"]//a[@class="sexy_button_new short white sexy_call_new" and contains(.,"Let Friends Get a Bonus")]',d));if(F)return Autoplay.fx=function(){clickElement(F);addToLog("process Icon",'Asked for help with <span class="job">'+missions[GM_getValue("selectMission")][MISSION_NAME]+"</span>.")},Autoplay.start(),!0}}else-1!=e.indexOf("You are not high enough level to do this job")?(addToLog("warning Icon","You are not high enough level to do "+missions[GM_getValue("selectMission",1)][MISSION_NAME]+"."),addToLog("warning Icon","Job processing will stop"),GM_setValue("autoMission",0),update_nrg_stam()):-1!=e.indexOf("Success")?addToLog("process Icon",f):-1!=e.indexOf("Missing")?getJobRowItems(jobName)&&(DEBUG(" - - need items jobid="+jobid+" selectMission="+GM_getValue("selectMission",1)),jobid!=GM_getValue("selectMission",1)&&(Autoplay.fx=autoMission)):DEBUG("Unrecognized job response.");n&&(Autoplay.fx=goJobsNav);Autoplay.start();break}catch(C){alert(C)}break;case"hitman":if(-1!=e.indexOf("someone else took out")){DEBUG(f);break}b=-1!=e.indexOf("You knocked out");if(-1!=e.indexOf("You WON")){if(e.match(/gained.*?([A-Z]*?\$|\u00A2|\u00A3)([\d,]*\d)/i),g=RegExp.$1+RegExp.$2,f=e.match(/\d+\s+experience\s+points?/i),addToLog("yeah Icon","Hit "+linkToString(a.profile,"user")+', <span class="good">WON '+g+'</span> and <span class="good">'+f+"</span>."),g=parseCash(g),GM_setValue("hitmanWinCountInt",GM_getValue("hitmanWinCountInt",0)+1),GM_setValue("hitmanWinDollarsInt",""+(GM_getIntValue("hitmanWinDollarsInt",0)+g)),GM_setValue("totalExpInt",GM_getValue("totalExpInt",0)+parseInt(f)),GM_setValue("totalWinDollarsInt",""+(GM_getIntValue("totalWinDollarsInt",0)+g)),GM_setValue("cashWinsNY",""+(GM_getIntValue("cashWinsNY",0)+g)),!b&&canSpendStamina()&&6<ptsToNextLevel){var r;if(isGMChecked("staminaPowerattack")&&(isGMChecked("stopPA")&&health>=GM_getValue("stopPAHealth")||!isGMChecked("stopPA")))r=xpathFirst('.//a[contains(.,"Power Attack")]',d);r||(r=xpathFirst('.//a[contains(.,"Attack Again")]',d));if(r)return Autoplay.fx=function(){clickAction=c;clickContext=a;clickElement(r);DEBUG("Clicked to repeat the hit on "+clickContext.name+" ("+clickContext.id+").")},isGMChecked("noStats")||updateLogStats(STAMINA_HOW_HITMAN),Autoplay.delay=noDelay,Autoplay.start(),!0}}else-1!=e.indexOf("You LOST")?(e.match(/LOST.*?RegExp.$1/i),d=RegExp.$1+RegExp.$2,g="Hit "+linkToString(a.profile,"user")+' <span class="bad">LOST '+d+".</span>",d=parseCash(d),GM_setValue("hitmanLossCountInt",GM_getValue("hitmanLossCountInt",0)+1),GM_setValue("hitmanLossDollarsInt",""+(GM_getIntValue("hitmanLossDollarsInt",0)+d)),GM_setValue("totalLossDollarsInt",""+(GM_getIntValue("totalLossDollarsInt",0)+d)),GM_setValue("fightLoss$NY",""+(GM_getIntValue("fightLoss$NY",0)+d)),a.id&&(setHitmanOpponentAvoid(a),g+=" Avoiding."),addToLog("omg Icon",g)):-1!=e.indexOf("This player is currently part of your mafia")?a.id&&setHitmanOpponentAvoid(a):DEBUG(f);-1!=e.indexOf("You were snuffed")&&addToLog("updateBad Icon",'You <span class="bad">DIED</span>.');b&&(a.id&&addSavedListItem("hitmanListKilled",a.id,100),addToLog("killedMobster Icon",'RX6 <span class="bad">KILLED</span> '+linkToString(a.profile,"user")+' and collected the <span class="money">'+a.bounty+"</span> bounty set by "+linkToString(a.payer,"user")+"."),GM_setValue("hitmanWinCountInt",GM_getValue("hitmanWinCountInt",0)+1),GM_setValue("hitmanWinDollarsInt",""+(GM_getIntValue("hitmanWinDollarsInt",0)+parseCash(a.bounty))),GM_setValue("totalWinDollarsInt",""+(GM_getIntValue("totalWinDollarsInt",0)+parseCash(a.bounty))),GM_setValue("cashWinsNY",""+(GM_getIntValue("cashWinsNY",0)+parseCash(a.bounty))));isGMChecked("noStats")||updateLogStats(STAMINA_HOW_HITMAN);randomizeStamina();break;case"war":if(-1!=e.indexOf("Target user is not a friend")||-1!=e.indexOf("Target user does not exist"))removeSavedListItem("autoWarTargetList",a.target_id),addToLog("warning Icon","Invalid war target (id="+a.target_id+"). Removing from list.");else if(-1!=e.indexOf("is already at war with someone else"))addToLog("info Icon",f.split(".")[0]+". Cycling warlist. "),cycleSavedList("autoWarTargetList");else if(-1!=e.indexOf("You successfully betrayed")){addToLog("omg Icon",f.split("<br><br>")[0]+"</div>");break}else if(-1!=e.indexOf("You successfully declared war"))cycleSavedList("autoWarTargetList"),addToLog("yeah Icon",f);else if(-1!=e.indexOf("WON")||-1!=e.indexOf("LOST"))d=-1!=e.indexOf("LOST")?"omg Icon":"yeah Icon",-1!=e.indexOf("to winning this war.")&&addToLog(d,f.split("to winning this war.")[0]+"to winning this war.</div>");helpWar&&(GM_setValue("logPlayerUpdatesCount",1+GM_getValue("logPlayerUpdatesCount",0)),helpWar=!1);setGMTime("warTimer","00:00");Autoplay.fx=goWarTab;Autoplay.start();return!0;case"stats":if(e.match(/You just upgraded your (\w+) by (\d+)/i)){e=RegExp.$1;d=eval(e.toUpperCase()+"_STAT");f=e.toLowerCase()+" Icon";g=isNaN(RegExp.$2)?1:parseInt(RegExp.$2);GM_setValue("nextStat",(d+1)%4);switch(d){case ATTACK_STAT:curAttack+=g;break;case DEFENSE_STAT:curDefense+=g;break;case HEALTH_STAT:maxHealth+=g;break;case ENERGY_STAT:maxEnergy+=g;break;case STAMINA_STAT:maxStamina+=g}addToLog(f,'<span style="color:#885588;">'+e+" increased by "+g+" point(s).</span>")}else DEBUG("Failed to increment stat.");break;case"energypack":addToLog("energyPack Icon",'Used an <span class="good">Energy Pack</span>.');energyPackElt=void 0;DEBUG('Unrecognized response for "energypack" action : '+f);break;case"help":var t=xpathFirst('.//a[contains(.,"Help ")]',d);if(t)return Autoplay.fx=function(){clickElement(t);clickAction="help";clickContext=a},Autoplay.delay=getAutoPlayDelay(),Autoplay.start(),!0;GM_setValue("logPlayerUpdatesCount",1+GM_getValue("logPlayerUpdatesCount",0));g=linkToString(xpathFirst('.//a[contains(@onclick,"xw_controller=stats&xw_action=view")]',d),"user");a&&!g&&(g=a.user);-1!=e.indexOf("not your friend")||-1!=e.indexOf("You need to be friends")||-1!=e.indexOf("to help on a job.")?addToLog("info Icon","Failed to help"+(g?" "+g:"")+"with job. Reason: not friends."):-1!=e.indexOf("You are too late")?addToLog("info Icon","You are too late to help "+(g?" "+g:"")+" with this job."):-1!=e.indexOf("already helped")?addToLog("info Icon","Already helped "+g+" with this job."):-1!=e.indexOf("You received")||-1!=e.indexOf("You helped")?(d=e.match(REGEX_CASH),f=0,e.match(/(\d+)\s+experience\s+points?/i)&&(f=parseInt(RegExp.$1)),-1!=e.indexOf("Special Bonus")&&(e=e.split("gained a ")[1],addToLog("lootbag Icon",'Found a <span class="loot">'+e.split(".<span")[0]+"</span> while helping on a job.")),g='You received <span class="good">'+d+'</span> and <span class="good">'+f+" experience</span> for helping "+g+" complete the job.",GM_setValue("passivetotalJobExpInt",GM_getIntValue("passivetotalJobExpInt",0)+f),addToLog("updateGood Icon",g),isGMChecked("noStats")||updateLogStats()):-1!=e.indexOf("25 friends")?addToLog("info Icon","Failed to help"+(g?" "+g:"")+" with job. Reason: already helped 25 friends for the day in that city."):addToLog("info Icon","WARNING: Not sure what happened when trying to help"+(g?" "+g:"")+"."+(a?" "+a.help:"")+" Perhaps you interfered by clicking on something?");Autoplay.start();return!0;case"help burners":if(t=xpathFirst('.//a[contains(.,"Accept")]',d))return Autoplay.fx=function(){clickElement(t);clickAction="help burners";clickContext=a},Autoplay.delay=getAutoPlayDelay(),Autoplay.start(),!0;GM_setValue("logPlayerUpdatesCount",1+GM_getValue("logPlayerUpdatesCount",0));addToLog("info Icon",e);Autoplay.start();return!0;case"help parts":if(t=xpathFirst('.//a[contains(.,"Send Item")]',d))return Autoplay.fx=function(){clickElement(t);clickAction="help parts";clickContext=a},Autoplay.delay=getAutoPlayDelay(),Autoplay.start(),!0;DEBUG("Parsing parts help.");GM_setValue("logPlayerUpdatesCount",1+GM_getValue("logPlayerUpdatesCount",0));-1!=e.indexOf("You sent ")&&addToLog("info Icon","RX6 sent "+f.split("You sent ")[1].split("</div>")[0]);Autoplay.start();return!0;case"deposit":parseInt(city)!=parseInt(a)&&addToLog("warning Icon","Warning! You have traveled from "+cities[a][CITY_NAME]+" to "+cities[city][CITY_NAME]+" while banking. Check your money.");e.match(/deposited/i)?addToLog(cities[city][CITY_CASH_CSS],f):DEBUG(f);(e=xpathFirst('//div[@id="bank_popup"]'))&&e.parentNode&&closePopup(e.parentNode,"Bank Popup");break;case"withdraw":e.match(/withdrew/i)?addToLog(cities[city][CITY_CASH_CSS],f):DEBUG(f);(e=xpathFirst('//div[@id="bank_popup"]'))&&e.parentNode&&closePopup(e.parentNode,"Bank Popup");break;case"buy item":addToLog("info Icon",f.untag());break;case"newcity buy":addToLog("info Icon","Brazil Items bought");break;case"buy property":addToLog("info Icon",f);break;case"crew collection":addToLog("info Icon",f);break;case"build item":d=a.propCount;e=cityProperties[d][ctPropName];d=cityProperties[d][ctPropTimer];/You cannot craft/i.test(f)||/You do not have/i.test(f)||/You need a higher/i.test(f)?(f=e+": "+f,setGMTime(d,"1 hour"),addToLog("warning Icon",f)):(setGMTime(d,"18 hours"),f.match(/You got (.+?)\./)?(e='RX6 built <span class="loot">'+RegExp.$1+"</span>.",f.match(/You gained:(.+?) close/)&&(e+=" You gained "+RegExp.$1+"."),addToLog("lootbag Icon",e)):addToLog("lootbag Icon",f));break;default:colorDEBUG('BUG DETECTED: Unrecognized action "'+c+'".',cre),DEBUG("Unrecognized Action :"+f)}return!1}function closePopup(b,c){if(!b)return DEBUG("Can not close "+c+" : popupElt undefined !"),!1;var a=xpathFirst('.//a[@class="pop_close"]',b);a||(a=xpathFirst('.//a[@class="close"]',b));a||(a=xpathFirst('.//a[@class="sexy_button_new medium black skip" or contains(.,"Cancel")]',b));a||(a=xpathFirst('.//a[@class="mw_new_ajax pop_close"]',b));a&&(clickElement(a),DEBUG("Got rid of "+c+" popup: "+b.id+"."));if(a=document.getElementById("fb_dialog_cancel_button"))clickElement(a),DEBUG("Skipped "+c+" popup: "+b.id+".");b.parentNode&&b.parentNode.removeChild(b);return!0}function showPopups(b){if(b&&0<b.length)for(var c=0,a=b.length;c<a;++c)-1==b[c].getAttribute("class").indexOf("pop_bg")&&!b[c].getAttribute("opened")&&0<b[c].innerHTML.length&&b[c].scrollWidth?(b[c].setAttribute("style","display: block;"),b[c].setAttribute("opened","yes")):("yes"!=b[c].getAttribute("opened")||!b[c].innerHTML.length)&&b[c].setAttribute("style","display: none;")}function handlePopups(){fetchPubOptions();try{var b=xpathFirst('.//div[@id="currentTab"]',popupfodderElt);b&&GM_setValue("currentTab",b.innerHTML);var c=$x('.//div[contains(@id, "pop_b") and not(contains(@style, "none"))]',popupfodderElt);showPopups(c);c=$x('.//div[@class="fight_true_popup"]//div[contains(@id, "pop_b")]',innerPageElt);showPopups(c);var a=xpathFirst('.//div[@id="requests_toaster" and contains(@style,"block")]');if(a){var d=xpathFirst('.//div[@id="requests_toaster_txt"]',a);d&&addToLog("process Icon",d.innerHTML.untag());return closePopup(a,"Requests")}var e=$x('.//div[@class="buy_prompt"]',appLayoutElt);if(running&&e&&0<e.length)for(var f=0,g=e.length;f<g;++f)if(e[f]&&e[f].scrollWidth&&0<e[f].innerHTML.length){var h=e[f];return closePopup(h,"Buy Prompt")}e=$x('.//div[contains(@id,"socialMissionFail") and @class="socialMissionTryAgain" and contains(@style,"block")]',appLayoutElt);if(running&&e&&0<e.length){f=0;for(g=e.length;f<g;++f)if(e[f]&&e[f].scrollWidth&&0<e[f].innerHTML.length){var h=e[f],k;isGMChecked("AutoRetryOperations")?(k=xpathFirst('.//a[contains(@onclick,"tryAgain") and contains(.,"Start")]',h),DEBUG("Clicking to retry expired operation")):(k=xpathFirst('.//a[contains(@onclick,"tryAgain") and contains(.,"Close")]',h),DEBUG("Clicking to close expired operation"));k&&clickElement(k);return!0}}e=$x('.//div[contains(@id,"zy_popup_box") and not(@class="zy_popup_box_bg") and contains(@style,"block")]',appLayoutElt);if(running&&e&&0<e.length){f=0;for(g=e.length;f<g;++f)if(e[f]&&e[f].scrollWidth&&0<e[f].innerHTML.length){h=e[f];if(k=xpathFirst('.//div[@class="achievement_message_text"]',h))if(k.innerHTML.untag().match(/you earned(.+)share/i)&&addToLog("yeah Icon","RX6 earned "+RegExp.$1+"."),isGMChecked("autoGlobalPublishing")&&(k=xpathFirst('.//a[contains(@class,"sexy_achievement_new") and contains(.,"Share the wealth")]',h)))clickElement(k),DEBUG("Clicked to share Achievement Bonus");return closePopup(h,"Achievement Popup")}}if((c=$x('.//div[(contains(@id,"pop_box") and contains(@style, "block")) or contains(@id,"mystery")]',appLayoutElt))&&0<c.length){f=0;for(g=c.length;f<g;++f)if((h=c[f])&&h.scrollWidth&&0<h.innerHTML.length){var l=h.innerHTML,n=l.untag().toLowerCase();if(!(-1!=l.indexOf("fight_wrapper")||-1!=l.indexOf("bank_popup")||-1!=l.indexOf("vault_popup")))if((-1!=l.indexOf('id="marketplace"')||-1!=l.indexOf('id="original_buyframe_popup"')||-1!=l.indexOf("marketplace_title.png")||-1!=l.indexOf("giftcard_iframe")||-1!=l.indexOf("newbuyer_congrats")||-1!=l.indexOf("xw_controller=hospital")||-1!=l.indexOf("Build Complete")||-1!=l.indexOf('id="ChopShopCarousel"')||-1!=l.indexOf('class="account_settings_title"')||-1!=l.indexOf('class="exp_discount_main"')||-1!=l.indexOf("TournamentController.nextPage()")||-1!=l.indexOf("this wave has ended")||-1!=l.indexOf("xw_controller=SubscriptionPlan")||-1!=l.indexOf('id="lbox_iframe"')||-1!=n.indexOf("wishlist is full")||-1!=n.indexOf("cooldown")||-1!=n.indexOf("buy now order")||-1!=n.indexOf("drag to reorder them")||-1!=n.indexOf("vengeance pack"))&&-1==n.indexOf("select a consumable to use")){if(running)return closePopup(h,"Annoying Zollipops stuff")}else if(running){if(-1!=n.indexOf("close_suggestor_iframe")){if(!timeLeftGM("requestTimer")&&inRequests)return unsafeWindow.close_suggestor_iframe(),closePopup(h,"Free Gift Suggestor");return}var o=xpathFirst('.//div[contains(@id,"map_boss_victory")]//a[contains(.,"Share")]',h);if(o){colorDEBUG("bossFight - clicked to share Boss Fight Rewards",caq);clickElement(o);popupTimer&&(window.clearInterval(popupTimer),popupTimer=window.setInterval(handlePopups,350));Autoplay.fx=goHome;Autoplay.start();return}if(o=xpathFirst('.//div[contains(@id,"map_boss_victory")]//a[contains(.,"return")]',h)){colorDEBUG("bossFight - clicked to Return to District",caq);clickElement(o);popupTimer&&(window.clearInterval(popupTimer),popupTimer=window.setInterval(handlePopups,350));Autoplay.fx=goHome;Autoplay.start();return}if(o=xpathFirst('.//div[@id="pop_box_map_boss_fight_stamina_popup"]//a[contains(.,"Close")]',h)){colorDEBUG("bossFight - clicked to close Boss Fight Popup - out of stamina",caq);clickElement(o);endBoss=!0;return}if((o=xpathFirst('.//div[@id="pop_box_map_boss_fight_popup"]//a[class="pop_close"]',h))&&endBoss){colorDEBUG("bossFight - clicked to close Boss Fight Popup",caq);isBGPaused=!1;clickElement(o);return}if((o=xpathFirst('.//div[@id="pop_box_map_boss_fight_run_away_popup"]//a[contains(.,"Run Away")]',h))&&endBoss){colorDEBUG("bossFight - clicked to Run Away from Boss Fight",caq);isBGPaused=!1;clickElement(o);popupTimer&&(window.clearInterval(popupTimer),popupTimer=window.setInterval(handlePopups,350));endBoss=!1;Autoplay.delay=150;Autoplay.fx=goHome;Autoplay.start();autoReload(!1,"challenge mission");return}if(o=xpathFirst('.//a[contains(@class,"attack_boss") and contains(@onclick,"Expert")]',h)){endBoss=!1;popupTimer&&(window.clearInterval(popupTimer),popupTimer=window.setInterval(handlePopups,3E3));autoReload(!1,"Boss Fight");colorDEBUG("bossFight - clicked to confirmBoss Fight",caq);clickElement(o);return}var p=xpathFirst('.//div[@id="map_boss_fight"]',h);if(p){popupTimer&&(window.clearInterval(popupTimer),popupTimer=window.setInterval(handlePopups,3E3));isUndefined(useConsumables)&&(useConsumables=!0);autoReload(!1,"Boss Fight");var q=$x('.//a[contains(@id,"use_con") and not(contains(@class,"greyButton"))]',p);if(q&&0<q.length&&useConsumables){o=q[q.length-1];colorDEBUG("bossFight - clicked to use consumable",caq);clickElement(o);useConsumables=!1;return}if(o=xpathFirst('.//a[contains(@class,"sexy_attack_new") and contains(@onclick,"BossController")]',p))colorDEBUG("bossFight - clicked to attack Boss",caq),clickElement(o),useConsumables=!0;return}var u=xpathFirst('.//div[@id="role_select_bg"]',h);if(u)return DEBUG("Found Battle Popup"),(o=xpathFirst('.//a[@class="rightArrow" and contains(.,"FIGHT")]',u))&&clickElement(o),closePopup(h,"Battle Popup");if(-1!=l.indexOf("mw_app=slotmachine")){var A=xpathFirst('//object[@id="slots"]/param[@name="flashvars"]');A&&A.value&&(slotSpins=A.value.match(/&freeSpins=(\d+)&/)[1],slotBonus=A.value.match(/&bonusMeter=(\d+)&/)[1],addToLog("info Icon","Slot Spins Remaining: "+slotSpins+" Bonus Level: "+slotBonus));return closePopup(h,"Slot Machine Popup")}if(-1!=l.indexOf('class="depotTitle"')){var l=1,v=$x('.//div[contains(@class,"upgrade_card_amounts")]',h);if(v&&v.length&&3==v.length){var w=xpathFirst('.//span[contains(@id,"buy_one_part_have")]',v[2]),G=xpathFirst('.//span[contains(@id,"buy_one_part_need")]',v[2]);w&&G&&(parseInt(w.innerHTML)==parseInt(G.innerHTML)?(DEBUG("Limited Parts, FULL!!!!  We have: "+w.innerHTML+" We Need: "+G.innerHTML),l=2):DEBUG("Limited Parts, We have: "+w.innerHTML+" We Need: "+G.innerHTML))}var y=$x('.//a[contains(@onclick,"postfeedforproperty_part")]',h);if(y&&y.length){var F=y[y.length-l];DEBUG("Clicking Ask Limited Property Element");clickElement(F)}return closePopup(h,"Limited Property")}if(-1!=n.indexOf("total requests")){var C=$x('.//a[@class="sexy_button_new medium white" and contains(@onclick,"accept_gift") and not(contains(@onclick,"item_id=3009")) ]',h);if(C&&isGMChecked("autoAcceptMsgGifts")){for(f=0;0<(f<C.length);++f)acceptgiftButton=C[f],clickElement(acceptgiftButton);DEBUG("Popup Process: MESSAGE CENTER - "+C.length+" Gifts Accepted")}if((C=$x('.//a[@class="sexy_button_new medium white" and contains(@onclick,"accept_boost")]',h))&&isGMChecked("autoAcceptMsgBoosts")){for(f=0;0<(f<C.length);++f)acceptgiftButton=C[f],clickElement(acceptgiftButton);DEBUG("Popup Process: MESSAGE CENTER - "+C.length+" Boosts Accepted")}if(isGMChecked("AutoBattle")){var r=$x('.//a[@class="sexy_button_new medium white" and contains(@onclick,"xw_action=createBattle") and contains(@onclick,"opponent_id='+GM_getValue("AutoBattleClanID")+'")]',h);if(r){for(f=0;0<(f<r.length);++f)acceptButton=r[f],clickElement(acceptButton);DEBUG("Popup Process: MESSAGE CENTER - Accepted "+r.length+" battles.")}}if((r=$x('.//a[@class="sexy_button_new medium white" and contains(.,"Join Mafia")]',h))&&isGMChecked("acceptMafiaInvitations")){for(f=0;0<(f<r.length);++f)acceptButton=r[f],clickElement(acceptButton);DEBUG("Popup Process: MESSAGE CENTER - Added "+r.length+" members to your mafia.")}if((r=$x('.//a[@class="sexy_button_new medium white" and contains(.,"Accept Crew")]',h))&&isGMChecked("autoAcceptMsgCrew")){for(f=0;0<(f<r.length);++f)acceptButton=r[f],clickElement(acceptButton);DEBUG("Popup Process: MESSAGE CENTER - Accepted "+r.length+" Crew Invites to your mafia.")}if((r=$x('.//a[@class="sexy_button_new medium white" and (contains(.,"Send Energy") or contains(@onclick,"xw_action=accept_energy_req"))]',h))&&isGMChecked("autosendMsgEnergyPack")){for(f=0;0<(f<r.length);++f)acceptButton=r[f],clickElement(acceptButton);DEBUG("Popup Process: MESSAGE CENTER - Sent "+r.length+" energy Packs to your mafia.")}return closePopup(h,"MESSAGE CENTER")}if(-1!=n.indexOf("opened a red mystery bag")){DEBUG("Popup Process: Red Mystery Bag Processed");var t;n.match(/you got:\s?(.+?)(\s?send|\s?share)/i)&&(t=RegExp.$1);addToLog("lootbag Icon",'Received <span class="loot">'+t+"</span> from a red mystery bag.");var O=xpathFirst('.//div[@class="mystery_bag_drop_item"]/div',h);O&&addToLog("lootbag Icon",O.innerHTML);return closePopup(h,"Red Mystery Bag Drop")}if(-1!=n.indexOf("share mystery bonus"))return DEBUG("Popup Process: Mystery Bonus Processed"),n.match(/you got:\s?(.+?)(\s?send|\s?share)/i)&&(t=RegExp.$1),addToLog("lootbag Icon",'Received <span class="loot">'+t+"</span> from a mystery bonus."),closePopup(h,"Mystery Bonus Drop");if(-1!=l.indexOf("BattleResultsController"))return DEBUG("Found BattleRewards Popup"),(o=xpathFirst('.//a[contains(@onclick,"BattleResultsController.collectReward") and contains(.,"Collect")]',h))?(DEBUG("Found collect link to click, boom!"),clickElement(o)):DEBUG("No collect link found :("),closePopup(h,"Battle Collect");if(-1!=l.indexOf("epic_battle_collect")||-1!=n.indexOf("clan/battle")){DEBUG("Found BattleRewards Item Popup");var E=xpathFirst('.//div[contains(@style,"item_with_preview")]',h);if(E){var D=E.innerHTML;addTolog("lootbag Icon",D)}return closePopup(h,"Battle Collect Item")}if(-1!=n.indexOf("you cleared the full board")){var F=y=w=G=0,K=$x('.//div[@class="rob_res_expanded_details"]'),v="";if(K&&0<K.length){f=0;for(g=K.length;f<g;f++){var B=K[f],Q=B.innerHTML.untag(),M=xpathFirst('.//div[@class="rob_res_expanded_details_cash"]',B);M&&M.innerHTML.untag().match(REGEX_CASH)&&(G+=parseCash(RegExp.lastMatch));var L=xpathFirst('.//div[@class="rob_res_expanded_details_exp"]',B);L&&L.innerHTML.untag().match(/(\d+) Experience/)&&(w+=parseInt(RegExp.$1));Q.match(/\+(\d+) Energy/)&&(y+=parseInt(RegExp.$1));Q.untag().match(/\+(\d+) Stamina/)&&(F+=parseInt(RegExp.$1))}G&&(v+=' <span class="good">'+cities[city][CITY_CASH_SYMBOL]+makeCommaValue(G)+"</span>");w&&(v+=' and <span class="good">'+w+" experience</span>");y&&(v+=' and <span class="user">'+y+" energy</span>");F&&(v+=' and <span class="bad">'+F+" stamina</span>");v="RX6 gained "+v+"."}DEBUG("Popup Process: Processing robbing board");if(n.match(/(\d+) bonus experience/i)){var P=parseInt(RegExp.$1.replace(/[^0-9]/g,"")),f="",J=parseInt(boardLastPtsToNextLevel)-parseInt(ptsToNextLevel);J||(J=w+P);var z=parseInt(boardLastStamina)-parseInt(stamina),S=parseFloat(J/z).toFixed(2),n=g=0;if(l.match(/your record on this board was\s+(.+?)\./i)){var H=RegExp.$1;H.match(/(\d)-(\d)/)&&(g=parseInt(RegExp.$1),n=parseInt(RegExp.$2),DEBUG("robWins: "+g+"/ robLosses: "+n));f='<br>Board Record: <span class="good">'+H+"</span>"}addToLog("yeah Icon","Robbing board cleared. "+v+' Bonus: <span class="good">'+P+" experience</span>."+f+" - Ratio: "+J+"/"+z+" ("+S+") ");boardLastStamina=parseInt(stamina);boardLastPtsToNextLevel=parseInt(ptsToNextLevel);isGMChecked("noStats")||(P&&updateRobStatistics(null,parseInt(P)),g&&updateFastRobStatistics(!0,g),n&&updateFastRobStatistics(!1,n),(P||g||n)&&updateLogStats());l.match(/you\s+(earned|gained|received|collected)\s+(some|an?)\s+bonus\s+(.+?)\.?<\/div>/i)&&addToLog("lootbag Icon",'Found <span class="loot">'+RegExp.$3+"</span> on robbing board.")}return closePopup(h,"Robbing Board Popup")}var s=xpathFirst('.//span[@id="level_up_skill"]',h);if(s)if(isGMChecked("autoStat")){b=0;b=parseInt(s.innerHTML);colorDEBUG("free skill points: "+b);var I=autoStatVars(b);DEBUG("AutoStat upgrading "+I[0]+" - "+I[1]);if(b&&""!=I[0]&&0!=I[1]){var N="remote/html_server.php?xw_controller=stats&xw_action=upgrade&upgrade_key="+I[0]+"&upgrade_amt="+I[1]+"&no_load=1&source=level_up_popup",R=createAjaxPage(!0);if(o=makeElement("a",null,{onclick:'return do_ajax("'+R+'","'+N+'", 1, 0, null, update_level_up_skill); return false;'})){var U=I[0].replace("max_",""),X=eval(U.toUpperCase()+"_STAT"),da=U.toLowerCase()+" Icon",T=isNaN(I[1])?1:parseInt(I[1]);GM_setValue("nextStat",(X+1)%4);switch(X){case ATTACK_STAT:curAttack+=T;break;case DEFENSE_STAT:curDefense+=T;break;case HEALTH_STAT:maxHealth+=T;break;case ENERGY_STAT:maxEnergy+=T;break;case STAMINA_STAT:maxStamina+=T}addToLog(da,'<span style="color:#885588;">'+U+" increased by "+T+" point(s).</span>");clickAction="autoStatAllocation";clickElement(o);return}}N="remote/html_server.php?xw_controller=levelUpBonus&xw_action=addBonusItem&xw_city="+city+"&no_load=1";R=createAjaxPage(!0);if((o=makeElement("a",null,{onclick:'return do_ajax("'+R+'","'+N+'", 1, 0, null, update_level_up_bonus_item); return false;'}))&&claimLevelUpBonus){DEBUG("Claiming Skill Points Allocation Reward");clickAction="autoStatReward";clickElement(o);claimLevelUpBonus=!1;return}}else DEBUG("Skill Poinst Allocation OFF");if(n.match(/(you are now level|promoted to level) (\d+)/i)){addToLog("info Icon",'You were promoted to level <span class="good">'+RegExp.$2+"</span>");if(document.getElementById("bonusItemName")){var ja=document.getElementById("bonusItemName");addToLog("lootbag Icon",'Level Up Bonus Item: <span class="loot">'+ja.innerHTML+"</span>")}if(isGMChecked("autoGlobalPublishing")){var V=xpathFirst('.//a[contains(@onclick,"postLevelUpFeedAndSend") and contains(.,"Share")]',h);V||(V=xpathFirst('.//a[contains(@onclick,"xw_action=levelup_boost_brag") and contains(.,"Share")]',h));V||(V=xpathFirst('.//div[@id="bonusShareButton"]//a[contains(.,"Share")]',h));V&&(DEBUG("Level Up popup Share button detected"),clickElement(V))}claimLevelUpBonus=!0;return closePopup(h,"Level Up Bonus")}var ea=$x('.//a[contains(@onclick,"postFeedAndSendSocialList") and contains(.,"Post")]',h);if(ea&&0<ea.length)return closePopup(h,"Level Up Bonus Sharing");if(-1!=n.indexOf("not involved in this mission"))return closePopup(h,"Not in Operation");if(-1!=n.indexOf("start operation")){var Z=xpathFirst('.//a[@class="sexy_button_new medium white" and contains(@onclick,"postCelebrateFeed")]',h);Z||(Z=xpathFirst('.//a[@class="sexy_button_new medium white" and contains(@onclick,"startMission")]',h));Z&&isGMChecked("autoStartMyOps")&&(clickElement(Z),DEBUG("Popup Process: OPERATIONS - Started a new Operation"));return closePopup(h,"Start New Operation")}if(-1!=n.indexOf("invite friends")){if((Z=xpathFirst('.//a[@class="sexy_button_new medium white" and contains(@onclick,"postCelebrateFeed")]',h))&&isGMChecked("autoStartMyOps"))clickElement(Z),DEBUG("Popup Process: OPERATIONS - Started My own Operation");return closePopup(h,"Inviting Friends on Operation Start")}if(-1!=n.indexOf("failed to give reward"))return DEBUG("Popup Process: OPERATIONS - Claim Rewards Failed"),closePopup(h,"Claim Operations Rewards Failed");if(-1!=n.indexOf("completed the operation")){DEBUG("Popup Process: OPERATIONS - Claim Rewards : "+h.id);for(var na=$x('.//td[@class="collectPopLootItem"]',h),D="",f=0;f<na.length;++f)var ta=$x('.//div[contains(@style,"center")]',na[f]),ra=ta[0].innerHTML.untag(),aa=ta[1].innerHTML,D=D?D+('<br><span class="loot">'+ra+"</span> ("+aa+")"):'<span class="loot">'+ra+"</span> ("+aa+")";addToLog("lootbag Icon","Operation Rewards :<br>"+D);if(!isGMChecked("autoGlobalPublishing"))return closePopup(h,"Operations Rewards Claimed")}var ka=xpathFirst('.//a[@class="sexy_button_new medium white sexy_call_new" and contains(@onclick,"postCelebrateFeed")]',h);if(ka)return isGMChecked("autoGlobalPublishing")&&(clickElement(ka),DEBUG("Popup Process: OPERATIONS - Share Rewards")),closePopup(h,"Operations Rewards Claimed and Shared");if(-1!=n.indexOf("won the fight")||-1!=n.indexOf("lost the fight"))return closePopup(h,"Succesfull War Attack");if(-1!=n.indexOf("have already helped"))return closePopup(h,"Already Helped");if(-1!=n.indexOf("war is already over"))return closePopup(h,"War already over");if(-1!=n.indexOf("a mafia request"))return closePopup(h,"War Not in Mafia");var ba=xpathFirst('.//a[@class="sexy_button_new short white sexy_call_new" and contains(@onclick,"attemptFeed")]',h);if(ba)return isGMChecked("autoGlobalPublishing")&&(clickElement(ba),DEBUG("Popup Process: WAR - Declare War Publishing")),closePopup(h,"War Declaration Popup");if(-1!=n.indexOf("help to take out all 7")){if((eltHelp=xpathFirst('.//a[contains(.,"Ask Friends for Help")]',h))&&isGMChecked("autoGlobalPublishing"))clickElement(eltHelp),DEBUG("Popup Process: WAR - Ask Friends for Help Publishing");return closePopup(h,"War Help Popup")}if(-1!=n.indexOf("share victory coins")){var oa=$x('.//a[@class="sexy_button_new short white" and contains(@onclick,"postWarWin")]',h);if(oa&&isGMChecked("autoGlobalPublishing"))for(f=0;0<(f<oa.length);++f)warRewardButton=oa[f],clickElement(warRewardButton),DEBUG("Popup Process: WAR - Reward Friends (Share Coins) for Help Publishing");return closePopup(h,"War Reward (Share Coins) Popup")}if(n.match(/congratulations/i)){var fa=$x('.//div[@style="margin: 10px; text-align: center;"]',h);if(fa&&fa.length){l="";f=0;for(g=fa.length;f<g;f++)l+=fa[f].innerHTML;l&&addToLog("lootbag Icon",l)}return closePopup(h,"Crafting")}if((eltHelp=xpathFirst('.//a[contains(@class,"sexy_button_new") and contains(.,"Share")]',h))&&isGMChecked("autoGlobalPublishing"))return clickElement(eltHelp),DEBUG("Popup Process: Shared Themed Event Items - "+n),DEBUG("Popup Process: Button: "+eltHelp.innerHTML),closePopup(h,"Shared Themed Event Items");if(n.match(/you found (.*) loot event./i)||n.match(/you found all (.*) in action./))return n.match(/you found (.*) loot event./i)?logtxt="RX6 found "+RegExp.$1+" loot event.":n.match(/you found all (.*) in action./)&&(logtxt="RX6 found "+RegExp.$1+" in action."),logtxt&&addToLog("yeah Icon",logtxt),closePopup(h,"Loot Event");if(isGMChecked("autoAskCityCrew")&&-1!=n.indexOf("send city crew requests")){if(inRequests)return;var Y=$x('.//div[@class="mfs_selectable"]//li[@class="mfs_add" and not(contains(@style,"none"))]'),la=xpathFirst('.//div[@id="mfs_tab_2" and contains(@class,"inactive")]');if(0==Y.length||21>Y.length&&la)la=xpathFirst('.//div[@id="mfs_tab_2"]'),clickElement(la);var ca=xpathFirst('.//a[@class="sexy_button_new medium orange" and contains(@onclick,"MW.Request.submitMFS") and contains(.,"SEND REQUESTS")]'),Y=$x('.//div[@class="mfs_selectable"]//li[@class="mfs_add" and not(contains(@style,"none"))]');if(0<Y.length&&ca&&!inRequests){var ga=xpathFirst('.//a[@id="selectMaxButton" and not (contains(@class,"disabled"))]');if(ga)clickElement(ga);else{g=50<Y.length?50:Y.length;for(f=0;f<g;f++)clickElement(Y[f])}clickElement(ca);inRequests=!0;setGMTime("requestTimer","00:30")}else setGMTime("requestTimer","00:05");return}if(-1!=n.indexOf("level mastered")){var W=xpathFirst('.//a[@class="sexy_button_new short green sexy_announce" and contains(@onclick,"post_mastery_feed")]',h);W&&isGMChecked("autoGlobalPublishing")&&(clickElement(W),DEBUG("Popup Process: Robbing/Fighting Level Mastery - Tell Your Friends"));return closePopup(h,"Robbing/Fighting Level Mastered")}if(-1!=n.indexOf("paypal"))return closePopup(h,"Paypal");if(-1!=l.indexOf("xw_action=buyframe_popup")||-1!=n.indexOf("div.buyframe_pop_box"))return closePopup(h,"Buy Reward Points");if(-1!=n.indexOf("safehouse_congrats"))return closePopup(h,"Crime Spree Congratulations");if(-1!=n.indexOf("treasure chest"))return closePopup(h,"Treasure Chest");if(-1!=n.indexOf("keep winning"))return closePopup(h,"Robbery Keep Winning");if(-1!=n.indexOf("tired of losing"))return closePopup(h,"Robbery Tired of Losing");if(-1!=n.indexOf("the slots collection"))return closePopup(h,"Slots Collection");if(-1!=n.indexOf("friend to be in your mafia and help"))return closePopup(h,"Grow your Mafia");if(-1!=n.indexOf("new loot!"))return closePopup(h,"Slot Machine Flushed");if(-1!=n.indexOf("your mafia wars requests have moved to the left column on facebook"))return closePopup(h,"Your Requests");if(-1!=n.indexOf("not have enough"))return closePopup(h,"not enough health, stamina or energy");if(-1!=n.indexOf("out of")&&-1==n.indexOf("the bank"))return closePopup(h,"out of health, stamina or energy");if(-1!=n.indexOf("you helped in"))return closePopup(h,"You helped in");if(-1!=n.indexOf("become world champion"))return closePopup(h,"Welcome to Tournaments");if(-1!=n.indexOf("your previous tournament has expired"))return closePopup(h,"Tournament Expired");var pa=xpathFirst('.//div[@id="let_there_be_space"]',h),ua=xpathFirst('.//div[@id="request_ifc"]',h);if(pa&&ua)return closePopup(h,"increase your mafia");if(isGMChecked("autoProcessPopups")){if(E=xpathFirst('.//div[contains(@style,"item_with_preview")]',h))D=E.innerHTML,addTolog("lootbag Icon",D);(eltButton=xpathFirst('.//a[contains(@class,"sexy_button_new") and not (contains(.,"Refill")) and not (contains(.,"Buy")) and not (contains(.,"RP"))]',h))?(DEBUG("Tried to process the following popup ("+eltButton.innerHTML+"):<br>"+n),clickElement(eltButton)):DEBUG("Could not process the following popup :<br>"+n);isGMChecked("TestChanges")&&DEBUG(h.innerHTML);return closePopup(h,"autoClosing (autoProcess) Unknown")}}}else return closePopup(h,"autoClosing empty popups")}}catch(qa){DEBUG("Error @handlePopups: "+qa)}return!1}function updateScript(){try{GM_xmlhttpRequest({method:"GET",url:SCRIPT.metadata+"?"+Math.random(),onload:function(b){200==b.status&&b.responseText.match(/@version\s+(\d+).(\d+).(\d+)/)&&(b=RegExp.$1+"."+RegExp.$2+"."+RegExp.$3,b!=SCRIPT.version?window.confirm("Version "+b+" is available!\n\nDo you want to install this version?\n")&&(window.location.href=SCRIPT.url):alert("You already have the latest version: "+b))}})}catch(b){DEBUG("BUG DETECTED (updateScript): "+b)}}function clearSettings(){if("function"==typeof GM_listValues&&"function"==typeof GM_deleteValue){var b=GM_listValues(),c;for(c in b)"function"==typeof GM_deleteValue&&GM_deleteValue(b[c])}else alert("In order to do this you need at least GreaseMonkey version: 0.8.20090123.1. Please upgrade and try again.")}function getArrayDiffs(b){diffArray=[];for(var c=1;c<b.length;c++)0>b[c]-b[c-1]?diffArray.push(0):diffArray.push(b[c]-b[c-1]);diffArray.unshift(0);return diffArray}function setSavedList(b,c){GM_setValue(b,c.join("\n"))}function getSavedList(b){return(b=GM_getValue(b,""))?b.split("\n"):[]}function addSavedListItem(b,c,a){var d=getSavedList(b);if(-1==d.indexOf(c)){d.push(c);if(0<a)for(;a<d.length;)d.shift();setSavedList(b,d)}}function removeSavedListItem(b,c){var a=getSavedList(b),d=a.indexOf(c);return-1!=d?(a.splice(d,1),setSavedList(b,a),!0):!1}function removeJobForItem(b,c){var a=getSavedList(b,""),d=0;if(0<a.length){var e=a[a.length-1];requirementJob.forEach(function(a){a[1]==e&&requirementJob[d][0]==c&&removeSavedListItem(b,requirementJob[d][1]);d++})}}function cycleSavedList(b){var c=GM_getValue(b,"").split("\n"),a=c.shift();a&&c.push(a);GM_setValue(b,c.join("\n"))}function stripURI(b){b=b.split('"')[1];return b.replace('" />',"")}function showIfUnchecked(b){return"checked"!=b?"unchecked":b}function showIfSelected(b){return"checked"==b?"selected":"unselected"}function showIfRelative(b){return"checked"==GM_getValue(b)?"relative":"absolute"}function linkToString(b,c){if(!b)return b;var a=function(a){if(a.match(/user=/))var b=a.split("user=")[1].split("'")[0].split("&")[0],a=a.replace(b,decodeID(b));return a},d="<a";c&&(d+=' class="'+c+'"');if(b.hasAttribute("onclick")){var e=b.getAttribute("onclick");e&&(d+=' onclick="'+a(e)+'"')}return d+=' href="'+a(b.href)+'">'+b.innerHTML+"</a>"}function decodeHTMLEntities(b){if(!b)return b;scratchpad.innerHTML=b;return scratchpad.value}function hideElement(b,c){if(b)return null==c&&(c=!0),b.setAttribute("id",c?"mwapHide":"",0),b}function clickElement(b){if(b)if(gvar.isGreaseMonkey)try{$(b).click()}catch(c){var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);b.dispatchEvent(a)}else a=document.createEvent("MouseEvents"),a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),b.dispatchEvent(a);else colorDEBUG("BUG DETECTED: Null element passed to clickElement().",cre)}function ignoreElement(b){var c=b.parentNode;return c&&(c=c.id)&&(-1!=c.indexOf("countdown")||-1!=c.indexOf("timer")||-1!=c.indexOf("ask_for_job_help_time")||-1!=c.indexOf("tournament_time_left")||-1!=c.indexOf("tournament_try_again_timer")||-1!=c.indexOf("zmc_event_count")||-1!=c.indexOf("googleAds")||-1!=c.indexOf("ps_mwap_promo_banner")||-1!=c.indexOf("FeaturedEventsModule"))?!0:(c=b.id)&&(-1!=c.indexOf("countdown")||-1!=c.indexOf("timer")||-1!=c.indexOf("ask_for_job_help_time")||-1!=c.indexOf("tournament_time_left")||-1!=c.indexOf("tournament_try_again_timer")||-1!=c.indexOf("zmc_event_count")||-1!=c.indexOf("googleAds")||-1!=c.indexOf("ps_mwap_promo_banner")||-1!=c.indexOf("FeaturedEventsModule"))?!0:!1}function xpathFirst(b,c){return document.evaluate(b,c||document,null,XPathResult.ANY_UNORDERED_NODE_TYPE,null).singleNodeValue}function $x(b,c){for(var a,d=[],e=document.evaluate(b,c||document,null,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null);a=e.iterateNext();)d.push(a);return d}function xpath(b,c){return document.evaluate(b,null==c?document:c,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null)}function toggleCheckElt(b){if(isGMChecked(b))return GM_setValue(b,0),!1;GM_setValue(b,"checked");return!0}function defaultCheckBoxElementArray(b,c){for(var a=0;a<b.length;a++)GM_setValue(b[a],c)}function saveCheckBoxElementArray(b){for(var c=0;c<b.length;c++)document.getElementById(b[c])?saveCheckBoxElement(b[c]):GM_setValue(b[c],0)}function saveCheckBoxElement(b){if(!0===document.getElementById(b).checked)return GM_setValue(b,"checked"),!0;GM_setValue(b,0);return!1}function saveElementArray(b){for(var c=0;c<b.length;c++)saveElement(b[c])}function saveElement(b){if(document.getElementById(b[0]))switch(b[1]){case 1:GM_setValue(b[0],document.getElementById(b[0]).selectedIndex?document.getElementById(b[0]).selectedIndex:0);break;case 2:GM_setValue(b[0],document.getElementById(b[0]).value?document.getElementById(b[0]).value:0);break;case 3:GM_setValue(b[0],document.getElementById(b[0]).value?"checked":0);break;case 4:GM_setValue(b[0],b[2]?b[2]:0);break;default:GM_setValue(b[0],document.getElementById(b[0]))}else GM_setValue(b[0],0)}function GM_getIntValue(b,c){isNaN(c)&&(c=0);var a=GM_getValue(b,c);return!isNaN(a)?parseInt(a):0}function GM_getFloatValue(b,c){isNaN(c)&&(c=0);var a=GM_getValue(b,c);return!isNaN(a)?parseFloat(a):0}function isGMEqual(b,c){return GM_getValue(b)+""==c+""}function isGMChecked(b){return isGMEqual(b,"checked")}function isGMUndefined(b){return isUndefined(GM_getValue(b))}function isUndefined(b){return"undefined"==b+""}function makeElement(b,c,a,d,e){b=document.createElement(b);if(null!=a)for(var f in a)b.setAttribute(f,a[f]);null!=d&&"checked"==GM_getValue(d,e)&&b.setAttribute("checked","checked");c&&c.appendChild(b);return b}function destroyByID(b){(b=document.getElementById(b))&&b.parentNode.removeChild(b)}function remakeElement(b,c,a,d,e){a.id&&destroyByID(a.id);return makeElement(b,c,a,d,e)}function getBrowserWindowSize(){document.body&&document.body.offsetWidth&&(winW=document.body.offsetWidth);winH=document.body.offsetHeight;"CSS1Compat"==document.compatMode&&document.documentElement&&document.documentElement.offsetWidth&&(winW=document.documentElement.offsetWidth);winH=document.documentElement.offsetHeight;window.innerWidth&&window.innerHeight&&(winW=window.innerWidth);winH=window.innerHeight}function isNewCity(b){return b==BRAZIL||b==CHICAGO||b==LONDON?!0:!1}function parseCash(b){"string"==typeof b&&(b=b.trim().replace(/K$/,"00"),b=b.trim().replace(/K/,"0"),b=b.trim().replace(/\D/g,""));return parseInt(b)}function parseCashLoc(b){if("string"==typeof b&&b.match(/([A-Z]*?\$|\u00A2|\u00A3)[\d,]*\d/))switch(RegExp.$1){case"C$":return CUBA;case"M$":return MOSCOW;case"B$":return BANGKOK;case"V$":return LV;case"L$":return ITALY;case"BRL$":return BRAZIL;case"\u00a2":return CHICAGO;case"\u00a3":return LONDON}return NY}function makeCommaValue(b){b=""+b;return b==(b=b.replace(/^(.*\s)?(\d+)(\d{3}\b)/,"$1$2,$3"))?b:makeCommaValue(b)}function getGMTime(b){var c=GM_getValue(b,0),c=Date.parse(c);c||(setGMTime(b,"00:00:10"),c=GM_getValue(b,0),c=Date.parse(c));return c/1E3}function setGMTime(b,c){var a=new Date;a.setMilliseconds(0);"now"!=c&&a.setTime(a.getTime()+1E3*timeLeft(c));GM_setValue(b,a.toString())}function timeLeftGM(b){var b=getGMTime(b),c=new Date;c.setMilliseconds(0);return Math.max(b-c.getTime()/1E3,0)}function timeLeft(b){if(!b)return 0;var c=0,a=[],a=b.split(":");if(2==a.length)c=60*parseInt(a[0])+parseInt(a[1]);else if(3==a.length)c=3600*parseInt(a[0])+60*parseInt(a[1])+parseInt(a[2]);else if(1==a.length){a=b.split(" and ");for(i=0;i<a.length;i++)if(spaceIndex=a[i].indexOf(" "),-1!=spaceIndex)if(firstPart=a[i].substring(0,spaceIndex),secondPart=a[i].substring(spaceIndex+1,a[i].length),"minutes"==secondPart||"minute"==secondPart)c+=60*parseInt(firstPart);else if("seconds"==secondPart||"second"==secondPart)c+=parseInt(firstPart);else if("hours"==secondPart||"hour"==secondPart)c+=parseInt(3600*firstPart);else if("days"==secondPart||"day"==secondPart)c+=parseInt(86400*firstPart)}return c}function getDecimalTime(b){var b=parseFloat(b),c="";b&&(60<=b&&(c=parseInt(b/60)+"h ",b-=parseInt(b),b*=60),c+=parseInt(b)+"m ",b-=parseInt(b),c+=parseInt(60*b)+"s");return c.replace("00","0")}function secondsToHMS(b){var b=Number(b),c=Math.floor(b/3600),a=Math.floor(b%3600/60),b=Math.floor(b%3600%60);return(0<c?c+":":"")+(0<a?(0<c&&10>a?"0":"")+a+":":"0:")+(10>b?"0":"")+b}function getHoursTime(b){b=timeLeftGM(b);if(0==b)return 0;if(!isNaN(b)){var b=parseInt(b),c="";b&&(b/=60,60<=b&&(b/=60,c=parseInt(b)+"h ",b-=parseInt(b),b*=60),c+=parseInt(b)+"m ",b-=parseInt(b),c+=parseInt(60*b)+"s");return c}}function IsJsonString(b){try{JSON.parse(b)}catch(c){return!1}return!0}function decodeID(b){b=unescape(b);isNaN(b)&&(b=decode64(b));return b}function decode64(b){var c="",a,d,e="",f,g="",h=0;/[^A-Za-z0-9\+\/\=]/g.exec(b)&&DEBUG("Invalid character(s) found in input ("+b+"). Expect errors in decoding.");b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do a=keyStr.indexOf(b.charAt(h++)),d=keyStr.indexOf(b.charAt(h++)),f=keyStr.indexOf(b.charAt(h++)),g=keyStr.indexOf(b.charAt(h++)),a=a<<2|d>>4,d=(d&15)<<4|f>>2,e=(f&3)<<6|g,c+=String.fromCharCode(a),64!=f&&(c+=String.fromCharCode(d)),64!=g&&(c+=String.fromCharCode(e));while(h<b.length);return c}function encode64(b){var c="",a,d,e="",f,g,h="",k=0;do a=b.charCodeAt(k++),d=b.charCodeAt(k++),e=b.charCodeAt(k++),f=a>>2,a=(a&3)<<4|d>>4,g=(d&15)<<2|e>>6,h=e&63,isNaN(d)?g=h=64:isNaN(e)&&(h=64),c=c+keyStr.charAt(f)+keyStr.charAt(a)+keyStr.charAt(g)+keyStr.charAt(h);while(k<b.length);return c}function onOperationsNav(){return xpathFirst('.//div[@id="socialMissionNav"]//a',innerPageElt)?!0:!1}function goOperationsNav(){var b=xpathFirst('.//div[@id="nav_link_events_unlock"]//a',menubarElt);return b?(clickElement(b),!0):!1}function onOperationsTab(b,c){var a=xpathFirst('.//a[@id="'+b+'" and contains(@onclick,"controller=socialmission") and contains(@style,"menu_item_hover")]',innerPageElt);if(a)return!0;a=xpathFirst('.//a[@id="'+b+'" and contains(@onclick,"controller=socialmission")]',innerPageElt);return"go"==c?(clickElement(a),!0):!1}function checkmyMissions(b){var c="";"start"==b&&(c="startMission");"remove"==b&&(c="showTryAgain");return(c="continue"==b?xpathFirst('.//div[@class="doTaskModule" and not (contains(@style,"none"))]//a[contains(@class,"sexy_button_new medium") and contains(@onclick, "closeTask" )]',innerPageElt):xpathFirst('.//div[@class="socialMission"]//a[contains(@class,"sexy_button_new medium") and contains(@onclick, "'+c+'" )]',innerPageElt))?(DEBUG("checkmyMissions - Clicking to "+b+" an Operation"),clickElement(c),!0):!1}function getOperationsInfo(b,c,a){b.container=xpathFirst('.//div[@id="socialMission_'+b.id+'" and @class="socialMission"]');if(!b.container)return"undefined";b.name=xpathFirst('.//div[@class="missionName"]',b.container).innerHTML.untag();b.emptySlot=xpathFirst('.//div[@class="missionTaskImage" and contains(@style,"silhoutte_thmb")]',b.container);if("basic"==a)return b;b.slot=c;b.module=xpathFirst('.//div[@id="missionTask_'+b.slot+"_"+b.id+'_module" and contains(@style,"block")]',b.container);if(c=xpathFirst('.//div[@class="doTaskName"]',b.module))b.taskName=c.innerHTML.untag();if(c=xpathFirst('.//div[@class="doTaskMastery"]//p',b.module))b.taskMastery=c.innerHTML.untag().replace(/\D/g,"");if(c=xpathFirst('.//div[@class="doTaskPaysModule"]//dd[contains(@class,"experience")]',b.module))b.xp=c.innerHTML.untag();if(c=xpathFirst('.//div[@class="doTaskPaysModule"]//dd[contains(@class,"cash")]',b.module))b.cash=c.innerHTML.untag(),c.className.match(/(.+?)_cash_icon/i)&&(b.cashCity=cities.searchArray(RegExp.$1,1)[0]);if(c=xpathFirst('.//div[@class="doTaskUsesModule"]//dd[contains(@class,"energy")]',b.module))b.nrgNeeded=c.innerHTML.untag();if(c=xpathFirst('.//div[@class="doTaskUsesModule"]//dd[contains(@class,"stamina")]',b.module))b.stamNeeded=c.innerHTML.untag();if(c=xpathFirst('.//div[@class="doTaskUsesModule"]//dd[contains(@class,"cash")]',b.module))b.cashNeeded=c.innerHTML.untag(),c.className.match(/(.+?)_cash_icon/i)&&(b.cashNeededCity=cities.searchArray(RegExp.$1,1)[0]);b.taskResult="";b.taskFailed=!1;if("result"==a&&(c=xpathFirst('.//div[@class="task_results"]',b.module)))b.taskResult=c.innerHTML.untag(),"FAILURE"==b.taskResult&&(b.taskFailed=!0);b.taskResult&&colorDEBUG("getOperationsInfo - "+b.name+"/"+b.taskName+" RESULT: "+b.taskResult);checkOperationsInfo(b);return b}function checkOperationsInfo(b){b.doable=!1;if(100==b.taskMastery)colorDEBUG("Operation: "+b.name+"/"+b.taskName+" already mastered ... skipping",cre);else if(b.nrgNeeded&&(energy<b.nrgNeeded||energy-b.nrgNeeded<SpendMissionEnergy.floor))colorDEBUG("Energy Requirements for Operation: "+b.name+" not met ... skipping",cre);else if(b.stamNeeded&&(stamina<b.stamNeeded||stamina-b.stamNeeded<SpendMissionStamina.floor))colorDEBUG("Stamina Requirements for Operation: "+b.name+" not met ... skipping",cre);else{if(b.neededCash){if(b.neededCashCity!=city)return colorDEBUG("Cash Requirements (City) for Operation: "+b.name+" not met ... go to cash location",cre),Autoplay.fx=function(){goLocation(b.neededCashCity)},Autoplay.start(),!1;var c=parseCash(b.neededCash)-parseCash(cities[city][CITY_CASH])+4*parseCash(b.neededCash);if(0<c)return colorDEBUG("We need to withdraw "+cities[city][CITY_CASH_SYMBOL]+c+" to do this Operations Task 5 times. Going to the bank/vault of "+cities[city][CITY_NAME],cre),suspendBank=!0,autoBankWithdraw(cashDiff),Autoplay.fx=GoFamilyTab,Autoplay.start(),!1}b.doable=!0}}function askOperationsHelp(){var b=xpathFirst('.//a[contains(@class,"ask_for_help") and contains(@onclick, "postAskHelpFeed")]',innerPageElt);if(b){var c=b.id.replace("sm_action_button_","");opsInfo=new Operations(c);opsInfo=getOperationsInfo(opsInfo,"","basic");if(opsInfo.emptySlot)return clickElement(b),addToLog("updateGood Icon","Clicked to Ask for Help on Operation: "+opsInfo.name),!0}return!1}function collectOperationsRewards(){var b=xpathFirst('.//a[@class="sexy_button_new medium green" and contains(@onclick, "collectReward")]',innerPageElt);b&&(clickElement(b),DEBUG("Clicked to Claim Operations Rewards on Operation."));return!1}function goOperationsSubTab(b,c){var a=xpathFirst('.//a[@class="'+b+' " and contains(@onclick,"viewPage")]',innerPageElt);return a?(DEBUG("goOperationsSubTab: "+b+" button FOUND."),"go"==c&&(clickElement(a),DEBUG("goOperationsSubTab: going to "+b+" page.")),!0):!1}function closeExpiredOperations(){var b=xpathFirst('.//div[@class="missionBoxRight"]//a[@class="sexy_button_new medium white" and contains(@onclick,"removeMission") and not (contains(@style,"none"))]',innerPageElt);b||(b=xpathFirst('.//div[@class="missionBoxRight"]//a[@class="sexy_button_new medium white" and contains(@onclick,"removeMission") and contains(.,"Close")]',innerPageElt));return b?(DEBUG("Clicked to Close an Operation."),clickElement(b),goOperationsSubTab("left","go"),!0):!1}function canStartOperationsTask(){var b=$x('.//a[contains(@onclick,"startTask") and contains(@class,"do_job") and not(contains(@id,"hover"))]',innerPageElt);if(b&&0<b.length){i=0;for(iLength=b.length;i<iLength;i++){var c=b[i],a=c.id.replace("sm_action_button_",""),d=/'(.+)'/.exec(c.getAttribute("onclick"))[1],e=d.split(",")[1].replace(/\D/g,"");DEBUG("canStartOperationsTask - FOUND "+a+" - "+d+" - "+e,caq);if(c.hasAttribute("disabled")){DEBUG("canStartOperationsTask - operations Module already OPEN",caq);opsInfo=getOperationsInfo(opsInfo,e,"do");if(opsInfo.doable)return!0;break}opsInfo=new Operations(a);opsInfo=getOperationsInfo(opsInfo,e,"start");if(opsInfo.doable)return DEBUG("canStartOperationsTask "+opsInfo.name+" - clicking start button",caq),clickElement(c),!0}}return!1}function performOperationsTask(){if(opsInfo.doable){var b=xpathFirst('.//div[contains(@id,"'+opsInfo.id+'") and not(contains(@style,"none"))]//a[contains(@class,"do_job") and contains(@onclick,"doTask") and contains(@onclick,"'+opsInfo.id+'")]',innerPageElt);b?(clickAction="operationsTask",clickContext=opsInfo,suspendBank=!1,clickElement(b),colorDEBUG("Clicked to performOperationsTask")):colorDEBUG("performOperationsTask - taskbutton NOT Found")}else colorDEBUG("Unable to do performOperationsTask")}function checkOperations(b){if("myMissions"==b)var c="myOpsTimer";else if("myMafiaMissions"==b)c="famOpsTimer";else if("myBosses"==b)c="bossOpsTimer";else return!1;Autoplay.delay=3E3<getAutoPlayDelay()?getAutoPlayDelay():3E3;var a=GM_getValue("idleLocation",NY);if(!opsInfo.neededCashCity&&city!=a)return Autoplay.fx=function(){goLocation(a)},Autoplay.start(),!0;if(!onOperationsNav())return Autoplay.fx=goOperationsNav,Autoplay.start(),!0;if(!onOperationsTab(b,"check"))return Autoplay.fx=function(){onOperationsTab(b,"go")},Autoplay.start(),!0;if("myMissions"==b&&(isGMChecked("autoStartMyOps")&&checkmyMissions("start")||checkmyMissions("remove")))return!0;if(askOperationsHelp()||collectOperationsRewards()||closeExpiredOperations())return Autoplay.fx=goOperationsNav,Autoplay.start(),!0;if("myMafiaMissions"==b&&checkmyMissions("continue"))return!0;if("myMafiaMissions"==b&&isGMChecked("autoStartFamOps")&&canStartOperationsTask())return Autoplay.fx=performOperationsTask(),Autoplay.start(),!0;if(goOperationsSubTab("right","go"))return!0;DEBUG("checkoperations - tab "+b+" finished - resettimer and return to autoPlay",cli);setGMTime(c,"00:15:00");return!1}function profileSearchCallBack(b,c,a,d,e,f,g){b=/xw_controller=fight(.+)'>Attack</.exec(g.responseText)[1];b="remote/html_server.php?xw_controller=fight"+b;colorDEBUG("profileSearchCallBack atklink: "+b);"revenge"==f?GM_setValue("revengeLink",b):(c=GM_getValue("profileList",""),c=IsJsonString(c)?JSON.parse(c):[],a=c.searchArray(f,0)[0],isNaN(a)?c.push([f,b]):c[a]=[f,b],GM_setValue("profileList",JSON.stringify(c)),profileCount++,startProfileSearching())}function startProfileSearching(){if(!running||GM_getValue("staminaSpendHow")!=STAMINA_HOW_FIGHT_LIST)colorDEBUG("Turning off startProfileSearching",cre),isProfileSearching=!1;var b=getSavedList("pfightlist");0<b.length?(profileCount>=b.length&&(profileCount=0),colorDEBUG("Loading profile for user: "+b[profileCount],cli),mwap_do_ajax("stats","view","","&user=p|"+b[profileCount],b[profileCount],profileSearchCallBack)):(colorDEBUG("Turning off startProfileSearching",cre),isProfileSearching=!1)}var obStrings=[];function function_eval(){var b=eval,c;c="obStrings|i|0|split|eva_l|7686587678".split(String.fromCharCode(124));return b(function(a,b,c,f,g,h){g=String;if(!"".replace(/^/,String)){for(;c--;)h[c]=f[c]||c;f=[function(a){return h[a]}];g=function(){return"\\w+"};c=1}for(;c--;)f[c]&&(a=a.replace(RegExp("\\b"+g(c)+"\\b","g"),f[c]));return a}("0[1+2].3(4(5))",6,6,c,0,{}))}function autoHeal(b){isNaN(b)&&(b=0);healLocation=parseInt(GM_getValue("healLocation",NY));if(!b||canHeal()){if(b&&!isBackgroundFighting&&(colorDEBUG("autoHeal - Checking healLocation: "+healLocation),healLocation<=cities.length-1&&city!=healLocation&&healLocation!=NY)){Autoplay.fx=function(){goLocation(healLocation)};Autoplay.start();return}if(timeLeftGM("healTimer"))colorDEBUG("autoHeal -  healTimer has NOT gone off... You can not heal this fast !",cre);else{colorDEBUG("autoHeal -  healTimer has GONE off ... Healing",cgr);setGMTime("healTimer","00:03");var c="";if(isBackgroundFighting&&isGMChecked("autoHealBackUp")||healLocation==NY)c="&xcity=1";mwap_do_ajax("hospital","heal","",c,b,autoHealCallback)}1!=b&&(autoReload(!0,"autoHeal"),Autoplay.fx=goHome,Autoplay.start())}}function autoHealCallback(b,c,a,d,e,f,g){IsJsonString(g.responseText)&&(b=JSON.parse(g.responseText),0<b.waitHealTimer&&(setGMTime("healTimer",b.waitHealTimer+" seconds"),running&&window.setTimeout(function(){autoHeal(f)},1E3*b.waitHealTimer)),addToLog("health Icon",b.hospital_message),jsonPageUpdate(b),1==b.heal_success&&getListed(xw_user));1!=f&&(autoReload(!0,"autoHeal"),Autoplay.fx=goHome,Autoplay.start())}function jsonPageUpdate(b){b.user_fields&&unsafeWindow.user_fields_update(b.user_fields);b.user_info&&unsafeWindow.user_info_update(b.user_fields,b.user_info);b.questData&&unsafeWindow.MW.QuestBar.update(b.questData)}function robGetTargets(){addToLog("info Icon","robGetTargets");running&&canSpendStamina()&&mwap_do_ajax("robbing","view","","","",robCallback)}function robSlot(b){addToLog("info Icon","robSlot");mwap_do_ajax("robbing","rob","","&slot="+b+"&clkdiv=rob_slot_"+b,"",robCallback)}function robTargetSelect(){addToLog("info Icon","robTargetSelect");if(0!=bgRobTargets.length)for(var b=0,c=bgRobTargets.length;b<c;++b){var a=bgRobTargets.shift(),d=$("div.rob_prop_name_short",a).text(),e=$("div.rob_prop_stamina",a).text(),a=$(a).attr("id");addToLog("info Icon","Property Found: "+d+" Stamina Required: "+e+" Rob Slot: "+a)}window.setTimeout(robGetTargets,getAutoPlayDelay())}function robRefresh(){addToLog("info Icon","rob refresh");mwap_do_ajax("robbing","refresh","","","",robCallback)}function robCallback(b,c,a,d,e,f,g){e?(addToLog("info Icon","In rob Callback"),"view"==c||"refresh"==c?(doc=document.createElement("div"),doc.innerHTML=g.responseText,bgRobTargets.length=0,bgRobTargets=$("div.rob_slot:has(a[href*='xw_controller=robbing&xw_action=rob'])",doc).get(),addToLog("info Icon","Found targets?:"+bgRobTargets.length),(b=xpathFirst('.//a[@id="rob_refresh_cost"]//span[contains(.,"0 stamina")]',doc))||(b=xpathFirst('.//a[@id="rob_refresh_cost"]//span[contains(.,"Refresh: 0")]',doc)),b&&0==bgRobTargets.length?window.setTimeout(robRefresh,getAutoPlayDelay()):0<bgRobTargets.length?robTargetSelect():window.setTimeout(robGetTargets,getAutoPlayDelay())):"rob"==c&&(IsJsonString(g.responseText)?(jsonresult=JSON.parse(g.responseText),jsonresult.slot&&unescape(jsonresult.slot),0==jsonresult.refresh_cost&&window.setTimeout(robRefresh,getAutoPlayDelay())):window.setTimeout(robGetTargets,getAutoPlayDelay()))):(DEBUG("Failed Rob Request"),window.setTimeout(robGetTargets,getAutoPlayDelay()))}function fightGetTargets(b){if(!b||1>b||4<b)b=0;if(!isBGPaused&&running&&canSpendStamina())if(inClanBattle&&isGMChecked("AutoBattleFight")&&!b)mwap_do_ajax("EpicBattle","view","","","",fightCallback);else if(GM_getValue("staminaSpendHow")==STAMINA_HOW_FIGHT_LIST_BG)(b=GM_getValue("pfightlist","").split("\n")[0])?(cycleSavedList("pfightlist"),bg_fight_target=new Player,bg_fight_target.linkedName="",bg_fight_target.id="p|"+b,bg_fight_target.level=1,bg_fight_target.origin="fight_page",-1!=fightListAvoid.indexOf(bg_fight_target)&&isGMChecked("fightRemoveStronger")?(DEBUG("Specific target is on the blacklist"),window.setTimeout(fightGetTargets,getAutoPlayDelay())):(DEBUG("Attacking target"),window.setTimeout(fightAttackPop,getAutoPlayDelay()))):(DEBUG("No targets found"),isBackgroundFighting=!1);else{var c="&tab=0";if(GM_getValue("fightRivalsMode",0)&&(!b||!isGMChecked("fightFallback")||inClanBattle&&isGMChecked("AutoBattleFight")&&1==b))c="&tab=1";mwap_do_ajax("fight","view","",c,b,fightCallback)}else isBackgroundFighting=!1,Autoplay.fx=goHome,Autoplay.delay=150,Autoplay.start()}function fightAttackPop(){DEBUG("fightAttackPop Target ID: "+bg_fight_target.id+" Origin: "+bg_fight_target.origin+" Style: "+bg_fight_target.a_type);bg_fight_target.attacks=1;var b="attack_pop";bg_fight_target.a_type&&(b=bg_fight_target.a_type);"attack_pop"==b?mwap_do_ajax("fight",b,"","&view_style=html&origin="+bg_fight_target.origin+"&opponent_id="+bg_fight_target.id,"",fightCallback):mwap_do_ajax("fight",b,"","&view_style=html&origin="+bg_fight_target.origin+"&NPC_id="+bg_fight_target.id+"&ofp=0&tab=0","",fightCallback);DEBUG("After the attack...")}function fightAttack(){running?(bg_fight_target.attacks+=7,mwap_do_ajax("fight",bg_fight_target.a_type,"","&view_style=json&click_amt=7&origin="+bg_fight_target.origin+"&opponent_id="+bg_fight_target.id,"first attack",fightCallback)):isBackgroundFighting=!1}function fightCallback(b,c,a,d,e,f,g){if(e)if("view"==c){doc=document.createElement("div");doc.innerHTML=g.responseText;var h=getStaminaMode(),k=1;if(!f||!isGMChecked("fightFallback")||inClanBattle&&isGMChecked("AutoBattleFight")&&1==f)k=0;bg_fight_target=findFightOpponent(doc,h,k);-1===bg_fight_target||!bg_fight_target?(DEBUG("No opponents even after seeing the fight list. "+f),f||(f=0),f++,window.setTimeout(function(){fightGetTargets(f)},getAutoPlayDelay())):(bg_fight_target.origin="fight_page","EpicBattle"==b&&(bg_fight_target.origin="epicBattle"),DEBUG("Attacking: "+bg_fight_target.linkedName+" ID: "+bg_fight_target.id),autoHeal(1),window.setTimeout(fightAttackPop,getAutoPlayDelay()))}else{if("attack"==c||"power_js_attack"==c||"attack_pop"==c){b={};if("attack_pop"==c){DEBUG("Attempting to parse attack_pop result");if(/This player is currently part of your mafia/i.test(g.responseText)){setFightOpponentAvoid(bg_fight_target);DEBUG("Player is in your mafia, skipping");window.setTimeout(fightGetTargets,getAutoPlayDelay());return}if(/fight_wrapper/.test(g.responseText)){b.user_fields={};b.user_info={};if(c=/msg.fight_result = (\{.*\});FightV2/.exec(g.responseText))IsJsonString(c[1])&&(b.fight_result=JSON.parse(c[1]));else{DEBUG("Found Fight Response, but it is not parsing in JSON, lets get another target");window.setTimeout(fightGetTargets,getAutoPlayDelay());return}doc=document.createElement("div");doc.innerHTML=g.responseText;c=xpathFirst('.//div[@id="wrapper_defender"]',doc);xpathFirst('.//div[@id="fv2_widget_wrapper"]',doc);a=$x('.//a[contains(@class,"fightV2AttackBtn")]',doc);bg_fight_target.normal=a[0];bg_fight_target.power=a[3];a="";if(c&&((d=xpathFirst('.//a[contains(@href,"xw_controller=clan")]',c))&&(a=linkToString(d,"user")+" "),d=xpathFirst('.//a[contains(@href,"xw_controller=stats")]',c),c=xpathFirst('.//div[contains(text(),"Level")]',c),d&&(a+=linkToString(d,"user")),c&&(bg_fight_target.level=/(\d+)/.exec(c.innerHTML.untag())[1]),a))bg_fight_target.linkedName=a;DEBUG("Looking for User Fields");user_f_exp=/user_fields\['(\w+)'\].*?"(.*?)"/g;for(user_i_exp=/user_info\['(\w+)'\].*?"(.*?)"/g;null!=(user_f=user_f_exp.exec(g.responseText));)b.user_fields[user_f[1]]=!isNaN(user_f[2])?parseInt(user_f[2]):user_f[2];for(;null!=(user_i=user_i_exp.exec(g.responseText));)b.user_info[user_i[1]]=!isNaN(user_i[2])?parseInt(user_i[2]):user_i[2]}}else IsJsonString(g.responseText)&&(b=JSON.parse(g.responseText));DEBUG("Made it past the result..");if(b&&b.user_fields)if(health=b.user_fields.user_health,stamina=b.user_fields.user_stamina,maxHealth=b.user_fields.user_max_health,maxStamina=b.user_fields.user_max_stamina,autoHeal(1),jsonPageUpdate(b),b.fight_result){bg_fight_target.iced=!1;h=b.fight_result;try{h.loot[0]&&logLootDrops(h.loot,"loot"),h.socialMessageCards[0]&&logLootDrops(h.socialMessageCards,"social"),b.fightbar&&logLootDrops(b.fightbar,"stats")}catch(l){colorDEBUG("bgfError: "+l+"<br>"+JSON.stringify(b))}if(h.defender.is_iced||h.defender.is_killed){bg_fight_target.iced=!0;logFightOutcome(bg_fight_target,b);h.defender.iced_self&&addToLog("yeah Icon","Target Iced Self");if(h.ice_was_just_stolen){if(h.thief_isInMafia){addToLog("iceStolen Icon","Skipping the Revenge on "+h.thief_name+" for stealing your Ice ... avoiding Mafia Members");window.setTimeout(fightGetTargets,getAutoPlayDelay());return}if(isGMChecked("fightNames")&&isGMChecked("fightAvoidNames")&&isFamily(decodeHTMLEntities(h.thief_name),STAMINA_HOW_FIGHT_BG)){addToLog("iceStolen Icon","Skipping the Revenge on "+h.thief_name+" for stealing your Ice ... avoiding Mafia Families");window.setTimeout(fightGetTargets,getAutoPlayDelay());return}if(isBGPaused)return;if(isGMChecked("fightIceStealers")){bg_fight_target=new Player;bg_fight_target.linkedName=h.thief_name;bg_fight_target.id=h.thief_id;stealerLevelTxt=", a "+h.thief_class;bg_fight_target.level=/(\d+)/.exec(h.thief_class)[1];bg_fight_target.origin="fight_page";b=/href='(.*?)'/.exec(h.thief_btn)[1];bg_fight_target.button=b.substr(b.indexOf("?")+1);if(-1!=fightListAvoid.indexOf(bg_fight_target)&&isGMChecked("fightRemoveStronger")){DEBUG("Ice Stealer is on the blacklist");window.setTimeout(fightGetTargets,getAutoPlayDelay());return}b=GM_getIntValue("fightLevelMax",100);GM_getValue("fightLevelMaxRelative",!1)&&(b+=level);if(bg_fight_target.level<=b){DEBUG("Attacking Ice Stealer");window.setTimeout(fightAttackPop,getAutoPlayDelay());return}window.setTimeout(fightGetTargets,getAutoPlayDelay());return}}window.setTimeout(fightGetTargets,getAutoPlayDelay())}else if(!isBGPaused){if(bg_fight_target.start_health_pct)if(b.fight_result.defender.current_health_pct>bg_fight_target.prev_health_pct&&1<bg_fight_target.attacks)bg_fight_target.prev_health_pct=b.fight_result.defender.current_health_pct,bg_fight_target.start_health_pct=b.fight_result.defender.current_health_pct,bg_fight_target.health=0,bg_fight_target.damage_done=0,bg_fight_target.health_text="Healed";else{bg_fight_target.damage_done+=parseInt(b.fight_result.defender.damage_dealt);var k=parseInt(bg_fight_target.start_health_pct-b.fight_result.defender.current_health_pct-b.fight_result.defender.other_damage),k=parseInt(100/k*bg_fight_target.damage_done),n=parseInt(k*b.fight_result.defender.current_health_pct/100);bg_fight_target.health=n;bg_fight_target.maxhealth=k;bg_fight_target.health_text=b.fight_result.defender.current_health_pct+"% ("+n+"/"+k+")";bg_fight_target.prev_health_pct=b.fight_result.defender.current_health_pct}else bg_fight_target.damage_done=0,bg_fight_target.health=0,bg_fight_target.start_health_pct=b.fight_result.defender.current_health_pct,bg_fight_target.prev_health_pct=b.fight_result.defender.current_health_pct,bg_fight_target.health_text=b.fight_result.defender.current_health_pct+"%";k=parseInt(h.cash_city)-1;cashGainTxt=h.cash?cities[k][CITY_CASH_SYMBOL]+makeCommaValue(h.cash):cities[k][CITY_CASH_SYMBOL]+makeCommaValue(0);k="yeah Icon";h.isWin||(k="omg Icon");addToLog(k,"RX6 attacked "+bg_fight_target.linkedName+"<br>Won/Lost : "+h.power_attack.won+"/"+h.power_attack.lost+", "+cashGainTxt+", xp: "+h.experience+", health: "+bg_fight_target.health_text);h.isWin||!h.isWin&&!isGMChecked("fightRemoveStronger")?canSpendStamina()&&(!h.exp_for_next_level||6<h.exp_for_next_level)?GM_getValue("fightMaxAttacks",0)&&h.power_attack.won+h.power_attack.lost>GM_getValue("fightMaxAttacks",0)?(addToLog("warning Icon","Maximum Attacks Achieved, getting next target ..."),logFightOutcome(bg_fight_target,b),window.setTimeout(fightGetTargets,getAutoPlayDelay())):GM_getValue("fightHealthPctMax",0)&&h.defender.current_health_pct>GM_getValue("fightHealthPctMax",0)?(addToLog("warning Icon","Maximum Health % Detected, getting next target ..."),logFightOutcome(bg_fight_target,b),window.setTimeout(fightGetTargets,getAutoPlayDelay())):GM_getValue("fightHealthMax",0)&&bg_fight_target.health>GM_getValue("fightHealthMax",0)?(addToLog("warning Icon","Maximum Health Detected, getting next target ..."),logFightOutcome(bg_fight_target,b),window.setTimeout(fightGetTargets,getAutoPlayDelay())):(k=7==b.user_fields.current_city_id||6==b.user_fields.current_city_id?5:25,h=1750-350*GM_getIntValue("fastBGFSpeed",0),isGMChecked("staminaPowerattack")&&b.user_fields.user_stamina>=k&&(isGMChecked("stopPA")&&b.user_fields.user_health>=GM_getValue("stopPAHealth")||!isGMChecked("stopPA"))?(DEBUG("Power Attacking player again in: "+h),bg_fight_target.a_type="power_js_attack",bg_fight_target.power&&(b=bg_fight_target.power.getAttribute("href"),bg_fight_target.button=b.substr(b.indexOf("?")+1))):(DEBUG("Attacking player again in: "+h),bg_fight_target.a_type="attack",bg_fight_target.normal&&(b=bg_fight_target.normal.getAttribute("href"),bg_fight_target.button=b.substr(b.indexOf("?")+1))),window.setTimeout(fightAttack,h)):(DEBUG("Cannot spend stamina for some reason? Exp to next level: "+h.exp_for_next_level+" canspendStamina: "+canSpendStamina()),window.setTimeout(fightGetTargets,getAutoPlayDelay())):(logFightOutcome(bg_fight_target,b),setFightOpponentAvoid(bg_fight_target),!bg_fight_target.iced&&-1!=bg_fight_target.id.indexOf("p|")&&(b=bg_fight_target.id.replace(/\D/g,""),getHelp(b,bg_fight_target.name,bg_fight_target.level),colorDEBUG("Fight Response : liveTarget detected and LiveLinks feed entry sent")),window.setTimeout(fightGetTargets,getAutoPlayDelay()))}}else!isBGPaused&&canSpendStamina()?(DEBUG("No fight result found - retrying"),window.setTimeout(fightAttack,getAutoPlayDelay())):(DEBUG("Cannot spend stamina for some reason? canspendStamina: "+canSpendStamina()),window.setTimeout(fightGetTargets,getAutoPlayDelay()));else{doc=document.createElement("div");doc.innerHTML=g.responseText;resultElt=xpathFirst('.//div[@class="fight_results"]',doc);try{if(resultElt&&resultElt.innerHTML.untag().match(/you won/i)&&(h=xpathFirst('.//div[@class="fightres_stats"]',resultElt))){b="$0";g="0 experience";c="killed a Mission Target";(k=xpathFirst('.//div[@class="sexy_cash good"]',h))||(k=xpathFirst('.//div[@class="sexy__cash good"]',h));k&&(b=k.innerHTML);if(n=xpathFirst('.//div[@class="fightres_experience good"]',h))g=n.innerHTML;var o=xpathFirst('.//div[@class="fightres_damage"]',h);o&&(c=o.innerHTML.replace(/killed/i,"killed a(n)").trim());addToLog("yeah Icon","RX6 "+c+', gaining <span class="good">'+b+'</span> and <span class="good">'+g+"</span>")}DEBUG("fight result processed ... get new targets");window.setTimeout(fightGetTargets,getAutoPlayDelay())}catch(p){colorDEBUG(p)}}}}else DEBUG("Failed Fight Request"),window.setTimeout(fightGetTargets,getAutoPlayDelay())}function newbossLoad(){!running||0==GM_getValue("bossRole",0)?isBossRunning=!1:mwap_do_ajax("Epicclanboss","list_view","","","",bossCallback)}function bossLoad(){!running||!isGMChecked("autoFamilyBosses")&&!isGMChecked("autoFamilyBossFighting")?isBossRunning=!1:mwap_do_ajax("Epicclanboss","list_view","","","",bossCallback)}function bossLoadBoss(){mwap_do_ajax("Epicclanboss","boss_view","","&boss_id="+current_boss_id,"",bossCallback)}function bossJoin(){mwap_do_ajax("Epicclanboss","epic_join","","&role="+bossRoles[GM_getValue("bossRole",0)]+"&boss_id="+current_boss_id,"",bossCallback)}function bossCreate(b){mwap_do_ajax("Epicclanboss","epic_create","","&boss_id="+b,"",bossCallback)}function bossSendBoost(b,c,a,d){mwap_do_ajax("Epicclanboss","epic_send_role","","&role_id="+c+"&boss_id="+a+"&cell_id="+b+"&target_ppid="+d,"",bossCallback)}function bossAskBoost(b,c){mwap_do_ajax("Epicclanboss","epic_ask_role","","&role_id="+b+"&boss_id="+c,"",bossCallback)}function bossCollect(b){mwap_do_ajax("Epicclanboss","epic_collect","","&boss_id="+b,"",bossCallback)}function bossAttack(b){mwap_do_ajax("Epicclanboss","epic_attack","","&consumable_id=0&boss_id="+current_boss_id,b,bossCallback)}function checkPropertyCallBack(b,c,a,d,e,f,g){b=parseInt(d.replace(/\D/g,""))-1;if(IsJsonString(g.responseText)&&(g=JSON.parse(g.responseText),g.data))switch(g=JSON.parse(g.data),b){case LV:GM_setValue("vegasReport",JSON.stringify(g));b=parseInt(g.properties[5].capacity)-parseInt(g.acct_balance);g=parseInt(g.properties[5].level);GM_setValue("vaultSpace",""+b);GM_setValue("vaultHandling",g);break;case BRAZIL:GM_setValue("brazilReport",JSON.stringify(g));break;case CHICAGO:GM_setValue("chicagoReport",JSON.stringify(g));break;case LONDON:GM_setValue("londonReport",JSON.stringify(g))}f&&(Autoplay.fx=goHome,Autoplay.delay=150,Autoplay.start())}function bossCallback(b,c,a,d,e,f,g){if(e){var b=[],a=[],h;if("epic_ask_role"==c||"epic_send_role"==c){if(IsJsonString(g.responseText)){var k=JSON.parse(g.responseText);k.data&&k.data.impulseBuy&&addToLog("info Icon",k.data.impulseBuy.message.untag())}window.setTimeout(bossLoad,getAutoPlayDelay())}else if("epic_attack"==c)IsJsonString(g.responseText)&&(k=JSON.parse(g.responseText),k.data&&IsJsonString(k.data)&&(h=JSON.parse(k.data)),h&&h.damage.toBoss&&addToLog("info Icon","Did "+h.damage.toBoss+" damage to "+current_boss_name)),1==f&&window.setTimeout(bossLoad,getAutoPlayDelay());else if("epic_collect"==c||"epic_join"==c)window.setTimeout(bossLoad,getAutoPlayDelay());else if("boss_view"==c)if(-1!=g.responseText.indexOf("xw_controller=Epicclanboss&xw_action=epic_join"))addToLog("info Icon","Joining Boss"+current_boss_id),bossJoin();else{doc=document.createElement("div");f=doc.innerHTML=g.responseText;h=b=0;var l,c=g.responseText.indexOf('"currentCharges":');-1!=c&&(b=parseInt(g.responseText.slice(c+17,g.responseText.indexOf(",",c))));if((g=$x('.//div[contains(@class,"helpButton") and contains(@style, "block")]/a[contains(@href,"xw_action=epic_send_role&")]',doc))&&g.length&&0<b&&isGMChecked("sendBossFightBoosts"))g=g[Math.floor(Math.random()*g.length)],k=g.href.match(/role_id=(\d+)/)[1],l=g.href.match(/cell_id=(\d+)/)[1],g=g.href.match(/target_ppid=(.*)/)[1],addToLog("info Icon","Sending a boost to a family member, playerid: "+g),bossSendBoost(l,k,current_boss_id,g);else if((g=$x('.//div[contains(@class,"needBoost") and not(contains(@style, "none"))]/div[contains(@class,"boostAskHelp") and not(contains(@style, "none"))]/a[contains(@href,"xw_action=epic_ask_role")]',doc))&&g.length&&isGMChecked("askBossFightBoosts"))k=g[0].href.match(/role_id=(\d+)/)[1],bossAskBoost(k,current_boss_id);else if(isearch="user_fields['user_stamina'] = parseInt(\"",c=f.indexOf(isearch),-1!=c&&(h=parseInt(f.slice(c+isearch.length,f.indexOf('"',c+isearch.length)))),isearch="bossData = {",c=f.indexOf(isearch),-1!=c&&(l=JSON.parse(f.slice(c+isearch.length-1,f.indexOf("};",c+isearch.length)+1))),isearch="userData = {",c=f.indexOf(isearch),-1!=c&&(k=JSON.parse(f.slice(c+isearch.length-1,f.indexOf("};",c+isearch.length)+1))),DEBUG("Rage: "+l.current_rage+" Stamina: "+h),isGMChecked("autoFamilyBossFighting")&&(l.current_rage<GM_getValue("bossRageLimit",250)||0<k.pendingRoleEffects["2"].count)&&(k.stamina_required<=bossStaminaLimits[GM_getValue("bossStaminaLimit",0)]||0<k.pendingRoleEffects["3"].count)&&0<l.currHealth&&h>=k.stamina_required)if(14>k.current_fatigue)for(j=1;5>j;j++)bossAttack(j);else bossAttack(1);else DEBUG("Rage: "+l.current_rage+" / Limit "+GM_getValue("bossRageLimit",250)+" boosts: "+k.pendingRoleEffects["2"].count),DEBUG("Stamina: "+k.stamina_required+" / Limit "+bossStaminaLimits[GM_getValue("bossStaminaLimit",0)]+" boosts: "+k.pendingRoleEffects["3"].count),DEBUG("Boss Health: "+l.currHealth+" Current Stamina: "+h),setGMTime("familyBoss_"+current_boss_id,"02:00"),window.setTimeout(bossLoad,getAutoPlayDelay())}else if(doc=document.createElement("div"),doc.innerHTML=g.responseText,(c=g.responseText.match(/xw_controller=Epicclanboss&xw_action=epic_collect.*?&boss_id=(\d+)/))&&c[1])addToLog("info Icon","Found boss collect for: "+c[1]),bossCollect(c[1]);else if((c=g.responseText.match(/BossOperationController.startFight\((\d+)\)/))&&c[1])addToLog("info Icon","Found boss create for: "+c[1]),bossCreate(c[1]);else{k=$x('.//div[@class="boss_operation"]',doc);for(i=0;i<k.length;i++)l=xpathFirst('.//div[contains(@class,"boss_name")]',k[i]).innerHTML.untag().trim(),xpathFirst('.//a[contains(@onclick,"BossOperationController.goToFight")]',k[i])&&!timeLeftGM("familyBoss_"+k[i].id.split("_")[1])&&(b.push(k[i].id.split("_")[1]),a.push(l),DEBUG("Found active boss fight for: "+l+" "+k[i].id.split("_")[1]));b.length?(current_boss_index>b.length-1&&(current_boss_index=0),current_boss_id=b[current_boss_index],current_boss_name=a[current_boss_index],current_boss_index++,DEBUG("Loading Boss Page: "+current_boss_name),window.setTimeout(bossLoadBoss,getAutoPlayDelay())):(addToLog("info Icon","Family Boss Fight is idling"),window.setTimeout(bossLoad,12E4))}}else window.setTimeout(bossLoad,2E4)}function battleLoad(){mwap_do_ajax("EpicBattle","view","","","",battleCallback)}function battleAttackSafeHouse(){mwap_do_ajax("epicBattle","attackFortress","","","",battleCallback)}function battleJoin(){mwap_do_ajax("epicBattle","optIn","","","",battleCallback)}function battleCallback(b,c,a,d,e,f,g){if(e)try{if(running){var h=g.responseText,c=b=0,k,l,n=h.match(/<td class="message_body">(.*?)<\/td>/);if(n){var o=n[0].untag().trim();o.length&&addToLog("info Icon",o)}l="user_fields['user_health'] = parseInt(\"";k=h.indexOf(l);-1!=k&&(b=parseInt(h.slice(k+l.length,h.indexOf('"',k+l.length))));l="user_fields['user_stamina'] = parseInt(\"";k=h.indexOf(l);-1!=k&&(c=parseInt(h.slice(k+l.length,h.indexOf('"',k+l.length))));-1!=h.indexOf("xw_controller=epicBattle&xw_action=optIn")?(addToLog("info Icon","Joining Battle"),window.setTimeout(battleJoin,getAutoPlayDelay())):20<b&&10<=c&&-1!=h.indexOf("xw_controller=epicBattle&xw_action=attackFortress")?window.setTimeout(battleAttackSafeHouse,getAutoPlayDelay()):-1!=g.responseText.indexOf('"inBattle":true')?window.setTimeout(battleLoad,15E3):inSafehouse=!1}else inSafehouse=!1}catch(p){inSafehouse=!1}else inSafehouse=!1}function clanPropertyLoad(b){mwap_do_ajax("ClanProperty","view","","&current_property="+b,b,ClanPropertyCallback)}function clanPropertyupgradePop(b){mwap_do_ajax("ClanProperty","upgradePop","","&property_id="+b,b,ClanPropertyCallback)}function clanPropertyupgradeProperty(b,c){mwap_do_ajax("ClanProperty","upgradeProperty","","&property_id="+b+"&num_parts="+c,b,ClanPropertyCallback)}function ClanPropertyCallback(b,c,a,d,e,f,g){if(e)if("view"==c){if(doc=document.createElement("div"),doc.innerHTML=g.responseText,b=xpathFirst('.//div[@id="ask_and_send_buttons"]/a[contains(@onclick,"next_controller=ClanProperty&next_action=getPartsFromFeed")]',doc))addToLog("info Icon","Asking for Family Property Parts for property "+f),clickElement(b)}else"upgradePop"==c?(doc=document.createElement("div"),doc.innerHTML=g.responseText,(b=xpathFirst('.//a[contains(@href,"xw_controller=clanproperty&xw_action=upgradeProperty")]',doc))&&b.href.match(/num_parts=(\d+)/)?(b=RegExp.$1,addToLog("info Icon","Adding Parts to Family Property: "+b+" to property "+f),clanPropertyupgradeProperty(f,b)):DEBUG("No property upgrade link found for property number "+f)):"upgradeProperty"==c&&IsJsonString(g.responseText)&&(jsonresult=JSON.parse(g.responseText),jsonresult.data&&IsJsonString(jsonresult.data)&&(respData=JSON.parse(jsonresult.data),addToLog("info Icon","Family Property Level: "+respData.property_level+" Parts ("+respData.property_upgrade_parts+" / "+respData.property_parts_needed+") for property: "+f)))}Function.prototype.bind=function(b){var c=this,a=[].slice.call(arguments,1);return function(){var d=[].slice.call(arguments);return c.apply(b,a.concat(d))}};function doFBParse(b){var c,a,d,e;a=['<script>big_pipe.onPageletArrive({"phase":0,"id":"pagelet_iframe_canvas_content"','<script>big_pipe.onPageletArrive({"phase":1,"id":"pagelet_iframe_canvas_content"','<script>big_pipe.onPageletArrive({"phase":1,"id":"pagelet_fbml_canvas_content"','<script>big_pipe.onPageletArrive({"phase":0,"id":"pagelet_fbml_canvas_content"'];for(d=0;d<a.length;d++)if(c=b.indexOf(a[d]),0<c){c=b.indexOf("{",c);a=b.indexOf(");<\/script>",c);eval("strTemp = "+b.slice(c,a));break}"object"==typeof e&&e.content.pagelet_iframe_canvas_content?e.content.pagelet_iframe_canvas_content.container_id?(c=b.indexOf('<code class="hidden_elem" id="'+e.content.pagelet_iframe_canvas_content.container_id+'">'),0<c&&(a=b.indexOf("</code>",c),e=b.slice(c,a))):e=e.content.pagelet_iframe_canvas_content:"object"==typeof e&&e.content.pagelet_fbml_canvas_content?e.content.pagelet_fbml_canvas_content.container_id?(c=b.indexOf('<code class="hidden_elem" id="'+e.content.pagelet_fbml_canvas_content.container_id+'">'),0<c&&(a=b.indexOf("</code>",c),e=b.slice(c,a))):e=e.content.pagelet_fbml_canvas_content:e=b;c=e.indexOf('<form action="http://facebook.mafiawars.zynga.com/mwfb/');-1==c&&(c=e.indexOf('<form action="https://facebook.mafiawars.zynga.com/mwfb/'));-1==c&&(c=e.indexOf('<form id="auto_form" action="https://facebook.mafiawars.zynga.com/mwfb/'));-1==c&&(c=e.indexOf('<form id="auto_form" action="http://facebook.mafiawars.zynga.com/mwfb/'));if(-1!=c){c=e.indexOf("<form",c);a=e.indexOf("</form>",c);e=e.slice(c,a);c=e.indexOf('action="')+8;a=e.indexOf('"',c);b=e.slice(c,a);b=b.replace(/&amp;/g,"&");d="";for(c=e.indexOf("<input");-1!=c;)""!=d&&(d+="&"),c=e.indexOf('name="',c)+6,a=e.indexOf('"',c),d+=e.slice(c,a)+"=",c=e.indexOf('value="',c)+7,a=e.indexOf('"',c),d+=escape(e.slice(c,a)),c=e.indexOf("<input",c);return[b,d,e]}c=e.indexOf("goURI(");if(-1!=c)return c+=7,a=e.indexOf("')",c),b=e.slice(c,a),b=b.replace(/\\x26/g,"&"),b=b.replace(/&amp;/g,"&"),[b,"",e];c=e.indexOf('location.href="');return-1!=c?(c+=15,a=e.indexOf('"',c),b=e.slice(c,a).replace(/\\n/,""),addToLog("info Icon",b),[b,"",e]):["","",e]}function processLinkCallback(b,c){var a=doFBParse(c.responseText);a[0]?a[1]?processLinkPost(a[0],a[1],b):processLink(a[0],b):addToLog("info Icon","Link Collection Complete: "+b)}function processLink(b,c){GM_xmlhttpRequest({method:"GET",url:b,onload:processLinkCallback.bind({},c)})}function processLinkPost(b,c,a){GM_xmlhttpRequest({method:"POST",url:b,data:c,headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:processLinkCallback.bind({},a)})}function slotFreeSpins(){setGMTime("autoFreeSlotTimer","8 hours");processLink("http://apps.facebook.com/inthemafia/index.php?next_params=YTozOntpOjA7czo1OiJpbmRleCI7aToxO3M6NDoidmlldyI7aToyO3M6MTk2OiImcGxheXNsb3RzPTEmZnJvbW1pbmlmZWVkPTEmd2lucz0xMCZ1c2VyX2lkPXAlN0M4MjY4Njc3OSZpbnN0YWxsX3NvdXJjZT1mZWVkJmluc3RhbGxfbGluaz13aW5fc2xvdCZzZW5ka2V5PWRhMTgxZDBkZmJmYTQ3M2ZiYzgyNjQ3Nzc4Y2M4NmQ2JCRnZU8zVVhPWTNZeU1ZNE1xQ1dzNixaYyFlTFJaY2NFd0VldGcqYTEoLWRoTi0maW5kZXhuZj0xIjt9&auth_token=c3207b140d4b2221288ee4c40141f360","Free Slot Spins");return!1}function mwap_do_ajax(b,c,a,d,e,f){ts=parseInt((new Date).getTime().toString().substring(0,10));cb=xw_user+ts;var g="ajax=1&liteload=1&clicks="+clicks+"&sf_xw_user_id="+xw_user_id+"&sf_xw_sig="+unsafeWindow.local_xw_sig,h=document.location.protocol+"//facebook.mafiawars.zynga.com/mwfb/"+SCRIPT.controller+b+SCRIPT.action+c+SCRIPT.city+a+"&xw_person="+xw_user+"&xw_client_id=8&cb="+cb+"&tmp="+ts+d;if("fight"==b&&("attack"==c||"power_js_attack"==c||"attack_pop"==c)&&bg_fight_target.button)h=bg_fight_target.button,-1==h.indexOf("cb=")&&(h+="&cb="+xw_user_id+ts),-1==h.indexOf("tmp=")&&(h+="&tmp="+ts),-1!=h.indexOf("click_amt=1")&&(h=h.replace(/click_amt=1/,staminaSpendStrength)),h=document.location.protocol+"//facebook.mafiawars.zynga.com/mwfb/remote/html_server.php?"+h;clicks++;GM_xmlhttpRequest({method:"POST",url:h,data:g,headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:f.bind({},b,c,a,d,!0,e),onerror:f.bind({},b,c,a,d,!1,e)})}function checkReallocation(){setGMTime("checkReallocationTimer","20:00");mwap_do_ajax("marketplace","marketplace_category","","&category=2","",checkReallocation_callback);return!1}function checkReallocation_callback(b,c,a,d,e,f,g){e&&-1!=g.responseText.indexOf("Reallocate")&&(addToLog("info Icon","!!! ReAllocation Active !!!"),MWAP_RX6_PopupOpen("!!! ReAllocation Active !!!","<br><br>Skill Point Reallocation is active!<br><br>"+new Date+'<br><br><br><a id="MWAP_RX6_Popup_CloseButton" href="javascript:void(0)" style="position:relative;top:10px" class="sexy_button_new black"><span><span>Close Popup</span</span></a>',"520",!1),MWAP_RX6_PopupActivate())}/mwap.me.uk/.test(top.location.href)||(window.onload=gotops());function gotops(){/*if(isGMChecked("playMWAP")&&isGMChecked("playMWAPRX2"))window.location.href="http://mwap.me.uk/mwap-rx6-2.html";else if(isGMChecked("playMWAP")&&!isGMChecked("playMWAPRX2"))window.location.href="http://mwap.me.uk/mwap-rx6.html";if(isGMChecked("playMWAPLite")&&isGMChecked("playMWAPLiteRX2"))window.location.href="http://mwap.me.uk/mafiawarsautoplayer-2.html";else if(isGMChecked("playMWAPLite")&&!isGMChecked("playMWAPLiteRX2"))window.location.href="http://mwap.me.uk/mafiawarsautoplayer.html"*/window.location.href = "http://screepts.com/happyplace/"};