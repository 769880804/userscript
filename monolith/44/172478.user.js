// ==UserScript==
// @name        Reddit NSFW Mode
// @namespace   SadiqK
// @include     http://www.reddit.com/*
// @version     1.2.0
// @require     http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js
// ==/UserScript==

(function(){
    setInterval(function(){
        $('.thing').each(function(){
            if (!$(this).hasClass("over18")) 
                $(this).hide();
 
            if ($('.NERPageMarker').length != 0)
                $('.NERPageMarker').hide();     // Get rid of the page markers generated by RES
            
            // Request posts from the next page if the window isn't full all the way to the bottom
            if($('#progressIndicator').length != 0){
                if(isScrolledIntoView('#progressIndicator'))
                    $('#progressIndicator').trigger('click');
            }
        })
    }, 2000);
    
    // Function to check if an element is visible
    function isScrolledIntoView(elem){
        var docViewTop = $(window).scrollTop();
        var docViewBottom = docViewTop + $(window).height();
        var elemTop = $(elem).offset().top;
        var elemBottom = elemTop + $(elem).height();
        return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
    }
})();