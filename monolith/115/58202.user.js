// ==UserScript==
// @name           Gamer.Ru Extended
// @namespace      http://www.gamer.ru/
// @description    Вносит некоторые изменения в Gamer.Ru!
// @author         Tarahonich Yuriy aka Sofcase
// @include        http://*.gamer.ru/*
// ==/UserScript==

var HideAdvBox=false;if(getCookie('gre_HideAdvBox')!=""){HideAdvBox=getCookie('gre_HideAdvBox')=='true'}var HideLeftSide=false;if(getCookie('gre_HideLeftSide')!=""){HideLeftSide=getCookie('gre_HideLeftSide')=='true'}var HideBlackList=false;if(getCookie('gre_HideBlackList')!=""){HideBlackList=getCookie('gre_HideBlackList')=='true'}var BlackListBlogs=new Array();if(getCookie('gre_BlackListBlogs')!=""){BlackListBlogs=getCookie('gre_BlackListBlogs').split(";")}GM_registerMenuCommand("Открыть настройки",OpenPrefs,"q","alt","h");function OpenPrefs(){if(unsafeWindow.document.getElementById('PrefsWindow')!=null){unsafeWindow.document.getElementById('PrefsWindow').style.display='block';unsafeWindow.document.getElementById('PrefsWindow').style.top=(window.pageYOffset+100)+'px';return}var MainDiv=unsafeWindow.document.createElement('div');unsafeWindow.$(MainDiv).attr('id','PrefsWindow');unsafeWindow.$(MainDiv).css({'position':'absolute','top':(window.pageYOffset+100)+'px','left':'100px','z-index':9999,'width':'270px','background':'#fff','border':'1px solid #000','-moz-border-radius':'3px','border-radius':'3px','-webkit-border-radius':'3px','font-size':'11px','font-family':'tahoma','opacity':0});unsafeWindow.$(MainDiv).html('<div style="color:#09f;background:#e6e6e6;padding:5px 10px;cursor:move;">'+'<b>Настройки</b>'+'<span id="PrefsWinClose" style="float:right;cursor:pointer;"><b>x</b></span>'+'</div>'+'<div style="background:#fff;border-top:1px solid #dcdcdc;padding:5px 10px;">'+'<table width="100%" cellspacing="5" cellpadding="0">'+'<tr><td colspan="2"><b>Черный список блогов:</b><br /><span style="color:#999;">Разделяйте игры символом «;»</span></td></tr>'+'<tr><td colspan="2"><input type="text" id="bl_blogs" style="width:98%;border:1px solid #ccc;font-size:13px;padding:1px;font-family:tahoma;" /></td></tr>'+'<tr><td><input type="checkbox" id="pref_hide_blacklist" value="1" /></td><td>Скрывать посты из черного списка?</td></tr>'+'<tr><td colspan="2"><hr size="1" noshadow="noshadow" /></td></tr>'+'<tr><td><input type="checkbox" id="pref_hide_adv" value="1" /></td><td>Скрывать блок с рекламой?</td></tr>'+'<tr><td><input type="checkbox" id="pref_hide_leftside" value="1" /></td><td>Скрывать левый блок целиком?</td></tr>'+'<tr><td></td><td><br /><input type="submit" value="Сохранить" id="pref_save_btn" style="width:80%;font-family:tahoma;" /></td></tr>'+'</table>'+'</div>');unsafeWindow.$(MainDiv).draggable({containment:'parent',opacity:0.35,scroll:true});unsafeWindow.$(MainDiv).appendTo('body');document.getElementById('bl_blogs').value=BlackListBlogs.join(';');document.getElementById('pref_hide_blacklist').checked=HideBlackList;document.getElementById('pref_hide_adv').checked=HideAdvBox;document.getElementById('pref_hide_leftside').checked=HideLeftSide;unsafeWindow.$(MainDiv).animate({"opacity":1},1000);document.getElementById('pref_save_btn').addEventListener('click',function(){setCookie('gre_HideAdvBox',document.getElementById('pref_hide_adv').checked,365);setCookie('gre_HideLeftSide',document.getElementById('pref_hide_leftside').checked,365);setCookie('gre_HideBlackList',document.getElementById('pref_hide_blacklist').checked,365);setCookie('gre_BlackListBlogs',document.getElementById('bl_blogs').value,365);alert('Что бы изменения вошли в силу, необходимо обновить страницу!');unsafeWindow.$(document.getElementById('PrefsWinClose')).parent().parent().css('display','none')},false);document.getElementById('PrefsWinClose').addEventListener('click',function(){unsafeWindow.$(document.getElementById('PrefsWinClose')).parent().parent().css('display','none')},false)}if(HideBlackList){unsafeWindow.$('.post h3').each(function(){var el=unsafeWindow.$(this);var findPost=false;var i=0;var CountBlogs=BlackListBlogs.length;for(i=0;i<CountBlogs;i++){if(BlackListBlogs[i].toLowerCase()==el.children('a:first').text().toLowerCase()){findPost=true;break}}if(findPost){var postId=new RegExp('post_([0-9]+)_marks').exec(el.children('span:last').attr('class'))[1];unsafeWindow.$('.for_item_post_'+postId).animate({"opacity":.3},1000);if(el.next('div.pics')!=null){el.next('div.pics').css("display","none")}if(el.nextAll('div.body')!=null){el.nextAll('div.body').css("display","none")}if(el.nextAll('div[class!=user]')!=null){el.nextAll('div[class!=user]').css("display","none")}if(el.nextAll('div.user')!=null){el.nextAll('div.user').css("display","none")}var element=document.createElement('a');element.style.cursor='pointer';element.style.textDecoration='underline';element.appendChild(document.createTextNode('Раскрыть пост'));element.addEventListener("click",function(event){event.target.style.display='none';unsafeWindow.$('.for_item_post_'+postId+' div.body').css("display","block");unsafeWindow.$('.for_item_post_'+postId+' div.user').css("display","block");unsafeWindow.$('.for_item_post_'+postId+' div.pics').css("display","block");unsafeWindow.$('.for_item_post_'+postId).animate({"opacity":1},1000)},false);el.after(element)}})}if(HideLeftSide){unsafeWindow.$('div.col_left').css('display','none');unsafeWindow.$('div.col_right').css('margin-left','0px')}if(HideAdvBox){unsafeWindow.$('div.left_side_block:last').css('display','none')}if(unsafeWindow.$('li.my_avatar div span')!=null){unsafeWindow.$('li.my_avatar div').css({'border':'1px solid #069','width':'8px','height':'110px'});unsafeWindow.$('li.my_avatar div span').css({'width':'8px','left':'0'});var divpercent=document.createElement('span');divpercent.appendChild(document.createTextNode(unsafeWindow.$('li.my_avatar div span').css('height')));divpercent.style.position='absolute';divpercent.style.top='113px';divpercent.style.left='127px';divpercent.style.fontSize='10px';divpercent.style.color='#006595';unsafeWindow.$('li.my_avatar div').after(divpercent)}if(unsafeWindow.$('#logo')!=null){unsafeWindow.$('#logo').css('cursor','pointer');unsafeWindow.$('#logo').click(function(){location.href='http://www.gamer.ru/'})}function getCookie(c_name){if(document.cookie.length>0){c_start=document.cookie.indexOf(c_name+"=");if(c_start!=-1){c_start=c_start+c_name.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1)c_end=document.cookie.length;return unescape(document.cookie.substring(c_start,c_end))}}return""}function setCookie(c_name,value,expiredays){var exdate=new Date();exdate.setDate(exdate.getDate()+expiredays);document.cookie=c_name+"="+escape(value)+((expiredays==null)?"":";expires="+exdate.toGMTString())}