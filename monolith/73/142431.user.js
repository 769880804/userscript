// ==UserScript==
// @name           HackForums.net - PM From Post
// @namespace      spafic/pmpost
// @description    Easily send PMs from threads on HackForums.net
// @author         Spafic
// @copyright      Spafic 2012 (http://userscripts.org/users/Spafic)
// @licence        GNU General Public License
// This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. For a copy, see <http://www.gnu.org/licenses/>. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.use
//
// @match          *://*.hackforums.net/showthread.php*
// @version        1.0.2
// @downloadURL    https://userscripts.org/scripts/source/142431.user.js
// @updateURL      https://userscripts.org/scripts/source/142431.meta.js
//
// @icon           http://cdn2.hackforums.net/uploads/ficons/hf-news.png
// @icon64         http://cdn2.hackforums.net/uploads/ficons/hf-news.png
// @history        1.0.0 - Script created
// @history        1.0.1 - Now works with FireFox
// @history        1.0.2 - Fixed a small error I made where it would link to the poster's profile instead of the post.
// ==/UserScript==

(function(){var c,b,a,d,g,h,e,f;b=[];d=0;g=-1==document.body.innerHTML.toString().indexOf("<\!-- start: postbit_classic --\>")?!1:!0;for(a=0;a<document.getElementsByTagName("a").length;a++)c=document.getElementsByTagName("a")[a],-1!=c.href.indexOf("my_post_key")&&(h=c.href.split(/my_post_key\=/)[1]);if(!0==g){c=document.getElementById("posts").getElementsByClassName("smalltext");for(a=0;a<c.length;a++)-1!=c[a].innerHTML.toString().indexOf("start: postbit_pm")&&(b[d]=c[a],d++)}else b=document.getElementsByClassName("author_buttons float_left");for(a=0;a<b.length;a++)e=document.createElement("div"),e.setAttribute("style","position:absolute;z-index:100;padding:5px;margin-top:-360px;background-color:#333333;opacity:0.99;border:5px ridge #4F3A6B;display:none;"),e.setAttribute("name","pmpanel"+a),"PM"==b[a].getElementsByClassName("bitButton")[0].textContent&&(!0==g?(d=b[a].parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.getElementsByTagName("strong")[0].textContent,c=b[a].parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.getElementsByClassName("smalltext")[1].getElementsByTagName("a")[0].getAttribute("href")):(d=b[a].parentNode.parentNode.parentNode.getElementsByClassName("post_author")[0].getElementsByTagName("strong")[0].textContent,c=-1!=b[a].parentNode.parentNode.parentNode.getElementsByTagName("a")[0].getAttribute("href").indexOf("pid=")?b[a].parentNode.parentNode.parentNode.getElementsByTagName("a")[0].getAttribute("href"):b[a].parentNode.parentNode.parentNode.getElementsByTagName("a")[1].getAttribute("href")),e.innerHTML='<form action="private.php" method="POST" name="input" target="_BLANK"><input type="hidden" name="action" value="do_send" /><input type="hidden" name="pmid" value /><input type="hidden" name="do" value /><input type="hidden" name="my_post_key" value="'+h+'" /><input type="hidden" name="to" value="'+d+'" /><table><tr><td><span style="text-size:13px;">To</span></td><td><strong>'+d+'</strong></td></tr><tr><td><span style="text-size:13px;">Subject</span></td><td><input type="text" name="subject" size="75" maxlength="85" /></td></tr><tr><td><span style="text-size:13px;">Message</span></td><td><textarea name="message" cols="66" rows="8">[size=x-small]Sent from post http://www.hackforums.net/'+c+'[/size]\n\n</textarea></td></tr><tr><td><span style="text-size:13px;">Options</span></td><td><label><input type="checkbox" name="options[signature]" value="1" checked="checked" /><strong>Signature:</strong> include your signature in this message.</label><br /><label><input type="checkbox" name="options[disablesmilies]" value="1" /><strong>Disable Smilies:</strong> disable smilies from showing in this message.</label><br /><label><input type="checkbox" name="options[savecopy]" value="1" checked="checked" /><strong>Save a Copy:</strong> save a copy of this message in your Sent Items folder.</label></td></tr><tr><td colspan="2"><center><input type="submit" class="bitButton" style="cursor:pointer" name="submit" value="Send Message" /><input type="submit" class="bitButton" style="cursor:pointer" name="saveasdraft" value="Save as Draft" /></center></td></tr></table></form>',b[a].appendChild(e),b[a].getElementsByClassName("bitButton")[0].setAttribute("just4me",a),b[a].getElementsByClassName("bitButton")[0].textContent="Open PM Box",b[a].getElementsByClassName("bitButton")[0].setAttribute("just4me_visible","false"),b[a].getElementsByClassName("bitButton")[0].setAttribute("onclick","return false;"),b[a].getElementsByClassName("bitButton")[0].addEventListener("click",function(){if(this.getAttribute("just4me_visible")=="false"){f=this.getAttribute("just4me");document.getElementsByName("pmpanel"+f)[0].style.display="block";this.setAttribute("just4me_visible","true");this.textContent="Close PM Box"}else{f=this.getAttribute("just4me");document.getElementsByName("pmpanel"+f)[0].style.display="none";this.setAttribute("just4me_visible","false");this.textContent="Open PM Box"}},!1),e=null)})();