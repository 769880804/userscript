// ==UserScript==
// @name           Gmail FavIcon Alerts 2.6
// @description    Alerts you to the status of your Gmail Inbox through distinct FavIcons.
// @version        2.6.2
// @date           2009-02-19
// @author         Peter Wooley
// @author         Tyler Sticka
// @namespace      http://peterwooley.com
// @include        https://mail.google.com/mail*
// @include        http://mail.google.com/mail*
// @include        https://mail.google.com/mail*
// @include        http://mail.google.com/a*
// @include        https://mail.google.com/a*
// ==/UserScript==
if(!GM_xmlhttpRequest) // Try to degrade... not so gracefully.
	return alert('Gmail FavIcon Alerts 2 requires Ajax support in Greasemonkey,\nplease upgrade to the latest version.');

// Register GM Commands and Methods
GM_registerMenuCommand( "Gmail FavIcon Alerts > Chat Alerts On", function() { setChat(true) } );
GM_registerMenuCommand( "Gmail FavIcon Alerts > Chat Alerts Off", function() { setChat(false) } );
GM_registerMenuCommand( "Gmail FavIcon Alerts > Unread Count On", function() { setUnreadCountDisplay(true) } );
GM_registerMenuCommand( "Gmail FavIcon Alerts > Unread Count Off", function() { setUnreadCountDisplay(false) } );
function setChat(val) { GM_setValue('chatEnabled', val) };
function setUnreadCountDisplay(val) { GM_setValue('unreadCountDisplay', val) };

var gfia_instance;
var gfia_chat = false || GM_getValue('chatEnabled', false);

// Wait for the window to load to try and initialize,
// then check for Gmail's API, which is only loaded several <iframe>s in;
// finally call the method that creates the instance
window.addEventListener('load', function() {
	  if (unsafeWindow.gmonkey) { // Version 2 Method, using Google's API
	    unsafeWindow.gmonkey.load('1.0', function(gmail) {
			gfia(gmail);
	    });
	  }
	}, true);

function gfia(gmail) {
	if(!gfia_instance)
		setTimeout( function(gmail) { gfia_instance = new GmailFavIconAlerts(gmail); }, 0, gmail);			
}


function GmailFavIconAlerts(gmail) {
	var self = this;
	
	this.construct = function() {
		this.chat = this.getChat();
		this.chatting = false;
		this.head = top.document.getElementsByTagName("head")[0];
		this.inboxText = 'Inbox';
		this.chatText = ' says';
		this.timer;
		this.icons = {
			chat: 'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABKuv8ASrr/cIqv/3CKr/9wiq//cIqv/3CKr/9wiq//cIqv/3CKr/9wiq//cIqv/3CKr/9wiq//AEq6/wBKuv8ATMH/AEzB/7nD0v/e3t7/3t7e/97e3v/e3t7/3t7e/97e3v/e3t7/3t7e/97e3v/e3t7/ucPS/wBMwf8ATMH/AE/J/wBPyf93krv/wMnY/+Xl5f/l5eX/5eXl/+Xl5f/l5eX/5eXl/+Xl5f/l5eX/wMnY/3eSu/8AT8n/AE/J/wBS1P8AUtT/xtHh/3yXwf/G0eH/7e3t/+3t7f9LjO3/S4zt/+3t7f/t7e3/xtHh/3yXwf/G0eH/AFLU/wBS1P8AV9n/AFfZ//T09P/M1+j/gJ3I/5av1v8ue+//Fmnp/xZp6f8ue+//lq/W/4CdyP/M1+j/9PT0/wBX2f8AV9n/AF7g/wBe4P/7+/v/+/v7/5y23v81gfX/HHHx/xNr7/8Ta+//HHHx/zWB9f+ctt7/+/v7//v7+/8AXuD/AF7g/w5o5v8OaOb///////////88iPr/IHTz/x1y8v+10v//tdL//x1y8v8kdvT/PIj6////////////Dmjm/w5o5v8gc+z/IHPs//////9Fjfr/Ln30/yd58/+41P////////////+41P//J3nz/y599P9Fjfr//////yBz7P8gc+z/Lnzx/y588f9Nkvr/NID0/zB+8/+71v///////////////////////7vW//8wfvP/Pon3/02S+v8ufPH/Lnzx/ziD9P84g/T/OIP0/ziD9P++2P//////////////////////////////////vtj//ziD9P84g/T/OIP0/ziD9P8+hvP/Pobz/z6G8/9zoeb/jqnT/46p0/+OqdP/jqnT/46p0/+OqdP/jqnT/46p0/9zoeb/Pobz/z6G8/8+hvP/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//AAD//////////w==',
			read:	'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0Wsv8NFrL/gYGu/4GBrv+Bga7/gYGu/4GBrv+Bga7/gYGu/4GBrv+Bga7/gYGu/4GBrv+Bga7/DRay/w0Wsv8QGbX/EBm1/8HB0//g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/4ODg/+Dg4P/g4OD/wcHT/xAZtf8QGbX/FBy5/xQcuf+Jibn/x8fZ/+fn5//n5+f/5+fn/+fn5//n5+f/5+fn/+fn5//n5+f/x8fZ/4mJuf8UHLn/FBy5/xogvv8aIL7/zc3g/42Nvv/NzeD/7u7u/+7u7v9qat3/amrd/+7u7v/u7u7/zc3g/42Nvv/NzeD/GiC+/xogvv8gJcP/ICXD//X19f/T0+f/kZHE/6Sk0v9SUtv/PT3U/z091P9SUtv/pKTS/5GRxP/T0+f/9fX1/yAlw/8gJcP/Ki7K/youyv/7+/v/+/v7/6qq2f9YWOH/Q0Pb/zw82P88PNj/Q0Pb/1hY4f+qqtn/+/v7//v7+/8qLsr/Ki7K/zc60f83OtH///////////9fX+b/R0fd/0RE3P+6uv//urr//0RE3P9KSt//X1/m////////////NzrR/zc60f9GR9f/RkfX//////9mZuf/U1Pg/0xM3v+9vf////////////+9vf//TEze/1NT4P9mZuf//////0ZH1/9GR9f/UlLd/1JS3f9tbej/V1fg/1RU3//AwP///////////////////////8DA//9UVN//YGDk/21t6P9SUt3/UlLd/1tb4f9bW+H/W1vh/1tb4f/Dw///////////////////////////////////w8P//1tb4f9bW+H/W1vh/1tb4f9gYOH/YGDh/2Bg4f+Kitz/np7P/56ez/+ens//np7P/56ez/+ens//np7P/56ez/+Kitz/YGDh/2Bg4f9gYOH/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//////////8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//////////////////w==',
			unread:	[
				'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALopAP+6KQD/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/uikA/7opAP+9LAD/vSwA/9LDvf/e3t7/3t7e/97e3v/e3t7/3t7e/97e3v/e3t7/3t7e/97e3v/e3t7/0sO9/70sAP+9LAD/wTEA/8ExAP+5koD/2MnD/+bm5v/m5ub/5ubm/+bm5v/m5ub/5ubm/+bm5v/m5ub/2MnD/7mSgP/BMQD/wTEA/8Y6A//GOgP/4NDI/76Wg//g0Mj/7e3t/+3t7f/jhVr/44Va/+3t7f/t7e3/4NDI/76Wg//g0Mj/xjoD/8Y6A//MQQn/zEEJ//X19f/n1s//xJqH/9OtnP/jc0D/3GIp/9xiKf/jc0D/062c/8Sah//n1s//9fX1/8xBCf/MQQn/0kwU/9JMFP/7+/v/+/v7/9q0o//pekb/5Ggv/+FiJ//hYif/5Ggv/+l6Rv/atKP/+/v7//v7+//STBT/0kwU/9lZI//ZWSP////////////ugE7/5mwz/+VpMP//zrf//863/+VpMP/objf/7oBO////////////2Vkj/9lZI//eaDL/3mgy///////uhVX/6HZA/+ZvOf//0Lr/////////////0Lr/5m85/+h2QP/uhVX//////95oMv/eaDL/5XRA/+V0QP/vjF3/6HlF/+d3Qv//0r3////////////////////////Svf/nd0L/7IBP/++MXf/ldED/5XRA/+l8Sf/pfEn/6XxJ/+l8Sf//1MD//////////////////////////////////9TA/+l8Sf/pfEn/6XxJ/+l8Sf/of0//6H9P/+h/T//gnH7/0KiV/9Colf/QqJX/0KiV/9Colf/QqJX/0KiV/9Colf/gnH7/6H9P/+h/T//of0//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//AAD//////////w==',
				'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALopAP+6KQD/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/uikA/7opAP+9LAD/vSwA/9LDvf/e3t7/3t7e/97e3v/Z2dn/zc3N/8fHx//Hx8f/x8fH/8fHx//Hx8f/va+q/68pAP+5KwD/wTEA/8ExAP+5koD/2MnD/+bm5v/m5ub/1dXV/7Ozs/+hoaH/oaGh/6Ghof+hoaH/mI2J/4JmWv+WJgD/sy0A/8Y6A//GOgP/4NDI/76Wg//g0Mj/7e3t/9XV1f+fXT//WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/1i82//MQQn/zEEJ//X19f/n1s//xJqH/9OtnP/MZzn/mkUd/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/0kwU/9JMFP/7+/v/+/v7/9q0o//pekb/zV0q/55FG/9YvNv/rfX9/631/f8jMTP/IzEz/yMxM/+t9f3/WLzb/9lZI//ZWSP////////////ugE7/5mwz/85eK/+zkYD/WLzb/631/f+t9f3/rfX9/yMxM/+t9f3/rfX9/1i82//eaDL/3mgy///////uhVX/6HZA/+ZvOf/lu6f/s7Oz/1i82/+t9f3/rfX9/631/f8jMTP/rfX9/631/f9YvNv/5XRA/+V0QP/vjF3/6HlF/+d3Qv//0r3/5eXl/7Ozs/9YvNv/rfX9/631/f8jMTP/IzEz/631/f+t9f3/WLzb/+l8Sf/pfEn/6XxJ/+l8Sf//1MD//////+Xl5f+zs7P/WLzb/631/f+t9f3/rfX9/yMxM/+t9f3/rfX9/1i82//of0//6H9P/+h/T//gnH7/0KiV/9Colf/Bm4r/ooJ0/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAABNYvNv/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPwAAAD//////////w==',
				'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALopAP+6KQD/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/uikA/7opAP+9LAD/vSwA/9LDvf/e3t7/3t7e/97e3v/Z2dn/zc3N/8fHx//Hx8f/x8fH/8fHx//Hx8f/va+q/68pAP+5KwD/wTEA/8ExAP+5koD/2MnD/+bm5v/m5ub/1dXV/7Ozs/+hoaH/oaGh/6Ghof+hoaH/mI2J/4JmWv+WJgD/sy0A/8Y6A//GOgP/4NDI/76Wg//g0Mj/7e3t/9XV1f+fXT//WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/1i82//MQQn/zEEJ//X19f/n1s//xJqH/9OtnP/MZzn/mkUd/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/0kwU/9JMFP/7+/v/+/v7/9q0o//pekb/zV0q/55FG/9YvNv/rfX9/yMxM/8jMTP/IzEz/yMxM/+t9f3/WLzb/9lZI//ZWSP////////////ugE7/5mwz/85eK/+zkYD/WLzb/631/f8jMTP/rfX9/631/f+t9f3/rfX9/1i82//eaDL/3mgy///////uhVX/6HZA/+ZvOf/lu6f/s7Oz/1i82/+t9f3/rfX9/yMxM/8jMTP/rfX9/631/f9YvNv/5XRA/+V0QP/vjF3/6HlF/+d3Qv//0r3/5eXl/7Ozs/9YvNv/rfX9/631/f+t9f3/rfX9/yMxM/+t9f3/WLzb/+l8Sf/pfEn/6XxJ/+l8Sf//1MD//////+Xl5f+zs7P/WLzb/631/f8jMTP/IzEz/yMxM/+t9f3/rfX9/1i82//of0//6H9P/+h/T//gnH7/0KiV/9Colf/Bm4r/ooJ0/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAABNYvNv/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPwAAAD//////////w==',		
				'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALopAP+6KQD/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/uikA/7opAP+9LAD/vSwA/9LDvf/e3t7/3t7e/97e3v/Z2dn/zc3N/8fHx//Hx8f/x8fH/8fHx//Hx8f/va+q/68pAP+5KwD/wTEA/8ExAP+5koD/2MnD/+bm5v/m5ub/1dXV/7Ozs/+hoaH/oaGh/6Ghof+hoaH/mI2J/4JmWv+WJgD/sy0A/8Y6A//GOgP/4NDI/76Wg//g0Mj/7e3t/9XV1f+fXT//WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/1i82//MQQn/zEEJ//X19f/n1s//xJqH/9OtnP/MZzn/mkUd/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/0kwU/9JMFP/7+/v/+/v7/9q0o//pekb/zV0q/55FG/9YvNv/rfX9/yMxM/8jMTP/IzEz/631/f+t9f3/WLzb/9lZI//ZWSP////////////ugE7/5mwz/85eK/+zkYD/WLzb/631/f+t9f3/rfX9/631/f8jMTP/rfX9/1i82//eaDL/3mgy///////uhVX/6HZA/+ZvOf/lu6f/s7Oz/1i82/+t9f3/rfX9/yMxM/8jMTP/rfX9/631/f9YvNv/5XRA/+V0QP/vjF3/6HlF/+d3Qv//0r3/5eXl/7Ozs/9YvNv/rfX9/631/f+t9f3/rfX9/yMxM/+t9f3/WLzb/+l8Sf/pfEn/6XxJ/+l8Sf//1MD//////+Xl5f+zs7P/WLzb/631/f8jMTP/IzEz/yMxM/+t9f3/rfX9/1i82//of0//6H9P/+h/T//gnH7/0KiV/9Colf/Bm4r/ooJ0/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAABNYvNv/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPwAAAD//////////w==',
				'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALopAP+6KQD/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/uikA/7opAP+9LAD/vSwA/9LDvf/e3t7/3t7e/97e3v/Z2dn/zc3N/8fHx//Hx8f/x8fH/8fHx//Hx8f/va+q/68pAP+5KwD/wTEA/8ExAP+5koD/2MnD/+bm5v/m5ub/1dXV/7Ozs/+hoaH/oaGh/6Ghof+hoaH/mI2J/4JmWv+WJgD/sy0A/8Y6A//GOgP/4NDI/76Wg//g0Mj/7e3t/9XV1f+fXT//WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/1i82//MQQn/zEEJ//X19f/n1s//xJqH/9OtnP/MZzn/mkUd/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/0kwU/9JMFP/7+/v/+/v7/9q0o//pekb/zV0q/55FG/9YvNv/rfX9/631/f+t9f3/IzEz/631/f+t9f3/WLzb/9lZI//ZWSP////////////ugE7/5mwz/85eK/+zkYD/WLzb/631/f8jMTP/IzEz/yMxM/8jMTP/rfX9/1i82//eaDL/3mgy///////uhVX/6HZA/+ZvOf/lu6f/s7Oz/1i82/+t9f3/IzEz/631/f8jMTP/rfX9/631/f9YvNv/5XRA/+V0QP/vjF3/6HlF/+d3Qv//0r3/5eXl/7Ozs/9YvNv/rfX9/631/f8jMTP/IzEz/631/f+t9f3/WLzb/+l8Sf/pfEn/6XxJ/+l8Sf//1MD//////+Xl5f+zs7P/WLzb/631/f+t9f3/rfX9/yMxM/+t9f3/rfX9/1i82//of0//6H9P/+h/T//gnH7/0KiV/9Colf/Bm4r/ooJ0/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAABNYvNv/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPwAAAD//////////w==',
				'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALopAP+6KQD/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/uikA/7opAP+9LAD/vSwA/9LDvf/e3t7/3t7e/97e3v/Z2dn/zc3N/8fHx//Hx8f/x8fH/8fHx//Hx8f/va+q/68pAP+5KwD/wTEA/8ExAP+5koD/2MnD/+bm5v/m5ub/1dXV/7Ozs/+hoaH/oaGh/6Ghof+hoaH/mI2J/4JmWv+WJgD/sy0A/8Y6A//GOgP/4NDI/76Wg//g0Mj/7e3t/9XV1f+fXT//WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/1i82//MQQn/zEEJ//X19f/n1s//xJqH/9OtnP/MZzn/mkUd/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/0kwU/9JMFP/7+/v/+/v7/9q0o//pekb/zV0q/55FG/9YvNv/rfX9/yMxM/8jMTP/IzEz/631/f+t9f3/WLzb/9lZI//ZWSP////////////ugE7/5mwz/85eK/+zkYD/WLzb/631/f+t9f3/rfX9/631/f8jMTP/rfX9/1i82//eaDL/3mgy///////uhVX/6HZA/+ZvOf/lu6f/s7Oz/1i82/+t9f3/IzEz/yMxM/8jMTP/rfX9/631/f9YvNv/5XRA/+V0QP/vjF3/6HlF/+d3Qv//0r3/5eXl/7Ozs/9YvNv/rfX9/yMxM/+t9f3/rfX9/631/f+t9f3/WLzb/+l8Sf/pfEn/6XxJ/+l8Sf//1MD//////+Xl5f+zs7P/WLzb/631/f8jMTP/IzEz/yMxM/8jMTP/rfX9/1i82//of0//6H9P/+h/T//gnH7/0KiV/9Colf/Bm4r/ooJ0/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAABNYvNv/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPwAAAD//////////w==',
				'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALopAP+6KQD/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/uikA/7opAP+9LAD/vSwA/9LDvf/e3t7/3t7e/97e3v/Z2dn/zc3N/8fHx//Hx8f/x8fH/8fHx//Hx8f/va+q/68pAP+5KwD/wTEA/8ExAP+5koD/2MnD/+bm5v/m5ub/1dXV/7Ozs/+hoaH/oaGh/6Ghof+hoaH/mI2J/4JmWv+WJgD/sy0A/8Y6A//GOgP/4NDI/76Wg//g0Mj/7e3t/9XV1f+fXT//WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/1i82//MQQn/zEEJ//X19f/n1s//xJqH/9OtnP/MZzn/mkUd/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/0kwU/9JMFP/7+/v/+/v7/9q0o//pekb/zV0q/55FG/9YvNv/rfX9/631/f8jMTP/IzEz/631/f+t9f3/WLzb/9lZI//ZWSP////////////ugE7/5mwz/85eK/+zkYD/WLzb/631/f8jMTP/rfX9/631/f8jMTP/rfX9/1i82//eaDL/3mgy///////uhVX/6HZA/+ZvOf/lu6f/s7Oz/1i82/+t9f3/IzEz/yMxM/8jMTP/rfX9/631/f9YvNv/5XRA/+V0QP/vjF3/6HlF/+d3Qv//0r3/5eXl/7Ozs/9YvNv/rfX9/yMxM/+t9f3/rfX9/631/f+t9f3/WLzb/+l8Sf/pfEn/6XxJ/+l8Sf//1MD//////+Xl5f+zs7P/WLzb/631/f+t9f3/IzEz/yMxM/+t9f3/rfX9/1i82//of0//6H9P/+h/T//gnH7/0KiV/9Colf/Bm4r/ooJ0/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAABNYvNv/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPwAAAD//////////w==',
				'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALopAP+6KQD/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/uikA/7opAP+9LAD/vSwA/9LDvf/e3t7/3t7e/97e3v/Z2dn/zc3N/8fHx//Hx8f/x8fH/8fHx//Hx8f/va+q/68pAP+5KwD/wTEA/8ExAP+5koD/2MnD/+bm5v/m5ub/1dXV/7Ozs/+hoaH/oaGh/6Ghof+hoaH/mI2J/4JmWv+WJgD/sy0A/8Y6A//GOgP/4NDI/76Wg//g0Mj/7e3t/9XV1f+fXT//WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/1i82//MQQn/zEEJ//X19f/n1s//xJqH/9OtnP/MZzn/mkUd/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/0kwU/9JMFP/7+/v/+/v7/9q0o//pekb/zV0q/55FG/9YvNv/rfX9/631/f8jMTP/rfX9/631/f+t9f3/WLzb/9lZI//ZWSP////////////ugE7/5mwz/85eK/+zkYD/WLzb/631/f+t9f3/IzEz/631/f+t9f3/rfX9/1i82//eaDL/3mgy///////uhVX/6HZA/+ZvOf/lu6f/s7Oz/1i82/+t9f3/rfX9/631/f8jMTP/rfX9/631/f9YvNv/5XRA/+V0QP/vjF3/6HlF/+d3Qv//0r3/5eXl/7Ozs/9YvNv/rfX9/631/f+t9f3/rfX9/yMxM/+t9f3/WLzb/+l8Sf/pfEn/6XxJ/+l8Sf//1MD//////+Xl5f+zs7P/WLzb/631/f8jMTP/IzEz/yMxM/8jMTP/rfX9/1i82//of0//6H9P/+h/T//gnH7/0KiV/9Colf/Bm4r/ooJ0/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAABNYvNv/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPwAAAD//////////w==',
				'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALopAP+6KQD/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/uikA/7opAP+9LAD/vSwA/9LDvf/e3t7/3t7e/97e3v/Z2dn/zc3N/8fHx//Hx8f/x8fH/8fHx//Hx8f/va+q/68pAP+5KwD/wTEA/8ExAP+5koD/2MnD/+bm5v/m5ub/1dXV/7Ozs/+hoaH/oaGh/6Ghof+hoaH/mI2J/4JmWv+WJgD/sy0A/8Y6A//GOgP/4NDI/76Wg//g0Mj/7e3t/9XV1f+fXT//WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/1i82//MQQn/zEEJ//X19f/n1s//xJqH/9OtnP/MZzn/mkUd/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/0kwU/9JMFP/7+/v/+/v7/9q0o//pekb/zV0q/55FG/9YvNv/rfX9/631/f8jMTP/IzEz/631/f+t9f3/WLzb/9lZI//ZWSP////////////ugE7/5mwz/85eK/+zkYD/WLzb/631/f8jMTP/rfX9/631/f8jMTP/rfX9/1i82//eaDL/3mgy///////uhVX/6HZA/+ZvOf/lu6f/s7Oz/1i82/+t9f3/rfX9/yMxM/8jMTP/rfX9/631/f9YvNv/5XRA/+V0QP/vjF3/6HlF/+d3Qv//0r3/5eXl/7Ozs/9YvNv/rfX9/yMxM/+t9f3/rfX9/yMxM/+t9f3/WLzb/+l8Sf/pfEn/6XxJ/+l8Sf//1MD//////+Xl5f+zs7P/WLzb/631/f+t9f3/IzEz/yMxM/+t9f3/rfX9/1i82//of0//6H9P/+h/T//gnH7/0KiV/9Colf/Bm4r/ooJ0/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAABNYvNv/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPwAAAD//////////w==',
				'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALopAP+6KQD/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/uikA/7opAP+9LAD/vSwA/9LDvf/e3t7/3t7e/97e3v/Z2dn/zc3N/8fHx//Hx8f/x8fH/8fHx//Hx8f/va+q/68pAP+5KwD/wTEA/8ExAP+5koD/2MnD/+bm5v/m5ub/1dXV/7Ozs/+hoaH/oaGh/6Ghof+hoaH/mI2J/4JmWv+WJgD/sy0A/8Y6A//GOgP/4NDI/76Wg//g0Mj/7e3t/9XV1f+fXT//WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/1i82//MQQn/zEEJ//X19f/n1s//xJqH/9OtnP/MZzn/mkUd/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/0kwU/9JMFP/7+/v/+/v7/9q0o//pekb/zV0q/55FG/9YvNv/rfX9/631/f8jMTP/IzEz/631/f+t9f3/WLzb/9lZI//ZWSP////////////ugE7/5mwz/85eK/+zkYD/WLzb/631/f+t9f3/rfX9/631/f8jMTP/rfX9/1i82//eaDL/3mgy///////uhVX/6HZA/+ZvOf/lu6f/s7Oz/1i82/+t9f3/rfX9/yMxM/8jMTP/IzEz/631/f9YvNv/5XRA/+V0QP/vjF3/6HlF/+d3Qv//0r3/5eXl/7Ozs/9YvNv/rfX9/yMxM/+t9f3/rfX9/yMxM/+t9f3/WLzb/+l8Sf/pfEn/6XxJ/+l8Sf//1MD//////+Xl5f+zs7P/WLzb/631/f+t9f3/IzEz/yMxM/+t9f3/rfX9/1i82//of0//6H9P/+h/T//gnH7/0KiV/9Colf/Bm4r/ooJ0/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAABNYvNv/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPwAAAD//////////w==',
				'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAACMuAAAjLgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALopAP+6KQD/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/rYh4/62IeP+tiHj/uikA/7opAP+9LAD/vSwA/9LDvf/Z2dn/zc3N/8fHx//Hx8f/x8fH/8fHx//Hx8f/x8fH/8fHx//Hx8f/va+q/68pAP+5KwD/wTEA/8ExAP+5koD/yLq0/7Ozs/+hoaH/oaGh/6Ghof+hoaH/oaGh/6Ghof+hoaH/mI2J/4JmWv+WJgD/sy0A/8Y6A//GOgP/4NDI/6uHdv+dkoz/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/1i82//MQQn/zEEJ//X19f/PwLr/imxf/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/0kwU/9JMFP/7+/v/4eHh/5l+cv9YvNv/rfX9/yMxM/8jMTP/IzEz/631/f8jMTP/IzEz/631/f+t9f3/WLzb/9lZI//ZWSP//////+Xl5f+nWjf/WLzb/631/f+t9f3/IzEz/631/f8jMTP/rfX9/631/f8jMTP/rfX9/1i82//eaDL/3mgy///////Wd0z/o1Mt/1i82/+t9f3/rfX9/yMxM/+t9f3/IzEz/631/f+t9f3/IzEz/631/f9YvNv/5XRA/+V0QP/vjF3/0G0+/6JULv9YvNv/rfX9/yMxM/8jMTP/rfX9/yMxM/+t9f3/rfX9/yMxM/+t9f3/WLzb/+l8Sf/pfEn/6XxJ/9FvQv+zlYf/WLzb/631/f+t9f3/IzEz/631/f+t9f3/IzEz/yMxM/+t9f3/rfX9/1i82//of0//6H9P/+h/T//PkHX/ooJ0/1i82/+t9f3/rfX9/631/f+t9f3/rfX9/631/f+t9f3/rfX9/631/f9YvNv/AAAAAAAAAAAAAAAAAAAABgAAABNYvNv/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/1i82/9YvNv/WLzb/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAD//////////w==',
			]
		};
		
		this.timer = setInterval(this.poll, 500);
		this.poll();
		
		return true;
	}
	
	this.getChat = function() { return false || GM_getValue('chatEnabled', false); }
	this.getDebugging = function() { return false || GM_getValue('debuggingEnabled', false); }
	this.getSearchElement = function() {
		var element = gmail.getNavPaneElement().getElementsByTagName('span')[1];		
		return self.isInboxNode(element) ? element: null;
	}
	this.isInboxNode = function(element) { return element.textContent.indexOf(self.inboxText) != -1; }
	this.newChat = function() { return top.document.title.indexOf(self.chatText) !== -1 ? true : false; }
	this.newMail = function() { return self.searchElement.textContent != self.inboxText; }
	this.getUnreadCountDisplay = function() { return GM_getValue('unreadCountDisplay', true); }
	this.getUnreadCount = function() {
		if(this.newMail()) {
			matches = self.searchElement.textContent.match(/\((\d*)\)/);
			return matches ? matches[1] : false;
		}
	}
	this.getUnreadCountIcon = function() {
		var unread = self.getUnreadCount();
		if(unread && unread < self.icons.unread.length && this.getUnreadCountDisplay()) {
			return self.icons.unread[unread];
		} else {
			return self.icons.unread[0];
		}
	}
	
	this.poll = function() {
			if(!self.searchElement)
				return self.searchElement = self.getSearchElement();
			
			if(self.getChat() && self.newChat()) {
				return self.setIcon(self.icons.chat);
			}
				
			if(self.newMail())
				self.setIcon(self.getUnreadCountIcon());
			else
				self.setIcon(self.icons.read);
	}
	
	this.setIcon = function(icon) {
		var links = self.head.getElementsByTagName("link");
		for (var i = 0; i < links.length; i++)
			if (links[i].type == "image/x-icon" && 
			   (links[i].rel == "shortcut icon" || links[i].rel=="icon") &&
			   links[i].href != icon)
				self.head.removeChild(links[i]);
			else if(links[i].href == icon)
				return;

		var newIcon = document.createElement("link");
		newIcon.type = "image/x-icon";
		newIcon.rel = "shortcut icon";
		newIcon.href = icon;
		return self.head.appendChild(newIcon);
	}
	
	this.toString = function() { return '[object GmailFavIconAlerts]'; }
	
	return this.construct();
}