// ==UserScript==
// @name      Google Play on Douban
// @version   1.0.1
// @namespace https://tonyseek.com/
// @match     http://www.douban.com/subject/*/
// @require   http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js
// @run-at	  document-start
// ==/UserScript==
// Generated by CoffeeScript 1.3.3
(function() {
  var ICON_URL, extract_play_url,
    _this = this;

  ICON_URL = "http://developer.android.com/images/brand/en_app_rgb_wo_60.png";

  extract_play_url = function(callback) {
    var edit_url;
    edit_url = $(".th-modify a").attr("href");
    return $.get(edit_url, {
      source: "userscript"
    }, function(response) {
      var parent, play_url;
      parent = $("<html>").html(response);
      play_url = parent.find(".desc-item-app_url .value").text().trim();
      if (play_url.indexOf("play.google.com") >= 0) {
        return typeof callback === "function" ? callback(play_url) : void 0;
      }
    });
  };

  $(function() {
    return extract_play_url(function(play_url) {
      var download_channel, play_icon;
      if (!play_url) {
        return;
      }
      play_icon = $("<i>").css({
        background: "url('" + ICON_URL + "') no-repeat 0 0",
        width: "172px",
        height: "60px",
        display: "block",
        margin: "0 0 20px 0"
      });
      download_channel = $("<a>").insertBefore($(".download-channel"));
      return download_channel.append(play_icon).attr({
        href: play_url,
        target: "_blank",
        rel: "nofollow"
      });
    });
  });

}).call(this);
