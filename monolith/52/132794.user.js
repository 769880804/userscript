// ==UserScript==
// @name           3gokushi-Beyond
// @namespace      3gokushi-hatt
// @description    ブラウザ三国志用便利機能色々ごった煮
// @include        http://*.3gokushi.jp/*
// @include        http://mixi.jp/run_appli.pl?id=6598
// @include        http://*.mixi-platform.com/*
// @author         原作者hatt,編集者romer,etc...
// @version        2.0.27
// ==/UserScript==
//
// FireFox / Google Chrome対応です。
// ver1.00 2010.03.19
// ver1.01 2010.03.20
// ver1.02 2010.03.20
// ver1.03 2010.03.21
// ver1.10 2010.03.22
// ver1.11 2010.03.23
// ver1.12 2010.03.25
// ver1.13 2010.03.26
// ver1.14 2010.03.27
// ver1.15 2010.03.28
// ver1.16 2010.03.29
// ver1.17 2010.03.31
// ver1.18 2010.04.02
// ver1.19 2010.04.05
// ver1.20 2010.04.08
// ver1.21 2010.04.09
// ver1.22 2010.04.13
// ver1.23 2010.04.19
// ver1.24 2010.04.28
// ver1.25 2010.05.02
// ver1.26 2010.05.10
// ver1.27 2010.05.29
// ver1.27.0.1 2010.08.19
// ver1.27.0.2 2010.09.21
// ver1.27.0.4 2010.09.22
// ver1.27.1.0 2010.09.23
// ver1.27.1.2 2010.09.24
// ver1.27.1.4 2010.09.25
// ver1.27.1.7 2010.09.26
// ver1.27.2.2 2010.09.29
// ver1.27.2.3 2010.10.01
// ver1.27.2.4 2010.10.02
// ver1.27.2.5 2010.10.07
// ver1.27.2.6 2010.10.12
// ver2.0 2011.01.01
// ver2.0.Griffith.0 2011.02.03 #social display:none;
// ver2.0.1 51x51エラー対応、初期値初期設定変更
// ver2.0.2 スタイル組込、ブラ三タイマーをごにょごにょ、同盟レベル表示改善組込、アホツール3種組込
// ver2.0.3 本人プロフィール画面の座標リンクが機能していなかったのを暫定修正
// ver2.0.4 トレード系組込
// ver2.0.5
// ver2.0.6
// ver2.0.7 スタイルやリンク修正
// ver2.0.7 武将カード分類ツール修正
// ver2.0.8 クエスト補助CSS修正
// ver2.0.9 クエスト追加対応
// ver2.0.10 プロフ対応・・・同盟員詳細情報csv関係
// ver2.0.11 プロフ対応・・・ビルダー等
// ver2.0.12 2012.04.25 ・・・2012.04.24のメンテに対応（主にビルダー）
// ver2.0.13 2012.04.26 ・・・2012.04.24のメンテに対応（カード出品）
// var2.0.14 2012.04.26 ・・・ブラ3ニュース移動、アクション画面移動、次拠点バグ修正(本当か？)by　akacapu
// var2.0.15 2012.04.29 ・・・右クリック建築修正 by　ひろひろひろ
// var2.0.16 2012.04.29 ・・・MAPTOOL新しいの入ったはず by　ひろひろひろ
// var2.0.17 2012.05.03 ・・・同盟リンクの異常修正、ビルダー修正
// var2.0.18 2012.05.03 ・・・MAPTOOLが正しく取り込めていなかったため修正
// var2.0.19 2012.05.08 ・・・2012.05.08のメンテ対応（まずはロールオーバー）
// var2.0.20 2012.05.09 ・・・2012.05.08のメンテ対応（ユニット作成完了時刻）
// var2.0.21 2012.05.09 ・・・2012.05.08のメンテ対応（ロールオーバーにアイテム追加。）
// var2.0.22 2012.05.13 ・・・クエスト補助修正、読み込めないリンク修正　変更点　ac22
// var2.0.23 2012.05.13 ・・・ブラ3ニュース空白廃止　変更点　ac23
// var2.0.24 2012.05.14 ・・・やぱり水鏡先生を組み込み　　ひろひろひろ
// var2.0.25 2012.05.14 ・・・中域MAPで距離が出ないなどの不具合修正　　ひろひろひろ
// var2.0.26 2012.05.16 ・・・カード分類ツールの不具合修正　　ひろひろひろ
// var2.0.27 2012.05.16 ・・・メンテ対応（同盟タブのリンク追加、MAPツール）　ひろひろひろ




/////////////////////////////////////////////////120125 faraway End
//var OPT_STYLE = 1;	//faraway 0320
//var OPT_TIMER = 0;	//faraway 0320
//faraway0320 beyond本体変数宣言　開始
var OPT_TRADESCORE = 0;		//27."トレードスコア単価計算"
var OPT_TRADECARDID = 0;	//28."トレードカードＩＤ表示"
var OPT_TRADESTATUS = 0;	//34."トレードステータス表示"
//faraway0320 beyond本体変数宣言　終了
//faraway 1.地図ツールのソース(bro3_map_tool.user.js) 変数部 開始
var VERSION_1 = "2.39.d4ex3";
var LOCAL_STORAGE_1 = "bro3_map_tool";

var RADIUS = 25; //半径（中域）
var RADIUS_L = 125; //半径（広域）
var CELL_SIZE_M = 14; //中域地図の1マスサイズ(px)
var CELL_SIZE_L = 3; //広域地図の1マスサイズ(px)
var FONT_SIZE = "10px"; //中域地図のマス内文字サイズ
var HI_POWER = 4; //高☆領地基準
var HI_POPUL = 600; //高人口拠点基準
var MAX_XY = 700; //座標絶対値最大
var DELIMIT_1 = "#$%";
var DELIMIT2_1 = "&?@";
var NPC_ALLY = "-";

//保存データインデックス（マス）
var IDX_VILLAGE_NAME = 0; //地名
var IDX_USER_NAME = 1; //君主名
var IDX_POPULATION = 2; //人口
var IDX_ALLIANCER = 3; //同盟名
var IDX_POWER = 4; //戦力
var IDX_WOOD = 5; //森
var IDX_STONE = 6; //岩
var IDX_IRON = 7; //鉄
var IDX_RICE = 8; //穀
var IDX_NPC_FLG = 9; //NPCフラグ
var IDX_TIME_BEFORE = 10;
var IDX_USER_BEFORE = 11;
var IDX_ALLY_BEFORE = 12;
var IDX_LAST_UPDATE = 13;
var IDX_CAPITAL_FLG = 14; //本拠地フラグ

//保存データインデックス（同盟）
var IDX_ALLY_PARENT = 0; //親同盟
var IDX_ALLY_CHILDREN = 1; //子同盟リスト
var IDX_ALLY_MEMBERS = 2; //同盟員リスト

//保存データインデックス（君主）
var IDX_USER_VILLAGES = 0; //拠点リスト
var IDX_USER_ALLY = 1; //所属同盟

//地図モード
var MAP_MODE_S = ""; //狭域地図
var MAP_MODE_M = "1"; //中域地図
var MAP_MODE_L = "2"; //広域地図

//入力モード
var INPUT_MODE_NAME = "1"; //名称
var INPUT_MODE_COLOR = "2"; //色

//デフォルト色定義
var USER_COLORS_DEF = new Array(
	"#0000a0", "#a00000", "#00a000", "#808000", "#008080",
	"#505050", "#505050", "#505050", "#505050", "#505050",
	"#0000a0", "#a00000", "#00a000", "#808000", "#008080",
	"#505050", "#505050", "#505050", "#505050", "#505050",
	"#0000a0", "#a00000", "#00a000", "#808000", "#008080",
	"#505050", "#505050", "#505050", "#505050", "#505050"
	);
var ALLY_COLORS_DEF = new Array(
	"#a0a0ff", "#ffa0a0", "#a0ffa0", "#ffff80", "#80ffff", 
	"#ff80ff", "#40c0ff", "#ffc040", "#c0ff40", "#b0b0b0",
	"#a0a0ff", "#ffa0a0", "#a0ffa0", "#ffff80", "#80ffff", 
	"#ff80ff", "#40c0ff", "#ffc040", "#c0ff40", "#b0b0b0",
	"#a0a0ff", "#ffa0a0", "#a0ffa0", "#ffff80", "#80ffff", 
	"#ff80ff", "#40c0ff", "#ffc040", "#c0ff40", "#b0b0b0"
	);
var NPC_COLOR = "purple";
var ETC_COLOR = "lightgrey";

var MINPEI = [
	[1,"★"                ,"森1 岩0 鉄0 穀0" , 5 ,  0   ,  0   ,  0   ,   0 ,  0  ,   0 ],
	[1,"★"                ,"森0 岩1 鉄0 穀0" , 5 ,  0   ,  0   ,  0   ,   0 ,  0  ,   0 ],
	[1,"★"                ,"森0 岩0 鉄1 穀0" , 5 ,  0   ,  0   ,  0   ,   0 ,  0  ,   0 ],
	[1,"★"                ,"森0 岩0 鉄0 穀1" , 5 ,  0   ,  0   ,  0   ,   0 ,  0  ,   0 ],
	[1,"★★"              ,"森3 岩0 鉄0 穀0" , 0 ,  0.5 ,  4   ,  0.5 ,   0 ,  0  ,   0 ],
	[1,"★★"              ,"森0 岩3 鉄0 穀0" , 0 ,  4   ,  0.5 ,  0.5 ,   0 ,  0  ,   0 ],
	[1,"★★"              ,"森0 岩0 鉄3 穀0" , 0 ,  0.5 ,  0.5 ,  4   ,   0 ,  0  ,   0 ],
	[1,"★★★"            ,"森1 岩1 鉄1 穀0" , 0 ,  6   ,  6   ,  6   ,   0 ,  0  ,   0 ],
 	[1,"★★★"            ,"森0 岩0 鉄0 穀4" , 0 ,  7.5 ,  7.5 ,  7.5 ,   0 ,  0  ,   0 ],
 	[1,"★★★★"          ,"森2 岩2 鉄2 穀0" , 0 , 12.5 , 12.5 , 12.5 ,   0 ,  0  ,   0 ],
	[1,"★★★★"          ,"森0 岩0 鉄0 穀8" , 0 , 12.5 , 12.5 , 12.5 ,   0 ,  0  ,   0 ],
	[1,"★★★★"          ,"森2 岩2 鉄2 穀2" , 0 , 11   , 11   , 11   ,   0 ,  0  ,   0 ],
	[1,"★★★★★"        ,"森6 岩0 鉄0 穀0" , 0 , 10   , 40   , 10   ,   0 ,  0  ,   0 ],
	[1,"★★★★★"        ,"森0 岩6 鉄0 穀0" , 0 , 40   , 10   , 10   ,   0 ,  0  ,   0 ],
	[1,"★★★★★"        ,"森0 岩0 鉄6 穀0" , 0 , 10   , 10   , 40   ,   0 ,  0  ,   0 ],
	[1,"★★★★★★"      ,"森10 岩0 鉄0 穀0", 0 , 75   , 15   , 15   ,   0 ,  0  ,   0 ],
	[1,"★★★★★★"      ,"森0 岩10 鉄0 穀0", 0 , 15   , 75   , 15   ,   0 ,  0  ,   0 ],
	[1,"★★★★★★"      ,"森0 岩0 鉄10 穀0", 0 , 15   , 15   , 75   ,   0 ,  0  ,   0 ],
	[1,"★★★★★★★"    ,"森3 岩3 鉄3 穀0" , 0 ,  0   ,  0   ,  0   ,  50 ,  50 ,  50 ],
	[1,"★★★★★★★★"  ,"森4 岩4 鉄4 穀4" , 0 ,  0   ,  0   ,  0   , 100 , 100 , 100 ],
	[1,"★★★★★★★★★","森0 岩0 鉄0 穀18", 0 ,  0   ,  0   ,  0   , 150 , 150 , 150 ]
	,
	[2,"★"                ,"森1 岩0 鉄0 穀0",  5 ,  0   ,  0   , 0    ,  0    ,   0   ,   0   ],
	[2,"★"                ,"森0 岩1 鉄0 穀0",  5 ,  0   ,  0   , 0    ,  0    ,   0   ,   0   ],
	[2,"★"                ,"森0 岩0 鉄1 穀0",  5 ,  0   ,  0   , 0    ,  0    ,   0   ,   0   ],
	[2,"★"                ,"森0 岩0 鉄0 穀1",  5 ,  0   ,  0   , 0    ,  0    ,   0   ,   0   ],
	[2,"★★"              ,"森3 岩0 鉄0 穀0",  0 ,  0.5 ,  6   , 0.5  ,  0    ,   0   ,   0   ],
	[2,"★★"              ,"森0 岩3 鉄0 穀0",  0 ,  6   ,  0.5 , 0.5  ,  0    ,   0   ,   0   ],
	[2,"★★"              ,"森0 岩0 鉄3 穀0",  0 ,  0.5 ,  0.5 , 6    ,  0    ,   0   ,   0   ],
	[2,"★★★"            ,"森1 岩1 鉄1 穀0",  0 ,  7.5 ,  7.5 , 7.5  ,  0    ,   0   ,   0   ],
	[2,"★★★"            ,"森0 岩0 鉄0 穀4",  0 , 17   ,  3   , 3    ,  0    ,   0   ,   0   ],
	[2,"★★★"            ,"森0 岩0 鉄0 穀1",  0 ,  3   , 17   , 3    ,  0    ,   0   ,   0   ],
	[2,"★★★★"          ,"森2 岩2 鉄2 穀0",  0 , 14   , 14   , 14   ,  0    ,   0   ,   0   ],
	[2,"★★★★"          ,"森2 岩2 鉄2 穀0",  0 ,  5   ,  5   , 35   ,  0    ,   0   ,   0   ],
	[2,"★★★★"          ,"森0 岩0 鉄0 穀8",  0 , 15   , 15   , 15   ,  0    ,   0   ,   0   ],
	[2,"★★★★★"        ,"森6 岩0 鉄0 穀0",  0 , 12.5 , 65   , 12.5 ,  0    ,   0   ,   0   ],
	[2,"★★★★★"        ,"森0 岩6 鉄0 穀0",  0 , 65   , 12.5 , 12.5 ,  0    ,   0   ,   0   ],
	[2,"★★★★★"        ,"森0 岩0 鉄6 穀0",  0 , 12.5 , 12.5 , 65   ,  0    ,   0   ,   0   ],
	[2,"★★★★★"        ,"森0 岩0 鉄0 穀1",  0 , 30   , 30   , 30   ,  0    ,   0   ,   0   ],
	[2,"★★★★★★"      ,"森2 岩2 鉄2 穀0",  0 ,  0   ,  0   , 0    ,  27.5 ,  27.5 ,  27.5 ],
	[2,"★★★★★★"      ,"森10 岩0 鉄0 穀0", 0 ,  0   ,  0   , 0    ,  12.5 ,  60   ,  12.5 ],
	[2,"★★★★★★"      ,"森0 岩10 鉄0 穀0", 0 ,  0   ,  0   , 0    ,  60   ,  12.5 ,  12.5 ],
	[2,"★★★★★★"      ,"森0 岩0 鉄10 穀0", 0 ,  0   ,  0   , 0    ,  12.5 ,  12.5 ,  60   ],
	[2,"★★★★★★★"    ,"森2 岩4 鉄4 穀0",  0 ,  0   ,  0   , 0    ,  65   ,  22.5 ,  65   ],
	[2,"★★★★★★★"    ,"森0 岩0 鉄0 穀1",  0 ,  0   ,  0   , 0    ,  65   ,  65   ,  22.5 ],
	[2,"★★★★★★★"    ,"森0 岩0 鉄0 穀12", 0 ,  0   ,  0   , 0    ,  22.5 ,  65   ,  65   ],
	[2,"★★★★★★★★"  ,"森4 岩1 鉄2 穀0",  0 ,  0   ,  0   , 0    ,  50   , 250   ,  25   ],
	[2,"★★★★★★★★"  ,"森2 岩4 鉄1 穀0",  0 ,  0   ,  0   , 0    , 250   ,  50   ,  25   ],
	[2,"★★★★★★★★"  ,"森1 岩2 鉄4 穀0",  0 ,  0   ,  0   , 0    ,  25   ,  50   , 250   ],
	[2,"★★★★★★★★★","森4 岩4 鉄4 穀4",  0 ,  0   ,  0   , 0    , 200   , 200   , 200   ],
	[2,"★★★★★★★★★","森1 岩1 鉄1 穀2",  0 ,  0   ,  0   , 0    , 190   , 190   , 190   ],
	[2,"★★★★★★★★★","森0 岩0 鉄0 穀18", 0 ,  0   ,  0   , 0    , 175   , 175   , 175   ]
	,
	[3,"★",                "森1 岩0 鉄0 穀0",  5 ,  0   ,  0   , 0    ,   0 ,   0 ,   0 ],
	[3,"★",                "森0 岩1 鉄0 穀0",  5 ,  0   ,  0   , 0    ,   0 ,   0 ,   0 ],
	[3,"★",                "森0 岩0 鉄1 穀0",  5 ,  0   ,  0   , 0    ,   0 ,   0 ,   0 ],
	[3,"★",                "森0 岩0 鉄0 穀1",  5 ,  0   ,  0   , 0    ,   0 ,   0 ,   0 ],
	[3,"★★",              "森3 岩0 鉄0 穀0",  0 ,  0.5 , 10   , 0.5  ,   0 ,   0 ,   0 ],
	[3,"★★",              "森0 岩3 鉄0 穀0",  0 ,  10  ,  0.5 , 0.5  ,   0 ,   0 ,   0 ],
	[3,"★★",              "森0 岩0 鉄3 穀0",  0 ,  0.5 ,  0.5 , 10   ,   0 ,   0 ,   0 ],
	[3,"★★★",            "森1 岩1 鉄1 穀0",  0 ,  9   ,  9   , 9    ,   0 ,   0 ,   0 ],
	[3,"★★★",            "森0 岩0 鉄0 穀4",  0 , 20   ,  6   , 6    ,   0 ,   0 ,   0 ],
	[3,"★★★",            "森0 岩0 鉄0 穀1",  0 ,  7   , 22   , 7    ,   0 ,   0 ,   0 ],
	[3,"★★★★",          "森2 岩2 鉄2 穀0",  0 , 16   , 16   , 16   ,   0 ,   0 ,   0 ],
	[3,"★★★★",          "森2 岩2 鉄2 穀0",  0 ,  7.5 ,  7.5 , 35   ,   0 ,   0 ,   0 ],
	[3,"★★★★",          "森0 岩0 鉄0 穀8",  0 , 19   , 19   , 19   ,   0 ,   0 ,   0 ],
	[3,"★★★★★",        "森6 岩0 鉄0 穀0",  0 , 12.5 , 75   , 12.5 ,   0 ,   0 ,   0 ],
	[3,"★★★★★",        "森0 岩6 鉄0 穀0",  0 , 75   , 12.5 , 12.5 ,   0 ,   0 ,   0 ],
	[3,"★★★★★",        "森0 岩0 鉄6 穀0",  0 , 12.5 , 12.5 , 75   ,   0 ,   0 ,   0 ],
	[3,"★★★★★",        "森0 岩0 鉄0 穀1",  0 , 32.5 , 32.5 , 32.5 ,   0 ,   0 ,   0 ],
	[3,"★★★★★",        "森2 岩2 鉄1 穀0",  0 , 35   , 35   , 35   ,   0 ,   0 ,   0 ],
	[3,"★★★★★",        "森1 岩1 鉄2 穀0",  0 , 37.5 , 37.5 , 37.5 ,   0 ,   0 ,   0 ],
	[3,"★★★★★★",      "森10 岩0 鉄0 穀0", 0 ,  0   ,  0   , 0    ,  20 ,  90 ,  20 ],
	[3,"★★★★★★",      "森0 岩10 鉄0 穀0", 0 ,  0   ,  0   , 0    ,  90 ,  20 ,  20 ],
	[3,"★★★★★★",      "森0 岩0 鉄10 穀0", 0 ,  0   ,  0   , 0    ,  20 ,  20 ,  90 ],
	[3,"★★★★★★",      "森2 岩2 鉄2 穀0",  0 ,  0   ,  0   , 0    ,  40 ,  40 ,  40 ],
	[3,"★★★★★★★",    "森2 岩4 鉄4 穀0",  0 ,  0   ,  0   , 0    , 110 ,  30 ,  30 ],
	[3,"★★★★★★★",    "森0 岩0 鉄0 穀1",  0 ,  0   ,  0   , 0    , 110 , 110 ,  30 ],
	[3,"★★★★★★★",    "森0 岩0 鉄0 穀12", 0 ,  0   ,  0   , 0    ,  30 , 110 ,  30 ],
	[3,"★★★★★★★★",  "森14 岩0 鉄0 穀0", 0 ,  0   ,  0   , 0    , 250 ,  75 ,  75 ],
	[3,"★★★★★★★★",  "森0 岩14 鉄0 穀0", 0 ,  0   ,  0   , 0    ,  75 , 250 ,  75 ], 
	[3,"★★★★★★★★",  "森0 岩0 鉄14 穀0", 0 ,  0   ,  0   , 0    ,  75 ,  75 , 250 ],
	[3,"★★★★★★★★",  "森4 岩1 鉄2 穀0",  0 ,  0   ,  0   , 0    ,  50 , 250 ,  25 ],
	[3,"★★★★★★★★",  "森2 岩4 鉄1 穀0",  0 ,  0   ,  0   , 0    , 250 ,  50 ,  25 ],
	[3,"★★★★★★★★",  "森1 岩2 鉄4 穀0",  0 ,  0   ,  0   , 0    ,  25 ,  50 , 250 ],
	[3,"★★★★★★★★★","森1 岩0 鉄0 穀0",  0 ,  0   ,  0   , 0    , 150 , 300 , 150 ],
	[3,"★★★★★★★★★","森0 岩1 鉄0 穀0",  0 ,  0   ,  0   , 0    , 300 , 150 , 150 ],
	[3,"★★★★★★★★★","森0 岩0 鉄1 穀0",  0 ,  0   ,  0   , 0    , 150 , 150 , 300 ],
	[3,"★★★★★★★★★","森4 岩4 鉄4 穀4",  0 ,  0   ,  0   , 0    , 300 , 300 , 300 ], 
	[3,"★★★★★★★★★","森1 岩1 鉄1 穀2",  0 ,  0   ,  0   , 0    , 250 , 250 , 250 ],
	[3,"★★★★★★★★★","森0 岩0 鉄0 穀18", 0 ,  0   ,  0   , 0    , 200 , 200 , 200 ]
	,
	[4,"★"                ,"森1 岩0 鉄0 穀0" , 5 ,  0  ,   0  ,  0  ,  0,   0 ,  0],
	[4,"★"                ,"森0 岩1 鉄0 穀0" , 5 ,  0  ,   0  ,  0  ,  0,   0 ,  0],
	[4,"★"                ,"森0 岩0 鉄1 穀0" , 5 ,  0  ,   0  ,  0  ,  0,   0 ,  0],
	[4,"★"                ,"森0 岩0 鉄0 穀1" , 5 ,  0  ,   0  ,  0  ,  0,   0 ,  0],
	[4,"★★"              ,"森3 岩0 鉄0 穀0" , 0 ,  1  ,  12.5,  1  ,  0,   0 ,  0],
	[4,"★★"              ,"森0 岩3 鉄0 穀0" , 0 , 12.5,   1  ,  1  ,  0,   0 ,  0],
	[4,"★★"              ,"森0 岩0 鉄3 穀0" , 0 ,  1  ,   1  , 12.5,  0,   0 ,  0],
	[4,"★★★"            ,"森1 岩1 鉄1 穀0" , 0 , 15  ,  15  , 15  ,  0,   0 ,  0],
	[4,"★★★"            ,"森0 岩0 鉄0 穀4" , 0 , 25  ,  12  , 12  ,  0,   0 ,  0],
	[4,"★★★"            ,"森0 岩0 鉄0 穀1" , 0 , 13  ,  25  , 13  ,  0,   0 ,  0],
	[4,"★★★★"          ,"森2 岩2 鉄2 穀0" , 0 , 33  ,  33  , 33  ,  0,   0 ,  0],
	[4,"★★★★"          ,"森2 岩2 鉄2 穀0" , 0 , 30  ,  30  , 45  ,  0,   0 ,  0],
	[4,"★★★★"          ,"森0 岩0 鉄0 穀8" , 0 , 36  ,  36  , 36  ,  0,   0 ,  0],
	[4,"★★★★★"        ,"森6 岩0 鉄0 穀0" , 0 , 33  , 111  , 33  ,  0,   0 ,  0],
	[4,"★★★★★"        ,"森0 岩6 鉄0 穀0" , 0 ,111  ,  33  , 33  ,  0,   0 ,  0],
	[4,"★★★★★"        ,"森0 岩0 鉄6 穀0" , 0 , 33  ,  33  ,111  ,  0,   0 ,  0],
	[4,"★★★★★"        ,"森0 岩0 鉄0 穀1" , 0 , 55  ,  55  , 55  ,  0,   0 ,  0],
	[4,"★★★★★"        ,"森2 岩2 鉄1 穀0" , 0 , 60  ,  60  , 60  ,  0,   0 ,  0],
	[4,"★★★★★"        ,"森1 岩1 鉄2 穀0" , 0 , 70  ,  70  , 70  ,  0,   0 ,  0],
	[4,"★★★★★★"      ,"森10 岩0 鉄0 穀0", 0 ,  0  ,   0  ,  0  , 50, 180 , 50],
	[4,"★★★★★★"      ,"森0 岩10 鉄0 穀0", 0 ,  0  ,   0  ,  0  ,180,  50 , 50],
	[4,"★★★★★★"      ,"森0 岩0 鉄10 穀0", 0 ,  0  ,   0  ,  0  , 50,  50 ,180],
	[4,"★★★★★★"      ,"森2 岩2 鉄2 穀0" , 0 ,  0  ,   0  ,  0  , 85,  85 , 85],
	[4,"★★★★★★★"    ,"森2 岩4 鉄4 穀0" , 0 ,  0  ,   0  ,  0  ,220, 110 ,110],
	[4,"★★★★★★★"    ,"森0 岩0 鉄0 穀1" , 0 ,  0  ,   0  ,  0  ,110, 110 ,220],
	[4,"★★★★★★★"    ,"森0 岩0 鉄0 穀12", 0 ,  0  ,   0  ,  0  ,110, 220 ,110],
	[4,"★★★★★★★★"  ,"森14 岩0 鉄0 穀0", 0 ,  0  ,   0  ,  0  ,400, 175 ,175],
	[4,"★★★★★★★★"  ,"森0 岩14 鉄0 穀0", 0 ,  0  ,   0  ,  0  ,175, 400 ,175],
	[4,"★★★★★★★★"  ,"森0 岩0 鉄14 穀0", 0 ,  0  ,   0  ,  0  ,175, 175 ,400],
	[4,"★★★★★★★★"  ,"森4 岩1 鉄2 穀0" , 0 ,  0  ,   0  ,  0  ,200, 350 ,100],
	[4,"★★★★★★★★"  ,"森2 岩4 鉄1 穀0" , 0 ,  0  ,   0  ,  0  ,350, 200 ,100],
	[4,"★★★★★★★★"  ,"森1 岩2 鉄4 穀0" , 0 ,  0  ,   0  ,  0  ,100, 200 ,350],
	[4,"★★★★★★★★★","森1 岩0 鉄0 穀0" , 0 ,  0  ,   0  ,  0  ,400, 600 ,400],
	[4,"★★★★★★★★★","森0 岩1 鉄0 穀0" , 0 ,  0  ,   0  ,  0  ,600, 400 ,400],
	[4,"★★★★★★★★★","森0 岩0 鉄1 穀0" , 0 ,  0  ,   0  ,  0  ,400, 400 ,600],
	[4,"★★★★★★★★★","森4 岩4 鉄4 穀4" , 0 ,  0  ,   0  ,  0  ,450, 450 ,450],
	[4,"★★★★★★★★★","森1 岩1 鉄1 穀2" , 0 ,  0  ,   0  ,  0  ,400, 400 ,400],
	[4,"★★★★★★★★★","森0 岩0 鉄0 穀18", 0 ,  0  ,   0  ,  0  ,350, 350 ,350]
];
var SPEC = [
	[ 15, 10, 10, 10, 15],	//剣兵
	[ 50, 40, 25, 55, 40],	//槍兵
	[ 52, 58, 42, 26, 42],	//弓兵
	[ 54, 28, 60, 44, 44],	//騎兵
	[200,100, 63,137,100],	//矛槍兵
	[208,145,105, 65,105],	//弩兵
	[216, 70,150,110,110]	//近衛騎兵
];


//CSV出力
var CSV_RADIUS_S = 25; //半径S
var CSV_RADIUS_L = 100; //半径L

//グローバル変数


var USERS; //君主名
var ALLYS; //同盟名
var USER_COLORS; //君主色
var ALLY_COLORS; //同盟色
var CENTER_X; //中心X座標
var CENTER_Y; //中心Y座標
var MY_X = 0; //自拠点X座標
var MY_Y = 0; //自拠点Y座標
var BASE_TIME = ""; //基準時刻
var MAP_MODE = MAP_MODE_S; //地図モード（狭域/中域/広域）
var INPUT_MODE = INPUT_MODE_NAME; //入力モード（名称/色）
var DISP_NPC_YET = false; //未攻略NPC表示フラグ
var DISP_NPC_FALLEN = false; //攻略済NPC表示フラグ
var DISP_PERIOD1 = true;  //期数
var DISP_PERIOD2 = false; //期数
var DISP_PERIOD3 = false; //期数
var DISP_PERIOD4 = false; //期数
var DISP_COMPROMISE = 70; //妥協点
var DISP_MATERIAL = false;	//資源表示

var MAP_WIDE = false; //プチワイド
var DISP_PICTURE = true; //マップアイコン表示

var MATCH_FULL = false; //完全一致フラグ
var MAP_SCALE; //地図幅
var LOADED_MAPS = new Array();
var CELLS_CACHE = new Array();
var ALLYS_CACHE = new Array();
var USERS_CACHE = new Array();
var ALLYS_INDEX = new Array();
var USERS_INDEX = new Array();
var GET_MAP_LIST = new Array();		// by どらごら
var GET_MAP_LIST_COUNTER;					// by どらごら
var MAX_MAP_LIST;									// by どらごら
var GET_MAP_SLEEP_TID;						// 条件監視sleep by どらごら
var j$;														// jQuery by どらごら
var ROUTE_ENABLE = false;					// 遠征支援を有効にする by どらごら
var CURSOR_ENABLE = false;				// カーソル位置 by どらごら

var MEMBER_ID_LIST = new Array();
var MEMBER_ID_LIST_COUNTER;
var MEMBER_ID_MAX_COUNTER;
var MEMBER_INFO_TEXT;
var MEMBER_SLEEP_TID;

//マウスドラッグ用
var MOUSE_DRAGGING_1 = false;
var MOUSE_DRAG_START_X;
var MOUSE_DRAG_START_Y;

var MAP_MATE_COLORS;
var MAP_MATE_COLORS_DEF = new Array(
	"#00a000",	//木のみ
	"#a0a0a0",	//石のみ
	"#a060a0",	//鉄のみ
	"#f0f080",	//糧のみ
	"#ffc040",	//複合
	"#404040"	//取得済
	);
var MAP_MATE_NAMES;
var MAP_MATE_NAMES_DEF = new Array(
	"木のみ",	//木のみ
	"石のみ",	//石のみ
	"鉄のみ",	//鉄のみ
	"糧のみ",	//糧のみ
	"複合",		//複合
	"取得済"	//取得済
	);
var MAP_COLOR_MODE;	//マップ色モード

var MAP_WOOD_COLOR	= 0; //木
var MAP_STONE_COLOR	= 1; //石
var MAP_IRON_COLOR	= 2; //鉄
var MAP_RICE_COLOR	= 3; //糧
var MAP_MIX_COLOR	= 4; //複合
var MAP_OTHER_COLOR	= 5; //他同盟

var map_hostname;	////location.hostnameが付いたﾃﾞｰﾀを削除する為、地図ﾂｰﾙのものは、"map_"+location.hostnameにして他に影響が出ないようにした。faraway111013

var mapAllId = 'mapAll';//mapツール四季対応？20120524
if(document.getElementById("mapboxInner")) mapAllId = document.getElementById("mapboxInner").firstElementChild.id;


//faraway 1.地図ツールのソース(bro3_map_tool.user.js) 変数部 終了

//faraway 2.タイマーのソース(bro3_timer.user.js) 変数部 開始
//faraway 2.タイマーのソース(bro3_timer.user.js) 変数部 終了
//faraway 3.同盟貢献チェッカーのソース(bro3_contrib_checker.user.js) 変数部 開始
var VERSION_3 = "1.04";
var LOCAL_STORAGE_3 = "bro3_contrib_checker";

var DELIMIT_3 = "#$%";

//インデックス
var IDX_RANK = 0; //ランク
var IDX_POINT = 1; //ポイント
var IDX_CONTRIB = 2; //寄付
var IDX_VILLAGE = 3; //拠点

//グローバル変数
var CURRENT_TIME = generateDateString_3(new Date());
var LAST_UPDATE = "";
var ALLY_NAME = "";
var SAVE_DATA = new Array();
var SAVE_USERS = new Array();
//faraway 3.同盟貢献チェッカーのソース(bro3_contrib_checker.user.js) 変数部 終了

//faraway 4.発展チェッカーのソース(bro3_growth_checker.user.js) 変数部 開始
var VERSION4 = "1.07";
var LOCAL_STORAGE4 = "bro3_growth_checker";

var DELIMIT_4 = "#$%";
//faraway 4.発展チェッカーのソース(bro3_growth_checker.user.js) 変数部 終了

//faraway 5.統計グラフ化ツールのソース(bro3_graph.user.js) 変数部 開始
var VERSION_5 = "1.06";
var LOCAL_STORAGE_5 = "bro3_graph";

var DELIMIT_5 = "#$%";
var DELIMIT2_5 = "&?@";
var GRAPH_WIDTH = 745;
var GRAPH_HEIGHT = 500;
var GRAPH_PADDING = 8;

//色定義
var ALLY_COLORS_5 = new Array("blue", "red", "green", "olive", "brown", 
	"purple", "black", "indigo", "deeppink", "darkcyan", 
	"dodgerblue", "lightcoral", "lawngreen", "yellow", "tomato", 
	"plum", "darkgray", "mediumpurple", "pink", "cyan");

//保存データインデックス
var IDX_DATETIME = 0; //日時
var IDX_POINT_5 = 1; //ポイント
var IDX_RANK_5 = 2; //ランク
var IDX_MEMBER = 3; //メンバー
//var IDX_LEADER = 4; //盟主

//グローバル変数
var TOOL_LOADED = false;
var ALLYS_5 = new Array(); //入力同盟名
var CURRENT_ALLYS_5 = new Array();
var ALLYS_INDEX_5 = new Array(); //同盟インデックス
//faraway 5.統計グラフ化ツールのソース(bro3_graph.user.js) 変数部 終了

//faraway 6.同盟ログツールのソース() 変数部 開始
var VERSION_6 = "1.07";
var LOCAL_STORAGE_6 = "bro3_log_tool";

var DELIMIT_6 = "#$%";
var DELIMIT2_6 = "&?@";
var DELIMIT3_6 = "{=]";

//データインデックス
var IDX_SUBJECT = 0; //件名
var IDX_DATE = 1; //ログ時刻
var IDX_ACTOR = 2; //攻撃者、防御者
var IDX_SOLDIER_COUNT = 3; //兵士数
//var IDX_INFORMATION = 4; //情報
var IDX2_ALLY_ID = 0; //同盟ID
var IDX2_ALLY_NAME = 1; //同盟名
var IDX2_USER_ID = 2; //ユーザID
var IDX2_USER_NAME = 3; //ユーザ名
var IDX2_VILLAGE_ID = 4; //拠点ID
var IDX2_VILLAGE_NAME = 5; //拠点名

//グローバル変数
var LOG_ID = getParameter_6("id");
var LOG_DATA = new Array();
//faraway 6.同盟ログツールのソース() 変数部 終了

//faraway 7.NPC砦、領土情報検索ツールのソース(bro3_npc_castle_info2.user.js) 変数部 開始
var DELIMIT1_7 = "#$%";
var DELIMIT2_7 = "&?@";
var OWNER_SPLITKEY = " ";
var VERSION_KEY = "vtX200";
var VERSION_7 = "2.49k2";

// データフラグ（初期値）
var FLAG1 = "1000000000";
var FLAG2 = "0000000  0  0  000000000000";
var FLAG3_1 = "010000情報を表示する１";
var FLAG3_2 = "010000情報を表示する２";
var FLAG3_3 = "010000情報を表示する３";
var FLAG4   = "";

// ブラウザ判別用
var browserType;

// 新鯖判定用
var add51_51mode = 0;

// スプレッドシート名
var spreadsheet = '';

// 共通関数
var d_7 = document;
var $d = function(id) { return d_7.getElementById(id); };
var $x_7 = function(xp,dc) { return d_7.evaluate(xp, dc||d_7, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $e_7 = function(key) { return d_7.evaluate(key, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };

// 検索オプション(種別)
var FLAG1_NPC = 0; // NPC砦
var FLAG1_LV1 = 1; // ☆1
var FLAG1_LV2 = 2; // ☆2
var FLAG1_LV3 = 3; // ☆3
var FLAG1_LV4 = 4; // ☆4
var FLAG1_LV5 = 5; // ☆5
var FLAG1_LV6 = 6; // ☆6
var FLAG1_LV7 = 7; // ☆7
var FLAG1_LV8 = 8; // ☆8
var FLAG1_LV9 = 9; // ☆9

// 検索オプション(特殊1)
var FLAG2_EMPTY = 0;            // 空き地検索
var FLAG2_LAND = 1;             // 領土検索
var FLAG2_ANALYZE = 2;          // 資源判別検索
var FLAG2_RADER = 3;            // レーダーの表示
var FLAG2_OWNER = 4;            // 本拠地一覧の表示
var FLAG2_EMPTY_DRAW = 5;       // 空き地を着色
var FLAG2_EMPTY_DRAW_COLOR = 6; // 空き地の枠色
var FLAG2_STRONG_AREANO = 7;    // 強調表示領地リスト番号(3桁)
var FLAG2_STRONG_AREANO2 = 10;  // 強調表示領地リスト番号(3桁)
var FLAG2_STRONG_AREANO3 = 13;  // 強調表示領地リスト番号(3桁)
var FLAG2_MENU2 = 16;           // メニュークローズドスイッチ2
var FLAG2_MENU4 = 17;           // メニュークローズドスイッチ4
var FLAG2_HFUNC = 18;           //
var FLAG2_SEARCH_LEVEL = 19;    // ルート探索：探索レベル
var FLAG2_SKIP_RES = 20;        // ルート探索：回避資源タイプ
var FLAG2_SKIP_USER = 21;       // 個人領地を通過
var FLAG2_SKIP_GROUP = 22;      // グループ領地を通過
var FLAG2_RANDOM_ROUTE = 23;    // 可変ルート
var FLAG2_DIRECTION = 24;       // 方位表示
var FLAG2_OLDDESIGN = 25;       // 旧式マップ
var FLAG2_NOEXEC51 = 26;        // 51x51モードでツールを動かさない

// 検索オプション(個人/同盟検索)
var FLAG3_ENABLE = 0;  // 有効/無効
var FLAG3_USER = 1;    // ユーザー検索
var FLAG3_GROUP = 2;   // 同盟検索
var FLAG3_MATCH = 3;   // 完全一致
var FLAG3_FILL = 4;    // 領土着色のみ
var FLAG3_COLOR = 5;   // カラー番号
var FLAG3_NAME = 6;    // 個人、同盟名称

// 検索オプション(個人/同盟検索)
//var FLAG5_ROUTE_MODE = 0;    // ルート構築モード
//var FLAG5_PUT_RESOURCE = 1;  // 資源情報出力
//var FLAG5_AUTO_MODE = 2;     // 自動ルート構築モード
//var FLAG5_ROUTE = 3;         // ルートデータ

// ルート自動構築用変数
var AUTO_ROUTE_NONE = 0;
var AUTO_ROUTE_EDIT_FIRST = 1;
var AUTO_ROUTE_EDIT_LAST = 2;
var AUTO_ROUTE_EDIT_END = 3;

var autoroute = AUTO_ROUTE_NONE;
var autoroute_f = [0,0,""];
var autoroute_l = [0,0,""];
var autoroute_f2 = [0,0];

var autoroute_path = new Array();
var autoroute_maxpaths = 0;

// 個人/同盟検索結果表示色
var cname = ["赤","紫","桃","橙","黄","緑","水","青","灰","白"];
var cname_en = ["red","purple","pink","orange","yellow","green","cyan","blue","gray","white"];

var season1 = [
		["なし",                   0, 0, 0, 0, 0, " "],		// 0
		["☆1( 1- 0- 0- 0) 1期～", 1, 0, 0, 0, 1, "A"],		// 1
		["☆1( 0- 1- 0- 0) 1期～", 0, 1, 0, 0, 1, "B"],		// 2
		["☆1( 0- 0- 1- 0) 1期～", 0, 0, 1, 0, 1, "C"],		// 3
		["☆1( 0- 0- 0- 1) 1期～", 0, 0, 0, 1, 1, "D"],		// 4
		["☆2( 3- 0- 0- 0) 1期～", 3, 0, 0, 0, 2, "E"],		// 5
		["☆2( 0- 3- 0- 0) 1期～", 0, 3, 0, 0, 2, "F"],		// 6
		["☆2( 0- 0- 3- 0) 1期～", 0, 0, 3, 0, 2, "G"],		// 7
		["☆3( 1- 1- 1- 0) 1期～", 1, 1, 1, 0, 3, "H"],		// 8
		["☆3( 0- 0- 0- 4) 1期～", 0, 0, 0, 4, 3, "I"],		// 9
		["☆3( 0- 0- 0- 1) 2期～", 0, 0, 0, 1, 3, "J"],		// 10
		["☆4( 2- 2- 2- 0) 1期～", 2, 2, 2, 0, 4, "K"],		// 11
		["☆4( 2- 2- 2- 2) 1期  ", 2, 2, 2, 2, 4, "L"],		// 12
		["☆4( 0- 0- 0- 8) 1期～", 0, 0, 0, 8, 4, "M"],		// 13
		["☆5( 6- 0- 0- 0) 1期～", 6, 0, 0, 0, 5, "N"],		// 14
		["☆5( 0- 6- 0- 0) 1期～", 0, 6, 0, 0, 5, "O"],		// 15
		["☆5( 0- 0- 6- 0) 1期～", 0, 0, 6, 0, 5, "P"],		// 16
		["☆5( 0- 0- 0- 1) 2期～", 0, 0, 0, 1, 5, "Q"],		// 17
		["☆5( 2- 2- 1- 0) 3期～", 2, 2, 1, 0, 5, "R"],		// 18
		["☆5( 1- 1- 2- 0) 3期～", 1, 1, 2, 0, 5, "S"],		// 19
		["☆6(10- 0- 0- 0) 1期～",10, 0, 0, 0, 6, "T"],		// 20
		["☆6( 0-10- 0- 0) 1期～", 0,10, 0, 0, 6, "U"],		// 21
		["☆6( 0- 0-10- 0) 1期～", 0, 0,10, 0, 6, "V"],		// 22
		["☆6( 2- 2- 2- 0) 2期～", 2, 2, 2, 0, 6, "W"],		// 23
		["☆7( 3- 3- 3- 0) 1期  ", 3, 3, 3, 0, 7, "X"],		// 24
		["☆7( 2- 4- 4- 0) 2期～", 2, 4, 4, 0, 7, "Y"],		// 25
		["☆7( 0- 0- 0- 1) 2期～", 0, 0, 0, 1, 7, "Z"],		// 26
		["☆7( 0- 0- 0-12) 2期～", 0, 0, 0,12, 7, "a"],		// 27
		["☆8( 4- 4- 4- 4) 1期  ", 4, 4, 4, 4, 8, "b"],		// 28
		["☆8( 4- 1- 2- 0) 2期～", 4, 1, 2, 0, 8, "c"],		// 29
		["☆8( 2- 4- 1- 0) 2期～", 2, 4, 1, 0, 8, "d"],		// 30
		["☆8( 1- 2- 4- 0) 2期～", 1, 2, 4, 0, 8, "e"],		// 31
		["☆8(14- 0- 0- 0) 3期～",14, 0, 0, 0, 8, "f"],		// 32
		["☆8( 0-14- 0- 0) 3期～", 0,14, 0, 0, 8, "g"],		// 33
		["☆8( 0- 0-14- 0) 3期～", 0, 0,14, 0, 8, "h"],		// 34
		["☆9( 0- 0- 0-18) 1期～", 0, 0, 0,18, 9, "i"],		// 35
		["☆9( 1- 1- 1- 2) 2期～", 1, 1, 1, 2, 9, "j"],		// 36
		["☆9( 4- 4- 4- 4) 2期～", 4, 4, 4, 4, 9, "k"],		// 37
		["☆9( 1- 0- 0- 0) 3期～", 1, 0, 0, 0, 9, "l"],		// 38
		["☆9( 0- 1- 0- 0) 3期～", 0, 1, 0, 0, 9, "m"],		// 39
		["☆9( 0- 0- 1- 0) 3期～", 0, 0, 1, 0, 9, "n"]		// 40
];

// ルート探索条件
var croutename = ["☆1のみ","☆2以下","☆3以下","☆4以下","☆5以下","☆6以下","☆7以下","☆8以下","☆回避なし"];
var croutelim = ["なし","★2森","★2岩","★2鉄"];
var groupname = ["指定なし","No.1","No.2","No.3"];

// 探索パターン（距離１）
var chkptn = [ [1,0], [0,1], [-1,0], [0,-1], [1,1], [1,-1], [-1,1], [-1,-1] ];
var chkptn_r  = [
		[ 1, 0], [ 0, 1], [-1, 0], [ 0,-1],	// 01
		[ 1, 0], [ 0, 1], [ 0,-1], [-1, 0],	// 02
		[ 1, 0], [-1, 0], [ 0, 1], [ 0,-1],	// 03
		[ 1, 0], [-1, 0], [ 0,-1], [ 0, 1],	// 04
		[ 1, 0], [ 0,-1], [-1, 0], [ 0, 1],	// 05
		[ 1, 0], [ 0,-1], [ 0, 1], [-1, 0],	// 06
		[ 0, 1], [ 1, 0], [-1, 0], [ 0,-1],	// 07
		[ 0, 1], [ 1, 0], [ 0,-1], [-1, 0],	// 08
		[ 0, 1], [-1, 0], [ 1, 0], [ 0,-1],	// 09
		[ 0, 1], [-1, 0], [ 0,-1], [ 1, 0],	// 10
		[ 0, 1], [ 0,-1], [-1, 0], [ 1, 0],	// 11
		[ 0, 1], [ 0,-1], [ 1, 0], [-1, 0],	// 12
		[-1, 0], [ 1, 0], [ 0, 1], [ 0,-1],	// 13
		[-1, 0], [ 1, 0], [ 0,-1], [ 0, 1],	// 14
		[-1, 0], [ 0, 1], [ 1, 0], [ 0,-1],	// 15
		[-1, 0], [ 0, 1], [ 0,-1], [ 1, 0],	// 16
		[-1, 0], [ 0,-1], [ 0, 1], [ 1, 0],	// 17
		[-1, 0], [ 0,-1], [ 1, 0], [ 0, 1],	// 18
		[ 0,-1], [ 1, 0], [ 0, 1], [-1, 0],	// 19
		[ 0,-1], [ 1, 0], [-1, 0], [ 0, 1],	// 20
		[ 0,-1], [ 0, 1], [ 1, 0], [-1, 0],	// 21
		[ 0,-1], [ 0, 1], [-1, 0], [ 1, 0],	// 22
		[ 0,-1], [-1, 0], [ 0, 1], [ 1, 0],	// 23
		[ 0,-1], [-1, 0], [ 1, 0], [ 0, 1],	// 24
		[ 1, 1], [ 1,-1], [-1, 1], [-1,-1],	// 25
		[ 1, 1], [ 1,-1], [-1,-1], [-1, 1],	// 26
		[ 1, 1], [-1, 1], [ 1,-1], [-1,-1],	// 27
		[ 1, 1], [-1, 1], [-1,-1], [ 1,-1],	// 28
		[ 1, 1], [-1,-1], [-1, 1], [ 1,-1],	// 29
		[ 1, 1], [-1,-1], [ 1,-1], [-1, 1],	// 30
		[ 1,-1], [ 1, 1], [-1, 1], [-1,-1],	// 31
		[ 1,-1], [ 1, 1], [-1,-1], [-1, 1],	// 32
		[ 1,-1], [-1, 1], [ 1, 1], [-1,-1],	// 33
		[ 1,-1], [-1, 1], [-1,-1], [ 1, 1],	// 34
		[ 1,-1], [-1,-1], [-1, 1], [ 1, 1],	// 35
		[ 1,-1], [-1,-1], [ 1, 1], [-1, 1],	// 36
		[-1, 1], [ 1, 1], [ 1,-1], [-1,-1],	// 37
		[-1, 1], [ 1, 1], [-1,-1], [ 1,-1],	// 38
		[-1, 1], [ 1,-1], [ 1, 1], [-1,-1],	// 39
		[-1, 1], [ 1,-1], [-1,-1], [ 1, 1],	// 40
		[-1, 1], [-1,-1], [ 1,-1], [ 1, 1],	// 41
		[-1, 1], [-1,-1], [ 1, 1], [ 1,-1],	// 42
		[-1,-1], [ 1, 1], [ 1,-1], [-1, 1],	// 43
		[-1,-1], [ 1, 1], [-1, 1], [ 1,-1],	// 44
		[-1,-1], [ 1,-1], [ 1, 1], [-1, 1],	// 45
		[-1,-1], [ 1,-1], [-1, 1], [ 1, 1],	// 46
		[-1,-1], [-1, 1], [ 1,-1], [ 1, 1],	// 47
		[-1,-1], [-1, 1], [ 1, 1], [ 1,-1]	// 48
];

// ルート探索条件（資源回避）
var cchkres = [ 0, 5, 6, 7 ];

// ルート指定文字列
// （案）
// 1. 起点にはマークSをつけ、XY座標を記録
// 2. 中間点にはPマークをつける
// 3. 起点、あるいは中間点からの方位
//    左上A、上B、右上C、右D、右下E、下F、左下G、左H
// 4. リピート数(a=1)
//    abcdefghijklmnopqrst 最大20
// 5. 資源情報(1-40)、zの場合、次のzまでが砦名。yは個人拠点
//    ABCDEFGHIJLKMNOPQRSTUVWZYZabcdefghijklmn
//
// 例.起点(100,-100)、右下☆1木1、右下☆2木3、右下☆1木1、右下☆1木1、右下☆1木1、右下☆1木1、右上NPC砦南東砦238
//    S 100-100EfAEAAAACz南東砦238z

//--------------------------------//
// アイコン定義（パステルカラー） //
//--------------------------------//
var icon_c_7 = new Array();

// 通常モード（１１ｘ１１用）
icon_c_7[0] = new Array();
icon_c_7[0][0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAk0lEQVR42u3VwQmAMAxA0WY'+
		'EwV0cwnkdwl0ER6heRKhnS/n5/5hLeIe0UWstmQrB8ATTE0xPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9LqCI+Kz7N4faPC2v/vWJXK'+
		'Aj7OUeRIsWLBgwYIFC+4AfkoBbmdo8AgJpucN/w1O90r7D9PB7QwNHiHB9ATTE0xPMD3B9NKBL9LFOZj2H7EeAAAAAElFTkSuQmCC';
icon_c_7[0][1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAtElEQVR42u3XOxKCMBgAYX6'+
		'OYMF4J8/AMb2UBUcwSkOR4CjMxOiyW+YB8yVVIqXUHakQDE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTK8qOCLefvz5/0CB0+3'+
		'6en64QMH3qZzsT2Bw3nwAVHA+ttw4Ebx2AIIFCxYsWLBgwYIF7wTmYzm4mK98AE1fS8X6L9x4u/fw2vrzCAF/up5ww1v3/DX4FxN'+
		'MTzA9wfQE0xNM73DgBw8JYpiEhB6BAAAAAElFTkSuQmCC';
icon_c_7[0][2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAr0lEQVR42u3VsRKDIBAAUa5'+
		'KnfxWvje/ZWorEgvrw4IZ2dut0fGBQPTeW6VCMDzB9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0xPML2p4Ii4/PL/98TS4G//DI9/xps'+
		'B3tuWjn20FwecdUwIBpyNOf8ABHhkQgQLXghcbg+XPKVL3sPnCmbhwAcoCweeDRIs2D08D5yFOqWzUPfwaAjw1WeWBt8xwfQE0xN'+
		'MTzA9wfTKgX8OKmKYVBXGEwAAAABJRU5ErkJggg==';
icon_c_7[0][3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAsElEQVR42u3VwQ2DMBAAQV8'+
		'HiGJoIvXSRIqJ0oEJD34ImwdSvLf7PhBjsIlaa8lUCIYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpCab3KDgibt/89zwxNPhd1+7'+
		'5JV4M8Ld8mrNTmTngVvuCYMCtmeMLQIB7FkSw4IHA6fZwylPa//BJqDfcmkHt4Z4FESx4IHC6PZzylPY/fBECfPeaocH/mGB6guk'+
		'JpieYnmB66cAbnXhimOdx8jMAAAAASUVORK5CYII=';
icon_c_7[0][4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAqElEQVR42u3TMRKDIBQAUX5'+
		't53VyBM/rEbxOOmu0SQocgk0SXXY7+A7O0yFyzqmnQjA8wfQE0xNMTzA9wfQE0xNMTzA9wfQE0xNMTzC9r4Ij4nD4/r44O78leM7'+
		'Lez3F4wD+NL8t+JnWNKahCq7NBQsWLFjwr8FlaHAtJLgVCtwK9Ydbz6Du8JkPIliwYMGCrw5+1QW43EOD/5FgeoLpCaYnmJ5get2'+
		'BN8++qph3fIzUAAAAAElFTkSuQmCC';
icon_c_7[0][5] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAsElEQVR42u3XMRKDIBBA0Wy'+
		'V2lzL8+ZasbYieoGsTAbRz/81Mr6CRaOU8hipEAxPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0yvKTgiqjff3iduDX4vx/efp2C'+
		'AP2u+9vWEgXdQFg68g7Jw4NYgwYI9w+3AWagpnYW6h7POPOPdv6XPHmpd/5Z6THHBgv8EZWtw4OGmtPfwjxDg2mduDb5igukJpie'+
		'YnmB6gukNB/4CHypimDIwJQkAAAAASUVORK5CYII=';
icon_c_7[0][6] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAsklEQVR42u3VsQ2DMBBA0Vy'+
		'djnUYIfNmhKyTjtqENhI6kDCG7/9r2+IVd0Qp5dFTIRieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5heVXBE7H789z1xa/Dnvf3'+
		'98RUM8PTNzz4HGHgBZeHACygLB64NEizYGa4HzkJt6ayu/sNnznjzGT57qTXd0i22uGDBB4P/Q4PXQoKzUOCtIcB779wafMUE0xN'+
		'MTzA9wfQE0+sOPAO9jouYRH9pQgAAAABJRU5ErkJggg==';
icon_c_7[0][7] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAo0lEQVR42u3QQQ5AMBQAUX9'+
		'lzbWc17VYWxUJiTQRLERMZ3btb5q+RkqpKqkQDE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTO9VcEQ8vnx5T/wanPrx/vmugYC'+
		'H6fpwW8PAC+i0bY4Dr6C8fI4DH0FXc8G/Ae/rEsD5Hhp850MECxYsWLBgwYIFvwre1yWA8z00+IsE0xNMTzA9wfQE0ysOPAMbFYa'+
		'YImwD1wAAAABJRU5ErkJggg==';
icon_c_7[0][8] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAqklEQVR42u3UwQmAMBAAQa8'+
		'F27Je27KFqOBDAiH6EMze7vcu4iAmSilTpkIwPMH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wvU/BEfH64cf7xNDgsq7P95cFAt6'+
		'2/vI8w8AHqNk1x4FPUF09x4HvoN5csOABwHVocDMkuBcOnO4LZ/yHU97SgungOjS4GRLcCwV+uk8Avz0zNPiPCaYnmJ5geoLpCaa'+
		'XDrwDAUW0mKahbVUAAAAASUVORK5CYII=';
icon_c_7[0][9] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAArUlEQVR42u3VQQ5AMBBAUXM'+
		'Ft3Qit3SFIrGQJgwLif7+v+0Qr1KilDL0VAiGJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6Qmm9yk4Il7ffHueaBpcpun5/DxDwMu'+
		'SD48jDLyBLjvWceAdVFev48BnULYuWHAD4Do0+DIkOAsFziK94WwGdYafbIhgwQ2BuzvDXX6l/Q/fzRPAb69pGvzHBNMTTE8wPcH'+
		'0BNPrDrwCyACLmJpZR94AAAAASUVORK5CYII=';

// 通常モード（１５ｘ１５用）
icon_c_7[1] = new Array();
icon_c_7[1][0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAZklEQVR42u3TsQ2AMAxFQTw'+
		'VQzAvQzCVQaIJFVUUW7rXufm6IonM3DoVwMDAwMDAwJUCBgYGBv4ZjPgMPvtRHnxe7+axBzAwMDDwAvB4lwfPDrjdk2j56dqBx7s'+
		'8eHbAwMDAwGu7ARPd2ak7UfORAAAAAElFTkSuQmCC';
icon_c_7[1][1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAdUlEQVR42u3VywmAMBAFQLc'+
		'Jm7Jem7KJ6MWDXzwkMeK847I8hhDYSCl1X0oAAwMDAwMDtxRgYGBg4JOSiMuSpT+aBKdpPM77AbjIl1jxzYL3eGBgYGDguuC7w7G'+
		'ZZ8AXPc2bnUyv/V/wk71mwDUDDAwMDPxuZukM7anou6r5AAAAAElFTkSuQmCC';
icon_c_7[1][2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAfElEQVR42u3TsQ2AMAxEUW4'+
		'E5mJe5mIEAwUdjiIFwVn8a2M5z5KtiJgqRYABAwYMGDBgpwAGDBgw4JsmUleT4y/ZgLdYmzWzFsBD4OztGsQK3BoE8C9XouTRlQW'+
		'fsCy24CdggFvgLJYrkcX26MqAe+pswG8GMGDAgAF/mx0rnO2pIl/VqAAAAABJRU5ErkJggg==';
icon_c_7[1][3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAeElEQVR42u3TQQqAMAxEUed'+
		'SXqLn9RJeKrrpzoaCoBP6Z5uQvkCqiNgqRYABAwYMGDBgpwAGDBgw4Ich0tSQ+y3ZgM840p5dDfAr8KjWF7ECZ4sAXvIkSn66cuB'+
		'RzfIkskUAL3kSJT9dOfBMnw34ywAGDBgw4H9zASZ+7amio7DkAAAAAElFTkSuQmCC';
icon_c_7[1][4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAc0lEQVR42u3Syw2AIBAFQLc'+
		'uS7BeS7AuNJ4gQS/+1mTeCZbkZSBEKWX4UwIYGBgYGBg4U4CBgYGBOyURTcnWGWfzFOC5LPt6irEB9+bAwMA3g+ukBx8F+Cr46Cz'+
		'llzi7CDAw8Mvgep8e/MgjAAMDAwN/mhV9vBe4d0lEIAAAAABJRU5ErkJggg==';
icon_c_7[1][5] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAfklEQVR42u3VsRGAMAxDUTQ'+
		'CczEvczGCgR7nUiQgH19tcs4rrIsiYqkUAQYMGDBgwICdAhgwYMCAH4ZIXUOut2QD3o/2nG0V4CHgG5bFFjwCBrgFzmK5EllsS1c'+
		'GnJ2N3u2pX/OMMv4TXG4lSpauHLjnng34zQAGDBgw4G9zAiuc7ankdBvGAAAAAElFTkSuQmCC';
icon_c_7[1][6] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAfElEQVR42u3TwQ2AMAhGYf+'+
		'5HMF5HcG5UK9GmialCsl754Z+B5CZLZUSYMCAAQMGDDhTgAEDBgz4ZYjUNeT6S2nAx96es24CHAK+YV5pwREwwC2wV8qV8Ep7dOX'+
		'Az5WI3u2pRzfjGAGXWwkvwKPgnndpwF8GGDBgwID/7QRyWgG4ei4f7wAAAABJRU5ErkJggg==';
icon_c_7[1][7] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAcklEQVR42u3QwQmAMAwFUDO'+
		'CczmvczlC1YPQgxYRpRHevyWE5LVRShn+lAAGBgYGBgbOFGBgYGDgkyURt5ZstyINuMxLe2YagV8B77A6dT8t+IBd9YGfgOs6Pbj'+
		'1EGBgYGDgvuC6Tg/+5BOAgYGBgbtmBbpmAriV8cm1AAAAAElFTkSuQmCC';
icon_c_7[1][8] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAeUlEQVR42u3TQQrAIAxE0eZ'+
		'8ntfzpe2ikEVTBMVO4M8yDPEtjLn7USkGGDBgwIABA1YKYMCAAQN+WWI2tOR6y2TA3vt3pzXAS8A3LCbOZcEPLJsDngXHyIPTDuB'+
		'F4HJfouTRlQPHyIPTDuBJ8EhPBrwzgAEDBgz435zr1xW4O4eh7gAAAABJRU5ErkJggg==';
icon_c_7[1][9] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAeklEQVR42u3TQQqAMAxEUXP'+
		'cnqjHjboQsjClUNEJ/lmmIX2F1Nx9qxQDDBgwYMCAASsFMGDAgAHfDDGbGnLcZTJgb23c0zvgR8AnLCbWZcEXLKsDXgXHyIPTHsC'+
		'L4OxMciVGDwH8y5Uo+enKgWf6ZMBvBjBgwIABf5sd0goBuPzg7coAAAAASUVORK5CYII=';

// 通常モード（２０ｘ２０用）
icon_c_7[2] = new Array();
icon_c_7[2][0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAT0lEQVR42u3SsQkAIAxEUW8'+
		'qh3Beh3CqaKOdXeAU/q/SGB5BRURxJxAgQIAAAQKEAyHpPF57ZEP0EaVVgQDxFmLPNkRW/1+CP5EdCBAgbk0OjJy/yRhvJQAAAAB'+
		'JRU5ErkJggg==';
icon_c_7[2][1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAZklEQVR42u3UQQrAIAxE0c4'+
		'leqme10v1EqmrFKxuJCRd/NlFUB4DRmZ2VEcgQIAAAQIEiEyEpM+l/o7SEXa3dz6vGoQ30DEliLERECB+gZj9Dp83MCF7ws83Gwn'+
		'bmOlNRAcECBCrPPueqb9NtTxIAAAAAElFTkSuQmCC';
icon_c_7[2][2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAZklEQVR42u3TsQ2AMAxEUW4'+
		'E5mJe5mIEAwWNkRsUnRH8Ky0leTklioipOwIBAgQIECBAOBGSykXHfrIhtlhv81mLF5FnJ8qKqJr5XxOveRPXzXNaEE8O/V4TOe2'+
		'/w97E6IAAAaLKDpSiqb9xGAVvAAAAAElFTkSuQmCC';
icon_c_7[2][3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAYElEQVR42u3SsQnAMAxE0dx'+
		'SWSLzZoksJceFmxiRwiAZ9K8U2DyOk5kd2REIECBAgAABIhIhyX30/qcwxGP3dD91xSK+t44KRXjN1GuCTfw1U6+JbTcxkraJ1YA'+
		'AAcJLA7hvqb+ZTBceAAAAAElFTkSuQmCC';
icon_c_7[2][4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAX0lEQVR42u3QQQpAIQhF0d6'+
		'6WkLrbQl/XdakCKFRoH9w30gF4ajMrGRHIECAAAECBIhIhKS9NPfl+zBEt6801Y04exBpiJU0hE84ws/CP3H7DIjfIFadhng+AgQ'+
		'IEJcMJijFv15TAzAAAAAASUVORK5CYII=';
icon_c_7[2][5] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAaUlEQVR42mP8//8/w0ADxlF'+
		'HjDpi1BGjjhh1xKgjRh1BT0cwMjLi1AQ0j5Fujtj6HlOftyAj/R0BsnTAQ4Jcnw+/kEAHdE8T6GKURA9VyglK08jQDYlBmyZgYMD'+
		'SBKVg1BGjjhh1BC4AAJSiqb+NvhCCAAAAAElFTkSuQmCC';
icon_c_7[2][6] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAZUlEQVR42u3SwRGAIAxEUbc'+
		'uS6BeS7CuqFecXITZjMzfKxN4JFFEbNURCBAgQIAAAcKJkJQW3ffJhjiPd93e5Ec8j5Z34uvP1+tEn/KdGBnPlJ0Y3ZH/d6KPHZG'+
		'd2RCzAwIEiCwXx8e2v9yP3/EAAAAASUVORK5CYII=';
icon_c_7[2][7] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAZUlEQVR42u3QsQ3AIAxEUW4'+
		'E5sq8zJURHJAIRSIrBZKd4rvCSODnk5mV7BIIECBAgAABIhIhyX3U/1MYwtr5vj9qPGIMXQnMPgUxhj77MMRKIAvxlQwIEL9B3Oc'+
		'0xPYSIECAcOoCT+K3v5E4knUAAAAASUVORK5CYII=';
icon_c_7[2][8] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAbElEQVR42u3QsQ3AIAwEQH4'+
		'ECqZiXqZKwQgmkZIUsdxF74J3Z1vg08PMSnZBCCGEEEIIIYRgIgCEj87/QEPYGH7eOx9xHX0TuPsUxDFnabXmItKTcPNtk3iOfvv'+
		'9knBzNiLa0RB/lxBCCBHVArM9wr9FTulDAAAAAElFTkSuQmCC';
icon_c_7[2][9] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAb0lEQVR42u3SQQrAIBADQPM'+
		'ED32kL/KRPfiEbQvFQ2VPhaTQ5OaCOoRFRBR1YIQRRhhhhBFGMBEA0kvne6AhorV13jsfcX06G7jPEsQ+Rtlq1SLkTSxzNuI5oze'+
		'RNfO/Jj67E7MR1U68jRFGGJHlADoQtb8fdhutAAAAAElFTkSuQmCC';

//--------------------------//
// アイコン定義（資源表示） //
//--------------------------//
var icon_cs = new Array();

// 資源モード（１１ｘ１１用） 資源アイコン＝numx5+maxtype、0=平均,1=木,2=石,3=鉄,4=糧
icon_cs[0] = new Array();
icon_cs[0][1*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlUlEQVR42u3XwQ2AIBAAQa8'+
		'zSqcz5WlQY9Sgsuw+CQbmeBk552mkQjA8wfQE0xNMTzA9wfQE0xNMTzA9wfQE0xNMTzC9puCU0ny2p5wfKHDp+PAIwYJ7A9'+
		'dr6wHgwHsDECxYsGDBggULFiz4JrBeq8F1rQfw6d/S5jIvvLhgwQ/BV7/pGvzHBNMTTE8wPcH0BNMbDrwA2HoUTHu/QmkAA'+
		'AAASUVORK5CYII=';
icon_cs[0][1*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAjUlEQVR42u3XQQqAIBBA0eZ'+
		'mHt2bVcuYoiiQ9Pv/UoTxzc6otS4zFYLhCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpNQWXUtanO/v8YIHvyCFY8Hjg3P'+
		'GEBr5cgGDBggULFixYsGDBH4G5BM61XsC/v6XTawQL7h/8sqHBPSaYnmB6gukJpieY3nTgDQ4o7j0786IyAAAAAElFTkSuQ'+
		'mCC';
icon_cs[0][1*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAkUlEQVR42u3XQQ6AIAwAQfs'+
		'zns7P0KOpRqOGKOvumYROORG11ulPhWB4gukJpieYnmB6gukJpieYnmB6gukJpieYnmB6XcGllHZ2Zrk/WOB2YI4QLHg4cG'+
		'69ABp4dwGCBQsWLFiwYMGCBd8E5hI413sB7/6WNtP0f3HBgp+CLzY0+IsJpieYnmB6gukJpvc78AxgUQFM5g3eGQAAAABJR'+
		'U5ErkJggg==';
icon_cs[0][1*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAnUlEQVR42u3Xyw2AIBAAUem'+
		'MAizEkizEAugMPRrUGDX4GWeOBANvORlSSs2fCoLhCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpVQXHGPPenun8gALnod'+
		's+vO0FC/4auFybDwAHXhuAYMGCBQsWLFiwYMEngeVaCS6rPYBH/5YWl7nhxQULvgg++s2nwW9MMD3B9ATTE0xPML3fgUeQA'+
		'xRM1lP3xgAAAABJRU5ErkJggg==';
icon_cs[0][1*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAl0lEQVR42u3XwQ2AIBTAUNm'+
		'M0RiNzdCjQY1Rg0ppjwQD73My5JynkQqC4QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6TUFxxjL2Z7l/IACl5KODw9JsO'+
		'DewPXaegA48N4ABAsWLFiwYMGCBQu+CazXanBd6wF8+re0ucwLLy5Y8EPw1W+6Bv8xwfQE0xNMTzA9wfSGA88f7hRMF9xrQ'+
		'AAAAABJRU5ErkJggg==';
icon_cs[0][2*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlUlEQVR42u3Uuw3AIAwA0Xg'+
		'zRmezfLp0QIGEz3c1SH5IOHrvV6VCMDzB9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0xPML2t4NbavXrnnSdSg9/mh4kQLPh08O'+
		'jM/0HSg2ceRLDgROByf7jklhZcCfyBRuHAu0GCBfuH94GHw9C2tGAiePVOavCJCaYnmJ5geoLpCaZXDvwAidoUTLsKuaAAA'+
		'AAASUVORK5CYII=';
icon_cs[0][2*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAjklEQVR42u3UsQ3AIAwAwXg'+
		'zRmezJCUdUCDh938Nkg/JRO/9qVQIhieYnmB6gukJpieYnmB6gukJpieYnmB6gukJpncU3Fp7d+/880Ru8A45BAu+HzxrPJ'+
		'EdvPQgggXnAZfb4Zq/tOBK4AUKDnwaJFiwO3wQPJ1GsOD7wZulBt+YYHqC6QmmJ5ieYHrlwB9gme49lH1iwQAAAABJRU5Er'+
		'kJggg==';
icon_cs[0][2*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlklEQVR42u3UsQ3AIAwAwXg'+
		'zRmM0NiNJlw4okML7v7fEWTLRWrsyFYLhCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpbQWXUvrqzPOeOBpc+7y5RggW/H'+
		'fwEPlZyPHgmYUIFnwQON0Np/ylBWcCv6BROPBukGDB3vA+8CjcLy2YCF6dORr8xwTTE0xPMD3B9ATTSwe+AYnPFExJ/c4ZA'+
		'AAAAElFTkSuQmCC';
icon_cs[0][2*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAnUlEQVR42u3UwQ2AIBAAQem'+
		'MAizEkizEAugM9ecPeZDA3u4bkhsSLpVStkglwfAE0xNMTzA9wfQE0xNMTzA9wfQE0xNMTzA9wfSGgnPOtffOM09aGlyv4/'+
		'8w+ylY8Ozg1pnvgywP/vMgggUvBA73h0NuacGRwC+oFQ48GiRYsH94HLg5DG1LCyaCe+8sDZ4xwfQE0xNMTzA9wfTCgW/CN'+
		'BRMgcyHLgAAAABJRU5ErkJggg==';
icon_cs[0][2*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmElEQVR42u3UsQ3AIAwAwXg'+
		'zRmM0NiNJlw4okML7vwbJh4SjtXZlKgTDE0xPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ATT2woupfTVO888cTS49zo/TFTBgv'+
		'8OHp35Psjx4JkHESz4IHC6P5xySwvOBH5Bo3Dg3SDBgv3D+8DDYWhbWjARvHrnaPAfE0xPMD3B9ATTE0wvHfgGic8UTHYe2'+
		'DgAAAAASUVORK5CYII=';
icon_cs[0][3*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAk0lEQVR42u3UsQ3AIAwAwXg'+
		'zRmezhJIOKCLh938NEmfJRO/9qVQIhieYnmB6gukJpieYnmB6gukJpieYnmB6gukJpvcruLX2nt4Z74nU4NH+YyIEC74dvD'+
		'ozDyQ9eGcgggUnApfb4ZK/tGA6eHUGtcM7AxEsOBG43A6X/KUF08Gnd1KDb0wwPcH0BNMTTE8wvXLgDymtFEw2w8zzAAAAA'+
		'ElFTkSuQmCC';
icon_cs[0][3*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAj0lEQVR42u3UsQ3AIAwAwXg'+
		'zRvdmScp0QBEJv/9rkDgkOzLz6lQIhieYnmB6gukJpieYnmB6gukJpieYnmB6gukJpvcreIxx79553xO1wTvkECz4fPCs74'+
		'nq4KUPESy4DrjdDPfc0oLp4FmkGV76EMGC64DbzXDPLS2YDt6sNPjEBNMTTE8wPcH0BNNrB34AQHvuPb+XPdMAAAAASUVOR'+
		'K5CYII=';
icon_cs[0][3*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlUlEQVR42u3UsQ3AIAwAwXg'+
		'zRmM0NiMp0wFFpPj931viLJkYY1yVCsHwBNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0PgW31ubpzPOeSA3uc9/cIwQL/j'+
		't4iXwtJD14ZyGCBScCl7vhkr+0YDp4iSTd8M5CBAtOBC53wyV/acF08OlMavAfE0xPMD3B9ATTE0yvHPgGKaIUTJnXjs4AA'+
		'AAASUVORK5CYII=';
icon_cs[0][3*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAnElEQVR42u3UwQ2AIBAAQem'+
		'MAizEkizEAugMffoDHybc3u4bEuaSo7TWtkwVwfAE0xNMTzA9wfQE0xNMTzA9wfQE0xNMTzA9wfR+Bdda+9c7z3tKaHC/jv'+
		'nH7KdgwauDR2feAwkPnhmIYMGBwOl2OOUvLZgOHp1B7fDMQAQLDgROt8Mpf2nBdPDXO6HBKyaYnmB6gukJpieYXjrwDWIHF'+
		'Ez77vfEAAAAAElFTkSuQmCC';
icon_cs[0][3*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlklEQVR42u3UsQ3AIAwAwXg'+
		'zRmM0NiMp0wFFpPj9X4PEWTIxxrgqFYLhCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpfQpurc3TO897IjV4zr7/mOiCBf'+
		'8dvDrzHkh68M5ABAtOBC63wyV/acF08OoMaod3BiJYcCJwuR0u+UsLpoNP76QG/zHB9ATTE0xPMD3B9MqBbymiFExqxYjtA'+
		'AAAAElFTkSuQmCC';
icon_cs[0][4*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAjUlEQVR42u3TQQqAIBBA0eZ'+
		'mHn1uVu4Cg3Qj2ff/5SjoE4zMPHYqBMMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0BNObCi6lnO2snhej678E1+7DIh7gt3'+
		'XBggULFix4MrgNDe5eRrDg9cG9Pag/PPIgggULFixY8ELgdoYGf5FgeoLpCaYnmJ5getuBL0erTEz9e/DyAAAAAElFTkSuQ'+
		'mCC';
icon_cs[0][4*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAiklEQVR42u3TQQ6AIAwAQfs'+
		'znt6fqUeDRrgQcdk90kMZEiIzt5UKwfAE0xNMTzA9wfQE0xNMTzA9wfQE0xNMTzA9wfSGgkspe3127ove+T/BV1I8gF/mgg'+
		'ULFixY8GDwLTS4eRvBgucHtyL94a4HESxYsGDBgicCV6HBXySYnmB6gukJpieY3nLgA5z/FkyE00qIAAAAAElFTkSuQmCC';
icon_cs[0][4*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAj0lEQVR42u3TsQ3AIAwAwXg'+
		'zRmM0NiPpIhEp0KCE57+0C+uQiFLKsVMhGJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmN5UcEqptrPrXozulwTneptyxA'+
		'P8thcsWLBgwYIng9vQ4F6CBS8A7iJJf3jkQQQLFixYsOAfgdsZGvxFgukJpieYnmB6gultBz4Bd0BMTAjR+bMAAAAASUVOR'+
		'K5CYII=';
icon_cs[0][4*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlUlEQVR42u3T0QmAIBgA4dz'+
		'MARqkkRqkAdzMegsM0hfJzrvHX0E/wZBSWmYqCIYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpCabXFRxjzOXsOi+0rv8SnI'+
		'/tPmzdH+C3dcGCBQsWLLgzuAwNrl5GsODxwbU9qD/c8iCCBQsWLFjwQOByhgZ/kWB6gukJpieYnmB604FP1MVMTN7QRIwAA'+
		'AAASUVORK5CYII=';
icon_cs[0][4*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAkElEQVR42u3TQQqAIBQA0f7'+
		'NPJpH82bWLjBIN5KNM8uvoE8wSinHToVgeILpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5gelPBKaXazq7zYnT9l+Ba831Y5A'+
		'f4bV2wYMGCBQueDG5Dg7uXESx4fXBvD+oPjzyIYMGCBQsWvBC4naHBXySYnmB6gukJpieY3nbgE3dATEzrDQwkAAAAAElFT'+
		'kSuQmCC';
icon_cs[0][5*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAl0lEQVR42u3X0Q2AIAwAUbs'+
		'Zo7OZ4gSVGESOu29I+j5oQtRaj50KwfAE0xNMTzA9wfQE0xNMTzA9wfQE0xNMTzA9wfSGgkspZ++dNk8sDW49HyZCsOCVwD'+
		'coCwceDRIs2Dc8DpwOQ9vSgong7MzXS23qb2nGFhcs+CUoO4MDb7elBdPBvXeWBv8xwfQE0xNMTzA9wfS2A1+J2hRM1ehdo'+
		'wAAAABJRU5ErkJggg==';
icon_cs[0][5*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAkUlEQVR42u3XwQ3AIAzAwGY'+
		'zRmezthsEVFHA2H+k3CORiFrrdVIhGJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmN5QcCnl7n3zzhN7g3vIIVjwXuAGCg'+
		'48GiRYsDs8EJxOI1jw+uCsn4/a1N/SjCsuWPBXUBYOfNyVFkwHd7Y1eMUE0xNMTzA9wfQE0zsO/ABgme49CLjCJwAAAABJR'+
		'U5ErkJggg==';
icon_cs[0][5*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmUlEQVR42u3XwQ2AIBAAQa8'+
		'zSqM0OkOtAIlBZNl9cwnz4BKilHLsVAiGJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmNxScUqq9M9d9Ymlwrs/NOUKw4J'+
		'XAN6gVDjwaJFiwb3gcuBVuSwsmgpvIj5fa1N/SjC0uWPBLUOsMDrzdlhZMB/fOLA3+Y4LpCaYnmJ5geoLpbQc+AYnPFEzE1'+
		'4m/AAAAAElFTkSuQmCC';
icon_cs[0][5*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAoElEQVR42u3XwQ2AIBAAQem'+
		'MAizEkizEAugMtQIkBpFl9w3JzYNLCCmlZaaCYHiC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHpNwTHGXHvnmicMDc7H9n'+
		'yYdRcseCTwDSqFA7cGCRbsG24HLg5D29KCieDSma+XWtffUo8tLljwS1DpDA483ZYWTAfX3hka/McE0xNMTzA9wfQE05sOf'+
		'ALCNBRMX0ydFAAAAABJRU5ErkJggg==';
icon_cs[0][5*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmklEQVR42u3XwQ2AIBAAQa8'+
		'zSqM0OkOtAIlBZNl9Q3Lz4BKilHLsVAiGJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmNxScUqq9d655Ymlwrfn5MJEFC1'+
		'4JfINa4cCjQYIF+4bHgZvD0La0YCK4debrpTb1tzRjiwsW/BLUOoMDb7elBdPBvXeWBv8xwfQE0xNMTzA9wfS2A5+JzxRME'+
		'AzzLgAAAABJRU5ErkJggg==';
icon_cs[0][6*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmElEQVR42u3USwrAIAwA0eZ'+
		'mHt2b9bMtBSvUquPMPpC3SCLnvK1UCIYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpCabXFJxS2mtnzn1iavDZ+2UiBAueCX'+
		'yBSuHArUGCBXvD7cDFZWhfWjAd/HTDfz+1rl+6xxcXLPhj8D00uLiMYMHjg2tnpgaPmGB6gukJpieYnmB6y4EP4pIvTGm1u'+
		'xgAAAAASUVORK5CYII=';
icon_cs[0][6*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAkklEQVR42u3UwQ2AIBAFUbc'+
		'zSqcz9a4Jkoiw48ydZN+BH7XW7U+FYHiC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHpDwaWUvffNeU/kBveQQ7DgXOAHFB'+
		'x4NEiwYP/wQHDzGsGCc4HvKB+P2tSVnrHiggW/DL6EBjevESx4fXBnqcErJpieYHqC6QmmJ5je78AHpYj/Pb/nAgQAAAAAS'+
		'UVORK5CYII=';
icon_cs[0][6*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmElEQVR42u3UwQ2AIBAFUbc'+
		'zSrM0OkO9GhMkEZFx5k7CO+yPnPPyp0IwPMH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wva7glFJpfbP/J6YGr+W+eY0QLH'+
		'gm8AGqhQP3BgkW7A33A9fCrbRgOvjqht8etaErPWLFBQt+GHwODa4lWPAE4NY3U4O/mGB6gukJpieYnmB6vwNvxMMvTPaPW'+
		'gkAAAAASUVORK5CYII=';
icon_cs[0][6*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAoUlEQVR42u3UwQ2AIBAAQem'+
		'MAizEkizEAugM9WtMkERU1t3/JTePu5BSGv5UEAxPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0yvKTjGmGtntn1C1+C8TN'+
		'eXGWfBgnsC76BSOHBrkGDB3nA7cHEZ2pcWTAef3fDTT+3VL/3GFxcs+GbwMTS4uIxgwd8H1850Df5igukJpieYnmB6gun9D'+
		'rwC5fQvTLXT0wUAAAAASUVORK5CYII=';
icon_cs[0][6*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAm0lEQVR42u3UwQ2AIBAAQem'+
		'M0iiNzlC/xgRNRGDZ/V9y87gLOedtpYJgeILpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5gek3BMcbydubYJ0wNLiU9XyYkwY'+
		'JnAp+gWjhwa5Bgwd5wO3B1GdqXFkwH393w30+t65fu8cUFC/4YfA0Nri4jWPD44LczU4NHTDA9wfQE0xNMTzC95cA7xMMvT'+
		'AZFCVEAAAAASUVORK5CYII=';
icon_cs[0][7*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAi0lEQVR42u3QQQ6AIAwAQfs'+
		'zns7PFG+mFzHRIMvusQ1Jh6i1bisVguEJpieYnmB6gukJpieYnmB6gukJpieYnmB6gul9Ci6l7E/ftHtianCr/5gIwYJnAp'+
		'+gXN7jwFfQ3V6w4B+C8wwN7vkQwYIFCxYsWLBgwYJfAucZGjwiwfQE0xNMTzA9wfSWAx+C9zBMSwINdQAAAABJRU5ErkJgg'+
		'g==';
icon_cs[0][7*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAiElEQVR42u3QQQoCQQwAQed'+
		'n+/T5mXqUQdAFRbe3+hoCqYw55+VMDeB4wPWA6wHXA64HXA+4HnA94HrA9YDrAdcDrvdV8LZt170793vGscF7yAMY+FjgZ5'+
		'RlngM/gl7NgYH/EbyUBr/1EGBgYGBgYGBgYOAPgZfS4F8EXA+4HnA94HrA9U4HvgEAzwJMTQ8xdQAAAABJRU5ErkJggg==';
icon_cs[0][7*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAj0lEQVR42u3QwQ2AIBAAQa8'+
		'zSqM0OkP9GXyIiUZZdp93uYQhSinLTIVgeILpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geq+CU0r17s32nhganGu/OUcIFj'+
		'wSeAedkM0eBz6CrvaCBf8Q3M7Q4J4PESxYsGDBggULFiz4IXA7Q4O/SDA9wfQE0xNMTzC96cArylwwTDdvw7kAAAAASUVOR'+
		'K5CYII=';
icon_cs[0][7*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlElEQVR42u3QwQ2AIBAAQem'+
		'MAizEkizEAugM9WfuIyYaZd193oXkhlRKGf5UEgxPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0zvUXDOuV59s92TugbXZW'+
		'o/ZpwFC+4JvINicY8DH0Fne8GCPwiOMzS45UMECxYsWLBgwYIFC74JHGdo8BsJpieYnmB6gukJpvc78Ao6gDBMdmmtLQAAA'+
		'ABJRU5ErkJggg==';
icon_cs[0][7*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAj0lEQVR42u3QQQ6AIAwAQfs'+
		'znsbT+BnqzfSiJhpl2T22IekQrbVlpkIwPMH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wvVfBpZR+9812TwwN7r1ePyaqYM'+
		'EjgXdQLu9x4CPobC9Y8A/BeYYGX/kQwYIFCxYsWLBgwYIfAucZGvxFgukJpieYnmB6gulNB14BylwwTGWlvYsAAAAASUVOR'+
		'K5CYII=';
icon_cs[0][8*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlElEQVR42u3UMQ6AIAxAUXs'+
		'zjs7NFDfTBRlM7Of/tWnSN0D03o+dCsHwBNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0PgW31s7VnXFPlAaP3h8TIVhwJf'+
		'ANyuU5DvwEzeaCBRcA59Dg6TGCBdcCb/eGt/ylBdPBOTR4eoxgwf8Hr+6UBv8xwfQE0xNMTzA9wfS2A18/EUpM+T3ECwAAA'+
		'ABJRU5ErkJggg==';
icon_cs[0][8*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAkUlEQVR42u3UQQrAIAwAweZ'+
		'nPt2ftT2WWhAPBbPZvQYhc4jRez8qFYLhCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLp/QpurZ2rb+59Ijd4hRyCBecCf1'+
		'Fecxz4CZrNBQtOAB5Cg6fbCBacC1zuhiv+0oLp4CE0eLqNYMH7gxdLDd4xwfQE0xNMTzA9wfTKgS/Z2RBMhMulowAAAABJR'+
		'U5ErkJggg==';
icon_cs[0][8*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlklEQVR42u3UMQ6AIAxAUXs'+
		'zjsbRuBnqZnBABxP7+X9tmvQNEK21baVCMDzB9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0xPML1PwaWU/nbnuCdSg2t/bq4Rgg'+
		'VnAp+gG3KY48BX0GwuWHAC8BgaPEuw4GTg5d7wkr+0YDp4DA2eJVhwAvDbndTgPyaYnmB6gukJpieY3nLgHQN+Skx8H7aUA'+
		'AAAAElFTkSuQmCC';
icon_cs[0][8*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAnUlEQVR42u3UsQ2AIBBAUdm'+
		'MARzEkRzEAdgMtTM0SGHiff5vL5fcKyCVUpaZSoLhCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpfQrOOdfRneueFBpcj+'+
		'39MesuWHAk8A1qa+c48BPUmwsWHADchgZ3jxEsOBZ4ujc85S8tmA5uQ4O7xwgW/H/w6E5o8B8TTE8wPcH0BNMTTG868AkNe'+
		'0pMh0pxewAAAABJRU5ErkJggg==';
icon_cs[0][8*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmElEQVR42u3UsQ3AIAwAwXg'+
		'zRmM0NiNJF9GQFJHw899alnwFRGvt2KkQDE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTO9XcCmlf9257onU4N7r+2OiCh'+
		'acCXyDxsY5DvwEzeaCBScAj6HB02MEC84F3u4Nb/lLC6aDx9Dg6TGCBa8P/rqTGrxigukJpieYnmB6gultBz4BA35KTLWU9'+
		'PYAAAAASUVORK5CYII=';
icon_cs[0][9*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAl0lEQVR42u3UMQrAIBAAwdz'+
		'PfLo/S0wXbNQi4K27rQo3gkat9TqpEAxPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0zvV3Ap5V490+aJ1ODW/DARggVnAr'+
		'+gvn4dB/6CRuuCBScA96HBw2EEC94fPNqDesMzFyJYcCLwcW/4yF9aMB28eiY1eMcE0xNMTzA9wfQE0zsO/ADmSi9MIHSI4'+
		'QAAAABJRU5ErkJggg==';
icon_cs[0][9*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAk0lEQVR42u3UQQqAMAwAQfO'+
		'zPr0/U4+iQu1BaDa711DIFNrovW+VCsHwBNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0fgW31vbZM+c+kRs8Qw7BgnOB3y'+
		'i3OQ58BY3mggUnAD9Cg4fbCBa8PngU6Q1/uhDBgvOAy73hmr+0YDp4stTgFRNMTzA9wfQE0xNMrxz4AJTq/z0yW/JGAAAAA'+
		'ElFTkSuQmCC';
icon_cs[0][9*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmUlEQVR42u3UwQ2AIBAAQa8'+
		'zSqM0OkP9GXygDxNv2f1eLmFIIFpr20qFYHiC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqfgksp/e3OcZ5IDa79ublGCB'+
		'acCXyCbshhjgNfQbO5YMEJwGNo8CzBghOAp0jSG35yIYIFJwIv94aX/KUF08Fvd1KD/5hgeoLpCaYnmJ5gesuBd8h7L0wW+'+
		'lIAAAAAAElFTkSuQmCC';
icon_cs[0][9*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAn0lEQVR42u3UsQ2AIBQAUdm'+
		'MARzEkRzEAdgMtTM0aGHCP+5aIPmPBFIpZZmpJBieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5jer+Ccc/165ponhQbXY3'+
		's/zLoLFhwJfIPa2nUc+AnqrQsWHADchgZ3hxEseHxwbw/qDb+5EMGCA4Gne8NT/tKC6eCvZ0KDR0wwPcH0BNMTTE8wvenAJ'+
		'+msL0y6tO6WAAAAAElFTkSuQmCC';
icon_cs[0][9*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmUlEQVR42u3UQQ7AEBQA0bq'+
		'Zozmam2m7a2ywaOKPmS2S/ySkWut1UkkwPMH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wvV/BOee2euaZJ4UGt1bmh0lFsO'+
		'BI4BfU16/jwF/QaF2w4ADgPjR4OIxgwfuDR3tQb3jmQgQLDgQ+7g0f+UsLpoNXz4QG75hgeoLpCaYnmJ5geseBb8h7L0w+v'+
		'THoAAAAAElFTkSuQmCC';

// 資源モード（１５ｘ１５用） 資源アイコン＝numx5+maxtype、0=平均,1=木,2=石,3=鉄,4=糧
icon_cs[1] = new Array();
icon_cs[1][1*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAcElEQVR42u3VQQqAIBBA0eZ'+
		'mHt2bVZugkqKFmtH7W2V8iGDknKcvFcDAwMDAwMAjBQwMDAxcllKar9bW+TEkeK0cHgHc5Els+GHBZzwwMDAwcF/w3cexrwa+6dd'+
		'8OKjSbf8X/GTfMOCeAQMDAwO/2wIfHc0tF6Ao+gAAAABJRU5ErkJggg==';
icon_cs[1][1*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAbUlEQVR42u3VSwqAMAxAQXO'+
		'zHr03UzeC4gdBWyPM25VCOotCotY6/KkABgYGBgYGzhQwMDAw8L5Synh2N8+PnOAjcgA3+hLLKSt4hwcGBgYG7gq+Whzr3sC3Xc2'+
		'bl4Afgm+UBtwzYGBgYOBvmwBLN7EtlGYAfwAAAABJRU5ErkJggg==';
icon_cs[1][1*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdElEQVR42u3VWwqAIBBG4f6'+
		'dzdJc2uzMegksKXzwMtE5r4p8ijBy9+1LCTBgwIABAwYcKcCAAQMGXGdm+WntOF8hwSnX5iQBHvIlTnxY8B0PGDBgwIDngt8GR1k'+
		'P/NDRfLlEp9f+L7hlXxjwzAADBgwY8Np2w8bNLSTtNCoAAAAASUVORK5CYII=';
icon_cs[1][1*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeUlEQVR42u3VwQ2AIAxAUbt'+
		'ZB3AQRnIQB+hm6IVEJRAOgDX+f4WUF0KCmNnypQQwYMCAAQMG7CnAgAEDBpynqrG0ds4Xl+C4h3z4ugEe8iQS3i34iQcMGDBgwHP'+
		'BtY/jWg/80K/5dlCn2/4vuGWfG/DMAAMGDBjwux18ns0tIgW66QAAAABJRU5ErkJggg==';
icon_cs[1][1*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdElEQVR42u3VwQnAIAxA0Wa'+
		'zjOZo2SztpdBWFA9qI/5/VeJDBMXMjpUSwIABAwYMGHCkAAMGDBhwnqp6ae2aLyHB7ikfLgnwkCdx48OCv3jAgAEDBjwXXPs4nvX'+
		'AD/2aXwd1uu19wS37woBnBhgwYMCA/+0Ew8bNLZ5CNl8AAAAASUVORK5CYII=';
icon_cs[1][2*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeElEQVR42u3TQQqAMAwFUXO'+
		'zHD0307pwJQkFpf7gzLaFvEJjEbF1ygADBgwYMGDASgEGDBgw4Hvuvs/cG7NMBjyqB5kBfgTOzq6HSIGrhwD+5ZdouXRtwScsSxb'+
		'8BgxwBc6S/BLpINWlawOeuScDXhlgwIABA/62A+GmzS3ethXLAAAAAElFTkSuQmCC';
icon_cs[1][2*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAcklEQVR42u3TQQqAMAwFUXO'+
		'zHD03UzeuJLFQqT84s20hr5BaRGydMsCAAQMGDBiwUoABAwYM+J677yP3zlmmA34iG+BJcNZ1ogQuHwL4jyvR89O1BRckWfAbMMA'+
		'VOEtzJdJJgCfBA8mAVwYYMGDAgL/tAN5QsS3Hn0obAAAAAElFTkSuQmCC';
icon_cs[1][2*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeUlEQVR42u3TQQqAMAwFUXO'+
		'zHq1Hy82qgjtJKFj0B2fWgb5Aau6+VcoAAwYMGDBgwEoBBgwYMOB7rbUxM3e8ZTLgPnJzNwP8CBxCr0WkwNkigH95EiU/XVnwCYu'+
		'SBa+AAc7AUZInESX76cqAZ+ZkwG8GGDBgwIC/bQdips0tH26T/AAAAABJRU5ErkJggg==';
icon_cs[1][2*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAgUlEQVR42u3TwQmAMAyFYbN'+
		'ZB3AQR3IQB8hmVQ+eJKVQ0Rf83zWBfIHE3H3KFAMMGDBgwIABKwUwYMCAAd9TSqk9fccskwHXbWkPmlfAQ+Codi0iBW4tAviXJ5H'+
		'y6dKCT1gUWfATMMAtcBTJkwgHqT5dGnBPnwz4zQAGDBgw4G+zA/+XzS0d0zlPAAAAAElFTkSuQmCC';
icon_cs[1][2*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAe0lEQVR42u3TQQqAQAiF4by'+
		'ZR5ujzc2sFq3CYaChnvS/rYKfoNZ73yrFAAMGDBgwYMBKAQwYMGDA97h7zPQds0wGHNHGg6wBfgTOatciUuDRIoB/eRIln64s+IR'+
		'lkQWvgAEegbNInkQ6SPXpyoBn+mTAbwYwYMCAAX+bHWKmzS1nKtu5AAAAAElFTkSuQmCC';
icon_cs[1][3*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAc0lEQVR42u3TQQrAMAhE0c7'+
		'NPLo3a7PpqkQChdYhf7YKPkGVmYdTBBgwYMCAAQPuFMCAAQMG/ExEnCt9Y5bagEfqQRLgV+BZ7V6kFbhaBPCWJ2H5dHbgWa3lSVS'+
		'LAN7yJCyfzg680tcG/GUAAwYMGPC/uQABl80tBU2T5gAAAABJRU5ErkJggg==';
icon_cs[1][3*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAb0lEQVR42u3TSwqAMAxFUbO'+
		'zLD07s04cST8g6Hv03mkLPYUkqupwKgADBgwYMGDASgEGDBgw4GeZea7cu94KHfCMHIBfgnvdJ0rg4UcA7zgSnktnB+6lOBLDjwD'+
		'ecSQ8l84OvJAM+MsAAwYMGPC/Nb5BsS3x8PePAAAAAElFTkSuQmCC';
icon_cs[1][3*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdUlEQVR42u3TQQrAMAhE0c7'+
		'NPFqO5s3SLrorkUAgVfJnLfgGVO5+VYoAAwYMGDBgwJkCGDBgwIC/MbM+M/fsUhpw67G5SYCXwEPoWyQVOCoC+MiTKPl05cBDaMa'+
		'TiIoAPvIkSj5dOfDMXBrwzgAGDBgw4H9zA4KIzS3tcmqGAAAAAElFTkSuQmCC';
icon_cs[1][3*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAe0lEQVR42u3TwQ2AQAhEUem'+
		'MAizEkizEAuhs9eLJLNnERJnsnyskPBKwiFiUYoABAwYMGDDgSgEMGDBgwM+4exvpu2ZZGXA7tnzQugN+Be7V7kVKgbNFAE95EpJ'+
		'PJwfu1UqeRLYI4ClPQvLp5MAjfWXAXwYwYMCAAf+bEx+IzS1VU+imAAAAAElFTkSuQmCC';
icon_cs[1][3*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdUlEQVR42u3TwQnAQAhE0di'+
		'ZpW1pdmZyySmsLAQSh/1zVfAJahFxKMUAAwYMGDBgwJ0CGDBgwICfcfdc6btmWRtw5qgH2QD8Cjyr3Yu0AleLAN7yJCSfTg48q7U'+
		'8iWoRwFuehOTTyYFX+tqAvwxgwIABA/43J4KIzS0CSt/VAAAAAElFTkSuQmCC';
icon_cs[1][4*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAbklEQVR42u3STQqAIBCA0eZ'+
		'mHt2bVdDGKN30N8H7dqOgTzBqrdOfCmBgYGBgYOBMAQMDAwMfK6XM7byeGaP1FOC17cCIHfhsHRgY+GZwW3pw9yLgi+DeXsovMXo'+
		'IMDDwy+B2Tg9+ImBgYGDgb1sA/ib3LQPIUJEAAAAASUVORK5CYII=';
icon_cs[1][4*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAa0lEQVR42u3SOw6AIBBAQfd'+
		'mHJ2bqY0JfrDxtybzOrZYhoSotQ5/KoCBgYGBgYEzBQwMDAy8r5Qytud5Z5zNc4AXWmzAB3NgYOCbwavSg7s3AV8E98r4JU4fAgw'+
		'M/DK4KT34iYCBgYGBv20Chk3PLe+CwM4AAAAASUVORK5CYII=';
icon_cs[1][4*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAb0lEQVR42u3Suw2AMAxAQbx'+
		'ZRsto2QyQaIL4NPyMdK+zC+siJVprw58KYGBgYGBg4EwBAwMDA28rpYz9PN+Ms30KcB0XW41Ygff2wMDAN4P70oOPAr4KPoRm/BJ'+
		'nDwEGBn4Z3M/pwU8EDAwMDPxtE5b29y0Pk3TFAAAAAElFTkSuQmCC';
icon_cs[1][4*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeElEQVR42u3S2w2AMAiFYdm'+
		'MARzEkRzEAdismviCse2Lt2Pynzcgga9JLSKGP8UAAwYMGDBgwEoBDBgwYMDnuHvJ9bbTen0JcFmmfeE4H8C1PmDAgG8G58iDm4c'+
		'AXwS3ZpJfovcQwIABvwzOtTz4iQAGDBgw4G+zAkaG9y0dD7avAAAAAElFTkSuQmCC';
icon_cs[1][4*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAcklEQVR42u3SSw6AMAhFUdk'+
		'ZS+vS2BmaOMFoO6mfZ3LfDEjgNKlFxPKnGGDAgAEDBgxYKYABAwYM+Bx3z1pvO23UlwBntn2htQP4qg8YMOCbwTXy4O4hwJPg3kz'+
		'yS4weAhgw4JfBtZYHPxHAgAEDBvxtVpb29y2C4cBQAAAAAElFTkSuQmCC';
icon_cs[1][5*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeklEQVR42u3VQQ6AMAgFUbk'+
		'ZR+dmWteGpguqnziztQlvAdEi4uiUAQYMGDBgwICVAgwYMGDAz9z9XHk3ZpkMeDQfZAa4BHzDsmTBFTDAM3CW5Eqkg1SPrg04+1a'+
		'921t/zTuO8Z/gdivR8ujagVfeyYDfDDBgwIABf9sF4abNLSYGVjoAAAAASUVORK5CYII=';
icon_cs[1][5*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdElEQVR42u3VQQ6AMAgFUbk'+
		'ZR+dm6t5Qm0j1E2fWTXgLSC0itk4ZYMCAAQMGDFgpwIABAwZ8zd33mXfnLNMB35ENcBF4QJIFV8AAj8BZmiuRTgL8EJxVvNtLv+Y'+
		'Vx/hPcLuV6Hl07cATyYDfDDBgwIABf9sB3lCxLVLpt90AAAAASUVORK5CYII=';
icon_cs[1][5*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAe0lEQVR42u3VsQ2AMAwFUbx'+
		'ZRsto3ixAjRylcOBb3NWW8gpbMXc/KmWAAQMGDBgwYKUAAwYMGPCz1tpYmbveMhlwH3NzNwOcAr5hUbLgDBjgGThKciWiZI+uDDi'+
		'EJu/21q95xzH+E1xuJUoeXTnwypwM+M0AAwYMGPC3nWKmzS0E9l6yAAAAAElFTkSuQmCC';
icon_cs[1][5*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAg0lEQVR42u3VwQ2AMAiFYdm'+
		'MARzEkRzEAdis6tnQ9EAV4v+uJXnfAVIxs6VSBDBgwIABAwacKYABAwYM+BlVbSNzV5ekAbdj6xetO+AQ8A3zkhYcAQPcA3tJuRJ'+
		'uUdajKwP23qJ3e+rXPOMY/wkutxIlj64ceGQuDfjNAAYMGDDgb3MC/5fNLb8y6t8AAAAASUVORK5CYII=';
icon_cs[1][5*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAfUlEQVR42u3VsQ3AMAhE0bA'+
		'Zo3k0NiNJHWG5wAko/1oj3StAFjM7OkUAAwYMGDBgwJUCGDBgwICfUVVfmbu6pAzYfcyLZABOAd+wKGXBGTDAM3CUkisRFlU9ujb'+
		'g6C17t7d+zTuO8Z/gdivR8ujagVfmyoDfDGDAgAED/jYnYqbNLYkZqNwAAAAASUVORK5CYII=';
icon_cs[1][6*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeUlEQVR42u3TQQqAMAxEUXO'+
		'zHD0307pVUgq2dQJ/1oF5i4lFxFEpBhgwYMCAAQNWCmDAgAEDfsfdz5G71mUy4JZ+kRngKeAblkUWPAMGuAfOIjmJtEj16cqBn5O'+
		'Yve2lT7fiGQGXm0RaBPgjeOROBrwzgAEDBgz431x6k+EtfzKUgQAAAABJRU5ErkJggg==';
icon_cs[1][6*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAc0lEQVR42u3TQQ6AMAgFUbk'+
		'ZR+dm6tqG2kRqf5OZNQlvARYRx04ZYMCAAQMGDFgpwIABAwbc5u7nyNy9y3TAb2QDXATukGTBFTDAPXCW5kmkmwAXgZ+k4tue+nQ'+
		'znhHwfieRbgL8ETyQDPjPAAMGDBjw2i6O670tWxpfNAAAAABJRU5ErkJggg==';
icon_cs[1][6*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeklEQVR42u3TQQrAMAgF0Xo'+
		'zj5ajebM03bYYAjWtwsw6kLf4ipkdlRLAgAEDBgwYcKYAAwYMGPAzVe0r78Zfkgbc+tzcRACHgC+YV1pwBAzwDOyVchJeaY+uHPg'+
		'+iehtbz26HccIuNwkvAC/Ba+8SwP+MsCAAQMG/G8n66ThLbHfc4gAAAAASUVORK5CYII=';
icon_cs[1][6*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAgklEQVR42u3TsQ2AMAxEUbx'+
		'ZBmAQRmIQBvBmAVqQo0hxwJb+1ZbuFWdR1SVTBDBgwIABAwYcKYABAwYM+J1SSu25u7okDLgeW7to3QG7gG+YlbBgDxjgFthKyEm'+
		'YRVGfLh34OQnvbU99uhnPCDjdJMwiwIPgnrsw4C8DGDBgwID/zQl8ROEtn9QurAAAAABJRU5ErkJggg==';
icon_cs[1][6*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAfElEQVR42u3TQQ6AMAhEUbk'+
		'ZR+vRuBnWrYamia1C8mdNMm8xiJkdlSKAAQMGDBgw4EwBDBgwYMDPqKrP3PUuSQN2b+MiaYCXgC9YlLTgFTDAI3CUlJMIi7I+XTn'+
		'wfRKrt7316XY8I+BykwiLAL8Ez9ylAX8ZwIABAwb8b07rpOEtyB1X7gAAAABJRU5ErkJggg==';
icon_cs[1][7*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAbElEQVR42u3PQQqAMAwAQfO'+
		'zPr0/03oQCmIRURph9pZQyDRqrcufCmBgYGBgYOBMAQMDAwOfK6Wsd961W5EG3BofigB+BbzD+vp9WvABu9oDPwH3c3rw6CPAwMD'+
		'AwHPB/Zwe/EXAwMDAwHPbAOzQ4i1TWPn9AAAAAElFTkSuQmCC';
icon_cs[1][7*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAaElEQVR42u3PSwqAMAxAQXO'+
		'zHr03UzdCUfxQlEaYtwyBTKLWOv2pAAYGBgYGBs4UMDAwMPCxUsr8ZG+9FXnAd+QAfgm8JzXztOANdjYH7gI3pQdfPgIMDAwMPBb'+
		'clB78RcDAwMDAY1sAAg3ALcjMbwcAAAAASUVORK5CYII=';
icon_cs[1][7*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAb0lEQVR42u3PSwqAMAxAQXO'+
		'zHq1H6838LISKKCKKEebtEgKdRmtt+FMBDAwMDAwMnClgYGBg4H2llPHK3fxWpAHX8dxcI4AfAS+wDbTbpwWvsKM98B1wP6cHn30'+
		'EGBgYGPhbcD+nB78RMDAwMPC3TZGI4i3pDQcRAAAAAElFTkSuQmCC';
icon_cs[1][7*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdUlEQVR42u3P0QmAMAxFUbN'+
		'ZBnAQR3IQB8hmVT+EgLQUUfqEe/8SCjm1iJj+lAEGDBgwYMCAlQIMGDBgwPfcvfS8O26ZDLhsS/vQvAJ+BXzCcnkvC75gtT3gJ+A'+
		'8y4NbHwEMGDBgwGPBeZYHfxFgwIABAx7bDkpg4i0pOh40AAAAAElFTkSuQmCC';
icon_cs[1][7*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAcElEQVR42u3PQQqAMAwFUXO'+
		'zHK1Hy82iLgqBYhFR+oWZXUIhrxYR258ywIABAwYMGLBSgAEDBgx4zN3zzrvjlsmAM9v8kDXAr4BPWK3uZcEddrUH/ARcZ3nw7CO'+
		'AAQMGDHgtuM7y4C8CDBgwYMBr2wGRiOItrdAIwQAAAABJRU5ErkJggg==';
icon_cs[1][8*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeElEQVR42u3TQQrAIAwF0eZ'+
		'mObo3a+2iECgpgmJ/YGYZAnkLtdbaUSkDDBgwYMCAASsFGDBgwIDfufs5stdvmQy4933IDPAS8A2Lxbks+IFlc8Cz4Jg8OD0EeBG'+
		'43JMo+enKgWPy4PQQ4EnwyJ4MeGeAAQMGDPjfLjA/9S1MyTcCAAAAAElFTkSuQmCC';
icon_cs[1][8*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdUlEQVR42u3TQQqAMAwFUXO'+
		'zHD03UzcFqwQLLfoDM8tQyFukFhFbpQwwYMCAAQMGrBRgwIABA37m7vvIu3OX6YDfyAZ4EfhOusxlwQ2WzQHPgrvkwekmwIvA5U6'+
		'i4qcrB+6SB6ebAE+CB5IBfxlgwIABA/63A+pWyS14ueRCAAAAAElFTkSuQmCC';
icon_cs[1][8*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeklEQVR42u3TwQnAMAhA0bq'+
		'Zo2U0N0vbQ8FSLIGEVuH/owi+QyJmtlVKAAMGDBgwYMCZAgwYMGDAz1S1j+wdtyQNuPV3cxMBvAR8wm5QN08LvmDRHPAs2JceHAV'+
		'4Fbjckyj56cqBfenBUYBnwSN7acBfBhgwYMCA/20HkXD1LRQVSWwAAAAASUVORK5CYII=';
icon_cs[1][8*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAgElEQVR42u3TwQmAMAxAUbN'+
		'ZB3AQR3IQB8hmVQ9CQFIKLZrA/8cQyDu0oqpLpgQwYMCAAQMGHCnAgAEDBvyulFJ79q5bEgZcj619aN0BTwHfMJudhwU/MG8OeBR'+
		'sCw92DwGeBE73JFJ+unRgW3iwewjwILhnLwz4ywADBgwY8L+dFbD1LRqhjQUAAAAASUVORK5CYII=';
icon_cs[1][8*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAe0lEQVR42u3TwQnAMAhA0bp'+
		'ZRstobmbTQ0EolkBCq/D/UQTfIRFVPSolgAEDBgwYMOBMAQYMGDDgZ601m9kbtyQN2Ky/H5IOeAv4gvn8PC34hkVzwKtgX3pweAj'+
		'wJnC5J1Hy05UD+9KDw0OAF8Eze2nAXwYYMGDAgP/tBJFw9S1tw2xPAAAAAElFTkSuQmCC';
icon_cs[1][9*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeUlEQVR42u3T0QqAIAxG4fZ'+
		'me/S9WdlFMIiJYNQvnXOpwj5BLSK2lTLAgAEDBgwYsFKAAQMGDPieu+8j59oskwG3+oPMAD8CPmG5vC4LvmDVOuBZcE4eXA4CPAm'+
		'u9iSfRO8igH/5JJb8dMuBR87JgN8MMGDAgAF/2wGXUuEtUV5r+QAAAABJRU5ErkJggg==';
icon_cs[1][9*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdUlEQVR42u3TSwqAMAxFUbO'+
		'zLD07UycFP0QLFX3Be4ehkFNoLSKmShlgwIABAwYMWCnAgAEDBnzO3eeec+su0wHfkQ3wQ+AjaTOXBTdYNgc8Ct4lD043AR4EZyk'+
		'+icuLAP7jk6j56cqBO5IBvxlgwIABA/62BTnKvS2FydqPAAAAAElFTkSuQmCC';
icon_cs[1][9*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAe0lEQVR42u3TUQqAIAyA4Xa'+
		'zHc2j7WZmD4ERE8Gojf7/cQz8BBUz2zIlgAEDBgwYMOBIAQYMGDDge6paZ/baWRIGXOrYXEQAPwI+YBdoNw8LPmHeHPAquC882Av'+
		'wKtiFRnwSo4sA/uWTSPnp0oFn9sKA3wwwYMCAAX/bDghy4S0NHYLTAAAAAElFTkSuQmCC';
icon_cs[1][9*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAgklEQVR42u3T0QmAMAxFUbN'+
		'ZB3AQR3IQB8hmVT+EgKQUKprgfZ9pIKeQiKpOmSKAAQMGDBgw4EgBDBgwYMD3lFJqT98xS8KA67a0B80r4EfAJ8zG1sOCL5hXBzw'+
		'KtgkPdgcBHgR7byFXovURwL9ciZRHlw7c0xcG/GYAAwYMGPC32QGZA+EtmbdcHQAAAABJRU5ErkJggg==';
icon_cs[1][9*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAfElEQVR42u3TYQqAMAiG4bz'+
		'ZjrajeTOrH4EQjsGilN7vpxN8BiqqulWKAAYMGDBgwIAzBTBgwIAB39Nas5m+Y5akAZv18SDpgB8BnzAfX08LvmBRHfAq2Cc9OBw'+
		'EeBEcvaVcidFHAP9yJUoeXTnwTF8a8JsBDBgwYMDfZgcIcuEtoElkPAAAAABJRU5ErkJggg==';

// 資源モード（２０ｘ２０用） 資源アイコン＝numx5+maxtype、0=平均,1=木,2=石,3=鉄,4=糧
icon_cs[2] = new Array();
icon_cs[2][1*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAY0lEQVR42u3UQQrAIAxE0c7'+
		'NcvTczOrCCtJuJCRd/FkFF8MjYOTuV3UEAgQIECBAgMhEmFnb33qP0hE9q0SqQcx5YEoQ+0ZAgPgF4u13zJxgQu7EU3a4kbCLmb6'+
		'J6IAAAeIrN59NkWIunq91AAAAAElFTkSuQmCC';
icon_cs[2][1*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAW0lEQVR42u3UPQoAIAhA4by'+
		'ZR/dm1VJEP0uENrw3NshHoGJmKToBAQIECBAgQHgiVDXPb3WO+CNGhkQhWjkIsfwICBA/IHbb0brBvLkTfZo34pAb4nUgQIA4VQC'+
		'K6n9iLPGhRQAAAABJRU5ErkJggg==';
icon_cs[2][1*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZElEQVR42u3UsQnAMAxE0dx'+
		'mGs2jaTPHTRwwSWOE5OJfqUI8DiS5+1UdgQABAgQIECAyEWbW19nYo3RE66+jSTWICRiYEsTaCAgQRyC+ruPJDibkT0zQZiNhHzO'+
		'9ieiAAAHiLzeBiZFig1ditAAAAABJRU5ErkJggg==';
icon_cs[2][1*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAa0lEQVR42mM8cOAAw0ADxlF'+
		'HjDpi1BGjjhh1xKgjRh1BT0c4ODj8RxcDmsNId0f835KBMMRnxsA4AsYGOWZAHIEeIqOOGHXEoHAEttwBA+Q4hirlBNwwMkOEaiU'+
		'm3UOC2mDUEaOOGHUELgAAalWRYnBbnpoAAAAASUVORK5CYII=';
icon_cs[2][1*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZklEQVR42u3UMQrAMAiF4Xo'+
		'zj5ajeTObDkkgtEsQ7fC/STI8PoQoZnZVR0CAAAECBAgQmQhV9f2t90g6wr2tEmk1iDE/mBLEvhEQIH6BePsdIyeYkDsxyw43EnY'+
		'x0zcRHRAgQHzlBoGJkWLJBgLoAAAAAElFTkSuQmCC';
icon_cs[2][2*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAY0lEQVR42u3TQQ6AIAxEUed'+
		'mPXpvprhwA+nGmKnRP0tIymMCysytOwIBAgQIECBAOBERsVd7Y55siJF1mORFzGsnyoqomvlfE695E9fN57Qg7hz6vSaWYd2/w97'+
		'E0wEBAkSVA3S9kWKCsbfvAAAAAElFTkSuQmCC';
icon_cs[2][2*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAX0lEQVR42u3TMQ7AIAxDUXK'+
		'zHD03owxMtFmqyqnge0UKDytYRLTqGAgQIECAAAFCiXD3np2NeaZDPDFMjVjTxYi0meOa+M9OzJevKUG8uXTDJm7Tqn+HuomvAwI'+
		'EiCwXUIp/Ymb+9bEAAAAASUVORK5CYII=';
icon_cs[2][2*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZElEQVR42u3TsQ3AIAxE0Xg'+
		'zj8Zo3ozQ0IDcRNE5Cv9aJHg+GYuIqzoGAgQIECBAgFAi3L1nZ+M+kyFa3x3NTIvYAAMlRWTNnNfEZ3ZiTr6mBPHk0f81sab8d8i'+
		'beDsgQIDIcgNLEZFiCgyLIAAAAABJRU5ErkJggg==';
icon_cs[2][2*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAaklEQVR42mM8cOAAw0ADxlF'+
		'HjDpi1BGjjhh1xKgjRh1BT0c4ODj8xyUHNI+Rbo74vyUD0zCfGfR1BLoYyFF0dQSukBl5ITFo0gTM5+hgQBxBjqXDLyQwDBvo3EH'+
		'3kKA2GHXEqCNGHYELAAAqlZFi3saeqgAAAABJRU5ErkJggg==';
icon_cs[2][2*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZklEQVR42u3TQQ6AIAxEUXu'+
		'zHo2j9WZVF24g3RgzNfpnCUl5TMAiYuuOgQABAgQIECCUCHfPau+YZzJE5liH2dAi5rUTJUVUzfyvide8ievmc1oQdw79XhPLsO7'+
		'fIW/i6YAAAaLKDksRkWKG9Ya5AAAAAElFTkSuQmCC';
icon_cs[2][3*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXElEQVR42u3SMQrAMAxD0ep'+
		'mPrpv1jpDlhbToWAX/DUmYB5CcvejOwIBAgQIECBAVCLM7Mz+4p7KEJHnMakWcX9bqFJE1sy8JtjEWzPzmvjtJnbaNvE1IECAyHI'+
		'BpK6RYl9LCAMAAAAASUVORK5CYII=';
icon_cs[2][3*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAVklEQVR42u3SQQoAIAhE0by'+
		'ZR/dm1qJVJC0CC/yzFeQxjJhZex0BAQIECBAgQGQiVNWj2/gneYgdQ7IRazwZETZTrgk2cWymXBP/bmLm2SZuAwIEiCgd4Ht/Yrv'+
		'KAqcAAAAASUVORK5CYII=';
icon_cs[2][3*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAW0lEQVR42u3SwQkAIAxDUbN'+
		'ZR3O0bqZePEnxIFTBn2uhPELk7uV2BAIECBAgQIDIRJhZi27jn9IQta2OKuUiFsBApSKiZv5rgk3smvmviWc3MXNtE6cBAQJElA5'+
		'7ApFiRFWLtwAAAABJRU5ErkJggg==';
icon_cs[2][3*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAYklEQVR42mM8cOAAw0ADxlF'+
		'HjDpi1BGjjhh1xKgjRh1BT0c4ODj8xyUHNI+Rbo74vyUD0zCfGfR1BLoYyFF0dQSukBl5ITGaJgiFzMgLiUGbJmBgwNIEpWDUEaO'+
		'OGHUELgAAWoaRYiCZ5rMAAAAASUVORK5CYII=';
icon_cs[2][3*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXklEQVR42u3SwQkAIQxEUdN'+
		'ZSrO0dBbXgxcleBDign+OCuExjJhZuR0BAQIECBAgQGQiVNWjv++epCHc63pMai5ifuuoVETUzHtNsIldM+818dtNjFzbxGlAgAA'+
		'RpQF7ApFiMvaBuAAAAABJRU5ErkJggg==';
icon_cs[2][4*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXElEQVR42u3QMQoAMQhE0cz'+
		'NPLo326RxWVxSBTTFn0oF5aHcfXRHIECAAAECBIhKhJk9Ua995b4MsTIkvYhvD6INEWlD/I5VI/Ks/BO7z4C4BhF1G+I0IECA2GU'+
		'C6EytYrGFo7AAAAAASUVORK5CYII=';
icon_cs[2][4*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAWUlEQVR42u3QuwkAIAwAUbN'+
		'ZRs9mfkBFFCshsbirTKE+ImaWohMQIECAAAEChCdCVfM41/uyz36I9q0siGUGEYaYhSGO17wRe96buG4GxDeIXhjiNRAgQNwqxFe'+
		'TYj3sYrkAAAAASUVORK5CYII=';
icon_cs[2][4*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXUlEQVR42u3QsQ3AMAgFUf/'+
		'NGM2jsRlxQxQ5chUJUtxVUCA9IXcf3QkECBAgQIAAUYkws8h53WvfyxAzYkzpRjx3EG2IrA2xV454Aao/cfoMiN8gcm5DfA0ECBC'+
		'nLsaQrWJ9VW51AAAAAElFTkSuQmCC';
icon_cs[2][4*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZElEQVR42u3QwQnAMAiF4bi'+
		'ZA3SQjpRBMoCbpb1YQkJOBc3hfycVlA/FzEp2BAQIECBAgAARiVDV7vW7L3MfhujtLnLVDzH2INIQnjTEciwaMc/CP7H7DIhjEF6'+
		'nIf4GBAgQuzysRK1i9wi3TwAAAABJRU5ErkJggg==';
icon_cs[2][4*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAX0lEQVR42u3QQQrAMAhE0cz'+
		'NPFqO5s1sNpaSklVBu/izUkF5KHcf3REIECBAgAABohJhZpH12tfelyEi5pDmjXj2INoQmTbE61g1Yp+Vf+L0GRC/QWTdhvgaECB'+
		'AnHIBxpCtYuyMGqIAAAAASUVORK5CYII=';
icon_cs[2][5*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZklEQVR42u3UQQ6AIAxEUed'+
		'mPXpvprBgI2FjTavkzxKS8igNcvejOgIBAgQIECBAZCLM7FzttXpKQ7TMxaR8RD+0vBNPb75fJ6Zi2TNxX4s8zyv/RHRG/tuJz87'+
		'ESNlMRAMCBIhVLnS9kWLX0mNCAAAAAElFTkSuQmCC';
icon_cs[2][5*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAYklEQVR42u3UMQ6AMAiFYbk'+
		'ZR+dm1qGTwiINWPO/tQl8oQQxs6M7AgIECBAgQICoRKjqGb1d9aQO4TGkA+G0a0G8afrDSTyqVSPuSXzPkjuR3ZF9J/HdnZhp24l'+
		'sQIAAEWUAUIp/YqQ2dZgAAAAASUVORK5CYII=';
icon_cs[2][5*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZ0lEQVR42u3UQQ6AIAxEUed'+
		'mPRpH681QF24kbCxp1fzZksCjTJC7b9URCBAgQIAAASITYWZ9tnbspzRE66OjSfmI89DySTy9+f8mcU96JwZA4HmW/BPRjnx3Eq/'+
		'txJWyTkQDAgSIWXZLEZFijFARfgAAAABJRU5ErkJggg==';
icon_cs[2][5*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAa0lEQVR42mM8cOAAw0ADxlF'+
		'HjDpi1BGjjhh1xKgjRh1BT0c4ODj8xyUHNI+Rbo74vyUD0zCfGfR3BMjSAQ8Jcn0+/EICwzB6pwl0MUqihyrlBKVpZOiGxKBNEzA'+
		'wYGmCUjDqiFFHjDoCFwAAKpWRYmXSg6cAAAAASUVORK5CYII=';
icon_cs[2][5*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAaUlEQVR42u3UwQ3AIAiF4bI'+
		'Zozkam9F66KXGSzFQm5+jJviJL4qZHdUlIECAAAECBIhMhKr6bO/qJ2kI9zY2k5aP6IeWT+Ltzf83iaFZdiaea5HnWfJPRDOy7yQ'+
		'+m4m7yjIRLRAgQMzqBEsRkWIkLNQMAAAAAElFTkSuQmCC';
icon_cs[2][6*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAYklEQVR42u3SQQ7AIAhE0c7'+
		'NODo3s3ZN2KiB2PzZmoxPRO7+dEcgQIAAAQIEiEqEmY3sbPapDDETy6R6xHdp+yRWX/6/SYSy7p3Y+Z4jO7G7I/dPIpRVI7KzMsT'+
		'pgAABIssLxLaeYonH1EMAAAAASUVORK5CYII=';
icon_cs[2][6*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXUlEQVR42u3SQQoAIAhE0by'+
		'ZR/dm1b7cZCjIn22gDxsxs1EdAQECBAgQIEBkIlR1em97nuQhbgypQFzWlSBelja8xDGtuhOB7/nSiWhHGlzimJaNcJKG+B0QIEB'+
		'4WbCshmKHCHCHAAAAAElFTkSuQmCC';
icon_cs[2][6*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZElEQVR42u3SsQ3AIAxE0dx'+
		'mHo3RvBlJWpAbQLYS/WstweOw3P2qjkCAAAECBAgQmQgz69HsOU9piNZnR5PyEe+l5U2svvx/TYwp34md7zmyE7s78v0mxqQjolk'+
		'a4nRAgAAR5QaVFp5ijCfncwAAAABJRU5ErkJggg==';
icon_cs[2][6*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAaklEQVR42u3SwQ2AMAiFYdm'+
		'MATqIIzmIA7BZW8+Ei20gmp8ryetXQMzsqC4BAQIECBAgQGQiVLVHvZknaYh+nz6sXfmI59HySbz9+f8m4cKqb2JlPVtuYvVGvj8'+
		'JF5aNiHppiN0FAgSIqAZv9p5ioP+/PgAAAABJRU5ErkJggg==';
icon_cs[2][6*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZElEQVR42u3SwQ3AIAiF4bI'+
		'Zozkam9F6JlzUQGx+riTPT0DM7OkuAQECBAgQIEBUIlTVs96XJ2UI9xHDZNQj5qPtk1j9+f8mEcK6b2JnPUduYvdG7p9ECKtGZL0'+
		'yxOkCAQJEVi+VFp5iLKeXWwAAAABJRU5ErkJggg==';
icon_cs[2][7*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXUlEQVR42u3QOwpAMQhE0cz'+
		'OXLo7y6eweSGkCOgr7lSKoAfl7q06AgECBAgQIEBkIsysn2Zzn9IQM/syKR+xjkaiL0Gso98+DRF1GeL2GRAgfoOIugzxGhAgQJw'+
		'yAPJWn2IjBc54AAAAAElFTkSuQmCC';
icon_cs[2][7*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAWUlEQVR42u3QQQrAMAgF0Xo'+
		'zj+7NTAtZhBDpouDvYmYXhPjQIuJSZyBAgAABAgSIToS7ZzW7/7M+xIlhCsS6LoWIZ+n+7kPMZIi3y4AA8R/ETIb4GggQIKoGHjG'+
		'JYo5H38oAAAAASUVORK5CYII=';
icon_cs[2][7*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAYUlEQVR42u3QQQrAMAhE0c7'+
		'NPJpH82ZpA0kWLaGLgnbxZ6UI+lARcVRHIECAAAECBIhMhJm13ezapzSEt6fDpXxEP7oAoy9B9KP3Pg0x6zLE22dAgPgNYtZliK8'+
		'BAQLELifUkp9ig73MeAAAAABJRU5ErkJggg==';
icon_cs[2][7*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZUlEQVR42u3QwQ3AIAiFYdm'+
		'MATqII3UQB2AzqwcuNaaHJuDhfycICXxBzKxkR0CAAAECBAgQkQhV7bvZ2CdhiN7quuy64xHzqMf7FMQ8+u7DEF6nIb4+AwLEMQi'+
		'v0xB/AwIEiF0evV6fYsSFq0UAAAAASUVORK5CYII=';
icon_cs[2][7*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAX0lEQVR42u3QsQ1AIQhF0c9'+
		'mjOZobMbXgkZjLEzA4r4KQgIniJl91REQIECAAAECRCZCVX036/skDeHe1mXS8hHjaCT6EsQ4OvdpiKjLEKfPgADxDCLqMsRtQIA'+
		'AscsP1JKfYis6xqsAAAAASUVORK5CYII=';
icon_cs[2][8*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXElEQVR42u3SSwoAIAhF0d7'+
		'OXLo76zNoUjgLC7pvJoIeRLl7uR2BAAECBAgQIDIRZlajXp+nNETPPkzKR4ylM7O+ghhL1/q/S2zDvr0EP/HMT0S9NMTpgAABIko'+
		'DSkSrYnFTAAcAAAAASUVORK5CYII=';
icon_cs[2][8*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAV0lEQVR42u3SSwoAIAhF0dy'+
		'ZS3dnfWZROQsNum8mgh5EMbOSHQEBAgQIECBARCJUtXq9Pk/iECeGZCDmdTURMZau9YeX2KZ9ewl+4pmfcBKGuB0QIEB4aS2vjWJ'+
		'vZJCyAAAAAElFTkSuQmCC';
icon_cs[2][8*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAYElEQVR42u3SywkAMQhF0bz'+
		'OLC2l2Vk+MMwig7vBBHLfTgQ9iHL3sjsCAQIECBAgQGQizKxFvTFPaYjavo4q5SPm0hfw1FsQc+la33eJNfdegp845ieiXhri74A'+
		'AASJKBxSwq2IYDnFEAAAAAElFTkSuQmCC';
icon_cs[2][8*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZElEQVR42mM8cOAAw0ADxlF'+
		'HjDpi1BGjjhh1xKgjRh1BT0c4ODj8xyUHNI+Rbo74vyUD0zCfGfR3BMhSGIDxB8QRIEvR+SMvJDAMG7EhMZomBk2awCVHN0dQG4w'+
		'6YtQRo47ABQDq3atiDvm6UQAAAABJRU5ErkJggg==';
icon_cs[2][8*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXklEQVR42u3SwQkAIAiF4dz'+
		'M0RrNzawOXQpvYUH/u4mgH6KYWbkdAQECBAgQIEBkIlTVo16fJ2kI97oPk5qPGEtnZn0FMZau9X+X2IZ9ewl+4pmfiHppiNMBAQJ'+
		'ElAYUsKtiWowuVgAAAABJRU5ErkJggg==';
icon_cs[2][9*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAY0lEQVR42u3SMQoAMQhE0Z2'+
		'beXRvtpsUNglWCxrIn84E9CHK3Z/uCAQIECBAgABRiTCzN/sb/VSGGNmbSfWIOTQSdQtiDl3r+zaxNatGrG/lm8g2c98mjr2JSNt'+
		'N/A0IECCyfPo8nmL6cykyAAAAAElFTkSuQmCC';
icon_cs[2][9*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAYElEQVR42u3SQQpAIQhF0dy'+
		'ZS3dn1YcGUTkK9EP3zSLQw0Mxs5IdAQECBAgQIEBEIlS1en99nsQhTgzJQMzraiLiW7q+H2ximxaNWBPdhNvMc0389yZG0m7iNiB'+
		'AgPDSAM1+hmI8ahF6AAAAAElFTkSuQmCC';
icon_cs[2][9*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZ0lEQVR42u3SQQrAIAxE0c7'+
		'NcjSPlpvZCm0XSlaFpOCfXRDMY4jc/aiOQIAAAQIECBCZCDPr0dv1n9IQra+OJuUjxtIXcM8liLF0nvdrYk46YgFkNxE1s18Tv72'+
		'JJ2U38TUgQICIcgLKnJ5is58jWwAAAABJRU5ErkJggg==';
icon_cs[2][9*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAbElEQVR42mM8cOAAw0ADxlF'+
		'HjDpi1BGjjhh1xKgjRh1BT0c4ODj8xyUHNI+Rbo74vyUD0zCfGfR3BMhSGIDxB8QRIEvR+SMvJDAMo7cj0MXoHhK4QmbkhcSgTRM'+
		'wMGBpglIw6ohRR4w6AhcAAKV8nmLgq80LAAAAAElFTkSuQmCC';
icon_cs[2][9*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZklEQVR42u3SsQkAMQiF4XM'+
		'zR8tobuZdCpsEqwMN5H+dCeiHKGb2dEdAgAABAgQIEJUIVfXs7+snZQj3sTeTUY+YQyNRtyDm0LW+bxNbs2rE+la+iWwz923i2Ju'+
		'ItN3E34AAASLLC8qcnmLjUKubAAAAAElFTkSuQmCC';

//------------------------//
// アイコン定義（領土枠） //
//------------------------//
var icon_2 = new Array();

// 赤
icon_2[1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADHElEQVR42u3Yy0sqURwH8J8LmUF'+
		'62M1eZlEUlQUS9C+0CSJoJ0URtGwXtQgqWkRFi3YtWgQ9KGpTBEGb9sGFGz2wh1EQiDY42ROxbtdzzwxMjGUzjo6mp/MFQRd65jP'+
		'n55zzOwaEEPykGCiY8FAw6aFg0kPBpIeCSQ8Fkx4KJj0UTHoomPRQMOmhYNJDwaSHgklPysAupxMxOTnAZmWJn0PPzxB8eADH+rq'+
		'BKLBvYAAx2dkQNhiAu7qChoUFEeju7UW/KivByLIQur8Hz/ExNG1tJR2fNDA/MoKY4mJ4ub2NgH6MBGfy8uDl5gauj46SCtcdzI+'+
		'NIaagQBWqCPf74frwEJo2N3WH6wbmBgeRqaJCM1QRfncHnv19aNzY0A2eMJgfGkKMzZYw9Cu4CVdLkOPA63Lp8oCLG8yPjyNxFnS'+
		'GfgWXZpw7OYGG1dW4x9IMThVUDe4/Pwf78rLmsWMGByYmkDE3N+VQJfjfpyfgcKlrgauCA1NTyIjX0e+GqsH5iwuomZ9XvbYvwek'+
		'KVYWfnUGNwrV+Anv6+1FuVVXaQ5XgD5eXYJuZiXrdEeCDlhZU1doqvs/u68sI6Mc8zc6KoMvtbWjc2flkiAD/aW9HNc3NGQ0Ozs2'+
		'hf29v4N7djbpTi17Swo4Jb+j9uDTsi4sZAXf19KCi0lIwlZdDAC9ZMZW0PIHhYcSWlYm7nHSGy6GevT3FB5YiWIgw2ya89rK460k'+
		'3uARl8vPBhzssNWhMYClu/OOWujqQlqnvhL9DzWZ4CQTAMjmp6To0bS1Pu7pQkd0OLL6rqZ5x+YwKfbNlejquceNqHlwdHajE4QA'+
		'Wr3nJhsv/o8JYltHRhMZJqD10dXejkvr6pMDl0BBuFnxCl7S09H3toTxHnZ3Iiktd6l0TgUfMqN8P3tNTcKyspM8BwCd4bS2YLBY'+
		'I8rwm+DsUv4TvevFaqic0KWApB04nsuFSjwX+/jCyWsUVwINLt3FtLXMO8eT53daGrNXVYCoshPDrawRcgkI4DCF8U7jHR2hKwRl'+
		'1yg/izTabCDcyDJkH8ekWCiY9FEx6KJj0/AeTN4OnIxo69wAAAABJRU5ErkJggg==';
// 紫
icon_2[2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAC9klEQVR42u3YwWvTUBwH8F8PkS61'+
		'7dZ1ltKOrTKKMkTF/QHC8CAexIOCpY7pUHcWb6IH0YMePMpkoGPWCRMPHmSniSKCh4llo9uoY7WYWSOx2nVmSh3PJOONtmuTpk1r'+
		'+nzfU3p4ffnwey95+VkQQvA/xULBhIeCSQ8Fkx4KJj0UTHoomPRQMOmhYNJDwaSHgkkPBZMeCiY9FEx6GgYeD8VQi5MBtoVVfovr'+
		'ImQzIpybOGAhCjx1OYVaHIxyzS3zEB7rVYCTF+PI0+mCHVYG1iR4Yv4zXHh6qO74uoFfXBWQwydhvuYKoMXBcJubgdWVHCzNJ+sK'+
		'Nxz88rqAdu7ShqrB5bEf5pJw/onxcMPA8tLt6GF1Q9XgPwWp4rMcDE0at89rBk9fEZCzU39FK4U7PSz8SImwvMgZ8oCrGvzqhoDw'+
		'8jMSWg6OK56c52Fgovq5dIMbBdWEL0rwiP65Kwa/viUo79FGQ9Xg65kcJOb0wTXBZoFqwVPLaTh1L6h5b2XBZoVqwbmFNJweKw/f'+
		'Bn5+iUOeoN30UDU4H8/CsTv+kvddAB45GkV9xwPKdd+wsymgxZkZySigmWcJGJ7a/horAI+efIcO9vc0NTg6KqI/Gzl4P71U8qRW'+
		'ckm7u+zKfvi0xMOZ8eZY0pHBGPL6PNDezcKKtI8rWtL5kU9Q8mD5lGNmeD504Q2n+sBSBcuRq21rtUKr13xwDLW1M5CY5TWhFYFx'+
		'Hg/GkX+vC/Br6l/CMZRtY0D8noP+m25d96HraDkejqHAPg/YXY2veH5Fs19ycOS2PmhV4C14SILvbww8f4/Kcx2+Vh20JjDOw4EY'+
		'6u6tDzwfmk2L8DFmzH8b0gB4EI6i3Xv8W9+utcDzoRl+8zv4bMREDYBieCDoB4ebhVVBHxxD23ybYxNxY6F1AePcD21WvBI4huKu'+
		'iVGdjYaCce6eeIu6AhLcY4WN31AAx1A5WeEXfFvjYehRE7dpi4Mb8R1elwK32hgyG/FmCwWTHgomPRRMev4CvwB/p45NdckAAAAA'+
		'SUVORK5CYII=';
// 桃
icon_2[3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAC0ElEQVR42u3Yv4vTYBgH8KfDCzFS'+
		'q7FSjgbO01KVIhT6Jzg5iINbOeQWF0dxEx1EERwcXW455DgdFAcHJ0fhloMql7uzlDsK4WogVOphOMjw+iS9hKY/kqZNavr6fqcU'+
		'mjzvh+fNm+RNUUrhf0qKgxkPB7MeDmY9HMx6OJj1cDDr4WDWw8Gsh4NZDwezHg5mPRzMejiY9cwMrFQVStIExNOi/dv4Y4DRMaD8'+
		'rpxiCtx62KLkDLGPtX0NSmslG1i/V6fSogREIDb8cPsQKh8rseNjA+uPdUoWCJi66YH2x4VL+N+WCc3tZqzwyMH6U4Rmg6G+cDy3'+
		'+Q3hH6KHRwa2pq54SQwN9YW3TVBrKpTfR3efTw3WH2FH8+E7Oi5czIlgtAxQd9RIFriJwfozhErRQ0fBnY5rO1hrY/JaocGzggbC'+
		'97D2evjaY4P1FwjNzB7qC+/gWJRw8EBwUqBB8PZ+G4qrxcCxjQQnFRoI/4HwtdHwAbD6QKXpQjrxUD/4UeMI5Ffy0HF7wLWbNbp0'+
		'a8k+ztzPzAW0P53XHRt08OkAyp8HH2Me8NadLVq4UZhrsLFqUNM0ofGlMfRNbfiUXkx3V8AGTuk38zGllRWF5vI5EC+K0N5tjzel'+
		'e2O9QVknW285SYb3QtWvqu+C5Qu2YnVbOCuAuJA8uAMl5wlo37VA6FhgJ/UVXAGv4AroPKb+IdyFnsOx/DIh+zwbahyhXi2VZSxW'+
		'wumTnX3Heztq/kToy3DQicBu8SoWvz4beO89atXKPpkMOhXYHcxdHMy1eOAeqI7X3o3m2pFsANSWa1S+KrvfrtPAPVANv4P38Dt4'+
		'PUEbAAPwotztuB4O7kLz3XPVerTQWMAuvHrS8THg7mJ0smtid3Qjvq3bWLdpN29vUvmyDMIFAcAED9yBWjnWj0H7rUHl7Rxv0/bH'+
		'2YiX8pINJ6cImxvxSQsHsx4OZj0czHr+AkmHfqeuNr+eAAAAAElFTkSuQmCC';
// 橙
icon_2[4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADCklEQVR42u3YS2gTQRgH8K+Hhbhp'+
		'mppEtyGptjSEShADBY9ePIgn8SBCCVq86E0UFTQ04KOKFRRvilBEasFHD55E0IsgiCCUhlSNaSVla41sHyHpqsQyzi5myaZJNpvs'+
		'xmSc/2lz2Mz8Mo/MfG0IIfif0kbBhIeCSQ8Fkx4KJj0UTHoomPRQMOmhYNJDwaSHgkkPBZMeCiY9FEx6GgaOXRtEjNUObPsm+bOY'+
		'/QHiWhqC5yfaiAIvjp3B0A75OTU/B4Gz92Vg/PZx5PB0A8NYQMyk4evnGRi4OGk63jSwMDGMGKcHcqvfVdDiKHCbC3JLC5D8ZC7c'+
		'cLDw6BJiOrdqQivC8bvJeBQGhp8YDjcMLE1d1uPTDa0IzwjAz0xDMPLYMHjdYGE8jJgt3XVDy8HZTg7EpUXg5z4assHVDBaeXkH5'+
		'6WcktBw8P+IpvLkF6oDrBjcKqgnHIx44N6677arBwuR1xLTbGw6tCM+mITUb1QXXBDcLVAu+zM+B/+Rdzb6VBTcrVBM+/wH8p8r3'+
		'dQOYHzuNbB5/00MrwTMLcfAeu1my3yrwVHg/6t1zQH627zvREtDipF/ckUFfXj+D4MjzDQYV+P3lQ8i3e29Lg8WX91BufR0S716V'+
		'PKmVntJd2/HWj3fAZALvgA9aAh67MYQ4twfYrh55HVc1pQsjnaCkl6VTTjPDC6F89E3FDasiWIo02hZrJ7BOd9PB81Cmw4n/i6c1'+
		'oVWB84nfGkKObTtA+Zv6h3AFatuMl90KuEIjuvqh62gZGw0hrm8nsHZHw0e8cERzK9/AdXS0pnZrujxI5RrOv6sh8MI1KrXlOhyp'+
		'q526roex0SN4xAOmwFXQ9DJepzFDvtuQAsDU1RDy+vuVu2s9cBV0NQV8HN+DL+i/FZkKVsH7/MA6XCAuC7rgCpTzyO/ys3FDoaaA'+
		'FfjIIPL6+quCK5vR36oJn8AjGjavdGtqmfZt5CDy9vSCxc4B/P6lguehUn6m8Y+ymoWB8MPWLdMWJ1+Id3BuGc5YrGQW4pstFEx6'+
		'KJj0UDDp+QNsoH+nzzrb+wAAAABJRU5ErkJggg==';
// 黄
icon_2[5] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAC0ElEQVR42u3Yv2sTYRgH8DfDwXkS'+
		'o+fJURKo1RCVIBT6Jzg5iINbKdLFxVHcRAdRBAdHly4iog6KQ4dOjkKXwileW4/QUjgaD14isRgKN7w+7zXn5dLeXe5Xenl9vxBI'+
		'IMn7fvK875v3fUuEEPQ/pcTBjIeDWQ8Hsx4OZj0czHo4mPVwMOvhYNbDwayHg1kPB7MeDmY9HMx6xgbW9XkiCGUkSSed173eH3h0'+
		'0ezs+xJT4Hb7PkBPOc8taws1m68coGHcIbI8jQRBdOC7u9/R3Nyn3PG5gTF+CNApZNvYBx2OB5fhvW20s5MvPHMwxo8BqkRCw+EY'+
		'4F8B/jFzeGZgOnQl6UJsaDi8g0xTg3n+ITN4ajDGD6Ci1dTQILgkqTDH2wBfz2SBSwzG+Alxh1+W0CC4W3HLWoe23iZuKzZ4XNBo'+
		'+Ca0/SZ22yODMX4G0MrYoeHwLvRFjwWPBBcFGgXvdLZQo7EU2bdAcFGh0fAfAA/u6yGwad4j5XK98NAw+N5eC9VqL47stw+sadfJ'+
		'zMwN53mlcncioMPpdl86oO3tZfgbWzlk8IHX1m6Rev3aRIN7vSVi2zZqtT4fuVMLGNLT/RWwBUP69UTAdX2RqGoVNirnYR5vjDak'+
		'B0N3UPTDdJdTZPgg1DS/hC5YoWAaWm1RPA1fNlU4uAsVhLPQr2+R0JHAbgxjEVbAS8j7mzo+uAc9A335hRTlaax+xNpa6voCNNaE'+
		'iitjr/hgRW37J0CfJ2o30eGBXteo6tWxwAfnKG1LUR6laifV8VDXb0NnruQC90PpNNrI5LszuQDQtAVSq13+d3ZNA/dDLVg4N2ED'+
		'Ef9UlCvYD2/0Kx5vcfOgVeezpmlkCs0F7MHn+xWPhnuL0cGtyUFFkx/wjwXsZnX1JsAvIlE8B69sH9yF0uzv0x/lN2wF303uNe1w'+
		'3It4Wa46cEE4weZFfNHCwayHg1kPB7Oev0iHfqc0GjUZAAAAAElFTkSuQmCC';
// 緑
icon_2[6] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADHUlEQVR42u3YzUsiYRzA8Z8HmUEy'+
		'c9UytTCKSgMJ+he6BBF0k6IIOnaLOgQVHaKWDt06dAh6oahLEQRdugcLG2WMZWEQSDU4mb0g2rY9mwMTY6Xjy4zps8/Xix70mQ/P'+
		'ODPPo0IIwf+UioAxj4Bxj4Bxj4Bxj4Bxj4Bxj4Bxj4Bxj4Bxj4Bxj4Bxj4Bxj4BxL29gN+NGpVQplNAl/Oen6BPcR+5hw7Whwgo8'+
		'dD2EtJQWVK8quGAvYLFpkQf2n/Wjmh81QKtpCEfDcBw4hu2WbcXxioHHuDFkpsxwG7tNgH5MgOspPdzEbsBz6VEULjt4gptAJsok'+
		'CU0FD8aCcHR5BFstW7LDZQMPs8PIrrFnDE0Fv4vdwUHgADabN2WD5wwe4UaQjbLlDE0GN2lMwEZYYK4YWS5wWYMnuUkUnwW5ocng'+
		'wox7WS+sNa1lPVbG4HxBpeC+oA9WHCsZj502eCo0hXRqXd6hqeCPfx6BYZmM4JLgn6GfSKvWfjtUCn7OncNC/YLksSUFFypUCn7K'+
		'ncJiffJj/QQeDAyiWl1twUNTwf33fpi1zX553AngtsM21F7bzr8f0A4UBfRjc49zPGjHvwO7zbufDAngzt+dqLW+tajB85F59PL3'+
		'BfbO9r58UvvylLbr7BCOhcEf9MOSY6ko4H1MH7JWWKFaUw2+kC+9U1rcaGgUVdFV/FNOIcPF0P3AfsoLVkpwvPhs6zQ6MNPmgoML'+
		'UANlAM+1RxKaFvj9x8/6UKOxEYTb1HfCBWgZVQahWAimjdMZHUdGj5Y9Jz3IUeEAA23I+4yLZzS+bp4xzmQ1blaLhy6mC7kqXaCn'+
		'9YrDxf/R+FjjxvGcxslpedjL9CJnpVMRuBh6F31bJV17Yblp+fuWh+K6Pd3IYXG8r11zgYuhwUgQTq5OYNW1WjgbAB/hDZYGMGqM'+
		'wEW4jOAC1Kqx8t/1XflkhSoCFnIfupHT5kwLLkAtlIW/A3gDXlhvXi+eTTxxHb86UJ2lDso15fD8+pwAF6Cvby8uysED+wAbLcrv'+
		'Ued9I95WZuPhlJrCcyO+0CJg3CNg3CNg3PsHkzeDpwDP1hMAAAAASUVORK5CYII=';
// 水
icon_2[7] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAACw0lEQVR42u3YvWuTQRwH8MtQiJU0'+
		'Gh8JJYG2GqIShEL/BCcH6dCtFHFxcRQ30UEUwcHRpUuQUh0Uhw6dHIUuhViatobQUgiNgYdILIZChvN74bnwJKbPW54nefLzvhBI'+
		'SHJ3n9xrLsI5Z/9TIgpMPApMPQpMPQpMPQpMPQpMPQpMPQpMPQpMPQpMPQpMPQpMPQpMPUMDLxeLPDYxwS5OTrZf/2k2WQOPj/Pz'+
		'EVLgJ9UqnwJU5LBWY/lcrg18WCrxmUSCRfGegO+enLAvCwuB4wMDP9N1Pg2M3mp1QXsj4Ql8torP7h4fBwr3HfwCUM0B1Aouvvsd'+
		'8M8BwH0Di6F7DfPTLdQKXkdZhUqFffJxng8MfooeTXnoUafwJH7EKub4HuB+LHCewS8BTQQAPQ8ue3wPda0PUJdr8LCgdvAD1L3m'+
		'oW7H4NeAxkcAtYI30JaiS7gtOCxQO/hhvc5Ws1nbtp0LDivUDv4D8LwF/B/w40qFZ2Kx0EOt4OXTU/Y2ne7b7i7w3UKB35ubaz9/'+
		'FI+PBbQ37xqNNmjj6Iht9tnGusBL29v8TiYz1uDVZpO3MDq/lst9T2p9h/QMhrSYD2UM6fdjMqQf4N9YKplkszio7GMeOxrS5ogT'+
		'1Kxxygkz3Az9htNY3malttyWRG9fikbZdAjhEnoFi9SOWFwdbEm24E7hWAFvYAWU29Qo4RJ6GW35hba80jRX7XB1tFxBZTlUpo2g'+
		'x809+hPQNy6hnsAy4rrm9pDg5jkq6nruEToQWOY+GnMrILgZqqPsfZ/K9uUCYAUHlpvpdOe/6yBwM7SGsg6w8q6F6QKgF54FXDN6'+
		'xQ1cQlPGd0s+QwMByywbPe4E3oEaO4Do0fUAr24DvaZd3Nri1wG/ir28hddmuISK6Gdn7Dfe+zDO17S9kRfxKeznAn7BuI8mdxEf'+
		'tigw9Sgw9Sgw9fwFSod+p8kgrB8AAAAASUVORK5CYII=';
// 青
icon_2[8] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADGElEQVR42u3YzUsiYRwH8J+HGJFM'+
		'27R11cIwKluIhf0XugQRdJOiCDp2izoEFR2iokO3Dh2CXijyUgRBl+7BwkYvaGkYBFINTloZom3rszPGs6tWjqPjS88+35Mexuf5'+
		'zPP4vPwUCCH4n6KgYMJDwaSHgkkPBZMeCiY9FEx6KJj0UDDpoWDSQ8Gkh4JJDwWTHgomPQUD2+1OVFHBQHm5Mv798TEC9/dhcDha'+
		'FESBh4aukVrNgEIRg4sLFpaWvsaB/f0eVFf3CZTKMri7i8DJiQ+2t7/nHZ838NgYhwwGBm5vo0nQ1GB4ZSUDNzdROD6+zCtcdvDE'+
		'BIf0enFoOrjfH4Wjo0vY2pIfLht4eJhFFotKMjQdPBiMwsGBDzY3v8kGzxk8MsIhs1n6iGYK1+tVwLJhcDqvZFngsgZPTnJIGAW5'+
		'oe/B8Yi7XCysr2fflmRwoaBicLfbD6urNsltZwyemgogjaas4NB08FDoFz/VWUlwUfDMTIDfR4sPFYOfn3OwuNgg2rd3waUKFYOf'+
		'nXF8X9+HvwIPDvqQ1aopeWg6uNd7D3Nz5jf7nQRuaztE7e3W+OeBAfWHgKZmfj4UB+3seGF39/X+nQTu7PyJWlsbPjR4YSGMnp9/'+
		'w96e582T2ptT2mLR8Af6KD81/LC8LH3pL0b6+pzIZPoMtbUqfssKZDalEzM6GkA1Ncr4KaeU4YnQ/X1f2gUrLViIMNoajQoMhtKD'+
		'Y2hVFcPfsK5FoRmB//24BzU16QBvU8WEY6hWy0AgEIXpaZ2kfkg6Wvb0nCKbTXirhR/xxBEV7s2zs9KgWYFxurqcqKXlC7/n5R+e'+
		'+B8V2hofzw6aExint9eJmpvzA0+EBoMR/pZ0DSsruR+CZCkAdHcf81Pd+Pfumgs8Eer3h+H09ArW1uQr9Mla4hHgjY1G0OlUwHHS'+
		'4BhqMr0863bLC80LGMduP+SnujkjOIYajS93bJfLBxsb8pV0CgLG6ej4gerrjVBdrYKnp1gSHENjMeBfSgQeHlhwOD5wmTY1uBBv'+
		'NmvjcIYpI7MQX2qhYNJDwaSHgknPH5M3g6dZBhoEAAAAAElFTkSuQmCC';
// 灰
icon_2[9] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMATgBOAE5iBS3kAAAC0UlEQVR42u3YzYtxURwH8GMzFsbL'+
		'mExmZDGG8j/YzF9gJWU1pjRS9jJNapDYK5mmhJpJ+SNsZm8hiWgaa3kpK+k8z+/Uma4ZXJd7PZznfDdYcM7H79zzpnK73eh/ioqD'+
		'GQ8Hsx4OZj0czHo4mPVwMOvhYNbDwayHg1kPB7MeDmY9HMx6OJj17A3s9/vx6ekp0mg05PN0OkWTyQSVSiUVU+BoNIop8uvrC728'+
		'vBBgKBTCVqsVqdVqAm+1WqhSqSiOVwz8/PyMz8/P0Wg0WoD+DIXrdDo0GAxQs9lUFC47OJFI4LOzM1HoOvhwOCTw9/d32eGygR8f'+
		'H/HV1ZVk6Do4DPVGo4He3t5kg+8MjsVi+OLiYmfoKjiMFhjq7XZblglua3AqlcJQBbmhq+C04p1OBxUKha3bkgzeF1QM3uv10Ovr'+
		'q+S2Nwan02myju4bug4OazlUXApcFJzJZMg6+q+hYvDPz0+Uy+VE+7YSfKhQMTgM9Xw+v7Kvv8CRSIT8wKFD18H7/T4UbGm/F8Ae'+
		'jwff3t6S9+Fw+CigP5PNZjG81mo1VK1WfxkWwD6fD7tcrqMG/32O8Xw+Rx8fH0t3akuHtMViIVP/MQ3ph4cHfHl5icxmM5nANhrS'+
		'wsDmH3ZQsMs5ZLgQWq/X105Ya8EQqLZWq0Vw6jk0OIUaDAZytBSDbgSmCQaD2GazoUNYpigUZuPxeIzi8bikfkjaWgYCAWy325Fe'+
		'r997xYUVhbaTyeRW7W51eLi/v8dOp/P70K4kXPiMQltPT087tbPT8RAq7nA4FIELofSUtM1hQVYwDVQc4PTsugtcCIWbj12Pg4qA'+
		'hfCbmxsCh85KgVMoLIXw3W63KytUETDN3d3dd8XF4BRqMpnICgAVLRaLx3OJJ4zX68XX19fIaDSi2Wy2AKdQjDGBwh9TLpeP95r2'+
		'Z+hFPDybAD85OWHzIv7QwsGsh4NZDweznj82FQczpHgBCQAAAABJRU5ErkJggg==';
// 白
icon_2[10] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAAAAAAP9DpOgcAAABjklEQVR42u3YwVKEMAwG4AQEWQ+i'+
		'XPD9n04OurIXkF2I68WxslAoLZSY/wbDTPsNkLZBAIL/FBQw8wiYewTMPQLmHgFzj4C5R8DcI2DuETD3CJh7BMw9AuYeAXPPamCq'+
		'aoIkUW9WFeDDAVmBidQBEAFv3YfjETB7do53Bh6C6p5zDbcOngrVwssS8Cm1DrcGNoVq4acTYPpoDb4YbAuqhVsqcMZgV1AtvGkA'+
		'72PjsWaD14Jq4W0LeBfOHnsyeCuobbgW7AtUC584t0Gwr9Cl8B54L1AdfGjeCpheC4I83xV0EF4UgC95z6CCP0qCNOUBHtipjX/S'+
		'1wsMcBdwo096j/C5NWd0WepVQI/gpsV10sbDJ/jSVWTW1pIuLUEYbgK3tVwaHR7osyGI41XgtvcFi46H1HYEQeAE3vuNug4wDLY7'+
		'HiqTa84EUWQF3oOez4Bx5E8DwBbcNdQJ+Gfyf1uyI/AetK4BD8l+mngK5u2dIMtuwl21cDYFK/jfb/2q/S63LBvxvkXA3CNg7hEw'+
		'93wB6xoXENO1jwwAAAAASUVORK5CYII=';

//--------------------------//
// アイコン定義（強調表示） //
//--------------------------//
var icon_3 = new Array();

// 強調１
// 20x20用
icon_3[0*3+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAAACAAACPkxwRAAAAdklEQVR42u3TSw6AMAgEUDhZuZl6'+
		'MzgZ/kLCwqiLisYMmyZddF4mlGmk14eBAAIIIIAAAgggvohQUW+tkZmRqHApIsK3h5do9/3+CtMV4YM7H0StGJ64BhFNRAtxljaR'+
		'28iIsxYeQeSlvLuc//2iQAABBBC9ZwYR9EOiDD/NxgAAAABJRU5ErkJggg==';
// 15x15用
icon_3[0*3+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAAACAAACPkxwRAAAAiklEQVR42u3SUQqAIBBF0ZmV6c6q'+
		'nenKpgwqiQqEkgnu/RL88PBQZZRfpYABAwYMGDBgTwEGDBgwYMCAXdUdnGKyEILknCWmqC7BG3J/dGGaHfct+C5gG8z0gVPwOqkf'+
		'8LbwFalg3S18h27FdgOfsesXqM6uFy4VYH12t/CbAQYMGDBgwIBdBfjrZqEuUy3an0BpAAAAAElFTkSuQmCC';
// 11x11用
icon_3[0*3+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAAACAAACPkxwRAAAAx0lEQVR42u3WQQ6CMBQAUXoyuJl6'+
		's3Kyqo0kDQlKoMafcWbFgkVf+ktJw3X4q5JgeILpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ7gSOUpl3Ec6/M8z8OU'+
		'p4QGl0sp6UUs5bHYW+KCl91twT12ORS4HeG6uBXtiV46ig8Fbkf447sHRzwUeD3G77CIHd6DPnuWBf+6Pef4zBUVGtx+letiO9zJ'+
		'4cBbf1e9/rrCgb+dYHqC6QmmJ5ieYHqC6QmmdwcvYXo94A2nDgAAAABJRU5ErkJggg==';
// 強調２
// 20x20用
icon_3[1*3+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAAACAAACPkxwRAAAAd0lEQVR42u3TUQqAIAwG4O1k7mbW'+
		'zbaTrbAMI6gebEX8e1EU3MfPZBro9WIggAACCCCAAAKILyJU1FNKZGYkKhyKqM2Xl0ciz2V7hemK8Oxemh8v5mOOQWxJ1BTWNTSJ'+
		'XRoN4iyFRxDtUN4dzv9+USCAAAKI3jUBGfRDouKLt9UAAAAASUVORK5CYII=';
// 15x15用
icon_3[1*3+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAAACAAACPkxwRAAAAjElEQVR42u3TWwqAIBCF4XFlujNr'+
		'Z7qy6UYmlA9CyQT/eRpR8OOgTib5VRxgwIABAwYM2FIAAwYMGDBgwKYyHJxCUu+95JwlpOBMgk/kdessorEse/BDwBpVd2T7wLrt'+
		'7IBLw0/oFWuu4Sa6EzsMfMNu77eabTcsxyerZ3MNvxnAgAEDBgwYsKkA/joLvS5TLdt3R4cAAAAASUVORK5CYII=';
// 11x11用
icon_3[1*3+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAAACAAACPkxwRAAAAx0lEQVR42u3WQQ6CMBQA0fZkcDPl'+
		'ZvRklUgwEKMSivFnnFlB0gUv/QVyuqa/KguGJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmO1NiPteu6+3UpJfVj'+
		'n9Hgeqk15WG5mS4zF/zY3RX4jF0OBV6P8Px0w3bBhF46ig8F3ozw58WHRjwU+GmM32ARO7wL3XiWBf+6Xee44RMVG7x6K89P2/5N'+
		'Dgd+9Xd11l9XOPC3E0xPMD3B9ATTE0xPMD3B9G5/YXo9rrEx/QAAAABJRU5ErkJggg==';
// 強調３
// 20x20用
icon_3[2*3+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAAACAAACPkxwRAAAAZUlEQVR42u3T0QmAMAyE4ctkzWbq'+
		'Zulk9UkQodWHWov8t0A+jotp1ecxECBAgAABAgSIGRHhUVJy5RzycBuKOI5fc4fpiiiLSvXQpjGIKZqotdFq4RXEeZRPx/nfFwUB'+
		'AgSI3tkBiLM1ovVcm2YAAAAASUVORK5CYII=';
// 15x15用
icon_3[2*3+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAAACAAACPkxwRAAAAh0lEQVR42u3TQQqAMAxE0eRk7c3U'+
		'm7UniwtRK+pC0DLCn1UChT4G4jbar+KAAQMGDBgwYKUABgwYMGDAgKXSHVxyiZSS1Votl+yS4BXZfmsW2/YE3wUcQ8SCvH1hPrkO'+
		'eG/4yhR6Dd+jn2G7gc/YOMziDS9H1s5yDb8ZwIABAwYMGLBUAH+dGT7ETS0BGxpnAAAAAElFTkSuQmCC';
// 11x11用
icon_3[2*3+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAAACAAACPkxwRAAAAw0lEQVR42u3W0Q6CIBhAYXgyebPq'+
		'zeTJaLXKrLkc2vp3OucKpxd+AwY5HdNflQXDE0xPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ARHaixjG4bhOq61pjKW'+
		'jAa3Q2uXX7w9pXzKXPA0uxN4j1kOBX5ewvffm9ceo158KPB8CX/8umuJhwK/L+NlLGKG16G37WXBv27dPu4/ooKD28vb7WdyOPDS'+
		'7WqvW1c48LcTTE8wPcH0BNMTTE8wPcH0zgGkcD3U7OevAAAAAElFTkSuQmCC';

//--------------------------//
// ルート構築モードアイコン //
//--------------------------//
// 正常アイコン
var ricon = 'data:image/png;base64,'+
			'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADOElEQVR42u3Yy2sTQRwH8F+U1XZD'+
			'39EQE2krJbREsZCzB6mI9SIevJQi/g3iTfQgetCDd29Fag6KB73Ug8WDCF4KoZIHobSNpGlW10ht3baGMs4snbBNNtlHZiUd53va'+
			'3XYfn8zuPH4+hBD8T/EJMOcRYN4jwLxHgHmPAPMeAeY9Asx7BJj3CDDvEWDeI8C8R4B5jwDznn8Gnkq9Rz3SceiUZX1/W9NgQ9uG'+
			'xPhlH1fgO+tJ1C11VPdP7m9/q+zAEUDQIR3D8C1IF4vwOj7pOd4z8D01jcKSrMNolpU1GAme0reXlCKcCYb1bQIPSJ2wVtEgnc97'+
			'CmcOfqBmEWnFWuhMbMJ3KzWPjGB6rBZOzv2SX4FXHsCZgcmrOyL3mkLpvhnY+LdauFrZhsXCKrwcZwdvGXxXTaHTkr8p1A64ETwo'+
			'd8O6tgnZwlcmHZxr8EM1g+jrZwV1Am4Epy2exvdIxC65hjsGu4G6AVvBs0oJZmMXHcNtgx/jzqinQWdk92ZuwM3gG6RzU9YdwS3B'+
			'LKAswFbw5fJ3eBa9YHm9hmCWUJZgK3gGw2eawOvAtwsLKNo1UAdlFSOYVWrhuc0f8DQSN0UfAE8m59C14bED/0A6iMMQAjXmzUoG'+
			'5kzG7wPgGwtzaGJkrO5i7Y42Yo9KEuxVKjC/lDGdqZm+0oNdffh7+FM9dlhe6V3YgyE828uUS/ZeaWPIDIqcTGY5Rng7dloU+qmw'+
			'3LTDagomIa3d2+GHkNzFBM56WCLQATySLJJr2RiSLMHVm+Q+orH+E9AuEw8C7cPP8hM/y6NAzNGP5mhqOZ36gM4FQ9DvssVbnVrS'+
			'Fi3hTvRJ4Kyrz8HV4oGUa84HI47hbhcP9Bsl97ofGG1pxdTS8vAmfqgYfii7cKfLQwot42un8DWft9DJMQHTTCffodHIYHXt2ghu'+
			'twBAoYr2C6+D8zA7fqV9CgC18GhkCAKyH1Ttdx3cqsRDoGH8o5Fzc4VVplBPwDRTeoubw82KeARKqyZZDE14APUUTHP981s0HAlD'+
			'EI/lu/vHjGVaAiVRd3ZgS1HgRfzq4S3T1oYW4kN4PF/CLe3X69EcFuLbLQLMewSY9wgw7/kLaIwBtgdcB2UAAAAASUVORK5CYII=';
// エラーアイコン
var ricon_e = 'data:image/png;base64,'+
			'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADRUlEQVR42u3YT2jTUBwH8F+dgS12'+
			'znVlYa46N2pRq1jYXfAiePLgQRhDPHhRFGRuoIgiovhnOg8qOygiOobiyZPgRRAEDwpDF1drqXZUt4ysOqbVUcfzvbYpaZs2Tfo6'+
			'u+f7XrakS8pn7+Xl/X4OhBD8T3FwMOPhYNbDwayHg1kPB7MeDmY9HMx6OJj1cDDr4WDWw8Gsh4NZDwezniUDyz39SGhqBLFBTB0n'+
			'fiUgMfcdAqPXHUyBp/oHkbDamT0WWltSP5MzswArVoJQL2D4D/ganIDux7eqjq8aWD19AwntUhqWiRKZBMnblf49HAGpa336AwJ3'+
			'N0HyiwLRYLCqcOpg9dwwIqOYD/Xfu+iQD5xEenD2XD4cXxuVZeh+dJM6nBqYTF3R22EI1Y6NwDmf5cPVOYiNT0Dg4RA1eMVg9RSe'+
			'uuukktBywMXgouSCxNQMxIIhKgucbbB6/jbSpp8Z1Aq4GFwbceX9B/CPXrUNtwy2A7UDNoXjVd0/Yn2qlw1WL9/F71GnLWgl4JJw'+
			'/DpT3o1bgpuCaUBpgM3g8c+T4Bs+a3q/omCaUJpgU/jER/CVuG8BONY3iBp9ha8XWtGDqd0zDz4fioJnaMAQnQMe230Qde7ZlfMH'+
			'ZIFYDiFQfT49eQaBp3cK0DngN/uOIO/OHQU3q3W0HivU1UFycRHCz18Y7tSMp3RHG34e5rPnls2UXvgD4oa1+DmOlDel9SE7KHIx'+
			'2eXo4TW5aGWgsZevSy5YJcEkZLTr1zhBbGulAqf+WsJQoaUZlLeyKbQssJYQ/hLX5o1QMxsPAm1uhOS3eXBfOGrpn2Zpayn39iFp'+
			'21YQXU22RrzirWVmRJPTKrivHLP1ONgqHki7Rtq+xTLcdvGQeUbJd7nPHKqoYqqoPJT3n0CS31c23HJ5qEHjuFiQQ+C/f+nflYf6'+
			'jPUOIM8mX7Z2LQYvuwGgQZV4ug4eGaydBkAB3NcFohvD1XgB3LTFQ6DtralrY6EIVWhVwFl4z3E84l5DuGETjyxGma5JLBiGwOi1'+
			'5dPE0+fV3sPI09EJ9VILRi2kzuW0aTGU5Lc6C0riJ3Q/oD+iSwrWR2vEu/AmRglHQVjVwGYjvtbCwayHg1kPB7Oev9FP96eURC+L'+
			'AAAAAElFTkSuQmCC';
// 起点アイコン
var ricon_f = 'data:image/png;base64,'+
			'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADo0lEQVR42u3Yy08TQRwH8F/VVWjD'+
			'u9JgawBDCKQaSTiTYjBGvBgPXggx+i8YbwYPRg968O5JYpCDxoNe8CCRhph4ISGYPkIIUFMeiysGwQJWMs5smGa7O93ubrumjvO9'+
			'bFu62/3wm52XByEE/1M8Asx5BJj3CDDvEWDeI8C8R4B5jwDzHgHmPQLMewSY9wgw7xFg3iPAvOevgYdi71GddAKqvV71/W4mA1uZ'+
			'XRjvueThCnxnbRbVSlW5982Hrzeye3AEEFRJxzF8B+Krq/C6d9B1vGvgESWOgpJXhdEsyivQETilvl6QV+FMIKi+JnC/VA0r2QzE'+
			'UylX4WUH31eSiFRRDx0ND3huxiaRFkw/08PJuZ9TS/DKBXjZwKTpdnjrDdBbyjFL5z/z/zZUXMnuwlx6GV72lA9eMviuEkOnJR+z'+
			'otFoVL14pL/f9BrRqSn1GIlEDBUPeGthLbMNyfSXsnRwjsEPlASizU8PVREWsSw0ObKaOql4HP/GePiiY7htcDFoDoDBeixF0bD+'+
			'TsE0heBJeR3Gwhdswy2DH+HOqK5AZ8T6vh5MsdPhZvXYF9swoFlgM/gW6dzkNVvwomC7UDMw6Zi0vTSrQysELgZf3PwKTzv7isIL'+
			'gp1CzcAktMJ0WLJWF+vwBIaPmsAN4NvpGdRZ02SA2g2pXrFnWBtSfafRw+e3v8GTUC8TnQcenJ1AV9u7875AOggnYT2jhaKvvpMQ'+
			'qDZvlhIwwRi/88DXZybQQEe34WKVjtZij0oSHGSzMLmQYM7UmE26taYBPw+/cp85adI0ZjMtVpN30rRpk96HA2jDs73E5rq1Jq0N'+
			'mUGRk8ksRwsvtaOhvbTdYYl1LT30Y3rRtMMyBZOQatdX+aDFW2MbTmda2rCGJbtgPbQJjyRzpMe3MCQVBed+ZH4adTeehEqZeBBo'+
			'A76X7/heHvrDtlqcranlcOwDOhdogUYLFXdjakkruo470cf+s44eLUeLB7Jdcz4QMoWXc/FAn1HyW/f8XSWtmEpaHt7ANxXGN1UI'+
			'XurykEI38bVj+JrPS+gwywKmGZ59h7pCrbm1qxbuZAOAQuXMD7wOTsFYz+XK2QDQwztDbeD3+kDJ/MyDW9niIdAg/qeRc+fTy2WF'+
			'ugKmGVIrzoazNvEIlO6aJDF03AWoq2Caa5/eovZQEAJ4LN8//Ey7TUugJMreHuzIMrzovfLvbtPqQzfiW/B4voAr7VP3oznciK+0'+
			'CDDvEWDeI8C85w/zOie2NTYv+QAAAABJRU5ErkJggg==';
// 終点アイコン
var ricon_l = 'data:image/png;base64,'+
			'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADeklEQVR42u3YzUsUYRwH8N9WU7qL'+
			'75uL7YYWIsoWCZ5lDSOyS3ToIhL1L0S3qEPUoQ7dOyVhHooOdbFDkiJBF0GMfUFE3VhfxibDtFXb5On5DT7D7uy4OzM7I+vT8z3N'+
			'Djszz2eeZ543DyEE/qd4BJjzCDDvEWDeI8C8R4B5jwDzHgHmPQLMewSY9wgw7xFg3iPAvEeAec+BgfujH0mNdAIqvV7191Y6Devp'+
			'LRjuvOzhCnx3eYpUSxXa78a949XMNhwBAhXScQrfhNjSErzt6nMd7xr4vhIjQcmrwljm5EVoDZxSj2flJTgbCKrHCPdLlbCYSUMs'+
			'mXQV7jj4oZIgWIt66GC413MrOkqyweycHo7Xfk3OwxsX4I6Bsem2ems1aCQq27rPeDigwZXMFkynFuB1p3PwksH3lCg5LfnyavS2'+
			'cgwiPT3WsGNj8ML/N6epB7zVsJzegETqmyMdnG3wIyVOWPPLhmIzVQs/Pk7sgCORiHq9UVPHGo/RZwyHL9mGWwYXg2qF14ERYyYM'+
			'zLIfPCGvwFD4omW4afAT2hnV7NMZGf3fCIzNVd9pmS2oEXwdOzd52RK8KNgq1C1wMfjc2nd43tZd9H77gu1C3QYXg8cpfLAAPA98'+
			'JzVJ2qoa8qBWo++lzXzD+ELsRA+f2fgBz0JdhugccN/UCLl2piPnD9hB2El3dNXSsIQvZCLcaOtZGIRm5918HEYMxu8c8I3JEdLb'+
			'2pF3MzvogwRnY49KEuxmMjA6GzecqRk26eaqOvo9/NHOHZYmvQO70EJne/G1FXNNOjs4g8KLcZaTDS/HTotBP6fmCnZYBcEYrO3a'+
			'Ch80eassww9iWEJoAx1JpvFeJoakomDtITMTpKP+JJTLxAOhdbQsP2lZHvvDll6apanlQPQTOR9ognoTNe7G1JLV6ArtRJ/6z9n6'+
			'HGwtHnC75kIgVBDu5OKBfaP4rAf+9pJWTCUtD2/SQoVpoYzgTiwPGXSN3jtK7/myhE7OETDLwNQH0h5q1taumFI2ABhUTv+i6+Ak'+
			'DHVeKZ8NAD28LdQCfq8PlPRv7bzZLR6EBulLw2tnUguOQl0Bs/SrNW4MN9rEQyjbNUlQ6LALUFfBLNe/vCdnQkEI0LF8Z+9c9jYt'+
			'QjHK9jZsyjK86rp6eLdp9WEb8U10PJ+lNe1T96M53Igvtwgw7xFg3iPAvOcfcDIRtt/m9fAAAAAASUVORK5CYII=';

var atk_icon = 'data:image/png;base64,'+
			'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAABIUlEQVR42u3Yaw6EIAwE4OVkXh1P'+
			'xsZNTBpSHiZthdmZn0giH2BFU875809JBIOHYPQQjB6C0UMweghGD8HoIRg9BKOHYPQQjB6C0UMwegj2zHEcRWs/zzPBgW9sqmil'+
			'xKJDwalButAEEwwM1oqb1YQsWbTk5BRBt0C7grWV0iDNwQme1bZ3A0tsMtiMW4C17dtb4XpF7zbLd3UIWOJ6bb2+yxetGXALeuHq'+
			'5395cI3WkBrUbTAR4Bv9u9HLUFdwq0JrRSsSaw7uQUftWx0tZ6D1NZlIuBm4B21NxBvPtfkKywFrBWs0GbKPB9r9aKlhW19GHmfn'+
			'EPAs9mnfpcGzgCd9twCPAK2PjG3BI0D0r1v3k5Y3YAnwyiEYPQSjh2D0fAED+WdMDlMwAwAAAABJRU5ErkJggg==';

//----------------------//
// レーダー描画アイコン //
//----------------------//
var icon_m = new Array();
// red
icon_m[0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAABhJREFUGFdj/M+ABP7/ZwDyEYgY'+
		'/n8UAAB2YibbE1hiFgAAAABJRU5ErkJggg==';
// green
icon_m[1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAAB1JREFUGFdjZGhggIP/9f8ZQHwY'+
		'+v+fMB+oBhkAAG1dIOdybdeqAAAAAElFTkSuQmCC';
// orange
icon_m[2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAABxJREFUGFdj/N/gwAAH9fsZgHwE'+
		'+v+fMP8/CgAA8fEv28S8Pq0AAAAASUVORK5CYII=';
// yellow
icon_m[3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAABhJREFUGFdj/P+fAQn8ZwDykRAx'+
		'/P/IAABygjLPOSZPYAAAAABJRU5ErkJggg==';
// black
icon_m[4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAABdJREFUGFdjYEAC////R+YyEMMH'+
		'qkEGAG3+GuaurV/rAAAAAElFTkSuQmCC';
// blank
icon_m[5] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAAB9JREFUGFdjPHDgAAMM2NvbMwD5'+
		'cPD//3+CfKAaZAAA6go158lfhdYAAAAASUVORK5CYII=';
// purple
icon_m[6] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAAB1JREFUGFdjbGD4zwAD9UAmkA9H'+
		'////J8gHqkEGAGOJLNsJpCpLAAAAAElFTkSuQmCC';
// blue
icon_m[7] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAAB1JREFUGFdjZGD4zwAD/8FMIAFF'+
		'/8EC+PlANcgAAF56JttM3K+FAAAAAElFTkSuQmCC';
// aqua
icon_m[8] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAABxJREFUGFdjZPj/nwEGwCwgH4b+'+
		'g+QI8IFqkAEAWpoyz55hZGAAAAAASUVORK5CYII=';
// wall
icon_m[9] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAAB5JREFUGFdjbGhoYICB+vp6BiAf'+
		'Dv7//0+QD1SDDABreyznkufwCAAAAABJRU5ErkJggg==';

//----------------------------//
// マップチップ回復用アイコン //
//----------------------------//
var icon_map = new Array();
icon_map['territory_b_s.png'] = 'data:image/png;base64,'+
		'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'+
		'LMiz5m1Pu0wAAAAASUVORK5CYII=';
icon_map['territory_r_s.png'] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAA'+
		'DQlJREFUeNrsW2tsFNcVPvOe3dmnvX5hg9f4ASYPnPCIKeAHISlKaEMUklbpj1hqS1QlUp0oUpOqP4zUH0nVFKQqqtRWrfOn'+
		'SqsoCjSE0DTBhDQVBcLD2PiB8Qvj9Qvvep8zs7Pbc+/sro3B1BCCkmavdLWPuTNzv/ud853vzmqZZDIJ36TGwjesZQFnAWcB'+
		'ZwFnAWcBZwFnAWcBZwFnAWcBZwFnAWcBZwFnAWcBZwEvoj25Yclq7I99kxjesTUebP5GAP7LCw+VlhfmNm2NhxrO11r2/N8D'+
		'vtB/wavGwl7yXlRjzX33MYex19+p+/N3gNGf4ksD9tan93y4LxwOgT9izB1CjrW1b3ZAwG5vKxq93FJ+KnnkawvYN+7ba7FY'+
		'IBaLuvDjvoXGWUNB0il4ZBx+7/Ewc4+/9uHEVw8wsunElybsfmTzTfJdb39P5viuB/hnrBbrq4u57eq7aw6T62BvPnPu9OBX'+
		'MocnpiaI8u7VNK31Nz+4h+Yl+bGOdIZhap12Z6skSL5FRkbDyOjIjr6BviVfmZAmiosvRIBOI6OBC/290N3XRcCBzWKjjLKs'+
		'uaYsw8awbyurKt82frqn5reiG3ZBeEzStILrXbuj5xyIgggOxRFK3YvU7RpyL2R8362G+BcN6YHUawv23eRNIpGgX6i6+hYy'+
		'WhgMB+lnQRJ9dd9ubA34g1ShxxgWTm+pLyidujLJnzzl9hgJbv7F5/6U6w/4X2Q59n5VVc/fSAu+VMAnTh8HURQhGovC0/jZ'+
		'SBg16WOp0P0+ESHyWbEpKzlRhrwlTli2fBLGJ/3gzHGBP8fl+bivD7hQCFZwwsTdmn5giucfgXgsn5wXjobXKhalvaP7nFvg'+
		'BRveQ7HK1nSEpcsZYT2wGNYXncOtz9fvwRsksU+nv9PjOvhn/BCPx73PbbT0I8gd6WMYuh8QRim7vAAsywHHS5BMGCBJAvCC'+
		'AAzL0y6JEkRwzOXiwrzJ7z3eMLym5o/p61gky58isQgRMAXBQiKZoCT9YdeGutRitoUj4edvO8MdXR01gkCGM675xzDXmrC3'+
		'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';
icon_map['territory_bk_s.png'] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3Ag'+
		'SUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKg'+
		'KLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADw'+
		'A3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4F'+
		'ANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMe'+
		'E80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q'+
		'5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQ'+
		'yDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK'+
		'8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mP'+
		'QCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqg'+
		'EZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPy'+
		'LXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlh'+
		'XIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6'+
		'EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BP'+
		'kvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3'+
		'aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKV'+
		'OpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3'+
		'xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqt'+
		'Zq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83'+
		'MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2U'+
		'a5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1lds'+
		'UBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTD'+
		'qcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY'+
		'4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7'+
		'+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6'+
		'MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xq'+
		'bFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WD'+
		'IEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSc'+
		'lJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuC'+
		'Fny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRa'+
		'uWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19t'+
		'St50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLd'+
		'jxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPc'+
		'w83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8'+
		'mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f4'+
		'1y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJH'+
		'zEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O'+
		'233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAA'+
		'ADqYAAAXb5JfxUYAAA1JSURBVHja7JtrbFRXfsB/577n3hnPjB/YEAePATtAsoUkQMgGbCZZQrShDdGSdJV+CNJ2s6oSqWYb'+
		'aXerfgApUnerZLEqrSp1pdb7BW3TVRXSPJalqQlsN83b5hVsMH5BsLGBGc977qsf5sHTKWGTKLvx+eLrOf9zzv2d//Pcqyt8'+
		'3+er1CS+Ym0OeA54DngOeA54DngOeA54DngOeA54DngOeA54DngOeA54DngO+AbaY/cuWPHYvQse+SppeEub1/hcPB7/+h89'+
		'8O7tG1sWN9Vte8uM3CF88dM/euCTwydjhXwmBuAL/554PP6/8Xi884taX/kCNPrXwAag54ld+/ZkMmkSWRe0lorIPcD+b3ds'+
		'xRSFd4al9PO9vb3//gcLPHFuojsQCJDP5yLAntnkJuXzAGuAF+PxOGuUI+Ly/p/sm/ryAe/evjEMbAMST+za9wuAE8OD1f6n'+
		'7lGeNAPmj29k2RV3rOwFEkBX/5G+0S+lD0+dn+oCuovFYs9P/+JrnQC+7+P7PkKIteFQuEdX9YkbtIwNZ86e2TI0MrTgS2PS'+
		'u7dvbAFiQN8Tu/YlTw6fYGDoOEIIgoEgT92jPClJpT2VhJSXhPRQa/vih871Da5cnO1n2Ljzgid5tdeb++jgETRVo8aqSZfX'+
		'egRYCfT1H+nbc7Mm/vua9Ej57w5gJ4DneQAU7MIvw6FwUyqTAkDVtYmOTfGeZCIVA8gIie+uV2sNVyv841tpzRe+uHryy1/l'+
		'JpKJ70uydFehUPjok2LB5wr8Xt+7aJpGLp/jCcD13JWVvrLpfhvYD2AFraWyZtCwIMzCRdOcm04QioQRkqzfqRxETqfp3Poo'+
		'L7wynUP4BiAAMrnMKitgHT46cCSqKmrQ9VzLNMyKhVXSWV//kb7kjWj9hn2455nOXbu3b/R3b994sfKb7dgkZhI4jhN7+r7A'+
		'sK7qWyp9re2Lf92xKd4DoCoqkiQjKzq+56LrKoqqIiS5tDmaTlZR+eCd9/ibzfWTf357/u8r8wT0wL9k89lewHI9F8/3FICf'+
		'P3VvR3kz92eymWc+cw0fPX50paoqgIhc3aep2jZN1fbni/n95ShNTbjmhwjBfRs2kM3kiNbX4/sevu8hyaUNUA0LgPjmP71k'+
		'xp4bi9TX/21VI5L0d6Zh/mU2n42VBDDLBcxIIpVAkRWEJByrPNfu7RtXACOzaVz5hGDUU/63+4ld+/bYdpFMLo3neXxnteg0'+
		'DXNHRd7zvZ6OTfH9g8eOdw98dBwAISuolk60NUPTxPLq3EKWQIhZN1ZIMoqqI8oyq9bd87RpmT96/aVXnhNCNEuS1JzNZ3td'+
		'z/0nx3UQQqBIJYxfPLPhP1VV3ez7fhawbljDJ4dPxhRF2SBJgmLR3l8JErIk43ke0ZroflmSR7L5LACxxa1bgG3zm28hPZMm'+
		'YFlE6udh145SbDiBEzqLPnk7ykzTDVlTTTTKNx/diiRJmJY53y5keqygVcxmsvi+P2EFrJjjOP9WKBauGHfk+OGEJEkUbdvW'+
		'FPX6Jv2DjQ2suGNlJb0k+o/09QMk00lsx6Y+Us93VovOoBmsBiRZkrd1bIrz6z2v9gAIUTLzUE2I1evvQ1YNALI1E/hSAacm'+
		'jZKaf8PAAKFwuHqt6hZCkjSAgBmo63gw/t0De3vrgBdKbuA/NZ2Y/mXQDErlTdC1YJgyW7iczhL9R/r6FYBisfArTdNXua6b'+
		'AKKXL1y0i9vCwfAOfPIepZTTsSm+A4jVz5tHLpslWBNGVnXs6DjCN5Ezt1THe0amtEnZ2pvOBr7nsvLuuzg/PU0wFFKBnjUd'+
		'a0+/9vIrlaAX1TV9xHGdU1ePTaVTPwkFQ9/zfS8PBBSA9/rfK5RzqB+yQtiO3ajICrIso6laBNgmJPFDO2svBZBVPSYpGl9/'+
		'4BtXTJ6NHcPNRHGLU+gTyzFPrcMvCOzmUnmZv6UP9eLCT0nr4zpFQuEQoXDokq8L0Vy5jtRF/yuTTL8K/MzzPBRFUacT0y31'+
		'kfrRYwNHhRACx3MKlmGVfNjzPc3zPHx8PZ1N/2tNqGbbqpWrSwl/JjHZsqx1x9GzvbHCBzJm0Kqa7NXNtS7gKwVcJjHOlDxA'+
		'LczDS09jW+MUmo/gWudxQhpMqLMCep6L7zn4nockK6i6dU2gkzWTWGwRsixoW7b0MdMyV7//u3dOLGlpWwnI42fGR8bOjPbI'+
		'sqx5nofjOPo1QUsgTCtgbXEd92cfHv7gaUmSCIVDt90aqqM1fpG2zU1IhRCcml0hnp65wlft2jGQoDj/BMLWsaNj+KIF35dx'+
		'i3k8z62Q4levQZJVFC0wa0SXFZW18fvxPRe7kAHfj6m6xvuH3sNxHCQhvSTJ0hYhROTyiu3qwsMtC/xVKpMimUriA5IB9rH5'+
		'5F5eRmb/7IEn0H8/UjoMly3gy0Vc8wK+WgDJrayC73u4TqGsSecSrBAoWgBFN2eF9eUi6WWvc3FijOmhcVKTyZJp10bJZDOk'+
		's2k8vEcMzYjIkjwxa6UlyZJY03EvjW3B6u92sYibCnBuMMfI+AiDA0MUmo5d90b03EKMo+uRxxbhFHN4ro0+vAqpECz1H1qH'+
		'yJtEmqCpIXxVAhbIqo5mhJAU7RPd2o6O4StFBkb6GBkfYWxstFKlVGXMsCJWb43RuKDpinysdGyKP3nwv9/8k8TFiwiEZAQM'+
		'Wv6syMn+kkB6Js3Blw6gRQTnz4yiGyq+3FiKgJPTuLaDURPEqAmCEGg04Kdr8YSN59iQMDF+9yCFOw+CI2N82EGrqiKWawgh'+
		'I0kyQpaRZPUTIV3HITN1oXTTdVlc8wKpnMLMmYsEAgHOv3EBz3aq8nWrchiGiSTnQqWCRtI7NsWfVIBYS2vMNQMmhhW4ZqEF'+
		'ixqRXJ3xkdFyigC74GIAQ4PH0RQd2dC47c4VV1RLcrlOrpafA5sv2ZT26VNTNpVm9FQpeDTX1yO1qjjZkus4tkNjYy0tbUt4'+
		'c9/eS/fhqDTMa6CYLyLJkg3ElAN7e3d2bIp3L2xt6QK6gIgydDtwoBQcZI32ZUuxbZvhU0P4Hhz855MsXxFm9PQojuOwqO22'+
		'qhYKM+mSP0dqENLNP18oZLK4hSKyrqFbJkKWGB47Ra6QQ25exJnnVOwZF/DQdJ2716+jmM9fM09DU2OioamxG+g+sLc3qZQL'+
		'7CSw89XnH+8GutRcpKu2ti5ScDNE6q2yf4uKnxNraWOw/xCO41wxeXLqPDPnpnBcl+b2JRhB66aBPx4aRvg+iq7TvLTtijPy'+
		'6fcvEmnV8MhhT4Eky6VA6RaIRCLYtkNdvj0rJer/Aeh++NkXkwAPP3tVWnr42ReTP9jYsLNjU7z7vvj6qsavii4sv/suFi1b'+
		'ymv/8SsUWWHizGlGhk4StIK8/eHbqIpK89L2krkViqV8qirIijJLJeXhFIqlvB0o5fih0SHSMzPURCPYCpw4crQqv/hbNnVr'+
		'srz7Y6Wau4v5FAhY/8CGBFDV6NUnpmvu4HoaB7oMIxBRZAVd18D3MUwTIYnK8ZDB/kPIilx9hlVp02OnkZHwJGhcHLsucOLc'+
		'FE4qh+/7RG6djxYw8DwP13PJpjMM9h8iWlvHRK50WLGabUTewogUyZ5VMAwdfL8KerlGP9V5uDxw56vPP969qH1x16L2xV1A'+
		'pJhPlaqfcqudN4/YkiUM9B9i6nxpR8dHh2lbtpyPBo+RmpkhHI3OCjx5bpLjhw8hhODh1sc5N3GWQj6PEAIhBGs6O1EUmYnX'+
		'Py4NyJsY73awcuv7aB/dnRSOuuty0N/7AcCBvb1JYGfHpnhJ477fZRcyEUmSwQdJEkTr61ly+3JGxkqR9NSxjxgeGMRxbWzH'+
		'xi0XFk6hQPJsaVNqmhpQDb0U8Mr9b7/5JulksnTOlRUClkk4GiaVuHCpyhIqwlET+uG1VdOdTaM3BXyZH1wydd/vuv/Bb3zf'+
		'tt2acF39NWNWrl3L6VPDnDk9Vk0dALl8noGBY6iqRlvQIGLoZDPpS8WLprO8s5N3/+e35LNZ8HycQpZAwKDjgQ34kLJGrBf+'+
		'P9P9TJ9LP/zsi8kDe3t36oa+MBgyd7jFbMIp5vB9ryoTjtZy9/p1aHpJg/lslt8efJnpwjHGPh7j7OTHTHmHOfDG65wdH7+0'+
		'UfeuJVpXVy1PfarxIGEGrR1W0Lr1wN7enRWtftomPouvWl59/vEw0OV7XteJgZMRKxikZUkbkiTzm5f3kJpJUhOOULPQITkk'+
		'uDBzAdMw0VQNq1bDME3GTpwBYPPWbyHwmJqYJJPOEK2rTYUj4Rdu1Ee/kDcPFY0LSYq1L2vfccutCxJOIUMxN1MqzQBZlrjt'+
		'ezMsejxXHbcwLvG1H53HCl4657p2AXyfhsZ5idji1h3hSPjWA3t7d34WsJ/pu6XZ0tmS9rbI9LlpaufVI6VtrOZL/lqzvPQ0'+
		'ZH5DMzO3pAiYJrIs31B6udkmPs8PtSqmXilgfMVmxjzOGz8/jmmYrHl0CUbnUQJvPYTIm59YMPxBAF8PPJ/LR/a+8hqGbrAu'+
		'3okVsq7R6OfZxBf5KV4F3HXc7T4+iqLs+qJAK+3/BgDqPrGwzlG2AAAAAABJRU5ErkJggg==';
icon_map['territory_bg_s.png'] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3Ag'+
		'SUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKg'+
		'KLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADw'+
		'A3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4F'+
		'ANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMe'+
		'E80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q'+
		'5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQ'+
		'yDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK'+
		'8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mP'+
		'QCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqg'+
		'EZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPy'+
		'LXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlh'+
		'XIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6'+
		'EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BP'+
		'kvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3'+
		'aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKV'+
		'OpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3'+
		'xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqt'+
		'Zq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83'+
		'MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2U'+
		'a5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1lds'+
		'UBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTD'+
		'qcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY'+
		'4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7'+
		'+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6'+
		'MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xq'+
		'bFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WD'+
		'IEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSc'+
		'lJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuC'+
		'Fny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRa'+
		'uWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19t'+
		'St50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLd'+
		'jxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPc'+
		'w83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8'+
		'mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f4'+
		'1y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJH'+
		'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'+
		'2WubZ18kUIt4nMMcKUeAVpyBnxnHsU9TbDqEZ1/Ajegwqk0J6Psege8S+D5SUdEM+7pEp+gWiUQriiJoW7jgGcu2lr3/m/89'+
		'Ma+5bQmgnB45PTg8MtSlKIru+z6u6xrXJS2BsOyQvc5zvR9+cPC3z0spiUQjd90ZqaOl4xJtTzQiixE4NbVBfCN7Vaw6tcMg'+
		'oTTrBMIxcOLDBKKZIFDwSgV835skJageg1Q0VD00ZUZXVI3lHY8Q+B5OMQtBkNAMnfcPvIfrukghX5WKXCeEiF1ZsV1beHiV'+
		'Ad9IZ9Ok0ikCQJrgHJlF/rWFZPdOnXhCvY8gM1G44gKBUsKzLhJoRZDe5FUIAh/PLVYs6V6GFQJVD6Ea1pSwgVIis/BNLo0O'+
		'M95/mvS5VNm1a+Nkc1kyuQw+/pOmbsYUqYxOWWlJRYr72x9kZlu4+rtTKuGlQ5w/nmfw9CDH+/opNh654Y0Y+TmYhx9GGW7F'+
		'LeXxPQdjYCmyGC73H1iBKFjEGqGxIXqNAAsUzUA3I0hV/8iwduLDBGqJvsEeBk8PMjw8NFmlVMdYUVUsezrBzNmNV+mx2r6m'+
		'49m3/2vfHyUvXUIgpBkyaf5yiZO95QGZiQxvv7ofPSa4MDKEYWoEysxyBjw3jue4mDVhzJowCIFOA0GmFl84+K4DSQvzN49R'+
		'/OLb4CqYH7TTommIRTpCKEipIBQFqWgfCem5Ltmxi+WbrsvhWRdJ51UmRi4RCoW48NZFfMetjq9bmsc0LaSSj5QLGmm0r+l4'+
		'VgUSzS0JzwpZmHbougvNbp2J9AxODw5VJAKcoocJ9B8/hq4aKKbOXV9cfFW1pEjl6vKz74nLPqV/cmnKpTMMnSonj6b6emSL'+
		'hpsrh47ruMycWUtz2zz27dl9+T5cjYYZDZQKJaQiHSCh7t/dvaV9Tce2OS3NnUAnEFP77wb2l5ODojN/4QIcx2HgVD+BD2//'+
		'6CSLFkcZOjOE67q0tt1VtUJxIlOO51gNQt76/kIxm8MrllAMHcO2EIpkYPgU+WIepamVke9pOBMe4KMbBvc9vIJSoXDdPA2N'+
		'M5MNjTO3Adv27+5OqZUCOwVs2fXS+m1Ap5aPddbW1sWKXpZYvV2JbzEZ5ySa2zjeewDXda/elxq7wMT5MVzPo2n+PMywfcvA'+
		'H/YPIIIA1TBoWtB2hWoFnHn/ErEWHZ88zhhIRSknSq9ILBbDcVzqCvNzMln/98C2tS/uSAGsffEaWVr74o7Ut1Y3bGlf07Ht'+
		'oY6Hqxa/Jruw6L57aV24gDf+7ZeoisroyBkG+08StsO888E7aKpG04L5ZXcrlsp6qqkoqjpFJeXjFktl3Q6VNb5/qJ/MxAQ1'+
		'8RiOCicOHa6On/uUQ939Od79vlrV7lIhDQIefnRVEqha9Nonpuvu4EYWBzpNMxRTFRXD0CEIMC0LUdmk0DWd470HUFSluoc1'+
		'2caHz6Ag8SXMnJu4IXDy/BhuOk8QBMTunIUeMvF9H8/3yGWyHO89QLy2jtF8+WHFbnIQBRszViJ3VsU0DQiCKuiVFv1Ez8OV'+
		'E7fsemn9ttb5cztb58/tBGKlQrpc/VRa7YwZJObNo6/3AGMXyit6emiAtoWLOHr8COmJCaLx+JTA586f49jBAwghWNuynvOj'+
		'ZykWCgghEEJw/8qVqKrC6Jsflk8oWJjvtrPk6ffRj96XEq629UrQ33kDYP/u7hSwpX1NR9niQdDpFLMxKRUIQEpBvL6eeXcv'+
		'YnC4nElPHTnKQN9xXM/BcR28SmHhFoukzpYXpaaxAc00ygmv0v/Ovn1kUqnyc66iErItovEo6eTFy1WW0BCuljQOLq+67lQW'+
		'vSXgK+LgsqsHQecjj33pm47j1UTrrt94XLJ8OWdODTByZrgqHQD5QoG+viNomk5b2CRmGuSymcvFi26waOVK3v3vX1PI5cAP'+
		'cIs5QiGT9kdXEUDaHrRf/jjX/VT3pde+uCO1f3f3FsM05oQj1mavlEu6pTzBFfvN0Xgt9z28At0oW7CQy/Hrt19jvHiE4Q+H'+
		'OXvuQ8b8g+x/603Onj59eaEeXE68rq5angZU80HSCtub7bB95/7d3VsmrfpJm/g0vmrZ9dL6KNAZ+H7nib6TMTscpnleG1Iq'+
		'/MdrO0lPpKiJxqiZ45LqF1ycuIhlWuiajl2rY1oWwydGAHji6acQ+IyNniObyRKvq01HY9GXbzZGb8ubh0mLCykT8xfO33zH'+
		'nbOTbjFLKT/B5FsGRZHc9fUJWtfnq+fN6ZB84TsXsMOXn3M9pwhBQMPMGcnE3JbN0Vj0zv27u7d8GrCf6rulqeRs3vy22Pj5'+
		'cWpn1CMzDnbT5XitWVTeDZnV0MTEHWlCloWiKDclL7faxO/zQ61JV58sYALVYcI6xls/PoZlWtz/lXmYKw8T+p/HEQXrIwuG'+
		'PwjgG4EX8oXY7tffwDRMVnSsxI7Y11n099nE7fwUbxLcc71NAQGqqm69XaCT7f8GAOektk0dB9KiAAAAAElFTkSuQmCC';
icon_map['territory_g_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['territory_o_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['territory_y_s.png'] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3Ag'+
		'SUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKg'+
		'KLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADw'+
		'A3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4F'+
		'ANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMe'+
		'E80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q'+
		'5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQ'+
		'yDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK'+
		'8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mP'+
		'QCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqg'+
		'EZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPy'+
		'LXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlh'+
		'XIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6'+
		'EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BP'+
		'kvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3'+
		'aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKV'+
		'OpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3'+
		'xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqt'+
		'Zq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83'+
		'MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2U'+
		'a5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1lds'+
		'UBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTD'+
		'qcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY'+
		'4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7'+
		'+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6'+
		'MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xq'+
		'bFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WD'+
		'IEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSc'+
		'lJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuC'+
		'Fny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRa'+
		'uWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19t'+
		'St50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLd'+
		'jxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPc'+
		'w83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8'+
		'mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f4'+
		'1y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJH'+
		'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'+
		'Wf57AD3ibFvd2a7UAAAAAElFTkSuQmCC';
icon_map['field'] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAACx0lEQVR42u2Zv0ssMRDH9xAO'+
		'FOFAK7HwCdrYiYUgCK+xUZsHTxtrG2v/C61trG1sbNTGRhBeJ3Y2CtqI1XuPAznhQM6bcBPG2WR/ZJO7Y8y32cslu5tPZjKT'+
		'ZGudTif5TqpFYOGKwNIVgaUrAktXBJauCCxdEVi6IrB0RWDpisDSFYGlKwJLVwSWrggsXRE4tK6OdtUL262mKm/sn9ZEAl8c'+
		'bnfqYw1dRmBUv8CDA3NQhOX/odb2joOCBwMGULjawPIUCtw7MAd9+3GtruPPP4cC3BswglJYUHPpRP9u3O44P98XeGVgChoS'+
		'2FdUdwY2BSMEHH1cSerNWVUGl/6YfElG/k4rt243nnSdCzDKFbw0sA2UwoEQkEOD6v9nCkNnRXSoKwteGPjscl41hI5TC9qA'+
		'aRuwOsBiHa+nAFxFonwZ8FxgnKPthTsjDBfOWWwDLvw+9yfVbvRmM/O9eaDwXNWu14+ic9wKDBYF10teJxIOTN3VNNrQlrot'+
		'DVxFgItYFdMdSMUG4h3vq+fJ7+WWETwFjBaFm/Scu19UnaAdz7IyHXFd7g4CPksNSPfqAori0Z/OdTqFOLgG/pJepv5pN4Qb'+
		'TcAuKQY7lRWIXIDBW0ypEPsOQlevnR9sGX0aLMxvotBVcqoP0QBJ+6I8q2cw2neU2cJ4M3FDBMaXuS4VfYBCfEAggE4Bk/6n'+
		'LGybwzZVdcUqMkV8GkBNaY1HbWuUho266QGDhKZuTIFNAdCWnnLzMD+hGCQ0tTBmENUXAuych03gg4bOCkjeVlpcebujYKAW'+
		'BVtL+wKnuyW+PCwD27fdUhVwnIOwSgNp1zTsnnyDegPOAucDYIqyIL1XtkBCPv21/jAcJx5lwPmSlW5GTKkF5Pv4NuypZRcQ'+
		'd1so3HWl3JoBhzqnDn4uzbeZSnQg4DeoVw59IN/XLw9Z9WK+POSBi/22NCz6BKBnXj3PpyekAAAAAElFTkSuQmCC';
icon_map['capital_b_m.png'] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAALyklEQVR42u2aC2xT1xnH/9f2'+
		'tR3beTpOQt4JSUkggwINJKWgdR3r+hgqLe2kgVQNQbtqGtqmtlq1Tpo0rarWqmKrRvdAGhNCG5RtpYVmlLQF2gJjhaZ5kpCk'+
		'Ic77/fTbvjvf51wTk6TQNg5dmk9EPr4+93znd77ntZEURcFXSaQF4HkuC8DzXRaA57ssAM93WQCe77IAPN9lAXi+S8SBMx74'+
		'k6LXGxAI+PHJ4e3SVwLYYDDC7XEDE7rsrz1208DnBDgmNg6KsLDb5YbH6wl9djPA5wRYgwBkvR4Go1kYOXBTwSMKTLD0qvGP'+
		'kypIkgY6oyUM3OvzQplDV48ocMHm3ykOv0agBq5eFKCTwUk8Ir7dbjc0Gi20Oi2aDj4aMfCIAec9uEdxBzTCui6VlNSJfxqG'+
		'pldJkqCVjTBEmcVYK6Bd8LjG0Hrkh/9fwJueKVNGx11o/qTlKqQqimptJewznd4EBATwSBd0Zhtco33ofOdXsw4eEeBn9zcq'+
		'o8ODGB4dQ0f3AOqb7FMgFUy4+sQBBLQmRJlMoJpN4nGOwD0+iCtHn5xV6Ii59OZ1jylylgcZt22BZEpG5aVWXGrunAQ5Ac+w'+
		'Rh7FxFnD1qBmxTHUiZbXfzJr0BEB/tGD25QyfwkMgT4si76CzFQrfEl3AKZFqKxvRVNLe2iuIumgaPQwm03QyUHrwi+aFG1w'+
		'XL3v4S+PhXft2qF0SYk49NvnwzZ19yMvKnXuKO6sJMWHZH0/bk0eRXyMCT7bWjikBNQJa3d29sLhlyHrNDBZYuEdboWn7X14'+
		'Os6jvb1dulF9cwb87W3fV07YvofAROJRXrpLeuqpfcqZMTPa2siKYm2RfTleBXiSfhBF8d2wWhMgpxJ4Ik6er8NYRxWDBsa7'+
		'2LK2zLVYm5qIPx56WbqevjkHPp60LexaivDEO5OMsMky6pvbUNfYJnbmvwouYjhZ7sFy2zDgc6K5rR/1VecFqBH6jPUw5dwF'+
		'SWeErDix0jKA7vfKcazyqDSTPlVuFH7WgUkyY2Uc35aHg6euYNQjo7rBLsDtQXDanCQzuEUZgNlZj44RUa+T1yDGmjpVyWgP'+
		'Mi4fR1nl69KXGvjcY/k4fPgwDBYrurBYgOtQ09CK6svt7N7k7gQuOg5+jYoSFjZEhdaIN0m4Pd2HsZMf4vdvvfjlsPATm9co'+
		'r6btQr9+Udj1vOgATv+giIH14qGBFemj0SPlwxmQ8d+qZlxq6mArBzRGaDUKLDEJPG91lpb/cmwa7rE3bdokXU/fnAE//Z18'+
		'vvmF/D/w+9jAGDy6KBQm6nH00SXYu3cvkpKSwhUK8C7kCnAjLtbaOVtnpcRhZZaGQRMsutDcQCCAo2/8G3/e+4o0nb6bAuzV'+
		'J8C36HYsKcjHxxVVeOS7D4qHAA2ys7Oxe/dumET3ZLVaERsbG3bvhcZmWPPuwfJ0IxaZXRgdHZ26OeHuR147huI1q1FVWQND'+
		'Wzn35r954/LNKUs/fvgOJXXpOixbs4E3V1b2FjZsWIczZ85gaGgIW7ZsQWNjI+x2O7RabRj489UyeowZeKIkGcWmAZh8U4Fp'+
		'b28dfxv33nc3jy8e/xv6R73Y/ZeDcwe8c8cTitFoxPIVRaguP4B192xBfFo+urq6UF9fz3P6+vrQ0dHB49LSUhQXF6OmpiYM'+
		'/BV7IlrkrNC6Zp2CXEsAO/K9yLEE+2ufz4cLFy5gyZIlSElJQfN/jqGlx4mcomK2uMvlCrl7RIB/8ewvlZSUZGTnZHIyKvvr'+
		'Sygs3oBhr8wWVYVcuqGhAQ6HI3TtWvBDzgLYDTlTdDy30oWiuADOnj2L2tpaFBUV8fW4uDjIQ43oc2hQ+s37+dqFDyuELgk/'+
		'f/aZG4b+TMBPP/WMsvFb3+DxwMAAKsr/Do05CZLFNmWuxWLhOa2trdOC7zjSiiuTLKzKVv1FVL65H/39/XyoW7duDX3m72uA'+
		'xhgPW9ZSjIs1ly0rFD24GRs3bowM8HO/fl6hBELy7junkZmVjva2DjicDlFHDdPeMxN4RryCswU/xUe9gbD5ie88B33vJR5P'+
		'Bvb7A3A53UhLT2WdtxWvFhXAJtzej8uXG0SfvWt2s/SJEyd4otPphNfrRU11HYq+thTR0dEYHBzCuXPnRUY2zHj/teCZyhW0'+
		'SlkoXPN1/LOyG22SFYpsQsxHB4TrtiImJgarVq1CTk6O0OlGcnIyW5QO4dSp95CbS+GgYHx8nBParAEfe/ERnqBfsZMXpvKR'+
		'kJDA30FRcqIEpNPp2OK5i7PR092L3t5emMxGztwzgbsaytESSOdrFO9qWSLQ9evXi3UT4XGLBJabjSZRwlSLUqKiB5PoaIvQ'+
		'PyB0a7heL/a8z/ff9+ShTwWfEfhfb+Yr+kERY50JDOv3B/tgg8GAkZERzqC0ObpOm62pqcWKFcsZiE791Mn3BTT94qCIzKyZ'+
		'sr7Schre1BK2eEVFBVuupKSEG5VrLVr25nEsFWOTKUqspRMVoFOsEOASRy7tcjl5TRXauf4otqx1SDcErFqUbtL2p8Ei72Eo'+
		'Ujw2NsbWpBMlcLIygdOY5tB7ajRUiy8rKkRvTx9nZb1BDgP3Nb0L3eI7+YDEs6/IASbhQZIoQfkiXGpDFqXD7OrqhtEYJQ56'+
		'mL8FoV8yqDSSTvIWi8XMlYH2UqirwvDqA7x3v7V9CngIWAVlWTQAZ94ZxI4cYTemP3IlclGKWYpjj8fDSihLkkXpM3pPh0Eb'+
		'uXjxI6xevYoPgOae+eAcAhNPSwSuApM4HC5kZmTyAQXzRTkKCgpErvBAlg2i5A3yPVTDLZZo9jACJ2hZ1vOYDkbVlbr2Z0E9'+
		'AlpfuzLM1aWjLzw8rU+TG5NQgiJAqoMEo8JSI0AW7+3tQ7WwiE6n5djOzs7kjdAB0DyyNnnABx+cRX5+Hlu8q7sL3rYLMGWX'+
		'YPHiXHz8cWXIouPjDm5gbDYbW0+vl9kLXC436yc40tPT08sHTHWY3L9HrOt0jrNuEoKeDPypFlZhCY5OVRYP83SC9EogtChZ'+
		'lSzZKBLKyZOnQgsmJiZi3bpSsYkk3hB5BB1MZWWViMmlvPmamjq2Rk5OsA6Xl7+NwsJCoc/BX9JTXPp8XrGWVdTjAdZJv1Sk'+
		'paWhufmK8KqgO5tMFv4SnxhkWcf5gjyRDoEkI+/lqRaeLoYJmKxDYHSqVEbIUgRMC9I9UVFRfBj79u3nbD1ZCPTxx3fwPbQx'+
		'8hKyCnVj9N5ubxcWTGSLDg0Ni7I2IPR5+ZcHn8/DGdpub+PY9Pt9Ym6S8KR+AR7gNXU6euRU2AMSEuI5kQ0PDzNoTEwsjykE'+
		'KIldm7VnzNIn9uxU/LkPhRKUCk6vlB1pTMnkyJE3OFlcK5s23Yf09HQ+JLqHDlD1DrpP3ezIyChvmMAoH9Ch0HxKkvSeGg6K'+
		'YaPRIP5ME32Amw/Q4/GJfYyHQIPh5sYt/rMzlqfr1uGZwAmyoaERp0+/N+19O3duZy+geWRxgqUxeQVBU09tMpnZ3cm9aU2y'+
		'MtVVq9XGCYtA6TPK4OQJikh6FK+Dg8MM9llAbxj408D37z/ASetaycrKxP3338uuTC5IgGpYEDTF9aVL1D4GM7vT6RKeoGUw'+
		'Sk5kQQKlMVmYQFNSFnFDQyHxeUA/M7AqFOPaou2cJV999R/TunNp6VpuQgiMkptqWXpP4KqFyZUpu5Nrkvj9XsTHx/Mh0mcE'+
		'SvFMYHTfFwH93MCTwSvct4qmoQOf8I9mV2X79kc5/ijBkaUIljYczKymiYZhUBzGmDiMAGdgyu7d3d38GXWkcXHxHPezBfqF'+
		'gSeDN+nXi/LUJJ5aGrl+PvTQA6FMTgC0UUp0dADk5mRF6p8pLqmVpPgmdyWwxEQbQ8426KwBXwtOWfmWW/JDyY3Wp4yrxi8J'+
		'zamrq0Pwf/cEuOZSBzWTRbOX7MHmez//91gRAZ4MTjFOlp1cx0mP2v/SARAwQVKzQfEaKYtGHPh64GTpycBUd+cCNOLAqtBj'+
		'ZpTm5TBwEgImCVo58qBzBqyKanG1CSFgqrtjY6NzAjrnwJPBqVcn4Ol63XkHfLPlf5w5bIhzJ/dRAAAAAElFTkSuQmCC';
icon_map['capital_b_s.png'] = 'data:image/png;base64,'+
		'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'+
		'SUVORK5CYII=';
icon_map['capital_bg_m.png'] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3Ag'+
		'SUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKg'+
		'KLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADw'+
		'A3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4F'+
		'ANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMe'+
		'E80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q'+
		'5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQ'+
		'yDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK'+
		'8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mP'+
		'QCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqg'+
		'EZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPy'+
		'LXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlh'+
		'XIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6'+
		'EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BP'+
		'kvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3'+
		'aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKV'+
		'OpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3'+
		'xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqt'+
		'Zq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83'+
		'MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2U'+
		'a5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1lds'+
		'UBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTD'+
		'qcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY'+
		'4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7'+
		'+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6'+
		'MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xq'+
		'bFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WD'+
		'IEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSc'+
		'lJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuC'+
		'Fny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRa'+
		'uWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19t'+
		'St50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLd'+
		'jxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPc'+
		'w83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8'+
		'mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f4'+
		'1y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJH'+
		'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'+
		'NZtlAAAAAElFTkSuQmCC';
icon_map['capital_bg_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['capital_bk_m.png'] = 'data:image/png;base64,'+
		'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'+
		'mcjFAAAAAElFTkSuQmCC';
icon_map['capital_bk_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['capital_g_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['capital_g_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['capital_o_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['capital_o_s.png'] = 'data:image/png;base64,'+
		'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'+
		'GvBk2/8BxbUfeVQGXUwAAAAASUVORK5CYII=';
icon_map['capital_p_m.png'] = 'data:image/png;base64,'+
		'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'+
		'SUVORK5CYII=';
icon_map['capital_p_s.png'] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAJSUlEQVR42u2Ya0yb1xnHH99e'+
		'G3M195sgkAABQgilSxpNbddGZFWTVrSkk/phalItHyr107RNmrp2mvZtW9R96iZt0T5VjdpKXTJIG0UiyaiIqJI03bgFQrmE'+
		'my+AMcZ3+935P+b1HAMhITZpqB+EbL8+73nP7/k/l3OskmWZvk+mSgJvc0sCb3dLAm93SwJvd0sCb3dLAm93SwJvd0sCb3d7'+
		'JMAfvXuMH/r67z9VfS+Af9NWL796/SNS+SRqmt69pdCPBPhXR2vk12+cvevaVoF/Z4BjLVEOSAIngZPAD27nCzpknVZHLVOH'+
		'VQpwrbmV9k2d2J7AHaUXZQqFKOTz8ueup37Jr39ov6X6unhwzQU81sCdDZfl5SWZfIEAST4fuTVmGqj5B/32ctddUNHwjy3w'+
		'v3LPyT6Nj4JaIq02lXQqQwScQkEe85Lt5S3bfCQc+FzBWdmj9vz/glpDGk06SWrpLnCtVksB8TnR8AkF7nj6Q3n5tpZCqlCY'+
		'VVYT/kQ2MzgU1wjF5UCQUkIBmg3M0huW448n8LWjn8tL8yFamPaQT6iolYWCqgBDR5usUpMkwEcD3wgnhOjnk+88nsCwm+99'+
		'Iqt8arJ0amhu0s3XAByrOIlUnlNZ+Np80bf065unEgYdd+CTP3uLJ6ys3EHP/ugZslotpL0xSPnzFeQakMjcF25NAFUUd4Vc'+
		'5CVXZA7b4es0ptfz+7/9/S9xhY8bsAIKO3L0x5SamkouVxjCbDbza+HUHBXYdpBnWEczvX6+pvFraF5tpVCOm/QvmEneVUFl'+
		'VVW0vLxMHe0XIvPHC/yhgQFqNBqpsDCfautq6IvPL1LbsVay2Wzk8XgYfGJigjIyMnj8zMwMNckS5c1WkutGOo2Vd1PKUyZK'+
		'r67m7/v6+mjnzp2UlZVFn37yGbUcPkTT0zM0cnuUHfiw4JsGBmhaWirl5OQQXuv31PL1zs5LAtLIsCGxu6qpqaHx8XFyu908'+
		'FsoVFRXx2IKCAsrLy6O5ubnIvD09PfyalpZGdrud9u/fT+np6WSxWMV310gn2pfDsbRp8E0Bv/fu7+Sc3GzatauSFhbsZLPO'+
		'UU6uicEAqhjgRkZG6ODBgww+ODhIU1NTVFFRwYrfC1gxgJeUlJBatLHxsQlq3NdAAwO3aPLONKdOS0vLA4FvCvjUqfflvXv3'+
		'8Pve3j6xYNua49COoNLs7Cx/Bjhgh4aGWPHm5mYqLi6OAN+5c0eE7/Sac2FjYjAYyKA3kk6nox0VZSRJUuKBO/70E3nU8KxQ'+
		'rFosdJ4G+gcoNzdXLHaSdJKGVKrVz1er1QwdDQ7FU1JSKDMzk65evUrt7e3siBMnVp+gfD4/K5ydnUWSzhBJH4fDQW1tbYkB'+
		'/ux8FQ+U5D+zt51OJy0uOrgCP/lkM6t55fKXAlr02ZAsto/qVXOsBQ6lT58+HRkTC+xYdNKehj0iMsppbGyM7AsOKi4pEttQ'+
		'Pzu8wdBPPtciHfnFx/cFviEwFGUv131NwZwpksxnOJRQkBBaVquVlUKuXer8N3vfarFxeEp63YbgUAm5X19fT3V1dTy31+sT'+
		'hS9NQO6gr0Shan3lJQoGgzQ6OiaeGyS9PkWMcfM4rVZDtdr/MjRsI/B1gaGotFAu+kg2KcAZ+r9GeqsCjfv1YpOwtLQkFj4h'+
		'crKIWwrsfMcXlCoqeDAYWBcc+YvWhfkQupgvLy+fmpoaeUxX15c8p1gqhzUAFxYWOMrwHlatuhkBhrmfbqdjB1xrgq8CVhTF'+
		'TZq5kjBcfxNJjSdZDSgJb3u9Xl4k1EU1BjzyEWPwPcYB+MUjLwhlxml4+LZYoHpNcLfbK+pAHpWVlXLPTjEYqap6J/dsPMPl'+
		'crNzPB43pwscmJGRxWpbRYfIzEyjSm8XScZMnm+x+UNeOyIyFjwCrICyFc2Te1c3v8WNutD7DAGvQk3kr0YTLlC4jsXg1Wy2'+
		'ioWkU2lpCVdnqIfWg/v6egfI5V4mvz8gHOQU6aBlUJMpi9wuLz33/DP8PBQutLbS0lLRe23ieRI7SfhTKDtP+fn5nPdwuMGg'+
		'J6MxlZ9tsVjoifThCLCydogVHeqq9j++tmZMQ+FMx1kuRvhHJUbY4syKB2RnZ4uitcjgdvsinTvXHomA2trd1NBQz4pjLBb4'+
		'7cgopWcIJSorqb9/kJxLTs53v99P//mml5qe2Cd2Z1ZOh6kpKKvjGgFner0e4Vw1PwugcKrTidSSxdq83KfhHJ/Pw4JUmP7J'+
		'gkUD31thJcfqTzAgJgEctpBYAO6BE6Aw8u/atet05UrXXfeWl5eJHnmIe6eSr1AdDhkR8Hl5uUKtPL42OTnJeet0LnONwM4N'+
		'y0IKIJokSc/PwyZlZmZ2ZZ/uFPcXsLPRCaG2x+MVDvRRVaA7UndWKbxeDseCAw6LhspK7mIR8PiFCxe5YMXa22+/xSrBWQBF'+
		'nmOOMZHTfvzaIWlXCpFOpMMMh2sYVMOOSEkJb1ER9ksiIrAGtKPMzCx2OnZthYUFfA+iqyZ0ddUaYqv2ulX64gcn5ejKp4AD'+
		'EntbJZxRUM6c+ZjBow1j3nzzDQ5ZgMJByrYTDhsaGuaIwfERoMhRrCUUCggwDRcoRIfiMFkOib14Lj9vcdHOoC6Xh8fdD+iG'+
		'wNHgHB5R8ADH4pHHPT1f0aVLV1bd19i4lw4c+EGk0GE84E0mE7/HvjotLZ1TBgZVg8EQV3yAIT9xSFCpZD502O0O8d2SqORl'+
		'fJDAfRW7Pwg7MCpPN92H71fxzs7LvJ+OtdbWl1kFREFYubDKSnijTQUCaF9GLIOdoF859KPQIS81Gu1KVQdouQjhab5e9sN3'+
		'VhWkuO20Ym2tHO9eqObFmM3hn2kQsseP/5TDGkVHyX+EZ4BzV+L2o9cb+HM0LIoPwhZVGaBFRcWcn0iZBwnduAFvBI5ww9Hv'+
		'0KHnuB1B1XCuuyJVHe9RXVGYFFA4B+GM7aJb9GtU4PDn+IA+NPC9wJV2BiWVPowwxuKVood9NM7ScA5UxabF7/fycRGHkniD'+
		'xg34fsChMIqXUrHhCPyUA1hUZ4SuyZS9rqLop6+8OPzd+E3rQcCRw1Ac4NhAwAnYF6M6J0rRhAPfBS725MppSwFXChgOCTgI'+
		'oKihvcRuAeMNmnBgxWKPmQr44OAtqg5280GFbeX7RIFuGbBia4V6tCUadMuB1wPfKtBHBvyo7X8YE+dqGMWV6wAAAABJRU5E'+
		'rkJggg==';
icon_map['capital_r_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['capital_r_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['capital_y_m.png'] = 'data:image/png;base64,'+
		'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'+
		'TkSuQmCC';
icon_map['capital_y_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_b_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_b_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_bg_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_bg_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_bk_m.png'] = 'data:image/png;base64,'+
		'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'+
		'rkJggg==';
icon_map['fort_bk_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_g_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_g_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_o_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_o_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_p_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_p_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_r_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_r_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_y_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['fort_y_s.png'] = 'data:image/png;base64,'+
		'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';
icon_map['village_b_m.png'] = 'data:image/png;base64,'+
		'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'+
		'AAAASUVORK5CYII=';
icon_map['village_b_s.png'] = 'data:image/png;base64,'+
		'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'+
		'484AAAAASUVORK5CYII=';
icon_map['village_bg_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['village_bg_s.png'] = 'data:image/png;base64,'+
		'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'+
		'/3b+BO7DXFsWRKoHAAAAAElFTkSuQmCC';
icon_map['village_bk_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['village_bk_s.png'] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAG+UlEQVR42u3YbWwTdRwH8O/d'+
		'9Xntuq6WbWU4GONhEJAHAwE0EAKJwgyiYoyEF75wRnlhYjDxjYEE4hsVEhIkQkgkBGIMEdEhLO4FQeWZoMB42gMbW+m69WFt'+
		'116f7s77H1y5dS1j0BZT+n1z7ba7+3/u93+4/yhBEPA8hSqCCzxFcKGnCC70FMGFniK40FMEF3qK4EJPEVzoKYILPUVwoacI'+
		'LvQUwYWeIrjQUwTnI+sW2YVA6Sw0NzdTzw2Ytc5Lfm9qasobPO/gP777UNhz4BiU4HzC8wY+9s27gsZglj4XNFgJlUPAXkM9'+
		'9Hr9sJ9/uqoKKz/Zm1N0zsAESo6pWBlMklplApaTK3jWwanQoYknpaOxa5l03P5bL4LBIKq4TjRuWD3q9bINzxpYhiqxJP75'+
		'B7Fvy1LpM7lXPB5HJBLBhBlBlFwI4r3GFY91/WzBnxqshKaCSTXJ9SmKQiwWQygUQiKRAE3TaFjgwcUZNljORKC66h8VHgv7'+
		'pePqTT89FfyJwekmIxJS0R2fzYXJZJK+R6NRCUrQ8r14npfQa+YP4JQ1CmuHFkaPAVx/OCNcBst5UviYwZmgJGS8clYHvm2c'+
		'Da1FJ2FJF1ZGrrhZXQLt2z3QOO+CZsQeMERD766AzWNB1BNIwgk00/3I78YKf2zwkd+nSH9IQPr2xdD4J6UF/7xxHF6Y1Iuz'+
		'rF3qxqSSSixZimYO3MWiNbXYXz2A9do3IZij+PXsDvR0cLDH50AV0cEisGAGR+/qY4WPCpbHaGzGZQlLkg78454WMEYdtDYG'+
		're/rUXs+gOt/WyU0qaharZbAOkGF2sAtbP1gMo7ry8iFseHjLdi183NcvX4R3V0GsaIlCIfDMFFx2KgQaF9gBDxmviMd5XY8'+
		'7hjPCCYV1fhqAGc5UsGMZ3xymZGhBqsVOnMZrs3rx1AFDy2tBhOJYtkP49GPLvR4yjFkVGHjEjMOn72CtZu2wcOchNfdgxpq'+
		'FtoudUEtnnf935t4a/2X2L13P7xeL1R8FC/bTYj4fcO6urzckZC2KMc4+2oT3lkYTgsfAZYrSk4iMOkpXp8rjSMyIckhVT62'+
		'xwlNmUWCsj4vWLcHNz4yQOAEMDpGOlrjpVhxNIzAtOWYWc/A53PBw7lQubAOgjYMLhBH6LwHfXo3DFM4OE+EsXXbCbTfuIrd'+
		'u3fBfatVHAYm2KurwEVYaPgIBrpceP17V7It5kvrh4110k7SdlKgVHgSPGx5qRIbX3c6Wc10YHKT7rsxOHsccNzphbrUiLKp'+
		'GgyUsug0x8Ha1IiFEuDiPDZTy2GrVKPVeg7xSxYIQRq0gQEtPhQumIC23gTNiwaEWC/cV/owLlENLaoQZIdwrf00EnENPNc8'+
		'mFU/GdUTJ+DMiVPDwPo/G0as/cq2K7s61fT1urR9mlQ49SQlmoCPHDyFmqm1sFaMg8vtQBvVipgxhrrZE+BRqxDqiqIiqEJN'+
		'zTxUzipDwHgcMbFKfPN0cWwDt4fuYJB2Y4lxMZhSNXiWA2PVgLdz8Abc4Fx+xDga2i4LKsqr4XH1o/t2J6KhGBq+UiWHGGlL'+
		'cmyTrv2gYMq2P7rC8sniuJW7tAyWxw8ZNx2dYbEBHfB7fEm4w9WNm4krQI0KcxbUghvixTF+f6bWGRIwiB8vHB5EH90LjZFD'+
		'LCpgjnEBal+qg7r6/maCd4ewd1sX4hQHnU6H1ybqJKjZahHvMxkXWk5LFZa77Qiwov0jKpxpDGeKsuu0tYdgKDEgwrIj4D33'+
		'utHODsBPmzD9FQG2mvtDqf2aGxdOd6B6MoPGN7bD3+1CtLxF7OoVoKkEzrXwuAG/NLOTJY28pKy0CKiqr4VOXNJYNoqLLX8l'+
		'u7RyAk19OVFCR1Q4NWSjnu4CqWiH8+H56eAO5z20OocQNAmYuwooFzdEtw9EUWa0YNvOozi0ZzP4Jb+hf58fv1yulaAMw0hL'+
		'WAmnxrKZ4oRlr0jew9hwaFhb0nXbdNBRwUp4uqeX+vYzKvyeA/84XVj2RRB0vxXRXi3Ms8PoO1MGpi8GXUgPBz0R5ztvo4TS'+
		'oWGxGgHPICjYUFVpw/gqSlp7lZNpsi0K8BOvw49T8XSvfKPB+8XJLT7Fi2hAQBlvQrkwKTkZkTFqsVPQl5pB8eJg5xlMq6tM'+
		'Xu9RE1LW3rRS86jd0Vjg3gE3BHF8KicjMkb9/h4wKs1IaIbk7F0623BdiR5acQaWoXJI11UmEzZvu6Vswf2+QVTYH/5LJ9fQ'+
		'rIEfBU99AGT99p9ZCr/XJ83ERnOpNOvKS0smJFlP165q+3/8x2Ms8NRXVuVmJN3SQvK0Fc05eBhcBMq7LTnyrotsPkgyvQJm'+
		'G5pzsJzUbaYU5YMgn0kefM8VNG9gOaO9suYamndwJni+oM8M/KzzH3ynWlv9nw58AAAAAElFTkSuQmCC';
icon_map['village_g_m.png'] = 'data:image/png;base64,'+
		'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'+
		'ge93/A/JKHRqKQ9W3AAAAABJRU5ErkJggg==';
icon_map['village_g_s.png'] = 'data:image/png;base64,'+
		'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'+
		'AAAASUVORK5CYII=';
icon_map['village_o_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['village_o_s.png'] = 'data:image/png;base64,'+
		'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'+
		'AAAASUVORK5CYII=';
icon_map['village_p_m.png'] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAImElEQVR42u3ZCWxT9x0H8O/z'+
		'fcV2LickmISQhHTlKLCspFBaCdjUUG3rWCohsXWr1K3rNm3qJo1N6ia0Tu3GtQl1mtrBjm4qa6fRNuFYSw9axk0JI0lJyB3b'+
		'sR07iR0/H+/c/z1jYyecIQnM+Iciv9jvPd7n/X6/////YkoURdxNQWXBGR5ZcKZHFpzpkQVnemTBmR5ZcKZHFpzpkQVnemTB'+
		'mR5ZcKZHFjxT0VBXIr5xzEXdFWAJ+6KzHfP6c+4e8G+druTvpf2YMfgdAU6N6cbfceDpRmfBMwXe5P0QxWz13QOWXm9HH884'+
		'+N3fPyW+/Oo+efsb61di3Y9fl3HOOUheSEaA9219XKzbtU3eblJtRaPpDRmciAR8umPawalQVmAxHB6Gn3XjD7XPQjPAYsO3'+
		'1qTtv/aZV/4/p6VUqMiLBOqHJ+yFKPAwiEb85oUfwnBKBVpJw3Q6MmPwKQenZZRj4Qq5wERiiJB/UiihAA8BMHVh269eRURB'+
		'ofwg+eDiKASGm3b4lIGH7xlInijM0QiOBeGNeq+6P0dxiFk+wUubmyCeaIYpVIK84Tzw3si0wm8ZLGVUenXuqEWtYhWULI/h'+
		'6HDycymjUkhZlbZjFBO/QYuOYM+GdxHyu5EbGQHPiaCDvAy3jFoAN5MGZ8IB+fVWB7dJgyWoxmBJ/n5kiwcLAutRKORfcX8J'+
		'G6JoKEpGsJfeirrvPoJdxUcgtvtQw1kxGG6B3qQgPQ442ilUKxdBFaCgCMRLff3G2rTzTRZ+0+DxUClOvsCi5cnjqP4whi82'+
		'/wljVCjZq1LpqkQVhFI/1PpuUC4Ov9TtxE++vA4tuv/g9aga2xt24N6FD+KVv/0Ib5/4C7wOATZuHpmY7VALDAqUDAyhiT0u'+
		'Zf1m4TcM3ru/St6Rz3dC3/kANIG5eO3lQzDqLIjer0P3KgEKUpIPvO3BusO74RcD0It69KsuoLTCC61DnTyXBN79RD34CIcd'+
		'9HmsqH0cX3j0OxjobMNL25+DRWvExx1jyMnNh0KhQDQaBRulUaLhYLxF+HXBiR5lPnNWxkqx/9tF0BVYYCywQanRoLXWB7qY'+
		'BxvmkGsyIqc/gK/v+hp8a8/ir2/tw3PR78vHcbNGEP7KGH636y08sfl58FQYDqoJ6ogJVdrliAYYtDX/FxFhDK6AEw+tfgZN'+
		'B94Hywsy3ON2o6bICKsQRsQ/OqkevypYyqhmpAwYzEMC3PgzLg3K0CH4OS96G/Sk90T5R2NSETiPeUIJHh6ah57dH2GN9mEE'+
		'G3zgy2pAw4dPzp3A8vp1UJsoBPk+xJgQooeDGOUZeJw+FK/RoO+wF1ueP4Lje36O1oANe958B9yIG1WlRSizF0PgeUSGfUl4'+
		'ao9HHmzCV+8PUzcETmRUOkjpL5Xf07QtwdFjg6BZETqrVYbSHi8EloWwJA9dS1lEyLbWpIZCrQATYuXjGug6bDgQhudRCp+q'+
		'8hFw90AgCw9Vvga6+6xQ6JXxm9lDyz/qlQYEaTdiLI2eg0PYWL8JNfetwvkTH6C/+wLeebORTHcCKfEY7OV22IoLESPTX55J'+
		'i57znclsB5b9Xb52qSLHw5PgBFSOWcOIVB6VN6UDJfBQwIxoOIL+rh54XV4Yi2wwllpJn7oQLNLAo4ygs4RMQaJUXhw0vArL'+
		'lBX4prYEfvK+o/AsuAsF4LqFK1aUbrEFGrtB3pYy7unqg3k0l5w/F2LMTN5jceLUIVR+3o6h4zwcrQMom23D/Joq6Ax6fNT4'+
		'Xho49dpTS51q2tJwxZqWMpx60KGDHSirroA1P0+Ge4JOjNqd6B/1oERrw+zFefCpyJTijIKLiJivNEBxLoqVT/4Unpw/ktH6'+
		'Ihgy12rcixA9HZ+bpbV1R6gHSpLoe8zzobTGBzYhwkMk1YQCiowNwwgPcqTfOejtFMK9MSg7c2BT22XoqH8YfR3dCPgCMlju'+
		'5UsJSwVfO8OXQurbREmfPuWFs9sJo8WYBu8daUeH0ArWLGJu1WyUlhUQiYhQBwPTvdr4TSM3wpw7RpIfgNpvR+ioVYb2MD3Q'+
		'5PAwk1F5mW4FrEuK4v+xmoLSfHlUH2vuhH5nEXKFhXDVt6RB6QBNZoFS9LX3XQanXP+EDF+th8eHVNIcxxF07xXhfaPtaIu1'+
		'IqhSYPW6hVBrJ56DDLSInVHjg65TMBeRsteSlVdEQMQnYoVtOYpybdBW50A9Wx/PtI8G++sRzGn5HgqEYlLeKgwsfg/7tH9O'+
		'QksryqFSqeSSHr84SYVeddBKhPSgnnq3JHAirgVvd7VjSM1hwGFA+RIOVcsVafh/7momCxIGJeUKLK14BE83bMGBvdshzm0D'+
		'czIHFKcGRUpdeTqK0lM/ICu3EhhFHVnIkBFdGUKzdT9cn/s4CU1EoSV4Teh1walwuTwu4W8U3usdRKuTQZCstiR4+RIFDORQ'+
		'afRV8lIJtuO1fzVDqzdh55aNyKtvQywQQ2ibFUuPvYgcoUCGyr2uYtA9uxFNpn+g7qHlaVBL3eG0Pp30PDxVGe8j8HP9NKJ6'+
		'Bmue0oIKO1A4tBYnD5zBY5s/C9ZVhGNn3sesFWRO/4UAXaEZq0c3wdQ2D6w6Bm/1v9G6eD9iZJF9sYvByrqlk4LeNDgR43v8'+
		'RuHdrl5oa8nysHYEGClHy54+LHtWA1+HBtFjebBpLo+6nk/7sMb1NDq+tJeMmPFsRsdCYGIKLKjMS7ueaVtLTxXcSzsgLggi'+
		'5ImhUG+B2V9xxVE3p1ABQWSgMRilZ0uoDfGBYI5VNynoLYNvFe4ecKJ8fuUEaGIwGhsbJGCeTFuaKYFOGXiycI/DReDRCdBE'+
		'pI660nz6WP3FO+MvHpOFC4IAe6V90tPLHQNOg5MlXuJpazx8oLMbc2suf9Uy3dBpBydi/GNm4iHE7SA9XF2Jwpre+I6XPp/u'+
		'P8jP6DcP1/o8Y755uB58pqC3DXy743/VIYBqGiDxaQAAAABJRU5ErkJggg==';
icon_map['village_p_s.png'] = 'data:image/png;base64,'+
		'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'+
		'Dfxv50+QI2JbIHQCpgAAAABJRU5ErkJggg==';
icon_map['village_r_m.png'] = 'data:image/png;base64,'+
		'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'+
		'8xpvamkX6KsAAAAASUVORK5CYII=';
icon_map['village_r_s.png'] = 'data:image/png;base64,'+
		'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'+
		'VlsH5sNBAAAAAElFTkSuQmCC';
icon_map['village_y_m.png'] = 'data:image/png;base64,'+
		'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';
icon_map['village_y_s.png'] = 'data:image/png;base64,'+
		'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'+
		'9R9zx0dbJIhfkwAAAABJRU5ErkJggg==';

var root_icon = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAAXNSR0IArs4c6QAAAAlwSFlz'+
		'AAALEwAACxMBAJqcGAAAAMFJREFUaN7t17ENg0AMQFGbDSgoWSTrkLFgnSxCSZERLkVQJCKR'+
		'QGKfbOm/igKJ+xR3ZxEAAAAAAAAAAAAAAJCf1vhIKeV2aDGql7TB75HLPD0f7tfti+0oIiJd'+
		'P1SJV8/Q3chP2nETbx2uHrHLPJ2L/BJuGa0hYx2jNWysU7SGjnWIbizW4xq7bnqvDfBPjWRh'+
		'9EPzBK/ndYjgrh/MFnTkbGaX5hzmplXxLn02PNNd+qdpaWdiSjMtRZ+HAQAAqnkAv9l3FuVV'+
		'5wsAAAAASUVORK5CYII=';

// 兵士構成
var solname = ["剣","槍","弓","騎","矛","弩","近","斥","斥騎","衝","投","武"];
//faraway 7.NPC砦、領土情報検索ツールのソース(bro3_npc_castle_info2.user.js) 変数部 終了

//faraway 11.書簡送信アシスタントのソース(bro3_Send_Mail_Supporter.user.js) 変数部 開始
//グローバル変数
var VERSION_11 = "0.4.1β";  //バージョン情報
var INTERVAL=1000;  //負荷対策 回線速度によっては正常動作しない時があります。その際は数値を増やしてください。1秒=1000
var HOST = location.hostname; //アクセスURLホスト
var PGNAME = "_MailSendSuppoter_"; //グリモン領域への保存時のPGの名前
var DELIMIT_11 = "#$%";
var DELIMIT2_11 = "&?@";

var SENDTFLG_NEW = 0;	//新規作成画面
var SENDTFLG_PRE = 1;	//確認画面
var SENDTFLG_END = 2;	//送信履歴画面
var SENDTFLG_CON = 3;	//新規作成画面連続送信中

var ADDRESSCNT = 36; //アドレス帳のカウント(ソース変更必須)


var d_11 = document;

//faraway 11.書簡送信アシスタントのソース(bro3_Send_Mail_Supporter.user.js) 変数部 終了

//faraway のソース() 変数部 開始
//faraway のソース() 変数部 終了
//faraway のソース() 変数部 開始
//faraway のソース() 変数部 終了
//faraway のソース() 変数部 開始
//faraway のソース() 変数部 終了
//faraway のソース() 変数部 開始
//faraway のソース() 変数部 終了
//faraway のソース() 変数部 開始
//faraway のソース() 変数部 終了
//faraway のソース() 変数部 開始
//faraway のソース() 変数部 終了
//faraway のソース() 変数部 開始
//faraway のソース() 変数部 終了

//faraway 12.書簡同報リンク変数のソース() 変数部 開始
var num_12 = 6;	// 設定する個数	faraway110606 num->num_12
//faraway 12.書簡同報リンク変数のソース() 変数部 終了

//faraway 13.書簡保存＆検索ツールのソース() 変数部 開始
////////////////////////////////////////////////////////
// 変数定義
////////////////////////////////////////////////////////
var d_13 = document;
var $_13 = unsafeWindow.jQuery;
var $xp = function (xp, dc) { return d_13.evaluate(xp, dc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); }
var $xp1 = function (xp, dc) { return d_13.evaluate(xp, dc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; }
var location_inboxURL = "/message/inbox.php";
var location_outboxURL = "/message/outbox.php";
var uneiLimitTxt = "ブラウザ三国志運営チーム";
var pageUnit = 12;
var worldKey = location.hostname;
var hrefArray = []; // [[書簡ID, URL]]
// 以下、GM変数
var syokanIdArray = [];		// キャッシュ済みの書簡IDの配列
var soushinsyaArray = {};	// {ID: soushinsya}
var atesakiArray = {};		// {ID: atesaki}
var kenmeiArray = {};		// {ID: kenmei}
var nichijiArray = {};		// {ID: nichiji}
var opValues = {};			// {autoCash: true/false, uneiLimit: true/false}
//faraway 13.書簡保存＆検索ツールのソース() 変数部 終了

//faraway 14.トレード検索条件記憶のソース() 変数部 開始
//faraway 12.と重複の為　
var num_14 = 6;	// 設定する個数 faraway110606復活	111012 num->num_14
//faraway 14.トレード検索条件記憶のソース() 変数部 終了

//faraway のソース(17.bro3_Auto_Bilder_nokin_custom) 変数部 開始

var credit = "nottisan with nokin + ceri + kiri";

var nxTime = 30000;
var tidMain;
var tidMain2;

//寄付用
var OPT_RISE_KIFU_MAX = 10000; //寄付を開始する糧の量
var OPT_RISE_KIFU = 1000; //寄付をする糧の量

//市場用
var OPT_RISE_MAX = 30000; //市場変換開始する糧の量
var OPT_TO_WOOD = 10000; //木に変換する糧
var OPT_TO_STONE = 10000; //石に変換する糧
var OPT_TO_IRON = 10000; //鉄に変換する糧
var WOOD = 101; //木の内部コード
var STONE = 102; //石の内部コード
var IRON = 103; //鉄の内部コード
var RICE = 104; //糧の内部コード
var OPT_TO_CODE = new Array();
OPT_TO_CODE["wood"] = 101;
OPT_TO_CODE["stone"] = 102;
OPT_TO_CODE["iron"] = 103;
//新規作成用
var OPT_KATEMURA = 0; //自動糧村化オプション
var OPT_TORIDE = 0; //自動砦化オプション
var OPT_SOUKO_MAX = 1; //倉庫の最大数

//内政用 by nottisan
var OPT_DOME = 0;

//グローバル変数
var VERSION_17 = "1.5.17β";  //バージョン情報
var INTERVAL_17=1000;  //負荷対策 回線速度によっては正常動作しない時があります。その際は数値を増やしてください。1秒=1000
var HOST_17 = location.hostname; //アクセスURLホスト
var PGNAME_17 = "Auto_Bilder"; //グリモン領域への保存時のPGの名前
var TIMEOUT_URL ="/false/login_sessionout.php"; //タイムアウト時のURLの一部
var g_MD_17="";

var SENDTFLG_TIMEOUT = 0;	//タイムアウト画面
var SENDTFLG_LOGIN_MENU = 1;	//ログイン画面
var SENDTFLG_LOGIN = 2;	        //ログイン中
//faraway110523同じ宣言があるためｺﾒﾝﾄｱｳﾄ var d = document;

// 保存データデリミタ
var DELIMIT1_17 = "#$%";
var DELIMIT2_17 = "&?@";
var DELIMIT3_17 = "{=]";
var DELIMIT4_17 = "|-/";

//保存データインデックス（拠点）
var IDX_XY_17 = 0; //座標
var IDX_BASE_NAME_17 = 1; //拠点名
var IDX_URL_17 = 2; //拠点URL
var IDX_ACTIONS_17 = 3; //実行中作業
var IDX_BASE_ID = 11; //拠点名

//保存データインデックス（実行中作業）
var IDX2_STATUS_17 = 0; //ステータス
var IDX2_TIME_17 = 1; //完了時刻
var IDX2_TYPE_17 = 2; //種別 C:都市画面、D:内政スキル、Fxy:施設座標
var IDX2_ALERTED_17 = 3; //通知済フラグ

var OPT_CHKBOX_AVC = 1;
var OPT_CHKBOX_AVC11 = 1;

var OPT_CHKBOX_W = 0;
var OPT_CHKBOX_S = 0;
var OPT_CHKBOX_I = 0;
var OPT_CHKBOX_R = 0;

var OPT_CHKBOX = [0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
//faraway110608var OPT_CHKBOXLV = [15,15,15,15,20,10,10,10,15,15,15,15,15,15,15,10,10,10,10,10,20,20,20,10];
var OPT_CHKBOXLV = [15,15,15,15,15,20,10,10,10,10,15,15,15,15,15,10,10,10,10,10,20,20,20,10];//faraway110608
var OPT_MAX_LV = "2";
var OPT_FUC_NAME = ["拠点","伐採所","石切り場","製鉄所","畑","倉庫",
                    "銅雀台","鍛冶場","防具工場","練兵所","兵舎","弓兵舎",
                    "厩舎","宿舎","兵器工房","市場","訓練所","水車","工場",
                    "研究所","大宿舎","遠征訓練所","見張り台","修行所"];

var OPT_FNID = new Array();
OPT_FNID["拠点"] =       0;
OPT_FNID["伐採所"] =     1;
OPT_FNID["石切り場"] =   2;
OPT_FNID["製鉄所"] =     3;
OPT_FNID["畑"] =         4;
OPT_FNID["倉庫"] =       5;
OPT_FNID["銅雀台"] =     6;
OPT_FNID["鍛冶場"] =     7;
OPT_FNID["防具工場"] =   8;
OPT_FNID["練兵所"] =     9;
OPT_FNID["兵舎"] =       10;
OPT_FNID["弓兵舎"] =     11;
OPT_FNID["厩舎"] =       12;
OPT_FNID["宿舎"] =       13;
OPT_FNID["兵器工房"] =   14;
OPT_FNID["市場"] =       15;
OPT_FNID["訓練所"] =     16;
OPT_FNID["水車"] =       17;
OPT_FNID["工場"] =       18;
OPT_FNID["研究所"] =     19;
OPT_FNID["大宿舎"] =     20;
OPT_FNID["遠征訓練所"] = 21;
OPT_FNID["見張り台"] =   22;
OPT_FNID["修行所"] =     23;

//市場変換処理用
var OPT_ICHIBA = 0;
var OPT_ICHIBA_PA = 0;
var OPT_ICHIBA_PATS = ["平均的に変換","一括変換","自動割当"];
//自動寄付用
var OPT_KIFU = 0;

var d_17 = document;
var $_17 = function(id) { return d_17.getElementById(id); };
var $x_17 = function(xp,dc) { return d_17.evaluate(xp, dc||d_17, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $a_17 = function(xp,dc) { var r = d_17.evaluate(xp, dc||d_17, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); var a=[]; for(var i=0; i<r.snapshotLength; i++){ a.push(r.snapshotItem(i)); } return a; };
var $e_17 = function(e,t,f) { if (!e) return; e.addEventListener(t, f, false); };

//LvUPリンク
var LVUPLINK = "http://SITE/facility/build.php?x=urlX&y=urlY&village_id=viID#ptop";
var URL_SITE = "SITE";
var URL_X = "urlX";
var URL_Y = "urlY";
var URL_viID = "viID";

//新規作成リンク

//var CREATELINK = "http://SITE/facility/build.php?id=fID&x=urlX&y=urlY&village_id=viID";//2012.4.24 VerUp対応 ひろひろひろ
var CREATELINK = "http://SITE/facility/build.php?ssid=ssid_val&x=urlX&y=urlY&village_id=viID#ptop";//2012.4.24  VerUp対応 ひろひろひろ
var URL_SSID ="ssid_val";//SSID ;//2012.4.24  VerUp対応 ひろひろひろ
var URL_fID = "fID"; //建物のID
var HATAKE = 215;
var SOUKO = 233;
var SUZUME = 216;

var VillageData = new Array();
var OPT_VILLAGE_17 = new Array();

var isMixi_17 = true;

//faraway 17.bro3_Auto_Bilder_nokin_customのソース(bro3_Auto_Bilder_nokin_custom) 変数部 終了==========================================

//faraway 18.全体マップ移動距離カスタムツールのソース(bro3_change_move_size.user.js) 変数部 開始==========================================
var DELIMIT1_18 = "#$%";
var DELIMIT2_18 = "&?@";
var VERSION_KEY_18 = "vtA101";
var VERSION_18 = "1.10";

var BASE = "   0   0";

// 共通関数
var d_18 = document;
var $_18 = function(id) { return d_18.getElementById(id); };
var $x_18 = function(xp,dc) { return d_18.evaluate(xp, dc||d_18, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $e_18 = function(key) { return d_18.evaluate(key, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };

//faraway 18.全体マップ移動距離カスタムツールのソース(bro3_change_move_size.user.js) 変数部 終了==========================================
//faraway 19.都市画面内政武将表示ツール(βバージョン)のソース(bro3_display_adm_info.user.js) 変数部 開始==========================================
var DELIMIT1_19 = "#$%";
var DELIMIT2_19 = "&?@";
var VERSION_KEY_19 = "vtB100";

// 共通関数
var d_19 = document;
var $_19 = function(id) { return d_19.getElementById(id); };
var $x_19 = function(xp,dc) { return d_19.evaluate(xp, dc||d_19, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $e_19 = function(key) { return d_19.evaluate(key, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };

// ゲージアイコン
var gage_icon = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAAFUAAAAGCAYAAACy79IDAAAABnRSTlMA/gD8AP5/ebwCAAAGK0lEQVR42i2V6W9cZxWHn7vNvtgz'+
				'k/HEcbwkTt04i9NQUpxiXCelAtSkKoIIFCGEEEJIIL7xib+C70iUIESjEKqiBtGUtGRtCU7iOIkbN3HiLa6XsWe9M3fu3PtyZsJ8'+
				'u++cdznP+Z3f0fymT+s3cXtUpcwOdAMsBaoOWgNCEQhYGpqr4W4pTB06MzqmxNTlu1GU720aqU7Z6CjW5nwsiRnYY5IIQX5Fsfi5'+
				'x84dBvtHDCw0bnzYpCx73zxhkZN9qwsely669G43+PbxEEruvXGtwfJ8k7GvhemTs+obcPnDKpGAzuirUYygxvy0w+M7dQZ2BxkY'+
				'loc6Gnc/LuLZHgdHUxKjU15y+PKBTTIdIDsYA8mj8qSKs+6Q2BnHigfxKy7Fp0V8pdHZE0U3NQqrNTa2aqSSQVIJC+V6PFixcTwY'+
				'kbMMTXKtNJkuN+kWPnubZdTZf2stltoP755SV+qfcDx6DL0psIRNC5ze+teWgKaAjWpYhsS70NhUBOWQZFrDlJBaXlEXsJmsgE0b'+
				'uBXFymOPsCS/50WdiCS2Nu+z9Mhj77BBX6+BLufc/rSJLfvGxyx2ZnWeLSoufeTQv8PkmxMhfFdx47LL6pLLq0fD5Potams+n31i'+
				'Ew/rfOUVgShvWpxusDhbp39XiO6BkABVPL5VbRd4YL9ACxvYq3LOvTLJjADanZA8FKXZEkqAxHoTGBELr9KgsFhGE6CpXFQSV2yu'+
				'19ksOqQTATpjJs2Gz0NZ85RiOGlJ/j5rdZ87ZZce2Tc8+THOkXGRzWVU2owR0yIYUsVWwgEBGwgIXE/DKyp0TyfZqbXXVU1RE/VF'+
				'IjpdPQJbCrE57+GWoX+3QUZgV9cVC/cV6Q44cMgiKaqau9/k0ZTP2LjFviFdCqjx7u8bokrFL38WIR01mZp0uPC+w1dHgrx9Mkxl'+
				'S+PC+SrF1SYnTsbJ9VgsCMSr/7Dp7w8wOhZB8w3uXauwOFXnyLEO0rmW8nxuvrcpHaNx+PWMKEQnP2OTv1ci0x8TsEm8kkd5ehNN'+
				'4McGOjDkfnerzsoXBcLxANu6w+D5LCxVWRWwfZkQWQHrVD2urFQxNY3X0iIrX3Gv5DJZ9jgk7T1SLjyHKvwwpJ11absW1KDVanmx'+
				'AZG6tyVr4hAdaZ1gC6oosbqsiMc0tvdJOwucdVGhW4LBIYOsqK78TPFEAOYkn5GXpcphjYe3msxOerz+RoCR/Ua7Vd/5nSNQFL/5'+
				'VYRs3OL61Trvn3MYHw1x6u0w5TycPVOlvOFx6vtxuvsCPBbwl85XGBoKMTYRkwR0bl2sMH/bZuxbKTI9otaCx/W/bBAQ9bzyZlcb'+
				'6tqdChtTRXKDSVIvCNRCk8KtTQzHJzbUiSlqdfI2yzNbRDuCdO2QTvAUc09KrAjUwWyYroRJTazio4WqsNB4IyOQRLWThQb/kSKN'+
				'Sh0ORcXgvnf3u+rc+nlEeHKB3oYZkAKYkqxfEkWJkuKdOiF5IHWFLcCioecqDUhKpQWf6oaib5dJ93YdW+zhyX+bJGI6R0ZFpWId'+
				'c3d8Zm42mThuMbzXRJcWvXDOxRZf/fHpEC/2msxMeZz5Q5WX9wX5yY9iuLbP2T/VWJh1Of2DOAMHgmx94fG3P5bIiUK+czIpVdeY'+
				'+meVz2/aYgdRBvfHaBRg8gNRoMyElyZSBAVE4aHD0yubZPsjdL+UaVvD+rU11FaT9IFtGNLejQ2btQeb6GJb3Xs62gpcmi/xbM2m'+
				'Nxchlwzg2C7XBagvIL+eDRJUPo/EQv6Vdzggg+io5OP89tcilP8PKv2irhIBrV1dq7VQaU0inVhcERJf1EVZzqoMIRHZNhkowpXq'+
				'l+Kna0oAC+Tu57Dmp5tymc6+wyaZhNYeXDOfeQzuMhg/ZhGUQvz9TIONZZ+f/yLMrpzB4kOPP5+p84LA/elp8TNR/wfv1Zi96/LW'+
				'iSgHDweprvj89Z0yUXnjybeSWFGDmas1bl8qM3wwyqHRuLxX48q7eZyixzdEoYGoLoWo8/RGgXRXiN7DnQLUoHC/iC1w0kMCPRUV'+
				'i3PIT6/TlJSze5KYgdYcqLC8UqYrE6Y70xqeHp/OlSi7Pq9tD4sVCnRR6OV8g37T4+junajrT9uD6n8kQMHfz+X6+wAAAABJRU5E'+
				'rkJggg==';

// デッキアイコン
var icon_m_19 = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAFUAAAAXCAIAAAD1B5RqAAAEdElEQVR42mNkYGDwN83KLorn5uNkGDHg66fvU/sWbjw9jdHHOL2y'+
		'KZsJCJgZSTWFkZFkLYMB/P///9/f///+/euon8a4fclxPkHuIeoTSgDQ/58/fGM8vOnifzCghR2nD1/xDLN58/zDQHsWC2CEgEMb'+
		'L/z+9YdsU54/fs3Byc7Jxf77N8gQdg42IPn183dRSUE7f4NF3dviSr1mNa1X0ZKj3MX8QjzGTur71pylVhCwsrEwHtxw/uf3X//+'+
		'kRn/7lHmeGTP7L3x+vn7d68/iogLUu5cBXVJdWO5bYuOMbMwU8X/nNzsjAfWn/vx7RfZ6f/FkzcSMiIQ9s8fv/78/gthA5OAmJQQ'+
		'VVwJBzpmyjKqoncvPb1y+i7EImAq+/blB9kGcvFwgPz//etPGuV/PACYKPQt1B7ffYlHDTAEgQkevzlfP/44tPk8Rf4HBuF/ctM/'+
		'Gd5++fytpp6SgoaUlpnC8om7+AV5IFL2/kbHtl9CLoy+f/tp72f06sl7aHDICIpI8b959vHo9ouQ+H/76oOMgjjZjgE2eRj3rz0L'+
		'9P/fv//I0O+baEOMss3zj8DZTkEmQHLfujPAgjOtLvDi4TuP7rwAity6+qC4JwaYtq+dvY/LnF8/fwdnON48++jWpUdUiQxQxQ/0'+
		'/+eP38hL/9IKYpw87HAuDz+nnDooNoBOZGFlhkQRsI599vA1XA0wSVt4aAPrBQFhXudgU25+jk3zDjOA2yT+yXbAyujD28+4rAMm'+
		'DaD/r516cOfKY+r4XwDmf2BjgComAv0AJDfOPYRfDdAPty8/unP9kYomtF7UMVVW1pMG1pTi0sJ4gtvEWQOY/g9uOgcMX2BdCwxE'+
		'YKJ4/+YTea4FZj1Q++/xvRdAUyj3PC8/N7C2f3Tz5ebF+Pyva6p6+fRtNMHsllAgObVmNVzk589fRd3RxNiLrIskAGyVgPx/7+Zj'+
		'qvg/Jt8bWD4B0/C5Y9dI0hgQ76SgJYGm8cvnbxk1oECBlH/sHKzsnGzA+g/IXjtjP1zZ4/vPyXawhp4S47bFx25ffQisuin0vKWT'+
		'gY2vHpDRXbiIJI3ekXbAigBYjU1rWIVfJTDB57VHkGEFLqBrosa4deHRaxfvUuJ/I0ste39DLl4OBnDM3Lh8jxhdMvIS6noKwLKQ'+
		'AVyHt+TO4uHlxq+FiYmxcnISkNGaPZcq/ge6nBFYOV05d+vHj5/kGRGW4gGMPQgbWOydP0lUynfytgD2DiBsYGWxfOY2Iq1rmJUB'+
		'ItNmUMX/ZjZ6jMDq58Kp6z++k+l/eSVpGw/DMwev3bxKVLRDgJCIALBf+PDW83PHr337+p14jallIWKyAtXJk7m4qDBaY+lgyAiM'+
		'tLPHr3z/Rn4regABpNpmYmIiQy+w72vjbALy/8XTN96+eT/QfqE34OXjNrPRZ5zXvglY+V2+cINaTaAhAZiZmbV0VTk42RmtVULL'+
		'q/Ie3X1+/y7JjeoPHz4OtEdI8DCczcvLo6gsJ6Mo3tk+CTTsZ6EUlJQQKyTKP9COHAAAAMC58cqqWOdsAAAAAElFTkSuQmCC';

// データ保持変数
var servertime;
var servertime_t;

var vname = new Array();
var fname = new Array();
var rare = new Array();
var gage = new Array();
var skill = new Array();
var limit = new Array();
//faraway 19.都市画面内政武将表示ツール(βバージョン)のソース(bro3_display_adm_info.user.js) 変数部 終了==========================================
//faraway 24.武将ダス履歴抽出分析 Ver1.09のソース(_24_bro3_put_busyodas_textuserjs.user.js) 変数部 開始==========================================
var VERSION_KEY_24 = "vtn200";
var VERSION_24 = "1.09";
var urlpath;
var maxpage;
var putText_24 = "";
var card;
var t_rare_count = {}; // ランク別カード数
var g_rare_count = {}; // ランク別カード数
var s_rare_count = {}; // ランク別カード数
var l_rare_count = {}; // ランク別カード数
var sp_rare_count = {}; // ランク別カード数
var sho_rare_count = {}; // ランク別カード数
var tai_rare_count = {}; // ランク別カード数

var xg_rare_count = {}; // ランク別カード数
var xs_rare_count = {}; // ランク別カード数

var total_cards = 0; // 総カード数
var g_total_cards = 0; // 総カード数
var sp_total_cards = 0; // 総カード数
var s_total_cards = 0; // 総カード数
var l_total_cards = 0; // 総カード数
var sho_total_cards = 0; // 総カード数
var tai_total_cards = 0; // 総カード数

var g_ex_cards = 0;
var s_ex_cards = 0;

var srup_text = "";

// 共通関数
var d_24 = document;
var $d_24 = function(id) { return d_24.getElementById(id); };
var $x_24 = function(xp,dc) { return d_24.evaluate(xp, dc||d_24, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $e_24 = function(key) { return d_24.evaluate(key, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };
//faraway 24.武将ダス履歴抽出分析 Ver1.09のソース(bro3_put_busyodas_textuserjs.user.js) 変数部 終了==========================================
//faraway 28.トレードカードＩＤ表示のソース(bro3_tradecardidview.user.js) 変数部 開始==========================================
////////////////////////////////////////////////////////
// 変数定義
////////////////////////////////////////////////////////
var d_28 = document;
var $xp_28 = function (xp, dc) { return d_28.evaluate(xp, dc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };
//faraway 28.トレードカードＩＤ表示のソース(bro3_tradecardidview.user.js) 変数部 終了==========================================

//faraway 29.トレード収入計算のソース(bro3_calc_trade_income.user.js) 変数部 開始==========================================
//グローバル変数
var VERSION_29 = "0.01";			//バージョン情報
var HOST_29 = location.hostname;	//アクセスURLホスト

var d_29 = document;
var $d_29 = function(id) { return d_29.getElementById(id); };
var $x_29 = function(xp,dc) { return d_29.evaluate(xp, dc||d_29, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $a_29 = function(xp,dc) { var r = d_29.evaluate(xp, dc||d_29, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); var a=[]; for(var i=0; i<r.snapshotLength; i++){ a.push(r.snapshotItem(i)); } return a; };
var $e_29 = function(e,t,f) { if (!e) return; e.addEventListener(t, f, false); };
var $v_29 = function(key) { return d_29.evaluate(key, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };
//faraway 29.トレード収入計算のソース(bro3_calc_trade_income.user.js) 変数部 終了==========================================

//faraway 31.自動巡回のソース(bro3_auto_map_move.user.js) 変数部 開始==========================================
//グローバル変数
var VERSION_31 = "0.5β";  //バージョン情報
//faraway未使用のようなので削除var MAX_XY = 600; //座標絶対値最大
var CENTER_X_31; //中心X座標
var CENTER_Y_31; //中心Y座標
var MOVE_CNT=20;  //移動量
var MAPSIZE=3; //移動時の強制MAPサイズ変更 1=11x11 2=15x15 3=20x20
var INTERVAL_31=2000;  //負荷対策 回線速度によっては正常動作しない時があります。その際は数値を増やしてください。1秒=1000
//faraway 31.自動巡回のソース(bro3_auto_map_move.user.js) 変数部 終了==========================================

//faraway .のソース(.user.js) 変数部 開始==========================================
//faraway .のソース(.user.js) 変数部 終了==========================================
//faraway .のソース(.user.js) 変数部 開始==========================================
//faraway .のソース(.user.js) 変数部 終了==========================================
//faraway .のソース(.user.js) 変数部 開始==========================================
//faraway .のソース(.user.js) 変数部 終了==========================================
//faraway .のソース(.user.js) 変数部 開始==========================================
//faraway .のソース(.user.js) 変数部 終了==========================================
//faraway .のソース(.user.js) 変数部 開始==========================================
//faraway .のソース(.user.js) 変数部 終了==========================================
//faraway .のソース(.user.js) 変数部 開始==========================================
//faraway .のソース(.user.js) 変数部 終了==========================================
//faraway .のソース(.user.js) 変数部 開始==========================================
//faraway .のソース(.user.js) 変数部 終了==========================================
//faraway .のソース(.user.js) 変数部 開始==========================================
//faraway .のソース(.user.js) 変数部 終了==========================================
//faraway .のソース(.user.js) 変数部 開始==========================================
//faraway .のソース(.user.js) 変数部 終了==========================================
//faraway .のソース(.user.js) 変数部 開始==========================================
//faraway .のソース(.user.js) 変数部 終了==========================================
//faraway .のソース(.user.js) 変数部 開始==========================================
//faraway .のソース(.user.js) 変数部 終了==========================================



//faraway beyond本体開始 ========================================================================
( function(){

if(document.getElementById("beyond_basepanel") ) return ;

var VERSION_NAME = "ブラウザ三国志Beyond Ver2.0 by hasekun" + " 統合版";	//faraway (+ " 統合版") 追加
var IMG_DIR = "/20100510-01/img/";

    if( location.pathname == "/map.php" ) {
      GM_addStyle("a.map-basing { display:none !important;}");
    }

cut_main();
cut_main1();

///////////////////////////////////////////////
//Chrome用GM_関数
// @copyright      2009, James Campos
// @license        cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
    GM_addStyle = function(css) {
        var style = document.createElement('style');
        style.textContent = css;
        document.getElementsByTagName('head')[0].appendChild(style);
    };

    GM_deleteValue = function(name) {
        localStorage.removeItem(name);
    };

    GM_getValue = function(name, defaultValue) {
        var value = localStorage.getItem(name);
        if (!value)
            return defaultValue;
        var type = value[0];
        value = value.substring(1);
        switch (type) {
            case 'b':
                return value == 'true';
            case 'n':
                return Number(value);
            default:
                return value;
        }
    };

    GM_log = function(message) {
        if (window.opera) {
            opera.postError(message);
            return;
        }
        console.log(message);
    };

     GM_registerMenuCommand = function(name, funk) {
    //todo
    };

    GM_setValue = function(name, value) {
        value = (typeof value)[0] + value;
        localStorage.setItem(name, value);
    };
}
///////////////////////////////////////////////


///////////////////////////////////////////////
//配列のindexOf対策
if (!Array.prototype.indexOf)
{
  Array.prototype.indexOf = function(elt /*, from*/)
  {
    var len = this.length;

    var from = Number(arguments[1]) || 0;
    from = (from < 0)
         ? Math.ceil(from)
         : Math.floor(from);
    if (from < 0)
      from += len;

    for (; from < len; from++)
    {
      if (from in this &&
          this[from] === elt)
        return from;
    }
    return -1;
  };
}


var d = document;
var $ = function(id) { return d.getElementById(id); };
var $x = function(xp,dc) { return d.evaluate(xp, dc||d, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $a = function(xp,dc) { var r = d.evaluate(xp, dc||d, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); var a=[]; for(var i=0; i<r.snapshotLength; i++){ a.push(r.snapshotItem(i)); } return a; };
var $e = function(dc,e,f) { if (!dc) return; dc.addEventListener(e, f, false); };
var isNarrow = location.host.match(/^[m|y]\d+\./i) ? true : false;

var MAP_X_MIN = -600;
var MAP_X_MAX = 600;
var MAP_Y_MIN = -600;
var MAP_Y_MAX = 600;

//faraway 110929 start
var OPT_AUTOTROOPS = 0;		//23."自動出兵"
var OPT_HISTANALYSIS  = 0;	//24."武将ダス履歴抽出分析 Ver1.09"
var OPT_QUESTASSIST = 0;	//25."クエスト補助"
var OPT_TRADESUPPORT = 0;	//26."トレードサポート"
//111017var OPT_TRADESCORE = 0;		//27."トレードスコア単価計算"
//111017var OPT_TRADECARDID = 0;	//28."トレードカードＩＤ表示"
var OPT_TRADEINCOME = 0;	//29."トレード収入計算"
var OPT_RESERVATION = 0;	//30."出兵予約"
var OPT_AUTOROUND = 0;		//31."自動巡回"
var OPT_REPORTLOG = 0;		//32."報告書・同盟ログCSV出力"
var OPT_TRADEDISPMORE = 0;	//33."トレードのカードをもっと表示"
//111017var OPT_TRADESTATUS = 0;	//34."トレードステータス表示"
var OPT_TRADETRADEID = 0;	//35."トレードトレードＩＤ表示"faraway111011
//faraway 110929 end
//faraway 1104007 start
var OPT_MAPTOOL = 0;
var OPT_TIMER = 0;
var OPT_ALLIANCE = 0;
var OPT_DEVELOPMENT = 0;
var OPT_STATISTICS = 0;
var OPT_ALLIANCELOG = 0;
var OPT_NPCFORT = 0;
var OPT_RIGHTCLICK = 0;
var OPT_ALLIANCELEVEL = 0;
var OPT_MISTAKEPREVENTION = 0;
var OPT_LETTERTRANSMISSION = 0;
var OPT_LETTERBROADCAST = 0;
var OPT_LETTERPRESERVATION = 0;
var OPT_TRADINGRETRIEVAL = 0;
var OPT_TRADINGAFTER = 0;
var OPT_NAVIGATIONADDITION = 0;
var OPT_BRO3AUTO = 0;
var OPT_CHANGE_MOVE_SIZE = 0;
var OPT_DISPLAY_ADM_INFO = 0;
var OPT_MASS_SHOKAN_TOOL = 0;
var OPT_DECK_TOOL = 0;
var OPT_CALCN_1KI = 0;
var OPT_AFTER_DAY = 0;	//ダミー
//faraway 110407 end
var OPT_VILLAGE = 1;
var OPT_BASELINK = 1;
var OPT_MAPLINK = 1;
var OPT_XYLINK = 1;
var OPT_XYLINK_NK = 1;
var OPT_LARGEICON = 0;
var OPT_TTBL = 1;
var OPT_MEMO = 1;

var OPT_DETAILS = 1;
var OPT_DETAILS_UP = 1;
var OPT_DECK = 1;
var OPT_DECK_SET = 1;

var OPT_CTIME_B = 1;
var OPT_CTIME_U = 1;

var OPT_ALLY = 1;
var OPT_ALLY_IS = 1;
var OPT_ALLY_XY = 1;
var OPT_ALLY_CSV = 1;

var OPT_RES_T = 1;
var OPT_RES_TIME = 1;
var OPT_REMOVELIST = 1;
var OPT_MAPLIST = 0;

var OPT_TTDISTANCE = 1;
var OPT_TTDISTANCE_ITEMS = new Array();

var OPT_TTALLYPRSN = 1;

var OPT_MEMO_FONT_SIZE = "9";
var OPT_MEMO_WIDTH = "21";
var OPT_MEMO_HEIGHT = "5";
var OPT_MEMO_COUNT = "1";

var OPT_MAPLINK_FONT_SIZE = "9";

var OPT_USER_STAR = 1;
var OPT_USER_LEVEL = 1;
//var OPT_REPORT_NP = 0;

var OPT_MAPCENTER = 1;
var OPT_TBREST = 1;
var OPT_DELMSG = 1;
var OPT_TSENDTIME = 1;
var OPT_SMALLBTN = 0;
var OPT_ATTACKMAP = 1;
var OPT_CARD_CMB = 1;

var OPT_PIKA_YOROZU = 1;
var OPT_PIKA_HPREST = 1;
var OPT_PIKA_MAPHELP = 1;
var OPT_PIKA_TRDHELP = 1;
var OPT_PIKA_BLINKBLD = 1;

var OPT_SUZAN_SEISAN = 1;

var OPT_CASTLE_AID = 1;
var OPT_NEXT_MEISEI = 1;
var OPT_TIMER_LINK_DEPOT = 1; // ブラ三タイマー

if (isNarrow) {
    var OPT_VILLAGE_LIST_BOX = 1;
}

var g_MD;
var g_MX;
var g_MY;

var BASE_X = -9999;
var BASE_Y = -9999;

var USER_ID = "";
var ALLY_ID = "";

var RES_NOW = [];
var RES_MAX = [];
var RES_GROW = [];
var RES_GROW_W = [];
var RES_GROW_B = [];

var PRE_LOAD_NODES = {};
var URL_PARAM = {};

var Pika_elementQueue = [];

var VILLAGES_INFO= {};

var SID = '';

var OPT_STYLE = 1;
var DISP_RANK = 1;

var OPT_ILLUST_CHANGE = 0; // 某ゲームのイラストに置き換えるアホツール
var OPT_UR_CHANGE = 0; // 見た目を全部URに置き換えるアホツール
var OPT_SR_CHANGE = 0; // 見た目を全部SRに置き換えるアホツール

var OPT_SENSEI_CHANGE = 0; // "水鏡先生"を"袁術先生"に変更に置き換えるアホツール


if( !initPanel() ) return;

initUrlParams();
initStyle();
initPreLoadNode();
initResources();
getMyInfo();
loadOptions();
initImages();
disp_Options();

initVillages();
initCastleSend();

if (isNarrow) initNarrow();


if ( isNarrow && OPT_VILLAGE_LIST_BOX )  disp_villageListBox();

if( OPT_STYLE )     cut_main2();
if( DISP_RANK )		GM_addStyle("#social {display:none !important;}");//ｽﾀｲﾙ変更にﾁｪｯｸが入っていなくても動作するようにここでｺｰﾙfaraway110525

if( OPT_VILLAGE )   disp_village();
if( OPT_BASELINK )  disp_baseLink();
if( OPT_MAPLINK )   disp_mapLink();
if( OPT_MEMO )      disp_memo();
if( OPT_ALLY )      disp_AllianceInfo();//XYリンク加工前に呼ぶ
if( OPT_XYLINK )    disp_XYLink();
if( OPT_TTBL )      disp_TTable();
if( OPT_NAVIGATIONADDITION ) disp_navigationaddition();	//faraway110530 disp_Details()があると報告書でリンク表示しないため、呼び出し位置変更
if( OPT_DETAILS )   disp_Details();
if( OPT_DECK )      disp_Deck();
if( OPT_CTIME_B )   disp_CompleteTimeBuild();
if( OPT_CTIME_U )   disp_CompleteTimeUnit();
if( OPT_RES_T )     disp_ResourcesTotal();
//faraway110620if( OPT_RES_TIME )  disp_ResourcesTime();
if( OPT_REMOVELIST) disp_RemoveList();
//faraway110425if( OPT_MAPLIST)    disp_MapList(); //位置下げる

if( OPT_USER_STAR)  disp_UserStar();
if( OPT_USER_LEVEL) disp_UserLevel();
//if( OPT_REPORT_NP)    disp_ReportNextPrior();
if( OPT_MAPCENTER)  disp_MapCenter();
if( OPT_TBREST)     disp_ToubatsuRestTime();
if( OPT_DELMSG)     disp_DeleteMessages();
if( OPT_TSENDTIME)  disp_TSendTime();
if( OPT_SMALLBTN)   disp_SmallButton();
if( OPT_ATTACKMAP)  disp_AttackMap();
if( OPT_CARD_CMB)   disp_CardCombine();
if( OPT_PIKA_YOROZU ) disp_PikaYorozu();
if( OPT_PIKA_HPREST ) disp_PikaHPRestTime();
//faraway110530if( OPT_PIKA_MAPHELP ) Pika_installMapXYHelper();
if( OPT_PIKA_TRDHELP ) Pika_installTradeHelper();

if( OPT_SUZAN_SEISAN ) disp_SuzanSeisan();

if ( OPT_CASTLE_AID ) disp_castleAidLink();
//faraway110620if ( OPT_NEXT_MEISEI ) disp_nextFameTimer();
if ( OPT_TIMER_LINK_DEPOT ) disp_timerLinkDepot();

if ( OPT_ILLUST_CHANGE ) disp_illustChange(); // 某ゲームのイラストに置き換えるアホツール
if ( OPT_UR_CHANGE ) disp_URChange(); // 見た目を全部URに置き換えるアホツール
if ( OPT_SR_CHANGE ) disp_SRChange(); // 見た目を全部URに置き換えるアホツール
if ( OPT_SENSEI_CHANGE ) disp_SENSEIChange(); // "水鏡先生"を"袁術先生"に変更に置き換えるアホツール


if( OPT_TTALLYPRSN) disp_ToolTipsAllyPerson();
if( OPT_TTDISTANCE) disp_ToolTipsDistance();
//faraway start
if( OPT_MAPTOOL ) disp_maptool();
if( OPT_MISTAKEPREVENTION ) disp_mistakeprevention();
//faraway110528if( OPT_RIGHTCLICK ) disp_rightclick();
//faraway "トレード画面入力改善"は、上の方にある
if( OPT_TRADESCORE  ) 		TradeScore();		//27."トレードスコア単価計算"		14.トレード検索条件記憶の前に移動111012faraway
if( OPT_TRADEDISPMORE  ) 	TradeDispMore();	//33."トレードをもっと表示"			14.トレード検索条件記憶の前に移動111012faraway
if( OPT_TRADINGRETRIEVAL ) disp_tradingretrieval();
if( OPT_TRADINGAFTER ) disp_tradingafter();
if( OPT_NPCFORT ) disp_npcfort();
if( OPT_RIGHTCLICK ) disp_rightclick();//NPCを使用すると発生の為、位置を下にしたfaraway110528
if( OPT_RES_TIME )  disp_ResourcesTime();//NPCを使用すると全体地図で資源時間の表示位置がずれて見えない為、位置を下にしたfaraway110620
if ( OPT_NEXT_MEISEI ) disp_nextFameTimer();//faraway110620
if( OPT_MAPLIST)    disp_MapList();//faraway110425
if( OPT_CHANGE_MOVE_SIZE ) disp_change_move_size();
if( OPT_DISPLAY_ADM_INFO ) disp_display_adm_info();
if( OPT_ALLIANCE ) disp_alliance();
if( OPT_DEVELOPMENT ) disp_development();
if( OPT_STATISTICS ) disp_statistics();
if( OPT_ALLIANCELOG ) disp_alliancelog();
if( OPT_MASS_SHOKAN_TOOL ) disp_mass_shokan_tool();
if( OPT_LETTERTRANSMISSION ) disp_lettertransmission();
if( OPT_LETTERBROADCAST ) disp_letterbroadcast();
if( OPT_LETTERPRESERVATION ) disp_letterpreservation();
if( OPT_BRO3AUTO ) disp_bro3auto();
if( OPT_DECK_TOOL ) disp_deck_tool();
if( OPT_ALLIANCELEVEL ) disp_alliancelevel();
//faraway110530if( OPT_NAVIGATIONADDITION ) disp_navigationaddition();
if( OPT_CALCN_1KI ) disp_calcn();
//if( OPT_TIMER ) disp_timer();
if( OPT_PIKA_MAPHELP ) Pika_installMapXYHelper();//NPCを使用すると座標移動しない為、位置を下にしたfaraway110530

//faraway end
//faraway110929 start
if( OPT_AUTOTROOPS  ) 		AutoTroops();		//23."自動出兵"
if( OPT_HISTANALYSIS   ) 	HistAnalysis();		//24."武将ダス履歴抽出分析 Ver1.09"
if( OPT_QUESTASSIST  ) 		QuestAssist();		//25."クエスト補助"
if( OPT_TRADESUPPORT  ) 	TradeSupport();		//26."トレードサポート"
if( OPT_TRADECARDID  )		TradeCardID();		//28."トレードカードＩＤ表示"
if( OPT_TRADEINCOME  ) 		TradeIncome();		//29."トレード収入計算"
if( OPT_RESERVATION  ) 		Reservation();		//30."出兵予約"
if( OPT_AUTOROUND  ) 		AutoRound();		//31."自動巡回"
if( OPT_REPORTLOG  ) 		ReportLog();		//32."報告書・同盟ログCSV出力"
if( OPT_TRADESTATUS  ) 		TradeStatus();		//34."トレードステータス表示"
if( OPT_TRADETRADEID  )		TradetradeID();		//35."トレードトレードＩＤ表示"	faraway111011
//faraway110929 end
csortSideBox();
crenumberSideBox();
Pika_blinkElements();


//////////////////////
//イメージ初期化
//////////////////////
var img_mura, img_map, img_naisei, img_ken, img_hanma, img_user, img_mail;
function initImages()
{
    if( !OPT_LARGEICON ) {
        img_mura = 'data:image/gif;base64,'+
                'R0lGODlhCgAKAKIAAAAAAP/M/7Jlf2YAAMaAoLpxjceAoQAAACH5BAQUAP8ALAAAAAAKAAoAAAMd'+
                'CBDcumE0CeOcI2vJMunYYICgZDalwEFcQSkooyQAOw==';


        img_map = 'data:image/gif;base64,'+
                'R0lGODlhCgAKAJEAAAAAAP//zAAAmSAgGiH5BAQUAP8ALAAAAAAKAAoAAAIaBIJplz0hRItISojx'+
                'tbXuDn3ZFDANMhhnCRQAOw==';


        img_naisei = 'data:image/gif;base64,'+
                'R0lGODlhCgAKALMAAAAAAMPS5HWOi5kAZktYU7yw0BogILmjyMz//8LP4r641MXb6QAAAAAAAAAA'+
                'AAAAACH5BAQUAP8ALAAAAAAKAAoAAAQnEBiEBkUGgGsvqUMockgxKBWnDMewdKA1UkNwJTBMU9vl'+
                'CxofDxABADs=';

        img_ken = 'data:image/gif;base64,'+
                'R0lGODlhCgAKALMAAAAAALS0tE48PP///42NjTMzM+Li4nx8fBgAACYPD5mZmQkJCUZGRru7u+jo'+
                '6AAAACH5BAQUAP8ALAAAAAAKAAoAAAQkECBAq5C1qrEyIMPQUAMZllRwhtlinB4De+ExBFniFKQ3'+
                '+YAIADs=';
        img_hanma = 'data:image/gif;base64,'+
                'R0lGODlhCgAKAOYAAP////7+/v39/fz8/Pv7+/r6+vn5+fj4+Pb29vX19fLy8vHx8fDw8O/v7+/u'+
                '7u3t7ezs7Obm5uLi4tra2tbW1tTU1NPT09LR0cjIyLq6ura0tLKysrCwsKmoqI+JiWxsbGdmZlVV'+
                'VUpKSkhFRUFBQUJBQT8/Py4uLiwsLCgoKCQkJCMjIyIhISoaGhsbGxkZGRkYGBYWFhoWFhkVFRMT'+
                'EyQODhQSEiILCw4ODgsLCwoKCgkJCQcGBgkGBgYGBhgAABYAAAQEBAMDAwEBAQAAAAEAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5'+
                'BAQUAP8ALAAAAAAKAAoAAAdcgEQ3HiAoDwILJjRAMh0XDAgBCRkqRTYpAwCaBxE+REGZmgAFQUND'+
                'oqI7OEM+C5oEsAsnLzkWChAYHxINFCQ8LBUcISIlGxMPNT46LisxMSMaDkQ/RERC1zMtPYEAOw==';
        img_mail = 'data:image/gif;base64,'+
                'R0lGODlhCgAKAMQAAP///5mZmSoaGhoWFhkVFRMTEyQODiILCwsLCwYGBgcGBgkGBhgAABYAAAMD'+
                'AwEBAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAQU'+
                'AP8ALAAAAAAKAAoAAAUvIHREZBkVzWCuQQC8QEsGkRvXz3PL7pO8tNorgoAZARHFERYxLIcRBmTq'+
                'iBAEixAAOw==';
        img_user = 'data:image/gif;base64,'+
                'R0lGODlhCgAKANUAADMAAPr3s+vhKdKwHr6DEal3EPPvPYJCA+XUI/HsLPbwUcejG9m+Mvn3M9m8'+
                'IP//tfj4NvXxMe/oK///M969IfLuMbR4EdzFL86wHv//O+XXKf//u//3tY5JBPj0Ue3iLvTwQu3l'+
                'L9fCIda3IKp4ENnDL+DHIv///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAUUACcALAAAAAAKAAoAAAZTwNMp'+
                'oEgkFAHhEASpVCCgZMAgEFVCDomBCBkBNBqACFJsaAqfD0nTSAhMkYaz7RAoLJhMJJIZEBQbJQcL'+
                'EhIjHRcbJw8XFgQEFgwPShseCAiAQkEAOw==';
    }else{
        img_mura = 'data:image/gif;base64,'+
                'R0lGODlhDgAOAOYAAAAAAP///+Hz/gid8Ame8gmg8gmb7wmc7wqe8gqg8gqb7wqc7wug8gud7wyh'+
                '8gyd7w2i8w2g8g2d7w2d7g6e8A6d7w6e7w6c7g6d7hCg8g+d7w+e7w+d7hWg7hag7huP0RyQ0h2Q'+
                '0h+V1iWq8yaq8yiq9Cis9AorPSms9QoqPCqs9Syu9QsrPS6v9S6t9C+t9DGv9TGw9TOw9Taw9EW3'+
                '9ke39ki49mbE+IXQ+YbQ+aLb+qPb+6Pc+8Ln/MTo/ODz/uL0/guh8g+j8xGj8iCa1yit9Cmt9Cuu'+
                '9C6v9DOx9TSz9Ue59ki59km69sLo/MTp/ODz/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5'+
                'BAEAAFEALAAAAAAOAA4AAAeXgCkfHBZDK0IQLQ4LFx8pIB4WQUw4Kig5NggKHSAcGBVHPDcoKDc7'+
                'JQYTHBwXD0hAP7GxJQcYGBwNCU0/Ab0BPzUIEhwPCUtOvr49NQQVB0Y8yck6JBUVDEy80sARGxgD'+
                'RdrJUCMUhAVL4r4/NBkbFSbI0r09LxoWJurJAi4bIElPgAgcKNDHjBAsiCiJwZAhjIcyRJwIBAA7';

        img_map = 'data:image/gif;base64,'+
                'R0lGODlhDgAOAMQAAKmLAeHXp76oQP38+My7arSaIe/pz9jKi8SvUeffuK6SEdTFf7mhMci0XPTw'+
                '39zPl+Tbr8OuTcq4ZN7SnOniv72mPf///8++ccm3YdTFgP///wAAAAAAAAAAAAAAAAAAACH5BAEA'+
                'ABoALAAAAAAOAA4AAAVCoAaMZDmKZqqu5EIRVUUqWEkJl6XvkL2POkCmNPkBgpdS8gi0AA6lnfOX'+
                'qDWlOoegN0IMKCRBgRGxsgwPAyuFWmtCADs=';

        img_naisei = 'data:image/gif;base64,'+
                'R0lGODlhDgAOAOYAAAAAAP///zEwMTAvMC8uLy4tLiwrLCsqKzw7PH9+fysrLImKiSkpKCgoJyYm'+
                'JTk5OE5OTdvb2dfX1Xp6eXd3dnV1dGZmZWJiYebm5eLi4d7e3dra2dfX1tTU09PT0tHR0M/Pzs7O'+
                'zc3NzMTEw8PDwsDAv7e3tqOjopKSkff29eLh4NnY19PS0dHQz83My8rJyMfGxcPCwcLBwMC/vr++'+
                'vSkoKCYlJSUkJCsqKjQzM0xLS9DOzsnHx3t6enV0dHRzc1taWuTj4+Hg4N/e3t3c3Nva2tbV1dXU'+
                '1NTT09LR0dHQ0NDPz8/OzsvKysnIyMjHx8HAwMC/v6Cfn9zc3MnJycXFxb+/v729vZ+fn5aWloWF'+
                'hXNzc3FxcWpqalxcXFpaWlZWVlBQUE5OTkdHR0BAQDo6Ojg4ODc3NzExMTAwMC8vLy4uLi0tLSws'+
                'LCsrKygoKCcnJyYmJiUlJSQkJCMjIyIiIiAgIB8fHx4eHv///wAAAAAAAAAAAAAAAAAAAAAAACH5'+
                'BAEAAHkALAAAAAAOAA4AAAewgAKCA4SFhGkDggJuYAkUFT9cPhByBYpzCykYGRpFQhN4bIptZEVE'+
                'RkkfPA9yBopqa1hEK0cfKDUNboppcBcvJCUzX3UMB4psZh8RIU1LVmhxxoJtZR4bHS0gUDkOOKNn'+
                'IFMsTEpXaTYKrzdeIUQcJF93b66CdBYnWls9WFJidziJCAApEkTEmC5JXEDRYSfRABMqkLCAUeVJ'+
                'DCdZ7BAYgGCIBBY7QlAZIYNGlDBsAgEAOw==';

        img_ken = 'data:image/gif;base64,'+
                'R0lGODlhDgAOAMQAAP9MH/9lP/9AEP9ZMP9/X/+Zf/+yn/+lj//Zz//y7/9zUP+AYP+/r/+Lbv/P'+
                'w//q5f+fh//s5/9jPP+NcP/l3//Mv/////8zAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEA'+
                'ABgALAAAAAAOAA4AAAVCIHaNZDmKZqkYqVlZQEsORCBX1YLIhWVRstHB9wheDC8LApiC+HwES+og'+
                'uAAsCcNAcUMIfJVUVEoKpyjMUZWEMmJCADs=';

        img_hanma = 'data:image/gif;base64,'+
                'R0lGODlhDgAOALMAAAAAAP///8zMzL+/v5mZmWZmZjIyMiYmJgwMDP///wAAAAAAAAAAAAAAAAAA'+
                'AAAAACH5BAEAAAkALAAAAAAOAA4AAARF0Eg5yLxTEFE1lkIYCEGBEUMoBqyQqSQ7WlQ4mLFnDKPO'+
                'tyYeifYLEUc3AylkkrR6I+Qr2krRJISWqnlBFQId7kdgEhsiADs=';
        img_mail = 'data:image/gif;base64,'+
                'R0lGODlhDgAOANUAAP////n6+u3t7ezs7Ojo6Kurq6ampqWkpKCgoJ6enpaWloeHh4SEhHV1dWhn'+
                'Z2dmZioqKiodHR8eHh0cHBsaGiEUFBYTExMTExMSEh4NDRwKChsJCRoICAoKCgcHBwkGBhIDAwUF'+
                'BQUGBhMAAAYEBBIAAAMDAxEAAAICAgQCAgEBAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAQUAP8ALAAAAAAOAA4AAAZxwNVm'+
                's1qxjkiW53I6FZ/Qoud0GACu2OvgUOQmrNhBYnU4Ah4URVZBcQBUKsBhglkIBAvM5PCOAwwTEwwM'+
                'EhIGVyohVwQIEEUQCARXLB1YAQUNDQUBWJRZn50ioKAsGaOfKxqnWSkpIyNQJiskFhEVH0EAOw==';
        img_user = 'data:image/gif;base64,'+
                'R0lGODlhDgAOAPcAAP7+v/3+vf39vf3+ofz6vvz9ofz5u/v8ofn2nv//O/3/Ofn3av76Nfn2af36'+
                'Nf75Nfj6Nvj5Nvj4N/n1U/fzaff4N/f4NPf4Lvfzavf1TPj0Tff3Lvb1NPX0NPb1LfXzNPXwTvXw'+
                'VPXwTfXyNPXyM/XuUPTyNPTyM/TxNPTwPPTwMvTwMfTvPfTvPPPxM/PwMPPwLvPvPfPvMvPwM/Pu'+
                'MvPuMPPuLfLtPfLuNfLuM/LuMvLuLvPtMfLtNfLtM/LtMfLtMPHtMvHsM/HsMfLsLfLsMPLsMfHp'+
                'LPDqKvHqLPDoLu7oLu/nLO3jK/HgNergK+rgKevfK+reKereKuvaM+bWJ+TRJOfOJOTOI+TJLN/K'+
                'IuHCIN3AK9/BH+G/IN6/K+C+H92+IN++INq9Ida1H9W0J9ayHNWxHM+xH8uqHc2kGs2jGs+iF8ug'+
                'GNGeGNCeGMmdF8WRE8SPFcSOFL+FFLt9ELp9EL59EKt0DKRyDKFwC6NpC4hdC4pVCoZQCpNFAJVE'+
                'AHtGCIVBB4A5AHk3BnozADQbAjQOADQOASkQAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
                'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAUUAIoALAAAAAAOAA4A'+
                'AAjGABUJJEABBxEiPSgQEMgQQYgUOiLqaBECQcMbMC5wGDLEgoUdNywaAAEDChgsLlyECbPEhggD'+
                'GFhsEJOIDwMGgQxd8RADAw4cEbYg8uPAQZ9DXSCgQHHwwxM3Z0iQMPNmygggQJJYiaKiq9euVbQc'+
                'EdKmjZIKJowYMSGhSRw4PhZ8GYQmQQcZeBWQAcRlgQANegilkVKjBpMxgvBkCKDogJM8he6sWTPn'+
                'zx4qBRgemJBFTp06dMqUGMBQIIAFOZAgCdIAAMOAADs=';
    }
}
//////////////////////
//スタイル初期化
//////////////////////
function initStyle()
{
    GM_addStyle("span.beyond_panel_ctlbox {width:35px; height:14px; display:block; position:absolute; right:-5px; top:-4px; }" +
                "span.beyond_panel_ctlbox img {width:8px;height:9px; float:right; }" +
                "div#beyond_basepanel img{vertical-align:middle; margin:1px 1px 1px 0px; padding-left:2px}" +
                 "#beyond_basepanel fieldset{border:groove 1px black; margin:1px; padding:1px;}"
                );
}

//////////////////////
//リソース変数初期化
//////////////////////
function initResources()
{
    var nowNodes = PRE_LOAD_NODES['nowResources'];
    var names = ['wood','stone','iron','rice'];
    for (var i=0; i <names.length;i++) {
        var name = names[i];
        RES_NOW[name] = parseInt( nowNodes[name].innerHTML, 10 );
        RES_MAX[name] = parseInt( $(name+'_max').innerHTML, 10 );
        RES_GROW[name] = parseInt( $('output_'+name).innerHTML, 10 );
    }

    var spns = $a('(id("sidebar") | id("status_left")//p[@class="status_bottom"])//span[@class="increase" or @class="resource"]');
    for(var i=0 ; i<spns.length ; i++) {
        var str = spns[i].previousSibling.nodeValue.match(/(木|石|鉄|糧)\s+(-?\d+)/);
        if( str ) {
            var name = "";
            switch( str[1] ) {
            case "木":
                name = 'wood';
                break;
            case "石":
                name = 'stone';
                break;
            case "鉄":
                name = 'iron';
                break;
            case "糧":
                name = 'rice';
                break;
            }
            RES_GROW_W[name] = parseInt(str[2], 10);
            RES_GROW_B[name] = parseInt(spns[i].innerHTML, 10);
        }
    }

    //名声
    RES_NOW["fame"] = 0;
    RES_MAX["fame"] = 0;
    var fameText = $x('id("status_left")/img[contains(@src,"ico_fame.gif")]').nextSibling;
    if( fameText ) {
        var tmp = fameText.nodeValue.match(/\s*(\d+)\s*\/\s*(\d+)/);
        RES_NOW["fame"] = parseInt(tmp[1],10);
        RES_MAX["fame"] = parseInt(tmp[2],10);
    }
}


//////////////////////
//ベースパネル初期化
//////////////////////
function initPanel()
{
    var panelBox = $("sidebar");
    if (isNarrow) {
        var panelBoxWrapper = $x('id("wrapper")');

        if (!panelBoxWrapper) return false;

        panelBox = d.createElement("div");
        panelBox.id = "sidebar";
        panelBox.style.width = "auto";
        panelBox.style.cssFloat = "left";
        panelBox.style.marginTop = "10px";

        panelBoxWrapper.appendChild(panelBox);
    }

    if( !panelBox ) return false;


    var basepanel = d.createElement("div");
    basepanel.id = "beyond_basepanel";

    var fixpanel = d.createElement("div");
    fixpanel.id = "beyond_fixpanel";
    var floatpanel = d.createElement("div");
    floatpanel.id = "beyond_floatpanel";
    var tmppanel = d.createElement("div");
    tmppanel.id = "beyond_tmp";
    tmppanel.style.display = "none";

    basepanel.appendChild(fixpanel);
    basepanel.appendChild(floatpanel);
    basepanel.appendChild(tmppanel);

    panelBox.appendChild(basepanel);

    return true;
}


//////////////////////
//オプション処理
//////////////////////
function disp_Options()
{
    if( !location.pathname.match(/^(\/user\/|\/bbs\/personal_)/) ) return;

    if( location.pathname.match(/ranking\.php/) ) return;
    var ul = $("statMenu");
    if( !ul ) return;

    var cl = d.createElement("a");
    cl.href = "javascript:void(0);";
//faraway120119    cl.innerHTML = "三国志Beyond";
    cl.innerHTML = "Beyond";	//faraway120119
    $e(cl, "click", function() {openOptions();});

    var li = d.createElement("li");
    li.appendChild(cl);
    li.className = "last";
    ul.appendChild(li);

    var lst = $x("//li[@class=\"last\"]");
    if( lst ) {
        lst.className = "";
    }


}

function loadOptions()
{
//faraway110929 start
OPT_REPORTLOG     = cloadData( "OPT_REPORTLOG"    , 1 );	//"報告書・同盟ログCSV出力"
OPT_AUTOROUND     = cloadData( "OPT_AUTOROUND"    , 1 );	//"自動巡回"
OPT_AUTOTROOPS    = cloadData( "OPT_AUTOTROOPS"   , 0 );	//"自動出兵"
OPT_RESERVATION   = cloadData( "OPT_RESERVATION"  , 1 );	//"出兵予約"
OPT_TRADEDISPMORE = cloadData( "OPT_TRADEDISPMORE", 0 );	//"トレードをもっと表示"
OPT_TRADESUPPORT  = cloadData( "OPT_TRADESUPPORT" , 0 );	//"トレードサポート"
OPT_TRADESCORE    = cloadData( "OPT_TRADESCORE"   , 0 );	//"トレードスコア単価計算"
OPT_TRADECARDID   = cloadData( "OPT_TRADECARDID"  , 0 );	//"トレードカードＩＤ表示"
OPT_TRADETRADEID  = cloadData( "OPT_TRADETRADEID" , 0 );	//"トレードトレードＩＤ表示"//111011faraway
OPT_TRADESTATUS   = cloadData( "OPT_TRADESTATUS"  , 0 );	//"トレードステータス表示"
OPT_TRADEINCOME   = cloadData( "OPT_TRADEINCOME"  , 0 );	//"トレード収入計算"
OPT_HISTANALYSIS  = cloadData( "OPT_HISTANALYSIS" , 1 );	//"武将ダス履歴抽出分析 Ver1.09"
OPT_QUESTASSIST   = cloadData( "OPT_QUESTASSIST"  , 1 );	//"クエスト補助"
//faraway110929 end
//faraway start
    OPT_MAPTOOL = cloadData( "OPT_MAPTOOL", 1 );
    OPT_TIMER = cloadData( "OPT_TIMER", 0 );
    OPT_ALLIANCE = cloadData( "OPT_ALLIANCE", 1 );
    OPT_DEVELOPMENT = cloadData( "OPT_DEVELOPMENT", 1 );
    OPT_STATISTICS = cloadData( "OPT_STATISTICS", 1 );
    OPT_ALLIANCELOG = cloadData( "OPT_ALLIANCELOG", 1 );
    OPT_NPCFORT = cloadData( "OPT_NPCFORT", 1 );
    OPT_RIGHTCLICK = cloadData( "OPT_RIGHTCLICK", 1 );
    OPT_ALLIANCELEVEL = cloadData( "OPT_ALLIANCELEVEL", 0 );
    OPT_MISTAKEPREVENTION = cloadData( "OPT_MISTAKEPREVENTION", 1 );
    OPT_LETTERTRANSMISSION = cloadData( "OPT_LETTERTRANSMISSION", 1);
    OPT_LETTERBROADCAST = cloadData( "OPT_LETTERBROADCAST", 1 );
    OPT_LETTERPRESERVATION = cloadData( "OPT_LETTERPRESERVATION", 1 );
    OPT_TRADINGRETRIEVAL = cloadData( "OPT_TRADINGRETRIEVAL", 1 );
    OPT_TRADINGAFTER = cloadData( "OPT_TRADINGAFTER", 1 );
    OPT_NAVIGATIONADDITION = cloadData( "OPT_NAVIGATIONADDITION", 1 );
    OPT_BRO3AUTO = cloadData( "OPT_BRO3AUTO", 1 );
	OPT_CHANGE_MOVE_SIZE = cloadData( "OPT_CHANGE_MOVE_SIZE", 1 );
	OPT_DISPLAY_ADM_INFO = cloadData( "OPT_DISPLAY_ADM_INFO", 1 );
	OPT_MASS_SHOKAN_TOOL = cloadData( "OPT_MASS_SHOKAN_TOOL", 1 );
	OPT_DECK_TOOL = cloadData( "OPT_DECK_TOOL", 1 );
	OPT_CALCN_1KI = cloadData( "OPT_CALCN_1KI", 1 );
//faraway end
    OPT_VILLAGE = cloadData( "OPT_VILLAGE", 1 );
    OPT_BASELINK = cloadData( "OPT_BASELINK", 1 );
    OPT_MAPLINK = cloadData( "OPT_MAPLINK", 1 );
    OPT_XYLINK = cloadData( "OPT_XYLINK", 1 );
    OPT_XYLINK_NK = cloadData( "OPT_XYLINK_NK", 1 );
    OPT_LARGEICON = cloadData( "OPT_LARGEICON", 0 );
    OPT_TTBL = cloadData( "OPT_TTBL", 1 );
    OPT_MEMO = cloadData( "OPT_MEMO", 1 );
    OPT_MEMO_FONT_SIZE = cloadData( "OPT_MEMO_FONT_SIZE", "9" );
    OPT_MEMO_WIDTH = cloadData( "OPT_MEMO_WIDTH", "21" );
    OPT_MEMO_HEIGHT = cloadData( "OPT_MEMO_HEIGHT", "5" );
    OPT_MEMO_COUNT = cloadData( "OPT_MEMO_COUNT", "1" );
    OPT_MAPLINK_FONT_SIZE = cloadData( "OPT_MAPLINK_FONT_SIZE", "9" );
    OPT_DETAILS = cloadData( "OPT_DETAILS", 1 );
    OPT_DETAILS_UP = cloadData( "OPT_DETAILS_UP", 1 );
//  OPT_DECK = cloadData( "OPT_DECK", 1 );
    OPT_DECK_SET = cloadData( "OPT_DECK_SET", 1 );
    OPT_CTIME_B = cloadData( "OPT_CTIME_B", 1 );
    OPT_CTIME_U = cloadData( "OPT_CTIME_U", 1 );
    OPT_ALLY = cloadData( "OPT_ALLY", 1 );
    OPT_ALLY_IS = cloadData( "OPT_ALLY_IS", 1 );
    OPT_ALLY_XY = cloadData( "OPT_ALLY_XY", 1 );
    OPT_ALLY_CSV = cloadData( "OPT_ALLY_CSV", 1 );
    OPT_RES_T = cloadData( "OPT_RES_T", 1 );
    OPT_RES_TIME = cloadData( "OPT_RES_TIME", 1 );
    OPT_REMOVELIST = cloadData( "OPT_REMOVELIST", 1 );
    OPT_MAPLIST = cloadData( "OPT_MAPLIST", 0 );
    OPT_TTDISTANCE = cloadData( "OPT_DISTANCE", 1 );
    OPT_TTDISTANCE_ITEMS = cloadData("OPT_DISTANCE_ITEMS", "[\"剣兵(6)\", \"槍兵(7)\", \"弓兵(5)\", \"騎兵(12)\", \"衝車(3)\", \"矛槍兵(10)\", \"弩兵(8)\", \"近衛騎兵(15)\", \"投石機(6)\", \"斥候騎兵(20)\"]", true, true);
    OPT_TTALLYPRSN = cloadData( "OPT_TTALLYPRSN", 1 );
    OPT_USER_STAR = cloadData( "OPT_USER_STAR", 1 );
    OPT_USER_LEVEL = cloadData( "OPT_USER_LEVEL", 1 );
//  OPT_REPORT_NP = cloadData( "OPT_REPORT_NP", 1 );
    OPT_MAPCENTER = cloadData( "OPT_MAPCENTER", 1 );
    OPT_TBREST = cloadData( "OPT_TBREST", 1 );
    OPT_DELMSG = cloadData( "OPT_DELMSG", 1 );
    OPT_TSENDTIME = cloadData( "OPT_TSENDTIME", 1 );
    OPT_SMALLBTN = cloadData( "OPT_SMALLBTN", 0 );
    OPT_ATTACKMAP = cloadData( "OPT_ATTACKMAP", 1 );
    OPT_CARD_CMB = cloadData( "OPT_CARD_CMB", 1 );

    OPT_PIKA_YOROZU = cloadData( "OPT_PIKA_YOROZU", 1 );
    OPT_PIKA_HPREST = cloadData( "OPT_PIKA_HPREST", 1 );
    OPT_PIKA_MAPHELP = cloadData( "OPT_PIKA_MAPHELP", 1 );
    OPT_PIKA_TRDHELP = cloadData( "OPT_PIKA_TRDHELP", 1 );
    OPT_PIKA_BLINKBLD = cloadData( "OPT_PIKA_BLINKBLD", 1 );

    OPT_SUZAN_SEISAN = cloadData( "OPT_SUZAN_SEISAN", 1 );

    OPT_CASTLE_AID = cloadData( "OPT_CASTLE_AID", 1 );
    OPT_NEXT_MEISEI = cloadData( "OPT_NEXT_MEISEI", 1 );
    OPT_TIMER_LINK_DEPOT = cloadData( "OPT_TIMER_LINK_DEPOT", 0 );
    if (isNarrow) {
        OPT_VILLAGE_LIST_BOX = cloadData( "OPT_VILLAGE_LIST_BOX", 0 );
    }

   OPT_STYLE = cloadData( "OPT_STYLE",1);
   DISP_RANK = cloadData( "DISP_RANK",1);
    OPT_ILLUST_CHANGE = cloadData( "OPT_ILLUST_CHANGE", 1 ); // 某ゲームのイラストに置き換えるアホツール
    OPT_UR_CHANGE = cloadData( "OPT_UR_CHANGE", 0 ); // 見た目を全部URに置き換えるアホツール
    OPT_SR_CHANGE = cloadData( "OPT_SR_CHANGE", 1 ); // 見た目を全部SRに置き換えるアホツール
    OPT_SENSEI_CHANGE = cloadData( "OPT_SENSEI_CHANGE", 0 ); // "水鏡先生"を"袁術先生"に変更に置き換えるアホツール


}
function saveOptions()
{
//faraway110929 start
    OPT_REPORTLOG     = cgetCheckBoxValue("OPT_REPORTLOG");		//"報告書・同盟ログCSV出力"
    OPT_AUTOROUND     = cgetCheckBoxValue("OPT_AUTOROUND");		//"自動巡回"
    OPT_AUTOTROOPS    = cgetCheckBoxValue("OPT_AUTOTROOPS");	//"自動出兵"
    OPT_RESERVATION   = cgetCheckBoxValue("OPT_RESERVATION");	//"出兵予約"
    OPT_TRADEDISPMORE = cgetCheckBoxValue("OPT_TRADEDISPMORE");	//"トレードをもっと表示"
    OPT_TRADESUPPORT  = cgetCheckBoxValue("OPT_TRADESUPPORT");	//"トレードサポート"
    OPT_TRADESCORE    = cgetCheckBoxValue("OPT_TRADESCORE");	//"トレードスコア単価計算"
    OPT_TRADECARDID   = cgetCheckBoxValue("OPT_TRADECARDID");	//"トレードカードＩＤ表示"
    OPT_TRADETRADEID  = cgetCheckBoxValue("OPT_TRADETRADEID");	//"トレードトレードＩＤ表示"	111011faraway
    OPT_TRADESTATUS   = cgetCheckBoxValue("OPT_TRADESTATUS");	//"トレードステータス表示"
    OPT_TRADEINCOME   = cgetCheckBoxValue("OPT_TRADEINCOME");	//"トレード収入計算"
    OPT_HISTANALYSIS  = cgetCheckBoxValue("OPT_HISTANALYSIS");	//"武将ダス履歴抽出分析 Ver1.09"
    OPT_QUESTASSIST   = cgetCheckBoxValue("OPT_QUESTASSIST");	//"クエスト補助"
//faraway110929 end
//faraway start
    OPT_MAPTOOL = cgetCheckBoxValue("OPT_MAPTOOL");
    OPT_TIMER = cgetCheckBoxValue("OPT_TIMER");
    OPT_ALLIANCE = cgetCheckBoxValue("OPT_ALLIANCE");
    OPT_DEVELOPMENT = cgetCheckBoxValue("OPT_DEVELOPMENT");
    OPT_STATISTICS = cgetCheckBoxValue("OPT_STATISTICS");
    OPT_ALLIANCELOG = cgetCheckBoxValue("OPT_ALLIANCELOG");
    OPT_NPCFORT = cgetCheckBoxValue("OPT_NPCFORT");
    OPT_RIGHTCLICK = cgetCheckBoxValue("OPT_RIGHTCLICK");
    OPT_ALLIANCELEVEL = cgetCheckBoxValue("OPT_ALLIANCELEVEL");
    OPT_MISTAKEPREVENTION = cgetCheckBoxValue("OPT_MISTAKEPREVENTION");
    OPT_LETTERTRANSMISSION = cgetCheckBoxValue("OPT_LETTERTRANSMISSION");
    OPT_LETTERBROADCAST = cgetCheckBoxValue("OPT_LETTERBROADCAST");
    OPT_LETTERPRESERVATION = cgetCheckBoxValue("OPT_LETTERPRESERVATION");
    OPT_TRADINGRETRIEVAL = cgetCheckBoxValue("OPT_TRADINGRETRIEVAL");
    OPT_TRADINGAFTER = cgetCheckBoxValue("OPT_TRADINGAFTER");
    OPT_NAVIGATIONADDITION = cgetCheckBoxValue("OPT_NAVIGATIONADDITION");
    OPT_BRO3AUTO = cgetCheckBoxValue("OPT_BRO3AUTO");
	OPT_CHANGE_MOVE_SIZE = cgetCheckBoxValue("OPT_CHANGE_MOVE_SIZE");
	OPT_DISPLAY_ADM_INFO = cgetCheckBoxValue("OPT_DISPLAY_ADM_INFO");
	OPT_MASS_SHOKAN_TOOL = cgetCheckBoxValue("OPT_MASS_SHOKAN_TOOL");
	OPT_DECK_TOOL = cgetCheckBoxValue("OPT_DECK_TOOL");
	OPT_CALCN_1KI = cgetCheckBoxValue("OPT_CALCN_1KI");
//faraway end
    OPT_VILLAGE = cgetCheckBoxValue("OPT_VILLAGE");
    OPT_BASELINK = cgetCheckBoxValue("OPT_BASELINK");
    OPT_MAPLINK = cgetCheckBoxValue("OPT_MAPLINK");
    OPT_XYLINK = cgetCheckBoxValue("OPT_XYLINK");
    OPT_XYLINK_NK = cgetCheckBoxValue("OPT_XYLINK_NK");
    OPT_LARGEICON = cgetCheckBoxValue("OPT_LARGEICON");
    OPT_TTBL = cgetCheckBoxValue("OPT_TTBL");
    OPT_MEMO = cgetCheckBoxValue("OPT_MEMO");
    OPT_MEMO_FONT_SIZE = cgetTextBoxValue("OPT_MEMO_FONT_SIZE");
    OPT_MEMO_WIDTH = cgetTextBoxValue("OPT_MEMO_WIDTH");
    OPT_MEMO_HEIGHT = cgetTextBoxValue("OPT_MEMO_HEIGHT");
    OPT_MEMO_COUNT = cgetTextBoxValue("OPT_MEMO_COUNT");
    OPT_MAPLINK_FONT_SIZE = cgetTextBoxValue("OPT_MAPLINK_FONT_SIZE");
    OPT_DETAILS = cgetCheckBoxValue("OPT_DETAILS");
    OPT_DETAILS_UP = cgetCheckBoxValue("OPT_DETAILS_UP");
//  OPT_DECK = cgetCheckBoxValue("OPT_DECK");
    OPT_DECK_SET = cgetCheckBoxValue("OPT_DECK_SET");
    OPT_CTIME_B = cgetCheckBoxValue("OPT_CTIME_B");
    OPT_CTIME_U = cgetCheckBoxValue("OPT_CTIME_U");
    OPT_ALLY = cgetCheckBoxValue("OPT_ALLY");
    OPT_ALLY_IS = cgetCheckBoxValue("OPT_ALLY_IS");
    OPT_ALLY_XY = cgetCheckBoxValue("OPT_ALLY_XY");
    OPT_ALLY_CSV = cgetCheckBoxValue("OPT_ALLY_CSV");
    OPT_RES_T = cgetCheckBoxValue("OPT_RES_T");
    OPT_RES_TIME = cgetCheckBoxValue("OPT_RES_TIME");
    OPT_REMOVELIST = cgetCheckBoxValue("OPT_REMOVELIST");
    OPT_MAPLIST = cgetCheckBoxValue("OPT_MAPLIST");
    OPT_TTDISTANCE = cgetCheckBoxValue("OPT_DISTANCE");
    OPT_TTDISTANCE_ITEMS = getDistanceBox(10);
    OPT_TTALLYPRSN = cgetCheckBoxValue("OPT_TTALLYPRSN");
    OPT_USER_STAR = cgetCheckBoxValue("OPT_USER_STAR");
    OPT_USER_LEVEL = cgetCheckBoxValue("OPT_USER_LEVEL");
//  OPT_REPORT_NP = cgetCheckBoxValue("OPT_REPORT_NP");
    OPT_MAPCENTER = cgetCheckBoxValue("OPT_MAPCENTER");
    OPT_TBREST = cgetCheckBoxValue("OPT_TBREST");
    OPT_DELMSG = cgetCheckBoxValue("OPT_DELMSG");
    OPT_TSENDTIME = cgetCheckBoxValue("OPT_TSENDTIME");
    OPT_SMALLBTN = cgetCheckBoxValue("OPT_SMALLBTN");
    OPT_ATTACKMAP = cgetCheckBoxValue("OPT_ATTACKMAP");
    OPT_CARD_CMB = cgetCheckBoxValue("OPT_CARD_CMB");
    OPT_PIKA_YOROZU = cgetCheckBoxValue("OPT_PIKA_YOROZU");
    OPT_PIKA_HPREST = cgetCheckBoxValue("OPT_PIKA_HPREST");
    OPT_PIKA_MAPHELP = cgetCheckBoxValue("OPT_PIKA_MAPHELP");
    OPT_PIKA_TRDHELP = cgetCheckBoxValue("OPT_PIKA_TRDHELP");
    OPT_PIKA_BLINKBLD = cgetCheckBoxValue("OPT_PIKA_BLINKBLD");
    OPT_SUZAN_SEISAN = cgetCheckBoxValue("OPT_SUZAN_SEISAN");

    OPT_CASTLE_AID = cgetCheckBoxValue("OPT_CASTLE_AID");
    OPT_NEXT_MEISEI = cgetCheckBoxValue("OPT_NEXT_MEISEI");
    OPT_TIMER_LINK_DEPOT = cgetCheckBoxValue("OPT_TIMER_LINK_DEPOT");
    if (isNarrow) {
        OPT_VILLAGE_LIST_BOX = cgetCheckBoxValue( "OPT_VILLAGE_LIST_BOX");
    }

    OPT_STYLE = cgetCheckBoxValue("OPT_STYLE");
    DISP_RANK = cgetCheckBoxValue("DISP_RANK");

    OPT_ILLUST_CHANGE = cgetCheckBoxValue("OPT_ILLUST_CHANGE"); // 某ゲームのイラストに置き換えるアホツール
    OPT_UR_CHANGE = cgetCheckBoxValue("OPT_UR_CHANGE"); // 見た目を全部URに置き換えるアホツール
    OPT_SR_CHANGE = cgetCheckBoxValue("OPT_SR_CHANGE"); // 見た目を全部SRに置き換えるアホツール
    OPT_SENSEI_CHANGE = cgetCheckBoxValue("OPT_SENSEI_CHANGE"); // 見た目を全部SRに置き換えるアホツール

//faraway110929 start
    csaveData("OPT_REPORTLOG",    OPT_REPORTLOG    );	//"報告書・同盟ログCSV出力"
    csaveData("OPT_AUTOROUND",    OPT_AUTOROUND    );	//"自動巡回"
    csaveData("OPT_AUTOTROOPS",   OPT_AUTOTROOPS   );	//"自動出兵"
    csaveData("OPT_RESERVATION",  OPT_RESERVATION  );	//"出兵予約"
    csaveData("OPT_TRADEDISPMORE",OPT_TRADEDISPMORE);	//"トレードをもっと表示"
    csaveData("OPT_TRADESUPPORT", OPT_TRADESUPPORT );	//"トレードサポート"
    csaveData("OPT_TRADESCORE",   OPT_TRADESCORE   );	//"トレードスコア単価計算"
    csaveData("OPT_TRADECARDID",  OPT_TRADECARDID  );	//"トレードカードＩＤ表示"
    csaveData("OPT_TRADETRADEID", OPT_TRADETRADEID );	//"トレードトレードＩＤ表示"	faraway111011
    csaveData("OPT_TRADESTATUS",  OPT_TRADESTATUS  );	//"トレードステータス表示"
    csaveData("OPT_TRADEINCOME",  OPT_TRADEINCOME  );	//"トレード収入計算"
    csaveData("OPT_HISTANALYSIS", OPT_HISTANALYSIS );	//"武将ダス履歴抽出分析 Ver1.09"
    csaveData("OPT_QUESTASSIST",  OPT_QUESTASSIST  );	//"クエスト補助"
//faraway110929 end
//faraway start
    csaveData( "OPT_MAPTOOL", OPT_MAPTOOL );
    csaveData( "OPT_TIMER", OPT_TIMER );
    csaveData( "OPT_ALLIANCE", OPT_ALLIANCE );
    csaveData( "OPT_DEVELOPMENT", OPT_DEVELOPMENT );
    csaveData( "OPT_STATISTICS", OPT_STATISTICS );
    csaveData( "OPT_ALLIANCELOG", OPT_ALLIANCELOG );
    csaveData( "OPT_NPCFORT", OPT_NPCFORT );
    csaveData( "OPT_RIGHTCLICK", OPT_RIGHTCLICK );
    csaveData( "OPT_ALLIANCELEVEL", OPT_ALLIANCELEVEL );
    csaveData( "OPT_MISTAKEPREVENTION", OPT_MISTAKEPREVENTION );
    csaveData( "OPT_LETTERTRANSMISSION", OPT_LETTERTRANSMISSION );
    csaveData( "OPT_LETTERBROADCAST", OPT_LETTERBROADCAST );
    csaveData( "OPT_LETTERPRESERVATION", OPT_LETTERPRESERVATION );
    csaveData( "OPT_TRADINGRETRIEVAL", OPT_TRADINGRETRIEVAL );
    csaveData( "OPT_TRADINGAFTER", OPT_TRADINGAFTER );
    csaveData( "OPT_NAVIGATIONADDITION", OPT_NAVIGATIONADDITION );
    csaveData( "OPT_BRO3AUTO", OPT_BRO3AUTO );
    csaveData( "OPT_CHANGE_MOVE_SIZE", OPT_CHANGE_MOVE_SIZE );
    csaveData( "OPT_DISPLAY_ADM_INFO", OPT_DISPLAY_ADM_INFO );
    csaveData( "OPT_MASS_SHOKAN_TOOL", OPT_MASS_SHOKAN_TOOL );
    csaveData( "OPT_DECK_TOOL", OPT_DECK_TOOL );
    csaveData( "OPT_CALCN_1KI", OPT_CALCN_1KI );
//faraway end
    csaveData( "OPT_VILLAGE", OPT_VILLAGE );
    csaveData( "OPT_BASELINK", OPT_BASELINK );
    csaveData( "OPT_MAPLINK", OPT_MAPLINK );
    csaveData( "OPT_XYLINK", OPT_XYLINK );
    csaveData( "OPT_XYLINK_NK", OPT_XYLINK_NK );
    csaveData( "OPT_LARGEICON", OPT_LARGEICON );
    csaveData( "OPT_TTBL", OPT_TTBL );
    csaveData( "OPT_MEMO", OPT_MEMO );
    csaveData( "OPT_MEMO_FONT_SIZE", OPT_MEMO_FONT_SIZE );
    csaveData( "OPT_MEMO_WIDTH", OPT_MEMO_WIDTH );
    csaveData( "OPT_MEMO_HEIGHT", OPT_MEMO_HEIGHT );
    csaveData( "OPT_MEMO_COUNT", OPT_MEMO_COUNT );
    csaveData( "OPT_MAPLINK_FONT_SIZE", OPT_MAPLINK_FONT_SIZE );
    csaveData( "OPT_DETAILS", OPT_DETAILS );
    csaveData( "OPT_DETAILS_UP", OPT_DETAILS_UP );
//  csaveData( "OPT_DECK", OPT_DECK );
    csaveData( "OPT_DECK_SET", OPT_DECK_SET );
    csaveData( "OPT_CTIME_B", OPT_CTIME_B );
    csaveData( "OPT_CTIME_U", OPT_CTIME_U );
    csaveData( "OPT_ALLY", OPT_ALLY );
    csaveData( "OPT_ALLY_IS", OPT_ALLY_IS );
    csaveData( "OPT_ALLY_XY", OPT_ALLY_XY );
    csaveData( "OPT_ALLY_CSV", OPT_ALLY_CSV );
    csaveData( "OPT_RES_T", OPT_RES_T );
    csaveData( "OPT_RES_TIME", OPT_RES_TIME );
    csaveData( "OPT_REMOVELIST", OPT_REMOVELIST );
    csaveData( "OPT_MAPLIST", OPT_MAPLIST );
    csaveData( "OPT_DISTANCE", OPT_TTDISTANCE );
    csaveData( "OPT_DISTANCE_ITEMS", OPT_TTDISTANCE_ITEMS, true, true );
    csaveData( "OPT_TTALLYPRSN", OPT_TTALLYPRSN );
    csaveData( "OPT_USER_STAR", OPT_USER_STAR );
    csaveData( "OPT_USER_LEVEL", OPT_USER_LEVEL );
//  csaveData( "OPT_REPORT_NP", OPT_REPORT_NP );
    csaveData( "OPT_MAPCENTER", OPT_MAPCENTER );
    csaveData( "OPT_TBREST", OPT_TBREST );
    csaveData( "OPT_DELMSG", OPT_DELMSG );
    csaveData( "OPT_TSENDTIME", OPT_TSENDTIME );
    csaveData( "OPT_SMALLBTN", OPT_SMALLBTN );
    csaveData( "OPT_ATTACKMAP", OPT_ATTACKMAP );
    csaveData( "OPT_CARD_CMB", OPT_CARD_CMB );
    csaveData( "OPT_PIKA_YOROZU", OPT_PIKA_YOROZU );
    csaveData( "OPT_PIKA_HPREST", OPT_PIKA_HPREST );
    csaveData( "OPT_PIKA_MAPHELP", OPT_PIKA_MAPHELP );
    csaveData( "OPT_PIKA_TRDHELP", OPT_PIKA_TRDHELP );
    csaveData( "OPT_PIKA_BLINKBLD", OPT_PIKA_BLINKBLD );
    csaveData( "OPT_SUZAN_SEISAN", OPT_SUZAN_SEISAN );

    csaveData( "OPT_CASTLE_AID", OPT_CASTLE_AID );
    csaveData( "OPT_NEXT_MEISEI", OPT_NEXT_MEISEI );
    csaveData( "OPT_TIMER_LINK_DEPOT", OPT_TIMER_LINK_DEPOT );
    if (isNarrow) {
        csaveData( "OPT_VILLAGE_LIST_BOX", OPT_VILLAGE_LIST_BOX );
    }

    csaveData( "OPT_STYLE", OPT_STYLE );
    csaveData( "DISP_RANK", DISP_RANK );

    csaveData( "OPT_ILLUST_CHANGE", OPT_ILLUST_CHANGE ); // 某ゲームのイラストに置き換えるアホツール
    csaveData( "OPT_UR_CHANGE", OPT_UR_CHANGE ); // 見た目を全部URに置き換えるアホツール
    csaveData( "OPT_SR_CHANGE", OPT_SR_CHANGE ); // 見た目を全部SRに置き換えるアホツール
    csaveData( "OPT_SENSEI_CHANGE", OPT_SENSEI_CHANGE ); // 見た目を全部SRに置き換えるアホツール

    alert("設定を保存しました");
    deleteOptionsHtml();
}
function getMyInfo()
{
    if( (location.pathname == "/user/" ) && !URL_PARAM.user_id ) {

        var uid=0, aid=0;
        var uidtd = $x("//table[@class=\"commonTables\"]//tr[2]//td[3]");
        if( uidtd ) {
            uid = uidtd.innerHTML.match(/\/bbs\/personal_topic_view\.php\?user_id\=(\d+)/);
        }
        var aidtd = $x("//table[@class=\"commonTables\"]//tr[4]//td[5]");
        if( aidtd ) {
            aid = d.body.innerHTML.match(/\/alliance\/info\.php\?id\=(\d+)/);
        }
        if( uid && aid ) {
            csaveData( "user_id", uid[1], true );
            csaveData( "ally_id", aid[1], true );
        }
    }
    USER_ID = cloadData( "user_id", "", true );
    ALLY_ID = cloadData( "ally_id", "", true );
}
function resetMapLink() {
    if( !confirm("登録済みリンクを全て削除します。\nよろしいですか？") ) return;

    var maplinks = cloadData( "links", 0, true );
    for(i=0 ; i<maplinks ; i++) {
        cdelData( "link" + i, true );
    }
    cdelData( "links", true);

    resetMapLinks();
}

function resetUserXY() {
    if( !confirm("同盟員一覧の座標情報を全て削除します。\nよろしいですか？") ) return;
    cresetUserXY();
}

function resetUserStar() {
    if( !confirm("君主の★情報と自領地のLevel情報を全て削除します。\nよろしいですか？") ) return;
    cresetUserStar();
    cdelData("MyLevelList",true);
}

function openOptions() {
    deleteOptionsHtml();
    addOptionsHtml();
}

function deleteOptionsHtml() {
    var elem = $("beyond_OptionsWindow");
    if (!elem ) return;
    $("beyond_floatpanel").removeChild(elem);
}

function addOptionsHtml() {

    var oc = d.createElement("div");
    oc.id = "beyond_OptionsWindow";
    oc.style.position = "absolute";
    oc.style.backgroundColor = "#999";
    oc.style.border = "outset 2px #ccc";
    oc.style.fontSize = "12px";
    oc.style.padding = "15px";
    oc.style.zIndex = 1000000;

    var x = cloadData("config_window_x", 10);
    var y = cloadData("config_window_y", 80);
    if(x < 0) x = 0;
    if(y < 0) y = 0;
x=x-25;// ﾒﾆｭｰ表示位置を左に寄せて、移動時間表示の表示1～10の欄が折り返さないようにしたfaraway110513
    oc.style.left = x + "px";
    oc.style.top = y + "px";

    $e(oc, "mousedown", function(event){
                if( event.target != $("beyond_OptionsWindow")) {return false;}
                g_MD="beyond_OptionsWindow";
                g_MX=event.pageX-parseInt(this.style.left,10);
                g_MY=event.pageY-parseInt(this.style.top,10);
                event.preventDefault();});
    $e(d, "mousemove", function(event){
                if(g_MD != "beyond_OptionsWindow") return true;
                var oc = $("beyond_OptionsWindow");
                if( !oc ) return true;
                var x = event.pageX - g_MX;
                var y = event.pageY - g_MY;
                oc.style.left = x + "px";
                oc.style.top = y + "px";
                csaveData("config_window_x", x);
                csaveData("config_window_y", y);
                });
    $e(d, "mouseup", function(event){g_MD="";});

    var tx = d.createElement("div");

    var ah = d.createElement("a");
    ah.href = "http://www1.ocn.ne.jp/~hatt/3gkb/";
    tx.title = ah.href;
    ah.target = "_blank";
    ah.appendChild(d.createTextNode(VERSION_NAME));
    tx.appendChild(ah);
    tx.style.padding = "4px";
    tx.style.fontSize = "10px";
    tx.style.color = "steelblue";
    oc.appendChild(tx);

    $("beyond_floatpanel").appendChild(oc);

    var tbl = d.createElement("table");
    tbl.style.border ="0px";
    var tr = d.createElement("tr");
    var td1 = d.createElement("td");
    td1.style.padding = "15px";
    td1.style.verticalAlign = "top";
    var td2 = d.createElement("td");
    td2.style.padding = "15px";
    td2.style.verticalAlign = "top";
    var td3 = d.createElement("td");
    td3.style.padding = "15px";
    td3.style.verticalAlign = "top";
    var td4 = d.createElement("td");
    td4.style.padding = "15px";
    td4.style.verticalAlign = "top";
    tr.appendChild(td1);
    tr.appendChild(td2);
    tr.appendChild(td3);
    tr.appendChild(td4);
    tbl.appendChild(tr);
    oc.appendChild(tbl);


    //設定項目
    ccreateCheckBox(td1, "OPT_SMALLBTN", OPT_SMALLBTN, "小さいボタン","右上の4つのボタンを小さくします。状況も1行にします。",0);
    ccreateCheckBox(td1, "OPT_LARGEICON", OPT_LARGEICON, "大きめアイコン","拠点リンク・領地リンクなどのアイコンを14x14サイズにします（アイコン提供:ゆう＠てらおとめん様）",0);
    ccreateCheckBox(td1, "OPT_PIKA_BLINKBLD", OPT_PIKA_BLINKBLD, "都市画面改善","建設中を点滅させます",0);
    ccreateCheckBox(td1, "OPT_VILLAGE", OPT_VILLAGE, "建築表示機能","村の表示で資源不足で建築不可能な場合、LV表示を黄色にします",0);
    ccreateCheckBox(td1, "OPT_BASELINK", OPT_BASELINK, "拠点リンク機能","城や村のリンクにマップ・内政などのリンクを追加します",0);
    ccreateCheckBox(td1, "OPT_XYLINK", OPT_XYLINK, "座標リンク機能","掲示板などの(xx,yy)にリンク機能を追加します",0);
    ccreateCheckBox(td1, "OPT_XYLINK_NK", OPT_XYLINK_NK, "両端のカッコ無視","xx,yyだけでもリンクします。1,000などの数字もリンクになってしまいます",20);
    ccreateCheckBox(td1, "OPT_TTBL", OPT_TTBL, "兵力整形機能","掲示板に貼り付けた兵力一覧を整形します",0);
    ccreateCheckBox(td1, "OPT_DETAILS", OPT_DETAILS, "ログ合計表示機能","同盟ログの兵力＋援軍の合計を表示します",0);
    ccreateCheckBox(td1, "OPT_DETAILS_UP", OPT_DETAILS_UP, "合計を上に出す","合計表示を、下じゃなくて上に出します",20);
//  ccreateCheckBox(td1, "OPT_DECK", OPT_DECK, "デッキ画面改善","デッキ画面の改善を行います",0);
    ccreateCheckBox(td1, "OPT_DECK_SET", OPT_DECK_SET, "デッキセット先自動選択","初期表示のセット先拠点を現在選択中の拠点にします",0);
    ccreateCheckBox(td1, "OPT_CTIME_B", OPT_CTIME_B, "完了時刻の表示(建物)","建築作成時に完了予定日時を表示します。",0);
    ccreateCheckBox(td1, "OPT_CTIME_U", OPT_CTIME_U, "完了時刻の表示(ユニット)","ユニット作成時に完了予定日時を表示します。",0);
    ccreateCheckBox(td1, "OPT_RES_T", OPT_RES_T, "資源生産合計表示","資源生産量の合計を表示します",0);
    ccreateCheckBox(td1, "OPT_RES_TIME", OPT_RES_TIME, "資源時間の表示","資源の残り時間を表示します",0);
    ccreateCheckBox(td1, "OPT_REMOVELIST", OPT_REMOVELIST, "破棄中の領地表示","破棄中の領地一覧を表示し、マップにマークを付けます",0);
    ccreateCheckBox(td1, "OPT_SUZAN_SEISAN", OPT_SUZAN_SEISAN, "拠点生産量表示","拠点の生産量を表示します",0);
    ccreateCheckBox(td1, "OPT_TTALLYPRSN", OPT_TTALLYPRSN, "同盟/君主表示","全ての[拠点/領地]リンクのToolTipsを同盟/君主表示に変更します",0);
    ccreateCheckBox(td1, "OPT_ALLY", OPT_ALLY, "同盟表示改善","同盟員一覧の表示改善",0);
    ccreateCheckBox(td1, "OPT_ALLY_IS", OPT_ALLY_IS, "同盟表示のソート","同盟員一覧の並べ替えを追加します",15);
    ccreateCheckBox(td1, "OPT_ALLY_XY", OPT_ALLY_XY, "同盟員座標表示","同盟員一覧に本居城の座標を追加します",15);
    ccreateCheckBox(td1, "OPT_ALLY_CSV", OPT_ALLY_CSV, "同盟員情報CSV","同盟員一覧の詳細をCSV表示します。",15);
    ccreateCheckBox(td1, "OPT_ALLIANCE", OPT_ALLIANCE, "同盟貢献チェッカー","寄付の確認等動きがわかります",0);	//110929
    ccreateCheckBox(td1, "OPT_DEVELOPMENT", OPT_DEVELOPMENT, "発展チェッカー","放置者発見用",0);				//110929
    ccreateCheckBox(td1, "OPT_RIGHTCLICK", OPT_RIGHTCLICK, "右クリック拡張","全体地図＆都市画面で右クリック拡張されます",0);//faraway110929


    ccreateCheckBox(td2, "OPT_DISTANCE", OPT_TTDISTANCE, "移動時間表示","全ての[兵を送る]リンクのToolTipsを移動時間の目安表示に変更します",0);
//faraway 110504 strat	移動時間表示の文字化け対応
	var work_0 = OPT_TTDISTANCE_ITEMS;	
    try {
		work_0 = work_0.replace("[", "", "g");
		work_0 = work_0.replace("]", "", "g");
		work_0 = work_0.replace(" ", "", "g");
		work_0 = work_0.replace("\\", "", "g");
		work_0 = work_0.replace("\"", "", "g");
		work_0 = work_0.split(",");
    }catch(e) {
	}
    createDistanceBox(td2, work_0, 10);
//faraway 110504 end

    //faraway110504createDistanceBox(td2, OPT_TTDISTANCE_ITEMS, 10);
    ccreateCheckBox(td2, "OPT_MEMO", OPT_MEMO, "メモ機能","メモ機能",0);
    ccreateTextBox(td2, "OPT_MEMO_FONT_SIZE", OPT_MEMO_FONT_SIZE, "フォントサイズ","メモのフォントサイズを指定します。デフォルト=10",5,20);
    ccreateTextBox(td2, "OPT_MEMO_WIDTH", OPT_MEMO_WIDTH, "メモ幅","メモの幅を指定します。デフォルト=20",5,20);
    ccreateTextBox(td2, "OPT_MEMO_HEIGHT", OPT_MEMO_HEIGHT, "メモ高","メモの高さを指定します。デフォルト=5",5,20);
    ccreateTextBox(td2, "OPT_MEMO_COUNT", OPT_MEMO_COUNT, "メモ数(1～5)","メモ欄の数を指定します。デフォルト=1",5,20);
    ccreateCheckBox(td2, "OPT_MAPLINK", OPT_MAPLINK, "領地リンク機能","領地や敵地・NPC砦等へのリンク",0);
    ccreateTextBox(td2, "OPT_MAPLINK_FONT_SIZE", OPT_MAPLINK_FONT_SIZE, "フォントサイズ","領地リンクのフォントサイズを指定します。デフォルト=10", 5, 20);
    ccreateCheckBox(td2, "OPT_STYLE", OPT_STYLE, "スタイル変更","スタイルを旧スタイルに近い形に変更します",0);
    ccreateCheckBox(td2, "DISP_RANK", DISP_RANK, "ランキングの非表示","チェックするとランキングが消える",0);
    ccreateCheckBox(td2, "OPT_ALLIANCELOG", OPT_ALLIANCELOG, "同盟ログ","新しい同盟ログに修正が入ります",0);//110929
    ccreateCheckBox(td2, "OPT_REPORTLOG", OPT_REPORTLOG, "報告書・同盟ログCSV出力","一時保管等",0);			//110929

    ccreateCheckBox(td3, "OPT_USER_STAR", OPT_USER_STAR, "君主★情報表示","プロフィール画面に領地の★表示を追加します",0);
    ccreateCheckBox(td3, "OPT_USER_LEVEL", OPT_USER_LEVEL, "領地レベル表示","プロフィール画面に領地のレベル表示を追加します",0);
//  ccreateCheckBox(td3, "OPT_REPORT_NP", OPT_REPORT_NP, "同盟ログ前後表示","同盟ログの詳細に、[前のログ]・[次のログ]を追加します（限定的）",0);
    ccreateCheckBox(td3, "OPT_TBREST", OPT_TBREST, "討伐ゲージ回復時間予測機能","武将の討伐ゲージが300 or 500になる時間を表示します",0);
    ccreateCheckBox(td4, "OPT_DELMSG", OPT_DELMSG, "書簡/報告書削除機能","書簡や報告書の内容ページに、削除ボタンを付けます",0);
    ccreateCheckBox(td3, "OPT_TSENDTIME", OPT_TSENDTIME, "出発時刻計算","出兵画面で、到着希望時間から出発時刻を計算します",0);
    ccreateCheckBox(td3, "OPT_ATTACKMAP", OPT_ATTACKMAP, "出兵表示機能","マップ上に、現在出兵中の目印を付けます",0);
//faraway110929->111011同一カード合成復活
    ccreateCheckBox(td3, "OPT_CARD_CMB", OPT_CARD_CMB, "同一カード合成ボタン","カード合成後に、同一カードで合成を続けるボタンを追加します",0);
    ccreateCheckBox(td3, "OPT_PIKA_YOROZU", OPT_PIKA_YOROZU, "ヨロズダス引き忘れ防止機能","ヨロズダスがリセットされたら通知してくれます",0);
    ccreateCheckBox(td3, "OPT_PIKA_HPREST", OPT_PIKA_HPREST, "武将の回復時間予測機能","武将のHPが100になる時間を表示します",0);
//faraway110929    ccreateCheckBox(td3, "OPT_PIKA_TRDHELP", OPT_PIKA_TRDHELP, "トレード画面入力改善","4桁数字を入力するとカードNoとして検索します",0);
    ccreateCheckBox(td3, "OPT_CASTLE_AID", OPT_CASTLE_AID, "拠点援軍ボタン機能","城や村のリンクの横に援軍ボタンを表示します",0);
    ccreateCheckBox(td3, "OPT_NEXT_MEISEI", OPT_NEXT_MEISEI, "名声獲得タイマー機能","次の名声値獲得までの時間を表示します",0);
    ccreateCheckBox(td3, "OPT_TIMER_LINK_DEPOT", OPT_TIMER_LINK_DEPOT, "ブラ三タイマー格納機能","浮浪プログラマさん作成のブラウザ三国志タイマーをサイドボックスに格納します",0);
    if (isNarrow) {
    ccreateCheckBox(td3, "OPT_VILLAGE_LIST_BOX", OPT_VILLAGE_LIST_BOX, "都市リスト表示機能","都市のタブ以外でも都市のリストを表示できるようにします",0);
    }
    ccreateCheckBox(td3, "OPT_MAPLIST", OPT_MAPLIST, "マップの地形一覧","マップ上の拠点・領地リストを表示します",0);
    ccreateCheckBox(td3, "OPT_MAPCENTER", OPT_MAPCENTER, "マップ中央表示","マップ中央に目印を表示し、中央座標を表示します",0);
    ccreateCheckBox(td3, "OPT_PIKA_MAPHELP", OPT_PIKA_MAPHELP, "マップ画面検索改善","X座標のところに999,999等を入れてもジャンプしてくれます",0);
    ccreateCheckBox(td3, "OPT_NPCFORT", OPT_NPCFORT, "NPC砦、領土情報検索ver2.49","高機能地図です",0);
    ccreateCheckBox(td3, "OPT_CHANGE_MOVE_SIZE", OPT_CHANGE_MOVE_SIZE, "マップ移動距離カスタムver1.10","全体地図の移動距離が変わります",0);
    ccreateCheckBox(td3, "OPT_DISPLAY_ADM_INFO", OPT_DISPLAY_ADM_INFO, "内政武将表示ver1.09","内政武将が都市画面に出ます",0);
    ccreateCheckBox(td3, "OPT_MAPTOOL", OPT_MAPTOOL, "地図(map_tool Ver.2.39.d4ex2)","map_tool地図",0);
//faraway110929    ccreateCheckBox(td3, "OPT_RIGHTCLICK", OPT_RIGHTCLICK, "右クリック拡張","全体地図＆都市画面で右クリック拡張されます",0);
    ccreateCheckBox(td3, "OPT_AUTOROUND", OPT_AUTOROUND, "自動巡回","Auto_Map_Move Ver0.5β。やりすぎると重いです",0);	//faraway110929
    ccreateCheckBox(td3, "OPT_AUTOTROOPS", OPT_AUTOTROOPS, "自動出兵","初期設定では誤爆あるので設定必須です",0);			//faraway110929
    ccreateCheckBox(td3, "OPT_RESERVATION", OPT_RESERVATION, "出兵予約","単発予約です。ログアウト注意～",0);				//faraway110929
    ccreateCheckBox(td3, "OPT_STATISTICS", OPT_STATISTICS, "統計グラフ化","統計グラフ化",0);							//faraway110929
    ccreateCheckBox(td3, "OPT_MISTAKEPREVENTION", OPT_MISTAKEPREVENTION, "ミス防止補助","斥候騎兵誤生産対策＆単騎出兵対策",0);
    ccreateCheckBox(td3, "OPT_QUESTASSIST", OPT_QUESTASSIST, "クエスト補助","クエストの報酬説明",0);

//faraway110929    ccreateCheckBox(td4, "OPT_ALLIANCE", OPT_ALLIANCE, "同盟貢献チェッカー","寄付の確認等動きがわかります",0);
//faraway110929    ccreateCheckBox(td4, "OPT_DEVELOPMENT", OPT_DEVELOPMENT, "発展チェッカー","放置者発見用",0);
//faraway110929    ccreateCheckBox(td4, "OPT_STATISTICS", OPT_STATISTICS, "統計グラフ化","統計グラフ化",0);
//faraway110929    ccreateCheckBox(td4, "OPT_ALLIANCELOG", OPT_ALLIANCELOG, "同盟ログ","新しい同盟ログに修正が入ります",0);
    ccreateCheckBox(td4, "OPT_MASS_SHOKAN_TOOL", OPT_MASS_SHOKAN_TOOL, "書簡を複数に送付（最大○○人）","受取側は個別書簡になります",0);
    ccreateCheckBox(td4, "OPT_LETTERTRANSMISSION", OPT_LETTERTRANSMISSION, "書簡送信アシスタント","書簡送信先が登録できます",0);
    ccreateCheckBox(td4, "OPT_LETTERBROADCAST", OPT_LETTERBROADCAST, "書簡同報リンク","書簡同報リンク",0);
    ccreateCheckBox(td4, "OPT_LETTERPRESERVATION", OPT_LETTERPRESERVATION, "書簡保存＆検索","保存＆検索できるようになります",0);
//  ccreateCheckBox(td4, "OPT_TRADINGAFTER", OPT_TRADINGAFTER, "FavoriteTrade　ver.2.40","運営書簡を選んだり、まとめて開封します",0);
    ccreateCheckBox(td4, "OPT_PIKA_TRDHELP", OPT_PIKA_TRDHELP, "トレード画面入力改善","4桁数字を入力するとカードNoとして検索します",0);//faraway110929
    ccreateCheckBox(td4, "OPT_TRADINGRETRIEVAL", OPT_TRADINGRETRIEVAL, "トレード検索条件記憶","トレード検索条件記憶できます",0);
    ccreateCheckBox(td4, "OPT_TRADINGAFTER", OPT_TRADINGAFTER, "トレードその後","運営書簡を選んだり、まとめて開封します",0);
    ccreateCheckBox(td4, "OPT_TRADEDISPMORE", OPT_TRADEDISPMORE, "トレードをもっと表示","10:15に落としまくる人用",0);		//faraway110929
    ccreateCheckBox(td4, "OPT_TRADESUPPORT", OPT_TRADESUPPORT, "トレードサポート","最低価格調査",0);						//faraway110929
    ccreateCheckBox(td4, "OPT_TRADESCORE", OPT_TRADESCORE, "トレードスコア単価計算","スコア至上主義",0);				//faraway110929
    ccreateCheckBox(td4, "OPT_TRADECARDID", OPT_TRADECARDID, "トレードカードＩＤ表示","特定個人との取引できます",0);	//faraway110929
    ccreateCheckBox(td4, "OPT_TRADETRADEID", OPT_TRADETRADEID, "トレードトレードＩＤ表示","特定個人との取引できます",0);	//hasekun
    ccreateCheckBox(td4, "OPT_TRADESTATUS", OPT_TRADESTATUS, "トレードステータス表示","ステ振りが表示されます。",0);	//faraway110929
    ccreateCheckBox(td4, "OPT_TRADEINCOME", OPT_TRADEINCOME, "トレード収入計算","収入の手取りを計算します",0);			//faraway110929
    ccreateCheckBox(td4, "OPT_BRO3AUTO", OPT_BRO3AUTO, "Auto_Bilder","建築＆内政発動＆寄付＆糧変換をします",0);
    ccreateCheckBox(td4, "OPT_DECK_TOOL", OPT_DECK_TOOL, "武将カード分類ツール","デッキ画面で分類できます",0);
//faraway110531    ccreateCheckBox(td4, "OPT_AFTER_DAY", OPT_AFTER_DAY, "削除防止","間違って消さないように。",0);
//faraway110929    ccreateCheckBox(td4, "OPT_AFTER_DAY", OPT_AFTER_DAY, "自動出兵","初期設定では誤爆あるので設定必須です",0);
    ccreateCheckBox(td4, "OPT_HISTANALYSIS", OPT_HISTANALYSIS, "武将ダス履歴抽出分析 Ver1.09","自分の引き自慢にお使いくださいｗ",0);
//faraway110531ブラウザ三国志の運営と作者からSTOPがかかり    ccreateCheckBox(td4, "OPT_AFTER_DAY", OPT_AFTER_DAY, "課金ダス封印","URなんて幻です",0);
	//faraway start
//faraway 110427 ver2.0.2 で同盟レベル表示改善組込してあるのでメニューから外す	ccreateCheckBox(td4, "OPT_ALLIANCELEVEL", OPT_ALLIANCELEVEL, "同盟レベル画面改善","同盟レベル画面改善",0);
	ccreateCheckBox(td4, "OPT_NAVIGATIONADDITION", OPT_NAVIGATIONADDITION, "ﾅﾋﾞｹﾞｰｼｮﾝにﾛｰﾙｵｰﾊﾞｰﾘﾝｸ追加","ﾅﾋﾞｹﾞｰｼｮﾝにﾛｰﾙｵｰﾊﾞｰﾘﾝｸ追",0);
	ccreateCheckBox(td4, "OPT_CALCN_1KI",        OPT_CALCN_1KI,             "討伐・空き地 民兵出現 推定機","討伐・空き地 民兵出現 推定機",0);
	//faraway end
    //ccreateCheckBox(td4, "OPT_AFTER_DAY", OPT_AFTER_DAY, "ここから後日","",0);
    //ccreateCheckBox(td4, "OPT_AFTER_DAY", OPT_AFTER_DAY, "自動出兵","自動出兵",0);
    //ccreateCheckBox(td4, "OPT_AFTER_DAY", OPT_AFTER_DAY, "履歴抽出分析ver1.09","引きの自慢（不満）大会用",0);
    //ccreateCheckBox(td4, "OPT_AFTER_DAY", OPT_AFTER_DAY, "書簡テンプレート","１個だけテンプレートつくれます。署名とか。",0);
    //ccreateCheckBox(td4, "OPT_AFTER_DAY", OPT_AFTER_DAY, "ここまで後日","",0);

   var fs = d.createElement("fieldset");
   var lg = d.createElement("legend");
   lg.appendChild(d.createTextNode("　【 お 遊 び 】 ネタなツールたち　") );
   fs.appendChild(lg);
   td4.appendChild(fs);
    ccreateCheckBox(fs, "OPT_ILLUST_CHANGE", OPT_ILLUST_CHANGE, "イラスト置き換え機能","某ゲームのイラストに置き換えます。",0);
    ccreateCheckBox(fs, "OPT_UR_CHANGE", OPT_UR_CHANGE, "見た目を全部URに置き換え機能","CだろうがUCだろうがRだろうがSRだろうが、すべてのカードの見た目をURと同じ仕様にします。",0);
    ccreateCheckBox(fs, "OPT_SR_CHANGE", OPT_SR_CHANGE, "見た目を全部SRに置き換え機能","CだろうがUCだろうがRだろうが、すべてのカードの見た目をSRと同じ仕様にします。",0);
    ccreateCheckBox(fs, "OPT_SENSEI_CHANGE", OPT_SENSEI_CHANGE, "やっぱり袁術先生","水鏡先生を袁術先生に変更に置き換えます",0);



    ccreateButton(oc, "保存", "設定内容を保存します", function() {saveOptions();});
    ccreateButton(oc, "閉じる", "設定内容を保存せず閉じます", function() {deleteOptionsHtml();});
    ccreateButton(oc, "領地リンクのクリア", "領地・君主リンクの内容を初期化します", function() {resetMapLink();});
    ccreateButton(oc, "同盟員座標のクリア", "同盟員座標を全て初期化します", function() {resetUserXY();});
    ccreateButton(oc, "★/Level情報のクリア", "君主の★情報と自領地のLevel情報を全て初期化します", function() {resetUserStar();});
    ccreateButton(oc, "領地リンクの直接編集", "領地リンクをテキストで自由に変更できます", function(event) {mapLinkList(event);});
}

function createDistanceBox(container, items, num)
{
    var sels = ["その他", "無し", "剣兵(6)",
                "槍兵(7)", "弓兵(5)", "騎兵(12)", "斥候(9)", "衝車(3)",
                "矛槍兵(10)", "弩兵(8)", "近衛騎兵(15)", "斥候騎兵(20)", "投石機(6)"];
	var sp0 = "　";//表示1～表示10の位置合わせ by faraway
    for(var i=0 ; i<num ; i++ ) {
        var src = "";
        if( sels.indexOf(items[i]) != -1 ) src = items[i];
		if(i>8) sp0="";//表示1～表示10の位置合わせ by faraway
        var cb = ccreateComboBox(container, "OPT_DISTANCE_CB" + i , sels, src, "表示" + (i+1) + sp0, (i+1) + "行目の表示", 20 );//表示1～表示10の位置合わせ by faraway
//faraway        var cb = ccreateComboBox(container, "OPT_DISTANCE_CB" + i , sels, src, "表示" + (i+1), (i+1) + "行目の表示", 20 );

        var tb = d.createElement("input");
        tb.type = "text";
        tb.id = "OPT_DISTANCE_TX" + i;
        tb.title = "例) 「超早い馬(50)」など、半角カッコの中に速度を入れて下さい";
        if( src == "" ) {
            tb.value = items[i];
        }else{
            tb.disabled ="disabled";
        }
        tb.size = 12;

        cb.parentNode.appendChild(d.createTextNode(" "));
        cb.parentNode.appendChild(tb);
        (function(no) {
            $e(cb, "change", function() {
                var cb = $("OPT_DISTANCE_CB" + no);
                var tb = $("OPT_DISTANCE_TX" + no);
                if( !cb || !tb ) return;
                if( cb.value == sels[0] ) {
                    tb.disabled ="";
                }else{
                    tb.disabled ="disabled";
                }
            });
        })(i);
    }
}
function getDistanceBox(num)
{
    var ret = new Array();
    for(var i=0 ; i<num ; i++ ) {
        var cb = $("OPT_DISTANCE_CB" + i);
        var tb = $("OPT_DISTANCE_TX" + i);
        if( !cb || !tb ) return null;
        if( cb.value == "その他" ) {
            ret.push( tb.value );
        }else if( cb.value == "無し" ) {
            ret.push("");
        }else {
            ret.push( cb.value );
        }
    }
    return ret;
}

//////////////////////
//建築表示処理
//////////////////////
function disp_village() {
    if( location.pathname != "/village.php" ) {
        return ;
    }

    //costs
    var cost_wood = [
        [10,35,40,15],
        [25, 88, 100, 38],
        [58, 202, 230, 86],
        [173, 604, 690, 259],
        [431, 1510, 1725, 647],
        [1466, 2847, 3019, 1294],
        [2493, 4839, 5132, 2200],
        [3490, 6775, 7186, 3080],
        [4537, 8807, 9341, 4003],
        [5898, 11450, 12144, 5204],
        [8119, 14434, 15787, 6766],
        [11366, 20207, 22101, 9472],
        [17050, 30311, 33152, 14208],
        [25575, 45467, 49729, 21312],
        [38362, 68199, 74593, 31698]
    ];
    var cost_stone= [
        [40, 10, 35, 15],
        [100, 25, 88, 38],
        [230, 58, 202, 86],
        [690, 173, 604, 259],
        [1725, 431, 1510, 647],
        [3019, 1466, 2847, 1294],
        [5132, 2493, 4839, 2200],
        [7186, 3490, 6775, 3080],
        [9341, 4537, 8807, 4003],
        [12144, 5898, 11450, 5204],
        [15787, 8119, 14434, 6766],
        [22101, 11366, 20207, 9472],
        [33152, 17050, 30311, 14208],
        [49729, 25575, 45467, 21312],
        [74593, 38362, 68199, 31968]
    ];
    var cost_iron=[
        [35, 40, 10, 15],
        [88, 100, 25, 38],
        [202, 230, 58, 86],
        [604, 690, 173, 259],
        [1510, 1725, 431, 647],
        [2847, 3019, 1466, 1294],
        [4839, 5132, 2493, 2200],
        [6775, 7186, 3490, 3080],
        [8807, 9341, 4537, 4003],
        [11450, 12144, 5898, 5204],
        [14434, 15787, 8119, 6766],
        [20207, 22101, 11366, 9472],
        [30311, 33152, 17050, 14208],
        [45467, 49729, 25575, 21312],
        [68199, 74593, 38362, 31968]
    ];
    var cost_rice=[
        [35, 35, 30, 0],
        [88, 88, 75, 0],
        [202, 202, 173, 0],
        [604, 604, 518, 0],
        [1510, 1510, 1294, 0],
        [3019, 3019, 2588, 0],
        [5132, 5132, 4399, 0],
        [7186, 7186, 6159, 0],
        [9341, 9341, 8007, 0],
        [12144, 12144, 10409, 0],
        [15787, 15787, 13532, 0],
        [22101, 22101, 18944, 0],
        [33152, 33152, 28416, 0],
        [49729, 49729, 42625, 0],
        [74593, 74593, 63937, 0]
    ];
    var cost_souko=[
        [83, 141, 83, 63],
        [167, 281, 167, 126],
        [300, 506, 300, 226],
        [479, 810, 479, 362],
        [671, 1134, 671, 507],
        [1044, 1253, 1044, 835],
        [1462, 1754, 1462, 1169],
        [1973, 2368, 1973, 1578],
        [2664, 3196, 2664, 2131],
        [3596, 4315, 3596, 2877],
        [4854, 5825, 4854, 3883],
        [6311, 7573, 6311, 5048],
        [8204, 9845, 8204, 6563],
        [10255, 12306, 10255, 8204],
        [12819, 15382, 12819, 10255],
        [15382, 18459, 15382, 12306],
        [18459, 22151, 18459, 14767],
        [21228, 21228, 25473, 16982],
        [24412, 29294, 24412, 19529],
        [28074, 33688, 28074, 22459]
    ];
    var cost_syukusya=[
        [35, 20, 35, 80],
        [53, 30, 53, 120],
        [89, 51, 89, 204],
        [147, 84, 147, 337],
        [228, 130, 228, 522],
        [336, 192, 336, 767],
        [476, 272, 476, 1089],
        [653, 373, 653, 1492],
        [868, 496, 868, 1984],
        [1129, 645, 1129, 2580],
        [2032, 1161, 2032, 4644],
        [3658, 2090, 3658, 4644],
        [6951, 3971, 6950, 15882],
        [13205, 7544, 13205, 30177],
        [25090, 14334, 25090, 57336]
    ];
    var cost_kojo=[
        [780, 1560, 1560, 3900],
        [1248, 2496, 2496, 6240],
        [1997, 3994, 3994, 9984],
        [4193, 6290, 6290, 11182],
        [5871, 8806, 8806, 15655],
        [10958, 13698, 13698, 16437],
        [15342, 19177, 19177, 23013],
        [19944, 24930, 24930, 29916],
        [25928, 32410, 32410, 38891],
        [33706, 42132, 42132, 50559]
    ];
    var cost_suisya=[
        [2940, 980, 980, 4900],
        [4704, 1568, 1568, 7840],
        [7526, 2509, 2509, 12544],
        [10537, 5268, 5268, 14049],
        [14751, 7376, 7376, 19668],
        [20652, 13768, 13768, 20652],
        [28913, 19275, 19275, 28913],
        [37587, 25058, 25058, 37587],
        [48863, 32576, 32576, 48863],
        [63523, 42348, 42348, 63523]
    ];
    var cost_ichiba=[
        [100, 100, 50, 50],
        [334, 334, 191, 191],
        [1035, 1035, 592, 592],
        [2795, 2795, 1600, 1600],
        [6328, 6328, 4218, 4218],
        [13288, 13288, 8859, 8859],
        [25248, 25248, 16832, 16832],
        [42921, 42921, 28614, 28614],
        [64381, 64381, 42921, 42921],
        [90134, 90134, 60089, 60089]
    ];
    var cost_kenkyu=[
        [275, 110, 110, 55],
        [413, 165, 165, 83],
        [619, 248, 248, 124],
        [1486, 836, 836, 557],
        [2228, 1253, 1253, 836],
        [7521, 6267, 6267, 5015],
        [13538, 11282, 11282, 9025],
        [21436, 17862, 17862, 14290],
        [44675, 37228, 37228, 29784],
        [87725, 73104, 73104, 58483]
    ];
    var cost_kunren=[
        [1500, 1600, 2500, 3300],
        [2100, 2240, 3500, 3300],
        [2940, 3136, 4900, 6468],
        [6629, 7326, 13955, 6978],
        [13257, 14653, 27910, 13955],
        [32097, 37679, 55821, 13955],
        [64194, 75358, 111642, 27910],
        [128388, 150716, 223283, 55821],
        [256776, 301432, 446566, 111642],
        [513551, 602865, 893133, 223283]
    ];
    var cost_kajiba=[
        [150, 200, 340, 170],
        [400, 300, 680, 340],
        [780, 585, 1326, 663],
        [1482, 1112, 2519, 1260],
        [2742, 2056, 4661, 2330],
        [4935, 3701, 8390, 4195],
        [8636, 6477, 14682, 7341],
        [17640, 14112, 28223, 10584],
        [31566, 25253, 50506, 18940],
        [50506, 40404, 80809, 30303]
    ];
    var cost_bougu=[
        [150, 200, 340, 170],
        [300, 400, 680, 340],
        [585, 780, 1326, 663],
        [1112, 1482, 2519, 1260],
        [2056, 2742, 4661, 2330],
        [3701, 4935, 8390, 4195],
        [6477, 8636, 14682, 7341],
        [14112, 17640, 28223, 10584],
        [25253, 31566, 50506, 18940],
        [40404, 50506, 80809, 30303]
    ];
    var cost_heiki=[
        [216, 216, 216, 72],
        [432, 432, 432, 144],
        [864, 864, 864, 288],
        [1224, 1224, 1224, 648],
        [1836, 1836, 1836, 972],
        [2662, 2662, 2662, 1409],
        [3860, 3860, 3860, 2044],
        [7357, 7357, 7357, 2452],
        [13242, 13242, 13242, 4414],
        [23836, 23836, 23836, 7945],
        [42905, 42905, 42905, 14302],
        [77229, 77229, 77229, 25743],
        [139013, 139013, 139013, 46338],
        [278026, 278026, 278026, 92675],
        [556051, 556051, 556051, 185350]
    ];
    var cost_doujaku=[
        [700, 3500, 2100, 700],
        [1120, 5600, 3360, 1120],
        [1792, 8960, 5376, 1792],
        [3763, 10035, 7526, 3763],
        [5263, 14049, 10537, 5268],
        [9834, 14752, 14752, 9834],
        [13768, 20652, 20652, 13768],
        [17899, 26848, 26848, 17899],
        [23268, 34902, 34902, 23268],
        [30249, 45373, 45373, 30249]
    ];
    var cost_renpei=[
        [112, 107, 107, 122],
        [224, 214, 214, 244],
        [448, 428, 428, 488],
        [759, 725, 725, 826],
        [1214, 1160, 1160, 1322],
        [2209, 2110, 2110, 2406],
        [3331, 3182, 3182, 3627],
        [4958, 4736, 4736, 5400],
        [8091, 7729, 7729, 8813],
        [11130, 10632, 10632, 12122]
    ];
    var cost_heisya=[
        [72, 360, 72, 216],
        [144, 720, 144, 432],
        [288, 1440, 288, 864],
        [648, 1728, 648, 1296],
        [972, 2592, 972, 1944],
        [1409, 3758, 1409, 2819],
        [2725, 4088, 2725, 4088],
        [6744, 9810, 5518, 2453],
        [12140, 17658, 9933, 4415],
        [21852, 31784, 17879, 7946],
        [39333, 57212, 32182, 14303],
        [70800, 96545, 64364, 25745],
        [127440, 173781, 115854, 46342],
        [254879, 324392, 254879, 92683],
        [509759, 648784, 509759, 185367]
    ];
    var cost_yumi=[
        [360, 72, 72, 216],
        [720, 144, 144, 432],
        [1440, 288, 288, 864],
        [1728, 648, 648, 1296],
        [2592, 972, 972, 1944],
        [3758, 1409, 1409, 2819],
        [5450, 2044, 2044, 4087],
        [9810, 6131, 6131, 2453],
        [17658, 12140, 9933, 4415],
        [31784, 21852, 17879, 7946],
        [57212, 39333, 32182, 14303],
        [96545, 70800, 64364, 25745],
        [173781, 127440, 115854, 46342],
        [324392, 254879, 254879, 92683],
        [648784, 509759, 509759, 185367]
    ];
    var cost_uma=[
        [72, 72, 360, 216],
        [144, 144, 720, 432],
        [288, 288, 1440, 864],
        [648, 648, 1728, 1296],
        [972, 972, 2592, 1944],
        [1409, 1409, 3758, 2891],
        [2044, 2044, 5450, 4087],
        [5518, 6744, 9810, 2453],
        [9933, 12140, 17658, 4415],
        [17879, 21852, 31784, 7946],
        [32182, 39333, 57212, 14303],
        [64364, 70800, 96545, 25745],
        [115854, 127440, 173781, 46342],
        [254879, 254879, 324392, 92683],
        [509759, 509759, 648784, 185367]
    ];

    var cost_shiro=[
        [0, 0, 0, 0],
        [1404, 546, 390, 780],
        [2570, 1000, 714, 1428],
        [4161, 2081, 2081, 2081],
        [7102, 3552, 3552, 3552],
        [9056, 9056, 6037, 6037],
        [14384, 14384, 9589, 9589],
        [22773, 22773, 15183, 15183],
        [33562, 33562, 22374, 22374],
        [44402, 57559, 32890, 29602],
        [65122, 84418, 48239, 43415],
        [95317, 123558, 70605, 63544],
        [113458, 154716, 154716, 92830],
        [150418, 150418, 315878, 135375],
        [219008, 219008, 492770, 164258],
        [294820, 294820, 663345, 221115],
        [488220, 488220, 827854, 318406],
        [839130, 839130, 915414, 457707],
        [1307581, 1307581, 1354280, 700491],
        [1901938, 1901938, 1969864, 1018896]
    ];
    var cost_toride=[
        [104, 400, 136, 160],
        [243, 936, 319, 374],
        [438, 1685, 573, 673],
        [1110, 2467, 1357, 1233],
        [1887, 4194, 2307, 2097],
        [3236, 7191, 3954, 3596],
        [5177, 11505, 6327, 5753],
        [10430, 18776, 13560, 9387],
        [18839, 33912, 24492, 16956],
        [33914, 61043, 44087, 30523],
        [66939, 106495, 85196, 45640],
        [119786, 190570, 152456, 81672],
        [213820, 340166, 272133, 145786],
        [423566, 505021, 456148, 244365],
        [708513, 844765, 763014, 408756]
    ];
    var cost_mura=[
        [400, 136, 104, 160],
        [936, 319, 243, 374],
        [1685, 573, 438, 673],
        [2467, 1357, 1110, 1233],
        [4194, 2307, 1887, 2097],
        [7191, 3954, 3236, 3596],
        [11505, 6327, 5177, 5753],
        [18776, 13560, 10430, 9387],
        [33912, 24492, 18839, 16956],
        [61043, 44087, 33914, 30523],
        [106495, 85196, 66939, 45640],
        [190570, 152456, 119786, 81672],
        [340166, 272133, 213820, 145786],
        [505021, 456148, 423566, 244365],
        [844765, 763014, 708513, 408756]
    ];

    var cost_mihari = [
        [600,840,600,360],
        [960,1344,960,576],
        [1536,2150,1536,922],
        [2458,3441,2458,1475],
        [3932,5505,3932,2359],
        [6291,8808,6291,3775],
        [9437,13212,9437,5662],
        [14156,19818,14156,8493],
        [21233,29727,21233,12740],
        [31850,44590,31850,19110],
        [44590,62426,44590,26754],
        [62426,87396,62426,37456],
        [87397,122355,87397,52438],
        [122355,171297,122355,73413],
        [159062,222686,159062,95437],
        [206780,289492,206780,124068],
        [268814,376340,268814,161288],
        [349458,489242,349458,209675],
        [419350,587090,419350,251610],
        [503220,704508,503220,301932]
    ];
    var cost_daisyukusya = [
        [200,114,200,438],
        [320,183,320,701],
        [512,293,512,1121],
        [768,439,768,1682],
        [1152,658,1152,2523],
        [1728,987,1728,3784],
        [2419,1382,2419,5298],
        [3387,1935,3387,7418],
        [4741,2709,4741,10385],
        [6637,3793,6637,14538],
        [8628,4930,8628,18900],
        [11217,6409,11217,24570],
        [14582,8332,14582,31941],
        [18956,11735,18956,40620],
        [25817,16429,25817,49286],
        [32271,22003,32271,60141],
        [42172,29337,42172,69675],
        [52715,38963,52715,84803],
        [66009,49506,66009,93512],
        [79211,62708,79211,108914]
    ];
    var cost_enseikunren = [
        [2884,4486,5977,2723],
        [4614,7177,9484,4357],
        [7382,11483,15174,6972],
        [11811,18373,24279,11155],
        [18898,29397,38846,17848],
        [28347,44096,58269,26772],
        [42521,66143,87404,40158],
        [63781,99215,131105,60238],
        [89294,138901,183548,84333],
        [125011,194461,256967,118066],
        [175015,272246,359754,165292],
        [227520,353920,467680,214880],
        [295776,460096,607984,279344],
        [384509,598125,790379,363147],
        [512678,692116,897187,461410],
        [645974,830539,1045863,553692],
        [812082,959734,1218123,701344],
        [1018794,1151680,1417453,841613],
        [1275708,1382016,1647789,1009935],
        [1594635,1658420,1913561,1211922]
    ];
    var cost_syuugyousyo = [
        [1600,1200,600,600],
        [2240,1680,840,840],
        [3136,2352,1176,1176],
        [4390,3293,1646,1646],
        [6146,4610,2305,2305],
        [8605,6454,3227,3227],
        [11186,8390,4195,4195],
        [14542,10907,5453,5453],
        [18905,14179,7089,7089],
        [24577,18433,9216,9216],
        [31950,23963,11981,11981],
        [38340,28755,14378,14378],
        [46008,34506,17253,17253],
        [55210,41407,20704,20704],
        [66252,49689,24844,24844],
        [72877,54658,27329,27329],
        [80164,60123,30062,30062],
        [88181,66136,33068,33068],
        [96999,72749,36375,36375],
        [106699,80024,40012,40012]
    ];


    var costs = [];
    costs["伐採所"] = cost_wood;
    costs["石切り場"] = cost_stone;
    costs["製鉄所"] = cost_iron;
    costs["畑"] = cost_rice;
    costs["倉庫"] = cost_souko;
    costs["宿舎"] = cost_syukusya;
    costs["工場"] = cost_kojo;
    costs["水車"] = cost_suisya;
    costs["市場"] = cost_ichiba;
    costs["研究所"] = cost_kenkyu;
    costs["訓練所"] = cost_kunren;
    costs["鍛冶場"] = cost_kajiba;
    costs["防具工場"] = cost_bougu;
    costs["兵器工房"] = cost_heiki;
    costs["銅雀台"] = cost_doujaku;
    costs["練兵所"] = cost_renpei;
    costs["兵舎"] = cost_heisya;
    costs["弓兵舎"] = cost_yumi;
    costs["厩舎"] = cost_uma;
    costs["城"] = cost_shiro;
    costs["砦"] = cost_toride;
    costs["村"] = cost_mura;

    costs["見張り台"] = cost_mihari;
    costs["大宿舎"] = cost_daisyukusya;
    costs["遠征訓練所"] = cost_enseikunren;
    costs["修行所"] = cost_syuugyousyo;

    var img_lv = new Array();

    img_lv[0] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWAMQAAKiTADs9BK+dAN7aALGjAMO2QernwPT038CzLOvmANfQgfn577OjDeLbnsjE'+
        'AOXkrrCtALurPsS7FvDtztXOau/qANXRAMf/If/6CLy4ACAgIL+sAGFyB7WdAP///////yH5BAEA'+
        'AB8ALAAAAAAXABYAAAW24PdxZGmepShyWOu+sMutcV3PXKXvSTL8v8Rux9FwLMikxSGhGAwUhxJZ'+
        '5GSu2Azk4el6FJBspropmwmIxUFS6DLMZTJ8Q5gcBPiGpzCXwxFfAhsCCh4IfUZzG20NAI4GBwSI'+
        'HIoMXRQRXAWScH5whV0LBYKTHaanHQARChQMAKinVbCnjo6zpkUjt7uxGhorKBy3Jb4qH77IvrDJ'+
        'xcbOIqgBAc/UxqfS1dkfptja1R3d3tXT2iEAOw==';
    img_lv[1] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWAMQAAEBCAP//IbKcAP7+6mZ5AMjEAPnnRKiTANXRAO3YALy4AP/6CP/zgb+sAO/q'+
        'ACAgIP/6Et7aAP7xV9C2AP///7WdANXRAPLVB6+sALqhAP/7JevmAK2YAP/mAd7aAP///yH5BAEA'+
        'AB8ALAAAAAAXABYAAAWh4PcRZGmepSgSQeu+sEusS23fOD4TTu/7keDm5yM8CJakMlnwaCCFpdJI'+
        'UFivCgxiQJFgsFdqY0xuCBKMrqBMFrPHgo763XC/OXIJh25n47t7b31lHAaAfEd0DRwSh4JHFZGS'+
        'kRwTFxkck5JUmpMHnwKdFUYjoqabDw8rKASiJakqH6mzqZq0sLG5IpMAALq/sZK9wMQfkcPFwBXI'+
        'ycC+xSEAOw==';
    img_lv[2] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPz4Lr+vALKcAGZ5AP/5wP//Ie/qAKeSAP/zlenkAP////7xa7y4AP/n'+
        'F//6CP7+6t7aACAgIL+sAPXTBf/zgf/8TdXRAP7zq7WdAKyaAP381v3rQ+XHAMjEAOvmAMKtAPrn'+
        'Bf36VuzXAP/n5//8c/7yl////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACcALAAAAAAXABYAAAbDwNOJ'+
        'QCwaj0WhkGBoOp9QJ2H5qFqvWOyUcOh6u5Fw+PPtEiSEi3p98ShKGIzFw1afCY28viFa+P0BGnsN'+
        'dxOGhwMVDCMaDgscA4eGhZKGAxqYCRsgkZKUlRkaAhUQjBmVn5IaIQUFIwgIp55olRMaDAsQFXEY'+
        'Gqi0lRoFubwmnYd3GcrLGhQdsNADy8rJ08qY0tbTZ0Pa3tZnEktIBN5FEuJK6Ovo1uzoSvHy0wAA'+
        '8vf3y/X4/ErK+/36ZQAYsJ+9gEEAADs=';
    img_lv[3] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPXZMcjEAKyaAP7+6mZ5AP//If32lu/qANfBAKeSALy4AP/5wP/8Tfnh'+
        'BP/6CLWdACAgIN7aAL+sAP/5rP3rQ/TXHP/////8Yf381uzXANXRALGjAL2rAPflWuvmAPzpLunk'+
        'AP7xa//WQvzkAv36Vv/0l//nF////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACgALAAAAAAXABYAAAbEQBSq'+
        'QCwaj0WhsGBoOp9QZ2H5qFqvWOy0gOh6u5Jw+PPtFiKFjXq9EYQaJgpGwFafC4u8nlO6+P0gHHp5'+
        'dxOGhxwmIhoDJxcVHIeGhZKGHBwJFRkUAwOVlJWdFH8MHZ9olRMcIA4dChp+DqcFlRwkFweuFRcE'+
        'ppJ3EMHCEAx/FxmMwxDAyhAKAR4eFgoKzczNnZ3NwWdD29/CZxFLSAXbRRHjSuns6crt6Ury88MA'+
        'APP4+ML2+f1Kwfz8+YMQUKC/ewKDAAA7';
    img_lv[4] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAP/8TbWdALqhAKiTAP381mZ5AP//If32gurlAO/qAL+vAP/6CLy4AP/5'+
        'wP///7+sAOHdANTBAP/7JSAgINXRAP74q7CtAP7xa/LVB7GjAP756sjEAP7xV6yaAOvmAMKtAP//'+
        '/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACEALAAAAAAXABYAAAa/wFDI'+
        'QCwaj0Wh0HBoOp9Qp2HJqFqvWOzUoOh6v4pI5ANWGCiGinq95nACEw5bfTY07vj7JVF4dC55d3UQ'+
        'hIUQGgkbGH4ahoSDjhogDg4ejI4QkIYeGBsSBH4eHgKGmoSIDxsOD6yXhaaHCw4WGAgPFh0Lja9o'+
        'Ar6/AqIeGX4EBMACdcjABAMZA8fIysu/xtHSFEPU279n2UNIBtRFFN9C5ejlyOnlSu7vwAAA7/T0'+
        'v/L1+Uq++Pr6Av386ZvnLwgAOw==';
    img_lv[5] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPXZMbWdAL+pAKeSAP/5wGZ5AP//If/zgb+vAPz3AP/6CP///+/qAPfl'+
        'WrKcAP/5rL+sAN7aACAgIPXTBdXRALy4AKyaAP/7OP/8YdXRAP381v/6EMjEAP/sLOvmANK/APnn'+
        'RP7xa/vuWcKtAP/mAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACYALAAAAAAXABYAAAbGQJPJ'+
        'QCwaj0Wh0HBoOp9Qp2G5qFqvWOzU0Oh6u5Kw+PNtGCaGinpd6Sg4HExG0WFXzgaLfm/RMP4MEBoX'+
        'fBZ4EYiJDx4MJRePFwKJiIeTEQ8iDB4IEAgkD5aVkxcQDAUjpRAXoWiWERcJHgSzf6uToomkGyAE'+
        'IYG2iXgCw8QCBYCmAw/FAsLMAgQBDg4Us8vFzs+QF9fMZ0PP4d4TE0tIBuFF5Eom5O7kzO/r7PRC'+
        'xQAA9frsxPj7/yaG+QO4T8BAgvvyAQwCADs=';
    img_lv[6] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPzlQsjEAKypAP7+6mZ5AP//If/6CP/9iNfTAKeSANfBALy4AP/5rP7x'+
        'a/nhBLWdAL+sAP///yAgIP/5wN7aAO/qAOXHANK/APflWv/zgbKcANXRAP381r+vAPTXHPz3AP37'+
        'luvmAP/mA66eAP/n572fAP/WQv///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACgALAAAAAAXABYAAAa/QBSq'+
        'QCwaj0WhsGBoOp9QZ2F5qFqvWOy0YOl6vZWw6OstTAqctDotACESgrXaXGDY7wyShxAa4PF0EYKD'+
        'ESQhBAskioSCgYwbIxIaDg0aCxuMjoSGEhIUHRINJJlnjIWeDwoenaOEmoMkBAQYCgESIa2DdBC8'+
        'vRC2nZ4eJL4Qu8UQChcZGR8KChvFx8jPz9HIZkPI29ITE0tIBdtF3koo3ujexenl5u5CvgAA7/Tm'+
        'vfL1+Si8+Pr1EP381ZunLwgAOw==';
    img_lv[7] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPvkLb2rALGjAP/+wGZ5AP//Ie/qAP/8daiTANC2AP///7y4AP7xV/LV'+
        'B+HdAP/5rP/6CL+sACAgINXRAP756vz3ALWdAK+sAP/6Ev3xlvrtRcjEAPrpbOvmAL2fAKyaAP/s'+
        'LP/mAf/dvda4AMKtAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACYALAAAAAAXABYAAAbAQJOp'+
        'QCwaj0WhsGBoOp9QZ2EZqVqvWOy0cOh6D4+HxxP2fLuFSYHCbnMsCA4nk+G02+kCY8/HQBYEC4IQ'+
        'GHx7eRKJigN/DSIhCw0DiomIlBKMCyAgEBUlk5SWlAMhGwkikSAXl6KjAwMaCwqgoWqXiiACgKq3'+
        'rZQgAQsdILcSeRfIycgJCg4CCcrJx9HJCdbUyGlD2NzSExNLSAXYRd9KJt/p39Hq5ufvQsoAAPD1'+
        '58nz9vomyPn79hf8/bNHb18QADs=';
    img_lv[8] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPXZMbWdANbSAKiTAP381mZ5AP32lv//IeznAL+vAPv4bf/////+wN7a'+
        'AP/6CLy4APflWtXRAL+sACAgIPnhBP/5rP3xgv/8Ta+dAP7+6u/qAPTXHLGjAP/7OsjEAL2fAOvm'+
        'AP/uV//dvcGuAP/n5//mAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACcALAAAAAAXABYAAAbNwNPJ'+
        'QCwaj0Wh0IBoOp9Qp2H5qFqvWOzUsOl6u46wOPTdGCgGiXot+XgOlgNm8GFLzgaIft+5MBYRDQwa'+
        'CR17EHgTiosZDAwJJg0FIhmLiomWExkLjgwWJBmVlpiWGQkaGo4WCh2ZpIodChoNChUFDBeii6+a'+
        'FX8EBJwHupdoAsfIGYINggUJGcjHeNHIBAERERwKBNQC090CwOLgZ0Pg58hnFEtIBuREFOtK8fTx'+
        '1PXxSvr70QAA+wABIvMXsKCSYwQNGhSQUKHBfwqDAAA7';
    img_lv[9] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPXZRbWdANXRAKiTAP7+6mZ5AP//If/5rNC2AL2oAP/6CP3xgv381vTX'+
        'HLy4AN7aAL+sAO/qAP///yAgINXRAK+sAPvuWezXALGjAP/8Tf3xlsjEAOvmAKyaAP/n597aAMGu'+
        'ANa4AP/8Yf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACQALAAAAAAXABYAAAbAQBLJ'+
        'QCwaj0Wh0HBoOp9Qp2G5qFqvWOzUIOl6u5CwuPOVGCiGinpd4YA0CMQIxGFXzoaHfm8ZNBoIBRMI'+
        'Fnt6eBGJihkIDR4eGBMTGYqJiJURGRMNIY+blJWXlYybgRMMoIqiiwoXCBuCA6mWaJiJjx4Opx62'+
        'eAK/wL8eCgUFCRnBv77JvwQJAQ4EzALL0wTX09QUQ9nd2ttDSAbTRRTgQubp5snq5krv8MEAAPD1'+
        '9cDz9vpKv/n7+wL8/dtH718QADs=';
    img_lv[10] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAP/7OsjEALCtAP7+6mZ5AO3YAP37lv//If/6CKiTAP77a7WdAN7aAP/5'+
        'wPLVB/flWr+sAO/qALGjANXRAP/6EiAgIP////z2rsKtANXRAP/8Tf/zgby4AL+vAP381vnnROvm'+
        'AK+dAP/mAfvjGd7aAPXZRdC2AP7xV//n572fANfBAP/7Jf///wAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAC0ALAAAAAAXABYAAAbhwFar'+
        'QCwaj0WhsIBoOp9QZ2GZqFqvWOy0IOlKGuCQOAQuh7wFS0HDFpRYFUG7tMFgAnJ2utDpDCgEFygD'+
        'fQMHF4gXC4QdexEREwYcghOQBgQfKyOIGY+OjxObKJUTDh8iqJMjnmqPkKKVBoIiESIoFwasBa6h'+
        'lBGbHArCGB+VEZ+1IL4eiCAPhyPGewzUtrOot4gEJCLUDNPUCicPHgrhDxAm5d7fauzC5t7w8d5p'+
        'Q+z4+fUWFktIBfqK8FPSgp9BfvgODiTIUAg7AAAaSiToDeLEiy2oWcQ4kcFGjhMjYgwCADs=';
    img_lv[11] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWAMQAAEBCAP/7JdXRALKcAP7+6mZ5AP//IdC2AKiTAO/qAP7xV7y4APLVB7qhAP/z'+
        'gf/6CCAgIPnnRL+sAP///97aANXRAO3YAK+sAP/6ErWdAMjEAOvmAK2YAP/mAd7aAP///yH5BAEA'+
        'AB8ALAAAAAAXABYAAAW54PcVZGmepSgWRuu+sFusT23fOD4XSd9TwI0vAaQIewVIQcAUaDwBjKb5'+
        'jE6ZycJie6kQJooL1wsWb7OS9MDiAA/UbHdagp4POnI1XvFO19McexxzgWCDfkpzEoUKh4uCc3+L'+
        'EYaElI2RiYQKlYCcmIgFGaMZHAcMDRykpqiqo1mkowizA7GzCLWvECOxvb6kSbsjKKK+JRDCIsjL'+
        'yL3MyCrR0rEAANLX16TV2Nwqo9vd3Rng4d3W4SEAOw==';
    img_lv[12] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPz4Lr+vAK+sAP/5wGZ5AP//Ie/qAP/zgenkAKeSAP///7WdAP/nF/7z'+
        'q97aAP7xV7y4AP7+6vLVB9XRAP/6CCAgIL+sAP7xa7KcAP3rQ//zldXRAPrnBf381sjEAOvmAOXH'+
        'AN7aAPnnRL2fAP/n5//8TdC2AKyaAO3YAP/mAf/8c//7Jf7yl//6EsKtAP///wAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADAALAAAAAAXABYAAAbfQBis'+
        'QCwaj0WhsGBoOp9QZ2FZqVqvWOy0cOgeHmCQGAQug7wFS4HC/ohYrk87sXI4THJ2uhCJDDgSCxAD'+
        'fhALh4cBhBF7FxcZKQiCGY8IGCkoDQsajheNjhkqk6AopRseL52fFygdgiiODCgCCBKYqmqdra+O'+
        'rQQEKQoKuAW6I7woGAsSCHYOxAzRKIYQKLIEy84tGdx70bInEwLWKBMhwujcGd7fpSjq6t/yaUPy'+
        '9vffaRZLSAX4RRb2KQlIMKC9ggGVKFwoDwCAhRAhfnMYsaKSaBQtWmSQUaPFhxqDAAA7';
    img_lv[13] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPzpLsjEAK+sAP7+6mZ5AO3YAP7xa///If/6CKeSAP/5rN7aALWdAP/6'+
        'EvflWr+sANXRAP/5wO/qACAgILGjAP32lv////LVB/3rQ/XZMdXRANC2AP381r2rALy4AP/zgfTX'+
        'HP7xV//8TenkAOvmAP/7Jf/mAdfBAP/WQqyaAP/8Yb2fAP/0l97aAP/nF////wAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADAALAAAAAAXABYAAAblQBis'+
        'QCwaj0WhsIBoOp9QZ2GZqFqvWOy0MOlOGOCSuAQul7wFSmHDFrhMDkGbNGotVnJ2uvD5DCIEFyID'+
        'fiIXh4cBhB97EBAVBiCCFY8tBwYqLxcZlBCNjhUnk6AVKBkdCyoqjp+PoiKdqguIEh6sao6ugqsV'+
        'ASceCgaHJ7cFuSoZuxCiFsDJBLaeag3UKoYiKtQSiBcdBtQNe+AqHBge2Q0KGg8PIQoK4OLjquAN'+
        'qvT1aUP1/P3xFBSWICngrwhAJTAAKgTIb+FBhBCF1AMAIKJFhOAoXtwIg5pGjhcbfAR5sSLHIAA7';
    img_lv[14] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPnnRL+vALCtAP381mZ5AP//Ie/qAP7xa9C2AKiTAP74q7WdAN7aAP/7'+
        'JfLVB////7y4ANXRAP/6CCAgIL+sAOrlAP/zgf7xV7GjAP/5wNXRAP7+6v/6EsjEAKyaAOvmAL2f'+
        'AN7aAP/8Tf/mAf/n58KtAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACcALAAAAAAXABYAAAbZwNOp'+
        'QCwaj0WhsGBoOp9QZ2E5qVqvWOy0cOgeGmCQ1xv2FigFidojcnQ86rVn5ICrz4VIZLDhQDADensW'+
        'BH+BengVFRkWF38ZiowcCI+KFYmRJJUZJhoaH5WKmIuaGB8VHwgcCQp/H6eXaJYZpacWEBwaELt/'+
        'orKKHwF/ChUCGgsIjgsYAr4FDNAfGK7Rrw/DCtB40AwKCQ8C2dwKAuDiDNvjCufq7GdD3PHy82cU'+
        'S0jP9EQU9kr8//zkAeSnpKDBeAAAGFy4kFtChhCVQHsYMSIDihUjKqwYBAA7';
    img_lv[15] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPXZMb+vAK+sAP/5wGZ5AP//If7xa+vmANC2AKeSAP/6Ev///7WdAPfl'+
        'Wv/5rL2fAP/6CPLVB7y4AP/7JSAgIL+sAN7aAO3YAP381tXRANXRAPnnRLKcAPfyAP/zgcjEAP7x'+
        'V//sLP7+6v/mAayaAP/8Yd7aAP/7OPz3AMKtAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACsALAAAAAAXABYAAAbowNWq'+
        'QCwaj0WhsGBoOp9QZ2EZqVqvWOy0gOgiLmDvF0z2FiqFjRp0oixA69RigTKl4JtzYTIZaEYMIQN9'+
        'GgyGDA8agxN6FhYdGB+BHY8iDCQlmSUNjo2OHSSTjwcMIh8PHyqUFp4WJaEhJa4PDAQhtA+yrGiO'+
        'rrCyJQIiCsSGuq0lHIHADxkJCsq5nWgN1SUhy9UEh7UCHd961Q0lCRICmw0KAQ4OEsTfHeHimvDf'+
        'xAod4g1nQ/r+/+LOVFiCpADAIhUGKknIMKG/hgmVSJyoDwCAiRgxirOYsaOSahw9emwQUqTHiyKD'+
        'AAA7';
    img_lv[16] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPzlQsjEAKypAP7+6mZ5AP//IdfBAP/zgf/6CKeSAP/5rLWdAO/qAP/m'+
        'A7+sAN7aAP////LVB/flWrKcACAgINXRAP/5wNC2AOXHALy4AP37lr+vANXRAPTXHP7xa/381uvm'+
        'APz3AP/7Ja6eAP7xV72fAP/mAf/n5//9jN7aAP/WQv/6Eu3YAP///wAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAC4ALAAAAAAXABYAAAblQJer'+
        'QCwaj0WhsGBoOp9QZ2GZqFqvWOy00Og2IOCQ9xseFyoFi1qgGrEEaotAlFLB4+eCRkPqECIlA3sk'+
        'HAQbgnt7eQ8PFC0IgBSMJBsEBySYjA+LkyeRjQ4RCB8LCAeSm2iaJJ4lJA+UEREXIBELr6kFq62v'+
        'JLMnChyyuJywAYC9BAQYCscbxGgM0iQlyNLHsrMcJNJ50gwKGBIcCtIKGRMTHgoKFO7e3+zt7hTy'+
        '7d8MZ0P4/P3fZxWWICngr0iFgEoOKjzIb+FBJRAj4gMAIKJFi98oXtyoRJpGjhwZfATJsSLIIAA7';
    img_lv[17] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPvkLb2rAK+sAP/+wP//IWZ5ANC2AP/zge/qAKiTALy4AP////7xV/LV'+
        'B97aALWdAP/7JdXRAP7+6v/5rP/6CCAgIL+sAPrpbO3YAP/6ErGjAPrtRdXRAMjEAOvmAKyaAN7a'+
        'AMKtAP3xlv/8df/mAb2fAP/sLNa4AP/dvf/n5/z3AP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACwALAAAAAAXABYAAAbeQBbL'+
        'QCwaj0Wh0FBoOp9Qp2FZqVqvWOzUkOgmHuCPOPwJew0Wg2TtCUU0HolnRfJ4NPC1BG1YLAYdEwwN'+
        'A38UDAQMihSFC3wXFxsZCIMbkYcNJSeVkI+QGyWcG4cgIBQTIpYXnpGhDZYbJxwKriCQq2m3oJyR'+
        'GxsjDB2quAa3IByDtpAgAojKnWkQ0iANydIQIAEMGCDXEHzXCgcOAgrh4+Xe4OEK5t7t7tdoQ971'+
        '9vIWFktIBvdF+UpY5BuYrx5BgAETCvEGAIDChwGvNYRIkYW0iRUhQsCYEaLDikEAADs=';
    img_lv[18] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPnnRMjEAK+sAP381mZ5AOznAP32lv//If/6CKiTAPTXHLWdAN7aAPv4'+
        'bf/////+wL+sAO/qAPLVByAgILGjANXRAP/zgf/5rPXZMfflWv7+6tC2AL+vALy4ANXRAP/mAevm'+
        'AP/7Ov/7Jf7xV//8Tf/6Er2fAP/n58GuAK+dAP/dvd7aAP///wAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAC0ALAAAAAAXABYAAAbowFar'+
        'QCwaj0WhsIBoOp9QZ2GZqFqvWOy0IOlKGuCQOAQuN8YFSsHCFrBGJkFbdMAcSiy5JV3weAYfGw8k'+
        'A38XDw4kEA8bBoV8EREVBockFZIPDwYgEASWkZCRFSCDlxUOmQ8YKSqREaGSpJ+TG4KqHZevaq6j'+
        'pREdGxAdIAQPF7mwKgG+EYgKCqgHrboFDNYqJIMq24sQiwQGFdZ81gwKHBMdCtYKGRoaC+rl5OXP'+
        '6/X29+MUQ+X+/wDT8BuCpFpAIhQGCknIMOG/hgmVSJzoDwCAiRgxlrOYsaMSaxw9emQQUqTHiyKD'+
        'AAA7';
    img_lv[19] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPnnRLqhAK+sAP381v//IWZ5AOvmAP/zgdXRAKiTAPTXHP///7WdAP/6'+
        'CO3YAP/5rPfyAN7aALy4AP/6EtXRAL+sACAgIP/8Tf7+6rGjANC2APLVB8jEAP7xV//7Jf3xlqya'+
        'AMGuAP/n597aAPXZRf/8Yda4AP/mAb2fAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACoALAAAAAAXABYAAAbeQJXK'+
        'QCwaj0Wh0FBoOp9Qp2HpqFqvWOzUcOgeJGDvF0z2Gi6GirpD+lA6axIGAjGR4JWzYTIZJDIMHgN9'+
        'CQQEEIAQgxN6FhYaDwiBGo8QBCEhDwwMlBaNjhook48MBCKYpZ2fj6IelBoQpYgMCKpojqyjGiIe'+
        'ECCACbYGDcQhAYEhxZgLtMnEesQNIR7I0SECGRkbGtHQxAobHAIK0eAlC+TdaNENCu7s7e/sZ0Pw'+
        '9vdnF0tIw/ZFF/qUABwIEB5BgEoSKmQHAIDChw+jNYRIUQmxiRUrNsCYsaLDjEEAADs=';
    img_lv[20] = 'data:image/gif;base64,'+
        'R0lGODlhFwAWANUAAEBCAPXZRcjEAKypAP381mZ5AOXHAP37lv//If/6CKShAP/nF/77a////97a'+
        'ALWdAP/5wNXRAPXTBfz2ru/qACAgIP/zgb+sAPz4LrGjAP7+6vflWt7aALy4AL2rAP/8Tf/mAevm'+
        'AMGuANfBAP3rQ6yaAOnkAKeSAOzXAP/n5/vuWc/LAP7yl//8c/v2C72fAP/WQv/7OsaqAP///wAA'+
        'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADMALAAAAAAXABYAAAb0wNms'+
        'QCwaj0WhsIBoOp9QZ2GZqFqvWOy0QOlSHGBwaBwWjwuVQmQtMLUmk49gJeB84DHBGl3odDIqDYKC'+
        'GAMDB4MNDAMdfBcXGRYMKCULDSQlKBoEIyCCIheOjxklpSwEIiUQBKUlFg0goWmPFw8lHhYaKCco'+
        'DSolFyWBKLIFtBkgEBC7J54WrROsxaMMDRoWcBMeggESiLHFD7YQ1tkswoMaCxkZD3ziJRIGJ/T0'+
        '7BIbAR4n4u5p/aX6CWxVQiCaIQITKuyHpsISJAUWFqngUAnFixQTYqSopKNHgQAAeBw5sl9IkiiV'+
        'iDuZMuUDli1TimwZBAA7';

    Pika_prepareForDisplayBuildStatus();//Lv0表示

    var xybld_a = new Array();
    var allbld = $a("//li/span[@class=\"buildStatus\" and contains(text(),\"建設\")]/a");
    for(var idx=0 ; idx<allbld.length ; idx++) {
        var tmp = allbld[idx].href.match(/x=([\-0-9]+).*y=([\-0-9]+)/);
        if( tmp != null ) {
            xybld_a.push(tmp);
        }
    }



    allbld = $a("//li[contains(text(), \"削除中\")]/span[@class=\"buildStatus\"]/a");
    var xybld_d = new Array();
    for(var idx=0 ; idx<allbld.length ; idx++) {
        var tmp = allbld[idx].href.match(/x=([\-0-9]+).*y=([\-0-9]+)/);
        if( tmp != null ) {
            xybld_d.push(tmp);
        }
    }
    
    
    var allarea = $a("//area");
    for(var idx=0 ; idx < allarea.length ; idx++) {
        var title = allarea[idx].getAttribute("title").match(/^(.*) LV\.([0-9]+)$/);
        if( !title ) {
            title = [allarea[idx].getAttribute("title"), allarea[idx].getAttribute("title"), 0];
        }
        if( costs[title[1]] ) {
            if(costs[title[1]][title[2]]) {
//        	        var xy = allarea[idx].getAttribute("href").match(/^.*(?:\?|&)x=([\-0-9]+)&y=([\-0-9]+)+(?:&[^=]+=[^&]+)*$/);
	                var xy = allarea[idx].getAttribute("href").match(/^.*(?:\?|&)x=([\-0-9]+)&y=([\-0-9]+)+(?:&[^=]+=[^&]+)*.*$/);
                var level = parseInt(title[2],10);
                var blding = 0;
                var dlting = 0;
                
                console.log(xy);
 //                console.log(title[1],title[2]);
               
               for ( var xxx=0 ; xxx < xybld_a.length ; xxx++){
                    if( xy[1] == xybld_a[xxx][1] && xy[2] == xybld_a[xxx][2] ) {
                        level ++ ;
                        blding += 2;
                    }
                }
                for ( var xxx=0 ; xxx < xybld_d.length ; xxx++){
                    if( xy[1] == xybld_d[xxx][1] && xy[2] == xybld_d[xxx][2] ) {
                        dlting ++;
                    }
                }
                try {
                    if( costs[title[1]].length <= level || // maxinum level reached
                        RES_NOW.wood < costs[title[1]][level][0] ||
                        RES_NOW.stone< costs[title[1]][level][1] ||
                        RES_NOW.iron < costs[title[1]][level][2] ||
                        RES_NOW.rice < costs[title[1]][level][3] ) {
                            //lvを黄色に
                            var thisimg = getLevelImageHTML(xy[1], xy[2], "mapicon");
                            if( thisimg  ) {
                                thisimg.src = img_lv[parseInt(title[2],10)];
                            }
                    }
                }catch(e) {
                    GM_log("catched");
                }
                if( (blding || dlting) && !OPT_PIKA_BLINKBLD ) {
                    //建築中
                    var thisimg = getLevelImageHTML(xy[1], xy[2], "mapicon");
                    if( thisimg  ) {
                        thisimg.style.outlineColor = (blding) ? "red" : "blue";
                        thisimg.style.outlineStyle = "dotted";
                        thisimg.style.outlineWidth = "2px";
                    }
                }
            }
        }
    }
    if( OPT_PIKA_BLINKBLD) Pika_displayBuildStatus();

    function getLevelImageHTML(x, y, cls) {
        var xdom = "";
        var no = (101 + parseInt(x,10) * 7 + parseInt(y,10)).toString().substr(-2);
        xdom = "//img[@class=\"" + cls + no + "\"]";

//      var maps = document.getElementById("maps");

        return $x(xdom, $("maps") );
    }
}


//////////////////////
//メモ処理
//////////////////////
function disp_memo()
{
    var icon_memo = 'data:image/gif;base64,'+
                    'R0lGODlhEQAPAKIAAP///+np6dXV1VpaWlhYWEVFRURERDMzMyH5BAQUAP8ALAAAAAARAA8AAAM7'+
                    'eLrcXGTIOYo7RITNAyEWMwRAaQIj0YynOaAr2aKwKLfvEM+0bvO53Sz4G9YWEMrEcCziLknlwHCp'+
                    'NhIAOw==';

    var cnt = parseInt(OPT_MEMO_COUNT, 10);
    if( isNaN(""+cnt) || cnt < 1 ) cnt = 1;
    if( cnt > 5 ) cnt = 5;
    for(var i=0 ; i<cnt ; i++){
        createMemoTab(i);
    }

    function createMemoTab(no)
    {
        if( !no ) no = "";

        var title = "メモ";
        if( no ) title += (no +1 );
        var elms = ccreateSideBox("beyond_sidebox_memo" + no, icon_memo, title);

        var ta = d.createElement("textarea");
        ta.id = "beyond_memobox" + no;
        ta.rows = OPT_MEMO_HEIGHT;
        ta.cols = OPT_MEMO_WIDTH;

        if (isNarrow) {
            ta.rows = OPT_MEMO_HEIGHT - 1;
            ta.cols = OPT_MEMO_WIDTH - 4;
        }

        ta.style.fontSize= OPT_MEMO_FONT_SIZE + "px";
        ta.value= cloadData( "memo" + no, "", true );

        elms.sideBoxInner.appendChild(ta);


        var sv = d.createElement("a");
        sv.href = "javascript:void(0);";
        sv.innerHTML = "保存";
        $e(sv, "click", function() {
            var memoBox = $("beyond_memobox" + no);
            if( memoBox ) {
                csaveData( "memo" + no, memoBox.value, true );
                alert("保存しました");
            }
        });
        var dv = d.createElement("div");
        dv.appendChild(sv);
        elms.sideBoxInner.appendChild(dv);
    }

}
//////////////////////
//拠点リンク機能
//////////////////////
function disp_baseLink()
{
    var elm = $x('id("lodgment")/div[@class="floatInner"] | //div[@class="sideBoxInner basename"] | //div[@class="floatInner clearfix"]');
    if( !elm ) return;

    var bases = $a("//li/child::*", elm);

    for( var idx=0 ; idx < bases.length ; idx++) {
        addBaseLink(bases[idx]);
    }

    function addBaseLink(elem) {

        var thistitle = elem.title;
        if( !thistitle ) return;

        var xy = thistitle.match(/^.*\(([\-0-9]+)\,([\-0-9]+)+\)$/);

        if( !xy ) return;

        var a_m, a_v, a_n;

        var a_m_img = d.createElement("img");
        a_m_img.style.paddingLeft = "3px";
        a_m_img.style.paddingTop = "3px";
        a_m_img.src = img_map;
        var a_v_img = d.createElement("img");
        a_v_img.style.paddingLeft = "3px";
        a_v_img.style.paddingTop = "3px";
        a_v_img.src = img_mura;
        var a_n_img = d.createElement("img");
        a_n_img.style.paddingLeft = "3px";
        a_n_img.style.paddingTop = "3px";
        a_n_img.src = img_naisei;

		a_m = d.createElement("a");
		a_m.href = caddSessionId("/map.php?x=" + xy[1] + "&y=" + xy[2]);
		a_m.title = "マップ(" + xy[1] + "," + xy[2] + ")" ;
		a_m.appendChild(a_m_img);

        a_v = d.createElement("a");
        a_v.title = "表示";
        a_v.appendChild(a_v_img);
        a_n = d.createElement("a");
        a_n.title = "内政";
        a_n.appendChild(a_n_img);

        if( elem.href ) {
            var id = elem.href.match(/^.*\?village_id=([0-9]+).*$/);
            if( id ) {
                a_v.href = caddSessionId("/village_change.php?village_id=" + id[1] + "&from=menu&page=/village.php#ptop");
                a_n.href = caddSessionId("/village_change.php?village_id=" + id[1] + "&from=menu&page=/card/domestic_setting.php#ptop");
            }
        } else {
            a_v.href = caddSessionId("/village.php#ptop");
            a_n.href = caddSessionId("/card/domestic_setting.php#ptop");
        }

        var spn = d.createElement("span");
		spn.style.noWrap = true;
        spn.appendChild(a_v);
        spn.appendChild(a_m);
        spn.appendChild(a_n);
        elem.parentNode.insertBefore(spn, elem.nextSibling);

    }
}

//////////////////////
//領地リンク機能
//////////////////////
function disp_mapLink()
{

    //暫定的にsplit("\n")で3なら領地リンク、4なら君主リンクに
    if( location.pathname == "/land.php" ) {

        var div = $("tMenu");
        if( div ) {
            var lnk = d.createElement("a");
            lnk.href = "javascript:void(0);";
            lnk.innerHTML = "領地リンクの追加";
            div.appendChild(lnk);
            $e(lnk, "click", function() {saveMapLink();});

        }
    }else if( location.pathname == "/user/" ) {

        var table = $x("//table[@class=\"commonTables\"]");
        if( table ) {
            var lnk = d.createElement("a");
            lnk.href = "javascript:void(0);";
            lnk.innerHTML = "君主リンクの追加";
            $e(lnk, "click", function() {saveMapLink();});
            table.parentNode.insertBefore(lnk, table.nextSibling);
        }
    }


    var icon_map = 'data:image/gif;base64,'+
                'R0lGODlhEQAPALMAANO3SayTQ3drPFxQsFNTUUA3uTMzMxoamBgYnxsNxg0G8ggC9AAA/wAAAAAA'+
                'AAAAACH5BAQUAP8ALAAAAAARAA8AAARL0MhJq50InVsT+wknIctnIhZZmmZYIWy8CAFATLGpADwQ'+
                'TCuGYljo9W4Gz2dnNP4MMNOgaQRKqT3BJJFACLC9C1bLqfWeIpqATIkAADs=';

    var elms = ccreateSideBox("beyond_sidebox_xylink", icon_map, "領地/君主ﾘﾝｸ");
    elms.sideBoxInner.id = "beyond_sidebox_xylink_inner";

    resetMapLinks();


}

function saveMapLink( )
{
    if( location.pathname == "/land.php" ) {
        var allDivs, thisDiv;
        var v_name = "";

        var basename = $x("//span[@class=\"basename\"]");

        var xy = location.search.match(/^\?x=([\-0-9]+)\&y=([\-0-9]+)+$/);

        if( basename ) {
            v_name = basename.innerHTML;
            if( v_name =="空き地" ) {
                v_name += xy[1] + "," + xy[2];
            }
        }

        v_name = prompt("名前を入力してください", v_name);
        if( !v_name ) return;

        var maplinks = cloadData( "links", 0, true );
        var value = v_name + "\n" + xy[1] + "\n" + xy[2];
        csaveData( "link" + maplinks  , value, true );
        maplinks++;
        csaveData( "links"  , maplinks, true );

        resetMapLinks();

    }else if( location.pathname == "/user/" ) {
        var user_id = URL_PARAM.user_id;
        var tmp = d.body.innerHTML.match(/<td>君主<\/td>[^<]*?<td>(.+)<\/td>/);
        if( !tmp ) return;
        var user_name = tmp[1];

        var comment = "";

        disp_name = prompt("名前を入力してください", user_name);
        if( !disp_name ) return;

        comment = prompt("コメントを入力してください", comment);

        var maplinks = cloadData( "links", 0, true );
        var value = user_id + "\n" + user_name + "\n" + disp_name + "\n" + comment;
        csaveData( "link" + maplinks  , value, true );
        maplinks++;
        csaveData( "links"  , maplinks, true );

        resetMapLinks();

    }
}

function configMapLinkClose()
{
    var elem = $("beyond_mapLinkWindow");
    if( !elem ) return;
    $("beyond_floatpanel").removeChild(elem);
}

function configMapLink(n, evt)
{
    var tmp = cloadData( "link" + n , "", true );
    if( !tmp ) return ;

    configMapLinkClose();

    data = tmp.split("\n");

    var lw = d.createElement("div");
    lw.id = "beyond_mapLinkWindow";
    lw.style.position = "absolute";
    if( data.length == 3 ) {
        lw.style.backgroundColor = "thistle";
        lw.style.border = "outset 2px thistle";
    }else if( data.length == 4 ) {
        lw.style.backgroundColor = "lightgreen";
        lw.style.border = "outset 2px lightgreen";
    }
    lw.style.fontSize = "10px";
    lw.style.padding = "10px";
    lw.style.zIndex = 1000;
    lw.style.left = evt.pageX - 76 + "px";//faraway 20110420(176->76)
    lw.style.top = evt.pageY - 111 + "px";

    if( data.length == 3 ) {
        ccreateTextBox(lw, "LINK_TITLE", data[0], "名称","名称",20, 0);
        ccreateTextBox(lw, "LINK_X", data[1], "X座標","X座標",10, 0);
        ccreateTextBox(lw, "LINK_Y", data[2], "Y座標","Y座標",10, 0);
    }else if( data.length == 4 ) {
        var dv = d.createElement("div");
        dv.innerHTML = "id=" + data[0] + "　　" + data[1] + "<br>";
        lw.appendChild(dv);
        ccreateTextBox(lw, "LINK_TITLE", data[2], "表示名","表示名",20, 0);
        ccreateTextBox(lw, "LINK_COMMENT", data[3], "コメント","コメント",20, 0);
    }
    //設定ボタン
    ccreateButton(lw, "保存", "内容を保存します", function() {
        var v = "";
        if( data.length == 3 ) {
            v = cgetTextBoxValue("LINK_TITLE") + "\n"
                + cgetTextBoxValue("LINK_X") + "\n"
                + cgetTextBoxValue("LINK_Y");
        }else if( data.length == 4 ) {
            v = data[0] + "\n" + data[1] + "\n"
                + cgetTextBoxValue("LINK_TITLE") + "\n"
                + cgetTextBoxValue("LINK_COMMENT");
        }
        csaveData( "link" + n  , v, true );
        configMapLinkClose();
        resetMapLinks();
    });

    //削除
    ccreateButton(lw, "削除", "削除", function() {
        if(!confirm("削除してよろしいですか？") ) return false;

        var maplinks = cloadData( "links", 0, true );
        for(var i = n+1 ; i < maplinks ; i++) {
            var tmp = cloadData( "link" + i, "", true );
            csaveData( "link" + (i-1), tmp, true );
        }
        csaveData( 'links'  , maplinks-1, true );
        configMapLinkClose();
        resetMapLinks();
    });

    //上に移動
    if( n != 0 ) {
        ccreateButton(lw, "▲", "上に移動", function() {
            var tmp = cloadData( "link" + (n-1), "", true );
            csaveData( "link" + (n-1), cloadData( "link" + n, "", true ), true );
            csaveData( "link" + n, tmp, true );
            configMapLinkClose();
            resetMapLinks();
        });
    }
    //下に移動
    var maplinks = cloadData( "links", 0, true );
    if( n + 1 < maplinks ) {
        ccreateButton(lw, "▼", "下に移動", function() {
            var tmp = cloadData( "link" + (n+1), "", true );
            csaveData( "link" + (n+1), cloadData( "link" + n, "", true ), true );
            csaveData( "link" + n, tmp, true );
            configMapLinkClose();
            resetMapLinks();
        });
    }

    //閉じる
    ccreateButton(lw, "閉じる", "閉じる", function() {configMapLinkClose();});

    $("beyond_floatpanel").appendChild(lw);
}

function resetMapLinks()
{
    var ul = $("beyond_sidebox_xylink_ul");
    if( ul ) {
        ul.parentNode.removeChild(ul);
    }
    ul = d.createElement("ul");
    ul.id = "beyond_sidebox_xylink_ul";

    var maplinks = cloadData( "links", 0, true );
    for(var i=0 ; i<maplinks ; i++) {
        var tmp = cloadData( "link" + i , "", true );
        if( tmp != "" ) {
            var li = d.createElement("li");

            var data = tmp.split("\n");

            if( data.length == 3 ) {
                //領地リンク
                var link1 = d.createElement("a");
                link1.href = caddSessionId("/land.php?x=" + data[1] + "&y=" + data[2] + "#ptop");
                link1.title = "表示(" + data[1] + "," + data[2] + ")";
                link1.innerHTML = data[0];
                link1.style.fontSize = OPT_MAPLINK_FONT_SIZE + "px";

                var link2 = d.createElement("a");
                link2.href = caddSessionId("/map.php?x=" + data[1] + "&y=" + data[2] + "#ptop");
                link2.title="マップ(" + data[1] + "," + data[2] + ")";

                var a_m_img = d.createElement("img");
                a_m_img.src = img_map;
                link2.appendChild(a_m_img);

                var m = "";
                var dist = cgetDistanceFromBase(data[1], data[2]);
                if( dist != -1 ) {
                    m ="　距離[" + dist.toFixed(2) + "]";
                }
                var link3 = d.createElement("a");
                link3.href = caddSessionId("/facility/castle_send_troop.php?x=" + data[1] + "&y=" + data[2] + "#ptop");
                link3.title = "兵を送る(" + data[1] + "," + data[2] + ")" + m;

                var a_s_img = d.createElement("img");
                a_s_img.src = img_ken;
                link3.appendChild(a_s_img);

                var link4 = d.createElement("a");
                link4.href="javascript:void(0)";
                link4.title="設定";

                var a_d_img = d.createElement("img");
                a_d_img.src = img_hanma;
                link4.appendChild(a_d_img);
                (function(n){
                    $e(link4, "click", function(event){configMapLink(n,event);});
                })(i);

                li.appendChild(link1);
                li.appendChild(link2);
                li.appendChild(link3);
                li.appendChild(link4);
                ul.appendChild(li);
            }else if( data.length == 4 ) {
                //君主リンク
                var img = d.createElement("img");
                img.src = img_user;
                li.appendChild(img);

                var link1 = d.createElement("a");
                link1.href = caddSessionId("/user/?user_id=" + data[0] + "#ptop");
                link1.title = data[3];
                link1.innerHTML = data[2];
                link1.style.fontSize = OPT_MAPLINK_FONT_SIZE + "px";

                var link2 = d.createElement("a");
                link2.href=caddSessionId("/message/new.php?user_id=" + data[0] + "#ptop");
                link2.title="[" + data[1] + "]宛に書簡を送る";

                var a_m_img = d.createElement("img");
                a_m_img.src = img_mail;
                link2.appendChild(a_m_img);

                var link3 = d.createElement("a");
                link3.href="javascript:void(0)";
                link3.title="設定";

                var a_d_img = d.createElement("img");
                a_d_img.src = img_hanma;
                link3.appendChild(a_d_img);
                (function(n){
                    $e(link3, "click", function(event){configMapLink(n,event);});
                })(i);

                li.appendChild(link1);
                li.appendChild(link2);
                li.appendChild(link3);
                ul.appendChild(li);
            }
        }
    }

    $("beyond_sidebox_xylink_inner").appendChild(ul);

}

//////////////////////
//領地リンクの読み込み・保存機能
//////////////////////
function mapLinkList(evt)
{
    if( $("beyond_SaveMapLinkWindow") ) return;

    var mc = d.createElement("div");
    mc.id = "beyond_SaveMapLinkWindow";
    mc.style.position = "absolute";
    mc.style.backgroundColor = "blueviolet";
    mc.style.border = "outset 2px blueviolet";
    mc.style.fontSize = "12px";
    mc.style.padding = "15px";
    mc.style.zIndex = 1000+1;
    mc.style.left = evt.pageX - 250 + "px";
    mc.style.top = evt.pageY - 220 + "px";
    var ta = d.createElement("textarea");
    ta.id = "beyond_SaveMapLinkWindow_text";
    ta.rows = 10;
    ta.cols = 40;
    var txt = "";
    var maplinks = cloadData( "links", 0, true );
    for(var i=0 ; i<maplinks ; i++) {
        var tmp = cloadData( "link" + i , "", true );
        if( tmp ) {
            txt += tmp.replace(/\n/g, "\t" ) + "\n";
        }
    }
    ta.value = txt;

    mc.appendChild(ta);
    $e(ta, "keydown", function(event) {
        //TAB入力
        var kC = event.keyCode ? event.keyCode : event.charCode ? event.charCode : event.which;
        if (kC == 9 && !event.shiftKey && !event.ctrlKey && !event.altKey)
        {
            var oS = this.scrollTop;
            var sS = this.selectionStart;
            var sE = this.selectionEnd;
            this.value = this.value.substring(0, sS) + "\t" + this.value.substr(sE);
            this.setSelectionRange(sS + 1, sS + 1);
            this.focus();
            this.scrollTop = oS;
            if (event.preventDefault)
            {
                event.preventDefault();
            }
            return false;
        }
        return true;
    } );

    var sv = d.createElement("a");
    sv.href = "javascript:void(0);";
    sv.innerHTML = "保存";
    $e(sv, "click", function() {
        if( confirm("上書き保存します。よろしいですか？") == false) return;
        var  ta = $("beyond_SaveMapLinkWindow_text");
        if( ta ) {
            var lines = ta.value.split("\n");
            var saveLines = new Array();
            for( var i=0 ; i<lines.length ; i++) {
                if( lines[i] == "" ) continue;
                var dat = lines[i].split("\t");
                if( dat.length != 3 && dat.length != 4 ) {
                    alert("解析エラーです。処理を中断します。\n( " + lines[i] + " )" );
                    return;
                }
                //チェック
                if( dat.length == 3 ) {
                    if( !dat[1].match(/[\-0-9]+/g)  || !dat[2].match(/[\-0-9]+/g) ) {
                        alert("解析エラーです。処理を中断します。\n( " + lines[i] + " )" );
                        return;
                    }
                }else if ( dat.length == 4 ) {
                    if( dat[3] == "" && dat[1].match(/[\-0-9]+/g) && dat[2].match(/[\-0-9]+/g) ) {
                        dat.pop();
                    }else  if( !dat[0].match(/[\-0-9]+/g) ) {
                        alert("解析エラーです。処理を中断します。\n( " + lines[i] + " )" );
                        return;
                    }
                }else{
                    alert("解析エラーです。処理を中断します。\n( " + lines[i] + " )" );
                    return;
                }
                var linedata = "";
                for( var j=0 ; j<dat.length ; j++ ){
                    dat[j] = dat[j].replace(/(^\s+)|(\s+$)/g, "");
                    if( linedata != "" ) {
                        linedata += "\n";
                    }
                    linedata += dat[j];
                }
                saveLines.push(linedata);
            }

            //削除
            var maplinks = cloadData( "links", 0, true );
            for(i=0 ; i<maplinks ; i++) {
                cdelData( "link" + i, true );
            }
            //追加
            for(var i=0 ; i<saveLines.length ; i++ ) {
                csaveData( "link" + i  , saveLines[i], true );
            }
            csaveData( "links"  , saveLines.length, true );


            alert("上書き保存しました");
            resetMapLinks();
        }
    });

    var cl = d.createElement("a");
    cl.href = "javascript:void(0);";
    cl.innerHTML = "閉じる";
    $e(cl, "click", function() {
        var mc = $("beyond_SaveMapLinkWindow");
        if( mc ) {
            mc.parentNode.removeChild(mc);
        }
    });
    var dv = d.createElement("div");
    dv.appendChild(sv);
    dv.appendChild(d.createTextNode(" ") );
    dv.appendChild(cl);


    mc.appendChild(dv);
    $("beyond_floatpanel").appendChild(mc);

}

//////////////////////
//座標リンク処理
//////////////////////
function disp_XYLink()
{
    var flg_profile_xy = false;
    var flg_include_a = false;

    //1行コメント
    var comment = $a("//*[@id=\"commentList\"]//tr/td[2]");

    for(var i=0 ; i< comment.length ; i++) {
        setXYLink( comment[i] );
    }

    //各エレメント
    var targetPath = new Array();

    if( location.pathname == "/alliance/chat_view.php" ) {
        targetPath.push( "//div[@class=\"hitokotoList\"]/p[2]" );
    }
    if( location.pathname == "/alliance/info.php" ) {
        targetPath.push( "//tr[th[contains(text(),\"コメント\")]]/td" );
    }
    if( location.pathname == "/message/detail.php" ) {
        targetPath.push( "//tr[th[contains(text(),\"件名\")]]/td" );
        targetPath.push( "//tr[th[contains(text(),\"本文\")]]/td" );
    }
    if( location.pathname == "/bbs/res_view.php" ||
        location.pathname == "/bbs/personal_res_view.php" ) {
        targetPath.push( "//th[@class=\"mainTtl\"]/div[@class=\"threadTtl\"]" );
        targetPath.push( "//td[@class=\"contents\"]" );
        targetPath.push( "//table[@class=\"commonTables\"]//tr[2]/td[1]" );
    }
//プロフィール画面
    if( location.pathname == "/user/" ) {
//        if( URL_PARAM.user_id && USER_ID != URL_PARAM.user_id ) {
            targetPath.push( "//table[@class=\"commonTables\"]//tr[position()>12]/td[2]" );
            flg_profile_xy = true;
//        }
    }
//

    for(var i=0 ; i< targetPath.length ; i++) {
        var elms = $a(targetPath[i]);
        for(var j=0 ; j<elms.length ; j++) {
            setXYLink(elms[j]);
        }
    }

    function setXYLink(elm) {
        var tmpHTML = elm.innerHTML;

        var reg = /[\(|（|【]([\-0-9０-９]+)( *[,&、・，] *)([\-0-9０-９]+)[\)|）|】]/g;
        if(OPT_XYLINK_NK || flg_profile_xy ) {
            reg = /([\-0-9０-９]+)( *[\,&、・，] *)([\-0-9０-９]+)/g;
        }

        var elm_child_a = null;
        if( flg_include_a ) {
            elm_child_a = $x("descendant::a", elm);
        }

        tmpHTML = tmpHTML.replace(reg, XYLinkReg );

        elm.innerHTML = tmpHTML;

        function XYLinkReg() {

            var img_send = IMG_DIR + "report/icon_go.gif";
            var img_mp = IMG_DIR + "report/icon_scout.gif";
            var m = "";
            var dist = cgetDistanceFromBase(arguments[2], arguments[4]);
            if( dist != -1 ) {
                m = "　距離[" + dist.toFixed(2) + "]";
            }
            var x = toHankaku(arguments[1]);
            var y = toHankaku(arguments[3]);
            var disp = x + arguments[2] + y;
            if( !OPT_XYLINK_NK && !flg_profile_xy) disp = "(" + disp + ")";
            var txt = '<a href="'+caddSessionId('/land.php?x=' + x + '&y=' + y + '#ptop')+'" title="表示" style="display:inline;">' + disp + '</a>';
            txt += '<a href="'+caddSessionId('/map.php?x=' + x + '&y=' + y + '#ptop')+'" title="マップ' + x + ',' + y + '" style="display:inline;"><img src="' + img_mp + '" style="width:14px; height:14px; vertical-align:middle;"></a>';
            txt += '<a href="'+caddSessionId('/facility/castle_send_troop.php?x=' + x + '&y=' + y + '#ptop')+'" title="兵を送る' + x + ',' + y + m + '" style="display:inline;"><img src="' + img_send + '" style="width:14px; height:14px; vertical-align:middle;"></a>';

            //Aの入れ子は連結し直してみる
            if( elm_child_a ) {
                txt = '</a>' + txt + '<a href="' + elm_child_a.href +  '">';
            //    GM_log(txt);
            }

            return txt;

            function toHankaku(str) {
                return str.replace(/[０-９]/g, function(str){return String.fromCharCode(str.charCodeAt(0)-65248);});
            }
        }
    }

}

//////////////////////
//兵力整形
//////////////////////
function disp_TTable()
{
    if( location.pathname == "/message/inbox.php" ||
        location.pathname == "/message/outbox.php"  ||
        location.pathname == "/message/new.php" ||
        location.pathname == "/bbs/topic_view.php"  ||
        location.pathname == "/facility/unit_status.php" ||
        location.pathname == "/facility/castle_send_troop.php") {
        return ;
    }

    //■仮対処
    var ta = $a("//textarea");
    for(var i=0 ; i<ta.length ; i++) {
        if( ta[i].innerHTML != "" ) return;
    }

    var targetPath = [
        "//div[@id='commentList']",
//      "//td[@class='contents']",
        "//table[@class='commonTables']",
        "//p[@class='hitokoto']",
//      "//span[@class='xy']"
    ];

    for(var i=0 ; i<targetPath.length ; i++) {
        var elms = $a(targetPath[i]);
        for(var j=0 ; j<elms.length ; j++) {
            setTTable(elms[j]);
        }
    }

    function setTTable(elm) {

        var tmpHTML = elm.innerHTML;
    //  tmpHTML = tmpHTML.replace(/[\n\r]/g,"");
        var reg = /剣兵\s+槍兵\s+弓兵\s+騎兵\s+矛槍兵\s+弩兵\s+近衛騎兵\s+斥候\s+斥候騎兵\s+衝車\s+投石機\s+武将.*(\n兵士\s+|\n)(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+).*(\n死傷\s+|\n)(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)/g;
        tmpHTML = tmpHTML.replace(reg,
            function() {
                var txt = "<table class='tables'><tr><th class='solClass'>　</th>" +
                            "<th class='solClass'>剣兵</th><th class='solClass'>槍兵</th><th class='solClass'>弓兵</th><th class='solClass'>騎兵</th>" +
                            "<th class='solClass'>矛槍兵</th><th class='solClass'>弩兵</th><th class='solClass'>近衛騎兵</th><th class='solClass'>斥候</th>" +
                            "<th class='solClass'>斥候騎兵</th><th class='solClass'>衝車</th><th class='solClass'>投石機</th><th class='solClass'>武将</th>" +
                            "</tr><tr><th class='solClass'>兵士</th>";
                for(var i = 2 ; i<= 13 ; i++) {
                    txt += "<td>" + arguments[i] + "</td>";
                }

                txt += "</tr><tr><th class='solClass'>死傷</th>";
                for(var i = 15 ; i<= 26 ; i++) {
                    txt += "<td>" + arguments[i] + "</td>";
                }
                txt += "</tr></table>";
                return txt;
            } );

        reg = /剣兵\s+槍兵\s+弓兵\s+騎兵\s+矛槍兵\s+弩兵\s+近衛騎兵\s+斥候\s+斥候騎兵\s+衝車\s+投石機\s+武将.*(\n兵士\s+|\n)(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(.+)/g;
        tmpHTML = tmpHTML.replace(reg ,
            function() {
                var txt = "<table class='tables'><tr><th class='solClass'>　</th>" +
                            "<th class='solClass'>剣兵</th><th class='solClass'>槍兵</th><th class='solClass'>弓兵</th><th class='solClass'>騎兵</th>" +
                            "<th class='solClass'>矛槍兵</th><th class='solClass'>弩兵</th><th class='solClass'>近衛騎兵</th><th class='solClass'>斥候</th>" +
                            "<th class='solClass'>斥候騎兵</th><th class='solClass'>衝車</th><th class='solClass'>投石機</th><th class='solClass'>武将</th>" +
                            "</tr><tr><th class='solClass'>兵士</th>";
                for(var i = 2 ; i<= 13 ; i++) {
                    txt += "<td>" + arguments[i] + "</td>";
                }
                txt += "</tr></table>";

                return txt;
            } );


        elm.innerHTML = tmpHTML;
    }
}

//////////////////////
//兵力合計
//////////////////////
function disp_Details()
{
    if( location.pathname != "/alliance/detail.php" &&
        location.pathname != "/report/detail.php") return ;

    var troops = [[0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0]] ;
    var tbls = $a("//table[@class=\"tables\"][@summary=\"防御者\"]");

//faraway110503    if(tbls.length <2 ) return;	//修正

    for(var i=0 ; i<tbls.length ; i++) {
        var trs = $a("descendant::tr", tbls[i]);
        if( trs.length >=4 ) {
            for(var j=0; j < 2 ; j++) {
                var tds = $a("descendant::td", trs[j+2]);
                if(tds.length != 12) continue;
                for(var k=0 ; k<tds.length ; k++) {
                    troops[j][k] += parseInt(tds[k].innerHTML,10);
                }
            }
        }
    }

    var tbl = d.createElement("table");
    tbl.className = "tables";

    var tr = d.createElement("tr");
    var th = d.createElement("th");
    th.className = "attacker";
    th.appendChild(d.createTextNode("防御合計"));
    tr.appendChild(th);
    th = d.createElement("th");
    th.className = "attackerBase";
    th.setAttribute("colspan","12");
    tr.appendChild(th);
    tbl.appendChild(tr);

    var tr = d.createElement("tr");
    var thtxt = ["剣兵","槍兵","弓兵","騎兵","矛槍兵","弩兵","近衛騎兵","斥候","斥候騎兵","衝車","投石機","武将" ];
    var th = d.createElement("th");
    th.className = "blank";
    tr.appendChild(th);
    for(var i=0; i<12 ; i++){
        th = d.createElement("th");
        th.className = "solClass";
        th.appendChild(d.createTextNode(thtxt[i]));
        tr.appendChild(th);
    }
    tbl.appendChild(tr);

    var hd =["兵士","死傷"];
    for(var i=0 ; i<2 ; i++) {
        var tr = d.createElement("tr");
        var th = d.createElement("th");
        th.className = "blank";
        th.appendChild(d.createTextNode(hd[i]));
        tr.appendChild(th);
        for(var j=0; j<12 ; j++){
            var td = d.createElement("td");
            td.appendChild(d.createTextNode(troops[i][j]));
            tr.appendChild(td);
        }
        tbl.appendChild(tr);
    }

    if( OPT_DETAILS_UP == 0 ) {
        tbls[tbls.length-1].parentNode.insertBefore(tbl, tbls[tbls.length-1].nextSibling);
    } else {
        tbls[0].parentNode.insertBefore(tbl, tbls[0]);
    }
}

//////////////////////
//デッキ
//////////////////////
function disp_Deck()
{
    if( location.pathname != "/card/deck.php" ) return ;


    if( OPT_DECK_SET ) dispDeckSet();

    function dispDeckSet() {
        var nam = cgetCurrentBaseName();

        var sels = $a("//select",d);
        for(var i=0 ; i<sels.length ; i++) {
            if( !sels[i].id.match(/selected_village_/) ) continue;
            var opts = $a("descendant::option",sels[i]);
            for(var j=0 ; j<opts.length ; j++) {
                if(opts[j].innerHTML == nam ) {
                    opts[j].selected = true;
                }
            }
        }
    }
}


//////////////////////	
//完了時刻の表示（建物）
//////////////////////
function disp_CompleteTimeBuild()
{
    var lastTime = cgetNow();
    var villageId = cgetCurrentVillageId();

    if( location.pathname == "/village.php" ) {
        //最終建築時間の保存
        var spans = $a('id("actionLog")//li//span[@class="buildStatus" and (contains(text(),"建設中") or contains(text(),"建設準備中"))]/../span[@class="buildClock"]');
        if (!spans || spans.length == 0) {
            cdelData("lastBuildTime"+villageId,true);
            return;
        }

        var saveDate = new Date(caddDate(lastTime, spans[spans.length - 1].innerHTML.replace(/^[\s|　]*|[\s|　]*$/,"")).replace(/-/g,"/"));
        saveDate.setMinutes(saveDate.getMinutes() + 1);
        csaveData( "lastBuildTime"+villageId, saveDate.toString(), true);
        return;
    }


    var reg = /\/facility\/facility.php|\/facility\/select_facility.php|\/facility\/castle.php/;
    if(!location.pathname.match(reg) || d.referrer.match(reg)) {
        return;
    }

    var spans = new Array();
    var tds = $a('id("gray02Wrapper")//th[contains(text(),"所要時間")]//..//td[@class="contents"]');
    for(var i=0 ; i<tds.length ; i++){
        var td = tds[i];
        var th = $x('.//th[contains(text(),"建設に必要な食糧消費量") or contains(text(),"建設に必要な資材")]', td.parentNode.parentNode);
        if (th) {
            var span = d.createElement("span");
            td.appendChild(span);
            spans.push(span);
        }
    }

    if (!spans.length) return;

    lastTime = new Date(cloadData( "lastBuildTime"+villageId, lastTime.toString(), true));

    timerfunc();

    function timerfunc() {
        var now = cgetNow();
        if (lastTime < now) {
            lastTime = now;
        }

        for(var i = 0 ; i<spans.length ; i++){
            var span = spans[i];
            var ctime = caddDate(lastTime, span.parentNode.firstChild.nodeValue);
            if( ctime ) {
                span.innerHTML = "　(" + ctime + "完了)";
            }
        }

        setTimeout(timerfunc,1000);
    }
}

//////////////////////
//完了時刻の表示（ユニット）
//////////////////////
function disp_CompleteTimeUnit()
{
    if( location.pathname == "/facility/facility.php" ) {

        //ユニット作成の最終時刻の保存
        var lastTd = $x('id("gray02Wrapper")/table[@class="commonTables"][2]//tr[last()]/td');
        if( !lastTd ) {
            cdelData("lastUnitTime",true);
            return;
        }
        csaveData( "lastUnitTime", new Date(lastTd.innerHTML.replace(/^[\s|\n|\r|\t]*|[\s|\n|\r|\t]*$/,"").replace(/-/g,"/")).toString(), true);
        return;
    }

    if( location.pathname != "/facility/unit_confirm.php" ) {
        return;
    }
    var td = $x('//table[@class="commonTables" and @summary="object"]//th[contains(text(),"作成するまでに必要な時間")]/../td');
    if (!td) {alert("ret");return;}
    var span = d.createElement("span");
    td.appendChild(span);

    var lastTime = new Date(cloadData( "lastUnitTime", null, true ));

    timerfunc();

    function timerfunc() {
        var now = cgetNow();
        if (lastTime < now) {
            lastTime = now;
        }
        var ctime = caddDate(lastTime, span.parentNode.firstChild.nodeValue.replace(/^\s+|\s+$/g, ""));
        if( ctime ) {
            span.innerHTML = "　(" + ctime + "完了)";
        }
        setTimeout( timerfunc, 1000);
    }
}

//////////////////////
//同盟表示の改善
//////////////////////
function disp_AllianceInfo()
{
    if( OPT_ALLY_XY )   allianceXY();
    if( OPT_ALLY_IS )   allianceSort();
    if( OPT_ALLY_CSV )  allianceCSV();


    //同盟表示のソート
    function allianceSort()
    {
        if( location.pathname != "/alliance/info.php" ) return;

        var sort_kind, sort_order;

        var sort_list = ["num", "str", "num", "num", "num", "str", "str"];

        for(var i=0 ; i<8 ; i++) {
            var th = $x("//table[@summary=\"ランキング\"]//tr[2]//th[" + (i+1) + "]");
            if( th ) {

                sort_kind = sort_list[i];
                if( th.id == "beyond_ally_xy" ) sort_kind = "xy";

                th.appendChild(d.createElement("br"));

                var a = d.createElement("a");
                a.href = "javascript:void(0)";
                (function(n, k){
                    $e(a, "click", function(){row_sort(n, k, "asc"); } );
                })(i+1, sort_kind);

                var img = d.createElement("img");
                img.src= IMG_DIR + "trade/icon_up.gif";
                img.alt = "昇順に並べ替え";
                img.title = img.alt;
                a.appendChild(img);

                th.appendChild(a);
                th.appendChild(d.createTextNode(" "));
                a = d.createElement("a");
                a.href = "javascript:void(0)";
                (function(n, k){
                    $e(a, "click", function(){row_sort(n, k, "dsc"); } );
                })(i+1, sort_kind);

                img = d.createElement("img");
                img.src= IMG_DIR + "trade/icon_down.gif";
                img.alt = "降順に並べ替え";
                img.title = img.alt;
                a.appendChild(img);

                th.appendChild(a);

            }
        }

        function row_sort(col, kind, order) {
            var tbl = $x("//table[@summary=\"ランキング\"]");
            var trs = $a("descendant::tr[position()>2]", tbl);
            sort_kind = kind;
            sort_order = order;

            var strs = new Array();
            if( col == 2 || kind == "xy" ) {
                //名前 or座標はaの下
                for(var i=0; i<trs.length ; i++) {
                    var td = $x("descendant::td[" + col + "]", trs[i]);
                    var a = $x("descendant::a", td);
                    if( a ) strs.push({"node":trs[i], "value":a.innerHTML});
                    else strs.push({"node":trs[i], "value":""});
                }
            } else {
                for(var i=0; i<trs.length ; i++) {
                    var td = $x("descendant::td[" + col + "]", trs[i]);
                    strs.push({"node":trs[i], "value":td.innerHTML});
                }
            }

            strs.sort(row_cmp);

            for(var i=0 ; i<trs.length ; i++) {
                strs[i].node.parentNode.removeChild(strs[i].node);
                tbl.appendChild(strs[i].node);
            }
        }

        function row_cmp(a, b)
        {
            var ret = 0;
            if( sort_kind == "num" ){
                ret = parseInt(a.value, 10) - parseInt(b.value, 10);
            }else if (sort_kind == "xy") {
                //座標
                if( !a.value && !b.value ) ret =  0;
                else if( !a.value ) ret = 1;
                else if( !b.value ) ret = -1;
                else {
                    var a_xy = a.value.split(",");
                    var b_xy = b.value.split(",");
                    ret = ( Math.pow(parseInt(a_xy[0], 10), 2) + Math.pow(parseInt(a_xy[1], 10), 2) ) -
                          ( Math.pow(parseInt(b_xy[0], 10), 2) + Math.pow(parseInt(b_xy[1], 10), 2) );
                }
            }else {
                if( a.value == b.value ) {
                    ret = 0;
                } else if( a.value > b.value ) {
                    ret = 1;
                }else {
                    ret = -1;
                }
            }
            if( sort_order == "dsc") {
                ret = 0 - ret;
            }
            return ret;

        }
    }

    //同盟員座標表示
    function allianceXY()
    {
        //座標の収集
        if( location.pathname =="/user/" ) {
            if( USER_ID || URLPARAM.user_id ) {
                var uid, aid;
                if( URL_PARAM.user_id ) uid = URL_PARAM.user_id;
                else uid = USER_ID;
                var allytd = $x("//table[@class=\"commonTables\"]//tr[3]//td[4]");
                if( !allytd ) return;
                var aids = allytd.innerHTML.match(/\/alliance\/info\.php\?id\=(\d+)/);
                if( !aids ) return;
                aid = aids[1];
                var table = $x("//table[@class=\"commonTables\"]");
                if( table ) {
                    var xy = getXYfromUserHTML(table.innerHTML);
                    if( xy ) {
                        csetUserXY(aid, uid, xy.x, xy.y);
                    }
                }
            }
        }


        //表示
        if( location.pathname == "/alliance/info.php" ) {
            if( ALLY_ID || URL_PARAM.id ) {
                var aid;
                if( URL_PARAM.id ) aid = URL_PARAM.id;
                else aid = ALLY_ID;

                var head1 = $x("//table[@summary=\"ランキング\"]//tr[1]//th[@class=\"ttl\"]");
                if( head1 ) {
                    head1.setAttribute("colspan", parseInt(head1.getAttribute("colspan"),10) + 1 + "");
                }
                var head2 = $x("//table[@summary=\"ランキング\"]//tr[2]");
                if( head2 ) {
                    var th = d.createElement("th");
                    th.className = "all";
                    th.style.width = "110px";
                    th.id = "beyond_ally_xy";
                    th.innerHTML = "座標";
                    var lnk = d.createElement("a");
                    lnk.href = "javascript:void(0)";
                    lnk.innerHTML ="(GET)";//faraway110518ここが同盟の場所
                    lnk.style.fontSize = "9px";

                    var running = false;

                    $e(lnk, "click", function() {

                        if( running ) return ;

                        if( confirm("同盟員の情報を一気に取得するためサーバに負荷をかけます。\n何度も実行するとDOS攻撃と同じなので、実行には注意して下さい") == false ) return;
                        running = true;
//                      cdeleteUserXY(aid);
                        var trs = $a("//table[@summary=\"ランキング\"]//tr[position()>2]");

                        var now_num = 0;
                        var all_num = trs.length;
                        window.setTimeout(timerFunc, 0);

                        function timerFunc()
                        {
                            var idtd = $x("descendant::td[2]",trs[now_num]);
                            if( !idtd ) {
                                alert("ページフォーマットが変わったみたい");
                                return ;
                            }
                            var ids = idtd.innerHTML.match(/\/user\/\?user_id\=(\d+)/);
                            if( !ids ) {
                                alert("ページフォーマットが変わったみたい");
                                return ;
                            }

                            var tmp = $("beyond_xylink_" + ids[1] );
                            if( tmp.innerHTML != "　" ) {
                                now_num ++;
                                if( now_num < all_num ) {
                                    window.setTimeout(timerFunc, 0);
                                }else{
                                    running = false;
                                    alert("全ての座標を取得しました");
                                }
                                return ;
                            }

                            cajaxRequest("/user/?user_id=" + ids[1], "GET", "", function(req) {
                                var xytd = $("beyond_xylink_" + ids[1] );
                                if(xytd) {
                                    var xy = getXYfromUserHTML(req.responseText);
                                    if( xy ) {
                                        csetUserXY(aid, ids[1], xy.x, xy.y);
                                        xytd.innerHTML = cgetXYHtml(xy.x, xy.y );
                                    }
                                }
                                now_num ++;
                                if( now_num < all_num ) {
                                    window.setTimeout(timerFunc, 0);
                                }else{
                                    running = false;
                                    alert("全ての座標を取得しました");
                                }
                            });
                        }
                    });

                    th.appendChild(lnk);
                    head2.appendChild(th);
                }

                var trs = $a("//table[@summary=\"ランキング\"]//tr[position()>2]");
                var xylists = cloadData( "allyXYList" + aid, "[]", true, true );

                //ハッシュに書き換え
                var xylist = new Array();
                for(var i=0 ; i<xylists.length ; i++) {
                    xylist["id" + xylists[i].id ] = {"x":xylists[i].x, "y":xylists[i].y};
                    if( xylist["id" + xylists[i].id].x == null )  xylist["id" + xylists[i].id].x = 0;
                    if( xylist["id" + xylists[i].id].y == null )  xylist["id" + xylists[i].id].y = 0;
                }

                for(var i=0; i<trs.length ; i++) {
                    var idtd = $x("descendant::td[2]",trs[i]);
                    if( !idtd ) continue;
                    var ids = idtd.innerHTML.match(/\/user\/\?user_id\=(\d+)/);
                    if( !ids ) continue;

                    var td = d.createElement("td");
                    td.id = "beyond_xylink_" + ids[1];
                    if( xylist["id" + ids[1] ] ) {
                        td.innerHTML = cgetXYHtml(xylist["id" + ids[1] ].x, xylist["id" + ids[1] ].y);
                    }else{
                        td.innerHTML ="　";
                    }
                    trs[i].appendChild(td);

                    var yaku = $x("descendant::td[7]",trs[i]);
                    if( yaku.innerHTML.match(/盟主補佐/) ) {
                        //盟主補佐がぎりぎり2行になるので後ろの空白カット
                        yaku.innerHTML = yaku.innerHTML.replace(/[ 　\t\r\n]+$/g, "");

                    }
                }
            }
        }
    }

    function getXYfromUserHTML(html)
    {
        var xy = html.match(/<\/a>\n\(本拠地\)\t+<\/td>[^<]*<td[^>]*>([\-0-9]+),([\-0-9]+)<\/td>/);

        if( xy ) {
            return {"x":parseInt(xy[1],10),"y":parseInt(xy[2],10)};
        }
        return null;
    }

    function getDatafromUserHTML(html)
    {
        var ret = [];
        var tmp = html.match(/<td[^>]*>ランク<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
        if( !tmp ) return null;
        ret["all_rank"] = parseInt(tmp[1] ,10);

        tmp = html.match(/<td[^>]*>総合<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
        if( !tmp ) return null;
        ret["all_point"] = parseInt(tmp[1] ,10);

        tmp = html.match(/<td[^>]*>総人口<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
        if( !tmp ) return null;
        ret["jinko"] = parseInt(tmp[1] ,10);

        tmp = html.match(/<td[^>]*>攻撃<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
        if( !tmp ) return null;
        ret["attack"] = parseInt(tmp[1] ,10);

        tmp = html.match(/<td[^>]*>防御<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
        if( !tmp ) return null;
        ret["defence"] = parseInt(tmp[1] ,10);

        tmp = html.match(/<td[^>]*>撃破スコア<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
        if( !tmp ) return null;
        ret["attack_score"] = parseInt(tmp[1] ,10);

        tmp = html.match(/<td[^>]*>防衛スコア<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
        if( !tmp ) return null;
        ret["defence_score"] = parseInt(tmp[1] ,10);

        tmp = html.match(/<\/a>\n\(本拠地\)\t+<\/td>[^<]*<td[^>]*>([\-0-9]+),([\-0-9]+)<\/td>/);
        if ( !tmp ) return null;
        ret["x"] = parseInt(tmp[1],10);
        ret["y"] = parseInt(tmp[2],10);

        return ret;
    }

    function getXYListfromUserHTML(html)
    {
        var ret = new Array();
        var tmp = html.match(/<td[^>]*>君主<\/td>[^<]*<td[^>]*>([^<\s]+)/);
        if( !tmp ) return null;
        var user_name = tmp[1];

        tmp = html.match(/<td[^>]*>同盟<\/td>[^<]*<td[^>]*><a href="[^"]*">([^<]+)<\/a><\/td>/);
        if( !tmp ) return;
        var ally_name = tmp[1];

        var pos;
        //var reg = /<a href=\"(?:\.\.\/land\.php|\.\.\/village_change\.php).*\">([\s\S]+?)<\/a>[\s\S]+?<td>([\-0-9]+),([\-0-9]+)<\/td>[\s\S]+?<td>([0-9]+|\&nbsp\;)<\/td>/;
        var reg = /<a href="\.\.\/(?:land|village_change)\.php[^"]*">\s*([^<\s]+)\s*<\/a>[^<]*<\/td>[^<]*<td[^>]*>([\-0-9]+),([\-0-9]+)<\/td>[^<]*<td[^>]*>([0-9]+|&nbsp;)<\/td>/;
        var honkyo = 1;
        while((pos = html.search(reg) ) != -1 ) {

            html = html.substr(pos);

            var dat = html.match(reg);
            if( !dat ) break;

            if( dat[4] == "&nbsp;" ) dat[4] = "";

            ret.push({"user_name":user_name, "ally_name":ally_name, "area_name":dat[1].replace(/(^\s+|\s+$)/g, ""), "x":dat[2], "y":dat[3], "jinko":dat[4], "honkyo":honkyo});
            honkyo="";
            html = html.substr(dat[0].length);

        }

        return ret;
    }

    function allianceCSV()
    {
        if( location.pathname != "/alliance/info.php" ) return;
/*
        if( URL_PARAM.id ) {
            if( ALLY_ID != URL_PARAM.id ) {
                return;
            }
        }
*/
        var aid;
        if( URL_PARAM.id ) aid = URL_PARAM.id;
        else aid = ALLY_ID;

        //CSV出力用
        var tbl = $x("//table[@summary=\"ランキング\"]");
        if( !tbl ) return;

        var lnk = d.createElement("a");
        lnk.href = "javascript:void(0)";
        lnk.innerHTML ="同盟員詳細情報csv";
        tbl.parentNode.insertBefore(lnk, tbl.nextSibling);
        $e(lnk, "click", function() {

            if( $("beyond_csvWindow") ) return;

            if( confirm("同盟員の情報を一気に取得するためサーバに負荷をかけます。\n何度も実行するとDOS攻撃と同じなので、実行には注意して下さい") == false ) return;

            //窓作成
            var elm_xy = cgetElementXY( this );
            var yy = elm_xy.y - 420;
            if( yy < 0 ) yy = 0;
            createCSVWindow(10, yy);

            var trs = $a("//table[@summary=\"ランキング\"]//tr[position()>2]");

            var elm_msg = $("beyond_csvWindow_message");
            if( !elm_msg ) return;
            var elm_csv = $("beyond_csvWindow_csv");
            if( !elm_csv ) return;

            var now_num = 0;
            var all_num = trs.length;

            if( all_num == 0 ) return;

            var csv_txt = "同盟内ランク\tuser_id\t名前\t同盟内point\t寄付\t拠点\t全体ランク\t全体point\t人口\t攻撃\t防御\t撃破スコア\t防御スコア\t本拠X座標\t本拠Y座標\n";

            window.setTimeout(timerFunc ,0 );

            function timerFunc()
            {
                if( !$("beyond_csvWindow") ) return;
                var tds = $a("descendant::td",trs[now_num]);
                if( tds.length < 5 ) {
                    alert("ページフォーマットが変わったみたい");
                    return ;
                }

                var ids = tds[1].innerHTML.match(/\/user\/\?user_id\=(\d+).*\">(.+)<\/a>/);
                if( !ids ) {
                    alert("ページフォーマットが変わったみたい");
                    return ;
                }

                var uid = parseInt(ids[1], 10);

                cajaxRequest("/user/?user_id=" + uid, "GET", "", function(req) {
                    var dt = getDatafromUserHTML(req.responseText);
                    if( dt ) {
                        csv_txt += parseInt(tds[0].innerHTML, 10) + "\t";
                        csv_txt += uid + "\t";
                        csv_txt += ids[2]  + "\t";
                        csv_txt += parseInt(tds[2].innerHTML, 10)  + "\t";
                        csv_txt += parseInt(tds[3].innerHTML, 10)  + "\t";
                        csv_txt += parseInt(tds[4].innerHTML, 10)  + "\t";
                        csv_txt += dt.all_rank  + "\t";
                        csv_txt += dt.all_point  + "\t";
                        csv_txt += dt.jinko  + "\t";
                        csv_txt += dt.attack  + "\t";
                        csv_txt += dt.defence  + "\t";
                        csv_txt += dt.attack_score  + "\t";
                        csv_txt += dt.defence_score  + "\t";
                        csv_txt += dt.x  + "\t";
                        csv_txt += dt.y  + "\n";

                        var xytd = $("beyond_xylink_" + uid );
                        if(xytd) {
                            csetUserXY(aid, uid, dt.x, dt.y);
                            xytd.innerHTML = cgetXYHtml(dt.x, dt.y );
                        }

                        now_num ++;
                        elm_msg.innerHTML = "取得中... ( " + now_num + " / " + all_num + " )";
                        if( now_num < all_num ) {
                            window.setTimeout(timerFunc, 0);
                        }else{
                            elm_msg.innerHTML += ".. 完了しました。CTRL + A → CTRL + Cでコピーし、Excelなどに貼りつけてください";
                            elm_csv.value = csv_txt;
                            elm_csv.focus();
                        }
                    } else {
                        alert("user_id="+uid+"の取得に失敗しました" );
                        now_num ++;
                        elm_msg.innerHTML = "取得中... ( " + now_num + " / " + all_num + " )";
                        if( now_num < all_num ) {
                            window.setTimeout(timerFunc, 0);
                        }else{
                            elm_msg.innerHTML += ".. 完了しました。CTRL + A → CTRL + Cでコピーし、Excelなどに貼りつけてください";
                            elm_csv.value = csv_txt;
                            elm_csv.focus();
                        }
                    }

                }, function(req){
                    alert("サーバからエラーが返りましたよ" );
                });
            }
        });


        var lnk2 = d.createElement("a");
        lnk2.href = "javascript:void(0)";
        lnk2.innerHTML ="同盟員全領地座標csv";
        tbl.parentNode.insertBefore(lnk2, lnk.nextSibling);
        tbl.parentNode.insertBefore(d.createTextNode("　　"), lnk2);
        $e(lnk2, "click", function() {

            if( $("beyond_csvWindow") ) return;

            if( confirm("同盟員の情報を一気に取得するためサーバに負荷をかけます。\n何度も実行するとDOS攻撃と同じなので、実行には注意して下さい") == false ) return;

            if( navigator.userAgent.toLowerCase().indexOf('chrome') == -1 ) {
                if( confirm("終盤の巨大同盟だと、CTRL+AやCTRL+Cの操作で10分くらい掛かります。\nChromeだとそんなに時間掛からないみたいです。続けますか？") == false ) return;
            }
            //窓作成
            var elm_xy = cgetElementXY( this );
            var yy = elm_xy.y - 420;
            if( yy < 0 ) yy = 0;
            createCSVWindow(10, yy);

            var trs = $a("//table[@summary=\"ランキング\"]//tr[position()>2]");

            var elm_msg = $("beyond_csvWindow_message");
            if( !elm_msg ) return;
            var elm_csv = $("beyond_csvWindow_csv");
            if( !elm_csv ) return;

            var now_num = 0;
            var all_num = trs.length;

            if( all_num == 0 ) return;

            var csv_txt = "同盟\t君主\t領地名\tX\tY\t人口\t本拠\n";

            window.setTimeout(timerFunc ,0 );

            function timerFunc()
            {
                if( !$("beyond_csvWindow") ) return;
                var tds = $a("descendant::td",trs[now_num]);
                if( tds.length < 5 ) {
                    alert("ページフォーマットが変わったみたい");
                    return ;
                }

                var ids = tds[1].innerHTML.match(/\/user\/\?user_id\=(\d+).*\">(.+)<\/a>/);
                if( !ids ) {
                    alert("ページフォーマットが変わったみたい");
                    return ;
                }

                var uid = parseInt(ids[1], 10);

                cajaxRequest("/user/?user_id=" + uid, "GET", "", function(req) {
                    var dt = getXYListfromUserHTML(req.responseText);
                    if( dt ) {
                        for(var i=0 ; i<dt.length ; i++) {
                            csv_txt += dt[i].ally_name  + "\t";
                            csv_txt += dt[i].user_name  + "\t";
                            csv_txt += dt[i].area_name  + "\t";
                            csv_txt += dt[i].x  + "\t";
                            csv_txt += dt[i].y  + "\t";
                            csv_txt += dt[i].jinko  + "\t";
                            csv_txt += dt[i].honkyo  + "\n";
                        }

                        now_num ++;
                        elm_msg.innerHTML = "取得中... ( " + now_num + " / " + all_num + " )";
                        if( now_num < all_num ) {
                            window.setTimeout(timerFunc, 0);
                        }else{
                            elm_msg.innerHTML += ".. 完了しました。CTRL + A → CTRL + Cでコピーし、Excelなどに貼りつけてください";
                            elm_csv.value = csv_txt;
                            elm_csv.focus();
                        }
                    } else {
                        alert("取得に失敗しました" );
                    }
                }, function(req){
                    alert("サーバからエラーが返りましたよ" );
                });
            }
        });

        function createCSVWindow(x, y)
        {
            var cc = $("beyond_csvWindow");
            if( cc ) cc.parentNode.removeChild(cc);
            cc = d.createElement("div");
            cc.id = "beyond_csvWindow";
            cc.style.left = x + "px";
            cc.style.top = y + "px";
            cc.style.position = "absolute";
            cc.style.backgroundColor = "lightgray";
            cc.style.border = "outset 2px lightgray";
            cc.style.fontSize = "12px";
            cc.style.padding = "15px";
            cc.style.zIndex = 1000;

            cc.style.padding = "10px";
            var dv = d.createElement("div");
            dv.id = "beyond_csvWindow_message";
            cc.appendChild(dv);
            var tx = d.createElement("textarea");
            tx.id = "beyond_csvWindow_csv";
            tx.rows = 25;
            tx.cols = 140;
            tx.style.overflow = "scroll";
            cc.appendChild(tx);

            cc.appendChild(d.createElement("br") );
            ccreateButton(cc, "閉じる", "", function(){
                var cc = $("beyond_csvWindow");
                if( cc ) cc.parentNode.removeChild(cc);
            });

            $("beyond_floatpanel").appendChild(cc);
        }

    }
}

//////////////////////
//資源の合計
//////////////////////
function disp_ResourcesTotal()
{
    var white_all = RES_GROW_W.wood + RES_GROW_W.stone + RES_GROW_W.iron + RES_GROW_W.rice;
    var blue_all = RES_GROW_B.wood + RES_GROW_B.stone + RES_GROW_B.iron + RES_GROW_B.rice;
    var all_all = RES_GROW.wood + RES_GROW.stone + RES_GROW.iron + RES_GROW.rice;
    var box = $x('id("sidebar")//span[@class="increase" or @class="resource"]/../.. | id("status_left")//p[@class="status_bottom"]');
    if( !box ) return;

    var txt = d.createTextNode("合計 " + white_all);

    var sp = d.createElement("span");
        sp.className = "increase";
        sp.appendChild(d.createTextNode(" +" + blue_all) );

    var item = txt;
    var addSpDoc = box;
    if (!isNarrow) {
        item = d.createElement("li");
        item.appendChild(txt);
        item.title = "総合計 " + all_all;
        addSpDoc = item;
    }

    box.appendChild(item);
    addSpDoc.appendChild(sp);
}

//////////////////////
//建設/破棄一覧
//////////////////////
function disp_RemoveList()
{
    var img_x = 'data:image/gif;base64,'+
                'R0lGODlhPAA8AIAAAP/MM////yH5BAUUAAEALAAAAAA8ADwAAAJ4jI+py+0Po5y02ouz3rz7D4bi'+
                'SJbmiabqyrbuC8fyTNf2jef6zvf+DQgGJwCV8PgQro7IRXPJLCqerGjCCmMaotIsVzv7KmtiHNd8'+
                'tpVp4nEsDX6lt+7W/EBNfRl1PZY/ZPTXEOjXR1iIcuiQ+OP4CBkpOUlZWVMAADs=';
    var img_m = 'data:image/gif;base64,'+
                'R0lGODlhPAA8AIAAAP/MM////yH5BAUUAAEALAAAAAA8ADwAAAKpjI+py+0Po5y02ouz3rz7D4bi'+
                'SJbmiabqyrbuC8fyTNf2jef6zvc5AAwKacJiMTZcJFnLRvP0dAZT0wOQcQ1UTVkrAPs1dElbcVjR'+
                'LYuuxmGbfV7D31q6+jM2582JvSdvhBZXRxYHR4gAOIh3luWIqFj4lWYYNnbHKJhoWckVqdToB/Kp'+
                'yQd1uVjHmSrnmNq24saqOlsSpVd7+nbbspvrAxwsPExcbBxQAAA7';
    var img_t = 'data:image/gif;base64,'+
                'R0lGODlhPAA8AIAAAP/MM////yH5BAUUAAEALAAAAAA8ADwAAAKnjI+py+0Po5y02ouz3rz7D4bi'+
                'SJbmiabqyrbuC8fyTNf2jef6zvc5AAwKacJiMTZcJFnLAxDRPA2fTkAiSgpWoVaFVto1JI1ccDhA'+
                'FR+rZ1Hamka3y9m3XBu/5j9x8j265/HW5EfnFhYIkcgxaOTYNydI9UjJVrL39bDYkfn3yBUJ0kh5'+
                'tikJh6qEaHraRYrKyof32qmCpRZbR0tU6eP7CxwsPEz8UAAAOw==';
    var img_lup = 'data:image/gif;base64,'+
                'R0lGODlhPAA8AIAAAP/MM////yH5BAUUAAEALAAAAAA8ADwAAAKfjI+py+0Po5y02ouz3rz7D4bi'+
                'SJbmiabqyrbuC8fyTNf2jef6zvc9APgBg7rhMGc03o7AwJH2bDqlsef0YH1Rr1iiaqsAJ8SfbNi7'+
                'MJfRafaZRK7EOVtw867kiups/DTq5mFlF+SHFyjoRXiVpDcCOFYo2YW4ZqAkyaRYuZZZ+Of3l5IH'+
                'QYpiyoA6qnbJ+pUEO7cS6+pje4ubq7vLi1AAADs=';

    if( location.pathname == "/land.php" && URL_PARAM.x && URL_PARAM.y ) {

        var rmtime = d.body.innerHTML.match(/(現在領地を破棄中です|現在村を建設中です|現在砦を建設中です)[^\d]*\n(\d+-\d+-\d+ \d+:\d+:\d+)/ );
        if( rmtime ) {
            if( rmtime[1] == "現在領地を破棄中です" ) {
                addList(rmtime[2], 0, URL_PARAM.x, URL_PARAM.y );
            }else if( rmtime[1] == "現在村を建設中です" ) {
                addList(rmtime[2], 3, URL_PARAM.x, URL_PARAM.y );
            }else if( rmtime[1] == "現在砦を建設中です" ) {
                addList(rmtime[2], 4, URL_PARAM.x, URL_PARAM.y );
            }
        }else{
            rmtime = d.body.innerHTML.match(/現在領地をレベルアップ中です[^\d]*\n(\d+-\d+-\d+ \d+:\d+:\d+)に完了します。/ );
            if( rmtime ) {
                addList(rmtime[1], 5, URL_PARAM.x, URL_PARAM.y );
            }else {
                delList(0, URL_PARAM.x, URL_PARAM.y);
            }
        }
    }

    if( location.pathname == "/facility/castle.php" ) {
        var xy = cgetCurrentBaseXY();
        var rmtime = d.body.innerHTML.match(/(村を削除中です。|砦を削除中です。)[^\d]*(\d+-\d+-\d+ \d+:\d+:\d+)に完了します。/);
        if( rmtime ) {
            if( rmtime[1] == "村を削除中です。" ) {
                addList(rmtime[2], 1, xy.x, xy.y );
            }else if( rmtime[1] == "砦を削除中です。" ) {
                addList(rmtime[2], 2, xy.x, xy.y );
            }
        }else{
            delList(1,xy.x, xy.y);
        }
    }


    if( location.pathname == "/map.php" ) {
        //地図に表示
        var type = 1;
//		if( $x("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort15 now\"]") ) type=2;
//		else if( $x("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort20 now\"]") ) type=3;
		//地図51×51対応
		if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort15 now\"]") ) type=2;
		else if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort20 now\"]") ) type=3;

        var lists = cloadData("RemoveList", "[]", true, true);
        lists = checkList(lists);       //時間を過ぎたものを削除

        if( lists.length ) {
            var cx = parseInt(URL_PARAM.x,10);
            var cy = parseInt(URL_PARAM.y,10);
            if( cx > MAP_X_MAX ) cx = MAP_X_MAX;
            if( cx < MAP_X_MIN ) cx = MAP_X_MIN;
            if( cy > MAP_Y_MAX ) cy = MAP_Y_MAX;
            if( cy < MAP_Y_MIN ) cy = MAP_Y_MIN;

            var map = $x("//div[@id=\"mapsAll\"]");
            for(var i=0 ; i<lists.length ; i++) {
                var no = cgetMapNofromXY(lists[i].x, lists[i].y, cx, cy, type );
                if( !no ) continue;
                var img_src;
                if( lists[i].kind == 3) img_src = img_m;
                else if(lists[i].kind == 4 ) img_src = img_t;
                else if(lists[i].kind == 5 ) img_src = img_lup;
                else img_src = img_x;

                var img = document.createElement("img");
                img.className = "mapAll" + no;
                img.src = img_src;

                map.appendChild(img);
            }
        }
    }


    //パネルに表示

    var icon_rl = 'data:image/gif;base64,'+
                'R0lGODlhEQAPALMAAAD/ANO3SQbOKKyTQxqvSjKgYAivNwCZAHdrPBVwFVNTUS1NLTMzMwAAAAAA'+
                'AAAAACH5BAQUAP8ALAAAAAARAA8AAARKkMlJq50npzuXAKDALYsBnoBhHWgrVmyLIkOgSIl8Bnww'+
                'TDpCr3djfHbD4Y9hOhWSQ8kC9YTyEFKBwICw9i5WLKfWW3IYNISYEgEAOw==';
    var elms = ccreateSideBox("beyond_sidebox_removelist", icon_rl, "建設/破棄ﾘｽﾄ");

    var lists = cloadData("RemoveList", "[]", true, true);
    lists = checkList(lists);       //時間を過ぎたものを削除

    if( lists.length == 0 ) return;

    var ul = d.createElement("ul");

    for(var i=0 ; i<lists.length ; i++) {
        var li = d.createElement("li");
        //アイコン
        var title = "";
        switch(lists[i].kind){
        case 0: title = "領地破棄"; break;
        case 1: title = "村破棄"; break;
        case 2: title = "砦破棄"; break;
        case 3: title = "村作成"; break;
        case 4: title = "砦作成"; break;
        case 5: title = "レベルアップ"; break;
        }
        var icon = "";
        if( lists[i].kind == 1 || lists[i].kind == 3 ) {        //村破棄or村作成
            icon = IMG_DIR + "panel/village_b_l.png";
        }else if( lists[i].kind == 2 || lists[i].kind == 4 ) {  //砦破棄or砦作成
            icon = IMG_DIR + "panel/fort_b_l.png";
        }else{
            icon = IMG_DIR + "panel/territory_b_s.png";
        }

        var addHtml = '<img src="' + icon + '" style="width:20px; height:20px;" title="' + title + '">';

        var sizestyle = "";
        if( lists[i].kind == 0 || lists[i].kind == 1 || lists[i].kind == 2 ) {      //領地破棄or村破棄or砦破棄
            addHtml += '<img src ="' + img_x + '" style="position:relative; left:-20px; width:20px; height:20px;" title="' + title + '">';
            sizestyle = ' style="position:relative; left:-20px;"';
        }
        if( lists[i].kind == 5 ) {                              //領地LvUp
            addHtml += '<img src ="' + img_lup + '" style="position:relative; left:-20px; width:20px; height:20px;" title="' + title + '">';
            sizestyle = ' style="position:relative; left:-20px;"';
        }


        addHtml += '<a href="'+caddSessionId('/land.php?x=' + lists[i].x + '&y=' + lists[i].y +'#ptop')+'" title="表示"'+ sizestyle + '>' + lists[i].time.substr(-8) + '</a>';
        addHtml += '<a href="'+caddSessionId('/map.php?x=' + lists[i].x + '&y=' + lists[i].y +'#ptop')+'" title="マップ(' + lists[i].x + ',' + lists[i].y + ')"' + sizestyle + '>';
        addHtml += '<img src="' +  img_map + '" style="padding-left:2px;"></a>';

        li.innerHTML = addHtml;

        ul.appendChild(li);
    }
    elms.sideBoxInner.appendChild(ul);

    function addList(tim, kind, x, y) //kind=0:領地破棄 1:村破棄 2:砦破棄 3:村作成 4:砦作成 5:領地LvUp
    {
        var lists = cloadData("RemoveList", "[]", true, true);

        for(var i=0 ; i<lists.length ; i++) {
            if(lists[i].x == x && lists[i].y == y ) {
                return;
            }
        }
        lists.push({"x":x, "y":y, "time":tim, "kind":kind } );
        lists.sort( function(a,b){

                if(a.time > b.time) return 1;
                if(a.time < b.time) return -1;
                return 0;});

        csaveData( "RemoveList", lists, true, true );
    }
    function delList(kind, x, y) //kind=0:land 1:castle
    {
        var lists = cloadData("RemoveList", "[]", true, true);

        for(var i=0 ; i<lists.length ; i++) {
            if(lists[i].x == x && lists[i].y == y ) {
                if( ( ( lists[i].kind == 1 || lists[i].kind == 2 ) && kind == 1 ) ||
                    ( ( lists[i].kind == 0 || lists[i].kind == 3 || lists[i].kind == 4 || lists[i].kind == 5 ) && kind == 0 ) ) {

                    lists.splice(i,1);
                    csaveData( "RemoveList", lists, true, true );
                    break;
                }
            }
        }
    }

    function checkList(lists)
    {
        var dt = new Date();
        var ntime = dt.getFullYear() + "-" +
                    (dt.getMonth()+101).toString().substr(-2) + "-" +
                    (dt.getDate()+100).toString().substr(-2) + " " +
                    (dt.getHours()+100).toString().substr(-2)  + ":" +
                    (dt.getMinutes()+100).toString().substr(-2)  + ":" +
                    (dt.getSeconds()+100).toString().substr(-2);
        var str1 = "";
        var str2 = "";
        var str3 = "";
        var str4 = "";
        for(var i=0 ; i<lists.length ; i++) {
            if( lists[i].time < ntime ) {
                if ( lists[i].kind == 1 || lists[i].kind == 2 ) {
                    str2 += "(" + lists[i].x + "," + lists[i].y + ")\n";
                }else if ( lists[i].kind == 3 || lists[i].kind == 4 ) {
                    str3 += "(" + lists[i].x + "," + lists[i].y + ")\n";
                }else if ( lists[i].kind == 5 ) {
                    //LevelUp完了
                    str4 += "(" + lists[i].x + "," + lists[i].y + ")\n";
                    csetMyLevel(lists[i].x, lists[i].y, -1);
                }else {
                    str1 += "(" + lists[i].x + "," + lists[i].y + ")\n";
                }
                lists.splice(i,1);
                i--;
            }
        }
        if( str1 || str2 || str3 || str4 ) {
            var msg = "";
            if( str1) msg += "以下の領地が破棄されました\n" + str1;
            if( str2) msg += "以下の拠点が破棄されました\n" + str2;
            if( str3) msg += "以下の拠点が作成されました\n" + str3;
            if( str4) msg += "以下の拠点がレベルアップしました\n" + str4;

            csaveData( "RemoveList", lists, true, true );
//            alert(msg);
        }
        return lists;
    }
}



function disp_ResourcesTime()
{

	//if( location.pathname == "/map.php") alert(location.pathname);//faraway110531
    var flag_cost = false;
    if( location.pathname == "/facility/facility.php" ||
        location.pathname == "/facility/select_facility.php" ||
        location.pathname == "/facility/castle.php" ||
        location.pathname == "/facility/unit_confirm.php") {
        flag_cost = true;
    }

    var names = ["wood", "stone", "iron", "rice"];
    var resources = {
        wood : {
            base : null,
            timer : null
        },
        stone : {
            base : null,
            timer : null
        },
        iron : {
            base : null,
            timer : null
        },
        rice : {
            base : null,
            timer : null
        },
        fame : {
            base : null,
            timer : null
        }
    };

    //status_leftとstatus_rightの幅を変更
    var stat_left = $("status_left");
    var stat_right = $("status_right");
    if( stat_left && stat_right ) {
        stat_left.style.width = "725px";    //670 + 55
        stat_right.style.width = "200px";   //255 - 55
    }

    for(var i = 0; i < names.length;i++) {
        var name = names[i];
        var base = $(name);
        var dv = d.createElement("div");
        dv.id = "beyond_restime_" + name;
        dv.style.top = (base.offsetTop + 12) + "px";
        dv.style.left = base.offsetLeft + "px";
        dv.style.position = "absolute";
        base.parentNode.appendChild( dv );

        resources[name].base = base;
        resources[name].timer = dv;
    }

    //名声
    var villageCount = 0;
    for (var key in VILLAGES_INFO) {
        villageCount++;
    }

    var bldtbl = [17, 35, 54, 80, 112, 150, 195, 248, 310, 999];

    var addTop = 12;
    if (OPT_NEXT_MEISEI) {
        addTop = -12;
    }

    for( var i=0 ; i < bldtbl.length ; i++ ){
        if( RES_MAX.fame < bldtbl[i] ) {
            var base = $x('id("status_left")/img[@title="名声"]');
            if( base ) {
                var dv = d.createElement("div");

				var elm_xy = cgetElementXY("base"); //改良

                dv.id = "beyond_restime_meisei";
                dv.style.top = (base.offsetTop + addTop) + "px";
//110620                dv.style.top = "-7px";//位置ずれるため固定faraway110601	//faraway110616
                dv.style.left = (base.offsetLeft + 10) + "px";
				if( location.pathname == "/map.php") dv.style.left = (base.offsetLeft - 64) + "px";	//faraway110620
				if( location.pathname == "/user/ranking.php"){										//faraway110620
					if(base.offsetLeft >= 552){														//faraway110620
						 dv.style.left = (base.offsetLeft - 64) + "px";								//faraway110620
					}																				//faraway110620
				}
//110620                dv.style.left = "502px";//位置ずれるため固定faraway110601	//faraway110616
                dv.style.position = "absolute";
                dv.style.color="lightgreen";
                if( bldtbl[i] != 999 ) {
                    dv.innerHTML = "次拠点:" +  bldtbl[i];
					if(OPT_NEXT_MEISEI){			//名声獲得タイマー機能使用時	faraway110620
	                	dv.style.top = "-7px";		//位置ずれるため固定			faraway110620
					}
					else{
	                	dv.style.top = "17px";		//位置ずれるため固定			faraway110620
					}
                }

				if( villageCount < i + 1 ) {
				dv.innerHTML += "(+" + (i + 1 - villageCount ) + ")";
				}

				base.parentNode.appendChild( dv );
				resources.fame.base = base;
				resources.fame.timer = dv;

				// ---- 拠点数取得 ---- まだ改良の余地あるかもです by 霧
//				var baseelms = $a("//div[@class='sideBoxInner basename']/ul/li | //div[@class='floatInner clearfix']/ul/li | //div[@class='floatInner']//li/*[@title]");
//				if( baseelms.length < i + 1 ) {
//					dv.innerHTML += "(+" + (i + 1 - baseelms.length ) + ")";
//				}
//				stat_left.appendChild( dv );
            }
            break;
        }
    }

    if( flag_cost ) {
        var facilityResources = new Array();
        var tds = $a('//td[@class="cost"]');
        for(var i=0 ; i<tds.length ; i++) {
            var td = tds[i];
            var spn = $a('./span[@class="normal" or @class="max90"]', td);
            if( spn.length != 4 ) continue;

            var addObj = new Object();

            for(var j=0 ; j < names.length ; j++ ) {
                var name = names[j];
                var base = spn[j];
                var dv = d.createElement("div");
                dv.id = "beyond_restime_" + i + "_" + name;
                var elem_xy = cgetElementXY(base);
                dv.style.top = (elem_xy.y + 9) + "px";
                dv.style.left = (elem_xy.x - 18 )+ "px";
                dv.style.fontSize = "9px";
                dv.style.position = "absolute";
                td.appendChild( dv );

                addObj[name] = {base : base , timer : dv};
            }
            facilityResources.push(addObj);
        }
    }

    function ResourcesTimer()
    {
		var posleft =new Array("28px","150px","272px","398px");//位置ずれるため固値を設定faraway110601 //faraway110616
        cupdateCurrentResources();
        //各資源
        for(var i=0 ; i<names.length ; i++) {
            var name = names[i];
            var base = resources[name].base;
            var dv = resources[name].timer;

            if( dv && base ){
                var tim;
                if( RES_GROW[ name ] == 0 ) {
                    tim = "XX:XX:XX";
                }else if( RES_GROW[ name ] > 0 ){
                    tim = getTime(RES_MAX[ name ] - RES_NOW[ name ], RES_GROW[ name ]);
                }else{
                    tim = "-" + getTime(RES_NOW[ name ], 0 - RES_GROW[ name ]);
                }
                if( tim == "00:00:00" || tim.substr(0,1) == "-" ) dv.style.color="red";
                else if( parseInt(tim.substr(0,2), 10) < 1 ) dv.style.color="orange";
                else dv.style.color="lightgreen";

                dv.innerHTML = "(" + tim + ")";
                dv.style.top = (base.offsetTop + 12) + "px";
//110620				dv.style.top = "17px";//位置ずれるため17に固定faraway110601 ->faraway110616
                dv.style.left = base.offsetLeft + "px";
//110620				dv.style.left = posleft[i];//位置ずれるため固定faraway110601 ->faraway110616
            }
        }

        //名声
        var base = resources.fame.base;
        var dv = resources.fame.timer;
        if( base && dv) {
            dv.style.top = (base.offsetTop + addTop) + "px";
            dv.style.left = (base.offsetLeft + 10) + "px";
        }

        if( flag_cost ) {
            for(var i=0 ; i < facilityResources.length ; i++) {
                var facilityObj = facilityResources[i];
                for(var j=0 ; j<names.length ; j++ ) {
                    var name = names[j];
                    var base = facilityObj[name].base;
                    var dv = facilityObj[name].timer;
                    var needed = parseInt(base.innerHTML,10);
                    if( needed > RES_MAX[ name ] ) {
                        dv.style.color="red";
                        dv.innerHTML = "倉庫不足";
                    }else if( needed > RES_NOW[ name ] ) {
                        var tim = getTime(needed - RES_NOW[ name ], RES_GROW[ name ]);
                        dv.style.color="orange";
                        dv.innerHTML = "(" + tim + ")";
                    }else{
                        dv.style.color="lightgreen";
                        dv.innerHTML = "残" + (RES_NOW[ name ] - needed);
                    }
                    var elem_xy = cgetElementXY(base);
                    dv.style.top = (elem_xy.y + 9) + "px";
                    dv.style.left = (elem_xy.x - 18 )+ "px";
                }
            }
        }


        window.setTimeout( ResourcesTimer, 1000);
    }

    ResourcesTimer();

    function getTime(res, grow )
    {
        var tmp = res * 3600 / grow;
        var h = Math.floor(tmp / 3600);
        var m = Math.floor((tmp - h*3600 ) / 60 );
        var s = Math.floor(tmp - h*3600 - m*60 );
        var tim = h + ":" +
                  (m+100).toString().substr(-2)  + ":" +
                  (s+100).toString().substr(-2);
        return tim;
    }

}

//////////////////////
//地形一覧
//////////////////////
function disp_MapList()
{
    if( location.pathname != "/map.php" ) return;


    var map_type = 1;
//	if( $x("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort15 now\"]") ) map_type=2;
//	else if( $x("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort20 now\"]") ) map_type=3;
	//地図51×51対応
	if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort15 now\"]") ) map_type=2;
	else if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort20 now\"]") ) map_type=3;

    var base = $("mapbox");

    var div =d.createElement("div");
    div.id = "beyond_maplist";
    div.align = "center";
    div.appendChild(d.createElement("br"));

    var tmp_t = d.createElement("table");
    var tmp_r = d.createElement("tr");
    var tmp_d1 = d.createElement("td");
    ccreateCheckBox(tmp_d1, "beyond_maplist_kyoten", "1", "拠点","拠点を含めます",0);
    var tmp_d2 = d.createElement("td");
    ccreateCheckBox(tmp_d2, "beyond_maplist_ryouchi", "1", "領地","領地を含めます",0);
    var tmp_d3 = d.createElement("td");
    ccreateCheckBox(tmp_d3, "beyond_maplist_akichi", "1", "空き地","空き地を含めます",0);
    var tmp_d4 = d.createElement("td");

    var a = d.createElement("a");
    a.href = "javascript:void(0)";
    a.style.color = "black";
    a.appendChild(d.createTextNode("<地形一覧表示>"));
    tmp_d4.appendChild(a);

    tmp_r.appendChild(tmp_d1);
    tmp_r.appendChild(tmp_d2);
    tmp_r.appendChild(tmp_d3);
    tmp_r.appendChild(tmp_d4);
    tmp_t.appendChild(tmp_r);

    div.appendChild(tmp_t);
    base.appendChild(div);

    var sheet = d.styleSheets[d.styleSheets.length-1];
    sheet.insertRule("table#beyond_maplist_table {border:2px solid black; border-collapse:collapse;}", sheet.cssRules.length);
    sheet.insertRule("table#beyond_maplist_table th {background:lightgray; padding: 5px; text-align:center; border:1px solid black;}", sheet.cssRules.length);
    sheet.insertRule("table#beyond_maplist_table td {padding: 2px; border:1px solid black;}", sheet.cssRules.length);

    $e(a, "click", function() {

        var flag_akichi = cgetCheckBoxValue("beyond_maplist_akichi");
        var flag_ryouchi = cgetCheckBoxValue("beyond_maplist_ryouchi");
        var flag_kyoten = cgetCheckBoxValue("beyond_maplist_kyoten");

        var area = $a("//map[@id=\"mapOverlayMap\"]//area");
        var lists = new Array();
        for(var i=0; i<area.length ; i++) {
            var dat = area[i].getAttribute("onmouseover");
            dat = dat.replace(/^.*rewrite/, "getTRData");
            dat = dat.replace(/\); .*$/, ");");
            var trdata;
            eval("trdata = " + dat);
            if( trdata ) {
                lists.push(trdata);
            }
        }

        lists.sort( function(a,b){
                if(a.ally == "" && b.ally != "") return 1;
                else if(a.ally != "" && b.ally == "") return -1;

                if(a.ally > b.ally) return 1;
                else if(a.ally < b.ally) return -1;
                else{
                    if( a.user_name > b.user_name) return 1;
                    else if(a.user_name < b.user_name) return -1;
                    else{
                        if( a.kyoten_kind > b.kyoten_kind ) return -1;
                        else if( a.kyoten_kind < b.kyoten_kind ) return 1;
                        else {
                            if( parseInt(a.jinko,10) > parseInt(b.jinko,10) ) return -1;
                            else if( parseInt(a.jinko,10) < parseInt(b.jinko,10) ) return 1;
                            else {
                                if( parseFloat(a.kyori) > parseFloat(b.kyori) ) return 1;
                                else if( parseFloat(a.kyori) < parseFloat(b.kyori) ) return -1;
                                else {
                                    if( a.name > b.name ) return 1;
                                    else if( a.name < b.name ) return -1;
                                    else return 0;
                                }
                            }
                        }
                    }
                }
                return 0;
            });

        var tbl = initTable();

        for(var i=0 ; i<lists.length ; i++) {
            var tr = d.createElement("tr");
            var td;
            td = d.createElement("td");
            td.innerHTML = lists[i].ally;
            tr.appendChild(td);
            td = d.createElement("td");
            td.innerHTML = lists[i].user_name;
            tr.appendChild(td);
            td = d.createElement("td");
            if( lists[i].kyoten_img ) td.innerHTML = "<img src=\"" + lists[i].kyoten_img +  "\" style=\"width:30px; height:30px;\" />";
            tr.appendChild(td);
            td = d.createElement("td");
            td.style.display = "none";
            td.innerHTML = lists[i].kyoten_kind;
            tr.appendChild(td);
            td = d.createElement("td");
            td.innerHTML = lists[i].jinko;
            tr.appendChild(td);
            td = d.createElement("td");
            td.innerHTML = lists[i].name;
            tr.appendChild(td);

            td = d.createElement("td");
            var xy = lists[i].xy.match(/\(([\-0-9]+),([\-0-9]+)\)/);
            if( xy ) td.innerHTML = cgetXYHtml(xy[1], xy[2]);
            else td.innerHTML = lists[i].xy;
            tr.appendChild(td);
            td = d.createElement("td");
            td.innerHTML = lists[i].kyori;
            tr.appendChild(td);
            td = d.createElement("td");
            if( lists[i].npc ) td.style.color = "red";
            td.innerHTML = lists[i].star;
            tr.appendChild(td);

            tbl.appendChild(tr);
        }

        if( OPT_TTDISTANCE) disp_ToolTipsDistance();//試し

        function getTRData(name, user_name, jinko, xy, ally, star, kyori, wood, stone, iron, rice, npc)
        {
            if( !flag_akichi && ally == "" ) return null;

            if( jinko == "-") jinko = "";
            var kyoten_img = "";
            var kyoten_kind = 0;
            if( jinko || npc) {
                var tmp = xy.match(/\(([\-0-9]+),([\-0-9]+)\)/);
                if( tmp ) {
                    var cx = parseInt(URL_PARAM.x,10);
                    var cy = parseInt(URL_PARAM.y,10);
                    if( cx > MAP_X_MAX ) cx = MAP_X_MAX;
                    if( cx < MAP_X_MIN ) cx = MAP_X_MIN;
                    if( cy > MAP_Y_MAX ) cy = MAP_Y_MAX;
                    if( cy < MAP_Y_MIN ) cy = MAP_Y_MIN;
                    var no = cgetMapNofromXY(parseInt(tmp[1], 10), parseInt(tmp[2], 10), cx, cy, map_type);
                    if( no ) {
                        var img = $x("//div[@id=\"mapsAll\"]//img[@class=\"mapAll" + no + "\"]");
                        if( img ) {
                            kyoten_img = img.getAttribute("src");
                            if( npc ) kyoten_kind = 4;
                            else if( kyoten_img.match(/village/) ) kyoten_kind = 1;
                            else if( kyoten_img.match(/fort/) ) kyoten_kind = 2;
                            else if( kyoten_img.match(/capital/) ) kyoten_kind = 3;

                        }
                    }
                }
            }

            if( !flag_ryouchi && ally != "" && kyoten_kind == 0 ) return null;
            if( !flag_kyoten && ally != "" && kyoten_kind != 0 ) return null;

            return {"kyoten_kind":kyoten_kind, "kyoten_img":kyoten_img,
                    "jinko":jinko , "ally":ally, "user_name":user_name,
                    "name":name, "xy":xy, "kyori":kyori, "star":star, "npc":npc};
        }

        var sort_kind, sort_order;

        function row_sort(col, kind, order) {
            var tbl = $("beyond_maplist_table");
            var trs = $a("descendant::tr[position()>1]",tbl);
            sort_kind = kind;
            sort_order = order;

            var strs = new Array();
            if( kind == "xy" ) {
                //座標はaの下
                for(var i=0; i<trs.length ; i++) {
                    var td = $x("descendant::td[" + col + "]", trs[i]);
                    var a = $x("descendant::a", td);
                    if( a ) strs.push({"node":trs[i], "value":a.innerHTML});
                    else strs.push({"node":trs[i], "value":""});
                }
            } else {
                for(var i=0; i<trs.length ; i++) {
                    var td = $x("descendant::td[" + col + "]", trs[i]);
                    if(td.style.color=="red") {
                        strs.push({"node":trs[i], "value":"★★★★★★★★★★" + td.innerHTML});//NPC砦だけ特別に
                    }else{
                        strs.push({"node":trs[i], "value":td.innerHTML});
                    }
                }
            }

            strs.sort( function(a,b) {
                var ret = 0;
                if( sort_kind == "num" ){
                    if( a.value == "" && b.value == "" ) return 0;
                    else if( a.value == "" ) return 1;
                    else if( b.value == "" ) return -1;
                    else ret = parseInt(a.value, 10) - parseInt(b.value, 10);
                }else if( sort_kind == "kyo" ){
                    if( parseInt(a.value, 10) == 0 && parseInt(b.value, 10) == 0) return 0;
                    else if( parseInt(a.value, 10) == 0 ) return 1;
                    else if( parseInt(b.value, 10) == 0 ) return -1;
                    else ret = parseInt(a.value, 10) - parseInt(b.value, 10);
                }else if( sort_kind == "float" ){
                    ret = parseFloat(a.value, 10) - parseFloat(b.value, 10);
                }else if (sort_kind == "xy") {
                    //座標
                    if( !a.value && !b.value ) ret =  0;
                    else if( !a.value ) ret = 1;
                    else if( !b.value ) ret = -1;
                    else {
                        var a_xy = a.value.split(",");
                        var b_xy = b.value.split(",");
                        ret = ( Math.pow(parseInt(a_xy[0], 10), 2) + Math.pow(parseInt(a_xy[1], 10), 2) ) -
                              ( Math.pow(parseInt(b_xy[0], 10), 2) + Math.pow(parseInt(b_xy[1], 10), 2) );
                    }
                }else {
                    if( a.value == b.value ) {
                        ret = 0;
                    }else if( a.value == "" ) {
                        return 1;
                    }else if( b.value == "" ) {
                        return -1;
                    }else if( a.value > b.value ) {
                        ret = 1;
                    }else {
                        ret = -1;
                    }
                }
                if( sort_order == "dsc") {
                    ret = 0 - ret;
                }
                return ret;
            });

            tbl = initTable();

            for(var i=0 ; i<trs.length ; i++) {
                tbl.appendChild(strs[i].node);
            }
        }

        function appendSortButton(col, sortcol, kind )
        {
            var tbl = $("beyond_maplist_table");
            var th = $x("descendant::tr[1]//th[" + col + "]", tbl);
            if( !th ) return;
            th.appendChild(d.createElement("br"));

            var a = d.createElement("a");
            a.href = "javascript:void(0);";
            var img = d.createElement("img");
            img.src= IMG_DIR + "trade/icon_up.gif";
            img.alt = "昇順に並べ替え";
            img.title = img.alt;
            a.appendChild(img);
            th.appendChild(a);

            (function(n, k){
                $e(a, "click", function(){row_sort(n, k, "asc"); } );
            })(sortcol, kind);


            th.appendChild(d.createTextNode(" "));

            a = d.createElement("a");
            a.href = "javascript:void(0)";
            img = d.createElement("img");
            img.src= IMG_DIR + "trade/icon_down.gif";
            img.alt = "降順に並べ替え";
            img.title = img.alt;

            a.appendChild(img);
            th.appendChild(a);

            (function(n, k){
                $e(a, "click", function(){row_sort(n, k, "dsc"); } );
            })(sortcol, kind);

        }

        function initTable()
        {
            var dv = $("beyond_maplist");

            var tbl = $("beyond_maplist_table");
            if( tbl ) {
                tbl.parentNode.removeChild(tbl);
            }else{
                var a = d.createElement("a");
                a.href = "#ptop";
                a.style.color="black";
                a.appendChild(d.createTextNode("▲トップに戻る"));
                a.id = "beyond_maplist_table_gotop";
                dv.appendChild(a);
            }

            tbl = d.createElement("table");
            tbl.id = "beyond_maplist_table";

            tbl.innerHTML = "<tr>" +
                    "<th>同盟</th><th>君主</th><th>拠点</th><th style=\"display:none;\">拠点Kind</th>" +
                    "<th>人口</th><th>領地名</th><th>座標</th><th>距離</th><th>戦力</th>" +
                    "</tr>";

            dv.insertBefore(tbl, $("beyond_maplist_table_gotop"));

            appendSortButton(1, 1, "str" );
            appendSortButton(2, 2, "str" );
            appendSortButton(3, 4, "kyo" );
            appendSortButton(5, 5, "num" );
            appendSortButton(7, 7, "xy" );
            appendSortButton(8, 8, "float" );
            appendSortButton(9, 9, "str" );

            return tbl;
        }
    });
}

//////////////////////
//距離/時間表示（ToolTips）
//////////////////////
function disp_ToolTipsDistance()
{
    if( location.pathname == "/village.php" ) {
        saveTrainingLevel();
    }

    var links = $a('//a[contains(@href,"castle_send_troop.php") and not(contains(@href,"TB_inline"))]');
    if (!links.length) {
        return;
    }


    var TL = 0;
    var ETL = 0;
    var vid = cgetCurrentVillageId();
    var lists = cloadData("TrainingLevels", "[]", true, true);

    for (var i = 0;i < lists.length;i++) {
        if (lists[i].id == vid) {
            TL = parseInt(lists[i].level,10);
            ETL = parseInt(lists[i].elevel,10);
            break;
        }
    }

    if (isNaN(""+TL)) {
        TL = 0;
    }
    if (isNaN(""+ETL)) {
        ETL = 0;
    }


    var reg = /x=(-?\d+)&y=(-?\d+)/;
    for(var i=0 ; i<links.length ; i++) {
        if(!reg.test(links[i].href)) continue;

        links[i].alt = "";
        links[i].title = "";
        $e(links[i], "mouseover", function (event) {
            var xy = this.href.match(reg);
            var distance = cgetDistanceFromBase(xy[1], xy[2] );
            showToolTips(event, distance, TL, ETL);
        });

        $e(links[i], "mouseout", function () { hideToolTips(); } );

    }

    function showToolTips( evt, distance, trainingLevel , eTrainingLevel)
    {
        hideToolTips();
        var sp = 0.05 * trainingLevel + 1+ (eTrainingLevel*0.001*distance);

        var tw = d.createElement("div");
        tw.id = "beyond_ToolTipsWindow";
        tw.style.position = "absolute";
        tw.style.backgroundColor = "lightyellow";
        tw.style.border = "outset 2px lightyellow";
        tw.style.fontSize = "10px";
        tw.style.padding = "10px";
        tw.style.zIndex = 1000001;
        var xxx = evt.pageX + 5;
        if( xxx > 700 ) xxx -=175;
        tw.style.left = xxx + "px";
        tw.style.top = (evt.pageY +5) + "px";

        var dv = d.createElement("div");
        dv.innerHTML = "時間の目安　　遠征訓練所Lv."+eTrainingLevel+" (+"+(eTrainingLevel*0.1*distance).toFixed(3)+"%)<br>距離 [" + distance.toFixed(2) + "]　訓練所Lv." + trainingLevel + " (+" + (TL*5) + "%)" ;
        tw.appendChild(dv);

        var tbl = d.createElement("table");
        tbl.style.border = "2px solid black";
        tbl.style.borderCollapse = "collapse";
        tbl.style.width = "100%";

        var now = cgetNow();

        for(var i=0 ; i<OPT_TTDISTANCE_ITEMS.length ; i++){

            var tmp = OPT_TTDISTANCE_ITEMS[i].match(/.*\((-?[0-9]+([\.]{1}[0-9]+)?)\)/);
            if( !tmp ) continue;
            var speed = parseFloat(tmp[1]);
            if( speed < 0 ) continue;

            var tr = d.createElement("tr");
            var td = d.createElement("td");
            td.style.border = "1px solid black";
            td.style.textAlign = "left";
            td.appendChild(d.createTextNode( OPT_TTDISTANCE_ITEMS[i] ));
            tr.appendChild(td);

            var timeText = getTime(speed * sp, distance);

            td = d.createElement("td");
            td.style.border = "1px solid black";
            td.style.textAlign = "right";
            td.appendChild(d.createTextNode(timeText));
            tr.appendChild(td);

            var dayText = caddDate(now, timeText);
            dayText = dayText.substring(5, dayText.length - 3).replace("-", "/");


            td = d.createElement("td");
            td.style.border = "1px solid black";
            td.style.textAlign = "right";
            td.appendChild(d.createTextNode(dayText));
            tr.appendChild(td);

            tbl.appendChild(tr);
        }

        tw.appendChild(tbl);
        $("beyond_floatpanel").appendChild(tw);



        function getTime(speed, dist)
        {
            var tmp = dist * 3600 / speed;
            var h = Math.floor(tmp / 3600);
            var m = Math.floor((tmp - h*3600 ) / 60 );
            var s = Math.floor(tmp - h*3600 - m*60 );
            var tim = h + ":" +
                      (m+100).toString().substr(-2)  + ":" +
                      (s+100).toString().substr(-2);
            return tim;
        }

    }
    function hideToolTips()
    {
        var tw = $("beyond_ToolTipsWindow");
        if( tw ){
            tw.parentNode.removeChild(tw);
        }
    }


    function saveTrainingLevel()
    {
        var vil_id = cgetCurrentVillageId();
        if( !vil_id ) return;
        var basename = cgetCurrentBaseName();
        if( !basename ) return;

        var level = 0;
        var elevel = 0;
        var map = $a('//area[contains(@alt, "訓練所")]');;
        if(0 < map.length) {
            for (var i = 0;i < map.length;i++) {
                var lv = map[i].alt.match(/((?:遠征)?訓練所) LV.([0-9]+)/);
                if(lv[1] == "訓練所") {
                    level = parseInt(lv[2],10);
                }
                else if (lv[1] == "遠征訓練所") {
                    elevel = parseInt(lv[2],10);
                }
            }
        }


        var lists = cloadData("TrainingLevels", "[]", true, true);
        var newLists = new Array();
        var isNewItem = true;
        for (var i = 0;i < lists.length;i++) {
            if (chasVillageId(lists[i].id)) {
                var data = lists[i];
                if (data.id == vil_id) {
                    data.basename = basename;
                    data.level = level;
                    data.elevel = elevel;
                    isNewItem = false;
                }
                newLists.push({id:data.id,basename:data.basename,level:data.level,elevel:data.elevel});
            }
            if (newLists.length == 10) {
                break;
            }
        }

        if (isNewItem) {
            newLists.push({id:vil_id,basename:basename,level:level,elevel:elevel});
        }

        csaveData( "TrainingLevels", newLists, true, true );
    }


}

//////////////////////
//同盟/君主表示（ToolTips）
//////////////////////
function disp_ToolTipsAllyPerson()
{
    var links = $a('//a[(contains(@href,"village_change.php") or contains(@href,"land.php")) and not(contains(@href,"TB_inline") or contains(@href,"from"))]');
    if (links.length == 0) return;

    var selfVillages =cgetVillageIds();

    for(var i=0 ; i<links.length ; i++) {
        if(links[i].href.match(/village_change\.php/)) {
            var tmp = links[i].href.match(/village_id=([0-9]+)/);
            if( tmp && selfVillages[tmp[1]]) {
                continue;
            }
        }

        links[i].alt = "";
        links[i].title = "";

        $e(links[i], "mouseover", function(event){ showToolTips(event, this.href); } );
        $e(links[i], "mouseout", function(){ hideToolTips(); } );
    }

    function showToolTips( evt, url )
    {
        hideToolTips();
        var tw = d.createElement("div");
        tw.id = "beyond_ToolTipsWindow";
        tw.style.position = "absolute";
        tw.style.backgroundColor = "lightyellow";
        tw.style.border = "outset 2px lightyellow";
        tw.style.fontSize = "10px";
        tw.style.padding = "10px";
        tw.style.zIndex = 1000001;
        var xxx = evt.pageX + 5;
        if( xxx > 700 ) xxx -=50;
        tw.style.left = xxx + "px";
        tw.style.top = (evt.pageY +5) + "px";
        var dv = d.createElement("div");
        dv.id = "beyond_ToolTipsWindow_base";
        dv.appendChild(d.createTextNode("領地 : ..."));
        tw.appendChild( dv );

        dv = d.createElement("div");
        dv.id = "beyond_ToolTipsWindow_ally";
        dv.appendChild(d.createTextNode("同盟 : ..."));
        tw.appendChild( dv );

        dv = d.createElement("div");
        dv.id = "beyond_ToolTipsWindow_user";
        dv.appendChild(d.createTextNode("君主 : ..."));
        tw.appendChild( dv );
        $("beyond_floatpanel").appendChild(tw);


        cajaxRequest(url, "GET", "", function(req){
            var tw = $("beyond_ToolTipsWindow");
            if( !tw ) return ;

            var dom = d.createElement("html");
            dom.innerHTML = req.responseText;
            if (navigator.userAgent.toLowerCase().indexOf('chrome') != -1) {
                $("beyond_tmp").appendChild(dom);
            }
            var dt = getDatafromLandElm(dom);
            if (navigator.userAgent.toLowerCase().indexOf('chrome') != -1) {
                $("beyond_tmp").removeChild(dom);
            }
            if( !dt ) return ;

            if( $("beyond_ToolTipsWindow_base") ) {
                $("beyond_ToolTipsWindow_base").innerHTML = "領地 : " + dt.base + "(" + dt.x + "," + dt.y + ")";
                $("beyond_ToolTipsWindow_ally").innerHTML = "同盟 : " + dt.ally;
                $("beyond_ToolTipsWindow_user").innerHTML = "君主 : " + dt.user;
            }
        }, function(req){
//          alert("サーバからエラーが返りましたよ" );
        });

    }
    function hideToolTips()
    {
        var tw = $("beyond_ToolTipsWindow");
        if( tw ){
            tw.parentNode.removeChild(tw);
        }
    }
    function getDatafromLandElm(dom)
    {
        var ret = new Array();

        var nam = $x('.//span[@class="basename"]', dom);

        if( !nam ) return null;
        ret["base"] = nam.innerHTML;

        var xy = $x('.//span[@class="xy"]', dom);
        if( !xy ) return null;
        xy = xy.innerHTML.match(/([\-0-9]+),([\-0-9]+)/);
        if( !xy ) return null;
        ret["x"] = parseInt(xy[1], 10);
        ret["y"] = parseInt(xy[2], 10);

        var a = $a('.//div[@class="status"]//a', dom);
        if( a.length < 2 ) {
            ret["user"] = "";
            ret["ally"] = "";
        }else{
            ret["user"] = a[0].innerHTML;
            ret["ally"] = a[1].innerHTML;
        }
        return ret;
    }

}


//////////////////////
//プロフィール画面星表示
//////////////////////
function disp_UserStar()
{
    if( location.pathname == "/user/" ) {
        showProfile();
    }


    function showProfile()
    {
        //君主名取得
        var uname_td = $x("//table[@class=\"commonTables\"]//tr[2]/td[2]");
        if( !uname_td ) return;
        var uname = uname_td.textContent;
        var uid = USER_ID;
        if( URL_PARAM.user_id ) uid = URL_PARAM.user_id;

        //table★欄追加
        cappendColumnForProfile("★", "beyond_star" );

        //内容初期設定
        lists = cloadData( "UserStarList" + uid, "[]", true, true );

        for( var i=0 ; i<lists.length ; i++){
            var td = $("beyond_star_" + lists[i].x + "_" + lists[i].y);
            if( td && td.innerHTML == "" ) {
                if( lists[i].npc ) {
                    td.innerHTML = "★" + lists[i].star;
                    td.style.color = "red";
                }else{
                    td.innerHTML = "★" + lists[i].star + " (" + lists[i].wood + "," + lists[i].stone + "," + lists[i].iron + "," + lists[i].rice + ")";
                }
                td.style.opacity = lists[i].star * 0.05 + 0.5;
            }
        }
        //タイトルにGETを追加
        var th = $("beyond_star_title");
        if( th ) {
            var lnk = d.createElement("a");
            lnk.href = "javascript:void(0)";
            lnk.innerHTML ="(GET)";
            lnk.style.fontSize = "9px";

            var running = false;
            $e(lnk, "click", function() {

                if( running ) return ;

                if( confirm("☆情報を一気に取得するためサーバに負荷をかけます。\n何度も実行するとDOS攻撃と同じなので、実行には注意して下さい") == false ) return;
                running = true;

                window.setTimeout(timerFunc, 0);

                function timerFunc()
                {
                    var tds = $a("//td[contains(@id, \"beyond_star_\")]");
                    var targettd = "";
                    var targetid = "";
                    for( var i=0 ; i< tds.length ; i++) {
                        if( tds[i].innerHTML == "" ) {
                            targettd = tds[i];
                            targetid = tds[i].id;
                            break;
                        }
                    }
                    if( !targetid ) {
                        alert("全ての☆情報を取得しました");
                        running = false;
                        return;
                    }

                    var xy = targetid.match(/beyond_star_([\-0-9]+)_([\-0-9]+)/);
                    if( !xy ) {
                        GM_log("err");;
                        return ;
                    }

                    cajaxRequest("/map.php?x=" + xy[1] + "&y=" + xy[2], "GET", "", function(req) {
                        var dom = d.createElement("html");
                        dom.innerHTML = req.responseText;
                        if (navigator.userAgent.toLowerCase().indexOf('chrome') != -1) {
                            $("beyond_tmp").appendChild(dom);
                        }

                        var area = $a("//map[@id=\"mapOverlayMap\"]//area", dom);
                        for(var i=0 ; i<area.length ; i++){
                            var dat = area[i].getAttribute("onmouseover");
                            dat = dat.replace(/^.*rewrite/, "setStar");
                            dat = dat.replace(/\); .*$/, ");");
                            //evalの中ではGM_set/getValueが出来ないので、変数を一旦外に出す形に
                            eval("dat = " + dat);
                            if( !dat ) continue;

                            var td = $("beyond_star_" + dat.x + "_" + dat.y);
                            if( !td ) { GM_log("td null err?:" + dat.x + "," + dat.y); return;};
                            if( td.innerHTML) continue;

                            csetUserStar( uid, dat.x, dat.y, dat.star.length, dat.wood, dat.stone, dat.iron, dat.rice, dat.npc );
                            if( dat.npc ) {
                                td.innerHTML = "★" + dat.star.length;
                                td.style.color = "red";
                            }else{
                                td.innerHTML = "★" + dat.star.length + " (" + dat.wood + "," + dat.stone + "," + dat.iron + "," + dat.rice + ")";
                            }
                            td.style.opacity = dat.star.length * 0.05 + 0.5;
                        }

                        if (navigator.userAgent.toLowerCase().indexOf('chrome') != -1) {
                            $("beyond_tmp").removeChild(dom);
                        }

                        window.setTimeout(timerFunc, 0);

                    });
                }
            });

            th.appendChild(lnk);
        }
        function setStar(name, user_name, jinko, xy, ally, star, kyori, wood, stone, iron, rice, npc)
        {
            if( uname == user_name) {
                var tmp = xy.match(/\(([\-0-9]+),([\-0-9]+)\)/);
                if( tmp ) {
                    var x = tmp[1];
                    var y = tmp[2];
                    return {"user_name":user_name, "x":x, "y":y, "star":star, "wood":wood, "stone":stone, "iron":iron, "rice":rice, "npc":npc};
                }
            }
            return null;
        }
    }
}

//////////////////////
//プロフィール画面Level表示
//////////////////////
function disp_UserLevel()
{

    if( location.pathname == "/user/" ) {
        if( !URL_PARAM.user_id || USER_ID == URL_PARAM.user_id ) {
            showProfile();
        }
    }
    if( location.pathname == "/land.php" || location.pathname == "/village.php" ) {
        //保存
        var spnxy = $x("//span[@class=\"xy\"]");
        if( !spnxy ){
            return;
        }
        var xy = spnxy.innerHTML.match(/\(([\-0-9]+),([\-0-9]+)\)/);
        if( !xy ) {
            return;
        }
        var tmp = spnxy.innerHTML.match(/レベル(\d+)/);
        if( tmp ) {
    //        GM_log("add:" + xy[1] + "," + xy[2]);
            csetMyLevel(xy[1], xy[2], tmp[1] );
        }else {
     //       GM_log("del:" + xy[1] + "," + xy[2]);
            cdelMyLevel(xy[1], xy[2]);
        }
    }


    function showProfile()
    {
        //tableLevel欄追加
        cappendColumnForProfile("Level", "beyond_level" );

        //内容初期設定
        lists = cloadData( "MyLevelList", "[]", true, true );
        for( var i=0 ; i<lists.length ; i++){
            var td = $("beyond_level_" + lists[i].x + "_" + lists[i].y);
            if( td ) {
                td.innerHTML = lists[i].level;
            }
        }
        updateLevelUp();
        updateLevelUpLink();

        //タイトルにGETを追加
        var th = $("beyond_level_title");
        if( th ) {
            var lnk = d.createElement("a");
            lnk.href = "javascript:void(0)";
            lnk.innerHTML ="(GET)";
            lnk.style.fontSize = "9px";

            var running = false;
            $e(lnk, "click", function() {
                if( running ) return ;

                if( confirm("Level情報を一気に取得するためサーバに負荷をかけます。\n何度も実行するとDOS攻撃と同じなので、実行には注意して下さい") == false ) return;
                running = true;
                window.setTimeout(timerFunc, 0);

                function timerFunc()
                {
                    var tds = $a("//td[contains(@id, \"beyond_level_\")]");
                    var targettd = "";
                    var targetid = "";
                    for( var i=0 ; i< tds.length ; i++) {
                        if( tds[i].innerHTML == "" ) {
                            targettd = tds[i];
                            targetid = tds[i].id;
                            break;
                        }
                    }
                    if( !targetid ) {
                        updateLevelUp();
                        updateLevelUpLink();
                        running = false;
                        alert("全てのレベル情報を取得しました");
                        return;
                    }

                    var xy = targetid.match(/beyond_level_([\-0-9]+)_([\-0-9]+)/);
                    if( !xy ) {
                        GM_log("err");;
                        return ;
                    }

                    cajaxRequest("/land.php?x=" + xy[1] + "&y=" + xy[2], "GET", "", function(req) {
                        var dom = d.createElement("html");
                        dom.innerHTML = req.responseText;
                        if (navigator.userAgent.toLowerCase().indexOf('chrome') != -1) {
                            $("beyond_tmp").appendChild(dom);
                        }
                        var spnxy = $x("//span[@class=\"xy\"]", dom);
                        if( !spnxy ){
                            GM_log("span class=xy err");
                            return;
                        }
                        var xy = spnxy.innerHTML.match(/\(([\-0-9]+),([\-0-9]+)\)/);
                        if( !xy ) {
                            GM_log("xy match err");
                            return;
                        }
                        var level = 0;
                        var tmp = spnxy.innerHTML.match(/レベル(\d+)/);
                        if( tmp ) {
                            level = tmp[1];
                        }
                        var td = $("beyond_level_" + xy[1] + "_" + xy[2]);
                        if( !td ) { GM_log("td null err?:" + xy[1] + "," + xy[2]); return;};
                        if( !td.innerHTML ) {
                            csetMyLevel(xy[1], xy[2], level);
                            td.innerHTML = level;
                        }
                        if (navigator.userAgent.toLowerCase().indexOf('chrome') != -1) {
                            $("beyond_tmp").removeChild(dom);
                        }

                        window.setTimeout(timerFunc, 0);

                    });
                }
            });

            th.appendChild(lnk);

        }

        function updateLevelUp()
        {
            //建設/破棄リストから
            var lists = cloadData("RemoveList", "[]", true, true);
            for(var i=0 ; i<lists.length ; i++) {
                if( lists[i].kind != 5 ) continue;
                var td = $("beyond_level_" + lists[i].x + "_" + lists[i].y);
                if( !td ) continue;
    //           GM_log("td:" + td.innerHTML);
                var level = parseInt(td.innerHTML,10);
                if( isNaN( ""+level ) ) continue;
                td.innerHTML =  level + " (+)";
            }
        }
        function updateLevelUpLink()
        {
            var img_lvup = 'data:image/gif;base64,'+
                'R0lGODlhFQAVAJEAAIaT6////////wAAACH5BAUUAAIALAAAAAAVABUAAAJDlICpi3YM14u0WhVY'+
                'Rjn4zWlJx4HgiJrooqohm67A+c727GLpp8MhXZORRD4b8NYzQj4k5pDF2/CQl6pVclU4sgBDAQA7';
            var tds = $a("//td[contains(@id, \"beyond_level_\")]");
            for( var i=0 ; i<tds.length ; i++){
                if( "" + parseInt(tds[i].innerHTML,10) == tds[i].innerHTML ) {
                    var lv = parseInt(tds[i].innerHTML,10);
                    if( lv < 1 || lv > 4 ) continue;
                    var mtbl = [2, 2, 2, 4];
                    var meisei = mtbl[lv - 1];
                    if( RES_NOW.fame >= meisei ) {
                        var xy = tds[i].id.match(/beyond_level_([\-0-9]+)_([\-0-9]+)/);
                        if( xy ) {
                            var lnk =  '<a href="'+caddSessionId('/territory_proc.php?x=' + xy[1] + '&y=' + xy[2] + '&mode=lvup')+'" title="レベルアップ" onclick="';
                                lnk += "return confirm('名声" + meisei + "を消費し、領地をレベルアップしますか？');";
                                lnk += '"><img src="' + img_lvup + '" style="width:14px; height:14px; vertical-align:middle;"></a>';
                            tds[i].innerHTML += lnk;
                        }
                    }
                }
            }
        }
    }
}


//////////////////////
//同盟ログ前後リンク追加
//////////////////////
/***
function disp_ReportNextPrior()
{
    if( location.pathname == "/alliance/alliance_log.php" ) {
        var elms = $a("//table[@class=\"commonTables\"]//tr/td[2]/a");
        var lists = new Array();
        for( var i=0; i<elms.length ; i++) {
            var ids = elms[i].href.match(/id=(\d+)/);
            if( ids ) {
                lists.push(ids[1]);
            }
        }
        csaveData("AllyReports", lists, true, true);
    }
    if( location.pathname == "/alliance/detail.php" ) {
        var lists = cloadData("AllyReports", "[]", true, true);

        var pos =lists.indexOf( URL_PARAM.id );
        if( pos != -1 ) {
            var tbl = d.createElement("table");
            tbl.width = "100%";
            var tmpHTML = "<tr>";
            if( pos < lists.length -1  ) {
                var params = "id=" + lists[pos + 1] +
                            "&m=" + ( (URL_PARAM.m) ? URL_PARAM.m : ""  ) +
                            "&p=" + ( (URL_PARAM.p) ? URL_PARAM.p : ""  );
                tmpHTML += "<td align=\"left\"><a href=\"/alliance/detail.php?" + params + "\">前の報告書へ</a></td>"
            }
            if( pos > 0 ) {
                var params = "id=" + lists[pos - 1] +
                            "&m=" + ( (URL_PARAM.m) ? URL_PARAM.m : ""  ) +
                            "&p=" + ( (URL_PARAM.p) ? URL_PARAM.p : ""  );
                tmpHTML += "<td align=\"right\"><a href=\"/alliance/detail.php?" + params + "\">次の報告書へ</a></td>"
            }
            tmpHTML += "</tr>";
            tbl.innerHTML = tmpHTML;
            var ct = d.createElement("center");
            ct.appendChild(tbl);
            var inspos = $x("//table[@summary=\"件名\"]");
            if( inspos ) {
                inspos.parentNode.insertBefore(ct, inspos);
            }
        }
    }

}
***/
//////////////////////
//マップ中央表示
//////////////////////
function disp_MapCenter()
{
    if( location.pathname != "/map.php") return;
    var cx = parseInt(URL_PARAM.x, 10);
    var cy = parseInt(URL_PARAM.y, 10);
    if( isNaN(""+cx) ) cx = 0;
    if( isNaN(""+cy) ) cy = 0;
    if( cx > MAP_X_MAX ) cx = MAP_X_MAX;
    if( cx < MAP_X_MIN ) cx = MAP_X_MIN;
    if( cy > MAP_Y_MAX ) cy = MAP_Y_MAX;
    if( cy < MAP_Y_MIN ) cy = MAP_Y_MIN;

	// mixi 51x51 対応
//    var area_center = $x("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + cx + "&y=" + cy + "#ptop\"]");
	var area_center = $x("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + cx + "&y=" + cy + "\"] | //map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + cx + "&y=" + cy + "#ptop\"]");

	if( !area_center ) return;

    var dat = area_center.getAttribute("onmouseover");
    dat = dat.replace(/^.*overOperation/, "setCenter");
    dat = dat.replace(/\); .*$/, ");");
    eval(dat);

    var dv = d.createElement("div");
    dv.style.fontSize= "10px";
    dv.appendChild(d.createTextNode("中央:( " + cx + " , " + cy + " )"));
//	$("mapXY").appendChild(dv);
	$("map-xy-search").appendChild(dv);

    function setCenter(act, x, y )
    {
        var rollover = $("rollover");
        var icon_c = 'data:image/png;base64,'+
                'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAAAAlwSFlz'+
                'AAAK8AAACvABQqw0mAAAABZ0RVh0Q3JlYXRpb24gVGltZQAwMy8yNi8wOQlCSeUAAAAldEVYdFNv'+
                'ZnR3YXJlAE1hY3JvbWVkaWEgRmlyZXdvcmtzIE1YIDIwMDSHdqzPAAAEd0lEQVR4nO3by2+UVRjH'+
                '8U9LC0UUoqIBRAxCQUWRS0mUiBfEe70tdKMb48aYmPCfuDMmxoVrF97AiAFUEF1wURCNEUQTNQXR'+
                'KEpVGMq4eN6XmXlnOk7bGcCX95eckPcy532+55znck5KV7lcdiGp+1wbcLZVAOddBXDeVQDnXQVw'+
                '3lUA510FcN5VAOddBXDeVQDnXQVw3lUA510FcN51wQH31FwdeL5T35mOZbgiaXAUR7Afv3fkq/0v'+
                '1d3qafBaO7UEazEfM9CLruRZGSUcx0/YhL0dtqdjwEsxiEWYVHW/hGMC+lJMxmVJW4Jv8A72dciu'+
                'tgOvxANYqBb0NA7iQ7GEYTluxzWJHd24Lvntt3gXe9psX9uAB/AQrlUbCEcE6CbsFuCptooBWIl7'+
                '0S8GqQeLk+tDAnxnm+ycMPBqAXq1im/CKRzABnwh/LWRTguYXbgp6WuRyowvxAv4ARvxyQTtHRdw'+
                'D9bgfsxWCzqCz/G6CEStqiz8dh+uwhMiqk9K+p+H5/CwWC07RDwYl/GtajLuFFF3jlrQVF1JuxJ/'+
                '4o8x2jM9+W3aT7bvuXhWxIktwiVOjuUDrQBPxjoBOytjyHF8JWZ6rliGK5L2Jt5Q67fN1I178FjV'+
                'vbJYzodxAy5O7s/B08n7W0Q8aAm8GfBFSYd3qBQLqf4RQegtDImltw73Jc+2Cb9sFVby7kcYFtG7'+
                'D+8JoBExqI+KINcnBn4Wnkrs3Ib38Xezj3TV/FFLVFq9wj/XYmbm/WHhoyloVlNFwBqXf1WpV0xG'+
                'I+NT8GWYlnn2ixigTSi1UmlNxTO4Re3SHRYzukFj0FRNR3cMKhl90IbwsgAfFDOegs/EkyLwvSZW'+
                'W42ym4eluLXquiyW5nq8ojns2daQsGm9mIzq1LdapLk6ZYFL6v2uW+OIfL6oS+NdX8P4kV3S+/Gp'+
                'GKG0sxV4Ucz0RufPLM8WhcqAel/eLgqeOmWBT+JV/Cii7uXJ/WkiWg/gM7zt3AatR0QtngX9FZul'+
                'QauBGqWlkghOW0WaWaOSlqbhNgG+R+TaIbGk7hbRPU1Lu0XUHItmiiCUTUun1aelah1VSUt/NftA'+
                'o7SU1RQx23epVEGphsXSmS3Kv+pn4yk8Htda4ZE++1lMzGaNCo8GaakV4FRTBPRa9RVXqlNiE79d'+
                '7JKONeuwgWZggXCf5aN8g6jTPxCl5YlRe5vgiccJlSW2Riz3OZl3usWMHjZ2WMlvhsTslQVw+i+V'+
                'k5HtYnDHrPHslkpiGW0V/vygqKPT9LBKVEEH/ff2MFWXyJuDYkvYm3mebg93jMPeGk10P/xx0lYJ'+
                'Y+cL43txvdjbjnYAQAxQ9gAgVRnfiUE7bw4AUu1M2oDKEU+3AFicXB8Sm4OvBcxisQNboP446IBw'+
                'n11tsu+M2n2mtStpN4vNer8KeL84Akr3yJdkvj8iQP9Xh3ip9ibtRpFT54kipk+cVqY6gd/wvYi4'+
                'X3bInjPq9Ln0/qT1CfhZImcT0fiIOEAY7rAdZ9RV/CePnKsAzrsK4LzrggP+F1IbDJgkELkdAAAA'+
                'AElFTkSuQmCC';
        var img = d.createElement("img");
        img.src = icon_c;
        img.style.zIndex = 200;
        img.style.position = "absolute";

        img.style.left = x;
        img.style.top = y;
        if( $x("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort15 now\"]") )
			{ img.style.width = "44px"; img.style.height = "44px"; } else
		if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort15 now\"]") )
//P鯖仕様変更対応 2011.03.23 by 霧
			{ img.style.width = "44px"; img.style.height = "44px"; } else
		if( $x("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort20 now\"]") )
			{ img.style.width = "33px"; img.style.height = "33px"; } else
		if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort20 now\"]") )
//P鯖仕様変更対応 2011.03.23 by 霧
			{ img.style.width = "33px"; img.style.height = "33px"; }
		else {
			img.style.width = "60px";
			img.style.height = "60px";
			img.style.zIndex = 121;
		}
        rollover.parentNode.insertBefore(img, rollover.nextSibling);
    }

}

//////////////////////
//討伐ゲージ回復時間表示
//////////////////////
function disp_ToubatsuRestTime()
{
    if(location.pathname != "/card/deck.php") return ;

    ToubatsuRecoveryEstimates();

    function ToubatsuRecoveryEstimates()
    {
        var now = cgetNow();
        //デッキ
        var decks = $a("//div[@id=\"cardListDeck\"]//div[@class=\"control\"]");
        for( var i=0; i<decks.length ; i++ ){
            var stat = $x("descendant::dl/dd[3]", decks[i]);
            if( !stat ) continue;
            if( stat.textContent == "内政セット済" )  continue;

            var tb = $x("descendant::dl/dd[1]/div[1]", decks[i]);
            if( !tb ) continue;
            tb = 500 - parseInt( tb.textContent, 10 );

            if( tb != 0 ) {
                var timeText = getTime( tb );
                var dayText = caddDate(now, timeText);
                var txt = "500まで" + timeText + "後 (" + dayText + "完了)";

                $x("descendant::dl/dt[1]", decks[i]).title = txt;
                $x("descendant::dl/dd[1]", decks[i]).title = txt;
            }

        }
        //ファイル（カード表示）
        var files = $a("//div[@id=\"cardFileList\"]//div[@class=\"control\"]");
        for( var i=0; i<files.length ; i++ ){
            var tb = $x("descendant::dl/dd[1]/div[1]", files[i]);
            if( !tb ) continue;
            tb = 300 - parseInt( tb.textContent, 10 );

            if( tb != 0 ) {
                var timeText = getTime( tb );
                var dayText = caddDate(now, timeText);
                var txt = "300まで" + timeText + "後 (" + dayText + "完了)";

                $x("descendant::dl/dt[1]", files[i]).title = txt;
                $x("descendant::dl/dd[1]", files[i]).title = txt;
            }

        }
        //ファイル（ｘ枚表示）
        var files = $a("//table[@class=\"statusParameter1\"]//tr[7]");
        for( var i=0; i<files.length ; i++ ){

            var tb = $x("descendant::td[1]", files[i]);
            if( !tb ) continue;
            tb = 300 - parseInt( tb.textContent, 10 );

            if( tb != 0 ) {
                var timeText = getTime( tb );
                var dayText = caddDate(now, timeText);
                var txt = "300まで" + timeText + "後 (" + dayText + "完了)";

                $x("descendant::th[1]", files[i]).title = txt;
                $x("descendant::td[1]", files[i]).title = txt;
            }

        }

        window.setTimeout(function() { ToubatsuRecoveryEstimates(); }, 60*1000);
    }

    function getTime(toubatsu)
    {
        var tmp = toubatsu * 216;
        var h = Math.floor(tmp / 3600);
        var m = Math.floor((tmp - h*3600 ) / 60 );
        var s = Math.floor(tmp - h*3600 - m*60 );
        var tim = h + ":" +
                  (m+100).toString().substr(-2)  + ":" +
                  (s+100).toString().substr(-2);
        return tim;
    }
}

//////////////////////
//書簡/報告書削除機能
//////////////////////
function disp_DeleteMessages()
{
    if( location.pathname == "/message/detail.php" ) {
        //書簡削除ボタン
        addDeleteMessageButton();
    }
    if( location.pathname == "/report/detail.php" ) {
        //報告書削除ボタン
        addDeleteReportButton();
    }

    function addDeleteMessageButton()
    {
        var frm = d.createElement("form");
        frm.method = "post";
        frm.action = "/message/delete.php";
        var m = d.createElement("input");
        m.type = "hidden";
        m.name = "mode";
        m.value = URL_PARAM.m;
        var p = d.createElement("input");
        p.type = "hidden";
        p.name = "p";
        p.value = URL_PARAM.p;
        var c = d.createElement("input");
        c.type = "hidden";
        c.name = "chk[]";
        c.value = URL_PARAM.id;

        var btn = d.createElement("input");
        btn.type = "submit";
        btn.value = "削除";
        btn.setAttribute("onClick", "return window.confirm('この書簡を削除します。よろしいですか？');" );
        frm.appendChild(m);
        frm.appendChild(p);
        frm.appendChild(c);
        frm.appendChild(btn);

        var li = d.createElement("li");
        li.className = "last";
        li.appendChild(frm);
        var menu = $x("//ul[@id=\"statMenu\"]");
        menu.appendChild(li);
    }
    function addDeleteReportButton()
    {
        var frm = d.createElement("form");
        frm.method = "post";
        frm.action = "/report/list.php";
        var m = d.createElement("input");
        m.type = "hidden";
        m.name = "m";
        m.value = URL_PARAM.m;
        var p = d.createElement("input");
        p.type = "hidden";
        p.name = "p";
        p.value = URL_PARAM.p;
        var u = d.createElement("input");
        u.type = "hidden";
        u.name = "u";
        u.value = URL_PARAM.u;
        var c = d.createElement("input");
        c.type = "hidden";
        c.name = "chk[]";
        c.value = URL_PARAM.id;

        var btn = d.createElement("input");
        btn.type = "submit";
        btn.name = "remove_checked";
        btn.value = "削除";
        btn.setAttribute("onClick", "return window.confirm('この報告書を削除します。よろしいですか？');" );
        frm.appendChild(m);
        frm.appendChild(p);
        frm.appendChild(c);
        frm.appendChild(u);
        frm.appendChild(btn);
  //      GM_log("a");
        var h2 = $x("//h2");
        h2.parentNode.insertBefore(frm, h2.nextSibling);
    }

}

//////////////////////
//出発時刻計算
//////////////////////
function disp_TSendTime()
{
    if( location.pathname != "/facility/castle_send_troop.php" ) return;

    var td = $x('//table[@class="fighting_about"]//tr[1]/td[1]');
    if( !td ) return ;

    var tim = td.textContent.match(/到着まで[:|：][\s|　]*(\d+):(\d+):(\d+)[\s|　]*到達時間/);
    if( !tim ) return;

    var area_up_timer = $("area_up_timer0");
    if( !area_up_timer ) return;
    var day = area_up_timer.textContent.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
    if( !day ) return;

    //ベース作成
    var div = d.createElement("div");
    div.style.margin = "5px";
    div.appendChild(d.createTextNode("到着時刻："));
    createText(div, "beyond_send_y", day[1]);
    div.appendChild(d.createTextNode("-"));
    createText(div, "beyond_send_m", day[2]);
    div.appendChild(d.createTextNode("-"));
    createText(div, "beyond_send_d", day[3]);
    div.appendChild(d.createTextNode("　"));
    createText(div, "beyond_send_h", "");
    div.appendChild(d.createTextNode(":"));
    createText(div, "beyond_send_mi", "");
    div.appendChild(d.createTextNode(":"));
    createText(div, "beyond_send_s", "");
    div.appendChild(d.createTextNode("　"));
    var btn = d.createElement("input");
    btn.type = "button";
    btn.id = "beyond_send_button";
    btn.value = "出発時刻計算";
    div.appendChild(btn);

    div.appendChild(d.createElement("br"));
    div.appendChild(d.createTextNode("出発時刻："));

    var spn = d.createElement("span");
    spn.id = "beyond_send_time";
    div.appendChild(spn);

    td.appendChild(div);

    $e(btn, "click", function() {
        if( $("beyond_send_y").value == "" ) $("beyond_send_y").value = "0";
        if( $("beyond_send_m").value == "" ) $("beyond_send_m").value = "0";
        if( $("beyond_send_d").value == "" ) $("beyond_send_d").value = "0";
        if( $("beyond_send_h").value == "" ) $("beyond_send_h").value = "0";
        if( $("beyond_send_mi").value == "" ) $("beyond_send_mi").value = "0";
        if( $("beyond_send_s").value == "" ) $("beyond_send_s").value = "0";
        var y = $("beyond_send_y").value;
        var m = $("beyond_send_m").value;
        var d = $("beyond_send_d").value;
        var h = $("beyond_send_h").value;
        var mi =$("beyond_send_mi").value;
        var s = $("beyond_send_s").value;
//      if( !y || !m || !d || !h || !mi || !s ) {
//          alert("全て入力して下さい");
//          return;
//      }
        y = parseInt(y, 10);
        m = parseInt(m, 10);
        d = parseInt(d, 10);
        h = parseInt(h, 10);
        mi =parseInt(mi, 10);
        s = parseInt(s, 10);
        if( isNaN(""+y) || isNaN(""+m) || isNaN(""+d) || isNaN(""+h) || isNaN(""+mi) || isNaN(""+s) ) {
            alert("数字で入力して下さい");
            return;
        }


//ALMIC start

		var dt = new Date(y, m - 1, d, h - parseInt(tim[1],10) , mi - parseInt(tim[2],10), s - parseInt(tim[3],10) );
		

		$("beyond_send_time").innerHTML = 
			dt.getFullYear() + "-" + (dt.getMonth()+1) + "-" + dt.getDate() + " " +
			(dt.getHours()+100).toString().substr(-2)  + ":" +
			(dt.getMinutes()+100).toString().substr(-2)  + ":" +
			(dt.getSeconds()+100).toString().substr(-2);

/*
//こっから下がALMIC仕様なのかな？特定月の月末でバグが起きていたのでいったん封じ込め
		var diff = tim[1] * 3600 * 1000 + tim[2] * 60 * 1000 + tim[3] * 1000;

//		var dt = new Date(y,m,d,h,mi,s);
		var dt = new Date(y, m - 1, d, h - parseInt(tim[1],10) , mi - parseInt(tim[2],10), s - parseInt(tim[3],10) );
		var now = new Date();

		dt.setTime(dt.getTime() - diff); 

//		$("beyond_send_time").innerHTML = dt.getFullYear() + "-" + dt.getMonth() + "-" + dt.getDate() + " " + dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();
		$("beyond_send_time").innerHTML = dt.getFullYear() + "-" + (dt.getMonth()+1) + "-" + dt.getDate() + " " + (dt.getHours()+100).toString().substr(-2)  + ":" + (dt.getMinutes()+100).toString().substr(-2)  + ":" + (dt.getSeconds()+100).toString().substr(-2);

		if($("autotroop_time") != null &&
		   dt.getTime()/1000 > now.getTime()/1000 &&
		    window.confirm("自動出兵に設定しますか？")){
			$("autoTroop_HH").value = dt.getHours();
			$("autoTroop_MM").value = dt.getMinutes();
			$("autoTroop_SS").value = dt.getSeconds();
		}
*/
//ALMIC end



    } );

    function createText(container, id, def)
    {
        var tb = d.createElement("input");
        tb.type = "text";
        tb.value = def;
        tb.id = id;
        tb.size = 3;
        container.appendChild(tb);
    }

}
//////////////////////
//小さいボタン
//////////////////////
function disp_SmallButton()
{

    var btnConfs = {
            btn_buycp : {
                width : 26,
                start : -8
            },
            btn_special : {
                width : 26,
                start : -29
            },
            btn_getbusho : {
                width : 20,
                start : -2
            },
            btn_yorodudas : {
                width : 25,
                start : -2
            },
            btn_bushoduel : {
                width : 27,
                start : -1
            },
            btn_cpdeposit : {
                width : 20,
                start : -20
            },
            btn_invitefriend : {
                width : 27,
                start : -9
            }
    };

    if (isNarrow) {
        btnConfs.btn_buycp.start = -6;
        btnConfs.btn_special.start = -26;
    }

    var btnImages = $a('(id("sidebar")/ul/li | id("btn_area_box"))//img');

    for (var i =0; i < btnImages.length;i++) {
        var btnImage = btnImages[i];
        for (var key in btnConfs) {
            if (btnImage.src.indexOf(key) < 0) {
                continue;
            }
            var btnConf = btnConfs[key];
            var btn = btnImage.parentNode;
            var btnHeight = 22;
            if (isNarrow) btnHeight = 25;
            btnImage.style.display = "none";

            btn.style.width = btnConf.width+"px";
            btn.style.height = btnHeight+"px";
            btn.style.marginLeft = "2px";
            btn.style.marginBottom = "2px";
            btn.style.background = 'url("'+btnImage.src+'") no-repeat '+btnConf.start+'px 0px';
            btn.style.display = "block";

            var floatNode = btn;
            if (!isNarrow) floatNode = btn.parentNode;

            floatNode.style.cssFloat = "left";

            if (i == 0) {
                btn.style.marginLeft = "0px";
            }
        }
    }

    if (!isNarrow) cgetElementSibling(floatNode.parentNode,0).style.clear = "both";



    //状況の縮小
    var tr = $x('//table[@class="situationTable"]//tr[1]');
    var tds = $a('//table[@class="situationTable"]//tr[2]//img[not(contains(@src,"sit_blank"))]/ancestor::td');
    if( tr && tds ) {
        for( var i=0; i< tds.length ; i++) {
            tr.appendChild(tds[i]);
        }

        cgetElementSibling(tr,0).style.display = "none";

        var imgs = $a(".//img", tr);
        for( var i=0; i< imgs.length ; i++) {
            imgs[i].style.width = "20px";
            imgs[i].style.height = "20px";
            if( !imgs[i].src.match(/(_no\.gif)$/) ) {
                Pika_elementQueue.push(imgs[i]);
            }
        }
    }

    //拠点・生産・簡易出兵先の伸縮
    var targetNames = ["base","production","easydeploy"];
    var targets = {
            base : {
                img : '(id("lodgment") | id("sidebar"))//img[contains(@src,"icon_base")]',
                inner : 'ancestor::div[contains(@class,"Head")]/following-sibling::div[contains(@class,"Inner")]'
            },
            production : {
                img : 'id("sidebar")//img[contains(@src,"icon_production")]',
                inner : 'ancestor::div[contains(@class,"Head")]/following-sibling::div[contains(@class,"Inner")]'
            },
            easydeploy : {
                img : '(//div[@class="footer_box"] | id("sidebar"))//img[contains(@src,"icon_easydeploy")]',
                inner : 'ancestor::div[contains(@class,"Head")]/following-sibling::div[contains(@class,"Inner")] | id("map_bookmark")'
            }
    };
    for(var i = 0;i < targetNames.length;i++) {
        if (isNarrow && targetNames[i] == 'base' && location.pathname.search(/^\/(village|map|land)\.php/) < 0) {
            continue;
        }

        var target = targets[targetNames[i]];

        var base_img = $x(target.img);
        if( !base_img ) continue;

        var base_inner = $x(target.inner, base_img);
        if( !base_inner ) continue;

        var oc = cloadData( "sidebox_oc" + i , "", true);
        if( oc ) {
            base_inner.style.display = "none";
            base_img.style.opacity = 0.3;
        }
        (function(inner, no) {
            $e(base_img, "click", function(e) {
                var ocs = "";
                if( inner.style.display == "none" ){
                    inner.style.display = "";
                    this.style.opacity = 1;
                }else{
                    inner.style.display = "none";
                    this.style.opacity = 0.3;
                    ocs = "1";
                }
                csaveData( "sidebox_oc" + no , ocs, true);
            });
        })(base_inner, i);
    }

}

//////////////////////
//出兵マップ表示
//////////////////////
function disp_AttackMap()
{
    var img_atk = 'data:image/gif;base64,'+
            'R0lGODlhPAA8AIAAAP/M/////yH5BAUUAAEALAAAAAA8ADwAAAJ7jI+py+0Po5y02ouz3rz7D4bi'+
            'SJbmiabqyrbuC8fyTNf2jef6zvc8AATsgsEckYg7Fm9KoPE4XCakMCeDqmpCoSxt0yBsWQNj6bgb'+
            'dmJl6jUN+RSe3+V59ayMYZdwevjQd/c3ZbfiRlaYlXiYcsglFugjOUlZaXmJWVEAADs=';
    var img_mov = 'data:image/gif;base64,'+
            'R0lGODlhPAA8AIAAADP//////yH5BAUUAAEALAAAAAA8ADwAAAJ7jI+py+0Po5y02ouz3rz7D4bi'+
            'SJbmiabqyrbuC8fyTNf2jef6zvc8AATsgsEckYg7Fm9KoPE4XCakMCeDqmpCoSxt0yBsWQNj6bgb'+
            'dmJl6jUN+RSe3+V59ayMYZdwevjQd/c3ZbfiRlaYlXiYcsglFugjOUlZaXmJWVEAADs=';
    if( location.pathname == "/facility/unit_status.php" ) {
        var tds = $a("//table[@summary=\"出撃中の兵士\" or @summary=\"移動中の兵士\"]/tbody/tr[position()>1]/td[1]");

        for(var i=0; i<tds.length ; i+=3) {
            //0：場所　1：時間　２：兵種
//            GM_log(tds[i+0].textContent);
            var xy = tds[i+0].innerHTML.match(/[\(|（](-?\d+),(-?\d+)[）|\)]$/);
            if( !xy ) continue;
            var tim = tds[i+1].innerHTML.match(/(\d+\-\d+\-\d+ \d+:\d+:\d+)/);
            if( !tim ) continue;
            var kind = 0;
            if( tds[i].parentNode.parentNode.parentNode.getAttribute("summary") == "移動中の兵士" )
                kind = 1;
            addList(tim[1], parseInt(xy[1],10), parseInt(xy[2],10), kind );

            var a = $x("descendant::div/a[contains(text(), \"キャンセルする\")]", tds[i+1]);
            if( a ) {
                (function(tim, x, y) {
                    $e(a, "click", function(){
                        var lists = cloadData("AttackList", "[]", true, true);
                        for(var i=0 ; i<lists.length ; i++) {
                            if( lists[i].x == x && lists[i].y == y && lists[i].time == tim ) {
                                lists.splice(i,1);
                                csaveData( "AttackList", lists, true, true );
              //                  GM_log("deleted");
                                break;
                            }
                        }
                    } );
                })(tim[1], parseInt(xy[1],10), parseInt(xy[2],10));
            }
        }
        return;
    }

    var lists = cloadData("AttackList", "[]", true, true);
    lists = checkList(lists);       //時間を過ぎたものを削除

    if( location.pathname == "/map.php" ) {
        //地図に表示
        var type = 1;
//		if( $x("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort15 now\"]") ) type=2;
//		else if( $x("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort20 now\"]") ) type=3;
		//地図51×51対応
		if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort15 now\"]") ) type=2;
		else if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort20 now\"]") ) type=3;
        if( lists.length ) {
            var cx = parseInt(URL_PARAM.x,10);
            var cy = parseInt(URL_PARAM.y,10);
            if( cx > MAP_X_MAX ) cx = MAP_X_MAX;
            if( cx < MAP_X_MIN ) cx = MAP_X_MIN;
            if( cy > MAP_Y_MAX ) cy = MAP_Y_MAX;
            if( cy < MAP_Y_MIN ) cy = MAP_Y_MIN;

            var map = $x("//div[@id=\"mapsAll\"]");
            for(var i=0 ; i<lists.length ; i++) {
                var no = cgetMapNofromXY(lists[i].x, lists[i].y, cx, cy, type );
                if( !no ) continue;
                var img = document.createElement("img");
                img.className = "mapAll" + no;
                if( lists[i].kind == 1 ) {
                    img.src = img_mov;
                }else{
                    img.src = img_atk;
                }
                img.title = lists[i].time;
//              img.style.zIndex = 1000;

                map.appendChild(img);

                var area = $x("//map[@id=\"mapOverlayMap\"]/area[contains(@href, \"?x=" + lists[i].x + "&y=" + lists[i].y + "\")]");
                if( area ){
                    area.title += "　到着予定:" + lists[i].time;
                    area.alt += "　到着予定:" + lists[i].time;
                }

            }
        }
    }


    function addList(tim, x, y, kind)
    {
        var lists = cloadData("AttackList", "[]", true, true);

        var i;
        for(i=0 ; i<lists.length ; i++) {
            if(lists[i].x == x && lists[i].y == y ) {
                if( lists[i].time < tim ) {
                    lists[i].time = tim;
                    lists[i].kind = kind;
                    break;
                }else{
                    return;
                }
            }
        }
        if( i == lists.length ) {
            lists.push({"x":x, "y":y, "time":tim, "kind":kind } );
        }
        csaveData( "AttackList", lists, true, true );
    }

    function checkList(lists)
    {
        var dt = new Date();
        var ntime = dt.getFullYear() + "-" +
                    (dt.getMonth()+101).toString().substr(-2) + "-" +
                    (dt.getDate()+100).toString().substr(-2) + " " +
                    (dt.getHours()+100).toString().substr(-2)  + ":" +
                    (dt.getMinutes()+100).toString().substr(-2)  + ":" +
                    (dt.getSeconds()+100).toString().substr(-2);
        var deleted = false;
        for(var i=0 ; i<lists.length ; i++) {
            if( lists[i].time < ntime ) {
                lists.splice(i,1);
                i--;
                deleted = true;
            }
        }
        if( deleted ) {
            if( lists.length ) {
                csaveData( "AttackList", lists, true, true );
            } else {
                cdelData("AttackList", true );
            }
        }
        return lists;
    }
}

//////////////////////
//同一カード合成ボタン
//////////////////////
function disp_CardCombine()
{
    if( location.pathname != "/union/result_lv.php" &&
        location.pathname != "/union/result_learn.php" &&
        location.pathname != "/union/result_remove.php") {
        return;
    }

    var ins = $a("//div[@class=\"back\"]")[1];
    var skill2 = $x("//div[@class=\"skill2\"]");
    var skill3 = $x("//div[@class=\"skill3\"]");

    var div1 = d.createElement("div");
    div1.className = "cardColmn";
    div1.align = "center";
    var div2 = d.createElement("div");
    div2.className = "control";
    div1.appendChild(div2);

    var a = d.createElement("a");
    a.href = caddSessionId("lvup.php?cid=" + URL_PARAM.cid);
    a.title = "スキルLvを上げる";
    a.className = "skillLvUp";
    a.appendChild(d.createTextNode("スキルLvを上げる"));
    div2.appendChild(a);

    if( !skill3 ) {
        a = d.createElement("a");
        a.href = caddSessionId("learn.php?cid=" + URL_PARAM.cid);
        a.title = "新しいスキルを習得する";
        a.className = "skillLearn";
        a.appendChild(d.createTextNode("新しいスキルを習得する"));
        div2.appendChild(a);
    }
    if( skill2 ) {
        a = d.createElement("a");
        a.href = caddSessionId("remove.php?cid=" + URL_PARAM.cid);
        a.title = "スキルを削除する";
        a.className = "skillDelete";
        a.appendChild(d.createTextNode("スキルを削除する"));
        div2.appendChild(a);
    }

    ins.parentNode.insertBefore(div1, ins.nextSibling);
}

//////////////////////
//ヨロズダス表示
//////////////////////
function disp_PikaYorozu()
{
    if( location.pathname == "/busyodas/b3kuji.php" ) {
        Pika_updateYorozudasState();
    }
    if( location.pathname == "/busyodas/b3kuji_result.php") {
        Pika_updateYorozudasState2();
    }

    Pika_displayYorozudasState();
}

//////////////////////
//HP回復時間表示
//////////////////////
function disp_PikaHPRestTime()
{
    if(location.pathname != "/card/deck.php") return ;

    Pika_displayRecoveryEstimates();

}

//////////////////////
//拠点生産量表示
//////////////////////
function disp_SuzanSeisan()
{
    var icon = IMG_DIR  + "common/sidebar/icon_production.gif";
    var elms = ccreateSideBox("beyond_sidebox_suzanseisan", icon, "拠点生産");

    if(location.pathname == "/village.php") {
        Suzan_Seisan(elms.sideBoxInner);
    }

}


/////////////////////////////////////////////////////////////////////////////
//common functions
/////////////////////////////////////////////////////////////////////////////
function cgetCurrentBaseName()
{
    var xy = cgetCurrentBaseXY();
    return VILLAGES_INFO[(xy.x+"_"+xy.y).replace(/-/g,"m")].basename;
}

function cgetCurrentBaseXY()
{
    var nowLoc = $x('id("gnavi")//a[contains(@href,"map.php")]');
    if (!nowLoc) nowLoc = $x('id("gNav")//a[contains(@href,"map.php")]');
    if (!nowLoc) return null;


    var xy = nowLoc.href.match(/x=([\-0-9]+)&y=([\-0-9]+)/i);
    if( xy ) {
        return {'x':parseInt(xy[1], 10), 'y':parseInt(xy[2], 10)};
    }
}

function cgetDistanceFromBase(x, y)
{
    if( BASE_X == -9999 ) {
        var xy = cgetCurrentBaseXY();
        if( xy ) {
            BASE_X = xy.x;
            BASE_Y = xy.y;
        }
    }
    if( BASE_X != -9999 ) {
        var a = parseInt(x, 10);
        var b = parseInt(y, 10);
        return Math.sqrt(Math.pow(BASE_X - a, 2) + Math.pow(BASE_Y - b, 2));
    }
    return -1;
}

function cupdateCurrentResources()
{
    var nowNodes = PRE_LOAD_NODES['nowResources'];
    RES_NOW["wood"] = parseInt( nowNodes["wood"].innerHTML, 10 );
    RES_NOW["stone"] = parseInt( nowNodes["stone"].innerHTML, 10 );
    RES_NOW["iron"] = parseInt( nowNodes["iron"].innerHTML, 10 );
    RES_NOW["rice"] = parseInt( nowNodes["rice"].innerHTML, 10 );
}

function cgetNow()
{
    var stimeText = PRE_LOAD_NODES['serverTime'].innerHTML;
    var now = new Date();
    var nowTimeAry = stimeText.replace(/^\s*|\s*$/,'').split(":");
    now.setHours(parseInt(nowTimeAry[0],10),parseInt(nowTimeAry[1],10),parseInt(nowTimeAry[2],10));
    return now;
}

function caddDate(baseDate, timetxt)
{
    var tim = timetxt.match(/^(\d+):(\d+):(\d+)/);
    if( !tim ) return "";

    var dt = new Date(baseDate.getFullYear(),
                      baseDate.getMonth(),
                      baseDate.getDate(),
                      baseDate.getHours() + parseInt(tim[1],10),
                      baseDate.getMinutes() + parseInt(tim[2],10),
                      baseDate.getSeconds() + parseInt(tim[3],10) );

    return dt.getFullYear() + "-" + (dt.getMonth()+1) + "-" + dt.getDate() + " " +
            (dt.getHours()+100).toString().substr(-2)  + ":" +
            (dt.getMinutes()+100).toString().substr(-2)  + ":" +
            (dt.getSeconds()+100).toString().substr(-2);
}

//状態保存用のクッキー
function csetCookie(key, data)
{
    sday = new Date();
    sday.setTime(sday.getTime() + (120 * 1000 * 60 * 60 * 24));
    d.cookie = key + "=" + escape(data) + ";expires=" + sday.toGMTString() + "; path=/";
}

function cgetCookie(key)
{
    var data = "";
    var start = d.cookie.indexOf(key + "=");
    if (start != -1){
        var end = d.cookie.indexOf(";", start);
        data = unescape(d.cookie.substring(start + key.length + 1, end));
    }
    return data;
}
function cdelCookie(key)
{
    d.cookie = key + "=;expires=Thu,01-Jan-70 00:00:01 GMT; path=/";
}

function csetUserXY(aid, uid, x, y)
{
    var allylists = cloadData( "allyXYAllyList", "[]", true, true );

    if( allylists.indexOf(aid) == -1 ) {
        allylists.push(aid);
        csaveData( "allyXYAllyList", allylists, true, true );
    }

    var lists = cloadData( "allyXYList" + aid, "[]", true, true );

    for(var i=0 ; i<lists.length ; i++) {
        if( lists[i].id == uid ) {
            return;
        }
    }
    lists.push({"id":uid, "x":x, "y":y});
    csaveData( "allyXYList" + aid, lists, true, true );
}

function cdeleteUserXY(aid)
{
    var allylists = cloadData( "allyXYAllyList", "[]", true, true );

    var idx = allylists.indexOf(aid);
    if( idx != -1 ) {
        allylists.splice(idx,1);
        csaveData( "allyXYAllyList", allylists, true, true );
    }
    cdelData( "allyXYList" + aid, true );


}

function cresetUserXY()
{
    var allylists = cloadData( "allyXYAllyList", "[]", true, true );

    for(var i=0 ; i<allylists.length ; i++) {
        cdelData( "allyXYList" + allylists[i], true );
    }
    cdelData( "allyXYAllyList", true );
}

function cgetXYHtml(x,y)
{
    var img_send = IMG_DIR + "report/icon_go.gif";
    var img_mp = IMG_DIR + "report/icon_scout.gif";
    var m = "";
    var dist = cgetDistanceFromBase(x, y);
    if( dist != -1 ) {
        m = "　距離[" + dist.toFixed(2) + "]";
    }
    var txt = '';
    txt += '<a href="'+caddSessionId('/land.php?x=' + x + '&y=' + y + '#ptop')+'" title="表示" style="color:#0099cc; text-decoration: none;" onmouseover="';
    txt += "this.style.textDecoration='underline';"+'" onmouseout="'+"this.style.textDecoration='none';"+'">' + x + ',' + y + '</a>';
    txt += '<a href="'+caddSessionId('/map.php?x=' + x + '&y=' + y + '#ptop')+'" title="マップ' + x + ',' + y + '"><img src="' + img_mp + '" style="width:12px; height:12px; vertical-align:middle;"></a>';
    txt += '<a href="'+caddSessionId('/facility/castle_send_troop.php?x=' + x + '&y=' + y + '#ptop')+'" title="兵を送る' + x + ',' + y + m + '">';
    txt += '<img src="' + img_send + '" style="width:12px; height:12px; vertical-align:middle;"></a>';

    return txt;
}

function cajaxRequest(url, method, param, func_success, func_fail){
    var req = new XMLHttpRequest();
    req.onreadystatechange = function() {
        if (req.readyState == 4 && req.status == 200){
            func_success(req);
        }
        else if (req.readyState == 4 && req.status != 200){
            func_fail(req);
        }
    };

    if (SID) {
        var sdata = method.toLowerCase() == 'get' ? url : param;
        if (sdata.search(/(\?|&)SSID=[^&]+&?/i) < 0) {
           if (method.toLowerCase() == 'get') {
               url += (0 <= url.indexOf('?')) ? '&' : '?';
               url += SID;
           }
           else {
               if (typeof param != 'string') param = '';
               if (0 < param.length) param += '&';
               param += SID;
           }
        }
    }

    req.open(method, url, true);
    if (method == 'POST'){
        req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    }
    req.send(param);
}
function str2csvstr(str) {
    var csvstr;

    csvstr =  str.replace(/^[\s　]+|[\s　]+$/g, "");
    csvstr = csvstr.replace(/\"/g, "\"\"");

    if (csvstr.indexOf(",") != -1) {
        csvstr = "\"" + csvstr + "\"";
    }

    return csvstr;
}

function cgetElementXY(elm) {
    if( !elm ) return null;

    var xx = 0;
    var yy = 0;
    while(elm){
        xx += elm.offsetLeft;
        yy += elm.offsetTop;
        elm = elm.offsetParent;
    }
    return {"x":xx, "y":yy};
}

function cgetMapNofromXY(x, y, base_x, base_y, type)
{
    if( isNaN(""+base_x) ) base_x = 0;
    if( isNaN(""+base_y) ) base_y = 0;

    //map.php専用のXY座標→mapAll999
    var sc = 11;
    var hosei = 0;
    if( type == 2 ) {
        sc = 15;
    } else if( type == 3 ) {
        sc = 20;
        hosei = 1;
    }
    var hw = Math.floor( (sc - 1) / 2 );
    var no = "";
    if( x >= base_x - hw && x <= base_x - hw + sc - 1 &&
        y >= base_y - hw - hosei && y <= base_y - hw + sc - 1 - hosei  ) {
        no = (x - base_x + hw) * sc + (base_y + hw - y ) + 1;
        if( no < 10 ) no = "0" + no;
        else no = "" + no;
    }
    return no;
}

function ccreateCheckBox(container, id, def, text, title, left )
{
    left += 2;
    var dv = d.createElement("div");
    dv.style.padding = "2px";
    dv.style.paddingLeft= left + "px";
    dv.title = title;
    var cb = d.createElement("input");
    cb.type = "checkbox";
    cb.id = id;
    cb.value = 1;
    if( def ) cb.checked = true;

    var lb = d.createElement("label");
    lb.htmlFor = id;

    var tx = d.createTextNode(text);
    lb.appendChild( tx );

    dv.appendChild(cb);
    dv.appendChild(lb);
    container.appendChild(dv);
    return cb;
}
function ccreateTextBox(container, id, def, text, title, size, left )
{
    left += 2;
    var dv = d.createElement("div");
    dv.style.padding = "2px";
    dv.style.paddingLeft= left + "px";
    dv.title = title;
    var tb = d.createElement("input");
    tb.type = "text";
    tb.id = id;
    tb.value = def;
    tb.size = size;

    var tx = d.createTextNode(text);
    tx.title = title;

    dv.appendChild(tx);
    dv.appendChild(tb);
    container.appendChild(dv);
    return tb;
}

function ccreateComboBox(container, id, sels, def, text, title, left )
{
    left += 2;
    var dv = d.createElement("div");
    dv.style.padding = "2px";
    dv.style.paddingLeft= left + "px";
    dv.title = title;
    var sel = d.createElement("select");
    sel.id = id;
    for(var i=0; i<sels.length; i++){
        var opt = d.createElement("option");
        opt.value = sels[i];
        opt.appendChild(d.createTextNode(sels[i]));
        sel.appendChild(opt);
    }
    if( def ) sel.value = def;

    var tx = d.createTextNode(text);
    tx.title = title;

    dv.appendChild(tx);
    dv.appendChild(sel);
    container.appendChild(dv);
    return sel;
}

function ccreateButton(container, text, title, func)
{
    var btn = d.createElement("input");
    btn.style.padding = "1px";
    btn.type = "button";
    btn.value = text;
    btn.title = title;
    container.appendChild(d.createTextNode(" "));
    container.appendChild(btn);
    container.appendChild(d.createTextNode(" "));
    $e(btn, "click", func);
    return btn;
}

function cgetCheckBoxValue(id)
{
    var c = $(id);
    if( !c ) return 0;
    if( !c.checked ) return 0;
    return 1;
}

function cgetTextBoxValue(id)
{
    var c = $(id);
    if( !c ) return "";
    return c.value;
}

function ccreateSideBox(id, img, title)	//faraway110523　メモ機能や領地リンクが1つだとＣＰを購入する辺り（右上）に重なって表示される
{
    var icon_box = 'data:image/gif;base64,'+
        'R0lGODlhCwALAJEAAP///zMzM////wAAACH5BAUUAAIALAAAAAALAAsAAAIVjI8Gy6z5AoAyplkh'+
        'xteiTW1NQyUFADs=';

    var conf = cloadData( id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
    var elm_box = d.createElement("div");
    elm_box.id = id;
    elm_box.className = "sideBox";
    var elm_boxHead = d.createElement("div");
    elm_boxHead.className = "sideBoxHead";
    elm_box.appendChild(elm_boxHead);

    if (isNarrow) {
        elm_box.style.cssFloat = "left";
        elm_box.style.marginLeft = "10px";
    }

    var elm_h3 = d.createElement("h3");

    var elm_strong = d.createElement("strong");

    var elm_img = d.createElement("img");
    elm_img.src = img;
    elm_strong.appendChild(elm_img);
    elm_strong.appendChild(d.createTextNode(title));

    var elm_span=d.createElement("span");
    elm_span.className = "beyond_panel_ctlbox";
    var elm_img_up = d.createElement("img");
    elm_img_up.src= IMG_DIR + "trade/icon_up.gif";
    elm_img_up.title = "パネルを上に";
    elm_img_up.id = id + "up";
    var elm_img_down = d.createElement("img");
    elm_img_down.src= IMG_DIR + "trade/icon_down.gif";
    elm_img_down.title = "パネルを下に";
    elm_img_down.id = id + "down";
    var elm_img_box = d.createElement("img");
    elm_img_box.src= icon_box;
    elm_img_box.title = "フローティング/ドッキングの切り替え";
    elm_span.appendChild(elm_img_up);
    elm_span.appendChild(elm_img_box);
    elm_span.appendChild(elm_img_down);

    elm_strong.appendChild(elm_span);
    elm_h3.appendChild(elm_strong);
    elm_boxHead.appendChild(elm_h3);

    var elm_boxInner = d.createElement("div");
    elm_boxInner.className = "sideBoxInner";
    if( !conf.open ) {
        elm_boxInner.style.display = "none";
        elm_img.style.opacity = 0.3;
    }
    elm_box.appendChild(elm_boxInner);

    $e(elm_img, "click", function(){
        var sidebox = $(id);
        var op = false;
        if( !sidebox ) return;
        var inner = $x('.//div[contains(@class,"sideBoxInner")]', sidebox);
        if( !inner ) return;
        if( inner.style.display == "none" ){
            inner.style.display = "";
            this.style.opacity = 1;
            op = true;
        }else{
            inner.style.display = "none";
            this.style.opacity = 0.3;
        }

        var conf = cloadData( id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
        conf.open = op;
        csaveData( id + "conf", conf, true, true );
    } );

    $e(elm_img_up, "click", function(){
        var sidebox = $(id);
        if( sidebox.parentNode.id != "beyond_fixpanel" ) return;
        var target = sidebox.previousSibling;
        if( !target ) return;
        sidebox.parentNode.removeChild(sidebox);
        target.parentNode.insertBefore(sidebox, target);
        crenumberSideBox();
    });

    $e(elm_img_down, "click", function(){
        var sidebox = $(id);
        if( sidebox.parentNode.id != "beyond_fixpanel" ) return;
        var target = sidebox.nextSibling;
        if( !target ) return;
        sidebox.parentNode.removeChild(sidebox);
        target.parentNode.insertBefore(sidebox, target.nextSibling);
        crenumberSideBox();
    });

    $e(elm_img_box, "click", function(){
        var sidebox = $(id);
        if( !sidebox ) return;

        var conf = cloadData( id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );

        if( sidebox.parentNode.id == "beyond_fixpanel" ) {
            if( isNaN(""+conf.x) || conf.x == "" || isNaN(""+conf.y) || conf.y == "" ) {
                var xy = cgetElementXY(sidebox);
                conf.x = xy.x;
                conf.y = xy.y;

            }

            var cx = d.body.clientWidth;
            var cy = d.body.clientHeight;
            var eW = elm_box.clientWidth;
            var eH = elm_box.clientHeight;

            elm_box.style.left = conf.x + "px";
            elm_box.style.top = conf.y + "px";

            if ((conf.x + eW) <= 0) {
                elm_box.style.left = "0px";
            }
            else if (cx <= conf.x ) {
                elm_box.style.left = (cx - eW) + "px";
            }
            if ((conf.y + eH) <= 0) {
                elm_box.style.top = "0px";
            }
            else if (cy <= conf.y) {
                elm_box.style.top = (cy - eH) + "px";
            }

            sidebox.parentNode.removeChild(sidebox);
            $("beyond_floatpanel").appendChild(sidebox);
            sidebox.style.position = "absolute";
            sidebox.style.top = conf.y + "px";
            sidebox.style.left = conf.x + "px";
            sidebox.style.zIndex = 1000;
            conf.float = true;
            $(id + "up").style.display = "none";
            $(id + "down").style.display = "none";
        }else {
            sidebox.parentNode.removeChild(sidebox);
            $("beyond_fixpanel").appendChild(sidebox);
            sidebox.style.position = "";
            sidebox.style.top = "";
            sidebox.style.left = "";
            sidebox.style.backgroundColor = "";
            sidebox.style.border = "";
            sidebox.style.zIndex = "";
            conf.float = false;
            $(id + "up").style.display = "";
            $(id + "down").style.display = "";
            csortSideBox();
        }
        csaveData( id + "conf", conf, true, true );
		SetPositionBox(id, title, elm_box, 1);	//faraway110526
  } );


    var movedNode = null;
    var currentZIndex = 0;

    $e(elm_boxHead, "mousedown", function(event){
        movedNode = $(id);
        if( movedNode.parentNode.id != "beyond_floatpanel" ) return true;

        g_MD = id;
        g_MX = event.pageX-parseInt(movedNode.style.left,10);
        g_MY = event.pageY-parseInt(movedNode.style.top,10);
        currentZIndex = document.defaultView.getComputedStyle(movedNode, '').zIndex;
        movedNode.style.zIndex = 9999;
        if (navigator.userAgent.toLowerCase().indexOf('chrome') == -1) {
            event.preventDefault();
        }

        conf = cloadData( id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
    });
    $e(d, "mousemove", function(event){
        if(g_MD != id) return true;
        if( movedNode.parentNode.id != "beyond_floatpanel" ) return true;

        var x = event.pageX - g_MX;
        var y = event.pageY - g_MY;
        movedNode.style.left = x + "px";
        movedNode.style.top = y + "px";

        conf.x = x;
        conf.y = y;

    });
    $e(d, "mouseup", function(event){
        if(g_MD != id) return true;

        g_MD = "";
        movedNode.style.zIndex = currentZIndex;
        movedNode = null;

        csaveData( id + "conf", conf, true, true );
    });


    if( conf.float && !(isNaN(""+conf.x) || isNaN(""+conf.y))) {
        elm_box.style.position = "absolute";
        elm_box.style.zIndex = 1000;
        elm_img_up.style.display = "none";
        elm_img_down.style.display = "none";
        $("beyond_floatpanel").appendChild(elm_box);

        var cx = d.body.clientWidth;
        var cy = d.body.clientHeight;
        var eW = elm_box.clientWidth;
        var eH = elm_box.clientHeight;

        elm_box.style.left = conf.x + "px";
        elm_box.style.top = conf.y + "px";

        if ((conf.x + eW) <= 0) {
            elm_box.style.left = "0px";
        }
        else if (cx <= conf.x ) {
            elm_box.style.left = (cx - eW) + "px";
        }
        if ((conf.y + eH) <= 0) {
            elm_box.style.top = "0px";
        }
        else if (cy <= conf.y) {
            elm_box.style.top = (cy - eH) + "px";
        }

    } else {
		SetPositionBox(id, title, elm_box, 0);	//faraway110525
		//alert("id="+id+" elm_box.style.left=" + elm_box.style.left + " elm_box.style.top=" + elm_box.style.top);//faraway110524
        $("beyond_fixpanel").appendChild(elm_box);
    }

    return {"sideBox":elm_box, "sideBoxHead":elm_boxHead, "sideBoxInner":elm_boxInner };

}
function SetPositionBox(id, title, elm_box, dat)	//faraway110525
{
	//alert("SetPositionBox id="+id+" title="+title+" elm_box="+elm_box);
	var ccnt = 0 - dat;

    if(OPT_STYLE == 0) return;		//スタイル変更

    if(OPT_MEMO	== 1){				//メモ機能
		ccnt = OPT_MEMO_COUNT;
	    if(OPT_MEMO_COUNT == 1){	//メモ数(1～5)"
		}
	}

	if(OPT_TIMER_LINK_DEPOT == 1 ){	//ブラ三タイマー格納機能
		ccnt++;
	}

	if(OPT_MAPLINK == 1){			//領地リンク機能
		ccnt++;
	}

	if(OPT_REMOVELIST == 1){		//破棄中の領地表示（領地レベル表示）
		ccnt++;
	}

	if( OPT_SUZAN_SEISAN == 1){		//拠点生産量表示
		ccnt++;
	}

	if( ccnt <= 1){	
		if(id == "beyond_sidebox_villageListBox"){//拠点
			//alert("拠点 ccnt="+ccnt);
        	elm_box.style.position = "absolute";
        	elm_box.style.top = "311px";		
        	elm_box.style.left = "761px";		
        	elm_box.style.zIndex = 1000;		
		}
	}

	if( ccnt <= 1){	

		if(OPT_TIMER_LINK_DEPOT == 1 ){	//ブラ三タイマー格納機能
			if(id == "beyond_sidebox_timerOpenLinkconf"){		//タイマ
				SetPositionBoxSub(elm_box);
			}
		}

    	if(OPT_MEMO	== 1){				//メモ機能"
			if(id.match("beyond_sidebox_memo")){		//メモ
				//alert(id);
				SetPositionBoxSub(elm_box);
			}
		}

		if(OPT_MAPLINK == 1){			//領地リンク機能"
			if(id == "beyond_sidebox_xylink"){		//領地/君主ﾘﾝｸ
				SetPositionBoxSub(elm_box);
			}
		}

		if(OPT_REMOVELIST ==1){//破棄中の領地表示（領地レベル表示）
			if(id == "beyond_sidebox_removelist"){	//建設/破棄ﾘｽﾄ
				SetPositionBoxSub(elm_box);
			}
		}
	
		if( OPT_SUZAN_SEISAN == 1){		//拠点生産量表示
			if(id == "beyond_sidebox_suzanseisan"){	//拠点生産
				SetPositionBoxSub(elm_box);
			}
		}

	}
}
function SetPositionBoxSub(elm_box){	//faraway110525
	elm_box.style.position = "absolute";
	elm_box.style.top = "411px";		
    elm_box.style.left = "761px";		
    elm_box.style.zIndex = 1000;		
}

function csortSideBox()
{
    var sideboxes = $a("//div[@id=\"beyond_fixpanel\"]/div[@class=\"sideBox\"]");
    var srt = new Array();
    for(var i=0 ; i<sideboxes.length ; i++) {
        var pos = 0;

        var conf = cloadData( sideboxes[i].id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
        pos = conf.pos;
        srt.push({"node":sideboxes[i], "pos":pos});
    }

    srt.sort( function(a,b) {return a.pos - b.pos;});

    for(var i=0 ; i<srt.length ; i++){
        srt[i].node.parentNode.removeChild(srt[i].node);
    }
    var fixpanel = $("beyond_fixpanel");
    for(var i=0 ; i<srt.length ; i++){
        fixpanel.appendChild(srt[i].node);
    }
}

function crenumberSideBox()
{
    var sideboxes = $a("//div[@id=\"beyond_fixpanel\"]/div[@class=\"sideBox\"]");

    for(var i=0 ; i<sideboxes.length ; i++) {
        var conf = cloadData( sideboxes[i].id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
        conf.pos = i;
        csaveData( sideboxes[i].id + "conf", conf, true, true );

    }
}

function cappendColumnForProfile(title, id)
{
    var tds = $a('//table[@class="commonTables"]//th[contains(text(),"座標")]/../preceding-sibling::tr/*[contains("tdTDthTH",name())][last()]');
    for(var i=0 ; i<tds.length ; i++) {
        tds[i].colSpan++;
    }

    var tr = $x('//table[@class="commonTables"]//th[contains(text(),"座標")]/..');
    var th = d.createElement("th");
    th.className = "ttl4";
    th.id = id + "_title";
    th.appendChild( d.createTextNode( title ) );
    tr.appendChild( th );

    var trs = $a('//table[@class="commonTables"]//th[contains(text(),"座標")]/../following-sibling::tr');
    for(var i=0 ; i<trs.length ; i++) {
        var xytd = trs[i].childNodes[3];
        if( !xytd ) continue;
        var xy = xytd.innerHTML.match(/([\-0-9]+),([\-0-9]+)/);
        if( !xy ) continue;

        var td = d.createElement("td");
        td.id = id + "_" + xy[1] + "_" + xy[2];
        trs[i].appendChild(td);

        var pstd = trs[i].childNodes[5];
        if( !pstd ) continue;
        if( pstd.innerHTML != "&nbsp;" ) {
            td.textContent = "-";
        }
    }
}

function csetUserStar(uid, x, y, star, wood, stone, iron, rice, npc)
{
    var userlists = cloadData( "UserStarUserList", "[]", true, true );
    if( userlists.indexOf(uid) == -1 ) {
        userlists.push(uid);
        csaveData( "UserStarUserList", userlists, true, true );
    }

    var lists = cloadData( "UserStarList" + uid, "[]", true, true );

    for(var i=0 ; i<lists.length ; i++) {
        if( lists[i].x == x && lists[i].y == y ) {
            return;
        }
    }
    lists.push({"star":star, "x":x, "y":y, "wood":wood, "stone":stone, "iron":iron, "rice":rice, "npc":npc });
    csaveData( "UserStarList" + uid, lists, true, true );
}

function cresetUserStar()
{
    var userlists = cloadData( "UserStarUserList", "[]", true, true );

    for(var i=0 ; i<userlists.length ; i++) {
        cdelData( "UserStarList" + userlists[i], true );
    }
    cdelData( "UserStarUserList", true );
}

function csetMyLevel(x, y, level)
{
    var lists = cloadData( "MyLevelList", "[]", true, true );

    var ins = true;
    for(var i=0 ; i<lists.length ; i++) {
        if( lists[i].x == x && lists[i].y == y ) {
            if( level == -1 ) {
                lists[i].level++;
            }else{
                lists[i].level = level;
            }
            ins = false;
            break;
        }
    }
    if( ins && level != -1) {
        lists.push({"x":x, "y":y, "level":level});
    }
    csaveData( "MyLevelList", lists, true, true );
}
function cdelMyLevel(x, y)
{
    var lists = cloadData( "MyLevelList", "[]", true, true );

    for(var i=0 ; i<lists.length ; i++) {
        if( lists[i].x == x && lists[i].y == y ) {
            lists.splice(i,1);
            csaveData( "MyLevelList", lists, true, true );
            break;
        }
    }
}

function csaveData(key, value, local, ev)
{
    if( local ) key = location.hostname + key;
    if( ev ) {
        if (window.opera || typeof JSON != 'object') {
            value = toJSON(value);
        }
        else {
            value = JSON.stringify( value );
        }
    }
    GM_setValue(key, value );
}

function cloadData(key, value, local, ev)
{
    if( local ) key = location.hostname + key;
    var ret = GM_getValue(key, value);
    return ev ? eval('ret='+ret) : ret;
}

function cdelData(key, local )
{
    if( local ) key = location.hostname + key;
    GM_deleteValue( key );
}

//////////////////////////////////////////////////////////////////
//プレゼンツbｙピカチュウ関数群
//http://shigematsu.org/
//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
//////////////////////////////////////////////////////////////////
function Pika_blinkElements()
{
    // Drift-free blinking routine
    var opacity = Math.round((new Date() % 1000) / 1000);
    for (var i = 0; i < Pika_elementQueue.length; ++i) {
        Pika_elementQueue[i].style.opacity = opacity;
    }
    window.setTimeout(function() { Pika_blinkElements(); }, 500);
}

function Pika_updateYorozudasState() {
    var x = $a('//div[@class="sysMes"]/strong');
    if( x.length < 3 ) return;

    var nextUpdate = new Date(x[2].textContent.replace(/-/g, '/')).getTime();
    var info = {
        current:    +x[0].textContent,
        nextUpdate: nextUpdate,
        confirm:    nextUpdate - (24 * 60 * 60)
    };
    csaveData('yorozudas_state', info, true, true);
    Pika_displayYorozudasState();

/* 設定メニューでON/OFFできるのでここでON/OFFは必要ないかな
    var button  = d.createElement('input');
    with (button) {
        id      = 'beyond_yorozudas_notification';
        type    = 'checkbox';
        checked = cloadData('yorozudas_notification', false, true);
        addEventListener('click', function() {
            var state = $('beyond_yorozudas_notification').checked;
            csaveData('yorozudas_notification', state, true, true);
            Pika_displayYorozudasState();
        }, false);
    }
    var text    = d.createTextNode(' ヨロズダスの状態を通知する');
    var p       = d.createElement('p');
    var lb      = d.createElement("label");
    lb.htmlFor = button.id;
    lb.appendChild(text);
    with (p) {
        style.backgroundColor = '#aaaaaa';
        appendChild(button);
        appendChild(lb);
    }
    d.getElementsByClassName('sysMes')[0].appendChild(p);
*/
}
function Pika_updateYorozudasState2() { //result用を追加
    var x = $a('//div[@class="sysMes2"]/strong');
    if( x.length < 3 ) return;

    var nextUpdate = new Date(x[1].textContent.replace(/-/g, '/')).getTime();
    var info = {
        current:    +x[0].textContent,
        nextUpdate: nextUpdate,
        confirm:    nextUpdate - (24 * 60 * 60)
    };
    csaveData('yorozudas_state', info, true, true);
    Pika_displayYorozudasState();
}
function Pika_displayYorozudasState() {
    var xpath = '(id("sidebar")/ul/li | id("btn_area_box"))/a[contains(@href, "/busyodas/b3kuji.php")]/img';
    if (OPT_SMALLBTN) {
        xpath += '/..';
    }

    var img_yorozu = $x(xpath);
//設定メニューでON/OFFできるのでここでON/OFFは必要ないかな
//  var enabled = cloadData('yorozudas_notification', false, true);
//  if (enabled) {
        var info = cloadData('yorozudas_state', '{}', true, true);
        var now = new Date().getTime();
        if (info.nextUpdate < now) {
            Pika_elementQueue.push(img_yorozu);
        } else {
            if (info.current <= 0) {
                img_yorozu.style.opacity = 0.5;
            } else {
                if (info.confirm > 0
                 && info.confirm < now) {
                    if (confirm('ヨロズダスが引けますが、まだ引いていません。\n後でまた通知しますか?')) {
                        var delta = (info.nextUpdate - now) / 3600;
                        if (delta < 4) {
                            info.confirm += 1 * 60 * 60; // 1 hour later
                        } else if (delta < 8) {
                            info.confirm += 2 * 60 * 60; // 2 hours later
                        } else {
                            info.confirm += 4 * 60 * 60;
                        }
                    } else {
                        info.confirm = 0;
                    }
                    csaveData('yorozudas_state', info, true, true);
                }
            }
        }
//  } else {
//      img_yorozu.style.opacity = 1;
//  }
}

function Pika_displayRecoveryEstimates() {
    var
    candidates = $a('//*[@id="deck_file"]//*[div[@class="setPlace false"]]');
    for (var i = 0; i < candidates.length; ++i) {
        var level = + $x('*//*[starts-with(@class,"level_")]', candidates[i]).innerHTML;
//      var level = + candidates[i].getElementsByClassName('level')
//                      [0].textContent;
        var hp    = + candidates[i].getElementsByClassName('status_hp')
                        [0].textContent.toString().split(/[\/]/)[0];
        if (hp >= 100) continue;
//          var hours = (level * (100 - hp)) / 60;
        var hours = (level <= 5) ? Math.pow(2, level - 2) * (100 - hp) / 100 :
                        (level <= 10) ? 4 * (level - 3) * (100 - hp) / 100 :
                            (level + 20) * (100 - hp) / 100;

        var msg  = Pika_formatEstimate(hours, false) + 'にHP全回復';
        candidates[i].getElementsByClassName('setPlace false')[0].innerHTML = msg;
    }

    candidates = $a('//*[@id="deck_file"]//*[div[@class="control"]/dl/dd[contains(text(),"治療中")]]');
     for (var i = 0; i < candidates.length; ++i) {
        var level = + $x('*//*[starts-with(@class,"level_")]', candidates[i]).innerHTML;
//      var level = + candidates[i].getElementsByClassName('level')
//                      [0].textContent;
        var hp    = + candidates[i].getElementsByClassName('status_hp')
                        [0].textContent.toString().split(/[\/]/)[0];
        if (hp >= 100) continue;
//          var hours = (level * (100 - hp)) / 60;
        var hours = (level <= 5) ? Math.pow(2, level - 2) * (100 - hp) / 100 :
                        (level <= 10) ? 4 * (level - 3) * (100 - hp) / 100 :
                            (level + 20) * (100 - hp) / 100;
        var msg  = Pika_formatEstimate(hours, false) + '<br>にHP全回復';
        candidates[i].getElementsByTagName('dd')[2].innerHTML = msg;
        candidates[i].getElementsByTagName('dd')[2].style.fontSize = "10px";
        candidates[i].getElementsByTagName('dd')[2].style.margin = "0px";
    }

    window.setTimeout(function() { Pika_displayRecoveryEstimates(); }, 60*1000);
}
function Pika_formatEstimate(hours, displaySecs) {
    var msg   = '';
    var now   = new Date();
    var xday  = new Date(now.getTime() + hours * 60 * 60 * 1000);
    var days  = Math.floor(hours / 24);

    var delta = Math.floor(
        (
        new Date(xday.getYear(), xday.getMonth(), xday.getDate()) -
        new Date(now .getYear(), now .getMonth(), now .getDate())
        )
        / (24 * 60 * 60 * 1000));

    if (delta == 0) msg = '';
    else if (delta == 1) msg = '明日';
    else if (delta == 2) msg = '明後日';
    else msg = delta + '日後';

    msg += xday.getHours() + '時';
    msg += xday.getMinutes() + '分 ';

    if (days == 0) {
        var seconds = Math.floor((hours * 3600) % 60);
        var minutes = Math.floor((hours *   60) % 60);
        hours = Math.floor(hours);

        if (hours == 0) {
            if (displaySecs) {
                msg += '(' + minutes + '分' + seconds + '秒後) ';
            }
            else {
                msg += '(' + minutes + '分後) ';
            }
        }
        else {
            msg += '(' + hours+ '時間' + minutes +'分後) ';
        }
    }
    return msg;
}


function Pika_installMapXYHelper() {
    // http://javascript.g.hatena.ne.jp/emergent/20081122/1227329941
    // https://developer.mozilla.org/ja/XPCNativeWrapper
    // use event listener to set 'onlcick' functon

    if( location.pathname != '/map.php' ) return;

//	var btn = $x('//div[@id="mapXY"]//input[@type="submit"]');
	var btn = $x('//div[@id="map-xy-search"]//input[@type="submit"]');
    if( !btn ) return;
    btn.addEventListener('click',
            function() {
//				var xpath = '//div[@id="mapXY"]//input[@type="text"]';
				var xpath = '//div[@id="map-xy-search"]//input[@type="text"]';
                var xy = $a(xpath);
                var x  = xy[0].value.toString();

                if (x.match(/(-?\d+)[ .,&、](?:y=)?(-?\d+)/)) {
                    xy[0].value = RegExp.$1;
                    xy[1].value = RegExp.$2;
                }
            }, false);
}

function Pika_installTradeHelper() {

    if( location.pathname != '/card/trade.php' ) return;

    $('button')
        .addEventListener('click',
            function() {
                var element = $x('//div[@class="formSearch"]/select');
                var index = element.selectedIndex;
                if (index == 0 || index == 3) {
                    if ($('k').value.toString().match(/[1-4]\d{3}/)) {
                        element.selectedIndex = 2;
                    }
                }
            }, false);
}


function Pika_prepareForDisplayBuildStatus()
{
    var maps = $('maps');
    var xpath = 'img[contains(@src, "/img_lv0.gif")]/@class';
    var nodes = $a(xpath, maps);
    for (var i = 0; i < nodes.length; ++i) {
        var index = nodes[i].value.toString().substr(-2);
        var xpath = 'img[@class="map' + index +'" and contains(@src, "/facility_10")]';
        var isResourceProducingLot = $a(xpath, maps).length;
        if (!isResourceProducingLot) {
            $x('//img[@class="mapicon'+index+'"]').src =
                'data:image/gif;base64,'+
                'R0lGODlhFwAWAMQfADp1MxYsFzp7NEGdQTp7Nm2bac7dzebu5l6TWkWmRZ69nPL2'+
                '8kWAQLXNszuNO7/UvzV7NWqVZU6PTNrm2Y20i0apRj+WP1LOc0y7TDmDOSAgID+G'+
                'OShRLz9+N////////yH5BAEAAB8ALAAAAAAXABYAAAW74PdxZGmepShyV+u+sMut'+
                'WG3fOD5zVe8niYFQmPD5OBqOZcm0OCQUg4HiaC6RnIx2m4E8PGCPAsLNYDfoNAGx'+
                'OEgKYEYafZ5vCJODYN/wFOx1cwhiAhsCCh4IgEl2G3ANAJEGBwSLWWUMYBQRXwUE'+
                'XARYHaOkh2ELBQKkpKKrowARChQMAK6jrbaRkba3GiO8wKwaviMoHLwlwyofw83D'+
                'rs7Ky9MiqwEB1NnLpNfa3h+j3d/aHeLj2tjfIQA7';
        }
    }
}

function Pika_displayBuildStatus() {

    var xpath = 'id("actionLog")//li/span[@class="buildStatus" and contains(.,"建設")]/a';
    var nodes = $a(xpath);
    var facilities = {};
    for (var i = 0; i < nodes.length; ++i) {
        nodes[i].href.match(/x=(\d+)&y=(\d+)/);
        var x = parseInt(RegExp.$1,10);
        var y = parseInt(RegExp.$2,10);
        var index = (101 + x * 7 + y).toString().substr(-2);
        facilities[index] = index;
    }

    for (var index in facilities) {
        Pika_elementQueue.push(document.getElementsByClassName('map'+index)[0]);
        Pika_elementQueue.push(document.getElementsByClassName('mapicon'+index)[0]);
    }

    var deleting = $x('//*[@id="actionLog"]/ul/li[contains(text(), "削除中")]/span[@class="buildStatus"]/a');
    if (deleting && deleting.href.match(/x=(\d+)&y=(\d+)/)) {
        var x = +RegExp.$1;
        var y = +RegExp.$2;
        var index = (101 + x * 7 + y).toString().substr(-2);
        document.getElementsByClassName('map'+index)[0]
            .style.opacity = 0.5;
        document.getElementsByClassName('mapicon'+index)[0]
            .style.opacity = 0.5;
    }
}
//////////////////////////////////////////////////////////////////
//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑
//プレゼンツbｙピカチュウ関数群
//////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////
//プレゼンツbｙsu-zan関数群
//http://shigematsu.org/
//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
//////////////////////////////////////////////////////////////////
function Suzan_Seisan(inner)
{

    var yieldList = {
            other : [0,6,14,25,50,80,117,162,214,272,335,404,476,550,626,702],
            rice : [0,6,18,36,72,114,167,231,305,388,479,577,680,786,894,1003]
        };


    var yieldExtends = [
        {
            name : '水車',
            facility : {
                match : '畑',
                data : [0,0.03,0.06,0.09,0.12,0.15,0.18,0.21,0.24,0.27,0.3]
            },
            resource : {
                match : '穀物',
                data : [0,40,60,80,110,140,180,220,270,350,450]
            }
        },
        {
            name : '工場',
            facility : {
                match : '伐採所石切り場製鉄所',
                data : [0,0.03,0.05,0.08,0.1,0.13,0.15,0.18,0.2,0.23,0.25]
            },
            resource : {
                match : '森林岩山鉄鉱山',
                data : [0,55,65,75,95,115,145,185,235,300,380]
            }
        }
    ];

    var seisan = { w:0, s:0, i:0, r:0 };


    for (var i = 0; i < 2;i++) {
        var yieldExtend = yieldExtends[i];
        var yieldExtendArea = $x('//area[starts-with(@alt,"'+yieldExtend.name+'")]');
        if (!yieldExtendArea) {
            continue;
        }
        var yieldExtendAreaInfo = cgetFacilityInfoFromArea(yieldExtendArea);
        var yieldExtendResource = yieldExtend.resource.data[yieldExtendAreaInfo.lv];
        var yieldExtendFacility = yieldExtend.facility.data[yieldExtendAreaInfo.lv];

        var squreaAreas = cgetSquareElementFromArea(yieldExtendArea);
        for (var key in squreaAreas) {
            if (!squreaAreas[key]) {
                continue;
            }
            var squreaArea = squreaAreas[key];
            var squreaAreaInfo = cgetFacilityInfoFromArea(squreaArea);
            var dataKey = nameToDataKey(squreaAreaInfo.name);
            if (0 <= yieldExtend.resource.match.indexOf(squreaAreaInfo.name)) {
                seisan[dataKey] += yieldExtendResource;
            }
            else if (0 <= yieldExtend.facility.match.indexOf(squreaAreaInfo.name)) {
                seisan[dataKey] += Math.ceil(yieldExtendFacility * yieldList[getYieldKeyFromDataKey(dataKey)][squreaAreaInfo.lv]);
            }
        }
    }


    var areas = $a('//area[contains(@alt,"畑") or contains(@alt,"穀") or contains(@alt,"伐") or contains(@alt,"森") or contains(@alt,"石") or contains(@alt,"岩") or contains(@alt,"製") or contains(@alt,"鉱")]');
    for(var i=0; i<areas.length; i++){
        var areaInfo = cgetFacilityInfoFromArea(areas[i]);
        var dataKey = nameToDataKey(areaInfo.name);
        switch(areaInfo.name){
            case '森林':
            case '岩山':
            case '鉄鉱山':
            case '穀物':
                seisan[dataKey] += 10;
                break;
            case '伐採所':
            case '石切り場':
            case '製鉄所':
            case '畑':
                var yieldKey = getYieldKeyFromDataKey(dataKey);
                seisan[dataKey] += yieldList[yieldKey][areaInfo.lv];
                break;
        }
    }

    var text = '<ul>';
    text += '<li><img align="middle" alt="木" src="' + IMG_DIR + 'common/ico_wood2.gif"> 木  ' + seisan.w + '</li>';
    text += '<li><img align="middle" alt="石" src="' + IMG_DIR + 'common/ico_stone2.gif"> 石  ' + seisan.s + '</li>';
    text += '<li><img align="middle" alt="鉄" src="' + IMG_DIR + 'common/ico_iron2.gif"> 鉄  ' + seisan.i + '</li>';
    text += '<li><img align="middle" alt="糧" src="' + IMG_DIR + 'common/ico_lice2.gif"> 糧  ' + seisan.r + '</li>';
    text += '<li>　合計 ' + (seisan.w+seisan.s+seisan.i+seisan.r) +'</li></ul>';
    inner.innerHTML = text;

    function getYieldKeyFromDataKey(dataKey) {
        var ret = 'other';
        if (dataKey == 'r') {
            ret = 'rice';
        }
        return ret;
    }

    function nameToDataKey(name) {
        switch(name){
            case '森林':
            case '伐採所':
                return "w";
            case '岩山':
            case '石切り場':
                return "s";
            case '鉄鉱山':
            case '製鉄所':
                return "i";
            case '穀物':
            case '畑':
                return "r";
        }
    }
}
//////////////////////////////////////////////////////////////////
//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑
//プレゼンツbｙsu-zan関数群
//////////////////////////////////////////////////////////////////


function disp_castleAidLink()
{
    var bases = $a('(id("lodgment")/div[@class="floatInner"] | //div[@class="floatInner clearfix"] | //div[@class="sideBoxInner basename"])//li/*[@title]');
    if( !bases ) return;

    for( var i=0 ; i < bases.length ; i++) {
        var elem = bases[i];
        var thistitle = elem.title;
        if( !thistitle ) continue;
        var xy = thistitle.match(/\((-?\d+),(-?\d+)\)$/);
        if( !xy ) continue;

        var a_k_img = d.createElement("img");
        a_k_img.style.paddingLeft = "3px";
        a_k_img.style.paddingTop = "3px";
        a_k_img.src = img_ken;

        var a_k = d.createElement("a");
        a_k.title = "援軍";
        a_k.appendChild(a_k_img);

        if( elem.href ) {
            a_k.href = caddSessionId("/facility/castle_send_troop.php?x="+xy[1]+"&y="+xy[2]+"&radio_move_type=301");
            a_k.style.visibility = 'visible';
        } else {
            a_k.style.visibility = 'hidden';
        }

        var spn = cgetElementSibling(elem,0);
        if (!spn) {
            spn = d.createElement("span");
            elem.parentNode.appendChild(spn);
        }

        spn.appendChild(a_k);
    }
}

function disp_nextFameTimer() {
    var nextDate = new Date(cloadData("NextFameTime",null,true,true));
    var preCheckTime = new Date(cloadData("NextFamePreCheckTime",null,true,true));
    nextDate = loadNextDate();
    var seps = $a('id("status_left")/span[@class="sep"]');
    for (var i = 0; i < seps.length;i++) {
        seps[i].innerHTML = seps[i].innerHTML.replace(/^([\s|\u3000]*)|([\s|\u3000]*)$/g,"");
    }

    var img = $x('id("status_left")/img[@title="名声"]');
    var fameTimer = document.createElement('DIV');
    fameTimer.setAttribute("id","Beyond_nextFameTimer");
    fameTimer.appendChild(createTimerText(getTimeDiffNow(nextDate)));
    fameTimer.style.color = 'lightgreen';
    fameTimer.style.position = 'absolute';
    fameTimer.style.top = (img.offsetTop + 12) + "px";
//110620    fameTimer.style.top = "17px";//faraway110601 名声獲得タイマー表示位置固定//faraway110616
    fameTimer.style.left = (img.offsetLeft + 10) + "px";
//110620    fameTimer.style.left = "502px";//位置ずれるため17に固定faraway110601 名声獲得タイマー表示位置固定//faraway110616

    img.parentNode.appendChild(fameTimer);

    var timerId = setInterval(function(){
        fameTimer.style.top = (img.offsetTop + 12) + "px";
        fameTimer.style.left = (img.offsetLeft + 10) + "px";
        fameTimer.replaceChild(createTimerText(getTimeDiffNow(loadNextDate())), fameTimer.firstChild);
    },1000);

    function createTimerText(date) {
        return document.createTextNode("("+date.toLocaleTimeString().replace(/^0?/,"")+")");
    }
    function getTimeDiffNow(date) {
        var now = cgetNow();
        var oldDate = now, newDate = date;
        if (date.getTime() < now.getTime()) {
            return new Date(1970,1,1,0,0,0);
        }
        return new Date(1970,1,1,0,0,0,newDate.getTime() - oldDate.getTime());
    }

    var nextFameDateCheckErrorCount = 0;
    var nextFameRefreshCount = 0;
    function loadNextDate() {

        var nowDate = new Date();
        var isNextFameDateOver = false;
        if (nextDate.getTime() < nowDate.getTime()) {
            isNextFameDateOver = true;
        }

        var isPreCheckDateOver = false;
        if (preCheckTime.getTime() < (nowDate.getTime() - 1800000)) {
            isPreCheckDateOver = true;
        }

        if (5 < nextFameDateCheckErrorCount) {
            if (isNextFameDateOver) {
                clearInterval(timerId);
            }
            return nextDate;
        }

        if ((isPreCheckDateOver || isNextFameDateOver) && nextFameRefreshCount === 0) {
            nextFameTimeRefresher();
        }

        return nextDate;

        function nextFameTimeRefresher() {
            cajaxRequest("/facility/castle.php" , "GET", "", function(req) {
                var dom = d.createElement("html");
                dom.innerHTML = req.responseText;
                var nextFameNode = $x('.//div[@id="gray02Wrapper"]/table[contains(concat(" ",normalize-space(@class)," ")," commonTables ") and @summary="object"]//td[contains(concat(" ",normalize-space(@class)," ")," center ") and not(@colspan)]/div[not(@class)]',dom);
                if (!nextFameNode) {
                    nextFameDateCheckErrorCount++;
                    return;
                }

                var matches = null;
                if (!(matches = nextFameNode.innerHTML.match(/\d+-\d+-\d+\s\d+:\d+/))) {
                    nextFameDateCheckErrorCount++;
                    return;
                }

                var tmpDate = new Date(matches[0].replace(/-/g,"/")+":00");
                if (isPreCheckDateOver == false && nextDate.getTime() == tmpDate.getTime()) {
                    if (12 <= nextFameRefreshCount) {
                        clearInterval(timerId);
                    }
                    else {
                        nextFameRefreshCount++;
                        setTimeout(nextFameRefresher,5000);
                    }
                    return;
                }
                else if (!(nextDate.getTime() == tmpDate.getTime())) {
                    nextDate = tmpDate;
                    if (cloadData("NextFameTime",null,true,true)) {
                        var fameText = $x('id("status_left")//img[@title="名声"]').nextSibling;
                        matches = fameText.nodeValue.match(/(\d+)[^\d]*(\d+)/);
                        fameText.nodeValue = fameText.nodeValue.replace(/\d+[^\d]*\d+/,(parseInt(matches[1],10)+1) + " / " + (parseInt(matches[2],10)+1));
                    }

                    csaveData("NextFameTime",nextDate.toString(),true,true);
                }

                nextFameRefreshCount = 0;
                preCheckTime = new Date();
                csaveData("NextFamePreCheckTime",preCheckTime.toString(),true,true);
            },
            function() {
                nextFameDateCheckErrorCount++;
            });
        }
    }
}

function disp_timerLinkDepot() { // ブラ三タイマー機能 START **************************************************************************************************


var TIMER_VERSION = "1.37";
var DIST_URL = "http://blog.livedoor.jp/froo/archives/51423697.html";
var LOCAL_STORAGE_TIMER = "bro3_timer";

var DELIMIT1 = "#$%";
var DELIMIT2 = "&?@";
var DELIMIT3 = "{=]";
var DELIMIT4 = "|-/";

//保存データインデックス（拠点）
var IDX_XY = 0; //座標
var IDX_BASE_NAME = 1; //拠点名
var IDX_URL = 2; //拠点URL
var IDX_ACTIONS = 3; //実行中作業

//保存データインデックス（実行中作業）
var IDX2_STATUS = 0; //ステータス
var IDX2_TIME = 1; //完了時刻
var IDX2_TYPE = 2; //作業種別
var IDX2_ALERTED = 3; //通知済フラグ

//作業種別
var TYPE_CONSTRUCTION = "C"; //建設
var TYPE_MARCH = "M"; //行軍
var TYPE_DOMESTIC = "D"; //内政
var TYPE_FACILITY = "F"; //施設

//通知モード
var NOTICE_MODE_POPUP = ""; //ポップアップ
var NOTICE_MODE_ALERT = "1"; //アラート
var NOTICE_MODE_NONE = "2"; //通知なし

//表示モード
var DISP_MODE_PUSH = ""; //通知あり
var DISP_MODE_PULL = "1"; //通知なし
var DISP_MODE_NONE = "2"; //表示なし

//グローバル変数
var MOUSE_DRAGGING = false;
var MOUSE_OFFSET_X;
var MOUSE_OFFSET_Y;
var ALERT_TIME;


    var timerIcon = 'data:image/gif;base64,'+
                'R0lGODlhEAAQANUAACAcHfDx8enp6oCAg8jJyoSGiZCSlNDR0YuNkGlrbXh5e46Qkh8aG+Dg4Xx9'+
                'gIiKjDMwMfj5+XBxc9jZ2ZiYmWFhY1hYWrO0tMXFxt/g4ENCRHV2efjq6Li5up6eoKKjpPf4+CUh'+
                'InJXV1FOTyMfIU5MTTg0NUE+Pzs4OTMvMEpHSCgkJUhFRtHGxc7HyLe4ub/AwefX1tjT09bJyOHY'+
                '2Kumpu7x8W5vcV5eYGdoaoeJjL+cm/rw7/bn5QAAAAAAACH5BAEAAD4ALAAAAAAQABAAAAawwMLg'+
                'gVgsDEaD0oAYWgrEpmMwmBYRj0piINwYMAQXwaMY6AqSikIhuRwatFmgQVA4HDmcJEERBAI8HBEB'+
                'ES83GxUWCRIEGIQcPSARDQcFCRYQGgV+DTAtMX8BAh8aEAAABQR+HiI7Nn8HHyGnDAoCAhcDNTKh'+
                'AhSnAAwjEx0HAiChExMJDMArFBm3vbimwAAoHdECDQIHBCXWwBADBN4HBifh4SksKiYk6uoMzfH1'+
                '8UEAOw==';
    var sidboxId = 'beyond_sidebox_timerOpenLinkconf';
    var timeId = null;

    timeId = setInterval(function(){
        var doc = $x('id("timerOpenLink")/..');
        if (!doc) return;

        clearInterval(timeId);
        doc.style.display = 'none';

        var img = $x('.//img',doc);
        if (img) {
            timerIcon = img.src;
        }

        var box = ccreateSideBox(sidboxId,timerIcon,"タイマーボタン");
        var adoc = d.createElement("a");
        adoc.href = "javascript:void(0);";
        adoc.innerHTML = "タイマー表示";
        adoc.addEventListener("click", function() {
            var doc = $x('id("timerOpenLink")');
            if (!doc) return;
            var event = d.createEvent( "MouseEvents" );
            event.initEvent( "click", false, true );
            doc.dispatchEvent( event );
        }, true);
        box.sideBoxInner.appendChild(adoc);

        var conf = cloadData( sidboxId + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
        cinsertSideBox(conf.pos,box);
    },100);

    setTimeout(function(){clearInterval(timeId);},500);




//main
(function(){
	
	//mixi鯖障害回避用: 広告iframe内で呼び出されたら無視
	if (!document.getElementById("container")) return;
	
	initGMWrapper();
	setHost();
	
	//都市画面なら実行中作業を取得
	if (location.pathname == "/village.php") {
		getVillageActions();
	}
	
	//君主プロフィール画面なら都市画面URLを取得
	if ((location.pathname == "/user/" || location.pathname == "/user/index.php") &&
		getParameter("user_id") == "") {
		getUserProf();
	}
	
	//内政設定画面なら使用中スキルを取得
	if (location.pathname == "/card/domestic_setting.php") {
		getDomesticSkill();
	}
	
	//兵士作成画面なら作成中兵士を取得
	if (location.pathname == "/facility/facility.php") {
		getTrainingSoldier();
	}
	
	//リンクHTML追加
	addOpenLinkHtml();
	
	//アラート登録
	window.setTimeout(function() {
		updateTimer();
	}, 0);
})();

//サーバ登録
function setHost() {
	var hosts = loadHosts();
	for (var i = 0; i < hosts.length; i++) {
		if (hosts[i] == location.hostname) return;
	}
	hosts[i] = location.hostname;
	
	saveHosts(hosts);
}

//拠点の作業中情報を取得
function getVillageActions() {
	var data = new Array();
	
	//拠点名を取得
	var baseNameElem = document.evaluate(
		'//*[@id="basepoint"]/span[@class="basename"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	data[IDX_BASE_NAME] = trim(baseNameElem.snapshotItem(0).innerHTML);
	
	//座標を取得
	var xyElem = document.evaluate('//*[@id="basepoint"]/span[@class="xy"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	data[IDX_XY] = trim(xyElem.snapshotItem(0).innerHTML);
	
	//建設情報を取得
	var actionsElem = document.evaluate('//*[@id="actionLog"]/ul/li',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var actions1 = new Array();
	for (var i = 0; i < actionsElem.snapshotLength; i++) {
		var paItem = actionsElem.snapshotItem(i);
		var newAction = new Array();
		newAction[IDX2_TYPE] = TYPE_CONSTRUCTION;
		
		//ステータス
		var buildStatusElem = document.evaluate('./span[@class="buildStatus"]/a',
			paItem, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var buildStatus;
		if (buildStatusElem.snapshotLength > 0) {
			//施設建設
			buildStatus = "建設:" + trim(buildStatusElem.snapshotItem(0).innerHTML);
		} else {
			//研究
//			buildStatusElem = document.evaluate('./span[@class="buildStatus"]',
//				paItem, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
//			buildStatus = buildStatusElem.snapshotItem(0).innerHTML;
			continue;
		}
		newAction[IDX2_STATUS] = buildStatus;
		
//		var buildTimeElem = document.evaluate('./span[@class="buildTime"]',
//			paItem, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
//		newAction[IDX2_STATUS] += buildTimeElem.snapshotItem(0).innerHTML;
		
		//施設建設完了時刻
		var buildClockElem = document.evaluate('./span[@class="buildClock"]',
			paItem, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var clock = buildClockElem.snapshotItem(0).innerHTML;
		newAction[IDX2_TIME] = generateDateString(computeTime(clock));
		
		actions1.push(newAction);
	}
	
	//建設情報を永続保存
	data[IDX_ACTIONS] = actions1;
	saveVillage(data, TYPE_CONSTRUCTION);
	
	//行軍情報を取得
	var actionsElem = document.evaluate(
		'//*[@id="action"]/div[@class="floatInner"]/ul/li',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var actions2 = new Array();
	for (var i = 0; i < actionsElem.snapshotLength; i++) {
		var paItem = actionsElem.snapshotItem(i);
		var newAction = new Array();
		newAction[IDX2_TYPE] = TYPE_MARCH;
		
		//ステータス
		var statusElem = document.evaluate('./a',
			paItem, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var status = trim(statusElem.snapshotItem(0).innerHTML);
		newAction[IDX2_STATUS] = "行軍:" + status;
		
		//完了時刻
		var buildClockElem = document.evaluate('./span',
			paItem, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var clock = buildClockElem.snapshotItem(0).innerHTML;
		newAction[IDX2_TIME] = generateDateString(computeTime(clock));
		
		actions2.push(newAction);
	}
	
	//行軍情報を永続保存
	data[IDX_ACTIONS] = actions2;
	saveVillage(data, TYPE_MARCH);
}

//拠点情報を保存
function saveVillage(newData, type) {
	var allData = loadVillages(location.hostname);
	
	//新旧データをマージ
	var exists = false;
	for (var i = 0; i < allData.length; i++) {
		var villageData = allData[i];
		
		//作業リスト更新
		if (villageData[IDX_XY] == newData[IDX_XY]) {
			exists = true;
			villageData[IDX_BASE_NAME] = newData[IDX_BASE_NAME];
			
			var actions = villageData[IDX_ACTIONS];
			for (var j = actions.length - 1; j >= 0; j--) {
				if (actions[j][IDX2_TYPE] != type) continue;
				var endTime = new Date(actions[j][IDX2_TIME]);
				var nowTime = new Date();
				if (isNaN(endTime.valueOf()) || endTime > nowTime) actions.splice(j, 1);
			}
			villageData[IDX_ACTIONS] = actions.concat(newData[IDX_ACTIONS]);
		}
		
		allData[i] = villageData;
	}
	if (!exists) allData.push(newData);
	
	//Greasemonkey領域へ永続保存
	saveVillages(location.hostname, allData);
}

//ユーザプロフィール画面の拠点情報を取得
function getUserProf() {
	var oldVillages = loadVillages(location.hostname);
	var newVillages = new Array();

	var landElems = document.evaluate(
		'//*[@id="gray02Wrapper"]//table',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var src=landElems.snapshotItem(0).innerHTML.replace(/\t/g,"").split("</tr>\n");

	var flag_honkyo=0;
	for(i in src){
		src[i] =src[i].replace(/\n/g,"")
		//本拠地という文字列がでてくるまでスキップ
		if(flag_honkyo==0 && src[i].match(/.*本拠地.*/)){flag_honkyo=1;}
		if(flag_honkyo==0) continue;

		//本拠地以降の行はこっから
		if(src[i].match(/<tr><td[^>]*><a href="([^"]*)">([^<]*)<\/a>[^<]*<\/td><td.*>(-?[0-9]+,-?[0-9]+).*<\/td><td.*>([0-9]*)<\/td>/)) {
//		alert("拠点URL："+RegExp.$1+"\n拠点名："+RegExp.$2+"\n拠点座標："+RegExp.$3+"\n人口："+RegExp.$4+"\n");
			//名前項目を取得
			var name = RegExp.$2;
			var url  = RegExp.$1;
			//座標項目を取得
			var xy = "(" + RegExp.$3 + ")";
			//人口項目を取得
			var popul = RegExp.$4;
			//データマージ
			var newVil = new Array();
			newVil[IDX_ACTIONS] = new Array();
			for (var j = 0; j < oldVillages.length; j++) {
				if (xy == oldVillages[j][IDX_XY]) {
					newVil = oldVillages[j];
				}
			}
			newVil[IDX_XY] = xy;
			newVil[IDX_BASE_NAME] = name;
			newVil[IDX_URL] = url;
			newVillages.push(newVil);
		}
	}
	//保存
	saveVillages(location.hostname, newVillages);
}

//タイマーを開く
function openTimer() {
	dispTimer();
	setNoticeWait();
}

//タイマーを表示
function dispTimer() {
	deleteTimerHtml();
	addTimerHtml();
}

//作業完了後の表示を消す
function confirmTimer() {
	
	//基準時刻より前の作業情報を削除
	var hosts = getTargetHosts();
	for (var ii = 0; ii < hosts.length; ii++) {
		var baseTime = new Date(document.getElementById("openTime").innerHTML);
		var villages = loadVillages(hosts[ii]);
		for (var i = 0; i < villages.length; i++) {
			var actions = villages[i][IDX_ACTIONS];
			for (var j = actions.length - 1; j >=0 ; j--) {
				var actionTime = new Date(actions[j][IDX2_TIME]);
				if (actionTime <= baseTime) {
					actions.splice(j, 1);
				}
			}
			villages[i][IDX_ACTIONS] = actions;
		}
		
		//保存
		saveVillages(hosts[ii], villages);
	}
	
	//更新後内容で表示
	openTimer();
}

//タイマー表示を閉じる
function closeTimer() {
	deleteTimerHtml();
}

//設定ダイアログを表示
function setupTimer() {
	deleteTimerHtml();
	addSetupHtml();
}

//完了通知モード変更
function changeNoticeMode(value) {
	GM_setValue(location.hostname + "_notice_mode", value);
//console.log(location.hostname + "_notice_mode: " + value);
	
	openTimer();
}

//常駐モード変更
function changeStayMode(value) {
	GM_setValue(location.hostname + "_stay_mode", value);
//console.log(location.hostname + "_stay_mode: " + value);
}

//常駐モード取得
function getStayMode() {
	var result = GM_getValue(location.hostname + "_stay_mode", false);
	return result;
}

//リンクHTML追加
function addOpenLinkHtml() {
	var container;
	var isMixi;
	
	var sidebar = document.evaluate('//*[@id="sidebar"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if (sidebar.snapshotLength == 0) {
		sidebar = document.evaluate('//*[@id="bptpcp_area"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		if (sidebar.snapshotLength > 0) {
			isMixi = true;
		}
	}
	if (sidebar.snapshotLength == 0) {
		container = document.body;
	} else {
		container = sidebar.snapshotItem(0);
	}
	
	//タイマー表示リンク
	var linksDiv = document.createElement("div");
	container.appendChild(linksDiv);
	var openLink = document.createElement("a");
	openLink.id = "timerOpenLink";
	openLink.href = "javascript:void(0);";

	if (isMixi) {
		//RE土＠mixi鯖さん(http://3gokushijp.zouri.jp/)、ご隠居@mixi鯖さん提供
		var imgsrc_timer18x18=
		'data:image/gif;base64,'+
		'R0lGODlhEAAQANUAACAcHfDx8enp6oCAg8jJyoSGiZCSlNDR0YuNkGlrbXh5e46Qkh8aG+Dg4Xx9'+
		'gIiKjDMwMfj5+XBxc9jZ2ZiYmWFhY1hYWrO0tMXFxt/g4ENCRHV2efjq6Li5up6eoKKjpPf4+CUh'+
		'InJXV1FOTyMfIU5MTTg0NUE+Pzs4OTMvMEpHSCgkJUhFRtHGxc7HyLe4ub/AwefX1tjT09bJyOHY'+
		'2Kumpu7x8W5vcV5eYGdoaoeJjL+cm/rw7/bn5QAAAAAAACH5BAEAAD4ALAAAAAAQABAAAAawwMLg'+
		'gVgsDEaD0oAYWgrEpmMwmBYRj0piINwYMAQXwaMY6AqSikIhuRwatFmgQVA4HDmcJEERBAI8HBEB'+
		'ES83GxUWCRIEGIQcPSARDQcFCRYQGgV+DTAtMX8BAh8aEAAABQR+HiI7Nn8HHyGnDAoCAhcDNTKh'+
		'AhSnAAwjEx0HAiChExMJDMArFBm3vbimwAAoHdECDQIHBCXWwBADBN4HBifh4SksKiYk6uoMzfH1'+
		'8UEAOw==';
		
		linksDiv.style.cssFloat = "right";
		openLink.innerHTML =
			'<ul><li class="first_bpbtn">'+
				'<img src="'+imgsrc_timer18x18+'" height="18" width="18">'+
				'<span style="fontsize:66%;">タイマー</span>'+
			'</li></ul>';
	} else {
		openLink.innerHTML = "タイマー";
	}

	openLink.addEventListener("click", function() {
		if (location.pathname == "/village.php") {
			getVillageActions();
		}
		openTimer();
	}, true);
	linksDiv.appendChild(openLink);
}

//タイマー表示HTML追加
function addTimerHtml() {
	var popupLeft = GM_getValue(location.hostname + "_popup_left", 150);
	var popupTop = GM_getValue(location.hostname + "_popup_top", 150);
	if (popupLeft < 0) popupLeft = 0;
	if (popupTop < 0) popupTop = 0;
	
	var timerContainer = document.createElement("div");
	timerContainer.id = "timerContainer";
	timerContainer.style.position = "absolute";
	timerContainer.style.backgroundColor = "#B8B8B8";
	timerContainer.style.border = "outset 2px #B8B8B8";
	timerContainer.style.left = popupLeft + "px";
	timerContainer.style.top = popupTop + "px";
	timerContainer.style.fontSize = "10px";
	timerContainer.style.padding = "3px";
	timerContainer.style.zIndex = 999;
	timerContainer.style.textAlign = "left";
//	timerContainer.style.opacity = 0.8;
	document.body.appendChild(timerContainer);
	
	//現在時刻保存
	var nowTime = new Date();
	var openTimeElem = document.createElement("span");
	openTimeElem.id = "openTime";
	openTimeElem.style.display = "none";
	openTimeElem.innerHTML = generateDateString(nowTime);
	timerContainer.appendChild(openTimeElem);
	
	//確認済リンク
	var confirmLink = document.createElement("a");
	confirmLink.title = "完了済の作業を削除します";
	confirmLink.href = "javascript:void(0);";
	confirmLink.style.margin = "3px";
	confirmLink.innerHTML = "確認済";
	confirmLink.addEventListener("click", function() {confirmTimer()}, true);
	timerContainer.appendChild(confirmLink);
	
	//閉じるリンク
	var closeLink = document.createElement("a");
	closeLink.title = "タイマー表示を隠します";
	closeLink.href = "javascript:void(0);";
	closeLink.style.margin = "3px";
	closeLink.innerHTML = "閉じる";
	closeLink.addEventListener("click", function() {closeTimer()}, true);
	timerContainer.appendChild(closeLink);
	
	//通知プルダウン
	var noticeSpan = document.createElement("span");
	noticeSpan.title = "作業完了の通知方法を指定します";
	noticeSpan.style.margin = "3px";
	timerContainer.appendChild(noticeSpan);
	
	var noticeCap = document.createElement("span");
	noticeCap.innerHTML = "通知";
	noticeSpan.appendChild(noticeCap);
	
	var noticeBox =  document.createElement("select");
	noticeBox.addEventListener("change", 
		function() {changeNoticeMode(this.value)}, true);
	noticeSpan.appendChild(noticeBox);
	
	var noticeOpts = new Array(
		new Array("popup", NOTICE_MODE_POPUP), 
		new Array("alert", NOTICE_MODE_ALERT), 
		new Array("none", NOTICE_MODE_NONE));
	for (var i = 0; i < noticeOpts.length; i++) {
		var elem = document.createElement("option");
		elem.innerHTML = noticeOpts[i][0];
		elem.value = noticeOpts[i][1];
		noticeBox.appendChild(elem);
	}
	noticeBox.value = GM_getValue(
		location.hostname + "_notice_mode", NOTICE_MODE_POPUP);
	
	//常駐チェックボックス
	var staySpan = document.createElement("span");
	staySpan.title = "作業完了がなくても常に表示します";
	staySpan.style.margin = "3px";
	timerContainer.appendChild(staySpan);
	
	var stayCap = document.createElement("span");
	stayCap.innerHTML = "常駐";
	staySpan.appendChild(stayCap);
	
	var stayBox =  document.createElement("input");
	stayBox.type = "checkbox";
	stayBox.style.verticalAlign = "middle";
	stayBox.checked = getStayMode();
	stayBox.addEventListener("change", 
		function() {changeStayMode(this.checked)}, true);
	staySpan.appendChild(stayBox);
	
	//設定リンク
	var setupLink = document.createElement("a");
	setupLink.title = "細かい通知＆表示設定を行えます";
	setupLink.href = "javascript:void(0);";
	setupLink.style.margin = "3px";
	setupLink.innerHTML = "設定";
	setupLink.addEventListener("click", function() {setupTimer()}, true);
	timerContainer.appendChild(setupLink);
	
	//バージョン
	var versionSpan = document.createElement("span");
	versionSpan.title = "ツール公開ページを表示します";
	versionSpan.style.fontSize = "9px";
	versionSpan.style.margin = "3px";
	timerContainer.appendChild(versionSpan);
	
	var versionLink = document.createElement("a");
	versionLink.target = "_blank";
	versionLink.href = DIST_URL;
	versionLink.innerHTML = "Ver." + TIMER_VERSION;
	versionSpan.appendChild(versionLink);
	
	//現在サーバtable
	timerContainer.appendChild(createCurrentHostTable(nowTime));
	
	//他サーバtable
	if (navigator.userAgent.toLowerCase().indexOf('chrome') < 0) {
		timerContainer.appendChild(createOtherHostsTable(nowTime));
	}
	
	//ドラッグ＆ドロップ設定
	timerContainer.addEventListener("mousedown",
		function(event) {
			MOUSE_DRAGGING = true;
			MOUSE_OFFSET_X = event.pageX - parseInt(this.style.left);
			MOUSE_OFFSET_Y = event.pageY - parseInt(this.style.top);
			if (navigator.userAgent.toLowerCase().indexOf('chrome') < 0) {
				event.preventDefault();
			}
		},
		false);
	document.body.addEventListener("mousemove",
		function(event) {
			if (!MOUSE_DRAGGING) return true;
			
			var timerContainer = document.getElementById("timerContainer");
			if (timerContainer == undefined) return true;
			
			var popupLeft = event.pageX - MOUSE_OFFSET_X;
			var popupTop = event.pageY - MOUSE_OFFSET_Y;
			timerContainer.style.left = popupLeft + "px";
			timerContainer.style.top = popupTop + "px";
			
			//ポップアップ位置を永続保存
			GM_setValue(location.hostname + "_popup_left", popupLeft);
			GM_setValue(location.hostname + "_popup_top", popupTop);
		},
		false);
	document.body.addEventListener("mouseup",
		function(event) {
			MOUSE_DRAGGING = false;
		},
		false);
}

//現サーバのテーブル作成
function createCurrentHostTable(nowTime) {
	var table = document.createElement("table");
	table.style.margin = "3px";
	
	//次回時間
	var nextTime = getNextTime(location.hostname, nowTime);
	if (nextTime != undefined) {
		var waitTimeStr = generateWaitTimeString(nextTime, nowTime);
		var nextTimeTr = document.createElement("tr");
		var nextTimeTd = document.createElement("td");
		nextTimeTd.colSpan = 2;
		nextTimeTd.innerHTML = "次回: " + generateDateString2(nextTime);
		nextTimeTd.innerHTML += " (あと" + waitTimeStr + ")";
		nextTimeTr.appendChild(nextTimeTd);
		table.appendChild(nextTimeTr);
	}
	
	//各拠点テーブル
	var villages = loadVillages(location.hostname);
	for (var i = 0; i < villages.length; i++) {
		var tableTr = document.createElement("tr");
		tableTr.style.verticalAlign = "top";
		table.appendChild(tableTr);
		
		//拠点情報項目
		var villageTd = document.createElement("td");
		villageTd.style.border = "solid 1px dimgray";
		villageTd.style.padding = "3px";
		villageTd.style.margin = "3px";
		tableTr.appendChild(villageTd);
		var villageText = villages[i][IDX_BASE_NAME];
		if (villages[i][IDX_URL] != "") {
			villageText = "<a href='" + villages[i][IDX_URL] + "'>" + 
				villageText + "</a>";
		}
		villageTd.innerHTML = villageText;
		
		//実行中作業情報項目
		var actionsTd = document.createElement("td");
		actionsTd.style.border = "solid 1px dimgray";
		actionsTd.style.padding = "3px";
		tableTr.appendChild(actionsTd);
		var actions = sortAction(villages[i][IDX_ACTIONS]);
		for (var j = 0; j < actions.length; j++) {
			var actionDiv = createActionDiv(
				actions[j], nowTime, villages[i][IDX_XY], location.hostname);
			if (!actionDiv) continue;
			
			actionsTd.appendChild(actionDiv);
		}
	}
	
	return table;
}

//他サーバのテーブル作成
function createOtherHostsTable(nowTime) {
	var table = document.createElement("table");
	table.style.margin = "3px";
	
	//他サーバ監視有無フラグ
	var dispOtherHosts = GM_getValue(location.hostname + "_disp_other_hosts", false);
	
	//操作リンク行
	var linkTr = document.createElement("tr");
	var linkTd = document.createElement("td");
	linkTd.colSpan = 2;
	
	//他サーバ監視有無
	var linkDesc = document.createElement("span");
	linkDesc.innerHTML = "他サーバ監視" + (dispOtherHosts ? "ON" : "OFF");
	linkTd.appendChild(linkDesc);
	
	//他サーバ監視切り替えリンク
	var dispLink = document.createElement("a");
	dispLink.href = "javascript:void(0);";
	dispLink.style.margin = "3px";
	var flipMode;
	if (dispOtherHosts) {
		flipMode = "→OFF";
		dispLink.addEventListener("click", function() {setDispOtherHosts(false)}, true);
	} else {
		flipMode = "→ON";
		dispLink.addEventListener("click", function() {setDispOtherHosts(true)}, true);
	}
	dispLink.innerHTML = flipMode;
	linkTd.appendChild(dispLink);
	
	linkTr.appendChild(linkTd);
	table.appendChild(linkTr);
	
	//他サーバ監視なしなら終了
	if (!dispOtherHosts) return table;
	
	var hosts = loadHosts();
	
	//次回時間
	var nextTime;
	var nextHost;
	for (var i = 0; i < hosts.length; i++) {
		if (hosts[i] == location.hostname) continue;
		
		var tmpNextTime = getNextTime(hosts[i], nowTime);
		if (nextTime == undefined || tmpNextTime < nextTime) {
			nextTime = tmpNextTime;
			nextHost = hosts[i];
		}
	}
	if (nextTime != undefined) {
		var waitTimeStr = generateWaitTimeString(nextTime, nowTime);
		
		var nextTimeTr = document.createElement("tr");
		var nextTimeTd = document.createElement("td");
		nextTimeTd.colSpan = 2;
		nextTimeTd.innerHTML = "次回(" + nextHost + "): " + generateDateString2(nextTime);
		nextTimeTd.innerHTML += " (あと" + waitTimeStr + ")";
		nextTimeTr.appendChild(nextTimeTd);
		table.appendChild(nextTimeTr);
	}
	
	//完了済みの作業のみ表示
	for (var ii = 0; ii < hosts.length; ii++) {
		if (hosts[ii] == location.hostname) continue;
		var villages = loadVillages(hosts[ii]);
		
		for (var i = 0; i < villages.length; i++) {
			var actions = sortAction(villages[i][IDX_ACTIONS]);
			
			//行表示有無判断
			var existsAction = false;
			for (var j = 0; j < actions.length; j++) {
				var actionTime = new Date(actions[j][IDX2_TIME]);
				if (actionTime < nowTime) {
					var type = actions[j][IDX2_TYPE].charAt(0);
					if (getDispMode(type) != DISP_MODE_NONE) {
						existsAction = true;
					}
				}
			}
			if (!existsAction) continue;
			
			var tableTr = document.createElement("tr");
			tableTr.style.verticalAlign = "top";
			table.appendChild(tableTr);
			
			//拠点情報項目
			var villageTd = document.createElement("td");
			villageTd.style.border = "solid 1px dimgray";
			villageTd.style.padding = "3px";
			tableTr.appendChild(villageTd);
			var villageText = hosts[ii] + "<br/>" + villages[i][IDX_BASE_NAME];
			villageTd.innerHTML = villageText;
			
			//実行中作業情報項目
			var actionsTd = document.createElement("td");
			actionsTd.style.border = "solid 1px dimgray";
			actionsTd.style.padding = "3px";
			tableTr.appendChild(actionsTd);
			for (var j = 0; j < actions.length; j++) {
				var actionTime = new Date(actions[j][IDX2_TIME]);
				if (actionTime > nowTime) {
					continue;
				}
				
				var actionDiv = createActionDiv(
					actions[j], nowTime, villages[i][IDX_XY], hosts[ii]);
				if (!actionDiv) continue;
				
				actionsTd.appendChild(actionDiv);
			}
		}
	}
	
	return table;
}

//各作業行生成
function createActionDiv(action, nowTime, baseXy, host) {
	var type = action[IDX2_TYPE].charAt(0);
	if (getDispMode(type) == DISP_MODE_NONE) {
		return undefined;
	}
	
	var actionDiv = document.createElement("div");
	
	//作業完了背景色
	var actionTime = new Date(action[IDX2_TIME]);
	if (actionTime < nowTime) {
		actionDiv.style.backgroundColor = "white";
	}
	
	//作業完了時刻
	var textSpan = document.createElement("span");
	var text = "";
	text += action[IDX2_TIME].replace(/^[0-9]{4}\//, "");
	if (getDispWaitTime()) {
		var finishTime = new Date(action[IDX2_TIME]);
		text += " (あと" + generateWaitTimeString(finishTime, nowTime) + ")";
	}
	text += " ";
	text += action[IDX2_STATUS];
	textSpan.innerHTML = text;
	actionDiv.appendChild(textSpan);
	
	//作業完了行の個別削除リンク
	if (actionTime < nowTime) {
		var delLink = document.createElement("a");
		delLink.title = "確認済にして削除します";
		delLink.href = "javascript:void(0);";
		delLink.style.color = "gray";
		delLink.innerHTML = "済";
		
		var key = host + DELIMIT1 + baseXy + DELIMIT1 + action[IDX2_TIME];
		delLink.addEventListener("click", 
			(function(key_) {
				return function() { deleteAction(key_); }
			})(key), true);
		actionDiv.appendChild(delLink);
	}
	
	return actionDiv;
}

//作業削除
function deleteAction(key) {
	var hosts = getTargetHosts();
	for (var ii = 0; ii < hosts.length; ii++) {
		var villages = loadVillages(hosts[ii]);
		var exists = false;
		villageLoop:
		for (var i = 0; i < villages.length; i++) {
			for (var j = 0; j < villages[i][IDX_ACTIONS].length; j++) {
				var action = villages[i][IDX_ACTIONS][j];
				var curKey = hosts[ii] + DELIMIT1 + 
					villages[i][IDX_XY] + DELIMIT1 + action[IDX2_TIME];
				if (key == curKey) {
					exists = true;
					villages[i][IDX_ACTIONS].splice(j, 1);
					break villageLoop;
				}
			}
		}
		
		//見つかったら更新
		if (exists) {
			saveVillages(hosts[ii], villages);
			openTimer();
			return;
		}
	}
}

function setDispOtherHosts(on) {
	GM_setValue(location.hostname + "_disp_other_hosts", on);
	openTimer();
}
function sortAction(actions) {
	actions.sort(function(val1, val2) {
		var diff = (new Date(val1[IDX2_TIME])).getTime() 
			- (new Date(val2[IDX2_TIME])).getTime();
		return diff;
	});
	return actions;
}

//タイマー表示HTML削除
function deleteTimerHtml() {
	var timerElem = document.getElementById("timerContainer");
	if (timerElem) document.body.removeChild(timerElem);
	deleteSetupHtml();
}

//通知設定
function setNoticeWait() {
	var noticeMode = GM_getValue(location.hostname + "_notice_mode", "");
	if (noticeMode == NOTICE_MODE_NONE) return;
	
	var nextTime;
	var hosts = getTargetHosts();
	for (var i = 0; i < hosts.length; i++) {
		var tmpNextTime = getNextTime(hosts[i], new Date());
		if (nextTime == undefined || tmpNextTime < nextTime) {
			nextTime = tmpNextTime;
		}
	}
	
	//未完了作業がなければ何もしない
	if (nextTime == undefined) {
		return;
	}
	
	//通知時刻が直近でなければ何もしない
	if (ALERT_TIME != undefined) {
		if (nextTime.getTime() > ALERT_TIME.getTime() - 3000) {
			return;
		}
	}
	ALERT_TIME = nextTime;
	
	var nowTime = new Date();
	var waitTime = nextTime.getTime() - nowTime.getTime() + 5000;
//console.log("waitTime="+waitTime);
	
	//完了時刻まで待つ
	window.setTimeout(function() {
		ALERT_TIME = undefined;
		updateTimer();
	}, waitTime);
}

//タイマー更新
function updateTimer() {
	var noticeMode = GM_getValue(location.hostname + "_notice_mode", "");
	
	//通知なしなら表示しない
	if (noticeMode == NOTICE_MODE_NONE && !getStayMode()) return;
	
	//アラート表示
	if (noticeMode == NOTICE_MODE_ALERT && existsAlertNeed()) {
		alert("作業完了！");
		setActionAlerted();
	}
	
	//通知対象の作業あれば表示
	if (getStayMode() || existsNotice(new Date())) {
		dispTimer();
	}
	
	//通知待ち設定
	setNoticeWait();
}

//通知対象ホスト
function getTargetHosts() {
	var hosts = new Array();
	var dispOtherHosts = GM_getValue(location.hostname + "_disp_other_hosts", false);
	if (dispOtherHosts) {
		hosts = loadHosts();
	} else {
		hosts[0] = location.hostname;
	}
	return hosts;
}

//次回完了時刻取得
function getNextTime(hostname, baseTime) {
	
	//一番早い作業完了時刻を取得
	var startTime = new Date("2099/12/31 23:59:59");
	var nextTime = startTime;
	var villages = loadVillages(hostname);
	for (var i = 0; i < villages.length; i++) {
		var actions = villages[i][IDX_ACTIONS];
		for (var j = 0; j < actions.length; j++) {
			var actionTime = new Date(actions[j][IDX2_TIME]);
			if (actionTime > baseTime && actionTime < nextTime) {
				var type = actions[j][IDX2_TYPE].charAt(0);
				if (getDispMode(type) == DISP_MODE_PUSH) {
					nextTime = actionTime;
				}
			}
		}
	}
	
	//作業中がなければ何もしない
	if (nextTime == startTime) nextTime = undefined;
	
	return nextTime;
}

//通知有無チェック
function existsNotice(baseTime) {
	var hosts = getTargetHosts();
	for (var i = 0; i < hosts.length; i++) {
		var villages = loadVillages(hosts[i]);
		for (var j = 0; j < villages.length; j++) {
			var actions = villages[j][IDX_ACTIONS];
			for (var k = 0; k < actions.length; k++) {
				var actionTime = new Date(actions[k][IDX2_TIME]);
				if (actionTime <= baseTime) {
					var type = actions[k][IDX2_TYPE].charAt(0);
					if (getDispMode(type) == DISP_MODE_PUSH) {
						return true;
					}
				}
			}
		}
	}
	return false;
}

//未アラート作業の有無チェック
function existsAlertNeed() {
	var baseTime = new Date();
	var hosts = getTargetHosts();
	for (var ii = 0; ii < hosts.length; ii++) {
		var villages = loadVillages(hosts[ii]);
		for (var i = 0; i < villages.length; i++) {
			for (var j = 0; j < villages[i][IDX_ACTIONS].length; j++) {
				var action = villages[i][IDX_ACTIONS][j];
				var actionTime = new Date(action[IDX2_TIME]);
				if (actionTime <= baseTime) {
					if (action[IDX2_ALERTED] != "1") {
						var type = action[IDX2_TYPE].charAt(0);
						if (getDispMode(type) == DISP_MODE_PUSH) {
							return true;
						}
					}
				}
			}
		}
	}
	return false;
}

//通知済フラグ設定
function setActionAlerted() {
	var baseTime = new Date();
	var hosts = getTargetHosts();
	for (var ii = 0; ii < hosts.length; ii++) {
		var villages = loadVillages(hosts[ii]);
		for (var i = 0; i < villages.length; i++) {
			for (var j = 0; j < villages[i][IDX_ACTIONS].length; j++) {
				var action = villages[i][IDX_ACTIONS][j];
				var actionTime = new Date(action[IDX2_TIME]);
				if (actionTime <= baseTime) {
					action[IDX2_ALERTED] = "1";
				}
				villages[i][IDX_ACTIONS][j] = action;
			}
		}
		
		//保存
		saveVillages(hosts[ii], villages);
	}
}


//拠点情報を読み出し
function loadVillages(hostname) {
	var ret = new Array();
	
	var src = GM_getValue(hostname, "");
	if (src == "") return ret;
	
	var villages = src.split(DELIMIT1);
	for (var i = 0; i < villages.length; i++) {
		var fields = villages[i].split(DELIMIT2);
		
		ret[i] = new Array();
		ret[i][IDX_XY] = fields[IDX_XY];
		ret[i][IDX_BASE_NAME] = fields[IDX_BASE_NAME];
		ret[i][IDX_URL] = fields[IDX_URL];
		
		ret[i][IDX_ACTIONS] = new Array();
		if (fields[IDX_ACTIONS] == "") continue;
		var actions = fields[IDX_ACTIONS].split(DELIMIT3);
		for (var j = 0; j < actions.length; j++) {
			ret[i][IDX_ACTIONS][j] = new Array();
			if (actions[j] == "") continue;
			
			var item = actions[j].split(DELIMIT4);
			if (item[IDX2_TYPE] == undefined) item[IDX2_TYPE] = TYPE_CONSTRUCTION;
			
			ret[i][IDX_ACTIONS][j][IDX2_STATUS] = item[IDX2_STATUS];
			ret[i][IDX_ACTIONS][j][IDX2_TIME] = item[IDX2_TIME];
			ret[i][IDX_ACTIONS][j][IDX2_TYPE] = item[IDX2_TYPE];
			ret[i][IDX_ACTIONS][j][IDX2_ALERTED] = item[IDX2_ALERTED];
		}
	}
	
	return ret;
}

//拠点情報を保存
function saveVillages(hostname, newData) {
	
	//配列をデリミタ区切り文字列に変換
	var newDataStr = new Array();
	for (var i = 0; i < newData.length; i++) {
		var villageData = newData[i];
		var actions = villageData[IDX_ACTIONS];
		
		//配列をデリミタ区切り文字列に変換
		for (var j = 0; j < actions.length; j++) {
			actions[j] = genDelimitString(actions[j], DELIMIT4);
		}
		villageData[IDX_ACTIONS] = genDelimitString(actions, DELIMIT3);
		newDataStr[i] = genDelimitString(villageData, DELIMIT2);
	}
	
	//Greasemonkey領域へ永続保存
	GM_setValue(hostname, genDelimitString(newDataStr, DELIMIT1));
//console.log(genDelimitString(newDataStr, DELIMIT1));
}

//対象サーバリスト読み出し
function loadHosts() {
	var ret = new Array();
	
	var src = GM_getValue("hosts", "");
	if (src == "") return ret;
	
	ret = src.split(DELIMIT1);
	
	return ret;
}

//対象サーバリスト保存
function saveHosts(hosts) {
	
	//Greasemonkey領域へ永続保存
	GM_setValue("hosts", genDelimitString(hosts, DELIMIT1));
//console.log(genDelimitString(hosts, DELIMIT1));
}

//内政スキル取得
function getDomesticSkill() {
	var data = getMyVillage();
	data[IDX_ACTIONS] = new Array();
	
	for (var i = 0; i < 3; i++) {
		var clockElem = document.getElementById("area_timer" + i);
		if (clockElem != undefined) {
			var clock = trim(clockElem.innerHTML);
			data[IDX_ACTIONS][i] = new Array();
			
			var statusElem = document.evaluate('..',
				clockElem, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
			var status = "";
			if (statusElem.className == "status") status = "使用";
			else if (statusElem.className == "recovery") status = "回復";
			
			var nameLink = document.evaluate('../td/a',
				statusElem, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			status = "内政:" + status + "(" + trim(nameLink.snapshotItem(0).innerHTML) + ")";
			
			data[IDX_ACTIONS][i][IDX2_STATUS] = status;
			data[IDX_ACTIONS][i][IDX2_TIME] = generateDateString(computeTime(clock));
			data[IDX_ACTIONS][i][IDX2_TYPE] = TYPE_DOMESTIC;
		}
	}
	
	saveVillage(data, TYPE_DOMESTIC);
}

//施設内作業中取得
function getTrainingSoldier() {
	var data = getMyVillage();
	data[IDX_ACTIONS] = new Array();
	
	//施設名
	var facilityName = "";
	var h2Elem = document.evaluate('//*[@id="gray02Wrapper"]/h2',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if (h2Elem.getSnapshotLength != 0) {
		facilityName = trim(h2Elem.snapshotItem(0).innerHTML);
	}
	
	//作業種別
	var actionType = TYPE_FACILITY + getParameter("x") + getParameter("y");

	//作業中情報取得
	var idx = 0; 
	while (1) {
		var clockElem = document.getElementById("area_timer" + idx);
		if (clockElem == undefined) break;
		
		var mainTtls = document.evaluate('../../../tr/th[@class="mainTtl"]',
			clockElem, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		if (mainTtls.snapshotLength == 0) break;
		var clock = trim(clockElem.innerHTML);
		if (clock == "") break;
		
		var mainTtlElem = mainTtls.snapshotItem(idx);
		if (mainTtlElem == undefined) break;
		var status = trim(mainTtlElem.innerHTML);
		if (status == "") break;
		
		data[IDX_ACTIONS][idx] = new Array();
		data[IDX_ACTIONS][idx][IDX2_STATUS] = facilityName + ":" + status;
		data[IDX_ACTIONS][idx][IDX2_TIME] = generateDateString(computeTime(clock));
		data[IDX_ACTIONS][idx][IDX2_TYPE] = actionType;
		
		idx++;
	}
	
	saveVillage(data, actionType);
}

//自拠点座標取得
//RE土＠mixi鯖さん(http://3gokushijp.zouri.jp/)提供
function getMyXY() {
	var d = document;
	var $x = function(xp,dc) {
		return document.evaluate(xp, dc||d, null, 
			XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
	};

	var nowLoc = $x('id("gNav")//a[contains(@href,"map.php")]');
	if (!nowLoc) return null;

	var xy = nowLoc.href.match(/x=([\-0-9]+)&y=([\-0-9]+)/i);
	if( xy ) {
		return xy[1]+","+xy[2];
	}
}

//自拠点情報取得
//RE土＠mixi鯖さん(http://3gokushijp.zouri.jp/)提供
function getMyVillage() {
	var ret = new Array();
	
	var xy=getMyXY();
	if(! xy){
		return ret;
	}
	var allData = loadVillages(location.hostname);
	for (var i = 0; i < allData.length; i++) {
		var villageData = allData[i];
		if (villageData[IDX_XY] == "("+xy+")") {
			ret[IDX_XY] = villageData[IDX_XY];
			ret[IDX_BASE_NAME] = villageData[IDX_BASE_NAME];
			return ret;
		}
	}
	
	return ret;
}


//設定ダイアログHTML追加
function addSetupHtml() {
	var popupLeft = GM_getValue(location.hostname + "_popup_left", 150);
	var popupTop = GM_getValue(location.hostname + "_popup_top", 150);
	if (popupLeft < 0) popupLeft = 0;
	if (popupTop < 0) popupTop = 0;
	
	var container = document.createElement("div");
	container.id = "setupContainer";
	container.style.position = "absolute";
	container.style.backgroundColor = "silver";
	container.style.border = "outset 2px silver";
	container.style.left = popupLeft + "px";
	container.style.top = popupTop + "px";
//	container.style.fontSize = "10px";
	container.style.padding = "3px";
	container.style.zIndex = 999;
	container.style.textAlign = "left";
	document.body.appendChild(container);
	
	//各作業種別プルダウン
	var types = new Array(
		new Array("建設", TYPE_CONSTRUCTION, 
			"施設建設の完了時刻"), 
		new Array("行軍", TYPE_MARCH, 
			"武将・兵士の行動（出撃・移動など）の完了時刻"), 
		new Array("施設", TYPE_FACILITY, 
			"施設内作業（研究・兵士作成など）の完了時刻"), 
		new Array("内政", TYPE_DOMESTIC, 
			"内政スキル使用・回復の完了時刻"));
	for (var type = 0; type < types.length; type++) {
		var typeDiv = document.createElement("div");
		typeDiv.title = types[type][2];
		typeDiv.style.margin = "3px";
		container.appendChild(typeDiv);
		
		var caption = document.createElement("span");
		caption.innerHTML = types[type][0];
		typeDiv.appendChild(caption);
		
		var selectBox = document.createElement("select");
		selectBox.id = "dispMode" + types[type][1];
		typeDiv.appendChild(selectBox);
		
		var options = new Array(
			new Array("通知あり", DISP_MODE_PUSH), 
			new Array("通知なし", DISP_MODE_PULL), 
			new Array("表示なし", DISP_MODE_NONE));
		for (var i = 0; i < options.length; i++) {
			var elem = document.createElement("option");
			elem.innerHTML = options[i][0];
			elem.value = options[i][1];
			selectBox.appendChild(elem);
		}
		
		selectBox.value = getDispMode(types[type][1]);
	}
	
	//残り時間表示チェックボックス
	var waitTimeDiv = document.createElement("div");
	waitTimeDiv.title = "明細行に残り時間を表示します";
	waitTimeDiv.style.margin = "3px";
	container.appendChild(waitTimeDiv);
	
	var waitTimeCap = document.createElement("span");
	waitTimeCap.innerHTML = "残り時間表示";
	waitTimeDiv.appendChild(waitTimeCap);
	
	var waitTimeBox =  document.createElement("input");
	waitTimeBox.id = "dispWaitTime";
	waitTimeBox.type = "checkbox";
	waitTimeBox.style.verticalAlign = "middle";
	waitTimeBox.checked = getDispWaitTime();
	waitTimeDiv.appendChild(waitTimeBox);
	
	//OKボタン
	var okButton = document.createElement("input");
	okButton.title = "設定を保存して閉じます";
	okButton.id = "setupOk";
	okButton.type = "button";
	okButton.value = "OK";
	okButton.addEventListener("click", function() {saveSetup()}, true);
	container.appendChild(okButton);
	
	//Cancelボタン
	var cancelButton = document.createElement("input");
	cancelButton.title = "設定を保存せずに閉じます";
	cancelButton.id = "setupCancel";
	cancelButton.type = "button";
	cancelButton.value = "Cancel";
	cancelButton.addEventListener("click", function() {dispTimer()}, true);
	container.appendChild(cancelButton);
}

//設定ダイアログHTML削除
function deleteSetupHtml() {
	var setupElem = document.getElementById("setupContainer");
	if (setupElem) document.body.removeChild(setupElem);
}

//設定情報保存
function saveSetup() {
	
	//作業種別表示モード
	var types = new Array(
		TYPE_CONSTRUCTION, TYPE_MARCH, TYPE_FACILITY, TYPE_DOMESTIC);
	for (var i = 0; i < types.length; i++) {
		var mode = document.getElementById("dispMode" + types[i]).value;
		GM_setValue(location.hostname + "_disp_mode" + types[i], mode);
	}
	
	//残り時間表示有無
	var dispWaitTime = document.getElementById("dispWaitTime").checked;
	GM_setValue(location.hostname + "_disp_wait_time", dispWaitTime);
	
	deleteSetupHtml();
	updateTimer();
}

//表示モード取得
function getDispMode(type) {
	var result = GM_getValue(
		location.hostname + "_disp_mode" + type, DISP_MODE_PUSH);
	return result;
}

//残り時間表示有無取得
function getDispWaitTime() {
	var result = GM_getValue(location.hostname + "_disp_wait_time", false);
	return result;
}

//URLパラメータ取得
function getParameter(key) {
	var str = location.search.split("?");
	if (str.length < 2) {
		return "";
	}
	
	var params = str[1].split("&");
	for (var i = 0; i < params.length; i++) {
		var keyVal = params[i].split("=");
		if (keyVal[0] == key && keyVal.length == 2) {
			return decodeURIComponent(keyVal[1]);
		}
	}
	return "";
}

//子Element取得
function getChildElement(parentNode, position) {
	var current = 0;
	for (var i = 0; i < parentNode.childNodes.length; i++){
		var childNode = parentNode.childNodes[i];
		if (childNode.nodeType == 1) {
			if (current == position) {
				return childNode;
			}
			current++;
		}
	}
	
	return undefined;
}

//時刻計算（現在時刻に加算、引数hh:mm:ss）
function computeTime(clock) {
	var hour = parseInt(trimZero(
		clock.replace(/^([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$1")));
	if (isNaN(hour)) hour = 0;
	var min = parseInt(trimZero(
		clock.replace(/^([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$2")));
	if (isNaN(min)) min = 0;
	var sec = parseInt(trimZero(
		clock.replace(/^([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$3")));
	if (isNaN(sec)) sec = 0;
	
	var now = new Date();
	var resTime = new Date();
	resTime.setHours(now.getHours() + hour);
	resTime.setMinutes(now.getMinutes() + min);
	resTime.setSeconds(now.getSeconds() + sec);
	
	return resTime;
}

//日時文字列編集（yyyy/mm/dd hh:mm:ss）
function generateDateString(date) {
	var res = "" + date.getFullYear() + "/" + padZero(date.getMonth() + 1) + 
		"/" + padZero(date.getDate()) + " " + padZero(date.getHours()) + ":" + 
		padZero(date.getMinutes()) + ":" + padZero(date.getSeconds());
	return res;
}

//日時文字列編集2（mm/dd hh:mm:ss）
function generateDateString2(date) {
	var res = "" + padZero(date.getMonth() + 1) + "/" + padZero(date.getDate()) + 
		" " + padZero(date.getHours()) + ":" + padZero(date.getMinutes()) + 
		":" + padZero(date.getSeconds());;
	return res;
}

//残時間文字列編集
function generateWaitTimeString(time1, time2) {
	var result = "";
	if (time1 < time2) time1 = time2;
	
	var waitTimeSec = Math.ceil((time1.getTime() - time2.getTime()) / 1000);
	result += Math.floor(waitTimeSec / (60*60));
	result += ":";
	result += padZero(Math.floor((waitTimeSec % (60*60)) / 60));
	result += ":";
	result += padZero(waitTimeSec % 60);
	
	return result;
}

//先頭ゼロ付加
function padZero(num) {
	var result;
	if (num < 10) {
		result = "0" + num;
	} else {
		result = "" + num;
	}
	return result;
}
//先頭ゼロ除去
function trimZero(str) {
	var res = str.replace(/^0*/, "");
	if (res == "") res = "0";
	return res;
}

//デリミタ区切り文字列生成
function genDelimitString(dataArray, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

//空白除去
function trim(str) {
	if (str == undefined) return "";
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
}

//数値チェック
function isNumeric(num) {
	if (num.match(/^-?[0-9]+$/)) {
		return true;
	}
	return false;
}

//Google Chrome用GM_*系ラッパー関数
function initGMWrapper() {
	
	// @copyright      2009, James Campos
	// @license        cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
	if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
		GM_addStyle = function(css) {
			var style = document.createElement('style');
			style.textContent = css;
			document.getElementsByTagName('head')[0].appendChild(style);
		}

		GM_deleteValue = function(name) {
			localStorage.removeItem(LOCAL_STORAGE_TIMER + "." + name);
		}

		GM_getValue = function(name, defaultValue) {
			var value = localStorage.getItem(LOCAL_STORAGE_TIMER + "." + name);
			if (!value)
				return defaultValue;
			var type = value[0];
			value = value.substring(1);
			switch (type) {
				case 'b':
					return value == 'true';
				case 'n':
					return Number(value);
				default:
					return value;
			}
		}

		GM_log = function(message) {
			console.log(message);
		}

		GM_registerMenuCommand = function(name, funk) {
		//todo
		}

		GM_setValue = function(name, value) {
			value = (typeof value)[0] + value;
			try {
				localStorage.setItem(LOCAL_STORAGE_TIMER + "." + name, value);
			} catch (e) {
				alert("localStorageへの保存に失敗 (" + e + ")");
				throw e;
			}
		}
	}
}
} // ブラ三タイマー機能 END ************************************************************************************************************


function disp_villageListBox() {
    if (0 <= location.pathname.search(/^\/(village|map|land)\.php/)) {
        return;
    }

    var isOpen = cloadData('sidebox_oc0', false,true) ? false : true;
    var sidBoxId = 'beyond_sidebox_villageListBox';
    var conf = cloadData( sidBoxId+'conf' , "null", true, true );

    if (!OPT_SMALLBTN) {
        isOpen = (conf == null) ? true : conf.open;
    }

    if (conf != null && typeof conf == 'object') {
        conf.open = isOpen;
        csaveData(sidBoxId+'conf',conf,true,true);
    }

    var box = ccreateSideBox(sidBoxId,IMG_DIR+'common/sidebar/icon_base.gif',"拠点");
    box.sideBoxInner.className += " basename";
    var ul = d.createElement("ul");
    box.sideBoxInner.appendChild(ul);

    var boxImage = $x('.//img[contains(@src,"icon_base")]', box.sideBoxHead);
    $e(boxImage,'click',function(){
        var saveData = isOpen ? "1" : "";
        isOpen = !isOpen;
        csaveData('sidebox_oc0', saveData,true);
    });

    var cvid = cgetCurrentVillageId();
    for (var key in VILLAGES_INFO) {
        var village = VILLAGES_INFO[key];
        var li = d.createElement("li");
        li.style.paddingBottom = "0px";
        ul.appendChild(li);

        var item;
        if (village.vid == cvid) {
            li.className = "on";
            item = d.createElement("span");

        }
        else {
            item = d.createElement("a");
            item.href = caddSessionId('/village_change.php?village_id='+village.vid+'&from=menu&page=' + encodeURIComponent(location.pathname + location.search));
        }

        li.appendChild(item);
        item.title = village.basename + " ("+village.x+","+village.y+")";
        item.appendChild(d.createTextNode(village.basename));
    }
}





// 初期化拡張
function initVillages() {
// ---- mixi鯖 51×51 に対応 ----
//	if (0 <= location.pathname.search(/^\/(village|map|land)\.php/))
    if (0 <= location.pathname.search(/^\/(village|land)\.php/))
		{ _villageInit(); return; }

    else if (location.pathname == "/user/" && $("statMenu")) {
        _profileInit();
        return;
    }

    VILLAGES_INFO = cloadData("villagesInfo","{}",true,true);

    function _villageInit() {
        var villages = $a('(id("lodgment")/div[@class="floatInner"] | //div[@class="sideBoxInner basename"])//li/*[@title]');

        var compList = new Object();

        var reg = new RegExp(/^([^ ]+) \((-?\d+),(-?\d+)\)$/);
        var matches = null;
        var noVids = new Array();

        for (var i=0;i < villages.length;i++) {
            var village = villages[i];
            var addObj = new Object();
            if ((matches = village.title.match(reg))) {
                addObj.basename = matches[1];
                addObj.x = parseInt(matches[2],10);
                addObj.y = parseInt(matches[3],10);
            }

            if (typeof village.href == 'string' && (matches = village.href.match(/village_id=(\d+)/))) {
                addObj.vid = parseInt(matches[1],10);
            }
            else {
                var viDoc = $x('//input[@name="village_id"]');
                if (viDoc) {
                    addObj.vid = parseInt(viDoc.value,10);
                }
                else {
                    noVids.push(addObj);
                }
            }
            compList[(addObj.x+"_"+addObj.y).replace(/-/g,"m")] = addObj;
        }

        _compData(compList);


        if (0 < noVids.length) {
            cajaxRequest("/user/" , "GET", "", function(req) {
                var dom = d.createElement("html");
                dom.innerHTML = req.responseText;
                for (var i = 0;i < noVids.length;i++) {
                    var td = $x('.//td[text()="'+noVids[i].x+","+noVids[i].y+'"]',dom);
                    var linkTd = cgetElementSibling(td,1);
                    var link = $x('.//a',linkTd);
                    if ((matches = link.href.match(/village_id=(\d+)/))) {
                        VILLAGES_INFO[(noVids[i].x+"_"+noVids[i].y).replace(/-/g,"m")].vid = parseInt(matches[1],10);
                    }
                }

                csaveData("villagesInfo",VILLAGES_INFO,true,true);
            });
        }
    }

    function _profileInit() {
        var compList = new Object();
        var matches = null;
        var villageLinks = $a('//table[contains(concat(" ", normalize-space(@class), " "), " commonTables ")]//th[contains(text(), "座標")]/../following-sibling::tr[position() <= 10]/td[position()=3 and 1 <= normalize-space(text())]/..//a');
        for (var i = 0;i < villageLinks.length;i++) {
            var villageLink = villageLinks[i];

            var addObj = new Object();
            var loc = cgetElementSibling(villageLink.parentNode,0);
            if ((matches = loc.innerHTML.match(/(-?\d+),(-?\d+)/))) {
                addObj.x = parseInt(matches[1],10);
                addObj.y = parseInt(matches[2],10);
            }

            if ((matches = villageLink.href.match(/village_id=(\d+)/))) {
                addObj.vid = parseInt(matches[1],10);
            }
            addObj.basename = villageLink.innerHTML.replace(/^\s*|\s*$/g,"");
            compList[(addObj.x+"_"+addObj.y).replace(/-/g,"m")] = addObj;
        }

        _compData(compList);
    }

    function _compData(compList) {
        var nowVillageList = cloadData("villagesInfo","{}",true,true);
        for (var key in compList) {
            VILLAGES_INFO[key] = compList[key];
            if (typeof nowVillageList[key] == 'object') {
                VILLAGES_INFO[key] = nowVillageList[key];
                if (typeof VILLAGES_INFO[key].vid != 'number' && typeof compList[key].vid == 'number') {
                    VILLAGES_INFO[key].vid = compList[key].vid;
                }
                VILLAGES_INFO[key].basename = compList[key].basename;
            }
        }

        csaveData("villagesInfo",VILLAGES_INFO,true,true);
    }
}

function initCastleSend() {
    if( location.pathname != '/facility/castle_send_troop.php' || location.search.indexOf("radio_move_type") < 0) return;

    var radioMoveType = location.search.match(/radio_move_type=(\d+)/)[1];
    var ary = $a('//input[@name="radio_move_type"]');
    var elem;
    for (var i = 0; i < ary.length;i++) {
        elem = ary[i];
        if (elem.value == radioMoveType) {
            elem.checked = "checked";
        }
        else {
            elem.checked = "";
        }
    }
}

function initNarrow() {

    if (0 <= location.pathname.search(/^\/(village|map|land)\.php/)) {
        $x('id("lodgment")/div[@class="floatHead"]//a').href = 'javascript:void(0);';
    }
    GM_addStyle(".footer_box { height:auto !important;}");
}

function initPreLoadNode() {
    PRE_LOAD_NODES['nowResources'] = {wood:$('wood'),stone:$('stone'),iron:$('iron'),rice:$('rice')};
    PRE_LOAD_NODES['serverTime'] = $('server_time_disp');
}

function initUrlParams() {
    var matches = location.search.match(/(?:\?|&)?([^=]+)(?:=([^&]+))?/g);

    if (matches) {
        var param;
        var key;
        var data;
        for(var i = 0 ; i < matches.length ; i++) {
            param = matches[i].match(/(?:\?|&)?([^=]+)(?:=([^&]+))?/);
            key = param[1];
            data = param[2];
            URL_PARAM[key] = '';
            if( param.length == 3 && typeof data == 'string') {
                URL_PARAM[key] = decodeURIComponent(data);

                // session id
                if (key.toLowerCase() == 'ssid') {
                    SID = key + '=' +data;
                }
            }
        }
    }
}

// 同盟レベルの表示を改善 START *********************************************************************************
if( location.pathname != "/alliance/level.php" ) { return; }

cl=document.getElementsByClassName('contents');
np=parseInt(cl[4].innerHTML)-parseInt(cl[2].innerHTML);
once = Math.round(np/parseInt(cl[1].innerHTML));

function kugiri(np,once) {
var num = new String(np,once).replace(/,/g, "");
while(num != (num = num.replace(/^(-?\d+)(\d{3})/, "$1.$2")));
return num;
}

cl[1].innerHTML+=' <span style="color:red; white-space:nowrap;">(空き枠:'+(parseInt(cl[3].innerHTML)-parseInt(cl[1].innerHTML))+')</span>';
cl[2].innerHTML+=' <br><span style=" font-size:12px; color:red; white-space:nowrap;">(次まで:'+(kugiri(np))+'／1人あたり:'+(kugiri(once))+')</span>';
cl[3].innerHTML+=' <span style="color:red; white-space:nowrap;">(次で+'+(parseInt(cl[5].innerHTML)-parseInt(cl[3].innerHTML))+')</span>';
// 同盟レベルの表示を改善 END ************************************************************************************************************



function disp_illustChange() { // 某ゲームのイラストに置き換えるアホツール START *********************************************************************************
	var illust = {
		"1001" : {big : "http://lh4.ggpht.com/-Ij0lTA4Xp4k/TUBV1zosOaI/AAAAAAAAAww/4fAT9WsnvKg/1001_R.png",		small : "http://lh4.ggpht.com/-1bFGHg9lH9M/TMOUZsPKcEI/AAAAAAAAAkQ/jHHy_0_pdXk/mini1001_R.png"},
		"1002" : {big : "http://lh5.ggpht.com/-7To95mWg9pY/TUBV2VA3OOI/AAAAAAAAAw0/Es5QRxubEF4/1002_SR.png",	small : "http://lh6.ggpht.com/-Wq519rEwwag/TMOUZ3ezkhI/AAAAAAAAAkU/Dl2VPTslxZ8/mini1002_SR.png"},
		"1003" : {big : "http://lh5.ggpht.com/-FAxU_xk8NxQ/TUBV3HYgLpI/AAAAAAAAAw4/45fpffEcEsE/1003_SR.png",	small : "http://lh4.ggpht.com/-EmwHZsLr2bU/TMOUaI_87xI/AAAAAAAAAkY/ERHTfMemMDw/mini1003_SR.png"},
		"1004" : {big : "http://lh4.ggpht.com/-4BVrJ4muA4Q/TUBV3lmJ5dI/AAAAAAAAAw8/SbHUT_9-IiE/1004_SR.png",	small : "http://lh4.ggpht.com/-2MxAe7gy2fY/TMOUaobSVkI/AAAAAAAAAkc/WK3r5V6e1a4/mini1004_SR.png"},
		"1005" : {big : "http://lh6.ggpht.com/-KTVKIONza_0/TUBV4NFVgBI/AAAAAAAAAxA/UDDtua4qu00/1005_R.png",		small : "http://lh3.ggpht.com/-FWP8p2Jd-Tc/TMOUa4eszrI/AAAAAAAAAkg/BCYpHwgiJ0o/mini1005_R.png"},
		"1006" : {big : "http://lh5.ggpht.com/-7hXoZoevUUs/TUBV49jBVvI/AAAAAAAAAxE/aTSxDMPO0nY/1006_SR.png",	small : "http://lh3.ggpht.com/--ph1yo4dSWQ/TMOUbRg6uYI/AAAAAAAAAkk/5xHzRYvOotk/mini1006_SR.png"},
		"1007" : {big : "http://lh5.ggpht.com/-XytgCa7FtRw/TUBV5RqnSKI/AAAAAAAAAxM/KgTDTeCwL4I/1007_UC.png",	small : "http://lh6.ggpht.com/-mMquGOfyOf4/TMOUbxQnr5I/AAAAAAAAAko/wgRqt4D9mQY/mini1007_UC.png"},
		"1008" : {big : "http://lh4.ggpht.com/-4gN6C98LEZA/TUBV59Y0OFI/AAAAAAAAAxQ/U50SNc55Gtk/1008_R.png",		small : "http://lh5.ggpht.com/-x1x3KAJ3FcI/TMOUcAsJrWI/AAAAAAAAAks/tEKEoWF1KAA/mini1008_R.png"},
		"1009" : {big : "http://lh3.ggpht.com/-hxxmdsa5PsQ/TUBV6SVtCaI/AAAAAAAAAxU/_TUf5mx-AMk/1009_UC.png",	small : "http://lh5.ggpht.com/-d71B00kfRa0/TMOUcikXd4I/AAAAAAAAAkw/IakzCXkJ4Ys/mini1009_UC.png"},
		"1010" : {big : "http://lh5.ggpht.com/-jUmeaBZAOic/TUBV7OcYKHI/AAAAAAAAAxY/uuGVkyJ7XI0/1010_UC.png",	small : "http://lh6.ggpht.com/-seZxrV0A92w/TMOUdNnmgKI/AAAAAAAAAk0/qgwQN9MUmkk/mini1010_UC.png"},
		"1011" : {big : "http://lh5.ggpht.com/-ymF9mcme2Cc/TUBV7s-CSYI/AAAAAAAAAxc/KS5938NOqN0/1011_R.png",		small : "http://lh6.ggpht.com/-GQST_X2ZCgs/TMOUdi88fSI/AAAAAAAAAk4/j-S_U8RWow4/mini1011_R.png"},
		"1012" : {big : "http://lh5.ggpht.com/-j0lcRLwgwgs/TUBV8AhUjrI/AAAAAAAAAxg/kZ9E1TFexso/1012_UC.png",	small : "http://lh3.ggpht.com/-x0LdhfqBuA8/TMOUd73E8WI/AAAAAAAAAk8/OOX7GzdlO1g/mini1012_UC.png"},
		"1013" : {big : "http://lh6.ggpht.com/-P0t1Oz3epDo/TUBV8ja__MI/AAAAAAAAAxk/8-b2x9ayzEY/1013_C.png",		small : "http://lh4.ggpht.com/-6qSNhvMhAow/TMOUeTyzoSI/AAAAAAAAAlA/bLQ3KATshJo/mini1013_C.png"},
		"1015" : {big : "http://lh5.ggpht.com/-pnEbE-P5qvI/TMOTrKz9fJI/AAAAAAAAAe8/wLBIf5OQm20/1015_UC.png",	small : "http://lh3.ggpht.com/-AQLrvHJr9GY/TMOUegz9BnI/AAAAAAAAAlE/HADVf2zTm3E/mini1015_UC.png"},
		"1016" : {big : "http://lh4.ggpht.com/-C0XXlaK_zyQ/TXmhd-TPHOI/AAAAAAAAA9s/X2WoEz_1fJw/1016_R.png",		small : "http://lh3.ggpht.com/-arJyGRs9gU4/TXmheuR7O9I/AAAAAAAAA90/moRy7E9Di78/mini1016_R.png"},
		"1019" : {big : "http://lh5.ggpht.com/-i9ZIDce_ycc/TMOTsDMJByI/AAAAAAAAAfE/dFvndpvHCJI/1019_UC.png",	small : "http://lh6.ggpht.com/-HC2h-nT62pI/TMOUfR1VSEI/AAAAAAAAAlM/Q_-1AHC3asY/mini1019_UC.png"},
		"1020" : {big : "http://lh4.ggpht.com/-P4_tdFzeEQ4/TMOTsrs6YII/AAAAAAAAAfI/GPQ0jSRWpYs/1020_C.png",		small : "http://lh6.ggpht.com/-JVsYM-hSWck/TMOUf15XzzI/AAAAAAAAAlQ/sUBi9Vsrtag/mini1020_C.png"},
		"1031" : {big : "http://lh5.ggpht.com/-kTK2fTh5t3s/TMOTtQaU9_I/AAAAAAAAAfM/ueVtf09OXMQ/1031_UC.png",	small : "http://lh6.ggpht.com/-iuz6R2_Jc_Y/TMOUgUSpuxI/AAAAAAAAAlU/NBfpcqMiDhk/mini1031_UC.png"},
		"1032" : {big : "http://lh6.ggpht.com/-joDtpvKfvUQ/TMOTtgYMJJI/AAAAAAAAAfQ/kEjvcYI1tLs/1032_C.png",		small : "http://lh4.ggpht.com/-29ltBq6JZYA/TMOUghWGsKI/AAAAAAAAAlY/8HTQR3MYfK4/mini1032_C.png"},
		"1035" : {big : "http://lh6.ggpht.com/-sTnmNCZ6Zq4/TMO7r-NLwTI/AAAAAAAAAqk/bGyoZl1-F-A/1035_SR.png",	small : "http://lh5.ggpht.com/-Qetv-BSBv7g/TMO7t9xSPTI/AAAAAAAAAq0/ldDfuTe1hX4/mini1035_SR.png"},
		"1037" : {big : "http://lh5.ggpht.com/-_LysnA8AD1M/TMOTuYz4nEI/AAAAAAAAAfU/XZRCTSsL4EI/1037_SR.png",	small : "http://lh3.ggpht.com/-i9JGmNPgtf0/TMOUhE23ECI/AAAAAAAAAlc/9c1BTxJ1r8I/mini1037_SR.png"},
		"1038" : {big : "http://lh4.ggpht.com/-vcNo4WPk580/TMOTuxMdFrI/AAAAAAAAAfY/po6JMoU70WE/1038_R.png",		small : "http://lh6.ggpht.com/-z2qIJP3LdTA/TMOUhU5dlJI/AAAAAAAAAlg/SF1u6fMnHcg/mini1038_R.png"},
		"1039" : {big : "http://lh5.ggpht.com/-x6Zfn6fPMaY/TMOTvWispQI/AAAAAAAAAfc/vxm1FUSf0b0/1039_UC.png",	small : "http://lh4.ggpht.com/-yTHR9rFC5bs/TMOUh0Gph6I/AAAAAAAAAlk/5MRCHimn4Pc/mini1039_UC.png"},
		"1040" : {big : "http://lh3.ggpht.com/-XdLOFTeg0UM/TMOTwDfzjrI/AAAAAAAAAfg/Wgcq4RArJOA/1040_C.png",		small : "http://lh3.ggpht.com/-CDSLPPQ9KaE/TMOUiEzn-yI/AAAAAAAAAlo/vykY9aJt7Qw/mini1040_C.png"},
		"1042" : {big : "http://lh5.ggpht.com/-yEZ6oIyka4U/TMOTwgtvNOI/AAAAAAAAAfk/7eHt87setkI/1042_R.png",		small : "http://lh4.ggpht.com/-DNuGvIcQ7tA/TMOUinPWvMI/AAAAAAAAAls/kidl63B0i78/mini1042_R.png"},
		"1043" : {big : "http://lh6.ggpht.com/-Hyvr4L0y8xM/TMOTxNZmVNI/AAAAAAAAAfo/HuyqLlJdsUM/1043_R.png",		small : "http://lh6.ggpht.com/-_3OwbdGjfws/TMOUjEXybwI/AAAAAAAAAlw/NucBRUwVyvI/mini1043_R.png"},
		"1046" : {big : "http://lh4.ggpht.com/-9ADLIIwUfy4/TMOTx7Dh-oI/AAAAAAAAAfs/TtkfFXXPmm0/1046_UR.png",	small : "http://lh5.ggpht.com/-WYdNCXnhGwo/TMOUjWkoo-I/AAAAAAAAAl0/T5PgkqOXCos/mini1046_UR.png"},
		"1047" : {big : "http://lh6.ggpht.com/-Pfzk9chkn-8/TMOTyb7RgFI/AAAAAAAAAfw/E_6FRKdzAo4/1047_UR.png",	small : "http://lh5.ggpht.com/-XKwE-rBeLgY/TMOUj5JSL-I/AAAAAAAAAl4/HILfg4C6GeA/mini1047_UR.png"},
		"1048" : {big : "http://lh5.ggpht.com/-yLH1ubhBAmQ/TMOTy6P-Z-I/AAAAAAAAAf0/k9LKOJxlkNU/1048_UR.png",	small : "http://lh3.ggpht.com/-mJedALDh1Eg/TMOUkMID6MI/AAAAAAAAAl8/ElXwRwijJIg/mini1048_UR.png"},
		"1049" : {big : "http://lh6.ggpht.com/-Ozu2k_4k-3g/TMOTzXAtIpI/AAAAAAAAAf4/Lr-6YksXeCY/1049_UR.png",	small : "http://lh5.ggpht.com/-tYmt8G5NuP0/TMOUkhNbjtI/AAAAAAAAAmA/sHejRl3Gpn0/mini1049_UR.png"},
		"1050" : {big : "http://lh6.ggpht.com/-Ve1EuCVg9g4/TMO7sR0NHCI/AAAAAAAAAqo/BapswH84iug/1050_UR.png",	small : "http://lh3.ggpht.com/-BD30lBn8R-4/TMO7uB87YDI/AAAAAAAAAq4/7cB8ExBONnI/mini1050_UR.png"},
		"1051" : {big : "http://lh6.ggpht.com/-ZJkSTNQkwOc/TMOTzmEUYlI/AAAAAAAAAf8/v0zNznVU6iY/1051_UR.png",	small : "http://lh5.ggpht.com/-a9BqjIghX2w/TMOUk5_-HgI/AAAAAAAAAmE/49hoSiRha8o/mini1051_UR.png"},
		"1052" : {big : "http://lh6.ggpht.com/-AIyfNgKwvSM/TMOT0ZPd5wI/AAAAAAAAAgA/Xsj-poch0H8/1052_SR.png",	small : "http://lh4.ggpht.com/-mICsYm40uqc/TMOUldgnLoI/AAAAAAAAAmI/Rpe_2kr8nlg/mini1052_SR.png"},
		"1056" : {big : "http://lh5.ggpht.com/-I6iE28vzAuw/TMOT04LC2hI/AAAAAAAAAgE/kONmpCjPqK4/1056_R.png",		small : "http://lh4.ggpht.com/-7fyzGny5hnw/TMOUlvKe_9I/AAAAAAAAAmM/7v0CBAIYAM8/mini1056_R.png"},
		"1057" : {big : "http://lh3.ggpht.com/-QqMV9R6KkCo/TMOT1mHFRSI/AAAAAAAAAgI/srSzJ3woTAU/1057_SR.png",	small : "http://lh3.ggpht.com/-Yidb5ZXLEqQ/TMOUmK_HvII/AAAAAAAAAmQ/X-1b-aPDGUI/mini1057_SR.png"},
		"1059" : {big : "http://lh3.ggpht.com/-5oj3UHm9OgU/TMclNDonneI/AAAAAAAAArM/hiivHEaRwFI/1059_C.png",		small : "http://lh4.ggpht.com/-92l3Dp4rNAY/TMclPnbOkgI/AAAAAAAAAro/eK3kQmm9JtM/mini1059_C.png"},
		"1060" : {big : "http://lh4.ggpht.com/-p3RvF88jWbM/TMclNXrDMgI/AAAAAAAAArQ/HjVam6tgx8A/1060_R.png",		small : "http://lh3.ggpht.com/-5B4FX8gh-qQ/TMclQKmrAcI/AAAAAAAAArs/okqCC0Jj-Vs/mini1060_R.png"},
		"1062" : {big : "http://lh4.ggpht.com/-dCQ-zWogBLo/TSE1EyPHYPI/AAAAAAAAAvI/1JhvKTaL10c/1062_UR.png",	small : "http://lh6.ggpht.com/-XNEXTBWQfIk/TSE1GzL1lfI/AAAAAAAAAvY/wxjub4Ty2_A/mini1062_UR.png"},
		"1063" : {big : "http://lh3.ggpht.com/-6vMEzjYOfgw/TPTMrGGWDKI/AAAAAAAAAuU/DcTY2UY3Ps0/1063_UC.png",	small : "http://lh6.ggpht.com/-LCs3a2qMsfE/TPTMuPE1raI/AAAAAAAAAuk/kknMyC3JCJ8/mini1063_UC.png"},
		"1066" : {big : "http://lh5.ggpht.com/-uUaOqiqWFS4/TPTMrqeil9I/AAAAAAAAAuY/oi7rDL4WO4w/1066_SR.png",	small : "http://lh4.ggpht.com/-gvtlma0k56c/TPTMulgZL2I/AAAAAAAAAuo/WYGa-9VpqKw/mini1066_SR.png"},
		"1070" : {big : "http://lh6.ggpht.com/-KjTZiRtjmDQ/TXmheA_EmGI/AAAAAAAAA9w/pHLxjchY3b8/1070_UC.png",	small : "http://lh3.ggpht.com/-mtsQKJSPQR8/TXmhfHP1C3I/AAAAAAAAA94/yb7iVnAwCXo/mini1070_UC.png"},
		"1072" : {big : "http://lh5.ggpht.com/-nJ33oAZ084Y/TZCCfaLzAoI/AAAAAAAABDA/M3BuIlhUA7I/1072_R.png",		small : "http://lh4.ggpht.com/-FOSbgWfttIc/TZCCi8kcvzI/AAAAAAAABDg/yrHkI3wTWN8/mini1072_R.png"},
		"1073" : {big : "http://lh5.ggpht.com/--WCoLqUI93o/TZCCf6RtwXI/AAAAAAAABDE/lTGLf_C6qy4/1073_R.png",		small : "http://lh6.ggpht.com/-Kx3w80aQ_WE/TZCCjDjlqbI/AAAAAAAABDk/ic-3MnNz-So/mini1073_R.png"},
		"1074" : {big : "http://lh3.ggpht.com/-SdJ6l9_1PiQ/TbbblCkoo_I/AAAAAAAABEo/qd6-FHBea98/1074_SR.png",	small : "http://lh6.ggpht.com/-OESwEl-h4GQ/TbbbmmcVKHI/AAAAAAAABE4/Gwu8S428Hw0/mini1074_SR.png"},
		"1075" : {big : "http://lh5.ggpht.com/-h6tXGT9NfwU/Tdp21CIGcDI/AAAAAAAABFM/hshCGB7CiOc/1075_UR.png",	small : "http://lh3.ggpht.com/-3DNvOljY5zY/Tdp22MPAMmI/AAAAAAAABFY/bNNxOQtYD-g/mini1075_UR.png"},
		"1078" : {big : "http://lh6.ggpht.com/-M3HC9hO3x4M/Tdp21RrmRRI/AAAAAAAABFQ/u6QYw7fnAaM/1078_UC.png",	small : "http://lh4.ggpht.com/-bBBkkw_CWuI/Tdp22cLAnLI/AAAAAAAABFc/XbOmJKlCVd8/mini1078_UC.png"},
		"1079" : {big : "http://lh6.ggpht.com/-1p7zy2KtkZ0/TgB9-3SKDhI/AAAAAAAABGE/YX-mzMj_o48/1079_UR.png",	small : "http://lh5.ggpht.com/-cPbWuVsascw/TgB9_v-2g-I/AAAAAAAABGM/amkXy3a3YdM/mini1079_UR.png"},
		"1083" : {big : "http://lh4.ggpht.com/-ur00WLogMBo/Ti4pAqXfBfI/AAAAAAAABJo/Ev18aYqyang/1083_UR.png",	small : "http://lh3.ggpht.com/-XjuSkLHkHD8/Ti4pCEgEJ9I/AAAAAAAABJ4/rziGfUDV9hc/mini1083_UR.png"},
		"1086" : {big : "http://lh6.ggpht.com/-RWVeZG3-F34/ToAEBd_46gI/AAAAAAAABTU/hTvjmwRcZfQ/1086_UR.png",	small : "http://lh4.ggpht.com/-sb1FEfS32MA/ToAEChI9YjI/AAAAAAAABTg/fKfGjL_4sV0/mini1086_UR.png"},
		"1089" : {big : "http://lh6.ggpht.com/-qILVjgVFc8U/Tp70KeQ-C_I/AAAAAAAABV0/glQ-pDpKp-o/1089_R.png",		small : "http://lh5.ggpht.com/-sPwoqVPfjOU/Tp70N0u_fFI/AAAAAAAABW4/FVootTTwUb8/mini1089_R.png"},
		"1090" : {big : "http://lh3.ggpht.com/-3rF8Q0TzDj8/Tp70K-lhCNI/AAAAAAAABV8/Iqp5joQ7qrI/1090_UC.png",	small : "http://lh4.ggpht.com/-g2jh9_v-264/Tp70ODMVZHI/AAAAAAAABXE/IPEqs1ZZCqA/mini1090_UC.png"},
		"1091" : {big : "http://lh5.ggpht.com/-pz73rlVQGeQ/Tp70LN9WziI/AAAAAAAABWE/VcWjrJwTZ38/1091_UC.png",	small : "http://lh6.ggpht.com/-MJ5wlVHQNO0/Tp70OScqt1I/AAAAAAAABXM/u4TgYp6ntWQ/mini1091_UC.png"},
		"1092" : {big : "http://lh6.ggpht.com/-9KhpXVo7n_8/Tqbwbqmh6uI/AAAAAAAABYQ/OjNPvJ9bcFc/1092_UR.png",	small : "http://lh4.ggpht.com/-eNqccGzVkrY/Tqbwdsr3nWI/AAAAAAAABYk/NAdU_-hgHHg/mini1092_UR.png"},
		"1094" : {big : "http://lh6.ggpht.com/-n1t0fKRX2P4/Tw7YUoRR6TI/AAAAAAAABas/H9GH9tL3QIs/1094_SR.png",	small : "http://lh6.ggpht.com/-YwEXjEXRoEw/Tw7YX7rQ2QI/AAAAAAAABbQ/rcsTUVGSw90/mini1094_SR.png"},
		"1095" : {big : "http://lh4.ggpht.com/-KFY2xa1L1Us/Tw7YVAGFtVI/AAAAAAAABaw/vmCRwYEV1dY/1095_UR.png",	small : "http://lh5.ggpht.com/-9z3AtFXub1Q/Tw7YYXDFTDI/AAAAAAAABbY/BmNGFXmooW8/mini1095_UR.png"},
		"2001" : {big : "http://lh6.ggpht.com/-mFNChWHZN5w/TMOT2OaGcGI/AAAAAAAAAgM/96bjcFAf8GU/2001_SR.png",	small : "http://lh4.ggpht.com/-2z1BNsqW3vM/TMOUmtgqiuI/AAAAAAAAAmU/huw20LZX_Ho/mini2001_SR.png"},
		"2003" : {big : "http://lh4.ggpht.com/-aJb6-iJgPU8/TMOT2nAuPJI/AAAAAAAAAgQ/pDmeyKCvlaM/2003_R.png",		small : "http://lh4.ggpht.com/-SU2hN6fkAmc/TMOUm9CVPnI/AAAAAAAAAmY/_prrfywzROY/mini2003_R.png"},
		"2004" : {big : "http://lh5.ggpht.com/-dUqSWW1f5C8/TMOT3MuFcHI/AAAAAAAAAgU/C6VFdlUn8nI/2004_R.png",		small : "http://lh4.ggpht.com/--Pu5aAe54FU/TMOUnSnr2DI/AAAAAAAAAmc/78qiAf61ekM/mini2004_R.png"},
		"2005" : {big : "http://lh3.ggpht.com/-BbOHdFgAuZg/TMOT3sv1ZOI/AAAAAAAAAgY/DAMujnu0iEY/2005_SR.png",	small : "http://lh3.ggpht.com/-NxbtoOOLFgA/TMOUn9BwM_I/AAAAAAAAAmg/yQLWSnSQ40g/mini2005_SR.png"},
		"2007" : {big : "http://lh4.ggpht.com/-3wmFy0zRR3s/TMOT4Y531RI/AAAAAAAAAgc/DQrApnmoNy8/2007_R.png",		small : "http://lh3.ggpht.com/-NfOJm9RiaFU/TMOUoWHegRI/AAAAAAAAAmk/xuFDr-w8JEw/mini2007_R.png"},
		"2008" : {big : "http://lh6.ggpht.com/-YuobBvmtPBw/TMOT42VrEBI/AAAAAAAAAgg/AwWfKfHxPGw/2008_UC.png",	small : "http://lh5.ggpht.com/-KkoKQX6BuZk/TMOUouqjPvI/AAAAAAAAAmo/kxPg7x5zDec/mini2008_UC.png"},
		"2009" : {big : "http://lh4.ggpht.com/-9c_qs-mCi24/TMOT5Xq38AI/AAAAAAAAAgk/kZkETA6q_dg/2009_UC.png",	small : "http://lh3.ggpht.com/-s7Kzb96fIVc/TMOUpQy-fzI/AAAAAAAAAms/BrJmeuLBDGU/mini2009_UC.png"},
		"2010" : {big : "http://lh3.ggpht.com/-1fx-DP0ixs4/TMOT51qgBYI/AAAAAAAAAgo/d9hn0-ScZOw/2010_UC.png",	small : "http://lh3.ggpht.com/-RulkOxjas18/TMOUpq99ynI/AAAAAAAAAmw/95YkbrE3oeo/mini2010_UC.png"},
		"2011" : {big : "http://lh5.ggpht.com/-ICLrnqBYZiU/TMOT6WTolYI/AAAAAAAAAgs/Epowju_lPyM/2011_C.png",		small : "http://lh5.ggpht.com/-G1bkLcbesCw/TMOUp0Rys5I/AAAAAAAAAm0/CTVnqWzjhHY/mini2011_C.png"},
		"2012" : {big : "http://lh3.ggpht.com/-2QvSiWsB9wE/TMOT7KUH9DI/AAAAAAAAAgw/yTcWyE2uxcU/2012_UC.png",	small : "http://lh6.ggpht.com/-0YAU-Wiu8Z0/TMOUqGAOsyI/AAAAAAAAAm4/tINSbt_krZE/mini2012_UC.png"},
		"2013" : {big : "http://lh4.ggpht.com/-OcxmcZsZBMg/TMOT7kK2vLI/AAAAAAAAAg0/uLoTXOaqNZU/2013_R.png",		small : "http://lh3.ggpht.com/-GEZbI2yMDrA/TMOUqrh59rI/AAAAAAAAAm8/he25q8Olsag/mini2013_R.png"},
		"2017" : {big : "http://lh6.ggpht.com/-ciNP0vsNR6Y/TMOT8F2aAYI/AAAAAAAAAg4/ZIWeQkKpgPc/2017_UC.png",	small : "http://lh5.ggpht.com/-LuF9W3ynNuM/TMOUqzVycEI/AAAAAAAAAnA/yU-M5DxaTtk/mini2017_UC.png"},
		"2018" : {big : "http://lh4.ggpht.com/-yWyqlZmCNZI/TMOT8UOr3XI/AAAAAAAAAg8/D-iT8UeAapg/2018_C.png",		small : "http://lh3.ggpht.com/-deZjufkQvzA/TMOUrU4KK3I/AAAAAAAAAnE/X6k9Szl4pL8/mini2018_C.png"},
		"2035" : {big : "http://lh4.ggpht.com/-E8DEk7IKY34/TMOT9JeQVZI/AAAAAAAAAhA/pjetyDv48mc/2035_UC.png",	small : "http://lh3.ggpht.com/-JpAGlbhGM0k/TMOUrkrR1rI/AAAAAAAAAnI/bnGjiBNJmrw/mini2035_UC.png"},
		"2036" : {big : "http://lh5.ggpht.com/-nIsIf5TnP44/TMOT9phLIpI/AAAAAAAAAhE/ITOgStd0bvo/2036_C.png",		small : "http://lh6.ggpht.com/-FBeyK_NDFdU/TMOUsOIihAI/AAAAAAAAAnM/tiYzc_0F_cg/mini2036_C.png"},
		"2039" : {big : "http://lh5.ggpht.com/-3UTlS6ayRdc/TMOT-Qe0zJI/AAAAAAAAAhI/dZIdg0bm2AA/2039_R.png",		small : "http://lh4.ggpht.com/-BlXDwQouX00/TMOUsR2HNPI/AAAAAAAAAnQ/7Fi8FYQ5aTY/mini2039_R.png"},
		"2040" : {big : "http://lh6.ggpht.com/-DOVW-NPRIuo/TMOT-z_rl_I/AAAAAAAAAhM/ufNcVPPgGPk/2040_R.png",		small : "http://lh5.ggpht.com/-Yo1fPACUPyU/TMOUs00ameI/AAAAAAAAAnU/KbdA01d8ZDw/mini2040_R.png"},
		"2041" : {big : "http://lh4.ggpht.com/-UOC8xlAHpps/TMOT_YdDjDI/AAAAAAAAAhQ/lRfUBZJSa5A/2041_UC.png",	small : "http://lh3.ggpht.com/-9kQgZpCvt-E/TMOUtddSUBI/AAAAAAAAAnY/RcRoK5EO6Dg/mini2041_UC.png"},
		"2042" : {big : "http://lh3.ggpht.com/-y0vWdFVHkfc/TMOUADKHm7I/AAAAAAAAAhU/ubihZ0Qq94s/2042_SR.png",	small : "http://lh4.ggpht.com/-kuiXSzLJlT4/TMOUtpBa67I/AAAAAAAAAnc/4yptNL_pvUM/mini2042_SR.png"},
		"2043" : {big : "http://lh4.ggpht.com/-ndKY7_xxNOI/TMOUAg3SXII/AAAAAAAAAhY/kCKCwFgXHqk/2043_R.png",		small : "http://lh6.ggpht.com/-d5ui_92CTGs/TMOUtz1XQtI/AAAAAAAAAng/XwkWnoljfHE/mini2043_R.png"},
		"2044" : {big : "http://lh4.ggpht.com/-56ZErU7Zn2Y/TMOUBNGIRPI/AAAAAAAAAhc/BJ_rES56N1A/2044_R.png",		small : "http://lh3.ggpht.com/-ypUXsiC07hc/TMOUuTzakeI/AAAAAAAAAnk/KwLjTBh-ZZ8/mini2044_R.png"},
		"2049" : {big : "http://lh4.ggpht.com/-kbUk4h2zHy4/TMOUBpCurLI/AAAAAAAAAhg/A84tksA8kWI/2049_R.png",		small : "http://lh6.ggpht.com/-V-5MeoEY-xw/TMOUuynbhvI/AAAAAAAAAno/IWfzMKRGkO0/mini2049_R.png"},
		"2050" : {big : "http://lh4.ggpht.com/-fNwXKaxg0AQ/TMOUCF5IT3I/AAAAAAAAAhk/WK07kc3NgnQ/2050_UC.png",	small : "http://lh5.ggpht.com/-fb3LEAc4gys/TMOUveh4NWI/AAAAAAAAAns/jKivIXUAgAQ/mini2050_UC.png"},
		"2051" : {big : "http://lh6.ggpht.com/-W3MGYYZyEqs/TMOUC1fPBMI/AAAAAAAAAho/9O9X0F84j18/2051_UR.png",	small : "http://lh6.ggpht.com/-cBAxCatdleM/TMOUvqeQUFI/AAAAAAAAAnw/v4jkqFVbH7k/mini2051_UR.png"},
		"2052" : {big : "http://lh5.ggpht.com/-geKglraFHU4/TMOUDXAsq-I/AAAAAAAAAhs/CseltgUGAF8/2052_UR.png",	small : "http://lh5.ggpht.com/-f7jcdxbC1M4/TMOUvy-GhEI/AAAAAAAAAn0/_9fFKuXCK2M/mini2052_UR.png"},
		"2058" : {big : "http://lh6.ggpht.com/-EKFwSX0BDa8/TMOUDzN_u0I/AAAAAAAAAhw/qLz_SgwtsM0/2058_UR.png",	small : "http://lh3.ggpht.com/-tauTrc2mP7U/TMOUwMBPK4I/AAAAAAAAAn4/gH8gV7HHRZE/mini2058_UR.png"},
		"2060" : {big : "http://lh4.ggpht.com/-gPnfLio8P6U/TMOUEUoTQhI/AAAAAAAAAh0/mYEDb6h-K7Q/2060_UR.png",	small : "http://lh3.ggpht.com/-pKloDoPQP-4/TMOUwmn1WkI/AAAAAAAAAn8/wF47FFA2eg8/mini2060_UR.png"},
		"2062" : {big : "http://lh4.ggpht.com/-hH6m8U8Asyc/TMfJ2_rxPqI/AAAAAAAAAsI/7KSKo6RvvDw/2062_SR.png",	small : "http://lh6.ggpht.com/-OExOgPF_psc/TMfJ3rB4lPI/AAAAAAAAAsM/1fYkoek98_Y/mini2062_SR.png"},
		"2063" : {big : "http://lh6.ggpht.com/-HNm7K3MvOww/TMclN-HTk0I/AAAAAAAAArU/NVooLCquOpY/2063_UR.png",	small : "http://lh6.ggpht.com/-w9VSPeo0tYo/TMclQVTFQZI/AAAAAAAAArw/TfVusfo-BAM/mini2063_UR.png"},
		"2064" : {big : "http://lh5.ggpht.com/-sK4R7Eqmo7k/TMclOIUhKhI/AAAAAAAAArY/e57UHPgqleI/2064_SR.png",	small : "http://lh6.ggpht.com/-VgxmjdaPKlI/TMclQi1chCI/AAAAAAAAAr0/zCHoSzIFjwc/mini2064_SR.png"},
		"2066" : {big : "http://lh5.ggpht.com/-8Glkm9ym_vA/TVDfNPJQiRI/AAAAAAAAAyo/PQYFS-BA1zA/2066_UR.png",	small : "http://lh5.ggpht.com/-URZkBYugsY8/TVDfNqWOgxI/AAAAAAAAAy0/tdkTbdYSOrQ/mini2066_UR.png"},
		"2067" : {big : "http://lh5.ggpht.com/-ErReumiNtC4/TPTMslYyxXI/AAAAAAAAAuc/gZszdtTF_hk/2067_R.png",		small : "http://lh4.ggpht.com/-nN9aFylV8II/TPTMu2rIPyI/AAAAAAAAAus/Mco0hiY2u6w/mini2067_R.png"},
		"2068" : {big : "http://lh3.ggpht.com/-I91MTam9lTs/TPTMtuxkAoI/AAAAAAAAAug/dFmEqPSFKiU/2068_R.png",		small : "http://lh4.ggpht.com/-PSOebsa1ysg/TPTMvLEjUzI/AAAAAAAAAuw/aajzWlzcsnI/mini2068_R.png"},
		"2069" : {big : "http://lh6.ggpht.com/-lyaizpUrqhQ/TT9wv8Hj1tI/AAAAAAAAAwE/WcctHhf9YnE/2069_SR.png",	small : "http://lh4.ggpht.com/-BgiN6wTEmrQ/TT9wym0StTI/AAAAAAAAAwY/RDvv0OpawOE/mini2069_SR.png"},
		"2070" : {big : "http://lh4.ggpht.com/-FvCiLluCvDw/TT9wwdS7kfI/AAAAAAAAAwI/2ZIRz_zdN4k/2070_UC.png",	small : "http://lh3.ggpht.com/-r2lAH_Bd0OQ/TT9wy9k0A4I/AAAAAAAAAwc/ThUNDwz6pic/mini2070_UC.png"},
		"2071" : {big : "http://lh3.ggpht.com/-od86VIQ22VM/TT9wwys03KI/AAAAAAAAAwM/Bzn7_u7kQDM/2071_UR.png",	small : "http://lh5.ggpht.com/-N0cjPkJhinc/TT9wzOANviI/AAAAAAAAAwg/MrponatyFFs/mini2071_UR.png"},
		"2074" : {big : "http://lh5.ggpht.com/-UZ8bBtZ5nVY/TW3TyZv-9BI/AAAAAAAAA7k/oWifMVFHTxs/2074_R.png",		small : "http://lh6.ggpht.com/-3qcYnNTvqS4/TW3T04KFZDI/AAAAAAAAA78/O18-YshwK1M/mini2074_R.png"},
		"2076" : {big : "http://lh6.ggpht.com/-QANBigfzxmY/TZCCgAVxqtI/AAAAAAAABDI/vLYtlPCVt2Q/2076_UC.png",	small : "http://lh3.ggpht.com/-I8dx-BHw9Aw/TZCCjSSlHgI/AAAAAAAABDo/1sxBjnMU2Qc/mini2076_UC.png"},
		"2077" : {big : "http://lh3.ggpht.com/-u4foXjuJfQ4/TZCCgmDwZxI/AAAAAAAABDM/YhRfGNAag1U/2077_UC.png",	small : "http://lh3.ggpht.com/-YNUU_YaGeYU/TZCCjy8_GGI/AAAAAAAABDs/X5scvTFm8ms/mini2077_UC.png"},
		"2078" : {big : "http://lh6.ggpht.com/-bDICdryrQ0s/Tbbbllu1n3I/AAAAAAAABEs/QWJ6IsF3Q3w/2078_R.png",		small : "http://lh3.ggpht.com/-5RncC4HcYCw/Tbbbm_sNK7I/AAAAAAAABE8/QhMExooBWjg/mini2078_R.png"},
		"2084" : {big : "http://lh6.ggpht.com/-CD_aAYBnj28/TgB9_X-YOYI/AAAAAAAABGI/FnDGJfDUIDc/2084_SR.png",	small : "http://lh3.ggpht.com/-MswkfG776fc/TgB9_22PFfI/AAAAAAAABGQ/YABQmwf3Lbo/mini2084_SR.png"},
		"2086" : {big : "http://lh5.ggpht.com/-gQiX8zJNu50/Ti4pA3WL0YI/AAAAAAAABJs/91U33cCFglo/2086_SR.png",	small : "http://lh6.ggpht.com/-E5cp1E3mDLw/Ti4pCdT-eCI/AAAAAAAABJ8/KQ_aavGZi5A/mini2086_SR.png"},
		"2088" : {big : "http://lh3.ggpht.com/-W5GPapcZmA4/TkAJsCsGNfI/AAAAAAAABKM/Q9FtySyLJoc/2088_UR.png",	small : "http://lh4.ggpht.com/-wLg7mfEfim0/TkAJtfGqCJI/AAAAAAAABKY/MlDGk5mrZpQ/mini2088_UR.png"},
		"2089" : {big : "http://lh6.ggpht.com/-zzwpE8gva5A/TkAJskkvd8I/AAAAAAAABKQ/DfqIJh72gJg/2089_SR.png",	small : "http://lh5.ggpht.com/-cW0O6pRe2j0/TkAJtph-QgI/AAAAAAAABKc/NW0Q8L6YmG0/mini2089_SR.png"},
		"2091" : {big : "http://lh6.ggpht.com/-ytRjxYJ-Ta8/TkAJs7CqZrI/AAAAAAAABKU/uCU6SxoORkQ/2091_UC.png",	small : "http://lh3.ggpht.com/-TnK6J1-EFJs/TkAJt5APvjI/AAAAAAAABKg/9zAhSi20mNI/mini2091_UC.png"},
		"2092" : {big : "http://lh3.ggpht.com/-DE8C3haagc0/TlVoTVBc4dI/AAAAAAAABKo/Wf9bQiJMmH8/2092_UR.png",	small : "http://lh3.ggpht.com/-9paaT3F39nQ/TlVoUIv5NkI/AAAAAAAABKw/fzxJLOMjlQ8/mini2092_UR.png"},
		"2093" : {big : "http://lh5.ggpht.com/-t4WM5LCFEsM/TlVoTmAlv1I/AAAAAAAABKs/25qnl2BlkJ8/2093_SR.png",	small : "http://lh6.ggpht.com/-pCa_LjqQ3-k/TlVoUbOLXaI/AAAAAAAABK0/C-lD3T_do18/mini2093_SR.png"},
		"2094" : {big : "http://lh6.ggpht.com/-wMTjZB_dx1Y/ToAEB4DOqOI/AAAAAAAABTY/IvgiLzKlGzg/2094_UR.png",	small : "http://lh3.ggpht.com/-5UH5vSnIStU/ToAEC-CnCyI/AAAAAAAABTk/Th_A-8lF_0U/mini2094_UR.png"},
		"2096" : {big : "http://lh3.ggpht.com/-hhWI9J9j5rE/Tp70LpIuI_I/AAAAAAAABWM/XvRUZs_icps/2096_R.png",		small : "http://lh6.ggpht.com/-YUlcOMeLUtQ/Tp70OurB_WI/AAAAAAAABXU/230MPJszuBQ/mini2096_R.png"},
		"2097" : {big : "http://lh3.ggpht.com/-Dsm2vFSIs00/Tp70MEIYRSI/AAAAAAAABWU/QWPccspxphw/2097_UC.png",	small : "http://lh4.ggpht.com/-huFBmqykyvI/Tp70O1e6uSI/AAAAAAAABXc/TckZYPyfjL0/mini2097_UC.png"},
		"2098" : {big : "http://lh5.ggpht.com/-EPeWN1qqTpI/Tp70MRZNFzI/AAAAAAAABWc/O6rCghlwyMI/2098_UC.png",	small : "http://lh3.ggpht.com/-STkejNnsBeE/Tp70POSIlgI/AAAAAAAABXk/lm2WbNyvyv8/mini2098_UC.png"},
		"2099" : {big : "http://lh3.ggpht.com/-TjdAX_F-UUw/TqbwcNuQy-I/AAAAAAAABYU/AuUAZ3sUtcw/2099_SR.png",	small : "http://lh3.ggpht.com/-SRItuwFPwmg/TqbweUkzvkI/AAAAAAAABYs/4NDquJetCB8/mini2099_SR.png"},
		"2102" : {big : "http://lh6.ggpht.com/-i-ejabfb58Y/Tw7YVuHptNI/AAAAAAAABa4/wX6OzWjsGFE/2102_UR.png",	small : "http://lh3.ggpht.com/--gdygEG7qL8/Tw7YZMfQj0I/AAAAAAAABbg/xMjStAYp1bQ/mini2102_UR.png"},
		"2104" : {big : "http://lh3.ggpht.com/-pNwSC8ozHBg/TxwXed0x7vI/AAAAAAAAB-c/AfN_ax4cd04/2104_UR.png",	small : "http://lh4.ggpht.com/-ES_iLf1EjOk/TxwXf9wgceI/AAAAAAAAB-w/p_MjHsNWltc/mini2104_UR.png"},
		"3001" : {big : "http://lh4.ggpht.com/-LVYxV3G7ubA/TMOUE8XBbCI/AAAAAAAAAh4/jDx0mpIkrOw/3001_R.png",		small : "http://lh3.ggpht.com/-nvcyciDLYzQ/TMOUxFpHtXI/AAAAAAAAAoA/n2_0lF8ijyg/mini3001_R.png"},
		"3002" : {big : "http://lh3.ggpht.com/-MijYWAK6Hb8/TMOUFTN6BfI/AAAAAAAAAh8/y0Q2C9sVW4E/3002_SR.png",	small : "http://lh5.ggpht.com/-HsSi81b0_NY/TMOUxRs0CDI/AAAAAAAAAoE/y-fvMI1ErXQ/mini3002_SR.png"},
		"3003" : {big : "http://lh4.ggpht.com/-aVqtsl_ANBY/TMOUF4jNx3I/AAAAAAAAAiA/SAochOqhxVw/3003_SR.png",	small : "http://lh3.ggpht.com/-OF3WGe_fRz4/TMOUxgrtLLI/AAAAAAAAAoI/9Ynjp1OjEH0/mini3003_SR.png"},
		"3004" : {big : "http://lh3.ggpht.com/-iN6amrGftpU/TMOUGpyhbJI/AAAAAAAAAiI/dbB8Y-0m0OA/3004_SR.png",	small : "http://lh4.ggpht.com/-rnIb77im6cc/TMOUyHMsUkI/AAAAAAAAAoM/FLChu97t_y4/mini3004_SR.png"},
		"3005" : {big : "http://lh6.ggpht.com/-fP2wpVzcUg8/TMOUHKnmmPI/AAAAAAAAAiM/l4KI5iJZRQE/3005_R.png",		small : "http://lh6.ggpht.com/-BuFJb7NII4M/TMOUyQp9thI/AAAAAAAAAoQ/w1-YHs-YDjI/mini3005_R.png"},
		"3006" : {big : "http://lh3.ggpht.com/-Cas_K_cQ890/TMOUHhLRrAI/AAAAAAAAAiQ/NiHuGqp7rdQ/3006_SR.png",	small : "http://lh3.ggpht.com/-DJhtLQ9zQKg/TMOUy5TkMCI/AAAAAAAAAoU/EFQfGP_6LA4/mini3006_SR.png"},
		"3007" : {big : "http://lh6.ggpht.com/-tU6Fvilpp4s/TMOUIbDNZBI/AAAAAAAAAiU/oYDRF2WzHv0/3007_R.png",		small : "http://lh3.ggpht.com/-1zBimUVswk0/TMOUzKffVYI/AAAAAAAAAoY/08XmeBxHtcE/mini3007_R.png"},
		"3008" : {big : "http://lh3.ggpht.com/-6_1lWBgCkVU/TMOUI-PUYpI/AAAAAAAAAiY/r0lYYsg5UHA/3008_UC.png",	small : "http://lh3.ggpht.com/-QkkxXnwPUco/TMOUzXjSFKI/AAAAAAAAAoc/kovB_9HHTMg/mini3008_UC.png"},
		"3009" : {big : "http://lh3.ggpht.com/-yuaRA0hdiVw/TMOUJd_COlI/AAAAAAAAAic/j3K4kCt0m1o/3009_UC.png",	small : "http://lh3.ggpht.com/-NEVxUQoWxlM/TMOUz6kshkI/AAAAAAAAAok/d7vA6IFSZYY/mini3009_UC.png"},
		"3010" : {big : "http://lh6.ggpht.com/-YKh-2sPAxeQ/TMOUKHLewMI/AAAAAAAAAig/Jf7l4e61yTc/3010_R.png",		small : "http://lh6.ggpht.com/-NAwcp7IXHFA/TMOU0I--MXI/AAAAAAAAAoo/I1hdTQNwxsM/mini3010_R.png"},
		"3013" : {big : "http://lh5.ggpht.com/-zMjF2oq2EFc/TMOUKTw0TXI/AAAAAAAAAik/uhKEhrAum7U/3013_UC.png",	small : "http://lh6.ggpht.com/-AIUCvdT5tyw/TMOU0gQoHbI/AAAAAAAAAos/bPUGDwEH_KE/mini3013_UC.png"},
		"3031" : {big : "http://lh5.ggpht.com/-4eZX3bX_BWU/TUBXZDLQH4I/AAAAAAAAAxw/c5G-WhTsMuU/3031_R.png",		small : "http://lh6.ggpht.com/-fRrL7fO7u3w/TUBXbLW9ysI/AAAAAAAAAyA/C-tHHMOs5QU/mini3031_R.png"},
		"3032" : {big : "http://lh4.ggpht.com/-lIAmsd2p3iw/TUBXZoTttvI/AAAAAAAAAx0/tFHZPy7pkB4/3032_R.png",		small : "http://lh5.ggpht.com/-KoK5IXvdysU/TUBXbTyjspI/AAAAAAAAAyE/mTNa5a_os54/mini3032_R.png"},
		"3037" : {big : "http://lh5.ggpht.com/-l1-9QdFG5bk/TMOUK0iKPxI/AAAAAAAAAio/tAxl-misT1Y/3037_R.png",		small : "http://lh5.ggpht.com/-YOKKvaLQMzs/TMOU1JhNQRI/AAAAAAAAAow/KQVu1KvFESc/mini3037_R.png"},
		"3038" : {big : "http://lh6.ggpht.com/-Npha340QCO0/TMOULexVMqI/AAAAAAAAAis/X8zY9NNPGZ8/3038_UC.png",	small : "http://lh5.ggpht.com/-EqbKmGfgV5k/TMOU1Xy4MlI/AAAAAAAAAo0/Gc9aHY7dVdM/mini3038_UC.png"},
		"3039" : {big : "http://lh4.ggpht.com/-B-xHi9Gu_ig/TMOUL4TFfhI/AAAAAAAAAiw/RhyOA2yKj0I/3039_C.png",		small : "http://lh4.ggpht.com/-8Lq7sqP36CU/TMOU1iK2YYI/AAAAAAAAAo4/_ZoT_00yPd0/mini3039_C.png"},
		"3040" : {big : "http://lh4.ggpht.com/-ynSM39Zynpw/TMOUMmuuX_I/AAAAAAAAAi0/PFXJMb9M00A/3040_SR.png",	small : "http://lh6.ggpht.com/-Nnr_nohY5-M/TMOU1xFvjlI/AAAAAAAAAo8/dT1K1hCGCu8/mini3040_SR.png"},
		"3041" : {big : "http://lh4.ggpht.com/-x9HbCgMx1P4/TMOUNNVsfNI/AAAAAAAAAi4/zPsag1CuvwI/3041_R.png",		small : "http://lh6.ggpht.com/-0hJFkltJnsE/TMOU2fLpLEI/AAAAAAAAApA/Rz0K5V0DLYM/mini3041_R.png"},
		"3042" : {big : "http://lh4.ggpht.com/-5_52oj93cGs/TMOUNwrd0hI/AAAAAAAAAi8/_XIpmZ4HQBI/3042_R.png",		small : "http://lh5.ggpht.com/-Xia2s0OGnMo/TMOU2_XO_PI/AAAAAAAAApE/PWtzxvN6PJc/mini3042_R.png"},
		"3043" : {big : "http://lh3.ggpht.com/-4X7Tw1Dg2ms/TMOUOU6udXI/AAAAAAAAAjA/FffzjDC3iOY/3043_UC.png",	small : "http://lh6.ggpht.com/-nZf8oMrqkZ8/TMOU3CYK0dI/AAAAAAAAApI/C_mwbu0iBYU/mini3043_UC.png"},
		"3045" : {big : "http://lh3.ggpht.com/-jzsgxYqTCDg/TMOUPedOOLI/AAAAAAAAAjE/WhT3fgdF9FY/3045_UR.png",	small : "http://lh5.ggpht.com/-d9DgN-6KNzM/TMOU3SagEjI/AAAAAAAAApM/1aOYNsBeCoM/mini3045_UR.png"},
		"3046" : {big : "http://lh3.ggpht.com/-z4D2MsNgSi8/TMOUP1m0hXI/AAAAAAAAAjI/ZIQjJIejimE/3046_UR.png",	small : "http://lh5.ggpht.com/-QBl6DMNPIfw/TMOU3__uZiI/AAAAAAAAApQ/Wzfy0CGO3ts/mini3046_UR.png"},
		"3047" : {big : "http://lh3.ggpht.com/-b-zDXcYmwoE/TMO7sx_MhTI/AAAAAAAAAqs/s7FdawzHJJE/3047_UR.png",	small : "http://lh3.ggpht.com/-t9ECqhG0r6E/TMO7uk2RMbI/AAAAAAAAAq8/5UkhDkXZhmg/mini3047_UR.png"},
		"3049" : {big : "http://lh3.ggpht.com/-1M6Mz9a9TzU/TMOUQoZ9_BI/AAAAAAAAAjM/LjJ6QuYcy_E/3049_UC.png",	small : "http://lh3.ggpht.com/-taSkS87ilLw/TMOU4DefQaI/AAAAAAAAApU/J4JLkO-a5Lg/mini3049_UC.png"},
		"3051" : {big : "http://lh3.ggpht.com/-TFOOxvjJKeo/TMO7tOarDJI/AAAAAAAAAqw/RfZ7fjwmLlo/3051_R.png",		small : "http://lh3.ggpht.com/-0cCh_A5ztCA/TMO7uzlkjxI/AAAAAAAAArA/bTtfuUdUTJE/mini3051_R.png"},
		"3052" : {big : "http://lh3.ggpht.com/-8NffT6IZG2I/TMOURLLbAmI/AAAAAAAAAjQ/Wfey2KDy-Jg/3052_UC.png",	small : "http://lh5.ggpht.com/-Yf4E9xdKdOA/TMOU4sXrtrI/AAAAAAAAApY/_IuUt6Gc-JA/mini3052_UC.png"},
		"3053" : {big : "http://lh3.ggpht.com/-uTgde6Nw3eM/TMclOnUVmuI/AAAAAAAAArc/pOoENC71FVs/3053_UR.png",	small : "http://lh4.ggpht.com/-8kQDWknwpKc/TMclRJkg-KI/AAAAAAAAAr4/-5sgbHhLUrE/mini3053_UR.png"},
		"3054" : {big : "http://lh6.ggpht.com/-DVm9YUFfQa4/TMclO1AjeeI/AAAAAAAAArg/G5EV5wmQgyE/3054_SR.png",	small : "http://lh4.ggpht.com/-X0Y65vBOOYw/TMclRZnTrAI/AAAAAAAAAr8/nq3XEa6rYb4/mini3054_SR.png"},
		"3056" : {big : "http://lh5.ggpht.com/-MA_-i6yxU_4/TUBXaIPMHJI/AAAAAAAAAx4/iV3kyDOi7VU/3056_UR.png",	small : "http://lh4.ggpht.com/--euHdRVt6mY/TUBXb9yQkrI/AAAAAAAAAyI/VmlaQTwEBS8/mini3056_UR.png"},
		"3057" : {big : "http://lh5.ggpht.com/-vjss5dEfpX0/TUBXailKb_I/AAAAAAAAAx8/NcU8g79acfo/3057_UR.png",	small : "http://lh3.ggpht.com/-M8Rhkb4VLpA/TUBXcY7xReI/AAAAAAAAAyM/G0p2UxJV_wo/mini3057_UR.png"},
		"3058" : {big : "http://lh3.ggpht.com/-0pxkAYg06tk/TSE1FxEaCdI/AAAAAAAAAvQ/KjizN46LWX0/3058_UR.png",	small : "http://lh3.ggpht.com/-DSW96376Tfc/TSE1HW4UCPI/AAAAAAAAAvg/JQdRau-da_M/mini3058_UR.png"},
		"3062" : {big : "http://lh6.ggpht.com/-aHX8lR6Ahag/TT9wxxmDquI/AAAAAAAAAwQ/cTeNAhpKT0Y/3062_UC.png",	small : "http://lh6.ggpht.com/-S0H7LzqulHU/TT9wzovgP3I/AAAAAAAAAwk/mIzaSy1V2PU/mini3062_UC.png"},
		"3064" : {big : "http://lh5.ggpht.com/-c-Gnv1iQVVY/TW3Ty-i035I/AAAAAAAAA7o/P2BvGFtJt_M/3064_R.png",		small : "http://lh4.ggpht.com/-k5K3vL6b6_E/TW3T1FlyA0I/AAAAAAAAA8A/izks226-mw8/mini3064_R.png"},
		"3065" : {big : "http://lh5.ggpht.com/-TIjhYRvuTWc/TZCChGGo_QI/AAAAAAAABDQ/uH3mHF3Zp2k/3065_UR.png",	small : "http://lh5.ggpht.com/-ozaGASGEhhs/TZCCkF4YNwI/AAAAAAAABDw/afuHU1TLGqM/mini3065_UR.png"},
		"3066" : {big : "http://lh4.ggpht.com/-SzKmKmr-nqs/TW5YvoDXm3I/AAAAAAAAA8w/NWKKEuxD3uM/3066_UR.png",	small : "http://lh4.ggpht.com/-1qmtbnVCM7w/TW5YwI_9MQI/AAAAAAAAA80/k-xRd1LiecE/mini3066_UR.png"},
		"3067" : {big : "http://lh5.ggpht.com/-0oq9DyXmsGY/TZCChmRG8XI/AAAAAAAABDU/2RVqQUl1JLQ/3067_UR.png",	small : "http://lh3.ggpht.com/-YtH8Dq4b5KY/TZCCkRLt4oI/AAAAAAAABD0/Rh3J4Ldta7s/mini3067_UR.png"},
		"3078" : {big : "http://lh5.ggpht.com/-z_T8oyM-Npc/Tp70MwHnS9I/AAAAAAAABWk/x0Oae4Uaom8/3078_R.png",		small : "http://lh5.ggpht.com/-F-8WFZaHSjU/Tp70PetFrqI/AAAAAAAABXs/RAgjtiqhT48/mini3078_R.png"},
		"3079" : {big : "http://lh3.ggpht.com/-LuZq2Bo9Xdg/Tp70NT-De1I/AAAAAAAABWs/fjajiN1v0b8/3079_UC.png",	small : "http://lh5.ggpht.com/-X1HDBaq5BKE/Tp70Pmq8eaI/AAAAAAAABX0/tjzbw-WuG5g/mini3079_UC.png"},
		"3080" : {big : "http://lh4.ggpht.com/-mTQR7_p-K_M/Tp70NuAP6oI/AAAAAAAABW0/hefRxiMAimk/3080_UC.png",	small : "http://lh6.ggpht.com/-hLMSLSZir-A/Tp70P-0cnNI/AAAAAAAABX8/DB1vbLd_4X0/mini3080_UC.png"},
		"3081" : {big : "http://lh4.ggpht.com/-e9lQGOo4q1I/TrnKdOVqFlI/AAAAAAAABZE/iQAfgS7Jask/3081_UR.png",	small : "http://lh5.ggpht.com/-avoNc0UG0Ps/TrnKfabmv4I/AAAAAAAABZY/Mspr8MDFhKQ/mini3081_UR.png"},
		"3082" : {big : "http://lh4.ggpht.com/-rN-x8VDrazY/TrnKdiN4kTI/AAAAAAAABZI/-UJJT4ea0eU/3082_SR.png",	small : "http://lh4.ggpht.com/-0rX402sK2LM/TrnKfwq_PpI/AAAAAAAABZg/WXrIfST5bsQ/mini3082_SR.png"},
		"3083" : {big : "http://lh6.ggpht.com/-BFc6XaEQWF0/TrnKeEPMYNI/AAAAAAAABZQ/fm4YeprtrcI/3083_R.png",		small : "http://lh3.ggpht.com/-KBPt30ooorY/TrnKg4RmnII/AAAAAAAABZo/tOgexpuVEQY/mini3083_R.png"},
		"3087" : {big : "http://lh4.ggpht.com/-qzjK8ADzMGo/TspwUbLYNxI/AAAAAAAABZ4/r0_TV4ewizI/3087_UR.png",	small : "http://lh5.ggpht.com/-YeNbZ3_YPP8/TspwWHRCwoI/AAAAAAAABaQ/zXxNfLGaeWw/mini3087_UR.png"},
		"3089" : {big : "http://lh5.ggpht.com/-rC2jSBS8-GU/Tw7YWFASvkI/AAAAAAAABbA/AWfLtqaudFY/3089_UR.png",	small : "http://lh6.ggpht.com/-knOlpahCh0g/Tw7YZ7MsM9I/AAAAAAAABbo/jFpNIySEQ_g/mini3089_UR.png"},
		"3090" : {big : "http://lh5.ggpht.com/-OxGBgZKGomY/Tw7YWlkspCI/AAAAAAAABbM/RU6JrZZzpYo/3090_SR.png",	small : "http://lh3.ggpht.com/-Vyb3WdXg9tY/Tw7YaVJbEkI/AAAAAAAABbw/lSelD5ltTCA/mini3090_SR.png"},
		"3091" : {big : "http://lh5.ggpht.com/-1KxA8jtEYl4/TxwXe1wFRiI/AAAAAAAAB-g/EmQeJaAknpE/3091_UR.png",	small : "http://lh3.ggpht.com/-Qz_xBeLPdpI/TxwXgGaefSI/AAAAAAAAB-0/-BOEkr_hhhM/mini3091_UR.png"},
		"4001" : {big : "http://lh3.ggpht.com/-rPCGC0Bh1Fc/TVDfNfYhGFI/AAAAAAAAAys/oAhuRQLpZ6g/4001_SR.png",	small : "http://lh6.ggpht.com/-lzwENk0zJTY/TVDfNS309kI/AAAAAAAAAyw/o7wt9h6D9H0/mini4001_SR.png"},
		"4002" : {big : "http://lh3.ggpht.com/-W_U4yFEJO_w/TMOUSQRaowI/AAAAAAAAAjY/eWtvz4DjgpY/4002_R.png",		small : "http://lh5.ggpht.com/-UQ02qCvIsSE/TMOU5X1QQ2I/AAAAAAAAApg/hd71wP-QCsM/mini4002_R.png"},
		"4003" : {big : "http://lh3.ggpht.com/-x7NnM3JgJZw/TMOUS6P0fEI/AAAAAAAAAjc/-86F_ombfWA/4003_R.png",		small : "http://lh5.ggpht.com/-bFhMrBs54MY/TMOU5gR3uGI/AAAAAAAAApk/GprgvA1z1Tc/mini4003_R.png"},
		"4004" : {big : "http://lh5.ggpht.com/-UC0Xt7phUqc/TMOUTVFsIzI/AAAAAAAAAjg/II3Atly7DMQ/4004_R.png",		small : "http://lh5.ggpht.com/-DwOJrIsEEL8/TMOU5xFmbNI/AAAAAAAAApo/dHDqeM1d8oY/mini4004_R.png"},
		"4005" : {big : "http://lh3.ggpht.com/-gg06FKX2y7U/TMOUT_9oPHI/AAAAAAAAAjk/fE9Q2wyDl2A/4005_R.png",		small : "http://lh6.ggpht.com/-sFQNguvj5Eo/TMOU6TwZASI/AAAAAAAAAps/JvYbLu153VI/mini4005_R.png"},
		"4006" : {big : "http://lh3.ggpht.com/-FyRRZUULxmI/TMOUUkqxrZI/AAAAAAAAAjo/hbPU10vxNgY/4006_UC.png",	small : "http://lh4.ggpht.com/-5dbFOaq0U9Y/TMOU6pFCFWI/AAAAAAAAApw/iE3MhkdXs8A/mini4006_UC.png"},
		"4007" : {big : "http://lh6.ggpht.com/-HqKuRnEtZZw/TMOUVMCW3UI/AAAAAAAAAjs/I7Q0pRkjPP0/4007_C.png",		small : "http://lh4.ggpht.com/-zZ1bXt6hgok/TMOU67kpv5I/AAAAAAAAAp0/K0rzvCliT2M/mini4007_C.png"},
		"4025" : {big : "http://lh6.ggpht.com/-ue3GXe6VYhU/TMOUVhhQZgI/AAAAAAAAAjw/Yv9OIE3vXFY/4025_SR.png",	small : "http://lh6.ggpht.com/-eRrpaGiEWIc/TMOU7boBMmI/AAAAAAAAAp4/37zpxctxsrY/mini4025_SR.png"},
		"4026" : {big : "http://lh6.ggpht.com/-d0vd96hgy4U/TMOUWNKSqqI/AAAAAAAAAj0/ShsOJEG8Gp4/4026_R.png",		small : "http://lh4.ggpht.com/-bCy-k5N_bOU/TMOU7huScDI/AAAAAAAAAp8/U9iqGwANKew/mini4026_R.png"},
		"4027" : {big : "http://lh3.ggpht.com/-vDtqbTFiv4c/TMOUWnm5w0I/AAAAAAAAAj4/Bu3o1Jk0YTM/4027_UC.png",	small : "http://lh5.ggpht.com/-Gq7KiIlxyBQ/TMOU8EoFz6I/AAAAAAAAAqA/XqXqOJyx2H8/mini4027_UC.png"},
		"4029" : {big : "http://lh5.ggpht.com/-iZ7an7IwqJw/TMOUXLFtWWI/AAAAAAAAAj8/xrpOND9Db9k/4029_R.png",		small : "http://lh4.ggpht.com/-zZKgtvOromE/TMOU8opmvtI/AAAAAAAAAqE/y7_CR6YQiaA/mini4029_R.png"},
		"4031" : {big : "http://lh4.ggpht.com/-ggQonUkSp2g/TMOUXki26vI/AAAAAAAAAkA/MPykzDQ5qIc/4031_UR.png",	small : "http://lh5.ggpht.com/-g057mb26wuI/TMOU82SqcSI/AAAAAAAAAqI/tXaY5x8gKUw/mini4031_UR.png"},
		"4032" : {big : "http://lh5.ggpht.com/-oDiCoH0S4GY/TMOUYLSFpuI/AAAAAAAAAkE/tPmlskMoFBo/4032_SR.png",	small : "http://lh5.ggpht.com/-ATpTfZiGvJ4/TMOU9X-ULPI/AAAAAAAAAqM/aICJqXLSuoo/mini4032_SR.png"},
		"4033" : {big : "http://lh4.ggpht.com/-y1vHJL6eyUM/TMOUYprSnDI/AAAAAAAAAkI/TG2q8rtqAFE/4033_SR.png",	small : "http://lh6.ggpht.com/-hel0pFyOVq8/TMOU9_n_ygI/AAAAAAAAAqQ/VwxRGxb5k4g/mini4033_SR.png"},
		"4034" : {big : "http://lh3.ggpht.com/-BBLUVlJNN-I/TMOUZEb3lSI/AAAAAAAAAkM/Td501sGU6bo/4034_SR.png",	small : "http://lh6.ggpht.com/-nML-048INCI/TMOU-MOyyAI/AAAAAAAAAqU/0THXpe1PPBU/mini4034_SR.png"},
		"4038" : {big : "http://lh5.ggpht.com/-Tri4DBVSvuo/TMclPU4sQJI/AAAAAAAAArk/98Bq-Thq08E/4038_UC.png",	small : "http://lh5.ggpht.com/-3LUqSD-vxQ8/TMclRv5Tt9I/AAAAAAAAAsA/O9wriGDDBHY/mini4038_UC.png"},
		"4039" : {big : "http://lh5.ggpht.com/-nSd40N3yHX4/TSE1GVQmGFI/AAAAAAAAAvU/onDT_HtL79w/4039_UR.png",	small : "http://lh5.ggpht.com/-W6hIQyo7Cfw/TSE1H4-8fMI/AAAAAAAAAvk/wRPf-LA7GjQ/mini4039_UR.png"},
		"4042" : {big : "http://lh3.ggpht.com/-YxtLfx6S78Q/TW3TznofjBI/AAAAAAAAA7w/ub9ZbVI7F58/4042_SR.png",	small : "http://lh6.ggpht.com/--nNRKfWE9H4/TW3T1zS1NAI/AAAAAAAAA8I/pBQSHMlcCU4/mini4042_SR.png"},
		"4046" : {big : "http://lh4.ggpht.com/-2F1qPtMYiX4/TT9wyNTs4BI/AAAAAAAAAwU/dGNaHahxfSw/4046_UC.png",	small : "http://lh5.ggpht.com/-8fTiLKAoeqw/TT9wz1rKLaI/AAAAAAAAAwo/nHJxWucyu5w/mini4046_UC.png"},
		"4047" : {big : "http://lh3.ggpht.com/-_6b0I5nlXFw/TZCCiGASkKI/AAAAAAAABDY/2w55Uy5U6gg/4047_SR.png",	small : "http://lh4.ggpht.com/-u-_xhc4C1Rs/TZCCknJF8oI/AAAAAAAABD4/awQFYPosn2Y/mini4047_SR.png"},
		"4048" : {big : "http://lh4.ggpht.com/-Ua1c7kmbE_Q/TW3T0LKqBAI/AAAAAAAAA70/AmqXTG-w6U8/4048_SR.png",	small : "http://lh4.ggpht.com/-CUtV4_Sca10/TW3T2EOWkeI/AAAAAAAAA8M/IO2rlZ7DEN4/mini4048_SR.png"},
		"4050" : {big : "http://lh5.ggpht.com/-1aUHVy2cx8A/TZCCiaYThhI/AAAAAAAABDc/H0ylhZfXVN4/4050_SR.png",	small : "http://lh3.ggpht.com/-w_XSpOvtk5Y/TZCCk-dnqKI/AAAAAAAABD8/nxkS4UeSc60/mini4050_SR.png"},
		"4051" : {big : "http://lh4.ggpht.com/-fWdLakxRGmY/Tbbbl3e67II/AAAAAAAABEw/OYhBHDHMgfM/4051_UR.png",	small : "http://lh3.ggpht.com/-xqTnAa-A03g/TbbbnAlAPII/AAAAAAAABFA/FZCJL24YBWw/mini4051_UR.png"},
		"4052" : {big : "http://lh3.ggpht.com/-pDdAtOUiaj0/TbbbmfoveXI/AAAAAAAABE0/RO9fO-OqMlU/4052_R.png",		small : "http://lh4.ggpht.com/-hJfIO125Fxk/TbbbnlUfVrI/AAAAAAAABFE/YKcFUgg7XR8/mini4052_R.png"},
		"4053" : {big : "http://lh3.ggpht.com/-0UHrFqB2wgo/Tdp214RxijI/AAAAAAAABFU/U6QERIKs-n4/4053_UR.png",	small : "http://lh6.ggpht.com/-5r12h8jRtK8/Tdp22plxIwI/AAAAAAAABFg/eQKLN_XWlXQ/mini4053_UR.png"},
		"4055" : {big : "http://lh5.ggpht.com/-t5j_uxkBUUo/Ti4pBUala5I/AAAAAAAABJw/Na0lakZ8ix0/4055_UR.png",	small : "http://lh5.ggpht.com/-kO2YGVIfS98/Ti4pCkeIBhI/AAAAAAAABKA/h9muF4mF9Aw/mini4055_UR.png"},
		"4056" : {big : "http://lh5.ggpht.com/-tc70aUVdjYc/Ti4pB0XfnpI/AAAAAAAABJ0/h9lJQexYh88/4056_SR.png",	small : "http://lh6.ggpht.com/-SG-lJWzT8gs/Ti4pC81gvEI/AAAAAAAABKE/d9c01H_M7iQ/mini4056_SR.png"},
		"4059" : {big : "http://lh3.ggpht.com/-_HDOuV0cCzs/ToAECN6WNgI/AAAAAAAABTc/_zWu-El83-8/4059_R.png",		small : "http://lh3.ggpht.com/-k_ujaZsYUho/ToAEDJliZPI/AAAAAAAABTo/04iIBFrfQbk/mini4059_R.png"},
		"4060" : {big : "http://lh5.ggpht.com/-BdtTX_9ulhY/Tqbwch0QylI/AAAAAAAABYc/ddz7lMRr48I/4060_UR.png",	small : "http://lh3.ggpht.com/-gaMKP-vv5qk/Tqbwe2JJgKI/AAAAAAAABY0/r7LeU3aqCMg/mini4060_UR.png"},
		"4063" : {big : "http://lh6.ggpht.com/-qNAEp7X6Ix8/TspwUmc9roI/AAAAAAAABZ8/mW6lxnRJH_w/4063_R.png",		small : "http://lh3.ggpht.com/-OiNwhH_-N2g/TspwWu0q0KI/AAAAAAAABaU/9Zkw8-5oLXM/mini4063_R.png"},
		"4064" : {big : "http://lh4.ggpht.com/-PPo8pbYl7pY/TspwVEH9qSI/AAAAAAAABaI/QgmJlUepXbs/4064_R.png",		small : "http://lh3.ggpht.com/-S1PgP2M1W-E/TspwW9LpU8I/AAAAAAAABaY/uX1FpgZE1fM/mini4064_R.png"},
		"4068" : {big : "http://lh6.ggpht.com/-mXybKpO3MxU/TxwXfQZQ6vI/AAAAAAAAB-o/qMMJpQI4HZA/4068_R.png",		small : "http://lh6.ggpht.com/-a9KfzpV-E2I/TxwXgtbva9I/AAAAAAAAB-4/2WXHGrWt2nI/mini4068_R.png"}
	};
/*faraway120126 start
	};
faraway End 120126*/

	var elements = document.getElementsByClassName('illust');
	for (i = 0; i < elements.length; i++) {
		// 大イラストの置き換え
		if (elements[i].nodeName == 'IMG') {
			var imgname = elements[i].src.substring(elements[i].src.lastIndexOf("/") + 1).substring(0, 4);
			if (illust[imgname] != undefined && illust[imgname] != null) {
				elements[i].src = illust[imgname].big;
			}
		}
		// サムネイルの置き換え
		if (elements[i].nodeName == 'TD' || elements[i].nodeName == 'DIV') {
			var img = elements[i].getElementsByTagName('img')[0];
			if(img !=undefined){
				var imgname = img.src.substring(img.src.lastIndexOf("/") + 1).substring(0, 4);
				if (illust[imgname] != undefined && illust[imgname] != null) {
					img.src = illust[imgname].small;
				}
			}
		}
	}

	// 小イラストの置き換え
	var minielements = document.getElementsByClassName('illustMini');
	for (i = 0; i < minielements.length; i++) {
		var img = minielements[i].getElementsByTagName('img')[0];
		if(img !=undefined){
			var imgname = img.src.substring(img.src.lastIndexOf("/") + 1).substring(0,4);
			if (illust[imgname] != undefined && illust[imgname] != null) {
				img.src = illust[imgname].small;
			}
		}
	}

	// イメージ: 水鏡先生を袁術先生に変更
	var teacher = document.getElementById('teacher');
	if (teacher != null) {
		var random = Math.floor(Math.random() * 6);	// 0?5までの乱数値
		switch (random) {
			case 0:		teacher.src = 'http://lh4.ggpht.com/_yaaM6-lAuRY/TNfkJ53VBtI/AAAAAAAAAtU/fO6qaKBfrXk/teacher_1.png';break;
			case 1:		teacher.src = 'http://lh4.ggpht.com/_yaaM6-lAuRY/TNfkJ4sFEnI/AAAAAAAAAtY/r-L-XnSGQm8/teacher_2.png';break;
			case 2:		teacher.src = 'http://lh4.ggpht.com/_yaaM6-lAuRY/TNfkKLdQJCI/AAAAAAAAAtc/kD8dw97xWxU/teacher_3.png';break;
			case 3:		teacher.src = 'http://lh3.ggpht.com/_yaaM6-lAuRY/TNfkKHSLDfI/AAAAAAAAAtg/wm0YlHobs-Y/teacher_4.png';break;
			case 4:		teacher.src = 'http://lh4.ggpht.com/_yaaM6-lAuRY/TNfkKP8Y7VI/AAAAAAAAAtk/I9rPMmSn2fs/teacher_5.png';break;
			case 5:		teacher.src = 'http://lh3.ggpht.com/_yaaM6-lAuRY/TNfkNVG2ypI/AAAAAAAAAto/Fw5oA8LMYWE/teacher_6.png';break;
		}
	}
	// 名札: "水鏡先生"を"袁術先生"に変更
	var teacher_name = document.getElementById('teacherName');
	if (teacher_name != null) {
		teacher_name.src = 'http://lh3.ggpht.com/_yaaM6-lAuRY/TNfkNpLhUyI/AAAAAAAAAts/fpXRp00rQv0/teacher_name.png';
	}

	// プロフィール背景画像を差し替え
	GM_addStyle('div#header_bottom #profileBtn a { background-image:url("http://lh3.ggpht.com/_yaaM6-lAuRY/TNfm_YvWZxI/AAAAAAAAAt0/jnHgWqKO96Q/profile.png") !important }');

} // 某ゲームのイラストに置き換えるアホツール END ************************************************************************************************************


function disp_URChange() { // 見た目を全部URに置き換えるアホツール START *********************************************************************************
//faraway120125var css = "div.card {\n    background: transparent url(http://s1.1kibaku.jp/20111108-01/extend_project/ikki/img/card/common/bg_card_ur.png)
var css = "div.card {\n    background: transparent url(http://m9.3gokushi.jp/20110117-01/img/card/common/bg_card_ur.png) no-repeat scroll left top !important;\n  }\n  \n  div.cardStatus_rarerity_c,\n  div.cardStatus_rarerity_uc,\n  div.cardStatus_rarerity_r,\n  div.cardStatus_rarerity_sr {\n    background-image: url(http://s1.3gokushi.jp/20100328-01/img/card/common/bg_status_ur.png) !important;\n  }\n  \n  span.level_c,\n  span.level_uc,\n  span.level_r,\n  span.level_sr {\n    background-image: url(http://s1.3gokushi.jp/20100328-01/img/card/common/bg_level_ur.gif) !important;\n  }\n  \n  span.soltype {\n    overflow: hidden;\n    width: 21px;\n  }\n  span.soltype img[title=\"歩兵\"] {\n    padding-left: 21px !important;\n    background-image: url(http://s1.3gokushi.jp/20100513-01/img/card/type/type_501_ur.gif) !important;\n  }\n  span.soltype img[title=\"槍兵\"] {\n    padding-left: 21px !important;\n    background-image: url(http://s1.3gokushi.jp/20100513-01/img/card/type/type_502_ur.gif) !important;\n  }\n  span.soltype img[title=\"騎兵\"] {\n    padding-left: 21px !important;\n    background-image: url(http://s1.3gokushi.jp/20100513-01/img/card/type/type_503_ur.gif) !important;\n  }\n  span.soltype img[title=\"弓兵\"] {\n    padding-left: 21px !important;\n    background-image: url(http://s1.3gokushi.jp/20100513-01/img/card/type/type_504_ur.gif) !important;\n  }";
if (typeof GM_addStyle != "undefined") {
	GM_addStyle(css);
} else if (typeof PRO_addStyle != "undefined") {
	PRO_addStyle(css);
} else if (typeof addStyle != "undefined") {
	addStyle(css);
} else {
	var heads = document.getElementsByTagName("head");
	if (heads.length > 0) {
		var node = document.createElement("style");
		node.type = "text/css";
		node.appendChild(document.createTextNode(css));
		heads[0].appendChild(node); 
	}
}
} // 見た目を全部URに置き換えるアホツール END ************************************************************************************************************


function disp_SRChange() { // 見た目を全部URに置き換えるアホツール START *********************************************************************************
var css = "div.card {\n    background: transparent url(http://m9.3gokushi.jp/20110117-01/img/card/common/bg_card_sr.png) no-repeat scroll left top !important;\n  }";
if (typeof GM_addStyle != "undefined") {
	GM_addStyle(css);
} else if (typeof PRO_addStyle != "undefined") {
	PRO_addStyle(css);
} else if (typeof addStyle != "undefined") {
	addStyle(css);
} else {
	var heads = document.getElementsByTagName("head");
	if (heads.length > 0) {
		var node = document.createElement("style");
		node.type = "text/css";
		node.appendChild(document.createTextNode(css));
		heads[0].appendChild(node); 
	}
}
} // 見た目を全部URに置き換えるアホツール END ************************************************************************************************************


function disp_SENSEIChange() { //水鏡先生"を"袁術先生"に変更に置き換えるアホツール START *****************************************************************
if(document.getElementById('questB3_thumb')){document.getElementById('questB3_thumb').innerHTML = '<img src="http://gyazo.com/86f98f411fc6bc7d0f2c208999bab8f9.png?1336998290"><div style="color:#fff; width:150px; height:30px; text-align:center; background-color:#fcc; background-image:url(../20120508-02/extend_project/w760/img/tutorial/quest_name_bg.png); line-height:25px;">やっぱり 水鏡先生</div>';}}
 // 見た目を全部URに置き換えるアホツール END ************************************************************************************************************



//////////////////////
//スタイル変更
//////////////////////
function cut_main(){
  if(location.pathname != "/run_appli.pl") return;

  GM_addStyle(
//faraway120125    ".appliMainbox01,.gadgetStage, .gadgetStage iframe {width:945px !important;}" +
//faraway120125    ".appliSidebox01 {display:none !important;}"
//faraway120125  );
    ".appliMainbox01,.gadgetStage, .gadgetStage iframe {width:945px !important;}" +
    ".appliSidebox01 {display:none !important;}" +
    ".mixiPointDisplay {display:none !important;}" +
    ".serviceNavigation {display:none !important;}" +
    ".headerLogo {display:none !important;}" +
    ".adBanner {display:none !important;}" +
    ".globalNavigation {display:none !important;}" +
    ".displayMain {display:none !important;}"  );
}

function cut_main1(){
//  GM_addStyle(
//	/*次の１行追加110929*/
//faraway120125    "#buy_cp_btn {display:none !important;}" +
//    "#server_wrapper, #canvas_view #container {width:auto !important;}" +
//    ".serverNews, #serverLatest, #serverList, .serverBrowser {margin:0 auto 10px !important;}" +
//    ".serverNews, #serverList, .serverBrowser {width:742px !important;}" +
//    ".serverItem1 {margin:5px !important;}" +
//    "#serverLatest {width:754px !important;}" +
//    ".serverItemSpace {display:none !important;}" +
//    "#mixi_btn {position:absolute !important; top:50px !important; left:687px !important; background-color:#FFDE49 !important; width:65px !important; !important;}" +
//    "#adsHeader {display:none !important;}" +
//	"#mixi_ad_head, #mixi_ad_groups {display:none !important;}"	//faraway111012　10月11日のメンテの広告の消去
//  );
  GM_addStyle(
 /*次の１行追加110929*/
    "#server_wrapper, #canvas_view #container {width:auto !important;}" +
    ".serverNews, #serverLatest, #serverList, .serverBrowser {margin:0 auto 10px !important;}" +
    ".serverNews, #serverList, .serverBrowser {width:742px !important;}" +
    ".serverItem1 {margin:5px !important;}" +
    "#serverLatest {width:754px !important;}" +
    ".serverItemSpace {display:none !important;}" +
    "#gadget-friend-selector{display:none !important;}" +
//    "#mixi_btn {position:absolute !important; top:50px !important; left:687px !important; background-color:#FFDE49 !important; width:65px !important; !important;}" +
    "#adsHeader {display:none !important;}" +
    "#mapbox div.alliance-base-box-top{left: 260px ! important; top:0px ! important;}" +//同盟拠点
    "#buy_cp_btn {position: absolute; top: 170px !important; left: 773px !important;}" +/*faraway120126160->170*/
    "div#action{left: 415px ! important; top:10px ! important;}" +
    "#mixi_ad_head, #mixi_ad_groups {display:none !important;}" //faraway111012　10月11日のメンテの広告の消去
  );
//ブラ三ニュース
//  GM_addStyle(
//    "#wrapper {margin-top:40px !important;}" +
//    "div.brNews{position:absolute;top:223px;}" 
//  );



}

function cut_main2(){
  GM_addStyle(
    "#ADDSPACE, .appliSidebox01 {display:none !important;}" +
    "#container {width:auto !important;padding: 15px 0px 10px !important;}" +
    "#container #header, #container #tabArea, #container #box {width:auto !important;}" +
    "#header_bottom {background:none !important; height:5px !important;}" +
    "#supportNavi {position:absolute; top:8px; left:680px;}" +
    "#adsHeader {visibility: hidden;}" +
    "#profileBtn {position:absolute; top:8px; left:780px;}" +
    "#btn_area {position:absolute; top:162px; left:770px; width:auto !important; height: auto !important;}" +
    "#btn_area_box {width:auto !important; height: auto !important; padding:0 !important;}" +
    "#btn_area_box a {display:block !important; height:25px; margin-bottom:3px !important;}" +
    "#worldtime {position:absolute; top:65px; left:765px; width:140px !important; height:auto !important; margin:auto !important;}" +
    "#worldtime dl {width:140px !important; height:40px !important;}" +
    "#worldtime * {float:none !important; height:auto !important; margin:auto !important; padding:3px !important; background-image:none !important; background-color:#000;}" +
    "#worldtime dd {border:1px #fd0 solid;}" +
    "#server_time_disp { padding:0 !important;}" +
    "#bptpcp_area {position:absolute; top:107px; left:750px; background:none !important;}" +
    "#buy_cp_btn {position: absolute; top: 160px !important; left: 773px !important;}" +
    "#statusIcon {top:22px !important; left:710px !important; white-space:nowrap !important;}" +  
    "#lodgment {top:158px !important; left:774px !important; background-image:none !important;}" +
    "#lodgment * {background-image:none !important; background-color:#333 !important;}" +
    "#lodgment ul li {padding:2px 0 !important;}" +
    "#lodgment .on {background:#000 !important; padding-left:3px !important; width:120px !important;}" +
    "#lodgment .on span {background:#000 !important;}" +
    ".footer_box {float:none !important;position:absolute; top:640px; left:760px; }" +
    "#whiteWrapper {min-height:550px;}" +
    ".message_textarea_width {min-height:320px;}" +
    "#social {display:none !important;}"// +
  );
//ブラ三ニュース
//  GM_addStyle(
//    "#wrapper {margin-top:40px !important;}" + 
//    "div.brNews {position:absolute !important;top:160px !important;}" +
//  );



  if (DISP_RANK == 1) {
    GM_addStyle("#social {display:none !important;}");
  }
}

//function cut_main2(){	//faraway 120125 置き換え
//  GM_addStyle(
//    "#ADDSPACE, .appliSidebox01 {display:none !important;}" +
//    "#container {width:auto !important;}" +
//    "#container #header, #container #tabArea, #container #box {width:auto !important;}" +
//    "#header_bottom {background:none !important; height:5px !important;}" +
//    "#supportNavi {position:absolute; top:8px; left:680px;}" +
//    "#adsHeader {visibility: hidden;}" +
/* 敵襲ボタン微調整　Auto_Bilder0.0.6βまでの位置調整 */
//    "#profileBtn {position:absolute; top:8px; left:780px;}" +
//    "#btn_area {position:absolute; top:162px; left:770px; height: auto !important; white-space:nowrap !important; margin:auto !important;}" +
//    "#btn_area_box {width:auto !important; height: auto !important; padding:0 !important;}" +
//    "#btn_area_box a {display:block !important; height:25px; margin-bottom:3px !important;}" +
//    "#worldtime {position:absolute; top:65px; left:765px; width:140px !important; height:auto !important; margin:auto !important;}" +
//    "#worldtime dl {width:140px !important; height:40px !important; padding:auto !important;}" +
//    "#worldtime * {float:none !important; height:auto !important; margin:auto !important; padding:3px !important; background-image:none !important; background-color:#000;}" +
//    "#worldtime dd {border:1px #fd0 solid;}" +
//    "#server_time_disp { padding:0 !important;}" +
//    "#buy_cp_btn {position: absolute; top: 160px !important; left: 773px !important;}" +//cp購入
//    "#statusIcon {top:22px !important; left:710px !important; white-space:nowrap !important;}" +
//    "#bptpcp_area {position:absolute; top:107px; left:750px; background:none !important;}" +

//    "#lodgment {top:156px !important; left:774px !important; background-image:none !important;}" +
//    "#lodgment * {background-image:none !important; background-color:#333 !important;}" +
//    "#lodgment ul li {padding:2px 0 !important;}" +
//    "#lodgment .on span {background:#000 !important; margin:0px !important; padding:2px !important; height:14px;}" +
//    "#lodgment .on {background:#000 !important; padding-left:3px !important; width:120px !important;}" +
//    ".footer_box {float:none !important;position:absolute; top:640px; left:760px; }" +
//    "#whiteWrapper {min-height:550px;}" +
//    ".message_textarea_width {min-height:320px;}"//拠点リンク
//  );
//  if (DISP_RANK == 1) {
//    GM_addStyle("#social {display:none !important;}");
//  }
//}


// common関数拡張

function cinsertSideBox(insPos,insNode) {
    var sideboxes = $a(".//div[@id=\"beyond_fixpanel\"]/div[@class=\"sideBox\"]");
    var srt = new Array();
    var pos = 0;
    var insNodeId = insNode.sideBox.id;
    for(var i=0 ; i<sideboxes.length ; i++) {
        var conf = cloadData( sideboxes[i].id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
        pos = conf.pos;
        if (insPos <= conf.pos && insNodeId != sideboxes[i].id) {
            pos++;
        }
        else if (insNodeId == sideboxes[i].id) {
            pos = insPos;
        }
        srt.push({"node":sideboxes[i], "pos":pos});
    }

    srt.sort( function(a,b) {return a.pos - b.pos;});

    for(var i=0 ; i<srt.length ; i++){
        srt[i].node.parentNode.removeChild(srt[i].node);
    }
    var fixpanel = $("beyond_fixpanel");
    for(var i=0 ; i<srt.length ; i++){
        fixpanel.appendChild(srt[i].node);
    }
}

function cgetCurrentVillageId() {
    var xy = cgetCurrentBaseXY();
    return VILLAGES_INFO[(xy.x+"_"+xy.y).replace(/-/g,"m")].vid;
}

function chasVillageId(vid) {
    vid = parseInt(vid,10);
    var vids = cgetVillageIds();
    return vids[vid] ? true : false;
}

function cgetVillageIds() {
    var ret = new Object();
    for (var key in VILLAGES_INFO) {
        if (isNaN(""+VILLAGES_INFO[key].vid)) {
            continue;
        }
        ret[VILLAGES_INFO[key].vid] = VILLAGES_INFO[key].vid;
    }
    return ret;
}


// element , pre 1:next0,skipCount
function cgetElementSibling(element,direction,skipCount) {
    var hasElementSibling = (typeof element.nextElementSibling == 'object' || typeof element.previousElementSibling == 'object') ? true : false;
    if (!skipCount) skipCount = 1;
    for (var i = 0;i < skipCount;) {
        if (hasElementSibling) {
            i++;
            if (direction == 1) {
                element = element.previousElementSibling;
            }
            else {
                element = element.nextElementSibling;
            }
        }
        else {
            if (direction == 1) {
                element = element.previousSibling;
            }
            else {
                element = element.nextSibling;
            }
            if (element.nodeType == 1) {
                i++;
            }
        }

        if (element == null) {
            break;
        }
    }
    return element;
}

// areaから四方のareaを取得
function cgetSquareElementFromArea(area) {
    var coords = area.getAttribute('coords');
    var matches = null;
    if (!coords || !(matches = coords.match(/^(\d+),(\d+)/))) return false;
    var base = new Object();
    base.x = parseInt(matches[1],10);
    base.y = parseInt(matches[2],10);

    var $x = function(xp,dc) { return d.evaluate(xp, dc||d, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };

    var add = new Object();
    add.x = 50;
    add.y = 25;

    var isMap = false;

    if (0 <= location.pathname.indexOf("map.php")) {
        isMap = true;
//		var size = parseInt($x('id("changemapscale")//li[contains(concat(" ",normalize-space(@class)," ")," now ")]').className.match(/sort(\d+) /)[1],10);
		//地図51×51対応
		var size = parseInt($x('id("change-map-scale")//li[contains(concat(" ",normalize-space(@class)," ")," now ")]').className.match(/sort(\d+) /)[1],10);
        switch (size) {
        case 20:
            add.x = 16;
            add.y = 8;
            break;
        case 15:
            add.x = 22;
            add.y = 11;
            break;
        default:
            add.x = 30;
            add.y = 15;
            break;
        }

        base.y += add.y * 2;
    }

    var xpaths = {ne:calc(base,add,0),nw:calc(base,add,1),se:calc(base,add,2),sw:calc(base,add,3)};

    var ret = new Object();
    for (var key in xpaths) {
        ret[key] = $x('//area[@coords="' + xpaths[key] + '"]');
    }
    return ret;

    // direction ne:0 nw:1 se:2 sw:3
    function calc(base,add,direction) {
        var addX = (direction % 2) == 0 ? add.x : - add.x;
        var addY = direction < 2 ? - add.y : add.y;

        var retBaseX = base.x + addX;
        var retBaseY = base.y + addY;

        var top = [retBaseX, retBaseY - (add.y * 2)];
        var left = [retBaseX - add.x, retBaseY - add.y];
        var bottom = [retBaseX, retBaseY];
        var right = [retBaseX + add.x, retBaseY - add.y];
        var ret = isMap ? top.concat(left,bottom,right) : bottom.concat(left,top,right);
        return ret.join(",");
    }
}

// areaからx,y,name,lvを返す
function cgetFacilityInfoFromArea(area) {
    var retObj = {name:"",lv:0,x:-1,y:-1};
    var matches = null;
    if (area.alt) {
        if ((matches = area.alt.match(/^([^ ]+)[^\d]+(\d+)/))) {
            retObj.name = matches[1];
            retObj.lv = parseInt(matches[2],10);
        }
        else {
            retObj.name = area.alt;
        }
    }

    if (area.href && (matches = area.href.match(/(?:x=(\d+)&y=(\d+))/))) {
        retObj.x = parseInt(matches[1],10);
        retObj.y = parseInt(matches[2],10);
    }

    return retObj;
}

function caddSessionId(url) {
    if (0 < SID.length && url.search(/(\?|&)SSID=[^&]+&?/i) < 0) {
        var anchor = '';
        var matches;
        if ((matches = url.match(/#[^#]+$/))) {
            url = url.substring(0,url.lastIndexOf('#'));
            anchor = matches[0];
        }
        url += 0 <= url.indexOf('?') ? '&' : '?';
        url += SID;
        url += anchor;
    }
    return url;
}


// その他拡張
//JSONとprototype.jsの衝突回避用
function toJSON(obj) {
    switch (typeof obj) {
    case 'string':
        return quote(obj);
    case 'number':
        return isFinite(obj) ? String(obj) : 'null';
    case 'boolean':
    case 'null':
        return String(obj);
    case 'object':
        if (!obj) {
            return 'null';
        }

        if (obj instanceof Date) {
            return isFinite(obj) ? obj.getUTCFullYear() + '-'
                    + complementZero(obj.getUTCMonth() + 1) + '-'
                    + complementZero(obj.getUTCDate()) + 'T'
                    + complementZero(obj.getUTCHours()) + ':'
                    + complementZero(obj.getUTCMinutes()) + ':'
                    + complementZero(obj.getUTCSeconds()) + 'Z' : 'null';
        }

        var partial = new Array();
        var prefix = '{';
        var suffix = '}';
        if (obj instanceof Array) {
            prefix = '[';
            suffix = ']';

            length = obj.length;
            for ( var i = 0; i < length; i++) {
                partial[i] = toJSON(obj[i]) || 'null';
            }
        } else {
            for ( var key in obj) {
                if (Object.hasOwnProperty.call(obj, key)) {
                    partial.push(quote(key) + ':'
                            + (toJSON(obj[key]) || 'null'));
                }
            }
        }

        return prefix + partial.join(',') + suffix;
        break;
    default:
        return null;
    }

    function quote(str) {
        var escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
        var meta = { // table of character substitutions
            '\b' : '\\b',
            '\t' : '\\t',
            '\n' : '\\n',
            '\f' : '\\f',
            '\r' : '\\r',
            '"' : '\\"',
            '\\' : '\\\\'
        };

        return escapable.test(str) ? '"'
                + str.replace(escapable,
                        function(a) {
                            var c = meta[a];
                            return typeof c === 'string' ? c : '\\u'
                                    + ('0000' + a.charCodeAt(0).toString(16))
                                            .slice(-4);
                        }) + '"' : '"' + str + '"';
    }

    function complementZero(number) {
        return number < 10 ? '0' + number : number;
    }
}
}) ();
//faraway beyond本体終了 ========================================================================

//faraway 1.地図ツールのソース(bro3_map_tool.user.js) 開始
// ==UserScript==
// @name           bro3_map_tool
// @namespace      http://blog.livedoor.jp/froo/
// @include        http://*.3gokushi.jp/map.php*
// @include        http://*.3gokushi.jp/alliance/info.php*
// @include        http://*.3gokushi.jp/user/*
// @include        http://*.3gokushi.jp/facility/castle_send_troop.php*
// @include        http://*.1kibaku.jp/map.php*
// @include        http://*.1kibaku.jp/alliance/info.php*
// @include        http://*.1kibaku.jp/user/*
// @description    ブラウザ三国志 地図ツール by 浮浪プログラマ(どらごら改造バージョン4+ex3)
// ==/UserScript==

// 公開ページ: http://blog.livedoor.jp/froo/archives/51365945.html
// 使い方: 全体地図ページ左下「地図ツール」の各リンクをクリック
//
// どらごらバージョン：http://doragora.blog86.fc2.com/blog-entry-3.html

//**************
// 改造履歴 by どらごら
// Ver 2.33.d1 2010/06/14
//		・中域画面で59x59の一括取得
// Ver 2.36.d2 2010/08/31
//		・ベースを2.36に変更
//		・遠征支援機能を追加
//		・jQuery対応コード追加
//		・出兵画面に簡易出兵先情報を表示
//		・君主数10→20拡張、同盟数10→20拡張
//		・その他色々
// Ver 2.36.d3 2010/09/21
//		・１画面内に自同盟のマスが無い場合、配下同盟の処理が正しく行われないのを修正
//			※オリジナルの潜在バグだと思われるので暫定対応
// Ver 2.37.d4 2010/10/03
//　　・ベースを2.37に変更
//　　・中画面でかならず白で枠を表示するように変更
//　　・初起動時に遠征機能にチェックが入っているのに、画面が表示されないのを修正
//			※そもそも初期値は遠征機能無効
//　　・オリジナルから増えたメモリ消費をなるべく抑える。(１学期中間テスト)
//		・画面遷移する時、昔のゴミコードがあったのを削除
//**************
// <><><><><><><><><><><> attention(注意) <><><><><><><><><><><>
// ・どらごら改造バージョンは、Google Chrome未テストです。
// ・変更箇所は「どらごら」で検索した前後をオリジナルバージョンと
// 　比較する事により、区別出来るようにしてあります。
// <><><><><><><><><><><> attention(注意) <><><><><><><><><><><>
//**************
//
//　Ver 2.37.d4ex 2010/12/27 拡張 by mmc
//　・君主、同盟登録拡張（20→30まで）
//　・君主、同盟のカンマ区切り登録対応
//　・99×99データ取得（59×59のさらに一回り分を取得）
//
//　Ver 2.37.d4ex1	2011/01/08 拡張 by mmc
//　・中域マップでの出兵先戦力（防御力）参照機能追加。
//
//　Ver 2.37.d4ex2	2011/01/20 拡張 by mmc
//　・期数の選択をチェックボックスからラジオボタンへ変更。
//　・２期、３期の★４戦力について平地23および20の両方を表示するように対応。
//
//　Ver 2.37.d4ex3	2011/02/17 拡張 by mmc
//　・３期森10の★ランク誤りの修正。
//　・中域マップのプチワイド対応。（半径25→34への切り替え。99×99取得の機能を吸収）
//　・中域マップでのポップウインドウに賊討伐時の入手資源を表示するように対応。
//
//　Ver 2.37.d4ex4	2011/03/24 拡張 by mmc
//　・１期★６(森10)のデータ記載ミスの修正。
//　・中域マップでのプチワイド時の全範囲取得の範囲を調整（5×5＝25画面分を4×4=16画面分に変更）
//　・広域マップでの前半に取得に対応。（13×13＝169画面取得します時間がかかるので注意）
//　・全範囲取得時の進捗を表示するように対応。
//　・全範囲取得によるデータ取得にて中域画面での本拠地の目印（四角の点線で囲まれる）の設定がおかしくなる不具合を修正。
//　　　→データ取得した座標が変数に反映されていないので、別のエリアの拠点をセットしている。
//　　　→またマップデータ取得の際、拠点フラグを毎回クリアしていたので「人数なし（≒拠点ではない）」という条件を追加。
//　・中域画面での本拠地表示の文字を「P」→「C」（Castle）に変更。
//
//　Ver 2.39.d4ex1	2011/04/13 拡張 by mmc
//　・本家「浮浪プログラマ」氏のバージョンアップ反映。2.37→2.39
//　　　ブラウザ一騎当千の対応 from 2.38
//　　　51×51マップ対応 from 2.39	※既に対応済みの為バージョンのみ移行
//　・峡域マップが20×20以外のときに全範囲取得すると本拠地情報が正しくセットされない不具合の修正。
//　・不正にセットされた本拠地情報の補正。
//　・同盟画面での同盟情報詳細csv取得の機能の追加。
//
//　Ver 2.39.d4ex2	2011/04/20 拡張 by mmc
//　・戦力データについて、５期を追加。
//　・中域マップのチップツールによる入手資源の表示に、範囲と期待値を選択できるように対応。
//　・中域マップの下部のレイアウト変更（あまり頻繁に変更しない設定について隠す）
//　・バージョン表記をボタンテキストに変更し、そのボタン押下により上記設定を表示するように修正。
//　・峡域マップでの資源アイコン表示のoff機能追加。（Ver 2.39.d4ex1βの機能です）
//
//　Ver 2.39.d4ex3	2011/09/30 拡張 by mmc
//　・中域マップでの資源領地の色分け対応。
//**************
//faraway 変数宣言移動前の場所

//main
//faraway(function(){
function disp_maptool(){//faraway メイン関数の関数名を再設定
//window.alert("1.地図ツール:" + location.pathname);	//faraway
	map_hostname =  "map_"+ location.hostname;	////location.hostnameが付いたﾃﾞｰﾀを削除する為、地図ﾂｰﾙのものは、"map_"+location.hostnameにして他に影響が出ないようにした。faraway111013
	//mixi鯖障害回避用: 広告iframe内で呼び出されたら無視
	var container = document.evaluate('//*[@id="container"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	if (container.snapshotLength == 0) return;
	
	initGMWrapper_1();
	BASE_TIME = getBaseTime();
	ALLYS_INDEX = GM_getValue(map_hostname + "ALLYS_INDEX", "").split(DELIMIT_1);
	USERS_INDEX = GM_getValue(map_hostname + "USERS_INDEX", "").split(DELIMIT_1);
	
	// jQuery append by どらごら
	jQueryAppend();
	
	// オプション読み出し by どらごら
	ROUTE_ENABLE = GM_getValue(map_hostname + "route_enable", false);
	CURSOR_ENABLE = GM_getValue(map_hostname + "cursor_flg", false);
	
	// 競合回避 by どらごら
	if( document.getElementById('route_output') != null) {
		ROUTE_ENABLE = false;
	}
	//地図ページ
	if (location.pathname == "/map.php") {
		
		//地図サイズ
		MAP_SCALE = getMapScale();
		
		//中心座標取得
		CENTER_X = parseInt(getParameter_1("x"));
		if (isNaN(CENTER_X)) CENTER_X = 0;
		CENTER_Y = parseInt(getParameter_1("y"));
		if (isNaN(CENTER_Y)) CENTER_Y = 0;
		
		//マップモード取得
		MAP_MODE = GM_getValue(map_hostname + "MAP_MODE", "");
		//GM_setValue(map_hostname + "MAP_MODE", "");
		if((ROUTE_ENABLE) && (GM_getValue(map_hostname + "default_mapM", "false") == true)) {
			// 中域画面が標準 by どらごら
			if(MAP_MODE == "") MAP_MODE = MAP_MODE_M;
		} else {
			GM_setValue(map_hostname + "MAP_MODE", "");
		}
		
		//自拠点座標取得
		var xy = getMyXY_1();
		if (xy == "") {
			MY_X = 0;
			MY_Y = 0;
		} else {
			MY_X = parseInt(xy.split(",")[0]);
			MY_Y = parseInt(xy.split(",")[1]);
		}
		
		//名称取得
		USERS = loadNames("USERS");
		ALLYS = loadNames("ALLYS");
		MAP_MATE_NAMES	= MAP_MATE_NAMES_DEF;

		//色取得
		USER_COLORS = loadColors("USER_COLORS", USER_COLORS_DEF);
		ALLY_COLORS = loadColors("ALLY_COLORS", ALLY_COLORS_DEF);
		MAP_MATE_COLORS	= loadColors("MAP_MATE_COLORS", MAP_MATE_COLORS_DEF);
		
		//NPC表示フラグ
		DISP_NPC_YET = GM_getValue(map_hostname + "DISP_NPC_YET", true);
		DISP_NPC_FALLEN = GM_getValue(map_hostname + "DISP_NPC_FALLEN", false);
		
		//期数
		DISP_PERIOD1 = GM_getValue(map_hostname + "DISP_PERIOD1", true);
		DISP_PERIOD2 = GM_getValue(map_hostname + "DISP_PERIOD2", false);
		DISP_PERIOD3 = GM_getValue(map_hostname + "DISP_PERIOD3", false);
		DISP_PERIOD4 = GM_getValue(map_hostname + "DISP_PERIOD4", false);
		DISP_COMPROMISE = GM_getValue(map_hostname + "DISP_COMPROMISE", 70);

		//プチワイド
		MAP_WIDE = GM_getValue(map_hostname + "MAP_WIDE", false);
		if (MAP_WIDE){
			RADIUS = 38; 		//半径（中域）
			CELL_SIZE_M = 9;	//中域地図の1マスサイズ(px)
			FONT_SIZE = "7px";	//中域地図のマス内文字サイズ
		} else {
			RADIUS = 25;		//半径（中域）
			CELL_SIZE_M = 14;	//中域地図の1マスサイズ(px)
			FONT_SIZE = "10px";	//中域地図のマス内文字サイズ
		}

		//資源表示
		DISP_MATERIAL = GM_getValue(map_hostname + "DISP_MATERIAL", false);
		DISP_PICTURE = GM_getValue(map_hostname + "DISP_PICTURE", true);

		//マップ色モード
		MAP_COLOR_MODE	= GM_getValue(location.hostname + "MAP_COLOR_MODE", false);

		//完全一致フラグ
		MATCH_FULL = GM_getValue(map_hostname + "MATCH_FULL", false);

		window.setTimeout(ChangePicture, 0);
		saveMapData();
		window.setTimeout(saveCapital, 0);
		window.setTimeout(saveAllyForMap, 0);
		window.setTimeout(markChangeArea, 0);
		window.setTimeout(defaultTargets, 0);
		window.setTimeout(addMapHtml, 0);
		window.setTimeout(changeMap, 0);

	//同盟トップページ
	} else if (location.pathname == "/alliance/info.php") {
		saveAllyForAllyInfo();
		allianceCSV_1();

	//君主プロフィールページ
	} else if (location.pathname == "/user/" || location.pathname == "/user/index.php") {
		saveUserForProf();
	// 出兵画面 by どらごら
	} else if (location.pathname == "/facility/castle_send_troop.php") {
		sendTroop();
	}
	
	window.setTimeout(saveAllysIndex, 0);
	window.setTimeout(saveUsersIndex, 0);
//faraway})();
}	//faraway
//地図データ保存
function saveMapData() {
	saveMapData2(document);
}
function saveMapData2(dom) {
	var areas = dom.evaluate('//*[@id="mapOverlayMap"]//area/@onmouseover', 
		dom, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	
	for (var i = 0; i < areas.snapshotLength; i++) {
		rowText = areas.snapshotItem(i).textContent;
		rowText = rowText.replace(/^.*mapInfoView/, "mapInfoViewCustom");
		rowText = rowText.replace(/^.*rewrite/, "mapInfoViewCustom");
		rowText = rowText.replace(/\); .*$/, ");");
		eval(rowText);
	}
}
function mapInfoViewCustom(h,k,g,l,e,c,b,f,j,d,i,a) {
	window.setTimeout(function() {
		var key = map_hostname + l;
		var xy = l.replace(/^\((-?[0-9]+\,-?[0-9]+)\)$/, "$1");
		
		//前セルデータ取得
		var data = loadCellData(key);
		
		//保存データ作成
		data = updateMapCellBefore(data);
		data[IDX_VILLAGE_NAME] = h; //地名
		data[IDX_USER_NAME] = k; //君主名
		data[IDX_POPULATION] = (g=="-") ? "" : g; //人口
		data[IDX_ALLIANCER] = e; //同盟名
		data[IDX_POWER] = c; //戦力
		data[IDX_WOOD] = f; //森
		data[IDX_STONE] = j; //岩
		data[IDX_IRON] = d; //鉄
		data[IDX_RICE] = i; //穀
		data[IDX_NPC_FLG] = a; //NPC拠点
		if (data[IDX_CAPITAL_FLG] != "C" || data[IDX_POPULATION] == ""){
			data[IDX_CAPITAL_FLG] = "";	//人口なしまたは最新のフラグ以外はクリア
		}
		
		//Greasemonkey領域に永続保存
		saveCellData(key, data);
		
		//同盟⇔君主→拠点関係性情報更新
		if (data[IDX_USER_NAME] != "") {
			//君主所属同盟情報更新
			updateAllyMember(data[IDX_USER_NAME], data[IDX_ALLIANCER]);
			
			//拠点情報更新
			if (data[IDX_POPULATION] != "" || data[IDX_NPC_FLG] == "1") {
				var userData = getUserDataCache(data[IDX_USER_NAME]);
				if (searchArrayItem(userData[IDX_USER_VILLAGES], xy) < 0) {
					userData[IDX_USER_VILLAGES].push(xy);
					saveUserData(data[IDX_USER_NAME], userData);
				}
			}
		}
		
		//NPC砦を登録
		if (data[IDX_NPC_FLG] == "1") {
			saveNpcsIndex(xy);
		}
	}, 0);
}

//前所有者情報が基準時刻より古かったら更新
function updateMapCellBefore(data) {
	if (data[IDX_TIME_BEFORE] == undefined || 
		data[IDX_TIME_BEFORE] < BASE_TIME) {
		
		data[IDX_TIME_BEFORE] = getCurrentTime2(); //前所有者更新時刻
		data[IDX_USER_BEFORE] = data[IDX_USER_NAME]; //前君主
		data[IDX_ALLY_BEFORE] = data[IDX_ALLIANCER]; //前同盟
	}
	return data;
}

//地図のマスデータを保存
function saveCellData(key, data) {
	
	//初回表示時の変更チェックを回避
	if (data[IDX_USER_BEFORE] == undefined) {
		data[IDX_USER_BEFORE] = data[IDX_USER_NAME];
	}
	if (data[IDX_ALLY_BEFORE] == undefined) {
		data[IDX_ALLY_BEFORE] = data[IDX_ALLIANCER];
	}
	
	//最終更新日時
	data[IDX_LAST_UPDATE] = getCurrentTime();
	
	//Greasemonkey領域に永続保存
	GM_setValue(key, genDelimitString_1(data, DELIMIT_1));
//console.log(key + ": " + data);
	CELLS_CACHE[key] = data;
}

//地図のマスデータを読み込み
function loadCellData(key) {
	var data = new Array();
	
	//Greasemonkey領域から取得
	var dataStr = GM_getValue(key);
	if (dataStr != undefined) {
		data = dataStr.split(DELIMIT_1);
	}
	
	return data;
}

//地図のマスデータのキャッシュを取得
function getCellDataCache(key) {
	if (CELLS_CACHE[key] == undefined) {
		CELLS_CACHE[key] = loadCellData(key);
	}
	return CELLS_CACHE[key];
}

//本拠地フラグ保存
function saveCapital() {
	// by どらごら
	saveCapital2(document);
}
function saveCapital2(dom) {
	var myAlly;
	var imgs = dom.evaluate('//*[@id="mapsAll"]//img', 
		dom, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	
	for (var i = 0; i < imgs.snapshotLength; i++) {
		var className = imgs.snapshotItem(i).className;
		var src = imgs.snapshotItem(i).src;
		
		if (!className.match(/mapAll[0-9]+/)) {
			continue;
		}
		
		if (src.match(/capital_[a-z]+_[a-z]+\.png$/)) {
			var xy = getXyFromMapClass(className);
			var key = generateCellKey(xy[0], xy[1]);
			var data = getCellDataCache(key);
			data[IDX_CAPITAL_FLG] = "C";
			saveCellData(key, data);
		}
	}
}

//配下同盟データ保存（全体地図ページ）
function saveAllyForMap() {
	// by どらごら
	saveAllyForMap2(document);
}
function saveAllyForMap2(dom) {
	var myAlly;
	var depAllys = new Array(); //自同盟の配下である同盟
	var aloneAllys = new Array(); //自同盟の配下でない同盟
	var imgs = dom.evaluate('//*[@id="mapsAll"]//img', 
		dom, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	
	for (var i = 0; i < imgs.snapshotLength; i++) {
		var className = imgs.snapshotItem(i).className;
		var src = imgs.snapshotItem(i).src;
		
		if (!className.match(/mapAll[0-9]+/)) {
			continue;
		}
		
		if (src.match(/_b_.\.png$/) || src.match(/_g_.\.png$/)) {
			if (myAlly == undefined) {
				myAlly = getAllyFromMapClass(className);
			}
		} else if (src.match(/_bk_.\.png$/)) {
			var allyName = getAllyFromMapClass(className);
			depAllys[allyName] = allyName;
		} else {
			var allyName = getAllyFromMapClass(className);
			aloneAllys[allyName] = allyName;
		}
	}
	
	// 自同盟名を取得する事で、下記直後の条件文が真になるようにする by どらごら
	myAlly = getAllyFromXy(MY_X, MY_Y);
	
	//Greasemonkey領域に永続保存
	if (myAlly != undefined && myAlly != "") {
		
		//自同盟の配下である同盟
		for (var i in depAllys) {
		if(i=="each") break;//faraway110606　全範囲取得の0/9,1/9...9/9が表示されない現象に対応
			updateParentAlly(i, myAlly);
		}
		
		//自同盟の配下でない同盟
		for (var i in aloneAllys) {
			var before = getParentAlly(i);
			
			//かつては自同盟配下だった同盟
			if (before == myAlly) {
				updateParentAlly(i, "");
			}
		}
	}
}

//配下同盟データ保存（同盟情報ページ）
function saveAllyForAllyInfo() {
	
	//「略称」欄取得
	var myAlly = "";
	var myAllyElem = document.evaluate(
		'//*[@id="gray02Wrapper"]//table/tbody/tr[3]/td',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	if (myAllyElem.snapshotLength == 0) return;
	myAlly = myAllyElem.snapshotItem(0).innerHTML;
	//「状態」欄取得
	var parentAlly = "";
	var statElem = document.evaluate(
		'//*[@id="gray02Wrapper"]//table/tbody/tr[6]/td',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	
	if (statElem.snapshotItem(0).innerHTML.match(/親同盟/)) {
		var parentAllyElem = document.evaluate(
			'//*[@id="gray02Wrapper"]//table/tbody/tr[6]/td/a',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		if (parentAllyElem.snapshotLength >= 1) {
			parentAlly = parentAllyElem.snapshotItem(0).innerHTML;
		}
	}
	
	//Greasemonkey領域に永続保存
	updateParentAlly(myAlly, parentAlly);
}

//君主領地データ保存（プロフィールページ）
function saveUserForProf() {
	
	//「君主」欄取得
	var user = "";
	var userElem = document.evaluate(
		'//*[@id="gray02Wrapper"]//table/tbody/tr[2]/td[2]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);

	user = userElem.snapshotItem(0).innerHTML;
	//「同盟」欄取得
	var ally = "";
	var allyElem = document.evaluate(
		'//*[@id="gray02Wrapper"]//table/tbody/tr[4]/td[5]/a',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	ally = allyElem.snapshotItem(0).innerHTML;
	//「国情報」欄取得
	var landElems = document.evaluate(
		'//*[@id="gray02Wrapper"]//table/tbody/tr',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var isLandList =false;
	var villages = new Array();
	for (var i=0; i<landElems.snapshotLength; i++) {
		var item = landElems.snapshotItem(i);
		if(getChildElement_1(item, 0)==undefined) continue;
		if (!isLandList) {
			if (trim_1(getChildElement_1(item, 0).innerHTML) == "名前") {
				isLandList = true;
			}
			continue;
		}
		
		//地名を取得
		var landall = getChildElement_1(item, 0).innerHTML;
		var land = trim_1(getChildElement_1(getChildElement_1(item, 0), 0).innerHTML);

		//座標を取得
		var xySrc = getChildElement_1(item, 1).innerHTML;
		xySrc = "" + xySrc.match(/-?[0-9]+\,-?[0-9]+/i);
		var xy = xySrc.split(",");
		var x = xy[0];
		var y = xy[1];
		if (!isNumeric_1(x) || !isNumeric_1(y)) continue;
		
		//人口を取得
		var popul = getChildElement_1(item, 2).innerHTML;
		if (!isNumeric_1(popul)) popul = "";
		
		//マスデータを更新
		var key = generateCellKey(x, y);
		var data = loadCellData(key);
		data = updateMapCellBefore(data);
		data[IDX_VILLAGE_NAME] = land;
		data[IDX_USER_NAME] = user;
		data[IDX_POPULATION] = popul;
		data[IDX_ALLIANCER] = ally;
		data[IDX_CAPITAL_FLG] = (landall.match(/本拠地/) ? "C" : "");
		saveCellData(key, data);
		
		//拠点の場合、座標を別領域に保存
		if (popul != "") {
			villages.push(xy);
		}
	}
	
	//同盟所属情報を更新
	updateAllyMember(user, ally);
	
	//君主の拠点データを更新
	var userData = getUserDataCache(user);
	userData[IDX_USER_VILLAGES] = villages;
	saveUserData(user, userData);
}

//MapタグのClass属性から同盟名を取得
function getAllyFromMapClass(className) {
	var xy = getXyFromMapClass(className);
	var data = getCellDataCache(generateCellKey(xy[0], xy[1]));
	var ally = data[IDX_ALLIANCER];
	if (ally == undefined) ally = "";
	
	return ally;
}

//MapタグのClass属性から座標を取得
function getXyFromMapClass(className) {
	var mapNo = parseInt(trimZero_1(className.replace(/mapAll/, "")));
    var x = CENTER_X - Math.floor((MAP_SCALE-1)/2) + Math.floor((mapNo-1) / MAP_SCALE);
    var y = CENTER_Y + Math.floor((MAP_SCALE-1)/2) - ((mapNo-1) % MAP_SCALE);
	return new Array(x, y);
}

//HTML要素追加
function addMapHtml() {
	var rootElem = document.createElement("div");
	rootElem.id = "maptool";
	
	var mapElem = document.evaluate('//*[@id="mapboxInner"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	mapElem.snapshotItem(0).insertBefore(
//20120524	rootElem, document.getElementById("mapAll").nextSibling);
		rootElem, document.getElementById(mapAllId).nextSibling);
	addLinkHtml(rootElem);
	addBodyHtml(rootElem);
	addHeadHtml(rootElem);
	if (navigator.userAgent.toLowerCase().indexOf('chrome') < 0) {
		initPopup();
	}
}

//地図ツールOpenリンク追加
function addLinkHtml(parentElem) {
	var addElem = document.createElement("div");
	parentElem.appendChild(addElem);
	addElem.id = "maptoolLink";
	addElem.style.margin = "4px 2px";
	
	//タイトル
	var titleElem =  document.createElement("span");
	titleElem.innerHTML = "地図ツール";
	titleElem.style.margin = "2px 2px";
	addElem.appendChild(titleElem);
	
	//aタグ（中域地図）
	var linkElem =  document.createElement("a");
	linkElem.id = "maptoolOpen";
	linkElem.href = "javascript:void(0);";
	linkElem.innerHTML = "中域";
	linkElem.style.backgroundColor = "black";
	linkElem.style.padding = "2px 4px";
	linkElem.style.margin = "2px 2px";
	addElem.appendChild(linkElem);
	
	//aタグ（広域地図）
	var linkElem2 =  document.createElement("a");
	linkElem2.id = "maptoolOpenL";
	linkElem2.href = "javascript:void(0);";
	linkElem2.innerHTML = "広域";
	linkElem2.style.backgroundColor = "black";
	linkElem2.style.padding = "2px 4px";
	linkElem2.style.margin = "2px 2px";
	addElem.appendChild(linkElem2);
	
	//aタグ（CSV出力S）
	var csvSizeS = CSV_RADIUS_S * 2 + 1;
	var linkElemCsvS =  document.createElement("a");
	linkElemCsvS.id = "maptoolCsvS";
	linkElemCsvS.href = "javascript:void(0);";
	linkElemCsvS.innerHTML = "CSV" + 
		"<span style='font-size:9px'>" + csvSizeS + "x" + csvSizeS + "</span>";
	linkElemCsvS.style.backgroundColor = "black";
	linkElemCsvS.style.padding = "2px 4px";
	linkElemCsvS.style.margin = "2px 2px";
	addElem.appendChild(linkElemCsvS);
	
	//aタグ（CSV出力L）
	var csvSizeL = CSV_RADIUS_L * 2 + 1;
	var linkElemCsvL =  document.createElement("a");
	linkElemCsvL.id = "maptoolCsvL";
	linkElemCsvL.href = "javascript:void(0);";
	linkElemCsvL.innerHTML = "CSV" + 
		"<span style='font-size:9px'>" + csvSizeL + "x" + csvSizeL + "</span>";
	linkElemCsvL.style.backgroundColor = "black";
	linkElemCsvL.style.padding = "2px 4px";
	linkElemCsvL.style.margin = "2px 2px";
	addElem.appendChild(linkElemCsvL);
	
	//イベントリスナー（中域地図）
	linkElem.addEventListener("click",
		function() {
			MAP_MODE = MAP_MODE_M;
			changeMap();
		},
		true);
	
	//イベントリスナー（広域地図）
	linkElem2.addEventListener("click",
		function() {
			MAP_MODE = MAP_MODE_L;
			changeMap();
		},
		true);
	
	//イベントリスナー（CSV出力S）
	linkElemCsvS.addEventListener("click",
		function() {
			outputMapCsvS();
		},
		true);
	
	//イベントリスナー（CSV出力L）
	linkElemCsvL.addEventListener("click",
		function() {
			outputMapCsvL();
		},
		true);
	
	//初期化機能
//faraway110618 firefox4.0.1にﾊﾞｰｼﾞｮﾝｱｯﾌﾟしたら初期ﾎﾞﾀﾝが表示されない為	if (navigator.userAgent.toLowerCase().indexOf('chrome') >= 0) {
//	if (navigator.userAgent.toLowerCase().indexOf('chrome') >= 0) {
	
		//aタグ
		var linkElemClr =  document.createElement("a");
		linkElemClr.id = "maptoolClr";
		linkElemClr.href = "javascript:void(0);";
		linkElemClr.innerHTML = "初期化";
		linkElemClr.style.backgroundColor = "black";
		linkElemClr.style.padding = "2px 4px";
		linkElemClr.style.margin = "2px 2px";
		addElem.appendChild(linkElemClr);
		
		//イベントリスナー
		linkElemClr.addEventListener("click",
			function() {
				if (confirm("地図ツールデータを初期化します: " + map_hostname)) {
					clearAllData();
					location.reload();
				}
			},
			true);
//	}
}

//ヘッダ部HTML追加
function addHeadHtml(parentElem) {
	var addElem = document.createElement("div");
	parentElem.appendChild(addElem);
	
	// 遠征支援機能 by どらごら
	var routeHTML = "";
	if(ROUTE_ENABLE) {
		routeHTML = 
			"<table style='font-size:11px; margin:1px;'>"+
			"<tr>"+
				"<td id='fld_route_output' style='background-color:black; padding:3px 4px;'>"+
					"<textarea cols='100' rows='10' id='route_output'></textarea>"+
				"</td>"+
				"<td id='fld_route_botton' style='background-color:black; padding:3px 4px; color:white; '>"+
					"<input id='route_cursor_enable' type='checkbox' style='vertical-align:bottom' " + 
							(CURSOR_ENABLE ? "checked" : "") + "/>カーソル位置<br />"+
					"<input id='route_default_mapM' type='checkbox' style='vertical-align:bottom' " + 
							(GM_getValue(map_hostname + "default_mapM", "true") == true ? "checked" : "") + "/>中域画面が標準<br />"+
					"<input id='route_chk_enable' type='checkbox' style='vertical-align:bottom' " + 
							(GM_getValue(map_hostname + "chk_flg", "false") == true ? "checked" : "") + " />直接クリック<br />"+
					"<input id='route_rewrite' type='button' value='マップに反映'></input><br />"+
					"<input id='route_validate' type='button' value='ルート検証'></input><br />"+
				"</td>"+
			"</tr>"+
			"</table>";
	}
	
	addElem.id = "maptoolHead";
	addElem.style.margin = "2px 2px";
	addElem.innerHTML = 
		"<table style='font-size:11px; margin:1px;'>"+
		"<tr>"+
			"<td style='background-color:black; padding:3px 4px; text-align:center;'>"+
				"<a id='maptoolClose' href='javascript:void(0);'>狭域</a> "+
				"<a id='maptoolSwitch' href='javascript:void(0);'></a>"+
			"</td>"+
			"<td style='background-color:black; padding:3px 4px; "+
				"font-size:10px; font-family:monospace;'>"+
				"<a id='maptoolMoveLeft' href='javascript:void(0);'>←</a> "+
				"<a id='maptoolMoveUp' href='javascript:void(0);'>↑</a> "+
				"<a id='maptoolMoveDown' href='javascript:void(0);'>↓</a> "+
				"<a id='maptoolMoveRight' href='javascript:void(0);'>→</a>"+
			"</td>"+
			"<td style='width:4px'></td>"+
			"<td style='color:white; background-color:black; padding:0px 4px; "+
				"text-align:center;'>"+
				"<input id='maptoolTime' type='button' value='基準時更新' /> "+
				"<span id='base_time'></span>"+
			"</td>"+
			"<td style='width:4px'></td>"+
			"<td style='color:white; background-color:black; padding:3px 4px; "+
				"text-align:center;'>"+
				"入力モード "+
				"<a id='maptoolModeName' href='javascript:void(0);'>名称</a> "+
				"<a id='maptoolModeColor' href='javascript:void(0);'>色</a>"+
			"</td>"+
			"<td style='width:4px'></td>"+
			"<td style='color:white; background-color:black; padding:3px 4px; "+
				"text-align:center;'>"+
				"<a id='maptoolExGetMap5959' href='javascript:void(0);'>全範囲取得</a>"+
			"</td>"+
			"<td style='width:4px'></td>"+
			"<td style='color:white; background-color:black; padding:3px 4px; "+
				"text-align:center;'>"+
				"<input id='maptoolExRouteEnable' type='checkbox' style='vertical-align:bottom' " +
						(ROUTE_ENABLE ? "checked" : "") + " />遠征支援"+
			"</td>"+
			"<td>" +
				"<input id='configopen' type='button' value='設定' />"+
			"</td>"+
		"</tr>"+
		"</table>" + 
		"<div id='CONFIG_AREA' style='display:none;'>" +
			"<table style='boder:1px; margin:1px;'>" +
				"<tr><td>" +
					"<table style='font-size:11px; margin:1px;'><tr>" +
						"<td style='color:white; background-color:black; padding:3px 4px; text-align:center;'>戦力 "+
							"<input id='fld_compromise' type='text' style='width:30px' />% "+
						"</td>"+
						"<td style='width:4px'></td>"+
						"<td style='color:white; background-color:black; padding:3px 4px; text-align:center;'>資源 "+
							"<input id='fld_material1' type='radio' name='material' value ='1' style='vertical-align:bottom' />期待値 "+
							"<input id='fld_material2' type='radio' name='material' value ='2' style='vertical-align:bottom' />範囲 "+
							"<input id='material_picture' type='checkbox' style='vertical-align:bottom' />ｱｲｺﾝ表示する"+
						"</td>"+
						"<td style='width:4px'></td>"+
						"<td style='color:white; background-color:black; padding:3px 4px; text-align:center;'>サイズ "+
							"<input id='fld_mapwide1' type='radio' name='mapwide' value ='1' style='vertical-align:bottom' />51x51 "+
							"<input id='fld_mapwide2' type='radio' name='mapwide' value ='2' style='vertical-align:bottom' />77x77"+
						"</td>"+
						"<td style='width:4px'></td>"+
						"<td style='color:white; background-color:black; padding:3px 4px; text-align:center;'>期数 "+
							"<input id='fld_period1' type='radio' name='fld_period' value ='1' style='vertical-align:bottom' />1 "+
							"<input id='fld_period2' type='radio' name='fld_period' value ='2' style='vertical-align:bottom' />2 "+
							"<input id='fld_period3' type='radio' name='fld_period' value ='3' style='vertical-align:bottom' />3,4 "+
							"<input id='fld_period4' type='radio' name='fld_period' value ='4' style='vertical-align:bottom' />5"+
						"</td>"+
						"<td style='width:4px'></td>"+
						"<td style='color:white; background-color:black; padding:3px 4px; text-align:center;'>"+
							"<input id='maptoolMatchFull' type='checkbox' style='vertical-align:bottom' />完全一致"+
						"</td>"+
					"</tr></table>" + 
					"<table style='font-size:11px; margin:1px;'><tr>" +
						"<td style='color:white; background-color:black; padding:3px 4px; text-align:center;'>NPC"+
							"<input id='fld_npc_yet' type='checkbox' style='vertical-align:bottom' />未 "+
							"<input id='fld_npc_fallen' type='checkbox' style='vertical-align:bottom' />済"+
						"</td>"+
						"<td style='width:4px'></td>"+
					"</tr></table>" +
				"</td><td>"+
					"<input id='configclose' type='button' value='閉じる' style='margin:0px 4px 4px 4px' />"+
				"</td></tr>" +
			"</tr></table>" + 
		"</div>"+
		"<table style='font-size:11px; margin:1px;'>"+
		"<tr>"+
			"<td style='color:white; background-color:black; padding:3px 4px' rowspan='3'>君主</td>"+
			"<td id='fld_user1' style='padding:3px 4px;'>"+
				"<input id='user1' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user2' style='padding:3px 4px;'>"+
				"<input id='user2' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user3' style='padding:3px 4px;'>"+
				"<input id='user3' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user4' style='padding:3px 4px;'>"+
				"<input id='user4' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user5' style='padding:3px 4px;'>"+
				"<input id='user5' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user6' style='padding:3px 4px;'>"+
				"<input id='user6' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user7' style='padding:3px 4px;'>"+
				"<input id='user7' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user8' style='padding:3px 4px;'>"+
				"<input id='user8' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user9' style='padding:3px 4px;'>"+
				"<input id='user9' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user10' style='padding:3px 4px;'>"+
				"<input id='user10' type='text' style='width:50px' />"+
			"</td>"+
			"<td style='background-color:black; padding:0px 2px; text-align:center;width:50px' rowspan='6'>"+
				"<input id='maptoolSave' type='button' value='保存' />"+
			"</td>"+
		"</tr>"+
		"<tr>"+
			"<td id='fld_user11' style='padding:3px 4px;'>"+
				"<input id='user11' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user12' style='padding:3px 4px;'>"+
				"<input id='user12' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user13' style='padding:3px 4px;'>"+
				"<input id='user13' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user14' style='padding:3px 4px;'>"+
				"<input id='user14' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user15' style='padding:3px 4px;'>"+
				"<input id='user15' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user16' style='padding:3px 4px;'>"+
				"<input id='user16' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user17' style='padding:3px 4px;'>"+
				"<input id='user17' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user18' style='padding:3px 4px;'>"+
				"<input id='user18' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user19' style='padding:3px 4px;'>"+
				"<input id='user19' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user20' style='padding:3px 4px;'>"+
				"<input id='user20' type='text' style='width:50px' />"+
			"</td>"+
		"</tr>"+
		"<tr>"+
			"<td id='fld_user21' style='padding:3px 4px;'>"+
				"<input id='user21' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user22' style='padding:3px 4px;'>"+
				"<input id='user22' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user23' style='padding:3px 4px;'>"+
				"<input id='user23' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user24' style='padding:3px 4px;'>"+
				"<input id='user24' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user25' style='padding:3px 4px;'>"+
				"<input id='user25' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user26' style='padding:3px 4px;'>"+
				"<input id='user26' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user27' style='padding:3px 4px;'>"+
				"<input id='user27' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user28' style='padding:3px 4px;'>"+
				"<input id='user28' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user29' style='padding:3px 4px;'>"+
				"<input id='user29' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_user30' style='padding:3px 4px;'>"+
				"<input id='user30' type='text' style='width:50px' />"+
			"</td>"+
		"</tr>"+
		"<tr>"+
			"<td style='color:white; background-color:black; padding:3px 4px' rowspan='3'>同盟</td>"+
			"<td id='fld_ally1' style='padding:3px 4px;'>"+
				"<input id='ally1' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally2' style='padding:3px 4px;'>"+
				"<input id='ally2' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally3' style='padding:3px 4px;'>"+
				"<input id='ally3' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally4' style='padding:3px 4px;'>"+
				"<input id='ally4' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally5' style='padding:3px 4px;'>"+
				"<input id='ally5' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally6' style='padding:3px 4px;'>"+
				"<input id='ally6' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally7' style='padding:3px 4px;'>"+
				"<input id='ally7' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally8' style='padding:3px 4px;'>"+
				"<input id='ally8' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally9' style='padding:3px 4px;'>"+
				"<input id='ally9' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally10' style='padding:3px 4px;'>"+
				"<input id='ally10' type='text' style='width:50px' />"+
			"</td>"+
		"</tr>"+
		"<tr>"+
			"<td id='fld_ally11' style='padding:3px 4px;'>"+
				"<input id='ally11' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally12' style='padding:3px 4px;'>"+
				"<input id='ally12' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally13' style='padding:3px 4px;'>"+
				"<input id='ally13' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally14' style='padding:3px 4px;'>"+
				"<input id='ally14' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally15' style='padding:3px 4px;'>"+
				"<input id='ally15' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally16' style='padding:3px 4px;'>"+
				"<input id='ally16' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally17' style='padding:3px 4px;'>"+
				"<input id='ally17' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally18' style='padding:3px 4px;'>"+
				"<input id='ally18' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally19' style='padding:3px 4px;'>"+
				"<input id='ally19' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally20' style='padding:3px 4px;'>"+
				"<input id='ally20' type='text' style='width:50px' />"+
			"</td>"+
		"</tr>"+
		"<tr>"+
			"<td id='fld_ally21' style='padding:3px 4px;'>"+
				"<input id='ally21' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally22' style='padding:3px 4px;'>"+
				"<input id='ally22' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally23' style='padding:3px 4px;'>"+
				"<input id='ally23' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally24' style='padding:3px 4px;'>"+
				"<input id='ally24' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally25' style='padding:3px 4px;'>"+
				"<input id='ally25' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally26' style='padding:3px 4px;'>"+
				"<input id='ally26' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally27' style='padding:3px 4px;'>"+
				"<input id='ally27' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally28' style='padding:3px 4px;'>"+
				"<input id='ally28' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally29' style='padding:3px 4px;'>"+
				"<input id='ally29' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_ally30' style='padding:3px 4px;'>"+
				"<input id='ally30' type='text' style='width:50px' />"+
			"</td>"+
		"</tr>"+
		"<tr>"+
			"<td style='color:white; background-color:black; padding:3px 4px' colspan='2'>資源 " +
				"<input id='fld_map_color' type='checkbox' style='vertical-align:bottom' />色表示する"+
			"</td>"+
			"<td id='fld_col1' style='padding:3px 4px;'>"+
				"<input id='col1' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_col2' style='padding:3px 4px;'>"+
				"<input id='col2' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_col3' style='padding:3px 4px;'>"+
				"<input id='col3' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_col4' style='padding:3px 4px;'>"+
				"<input id='col4' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_col5' style='padding:3px 4px;'>"+
				"<input id='col5' type='text' style='width:50px' />"+
			"</td>"+
			"<td id='fld_col6' style='padding:3px 4px;'>"+
				"<input id='col6' type='text' style='width:50px' />"+
			"</td>"+
		"</tr>"+
		"</table>" + routeHTML;
		//-----
	
	//バージョン
	document.getElementById("configopen").value  = "Ver." + VERSION_1;
	
	//基準時刻
	var baseTime = BASE_TIME;
	if (baseTime.length == 8) baseTime += "000000";
	document.getElementById("base_time").innerHTML = 
		baseTime.substr(4, 2) + "/" + baseTime.substr(6, 2) +
		" " + baseTime.substr(8, 2) + ":" + baseTime.substr(10, 2);
	
	//完全一致
	document.getElementById("maptoolMatchFull").checked = MATCH_FULL;
	
	//項目背景着色
	setFieldColors();
	
	//君主、同盟を表示
	setInputNames();
	
	//NPCを表示
	document.getElementById("fld_npc_yet").checked = DISP_NPC_YET;
	document.getElementById("fld_npc_fallen").checked = DISP_NPC_FALLEN;

	//期数
	document.getElementById("fld_period1").checked = DISP_PERIOD1;
	document.getElementById("fld_period2").checked = DISP_PERIOD2;
	document.getElementById("fld_period3").checked = DISP_PERIOD3;
	document.getElementById("fld_period4").checked = DISP_PERIOD4;
	document.getElementById("fld_compromise").value= DISP_COMPROMISE;

	//プチワイド
	document.getElementById("fld_mapwide1").checked = MAP_WIDE == false;
	document.getElementById("fld_mapwide2").checked = MAP_WIDE;

	//資源表示
	document.getElementById("fld_material1").checked = DISP_MATERIAL == false;
	document.getElementById("fld_material2").checked = DISP_MATERIAL;
	document.getElementById("material_picture").checked = DISP_PICTURE;
	document.getElementById("fld_map_color").checked = MAP_COLOR_MODE;
	
	// ルート用スクリプトを追加 by どらごら
	addRouteScriptHtml();
	
	//イベントリスナー登録（保存ボタン）
	document.getElementById('maptoolSave').addEventListener("click",
		function() {
			//入力値をGreasemonkey領域に保存
			if (INPUT_MODE == INPUT_MODE_NAME) {
				saveInputUsers("USERS");
				saveInputAllys("ALLYS");
				USERS = loadNames("USERS");
				ALLYS = loadNames("ALLYS");
				MAP_MATE_NAMES	= MAP_MATE_NAMES_DEF;
				defaultTargets();
				setInputNames();
				
			} else if (INPUT_MODE == INPUT_MODE_COLOR) {
				saveInputUsers("USER_COLORS");
				saveInputAllys("ALLY_COLORS");
				saveInputColors("MAP_MATE_COLORS");
				USER_COLORS = loadColors("USER_COLORS", USER_COLORS_DEF);
				ALLY_COLORS = loadColors("ALLY_COLORS", ALLY_COLORS_DEF);
				MAP_MATE_COLORS = loadColors("MAP_MATE_COLORS", MAP_MATE_COLORS_DEF);
				setInputColors();
				setFieldColors();
			}
			
			//NPC表示フラグ
			DISP_NPC_YET = document.getElementById("fld_npc_yet").checked;
			DISP_NPC_FALLEN = document.getElementById("fld_npc_fallen").checked;
			GM_setValue(map_hostname + "DISP_NPC_YET", DISP_NPC_YET);
			GM_setValue(map_hostname + "DISP_NPC_FALLEN", DISP_NPC_FALLEN);
//console.log(map_hostname + "DISP_NPC_YET: " + GM_getValue(map_hostname + "DISP_NPC_YET"));
//console.log(map_hostname + "DISP_NPC_FALLEN: " + GM_getValue(map_hostname + "DISP_NPC_FALLEN"));

			//期数
			DISP_PERIOD1 = document.getElementById("fld_period1").checked;
			DISP_PERIOD2 = document.getElementById("fld_period2").checked;
			DISP_PERIOD3 = document.getElementById("fld_period3").checked;
			DISP_PERIOD4 = document.getElementById("fld_period4").checked;
			DISP_COMPROMISE = document.getElementById("fld_compromise").value;
			GM_setValue(map_hostname + "DISP_PERIOD1", DISP_PERIOD1);
			GM_setValue(map_hostname + "DISP_PERIOD2", DISP_PERIOD2);
			GM_setValue(map_hostname + "DISP_PERIOD3", DISP_PERIOD3);
			GM_setValue(map_hostname + "DISP_PERIOD4", DISP_PERIOD4);
			GM_setValue(map_hostname + "DISP_COMPROMISE", DISP_COMPROMISE);

			//プチワイド
			MAP_WIDE = document.getElementById("fld_mapwide2").checked;
			GM_setValue(map_hostname + "MAP_WIDE", MAP_WIDE);
			if (MAP_WIDE){
				RADIUS = 38; 		//半径（中域）
				CELL_SIZE_M = 9;	//中域地図の1マスサイズ(px)
				FONT_SIZE = "7px";	//中域地図のマス内文字サイズ
			} else {
				RADIUS = 25;		//半径（中域）
				CELL_SIZE_M = 14;	//中域地図の1マスサイズ(px)
				FONT_SIZE = "10px";	//中域地図のマス内文字サイズ
			}

			DISP_MATERIAL = document.getElementById("fld_material2").checked;
			GM_setValue(map_hostname + "DISP_MATERIAL", DISP_MATERIAL);
			DISP_PICTURE = document.getElementById("material_picture").checked;
			GM_setValue(map_hostname + "DISP_PICTURE", DISP_PICTURE);
	
			//資源色表示
			MAP_COLOR_MODE = document.getElementById("fld_map_color").checked;
			GM_setValue(location.hostname + "MAP_COLOR_MODE", MAP_COLOR_MODE);

			//地図変更
			LOADED_MAPS = new Array();
			changeMap();
		},
		true);
	
	//イベントリスナー登録（基準時更新ボタン）
	document.getElementById('maptoolTime').addEventListener("click",
		function() {
			
			//基準時間として現在時刻をGreasemonkey領域に保存
			GM_setValue(map_hostname + "BASE_TIME", getCurrentTime2());
			
			//ページリロード
			GM_setValue(map_hostname + "MAP_MODE", MAP_MODE);
			location.reload();
		},
		true);
	
	//イベントリスナー登録（狭域地図リンク）
	document.getElementById('maptoolClose').addEventListener("click",
		function() {
			MAP_MODE = MAP_MODE_S;
			changeMap();
		},
		true);
	
	//イベントリスナー登録（中域/広域地図リンク）
	document.getElementById('maptoolSwitch').addEventListener("click",
		function() {
			MAP_MODE = (MAP_MODE == MAP_MODE_L ? MAP_MODE_M : MAP_MODE_L);
			changeMap();
		}, true);
	
	//イベントリスナー登録（←↑↓→リンク）
	document.getElementById('maptoolMoveLeft').addEventListener("click",
		function() { shiftMap(-1, 0); }, true);
	document.getElementById('maptoolMoveUp').addEventListener("click",
		function() { shiftMap(0, 1); }, true);
	document.getElementById('maptoolMoveDown').addEventListener("click",
		function() { shiftMap(0, -1); }, true);
	document.getElementById('maptoolMoveRight').addEventListener("click",
		function() { shiftMap(1, 0); }, true);
	
	//イベントリスナー登録（名称設定・色設定）
	document.getElementById('maptoolModeName').addEventListener("click",
		function() { setInputNames(); }, true);
	document.getElementById('maptoolModeColor').addEventListener("click",
		function() { setInputColors(); }, true);
	
	//イベントリスナー登録（完全一致チェックボックス）
	document.getElementById('maptoolMatchFull').addEventListener("click",
		function() { changeMatchMode(this.checked); }, true);
	
	//イベントリスナー登録（59x59範囲取得 by どらごら）
	document.getElementById('maptoolExGetMap5959').addEventListener("click",
		function() { getMap5959(); }, true);
	
	//イベントリスナー登録（遠征支援 by どらごら）
	document.getElementById('maptoolExRouteEnable').addEventListener("click",
		function() { 
			GM_setValue(map_hostname + "route_enable", j$("#maptoolExRouteEnable").attr('checked'));
			//ページリロード
			location.reload();
		}, true);
	
	//イベントリスナー登録（閉じる）
	document.getElementById('configclose').addEventListener("click",
		function(){ConfigClose();}, true);

	//イベントリスナー登録（開く≒バージョンボタン）
	document.getElementById('configopen').addEventListener("click",
		function(){ConfigOpen();}, true);

	if(ROUTE_ENABLE) {
		//イベントリスナー登録（カーソル位置 by どらごら）
		document.getElementById('route_cursor_enable').addEventListener("click",
			function() { 
				CURSOR_ENABLE = j$("#route_cursor_enable").attr('checked');
				GM_setValue(map_hostname + "cursor_flg", CURSOR_ENABLE);
				//ページリロード
				location.reload();
			}, true);
		
		//イベントリスナー登録（中域画面が標準 by どらごら）
		document.getElementById('route_default_mapM').addEventListener("click",
			function() { 
				GM_setValue(map_hostname + "default_mapM", j$("#route_default_mapM").attr('checked'));
			}, true);
		
		
		//イベントリスナー登録（直接クリック有効 by どらごら）
		document.getElementById('route_chk_enable').addEventListener("click",
			function() { 
				GM_setValue(map_hostname + "chk_flg", j$("#route_chk_enable").attr('checked'));
			}, true);
		
		//イベントリスナー登録（マップに反映 by どらごら）
		document.getElementById('route_rewrite').addEventListener("click",
			function() { onReWrite(); }, true);
		
		//イベントリスナー登録（ルート検証 by どらごら）
		document.getElementById('route_validate').addEventListener("click",
			function() { onValidation(); }, true);
		
	}
	
}

//本体部HTML追加
function addBodyHtml(parentElem) {
	
	//中域地図div
	var addElem = document.createElement("div");
	parentElem.appendChild(addElem);
	addElem.id = "maptoolBody";
	addElem.style.display = "none";
	
	//広域地図div
	var addElem2 = document.createElement("div");
	parentElem.appendChild(addElem2);
	addElem2.id = "maptoolBodyL";
	addElem2.style.display = "none";
	
	//中域/広域地図ドラッグ＆ドロップイベントリスナー
	var elems = new Array();
	elems.push(addElem);
	elems.push(addElem2);
	for (var i=0; i<elems.length; i++) {
		elems[i].addEventListener("mousedown",
			function(event) {
				MOUSE_DRAGGING_1 = true;
				MOUSE_DRAG_START_X = event.pageX;
				MOUSE_DRAG_START_Y = event.pageY;
				this.style.cursor = "move";
				event.preventDefault();
			},
			false);
		elems[i].addEventListener("mouseup",
			function(event) {
				if (!MOUSE_DRAGGING_1) {
					return true;
				}
				MOUSE_DRAGGING_1 = false;
				this.style.cursor = "default";
				
				var offsetX = event.pageX - MOUSE_DRAG_START_X;
				var offsetY = event.pageY - MOUSE_DRAG_START_Y;
				if (Math.sqrt(offsetX*offsetX+offsetY*offsetY) > 5) {
					var cellSize;
					if (MAP_MODE == MAP_MODE_M) cellSize = CELL_SIZE_M;
					else if (MAP_MODE == MAP_MODE_L) cellSize = CELL_SIZE_L;
					
					if (cellSize != undefined) {
						moveMap(CENTER_X - Math.round(offsetX / cellSize), 
							CENTER_Y + Math.round(offsetY / cellSize));
					}
				}
				event.preventDefault();
			},
			false);
	}
}

//地図（中域）本体部HTML生成
function genBodyHtml() {
	var bodyHtml = "";
	
	bodyHtml += "<table style='border:1px solid gray; font-size:" + FONT_SIZE + "'>\n";
	
	//各マス作成
	for (var y=CENTER_Y+RADIUS; y>=CENTER_Y-RADIUS; y--) {
		bodyHtml += "<tr style='height:" + CELL_SIZE_M + "px'>\n";
		
		for (var x=CENTER_X-RADIUS; x<=CENTER_X+RADIUS; x++) {
			bodyHtml += generateMapCellHtml(x, y);
		}
		bodyHtml += "</tr>\n";
	}
	
	bodyHtml += "</table>\n";
	
	return bodyHtml;
}

//地図（広域）本体部HTML生成
function genBodyHtmlL() {
	var bodyHtml = "";
	
	var width = (RADIUS_L * 2 + 1) * CELL_SIZE_L;
	bodyHtml +=
		"<div id='mapBodyL' style='background-color:lightgray; color:white; " + 
		"position:relative; overflow:hidden; " + 
		"width:" + width + "px; height:" + width + "px;'>\r\n";
	
	//中心線
	bodyHtml += 
		"<div style='background-color:darkgray; position:absolute; " +
		"width:" + width + "px; height:1px; " +
		"left:0px; top:" + (Math.floor(width/2) + 1) + "px;'></div>";
	bodyHtml += 
		"<div style='background-color:darkgray; position:absolute; " +
		"width:1px; height:" + width + "px; " +
		"left:" + (Math.floor(width/2) + 1) + "px; top:0px;'></div>";
	
	//同盟単位
	for (var i = ALLYS.length - 1; i >= 0; i--) {
		var allySub = ALLYS[i];
		if (allySub == "") {
			continue;
		}
		
		//名称が部分一致する同盟が対象
		var matchAllys = searchArrayString(ALLYS_INDEX, allySub);
		for (var j=0; j<matchAllys.length; j++) {
			var allyData = getAllyDataCache(matchAllys[j]);
			var members = allyData[IDX_ALLY_MEMBERS];
			for (var k=0; k<members.length; k++) {
				bodyHtml += genUserVillageHtml(members[k], ALLY_COLORS[i], matchAllys[j], 1);
			}
		}
	}
	
	//NPC拠点
	if (DISP_NPC_YET || DISP_NPC_FALLEN) {
		var npcs = splitDelimited(
			GM_getValue(map_hostname + "NPCS_INDEX", ""), DELIMIT_1);
		bodyHtml += genVillagesHtml(npcs, "", NPC_COLOR, 3);
	}
	
	//君主単位
	for (var i = USERS.length - 1; i >= 0; i--) {
		var userSub = USERS[i];
		if (userSub == "") {
			continue;
		}
		
		//名称が部分一致する君主が対象
		var matchUsers = searchArrayString(USERS_INDEX, userSub);
		for (var j=0; j<matchUsers.length; j++) {
			bodyHtml += genUserVillageHtml(matchUsers[j], USER_COLORS[i], "", 2);
		}
	}
	
	bodyHtml += "</div>";
	
	return bodyHtml;
}

//君主下各拠点のHTML生成（広域地図）
function genUserVillageHtml(user, color, ally, priority) {
	var ret = "";
	var userData = getUserDataCache(user);
	
	//既に同盟から抜けている場合はスキップ
	if (ally != "" && ally != userData[IDX_USER_ALLY]) {
		return "";
	}
	
	//各拠点HTML生成
	var villages = userData[IDX_USER_VILLAGES];
	ret = genVillagesHtml(villages, user, color, priority);
	
	return ret;
}

//拠点表示（複数分）HTML生成（広域地図）
function genVillagesHtml(villages, user, color, priority) {
	var ret = "";
	
	for (var j = 0; j < villages.length; j++) {
		var x = parseInt(villages[j].split(",")[0]);
		var y = parseInt(villages[j].split(",")[1]);
		if (isNaN(x) || isNaN(y)) {
			continue;
		}
		ret += genVillageHtml(user, color, x, y, priority) + "\r\n";
	}
	
	return ret;
}

//拠点表示HTML生成（広域地図）
function genVillageHtml(user, color, x, y, priority) {
	
	//画面範囲外ならスキップ
	if (x < CENTER_X-RADIUS_L-5 || x > CENTER_X+RADIUS_L+5) return "";
	if (y < CENTER_Y-RADIUS_L-5 || y > CENTER_Y+RADIUS_L+5) return "";
	
	//マスデータ取得
	var data = loadCellData(generateCellKey(x, y));
	
	//表示対象外はスキップ
	if (data[IDX_NPC_FLG] == "1") {
		//NPCの表示指定がない場合はスキップ
		var disp = false;
		if (data[IDX_ALLIANCER] == NPC_ALLY) {
			if (DISP_NPC_YET) {
				disp = true;
			}
		} else {
			if (DISP_NPC_FALLEN) {
				if (user == "") disp = true;
			} else {
				if (user != "") disp = true;
			}
		}
		if (!disp) return "";
		
	} else {
		//既に拠点がない場合はスキップ
		if ((data[IDX_POPULATION] == undefined || data[IDX_POPULATION] == "" ||
			data[IDX_USER_NAME] != user)) {
			return "";
		}
	}
	
	//四角形のサイズを決定
	var size;
	if (data[IDX_NPC_FLG] == "1") {
		if (data[IDX_POWER].length <= 3) size = 2;
		else if (data[IDX_POWER].length <= 6) size = 3;
		else size = 4;
	} else {
		var population = parseInt(data[IDX_POPULATION]);
		if (population < 100) size = 1;
		else if (population < 250) size = 2;
		else if (population < 600) size = 3;
		else if (population < 1000) size = 4;
		else size = 5;
	}
	
	var borderWidth = 1;
	var width = (size + 1) * 2 + 1 - borderWidth * 2;
	var left = (x - (CENTER_X - RADIUS_L)) * CELL_SIZE_L - (width-CELL_SIZE_L)/2;
	var top = ((CENTER_Y + RADIUS_L) - y) * CELL_SIZE_L - (width-CELL_SIZE_L)/2;
	var zIndex = priority * 10 + (9 - size);
	//var popupText = genPopupText(data, x, y);
	var clsData = new genPopupText(data, x, y);	// by どらごら
	var popupText = clsData.popupText;
	
	var ret = 
		"<a href='" + getMapUrl(x, y) + "'>" +
		"<div style='background-color:" + color + "; z-index:" + zIndex + "; " +
		"width:" + width + "px; height:" + width + "px; " +
		"left:" + left + "px; top:" + top + "px; " +
		"position:absolute; border:outset " + borderWidth + "px " + color + "' ";
	if (navigator.userAgent.toLowerCase().indexOf('chrome') >= 0) {
		ret += "title='" + popupText.replace(/<br\/>/g, "\n") + "'>";
	} else {
		ret += "onMouseOver='onPopup(\"" + popupText + "\", event.pageX, event.pageY)' " +
			"onMouseOut='offPopup()'>";
	}
	ret += "</div></a>";
	
	return ret;
}


//説明ポップアップ初期化
function initPopup() {

	//CSS
	addGlobalStyle(
		".popup{"+
			"position:absolute; left:0px; top:0px; visibility:hidden;opacity:1; "+
			"font-size:9pt; color:#ffffff; -moz-border-radius: 8px;"+
			"background-color:#000000; layer-background-color:#FFFFFF; "+
			"border:1px solid #ffffFF; padding:10px;z-index:999;"+
		"}"
	);
	
	//表示関数
	var funcHTML = 
		'function onPopup(text, nX, nY) {\n'+
			'var sX = -10, sY = 24;\n'+
			'var msgElem = document.getElementById("popup");\n'+
			'msgElem.innerHTML = text;\n'+
			'msgElem.style.visibility = "visible";\n'+
			'msgElem.style.left = (nX + sX) + "px";\n'+
			'msgElem.style.top = (nY + sY) + "px";\n'+
		'}\n'+
		'function offPopup() {\n'+
			'document.getElementById("popup").style.visibility = "hidden";\n'+
		'}\n';
	var scriptElem = document.createElement("script");
	scriptElem.type = "text/javascript";
	scriptElem.innerHTML = funcHTML;
	document.getElementsByTagName("head")[0].appendChild(scriptElem);
	
	//HTMLタグ追加
	var popupElem = document.createElement('span');
	popupElem.id = "popup";
	popupElem.className = "popup";
	var mapElem = document.evaluate('//*[@id="maptool"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	mapElem.snapshotItem(0).appendChild(popupElem);
	
	//イベントリスナー登録
	popupElem.addEventListener("mouseover",
		function() { this.style.visibility = "hidden" }, true);
}

//所有者が変わった領地に印
function markChangeArea() {
	// by どらごら
	markChangeArea2(document);
}
function markChangeArea2(dom) {
	var markHtml = "";
	
	var mapElem = dom.evaluate('//*[@id="mapsAll"]', dom, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
	
	var baseX = CENTER_X - Math.floor((MAP_SCALE-1)/2);
	var baseY = CENTER_Y + Math.floor((MAP_SCALE-1)/2);
	for (var x = baseX; x <= baseX + MAP_SCALE - 1; x++) {
		for (var y = baseY; y >= baseY - MAP_SCALE + 1; y--) {
			
			//保存データ取得
			var data = getCellDataCache(generateCellKey(x, y));
			var userBefore = data[IDX_USER_BEFORE];
			var userAfter = data[IDX_USER_NAME];
			
			if (userBefore == userAfter) {
				continue;
			}
			
			//チェック画像
			var areaNo = (x - baseX) * MAP_SCALE + (baseY - y) + 1;
			var addElem = document.createElement("img");
			addElem.className = "mapAll" + padZero_1(areaNo);
			addElem.alt = "change";
			addElem.src = "data:image/gif;base64,"+
				"R0lGODlhPAA8AHcAMSH+GlNvZnR3YXJlOiBNaWNyb3NvZnQgT2ZmaWNlACH5BAEAAAAALBMAHgAZ"+
				"ABQAgAAAAP4AAAIyhI+ZwayPmoRUOvpswFDzbH2KJy5TGZ2oQa5AyF0HjKltddK1pn58s/q5eC5W"+
				"byhDFQAAOw==";
			
			mapElem.appendChild(addElem);
		}
	}
}

//地図幅の取得
function getMapScale() {
	var sort15 = document.evaluate('//*[@id="change-map-scale"]/ul/li[@class="sort15 now"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if (sort15.snapshotLength != 0) {
		return 15;
	}
	
	var sort20 = document.evaluate('//*[@id="change-map-scale"]/ul/li[@class="sort20 now"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if (sort20.snapshotLength != 0) {
		return 20;
	}
	
	return 11;
}

//君主、同盟の指定がない場合は中心座標の君主をデフォルト
function defaultTargets() {
	if (USERS[0] != "" || ALLYS[0] != "") {
		return;
	}
	
	var data = getCellDataCache(generateCellKey(CENTER_X, CENTER_Y));
	if (data.length > 0) {
		USERS[0] = data[IDX_USER_NAME];
		ALLYS[0] = data[IDX_ALLIANCER];
	}
}

//名称入力欄設定
function setInputNames() {
	INPUT_MODE = INPUT_MODE_NAME;
	setInputLink("maptoolModeName");
	setInputs(USERS, ALLYS, MAP_MATE_NAMES, "");
}
//色入力欄設定
function setInputColors() {
	INPUT_MODE = INPUT_MODE_COLOR;
	setInputLink("maptoolModeColor");
	setInputs(USER_COLORS, ALLY_COLORS, MAP_MATE_COLORS, "monospace");
}
//リンク背景色設定
function setInputLink(id) {
	var linkIds = new Array("maptoolModeName", "maptoolModeColor");
	for (var i = 0; i < linkIds.length; i++) {
		var elem = document.getElementById(linkIds[i]);
		if (linkIds[i] == id) {
			elem.style.backgroundColor = "dimgray";
		} else {
			elem.style.backgroundColor = "";
		}
	}
}

//入力欄設定
function setInputs(users, allys, colors, fontFamily) {
	
	//各テキストボックスを初期化
	for (var i = 0; i < USER_COLORS.length; i++) {
		var field = document.getElementById("user" + (i+1));
		field.value = "";
		field.style.fontFamily = fontFamily;
	}
	for (var i = 0; i < ALLY_COLORS.length; i++) {
		var field = document.getElementById("ally" + (i+1));
		field.value = "";
		field.style.fontFamily = fontFamily;
	}
	for (var i = 0; i < MAP_MATE_COLORS.length; i++) {
		var field = document.getElementById("col" + (i+1));
		field.value = "";
		field.style.fontFamily = fontFamily;
	}
	//各テキストボックスに設定
	for (var i = 0; i < users.length; i++) {
		document.getElementById("user" + (i+1)).value = users[i];
	}
	for (var i = 0; i < allys.length; i++) {
		document.getElementById("ally" + (i+1)).value = allys[i];
	}
	for (var i = 0; i < colors.length; i++) {
		document.getElementById("col" + (i+1)).value = colors[i];
	}
}

//入力欄背景色設定
function setFieldColors() {
	for (var i = 0; i < USER_COLORS.length; i++) {
		document.getElementById("fld_user" + (i+1)).style.backgroundColor = USER_COLORS[i];
	}
	for (var i = 0; i < ALLY_COLORS.length; i++) {
		document.getElementById("fld_ally" + (i+1)).style.backgroundColor = ALLY_COLORS[i];
	}
	for (var i = 0; i < MAP_MATE_COLORS.length; i++) {
		document.getElementById("fld_col" + (i+1)).style.backgroundColor = MAP_MATE_COLORS[i];
	}
}

//地図1マス生成
function generateMapCellHtml(x, y) {
	var cellHtml = "";
	
	//保存データ取得
	var data = loadCellData(generateCellKey(x, y));
	var user = data[IDX_USER_NAME];
	var population = data[IDX_POPULATION];
	var ally = data[IDX_ALLIANCER];
	var power = data[IDX_POWER];
	var npcFlg = data[IDX_NPC_FLG];
	var capitalFlg = data[IDX_CAPITAL_FLG];
	var timeBefore = data[IDX_TIME_BEFORE];
	var userBefore = data[IDX_USER_BEFORE];
	var parentAlly = getParentAlly(ally);
	
	//背景色
	var bgColor;
	var reverse = false;
	if (user == undefined) {
		bgColor = "gray";
	} else if (user == "") {
		bgColor = "white";
 	} else if (npcFlg == "1" && 
 		((DISP_NPC_YET && ally == NPC_ALLY) || (DISP_NPC_FALLEN && ally != NPC_ALLY))) {
		bgColor = NPC_COLOR;
		reverse = true;
	}
	if (MAP_COLOR_MODE){
		if (bgColor == undefined) {
			if (matchString(user, USERS[0])) {
				bgColor = USER_COLORS[0];
				reverse = true;
			}
		}
		if (bgColor == undefined) {
			if (matchString(ally, ALLYS[0]) || matchString(parentAlly, ALLYS[0])) {
				bgColor = ALLY_COLORS[0];
			}
		}
		if (bgColor == undefined) {
			if (user != ""){
				bgColor = MAP_MATE_COLORS[MAP_OTHER_COLOR];
				reverse = true;
			}
		}
		if (user == "") {
			if (data[IDX_STONE] + data[IDX_IRON] + data[IDX_RICE] == "000"){
				bgColor = MAP_MATE_COLORS[MAP_WOOD_COLOR];
			} else if (data[IDX_WOOD] + data[IDX_IRON] + data[IDX_RICE] == "000"){
				bgColor = MAP_MATE_COLORS[MAP_STONE_COLOR];
			} else if (data[IDX_WOOD] + data[IDX_STONE] + data[IDX_RICE] == "000"){
				bgColor = MAP_MATE_COLORS[MAP_IRON_COLOR];
			} else if (data[IDX_WOOD] + data[IDX_STONE] + data[IDX_IRON] == "000"){
				bgColor = MAP_MATE_COLORS[MAP_RICE_COLOR];
			} else {
				bgColor = MAP_MATE_COLORS[MAP_MIX_COLOR];
			}
			reverse = true;
		}
	} else {
		if (bgColor == undefined) {
			for (var i=0; i<USERS.length; i++) {
				if (matchString(user, USERS[i])) {
					bgColor = USER_COLORS[i];
					reverse = true;
					break;
				}
			}
		}
		if (bgColor == undefined) {
			for (var i=0; i<ALLYS.length; i++) {
				if (matchString(ally, ALLYS[i]) || matchString(parentAlly, ALLYS[i])) {
					bgColor = ALLY_COLORS[i];
					break;
				}
			}
		}
	}
	if (bgColor == undefined) {
		bgColor = ETC_COLOR;
	}
	
	//マス情報は新しい？
	var isNewData = (timeBefore >= BASE_TIME);
	
	//所有者変更有無チェック
	var isDiff = (userBefore != user && isNewData);
	
	//ポップアップ内容
	//var popupText = genPopupText(data, x, y);
	var clsData = new genPopupText(data, x, y);	// by どらごら
	var popupText = clsData.popupText;
	
	//データが古いマスに目印
	var borderStyle = "border: solid white 1px;";
	if (!isNewData) {
		if (reverse) {
			borderStyle = "border: solid lightgrey 1px;";
		} else {
			borderStyle = "border: solid gray 1px;"
		}
	}
	
	//中心マスに目印
	if (x==CENTER_X && y==CENTER_Y) {
		var borderColor;
		if (reverse) borderColor = "black";
		else borderColor = "black";
		borderStyle = "border: solid "+borderColor+" 2px;";
	}
	
	//☆多領地、人口多拠点を強調
	var hiPowerStyle, textColor;
	if ((power != undefined && power.length >= HI_POWER) || 
		(population != undefined && parseInt(population) > HI_POPUL)) {
		hiPowerStyle = "font-weight:bold;";
		if (reverse) textColor = "white";
		else textColor = "black";
	} else {
		hiPowerStyle = "";
		if (reverse) textColor = "lightgray";
		else textColor = "dimgray";
	}
	
	//配下同盟表示
	var anchorStyle = "";
	if (ally != "" && parentAlly != "" && !reverse) {
		anchorStyle += "background-color:whitesmoke;";
	}
	
	//本拠地表示
	if (capitalFlg == "C") {
		anchorStyle += "border:dotted 1px " + textColor + ";";

	}
	
	//所有者変更表示
	if (isDiff) {
		if (reverse) textColor = "pink";
		else textColor = "red";
	}
	
	//tdタグ by どらごら
	if(ROUTE_ENABLE == false) {
		cellHtml += "<td style='width:" + CELL_SIZE_M + "px; text-align:center; " +
			"background-color:" + bgColor + ";" + borderStyle + hiPowerStyle + "'>";
	} else {
		// x,y,p,c,b
		var argv = "event, " + 
										clsData.x + "," + clsData.y + 
										"," + "\"" + clsData.power + "\"" +
										"," + ((clsData.x==CENTER_X && clsData.y==CENTER_Y) ? "true" : "false") + 
										"," + "\"" + bgColor + "\"" +
								"";
		var mouse_over = "";
		if(CURSOR_ENABLE) {
			mouse_over = " onMouseOver='onMapMouseOver("+ argv + ");' onMouseOut='onMapMouseOut("+ argv + ");' ";
		}
		cellHtml += "<td style='width:" + CELL_SIZE_M + "px; text-align:center; "+
			"background-color:" + bgColor + ";" + borderStyle + hiPowerStyle + "' " +
			"id='route_td_" + clsData.x + "_" + clsData.y + "' onClick='onMapClick("+ argv + ");' " +
			mouse_over + " onContextMenu='onMapContextMenu("+ argv +");'>";
	}
	
	//座標リンク by どらごら
	if(ROUTE_ENABLE == false) {
		cellHtml += "<a href='" + getMapUrl(x, y) + "' " +
			"style='color:" + textColor + "; text-decoration:none; " + anchorStyle + "' ";
		if (navigator.userAgent.toLowerCase().indexOf('chrome') >= 0) {
			cellHtml += "title='" + popupText.replace(/<br\/>/g, "\n") + "'>";
		} else {
			cellHtml += "onMouseOver='onPopup(\"" + popupText + "\", event.pageX, event.pageY)' " +
				"onMouseOut='offPopup()'>";
		}
	} else {
		cellHtml += "<a href='javascript:void(0);' id='route_a_" + clsData.x + "_" + clsData.y + "' " +
			"style='color:" + textColor + "; text-decoration:none; " + anchorStyle + "' ";
		if (navigator.userAgent.toLowerCase().indexOf('chrome') >= 0) {
			cellHtml += "title='" + popupText.replace(/<br\/>/g, "\n") + "'>";
		} else {
			cellHtml += "onMouseOver='onPopup(\"" + popupText + "\", event.pageX, event.pageY)' " +
				"onMouseOut='offPopup()'>";
		}
	}
	
	//☆数(領地) 、「C」(Castle/PC)、「P」(PC)、「N」(NPC)
	if (data.length == 0) cellHtml += "　";
	else if (npcFlg == "1") cellHtml += "N";
	else if (population != "" & capitalFlg == "C") cellHtml += capitalFlg;
	else if (population != "") cellHtml += "P";
	else if (power == "") cellHtml += "?";
	else cellHtml += power.length;
	
	cellHtml += "</a>";
	cellHtml += "</td>\n";
	
	return cellHtml;
}

//ポップアップテキスト生成
//	クラス化 by どらごら
function genPopupText(data, x, y) {
	this.x = x;
	this.y = y;
	this.data = data;
	
	this.village = data[IDX_VILLAGE_NAME];
	this.user = data[IDX_USER_NAME];
	this.population = data[IDX_POPULATION];
	this.ally = data[IDX_ALLIANCER];
	this.power = data[IDX_POWER];
	this.material = 
		"森"+data[IDX_WOOD] +
		" 岩"+data[IDX_STONE] +
		" 鉄"+data[IDX_IRON] +
		" 穀"+data[IDX_RICE];
	this.npcFlg = data[IDX_NPC_FLG];
	this.userBefore = data[IDX_USER_BEFORE];
	this.allyBefore = data[IDX_ALLY_BEFORE];
	this.lastUpdate = data[IDX_LAST_UPDATE];
	this.parentAlly = getParentAlly(this.ally);
	
	//自拠点からの距離
	this.distance = -1;
	if (MY_X != 0 || MY_Y != 0) {
		this.distance = Math.sqrt((MY_X-x)*(MY_X-x)+(MY_Y-y)*(MY_Y-y));
		this.distance = Math.round(this.distance * 100) / 100;
	}

	//兵数計算
	var ki = 0;
	if (DISP_PERIOD1){ki=1}
	if (DISP_PERIOD2){ki=2}
	if (DISP_PERIOD3){ki=3}
	if (DISP_PERIOD4){ki=4}

	var heika = [0,0,0,0,0,0,0];
	var defTxt = ""; 
	for (i=0; i<MINPEI.length; i++){
		if (MINPEI[i][0] == ki && MINPEI[i][1] == this.power && MINPEI[i][2] == this.material){
			heika[0] = MINPEI[i][3] * (1+(this.distance * 0.1));
			heika[1] = MINPEI[i][4] * (1+(this.distance * 0.1));
			heika[2] = MINPEI[i][5] * (1+(this.distance * 0.1));
			heika[3] = MINPEI[i][6] * (1+(this.distance * 0.1));
			heika[4] = MINPEI[i][7] * (1+(this.distance * 0.1));
			heika[5] = MINPEI[i][8] * (1+(this.distance * 0.1));
			heika[6] = MINPEI[i][9] * (1+(this.distance * 0.1));

			var sum = [[0,0],[0,0],[0,0],[0,0]];
			for (j=0; j<4; j++){
				for (k=0; k<7; k++){
					sum[j][0] = sum[j][0] + (SPEC[k][j] * Math.floor(heika[k]*3));
					if (DISP_COMPROMISE != undefined && DISP_COMPROMISE >= 0 && DISP_COMPROMISE <= 100){
						sum[j][1] = sum[j][1] + (SPEC[k][j] * Math.floor(heika[k]*3*DISP_COMPROMISE/100));
					}
				}
			}
			if (sum[0][0] != 0 || sum[0][1] != 0 || sum[1][0] != 0 || sum[1][1] != 0 || sum[2][0] != 0 || sum[2][1] != 0 || sum[3][0] != 0 || sum[3][1] != 0) {
				var nin = [[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]];
				for (k=0; k<7; k++){
					j=k;
					if (k>3){j=k-3}
					nin[k][0] = Math.ceil(sum[j][0] / SPEC[k][4]);
					nin[k][1] = Math.ceil(sum[j][1] / SPEC[k][4]);
				}

				if (defTxt != ""){defTxt += "または、（↑平地23、平地20↓）<br/>"}
				defTxt += "vs歩：" + sum[0][0] + "("+ nin[0][0] +")　" + sum[0][1] + "("+ nin[0][1] +")<br/>";
				defTxt += "vs槍：" + sum[1][0] + "("+ nin[1][0] +"/" + nin[4][0] + ")　" + sum[1][1] + "("+ nin[1][1] + "/" + nin[4][1] +")<br/>";
				defTxt += "vs弓：" + sum[2][0] + "("+ nin[2][0] +"/" + nin[5][0] + ")　" + sum[2][1] + "("+ nin[2][1] + "/" + nin[5][1] +")<br/>";
				defTxt += "vs騎：" + sum[3][0] + "("+ nin[3][0] +"/" + nin[6][0] + ")　" + sum[3][1] + "("+ nin[3][1] + "/" + nin[6][1] +")<br/>";
			}
		}
	}

	//入手資源計算
	var getTxt = "";
	if (DISP_MATERIAL) {
		if (data[IDX_WOOD]!=0)  {
			getTxt += " 木" + Math.floor(data[IDX_WOOD]  * this.distance * 10) + "～" + Math.floor(data[IDX_WOOD]  * this.distance * 100);
		}
		if (data[IDX_STONE]!=0) { 
			getTxt += " 石" + Math.floor(data[IDX_STONE] * this.distance * 10) + "～" + Math.floor(data[IDX_STONE] * this.distance * 100);
		}
		if (data[IDX_IRON]!=0)  {
			getTxt += " 鉄" + Math.floor(data[IDX_IRON]  * this.distance * 10) + "～" + Math.floor(data[IDX_IRON]  * this.distance * 100);
		}
		if (data[IDX_RICE]!=0)  {
			getTxt += " 糧" + Math.floor(data[IDX_RICE]  * this.distance * 10) + "～" + Math.floor(data[IDX_RICE]  * this.distance * 100);
		}
	} else {
		if (data[IDX_WOOD]!=0)  {
			getTxt += " 木" + Math.floor(data[IDX_WOOD]  * this.distance * 1595 / 100);
		}
		if (data[IDX_STONE]!=0) { 
			getTxt += " 石" + Math.floor(data[IDX_STONE] * this.distance * 1595 / 100);
		}
		if (data[IDX_IRON]!=0)  {
			getTxt += " 鉄" + Math.floor(data[IDX_IRON]  * this.distance * 1595 / 100);
		}
		if (data[IDX_RICE]!=0)  {
			getTxt += " 糧" + Math.floor(data[IDX_RICE]  * this.distance * 1595 / 100);
		}
	}

	//[地名]([座標])/[[距離]]
	if (this.village == undefined) this.village = "不明";
	this.popupText = "";
	this.popupText += this.village;
	this.popupText += "(" + x + "," + y + " )"
	if (this.distance >= 0) {
		this.popupText += " / "
		this.popupText += "[" + this.distance + "]"
	}
	this.popupText += "<br/>";
//	alert(this.distance);
	//[君主名]@[同盟名]@[親同盟]([前君主名]@[同盟名])
	this.exists = false;
	if (this.user != undefined && this.user != "") {
		this.popupText += this.user + "@" + this.ally;
		if (this.parentAlly != "") this.popupText += "@" + this.parentAlly;
		this.exists = true;
	}
	if (this.userBefore != this.user && this.userBefore != undefined && this.userBefore != "") {
		this.popupText += "(" + this.userBefore + "@" + this.allyBefore + ")";
		this.exists = true;
	}
	if (this.exists) {
		this.popupText += "<br/>";
	}
	//NPC戦力
	//if (this.npcFlg == "1") {
	if (this.power != undefined && this.power != "") {
		this.popupText += this.power + "<br/>";
	}
	//資源
	if (this.power != undefined && this.power != "" && this.npcFlg != "1") {
		this.popupText += this.material + "<br/>";
		if (getTxt != "") {
			this.popupText += "　賊討伐入手（" + getTxt + "）<br/>";
			if (DISP_MATERIAL) {
				this.popupText += "　※1倍:45% ～ 10.5倍:1%<br/>"
			} else {
				this.popupText += "　※期待値:1.6倍<br/>"
			}
		}
	}
	//人口
	if (this.population != undefined && this.population != "") {
		this.popupText += "人" +this. population + "<br/>";
	}
	//防御力
	if (defTxt != "") {
		this.popupText += defTxt;
	}
	//最終更新日時
	if (this.lastUpdate != undefined) {
		var dateText = this.lastUpdate;
		dateText = dateText.replace(/^[0-9]{4}\//, "");
		dateText = dateText.replace(/:[0-9]{2}$/, "");
		this.popupText += dateText;
	}
	
	//return popupText;
}

//地図切り替え
function changeMap() {
	//現在の表示を消去
	if (MAP_MODE != MAP_MODE_S) {
//20120524		document.getElementById("mapAll").style.display = "none";
		document.getElementById(mapAllId).style.display = "none";
		document.getElementById("maptoolLink").style.display = "none";
	} else {
		document.getElementById("maptoolHead").style.display = "none";
	}
	if (MAP_MODE != MAP_MODE_M) {
		document.getElementById("maptoolBody").style.display = "none";
	}
	if (MAP_MODE != MAP_MODE_L) {
		document.getElementById("maptoolBodyL").style.display = "none";
	}
	
	//地図ツール共通部表示
	if (MAP_MODE != MAP_MODE_S) {
		document.getElementById("maptoolHead").style.display = "block";
		
		var switchName;
		if (MAP_MODE == MAP_MODE_M) switchName = "広域";
		if (MAP_MODE == MAP_MODE_L) switchName = "中域";
		document.getElementById("maptoolSwitch").innerHTML = switchName;
		
		if (MAP_MODE == MAP_MODE_L) {
			document.getElementById("maptoolTime").disabled = true;
		} else {
			document.getElementById("maptoolTime").disabled = false;
		}
	}
	
	//時間がかかるので別スレッド化（一旦描画して砂時計を表示させる）
	setWaitCursor();
	window.setTimeout(function() {
		//地図ツール個別部表示
		if (MAP_MODE == MAP_MODE_M) {
			//中域地図
			document.getElementById("maptoolBody").style.display = "block";
		} else if (MAP_MODE == MAP_MODE_L) {
			//広域地図
			document.getElementById("maptoolBodyL").style.display = "block";
		} else {
			//狭域地図
			var x = parseInt(getParameter_1("x"));
			if (isNaN(x)) x = 0;
			var y = parseInt(getParameter_1("y"));
			if (isNaN(y)) y = 0;
			if (x == CENTER_X && y == CENTER_Y) {
//20120524				document.getElementById("mapAll").style.display = "block";
				document.getElementById(mapAllId).style.display = "block";

				document.getElementById("maptoolLink").style.display = "block";
				window.scroll(0,0);
			} else {
				//ページリロード
				GM_setValue(map_hostname + "MAP_MODE", MAP_MODE);
				location.href = getMapUrl(CENTER_X, CENTER_Y);
			}
		}
		
		//未表示の場合はHTML生成
		if (LOADED_MAPS[MAP_MODE] != "1") {
//console.log((new Date()).getTime());
			if (MAP_MODE == MAP_MODE_M) {
				document.getElementById("maptoolBody").innerHTML = genBodyHtml();
//				// 右クリックメニューテスト用 by どらごら
//				if(ROUTE_ENABLE) {
//					for (var y=CENTER_Y+RADIUS; y>=CENTER_Y-RADIUS; y--) {
//						for (var x=CENTER_X-RADIUS; x<=CENTER_X+RADIUS; x++) {
//							
//							// 右クリック
//							var clsData = new genPopupText(loadCellData(generateCellKey(x, y)), x, y);
//							var routeLink = document.getElementById("route_a_" + x + "_" + y);
//	            function onMapContextMenu_env(b){return function(e) {onMapContextMenu(e, b);}}
//							routeLink.addEventListener("contextmenu", onMapContextMenu_env(clsData), false);
//							
//						}
//					}
//				}
			} else if (MAP_MODE == MAP_MODE_L) {
				document.getElementById("maptoolBodyL").innerHTML = genBodyHtmlL();
			}
//console.log((new Date()).getTime());
			
			LOADED_MAPS[MAP_MODE] = "1";
		}
		
		// by どらごら
		if(ROUTE_ENABLE) {
			onReWrite();
		}
		
		resetCursor();
	}, 0);
}

//同盟データ読み込み
function loadAllyData(ally) {
	var ret = new Array();
	var src = GM_getValue(generateAllyKey(ally), "");
	
	var array1 = src.split(DELIMIT_1);
	ret[IDX_ALLY_PARENT] = array1[IDX_ALLY_PARENT];
	if (ret[IDX_ALLY_PARENT] == undefined) ret[IDX_ALLY_PARENT] = "";
	
	var chiliren = new Array();
	if (array1[IDX_ALLY_CHILDREN] != undefined && array1[IDX_ALLY_CHILDREN] != "") {
		chiliren = array1[IDX_ALLY_CHILDREN].split(DELIMIT2_1);
	}
	ret[IDX_ALLY_CHILDREN] = chiliren;
	
	var members = new Array();
	if (array1[IDX_ALLY_MEMBERS] != undefined && array1[IDX_ALLY_MEMBERS] != "") {
		members = array1[IDX_ALLY_MEMBERS].split(DELIMIT2_1);
	}
	ret[IDX_ALLY_MEMBERS] = members;
	
	return ret;
}

//同盟データ保存
function saveAllyData(ally, data) {
	var dataArray = new Array();
	dataArray[IDX_ALLY_PARENT] = data[IDX_ALLY_PARENT];
	dataArray[IDX_ALLY_CHILDREN] = genDelimitString_1(data[IDX_ALLY_CHILDREN], DELIMIT2_1);
	dataArray[IDX_ALLY_MEMBERS] = genDelimitString_1(data[IDX_ALLY_MEMBERS], DELIMIT2_1);
	GM_setValue(generateAllyKey(ally), genDelimitString_1(dataArray, DELIMIT_1));
//console.log(generateAllyKey(ally) +":"+ genDelimitString_1(dataArray, DELIMIT_1));
	
	ALLYS_CACHE[ally] = data;
	if (searchArrayItem(ALLYS_INDEX, ally) < 0) {
		ALLYS_INDEX.push(ally);
	}
}

//同盟データキャッシュ取得
function getAllyDataCache(ally) {
	if (ALLYS_CACHE[ally] == undefined) {
		ALLYS_CACHE[ally] = loadAllyData(ally);
	}
	return ALLYS_CACHE[ally];
}

//親同盟取得
function getParentAlly(ally) {
	parentAlly = getAllyDataCache(ally)[IDX_ALLY_PARENT];
	if (parentAlly == undefined) {
		parentAlly = "";
	}
	
	return parentAlly;
}

//親同盟更新
function updateParentAlly(child, parent) {
	var childData = getAllyDataCache(child);
	var beforeParent = childData[IDX_ALLY_PARENT];
	
	//子同盟のデータを更新
	childData[IDX_ALLY_PARENT] = parent;
	saveAllyData(child, childData);
	
	//親同盟の子同盟リストに追加
	if (parent != "") {
		//TODO
	}
	
	//親同盟が変わった場合、元親の子同盟リストから削除
	if (beforeParent != "" && beforeParent != parent) {
		//TODO
	}
}

//同盟所属君主のデータを更新
function updateAllyMember(user, ally) {
	
	//所属同盟のデータを更新
	{
		var afterAllyData = getAllyDataCache(ally);
		var members = afterAllyData[IDX_ALLY_MEMBERS];
		if (searchArrayItem(members, user) < 0) {
			members.push(user);
			afterAllyData[IDX_ALLY_MEMBERS] = members;
			saveAllyData(ally, afterAllyData);
		}
	}
	
	//君主データの同盟情報を取得
	var userData = getUserDataCache(user);
	var beforeAlly = userData[IDX_USER_ALLY];
	
	//君主データがなかったら作成
	if (beforeAlly == "") {
		userData[IDX_USER_ALLY] = ally;
		saveUserData(user, userData);
	
	//君主の所属同盟が変化した場合
	} else if (beforeAlly != ally) {
		
		//同盟データの所属君主情報を更新
		var beforeAllyData = getAllyDataCache(beforeAlly);
		var members = beforeAllyData[IDX_ALLY_MEMBERS];
		var itemIdx = searchArrayItem(members, user);
		if (itemIdx >= 0) {
			members.splice(itemIdx, 1);
			beforeAllyData[IDX_ALLY_MEMBERS] = members;
			saveAllyData(beforeAlly, beforeAllyData);
		}
		
		//君主データの同盟情報を更新
		userData[IDX_USER_ALLY] = ally;
		saveUserData(user, userData);
	}
}

//君主データ読み込み
function loadUserData(user) {
	var ret = new Array();
	var src = GM_getValue(generateUserKey(user), "");
	var array1 = src.split(DELIMIT_1);
	
	var villages = new Array();
	if (array1[IDX_USER_VILLAGES] != undefined && array1[IDX_USER_VILLAGES] != "") {
		villages = array1[IDX_USER_VILLAGES].split("|");
	}
	ret[IDX_USER_VILLAGES] = villages;
	
	ret[IDX_USER_ALLY] = array1[IDX_USER_ALLY];
	if (ret[IDX_USER_ALLY] == undefined) ret[IDX_USER_ALLY] = "";
	
	return ret;
}

//君主データ保存
function saveUserData(user, data) {
	var dataArray = new Array();
	dataArray[IDX_USER_VILLAGES] = genDelimitString_1(data[IDX_USER_VILLAGES], "|");
	dataArray[IDX_USER_ALLY] = data[IDX_USER_ALLY];
	GM_setValue(generateUserKey(user), genDelimitString_1(dataArray, DELIMIT_1));
//console.log(generateUserKey(user) + ": " + genDelimitString_1(dataArray, DELIMIT_1));
	
	USERS_CACHE[user] = data;
	if (searchArrayItem(USERS_INDEX, user) < 0) {
		USERS_INDEX.push(user);
	}
}

//君主データキャッシュ取得
function getUserDataCache(user) {
	if (USERS_CACHE[user] == undefined) {
		USERS_CACHE[user] = loadUserData(user);
	}
	return USERS_CACHE[user];
}

//検索用索引保存
function saveAllysIndex() {
	GM_setValue(map_hostname + "ALLYS_INDEX", 
		genDelimitString_1(ALLYS_INDEX, DELIMIT_1));
}
function saveUsersIndex() {
	GM_setValue(map_hostname + "USERS_INDEX", 
		genDelimitString_1(USERS_INDEX, DELIMIT_1));
}

//NPC砦リストに追加
function saveNpcsIndex(value) {
	var key = map_hostname + "NPCS_INDEX";
	var delimiter = DELIMIT_1;
	
	var items = splitDelimited(GM_getValue(key, ""), delimiter);
	
	if (items.indexOf(value) == -1) {
		items.push(value);
		
		//Greasemonkey領域へ永続保存
		GM_setValue(key, genDelimitString_1(items, delimiter));
//console.log(key+": " + genDelimitString_1(items, delimiter));
	}
}

//完全一致/部分一致変更
function changeMatchMode(checked) {
	GM_setValue(map_hostname + "MATCH_FULL", checked);
//console.log(map_hostname + "MATCH_FULL: " + checked);
	MATCH_FULL = checked;
	
	//地図変更
	LOADED_MAPS = new Array();
	changeMap();
}


//名称定義読み込み
function loadNames(key) {
	var result = GM_getValue(map_hostname + key, "").split(DELIMIT_1);
	return result;
}

//色定義読み込み
function loadColors(key, defaults) {
	var result = new Array();
	var inputs = GM_getValue(map_hostname + key, "").split(DELIMIT_1)
	for (var i = 0; i < defaults.length; i++) {
		if (inputs[i] == undefined || inputs[i] == "") {
			result[i] = defaults[i];
		} else {
			result[i] = inputs[i];
		}
	}
	return result;
}

//入力値を保存
function saveInputAllys(key) {
	saveInputValues(key, ALLY_COLORS.length, "ally");
}
function saveInputUsers(key) {
	saveInputValues(key, USER_COLORS.length, "user");
}
function saveInputColors(key) {
	saveInputValues(key, MAP_MATE_COLORS.length, "col");
}
function saveInputValues(key, length, id) {
	var newAllys = new Array();
	
	//テキストボックスから入力値を取得
	for (var i = 0; i < length; i++) {
		newAllys[i] = trim_1(document.getElementById(id + (i+1)).value);
	}
	
	//Greasemonkey領域に永続保存
	trimArray(newAllys);
	GM_setValue(map_hostname + key, genDelimitString_1(newAllys, DELIMIT_1));
//console.log(map_hostname + key + ":" + genDelimitString_1(newAllys, DELIMIT_1));
}

//配列空項目削除
function trimArray(ary) {
	for (var i = ary.length - 1; i >= 0; i--) {
		if (ary[i] != undefined && ary[i] != "") break;
		ary.splice(i, 1);
	}
}

//地図データCSV出力
function outputMapCsvS() {
	outputMapCsv(CSV_RADIUS_S);
}
function outputMapCsvL() {
	outputMapCsv(CSV_RADIUS_L);
}
function outputMapCsv(radius) {
//20120524	document.getElementById("mapAll").style.display = "none";
	document.getElementById(mapAllId).style.display = "none";
	document.getElementById("maptoolLink").style.display = "none";
	
	var frameElem = document.createElement("iframe");
	frameElem.id = "maptoolCsvFrame";
	frameElem.style.width = "100%";
	frameElem.style.height = "540px";
	
	var mapElem = document.evaluate('//*[@id="mapboxInner"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	mapElem.snapshotItem(0).insertBefore(
//20120524		frameElem, document.getElementById("mapAll").nextSibling);
		frameElem, document.getElementById(mapAllId).nextSibling);
	
	//時間がかかるので別スレッド化（一旦描画して砂時計を表示させる）
	setWaitCursor();
	window.setTimeout(function() {
		var frameDoc = document.getElementById("maptoolCsvFrame").contentDocument;
		var addElem = frameDoc.createElement("pre");
		addElem.id = "maptoolCsv";
		addElem.style.fontSize = "12px";
		frameDoc.body.appendChild(addElem);
		
		//タイトル行
		var csvText = "";
		csvText += "X,Y,VILLAGE_NAME,USER_NAME,POPULATION,X_Y,ALLIANCER,POWER,";
		csvText += "WOOD,STONE,IRON,RICE,NPC_FLAG,LAST_UPDATE,CAPITAL_FLAG,PARENT_ALLY\n";
		
		//各マス行
		for (var y=CENTER_Y+radius; y>=CENTER_Y-radius; y--) {
			for (var x=CENTER_X-radius; x<=CENTER_X+radius; x++) {
				
				//保存データ取得
				var data = loadCellData(generateCellKey(x, y));
				if (data.length == 0) {
					continue;
				}
				
				csvText += x;
				csvText += ",";
				csvText += y;
				csvText += ",";
				csvText += convCsvString(data[IDX_VILLAGE_NAME]);
				csvText += ",";
				csvText += convCsvString(data[IDX_USER_NAME]);
				csvText += ",";
				csvText += data[IDX_POPULATION];
				csvText += ",";
				csvText += convCsvString("(" + x + "," + y + ")");
				csvText += ",";
				csvText += convCsvString(data[IDX_ALLIANCER]);
				csvText += ",";
				csvText += data[IDX_POWER];
				csvText += ",";
				csvText += data[IDX_WOOD];
				csvText += ",";
				csvText += data[IDX_STONE];
				csvText += ",";
				csvText += data[IDX_IRON];
				csvText += ",";
				csvText += data[IDX_RICE];
				csvText += ",";
				csvText += data[IDX_NPC_FLG];
				csvText += ",";
				csvText += data[IDX_LAST_UPDATE];
				csvText += ",";
				csvText += data[IDX_CAPITAL_FLG];
				csvText += ",";
				csvText += convCsvString(getParentAlly(data[IDX_ALLIANCER]));
				csvText += "\n";
			}
		}
		
		addElem.innerHTML = csvText;
		resetCursor();
	}, 100);
}

//マスデータキー生成
function generateCellKey(x, y) {
	return map_hostname + "(" + x + "," + y + ")";
}
//同盟データキー生成
function generateAllyKey(allyName) {
	return map_hostname + "_ally_" + escape(allyName);
}
//君主データキー生成
function generateUserKey(userName) {
	return map_hostname + "_user_" + escape(userName);
}

//基準時刻取得
function getBaseTime() {
	var res = GM_getValue(map_hostname + "BASE_TIME", "");
	if (res == "") {
		var date = new Date();
		res = "" + date.getFullYear() + padZero_1(date.getMonth() + 1) + 
			padZero_1(date.getDate());
	}
	return res;
}

//自拠点座標取得
//RE土＠mixi鯖さん(http://3gokushijp.zouri.jp/)提供
function getMyXY_1() {
	var d = document;
	var $x = function(xp,dc) {
		return document.evaluate(xp, dc||d, null, 
			XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
	};

	var nowLoc = $x('id("gNav")//a[contains(@href,"map.php")]');
	if (!nowLoc) return "";
	var xy = nowLoc.href.match(/x=([\-0-9]+)&y=([\-0-9]+)/i);
	if( xy ) {
		return xy[1]+","+xy[2];
	}
}

//地図シフト
function shiftMap(shiftX, shiftY) {
	var r; //半径
	if (MAP_MODE == MAP_MODE_M) r = RADIUS;
	else if (MAP_MODE == MAP_MODE_L) r = RADIUS_L;
	
	//移動先座標算出
	var x = CENTER_X + ((r*2 + 1) * shiftX);
	var y = CENTER_Y + ((r*2 + 1) * shiftY);
	
	//地図移動
	moveMap(x, y);
}

//地図移動
function moveMap(x, y) {
	if (isNaN(x) || isNaN(y)) return;
	CENTER_X = x;
	CENTER_Y = y;
	
	//範囲外に出ないように
	CENTER_X = (CENTER_X > MAX_XY ? MAX_XY: CENTER_X);
	CENTER_X = (CENTER_X < -MAX_XY ? -MAX_XY: CENTER_X);
	CENTER_Y = (CENTER_Y > MAX_XY ? MAX_XY: CENTER_Y);
	CENTER_Y = (CENTER_Y < -MAX_XY ? -MAX_XY: CENTER_Y);
	
	//地図表示
	LOADED_MAPS = new Array();
	changeMap();
}

//地図画面URL取得
function getMapUrl(x, y) {
	return "/map.php?x=" + x + "&y=" + y;
}

//全データ初期化
function clearAllData() {
	var keys = GM_listValues();
	var hostname = map_hostname;	//location.hostnameが付いたﾃﾞｰﾀを削除する為、地図ﾂｰﾙのものは、"map_"+location.hostnameにして他に影響が出ないようにした。faraway111013
	for (var i = 0; i < keys.length; i++) {
		if (keys[i].indexOf(hostname, 0) == 0) {
			GM_deleteValue(keys[i]);
		}
	}
}

//カーソル変更
function setWaitCursor() {
	document.getElementsByTagName("body")[0].style.cursor = "wait";
}
function resetCursor() {
	document.getElementsByTagName("body")[0].style.cursor = "auto";
}

//CSS追加
function addGlobalStyle(css) {
	var head, style;
	head = document.getElementsByTagName("head")[0];
	if (!head) { return; } style = document.createElement("style");
	style.type = "text/css";
	style.innerHTML = css;
	head.appendChild(style);
}

//URLパラメータ取得
function getParameter_1(key) {
	var str = location.search.split("?");
	if (str.length < 2) {
		return "";
	}
	
	var params = str[1].split("&");
	for (var i = 0; i < params.length; i++) {
		var keyVal = params[i].split("=");
		if (keyVal[0] == key && keyVal.length == 2) {
			return decodeURIComponent(keyVal[1]);
		}
	}
	return "";
}

//子Element取得
function getChildElement_1(parentNode, position) {
	var current = 0;
	for (var i = 0; i < parentNode.childNodes.length; i++){
		var childNode = parentNode.childNodes[i];
		if (childNode.nodeType == 1) {
			if (current == position) {
				return childNode;
			}
			current++;
		}
	}
	
	return undefined;
}

//現在時刻取得（yyyy/mm/dd hh:mm:ss）
function getCurrentTime() {
	var date = new Date();
	var res = "" + date.getFullYear() + "/" + padZero_1(date.getMonth() + 1) + 
		"/" + padZero_1(date.getDate()) + " " + padZero_1(date.getHours()) + ":" + 
		padZero_1(date.getMinutes()) + ":" + padZero_1(date.getSeconds());
	return res;
}
//現在時刻取得2（yyyymmddhhmmss）
function getCurrentTime2() {
	var date = new Date();
	var res = "" + date.getFullYear() + padZero_1(date.getMonth() + 1) + 
		padZero_1(date.getDate()) + padZero_1(date.getHours()) + 
		padZero_1(date.getMinutes()) + padZero_1(date.getSeconds());
	return res;
}

//先頭ゼロ付加
function padZero_1(num) {
	var result;
	if (num < 10) {
		result = "0" + num;
	} else {
		result = "" + num;
	}
	return result;
}
//先頭ゼロ除去
function trimZero_1(str) {
	var res = str.replace(/^0*/, "");
	if (res == "") res = "0";
	return res;
}

//空白除去
function trim_1(str) {
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
}

//CSV用文字列変換
function convCsvString(str) {
	var result;
	
	//「"」を「""」に変換
	result = str.replace(/\"/g, "\"\"");
	
	//「,」を含む場合は全体を「"」で囲む
	if (result.indexOf(",") >= 0) {
		result = "\"" + result + "\""
	}
	
	return result;
}

//デリミタ区切り文字列生成
function genDelimitString_1(dataArray, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}


//完全一致/部分一致チェック
function matchString(target, sub) {
	if (target == undefined || sub == undefined || sub == "") {
		return false;
	}
	
	var tbl = sub.split(",")
	target = target.toLowerCase();

	for (var i=0; i<tbl.length; i++) {
		var tmp = tbl[i].toLowerCase();
		if (tmp != undefined && tmp != "") {
			if (MATCH_FULL) {
				if (target == tmp) return true;
			} else {
				if (target.indexOf(tmp) >= 0) return true;
			}
		}
	}

	return false;
}

function searchArrayString(targets, sub) {
	var ret = new Array();
	for (var i=0; i<targets.length; i++) {
		if (matchString(targets[i], sub)) ret.push(targets[i]);
	}
	return ret;
}

//数値チェック
function isNumeric_1(num) {
	if (num.match(/^-?[0-9]+$/)) {
		return true;
	}
	return false;
}

//配列検索
function searchArrayItem(array, key) {
	for (var i=0; i<array.length; i++) {
		if (array[i] == key) {
			return i;
		}
	}
	return -1;
}

//デリミタ区切り文字列を配列に変換
function splitDelimited(str, delimiter) {
	if (str == undefined || str == "") {
		return new Array();
	} else {
		return str.split(delimiter);
	}
}

//Google Chrome用GM_*系ラッパー関数
function initGMWrapper_1() {
	
	// @copyright      2009, James Campos
	// @license        cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
	if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
		GM_addStyle = function(css) {
			var style = document.createElement('style');
			style.textContent = css;
			document.getElementsByTagName('head')[0].appendChild(style);
		}

		GM_deleteValue = function(name) {
			localStorage.removeItem(LOCAL_STORAGE_1 + "." + name);
		}

		GM_getValue = function(name, defaultValue) {
			var value = localStorage.getItem(LOCAL_STORAGE_1 + "." + name);
			if (!value)
				return defaultValue;
			var type = value[0];
			value = value.substring(1);
			switch (type) {
				case 'b':
					return value == 'true';
				case 'n':
					return Number(value);
				default:
					return value;
			}
		}

		GM_log = function(message) {
			console.log(message);
		}

		GM_registerMenuCommand = function(name, funk) {
		//todo
		}

		GM_setValue = function(name, value) {
			value = (typeof value)[0] + value;
			try {
				localStorage.setItem(LOCAL_STORAGE_1 + "." + name, value);
			} catch (e) {
				alert("localStorageへの保存に失敗 (" + e + ")");
				throw e;
			}
		}
		
		//by froo
		GM_listValues = function() {
			var res = new Array();
			for (var i = 0; i < localStorage.length; i++) {
				var key = localStorage.key(i);
				if (key.indexOf(LOCAL_STORAGE_1 + ".", 0) == 0) {
					res.push(key.replace(/^.*?\./, ""));
				}
			}
			return res;
		}
	}
}

//------------------------------------------------------------------------------

//座標から同盟名を取得 by どらごら
// getAllyFromMapClassからコピペ
function getAllyFromXy(x, y) {
	var data = getCellDataCache(generateCellKey(x, y));
	var ally = data[IDX_ALLIANCER];
	if (ally == undefined) ally = "";
	
	return ally;
}

//59x59範囲取得 by どらごら
function getMap5959() {
	
	var max;	//取得画面数
	var pos;	//取得位置補正

	if (MAP_MODE == MAP_MODE_L){
		max = 13;	//13×13＝169画面分取得
		pos = 120;
	} else {
		if (MAP_WIDE){
			max = 4;	//4×4＝16画面分取得
			pos = 30;
		} else {
			max = 3;	//3×3＝9画面分取得
			pos = 20;
		}
	}

	if( confirm("表示範囲を一気に取得するためサーバに負荷がかかります。\n" +
							"何度も実行するとDOS攻撃と同じなので、実行には注意して下さい\n" +
							"※取得中はあまり他の動作を行わないようにしてください。") == false ) return;

	for (var i = 0; i < max; i++) {
		for (var j = 0; j < max; j++) {
			GET_MAP_LIST.push(new Array(CENTER_X - pos + (j*20), CENTER_Y - pos + (i*20)));
		}
	}
	setWaitCursor();
	GET_MAP_LIST_COUNTER = GET_MAP_LIST.length;
	MAX_MAP_LIST = GET_MAP_LIST_COUNTER;
	window.setTimeout(getMaps, 0);
	GET_MAP_SLEEP_TID = setInterval( GetMapSleep , 1000);
}

// 条件監視sleep by どらごら
function GetMapSleep(){
	j$("#maptoolExGetMap5959").text((MAX_MAP_LIST - GET_MAP_LIST_COUNTER) + "/" + MAX_MAP_LIST);

	clearInterval(GET_MAP_SLEEP_TID);
	if(GET_MAP_LIST_COUNTER <= 0){
		LOADED_MAPS = new Array();
		changeMap();
		resetCursor();
		j$("#maptoolExGetMap5959").text("全範囲取得");
		alert("地図情報　取得完了!");
	} else {
		GET_MAP_SLEEP_TID = setInterval( GetMapSleep , 1000);
	}
	
}

// マップページをajaxを使用して取得 by どらごら
function getMaps() {
	
	j$("#maptoolExGetMap5959").text((MAX_MAP_LIST - GET_MAP_LIST_COUNTER) + "/" + MAX_MAP_LIST);
	if(GET_MAP_LIST.length == 0) {
		return;
	}
	
	var mapPosi = GET_MAP_LIST.pop();
	
	cajaxRequest_1(getMapUrl(mapPosi[0], mapPosi[1]) + "&type=3", "GET", "", function(req) {
		var cx = parseInt(CENTER_X);
		var cy = parseInt(CENTER_Y);
		var map= parseInt(MAP_SCALE);
		CENTER_X = parseInt(mapPosi[0]);
		CENTER_Y = parseInt(mapPosi[1]);
		MAP_SCALE = 20;	//↑の引数「type=3」は１画面20×20マスのモード
		var reqXML = createNewDocument(req.responseText);
		saveMapData2(reqXML);
		saveCapital2(reqXML);
		saveAllyForMap2(reqXML);
		CENTER_X = parseInt(cx);
		CENTER_Y = parseInt(cy);
		MAP_SCALE = map;
		GET_MAP_LIST_COUNTER = GET_MAP_LIST_COUNTER - 1;
	});
	
	window.setTimeout(getMaps, 0);
}

// html to new document
// Autopagerize(http://userscripts.org/scripts/review/8551)
// by どらごら
function createNewDocument(req) {
	
	return createHTMLDocumentByString(req);
	
	function createHTMLDocumentByString(str) {
    if (document.documentElement.nodeName != 'HTML') {
        return new DOMParser().parseFromString(str, 'application/xhtml+xml')
    }
    var html = strip_html_tag(str)
    var htmlDoc
    try {
        // We have to handle exceptions since Opera 9.6 throws
        // a NOT_SUPPORTED_ERR exception for |document.cloneNode(false)|
        // against the DOM 3 Core spec.
        htmlDoc = document.cloneNode(false)
        htmlDoc.appendChild(htmlDoc.importNode(document.documentElement, false))
    }
    catch(e) {
        htmlDoc = document.implementation.createDocument(null, 'html', null)
    }
    var fragment = createDocumentFragmentByString(html)
    try {
        fragment = htmlDoc.adoptNode(fragment)
    }
    catch(e) {
        fragment = htmlDoc.importNode(fragment, true)
    }
    htmlDoc.documentElement.appendChild(fragment)
    return htmlDoc
	}
	function strip_html_tag(str) {
    var chunks = str.split(/(<html(?:[ \t\r\n][^>]*)?>)/)
    if (chunks.length >= 3) {
        chunks.splice(0, 2)
    }
    str = chunks.join('')
    chunks = str.split(/(<\/html[ \t\r\n]*>)/)
    if (chunks.length >= 3) {
        chunks.splice(chunks.length - 2)
    }
    return chunks.join('')
	}
	function createDocumentFragmentByString(str) {
    var range = document.createRange()
    range.setStartAfter(document.body)
    return range.createContextualFragment(str)
	}
}

// ajaxラッパー by どらごら
function cajaxRequest_1(url, method, param, func_success, func_fail){
	var req = new XMLHttpRequest();
	req.onreadystatechange = function() {
		if (req.readyState == 4 && req.status == 200){
			func_success(req);
		}
		else if (req.readyState == 4 && req.status != 200){
			func_fail(req);
		}
	}
	
	req.open(method, url, true);
	if (method == 'POST'){
		req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	}
	req.send(param);
}

// jQuery append by どらごら
// 
function jQueryAppend() {
	
	j$ = unsafeWindow.jQuery;
	
  j$(document.body).append(
		"<div id='route_contextmenu'>" +
			"<ul id='route_command' style='text-align:left'></ul>" +
		"</div>");
	j$("#route_contextmenu")
		.hide()
		.css({ 
			position: "absolute", 
			backgroundColor: "white", 
			border: "outset 2px gray", 
			color: "black", 
			padding: "3px", 
			zIndex: 999
		});
	
	
}

// スクリプトタグを追加 by どらごら
function addRouteScriptHtml() {
	
	if(ROUTE_ENABLE == false) return;
	
	var funcHTML = onMapMouseOver+onMapMouseOut+onMapClick+menuMapChk+createArgClass+
									onMapContextMenu+menuMapChk+menuChkDel;
	var scriptElem = document.createElement("script");
	scriptElem.type = "text/javascript";
	scriptElem.innerHTML = funcHTML;
	document.getElementsByTagName("head")[0].appendChild(scriptElem);
}

function createArgClass(x, y, pw, center_flg, bg_color) {
	this.x = x;
	this.y = y;
	this.pw = pw;
	this.center_flg = center_flg;
	this.bg_color = bg_color;
}

// マウス移動 by どらごら
function onMapMouseOver(e, x,y,p,c,b) {
	j$("#route_td_" + x + "_" + y).css("border", "solid 2px lime");
}

// マウス外れ by どらごら
function onMapMouseOut(e, x,y,p,c,b) {
	//中心マスに目印
	var borderColor = "white";
	var borderPic = "0px";
	var bold = "solid";
	if (c) {
		borderColor = "black";
		borderPic = "2px";
	}
	j$("#route_td_" + x + "_" + y).css("border", bold+" "+borderPic+" "+borderColor);
	
}

// マップ左クリック by どらごら
function onMapClick(e, x,y,p,c,b) {
	if(document.getElementById("route_chk_enable").checked == true) {
		menuMapChk(e, x,y,p,c,b);
	} else {
		location.href = "/map.php?x=" + x + "&y=" + y;
	}
}

// マップ右クリック by どらごら
function onMapContextMenu(e, x,y,p,c,b) {
	
	// メニュー追加
	j$("#route_command")
		.text("")
		.append("<li id='chkLink' class='route_item' style='padding:0px 10px'>チェック</li>")
		.append("<li id='delLink' class='route_item' style='padding:0px 10px'>取り消し</li>")
		.append("<li id='moveLink' class='route_item' style='padding:0px 10px'>画面遷移</li>")
		.append("<li id='detailLink' class='route_item' style='padding:0px 10px'>詳細</li>")
		.append("<li id='sortieLink' class='route_item' style='padding:0px 10px'>出撃</li>");
	
	j$(".route_item")
		.mouseover(function() {
			j$(this).css("backgroundColor", "grey")
		})
		.mouseout(function() {
			j$(this).css("backgroundColor", "white")
		});
	
	j$("#chkLink")
		.addClass("subMenuItem")
		.unbind("click")
		.one("click", 
			function (x,y,p,c,b) {
				return function () {
					menuMapChk(e, x,y,p,c,b);
				};
			}(x,y,p,c,b));
	
	j$("#delLink")
		.addClass("subMenuItem")
		.unbind("click")
		.one("click", 
			function (x,y,p,c,b) {
				return function () {
					menuChkDel(e, x,y,p,c,b);
				};
			}(x,y,p,c,b));
	
	j$("#moveLink")
		.addClass("subMenuItem")
		.unbind("click")
		.one("click", 
			function (x,y,p,c,b) {
				return function () {
					location.href = "map.php?x=" + x + "&y=" + y;
				};
			}(x,y,p,c,b));
	
	j$("#detailLink")
		.addClass("subMenuItem")
		.unbind("click")
		.one("click", 
			function (x,y,p,c,b) {
				return function () {
					location.href = "land.php?x=" + x + "&y=" + y;
				};
			}(x,y,p,c,b));
	
	
	j$("#sortieLink")
		.addClass("subMenuItem")
		.unbind("click")
		.one("click", 
			function (x,y,p,c,b) {
				return function () {
					location.href = "facility/castle_send_troop.php?x=" + x + "&y=" + y + "#ptop";
				};
			}(x,y,p,c,b));
	
	
	
	// メニュー表示
	j$("#route_contextmenu")
		.css({ 
			left: e.pageX + "px", 
			top: e.pageY + "px"
		})
		.show();
	
	j$(document)
		.unbind("click")
		.one("click", 
			function () {
				j$("#route_contextmenu").hide();
			});
	
	// デフォルトのメニューは非表示
	e.preventDefault();
}

// ルートの検証 by どらごら
function onValidation() {
	
	var txtbox = document.getElementById("route_output");
	var line = txtbox.value.split("\n");
	var x = null;
	var y = null;
	var lineNum;
	
	for(var i=0;i<line.length;i++) {
		
		regObj = new RegExp(/[^-^\d]*([^,]*),([^\)]*)\)[\s\u3000\u2605\u2606\d]*(.*)/);
		if (line[i].match(regObj)) {
			
			var tdElem = document.getElementById("route_td_" + RegExp.$1 + "_" + RegExp.$2);
			if (tdElem == null) {
				continue;
			}
			
			if ((x == null) && (y == null)) {
				x = RegExp.$1;
				y = RegExp.$2;
				lineNum = i;
				continue;
			}
			
			if ((Math.abs(x - RegExp.$1) > 1 ) || (Math.abs(y - RegExp.$2) > 1 )) {
				// not chain
				var msg = (lineNum + 1) + "行目の(" + x + "," + y + ")と\n" +
				          (i + 1) + "行目の(" + RegExp.$1 + "," + RegExp.$2 + ")が離れています";
				alert(msg);
			}
			x = RegExp.$1;
			y = RegExp.$2;
			lineNum = i;
		}
		
	}
	
	alert("チェック終了！");
}

// マップをチェック by どらごら
function menuMapChk(e, x,y,p,c,b) {
	j$("#route_output").val(j$("#route_output").val() + "(" + x + "," + y + ") ★" + p.length + " \n");
	j$("#route_td_" + x + "_" + y).css("backgroundColor", "#FF00FF");
}

// チェックを削除 by どらごら
function menuChkDel(e, x,y,p,c,b) {
	
	var txtbox = document.getElementById("route_output");
	var line = txtbox.value.split("\n");
	var newText = "";
	
	for(var i=0;i<line.length;i++) {
		
		regObj = new RegExp(/[^-^\d]*([^,]*),([^\)]*)\)[\s\u3000\u2605\u2606\d]*(.*)/);
		if (line[i].match(regObj)) {
			
			if((x == RegExp.$1) && (y == RegExp.$2)) {
				
				var tdElem = document.getElementById("route_td_" + RegExp.$1 + "_" + RegExp.$2);
				if(tdElem != null) {
					tdElem.style.backgroundColor = b;
				}
				
			} else {
				newText += line[i] + "\n";
			}
			
		} else {
			// 一致しなくても、行は有効
			newText += line[i] + "\n";
		}
		
	}
	txtbox.value = newText;
	
}

// マップに反映 by どらごら
function onReWrite() {
	var txtbox = document.getElementById("route_output");
	var line = txtbox.value.split("\n");
	
	for(var i=0;i<line.length;i++) {
		
		regObj = new RegExp(/[^-^\d]*([^,]*),([^\)]*)\)[\s\u3000\u2605\u2606\d]*(.*)/);
		if (line[i].match(regObj)) {
			
			var tdElem = document.getElementById("route_td_" + RegExp.$1 + "_" + RegExp.$2);
			if(tdElem == null) {
				continue;
			}
			
			if(RegExp.$3.trim() == "") {
				tdElem.style.backgroundColor = "#FF00FF";
			} else {
				tdElem.style.backgroundColor = "#00FF00";
			}
		}
		
	}
}

// 出兵画面に簡易出兵先情報表示準備 by どらごら
function sendTroop() {
	
	//自拠点座標取得
	var xy = getMyXY_1();
	if (xy == "") {
		MY_X = 0;
		MY_Y = 0;
	} else {
		MY_X = parseInt(xy.split(",")[0]);
		MY_Y = parseInt(xy.split(",")[1]);
	}
	
	j$("input[name=village_x_value]").attr("id", "village_x_value");
	j$("input[name=village_y_value]").attr("id", "village_y_value");
	document.getElementById("village_x_value").addEventListener("change",
		function() {
			sendTroopInfo();
		},
		true);
	document.getElementById("village_y_value").addEventListener("change",
		function() {
			sendTroopInfo();
		},
		true);
	
	j$(".notice:eq(3)").append(
		"<div id='sendTroopInfo'>" +
			"<table id='sendTroopInfoTable' class='commonTables'>" +
			"<tr>" +
				"<th class='mainTtl'>森</th>" +
				"<th class='mainTtl'>岩</th>" +
				"<th class='mainTtl'>鉄</th>" +
				"<th class='mainTtl'>糧</th>" +
				"<th class='mainTtl'>強さ</th>" +
				"<th class='mainTtl'>距離</th>" +
			"</tr>" +
			"<tr>" +
				"<td id='sendTroop_wood'></th>" +
				"<td id='sendTroop_stone'></th>" +
				"<td id='sendTroop_iron'></th>" +
				"<td id='sendTroop_rice'></th>" +
				"<td id='sendTroop_power'></th>" +
				"<td id='sendTroop_distance'></th>" +
			"</tr>" +
			"</table>" +
			"<div id='locationErrMsg' style='display:none'>"+
				"<font color='red'>未取得の座標です</font>"+
			"</div>"+
		"</div>"
	);
	
	// 情報表示
	sendTroopInfo();
}

// 出兵画面に簡易出兵先情報表示 by どらごら
function sendTroopInfo() {
	
	//保存データ取得
	var x = parseInt(j$("input[name=village_x_value]").val());
	var y = parseInt(j$("input[name=village_y_value]").val());
	var data = loadCellData(generateCellKey(x, y));
	if (data.length == 0) {
		j$("#sendTroopInfoTable td:first")
			.text("")
			.next().text("")
			.next().text("")
			.next().text("")
			.next().text("")
			.next().text("")
			;
		j$("#locationErrMsg").show();
		
	} else {
		var clsData = new genPopupText(data, x, y);	// by どらごら
		
		j$("#sendTroopInfoTable td:first")
			.text(clsData.data[IDX_WOOD])
			.next().text(clsData.data[IDX_STONE])
			.next().text(clsData.data[IDX_IRON])
			.next().text(clsData.data[IDX_RICE])
			.next().text("☆" + (clsData.power).length)
			.next().text(clsData.distance)
			;
		j$("#locationErrMsg").hide();
	}
}

function allianceCSV_1(){
	//CSV出力用
	if (j$("#csvMake").size() == 0){
		j$("table.tables")
			.after("<iframe style=\"width: 100%; height: 0px; visibility:hidden\" id=\"memberCsvFrame\"></iframe>")
			.after("<p id=\"csvMake\">同盟員全領地情報取得</p>");

		j$("#csvMake").css("background","black").css("width", "180px").css("color", "white").css("text-align", "center");
	}
	j$("#csvMake").click(function() {
		if (j$("#csvMake").text() != "同盟員全領地情報取得"){return;}
		if( confirm("同盟員の情報を一気に取得するためサーバに負荷がかかります。\n何度も実行するとDOS攻撃と同じなので、実行には注意して下さい") == false ) return;

		MEMBER_ID_LIST = new Array();
		j$("table.tables td a").each(function(){
			var url = j$(this).attr("href");
			var uid = url.match(/user_id=[0-9]+/);
			if (uid != null){
				MEMBER_ID_LIST.push({"URL":"/user/?" + uid});
			}
		});

		MEMBER_INFO_TEXT = "Ｘ座標,Ｙ座標,君主,領地,人口,本拠地,戦力,森,岩,鉄,糧,備考\n";
		setWaitCursor();
		MEMBER_ID_LIST_COUNTER = MEMBER_ID_LIST.length;
		MEMBER_ID_MAX_COUNTER = MEMBER_ID_LIST_COUNTER;
		window.setTimeout(GetMember, 0);
	});
}

function GetMember() {

	j$("#csvMake").text("情報取得中" +  (MEMBER_ID_MAX_COUNTER - MEMBER_ID_LIST_COUNTER) + "/" + MEMBER_ID_MAX_COUNTER);
	if(MEMBER_ID_LIST.length == 0) {
		if (MEMBER_ID_LIST_COUNTER > 0){
			window.setTimeout(GetMember, 1000);
		} else {
			var frameDoc = document.getElementById("memberCsvFrame").contentDocument;
			var addElem = frameDoc.createElement("pre");
			addElem.id = "memberCsv";
			addElem.style.fontSize = "12px";
			frameDoc.body.appendChild(addElem);

			addElem.innerHTML = MEMBER_INFO_TEXT;
			j$("#memberCsvFrame").css("height", "300px").css("visibility","visible");
			j$("#csvMake").text("同盟員全領地情報取得(済)");
			resetCursor();
			alert("同盟情報　取得完了!");
			return;
		}
	}

	var member = MEMBER_ID_LIST.pop();
	cajaxRequest_1(member.URL, "GET", "", function(req) {
		var dt = getXYListfromUserHTML(req.responseText);
		if( dt ) {
			for(var i=0 ; i<dt.length ; i++) {
				MEMBER_INFO_TEXT += dt[i].x + ",";
				MEMBER_INFO_TEXT += dt[i].y + ",";
				MEMBER_INFO_TEXT += convCsvString(dt[i].user_name) + ",";
				MEMBER_INFO_TEXT += convCsvString(dt[i].area_name) + ",";
				MEMBER_INFO_TEXT += dt[i].jinko + ",";
				MEMBER_INFO_TEXT += dt[i].honkyo + ",";
				var data = getCellDataCache(generateCellKey(dt[i].x, dt[i].y));
				if (data.length == 0) {
					MEMBER_INFO_TEXT += ",,,,,情報未取得\n";
				} else {
					if (dt[i].jinko != ""){
						MEMBER_INFO_TEXT += ",,,,,\n";	//拠点の場合、資源情報は無しとする。
					} else {
						MEMBER_INFO_TEXT += data[IDX_POWER] + ",";
						MEMBER_INFO_TEXT += data[IDX_WOOD] + ",";
						MEMBER_INFO_TEXT += data[IDX_STONE] + ",";
						MEMBER_INFO_TEXT += data[IDX_IRON] + ",";
						MEMBER_INFO_TEXT += data[IDX_RICE] + ",\n";
					}
				}
			}
		}

		MEMBER_ID_LIST_COUNTER = MEMBER_ID_LIST_COUNTER - 1;
	});
	window.setTimeout(GetMember, 0);

	function getXYListfromUserHTML(html){
		var ret = new Array();
		var tmp = html.match(/<td[^>]*>君主<\/td>[^<]*<td[^>]*>([^<\s]+)/);
		if( !tmp ) return null;
		var user_name = tmp[1];

		var pos;
		var reg = /<a href="\.\.\/(?:land|village_change)\.php[^"]*">\s*([^<\s]+)\s*<\/a>[^<]*<\/td>[^<]*<td[^>]*>([\-0-9]+),([\-0-9]+)<\/td>[^<]*<td[^>]*>([0-9]+|&nbsp;)<\/td>/;
		var honkyo = 1;
		while((pos = html.search(reg) ) != -1 ) {

			html = html.substr(pos);

			var dat = html.match(reg);
			if( !dat ) break;

			if( dat[4] == "&nbsp;" ) dat[4] = "";

			ret.push({"user_name":user_name, "area_name":dat[1].replace(/(^\s+|\s+$)/g, ""), "x":dat[2], "y":dat[3], "jinko":dat[4], "honkyo":honkyo});
			honkyo="";
			html = html.substr(dat[0].length);
		}

		return ret;
	}
}

function ChangePicture() {
	if (DISP_PICTURE){return;}
	j$("div #mapsAll img").each(function(){
		var src = j$(this).attr("src");
		if (src.indexOf("resource") >= 0){
			j$(this).remove();	//資源画像がヒットされたらタグそのものを削除。
		}
	});
}

function ConfigOpen() {
	j$('#CONFIG_AREA').show();
	GM_log("#open");
}

function ConfigClose() {
	j$('#CONFIG_AREA').hide();
	GM_log("#close");
}
//faraway 1.地図ツールのソース(bro3_map_tool.user.js) 終了

//faraway 2.タイマーのソース(bro3_timer.user.js)開始
//faraway 2.タイマーのソース(bro3_timer.user.js) 終了

//faraway 3.同盟貢献チェッカーのソース(bro3_contrib_checker.user.js)開始
// ==UserScript==
// @name           bro3_contrib_checker
// @version        1.01
// @namespace      http://blog.livedoor.jp/froo/
// @include        http://*.3gokushi.jp/alliance/info.php*
// @include        http://*.1kibaku.jp/alliance/info.php*
// @description    ブラウザ三国志 同盟貢献チェッカー by 浮浪プログラマ
// ==/UserScript==

// 公開ページ: http://blog.livedoor.jp/froo/archives/51427985.html
// 使い方: 同盟トップでリンク「貢献チェック実行」をクリック

//faraway 変数宣言移動前の場所


//main
//faraway (function(){
function disp_alliance() {	//faraway
//window.alert("3.同盟貢献チェッカー:" + location.pathname);	//faraway
	if(location.pathname != "/alliance/info.php") return;	//faraway
	//mixi鯖障害回避用: 広告iframe内で呼び出されたら無視
	var container = document.evaluate('//*[@id="container"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	if (container.snapshotLength == 0) return;
	
	initGMWrapper_3();
	
	//「略称」欄取得
	var myAllyElem = document.evaluate(
		'//*[@id="gray02Wrapper"]//table/tbody/tr[3]/td',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	if (myAllyElem.snapshotLength == 0) return;
	ALLY_NAME = trim_3(myAllyElem.snapshotItem(0).innerHTML);
	
	//前回更新日時取得
	LAST_UPDATE = GM_getValue(generateAllyKey_3(ALLY_NAME), "");
	
	//同盟ランキングTableタイトル部取得
	var tableTitle = document.evaluate(
		'//*[@id="gray02Wrapper"]//table[@class="tables"]/tbody/tr/th',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	
	//チェック実行リンク追加
	var checkExecLink = document.createElement("a");
	checkExecLink.id = "checkContribLink";
	checkExecLink.href = "javascript:void(0)";
	checkExecLink.innerHTML = "貢献チェック実行";
	if (LAST_UPDATE != "") {
		checkExecLink.innerHTML += "(前回:" + convDateStrShort(LAST_UPDATE) + ")";
	}
	checkExecLink.style.margin = "0px 5px";
	tableTitle.snapshotItem(0).appendChild(checkExecLink);
	checkExecLink.addEventListener("click", chackContrib, true);
	
	//基準時刻更新リンク追加
	var checkSaveLink = document.createElement("a");
	checkSaveLink.id = "saveContribLink";
	checkSaveLink.href = "javascript:void(0)";
	checkSaveLink.innerHTML = "貢献チェック基準時刻更新";
	checkSaveLink.innerHTML += "(";
	if (LAST_UPDATE != "") {
		checkSaveLink.innerHTML += convDateStrShort(LAST_UPDATE);
	}
	checkSaveLink.innerHTML += " → " + convDateStrShort(CURRENT_TIME);
	checkSaveLink.innerHTML += ")";
	checkSaveLink.style.display = "none";
	checkSaveLink.style.margin = "0px 5px";
	tableTitle.snapshotItem(0).appendChild(checkSaveLink);
	checkSaveLink.addEventListener("click", saveContrib, true);
	
	//データ更新済メッセージ追加
	var messageSaveEnd = document.createElement("span");
	messageSaveEnd.id = "descContribEnd";
	messageSaveEnd.innerHTML = "貢献チェック基準時刻更新済";
	messageSaveEnd.innerHTML += "(";
	if (LAST_UPDATE != "") {
		messageSaveEnd.innerHTML += convDateStrShort(LAST_UPDATE);
	}
	messageSaveEnd.innerHTML += " → " + convDateStrShort(CURRENT_TIME);
	messageSaveEnd.innerHTML += ")";
	messageSaveEnd.style.display = "none";
	messageSaveEnd.style.margin = "0px 5px";
	messageSaveEnd.style.fontSize = "10px";
	tableTitle.snapshotItem(0).appendChild(messageSaveEnd);
//faraway})();
}	//faraway

//貢献チェック実行
function chackContrib() {
	
	//「同盟内ランキング」Table各行の取得
	var userElems = document.evaluate(
		'//*[@id="gray02Wrapper"]//table[@class="tables"]/tbody/tr',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	for (var i = 0; i < userElems.snapshotLength; i++) {
		var newModified = "";
		var oldModified = "";
		
		var rowFields = document.evaluate('./td', userElems.snapshotItem(i), 
			null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		if (rowFields.snapshotLength == 0) continue;
		
		//「君主」欄
		var userField = rowFields.snapshotItem(1);
		var userLink = document.evaluate('./a', userField,
			null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var user = trim_3(userLink.snapshotItem(0).innerHTML);
		
		//前回値取得
		var userData = new Array();
		var dataStr = GM_getValue(generateUserKey_3(user), "");
		if (dataStr != "") {
			userData = dataStr.split(DELIMIT_3);
		}
		
		//「ランク」欄
		{
			var rankField = rowFields.snapshotItem(0);
			var newRank = trim_3(rankField.innerHTML);
			
			var rankItem = new Array("", "");
			if (userData[IDX_RANK] != undefined && userData[IDX_RANK] != "") {
				rankItem = userData[IDX_RANK].split(",");
			}
			
			var oldRank = rankItem[0];
			if (newRank != oldRank) {
				if (oldRank != "") {
					var diff = diffNum(oldRank, newRank);
					if (parseInt(diff) > 0) rankField.style.color = "red";
					else rankField.style.color = "blue";
					rankField.innerHTML = newRank + "<font size='-2'>(" + diff + ")</font>";
				}
				
				rankItem[0] = newRank;
				rankItem[1] = CURRENT_TIME;
				userData[IDX_RANK] = rankItem;
			}
		}
		
		//貢献チェック対象データ
		var fieldId = new Array(
			new Array(IDX_POINT, 2), //ポイント
			new Array(IDX_CONTRIB, 3), //寄付
			new Array(IDX_VILLAGE, 4) //拠点
		);
		for (var j = 0; j < fieldId.length; j++) {
			var targetElem = rowFields.snapshotItem(fieldId[j][1]);
			var targetData = userData[fieldId[j][0]];
			var newValue = trim_3(targetElem.innerHTML);
			
			var dataItem = new Array("", "");
			if (targetData != undefined && targetData != "") {
				dataItem = targetData.split(",");
			}
			var oldValue = dataItem[0];
			
			if (dataItem[1] > oldModified) {
				oldModified = dataItem[1];
			}
			
			if (newValue != oldValue) {
				
				//増減表示
				if (oldValue != "") {
					var diff = diffNum(newValue, oldValue);
					if (parseInt(diff) > 0) targetElem.style.color = "red";
					else targetElem.style.color = "blue";
					
					targetElem.innerHTML = newValue + 
						"<font size='-2'>(" + diff + ")</font>";
				}
				
				dataItem[0] = newValue;
				dataItem[1] = CURRENT_TIME;
				userData[fieldId[j][0]] = genDelimitString_3(dataItem, ",");
				newModified = CURRENT_TIME;
				
			} else if (oldModified > newModified) {
				newModified = oldModified;
			}
		}
		
		//前回変化からの時間数を表示
		var newText = trim_3(userField.innerHTML);
		newText += "<font size='-2'> (";
		if (oldModified != "" && oldModified != newModified) {
			newText += diffTime(CURRENT_TIME, oldModified) + "→";
		}
 		newText += diffTime(CURRENT_TIME, newModified);
 		newText += ")</font>";
 		userField.innerHTML = newText;
		
		if (oldModified != newModified) {
			userField.style.color = "red";
		}
		
		//データを保存
		if (newModified == CURRENT_TIME || rankItem[1] == CURRENT_TIME) {
			SAVE_DATA[user] = userData;
			SAVE_USERS.push(user);
		}
	}
	
	//操作リンク更新
	document.getElementById("checkContribLink").style.display = "none";
	if (LAST_UPDATE == "") {
		//初回なら即保存
		saveContrib();
		document.getElementById("descContribEnd").style.display = "inline";
	} else {
		document.getElementById("saveContribLink").style.display = "inline";
	}
}

//貢献チェック基準更新
function saveContrib() {
	
	//Greasemonkey領域へ値を保存
	for (var i = 0; i < SAVE_USERS.length; i++) {
		var dataStr = genDelimitString_3(SAVE_DATA[SAVE_USERS[i]], DELIMIT_3);
		GM_setValue(generateUserKey_3(SAVE_USERS[i]), dataStr);
//console.log(generateUserKey_3(SAVE_USERS[i]) + ": " + dataStr);
	}
	
	//Greasemonkey領域へ最終更新時刻を保存
	GM_setValue(generateAllyKey_3(ALLY_NAME), CURRENT_TIME);
//console.log(generateAllyKey_3(ALLY_NAME) + ": " + CURRENT_TIME);
	
	//操作リンク更新
	document.getElementById("saveContribLink").style.display = "none";
	document.getElementById("descContribEnd").style.display = "inline";
}

//同盟データキー生成
function generateAllyKey_3(allyName) {
	return location.hostname + "_ally2_" + escape(allyName);//faraway110602 同盟内ランキング貢献チェック実行(前回:05/12 14:02)文字化け回避保存のキー文字をユニークなものにした)
//faraway110602原型	return location.hostname + "_ally_" + escape(allyName);
}
//君主データキー生成
function generateUserKey_3(userName) {
	//faraway110616 return location.hostname + "_user_" + escape(userName);
	return location.hostname + "_user_3_" + escape(userName);	//faraway110616 他のｽｸﾘﾌﾟﾄと競合する為
}

//数値増減計算（文字列）
function diffNum(strNum1, strNum2) {
	var intNum1 = parseInt(strNum1);
	if (isNaN(intNum1)) intNum1 = 0;
	var intNum2 = parseInt(strNum2);
	if (isNaN(intNum2)) intNum2 = 0;
	
	var diffInt = intNum1 - intNum2;
	var diffStr = "" + diffInt;
	if (diffInt > 0) diffStr = "+" + diffStr;
	
	return diffStr;
}

//時刻差分計算（文字列）
function diffTime(strTime1, strTime2) {
	var date1 = new Date(strTime1);
	var date2 = new Date(strTime2);
	var diffSec = Math.ceil((date1.getTime() - date2.getTime()) / 1000);
	
	var result = "";
	result += Math.floor(diffSec / (60*60));
	result += ":";
	result += padZero_3(Math.floor((diffSec % (60*60)) / 60));
	result += ":";
	result += padZero_3(diffSec % 60);
	
	return result;
}

//日時文字列編集（yyyy/mm/dd hh:mm:ss）
function generateDateString_3(date) {
	var res = "" + date.getFullYear() + "/" + padZero_3(date.getMonth() + 1) + 
		"/" + padZero_3(date.getDate()) + " " + padZero_3(date.getHours()) + ":" + 
		padZero_3(date.getMinutes()) + ":" + padZero_3(date.getSeconds());
	return res;
}

//日付文字列を短縮型に変換
function convDateStrShort(str) {
	var result = str;
	result = result.replace(/^[0-9]{4}\//, "");
	result = result.replace(/:[0-9]{2}$/, "");
	return result;
}

//先頭ゼロ付加
function padZero_3(num) {
	var result;
	if (num < 10) {
		result = "0" + num;
	} else {
		result = "" + num;
	}
	return result;
}

//空白除去
function trim_3(str) {
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
}

//デリミタ区切り文字列生成
function genDelimitString_3(dataArray, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

//Google Chrome用GM_*系ラッパー関数
function initGMWrapper_3() {
	
	// @copyright      2009, James Campos
	// @license        cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
	if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
		GM_addStyle = function(css) {
			var style = document.createElement('style');
			style.textContent = css;
			document.getElementsByTagName('head')[0].appendChild(style);
		}

		GM_deleteValue = function(name) {
			localStorage.removeItem(LOCAL_STORAGE_3 + "." + name);
		}

		GM_getValue = function(name, defaultValue) {
			var value = localStorage.getItem(LOCAL_STORAGE_3 + "." + name);
			if (!value)
				return defaultValue;
			var type = value[0];
			value = value.substring(1);
			switch (type) {
				case 'b':
					return value == 'true';
				case 'n':
					return Number(value);
				default:
					return value;
			}
		}

		GM_log = function(message) {
			console.log(message);
		}

		 GM_registerMenuCommand = function(name, funk) {
		//todo
		}

		GM_setValue = function(name, value) {
			value = (typeof value)[0] + value;
			localStorage.setItem(LOCAL_STORAGE_3 + "." + name, value);
		}
	}
}
//faraway 3.同盟貢献チェッカーのソース(bro3_contrib_checker.user.js)終了

//faraway 4.発展チェッカーのソース(bro3_growth_checker.user.js)開始
// ==UserScript==
// @name           bro3_growth_checker
// @namespace      http://blog.livedoor.jp/froo/
// @include        http://*.3gokushi.jp/user/*
// @include        http://*.1kibaku.jp/user/*
// @description    ブラウザ三国志 発展チェッカー by 浮浪プログラマ
// ==/UserScript==

// 公開ページ: http://blog.livedoor.jp/froo/archives/51383261.html
// 使い方: 君主プロフィールページを表示

//faraway 変数宣言移動前の場所


//main
//faraway (function(){
function disp_development() {	//4.発展チェッカー faraway
//window.alert("disp_developmentです。4");
//window.alert("4.発展チェッカー:" + location.pathname);	//faraway
	
	//mixi鯖障害回避用: 広告iframe内で呼び出されたら無視
	var container = document.evaluate('//*[@id="container"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	if (container.snapshotLength == 0) return;
	
	//プロフィールページ以外なら処理しない
	if (location.pathname != "/user/" && location.pathname != "/user/index.php") {
		return;
	}
	
	initGMWrapper_4();
	
	//「君主」欄取得
	var user = "";
	var userElem = document.evaluate(
		'//*[@id="gray02Wrapper"]//table/tbody/tr[2]/td[2]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	user = userElem.snapshotItem(0).innerHTML;
	
	//前回値取得
	var data = new Array();
	var dataStr = GM_getValue(generateUserKey_4(user));	//faraway _4を追加
	if (dataStr != undefined) {
		data = dataStr.split(DELIMIT_4);
	}
	
	//各値欄取得
	var fieldPaths = new Array(
		'//*[@id="gray02Wrapper"]//table/tbody/tr[4]/td[3]', //ランク
		'//*[@id="gray02Wrapper"]//table/tbody/tr[5]/td[2]', //総合
		'//*[@id="gray02Wrapper"]//table/tbody/tr[6]/td[2]', //総人口
		'//*[@id="gray02Wrapper"]//table/tbody/tr[6]/td[4]', //拠点
		'//*[@id="gray02Wrapper"]//table/tbody/tr[7]/td[2]', //攻撃
		'//*[@id="gray02Wrapper"]//table/tbody/tr[7]/td[4]', //防御
		'//*[@id="gray02Wrapper"]//table/tbody/tr[8]/td[2]', //撃破スコア
		'//*[@id="gray02Wrapper"]//table/tbody/tr[8]/td[4]', //防衛スコア
		'//*[@id="gray02Wrapper"]//table/tbody/tr[4]/td[5]', //同盟
		'//*[@id="gray02Wrapper"]//table/tbody/tr[5]/td[4]'  //役職
	);
	for (var i=0; i<fieldPaths.length; i++) {
		var targetElem = document.evaluate(fieldPaths[i],
			document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
		var value = targetElem.snapshotItem(0).innerHTML;
		
		var dataItem = new Array();
		if (data[i] != undefined) {
			dataItem = data[i].split(",");
		}
		
		//値変化を表示
		var lastUpdate = getCurrentTime_4();
		
		//日時表示編集
		var dateText = dataItem[1];
		if (dateText == undefined) dateText = lastUpdate;
		dateText = dateText.replace(/^[0-9]{4}-/, "");
//		dateText = dateText.replace(/-/, "/");
//		dateText = dateText.replace(/^0([0-9])/, "$1");
//		dateText = dateText.replace(/\/0([0-9])/, "/$1");
		dateText = dateText.replace(/:[0-9]{2}$/, "");
		if (dataItem[0] != undefined && value != dataItem[0]) {
			targetElem.snapshotItem(0).style.color = "red";
			targetElem.snapshotItem(0).innerHTML = 
				value + " ← " + dataItem[0] + 
				" (" + dateText + " ～)";
		} else {
			targetElem.snapshotItem(0).innerHTML = 
				value + " (" + dateText + " ～)";
		}
		
		//値に変更があったら更新
		if (value != dataItem[0]) {
			dataItem[0] = value;
			dataItem[1] = lastUpdate;
			data[i] = dataItem;
		}
	}
	
	//値を保存
	GM_setValue(generateUserKey_4(user), genDelimitString_4(data, DELIMIT_4));
//console.log(generateUserKey_4(user) + ": " + genDelimitString_4(data, DELIMIT_4));
//faraway})();
}//faraway

//君主データキー生成
function generateUserKey_4(userName) {
	//faraway110616 return location.hostname + "_user_" + escape(userName);
	return location.hostname + "_user_4_" + escape(userName);	//faraway110616 他のｽｸﾘﾌﾟﾄと競合する為
}

//現在時刻取得（yyyy-mm-dd hh:mm:ss）
function getCurrentTime_4() {
	var date = new Date();
	var res = "" + date.getFullYear() + "-" + padZero_4(date.getMonth() + 1) + 
		"-" + padZero_4(date.getDate()) + " " + padZero_4(date.getHours()) + ":" + 
		padZero_4(date.getMinutes()) + ":" + padZero_4(date.getSeconds());
	return res;
}

//先頭ゼロ付加
function padZero_4(num) {
	var result;
	if (num < 10) {
		result = "0" + num;
	} else {
		result = "" + num;
	}
	return result;
}

//デリミタ区切り文字列生成
function genDelimitString_4(dataArray, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

//Google Chrome用GM_*系ラッパー関数
function initGMWrapper_4() {
	
	// @copyright      2009, James Campos
	// @license        cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
	if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
		GM_addStyle = function(css) {
			var style = document.createElement('style');
			style.textContent = css;
			document.getElementsByTagName('head')[0].appendChild(style);
		}

		GM_deleteValue = function(name) {
			localStorage.removeItem(LOCAL_STORAGE4 + "." + name);
		}

		GM_getValue = function(name, defaultValue) {
			var value = localStorage.getItem(LOCAL_STORAGE4 + "." + name);
			if (!value)
				return defaultValue;
			var type = value[0];
			value = value.substring(1);
			switch (type) {
				case 'b':
					return value == 'true';
				case 'n':
					return Number(value);
				default:
					return value;
			}
		}

		GM_log = function(message) {
			console.log(message);
		}

		 GM_registerMenuCommand = function(name, funk) {
		//todo
		}

		GM_setValue = function(name, value) {
			value = (typeof value)[0] + value;
			localStorage.setItem(LOCAL_STORAGE4 + "." + name, value);
		}
	}
}

//faraway 4.発展チェッカーのソース(bro3_growth_checker.user.js)終了

//faraway 5.統計グラフ化ツールのソース(bro3_graph.user.js)開始
//================================================================================
//5.統計グラフ化ツール
//================================================================================
// ==UserScript==
// @name           bro3_graph
// @version        1.06
// @namespace      http://blog.livedoor.jp/froo/
// @include        http://*.3gokushi.jp/alliance/list.php*
// @include        http://*.1kibaku.jp/alliance/list.php*
// @description    ブラウザ三国志 統計グラフ化ツール by 浮浪プログラマ
// ==/UserScript==

// 公開ページ: http://blog.livedoor.jp/froo/archives/51416669.html
// 使い方: 「統計」-「同盟」ページ検索欄横の各リンクをクリック

//faraway 5.統計グラフ化ツール変数宣言移動前の場所


//main
//faraway (function(){
function disp_statistics() {	//faraway 
	if(location.pathname != "/alliance/list.php") return;	//faraway
//window.alert("5.統計グラフ化ツール:" + location.pathname);	//faraway
	
	//mixi鯖障害回避用: 広告iframe内で呼び出されたら無視
	var container = document.evaluate('//*[@id="container"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	if (container.snapshotLength == 0) return;
	
	initGMWrapper_5();
	var allysIndexTmp = GM_getValue(location.hostname + "_allys_index", "");
	if (allysIndexTmp != "") ALLYS_INDEX_5 = allysIndexTmp.split(DELIMIT_5);
	getAllyData_5();
	addLinkHtml_5();

//faraway})();
}//faraway

//同盟ランキングデータ取得
function getAllyData_5() {
	var tableElems = document.evaluate(
		'//*[@id="grayWrapper"]//table/tbody/tr',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	
	//ランキング時刻を取得
	var time = getChildElement_5(
		getChildElement_5(tableElems.snapshotItem(0), 2), 0).innerHTML;
	time = time.replace(/^([0-9]{2}:[0-9]{2}).+$/, "$1");
	var now = new Date();
	var nowTime = padZero_5(now.getHours()) + ":" + padZero_5(now.getMinutes());
	
	//前日分かチェック
	var tmpDate = now;
	if (nowTime < time) {
		tmpDate.setDate(now.getDate() - 1);
	}
	
	//日時に編集
	var datetime = tmpDate.getFullYear() + "/" + padZero_5(tmpDate.getMonth() + 1) + 
		"/" + padZero_5(tmpDate.getDate()) + " " + time;
	
	//各同盟データ取得
	CURRENT_ALLYS_5 = new Array();
	for (var i = 2; i<tableElems.snapshotLength; i++) {
		var item = tableElems.snapshotItem(i);
		var appendData = new Array();
		appendData[IDX_DATETIME] = datetime;
		
		//更新データ取得
		var name = getChildElement_5(getChildElement_5(item, 1), 0).innerHTML; //同盟略称
		appendData[IDX_POINT_5] = getChildElement_5(item, 2).innerHTML; //ポイント
		appendData[IDX_RANK_5] = getChildElement_5(item, 0).innerHTML.replace(/→\s/, ""); //ランク
		appendData[IDX_MEMBER] = getChildElement_5(item, 3).innerHTML; //メンバー
		CURRENT_ALLYS_5.push(name);
		
		//既存データを取得
		var data = loadAllyData_5(name);
		
		//データ更新
		var upIdx = data.length;
		if (data.length >= 1) {
			var lastDatetime = data[data.length-1][0];
			if (datetime == lastDatetime) {
				upIdx--;
			}
		}
		data[upIdx] = appendData;
		
		//Greasemonkey領域へ永続保存
		saveAllyData_5(name, data);
		
		//検索用索引更新
		if (searchArrayItem_5(ALLYS_INDEX_5, name) < 0) {
			ALLYS_INDEX_5.push(name);
		}
	}
	
	//検索用索引をGreasemonkey領域へ永続保存
	saveAllysIndex_5();
}

//ツールOpenリンク追加
function addLinkHtml_5() {
	var containerElem = document.getElementById("rankSearch");
	var addElem = document.createElement("span");
	containerElem.appendChild(addElem);
	addElem.id = "toolLink";
	
	//aタグ（グラフ）
	var linkGraph =  document.createElement("a");
	linkGraph.id = "toolOpen";
	linkGraph.href = "javascript:void(0);";
	linkGraph.innerHTML = "グラフ表示";
	linkGraph.style.color = "white";
	linkGraph.style.backgroundColor = "black";
	linkGraph.style.padding = "3px 5px";
	linkGraph.style.margin = "2px 4px";
//	linkGraph.style.textDecoration = "underline";
	linkGraph.addEventListener("click", function() {openTool();}, true);
	addElem.appendChild(linkGraph);
	
	//aタグ（CSV）
	var linkCsv =  document.createElement("a");
	linkCsv.id = "toolCsv";
	linkCsv.href = "javascript:void(0);";
	linkCsv.innerHTML = "CSV表示";
	linkCsv.style.color = "white";
	linkCsv.style.backgroundColor = "black";
	linkCsv.style.padding = "3px 5px";
	linkCsv.style.margin = "2px 4px";
	linkCsv.addEventListener("click", function() {outputCsv();}, true);
	addElem.appendChild(linkCsv);
}

//ツールOpen
function openTool() {
	
	//既存オブジェクト消去
	document.getElementById("grayWrapper").style.display = "none";
	
	//グラフオブジェクト表示
	if (TOOL_LOADED) {
		document.getElementById("graphtool").style.display = "block";
	} else {
		addToolHtml(document.getElementById("whiteWrapper"));
		TOOL_LOADED = true;
	}
}

//ツールHTML追加
function addToolHtml(parentElem) {
	
	//グラフオブジェクト追加
	var toolElem = document.createElement("div");
	parentElem.appendChild(toolElem);
	toolElem.id = "graphtool";
	toolElem.style.margin = "8px 8px";
	
	//グラフ化対象同盟取得
	loadTargetAllys();
	
	//HTML追加
	addGraphHtml(toolElem);
	addCtrlHtml(toolElem);
	if (navigator.userAgent.toLowerCase().indexOf('chrome') < 0) {
		initPopup_5(toolElem);
	}
}

//グラフ部HTML追加
function addGraphHtml(parentElem) {
	var graphElem = document.createElement("div");
	parentElem.insertBefore(graphElem, document.getElementById("graphCtrl"));
	graphElem.id = "graphMain";
	graphElem.style.position = "relative";
	
	var canvasHtml = "<canvas id='graphCanvas' " +
		"width='" + (GRAPH_WIDTH + GRAPH_PADDING * 2) + 
		"' height='" + (GRAPH_HEIGHT + GRAPH_PADDING * 2) + "'></canvas>";
	graphElem.innerHTML = canvasHtml;
	var canvas = document.getElementById("graphCanvas");
	canvas.style.backgroundColor = "gainsboro";
	var ctx = canvas.getContext("2d");
	
	//時間がかかるので別スレッド化（一旦描画して砂時計を表示させる）
	setWaitCursor_5();
	window.setTimeout(function() {
		
		//同盟データ取得
		var allysData = new Array();
		var maxDatetime = new Date("2000/1/1 00:00:00");
		var minDatetime = new Date("2099/12/31 23:59:59");
		var maxPoint = 0;
//		var minPoint = 999999999;
		var minPoint = 0;
		for (var i = 0; i < ALLYS_5.length; i++) {
			if (ALLYS_5[i] == "") continue;
			var srcData = loadAllyData_5(ALLYS_5[i]);
			if (srcData.length == 0) continue;
			
			allysData[i] = new Array();
			for (var j = 0; j < srcData.length; j++) {
				allysData[i][j] = new Array();
				var datetime = new Date(srcData[j][IDX_DATETIME]);
				var point = parseInt(srcData[j][IDX_POINT_5]);
				if (isNaN(point)) point = 0;
				
				//最大/最小値チェック
				if (datetime.getTime() > maxDatetime.getTime()) maxDatetime = datetime;
				if (datetime.getTime() < minDatetime.getTime()) minDatetime = datetime;
				if (point > maxPoint) maxPoint = point;
//				if (point < minPoint) minPoint = point;
				
				allysData[i][j][IDX_DATETIME] = datetime;
				allysData[i][j][IDX_POINT_5] = point;
			}
		}
		
		//グラフ表示
		for (var i = allysData.length - 1; i >= 0; i--) {
			if (allysData[i] == undefined) continue;
			ctx.strokeStyle = ALLY_COLORS_5[i];
			ctx.beginPath();
			
			var isFirst = true;
			for (var j = 0; j < allysData[i].length; j++) {
				if (allysData[i][j] == undefined) continue;
				var datetime = allysData[i][j][IDX_DATETIME];
				var point = allysData[i][j][IDX_POINT_5];
				
				var xRatio = 0;
				if (maxDatetime.getTime() > minDatetime.getTime()) { 
					 xRatio = (datetime.getTime() - minDatetime.getTime()) 
						/ (maxDatetime.getTime() - minDatetime.getTime());
				}
				
				var yRatio = 0;
				if (maxPoint > minPoint) {
					yRatio = (point - minPoint) / (maxPoint - minPoint);
				}
				
				var xPos = Math.floor(GRAPH_WIDTH * xRatio) + GRAPH_PADDING;
				var yPos = GRAPH_HEIGHT - Math.floor(GRAPH_HEIGHT * yRatio) + GRAPH_PADDING;
				
				if (isFirst) ctx.moveTo(xPos, yPos);
				else ctx.lineTo(xPos, yPos);
				isFirst = false;
				
				var mark = document.createElement("div");
				graphElem.appendChild(mark);
				mark.style.position = "absolute";
				mark.style.border = "outset 1px " + ALLY_COLORS_5[i];
				mark.style.backgroundColor = ALLY_COLORS_5[i];
				mark.style.width = "6px";
				mark.style.height = "6px";
				mark.style.left = (xPos - 4) + "px";
				mark.style.top = (yPos - 4) + "px";
				
				//ポップアップ設定
				var popupText = ALLYS_5[i] + "<br/>" + generateDateString_5(datetime) + 
					"<br/> " + point + "ポイント";
				if (navigator.userAgent.toLowerCase().indexOf('chrome') >= 0) {
					mark.title = popupText.replace(/<br\/>/g, "\n");
				} else {
					mark.addEventListener("mouseover", createOnPopup(popupText), true);
					mark.addEventListener("mouseout", function() {offPopup_5();}, true);
				}
			}
			
			ctx.stroke();
		}
		
		resetCursor_5();
	}, 0);
}

//操作部HTML追加
function addCtrlHtml(parentElem) {
	var addElem = document.createElement("div");
	parentElem.appendChild(addElem);
	addElem.id = "graphCtrl";
	addElem.style.margin = "2px 2px";

	addElem.innerHTML = 
		"<table style='font-size:11px'>"+
		"<tr>"+
			"<td style='background-color:black; padding:5px 4px; text-align:center;'>"+
				"<a id='graphtoolClose' href='javascript:void(0);'>ランキング</a>"+
			"</td>"+
			"<td style='width:5px'></td>"+
			"<td id='fld_ally1' style='padding:2px 4px;'>"+
				"<input id='ally1' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally2' style='padding:2px 4px;'>"+
				"<input id='ally2' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally3' style='padding:2px 4px;'>"+
				"<input id='ally3' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally4' style='padding:2px 4px;'>"+
				"<input id='ally4' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally5' style='padding:2px 4px;'>"+
				"<input id='ally5' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally6' style='padding:2px 4px;'>"+
				"<input id='ally6' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally7' style='padding:2px 4px;'>"+
				"<input id='ally7' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally8' style='padding:2px 4px;'>"+
				"<input id='ally8' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally9' style='padding:2px 4px;'>"+
				"<input id='ally9' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally10' style='padding:2px 4px;'>"+
				"<input id='ally10' type='text' style='width:52px' />"+
			"</td>"+
			"<td style='background-color:black; padding:0px 4px; text-align:center;'>"+
				"<input id='graphtoolSave' type='button' value='保存' />"+
			"</td>"+
		"</tr>"+
		"<tr>"+
			"<td id='version' "+
				"style='font-size:9px; padding:2px 2px; text-align:center;'></td>"+
			"<td></td>"+
			"<td id='fld_ally11' style='padding:2px 4px;'>"+
				"<input id='ally11' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally12' style='padding:2px 4px;'>"+
				"<input id='ally12' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally13' style='padding:2px 4px;'>"+
				"<input id='ally13' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally14' style='padding:2px 4px;'>"+
				"<input id='ally14' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally15' style='padding:2px 4px;'>"+
				"<input id='ally15' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally16' style='padding:2px 4px;'>"+
				"<input id='ally16' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally17' style='padding:2px 4px;'>"+
				"<input id='ally17' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally18' style='padding:2px 4px;'>"+
				"<input id='ally18' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally19' style='padding:2px 4px;'>"+
				"<input id='ally19' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally20' style='padding:2px 4px;'>"+
				"<input id='ally20' type='text' style='width:52px' />"+
			"</td>"+
			"<td style='background-color:black; padding:0px 4px; text-align:center;'>"+
				"<input id='graphtoolClear' type='button' value='消去' />"+
			"</td>"+
		"</tr>"+
		"</table>";
	
	//バージョン
	document.getElementById("version").innerHTML = "Ver." + VERSION_5;
	
	//着色
	for (var i = 0; i < ALLY_COLORS_5.length; i++) {
		document.getElementById("fld_ally" + (i+1)).style.backgroundColor = ALLY_COLORS_5[i];
	}
	
	//同盟を表示
	for (var i = 0; i < ALLYS_5.length; i++) {
		document.getElementById("ally" + (i+1)).value = ALLYS_5[i];
	}
	
	//イベントリスナー登録（保存ボタン）
	document.getElementById('graphtoolSave').addEventListener("click",
		function() {
			
			//入力同盟名をGreasemonkey領域に保存
			for (var i = 0; i < ALLY_COLORS_5.length; i++) {
				ALLYS_5[i] = trim_5(document.getElementById("ally" + (i+1)).value);
			}
			GM_setValue(location.hostname + "_allys", genDelimitString_5(ALLYS_5, DELIMIT_5));
			
			//グラフ再描画
			var toolElem = document.getElementById("graphtool");
			toolElem.removeChild(document.getElementById("graphMain"));
			addGraphHtml(toolElem);
		},
		true);
	
	//イベントリスナー登録（消去ボタン）
	document.getElementById('graphtoolClear').addEventListener("click",
		function() {clearAllys();}, true);
	
	//イベントリスナー登録（閉じるリンク）
	document.getElementById('graphtoolClose').addEventListener("click",
		function() {closeTool();}, true);
}

//説明ポップアップ初期化
function initPopup_5(parentElem) {

	//CSS
	addGlobalStyle_5(
		".popup{"+
			"position:absolute; left:0px; top:0px; visibility:hidden; "+
			"font-size:9pt; color:#0099FF; "+
			"background-color:#FFFFFF; layer-background-color:#FFFFFF; "+
			"border:1px solid #0099FF; padding:5; z-index:255;"+
		"}"
	);
	
	//HTMLタグ追加
	var popupElem = document.createElement('span');
	popupElem.id = "popup";
	popupElem.className =  "popup";
	parentElem.appendChild(popupElem);
	
	//イベントリスナー登録
	popupElem.addEventListener("mouseover",
		function() { this.style.visibility = "hidden" }, true);
}

//ポップアップOn関数作成
function createOnPopup(text) {
	return function(e) {
		onPopup_5(text, e.pageX, e.pageY);
	}
}

//ポップアップOn/Off
function onPopup_5(text, nX, nY) {
	var sX = -10, sY = 24;
	var msgElem = document.getElementById("popup");
	msgElem.innerHTML = text;
	msgElem.style.visibility = "visible";
	msgElem.style.left = (nX + sX) + "px";
	msgElem.style.top = (nY + sY) + "px";
}
function offPopup_5() {
	document.getElementById("popup").style.visibility = "hidden";
}

//同盟入力消去
function clearAllys() {
	for (var i = 0; i < ALLY_COLORS_5.length; i++) {
		document.getElementById("ally" + (i+1)).value = "";
	}
}

//ツールを閉じる
function closeTool() {
	document.getElementById("grayWrapper").style.display = "block";
	document.getElementById("graphtool").style.display = "none";
}

//同盟データ保存
function saveAllyData_5(name, data) {
	var saveData = new Array();
	for (var i = 0; i < data.length; i++) {
		saveData[i] = genDelimitString_5(data[i], DELIMIT2_5);
	}
	
	GM_setValue(generateAllyKey_5(name), genDelimitString_5(saveData, DELIMIT_5));
//console.log(generateAllyKey_5(name) +":"+ genDelimitString_5(saveData, DELIMIT_5));
}

//同盟データ読み込み
function loadAllyData_5(ally) {
	var ret = new Array();
	var src = GM_getValue(generateAllyKey_5(ally), "");
	
	var array1 = src.split(DELIMIT_5);
	for (var i = 0; i < array1.length; i++) {
		if (array1[i] != "") {
			ret[i] = array1[i].split(DELIMIT2_5);
		}
	}
	
	return ret;
}

//グラフ表示対象同盟を読み込み
function loadTargetAllys() {
	ALLYS_5 = GM_getValue(location.hostname + "_allys", "").split(DELIMIT_5);
	
	//指定同盟なしなら現ランキング表示の同盟をデフォルト設定
	for (var i = 0; i < ALLYS_5.length; i++) {
		if (ALLYS_5[i] != "") return;
	}
	for (var i = 0; i < CURRENT_ALLYS_5.length; i++) {
		ALLYS_5[i] = CURRENT_ALLYS_5[i];
	}
}

//CSV出力
function outputCsv() {
	document.getElementById("grayWrapper").style.display = "none";
	
	var frameElem = document.createElement("iframe");
	frameElem.id = "toolCsvFrame";
	frameElem.style.width = "100%";
	frameElem.style.height = "540px";
	
	var container = document.getElementById("whiteWrapper");
	container.appendChild(frameElem);
	
	//時間がかかるので別スレッド化（一旦描画して砂時計を表示させる）
	setWaitCursor_5();
	window.setTimeout(function() {
		var frameDoc = document.getElementById("toolCsvFrame").contentDocument;
		var addElem = frameDoc.createElement("pre");
		addElem.id = "toolCsv";
		addElem.style.fontSize = "12px";
		frameDoc.body.appendChild(addElem);
		
		//タイトル行
		var csvText = "";
		csvText += "ALLIANCER,DATETIME,RANK,POINT,MEMBER\n";
		
		//データ行
		for (var i = 0; i < ALLYS_INDEX_5.length; i++) {
			
			//保存データ取得
			var srcData = loadAllyData_5(ALLYS_INDEX_5[i]);
			if (srcData.length == 0) continue;
			
			for (var j = 0; j < srcData.length; j++) {
				csvText += convCsvString_5(ALLYS_INDEX_5[i]);
				csvText += ",";
				csvText += srcData[j][IDX_DATETIME];
				csvText += ",";
				csvText += srcData[j][IDX_RANK_5];
				csvText += ",";
				csvText += srcData[j][IDX_POINT_5];
				csvText += ",";
				csvText += srcData[j][IDX_MEMBER];
				csvText += "\n";
			}
		}
		
		addElem.innerHTML = csvText;
		resetCursor_5();
	}, 0);
}

//同盟データキー生成
function generateAllyKey_5(allyName) {
	return location.hostname + "_ally5_" + escape(allyName);//faraway110602	保存名をユニークにする
//faraway110602原型	return location.hostname + "_ally_" + escape(allyName);
}

//検索用索引保存
function saveAllysIndex_5() {
	GM_setValue(location.hostname + "_allys_index", 
		genDelimitString_5(ALLYS_INDEX_5, DELIMIT_5));
}

//子Element取得
function getChildElement_5(parentNode, position) {
	var current = 0;
	for (var i = 0; i < parentNode.childNodes.length; i++){
		var childNode = parentNode.childNodes[i];
		if (childNode.nodeType == 1) {
			if (current == position) {
				return childNode;
			}
			current++;
		}
	}
	
	return undefined;
}

//カーソル変更
function setWaitCursor_5() {
	document.getElementsByTagName("body")[0].style.cursor = "wait";
}
function resetCursor_5() {
	document.getElementsByTagName("body")[0].style.cursor = "auto";
}

//CSS追加
function addGlobalStyle_5(css) {
	var head, style;
	head = document.getElementsByTagName("head")[0];
	if (!head) { return; } style = document.createElement("style");
	style.type = "text/css";
	style.innerHTML = css;
	head.appendChild(style);
}

//日時文字列編集（mm/dd hh:mm）
function generateDateString_5(date) {
	var res = "" + padZero_5(date.getMonth() + 1) + "/" + padZero_5(date.getDate()) + 
		" " + padZero_5(date.getHours()) + ":" + padZero_5(date.getMinutes());
	return res;
}

//先頭ゼロ付加
function padZero_5(num) {
	var result;
	if (num < 10) {
		result = "0" + num;
	} else {
		result = "" + num;
	}
	return result;
}

//空白除去
function trim_5(str) {
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
}

//CSV用文字列変換
function convCsvString_5(str) {
	var result;
	
	//「"」を「""」に変換
	result = str.replace(/\"/g, "\"\"");
	
	//「,」を含む場合は全体を「"」で囲む
	if (result.indexOf(",") >= 0) {
		result = "\"" + result + "\""
	}
	
	return result;
}

//デリミタ区切り文字列生成
function genDelimitString_5(dataArray, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

//配列検索
function searchArrayItem_5(array, key) {
	for (var i=0; i<array.length; i++) {
		if (array[i] == key) {
			return i;
		}
	}
	return -1;
}

//Google Chrome用GM_*系ラッパー関数
function initGMWrapper_5() {
	
	// @copyright      2009, James Campos
	// @license        cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
	if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
		GM_addStyle = function(css) {
			var style = document.createElement('style');
			style.textContent = css;
			document.getElementsByTagName('head')[0].appendChild(style);
		}

		GM_deleteValue = function(name) {
			localStorage.removeItem(LOCAL_STORAGE_5 + "." + name);
		}

		GM_getValue = function(name, defaultValue) {
			var value = localStorage.getItem(LOCAL_STORAGE_5 + "." + name);
			if (!value)
				return defaultValue;
			var type = value[0];
			value = value.substring(1);
			switch (type) {
				case 'b':
					return value == 'true';
				case 'n':
					return Number(value);
				default:
					return value;
			}
		}

		GM_log = function(message) {
			console.log(message);
		}

		 GM_registerMenuCommand = function(name, funk) {
		//todo
		}

		GM_setValue = function(name, value) {
			value = (typeof value)[0] + value;
			localStorage.setItem(LOCAL_STORAGE_5 + "." + name, value);
		}
	}
}
//faraway 5.統計グラフ化ツールのソース(bro3_graph.user.js)終了

//faraway 6.同盟ログツールのソース(bro3_log_tool.user.js)開始
//================================================================================
//6.同盟ログツール
//================================================================================
// ==UserScript==
// @name           bro3_log_tool
// @namespace      http://blog.livedoor.jp/froo/
// @include        http://*.3gokushi.jp/alliance/detail.php*
// @include        http://*.3gokushi.jp/alliance/alliance_log.php*
// @include        http://*.3gokushi.jp/report/detail.php*
// @include        http://*.3gokushi.jp/land.php*
// @include        http://*.3gokushi.jp/village.php*
// @include        http://*.1kibaku.jp/alliance/detail.php*
// @include        http://*.1kibaku.jp/alliance/alliance_log.php*
// @include        http://*.1kibaku.jp/report/detail.php*
// @include        http://*.1kibaku.jp/land.php*
// @include        http://*.1kibaku.jp/village.php*
// @description    ブラウザ三国志 同盟ログツール by 浮浪プログラマ
// ==/UserScript==

// 公開ページ: http://blog.livedoor.jp/froo/archives/51450661.html
// 使い方: 同盟ログ詳細(/alliance/detail.php)下部にツールリンク
// 　　　　同盟ログ一覧(/alliance/alliance_log.php)に未読マーク
// 　　　　報告書詳細(/report/detail.php)下部に戦力計算表示
// 　　　　拠点詳細(/village.php)・領地詳細(/land.php)に関連最新ログリンク

//faraway 6.同盟ログツール変数宣言移動前の場所

//main
//faraway(function(){
function disp_alliancelog() {	//faraway
//window.alert("disp_alliancelogです。6");
//window.alert("6.同盟ログツール:" + location.pathname);	//faraway
	
	//mixi鯖障害回避用: 広告iframe内で呼び出されたら無視
	var container = document.evaluate('//*[@id="container"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	if (container.snapshotLength == 0) return;
	
	initGMWrapper_6();
	
	if (location.pathname == "/alliance/detail.php") {
		
		//ログデータ取得
		LOG_DATA[IDX_SUBJECT] = getSubject();
		LOG_DATA[IDX_DATE] = getLogDate();
		
		LOG_DATA[IDX_ACTOR] = getActor();
		LOG_DATA[IDX_SOLDIER_COUNT] = getSoldier();
//		LOG_DATA[IDX_INFORMATION] = getInformation();
		
		//HTML追加
		if (LOG_DATA[IDX_ACTOR].length > 0) {
			appendHeaderHtml();
			appendLinksHtml();
		}
		
		//保存
		saveLogData(LOG_ID, LOG_DATA);
		
	} else if (location.pathname == "/alliance/alliance_log.php") {
		checkAlreadyRead();
		
	} else if (location.pathname == "/report/detail.php") {
		appendHeaderHtml();
		appendSoldierCountHtml(getSoldier());
		
	} else if (location.pathname == "/land.php" || location.pathname == "/village.php") {
		appendNewestLogLink();
	}
//faraway})();
}//faraway

//件名取得
function getSubject() {
	var elem = document.evaluate(
		'//*[@id="gray02Wrapper"]/table[1]/tbody/tr[2]/td',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	
	return trim_6(elem.snapshotItem(0).innerHTML);
}

//ログ時刻取得
function getLogDate() {
	var elem = document.evaluate(
		'//*[@id="gray02Wrapper"]/table[@class="tables"]/tbody/tr/td[@class="sendingDate"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	
	return trim_6(elem.snapshotItem(0).innerHTML);
}

//攻撃者・防御者の取得
function getActor() {
	var result = new Array();
	
	var links = new Array();
	var tables = document.evaluate('//*[@id="gray02Wrapper"]/table[@class="tables"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	for (var i = 0; i < tables.snapshotLength; i++) {
		var itemTable = tables.snapshotItem(i);
		
		if (links[0] == undefined && itemTable.summary == "攻撃者") {
			links[0] = document.evaluate('./tbody/tr/th[@class="attackerBase"]/a',
				itemTable, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
		} else if (links[1] == undefined && itemTable.summary == "防御者") {
			links[1] = document.evaluate('./tbody/tr/th[@class="defenserBase"]/a',
				itemTable, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
		}
	}
	
	for (var i = 0; i < 2; i++) {
		result[i] = new Array();
		result[i][IDX2_ALLY_ID] = "";
		result[i][IDX2_ALLY_NAME] = "";
		result[i][IDX2_USER_ID] = "";
		result[i][IDX2_USER_NAME] = "";
		result[i][IDX2_VILLAGE_ID] = "";
		result[i][IDX2_VILLAGE_NAME] = "";
		
		if (links[i] == undefined) {
			//何もしない
		} else if (links[i].snapshotLength == 1) {
			result[i][IDX2_VILLAGE_ID] = getParameter2_6(links[i].snapshotItem(0).href, "village_id");
			result[i][IDX2_VILLAGE_NAME] = trim_6(links[i].snapshotItem(0).innerHTML);
		
		} else if (links[i].snapshotLength >= 3) {
			result[i][IDX2_ALLY_ID] = getParameter2_6(links[i].snapshotItem(0).href, "id");
			result[i][IDX2_ALLY_NAME] = trim_6(links[i].snapshotItem(0).innerHTML);
			result[i][IDX2_USER_ID] = getParameter2_6(links[i].snapshotItem(1).href, "user_id");
			result[i][IDX2_USER_NAME] = trim_6(links[i].snapshotItem(1).innerHTML);
			result[i][IDX2_VILLAGE_ID] = getParameter2_6(links[i].snapshotItem(2).href, "village_id");
			result[i][IDX2_VILLAGE_NAME] = trim_6(links[i].snapshotItem(2).innerHTML);
		}
		
		//防御者情報がない場合は件名欄から取得
		if (i == 1 && result[i][IDX2_VILLAGE_ID] == "") {
			var subject = getSubject();
			if (subject.match(/【不可侵条約】/)) continue;
			if (subject.match(/【同盟変更】/)) continue;
			if (subject.match(/【脱退】/)) continue;
			if (subject.match(/【同盟追放】/)) continue;
			
			var titleElem = document.evaluate(
				'//*[@id="gray02Wrapper"]/table[1]/tbody/tr[2]/td/a',
				document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
			
			if (titleElem.snapshotLength >= 2) {
				var allyIdx;
				var villageIdx;
				var attacker = getParameter2_6(titleElem.snapshotItem(1).href, "village_id");
				var swap = (i == 0) ? 1 : 0;
				if (result[swap][IDX2_VILLAGE_ID] == attacker) {
					if (titleElem.snapshotLength == 3) {
						villageIdx = 2;
					} else {
						allyIdx = 2;
						villageIdx = 3;
					}
				} else {
					allyIdx = 0;
					villageIdx = 1;
				}
				
				if (allyIdx == undefined) {
					result[i][IDX2_ALLY_ID] = "";
					result[i][IDX2_ALLY_NAME] = "";
				} else {
					result[i][IDX2_ALLY_ID] = 
						getParameter2_6(titleElem.snapshotItem(allyIdx).href, "id");
					result[i][IDX2_ALLY_NAME] = 
						trim_6(titleElem.snapshotItem(allyIdx).innerHTML);
				}
				result[i][IDX2_USER_ID] = "";
				result[i][IDX2_USER_NAME] = "";
				result[i][IDX2_VILLAGE_ID] = 
					getParameter2_6(titleElem.snapshotItem(villageIdx).href, "village_id");
				result[i][IDX2_VILLAGE_NAME] = 
					trim_6(titleElem.snapshotItem(villageIdx).innerHTML);
			}
		}
	}
	
	return result;
}

//兵士取得
function getSoldier() {
	var result = new Array();
	var attackerData = new Array();
	var defenderData = new Array();
	
	var tables = document.evaluate('//*[@id="gray02Wrapper"]/table[@class="tables"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	for (var i = 0; i < tables.snapshotLength; i++) {
		var itemTable = tables.snapshotItem(i);
		
		if (itemTable.summary == "攻撃者") {
			attackerData = addSoldierCount(attackerData, getSoldierCount(itemTable));
		} else if (itemTable.summary == "防御者") {
			defenderData = addSoldierCount(defenderData, getSoldierCount(itemTable));
		}
	}
	
	if (attackerData.length > 0 || defenderData.length > 0) {
		result.push(attackerData);
		result.push(defenderData);
	}
	
	return result;
}

//ツールHTML初期化
function resetToolHtml() {
	
	//本体部div
	var toolBody = document.getElementById("toolBody");
	if (toolBody) {
		var container = document.evaluate('//*[@id="gray02Wrapper"]',
			document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
		container.removeChild(toolBody);
	}
	
	//リンク背景色
	var linkIds = new Array("calcLink", "attackerLink", "defenderLink");
	for (var i = 0; i < linkIds.length; i++) {
		var elem = document.getElementById(linkIds[i]);
		elem.style.backgroundColor = "white";
	}
}

//ツール名＆バージョン表示HTML追加
function appendHeaderHtml() {
	var container = document.evaluate('//*[@id="gray02Wrapper"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
	
	var titleElem = document.createElement("div");
	container.appendChild(titleElem);
	titleElem.innerHTML = 
		"<br/>ログツール " + "<font size='-2'>Ver." + VERSION_6 + "<font>";
}

//リンク部HTML追加
function appendLinksHtml() {
	var container = document.evaluate('//*[@id="gray02Wrapper"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
	
	var linkContainer = document.createElement("div");
	container.appendChild(linkContainer);
	var calcLink = document.createElement("a");
	var attackerLink = document.createElement("a");
	var defenderLink = document.createElement("a");
	linkContainer.appendChild(calcLink);
	linkContainer.appendChild(attackerLink);
	linkContainer.appendChild(defenderLink);
	
	calcLink.id = "calcLink";
	calcLink.innerHTML = "戦力計算";
	calcLink.style.margin = "4px";
	calcLink.style.padding = "2px";
	calcLink.href = "javascript:void(0)";
	calcLink.addEventListener("click", function() {dispSoldierCount()}, true);
	
	attackerLink.id = "attackerLink";
	attackerLink.innerHTML = "攻撃者関連ログ";
	attackerLink.style.margin = "4px";
	attackerLink.style.padding = "2px";
	attackerLink.href = "javascript:void(0)";
	attackerLink.addEventListener("click", function() {dispHistory(0)}, true);
	
	defenderLink.id = "defenderLink";
	defenderLink.innerHTML = "防御者関連ログ";
	defenderLink.style.margin = "4px";
	defenderLink.style.padding = "2px";
	defenderLink.href = "javascript:void(0)";
	defenderLink.addEventListener("click", function() {dispHistory(1)}, true);
}

//戦力計算表示
function dispSoldierCount() {
	resetToolHtml();
	
	var calkLink = document.getElementById("calcLink");
	calkLink.style.backgroundColor = "yellow";
	
	appendSoldierCountHtml(LOG_DATA[IDX_SOLDIER_COUNT]);
}

//関連ログ表示
//actorIdx: 0=攻撃者 1=防御者
function dispHistory(actorIdx) {
	resetToolHtml();
	
	var linkIds = new Array("attackerLink", "defenderLink");
	var link = document.getElementById(linkIds[actorIdx]);
	link.style.backgroundColor = "yellow";
	
	appendHistoryHtml(actorIdx);
}

//兵士数表示HTML追加
function appendSoldierCountHtml(soldierCount) {
	var container = document.evaluate('//*[@id="gray02Wrapper"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
	var toolBody = document.createElement("div");
	toolBody.id = "toolBody";
	container.appendChild(toolBody);
	
	//table追加
	appendRestTable(toolBody, soldierCount[0], soldierCount[1]);
	appendLossTable(toolBody, soldierCount[0], soldierCount[1]);
}

//関連ログ表示HTML追加
function appendHistoryHtml(actorIdx) {
	var container = document.evaluate('//*[@id="gray02Wrapper"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
	var toolBody = document.createElement("div");
	toolBody.id = "toolBody";
	container.appendChild(toolBody);
	
	//table追加
	var table = document.createElement("table");
	toolBody.appendChild(table);
	table.style.fontSize = "11px";
	table.style.margin = "3px";
	
	//タイトル行
	var titleRow = document.createElement("tr");
	titleRow.style.backgroundColor = "lawngreen";
	table.appendChild(titleRow);
	var titleTexts = new Array("件名", "時刻", "攻撃戦力", "防御戦力");
	for (var i = 0; i < titleTexts.length; i++) {
		var titleField = document.createElement("th");
		titleRow.appendChild(titleField);
		titleField.style.border = "solid 1px black";
		titleField.style.padding = "3px";
		titleField.innerHTML = titleTexts[i];
	}
	
	var logs = new Array();
	if (LOG_DATA[IDX_ACTOR][actorIdx] != undefined) {
		var villageId = LOG_DATA[IDX_ACTOR][actorIdx][IDX2_VILLAGE_ID];
		logs = loadLogIndex(villageId);
		logs.sort().reverse();
	}
	
	//データ行
	for (var i = 0; i < logs.length; i++) {
		var dataRow = document.createElement("tr");
		table.appendChild(dataRow);
		if (logs[i] == LOG_ID) {
			dataRow.style.backgroundColor = "yellow";
		}
		
		var logData = loadLogData(logs[i]);
		if (logData.length == 0) continue;
		
		//件名
		var subject = "<a href='/alliance/detail.php?id=" + logs[i] + 
			"&p=" + getParameter_6("p") + "'>" + 
			logData[IDX_SUBJECT].replace(/<[^>]+>/g, "") + "</a>";
		
		//戦力
		var soldierTotal = new Array();
		for (var j = 0; j < 2; j++) {
			if (logData[IDX_SOLDIER_COUNT][j] == undefined) {
				soldierTotal[j] = "-";
			} else {
				soldierTotal[j] = convDispNum(totalSoldiers(logData[IDX_SOLDIER_COUNT][j][0]));
				var lossSoldier = totalSoldiers(logData[IDX_SOLDIER_COUNT][j][1]);
				if (lossSoldier != 0 && !isNaN(lossSoldier)) {
					soldierTotal[j] += "(" + convDispNum(-lossSoldier) + ")"
				}
			}
			if (villageId == logData[IDX_ACTOR][j][IDX2_VILLAGE_ID]) {
				soldierTotal[j] = "<font color='red'><b>" + soldierTotal[j] + "</b></font>";
			}
		}
		
		var dataTexts = new Array(subject, logData[IDX_DATE], soldierTotal[0], soldierTotal[1]);
		for (var j = 0; j < dataTexts.length; j++) {
			var field = document.createElement("td");
			field.style.border = "solid 1px black";
			field.style.padding = "3px";
			dataRow.appendChild(field);
			field.innerHTML = dataTexts[j];
		}
	}
}

//兵士数加算
function addSoldierCount(total, add) {
	if (total == undefined) total = new Array();
	for (var i = 0; i < 2; i++) {
		if (total[i] == undefined) {
			total[i] = new Array(0,0,0,0,0,0,0,0,0,0,0);
		}
		for (var j = 0; j < 11; j++) {
			total[i][j] += add[i][j];
		}
	}
	
	return total;
}

//兵士数取得
function getSoldierCount(table) {
	var result = new Array();
	
	var rows = document.evaluate('./tbody/tr',
		table, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	for (var i = 0; i < rows.snapshotLength; i++) {
		var row = rows.snapshotItem(i);
		
		var fields = document.evaluate('./td',
			row, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
		if (fields.snapshotLength != 12) continue;
		var temp = new Array();
		for (var j = 0; j < fields.snapshotLength; j++) {
			var field = fields.snapshotItem(j);
			temp[j] = parseInt(trim_6(field.innerHTML));
		}
		
		result.push(temp);
	}
	
	return result;
}

//残兵士table追加
function appendRestTable(container, atData, dfData) {
	var table = document.createElement("table");
	container.appendChild(table);
	table.id = "restSoldier";
	table.className = "tables";
	
	table.innerHTML = 
		'<tr>'+
			'<th class="attacker" style="background-color:lawngreen;">残兵士合計</th>'+
			'<th class="attackerBase" style="background-color:lawngreen;" colspan="13"></th>'+
		'</tr>'+
		'<tr>'+
			'<th class="blank"> </th>'+
			'<th class="solClass">剣兵</th>'+
			'<th class="solClass">槍兵</th>'+
			'<th class="solClass">弓兵</th>'+
			'<th class="solClass">騎兵</th>'+
			'<th class="solClass">矛槍兵</th>'+
			'<th class="solClass">弩兵</th>'+
			'<th class="solClass">近衛騎兵</th>'+
			'<th class="solClass">斥候</th>'+
			'<th class="solClass">斥候騎兵</th>'+
			'<th class="solClass">衝車</th>'+
			'<th class="solClass">投石機</th>'+
			'<th class="solClass">合計</th>'+
		'</tr>'+
		'<tr>'+
			'<th class="blank">攻撃者</th>'+
			'<td id="restAttacker0"></td>'+
			'<td id="restAttacker1"></td>'+
			'<td id="restAttacker2"></td>'+
			'<td id="restAttacker3"></td>'+
			'<td id="restAttacker4"></td>'+
			'<td id="restAttacker5"></td>'+
			'<td id="restAttacker6"></td>'+
			'<td id="restAttacker7"></td>'+
			'<td id="restAttacker8"></td>'+
			'<td id="restAttacker9"></td>'+
			'<td id="restAttacker10"></td>'+
			'<td id="restAttackerTotal"></td>'+
		'</tr>'+
		'<tr>'+
			'<th class="blank">防御者</th>'+
			'<td id="restDefender0"></td>'+
			'<td id="restDefender1"></td>'+
			'<td id="restDefender2"></td>'+
			'<td id="restDefender3"></td>'+
			'<td id="restDefender4"></td>'+
			'<td id="restDefender5"></td>'+
			'<td id="restDefender6"></td>'+
			'<td id="restDefender7"></td>'+
			'<td id="restDefender8"></td>'+
			'<td id="restDefender9"></td>'+
			'<td id="restDefender10"></td>'+
			'<td id="restDefenderTotal"></td>'+
		'</tr>';
	
	//各項目設定
	var rowKey = new Array("restAttacker", "restDefender");
	var allData = new Array(atData, dfData);
	for (var i = 0; i < rowKey.length; i++) {
		if (allData[i] == undefined) break;
		var restArray = new Array();
		
		for (var col = 0; col < 11; col++) {
			if (allData[i][0] == undefined || allData[i][1] == undefined) {
				restArray[col] = NaN;
			} else {
				restArray[col] = allData[i][0][col] - allData[i][1][col];
			}
			var field = document.getElementById(rowKey[i] + col);
			field.innerHTML = convDispNum(restArray[col]);
		}
		
		var totalField = document.getElementById(rowKey[i] + "Total");
		totalField.innerHTML = convDispNum(totalSoldiers(restArray));
	}
}

//死傷者table追加
function appendLossTable(container, atData, dfData) {
	var table = document.createElement("table");
	container.appendChild(table);
	table.id = "lossSoldier";
	table.className = "tables";
	
	table.innerHTML = 
		'<tr>'+
			'<th class="attacker" style="background-color:lawngreen;">死傷者合計</th>'+
			'<th class="attackerBase" style="background-color:lawngreen;" colspan="13"></th>'+
		'</tr>'+
		'<tr>'+
			'<th class="blank"> </th>'+
			'<th class="solClass">剣兵</th>'+
			'<th class="solClass">槍兵</th>'+
			'<th class="solClass">弓兵</th>'+
			'<th class="solClass">騎兵</th>'+
			'<th class="solClass">矛槍兵</th>'+
			'<th class="solClass">弩兵</th>'+
			'<th class="solClass">近衛騎兵</th>'+
			'<th class="solClass">斥候</th>'+
			'<th class="solClass">斥候騎兵</th>'+
			'<th class="solClass">衝車</th>'+
			'<th class="solClass">投石機</th>'+
			'<th class="solClass">合計</th>'+
		'</tr>'+
		'<tr>'+
			'<th class="blank">攻撃者</th>'+
			'<td id="lossAttacker0"></td>'+
			'<td id="lossAttacker1"></td>'+
			'<td id="lossAttacker2"></td>'+
			'<td id="lossAttacker3"></td>'+
			'<td id="lossAttacker4"></td>'+
			'<td id="lossAttacker5"></td>'+
			'<td id="lossAttacker6"></td>'+
			'<td id="lossAttacker7"></td>'+
			'<td id="lossAttacker8"></td>'+
			'<td id="lossAttacker9"></td>'+
			'<td id="lossAttacker10"></td>'+
			'<td id="lossAttackerTotal"></td>'+
		'</tr>'+
		'<tr>'+
			'<th class="blank">防御者</th>'+
			'<td id="lossDefender0"></td>'+
			'<td id="lossDefender1"></td>'+
			'<td id="lossDefender2"></td>'+
			'<td id="lossDefender3"></td>'+
			'<td id="lossDefender4"></td>'+
			'<td id="lossDefender5"></td>'+
			'<td id="lossDefender6"></td>'+
			'<td id="lossDefender7"></td>'+
			'<td id="lossDefender8"></td>'+
			'<td id="lossDefender9"></td>'+
			'<td id="lossDefender10"></td>'+
			'<td id="lossDefenderTotal"></td>'+
		'</tr>';
	
	//各項目設定
	var rowKey = new Array("lossAttacker", "lossDefender");
	var allData = new Array(atData, dfData);
	for (var i = 0; i < rowKey.length; i++) {
		if (allData[i] == undefined) break;
		
		var lossArray;
		if (allData[i][1] == undefined) {
			lossArray = new Array();
		} else {
			lossArray = allData[i][1];
		}
		
		for (var col = 0; col < 11; col++) {
			var field = document.getElementById(rowKey[i] + col);
			field.innerHTML = convDispNum(lossArray[col]);
		}
		
		var totalField = document.getElementById(rowKey[i] + "Total");
		totalField.innerHTML = convDispNum(totalSoldiers(lossArray));
	}
}

//兵士合計（ポイント換算）
function totalSoldiers(soldiers) {
	if (soldiers == undefined || soldiers.length == 0) return NaN;
	var result = 0;
	
	//剣兵
	result += soldiers[0];
	
	//下級兵
	for (var i = 1; i <= 3; i++) {
		result += soldiers[i] * 2;
	}
	
	//上級兵
	for (var i = 4; i <= 6; i++) {
		result += soldiers[i] * 4;
	}
	
	//斥候
	result += soldiers[7];
	result += soldiers[8] * 2;
	
	//攻城兵器
	result += soldiers[9] * 2;
	result += soldiers[10] * 4;
	
	return result;
}

//ログデータ永続保存
function saveLogData(logId, logData) {
	var logDataStr = new Array();
	logDataStr[IDX_SUBJECT] = logData[IDX_SUBJECT]; //件名
	logDataStr[IDX_DATE] = logData[IDX_DATE]; //ログ時刻
	
	//攻撃者・防御者
	logDataStr[IDX_ACTOR] = new Array();
	if (logData[IDX_ACTOR].length > 0) {
		logDataStr[IDX_ACTOR][0] = 
			genDelimitString_6(logData[IDX_ACTOR][0], DELIMIT3_6); //攻撃者
		logDataStr[IDX_ACTOR][1] = 
			genDelimitString_6(logData[IDX_ACTOR][1], DELIMIT3_6); //防御者
	}
	logDataStr[IDX_ACTOR] = 
		genDelimitString_6(logDataStr[IDX_ACTOR], DELIMIT2_6);
	
	//兵士数
	logDataStr[IDX_SOLDIER_COUNT] = new Array();
	for (var i = 0; i < logData[IDX_SOLDIER_COUNT].length; i++) {
		logDataStr[IDX_SOLDIER_COUNT][i] = new Array();
		if (logData[IDX_SOLDIER_COUNT][i] == undefined) continue;
		for (var j = 0; j < logData[IDX_SOLDIER_COUNT][i].length; j++) {
			logDataStr[IDX_SOLDIER_COUNT][i][j] = new Array();
			for (var k = 0; k < logData[IDX_SOLDIER_COUNT][i][j].length ; k++) {
				logDataStr[IDX_SOLDIER_COUNT][i][j][k] = 
					convDispNum(logData[IDX_SOLDIER_COUNT][i][j][k]);
			}
		}
		logDataStr[IDX_SOLDIER_COUNT][i] = 
			genDelimitString_6(logDataStr[IDX_SOLDIER_COUNT][i], DELIMIT3_6);
	}
	logDataStr[IDX_SOLDIER_COUNT] = 
		genDelimitString_6(logDataStr[IDX_SOLDIER_COUNT], DELIMIT2_6);
	
	//ログデータ本体をGreasemonkey領域へ永続保存
	GM_setValue(generateLogKey(logId), genDelimitString_6(logDataStr, DELIMIT_6))
//console.log(generateLogKey(logId)+": " + genDelimitString_6(logDataStr, DELIMIT_6));
	
	//ログインデックスに追加
	addIndex(location.hostname + "_log_index", logId, ",");
	
	//拠点インデックスに追加
	if (logData[IDX_ACTOR].length > 0) {
		var nameUpdate = false;
		var names = splitDelimited_6(
			GM_getValue(location.hostname + "_village_name", ""), DELIMIT_6);
		
		for (var i = 0; i < logData[IDX_ACTOR].length; i++) {
			var actorId = logData[IDX_ACTOR][i][IDX2_VILLAGE_ID];
			var actorName = logData[IDX_ACTOR][i][IDX2_VILLAGE_NAME];
			
			//拠点ID-ログIDインデックスに追加
			addIndex(generateVillageKey(actorId), logId, ",");
			
			//拠点ID-拠点名インデックスに追加
			if (actorName != "") {
				var nameExists = false;
				for (var j = 0; j < names.length; j++) {
					var item = splitDelimited_6(names[j], DELIMIT2_6);
					if (item[0] == actorId) {
						if (item[1] == actorName) {
							nameExists = true;
						}
						break;
					}
				}
				if (!nameExists) {
					nameUpdate = true;
					names[j] = actorId + DELIMIT2_6 + actorName;
				}
			}
		}
		
		//拠点名-拠点IDインデックスをGreasemonkey領域へ永続保存
		if (nameUpdate) {
			GM_setValue(location.hostname + "_village_name", genDelimitString_6(names, DELIMIT_6));
//console.log(location.hostname + "_village_name"+": " + genDelimitString_6(names, DELIMIT_6));
		}
	}
}

//インデックス追加
function addIndex(key, value, delimiter) {
	var items = splitDelimited_6(GM_getValue(key, ""), delimiter);
	
	if (items.indexOf(value) == -1) {
		items.push(value);
		
		//Greasemonkey領域へ永続保存
		GM_setValue(key, genDelimitString_6(items, delimiter));
//console.log(key+": " + genDelimitString_6(items, delimiter));
	}
}

//ログデータ読み出し
function loadLogData(logId) {
	var result = splitDelimited_6(GM_getValue(generateLogKey(logId), ""), DELIMIT_6);
	if (result.length == 0) return result;
	
	//攻撃者・防御者
	result[IDX_ACTOR] = splitDelimited_6(result[IDX_ACTOR], DELIMIT2_6);
	for (var i = 0; i < result[IDX_ACTOR].length; i++) {
		result[IDX_ACTOR][i] = splitDelimited_6(result[IDX_ACTOR][i], DELIMIT3_6);
	}
	
	//兵士数
	result[IDX_SOLDIER_COUNT] = splitDelimited_6(result[IDX_SOLDIER_COUNT], DELIMIT2_6);
	for (var i = 0; i < result[IDX_SOLDIER_COUNT].length; i++) {
		result[IDX_SOLDIER_COUNT][i] = 
			splitDelimited_6(result[IDX_SOLDIER_COUNT][i], DELIMIT3_6);
		for (var j = 0; j < result[IDX_SOLDIER_COUNT][i].length; j++) {
			result[IDX_SOLDIER_COUNT][i][j] = 
				splitDelimited_6(result[IDX_SOLDIER_COUNT][i][j], ",");
			for (var k = 0; k < result[IDX_SOLDIER_COUNT][i][j].length; k++) {
				result[IDX_SOLDIER_COUNT][i][j][k] = 
					parseInt(result[IDX_SOLDIER_COUNT][i][j][k]);
			}
		}
	}
	
	return result;
}

//未読チェック
function checkAlreadyRead() {
	var logs = splitDelimited_6(GM_getValue(location.hostname + "_log_index", ""), ",");
	
	var rowElems = document.evaluate(
		'//*[@id="gray02Wrapper"]/div/div/table/tbody/tr/td[1]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	for (var i = 0; i < rowElems.snapshotLength; i++) {
		var field = rowElems.snapshotItem(i);
		var link = document.evaluate('./a', field, null, 
			XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
		var id = getParameter2_6(link.href, "id");
		if (logs.indexOf(id) == -1) {
			field.innerHTML += " [未]";
		}
	}
}

//拠点に関係する最新ログへのリンクを追加
function appendNewestLogLink() {
	
	//拠点名を取得
	var baseNameElem = document.evaluate(
		'//*[@id="basepoint"]/span[@class="basename"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var baseName = trim_6(baseNameElem.snapshotItem(0).innerHTML);
	
	//拠点ID取得
	var villageId = "";
	var names = splitDelimited_6(
		GM_getValue(location.hostname + "_village_name", ""), DELIMIT_6);
	for (var j = 0; j < names.length; j++) {
		var item = splitDelimited_6(names[j], DELIMIT2_6);
		if (item[1] == baseName) {
			villageId = item[0];
			break;
		}
	}
	
	//最新ログのID取得
	var logId = "";
	var names = new Array();
	if (villageId != "") {
		var logs = loadLogIndex(villageId);
		if (logs.length > 0) {
			logs.sort().reverse();
			logId = "" + logs[0];
		}
	}
	
	//リンクHTML追加
	if (logId != "") {
		var statusElem = document.evaluate('//*[@id="basepoint"]/div[@class="status"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);

		if(!statusElem){var statusElem = document.evaluate('//*[@id="basepoint"]/div[@class="status village-bottom"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
		}
		
		var sepElem = document.createElement("span");
		statusElem.appendChild(sepElem);
		sepElem.className = "sep";
		sepElem.style.margin = "4px";
		sepElem.innerHTML = "|";
		
		var linkElem = document.createElement("a");
		statusElem.appendChild(linkElem);
		linkElem.href = "/alliance/detail.php?id=" + logId;
		linkElem.style.margin = "4px";
		linkElem.innerHTML = "最新ログ";
	}
}

//ログインデックス取得
function loadLogIndex(villageId) {
	var logs = splitDelimited_6(GM_getValue(generateVillageKey(villageId), ""), ",");
	for (var i = 0; i < logs.length; i++) logs[i] = parseInt(logs[i]);
	return logs;
}


//ログデータキー生成
function generateLogKey(logId) {
	return location.hostname + "_log_" + logId;
}
//拠点データキー生成
function generateVillageKey(villageId) {
	return location.hostname + "_village_" + villageId;
}
//君主データキー生成
//function generateUserKey(userName) {
//	return location.hostname + "_user_" + escape(userName);
//}

//数値を表示用に変換
function convDispNum(value) {
	if (isNaN(value)) {
		return "?";
	} else {
		return "" + value;
	}
}

//URLパラメータ取得
function getParameter_6(key) {
	return getParameter2_6(location.search, key);
}

//URLパラメータ取得
function getParameter2_6(url, key) {
	var str = url.replace(/#.*$/, "").split("?");
	if (str.length < 2) {
		return "";
	}
	
	var params = str[1].split("&");
	for (var i = 0; i < params.length; i++) {
		var keyVal = params[i].split("=");
		if (keyVal[0] == key && keyVal.length == 2) {
			return decodeURIComponent(keyVal[1]);
		}
	}
	return "";
}

//デリミタ区切り文字列生成
function genDelimitString_6(dataArray, delimiter) {
	var ret = "";
	if (dataArray == undefined) return ret;
	
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

//デリミタ区切り文字列を配列に変換
function splitDelimited_6(str, delimiter) {
	if (str == undefined || str == "") {
		return new Array();
	} else {
		return str.split(delimiter);
	}
}

//空白除去
function trim_6(str) {
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
}

//Google Chrome用GM_*系ラッパー関数
function initGMWrapper_6() {
	
	// @copyright      2009, James Campos
	// @license        cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
	if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
		GM_addStyle = function(css) {
			var style = document.createElement('style');
			style.textContent = css;
			document.getElementsByTagName('head')[0].appendChild(style);
		}

		GM_deleteValue = function(name) {
			localStorage.removeItem(LOCAL_STORAGE_6 + "." + name);
		}

		GM_getValue = function(name, defaultValue) {
			var value = localStorage.getItem(LOCAL_STORAGE_6 + "." + name);
			if (!value)
				return defaultValue;
			var type = value[0];
			value = value.substring(1);
			switch (type) {
				case 'b':
					return value == 'true';
				case 'n':
					return Number(value);
				default:
					return value;
			}
		}

		GM_log = function(message) {
			console.log(message);
		}

		GM_registerMenuCommand = function(name, funk) {
		//todo
		}

		GM_setValue = function(name, value) {
			value = (typeof value)[0] + value;
			try {
				localStorage.setItem(LOCAL_STORAGE_6 + "." + name, value);
			} catch (e) {
				alert("localStorageへの保存に失敗 (" + e + ")");
				throw e;
			}
		}
	}
}
//faraway 6.同盟ログツールのソース(bro3_log_tool.user.js)終了

//faraway 7.NPC砦、領土情報検索ツールのソース(bro3_npc_castle_info2.user.js)開始
//================================================================================
//7.NPC砦、領土情報検索ツール
//================================================================================
// ==UserScript==
// @name           bro3_npc_castle_info2
// @namespace      http://homepage3.nifty.com/Craford
// @include        http://*.3gokushi.jp/map.php*
// @include        http://*.3gokushi.jp/big_map.php*
// @include        http://*.1kibaku.jp/map.php*
// @include        http://*.landsandlegends.com/map.php*
// @description    ブラウザ三国志NPC砦情報取得_2nd
// @version        2.49-k2
// ==/UserScript==
// version date       author
// ver2.00 2010.12.20 ドワクエ Craford 初版の設計を見直し、再構築
// ver2.01 2010.12.21 ドワクエ Craford ☆レベル数字表示補正
// ver2.02 2010.12.22 ドワクエ Craford 領土枠色に「灰」「白」「橙」を追加。空き地着色機能追加。
// ver2.03 2010.12.25 ドワクエ Craford 縮小マップにグリッドラインを追加。一騎当千対応
// ver2.04 2011.01.01 ドワクエ Craford 検索レイアウト変更。特定資源強調表示モードを追加
// ver2.05 2011.01.01 ドワクエ Craford 特定資源強調表示を３枠に拡大。
// ver2.06 2011.01.02 ドワクエ Craford 特定資源強調表示に１期★４(2-2-2-2)が抜けていたため追加。メニュー隠蔽機能追加
// ver2.07 2011.01.13 ドワクエ Craford css修正等の微調整。
// ver2.08 2011.01.15 ドワクエ Craford 各種調整等。
// ver2.09 2011.01.16 ドワクエ Craford 一部ロジック修正。
// ver2.10 2011.01.17 ドワクエ Craford 処理テストのための改版
// ver2.11 2011.01.17 ドワクエ Craford 処理テストのための改版その２
// ver2.12 2011.01.17 ドワクエ Craford 処理テストのための改版その３
// ver2.13 2011.01.17 ドワクエ Craford 使用するクッキーのキー数を、５→３に削減。コメント化ロジックの削除
// ver2.14 2011.01.20 ドワクエ Craford facebookのlands & legendsに対応
// ver2.15 2011.01.21 ドワクエ Craford 20x20モードの不備に対応
// ver2.16 2011.01.22 ドワクエ Craford 使用するクッキーのキー数を、３→２に削減。
// ver2.17 2011.01.23 ドワクエ Craford 更新ボタン押下時に、画面リロードをかけずに画面更新するように修正
// ver2.18 2011.01.23 ドワクエ Craford ルート構築モードを正式リリース。ツール初回使用時の表示不具合を修正。
// ver2.19 2011.02.01 ドワクエ Craford 更新時、本拠地一覧、縮小マップが動的に再描画されない問題に対応。
// ver2.20 2011.02.03 ドワクエ Craford 画像リソース定義をロジック外に移動。ルート構築モードでのルート検証を自動で行うように修正。
// ver2.21 2011.02.05 ドワクエ Craford ルート自動構築モードの実装。一部バグ修正。
// ver2.22 2011.02.06 ドワクエ Craford ルート自動構築モードのバグ修正。同盟検索連携の実装。強調表示のバグ修正。
// ver2.23 2011.02.08 ドワクエ Craford ルート自動構築モードで終点解除を可能とする仕様の実装。自動構築オプションを保持するように修正。
// ver2.24 2011.02.08 ドワクエ Craford ルート自動構築モードの構築ルートについて可変モードを実装。
// ver2.25 2011.02.09 ドワクエ Craford ルート自動構築モードで終了クリック時、メッセージ表示前にルートチェックするようにしてみる。
// ver2.26 2011.03.01 ドワクエ Craford スプレッドシートとの出兵情報共有の実装。
// ver2.27 2011.03.01 ドワクエ Craford 出兵共有機能のアイコン表示を、有効/無効切り替え時に動的更新。
// ver2.28 2011.03.01 ドワクエ Craford 動的更新時にポップヒントの表示が追加されてしまう不具合を修正。
// ver2.29 2011.03.01 ドワクエ Craford 出兵データがない行が含まれるとその先が表示されない問題に対応。
// ver2.30 2011.03.02 ドワクエ Craford mixi版のマップデータ出力htmlの仕様変更に対応。
// ver2.31 2011.03.08 ドワクエ Craford ユーザー名に処理不能な文字があるとき、半角空白に変える処理を追加
// ver2.32 2011.03.09 ドワクエ Craford 自動ルート構築モードの仕様変更。終点の連続定義（中間指定）で、連続したルート構築ができるようにする（プラン段階）
// ver2.33 2011.03.11 ドワクエ Craford 方位表示機能をこちらに移動。
// ver2.34 2011.03.23 ドワクエ Craford 本鯖仕様変更対応。
// ver2.35 2011.03.24 ドワクエ Craford mixi版スタイルシート変更対応。本鯖51x51モードに資源判別モード対応。
// ver2.36 2011.03.24 ドワクエ Craford includeつけわすれｗ
// ver2.37 2011.03.26 ドワクエ Craford 51x51モードに領土検索ツールのオプション設定内容が反映されるようにした。
// ver2.38 2011.03.26 ドワクエ Craford 資源判別オフなのに太字になる不具合を修正。
// ver2.39 2011.03.26 ドワクエ Craford 51x51の英字表示を変更
// ver2.40 2011.03.30 ドワクエ Craford 51x51モードに自動ルート構築実装
// ver2.41 2011.03.31 ドワクエ Craford mixi鯖でsmallmap表示をするとマップが一部クリックできなくなる問題に対処
// ver2.42 2011.03.31 ドワクエ Craford Chromeで51x51モードの処理が正しく動くように修正
// ver2.43 2011.03.31 ドワクエ Craford 51x51のルート表示だけでない問題に対処？
// ver2.44 2011.04.01 ドワクエ Craford 51x51のルート構築で、資源判別がオフのときにルートが描画されない問題に対応
// ver2.45 2011.04.01 ドワクエ Craford 51x51のルート構築で、Chromeのときに出力結果がおかしくなる問題に対応
// ver2.46 2011.04.10 ドワクエ Craford 同盟着色モードで、自同盟配下を着色対象外とする機能を追加
// ver2.47 2011.04.14 ドワクエ Craford マップパーツ変更にともなう着色ずれを修正
// ver2.48 2011.04.16 ドワクエ Craford マップパーツを以前のバージョンにもどせるようにした
// ver2.49 2011.04.24 ドワクエ Craford 左上から左方向9マス目が旧マップにならない問題、および領地着色枠がずれてしまう問題に対応

//faraway 7.NPC砦、領土情報検索ツール変数宣言移動前の場所

//----------------//
// メインルーチン //
//----------------//
//faraway(function(){
function disp_npcfort() {	//faraway
//window.alert("7.NPC砦、領土情報検索ツール:" + location.pathname);	//faraway

	// ブラウザ判定(Chromeかどうかを見極める)
	var ua = navigator.userAgent;
	if( ua.match(/Chrome\/([\.\d]+)/)) {
		browserType = "Chrome";
	}
	else{
		browserType = "";
	}

	if (location.pathname == "/map.php" || location.pathname == "/big_map.php") {
		// 全体マップ画面なら実行中作業を取得

		// 51x51モードの実装されているサーバーかを取得
		add51_51mode = check51_51mode_7();

		//HTML追加
		addHtml_7();

		// 51x51モードか？
		if( getViewSize() != 51 ){
			//結果取得
			getNPCCastleInfo();
		}
		else{
			//結果取得
			getNPCCastleInfo_51(0);		// 0: ルート構築再描画ではない
		}
	}
	else if(location.pathname == "/facility/unit_status.php" ){
		// 出兵情報画面なら実行中作業を取得＆スプレッドシートに出力（未実装）
//		putSoldierInfo();
	}
//faraway})();
}//faraway
//faraway 7.NPC砦、領土情報検索ツール

//-----------------------//
// 51x51モードの実装判定 //
//-----------------------//
function check51_51mode_7(){
	var result;

	var el = $e_7('//*[@id="change-map-scale"]');
	if( el.snapshotLength > 0 ){
		result = 1;
	}
	else{
		result = 0;
	}

	return result;
}

//----------------//
// 出兵情報の検索 //
//----------------//
function putSoldierInfo(){

	//----------------------------//
	// スプレッドシート情報の取得 //
	//----------------------------//
	var chkflg4;
	execFlag = loadExecFlag(location.hostname, "FLAG4");
	if( execFlag == "" ){
		chkflg4 = new String(FLAG4);  // 初期値
	}
	else{
		chkflg4 = execFlag;
	}

	// スプレッドシート名の加工
	if( chkflg4.charAt(0) == '1' ){
		var key = chkflg4.substr(1).replace(/.*[\?&]key=([^&]+).*/, '$1');

		// 出兵情報を取得
		var battleType = new Array();
		var target = new Array();
		var arriveDate = new Array();
		var fdata = new Array();
		var count = 0;
		var sortie = $e_7('//div[@id="sortie"]//th[@class="ttl3 w80"]');
		var flist = $e_7('//div[@id="sortie"]//table[@class="commonTablesNoMG"]//td[@class="digit"]');
		for( var i = 0; i < sortie.snapshotLength/3; i++ ){
			// 殲滅戦、援軍、強襲等
			battleType[count] = sortie.snapshotItem(i*3+0).textContent;
			// 出兵先
			var pos = sortie.snapshotItem(i*3+1).parentNode.innerHTML.match(/\([-]*\d+,[-]*\d+\)/);
			target[count] = pos[0];
			// 到着日時
			var dt = sortie.snapshotItem(i*3+2).parentNode.innerHTML.match(/\d+-\d+-\d+ \d+:\d+:\d+/);
			arriveDate[count] = dt[0];
			// 兵士構成
			var fd = "";
			var total = 0;
			for( var j = 0; j < 11; j++ ){
				var num = parseInt(flist.snapshotItem(i*12+j).textContent);
				if( fd != "" ){
					fd = fd + "/";
				}
				fd = fd + num;
				total = parseInt(total) + parseInt(num);
			}
			if( total != 0 ){
				fdata[count] = fd + "[" + flist.snapshotItem(i*12+11).textContent + "]";
			}
			else{
				fdata[count] = "SMK[" + flist.snapshotItem(i*12+11).textContent + "]";
			}
			count ++;
		}

		// 出兵データをPOSTする
	}
}

//----------------//
// 領土情報の検索 //
//----------------//
//拠点の作業中情報を取得
function getNPCCastleInfo() {
	//--------------//
	// ホスト名判別 //
	//--------------//
	var hostname;
	var ikibaku_flg;
	hostname = location.hostname;
	if( hostname.indexOf("1kibaku.jp") != -1 ){
		ikibaku_flg = 1;
	}
	else{
		ikibaku_flg = 0;
	}

	//--------------------------------------//
	// チェックボックスに関する情報をロード //
	//--------------------------------------//
	var chkflg1;
	var chkflg2;
	execFlag = loadExecFlag(location.hostname, "FLAG0");
	if( execFlag == "" ){
		// 表示フラグをロード
		var execFlag1 = loadExecFlag(location.hostname, "FLAG1");
		if( execFlag1 == "" ){
			chkflg1 = new String(FLAG1);  // 初期値
		}
		else{
			chkflg1 = execFlag1;
		}

		// オプションフラグをロード
		var execFlag2 = loadExecFlag(location.hostname, "FLAG2");
		if( execFlag2 == "" ){
			chkflg2 = new String(FLAG2);  // 初期値
		}
		else{
			chkflg2 = execFlag2;
		}

		// 初回のときは、フラグを保存
		execFlag = chkflg1 + DELIMIT1_7 + chkflg2;
		saveExecFlag(location.hostname, "FLAG0", execFlag);
	}
	else{
		var loadflg = new Array();
		loadflg = execFlag.split(DELIMIT1_7);
		chkflg1 = loadflg[0];
		chkflg2 = loadflg[1];
	}

	// 個人、同盟検索情報をロード
	var chkflg3 = new Array();
	execFlag = loadExecFlag(location.hostname, "FLAG3");
	if( execFlag == "" ){
		var execFlag3 = loadExecFlag(location.hostname, "FLAG3-1");
		if( execFlag3 == "" ){
			chkflg3[0] = new String(FLAG3_1);  // 初期値
		}
		else{
			chkflg3[0] = execFlag3;
		}
		execFlag3 = loadExecFlag(location.hostname, "FLAG3-2");
		if( execFlag3 == "" ){
			chkflg3[1] = new String(FLAG3_2);  // 初期値
		}
		else{
			chkflg3[1] = execFlag3;
		}
		execFlag3 = loadExecFlag(location.hostname, "FLAG3-3");
		if( execFlag3 == "" ){
			chkflg3[2] = new String(FLAG3_3);  // 初期値
		}
		else{
			chkflg3[2] = execFlag3;
		}

		// 初回のときは、フラグを保存
		execFlag = chkflg3[0] + DELIMIT1_7 + chkflg3[1] + DELIMIT1_7 + chkflg3[2];
		saveExecFlag(location.hostname, "FLAG3", execFlag);
	}
	else{
		chkflg3 = execFlag.split(DELIMIT1_7);
	}

	//----------------------//
	// 処理パラメータの抽出 //
	//----------------------//
	//-- データ絞り込み時のユーザー名情報の取得 --//
	var checkBox1;
	var checkBox2;
	var userBox;
	var listbox;
	var userName = new Array();
	var userText;
	var fullmatch = new Array();
	var nodisp = new Array();
	var target = new Array();
	var colorNo = new Array();
	for( var i = 0; i < 3; i++ ){
		fullmatch[i] = 0;
		nodisp[i] = 0;
		target[i] = 0;
		colorNo[i] = 0;
	}

	// 個人・同盟検索１
	checkBox1 = $e_7('//*[@id="ckEnable1"]');
	if( checkBox1.snapshotItem(0).checked == true ){
		// 個人・同盟の別
		checkBox2 = $e_7('//*[@id="ckType1"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			target[0] = 1;
		}
		else{
			target[0] = 2;
		}
		// 完全一致
		checkBox2 = $e_7('//*[@id="ckFullMatch1"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			fullmatch[0] = 1;
		}
		else{
			fullmatch[0] = 0;
		}
		// ☆表示
		checkBox2 = $e_7('//*[@id="ckLevelSearch1"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			nodisp[0] = 1;
		}
		else{
			nodisp[0] = 0;
		}
		userBox = $e_7('//*[@id="userBox1"]');
		userText = userBox.snapshotItem(0).value;
		userName[0] = new Array();
		userName[0] = userText.split(OWNER_SPLITKEY);
		// 枠色
		listbox = $e_7('//*[@id="lsColor1"]');
		colorNo[0] = listbox.snapshotItem(0).selectedIndex + 1;
	}
	else{
		userName[0] = "";
	}

	// 個人・同盟検索２
	checkBox1 = $e_7('//*[@id="ckEnable2"]');
	if( checkBox1.snapshotItem(0).checked == true ){
		// 個人・同盟の別
		checkBox2 = $e_7('//*[@id="ckType2"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			target[1] = 1;
		}
		else{
			target[1] = 2;
		}
		// 完全一致
		checkBox2 = $e_7('//*[@id="ckFullMatch2"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			fullmatch[1] = 1;
		}
		else{
			fullmatch[1] = 0;
		}
		// ☆表示
		checkBox2 = $e_7('//*[@id="ckLevelSearch2"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			nodisp[1] = 1;
		}
		else{
			nodisp[1] = 0;
		}
		userBox = $e_7('//*[@id="userBox2"]');
		userText = userBox.snapshotItem(0).value;
		userName[1] = new Array();
		userName[1] = userText.split(OWNER_SPLITKEY);
		// 枠色
		listbox = $e_7('//*[@id="lsColor2"]');
		colorNo[1] = listbox.snapshotItem(0).selectedIndex + 1;
	}
	else{
		userName[1] = "";
	}

	// 個人・同盟検索３
	checkBox1 = $e_7('//*[@id="ckEnable3"]');
	if( checkBox1.snapshotItem(0).checked == true ){
		// 個人・同盟の別
		checkBox2 = $e_7('//*[@id="ckType3"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			target[2] = 1;
		}
		else{
			target[2] = 2;
		}
		// 完全一致
		checkBox2 = $e_7('//*[@id="ckFullMatch3"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			fullmatch[2] = 1;
		}
		else{
			fullmatch[2] = 0;
		}
		// ☆表示
		checkBox2 = $e_7('//*[@id="ckLevelSearch3"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			nodisp[2] = 1;
		}
		else{
			nodisp[2] = 0;
		}
		userBox = $e_7('//*[@id="userBox3"]');
		userText = userBox.snapshotItem(0).value;
		userName[2] = new Array();
		userName[2] = userText.split(OWNER_SPLITKEY);
		// 枠色
		listbox = $e_7('//*[@id="lsColor3"]');
		colorNo[2] = listbox.snapshotItem(0).selectedIndex + 1;
	}
	else{
		userName[2] = "";
	}

	//-- 資源判別ONのとき、資源表示 --//
	var res_mode;
	var areaNo;
	var areaNo2;
	var areaNo3;
	if( chkflg2.charAt(FLAG2_ANALYZE) == '1' ){
		res_mode = 1;
	}
	else{
		res_mode = 0;
	}

	// 強調表示選択値を取得
	areaNo = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO,3));
	areaNo2 = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO2,3));
	areaNo3 = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO3,3));

	//------------------//
	// 画面サイズの取得 //
	//------------------//
	var viewSize;
	viewSize = getViewSize();

	//--------------------------------------------//
	// 全体表示画面から、画面中央座標を手に入れる //
	//--------------------------------------------//
	var codx = $e_7('//div[@id="datas"]/input[@id=\"x\"]');
	var cody = $e_7('//div[@id="datas"]/input[@id=\"y\"]');
	var bx = codx.snapshotItem(0).value;
	var by = cody.snapshotItem(0).value;
	var sx;
	var sy;
	var ex;
	var ey;

	//--------------//
	// ホスト名判別 //
	//--------------//
	var hosttype = "";
	if(    (location.hostname.indexOf("1kibaku") == -1)
	    && (location.hostname.indexOf("legend") == -1) ){
		hosttype = "0";
	}

	//------------------//
	// 左上座標を求める //
	//------------------//
	if( viewSize == 11 ){
		sx = parseInt(bx) - 5;
		sy = parseInt(by) + 5;
	}
	else if( viewSize == 15 ){
		sx = parseInt(bx) - 7;
		sy = parseInt(by) + 7;
	}
	else{
		sx = parseInt(bx) - 9;
		sy = parseInt(by) + 9;
	}

	//----------------------//
	// レーダーマップの描画 //
	//----------------------//
	var mapdata = new Array();
	var smallmapdv = $e_7('//*[@id="smallmap_dv"]');
	smallmapdv.snapshotItem(0).style.display = "inline";

	//--------------------------------------//
	// マップデータからレーダーマップを作る //
	//--------------------------------------//
	var areasrc = document.evaluate('//*[@id="mapsAll"]//img/@src',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var areacls = document.evaluate('//*[@id="mapsAll"]//img/@class',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var smallmap = $e_7('//*[@id="smallmap"]');

	// マップの作成
	for(var i = 0; i < 20; i++ ){
		mapdata[i] = new Array();
	}
	for(var i = 0; i < 20; i++ ){
		for(var j = 0; j < 20; j++ ){
			mapdata[j][i] = 'blank';
		}
	}

	var ck = $e_7('//*[@id="OldDesign"]');
	for (var i=0; i < areacls.snapshotLength-1; i++) {
		// 施設情報を全てリスト
		var rowTextA = areasrc.snapshotItem(i).textContent
		rowTextA = rowTextA.replace(/^.*\//,'');
		var clsText = areacls.snapshotItem(i).textContent;
		clsText = clsText.replace(/^mapAll0*/,'');
		var clsNo = parseInt(clsText) - 1;

		var areaimg;
		if( clsNo < 9 ){
			areaimg = $x_7('//div[@id="mapsAll"]//img[@class="mapAll0' + clsText + '"]');
		}
		else{
			areaimg = $x_7('//div[@id="mapsAll"]//img[@class="mapAll' + clsText + '"]');
		}

		var oldName = "";
		if( (areaimg != undefined) && (areaimg != null) ){
			oldName = areaimg.getAttribute("old");
			if( (oldName != undefined) && (oldName != null) ){
				rowTextA = oldName;
			}
		}

		var x = clsNo % viewSize;
		var y = Math.floor(clsNo / viewSize);

		// 城の情報をチェック
		if( rowTextA.indexOf('_bk_') >= 0 ){
			mapdata[y][x] = 'black';
		}else if( rowTextA.indexOf('_bg_') >= 0 ){
			mapdata[y][x] = 'aqua';
		}else if( rowTextA.indexOf('_b_') >= 0 ){
			mapdata[y][x] = 'blue';
		}else if( rowTextA.indexOf('_p_') >= 0 ){
			mapdata[y][x] = 'purple';
		}else if( rowTextA.indexOf('_r_') >= 0 ){
			mapdata[y][x] = 'red';
		}else if( rowTextA.indexOf('_g_') >= 0 ){
			mapdata[y][x] = 'green';
		}else if( rowTextA.indexOf('_o_') >= 0 ){
			mapdata[y][x] = 'orange';
		}else if( rowTextA.indexOf('_y_') >= 0 ){
			mapdata[y][x] = 'yellow';
		}else if( rowTextA.indexOf('blanc') >= 0 ){
			mapdata[y][x] = 'wall';
		}

		// 51x51モードが実装されており、かつ旧マップ使用が有効
		if( hosttype == "0" ){
			if( chkflg2.charAt(FLAG2_OLDDESIGN) == '1' ){
				if( icon_map[rowTextA] != undefined ){
					areasrc.snapshotItem(i).textContent = icon_map[rowTextA];
				}
				else if( rowTextA.indexOf("resource") >= 0 ){
					areasrc.snapshotItem(i).textContent = icon_map['field'];
				}
				areaimg.setAttribute("old",rowTextA);
			}
			else{
				if( (oldName != null) && (oldName != undefined) && (oldName != "")){
					areasrc.snapshotItem(i).textContent = "/20110414-01/extend_project/w760/img/panel/" + oldName;
				}
			}
		}
	}

	// 51x51モードが実装されており、かつ旧マップ使用が有効
	if( hosttype == "0" ){
		if( chkflg2.charAt(FLAG2_OLDDESIGN) == '1' ){
			var mapsAll = $e_7('//div[@id="mapsAll"]');
			for( y = 0; y < viewSize; y++ ){
				for( x = 0; x < viewSize; x++ ){
					if( mapdata[y][x] == 'blank' ){
						var img = document.createElement("img");
						img.src = icon_map['field'];
						if( y*viewSize + x + 1 <= 9 ){
							img.className = "mapAll0" + parseInt(x + 1);
						}
						else{
							img.className = "mapAll" + parseInt(y*viewSize + x + 1);
						}
						img.setAttribute("add","1");
						img.alt = "";
						mapsAll.snapshotItem(0).appendChild(img);
					}
				}
			}
		}
		else{
			for( y = 0; y < viewSize; y++ ){
				for( x = 0; x < viewSize; x++ ){
					if( mapdata[y][x] == 'blank' ){
						var classNo;
						if( y*viewSize + x + 1 <= 9 ){
							classNo = "0" + parseInt(x + 1);
						}
						else{
							classNo = parseInt(y*viewSize + x + 1);
						}

						var ex = $x_7('//div[@id="mapsAll"]//img[@add="1"]');
						if( (ex != undefined) && (ex != null) ){
							var ex2_p = ex.parentNode;
							ex2_p.removeChild(ex);
						}
					}
				}
			}
		}
	}

	// オプションオンのときだけレーダー描画
	if( chkflg2.charAt(FLAG2_RADER) == '1' ){
		// テキストボックスサイズの修正
		if( viewSize == 11 ){
			smallmap.snapshotItem(0).style.width = "66px";
			smallmap.snapshotItem(0).style.height = "66px";
			smallmap.snapshotItem(0).style.marginLeft = '-10px';
			smallmap.snapshotItem(0).style.marginTop = '354px';
		}
		else if( viewSize == 15 ){
			smallmap.snapshotItem(0).style.width = "90px";
			smallmap.snapshotItem(0).style.height = "90px";
			smallmap.snapshotItem(0).style.marginLeft = '-10px';
			smallmap.snapshotItem(0).style.marginTop = '330px';
		}
		else{
			smallmap.snapshotItem(0).style.width = "120px";
			smallmap.snapshotItem(0).style.height = "120px";
			smallmap.snapshotItem(0).style.marginLeft = '-10px';
			smallmap.snapshotItem(0).style.marginTop = '300px';
		}

		// 画像の設置
		var areaText = '';
		for( i = 0; i < viewSize; i++ ){
			for( j = 0; j < viewSize; j++ ){
				if( mapdata[j][i] == 'red' ){
					areaText = areaText + '<img src="' + icon_m[0] + '" width="6px" height="6px"/>';
				}
				else if( mapdata[j][i] == 'green' ){
					areaText = areaText + '<img src="' + icon_m[1] + '" width="6px" height="6px"/>';
				}
				else if( mapdata[j][i] == 'orange' ){
					areaText = areaText + '<img src="' + icon_m[2] + '" width="6px" height="6px"/>';
				}
				else if( mapdata[j][i] == 'yellow' ){
					areaText = areaText + '<img src="' + icon_m[3] + '" width="6px" height="6px"/>';
				}
				else if( mapdata[j][i] == 'black' ){
					areaText = areaText + '<img src="' + icon_m[4] + '" width="6px" height="6px"/>';
				}
				else if( mapdata[j][i] == 'blank' ){
					areaText = areaText + '<img src="' + icon_m[5] + '" width="6px" height="6px"/>';
				}
				else if( mapdata[j][i] == 'purple' ){
					areaText = areaText + '<img src="' + icon_m[6] + '" width="6px" height="6px"/>';
				}
				else if( mapdata[j][i] == 'blue' ){
					areaText = areaText + '<img src="' + icon_m[7] + '" width="6px" height="6px"/>';
				}
				else if( mapdata[j][i] == 'aqua' ){
					areaText = areaText + '<img src="' + icon_m[8] + '" width="6px" height="6px"/>';
				}
				else if( mapdata[j][i] == 'wall' ){
					areaText = areaText + '<img src="' + icon_m[9] + '" width="6px" height="6px"/>';
				}
			}
			areaText = areaText + '<br>';
		}
		if( areaText != '' ){
			smallmap.snapshotItem(0).innerHTML = areaText;
		}
	}
	else{
		var smallmapdv = $e_7('//*[@id="smallmap_dv"]');
		smallmapdv.snapshotItem(0).style.display = "none";
	}

	//----------------------------------------//
	// 全体表示画面から、領土情報を手に入れる //
	//----------------------------------------//
	// イベントデータ
	var areas = $e_7('//*[@id="mapOverlayMap"]//area/@onmouseover');
	var mouseout = $e_7('//*[@id="mapOverlayMap"]//area/@onmouseout');
	var href = $e_7('//*[@id="mapOverlayMap"]//area/@href');
	var textArea = $e_7('//*[@id="castleInfoText"]');

	var putText = "";

	//------------------//
	// 全領土を検索する //
	//------------------//
	for (var i=0; i<areas.snapshotLength; i++) {

		// 取得した領土の情報を抽出
		var rowText = areas.snapshotItem(i).textContent;
		var rowText2 = href.snapshotItem(i).textContent;
		rowText = rowText.replace(/^.*rewrite\(/, "");
		rowText = rowText.replace(/\); .*$/, "");
		var bkText = rowText;
		rowText = rowText.replace(/\//g,"==uZer==");
		rowText = rowText.replace(/', '/g,"'/'");
		rowText = rowText.replace(/'/g,"");
		var valueA = new Array();
		valueA = rowText.split('/');
		valueA[1] = valueA[1].replace(/==uZer==/,"/");
		var userTxt = '<b><font color="green">' + valueA[1] + '</font></b>';
		var groupTxt = '<b><font color="green">' + valueA[4] + '</font></b>';

		var pictImg = '<a href="' + rowText2 + '">'
			      + '<img src="/20100705-01/img/common/sidebar/icon_base.gif" onmouseover="' //ac22
			      + areas.snapshotItem(i).textContent + '" onmouseout="'
			      + mouseout.snapshotItem(i).textContent + '" ></a>';
		var linkText = '/' + pictImg + '<a href="' + rowText2 +  '" style="text-decoration: none"><font color="#00BFFF"><b>' + valueA[3] + '</b></font></a>' + '/距離' + valueA[6];

		// マップ座標の取得
		var rowText3 = valueA[3];
		rowText3 = rowText3.replace(/\(/,"");
		rowText3 = rowText3.replace(/\)/,"");
		var valueB = new Array();
		valueB = rowText3.split(',');
		var cx = parseInt(valueB[0]);
		var cy = parseInt(valueB[1]);

		// 資源数をカウント
		var max;
		var maxtype;
		var maxcount;
		max = 0;
		maxtype = 0;
		maxcount = 0;
		if( res_mode == 1 ){
			for(var j = 7; j <= 10; j++ ){
				if( valueA[j] > max ){
					max = valueA[j];
					maxtype = j - 6;
				}
			}
			for(var j = 7; j <= 10; j++ ){
				if( valueA[j] == max ){
					maxcount = maxcount + 1;
				}
			}
			if(maxcount > 1){
				maxtype = 0;
			}
		}

		//----------------------//
		// 個人・同盟検索の判定 //
		//----------------------//
		var matchcase = -1;    // マッチしたパターン

		// 個人・同盟マッチチェック
		for( var j = 0; j < 3; j++ ){
			for( var k = 0; k < userName[j].length; k++ ){
				// 検索有効時 username に値が入る
				if( userName[j][k] != "" ){
					// ターゲットが個人
					if( target[j] == 1 ){
						// 完全一致かつ、ユーザー名が一致
						if( (fullmatch[j] == 1) && (valueA[1] == userName[j][k]) ){
							matchcase = j;
							break;
						}
						// 部分一致かつ、ユーザー名が一致
						if( (fullmatch[j] == 0) && (valueA[1].indexOf(userName[j][k]) != -1) ){
							matchcase = j;
							break;
						}
					}
					// ターゲットが同盟
					else{
						// 完全一致かつ、ユーザー名が一致
						if( (fullmatch[j] == 1) && (valueA[4] == userName[j][k]) ){
							matchcase = j;
							break;
						}
						// 部分一致かつ、ユーザー名が一致
						if( (fullmatch[j] == 0) && (valueA[4].indexOf(userName[j][k]) != -1) ){
							matchcase = j;
							break;
						}
					}
				}
			}
			if( matchcase != -1 ){
				break;
			}
		}

		if( mapdata[Math.abs(cx-sx)][Math.abs(cy-sy)] == 'black' ){
			matchcase = -1;
		}

		//--------------//
		// 資源強調判定 //
		//--------------//
		var landLevel = valueA[5].length;
		if( valueA[5].substr(0,4) == '<img' ){
			// FaceBook Lands of Legends! 対応
			var stars = valueA[5].match(/<img/g);
			landLevel = stars.length;
		}

		var strongflg = 0;
		if( res_mode == 1 ){
			// 資源一致判定
			if(    (season1[areaNo][1] == parseInt(valueA[7]))	// 木
			    && (season1[areaNo][2] == parseInt(valueA[8]))	// 石
			    && (season1[areaNo][3] == parseInt(valueA[9]))	// 鉄
			    && (season1[areaNo][4] == parseInt(valueA[10]))	// 糧
			    && (season1[areaNo][5] == landLevel) ){		// ★
				strongflg = 1;
			}
			else if(    (season1[areaNo2][1] == parseInt(valueA[7]))	// 木
			         && (season1[areaNo2][2] == parseInt(valueA[8]))	// 石
			         && (season1[areaNo2][3] == parseInt(valueA[9]))	// 鉄
			         && (season1[areaNo2][4] == parseInt(valueA[10]))	// 糧
			         && (season1[areaNo2][5] == landLevel) ){		// ★
				strongflg = 2;
			}
			else if(    (season1[areaNo3][1] == parseInt(valueA[7]))	// 木
			         && (season1[areaNo3][2] == parseInt(valueA[8]))	// 石
			         && (season1[areaNo3][3] == parseInt(valueA[9]))	// 鉄
			         && (season1[areaNo3][4] == parseInt(valueA[10]))	// 糧
			         && (season1[areaNo3][5] == landLevel) ){		// ★
				strongflg = 3;
			}
		}

		//-----------------//
		// NPC砦の検索判定 //
		//-----------------//
		if( (chkflg1.charAt(FLAG1_NPC) == '1') && (valueA[11] == '1') ){
			// NPC砦
			if( putText != "" ){
				putText = putText + "\n";
			}
			// 砦名[0], 君主名[1], 座標[3], 所有者[4], ★[5]
			if( valueA[4] == '-' ){
				putText = putText + '<b><font color="purple">ＮＰＣ</font></b>/' + valueA[0] + '/<b><font color="red">未攻略</font></b>/' + userTxt + linkText + '/' + valueA[5];
			}
			else{
				putText = putText + '<b><font color="purple">ＮＰＣ</font></b>/' + valueA[0] + '/' + groupTxt + '/' + userTxt + linkText + '/' + valueA[5];
			}

			if( res_mode == 0 ){
				disp_AreaIcon(cx,cy,valueA[5].length,viewSize,0);
			}
		}

		//------------------------------------------//
		// 領土検索、または個人・同盟領土の検索判定 //
		//------------------------------------------//
		if( valueA[1] != '' ){
			// 領地化されている土地

			if( (matchcase == -1) && (chkflg2.charAt(FLAG2_LAND) == '1') ){
				// 個人・同盟検索に該当せず、領土検索がオンの場合

				// ☆数による絞り込み
				if(    ((chkflg1.charAt(FLAG1_LV1) == '1') && (landLevel == 1))
				    || ((chkflg1.charAt(FLAG1_LV2) == '1') && (landLevel == 2))
				    || ((chkflg1.charAt(FLAG1_LV3) == '1') && (landLevel == 3))
				    || ((chkflg1.charAt(FLAG1_LV4) == '1') && (landLevel == 4))
				    || ((chkflg1.charAt(FLAG1_LV5) == '1') && (landLevel == 5))
				    || ((chkflg1.charAt(FLAG1_LV6) == '1') && (landLevel == 6))
				    || ((chkflg1.charAt(FLAG1_LV7) == '1') && (landLevel == 7))
				    || ((chkflg1.charAt(FLAG1_LV8) == '1') && (landLevel == 8))
				    || ((chkflg1.charAt(FLAG1_LV9) == '1') && (landLevel == 9)) ){

					// 領土情報は検索結果に反映
					if( putText != "" ){
						putText = putText + "\n";
					}
					// 砦名[0], 君主名[1], 座標[3], ★[5]
					if( valueA[5] != "" ){
						if( ikibaku_flg == 1 ){
							putText = putText + groupTxt + '領土/' + userTxt + '/' + valueA[0] + linkText + '/' + valueA[5] + '/学' + valueA[7] + '/体' + valueA[8] + '/武' + valueA[9] + '/糧' + valueA[10];
						}
						else{
							putText = putText + groupTxt + '領土/' + userTxt + '/' + valueA[0] + linkText + '/' + valueA[5] + '/木' + valueA[7] + '/石' + valueA[8] + '/鉄' + valueA[9] + '/糧' + valueA[10];
						}
					}
					else{
						putText = putText + groupTxt + '領土/' + userTxt + '<b><font color="#FF0000">拠点</font></b>/' + valueA[0] + '/人口' + valueA[2] + linkText;
					}

					// 資源表示の有無で関数が変わる
					if( res_mode == 0 ){
						// パステルカラー表示
						disp_AreaIcon(cx,cy,landLevel,viewSize,100);
					}
					else{
						// 資源別着色表示
						disp_AreaIcon2(cx,cy,landLevel,viewSize,100 + strongflg*1000,maxtype);
					}
				}
			}
			else if( matchcase != -1 ){
				// 個人・同盟検索結果がマッチ

				if( nodisp[matchcase] == 0 ){
					// 画面に☆数を出す場合

					// ☆数による絞り込み
					if(    ((chkflg1.charAt(FLAG1_LV1) == '1') && (landLevel == 1))
					    || ((chkflg1.charAt(FLAG1_LV2) == '1') && (landLevel == 2))
					    || ((chkflg1.charAt(FLAG1_LV3) == '1') && (landLevel == 3))
					    || ((chkflg1.charAt(FLAG1_LV4) == '1') && (landLevel == 4))
					    || ((chkflg1.charAt(FLAG1_LV5) == '1') && (landLevel == 5))
					    || ((chkflg1.charAt(FLAG1_LV6) == '1') && (landLevel == 6))
					    || ((chkflg1.charAt(FLAG1_LV7) == '1') && (landLevel == 7))
					    || ((chkflg1.charAt(FLAG1_LV8) == '1') && (landLevel == 8))
					    || ((chkflg1.charAt(FLAG1_LV9) == '1') && (landLevel == 9)) ){

						// 領土情報は検索結果に反映
						if( putText != "" ){
							putText = putText + "\n";
						}
						// 砦名[0], 君主名[1], 座標[3], ★[5]
						if( valueA[5] != "" ){
							if( ikibaku_flg == 1 ){
								putText = putText + groupTxt + '領土/' + userTxt + '/' + valueA[0] + linkText + '/' + valueA[5] + '/学' + valueA[7] + '/体' + valueA[8] + '/武' + valueA[9] + '/糧' + valueA[10];
							}
							else{
								putText = putText + groupTxt + '領土/' + userTxt + '/' + valueA[0] + linkText + '/' + valueA[5] + '/木' + valueA[7] + '/石' + valueA[8] + '/鉄' + valueA[9] + '/糧' + valueA[10];
							}
						}
						else{
							putText = putText + groupTxt + '領土/' + userTxt + '<b><font color="#FF0000">拠点</font></b>/' + valueA[0] + '/人口' + valueA[2] + linkText;
						}

						// 資源表示の有無で関数が変わる
						if( res_mode == 0 ){
							// パステルカラー表示
							disp_AreaIcon(cx,cy,landLevel,viewSize,100 + colorNo[matchcase]);
						}
						else{
							// 資源別着色表示
							disp_AreaIcon2(cx,cy,landLevel,viewSize,100 + colorNo[matchcase] + strongflg*1000,maxtype);
						}
					}
					else{
						// ☆数の絞り込み対象外となった土地は枠のみつける
						disp_AreaIcon(cx,cy,landLevel,viewSize,colorNo[matchcase]);
					}
				}
				else{
					// 画面に☆数を出さない（領土の着色のみ行う）

					// 枠のみつける
					disp_AreaIcon(cx,cy,landLevel,viewSize,colorNo[matchcase]);
				}
			}
		}

		// 空き地検索結果
		if( (chkflg2.charAt(FLAG2_EMPTY) == '1') && (valueA[1] == '') ){
			// 空き地(空き地同時検索を除き、個人/同盟領土検索時は出さない)
			if(    ((chkflg1.charAt(FLAG1_LV1) == '1') && (landLevel == 1))
			    || ((chkflg1.charAt(FLAG1_LV2) == '1') && (landLevel == 2))
			    || ((chkflg1.charAt(FLAG1_LV3) == '1') && (landLevel == 3))
			    || ((chkflg1.charAt(FLAG1_LV4) == '1') && (landLevel == 4))
			    || ((chkflg1.charAt(FLAG1_LV5) == '1') && (landLevel == 5))
			    || ((chkflg1.charAt(FLAG1_LV6) == '1') && (landLevel == 6))
			    || ((chkflg1.charAt(FLAG1_LV7) == '1') && (landLevel == 7))
			    || ((chkflg1.charAt(FLAG1_LV8) == '1') && (landLevel == 8))
			    || ((chkflg1.charAt(FLAG1_LV9) == '1') && (landLevel == 9)) ){
				if( putText != "" ){
					putText = putText + "\n";
				}
				// 座標[3], ★[5], 木[7], 石[8], 鉄[9], 糧[10]
				if( ikibaku_flg == 1 ){
					putText = putText + '空き地★' + landLevel + linkText + '/学' + valueA[7] + '/体' + valueA[8] + '/武' + valueA[9] + '/糧' + valueA[10];
				}
				else{
					putText = putText + '空き地★' + landLevel + linkText + '/木' + valueA[7] + '/石' + valueA[8] + '/鉄' + valueA[9] + '/糧' + valueA[10];
				}

				var drawColor;
				if( chkflg2.charAt(FLAG2_EMPTY_DRAW) == "1" ){
					// 空き地着色モード有効時
					drawColor = parseInt(chkflg2.charAt(FLAG2_EMPTY_DRAW_COLOR)) + 1;
				}
				else{
					drawColor = 0;
				}

				drawColor = drawColor + 100 + strongflg*1000;	// drawColor > 100で着色
				if( res_mode == 0 ){
					disp_AreaIcon(cx,cy,landLevel,viewSize,drawColor);
				}
				else{
					disp_AreaIcon2(cx,cy,landLevel,viewSize,drawColor,maxtype);
				}
			}
			else if( chkflg2.charAt(FLAG2_EMPTY_DRAW) == "1" ){
				// 空き地着色モード有効時
				drawColor = parseInt(chkflg2.charAt(FLAG2_EMPTY_DRAW_COLOR)) + 1;

				disp_AreaIcon(cx,cy,valueA[5].length,viewSize,drawColor);
			}
		}
		else if( (chkflg2.charAt(FLAG2_EMPTY_DRAW) == "1") && (valueA[1] == '') ){
			// 空き地着色モード有効時
			drawColor = parseInt(chkflg2.charAt(FLAG2_EMPTY_DRAW_COLOR)) + 1;

			disp_AreaIcon(cx,cy,valueA[5].length,viewSize,drawColor);
		}
	}

	// 結果をTextAreaに表示
	textArea.snapshotItem(0).innerHTML = putText;

	//------------------//
	// 本拠地一覧の描画 //
	//------------------//
	if( chkflg2.charAt(FLAG2_OWNER) == '1' ){
		var baseinfodv = $e_7('//*[@id="baseinfo_dv"]');
		baseinfodv.snapshotItem(0).style.display = "inline";

		//----------------------------------//
		// マップデータから本拠地一覧を作る //
		//----------------------------------//
		var areasrc = document.evaluate('//*[@id="mapsAll"]//img/@src',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var areacls = document.evaluate('//*[@id="mapsAll"]//img/@class',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var baseText = $e_7('//*[@id="baseInfoText"]');

		var blank = '                      ';
		var outTextLine = new Array();
		var outLineMax = 0;
		var outLine = 0;
		for (var i = 0; i < 9; i++ ){
			outTextLine[i] = '';
		}
		for (var i=0; i < areacls.snapshotLength-1; i++) {
			// 施設情報を全てリスト
			var rowTextA = areasrc.snapshotItem(i).textContent
			rowTextA = rowTextA.replace(/^.*\//,'');
			var clsText = areacls.snapshotItem(i).textContent;
			clsText = clsText.replace(/^mapAll0*/,'');
			var clsNo = parseInt(clsText) - 1;

			// 城の情報をチェック
			if( rowTextA.substr(0,7) == 'capital' ){
				// テキストデータ
				var text = areas.snapshotItem(clsNo).textContent;

				// 城の情報を抽出
				var rowText = areas.snapshotItem(clsNo).textContent;
				var rowText2 = href.snapshotItem(clsNo).textContent;
				rowText = rowText.replace(/^.*rewrite\(/, "");
				rowText = rowText.replace(/\); .*$/, "");
				var bkText = rowText;
				rowText = rowText.replace(/\//g,"==uZer==");
				rowText = rowText.replace(/', '/g,"'/'");
				rowText = rowText.replace(/'/g,"");
				var valueA = new Array();
				valueA = rowText.split('/');
				valueA[1] = valueA[1].replace(/==uZer==/,"/");

				if( valueA[11] != '1' ){
					// NPC砦ではない

					// マップ座標の取得
					var rowText3 = valueA[3];
					rowText3 = rowText3.replace(/\(/,"");
					rowText3 = rowText3.replace(/\)/,"");
					var valueB = new Array();
					valueB = rowText3.split(',');
					var cx = parseInt(valueB[0]);
					var cy = parseInt(valueB[1]);

					// テキストの生成
					var data2 = '(' + formatRightNumber(cx,4) + ',' +  formatRightNumber(cy,4) + ') ';
					if( rowTextA.substr(0,9) == 'capital_r' ){
						// 他同盟
						data2 = data2 + '<font color="red"   >'
					}else if( rowTextA.substr(0,9) == 'capital_g' ){
						// 自同盟
						data2 = data2 + '<font color="green" >'
					}else if( rowTextA.substr(0,10) == 'capital_bk' ){
						// 自配下
						data2 = data2 + '<font color="black" >'
					}else if( rowTextA.substr(0,10) == 'capital_bg' ){
						// 同盟が配下
						data2 = data2 + '<font color="cyan"  >'
					}else if( rowTextA.substr(0,9) == 'capital_b' ){
						// プレイヤー
						data2 = data2 + '<font color="blue"  >'
					}else if( rowTextA.substr(0,9) == 'capital_o' ){
						// 他配下
						data2 = data2 + '<font color="orange">'
					}else if( rowTextA.substr(0,9) == 'capital_y' ){
						// 不可侵
						data2 = data2 + '<font color="yellow">'
					}
					data2 = data2 + valueA[1] + blank.substr(jstrlen(valueA[1])) + '</font>';
					outTextLine[outLine] = outTextLine[outLine] + data2;
					if( outLine == 8 ){
						outLine = 0;
					}
					else{
						outLine = outLine + 1;
						if( outLine > outLineMax ){
							outLineMax = outLine;
						}
					}
				}
			}
		}
		var outText = '';
		for( var i = 0; i < outLineMax; i++ ){
			// テキストの生成
			if( outText != '' ){
				outText = outText + '<br>';
			}
			outText = outText + outTextLine[i];
		}

		if( outText != '' ){
			baseText.snapshotItem(0).innerHTML = '<font color="brown"><b>本拠地リスト</b></font><br>' + outText;
		}
	}
	else{
		var baseinfodv = $e_7('//*[@id="baseinfo_dv"]');
		baseinfodv.snapshotItem(0).style.display = "none";
	}

	//----------------//
	// 方位表示の描画 //
	//----------------//
	if( chkflg2.charAt(FLAG2_DIRECTION) == '1' ){
		var dv2;
		var img;

		// 方位アイコン（東）
		img = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAACAAAAAiCAYAAAA+stv/AAAABnRSTlMAwADAAMCNeLu6AAABIUlEQVR42tWXaw6EIAyEtydbj86eTOMmNezY'+
				'aSsiZPuTDPbrA6hSSnnNNGkBWJb3aq2X8pFhACsgiEwEEJmcgSh6LFmtfRxAnateKtW+5wvAmsozqwQZLUIfAOtlhHt2AngyA8wOgNo0G1gr'+
				'S4PRoAadmZlgAFF0VzTeMQ0BehmDGJKBWtcE0NoDmdtyWAbYZTW0B5oApmegZw/8ZwZ6WdcMsNftkQzoRnzXWZS7qf42gPdBdGwNHGhpANwU'+
				'Ra9OW+bEcCSznNcRY9RsPf0cZ5xba16mPBAK4A2TDIBBWyAK4/YAGyiiDs+emBNANELXuuxI5jWuOZRmxqjsGfd66KcE1tlnzq8AWCVFrTmW'+
				'R2eXXVbRHuv7XX7PW35KbwH0tA1E3rSyVRg+QgAAAABJRU5ErkJggg==';
		dv2 = d_7.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.top = "390px";
		dv2.style.left = "500px";
		dv2.style.zIndex = 500;
		dv2.id = "icon_east";
		dv2.innerHTML = '<img src="' + img + '">';
		$d("datas").parentNode.appendChild(dv2);

		// 方位アイコン（西）
		img = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAACIAAAAgCAYAAAB3j6rJAAAABnRSTlMAwADAAMCNeLu6AAAA9klEQVR42u2YYQ7DIAiF58nWo7uTubjMhlJA'+
				'EHRd0vevWvXzFdA05ZwfV1BaCbJtzwKfc36l5SANonxRUjrCfEAw6SwVtAqE2UHKEpSzKswBZGRXbUdUm0U7iFbYOQ4EBqHamRtEApHy3AvS'+
				'm/sEgvMcyxOsXA0RQWYLOyeCULsbdYQqZiYQ+PJojHDjLgGiDtYIEJgpYSDc6dkDqX21LRSE6tOM+RkIVCiIdKmhag8VO7jfDKKNA4uGQaQa'+
				'wGUGXtj9adoC0B3NoYblAuFcsCqkoEkuLAXxAExxxKuQGInW/zoyI0a4DBQvz9SAUZDenEv/Bkh6A3xNvDBXWpYCAAAAAElFTkSuQmCC';
		dv2 = d_7.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.top = "145px";
		dv2.style.left = "220px";
		dv2.style.zIndex = 500;
		dv2.id = "icon_west";
		dv2.innerHTML = '<img src="' + img + '">';
		$d("datas").parentNode.appendChild(dv2);

		// 方位アイコン（南）
		img = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAACIAAAAiCAYAAAA6RwvCAAAABnRSTlMAwADAAMCNeLu6AAABAUlEQVR42u2XaxLCIAyE5WT26HiyOnUmHVzz'+
				'wJDQjnZ/0kC/hOVVaq23M6h4QZblvnLttT7KdJAVUEq5QN4hNp0CxILgfEV9poEQhFTFF4i0Aixxg/bGYwI7yOpCGdcHyIyKSNpBWiGUNO9e'+
				'j0hjsiD0AytLj0ekZa6CZImDMUHaTNuMrCphnLULd4FsHXAfwKykfYL6hoF4vhFoz3GQAsJNn7XCQkDaaSEIhAoBkbJDI1Mb54dhkAyFVQSr'+
				'YMVxsUMe6Y3jzq4Uj/RUBL+FgER75v884on9bZC0VeMB0Qx+SEW0m3s6SBuDQK6rovaM1F5tErQ2nvsW/42sGzwLcpSeYYfishi2CCMAAAAA'+
				'SUVORK5CYII=';
		dv2 = d_7.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.top = "390px";
		dv2.style.left = "220px";
		dv2.style.zIndex = 500;
		dv2.id = "icon_south";
		dv2.innerHTML = '<img src="' + img + '">';
		$d("datas").parentNode.appendChild(dv2);

		// 方位アイコン（南）
		img = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAACIAAAAgCAYAAAB3j6rJAAAABnRSTlMAwADAAMCNeLu6AAABAElEQVR42u3WXQ7DIAgA4HGy9ejuZDZLZovI'+
				'n0aM2cZjNfoFLQIppccOAV7IcTwz9z2lF2hjIZBMtgO4IdLY70DgswUHwWNLIGUjbWw7CL7QHHIJpCDecwAR8JxlEO4yY0w4BGejOQ5gIFJR'+
				'wtELkRDc8VSQbFL8EAlPAddYVEbwfA3QQKzovSMUYdWVEIg3C0sy4gWEQ7Yt8X/I90JwoZsBkdoBFkKrrPVg9UJKO9BAuPLOFahZGVEh2oNH'+
				'345RCG2Q3BAgS81oFaU3qDoarUyPlHjPcZc9mjYA95Vau2c9et4o61R/jdZpj7aDFqLJiBXeTr03hppnaZEZ4YZExwnhd/gwvUipkQAAAABJ'+
				'RU5ErkJggg==';
		dv2 = d_7.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.top = "145px";
		dv2.style.left = "500px";
		dv2.style.zIndex = 500;
		dv2.id = "icon_north";
		dv2.innerHTML = '<img src="' + img + '">';
		$d("datas").parentNode.appendChild(dv2);
	}

	//--------------//
	// 出兵情報共有 //
	//--------------//
	unionAttackInfo();
}

//----------------//
// 領土情報の検索 //
//----------------//
//拠点の作業中情報を取得
function getNPCCastleInfo_51(drawflag) {
	//--------------------------------------//
	// チェックボックスに関する情報をロード //
	//--------------------------------------//
	var chkflg1;
	var chkflg2;
	execFlag = loadExecFlag(location.hostname, "FLAG0");
	if( execFlag == "" ){
		// 表示フラグをロード
		var execFlag1 = loadExecFlag(location.hostname, "FLAG1");
		if( execFlag1 == "" ){
			chkflg1 = new String(FLAG1);  // 初期値
		}
		else{
			chkflg1 = execFlag1;
		}

		// オプションフラグをロード
		var execFlag2 = loadExecFlag(location.hostname, "FLAG2");
		if( execFlag2 == "" ){
			chkflg2 = new String(FLAG2);  // 初期値
		}
		else{
			chkflg2 = execFlag2;
		}

		// 初回のときは、フラグを保存
		execFlag = chkflg1 + DELIMIT1_7 + chkflg2;
		saveExecFlag(location.hostname, "FLAG0", execFlag);
	}
	else{
		var loadflg = new Array();
		loadflg = execFlag.split(DELIMIT1_7);
		chkflg1 = loadflg[0];
		chkflg2 = loadflg[1];
	}

	// 個人、同盟検索情報をロード
	var chkflg3 = new Array();
	execFlag = loadExecFlag(location.hostname, "FLAG3");
	if( execFlag == "" ){
		var execFlag3 = loadExecFlag(location.hostname, "FLAG3-1");
		if( execFlag3 == "" ){
			chkflg3[0] = new String(FLAG3_1);  // 初期値
		}
		else{
			chkflg3[0] = execFlag3;
		}
		execFlag3 = loadExecFlag(location.hostname, "FLAG3-2");
		if( execFlag3 == "" ){
			chkflg3[1] = new String(FLAG3_2);  // 初期値
		}
		else{
			chkflg3[1] = execFlag3;
		}
		execFlag3 = loadExecFlag(location.hostname, "FLAG3-3");
		if( execFlag3 == "" ){
			chkflg3[2] = new String(FLAG3_3);  // 初期値
		}
		else{
			chkflg3[2] = execFlag3;
		}

		// 初回のときは、フラグを保存
		execFlag = chkflg3[0] + DELIMIT1_7 + chkflg3[1] + DELIMIT1_7 + chkflg3[2];
		saveExecFlag(location.hostname, "FLAG3", execFlag);
	}
	else{
		chkflg3 = execFlag.split(DELIMIT1_7);
	}

	//-------------------------------------------------//
	// 51x51モード未使用設定の場合、なにもしないで戻る //
	//-------------------------------------------------//
	if( chkflg2.charAt(FLAG2_NOEXEC51) == '1' ){
		return;
	}


	//----------------------//
	// 処理パラメータの抽出 //
	//----------------------//
	//-- データ絞り込み時のユーザー名情報の取得 --//
	var checkBox1;
	var checkBox2;
	var userBox;
	var listbox;
	var userName = new Array();
	var userText;
	var fullmatch = new Array();
	var nodisp = new Array();
	var target = new Array();
	var colorNo = new Array();
	for( var i = 0; i < 3; i++ ){
		fullmatch[i] = 0;
		nodisp[i] = 0;
		target[i] = 0;
		colorNo[i] = 0;
	}

	// 個人・同盟検索１
	checkBox1 = $e_7('//*[@id="ckEnable1"]');
	if( checkBox1.snapshotItem(0).checked == true ){
		// 個人・同盟の別
		checkBox2 = $e_7('//*[@id="ckType1"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			target[0] = 1;
		}
		else{
			target[0] = 2;
		}
		// 完全一致
		checkBox2 = $e_7('//*[@id="ckFullMatch1"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			fullmatch[0] = 1;
		}
		else{
			fullmatch[0] = 0;
		}
		// ☆表示
		checkBox2 = $e_7('//*[@id="ckLevelSearch1"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			nodisp[0] = 1;
		}
		else{
			nodisp[0] = 0;
		}
		userBox = $e_7('//*[@id="userBox1"]');
		userText = userBox.snapshotItem(0).value;
		userName[0] = new Array();
		userName[0] = userText.split(OWNER_SPLITKEY);
		// 枠色
		listbox = $e_7('//*[@id="lsColor1"]');
		colorNo[0] = listbox.snapshotItem(0).selectedIndex + 1;
	}
	else{
		userName[0] = "";
	}

	// 個人・同盟検索２
	checkBox1 = $e_7('//*[@id="ckEnable2"]');
	if( checkBox1.snapshotItem(0).checked == true ){
		// 個人・同盟の別
		checkBox2 = $e_7('//*[@id="ckType2"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			target[1] = 1;
		}
		else{
			target[1] = 2;
		}
		// 完全一致
		checkBox2 = $e_7('//*[@id="ckFullMatch2"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			fullmatch[1] = 1;
		}
		else{
			fullmatch[1] = 0;
		}
		// ☆表示
		checkBox2 = $e_7('//*[@id="ckLevelSearch2"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			nodisp[1] = 1;
		}
		else{
			nodisp[1] = 0;
		}
		userBox = $e_7('//*[@id="userBox2"]');
		userText = userBox.snapshotItem(0).value;
		userName[1] = new Array();
		userName[1] = userText.split(OWNER_SPLITKEY);
		// 枠色
		listbox = $e_7('//*[@id="lsColor2"]');
		colorNo[1] = listbox.snapshotItem(0).selectedIndex + 1;
	}
	else{
		userName[1] = "";
	}

	// 個人・同盟検索３
	checkBox1 = $e_7('//*[@id="ckEnable3"]');
	if( checkBox1.snapshotItem(0).checked == true ){
		// 個人・同盟の別
		checkBox2 = $e_7('//*[@id="ckType3"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			target[2] = 1;
		}
		else{
			target[2] = 2;
		}
		// 完全一致
		checkBox2 = $e_7('//*[@id="ckFullMatch3"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			fullmatch[2] = 1;
		}
		else{
			fullmatch[2] = 0;
		}
		// ☆表示
		checkBox2 = $e_7('//*[@id="ckLevelSearch3"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			nodisp[2] = 1;
		}
		else{
			nodisp[2] = 0;
		}
		userBox = $e_7('//*[@id="userBox3"]');
		userText = userBox.snapshotItem(0).value;
		userName[2] = new Array();
		userName[2] = userText.split(OWNER_SPLITKEY);
		// 枠色
		listbox = $e_7('//*[@id="lsColor3"]');
		colorNo[2] = listbox.snapshotItem(0).selectedIndex + 1;
	}
	else{
		userName[2] = "";
	}

	//-- 資源判別ONのとき、資源表示 --//
	var res_mode;
	var areaNo;
	var areaNo2;
	var areaNo3;
	if( chkflg2.charAt(FLAG2_ANALYZE) == '1' ){
		res_mode = 1;
	}
	else{
		res_mode = 0;
	}

	// 強調表示選択値を取得
	areaNo = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO,3));
	areaNo2 = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO2,3));
	areaNo3 = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO3,3));

	//------------------//
	// 画面サイズの取得 //
	//------------------//
	var viewSize = 51;

	//-------------------------//
	// 51x51モードへの設定反映 //
	//-------------------------//
	// 処理データの取得
	var href = $e_7('//*[@id="map51-content"]//div/a');

	var redrawX = new Array();
	var redrawY = new Array();
	if( drawflag == 1 ){
		if( (autoroute == AUTO_ROUTE_EDIT_LAST) || (autoroute == AUTO_ROUTE_NONE) ){
			// 始点を配列に保存
			redrawX[0] = autoroute_f[0];
			redrawY[0] = autoroute_f[1];
		}

		// 終点を配列に保存
		redrawX[1] = autoroute_l[0];
		redrawY[1] = autoroute_l[1];

		// ルート構築ビューの中身を配列に保存
		var pos = 2;
		var baseText = $e_7('//*[@id="routeInfoText"]');
		var text = baseText.snapshotItem(0).innerHTML;
		if( text != "" ){
			var text2 = text.split("<br>");
			for( var i = 0; i < text2.length; i++ ){
				if( (i == 0) && (autoroute != AUTO_ROUTE_EDIT_FIRST) ){
					continue;
				}
				var list = text2[i].match(/(([-]*\d+),([-]*\d+))/);
				redrawX[pos] = list[2];
				redrawY[pos] = list[3];
				pos = pos + 1;
			}
		}
	}

	var maxcount;
	if( drawflag == 0 ){
		maxcount = href.snapshotLength;
	}
	else{
		maxcount = redrawX.length;
	}
	for( var i = 0; i < maxcount; i++ ){
//	for( var i = 0; i < 10; i++ ){
		var dt;
		if( drawflag == 0 ){
			dt = href.snapshotItem(i);
		}
		else{
			dt = $x_7("//div[@id=\"map51-content\"]//a[@href=\"/land.php?x=" + redrawX[i] + "&y=" + redrawY[i] + "#ptop\"]");
			if( (dt == null) || (dt == undefined) ){
				continue;
			}
		}
		var text = trim_7(dt.innerHTML);
		var p;
		var user = "";
		var group = "";
		var land = "";
		var landLevel = 0;
		var space = 0;

		// いま設定されている着色指定を解除
		if( text.indexOf("font") >= 0 ){
			text = text.substr(text.indexOf("</font>")-1,1);
			if( text == "S" ){
				text = autoroute_f[2];
			}
			else if( text == "E" ){
				text = autoroute_l[2];
			}
		}

		// 砦などの表示を英字に変更
		if( text == "村" ){
			text = "V";
		} else if( text == "砦" ){
			text = "F";
		} else if( text == "城" ){
			text = "C";
		}

		//----------------------//
		// 個人・同盟検索の判定 //
		//----------------------//
		var matchcase = -1;    // マッチしたパターン

		// 同盟名、個人名の取得
		p = dt.parentNode.innerHTML.match(/君主名<\/dt><dd>(.*)<\/dd><dt>座標/);
		if( p != undefined ){
			user = p[1];
		}
		else{
			p = dt.parentNode.innerHTML.match(/君主名&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt&gt;座標/);
			if( p != undefined ){
				user = p[1];
			}
		}
		p = dt.parentNode.innerHTML.match(/君主名<\/dt><dd>(.*)<\/dd><dt>人口/);
		if( p != undefined ){
			user = p[1];
		}
		else{
			p = dt.parentNode.innerHTML.match(/君主名&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt&gt;人口/);
			if( p != undefined ){
				user = p[1];
			}
		}
		p = dt.parentNode.innerHTML.match(/同盟名<\/dt><dd>(.*)<\/dd><dt>戦力/);
		if( p != undefined ){
			group = p[1];
		}
		else{
			p = dt.parentNode.innerHTML.match(/同盟名&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt&gt;戦力/);
			if( p != undefined ){
				group = p[1];
			}
		}
		p = dt.parentNode.innerHTML.match(/同盟名<\/dt><dd class=&quot;bottom-popup-r&quot;>(.*)<\/dd><\/dl>/);
		if( p != undefined ){
			group = p[1];
		}
		else{
			p = dt.parentNode.innerHTML.match(/同盟名&lt;\/dt&gt;&lt;dd class=&quot;bottom-popup-r&quot;&gt;(.*)&lt;\/dd&gt;&lt;\/dl&gt;/);
			if( p != undefined ){
				group = p[1];
			}
		}
		p = dt.parentNode.innerHTML.match(/戦力<\/dt><dd>(.*)<\/dd><dt class=/);
		if( p != undefined ){
			land = p[1];
			landLevel = land.length;
			if(text == "　"){
				text = landLevel;
			}
		}
		else{
			p = dt.parentNode.innerHTML.match(/戦力&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt class=/);
			if( p != undefined ){
				land = p[1];
				landLevel = land.length;
				if(text == "　"){
					text = landLevel;
				}
			}
		}
		if( dt.parentNode.innerHTML.indexOf(">空き地<") >= 0 ){
			space = 1;
		}
		else if( dt.parentNode.innerHTML.indexOf("&gt;空き地&lt;") >= 0 ){
			space = 1;
		}
		// 個人・同盟マッチチェック
		for( var j = 0; j < 3; j++ ){
			for( var k = 0; k < userName[j].length; k++ ){
				// 検索有効時 username に値が入る
				if( userName[j][k] != "" ){
					// ターゲットが個人
					if( target[j] == 1 ){
						// 完全一致かつ、ユーザー名が一致
						if( (fullmatch[j] == 1) && (user == userName[j][k]) ){
							matchcase = j;
							break;
						}
						// 部分一致かつ、ユーザー名が一致
						if( (fullmatch[j] == 0) && (user.indexOf(userName[j][k]) != -1) ){
							matchcase = j;
							break;
						}
					}
					// ターゲットが同盟
					else{
						// 完全一致かつ、ユーザー名が一致
						if( (fullmatch[j] == 1) && (group == userName[j][k]) ){
							matchcase = j;
							break;
						}
						// 部分一致かつ、ユーザー名が一致
						if( (fullmatch[j] == 0) && (group.indexOf(userName[j][k]) != -1) ){
							matchcase = j;
							break;
						}
					}
				}
			}
			if( matchcase != -1 ){
				break;
			}
		}

		//-----------------//
		// cssデータの作成 //
		//-----------------//
		var css = "";
		var strong = 0;		// 太字にするか

		if( space == 0 ){
			// 領地化されている土地

			if( (matchcase == -1) && (chkflg2.charAt(FLAG2_LAND) == '1') ){
				// 個人・同盟検索に該当せず、領土検索がオンの場合

				// ☆数による絞り込み
				if(    ((chkflg1.charAt(FLAG1_LV1) == '1') && (landLevel == 1))
				    || ((chkflg1.charAt(FLAG1_LV2) == '1') && (landLevel == 2))
				    || ((chkflg1.charAt(FLAG1_LV3) == '1') && (landLevel == 3))
				    || ((chkflg1.charAt(FLAG1_LV4) == '1') && (landLevel == 4))
				    || ((chkflg1.charAt(FLAG1_LV5) == '1') && (landLevel == 5))
				    || ((chkflg1.charAt(FLAG1_LV6) == '1') && (landLevel == 6))
				    || ((chkflg1.charAt(FLAG1_LV7) == '1') && (landLevel == 7))
				    || ((chkflg1.charAt(FLAG1_LV8) == '1') && (landLevel == 8))
				    || ((chkflg1.charAt(FLAG1_LV9) == '1') && (landLevel == 9)) ){

					// レベル表示指定のとき、太字にする
					strong = 1;
				}
			}
		}
		if( (space == 1) && (chkflg2.charAt(FLAG2_EMPTY) == '1') ){
			// 空き地かつ、空き地検索が有効
			if(    ((chkflg1.charAt(FLAG1_LV1) == '1') && (landLevel == 1))
			    || ((chkflg1.charAt(FLAG1_LV2) == '1') && (landLevel == 2))
			    || ((chkflg1.charAt(FLAG1_LV3) == '1') && (landLevel == 3))
			    || ((chkflg1.charAt(FLAG1_LV4) == '1') && (landLevel == 4))
			    || ((chkflg1.charAt(FLAG1_LV5) == '1') && (landLevel == 5))
			    || ((chkflg1.charAt(FLAG1_LV6) == '1') && (landLevel == 6))
			    || ((chkflg1.charAt(FLAG1_LV7) == '1') && (landLevel == 7))
			    || ((chkflg1.charAt(FLAG1_LV8) == '1') && (landLevel == 8))
			    || ((chkflg1.charAt(FLAG1_LV9) == '1') && (landLevel == 9)) ){

				// レベル表示指定のとき、太字にする
				strong = 1;
			}
		}

		// 個人・同盟マッチ判定
		if( matchcase != -1 ){
			// 枠着色CSSの追加
			css = css + 'border-style: solid; border-color: ' + cname_en[colorNo[matchcase]-1] + '; background-color: white; ';

			if( nodisp[matchcase] == 0 ){
				if(    ((chkflg1.charAt(FLAG1_LV1) == '1') && (landLevel == 1))
				    || ((chkflg1.charAt(FLAG1_LV2) == '1') && (landLevel == 2))
				    || ((chkflg1.charAt(FLAG1_LV3) == '1') && (landLevel == 3))
				    || ((chkflg1.charAt(FLAG1_LV4) == '1') && (landLevel == 4))
				    || ((chkflg1.charAt(FLAG1_LV5) == '1') && (landLevel == 5))
				    || ((chkflg1.charAt(FLAG1_LV6) == '1') && (landLevel == 6))
				    || ((chkflg1.charAt(FLAG1_LV7) == '1') && (landLevel == 7))
				    || ((chkflg1.charAt(FLAG1_LV8) == '1') && (landLevel == 8))
				    || ((chkflg1.charAt(FLAG1_LV9) == '1') && (landLevel == 9)) ){
					// 枠表示のみでなく、指定領土レベル以上のばあい、太字にする
					strong = 1;
				}
			}
		}

		// 太字処理
		if( (strong == 1) && (landLevel > 0) ){
			// 太字化CSSの追加 資源判別オンのときのみ
			if( res_mode == 1 ){
				css = css + 'text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;';
			}
		}
		else if( landLevel != 0 ){
			// 拠点以外の場合、灰色化CSSの追加
			css = css + 'color: transparent; ';
		}

		// 資源判別(太字処理のときのみ)
		if( (strong == 1) && (res_mode == 1) ){
			p = dt.parentNode.innerHTML.match(/.*木(\d+)&amp;nbsp;岩(\d+)&amp;nbsp;鉄(\d+)&amp;nbsp;糧(\d+).*/);
			if( p != undefined ){
				// マッチ
				var maxres = -1;
				var maxpos = -1;
				var multi = 0;
				for( var j = 1; j < 5; j++ ){
					if(p[j] > maxres){
						maxres = p[j];
						maxpos = j;
						multi = 0;
					}
					else if( p[j] == maxres ){
						multi = 1;
					}
				}
	
				var col;
				if( multi == 1 ){
					col = "white";
				}
				else if( maxpos == 1 ){
					col = "springgreen";
				}
				else if( maxpos == 2 ){
					col = "aqua";
				}
				else if( maxpos == 3 ){
					col = "orange";
				}
				else if( maxpos == 4 ){
					col = "yellow";
				}

				// 資源判別CSSの追加
				css = css + 'color: ' + col + '; ';
			}
		}

		//---------------------------------//
		// 生成したCSSをマップデータに反映 //
		//---------------------------------//
		var newText;
		if( css != "" ){
			if( res_mode == 1 ){
				newText = '<b><font style="' + css + '">' + text + '</font></b>';
			}
			else{
				newText = '<font style="' + css + '">' + text + '</font>';
			}
			dt.innerHTML = newText;
		}
		else{
			newText = '<font>' + text + '</font>';
			dt.innerHTML = newText;
		}
	}

	return;
}


//--------------//
// 出兵情報共有 //
//--------------//
function unionAttackInfo()
{
	//--------------//
	// 出兵情報共有 //
	//--------------//
	// チェック情報
	var checkBox = $e_7('//*[@id="ckUnion"]');

	// 画面サイズの取得
	var viewSize;
	viewSize = getViewSize();
	if( viewSize == 51 ){
		// 51x51だといまのとこなにもできないので戻る

		return;
	}

	// 全体表示画面から、画面中央座標を手に入れる //
	var codx = $e_7('//div[@id="datas"]/input[@id=\"x\"]');
	var cody = $e_7('//div[@id="datas"]/input[@id=\"y\"]');
	var bx = codx.snapshotItem(0).value;
	var by = cody.snapshotItem(0).value;
	var sx;
	var sy;
	var ex;
	var ey;

	// 左上座標を求める
	if( viewSize == 11 ){
		sx = parseInt(bx) - 5;
		sy = parseInt(by) + 5;
	}
	else if( viewSize == 15 ){
		sx = parseInt(bx) - 7;
		sy = parseInt(by) + 7;
	}
	else{
		sx = parseInt(bx) - 9;
		sy = parseInt(by) + 9;
	}
	ex = parseInt(sx) + (parseInt(viewSize) - 1)
	ey = parseInt(sy) - (parseInt(viewSize) - 1)

	// chromeでクロスドメイン処理がうまくいかないので、とりあえずFireFox限定
	if( /*(browserType != "Chrome") &&*/ (checkBox.snapshotItem(0).checked == true) && (spreadsheet != "") ){	//faraway コメントにしてある
		GM_xmlhttpRequest({
			method:"GET",
			url:spreadsheet,
			onload:function(x){
				var rollover = $d("rollover");
	
				var textline = x.responseText.split('\n');
	
				var pos = -1;
				var user = -1;
				var pd = -1;
				var com = -1;
				var data = textline[0].split('\t');
				for( var j = 0; j < data.length; j++ ){
					if( data[j] == '座標' ){
						pos = j;
					}
					else if( data[j] == 'ユーザー' ){
						user = j;
					}
					else if( data[j] == '着弾時刻' ){
						pd = j;
					}
					else if( data[j] == '補足' ){
						com = j;
					}
				}

				// サーバー時間の取得
				var svdata = document.evaluate('//span[@id="server_time"]',
					document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
				var time_text = svdata.snapshotItem(0).textContent;
				var day = time_text.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
				var servertime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

				if( (pos >= 0) && (user >=0) && (pd >= 0) ){
					var stack = new Array();
					for( var i = 1; i < textline.length; i++ ){
						var data = textline[i].split('\t');
//other						if( data.length < 3 ){
//other							continue;			//分岐点対応のため、チェック無効。座標がない場合はスキップされるので問題なし？
//other						}

						var posv = data[pos].match(/([-]*\d+),([-]*\d+)/);
//other						if( (posv.length < 2) || (posv[1] < sx) || (posv[1] > ex) || (posv[2] < ey) || posv[2] > sy ){
						if((posv == null) || (posv.length < 2) || (posv[1] < sx) || (posv[1] > ex) || (posv[2] < ey) || posv[2] > sy ){
							// 画面外
							continue;
						}
	
						stack[0] = posv[1];
						stack[1] = posv[2];
						stack[2] = data[user];
						stack[3] = data[pd];

						var flagWill = false;	//other
						// 終了時間の取得
						day = stack[3].match(/(\d+)[\/-](\d+)[\/-](\d+) +(\d+):(\d+):(\d+)/);
						if((day == null) || (day.length < 7)){
//							continue;
							flagWill = true;
						}
						if(!flagWill) {
							var endtime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

							var waittime = endtime.getTime() - servertime.getTime();
							if( waittime < 0 ){
								continue;
							}
						}
						// areaデータを取ってみる
						var area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + posv[1] + "&y=" + posv[2] + "#ptop\"]");
						if( area_pos == null ){
							area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + posv[1] + "&y=" + posv[2] + "\"]");
						}
						var list3 = area_pos.getAttribute("onmouseover").match(/'(\d+)px', '(\d+)px/);
	
//other						var puttext = "　" + stack[2] + "　" + stack[3];
						var puttext = !flagWill ? "　" + stack[2] + "　" + stack[3] : '　予定ルート';
						if( com != -1 ){
							if( data[com] != undefined ){
								puttext += "　" + data[com];
							}
						}
						area_pos.title = area_pos.alt;
						area_pos.title += puttext;
	
						// クリックしたポイントに画像を埋め込む
						var img = d_7.createElement("img");
						img.style.position = "absolute";
	
						img.style.left = list3[1] + "px";
						img.style.top = list3[2] + "px";
	
						// アイコンの決定
						if(flagWill) {
							img.name = "RootIcon";
							img.src = root_icon;
						} else {
							img.src = atk_icon;
							img.name = "atkIcon";
						}
						if( viewSize == 15 ){
							img.style.width = "44px";
							img.style.height = "44px";
							img.style.zIndex = 227;
						} else if( viewSize == 20 ){
							img.style.width = "33px";
							img.style.height = "33px";
							img.style.zIndex = 402;
						} else {
							img.style.width = "60px";
							img.style.height = "60px";
							img.style.zIndex = 123;
						}
						rollover.parentNode.insertBefore(img, rollover.nextSibling);
					}
				}
			}
		});
	}
}


//------------------------//
// 文字列の長さをチェック //
//------------------------//
function jstrlen(str, i) {
   var len = 0;
   str = escape(str);
   for (i = 0; i < str.length; i++, len++) {
      if (str.charAt(i) == "%") {
         if (str.charAt(++i) == "u") {
            i += 3;
            len++;
         }
         i++;
      }
   }
   return len;
}

//----------//
// 桁数整形 //
//----------//
function formatRightNumber( num, length ){
	var fix = '      ';
	var str;
	var result = '';

	str = num.toString(10);
	if( str.length < length ){
		result = fix.substr(0,length - str.length) + str;
	}
	else{
		result = str;
	}

	return result;
}

//--------------------------------//
// アイコン表示（レベル表示のみ） //
//--------------------------------//
function disp_AreaIcon(cx,cy,num,viewSize,group_flg)
{
	var area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + cx + "&y=" + cy + "#ptop\"]");
	if( area_pos == null ){
		area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + cx + "&y=" + cy + "\"]");
	}

	var dat = area_pos.getAttribute("onmouseover");
	dat = dat.replace(/^.*overOperation/, "setArea");
	dat = dat.replace(/\);.*$/, '');
	dat = dat + ',' + num + ',' + viewSize + ',' + group_flg + ');';
	eval(dat);
	
	function setArea(act, x, y, num, viewSize, group_flg)
	{
		var rollover = $d("rollover");

		//--------------//
		// ホスト名判別 //
		//--------------//
		var hosttype = "";
		if(    (location.hostname.indexOf("1kibaku") == -1)
		    && (location.hostname.indexOf("legend") == -1) ){
			hosttype = "0";
		}

		//------------------//
		// 旧マップ使用判定 //
		//------------------//
		var old = false;
		var ck = $e_7('//*[@id="ckOldDesign"]');
		if( (check51_51mode_7() == 1) && (ck.snapshotItem(0).checked == true) ){
			old = true;
		}

		if( group_flg >= 100 ){
			// 100より大きい場合は☆数表示あり
			var img = d_7.createElement("img");
			img.style.position = "absolute";

			img.style.left = x;
			var t = (y.substr(0,y.length-2));

			img.name = "viewIcon";

			if( viewSize == 15 ){
				img.src = icon_c_7[1][num];
				img.style.zIndex = 226;
				img.style.top = (parseInt(t) + 3) + "px";
			} else if( viewSize == 20 ){
				img.src = icon_c_7[2][num];
				img.style.zIndex = 401;
				img.style.top = (parseInt(t) + 3) + "px";
			} else {
				img.src = icon_c_7[0][num];
				img.style.zIndex = 122;
				img.style.top = (parseInt(t) + 0) + "px";
			}
			rollover.parentNode.insertBefore(img, rollover.nextSibling);
		}

		if( (group_flg % 100) > 0 ){
			// カラー指定があるばあいは、枠を表示
			var img2 = d_7.createElement("img");
			img2.style.position = "absolute";

			img2.name = "viewIcon";

			var iconNo = group_flg % 100;
			if( viewSize == 15 ){
				img2.src = icon_2[iconNo];
				img2.style.width = "44px";
				img2.style.height = "44px";
				img2.style.zIndex = 226;

				if( (hosttype == "0") && (old != true) ){
					img2.style.left = x;
					img2.style.top = parseInt(y.substr(0,y.length-2)) + 2 + "px";
				}
				else{
					img2.style.left = x;
					img2.style.top = y;
				}
			} else if( viewSize == 20 ){
				img2.src = icon_2[iconNo];
				img2.style.width = "33px";
				img2.style.height = "33px";
				img2.style.zIndex = 401;

				if( (hosttype == "0") && (old != true) ){
					img2.style.left = parseInt(x.substr(0,x.length-2)) + 1 + "px";
					img2.style.top = parseInt(y.substr(0,y.length-2)) + 4 + "px";
				}
				else{
					img2.style.left = x;
					img2.style.top = parseInt(y.substr(0,y.length-2)) + 1 + "px";
				}
			} else {
				img2.src = icon_2[iconNo];
				img2.style.width = "60px";
				img2.style.height = "60px";
				img2.style.zIndex = 122;

				if( (hosttype == "0") && (old != true) ){
					img2.style.left = parseInt(x.substr(0,x.length-2)) + 1 + "px";
					img2.style.top = parseInt(y.substr(0,y.length-2)) + 2 + "px";
				}
				else{
					img2.style.left = x;
					img2.style.top = y;
				}
			}
			rollover.parentNode.insertBefore(img2, rollover.nextSibling);
		}
	}
	
}

//----------------------------//
// アイコン表示（資源モード） //
//----------------------------//
function disp_AreaIcon2(cx,cy,num,viewSize,group_flg,maxtype)
{
	var area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + cx + "&y=" + cy + "#ptop\"]");
	if( area_pos == null ){
		area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + cx + "&y=" + cy + "\"]");
	}
	var dat = area_pos.getAttribute("onmouseover");
	dat = dat.replace(/^.*overOperation/, "setArea");
	dat = dat.replace(/\);.*$/, '');
	dat = dat + ',' + num + ',' + viewSize + ',' + group_flg + ',' + maxtype + ');';
	eval(dat);

	function setArea(act, x, y, num, viewSize, group_flg, maxtype)
	{
		var rollover = $d("rollover");

		//--------------//
		// ホスト名判別 //
		//--------------//
		var hosttype = "";
		if(    (location.hostname.indexOf("1kibaku") == -1)
		    && (location.hostname.indexOf("legend") == -1) ){
			hosttype = "0";
		}

		var old = false;
		var ck = $e_7('//*[@id="ckOldDesign"]');
		if( (check51_51mode_7() == 1) && (ck.snapshotItem(0).checked == true) ){
			old = true;
		}

		if( group_flg % 1000 >= 100 ){
			// 100より大きい場合は☆数表示あり
			var img = d_7.createElement("img");
			img.style.position = "absolute";

			img.style.left = x;
			var t = (y.substr(0,y.length-2));

			img.name = "viewIcon";

			if( viewSize == 15 ){
				img.src = icon_cs[1][num*5+maxtype];
				img.style.zIndex = 226;
				img.style.top = (parseInt(t) + 3) + "px";
			} else if( viewSize == 20 ){
				img.src = icon_cs[2][num*5+maxtype];
				img.style.zIndex = 401;
				img.style.top = (parseInt(t) + 3) + "px";
			} else {
				img.src = icon_cs[0][num*5+maxtype];
				img.style.zIndex = 122;
				img.style.top = (parseInt(t) + 0) + "px";
			}
			rollover.parentNode.insertBefore(img, rollover.nextSibling);
		}

		if( (group_flg % 100) > 0 ){
			// カラー指定があるばあいは、枠を表示
			var img2 = d_7.createElement("img");
			img2.style.position = "absolute";

			img2.name = "viewIcon";

			var iconNo = group_flg % 100;
			if( viewSize == 15 ){
				img2.src = icon_2[iconNo];
				img2.style.width = "44px";
				img2.style.height = "44px";
				img2.style.zIndex = 226;

				if( (hosttype == "0") && (old != true) ){
					img2.style.left = x;
					img2.style.top = parseInt(y.substr(0,y.length-2)) + 2 + "px";
				}
				else{
					img2.style.left = x;
					img2.style.top = y;
				}
			} else if( viewSize == 20 ){
				img2.src = icon_2[iconNo];
				img2.style.width = "33px";
				img2.style.height = "33px";
				img2.style.zIndex = 401;

				if( (hosttype == "0") && (old != true) ){
					img2.style.left = parseInt(x.substr(0,x.length-2)) + 1 + "px";
					img2.style.top = parseInt(y.substr(0,y.length-2)) + 4 + "px";
				}
				else{
					img2.style.left = x;
					img2.style.top = parseInt(y.substr(0,y.length-2)) + 1 + "px";
				}
			} else {
				img2.src = icon_2[iconNo];
				img2.style.width = "60px";
				img2.style.height = "60px";
				img2.style.zIndex = 122;

				if( (hosttype == "0") && (old != true) ){
					img2.style.left = parseInt(x.substr(0,x.length-2)) + 1 + "px";
					img2.style.top = parseInt(y.substr(0,y.length-2)) + 2 + "px";
				}
				else{
					img2.style.left = x;
					img2.style.top = y;
				}
			}
			rollover.parentNode.insertBefore(img2, rollover.nextSibling);
		}
		if( Math.floor(group_flg / 1000) > 0 ){
			// 強調指定があるばあいは、強調★を表示
			var img3 = d_7.createElement("img");
			img3.style.position = "absolute";

			img3.style.left = x;
			var t = (y.substr(0,y.length-2));

			img3.name = "viewIcon";

			var pow = Math.floor(group_flg / 1000) - 1;
			if( viewSize == 15 ){
				img3.src = icon_3[pow*3+2];
				img3.style.width = "44px";
				img3.style.height = "44px";
				img3.style.zIndex = 227;
				img3.style.top = (parseInt(t) + 3) + "px";
			} else if( viewSize == 20 ){
				img3.src = icon_3[pow*3+1];
				img3.style.width = "33px";
				img3.style.height = "33px";
				img3.style.zIndex = 402;
				img3.style.top = (parseInt(t) + 3) + "px";
			} else {
				img3.src = icon_3[pow*3+3];
				img3.style.width = "60px";
				img3.style.height = "60px";
				img3.style.zIndex = 123;
				img3.style.top = (parseInt(t) + 0) + "px";
			}
			rollover.parentNode.insertBefore(img3, rollover.nextSibling);
		}
	}
	
}

//--------------//
// データロード //
//--------------//
function loadExecFlag(hostname, key) {
	var datakey = new String();
	datakey = hostname + VERSION_KEY + key;

	var ret = new String();
	var src = CookieRead(datakey);
	if (src == "") return ret;

	return src;
}

//--------------//
// データセーブ //
//--------------//
function saveExecFlag(hostname, key, data) {

	var datakey = new String();
	datakey = hostname + VERSION_KEY + key;

	CookieWrite(datakey, data, 30);
}

//----------------------//
// クッキーへの書き込み //
//----------------------//
function CookieWrite(kword, kdata, kday)
{
	if(!navigator.cookieEnabled){    // クッキーが利用可能かどうか
		alert("クッキーへの書き込みができません");
		return;
	}

	sday = new Date();
	sday.setTime(sday.getTime() + (kday * 1000 * 60 * 60 * 24));
	s2day = sday.toGMTString();
	document.cookie = kword + "=" + escape(kdata) + ";expires=" + s2day;
}

//----------------------//
// クッキーから読み込み //
//----------------------//
function CookieRead(kword)
{
	if(typeof(kword) == "undefined"){	// キーワードなし
		return "";	// 何もしないで戻る
	}

	kword = kword + "=";
	kdata = "";
	scookie = document.cookie + ";";	// クッキー情報を読み込む
	start = scookie.indexOf(kword);		// キーワードを検索
	if (start != -1){
		// キーワードと一致するものあり
		end = scookie.indexOf(";", start);	// 情報の末尾位置を検索
		kdata = unescape(scookie.substring(start + kword.length, end));	// データ取り出し
	}

	return kdata;
}

//------------//
// HTMLの生成 //
//------------//
function addHtml_7() {
	var dv;
	var dv2;

	var body = $e_7('//body');
	if( body.snapshotLength > 0 ){
		body.snapshotItem(0).addEventListener("mousedown", function(e) {if(e.button == 2){checkData(e);}}, true);
		body.snapshotItem(0).innerHTML = body.snapshotItem(0).innerHTML.replace(/\u2028/g," ");
	}

	//----------------//
	// コンテナの取得 //
	//----------------//
	var container;
	var mapbox = $e_7('//*[@id="mapboxInner"]');
	if (mapbox.snapshotLength == 0) {
		container = document.body;
	} else {
		container = mapbox.snapshotItem(0);
	}
	
	//--------------------------------------//
	// チェックボックスに関する情報をロード //
	//--------------------------------------//
	var chkflg1;
	var chkflg2;
	execFlag = loadExecFlag(location.hostname, "FLAG0");
	if( execFlag == "" ){
		// 表示フラグをロード
		var execFlag1 = loadExecFlag(location.hostname, "FLAG1");
		if( execFlag1 == "" ){
			chkflg1 = new String(FLAG1);  // 初期値
		}
		else{
			chkflg1 = execFlag1;
		}

		// オプションフラグをロード
		var execFlag2 = loadExecFlag(location.hostname, "FLAG2");
		if( execFlag2 == "" ){
			chkflg2 = new String(FLAG2);  // 初期値
		}
		else{
			chkflg2 = execFlag2;
		}

		// 初回のときは、フラグを保存
		execFlag = chkflg1 + DELIMIT1_7 + chkflg2;
		saveExecFlag(location.hostname, "FLAG0", execFlag);
	}
	else{
		var loadflg = new Array();
		loadflg = execFlag.split(DELIMIT1_7);
		chkflg1 = loadflg[0];
		chkflg2 = loadflg[1];
	}

	// 個人、同盟検索情報をロード
	var chkflg3 = new Array();
	var execFlag = loadExecFlag(location.hostname, "FLAG3");
	if( execFlag == "" ){
		var execFlag3 = loadExecFlag(location.hostname, "FLAG3-1");
		if( execFlag3 == "" ){
			chkflg3[0] = new String(FLAG3_1);  // 初期値
		}
		else{
			chkflg3[0] = execFlag3;
		}
		execFlag3 = loadExecFlag(location.hostname, "FLAG3-2");
		if( execFlag3 == "" ){
			chkflg3[1] = new String(FLAG3_2);  // 初期値
		}
		else{
			chkflg3[1] = execFlag3;
		}
		execFlag3 = loadExecFlag(location.hostname, "FLAG3-3");
		if( execFlag3 == "" ){
			chkflg3[2] = new String(FLAG3_3);  // 初期値
		}
		else{
			chkflg3[2] = execFlag3;
		}

		// 初回のときは、フラグを保存
		execFlag = chkflg3[0] + DELIMIT1_7 + chkflg3[1] + DELIMIT1_7 + chkflg3[2];
		saveExecFlag(location.hostname, "FLAG3", execFlag);
	}
	else{
		chkflg3 = execFlag.split(DELIMIT1_7);
	}

	// 出兵情報共有設定
	var chkflg4;
	execFlag = loadExecFlag(location.hostname, "FLAG4");
	if( execFlag == "" ){
		chkflg4 = new String(FLAG4);  // 初期値

		// 初回のときは、フラグを保存
		execFlag = chkflg4;
		saveExecFlag(location.hostname, "FLAG4", execFlag);
	}
	else{
		chkflg4 = execFlag;
	}

	//--------------------------------------//
	// 画面生成                             //
	//--------------------------------------//
	var textLabel;
	var button1;
	var textArea;

	//----------------//
	//-- ヘッダー部 --//
	//----------------//
	//-- コントロール配置DIV --//
	var linksDiv = document.createElement("div");
	container.appendChild(linksDiv);

	//-- ツール名称ラベル --//
	textLabel = document.createElement("span");
	textLabel.id = "toolLabel";
	textLabel.style.fontSize = "16px";
	textLabel.innerHTML = "<br><b>NPC砦、領土情報検索ツール Ver." + VERSION_7 + "</b>";
	textLabel.style.color = "black";
	linksDiv.appendChild(textLabel);

	//-- 更新ボタン --//
	button1 = document.createElement("input");
	button1.type = "button";
	button1.id = "ckButton1";
	button1.style.fontSize = "12px";
	button1.style.marginLeft = "6px";
	button1.value = "選択した条件で表示を更新";
	button1.addEventListener("click", function() {updateButtonClicked()}, true);
	linksDiv.appendChild(button1);

	//-- ★セットボタン --//
	button1 = document.createElement("input");
	button1.type = "button";
	button1.id = "ckButton2a";
	button1.style.fontSize = "12px";
	button1.style.marginLeft = "6px";
	button1.value = "★のチェックを付ける";
	button1.addEventListener("click", function() {checkButtonClicked()}, true);
	linksDiv.appendChild(button1);

	//-- ★解除ボタン --//
	button1 = document.createElement("input");
	button1.type = "button";
	button1.id = "ckButton2";
	button1.style.fontSize = "12px";
	button1.style.marginLeft = "6px";
	button1.value = "★のチェックを外す";
	button1.addEventListener("click", function() {uncheckButtonClicked()}, true);
	linksDiv.appendChild(button1);

	//-- (改行) --//
	textLabel = document.createElement("span");
	textLabel.innerHTML = "<br>";
	linksDiv.appendChild(textLabel);

	//--------------------//
	//-- 検索オプション --//
	//--------------------//
	var checkbox;
	var ckLabel;
	var userBox;
	var listbox;
	var colorNo;
	var areaNo;
	var img;

	var optionPre = document.createElement("pre");
	optionPre.style.fontSize = "14px";
	optionPre.style.color = "black";
	optionPre.style.backgroundColor = "#ffffcc";
	optionPre.style.width = "750px";
	optionPre.style.height = "100%";
	optionPre.style.border = "solid 2px";
	optionPre.style.padding = "2px";
	optionPre.style.marginTop = "2px";
	linksDiv.appendChild(optionPre);

	//-- 検索・表示オプション見出し --//
	textLabel = document.createElement("span");
	textLabel.style.fontSize = "14px";
	textLabel.id = "test";
	textLabel.innerHTML = "<font color=\"red\"><b>検索対象</b></font>";
	optionPre.appendChild(textLabel);

	chkbox = document.createElement("input");
	chkbox.type = "checkbox";
	chkbox.id = "ckMenu2";
	chkbox.style.marginLeft = "400px";
	if( chkflg2.charAt(FLAG2_MENU2) == '1' ){
		chkbox.checked = true;
	}
	chkbox.addEventListener("click", function() {menu2Clicked()}, true);
	optionPre.appendChild(chkbox);

	// 補助オプション表示切り替え
	textLabel = document.createElement("span");
	textLabel.style.marginLeft = "4px";
	textLabel.style.fontSize = "14px";
	textLabel.innerHTML = "<font color=\"blue\"><b>補助OPTION表示</b></font>";
	optionPre.appendChild(textLabel);

	chkbox = document.createElement("input");
	chkbox.type = "checkbox";
	chkbox.id = "ckMenu4";
	chkbox.style.marginLeft = "14px";
	if( chkflg2.charAt(FLAG2_MENU4) == '1' ){
		chkbox.checked = true;
	}
	chkbox.addEventListener("click", function() {menu4Clicked()}, true);
	optionPre.appendChild(chkbox);

	// 同盟オプション表示切り替え
	textLabel = document.createElement("span");
	textLabel.style.marginLeft = "4px";
	textLabel.style.fontSize = "14px";
	textLabel.innerHTML = "<font color=\"blue\"><b>同盟OPTION表示</b></font><br>";
	optionPre.appendChild(textLabel);

	// 空き地検索
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckEmpty";
	chkbox.style.marginLeft = "15px";
	if( chkflg2.charAt(FLAG2_EMPTY) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "空き地検索";
	optionPre.appendChild(ckLabel);

	// 領土検索
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckLand";
	chkbox.style.marginLeft = "15px";
	if( chkflg2.charAt(FLAG2_LAND) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "領土検索";
	optionPre.appendChild(ckLabel);

	//-- ルート構築モード --//
	// ルート構築モードチェックボックス
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckRouteMode";
	chkbox.style.marginLeft = "15px";
	chkbox.addEventListener("click", function() {routeModeChecked()}, true);
//	if( chkflg5.charAt(FLAG5_ROUTE_MODE) == '1' ){
//		chkbox.checked = true;
//	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "<font color=\"green\"><b>ルート構築モード（</b></font>";
	optionPre.appendChild(ckLabel);

	// 資源情報出力なしチェックボックス
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckRouteMode2";
//	if( chkflg5.charAt(FLAG5_PUT_RESOURCE) == '1' ){
//		chkbox.checked = true;
//	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "<font color=\"green\"><b>資源情報なし</b></font>";
	optionPre.appendChild(ckLabel);

	// 自動ルート構築チェックボックス
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.style.marginLeft = "14px";
	chkbox.type = "checkbox";
	chkbox.id = "ckAutoRouteMode";
	chkbox.addEventListener("click", function() {autoRouteModeChecked()}, true);
//	if( chkflg5.charAt(FLAG5_AUTO_MODE) == '1' ){
//		chkbox.checked = true;
//	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "<font color=\"green\"><b>ルート自動構築）</b></font>";
	optionPre.appendChild(ckLabel);

	// （ギャップ埋め）
	ckLabel = document.createElement("pre");
	ckLabel.style.height = "2px";
	optionPre.appendChild(ckLabel);

	//-- ルート自動構築オプション見出し --//
	textLabel = document.createElement("pre");
	textLabel.style.fontSize = "14px";
	textLabel.style.marginTop = "2px";
	textLabel.innerHTML = "<font color=\"green\"><b>ルート自動構築条件設定</b></font><br>";
	optionPre.appendChild(textLabel);

	// 探査レベル
	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "15px";
	ckLabel.innerHTML = "探索レベル";
	optionPre.appendChild(ckLabel);

	areaNo = parseInt(chkflg2.charAt(FLAG2_SEARCH_LEVEL));
	listbox = document.createElement("select");
	listbox.id = "lsRouteLevel";
	for( var i = 0; i < croutename.length; i++ ){
		var opt = document.createElement("option");
		opt.id = i;
		var str = document.createTextNode(croutename[i]);
		opt.appendChild(str);
		listbox.appendChild(opt);
	}
	listbox.style.marginLeft = "4px";
	listbox.selectedIndex = areaNo;
	optionPre.appendChild(listbox);

	// 資源回避レベル
	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "14px";
	ckLabel.innerHTML = "回避資源";
	optionPre.appendChild(ckLabel);

	areaNo = parseInt(chkflg2.charAt(FLAG2_SKIP_RES));
	listbox = document.createElement("select");
	listbox.id = "lsSkipRes";
	for( var i = 0; i < croutelim.length; i++ ){
		var opt = document.createElement("option");
		opt.id = i;
		var str = document.createTextNode(croutelim[i]);
		opt.appendChild(str);
		listbox.appendChild(opt);
	}
	listbox.style.marginLeft = "4px";
	listbox.selectedIndex = areaNo;
	optionPre.appendChild(listbox);

	// 個人領土回避
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckRouteUser";
	chkbox.style.marginLeft = "14px";
	if( chkflg2.charAt(FLAG2_SKIP_USER) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "個人領地を通過（";
	optionPre.appendChild(ckLabel);

	// 通過同盟指定
	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "個人・同盟";
	optionPre.appendChild(ckLabel);

	areaNo = parseInt(chkflg2.charAt(FLAG2_SKIP_GROUP));
	listbox = document.createElement("select");
	listbox.id = "lsSkipGroup";
	for( var i = 0; i < groupname.length; i++ ){
		var opt = document.createElement("option");
		opt.id = i;
		var str = document.createTextNode(groupname[i]);
		opt.appendChild(str);
		listbox.appendChild(opt);
	}
	listbox.style.marginLeft = "4px";
	listbox.selectedIndex = areaNo;
	optionPre.appendChild(listbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "）";
	optionPre.appendChild(ckLabel);

	// 可変ルート
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckRouteRandom";
	chkbox.style.marginLeft = "10px";
	if( chkflg2.charAt(FLAG2_RANDOM_ROUTE) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "可変ルート";
	optionPre.appendChild(ckLabel);

	// （ギャップ埋め）
	ckLabel = document.createElement("pre");
	ckLabel.style.height = "2px";
	optionPre.appendChild(ckLabel);

	//-- 検索・表示オプション２見出し --//
	// 項目ラベル
	textLabel = document.createElement("pre");
	textLabel.id = "Label2-1";
	textLabel.style.fontSize = "14px";
	textLabel.innerHTML = "<font color=\"red\"><b>表示補助</b></font><br>";
	optionPre.appendChild(textLabel);

	// 資源判別
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckAnalyze";
	chkbox.style.marginLeft = "15px";
	if( chkflg2.charAt(FLAG2_ANALYZE) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "資源別に着色";
	ckLabel.id = "Label2-2";
	optionPre.appendChild(ckLabel);

	// 資源判別（強調表示）
	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "0px";
	ckLabel.innerHTML = "（強調表示";
	ckLabel.id = "Label2-3";
	optionPre.appendChild(ckLabel);

	// 強調種別選択１
	areaNo = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO,3));
	if( areaNo > season1.length ){
		areaNo = 0;
	}
	listbox = document.createElement("select");
	listbox.id = "lsArea";
	for( var i = 0; i < season1.length; i++ ){
		var opt = document.createElement("option");
		opt.id = i;
		var str = document.createTextNode(season1[i][0]);
		opt.appendChild(str);
		listbox.appendChild(opt);
	}
	listbox.style.marginLeft = "4px";
	listbox.selectedIndex = areaNo;
	optionPre.appendChild(listbox);

	// 強調種別選択２
	areaNo = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO2,3));
	if( areaNo > season1.length ){
		areaNo = 0;
	}
	listbox = document.createElement("select");
	listbox.id = "lsArea2";
	for( var i = 0; i < season1.length; i++ ){
		var opt = document.createElement("option");
		opt.id = i;
		var str = document.createTextNode(season1[i][0]);
		opt.appendChild(str);
		listbox.appendChild(opt);
	}
	listbox.style.marginLeft = "4px";
	listbox.selectedIndex = areaNo;
	optionPre.appendChild(listbox);

	// 強調種別選択３
	areaNo = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO3,3));
	if( areaNo > season1.length ){
		areaNo = 0;
	}
	listbox = document.createElement("select");
	listbox.id = "lsArea3";
	for( var i = 0; i < season1.length; i++ ){
		var opt = document.createElement("option");
		opt.id = i;
		var str = document.createTextNode(season1[i][0]);
		opt.appendChild(str);
		listbox.appendChild(opt);
	}
	listbox.style.marginLeft = "4px";
	listbox.selectedIndex = areaNo;
	optionPre.appendChild(listbox);

	// 閉じかっこ
	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "0px";
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "）<br>";
	ckLabel.id = "Label2-4";
	optionPre.appendChild(ckLabel);

	// 空き地を着色
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckEmptyDraw";
	chkbox.style.marginLeft = "15px";
	if( chkflg2.charAt(FLAG2_EMPTY_DRAW) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "空き地を着色";
	ckLabel.id = "Label2-5";
	optionPre.appendChild(ckLabel);

	// カラー選択
	colorNo = chkflg2.charAt(FLAG2_EMPTY_DRAW_COLOR);

	listbox = document.createElement("select");
	listbox.id = "lsEmptyColor";
	for( var i = 0; i < cname.length; i++ ){
		var opt = document.createElement("option");
		opt.id = i;
		var str = document.createTextNode(cname[i]);
		opt.appendChild(str);
		listbox.appendChild(opt);
	}
	listbox.style.marginLeft = "4px";
	listbox.selectedIndex = colorNo;
	optionPre.appendChild(listbox);

	// レーダー
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckRader";
	chkbox.style.marginLeft = "15px";
	if( chkflg2.charAt(FLAG2_RADER) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "縮小マップ";
	ckLabel.id = "Label2-6";
	optionPre.appendChild(ckLabel);

	// 本拠地一覧
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckOwnerList";
	chkbox.style.marginLeft = "15px";
	if( chkflg2.charAt(FLAG2_OWNER) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "本拠地一覧";
	ckLabel.id = "Label2-7";
	optionPre.appendChild(ckLabel);

	// 方位表示
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckDirection";
	chkbox.style.marginLeft = "15px";
	if( chkflg2.charAt(FLAG2_DIRECTION) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "方位表示";
	ckLabel.id = "Label2-8";
	optionPre.appendChild(ckLabel);

	// 旧マップパーツを使用
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckOldDesign";
	chkbox.style.marginLeft = "15px";
	if( chkflg2.charAt(FLAG2_OLDDESIGN) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "旧マップを使用";
	ckLabel.id = "Label2-9";
	optionPre.appendChild(ckLabel);

	// 51x51画面で本ツールを使わない
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckNoExec51";
	chkbox.style.marginLeft = "15px";
	if( chkflg2.charAt(FLAG2_NOEXEC51) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "51x51で使用しない";
	ckLabel.id = "Label2-10";
	optionPre.appendChild(ckLabel);

	//-- 表示対象オプション見出し --//
	textLabel = document.createElement("pre");
	textLabel.style.fontSize = "14px";
	textLabel.style.marginTop = "2px";
	textLabel.innerHTML = "<font color=\"red\"><b>表示する領土の種類</b></font><br>";
	optionPre.appendChild(textLabel);

	// NPC砦
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckNPC";
	chkbox.style.marginLeft = "15px";
	if( chkflg1.charAt(FLAG1_NPC) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "NPC砦";
	optionPre.appendChild(ckLabel);

	// ☆1
	chkbox = document.createElement("input");
	chkbox.type = "checkbox";
	chkbox.id = "ckLevel1";
	chkbox.style.marginLeft = "10px";
	if( chkflg1.charAt(FLAG1_LV1) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "☆1";
	optionPre.appendChild(ckLabel);

	// ☆2
	chkbox = document.createElement("input");
	chkbox.type = "checkbox";
	chkbox.id = "ckLevel2";
	chkbox.style.marginLeft = "10px";
	if( chkflg1.charAt(FLAG1_LV2) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "☆2";
	optionPre.appendChild(ckLabel);

	// ☆3
	chkbox = document.createElement("input");
	chkbox.type = "checkbox";
	chkbox.id = "ckLevel3";
	chkbox.style.marginLeft = "10px";
	if( chkflg1.charAt(FLAG1_LV3) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "☆3";
	optionPre.appendChild(ckLabel);

	// ☆4
	chkbox = document.createElement("input");
	chkbox.type = "checkbox";
	chkbox.id = "ckLevel4";
	chkbox.style.marginLeft = "10px";
	if( chkflg1.charAt(FLAG1_LV4) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "☆4";
	optionPre.appendChild(ckLabel);

	// ☆5
	chkbox = document.createElement("input");
	chkbox.type = "checkbox";
	chkbox.id = "ckLevel5";
	chkbox.style.marginLeft = "10px";
	if( chkflg1.charAt(FLAG1_LV5) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "☆5";
	optionPre.appendChild(ckLabel);

	// ☆6
	chkbox = document.createElement("input");
	chkbox.type = "checkbox";
	chkbox.id = "ckLevel6";
	chkbox.style.marginLeft = "10px";
	if( chkflg1.charAt(FLAG1_LV6) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "☆6";
	optionPre.appendChild(ckLabel);

	// ☆7
	chkbox = document.createElement("input");
	chkbox.type = "checkbox";
	chkbox.id = "ckLevel7";
	chkbox.style.marginLeft = "10px";
	if( chkflg1.charAt(FLAG1_LV7) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "☆7";
	optionPre.appendChild(ckLabel);

	// ☆8
	chkbox = document.createElement("input");
	chkbox.type = "checkbox";
	chkbox.id = "ckLevel8";
	chkbox.style.marginLeft = "10px";
	if( chkflg1.charAt(FLAG1_LV8) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "☆8";
	optionPre.appendChild(ckLabel);

	// ☆9
	chkbox = document.createElement("input");
	chkbox.type = "checkbox";
	chkbox.id = "ckLevel9";
	chkbox.style.marginLeft = "10px";
	if( chkflg1.charAt(FLAG1_LV9) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "☆9<br>";
	optionPre.appendChild(ckLabel);

	// （ギャップ埋め）
	ckLabel = document.createElement("pre");
	ckLabel.style.height = "2px";
	optionPre.appendChild(ckLabel);

	//-- 個人・同盟検索オプション見出し --//
	textLabel = document.createElement("pre");
	textLabel.style.fontSize = "14px";
	textLabel.innerHTML = "<font color=\"red\"><b>個人・同盟の検索</b></font><br>";
	textLabel.id = "Label4-1";
	optionPre.appendChild(textLabel);

	//-- 個人・同盟検索オプション１ --//
	// ナンバリング
	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "<font color='blue'><b>No.1</b></font>";
	ckLabel.style.marginLeft = "15px";
	ckLabel.id = "Label4-2-1";
	optionPre.appendChild(ckLabel);

	// 有効/無効
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckEnable1";
	chkbox.style.marginLeft = "8px";
	if( chkflg3[0].charAt(FLAG3_ENABLE) == '1' ){
		chkbox.checked = true;
	}
	chkbox.addEventListener("click", function() {enable1Checked()}, true);
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "有効にする";
	ckLabel.id = "Label4-2";
	optionPre.appendChild(ckLabel);

	// 個人
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "radio";
	chkbox.id = "ckType1";
	chkbox.name = "ckType1";
	chkbox.value = "1";
	chkbox.style.marginLeft = "8px";
	if( chkflg3[0].charAt(FLAG3_USER) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "個人";
	ckLabel.id = "Label4-3";
	optionPre.appendChild(ckLabel);

	// 同盟
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "radio";
	chkbox.id = "ckType1";
	chkbox.name = "ckType1";
	chkbox.value = "2";
	chkbox.style.marginLeft = "4px";
	if( chkflg3[0].charAt(FLAG3_GROUP) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "同盟";
	ckLabel.id = "Label4-4";
	optionPre.appendChild(ckLabel);

	// 完全一致
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckFullMatch1";
	chkbox.style.marginLeft = "8px";
	if( chkflg3[0].charAt(FLAG3_MATCH) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "完全一致";
	ckLabel.id = "Label4-5";
	optionPre.appendChild(ckLabel);

	// 個人・同盟名
	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "8px";
	ckLabel.innerHTML = "検索名称";
	ckLabel.id = "Label4-6";
	optionPre.appendChild(ckLabel);

	userBox = document.createElement("input");
	userBox.id = "userBox1";
	userBox.style.marginLeft = "4px";
	userBox.width = 240;
	if( chkflg3[0].charAt(FLAG3_ENABLE) == '1' ){
		userBox.disabled = false;
	}
	else{
		userBox.disabled = true;
	}
	userBox.value = chkflg3[0].substr(FLAG3_NAME);
	userBox.href = "javascript:void(0);";
	optionPre.appendChild(userBox);

	// 表示種別での絞り込み
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckLevelSearch1";
	chkbox.style.marginLeft = "8px";
	if( chkflg3[0].charAt(FLAG3_FILL) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "領土着色のみ";
	ckLabel.id = "Label4-7";
	optionPre.appendChild(ckLabel);

	// カラー選択
	ckLabel = document.createElement("span");
	ckLabel.style.marginTop = "1px";
	ckLabel.style.marginLeft = "8px";
	ckLabel.innerHTML = "枠色";
	ckLabel.id = "Label4-8";
	optionPre.appendChild(ckLabel);

	colorNo = chkflg3[0].charAt(FLAG3_COLOR);

	listbox = document.createElement("select");
	listbox.id = "lsColor1";
	for( var i = 0; i < cname.length; i++ ){
		var opt = document.createElement("option");
		opt.id = i;
		var str = document.createTextNode(cname[i]);
		opt.appendChild(str);
		listbox.appendChild(opt);
	}
	listbox.style.marginLeft = "4px";
	listbox.selectedIndex = colorNo;
	optionPre.appendChild(listbox);

	// (改行)
	textLabel = document.createElement("span");
	textLabel.innerHTML = "<br>";
	textLabel.id = "Label4-9";
	optionPre.appendChild(textLabel);

	//-- 個人・同盟検索オプション２ --//
	// ナンバリング
	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "<font color='blue'><b>No.2</b></font>";
	ckLabel.style.marginLeft = "15px";
	ckLabel.id = "Label4-2-2";
	optionPre.appendChild(ckLabel);

	// 有効/無効
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckEnable2";
	chkbox.style.marginLeft = "8px";
	if( chkflg3[1].charAt(FLAG3_ENABLE) == '1' ){
		chkbox.checked = true;
	}
	chkbox.addEventListener("click", function() {enable2Checked()}, true);
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "有効にする";
	ckLabel.id = "Label4-10";
	optionPre.appendChild(ckLabel);

	// 個人
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "radio";
	chkbox.id = "ckType2";
	chkbox.name = "ckType2";
	chkbox.value = "1";
	chkbox.style.marginLeft = "8px";
	if( chkflg3[1].charAt(FLAG3_USER) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "個人";
	ckLabel.id = "Label4-11";
	optionPre.appendChild(ckLabel);

	// 同盟
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "radio";
	chkbox.id = "ckType2";
	chkbox.name = "ckType2";
	chkbox.value = "2";
	chkbox.style.marginLeft = "4px";
	if( chkflg3[1].charAt(FLAG3_GROUP) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "同盟";
	ckLabel.id = "Label4-12";
	optionPre.appendChild(ckLabel);

	// 完全一致
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckFullMatch2";
	chkbox.style.marginLeft = "8px";
	if( chkflg3[1].charAt(FLAG3_MATCH) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "完全一致";
	ckLabel.id = "Label4-13";
	optionPre.appendChild(ckLabel);

	// 個人・同盟名
	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "8px";
	ckLabel.innerHTML = "検索名称";
	ckLabel.id = "Label4-14";
	optionPre.appendChild(ckLabel);

	userBox = document.createElement("input");
	userBox.id = "userBox2";
	userBox.style.marginLeft = "4px";
	userBox.width = 240;
	if( chkflg3[1].charAt(FLAG3_ENABLE) == '1' ){
		userBox.disabled = false;
	}
	else{
		userBox.disabled = true;
	}
	userBox.value = chkflg3[1].substr(FLAG3_NAME);
	userBox.href = "javascript:void(0);";
	optionPre.appendChild(userBox);

	// 表示種別での絞り込み
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckLevelSearch2";
	chkbox.style.marginLeft = "8px";
	if( chkflg3[1].charAt(FLAG3_FILL) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "領土着色のみ";
	ckLabel.id = "Label4-15";
	optionPre.appendChild(ckLabel);

	// カラー選択
	ckLabel = document.createElement("span");
	ckLabel.style.marginTop = "1px";
	ckLabel.style.marginLeft = "8px";
	ckLabel.innerHTML = "枠色";
	ckLabel.id = "Label4-16";
	optionPre.appendChild(ckLabel);

	colorNo = chkflg3[1].charAt(FLAG3_COLOR);

	listbox = document.createElement("select");
	listbox.id = "lsColor2";
	for( var i = 0; i < cname.length; i++ ){
		var opt = document.createElement("option");
		opt.id = i;
		var str = document.createTextNode(cname[i]);
		opt.appendChild(str);
		listbox.appendChild(opt);
	}
	listbox.style.marginLeft = "4px";
	listbox.selectedIndex = colorNo;
	optionPre.appendChild(listbox);

	// (改行)
	textLabel = document.createElement("span");
	textLabel.innerHTML = "<br>";
	textLabel.id = "Label4-17";
	optionPre.appendChild(textLabel);

	//-- 個人・同盟検索オプション３ --//
	// ナンバリング
	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "<font color='blue'><b>No.3</b></font>";
	ckLabel.style.marginLeft = "15px";
	ckLabel.id = "Label4-2-3";
	optionPre.appendChild(ckLabel);

	// 有効/無効
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckEnable3";
	chkbox.style.marginLeft = "8px";
	if( chkflg3[2].charAt(FLAG3_ENABLE) == '1' ){
		chkbox.checked = true;
	}
	chkbox.addEventListener("click", function() {enable3Checked()}, true);
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "有効にする";
	ckLabel.id = "Label4-18";
	optionPre.appendChild(ckLabel);

	// 個人
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "radio";
	chkbox.id = "ckType3";
	chkbox.name = "ckType3";
	chkbox.value = "1";
	chkbox.style.marginLeft = "8px";
	if( chkflg3[2].charAt(FLAG3_USER) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "個人";
	ckLabel.id = "Label4-19";
	optionPre.appendChild(ckLabel);

	// 同盟
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "radio";
	chkbox.id = "ckType3";
	chkbox.name = "ckType3";
	chkbox.value = "2";
	chkbox.style.marginLeft = "4px";
	if( chkflg3[2].charAt(FLAG3_GROUP) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "同盟";
	ckLabel.id = "Label4-20";
	optionPre.appendChild(ckLabel);

	// 完全一致
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckFullMatch3";
	chkbox.style.marginLeft = "8px";
	if( chkflg3[2].charAt(FLAG3_MATCH) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "完全一致";
	ckLabel.id = "Label4-21";
	optionPre.appendChild(ckLabel);

	// 個人・同盟名
	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "8px";
	ckLabel.innerHTML = "検索名称";
	ckLabel.id = "Label4-22";
	optionPre.appendChild(ckLabel);

	userBox = document.createElement("input");
	userBox.id = "userBox3";
	userBox.style.marginLeft = "4px";
	userBox.width = 240;
	if( chkflg3[2].charAt(FLAG3_ENABLE) == '1' ){
		userBox.disabled = false;
	}
	else{
		userBox.disabled = true;
	}
	userBox.value = chkflg3[2].substr(FLAG3_NAME);
	userBox.href = "javascript:void(0);";
	optionPre.appendChild(userBox);

	// 表示種別での絞り込み
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckLevelSearch3";
	chkbox.style.marginLeft = "8px";
	if( chkflg3[2].charAt(FLAG3_FILL) == '1' ){
		chkbox.checked = true;
	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "領土着色のみ";
	ckLabel.id = "Label4-23";
	optionPre.appendChild(ckLabel);

	// カラー選択
	ckLabel = document.createElement("span");
	ckLabel.style.marginTop = "1px";
	ckLabel.style.marginLeft = "8px";
	ckLabel.innerHTML = "枠色";
	ckLabel.id = "Label4-24";
	optionPre.appendChild(ckLabel);

	colorNo = chkflg3[2].charAt(FLAG3_COLOR);

	listbox = document.createElement("select");
	listbox.id = "lsColor3";
	for( var i = 0; i < cname.length; i++ ){
		var opt = document.createElement("option");
		opt.id = i;
		var str = document.createTextNode(cname[i]);
		opt.appendChild(str);
		listbox.appendChild(opt);
	}
	listbox.style.marginLeft = "4px";
	listbox.selectedIndex = colorNo;
	optionPre.appendChild(listbox);

	// （ギャップ埋め）
	ckLabel = document.createElement("pre");
	ckLabel.style.height = "2px";
	optionPre.appendChild(ckLabel);

	//-- 出兵情報共有見出し --//
	textLabel = document.createElement("pre");
	textLabel.style.fontSize = "14px";
	textLabel.style.marginTop = "2px";
	textLabel.innerHTML = "<font color=\"green\"><b>出兵情報共有設定</b></font><br>";
//other	if( browserType == "Chrome" ){
//		textLabel.style.display = "none";
//	}
	optionPre.appendChild(textLabel);

	// 共有フラグ
	chkbox = document.createElement("input");
	chkbox.style.marginTop = "1px";
	chkbox.type = "checkbox";
	chkbox.id = "ckUnion";
	chkbox.style.marginLeft = "14px";
	if( chkflg4.charAt(0) == '1' ){
		chkbox.checked = true;
	}
	chkbox.addEventListener("click", function() {attackIconClear()}, true);
//other	if( browserType == "Chrome" ){
//		chkbox.style.display = "none";
//	}
	optionPre.appendChild(chkbox);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "有効";
//other	if( browserType == "Chrome" ){
//		ckLabel.style.display = "none";
//	}
	optionPre.appendChild(ckLabel);

	// シート名
	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "8px";
	ckLabel.innerHTML = "スプレッドシートURL";
	ckLabel.id = "Label5-1";
//other	if( browserType == "Chrome" ){
//		ckLabel.style.display = "none";
//	}
	optionPre.appendChild(ckLabel);

	userBox = document.createElement("input");
	userBox.id = "userBox4";
	userBox.style.marginLeft = "4px";
	userBox.style.width = "500px";
	userBox.value = chkflg4.substr(1);
	userBox.href = "javascript:void(0);";
//other	if( browserType == "Chrome" ){
//		userBox.style.display = "none";
//	}
	optionPre.appendChild(userBox);

	// スプレッドシート名の加工
	if( chkflg4.charAt(0) == '1' ){
		spreadsheet = userBox.value.replace(/#gid/,"&gid") + "&output=txt";
	}

	// （ギャップ埋め）
	ckLabel = document.createElement("pre");
	ckLabel.style.height = "2px";
	optionPre.appendChild(ckLabel);

	//----------------------------//
	// 検索結果のテキスト表示領域 //
	//----------------------------//
	textArea = document.createElement("pre");
	textArea.id = "castleInfoText";
	textArea.innerHTML = "";
	textArea.style.fontSize = "14px";
	textArea.style.color = "black";
	textArea.style.backgroundColor = "#FFDEAD";
	textArea.style.width = "750px";
	textArea.style.height = "120px";
	textArea.style.overflow = "auto";
	textArea.style.border = "solid 2px";
	textArea.style.padding = "2px";
	textArea.style.marginTop = "-2px";
	linksDiv.appendChild(textArea);

	//------------------//
	// 部品描画先の設定 //
	//------------------//
	var target;
	if( $d("datas") == undefined ){
		target = "change-map-scale";
	}
	else{
		target = "datas";
	}

	//--------------//
	// ホスト名判別 //
	//--------------//
	var hosttype = location.hostname.substr(0,1);

	//----------------------------//
	// 縮小マップ描画エリアの定義 //
	//----------------------------//
	dv2 = d_7.createElement("div");
	dv2.style.display = "none";
	dv2.style.zIndex = 0;
	dv2.id = "smallmap_dv";
	dv2.style.fontSize= "10px";

	// データ描画用
	textArea = document.createElement("div");
	textArea.id = "smallmap";
	textArea.style.width = "66px";
	textArea.style.height = "66px";
	textArea.innerHTML = "";
	textArea.style.color = "black";
	textArea.innerHTML = "";
	textArea.style.borderTop = "solid white 2px";
	textArea.style.borderLeft = "solid white 2px";
	textArea.style.borderRight = "solid white 1px";
	textArea.style.borderBottom = "solid white 1px";
	// 51x51モードがある鯖
	if( hosttype == "m" ){
		textArea.style.position = "absolute";
		textArea.style.top = '40px';
		textArea.style.left = '5px';
	}
	dv2.appendChild(textArea);
	$d(target).appendChild(dv2);

	//----------------------------//
	// 本拠地情報描画エリアの定義 //
	//----------------------------//
	dv = d_7.createElement("div");
	dv.style.position = "absolute";
	if( add51_51mode == 0 ){
		// 51x51モードがない鯖
		dv.style.top = '16px';
		dv.style.left = '260px';
	}
	else{
		// mixi鯖とそれ以外
		if( hosttype == "m" ){
			dv.style.top = '380px';
			dv.style.left = '400px';
		}
		else{
			dv.style.top = '420px';
			dv.style.left = '400px';
		}
	}
	dv.style.fontSize= "10px";
	dv.style.display = "none";
	dv.id = "baseinfo_dv";
	dv.style.zIndex = 500;

	// レイアウト調整用
	textArea = document.createElement("pre");
	textArea.innerHTML = "";
	textArea.style.fontSize = "10px";
	textArea.innerHTML = "";
	dv.appendChild(textArea);

	dv2 = d_7.createElement("div");
	dv2.style.border = "solid 2px";
	dv2.style.borderColor = "transparent";
	dv.appendChild(dv2);

	// データ描画用
	textArea = document.createElement("pre");
	textArea.id = "baseInfoText";
	textArea.innerHTML = "";
	textArea.style.fontSize = "10px";
	textArea.style.color = "black";
	textArea.innerHTML = "";
	textArea.style.margin = "2px";
	dv2.appendChild(textArea);
	$d(target).appendChild(dv);

	//------------------//
	// ルート構築モード //
	//------------------//
	dv2 = d_7.createElement("div");
	dv2.style.position = "absolute";
	if( add51_51mode == 0 ){
		// 51x51モードがない鯖
		dv2.style.top = "24px";
		dv2.style.left = "420px";
	}
	else{
		// 51x51モードがある鯖

		if( location.pathname != "/big_map.php" ){
			if( location.hostname.substr(0,1) == "m" ){
				dv2.style.top = "54px";
				dv2.style.left = "430px";
			}
			else{
				dv2.style.top = "61px";
				dv2.style.left = "560px";
			}
		}
		else{
			if( location.hostname.substr(0,1) == "m" ){
				dv2.style.top = "0px";
				dv2.style.left = "430px";
			}
			else{
				dv2.style.top = "0px";
				dv2.style.left = "550px";
			}
		}
	}
	dv2.style.fontSize= "10px";
	dv2.style.width = "184px";
	dv2.style.zIndex = 500;
	dv2.style.display = "none";
	dv2.id = "routeField";
	$d(target).parentNode.appendChild(dv2);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "<font color=\"blue\"><b>ルート構築ビュー</b></font>";
	dv2.appendChild(ckLabel);

	dv2 = d_7.createElement("div");
	dv2.style.position = "absolute";
	dv2.style.paddingLeft = "4px";
	if( add51_51mode == 0 ){
		// 51x51モードがない鯖
		dv2.style.top = "36px";
		dv2.style.left = "420px";
	}
	else{
		// 51x51モードがある鯖
		if( location.pathname != "/big_map.php" ){
			if( location.hostname.substr(0,1) == "m" ){
				dv2.style.top = "66px";
				dv2.style.left = "420px";
			}
			else{
				dv2.style.top = "73px";
				dv2.style.left = "560px";
			}
		}
		else{
			if( location.hostname.substr(0,1) == "m" ){
				dv2.style.top = "12px";
				dv2.style.left = "430px";
			}
			else{
				dv2.style.top = "12px";
				dv2.style.left = "550px";
			}
		}
	}
	dv2.style.fontSize= "10px";
	dv2.style.color= "blue";
	dv2.style.width = "184px";
	if( location.hostname.substr(0,1) == "m" ){
		if( location.pathname != "/big_map.php" ){
			dv2.style.height = "70px";
		}
		else{
			dv2.style.height = "55px";
		}
	}
	else{
		if( location.pathname != "/big_map.php" ){
			dv2.style.height = "90px";
		}
		else{
			dv2.style.height = "55px";
		}
	}
	dv2.style.border = "1px black solid";
	dv2.style.backgroundColor = "#FFFFCC";
	dv2.style.zIndex = 500;
	dv2.style.overflowY = "scroll";
	dv2.style.display = "none";
	dv2.id = "routeField2";
	$d(target).parentNode.appendChild(dv2);

	ckLabel = document.createElement("text");
	ckLabel.id = "routeInfoText";
	ckLabel.innerHTML = "";
	dv2.appendChild(ckLabel);

	//-- 全選択ボタン --//
	var button1 = document.createElement("input");
	button1.style.position = "absolute";
	if( add51_51mode == 0 ){
		// 51x51モードがない鯖
		button1.style.top = "128px";
		button1.style.left = "525px";
	}
	else{
		// 51x51モードがある鯖
		if( location.pathname != "/big_map.php" ){
			if( location.hostname.substr(0,1) == "m" ){
				button1.style.top = "138px";
				button1.style.left = "525px";
			}
			else{
				button1.style.top = "165px";
				button1.style.left = "665px";
			}
		}
		else{
			if( location.hostname.substr(0,1) == "m" ){
				button1.style.top = "69px";
				button1.style.left = "535px";
			}
			else{
				button1.style.top = "69px";
				button1.style.left = "655px";
			}
		}
	}
	button1.style.zIndex = 500;
	button1.type = "button";
	button1.style.fontSize = "10px";
	button1.style.marginLeft = "6px";
	button1.value = "全選択";
	button1.style.display = "none";
	button1.id = "routeField5";
	button1.addEventListener("click", function() {routeSelectButtonClicked()}, true);
	$d(target).parentNode.appendChild(button1);

	//-- クリアボタン --//
	button1 = document.createElement("input");
	button1.style.position = "absolute";
	if( add51_51mode == 0 ){
		// 51x51モードがない鯖
		button1.style.top = "128px";
		button1.style.left = "570px";
	}
	else{
		// 51x51モードがある鯖
		if( location.pathname != "/big_map.php" ){
			if( location.hostname.substr(0,1) == "m" ){
				button1.style.top = "138px";
				button1.style.left = "570px";
			}
			else{
				button1.style.top = "165px";
				button1.style.left = "710px";
			}
		}
		else{
			if( location.hostname.substr(0,1) == "m" ){
				button1.style.top = "69px";
				button1.style.left = "580px";
			}
			else{
				button1.style.top = "69px";
				button1.style.left = "700px";
			}
		}
	}
	button1.style.zIndex = 500;
	button1.type = "button";
	button1.style.fontSize = "10px";
	button1.style.marginLeft = "6px";
	button1.value = "クリア";
	button1.style.display = "none";
	button1.id = "routeField3";
	button1.addEventListener("click", function() {routeClearButtonClicked()}, true);
	$d(target).parentNode.appendChild(button1);

	// インフォメーションエリア
	dv2 = d_7.createElement("div");
	dv2.style.position = "absolute";
	if( location.pathname != "/big_map.php" ){
		dv2.style.top = "450px";
		dv2.style.left = "145px";
	}
	else{
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "90px";
			dv2.style.left = "430px";
		}
		else{
			dv2.style.top = "90px";
			dv2.style.left = "550px";
		}
	}
	dv2.style.width = "500px";
	dv2.style.zIndex = 500;
	dv2.id = "route_info";
	dv2.innerHTML = '';
	$d(target).parentNode.appendChild(dv2);

	//--------------//
	// メニュー制御 //
	//--------------//
	menu2Clicked();
	menu4Clicked();
}

//----------------//
// ルート構築処理 //
//----------------//
function checkData(e){
	var rollover = $d("rollover");
	var checkBox = $e_7('//*[@id="ckRouteMode"]');
	var checkBox2 = $e_7('//*[@id="ckRouteMode2"]');
	var checkBox3 = $e_7('//*[@id="ckAutoRouteMode"]');
	var baseText = $e_7('//*[@id="routeInfoText"]');

	//------------------//
	// 画面サイズの取得 //
	//------------------//
	var viewSize;
	viewSize = getViewSize();
	var enf = true;
	if( checkBox.snapshotLength > 0 ){
		// ルート構築モードがON
		if( checkBox.snapshotItem(0).checked == true ){
			// ルート構築モード
			enf = false;

			if( viewSize == 51 ){
				// 51x51モードの場合、他とは違う処理をする
				var elem;
				var elemhtml = "";

				// マウス直下の情報を取得
				var el = document.elementFromPoint(e.clientX, e.clientY);
				if( el != undefined ){
					if( el.tagName == "A" ){
						elem = el.parentNode;
					}
					else if( el.tagName == "FONT" ){
						elem = el.parentNode.parentNode.parentNode;
					}
					else{
						return;
					}
					elemhtml = elem.innerHTML;
				}

				// 自動構築モードがOFF
				if( checkBox3.snapshotItem(0).checked == false ){
					alert("51x51画面では、自動ルート構築のみ実施可能です。\n自動ルート構築をチェックしてください。");

					return;
				}

				var list2 = elemhtml.match(/x=([-]*\d+)&amp;y=([-]*\d+)#/);
				if( (list2 != null) && (list2 != undefined) ){
					// クリックタイミングにより取れない場合は飛ばすため

					if( (autoroute == AUTO_ROUTE_EDIT_LAST) && (autoroute_f[0] == list2[1]) && (autoroute_f[1] == list2[2]) ){
						// 終点＝始点の場合、経路情報を削除し、モードを戻す

						// 経路情報を消す
						getNPCCastleInfo_51(1);

						// モードを戻す
						autoroute = AUTO_ROUTE_EDIT_FIRST;

						// インフォメーションの更新
						autoRouteInfo();
					}
					else if( (autoroute == AUTO_ROUTE_EDIT_END) && (autoroute_l[0] == list2[1]) && (autoroute_l[1] == list2[2]) ){
						// 終了後に終点クリックの場合、始点以外を削除し、モードを戻す

						// 経路情報を消す
						getNPCCastleInfo_51(1);

						// ルートテキストをクリア
						baseText.snapshotItem(0).innerHTML = "";

						// モードを戻す
						autoroute = AUTO_ROUTE_EDIT_LAST;

						// インフォメーションの更新
						autoRouteInfo();
					}
					else{
						var newhtml;
						var vtext;

						var data = elemhtml.match(/<font.*>(.*)<\/font>/);

						// 座標の登録
						if( autoroute == AUTO_ROUTE_EDIT_FIRST ){
							autoroute_f[0] = list2[1];
							autoroute_f[1] = list2[2];
							autoroute_f[2] = data[1];

							// 表示テキスト
							vtext = "S";

							// モード変更
							autoroute = AUTO_ROUTE_EDIT_LAST;

							// インフォメーションの更新
							autoRouteInfo();
						}
						else if( autoroute == AUTO_ROUTE_EDIT_LAST ){
							autoroute_l[0] = list2[1];
							autoroute_l[1] = list2[2];
							autoroute_l[2] = data[1];

							// 表示テキスト
							vtext = "E";

							// モード変更
							autoroute = AUTO_ROUTE_EDIT_END;

							// インフォメーションの更新
							autoRouteInfo();
						}

						// テキスト設定
						if( elemhtml.indexOf("<b>") >= 0 ){
							newhtml = elemhtml.replace(/<b>.*<\/b>/,"<font style=\"text-shadow: -1px -1px 0 #FFF, 1px -1px 0 #FFF, -1px 1px 0 #FFF, 1px 1px 0 #FFF; color:red; border-style: solid; border-color: cyan; background-color:cyan;\">" + vtext + "</font>");
						}
						else{
							newhtml = elemhtml.replace(/<font.*>.*<\/font>/,"<font style=\"text-shadow: -1px -1px 0 #FFF, 1px -1px 0 #FFF, -1px 1px 0 #FFF, 1px 1px 0 #FFF; border-style: solid; border-color: cyan; color:red; background-color:cyan;\">" + vtext + "</font>");
						}

						// マークを画面上に表示
						elem.innerHTML = newhtml;

						if( autoroute == AUTO_ROUTE_EDIT_END ){
							// 始点、終点の設定がおわった

							// ルート構築チェック(引数"1"はルートチェック)
							if( makeAutoRoute_51("1") == false ){
								alert("目的地に到達するルートには到達できません。条件を見直してください。");

								// 経路情報を消す
								getNPCCastleInfo_51(1);

								// モードを戻す
								autoroute = AUTO_ROUTE_EDIT_LAST;

								// インフォメーションの更新
								autoRouteInfo();

								return;
							}


							// 確認
							if( window.confirm("この座標からルートを構築します") ){
								// ルート構築
								makeAutoRoute_51("0");
							}
							else{
								// 経路情報を消す
								getNPCCastleInfo_51(1);

								// モードを戻す
								autoroute = AUTO_ROUTE_EDIT_LAST;

								// インフォメーションの更新
								autoRouteInfo();
							}
						}
					}
				}

				// コンテキストメニュー制御
				var body = $e_7('//body');
				if( body.snapshotLength > 0 ){
					if( enf == false ){
						body.snapshotItem(0).setAttribute("onContextmenu","return false;");
					}
					else{
						body.snapshotItem(0).setAttribute("onContextmenu","return true;");
					}
				}

				return;
			}

			//---------------------------------//
			// 51x51モードでないルート構築処理 //
			//---------------------------------//
			// 自動構築モードがOFF
			if( checkBox3.snapshotItem(0).checked == false ){
				//----------------//
				// 手動ルート構築 //
				//----------------//

				var obj = $e_7('//*[@id="x_y"]');
				var obj2 = $e_7('//*[@id="power"]');
				var obj3 = $e_7('//*[@id="material"]');
				var obj4 = $e_7('//*[@id="village_name"]');
				if( obj.snapshotLength > 0 ){
					var data = obj.snapshotItem(0).textContent;
					data = data.replace(/ \/.*$/,"");
					var data2 = obj2.snapshotItem(0).textContent;
					var data3 = obj3.snapshotItem(0).textContent;
					var list = data3.match(/^. *(\d+) . *(\d+) . *(\d+) . *(\d+)/);
					var list2 = data.match(/^.([-]*\d+),([-]*\d+)/);
					if( list2 != null ){
						// クリックタイミングにより取れない場合は飛ばすため

						//----------------------//
						// クリックデータの処理 //
						//----------------------//
						// ルート構築テキストの取得
						var text = baseText.snapshotItem(0).innerHTML;

						// areaデータを取ってみる
						var area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + list2[1] + "&y=" + list2[2] + "#ptop\"]");
						if( area_pos == null ){
							area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + list2[1] + "&y=" + list2[2] + "\"]");
						}
						var list3 = area_pos.getAttribute("onmouseover").match(/'(\d+)px', '(\d+)px/);

						// すでに画像が登録されてるか調べる
						var ex = $e_7('//*[@id="' + list2[1] + '_' + list2[2] + '"]');
						if( ex.snapshotLength > 0 ){
							// 画像がいたら消す
							var ex2 = $x_7('//*[@id="' + list2[1] + '_' + list2[2] + '"]');
							var ex2_p = ex2.parentNode;
							ex2_p.removeChild(ex2);

							var fp = text.indexOf(list2[0]);
							var ep = text.indexOf("<br>",fp);
							if( ep == -1 ){
								if( fp == 0 ){
									text = text.substr(0,fp);
								}
								else{
									text = text.substr(0,fp-4);
								}
							}
							else{
								text = text.substr(0,fp) + text.substr(ep+4);
							}
							baseText.snapshotItem(0).innerHTML = text;

							// ルートチェックの再実行
							routeCheckButtonClicked();
						}
						else{
							// 画像がいなければルート追加
							var landLevel = data2.length;
							var dt = obj2.snapshotItem(0).innerHTML.match(/star_warpower_b.gif/);
							if( dt != null && dt.length > 0){
								// FaceBook Lands of Legends! 対応
								var stars = obj2.snapshotItem(0).innerHTML.match(/<img/g);
								landLevel = stars.length;
								list = data3.match(/Forest (\d+) Clay (\d+) Iron (\d+) Crop (\d+)/);
							}

							// 直前のルートからの距離を求める
							var errf = false;
							if( text != "" ){
								var p1 = text.lastIndexOf("<br>");
								var p2 = text.indexOf("×");
								var pos = new Array();
								if( p1 != -1 ){
									pos = text.substr(p1+4).match(/^\(([-]*\d+),([-]*\d+)/);
								}
								else{
									pos = text.match(/^\(([-]*\d+),([-]*\d+)/);
								}

								var dx = Math.abs(parseInt(pos[1]) - parseInt(list2[1]));
								var dy = Math.abs(parseInt(pos[2]) - parseInt(list2[2]));
								if( (dx >= 2) || (dy >= 2) || (p2 != -1) ){
									// 距離2以上か、すでに×アイコンがあればエラーアイコン
									errf = true;
								}
							}

							// テキストの更新
							if( text != "" ){
								text = text + "<br>";
							}
							if( checkBox2.snapshotItem(0).checked == false ){
								if( list != null ){
									// 資源量出力があれば領地または空き地
									text = text + data + "&nbsp;★" + landLevel + "&nbsp;(" + list[1] + "-" + list[2] + "-" + list[3] + "-" + list[4] + ")";
								}
								else{
									// 資源量出力がなければ拠点か本拠地かNPC砦
									if( landLevel == 0 ){
										// ★0なら個人の本拠地または拠点
										text = text + data + "&nbsp;個人本拠地/拠点";
									}
									else{
										// ★0以外ならNPC砦または武将砦
										text = text + data + "&nbsp;★" + landLevel + "&nbsp;(" + obj4.snapshotItem(0).textContent + ")";
									}
								}
							}
							else{
								text = text + data + "&nbsp;★" + landLevel;
							}
							if( (errf == true) && (p2 == -1) ){
								// 初回ルートエラーの場合赤×を追加
								text = text + '<b><font color="red">×</font></b>';
							}
							baseText.snapshotItem(0).innerHTML = text;

							// クリックしたポイントに画像を埋め込む
							var img = d_7.createElement("img");
							img.style.position = "absolute";

							img.style.left = list3[1] + "px";
							img.style.top = list3[2] + "px";

							// アイコンの決定
							if( errf == false ){
								img.src = ricon;
							}
							else{
								img.src = ricon_e;
							}

							if( viewSize == 15 ){
								img.style.width = "44px";
								img.style.height = "44px";
								img.style.zIndex = 227;
							} else if( viewSize == 20 ){
								img.style.width = "33px";
								img.style.height = "33px";
								img.style.zIndex = 402;
							} else {
								img.style.width = "60px";
								img.style.height = "60px";
								img.style.zIndex = 123;
							}
							img.name = "routeIcon";
							img.id = list2[1] + "_" + list2[2];	// 座標をイメージのIDにする
							rollover.parentNode.insertBefore(img, rollover.nextSibling);

							// スクロールバーを最下段に移動する
							baseText.snapshotItem(0).parentNode.scrollTop = baseText.snapshotItem(0).parentNode.scrollHeight;
						}
					}
				}
			}
			else{
				//----------------//
				// 自動ルート構築 //
				//----------------//
				var obj = $e_7('//*[@id="x_y"]');
				if( obj.snapshotLength > 0 ){
					var data = obj.snapshotItem(0).textContent;
					data = data.replace(/ \/.*$/,"");
					var list2 = data.match(/^.([-]*\d+),([-]*\d+)/);
					if( (list2 != null) && (list2 != undefined) ){
						// クリックタイミングにより取れない場合は飛ばすため

						//----------------------//
						// クリックデータの処理 //
						//----------------------//
						// areaデータを取ってみる
						var area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + list2[1] + "&y=" + list2[2] + "#ptop\"]");
						if( area_pos == null ){
							area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + list2[1] + "&y=" + list2[2] + "\"]");
						}
						var list3 = area_pos.getAttribute("onmouseover").match(/'(\d+)px', '(\d+)px/);

						var ex = $e_7('//*[@id="' + list2[1] + '_' + list2[2] + '"]');
						if( (autoroute == AUTO_ROUTE_EDIT_LAST) && (ex.snapshotLength > 0)
							&& (autoroute_f[0] == list2[1]) && (autoroute_f[1] == list2[2]) ){
							// 終点＝始点の場合、登録済み画像を削除し、モードを戻す

							// 画像がいたら消す
							var ex2 = $x_7('//*[@id="' + list2[1] + '_' + list2[2] + '"]');
							var ex2_p = ex2.parentNode;
							ex2_p.removeChild(ex2);

							// モードを戻す
							autoroute = AUTO_ROUTE_EDIT_FIRST;

							// インフォメーションの更新
							autoRouteInfo();
						}
						else if( (autoroute == AUTO_ROUTE_EDIT_END) && (ex.snapshotLength > 0)
							&& (autoroute_l[0] == list2[1]) && (autoroute_l[1] == list2[2]) ){
							// 終了後に終点クリックの場合、始点以外を削除し、モードを戻す

							// 始点以外の画像を全部消す
							var en = $e_7('//*[@name="routeIcon"]');
							if( en.snapshotLength > 0 ){
								for( var i = 0; i < en.snapshotLength; i++ ){
									if( en.snapshotItem(i).id != autoroute_f[0] + "_" + autoroute_f[1] ){
										var ex = $x_7('//*[@id="' + en.snapshotItem(i).id + '"]');
										var ex_p = ex.parentNode;
										ex_p.removeChild(ex);
									}
								}
							}

							// ルートテキストをクリア
							baseText.snapshotItem(0).innerHTML = "";

							// モードを戻す
							autoroute = AUTO_ROUTE_EDIT_LAST;

							// インフォメーションの更新
							autoRouteInfo();
						}
						else{
							// クリックしたポイントに画像を埋め込む
							var img = d_7.createElement("img");
							img.style.position = "absolute";

							img.style.left = list3[1] + "px";
							img.style.top = list3[2] + "px";

							// アイコンの決定
							if( autoroute == AUTO_ROUTE_EDIT_FIRST ){
								img.src = ricon_f;
							}
							else if( autoroute == AUTO_ROUTE_EDIT_LAST ){
								img.src = ricon_l;
							}

							if( viewSize == 15 ){
								img.style.width = "44px";
								img.style.height = "44px";
								img.style.zIndex = 227;
							} else if( viewSize == 20 ){
								img.style.width = "33px";
								img.style.height = "33px";
								img.style.zIndex = 402;
							} else {
								img.style.width = "60px";
								img.style.height = "60px";
								img.style.zIndex = 123;
							}
							img.name = "routeIcon";
							img.id = list2[1] + "_" + list2[2];	// 座標をイメージのIDにする
							rollover.parentNode.insertBefore(img, rollover.nextSibling);

							// 座標の登録
							if( autoroute == AUTO_ROUTE_EDIT_FIRST ){
								autoroute_f[0] = list2[1];
								autoroute_f[1] = list2[2];

								// モード変更
								autoroute = AUTO_ROUTE_EDIT_LAST;

								// インフォメーションの更新
								autoRouteInfo();
							}
							else if( autoroute == AUTO_ROUTE_EDIT_LAST ){
								autoroute_l[0] = list2[1];
								autoroute_l[1] = list2[2];

								// モード変更
								autoroute = AUTO_ROUTE_EDIT_END;

								// インフォメーションの更新
								autoRouteInfo();

								// ルート構築チェック(引数"1"はルートチェック)
								if( makeAutoRoute("1") == false ){
									alert("目的地に到達するルートには到達できません。条件を見直してください。");

									// 画像の削除とモードの戻し
									var ex2 = $x_7('//*[@id="' + list2[1] + '_' + list2[2] + '"]');
									var ex2_p = ex2.parentNode;
									ex2_p.removeChild(ex2);

									// モードを戻す
									autoroute = AUTO_ROUTE_EDIT_LAST;

									// インフォメーションの更新
									autoRouteInfo();

									return;
								}


								// 確認
								if( window.confirm("この座標からルートを構築します") ){
									// ルート構築
									makeAutoRoute("0");
								}
								else{
									// 画像の削除とモードの戻し
									var ex2 = $x_7('//*[@id="' + list2[1] + '_' + list2[2] + '"]');
									var ex2_p = ex2.parentNode;
									ex2_p.removeChild(ex2);

									// モードを戻す
									autoroute = AUTO_ROUTE_EDIT_LAST;

									// インフォメーションの更新
									autoRouteInfo();
								}
							}
						}
					}
				}
			}
		}
	}

	// コンテキストメニュー制御
	var body = $e_7('//body');
	if( body.snapshotLength > 0 ){
		if( enf == false ){
			body.snapshotItem(0).setAttribute("onContextmenu","return false;");
		}
		else{
			body.snapshotItem(0).setAttribute("onContextmenu","return true;");
		}
	}
}

//--------------//
// リロード処理 //
//--------------//
function reloadNext(){

	// マップに埋め込んだマーク画像を全部消す
	var rollover = $d("rollover");

	// すでに画像が登録されてるか調べる
	var en = $e_7('//*[@name="viewIcon"]');
	if( en.snapshotLength > 0 ){
		// 画像がいたら消す
		for( var i = 0; i < en.snapshotLength; i++ ){
			var ex = $x_7('//*[@name="viewIcon"]');
			var ex_p = ex.parentNode;
			ex_p.removeChild(ex);
		}
	}

	en = $e_7('//*[@name="atkIcon"]');
	if( en.snapshotLength > 0 ){
		// 画像がいたら消す
		for( var i = 0; i < en.snapshotLength; i++ ){
			var ex = $x_7('//*[@name="atkIcon"]');
			var ex_p = ex.parentNode;
			ex_p.removeChild(ex);
		}
	}

	en = $e_7('//*[@id="icon_east"]');
	if( en.snapshotLength > 0 ){
		// 画像がいたら消す
		var ex = $x_7('//*[@id="icon_east"]');
		var ex_p = ex.parentNode;
		ex_p.removeChild(ex);
	}
	en = $e_7('//*[@id="icon_west"]');
	if( en.snapshotLength > 0 ){
		// 画像がいたら消す
		var ex = $x_7('//*[@id="icon_west"]');
		var ex_p = ex.parentNode;
		ex_p.removeChild(ex);
	}
	en = $e_7('//*[@id="icon_north"]');
	if( en.snapshotLength > 0 ){
		// 画像がいたら消す
		var ex = $x_7('//*[@id="icon_north"]');
		var ex_p = ex.parentNode;
		ex_p.removeChild(ex);
	}
	en = $e_7('//*[@id="icon_south"]');
	if( en.snapshotLength > 0 ){
		// 画像がいたら消す
		var ex = $x_7('//*[@id="icon_south"]');
		var ex_p = ex.parentNode;
		ex_p.removeChild(ex);
	}

	// 画面更新
	if( getViewSize() != 51 ){
		getNPCCastleInfo();
	}
	else{
		getNPCCastleInfo_51(0);		// 0:通常再描画
	}
}

//------------------------//
// 更新ボタン押下処理処理 //
//------------------------//
function updateButtonClicked() {
	var checkbox;
	var userbox;
	var listbox;
	var colorNo;

	//--------------------------------------//
	// チェックボックスに関する情報をロード //
	//--------------------------------------//
	var chkflg1;
	var chkflg2;
	execFlag = loadExecFlag(location.hostname, "FLAG0");
	if( execFlag == "" ){
		// 表示フラグをロード
		var execFlag1 = loadExecFlag(location.hostname, "FLAG1");
		if( execFlag1 == "" ){
			chkflg1 = new String(FLAG1);  // 初期値
		}
		else{
			chkflg1 = execFlag1;
		}

		// オプションフラグをロード
		var execFlag2 = loadExecFlag(location.hostname, "FLAG2");
		if( execFlag2 == "" ){
			chkflg2 = new String(FLAG2);  // 初期値
		}
		else{
			chkflg2 = execFlag2;
		}

		// 初回のときは、フラグを保存
		execFlag = chkflg1 + DELIMIT1_7 + chkflg2;
		saveExecFlag(location.hostname, "FLAG0", execFlag);
	}
	else{
		var loadflg = new Array();
		loadflg = execFlag.split(DELIMIT1_7);
		chkflg1 = loadflg[0];
		chkflg2 = loadflg[1];
	}

	// 個人、同盟検索情報をロード
	var chkflg3 = new Array();
	var execFlag = loadExecFlag(location.hostname, "FLAG3");
	if( execFlag == "" ){
		var execFlag3 = loadExecFlag(location.hostname, "FLAG3-1");
		if( execFlag3 == "" ){
			chkflg3[0] = new String(FLAG3_1);  // 初期値
		}
		else{
			chkflg3[0] = execFlag3;
		}
		execFlag3 = loadExecFlag(location.hostname, "FLAG3-2");
		if( execFlag3 == "" ){
			chkflg3[1] = new String(FLAG3_2);  // 初期値
		}
		else{
			chkflg3[1] = execFlag3;
		}
		execFlag3 = loadExecFlag(location.hostname, "FLAG3-3");
		if( execFlag3 == "" ){
			chkflg3[2] = new String(FLAG3_3);  // 初期値
		}
		else{
			chkflg3[2] = execFlag3;
		}

		// 初回のときは、フラグを保存
		execFlag = chkflg3[0] + DELIMIT1_7 + chkflg3[1] + DELIMIT1_7 + chkflg3[2];
		saveExecFlag(location.hostname, "FLAG3", execFlag);
	}
	else{
		chkflg3 = execFlag.split(DELIMIT1_7);
	}

	var chkflg4;
	execFlag = loadExecFlag(location.hostname, "FLAG4");
	if( execFlag == "" ){
		chkflg4 = new String(FLAG4);  // 初期値

		// 初回のときは、フラグを保存
		execFlag = chkflg4;
		saveExecFlag(location.hostname, "FLAG4", execFlag);
	}
	else{
		chkflg4 = execFlag;
	}

	//--------------------//
	// 空き地検索チェック //
	//--------------------//
	checkBox = $e_7('//*[@id="ckEmpty"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = '0' + chkflg2.substr(1);
	}
	else{
		chkflg2 = '1' + chkflg2.substr(1);
	}

	//------------------//
	// 領土検索チェック //
	//------------------//
	checkBox = $e_7('//*[@id="ckLand"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = chkflg2.substr(0,1) + '0' + chkflg2.substr(2);
	}
	else{
		chkflg2 = chkflg2.substr(0,1) + '1' + chkflg2.substr(2);
	}

	//------------------//
	// 資源表示チェック //
	//------------------//
	checkBox = $e_7('//*[@id="ckAnalyze"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = chkflg2.substr(0,2) + '0' + chkflg2.substr(3);
	}
	else{
		chkflg2 = chkflg2.substr(0,2) + '1' + chkflg2.substr(3);
	}

	//----------------------//
	// レーダー表示チェック //
	//----------------------//
	checkBox = $e_7('//*[@id="ckRader"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = chkflg2.substr(0,3) + '0' + chkflg2.substr(4);
	}
	else{
		chkflg2 = chkflg2.substr(0,3) + '1' + chkflg2.substr(4);
	}

	//------------------------//
	// 本拠地一覧表示チェック //
	//------------------------//
	checkBox = $e_7('//*[@id="ckOwnerList"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = chkflg2.substr(0,4) + '0' + chkflg2.substr(5);
	}
	else{
		chkflg2 = chkflg2.substr(0,4) + '1' + chkflg2.substr(5);
	}

	//--------------------//
	// 空き地着色チェック //
	//--------------------//
	checkBox = $e_7('//*[@id="ckEmptyDraw"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = chkflg2.substr(0,5) + '0' + chkflg2.substr(6);
	}
	else{
		chkflg2 = chkflg2.substr(0,5) + '1' + chkflg2.substr(6);
	}

	// 枠色
	listBox = $e_7('//*[@id="lsEmptyColor"]');
	colorNo = listBox.snapshotItem(0).selectedIndex;
	chkflg2 = chkflg2.substr(0,6) + colorNo + chkflg2.substr(7);

	//--------------//
	// 強調表示指定 //
	//--------------//
	checkBox = $e_7('//*[@id="ckEmptyDraw"]');

	// 選択領土１
	listBox = $e_7('//*[@id="lsArea"]');
	areaNo = listBox.snapshotItem(0).selectedIndex;
	chkflg2 = chkflg2.substr(0,7) + formatRightNumber(areaNo,3) + chkflg2.substr(10);

	// 選択領土２
	listBox = $e_7('//*[@id="lsArea2"]');
	areaNo = listBox.snapshotItem(0).selectedIndex;
	chkflg2 = chkflg2.substr(0,10) + formatRightNumber(areaNo,3) + chkflg2.substr(13);

	// 選択領土３
	listBox = $e_7('//*[@id="lsArea3"]');
	areaNo = listBox.snapshotItem(0).selectedIndex;
	chkflg2 = chkflg2.substr(0,13) + formatRightNumber(areaNo,3) + chkflg2.substr(16);

	//----------------------//
	// メニュー表示チェック //
	//----------------------//
	checkBox = $e_7('//*[@id="ckMenu2"]');

	// メニュー２
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = chkflg2.substr(0,16) + '0' + chkflg2.substr(17);
	}
	else{
		chkflg2 = chkflg2.substr(0,16) + '1' + chkflg2.substr(17);
	}

	// メニュー４
	checkBox = $e_7('//*[@id="ckMenu4"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = chkflg2.substr(0,17) + '0' + chkflg2.substr(18);
	}
	else{
		chkflg2 = chkflg2.substr(0,17) + '1' + chkflg2.substr(18);
	}

	//--------------------------//
	// ルート自動構築オプション //
	//--------------------------//
	//-- ルート自動構築オプション見出し --//
	// 探査レベル
	listBox = $e_7('//*[@id="lsRouteLevel"]');
	var level = listBox.snapshotItem(0).selectedIndex;
	chkflg2 = chkflg2.substr(0,19) + level + chkflg2.substr(20);

	// 資源回避レベル
	listBox = $e_7('//*[@id="lsSkipRes"]');
	var level = listBox.snapshotItem(0).selectedIndex;
	chkflg2 = chkflg2.substr(0,20) + level + chkflg2.substr(21);

	// 個人領土回避
	checkBox = $e_7('//*[@id="ckRouteUser"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = chkflg2.substr(0,21) + '0' + chkflg2.substr(22);
	}
	else{
		chkflg2 = chkflg2.substr(0,21) + '1' + chkflg2.substr(22);
	}

	// 通過同盟指定
	listBox = $e_7('//*[@id="lsSkipGroup"]');
	var level = listBox.snapshotItem(0).selectedIndex;
	chkflg2 = chkflg2.substr(0,22) + level + chkflg2.substr(23);

	// 可変ルート
	checkBox = $e_7('//*[@id="ckRouteRandom"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = chkflg2.substr(0,23) + '0' + chkflg2.substr(24);
	}
	else{
		chkflg2 = chkflg2.substr(0,23) + '1' + chkflg2.substr(24);
	}

	//-- 表示オプション追加 --//
	// 方位表示
	checkBox = $e_7('//*[@id="ckDirection"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = chkflg2.substr(0,24) + '0' + chkflg2.substr(25);
	}
	else{
		chkflg2 = chkflg2.substr(0,24) + '1' + chkflg2.substr(25);
	}

	//-- 旧マップモード --//
	checkBox = $e_7('//*[@id="ckOldDesign"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = chkflg2.substr(0,25) + '0' + chkflg2.substr(26);
	}
	else{
		chkflg2 = chkflg2.substr(0,25) + '1' + chkflg2.substr(26);
	}

	//-- 51x51で使わない --//
	checkBox = $e_7('//*[@id="ckNoExec51"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg2 = chkflg2.substr(0,26) + '0' + chkflg2.substr(27);
	}
	else{
		chkflg2 = chkflg2.substr(0,26) + '1' + chkflg2.substr(27);
	}

	//---------------//
	// NPC砦チェック //
	//---------------//
	checkBox = $e_7('//*[@id="ckNPC"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg1 = '0' + chkflg1.substr(1);
	}
	else{
		chkflg1 = '1' + chkflg1.substr(1);
	}

	//---------------//
	// ☆1砦チェック //
	//---------------//
	checkBox = $e_7('//*[@id="ckLevel1"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg1 = chkflg1.substr(0,1) + '0' + chkflg1.substr(2);
	}
	else{
		chkflg1 = chkflg1.substr(0,1) + '1' + chkflg1.substr(2);
	}

	//---------------//
	// ☆2砦チェック //
	//---------------//
	checkBox = $e_7('//*[@id="ckLevel2"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg1 = chkflg1.substr(0,2) + '0' + chkflg1.substr(3);
	}
	else{
		chkflg1 = chkflg1.substr(0,2) + '1' + chkflg1.substr(3);
	}

	//---------------//
	// ☆3砦チェック //
	//---------------//
	checkBox = $e_7('//*[@id="ckLevel3"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg1 = chkflg1.substr(0,3) + '0' + chkflg1.substr(4);
	}
	else{
		chkflg1 = chkflg1.substr(0,3) + '1' + chkflg1.substr(4);
	}

	//---------------//
	// ☆4砦チェック //
	//---------------//
	checkBox = $e_7('//*[@id="ckLevel4"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg1 = chkflg1.substr(0,4) + '0' + chkflg1.substr(5);
	}
	else{
		chkflg1 = chkflg1.substr(0,4) + '1' + chkflg1.substr(5);
	}

	//---------------//
	// ☆5砦チェック //
	//---------------//
	checkBox = $e_7('//*[@id="ckLevel5"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg1 = chkflg1.substr(0,5) + '0' + chkflg1.substr(6);
	}
	else{
		chkflg1 = chkflg1.substr(0,5) + '1' + chkflg1.substr(6);
	}

	//---------------//
	// ☆6砦チェック //
	//---------------//
	checkBox = $e_7('//*[@id="ckLevel6"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg1 = chkflg1.substr(0,6) + '0' + chkflg1.substr(7);
	}
	else{
		chkflg1 = chkflg1.substr(0,6) + '1' + chkflg1.substr(7);
	}

	//---------------//
	// ☆7砦チェック //
	//---------------//
	checkBox = $e_7('//*[@id="ckLevel7"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg1 = chkflg1.substr(0,7) + '0' + chkflg1.substr(8);
	}
	else{
		chkflg1 = chkflg1.substr(0,7) + '1' + chkflg1.substr(8);
	}

	//---------------//
	// ☆8砦チェック //
	//---------------//
	checkBox = $e_7('//*[@id="ckLevel8"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg1 = chkflg1.substr(0,8) + '0' + chkflg1.substr(9);
	}
	else{
		chkflg1 = chkflg1.substr(0,8) + '1' + chkflg1.substr(9);
	}

	//---------------//
	// ☆9砦チェック //
	//---------------//
	checkBox = $e_7('//*[@id="ckLevel9"]');

	if( checkBox.snapshotItem(0).checked == false ){
		chkflg1 = chkflg1.substr(0,9) + '0';
	}
	else{
		chkflg1 = chkflg1.substr(0,9) + '1';
	}

	//--------------------//
	// 個人／同盟１の処理 //
	//--------------------//
	userBox = $e_7('//*[@id="userBox1"]');

	// 有効/無効
	checkBox = $e_7('//*[@id="ckEnable1"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg3[0] = '0' + chkflg3[0].substr(1);
		userBox.disabled = true;
	}
	else{
		chkflg3[0] = '1' + chkflg3[0].substr(1);
		userBox.disabled = false;
	}

	// 個人/同盟
	checkBox = $e_7('//*[@id="ckType1"]');
	if( checkBox.snapshotItem(0).checked == true ){
		// 個人
		chkflg3[0] = chkflg3[0].substr(0,1) + '10' + chkflg3[0].substr(3);
	}
	else{
		// 同盟
		chkflg3[0] = chkflg3[0].substr(0,1) + '01' + chkflg3[0].substr(3);
	}

	// 完全一致
	checkBox = $e_7('//*[@id="ckFullMatch1"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg3[0] = chkflg3[0].substr(0,3) + '0' + chkflg3[0].substr(4);
	}
	else{
		chkflg3[0] = chkflg3[0].substr(0,3) + '1' + chkflg3[0].substr(4);
	}

	// 絞り込み
	checkBox = $e_7('//*[@id="ckLevelSearch1"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg3[0] = chkflg3[0].substr(0,4) + '0' + chkflg3[0].substr(5);
	}
	else{
		chkflg3[0] = chkflg3[0].substr(0,4) + '1' + chkflg3[0].substr(5);
	}

	// ユーザー名を更新
	chkflg3[0] = chkflg3[0].substr(0,FLAG3_NAME) + userBox.snapshotItem(0).value;

	// 枠色
	listBox = $e_7('//*[@id="lsColor1"]');
	colorNo = listBox.snapshotItem(0).selectedIndex;
	chkflg3[0] = chkflg3[0].substr(0,5) + colorNo + chkflg3[0].substr(6);

	//--------------------//
	// 個人／同盟２の処理 //
	//--------------------//
	userBox = $e_7('//*[@id="userBox2"]');

	// 有効/無効
	checkBox = $e_7('//*[@id="ckEnable2"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg3[1] = '0' + chkflg3[1].substr(1);
		userBox.disabled = true;
	}
	else{
		chkflg3[1] = '1' + chkflg3[1].substr(1);
		userBox.disabled = false;
	}

	// 個人/同盟
	checkBox = $e_7('//*[@id="ckType2"]');
	if( checkBox.snapshotItem(0).checked == true ){
		// 個人
		chkflg3[1] = chkflg3[1].substr(0,1) + '10' + chkflg3[1].substr(3);
	}
	else{
		// 同盟
		chkflg3[1] = chkflg3[1].substr(0,1) + '01' + chkflg3[1].substr(3);
	}

	// 完全一致
	checkBox = $e_7('//*[@id="ckFullMatch2"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg3[1] = chkflg3[1].substr(0,3) + '0' + chkflg3[1].substr(4);
	}
	else{
		chkflg3[1] = chkflg3[1].substr(0,3) + '1' + chkflg3[1].substr(4);
	}

	// 絞り込み
	checkBox = $e_7('//*[@id="ckLevelSearch2"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg3[1] = chkflg3[1].substr(0,4) + '0' + chkflg3[1].substr(5);
	}
	else{
		chkflg3[1] = chkflg3[1].substr(0,4) + '1' + chkflg3[1].substr(5);
	}

	// ユーザー名を更新
	chkflg3[1] = chkflg3[1].substr(0,FLAG3_NAME) + userBox.snapshotItem(0).value;

	// 枠色
	listBox = $e_7('//*[@id="lsColor2"]');
	colorNo = listBox.snapshotItem(0).selectedIndex;
	chkflg3[1] = chkflg3[1].substr(0,5) + colorNo + chkflg3[1].substr(6);

	//--------------------//
	// 個人／同盟３の処理 //
	//--------------------//
	userBox = $e_7('//*[@id="userBox3"]');

	// 有効/無効
	checkBox = $e_7('//*[@id="ckEnable3"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg3[2] = '0' + chkflg3[2].substr(1);
		userBox.disabled = true;
	}
	else{
		chkflg3[2] = '1' + chkflg3[2].substr(1);
		userBox.disabled = false;
	}

	// 個人/同盟
	checkBox = $e_7('//*[@id="ckType3"]');
	if( checkBox.snapshotItem(0).checked == true ){
		// 個人
		chkflg3[2] = chkflg3[2].substr(0,1) + '10' + chkflg3[2].substr(3);
	}
	else{
		// 同盟
		chkflg3[2] = chkflg3[2].substr(0,1) + '01' + chkflg3[2].substr(3);
	}

	// 完全一致
	checkBox = $e_7('//*[@id="ckFullMatch3"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg3[2] = chkflg3[2].substr(0,3) + '0' + chkflg3[2].substr(4);
	}
	else{
		chkflg3[2] = chkflg3[2].substr(0,3) + '1' + chkflg3[2].substr(4);
	}

	// 絞り込み
	checkBox = $e_7('//*[@id="ckLevelSearch3"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg3[2] = chkflg3[2].substr(0,4) + '0' + chkflg3[2].substr(5);
	}
	else{
		chkflg3[2] = chkflg3[2].substr(0,4) + '1' + chkflg3[2].substr(5);
	}

	// ユーザー名を更新
	chkflg3[2] = chkflg3[2].substr(0,FLAG3_NAME) + userBox.snapshotItem(0).value;

	// 枠色
	listBox = $e_7('//*[@id="lsColor3"]');
	colorNo = listBox.snapshotItem(0).selectedIndex;
	chkflg3[2] = chkflg3[2].substr(0,5) + colorNo + chkflg3[2].substr(6);

	//----------------------//
	// スプレッド連携の処理 //
	//----------------------//
	userBox = $e_7('//*[@id="userBox4"]');

	// 有効/無効
	checkBox = $e_7('//*[@id="ckUnion"]');
	if( checkBox.snapshotItem(0).checked == false ){
		chkflg4 = '0' + chkflg4.substr(1);
		userBox.disabled = true;
	}
	else{
		chkflg4 = '1' + chkflg4.substr(1);
		userBox.disabled = false;
	}

	// ユーザー名を更新
	chkflg4 = chkflg4.substr(0,1) + userBox.snapshotItem(0).value;

	//----------------------//
	// 更新したフラグを保存 //
	//----------------------//
	execFlag = chkflg1 + DELIMIT1_7 + chkflg2;
	saveExecFlag(location.hostname, "FLAG0", execFlag);
	execFlag = chkflg3[0] + DELIMIT1_7 + chkflg3[1] + DELIMIT1_7 + chkflg3[2];
	saveExecFlag(location.hostname, "FLAG3", execFlag);
	saveExecFlag(location.hostname, "FLAG4", chkflg4);

	//----------//
	// リロード //
	//----------//
	reloadNext();
}

//------------------------------//
// ★のチェックを付ける押下処理 //
//------------------------------//
function checkButtonClicked() {

	// チェックボックスのチェックを外す //
	var checkBox1 = $e_7('//*[@id="ckLevel1"]');
	var checkBox2 = $e_7('//*[@id="ckLevel2"]');
	var checkBox3 = $e_7('//*[@id="ckLevel3"]');
	var checkBox4 = $e_7('//*[@id="ckLevel4"]');
	var checkBox5 = $e_7('//*[@id="ckLevel5"]');
	var checkBox6 = $e_7('//*[@id="ckLevel6"]');
	var checkBox7 = $e_7('//*[@id="ckLevel7"]');
	var checkBox8 = $e_7('//*[@id="ckLevel8"]');
	var checkBox9 = $e_7('//*[@id="ckLevel9"]');

	checkBox1.snapshotItem(0).checked = true;
	checkBox2.snapshotItem(0).checked = true;
	checkBox3.snapshotItem(0).checked = true;
	checkBox4.snapshotItem(0).checked = true;
	checkBox5.snapshotItem(0).checked = true;
	checkBox6.snapshotItem(0).checked = true;
	checkBox7.snapshotItem(0).checked = true;
	checkBox8.snapshotItem(0).checked = true;
	checkBox9.snapshotItem(0).checked = true;
}

//----------------------------//
// ★のチェックを外す押下処理 //
//----------------------------//
function uncheckButtonClicked() {

	// チェックボックスのチェックを外す //
	var checkBox1 = $e_7('//*[@id="ckLevel1"]');
	var checkBox2 = $e_7('//*[@id="ckLevel2"]');
	var checkBox3 = $e_7('//*[@id="ckLevel3"]');
	var checkBox4 = $e_7('//*[@id="ckLevel4"]');
	var checkBox5 = $e_7('//*[@id="ckLevel5"]');
	var checkBox6 = $e_7('//*[@id="ckLevel6"]');
	var checkBox7 = $e_7('//*[@id="ckLevel7"]');
	var checkBox8 = $e_7('//*[@id="ckLevel8"]');
	var checkBox9 = $e_7('//*[@id="ckLevel9"]');

	checkBox1.snapshotItem(0).checked = false;
	checkBox2.snapshotItem(0).checked = false;
	checkBox3.snapshotItem(0).checked = false;
	checkBox4.snapshotItem(0).checked = false;
	checkBox5.snapshotItem(0).checked = false;
	checkBox6.snapshotItem(0).checked = false;
	checkBox7.snapshotItem(0).checked = false;
	checkBox8.snapshotItem(0).checked = false;
	checkBox9.snapshotItem(0).checked = false;
}

//----------------------------------//
// 有効チェックボックスチェック処理 //
//----------------------------------//
function enable1Checked() {

	var userBox = $e_7('//*[@id="userBox1"]');
	var checkBox = $e_7('//*[@id="ckEnable1"]');

	// ユーザー指定のフラグを反転
	if( checkBox.snapshotItem(0).checked == false ){
		userBox.snapshotItem(0).disabled = true;
	}
	else{
		userBox.snapshotItem(0).disabled = false;
	}
}

function enable2Checked() {

	var userBox = $e_7('//*[@id="userBox2"]');
	var checkBox = $e_7('//*[@id="ckEnable2"]');

	// ユーザー指定のフラグを反転
	if( checkBox.snapshotItem(0).checked == false ){
		userBox.snapshotItem(0).disabled = true;
	}
	else{
		userBox.snapshotItem(0).disabled = false;
	}
}

function enable3Checked() {

	var userBox = $e_7('//*[@id="userBox3"]');
	var checkBox = $e_7('//*[@id="ckEnable3"]');

	// ユーザー指定のフラグを反転
	if( checkBox.snapshotItem(0).checked == false ){
		userBox.snapshotItem(0).disabled = true;
	}
	else{
		userBox.snapshotItem(0).disabled = false;
	}
}

//------------------//
// ルート構築モード //
//------------------//
function routeModeChecked() {
	var checkBox = $e_7('//*[@id="ckRouteMode"]');
	var checkBox2 = $e_7('//*[@id="ckAutoRouteMode"]');
	var routeField = $e_7('//*[@id="routeField"]');
	var routeField2 = $e_7('//*[@id="routeField2"]');
	var routeField3 = $e_7('//*[@id="routeField3"]');
	var routeField5 = $e_7('//*[@id="routeField5"]');
	var baseField = $e_7('//*[@id="baseField"]');

	// ユーザー指定のフラグを反転
	if( checkBox.snapshotItem(0).checked == false ){
		if( baseField.snapshotLength > 0 ){
			baseField.snapshotItem(0).style.display = "inline";
		}
		routeField.snapshotItem(0).style.display = "none";
		routeField2.snapshotItem(0).style.display = "none";
		routeField3.snapshotItem(0).style.display = "none";
		routeField5.snapshotItem(0).style.display = "none";

		// メニュー解除されたらクリアボタンクリックを実行
		routeClearButtonClicked()
	}
	else{
		if( baseField.snapshotLength > 0 ){
			baseField.snapshotItem(0).style.display = "none";
		}
		routeField.snapshotItem(0).style.display = "inline";
		routeField2.snapshotItem(0).style.display = "inline";
		routeField3.snapshotItem(0).style.display = "inline";
		routeField5.snapshotItem(0).style.display = "inline";

		if( checkBox2.snapshotItem(0).checked == true ){
			// 自動構築モードがすでにチェックされてたら警告処理
			autoRouteModeChecked();
		}
	}

	// インフォメーションの更新
	autoRouteInfo();
}

//----------------------//
// 自動ルート構築モード //
//----------------------//
function autoRouteModeChecked() {

	var checkBox = $e_7('//*[@id="ckRouteMode"]');
	var checkBox2 = $e_7('//*[@id="ckAutoRouteMode"]');

	// 自動構築のチェック
	if( (checkBox.snapshotItem(0).checked == true) && (checkBox2.snapshotItem(0).checked == true) ){
		if( window.confirm("作成中のルートが破棄されますがよろしいですか？") ){
			routeClearButtonClicked();
			autoroute = AUTO_ROUTE_EDIT_FIRST;
		}
		else{
			// 解除時はルートをクリアする
			checkBox2.snapshotItem(0).checked = false;
 			return;
		}
	}
	else{
		autoroute = AUTO_ROUTE_NONE;
		routeClearButtonClicked();
	}

	// インフォメーションの更新
	autoRouteInfo();
}

//------------------------------------------//
// 自動ルート構築モードの指示メッセージ表示 //
//------------------------------------------//
function autoRouteInfo(){
	var routeField = $e_7('//*[@id="route_info"]');
	var checkBox = $e_7('//*[@id="ckRouteMode"]');

	if( checkBox.snapshotItem(0).checked == false ){
		// ルート構築モードがオフのときはメッセージをださない
		routeField.snapshotItem(0).innerHTML = '';
		return;
	}

	if( location.pathname != "/big_map.php" ){
		if( autoroute == AUTO_ROUTE_EDIT_FIRST ){
			routeField.snapshotItem(0).innerHTML = '<font color="red"><b>ルート起点を<br>右クリックして下さい</b></font>';
		}
		else if( autoroute == AUTO_ROUTE_EDIT_LAST ){
			routeField.snapshotItem(0).innerHTML = '<font color="red"><b>ルート終点を<br>右クリックして下さい</b></font>';
		}
		else if( autoroute == AUTO_ROUTE_EDIT_END ){
			routeField.snapshotItem(0).innerHTML = '<font color="red"><b>ルート終点を<br>右クリックで再試行できます</b></font>';
		}
		else{
			routeField.snapshotItem(0).innerHTML = '';
		}
	}
	else{
		if( autoroute == AUTO_ROUTE_EDIT_FIRST ){
			routeField.snapshotItem(0).innerHTML = '<font color="red"><b>右クリックで起点設定</b></font>';
		}
		else if( autoroute == AUTO_ROUTE_EDIT_LAST ){
			routeField.snapshotItem(0).innerHTML = '<font color="red"><b>右クリックで終点設定</b></font>';
		}
		else if( autoroute == AUTO_ROUTE_EDIT_END ){
			routeField.snapshotItem(0).innerHTML = '<font color="red"><b>終点右クリックで終点解除</b></font>';
		}
		else{
			routeField.snapshotItem(0).innerHTML = '';
		}
	}
}

//--------------------//
// ルート全選択ボタン //
//--------------------//
function routeSelectButtonClicked() {
	// 構築ルート情報の選択
	var routeText = $x_7('//*[@id="routeInfoText"]');

	var objs = routeText.firstChild;
	var obje = routeText.lastChild;

	var range = document.createRange();
	range.setStart(objs,0);
	range.setEnd(obje,obje.textContent.length);
	var sel = getSelection();
	sel.removeAllRanges();
	sel.addRange(range);
}

//--------------------//
// ルートクリアボタン //
//--------------------//
function routeClearButtonClicked() {
	var routeText = $e_7('//*[@id="routeInfoText"]');
	var checkBox = $e_7('//*[@id="ckAutoRouteMode"]');

	if( location.pathname == "/big_map.php" ){
		// 51x51画面では対象座標再描画で対応
		autoroute = AUTO_ROUTE_NONE;

		getNPCCastleInfo_51(1);

		routeText.snapshotItem(0).innerHTML = "";

		// ルート自動構築中ならフラグを初期化
		if( checkBox.snapshotItem(0).checked == true ){
			autoroute = AUTO_ROUTE_EDIT_FIRST;
		}

		return;
	}

	// 構築ルート情報のクリア
	routeText.snapshotItem(0).innerHTML = "";

	// マップに埋め込んだマーク画像を全部消す
	var rollover = $d("rollover");

	// すでに画像が登録されてるか調べる
	var en = $e_7('//*[@name="routeIcon"]');
	if( en.snapshotLength > 0 ){
		// 画像がいたら消す
		for( var i = 0; i < en.snapshotLength; i++ ){
			var ex = $x_7('//*[@id="' + en.snapshotItem(i).id + '"]');
			var ex_p = ex.parentNode;
			ex_p.removeChild(ex);
		}
	}

	// ルート自動構築中ならフラグを初期化
	if( checkBox.snapshotItem(0).checked == true ){
		autoroute = AUTO_ROUTE_EDIT_FIRST;
	}
}

//------------------//
// ルート検証ボタン //
//------------------//
function routeCheckButtonClicked(e){
	var rollover = $d("rollover");
	var checkBox = $e_7('//*[@id="ckRouteMode"]');
	var checkBox2 = $e_7('//*[@id="ckRouteMode2"]');

	// マップに埋め込んだマーク画像を拾う
	var rollover = $d("rollover");

	// すでに画像が登録されてるか調べる
	var cx = 0;
	var cy = 0;
	var errf = false;
	var errx;
	var erry;
	var en = $e_7('//*[@name="routeIcon"]');
	if( en.snapshotLength > 0 ){
		// 画像がいたら消す
		for( var i = en.snapshotLength -1; i >= 0; i-- ){
			var ex = $x_7('//*[@id="' + en.snapshotItem(i).id + '"]');
			var list = en.snapshotItem(i).id.match(/^([-]*\d+).([-]*\d+)/);
			if( i != en.snapshotLength -1 ){
				var dx = Math.abs(cx - parseInt(list[1]));
				var dy = Math.abs(cy - parseInt(list[2]));
				if( (dx >= 2) || (dy >= 2) || (errf == true) ){
					if( errf == false ){
						errx = parseInt(list[1]);
						erry = parseInt(list[2]);
					}
					ex.src = ricon_e;
					errf = true;
				}
				else{
					ex.src = ricon;
				}
			}

			cx = parseInt(list[1]);
			cy = parseInt(list[2]);
		}

		if( errf == true ){
			var baseText = $e_7('//*[@id="routeInfoText"]');
			var text = baseText.snapshotItem(0).innerHTML;
			var fp = text.indexOf('(' + errx + ',' + erry + ')');
			var xp = text.indexOf('×',fp);
			var ep = text.indexOf("<",fp);
			if( ep == -1 ){
				if( xp == -1 ){
					// マークがないばあいだけつける
					text = text + '<b><font color="red">×</font></b>';
				}
			}
			else{
				if( xp == -1 ){
					// マークがないばあいだけつける
					text = text.substr(0,ep) + '<b><font color="red">×</font></b>' + text.substr(ep);
				}
			}
			baseText.snapshotItem(0).innerHTML = text;
		}
	}

}

//----------------------//
// 表示補助メニュー制御 //
//----------------------//
function menu2Clicked() {

	var checkBox = $e_7('//*[@id="ckMenu2"]');
	var label;
	var chkbox;
	var listbox;

	// コントロールの表示切り替え
	if( checkBox.snapshotItem(0).checked == false ){
		for( var i = 1; i <= 10; i++ ){
			label = $e_7('//*[@id="Label2-' + i + '"]');
			label.snapshotItem(0).style.display = "none";
		}

		checkbox = $e_7('//*[@id="ckAnalyze"]');
		checkbox.snapshotItem(0).style.display = "none";
		checkbox = $e_7('//*[@id="ckEmptyDraw"]');
		checkbox.snapshotItem(0).style.display = "none";
		checkbox = $e_7('//*[@id="ckRader"]');
		checkbox.snapshotItem(0).style.display = "none";
		checkbox = $e_7('//*[@id="ckOwnerList"]');
		checkbox.snapshotItem(0).style.display = "none";
		checkbox = $e_7('//*[@id="ckDirection"]');
		checkbox.snapshotItem(0).style.display = "none";
		checkbox = $e_7('//*[@id="ckOldDesign"]');
		checkbox.snapshotItem(0).style.display = "none";
		checkbox = $e_7('//*[@id="ckNoExec51"]');
		checkbox.snapshotItem(0).style.display = "none";

		listbox = $e_7('//*[@id="lsArea"]');
		listbox.snapshotItem(0).style.display = "none";
		listbox = $e_7('//*[@id="lsArea2"]');
		listbox.snapshotItem(0).style.display = "none";
		listbox = $e_7('//*[@id="lsArea3"]');
		listbox.snapshotItem(0).style.display = "none";
		listbox = $e_7('//*[@id="lsEmptyColor"]');
		listbox.snapshotItem(0).style.display = "none";
	}
	else{
		for( var i = 1; i <= 10; i++ ){
			label = $e_7('//*[@id="Label2-' + i + '"]');
			label.snapshotItem(0).style.display = "inline";
		}

		checkbox = $e_7('//*[@id="ckAnalyze"]');
		checkbox.snapshotItem(0).style.display = "inline";
		checkbox = $e_7('//*[@id="ckEmptyDraw"]');
		checkbox.snapshotItem(0).style.display = "inline";
		checkbox = $e_7('//*[@id="ckRader"]');
		checkbox.snapshotItem(0).style.display = "inline";
		checkbox = $e_7('//*[@id="ckOwnerList"]');
		checkbox.snapshotItem(0).style.display = "inline";
		checkbox = $e_7('//*[@id="ckDirection"]');
		checkbox.snapshotItem(0).style.display = "inline";
		checkbox = $e_7('//*[@id="ckOldDesign"]');
		checkbox.snapshotItem(0).style.display = "inline";
		checkbox = $e_7('//*[@id="ckNoExec51"]');
		checkbox.snapshotItem(0).style.display = "inline";

		listbox = $e_7('//*[@id="lsArea"]');
		listbox.snapshotItem(0).style.display = "inline";
		listbox = $e_7('//*[@id="lsArea2"]');
		listbox.snapshotItem(0).style.display = "inline";
		listbox = $e_7('//*[@id="lsArea3"]');
		listbox.snapshotItem(0).style.display = "inline";
		listbox = $e_7('//*[@id="lsEmptyColor"]');
		listbox.snapshotItem(0).style.display = "inline";
	}
}

//----------------------//
// 同盟検索メニュー制御 //
//----------------------//
function menu4Clicked() {
	var checkBox = $e_7('//*[@id="ckMenu4"]');
	var label;
	var chkbox;
	var listbox;
	var userbox;

	// コントロールの表示切り替え
	if( checkBox.snapshotItem(0).checked == false ){
		for( var i = 1; i <= 24; i++ ){
			label = $e_7('//*[@id="Label4-' + i + '"]');
			label.snapshotItem(0).style.display = "none";
		}

		for( var i = 1; i <= 3; i++ ){
			label = $e_7('//*[@id="Label4-2-' + i + '"]');
			label.snapshotItem(0).style.display = "none";
		}

		for( var i = 1; i <=3; i++ ){
			checkbox = $e_7('//*[@id="ckEnable' + i + '"]');
			checkbox.snapshotItem(0).style.display = "none";
			checkbox = $e_7('//*[@id="ckType' + i + '"]');
			checkbox.snapshotItem(0).style.display = "none";
			checkbox.snapshotItem(1).style.display = "none";
			checkbox = $e_7('//*[@id="ckFullMatch' + i + '"]');
			checkbox.snapshotItem(0).style.display = "none";
			checkbox = $e_7('//*[@id="ckLevelSearch' + i + '"]');
			checkbox.snapshotItem(0).style.display = "none";

			userbox = $e_7('//*[@id="userBox' + i + '"]');
			userbox.snapshotItem(0).style.display = "none";

			listbox = $e_7('//*[@id="lsColor' + i + '"]');
			listbox.snapshotItem(0).style.display = "none";
		}
	}
	else{
		for( var i = 1; i <= 24; i++ ){
			label = $e_7('//*[@id="Label4-' + i + '"]');
			label.snapshotItem(0).style.display = "inline";
		}

		for( var i = 1; i <= 3; i++ ){
			label = $e_7('//*[@id="Label4-2-' + i + '"]');
			label.snapshotItem(0).style.display = "inline";
		}

		for( var i = 1; i <=3; i++ ){
			checkbox = $e_7('//*[@id="ckEnable' + i + '"]');
			checkbox.snapshotItem(0).style.display = "inline";
			checkbox = $e_7('//*[@id="ckType' + i + '"]');
			checkbox.snapshotItem(0).style.display = "inline";
			checkbox.snapshotItem(1).style.display = "inline";
			checkbox = $e_7('//*[@id="ckFullMatch' + i + '"]');
			checkbox.snapshotItem(0).style.display = "inline";
			checkbox = $e_7('//*[@id="ckLevelSearch' + i + '"]');
			checkbox.snapshotItem(0).style.display = "inline";

			userbox = $e_7('//*[@id="userBox' + i + '"]');
			userbox.snapshotItem(0).style.display = "inline";

			listbox = $e_7('//*[@id="lsColor' + i + '"]');
			listbox.snapshotItem(0).style.display = "inline";
		}
	}
}

//----------//
// 空白除去 //
//----------//
function trim_7(str)
{
	if (str == undefined) return "";
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
}


//------------------//
// 画面サイズの取得 //
//------------------//
function getViewSize()
{
	var viewSize;

	if( $x_7("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort15 now\"]") ){
		viewSize = 15;	// 15x15
	}
	else if( $x_7("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort20 now\"]") ){
		viewSize = 20;	// 20x20
	}
	else if( $x_7("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort15 now\"]") ){
		viewSize = 15;	// 15x15 本鯖の仕様変更対応
	}
	else if( $x_7("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort20 now\"]") ){
		viewSize = 20;	// 20x20 本鯖の仕様変更対応
	}
	else if( $x_7("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort51 now\"]") ){
		viewSize = 51;	// 51x51 本鯖の仕様変更対応
	}
	else{
		viewSize = 11;	// 11x11
	}

	return viewSize;
}

//----------------//
// 自動ルート構築 //
//----------------//
function makeAutoRoute(checkmode)
{
	//------//
	// 定数 //
	//------//
	var MAP_NONE  = -1;    // 未処理
	var MAP_NPC   = -2;    // NPC砦
	var MAP_WALL  = -3;    // 壁
	var MAP_START = 0;     // 起点
	var MAP_END   = -999;  // 目的地

	//------------------//
	// 画面サイズの取得 //
	//------------------//
	var viewSize;
	viewSize = getViewSize();

	//--------------------------//
	// 同盟検索オプションの取得 //
	//--------------------------//
	var checkBox1;
	var userName = new Array();
	var userText;
	var fullmatch = new Array();
	var target = new Array();
	for( var i = 0; i < 3; i++ ){
		fullmatch[i] = 0;
		target[i] = 0;
	}

	// 個人・同盟検索１
	checkBox1 = $e_7('//*[@id="ckEnable1"]');
	if( checkBox1.snapshotItem(0).checked == true ){
		// 個人・同盟の別
		checkBox2 = $e_7('//*[@id="ckType1"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			target[0] = 1;
		}
		else{
			target[0] = 2;
		}
		// 完全一致
		checkBox2 = $e_7('//*[@id="ckFullMatch1"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			fullmatch[0] = 1;
		}
		else{
			fullmatch[0] = 0;
		}
		userBox = $e_7('//*[@id="userBox1"]');
		userText = userBox.snapshotItem(0).value;
		userName[0] = new Array();
		userName[0] = userText.split(OWNER_SPLITKEY);
	}
	else{
		userName[0] = "";
	}

	// 個人・同盟検索２
	checkBox1 = $e_7('//*[@id="ckEnable2"]');
	if( checkBox1.snapshotItem(0).checked == true ){
		// 個人・同盟の別
		checkBox2 = $e_7('//*[@id="ckType2"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			target[1] = 1;
		}
		else{
			target[1] = 2;
		}
		// 完全一致
		checkBox2 = $e_7('//*[@id="ckFullMatch2"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			fullmatch[1] = 1;
		}
		else{
			fullmatch[1] = 0;
		}
		userBox = $e_7('//*[@id="userBox2"]');
		userText = userBox.snapshotItem(0).value;
		userName[1] = new Array();
		userName[1] = userText.split(OWNER_SPLITKEY);
	}
	else{
		userName[1] = "";
	}

	// 個人・同盟検索３
	checkBox1 = $e_7('//*[@id="ckEnable3"]');
	if( checkBox1.snapshotItem(0).checked == true ){
		// 個人・同盟の別
		checkBox2 = $e_7('//*[@id="ckType3"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			target[2] = 1;
		}
		else{
			target[2] = 2;
		}
		// 完全一致
		checkBox2 = $e_7('//*[@id="ckFullMatch3"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			fullmatch[2] = 1;
		}
		else{
			fullmatch[2] = 0;
		}
		userBox = $e_7('//*[@id="userBox3"]');
		userText = userBox.snapshotItem(0).value;
		userName[2] = new Array();
		userName[2] = userText.split(OWNER_SPLITKEY);
	}
	else{
		userName[2] = "";
	}

	//--------------------------------------------//
	// 全体表示画面から、画面中央座標を手に入れる //
	//--------------------------------------------//
	var codx = $e_7('//div[@id="datas"]/input[@id=\"x\"]');
	var cody = $e_7('//div[@id="datas"]/input[@id=\"y\"]');
	var bx = codx.snapshotItem(0).value;
	var by = cody.snapshotItem(0).value;

	// 左上座標を求める
	if( viewSize == 11 ){
		bx = parseInt(bx) - 5;
		by = parseInt(by) + 5;
	}
	else if( viewSize == 15 ){
		bx = parseInt(bx) - 7;
		by = parseInt(by) + 7;
	}
	else{
		bx = parseInt(bx) - 9;
		by = parseInt(by) + 9;
	}

	// 始点、終点座標を求める
	var sx = Math.abs(parseInt(autoroute_f[0]) - parseInt(bx));
	var sy = Math.abs(parseInt(autoroute_f[1]) - parseInt(by));
	var ex = Math.abs(parseInt(autoroute_l[0]) - parseInt(bx));
	var ey = Math.abs(parseInt(autoroute_l[1]) - parseInt(by));

	//------------------//
	// 探査レベルの取得 //
	//------------------//
	var listBox = $e_7('//*[@id="lsRouteLevel"]');
	var listBox2 = $e_7('//*[@id="lsSkipRes"]');
	var listBox3 = $e_7('//*[@id="lsSkipGroup"]');
	var limit = listBox.snapshotItem(0).selectedIndex + 1;
	var skipres = listBox2.snapshotItem(0).selectedIndex;
	var skipgrp = listBox3.snapshotItem(0).selectedIndex;

	//------------------------------//
	// マップデータをマトリックス化 //
	//------------------------------//
	// マップの作成
	var mapdata = new Array();
	var resdata = new Array();
	for(var i = 0; i < 20; i++ ){
		mapdata[i] = new Array();
		resdata[i] = new Array();
	}
	for(var i = 0; i < 20; i++ ){
		for(var j = 0; j < 20; j++ ){
			if( (i >= viewSize) || (j >= viewSize) ){
				mapdata[i][j] = MAP_WALL;	// 画面外は壁扱い
			}
			else{
				mapdata[i][j] = MAP_NONE;	// 未処理エリア
			}
		}
	}

	//----------------//
	// 領土情報の取得 //
	//----------------//
	var areas = $e_7('//*[@id="mapOverlayMap"]//area/@onmouseover');

	//--------------------------------//
	// 領土の情報をマトリックスに反映 //
	//--------------------------------//
	var ckUser = $e_7('//*[@id="ckRouteUser"]');
	for (var i = 0; i < areas.snapshotLength; i++) {
		var rowText = areas.snapshotItem(i).textContent;
		rowText = rowText.replace(/^.*rewrite\(/, "");
		rowText = rowText.replace(/\); .*$/, "");
		var bkText = rowText;
		rowText = rowText.replace(/\//g,"==uZer==");
		rowText = rowText.replace(/', '/g,"'/'");
		rowText = rowText.replace(/'/g,"");
		var valueA = new Array();
		valueA = rowText.split('/');
		valueA[1] = valueA[1].replace(/==uZer==/,"/");

		// マップ座標の取得
		var rowText3 = valueA[3];
		rowText3 = rowText3.replace(/\(/,"");
		rowText3 = rowText3.replace(/\)/,"");
		var valueB = new Array();
		valueB = rowText3.split(',');
		var x = parseInt(valueB[0]);
		var y = parseInt(valueB[1]);

		// 資源レベル
		var landLevel = valueA[5].length;
		if( valueA[5].substr(0,4) == '<img' ){
			// FaceBook Lands of Legends! 対応
			var stars = valueA[5].match(/<img/g);
			landLevel = stars.length;
		}

		//--------------------------------//
		// マトリックス上のオフセット計算 //
		//--------------------------------//
		var px = Math.abs(parseInt(x) - parseInt(bx));
		var py = Math.abs(parseInt(y) - parseInt(by));

		//--------------------//
		// 各種情報の埋め込み //
		//--------------------//
		if( valueA[11] == '1' ){
			// NPC砦
			mapdata[px][py] = MAP_NPC;

			// リソース情報
			resdata[px][py] = "★" + landLevel + "&nbsp;(" + valueA[0] + ")";
		}
		else if( valueA[1] != '' ){
			// 個人領土
			if( (ckUser.snapshotItem(0).checked == false) || ((ckUser.snapshotItem(0).checked == true) && (landLevel == 0)) ){
				mapdata[px][py] = MAP_WALL;   // 個人領土を対象外、あるいは対象かつ拠点の場合、壁とみなす
			}

			// 同盟指定
			if( (ckUser.snapshotItem(0).checked == true) && (skipgrp > 0) ){
				// 同盟指定ありの場合、指定条件にマッチしない領土は壁とみなす

				var matchcase = false;    // マッチしたパターン
				var groupNo = skipgrp - 1;
	
				// 個人・同盟マッチチェック
				for( var k = 0; k < userName[groupNo].length; k++ ){
					// 検索有効時 username に値が入る
					if( userName[groupNo][k] != "" ){
						// ターゲットが個人
						if( target[groupNo] == 1 ){
							// 完全一致かつ、ユーザー名が一致
							if( (fullmatch[groupNo] == 1) && (valueA[1] == userName[groupNo][k]) ){
								matchcase = true;
								break;
							}
							// 部分一致かつ、ユーザー名が一致
							if( (fullmatch[groupNo] == 0) && (valueA[1].indexOf(userName[groupNo][k]) != -1) ){
								matchcase = true;
								break;
							}
						}
						// ターゲットが同盟
						else{
							// 完全一致かつ、ユーザー名が一致
							if( (fullmatch[groupNo] == 1) && (valueA[4] == userName[groupNo][k]) ){
								matchcase = true;
								break;
							}
							// 部分一致かつ、ユーザー名が一致
							if( (fullmatch[groupNo] == 0) && (valueA[4].indexOf(userName[groupNo][k]) != -1) ){
								matchcase = true;
								break;
							}
						}
					}
				}
				if( matchcase == false ){
					// マッチしない場合は壁扱い
					mapdata[px][py] = MAP_WALL;
				}
			}

			// リソース情報
			if( landLevel != 0 ){
				resdata[px][py] = '★' + landLevel + '&nbsp;(' + valueA[7] + ',' + valueA[8] + ',' + valueA[9] + ',' + valueA[10] + ')';
			}
			else{
				resdata[px][py] = '個人本拠地/拠点';
			}
		}
		else{
			// リソース情報
			resdata[px][py] = '★' + landLevel + '&nbsp;(' + valueA[7] + ',' + valueA[8] + ',' + valueA[9] + ',' + valueA[10] + ')';
		}

		//----------------//
		// ルート特殊処理 //
		//----------------//
		// 土地レベルでの判定
		if( (landLevel > limit) || (mapdata[px][py] == MAP_NPC) ){
			// レベル超過の土地とNPC砦は壁扱いとする
			mapdata[px][py] = MAP_WALL;   // 壁扱い
		}
		
		// 資源回避での判定
		if(    (season1[cchkres[skipres]][1] == valueA[7])
		    && (season1[cchkres[skipres]][2] == valueA[8])
		    && (season1[cchkres[skipres]][3] == valueA[9])
		    && (season1[cchkres[skipres]][4] == valueA[10]) ){
			// 回避条件に一致する資源は壁扱いとする
			mapdata[px][py] = MAP_WALL;   // 壁扱い
		}

		// 始点、終点特例
		if( ((px == sx) && (py == sy)) || ((px == ex) && (py == ey)) ){
			mapdata[px][py] = MAP_NONE;   // 始点と目的地はルートに加える
		}
	}

	//--------------------//
	// 始点情報の埋め込み //
	//--------------------//
	mapdata[sx][sy] = MAP_START;

	// 探索情報設定
	var posdata = new Array();
	var maxpos = 0;
	posdata[0] = parseInt(sy) * 20 + parseInt(sx);

	for( var i = 0; i <= maxpos; i++ ){
		var cx = parseInt(posdata[i]) % 20;
		var cy = Math.floor(parseInt(posdata[i]) / 20);

		for( var j = 0; j < chkptn.length; j++ ){
			var lx = parseInt(cx) + parseInt(chkptn[j][0]);
			if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
				continue;
			}
			var ly = parseInt(cy) + parseInt(chkptn[j][1]);
			if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
				continue;
			}

			// 現座標からの移動距離＋１を求める
			var dist = parseInt(mapdata[cx][cy]) + 1;
			// 編集可能？
			if( (mapdata[lx][ly] == MAP_NONE) || (mapdata[lx][ly] == MAP_NPC) ){
				// 距離更新
				mapdata[lx][ly] = dist;

				// 座標登録
				maxpos = maxpos + 1;
				posdata[maxpos] = parseInt(ly) * 20 + parseInt(lx);
			}
			else if( (mapdata[lx][ly] > 0) && (parseInt(mapdata[lx][ly])) > dist ){
				// 距離更新
				mapdata[lx][ly] = dist;

				// 座標登録
				maxpos = maxpos + 1;
				posdata[maxpos] = parseInt(ly) * 20 + parseInt(lx);
			}
		}
	}

	// 事前チェックオンのとき、結果だけ返す
	if( checkmode == "1" ){
		if( mapdata[ex][ey] < 0 ){
			return false;
		}
		else{
			return true;
		}
	}

	// 終点にたどりつけたか？
	if( mapdata[ex][ey] < 0 ){
		alert("目的地に到達するルートを構築できませんでした。構築条件を見直してください。");
		return false;
	}

	//--------------------//
	// サーチルート逆探査 //
	//--------------------//
	posdata[0] = parseInt(ey) * 20 + parseInt(ex);
	maxpos = 0;

	for( var i = 0; i <= maxpos; i++ ){
		var cx = parseInt(posdata[i]) % 20;
		var cy = Math.floor(parseInt(posdata[i]) / 20);

		if( (cx == sx) && (cy == sy) ){
			break;
		}

		// コースとして通過可能な最小資源の土地を調べる
		var lowLevel = 9;
		for( var j = 0; j < chkptn.length; j++ ){
			var lx = parseInt(cx) + parseInt(chkptn[j][0]);
			if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
				continue;
			}
			var ly = parseInt(cy) + parseInt(chkptn[j][1]);
			if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
				continue;
			}

			// 現座標からの移動距離－１を求める
			var dist = parseInt(mapdata[cx][cy]) - 1;
			// 該当する座標？
			if( (mapdata[lx][ly] >= 0) && (parseInt(mapdata[lx][ly])) == dist ){
				var level = resdata[lx][ly].substr(resdata[lx][ly].indexOf("★")+1,1);
				if( resdata[lx][ly].indexOf("個人本拠地/拠点") >= 0 ){
					level = 0;
				}
				if( lowLevel > level ){
					lowLevel = level;
				}
			}
		}

		//--------------------------//
		// 固定・ランダム構築の分岐 //
		//--------------------------//
		checkBox1 = $e_7('//*[@id="ckRouteRandom"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			//--------------------//
			// ランダムルート構築 //
			//--------------------//

			// パターン乱数の算出
			var pattern;
			var rptn = new Array(2);
			pattern = Math.floor(Math.random() * 30);
			if( pattern < 24 ){
				// 十字優先のパターン(80%の確率でこちら)
				rptn[0] = pattern;

				// 後半4パターンの決定
				pattern = Math.floor(Math.random() * 24);
				rptn[1] = pattern + 24;
			}
			else{
				// ×字優先のパターン(20%の確率でこちら)
				pattern = Math.floor(Math.random() * 24);
				rptn[1] = pattern;

				// 前半4パターンの決定
				pattern = Math.floor(Math.random() * 24);
				rptn[0] = pattern + 24;
			}

			// ルート探索
			for( var j = 0; j < 8; j++ ){
				var rno;
				var offset;
				if( j < 4 ){
					rno = rptn[0];
					offset = j;
				}
				else{
					rno = rptn[1];
					offset = j - 4;
				}

				var lx = parseInt(cx) + parseInt(chkptn_r[rno*4 + offset][0]);
				if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
					continue;
				}
				var ly = parseInt(cy) + parseInt(chkptn_r[rno*4 + offset][1]);
				if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
					continue;
				}

				// 現座標からの移動距離－１を求める
				var dist = parseInt(mapdata[cx][cy]) - 1;
				var level = resdata[lx][ly].substr(resdata[lx][ly].indexOf("★")+1,1);
				if( resdata[lx][ly].indexOf("個人本拠地/拠点") >= 0 ){
					level = 0;
				}

				// 該当する座標？
				if( (mapdata[lx][ly] >= 0) && (parseInt(mapdata[lx][ly]) == dist) && (level == lowLevel) ){
					// 座標登録
					maxpos = maxpos + 1;
					posdata[maxpos] = parseInt(ly) * 20 + parseInt(lx);
	
					break;
				}
			}
		}
		else{
			//----------------//
			// 固定ルート構築 //
			//----------------//
			// ルート探索
			for( var j = 0; j < chkptn.length; j++ ){
				var lx = parseInt(cx) + parseInt(chkptn[j][0]);
				if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
					continue;
				}
				var ly = parseInt(cy) + parseInt(chkptn[j][1]);
				if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
					continue;
				}

				// 現座標からの移動距離－１を求める
				var dist = parseInt(mapdata[cx][cy]) - 1;
				var level = resdata[lx][ly].substr(resdata[lx][ly].indexOf("★")+1,1);
				if( resdata[lx][ly].indexOf("個人本拠地/拠点") >= 0 ){
					level = 0;
				}

				// 該当する座標？
				if( (mapdata[lx][ly] >= 0) && (parseInt(mapdata[lx][ly]) == dist) && (level == lowLevel) ){
					// 座標登録
					maxpos = maxpos + 1;
					posdata[maxpos] = parseInt(ly) * 20 + parseInt(lx);

					break;
				}
			}
		}
	}

	//----------------//
	// ルート情報表示 //
	//----------------//
	var baseText = $e_7('//*[@id="routeInfoText"]');
	checkBox1 = $e_7('//*[@id="ckRouteMode2"]');
	var rollover = $d("rollover");
	var text = '';
	for( var i = maxpos; i >= 0; i-- ){
		var cx = parseInt(posdata[i]) % 20;
		var cy = Math.floor(parseInt(posdata[i]) / 20);

		// areaデータを取ってみる
		var area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + (parseInt(bx) + cx) + "&y=" + (parseInt(by) - cy) + "#ptop\"]");
		if( area_pos == null ){
			area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + (parseInt(bx) + cx) + "&y=" + (parseInt(by) - cy) + "\"]");
		}
		var list3 = area_pos.getAttribute("onmouseover").match(/'(\d+)px', '(\d+)px/);

		// クリックしたポイントに画像を埋め込む
		var img = d_7.createElement("img");
		img.style.position = "absolute";

		img.style.left = list3[1] + "px";
		img.style.top = list3[2] + "px";

		// アイコンの決定
		if( (i != 0) && (i != maxpos) ){
			img.src = ricon;

			if( viewSize == 15 ){
				img.style.width = "44px";
				img.style.height = "44px";
				img.style.zIndex = 227;
			} else if( viewSize == 20 ){
				img.style.width = "33px";
				img.style.height = "33px";
				img.style.zIndex = 402;
			} else {
				img.style.width = "60px";
				img.style.height = "60px";
				img.style.zIndex = 123;
			}
			img.name = "routeIcon";
			img.id = (parseInt(bx) + cx) + "_" + (parseInt(by) - cy);	// 座標をイメージのIDにする
			rollover.parentNode.insertBefore(img, rollover.nextSibling);
		}

		if( text != '' ){
			text = text + '<br>';
		}

		// 資源表示での出力切り替え
		if( checkBox1.snapshotItem(0).checked == false ){
			// 資源出力あり
			text = text + '(' + (parseInt(bx) + cx) + ',' + (parseInt(by) - cy) + ')&nbsp;&nbsp;' + resdata[cx][cy];
		}
		else{
			// 資源出力なし
			if( resdata[cx][cy].indexOf("★") >= 0 ){
				text = text + '(' + (parseInt(bx) + cx) + ',' + (parseInt(by) - cy) + ')&nbsp;&nbsp;'
					+ resdata[cx][cy].substr(0,2);
			}
			else{
				text = text + '(' + (parseInt(bx) + cx) + ',' + (parseInt(by) - cy) + ')&nbsp;&nbsp;' + resdata[cx][cy];
			}
		}
	}

	// ルート表の表示
	baseText.snapshotItem(0).innerHTML = text;

	// ルートを記憶
	autoroute_path[autoroute_maxpaths] = text;
	autoroute_maxpaths = autoroute_maxpaths + 1;

	return true;
}

//-----------------------//
// 自動ルート構築(51x51) //
//-----------------------//
function makeAutoRoute_51(checkmode)
{
	//------//
	// 定数 //
	//------//
	var MAP_NONE  = -1;    // 未処理
	var MAP_NPC   = -2;    // NPC砦
	var MAP_WALL  = -3;    // 壁
	var MAP_START = 0;     // 起点
	var MAP_END   = -999;  // 目的地

	//------------------//
	// 画面サイズの取得 //
	//------------------//
	var viewSize;
	viewSize = getViewSize();
	if( viewSize != 51 ){
		return false;
	}

	//--------------------------//
	// 同盟検索オプションの取得 //
	//--------------------------//
	var checkBox1;
	var userName = new Array();
	var userText;
	var fullmatch = new Array();
	var target = new Array();
	for( var i = 0; i < 3; i++ ){
		fullmatch[i] = 0;
		target[i] = 0;
	}

	// 個人・同盟検索１
	checkBox1 = $e_7('//*[@id="ckEnable1"]');
	if( checkBox1.snapshotItem(0).checked == true ){
		// 個人・同盟の別
		checkBox2 = $e_7('//*[@id="ckType1"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			target[0] = 1;
		}
		else{
			target[0] = 2;
		}
		// 完全一致
		checkBox2 = $e_7('//*[@id="ckFullMatch1"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			fullmatch[0] = 1;
		}
		else{
			fullmatch[0] = 0;
		}
		userBox = $e_7('//*[@id="userBox1"]');
		userText = userBox.snapshotItem(0).value;
		userName[0] = new Array();
		userName[0] = userText.split(OWNER_SPLITKEY);
	}
	else{
		userName[0] = "";
	}

	// 個人・同盟検索２
	checkBox1 = $e_7('//*[@id="ckEnable2"]');
	if( checkBox1.snapshotItem(0).checked == true ){
		// 個人・同盟の別
		checkBox2 = $e_7('//*[@id="ckType2"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			target[1] = 1;
		}
		else{
			target[1] = 2;
		}
		// 完全一致
		checkBox2 = $e_7('//*[@id="ckFullMatch2"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			fullmatch[1] = 1;
		}
		else{
			fullmatch[1] = 0;
		}
		userBox = $e_7('//*[@id="userBox2"]');
		userText = userBox.snapshotItem(0).value;
		userName[1] = new Array();
		userName[1] = userText.split(OWNER_SPLITKEY);
	}
	else{
		userName[1] = "";
	}

	// 個人・同盟検索３
	checkBox1 = $e_7('//*[@id="ckEnable3"]');
	if( checkBox1.snapshotItem(0).checked == true ){
		// 個人・同盟の別
		checkBox2 = $e_7('//*[@id="ckType3"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			target[2] = 1;
		}
		else{
			target[2] = 2;
		}
		// 完全一致
		checkBox2 = $e_7('//*[@id="ckFullMatch3"]');
		if( checkBox2.snapshotItem(0).checked == true ){
			fullmatch[2] = 1;
		}
		else{
			fullmatch[2] = 0;
		}
		userBox = $e_7('//*[@id="userBox3"]');
		userText = userBox.snapshotItem(0).value;
		userName[2] = new Array();
		userName[2] = userText.split(OWNER_SPLITKEY);
	}
	else{
		userName[2] = "";
	}

	//--------------------------------------------//
	// 全体表示画面から、画面中央座標を手に入れる //
	//--------------------------------------------//
	var ckUser = $e_7('//*[@id="ckRouteUser"]');

	// 処理データの取得
	var href = $e_7('//*[@id="map51-content"]//li');
	var list2 = href.snapshotItem(1300).innerHTML.match(/x=([-]*\d+)&amp;y=([-]*\d+)#/);

	// 左上座標を求める
	var bx = parseInt(list2[1]) - 25;
	var by = parseInt(list2[2]) + 25;

	// 始点、終点座標を求める
	var sx = Math.abs(parseInt(autoroute_f[0]) - parseInt(bx));
	var sy = Math.abs(parseInt(autoroute_f[1]) - parseInt(by));
	var ex = Math.abs(parseInt(autoroute_l[0]) - parseInt(bx));
	var ey = Math.abs(parseInt(autoroute_l[1]) - parseInt(by));

	//------------------//
	// 探査レベルの取得 //
	//------------------//
	var listBox = $e_7('//*[@id="lsRouteLevel"]');
	var listBox2 = $e_7('//*[@id="lsSkipRes"]');
	var listBox3 = $e_7('//*[@id="lsSkipGroup"]');
	var limit = listBox.snapshotItem(0).selectedIndex + 1;
	var skipres = listBox2.snapshotItem(0).selectedIndex;
	var skipgrp = listBox3.snapshotItem(0).selectedIndex;

	//------------------------------//
	// マップデータをマトリックス化 //
	//------------------------------//
	// マップの作成
	var mapdata = new Array();
	var resdata = new Array();
	for(var i = 0; i < 51; i++ ){
		mapdata[i] = new Array();
		resdata[i] = new Array();
	}
	for(var i = 0; i < 51; i++ ){
		for(var j = 0; j < 51; j++ ){
			if( (i >= viewSize) || (j >= viewSize) ){
				mapdata[i][j] = MAP_WALL;	// 画面外は壁扱い
			}
			else{
				mapdata[i][j] = MAP_NONE;	// 未処理エリア
			}
		}
	}

	//--------------------------------//
	// 領土の情報をマトリックスに反映 //
	//--------------------------------//
	for (var i = 0; i < href.snapshotLength; i++) {
		var elem = href.snapshotItem(i);

		list2 = elem.innerHTML.match(/x=([-]*\d+)&amp;y=([-]*\d+)#/);
		if( (list2 == null) || (list2 == undefined) ){
			continue;
		}

		// マトリックス上のオフセット計算
		var px = Math.abs(parseInt(list2[1]) - parseInt(bx));
		var py = Math.abs(parseInt(list2[2]) - parseInt(by));

		// 座標の取得
		var list = elem.innerHTML.match(/x=([-]*\d+)&amp;y=([-]*\d+)#/);
		if( (list == null) || (list == undefined) ){
			continue;
		}

		// 土地レベルの取得
		var p = elem.innerHTML.match(/戦力<\/dt><dd>(.*)<\/dd><dt class=/);
		if( p != undefined ){
			land = p[1];
			landLevel = land.length;
		}
		else{
			p = elem.innerHTML.match(/戦力&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt class=/);
			if( p != undefined ){
				land = p[1];
				landLevel = land.length;
			}
			else{
				landLevel = 0;
			}
		}

		// 空き地状態の取得
		var space = 0;
		if( elem.innerHTML.indexOf(">空き地<") >= 0 ){
			space = 1;
		}
		else if( elem.innerHTML.indexOf("&gt;空き地&lt;") >= 0 ){
			space = 1;
		}

		// 同盟名、個人名の取得
		var user;
		var group;
		p = elem.innerHTML.match(/君主名<\/dt><dd>(.*)<\/dd><dt>座標/);
		if( p != undefined ){
			user = p[1];
		}
		else{
			p = elem.innerHTML.match(/君主名&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt&gt;座標/);
			if( p != undefined ){
				user = p[1];
			}
		}
		p = elem.innerHTML.match(/君主名<\/dt><dd>(.*)<\/dd><dt>人口/);
		if( p != undefined ){
			user = p[1];
		}
		else{
			p = elem.innerHTML.match(/君主名&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt&gt;人口/);
			if( p != undefined ){
				user = p[1];
			}
		}
		p = elem.innerHTML.match(/同盟名<\/dt><dd>(.*)<\/dd><dt>戦力/);
		if( p != undefined ){
			group = p[1];
		}
		else{
			p = elem.innerHTML.match(/同盟名&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt&gt;戦力/);
			if( p != undefined ){
				group = p[1];
			}
		}
		p = elem.innerHTML.match(/同盟名<\/dt><dd class=&quot;bottom-popup-r&quot;>(.*)<\/dd><\/dl>/);
		if( p != undefined ){
			group = p[1];
		}
		else{
			p = elem.innerHTML.match(/同盟名&lt;\/dt&gt;&lt;dd class=&quot;bottom-popup-r&quot;&gt;(.*)&lt;\/dd&gt;&lt;\/dl&gt;/);
			if( p != undefined ){
				group = p[1];
			}
		}

		// 資源の取得
		var res = elem.innerHTML.match(/.*木(\d+)&amp;nbsp;岩(\d+)&amp;nbsp;鉄(\d+)&amp;nbsp;糧(\d+).*/);
		if( res == undefined){
			res = new Array();
			res[1] = 0;
			res[2] = 0;
			res[3] = 0;
			res[4] = 0;
		}

		//----------------//
		// 領地のチェック //
		//----------------//
		// NPC砦判定
		if( elem.innerHTML.indexOf("npc-red-star") >= 0 ){
			// NPC砦名
			var casname = elem.innerHTML.match(/bigmap-caption&quot;>(.*)<\/dt><dd class=/);
			if( (casname == null) || (casname == undefined) ){
				casname = elem.innerHTML.match(/bigmap-caption&quot;&gt;(.*)&lt;\/dt&gt;&lt;dd class=/);
			}

			// NPC砦
			mapdata[px][py] = MAP_NPC;

			// リソース情報
			resdata[px][py] = "★" + landLevel + "&nbsp;(" + casname[1] + ")";
		}
		else if( space == 0 ){
			// 個人領土
			if( (ckUser.snapshotItem(0).checked == false) || ((ckUser.snapshotItem(0).checked == true) && (landLevel == 0)) ){
				mapdata[px][py] = MAP_WALL;   // 個人領土を対象外、あるいは対象かつ拠点の場合、壁とみなす
			}

			// 同盟指定
			if( (ckUser.snapshotItem(0).checked == true) && (skipgrp > 0) ){
				// 同盟指定ありの場合、指定条件にマッチしない領土は壁とみなす

				var matchcase = false;    // マッチしたパターン
				var groupNo = skipgrp - 1;
	
				// 個人・同盟マッチチェック
				for( var k = 0; k < userName[groupNo].length; k++ ){
					// 検索有効時 username に値が入る
					if( userName[groupNo][k] != "" ){
						// ターゲットが個人
						if( target[groupNo] == 1 ){
							// 完全一致かつ、ユーザー名が一致
							if( (fullmatch[groupNo] == 1) && (user == userName[groupNo][k]) ){
								matchcase = true;
								break;
							}
							// 部分一致かつ、ユーザー名が一致
							if( (fullmatch[groupNo] == 0) && (user.indexOf(userName[groupNo][k]) != -1) ){
								matchcase = true;
								break;
							}
						}
						// ターゲットが同盟
						else{
							// 完全一致かつ、ユーザー名が一致
							if( (fullmatch[groupNo] == 1) && (group == userName[groupNo][k]) ){
								matchcase = true;
								break;
							}
							// 部分一致かつ、ユーザー名が一致
							if( (fullmatch[groupNo] == 0) && (group.indexOf(userName[groupNo][k]) != -1) ){
								matchcase = true;
								break;
							}
						}
					}
				}
				if( matchcase == false ){
					// マッチしない場合は壁扱い
					mapdata[px][py] = MAP_WALL;
				}
			}

			// リソース情報
			if( landLevel != 0 ){
				resdata[px][py] = '★' + landLevel + '&nbsp;(' + res[1] + ',' + res[2] + ',' + res[3] + ',' + res[4] + ')';
			}
			else{
				resdata[px][py] = '個人本拠地/拠点';
			}
		}
		else{
			// リソース情報
			resdata[px][py] = '★' + landLevel + '&nbsp;(' + res[1] + ',' + res[2] + ',' + res[3] + ',' + res[4] + ')';
		}

		//----------------//
		// ルート特殊処理 //
		//----------------//
		// 土地レベルでの判定
		if( (landLevel > limit) || (mapdata[px][py] == MAP_NPC) ){
			// レベル超過の土地とNPC砦は壁扱いとする
			mapdata[px][py] = MAP_WALL;   // 壁扱い
		}
		
		// 資源回避での判定
		if(    (season1[cchkres[skipres]][1] == res[1])
		    && (season1[cchkres[skipres]][2] == res[2])
		    && (season1[cchkres[skipres]][3] == res[3])
		    && (season1[cchkres[skipres]][4] == res[4]) ){
			// 回避条件に一致する資源は壁扱いとする
			mapdata[px][py] = MAP_WALL;   // 壁扱い
		}

		// 始点、終点特例
		if( ((px == sx) && (py == sy)) || ((px == ex) && (py == ey)) ){
			mapdata[px][py] = MAP_NONE;   // 始点と目的地はルートに加える
		}
	}

	//--------------------//
	// 始点情報の埋め込み //
	//--------------------//
	mapdata[sx][sy] = MAP_START;

	// 探索情報設定
	var posdata = new Array();
	var maxpos = 0;
	posdata[0] = parseInt(sy) * 51 + parseInt(sx);

	for( var i = 0; i <= maxpos; i++ ){
		var cx = parseInt(posdata[i]) % 51;
		var cy = Math.floor(parseInt(posdata[i]) / 51);

		for( var j = 0; j < chkptn.length; j++ ){
			var lx = parseInt(cx) + parseInt(chkptn[j][0]);
			if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
				continue;
			}
			var ly = parseInt(cy) + parseInt(chkptn[j][1]);
			if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
				continue;
			}

			// 現座標からの移動距離＋１を求める
			var dist = parseInt(mapdata[cx][cy]) + 1;
			// 編集可能？
			if( (mapdata[lx][ly] == MAP_NONE) || (mapdata[lx][ly] == MAP_NPC) ){
				// 距離更新
				mapdata[lx][ly] = dist;

				// 座標登録
				maxpos = maxpos + 1;
				posdata[maxpos] = parseInt(ly) * 51 + parseInt(lx);
			}
			else if( (mapdata[lx][ly] > 0) && (parseInt(mapdata[lx][ly])) > dist ){
				// 距離更新
				mapdata[lx][ly] = dist;

				// 座標登録
				maxpos = maxpos + 1;
				posdata[maxpos] = parseInt(ly) * 51 + parseInt(lx);
			}
		}
	}

	// 事前チェックオンのとき、結果だけ返す
	if( checkmode == "1" ){
		if( mapdata[ex][ey] < 0 ){
			return false;
		}
		else{
			return true;
		}
	}

	// 終点にたどりつけたか？
	if( mapdata[ex][ey] < 0 ){
		alert("目的地に到達するルートを構築できませんでした。構築条件を見直してください。");
		return false;
	}

	//--------------------//
	// サーチルート逆探査 //
	//--------------------//
	posdata[0] = parseInt(ey) * 51 + parseInt(ex);
	maxpos = 0;

	for( var i = 0; i <= maxpos; i++ ){
		var cx = parseInt(posdata[i]) % 51;
		var cy = Math.floor(parseInt(posdata[i]) / 51);

		if( (cx == sx) && (cy == sy) ){
			break;
		}

		// コースとして通過可能な最小資源の土地を調べる
		var lowLevel = 9;
		for( var j = 0; j < chkptn.length; j++ ){
			var lx = parseInt(cx) + parseInt(chkptn[j][0]);
			if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
				continue;
			}
			var ly = parseInt(cy) + parseInt(chkptn[j][1]);
			if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
				continue;
			}

			// 現座標からの移動距離－１を求める
			var dist = parseInt(mapdata[cx][cy]) - 1;
			// 該当する座標？
			if( (mapdata[lx][ly] >= 0) && (parseInt(mapdata[lx][ly])) == dist ){
				var level = resdata[lx][ly].substr(resdata[lx][ly].indexOf("★")+1,1);
				if( resdata[lx][ly].indexOf("個人本拠地/拠点") >= 0 ){
					level = 0;
				}
				if( lowLevel > level ){
					lowLevel = level;
				}
			}
		}

		//--------------------------//
		// 固定・ランダム構築の分岐 //
		//--------------------------//
		checkBox1 = $e_7('//*[@id="ckRouteRandom"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			//--------------------//
			// ランダムルート構築 //
			//--------------------//

			// パターン乱数の算出
			var pattern;
			var rptn = new Array(2);
			pattern = Math.floor(Math.random() * 30);
			if( pattern < 24 ){
				// 十字優先のパターン(80%の確率でこちら)
				rptn[0] = pattern;

				// 後半4パターンの決定
				pattern = Math.floor(Math.random() * 24);
				rptn[1] = pattern + 24;
			}
			else{
				// ×字優先のパターン(20%の確率でこちら)
				pattern = Math.floor(Math.random() * 24);
				rptn[1] = pattern;

				// 前半4パターンの決定
				pattern = Math.floor(Math.random() * 24);
				rptn[0] = pattern + 24;
			}

			// ルート探索
			for( var j = 0; j < 8; j++ ){
				var rno;
				var offset;
				if( j < 4 ){
					rno = rptn[0];
					offset = j;
				}
				else{
					rno = rptn[1];
					offset = j - 4;
				}

				var lx = parseInt(cx) + parseInt(chkptn_r[rno*4 + offset][0]);
				if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
					continue;
				}
				var ly = parseInt(cy) + parseInt(chkptn_r[rno*4 + offset][1]);
				if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
					continue;
				}

				// 現座標からの移動距離－１を求める
				var dist = parseInt(mapdata[cx][cy]) - 1;
				var level = resdata[lx][ly].substr(resdata[lx][ly].indexOf("★")+1,1);
				if( resdata[lx][ly].indexOf("個人本拠地/拠点") >= 0 ){
					level = 0;
				}

				// 該当する座標？
				if( (mapdata[lx][ly] >= 0) && (parseInt(mapdata[lx][ly]) == dist) && (level == lowLevel) ){
					// 座標登録
					maxpos = maxpos + 1;
					posdata[maxpos] = parseInt(ly) * 51 + parseInt(lx);
	
					break;
				}
			}
		}
		else{
			//----------------//
			// 固定ルート構築 //
			//----------------//
			// ルート探索
			for( var j = 0; j < chkptn.length; j++ ){
				var lx = parseInt(cx) + parseInt(chkptn[j][0]);
				if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
					continue;
				}
				var ly = parseInt(cy) + parseInt(chkptn[j][1]);
				if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
					continue;
				}

				// 現座標からの移動距離－１を求める
				var dist = parseInt(mapdata[cx][cy]) - 1;
				var level = resdata[lx][ly].substr(resdata[lx][ly].indexOf("★")+1,1);
				if( resdata[lx][ly].indexOf("個人本拠地/拠点") >= 0 ){
					level = 0;
				}

				// 該当する座標？
				if( (mapdata[lx][ly] >= 0) && (parseInt(mapdata[lx][ly]) == dist) && (level == lowLevel) ){
					// 座標登録
					maxpos = maxpos + 1;
					posdata[maxpos] = parseInt(ly) * 51 + parseInt(lx);

					break;
				}
			}
		}
	}

	//----------------//
	// ルート情報表示 //
	//----------------//
	var baseText = $e_7('//*[@id="routeInfoText"]');
	checkBox1 = $e_7('//*[@id="ckRouteMode2"]');
	var text = '';
	for( var i = maxpos; i >= 0; i-- ){
		var cx = parseInt(posdata[i]) % 51;
		var cy = Math.floor(parseInt(posdata[i]) / 51);

		// areaデータを取ってみる
		var elem = $x_7("//div[@id=\"map51-content\"]//a[@href=\"/land.php?x=" + (parseInt(bx) + cx) + "&y=" + (parseInt(by) - cy) + "#ptop\"]");

		// アイコン表示
		var newhtml;
		if( elem.innerHTML.indexOf("<b>") >= 0 ){
			newhtml = elem.innerHTML.replace(/<b>.*<\/b>/,"<font style=\"border-style: solid; border-color: cyan; background-color:cyan;\">　</font>");
		}
		else{
			if( (elem.innerHTML.indexOf(">S</font>") >= 0) || (elem.innerHTML.indexOf(">E</font>") >= 0) ){
				newhtml = elem.innerHTML;
			}
			else{
				newhtml = elem.innerHTML.replace(/<font.*>.*<\/font>/,"<font style=\"border-style: solid; border-color: cyan; background-color:cyan;\">　</font>");
			}
		}
		elem.innerHTML = newhtml;

		if( text != '' ){
			text = text + '<br>';
		}

		// 資源表示での出力切り替え
		if( checkBox1.snapshotItem(0).checked == false ){
			// 資源出力あり
			text = text + '(' + (parseInt(bx) + cx) + ',' + (parseInt(by) - cy) + ')&nbsp;&nbsp;' + resdata[cx][cy];
		}
		else{
			// 資源出力なし
			if( resdata[cx][cy].indexOf("★") >= 0 ){
				text = text + '(' + (parseInt(bx) + cx) + ',' + (parseInt(by) - cy) + ')&nbsp;&nbsp;'
					+ resdata[cx][cy].substr(0,2);
			}
			else{
				text = text + '(' + (parseInt(bx) + cx) + ',' + (parseInt(by) - cy) + ')&nbsp;&nbsp;' + resdata[cx][cy];
			}
		}
	}

	// ルート表の表示
	baseText.snapshotItem(0).innerHTML = text;

	return true;
}

//--------------------//
// 出兵アイコンクリア //
//--------------------//
function attackIconClear() {
	// 出兵アイコンのクリア
	var checkBox = $e_7('//*[@id="ckUnion"]');

	// マップに埋め込んだマーク画像を全部消す
	var rollover = $d("rollover");

	// 無効なら画像を消す
	if( checkBox.snapshotItem(0).checked == false ){
		// すでに画像が登録されてるか調べる
		var en = $e_7('//*[@name="atkIcon"]');
		if( en.snapshotLength > 0 ){
			// 画像がいたら消す
			for( var i = 0; i < en.snapshotLength; i++ ){
				var ex = en.snapshotItem(i);
				var ex_p = ex.parentNode;
				ex_p.removeChild(ex);
			}
		}
	}
	else{
		// 出兵情報マッピング
		unionAttackInfo();
	}
}
//faraway 7.NPC砦、領土情報検索ツールのソース(bro3_npc_castle_info2.user.js)終了

//faraway 8.右クリック拡張のソース(b3rclick.user.js)開始
//================================================================================
//8.右クリック拡張
//================================================================================
function disp_rightclick() {	//faraway
//window.alert("8.右クリック拡張:" + location.pathname);	//faraway
// ==UserScript==
// @name           b3rClick
// @namespace      com.dosukoi-kissa.www
// @description    ブラウザ三国志ベースのアプリケーションの右クリックを拡張するプログラムです。 This script is an right-click extension, browser-3gokushi based applications 
// @include        http://*.3gokushi.jp/*
// @include        http://*.1kibaku.jp/*
// @include        http://*.17pk.com.tw/*
// @include        http://*.landsandlegends.com/*
// @author         su-zan
// @maintainer     romer
// @version        1.1.0.1
// ==/UserScript==
//faraway(function () {
    
    /**
     * gettextっぽい感じのやつ
     * @param {String} message
     * @param {Object} messageObject
     * @function
     */
    var _ = (function () {
        var locale = navigator.language.toLowerCase().substr(0,2),
        domain = location.hostname.replace(/^[^.]+\./,'').toLowerCase(),
        checks = [
                  {'default' : '_ja','locale' : locale},
                  {'default' : '_3gokushi.jp','locale' : domain}
                 ];
    
        return function (message,messageObject) {
            var messages,defKey;
    
            checks.forEach(function (check) {
                var key = '_'+check.locale;
                if (Object.prototype.hasOwnProperty.call(messageObject, key)) {
                    messages = messageObject[key];
                    defKey = check['default'];
                }
            });
            return messages[message] ? messages[message] : messageObject[defKey][message];
        };
    })(),
    
    NAMESPACE = 'com.dosukoi-kissa.www/'+location.host,　/*faraway120125+location.host*/
    crossBrowserUtility = initCrossBrowserSupport(),
    systemMessages = {
            '_3gokushi.jp' : {
                'LordName' : '\u541b\u4e3b\u540d',
                'Flatland' : '\u5e73\u5730'
            },
            '_1kibaku.jp' : {
                'LordName' : '\u982d\u9996\u540d',
                'Flatland' : '\u5e73\u5730'
            },
            '_landsandlegends.com' : {
                'LordName' : 'Lord',
                'Flatland' : 'Flatland'
            },
            '_17pk.com.tw' : {
                'LordName' : '\u541b\u4e3b\u540d',
                'Flatland' : '\u5e73\u5730'
            }
    },
    localeMessages = {
        '_ja' : {
            'Infomation' : '\u60c5\u5831',
            'Deploy' : '\u51fa\u5175',
            'CenterMap' : '\u4e2d\u592e\u306b\u8868\u793a\u3059\u308b',
            'ConvertTerritory' : '\u3053\u306e\u9818\u5730\u3092\u62e0\u70b9\u306b\u3059\u308b',
            'LvUpTerritory' : '\u3053\u306e\u9818\u5730\u3092\u30ec\u30d9\u30eb\u30a2\u30c3\u30d7',
            'DiscardTerritory' : '\u3053\u306e\u9818\u5730\u3092\u7834\u68c4\u3059\u308b',
            'LvUp' : '\u30ec\u30d9\u30eb\u30a2\u30c3\u30d7',
            'LvUpx2' : '\u30ec\u30d9\u30eb\u30a2\u30c3\u30d7x2',
            'Building' : '\u5efa\u7bc9>>',
            'CityField' : '\u90fd\u5e02\u753b\u9762',
            'MapField' : '\u5730\u56f3\u753b\u9762',
            'GovernorField' : '\u5185\u653f\u753b\u9762'
        },
        '_en' : {
            'Infomation' : 'infomation',
            'Deploy' : 'deploy',
            'CenterMap' : 'Center on map',
            'ConvertTerritory' : 'Convert this Territory',
            'LvUpTerritory' : 'Level Up Territory',
            'DiscardTerritory' : 'Discard Territory',
            'LvUp' : 'Level Up',
            'LvUpx2' : 'Level Up x2',
            'Building' : 'Building>>',
            'CityField' : 'City Field',
            'MapField' : 'Map Field',
            'GovernorField' : 'Governor Field'
        },
        '_zh' : {
            'Infomation' : '\u4fe1\u606f',
            'Deploy' : '\u51fa\u5175',
            'CenterMap' : '\u986f\u793a\u6b64\u8655\u70ba\u4e2d\u5fc3',
            'ConvertTerritory' : '\u5c07\u9818\u5730\u5efa\u70ba\u64da\u9ede',
            'LvUpTerritory' : '\u9818\u5730\u7684\u5347\u7d1a',
            'DiscardTerritory' : '\u6368\u68c4\u6b64\u9818\u5730',
            'LvUp' : '\u4e0a\u6607\u7b49\u7d1a',
            'LvUpx2' : '\u4e0a\u6607\u7b49\u7d1ax2',
            'Building' : '\u5efa\u9020>>',
            'CityField' : '\u90fd\u5e02\u753b\u9762',
            'MapField' : '\u5730\u5716\u753b\u9762',
            'GovernorField' : '\u5167\u653f\u753b\u9762'
        }
    },
    
    $ = function (id,pd) {return pd ? pd.getElementById(id) : document.getElementById(id);},
    /**
     * $x
     * @description 以前の$a xpathを評価し結果を配列で返す
     * @param {String} xp
     * @param {HTMLElement|HTMLDocument} dc
     * @returns {Array}
     * @throws
     * @function
     */
    $x = function(xp, dc) {function c(f) {var g = '';if (typeof f === 'string') {g = f;}var h = function(a) {var b = document.implementation.createHTMLDocument('');var c = b.createRange();c.selectNodeContents(b.documentElement);c.deleteContents();b.documentElement.appendChild(c.createContextualFragment(a));return b;};if (0 <= navigator.userAgent.toLowerCase().indexOf('firefox')) {h = function(a) {var b = document.implementation.createDocumentType('html','-//W3C//DTD HTML 4.01//EN','http://www.w3.org/TR/html4/strict.dtd');var c = document.implementation.createDocument(null, 'html', b);var d = document.createRange();d.selectNodeContents(document.documentElement);var e = c.adoptNode(d.createContextualFragment(a));c.documentElement.appendChild(e);return c;};}return h(g);}var m = [], r = null, n = null;var o = dc || document.documentElement;var p = o.ownerDocument;if (typeof dc === 'object' && typeof dc.nodeType === 'number') {if (dc.nodeType === 1 && dc.nodeName.toUpperCase() === 'HTML') {o = c(dc.innerHTML);p = o;}else if (dc.nodeType === 9) {o = dc.documentElement;p = dc;}}else if (typeof dc === 'string') {o = c(dc);p = o;}try {r = p.evaluate(xp, o, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for ( var i = 0, l = r.snapshotLength; i < l; i++) m.push(r.snapshotItem(i));}catch (e) {try {var q = p.evaluate(xp, o, null, XPathResult.ANY_TYPE, null);while (n = q.iterateNext()) m.push(n);}catch (e) {throw new Error(e.message);}}return m;},
    
    /**
     * $s
     * @description 以前の$x xpathを評価し1つの結果を返す
     * @param {String} xp
     * @param {HTMLElement|HTMLDocument} dc
     * @returns {Node}
     * @throws
     * @see $x
     * @function
     */
    $s = function(xp, dc) { return $x(xp,dc).shift();},
    
    /**
     * $e
     * @param {HTMLElement|HTMLDocument|Window} doc
     * @param {String|Object} event string or event.click=f or event.click=[f,f,f]
     * @param {Function} event handler
     * @param {Boolean} [useCapture=false]
     * @function
     */
    $e = function(doc, event, func, useCapture) {var eventList = event;var eType = null;var capture = useCapture || false;if (typeof event == 'string') {eventList = {};eventList[event] = [func];} else {for (eType in eventList) {if (typeof eventList[eType] == 'object'&& eventList[eType] instanceof Array) {continue;}eventList[eType] = [ event[eType] ];}}for (eType in eventList) {var eventName = eType;for ( var i = 0; i < eventList[eType].length; i++) {doc.addEventListener(eventName, eventList[eType][i], capture);}}},
    
    //初期設定
    menuWarp = createElement('div'),
    mainMenu = createElement('div', {
        'attribute' : {
            'class' : 'rMenu'
        },
        'css' : {
            'padding': '3px',
            'opacity': 0.8,
            'font-size': 'small',
            'color': '#333333',
            'background-color': '#000000',
            'border': '1px solid #7777FF',
            'position': 'absolute',
            'z-index': 10000,
            'cursor': 'pointer',
            'display': 'none',
            'min-width': '75px'
        },
        'innerText' : 'none'
    }),
    
    subMenu = mainMenu.cloneNode(false);
    
    subMenu.setAttribute('ready','false');
    subMenu.innerHTML = "<ul><li>testdayo</li></ul>";
    
    document.body.appendChild(menuWarp);
    
    menuWarp.appendChild(mainMenu);
    menuWarp.appendChild(subMenu);
    
    $e(mainMenu, {
        'mouseover' : function(e){
            mainMenu.style.display = "block";
        },
        'mouseout' : function(e){
            mainMenu.style.display = "none";
        }
    });
    
    $e(subMenu, {
        'mouseover' : function(e){
            mainMenu.style.display = "block";
            subMenu.style.display = "block";
        },
        'mouseout' : function(e){
            mainMenu.style.display = "none";
            subMenu.style.display = "none";
        }
    });
    
    
    subMenu.innerHTML = "<ul><li>testdayo</li></ul>";
    
    
    var userName = GM_getValue(NAMESPACE+"userName",null);
    var preCheckTime = GM_getValue(NAMESPACE+"preCheckTime_UserName", null);
    var now = new Date();
    if (!preCheckTime) {
        preCheckTime = now;
    }
    else {
        preCheckTime = new Date(preCheckTime);
    }
    
    if (userName == null || (preCheckTime.getTime() + 24*60*60*1000) <= now.getTime()) {
        var interval = 0;
        var getUserName = function(){
            GM_xmlhttpRequest({
                url:location.protocol + "//" + location.host+"/user/"+location.search,
                method : 'GET',
                onload : function(res){
                    var dom = document.createElement("html");
                    dom.innerHTML = res.responseText;
                    var ret = $x('//table[contains(concat(" ",normalize-space(@class)," "), " commonTables ")]//tr[2]/td[2]',dom);
                    ret.forEach(function(self){
                        userName = self.innerHTML;
                        GM_setValue(NAMESPACE+"userName",userName);
                        GM_setValue(NAMESPACE+"preCheckTime_UserName",new Date().getTime());
                    });
                    if (userName) {
                        clearInterval(interval);
                    }
                }
            });
        };
        setTimeout(getUserName,0);
    }
    
    // 右クリック時の動作
    
    function rightClickMenu(){
        this.init.apply(this,arguments);
    }
    
    rightClickMenu.prototype = {
        init:function(){
            this.ruleList = new Array();
            this.ruleList.length = 0;
            this.menu = new Array();
            this.menu.length = 0;
        },
        addMenu:function(menuName){
            this.menu[menuName] = eval(menuName);
        },
        addRule:function(){
            this.ruleList[this.ruleList.length] = {
                type:arguments[0],
                value:arguments[1],
                menu:arguments[2]
            };
        },
        setListener:function(){
            var callee = this;
    
    
    
            var mFunc = function(event){
                var resultMenu = callee.evaluate.apply(callee,arguments);
                if(resultMenu != false && event.button == '2'){
                    if (typeof resultMenu.ready == 'function') {
                        resultMenu.ready(event);
                    }
    
                    var addWarp = document.createElement("UL");
                    for(var n=0;n < resultMenu.items.length;n++){
                        var addDoc = null;
                        var item = resultMenu.items[n];
                        var name = callee.getValue(item,"name",arguments);
                        if (!name) {
                            continue;;
                        }
                        switch(item.type){
                            case 'link':
                                var match = null;
                                var href = callee.getValue(item,"href",arguments);
                                addDoc = document.createElement("A");
                                if (0 < href.length) {
                                    if (href.lastIndexOf("&") == (href.length - 1)) {
                                        href = href.slice(0,-1);
                                    }
                                    if ((match = event.target.href.match(/[\?|&](([x|y]|SSID)=[\w,-]+)/ig)) != null) {
                                        if (href.lastIndexOf("?") != (href.length - 1)) {
                                            href += "&";
                                        }
                                        href += match.join("").replace("?","");
                                    }
                                    $e(addDoc,"click",function() {
                                        subMenu.style.display = "none";
                                        mainMenu.style.display = "none";
                                    });
                                }
                                else {
                                    href = "javascript:void(0);";
                                }
    
                                addDoc.href = href;
                                addDoc.appendChild(document.createTextNode(name));
                                break;
                            case 'text':
                                addDoc = document.createElement("SPAN");
                                addDoc.innerHTML = name;
                                break;
                        }
    
                        if (typeof item.events == 'object') {
                            $e(addDoc,item.events);
                        }
    
                        var li = document.createElement("LI");
                        li.appendChild(addDoc);
                        addWarp.appendChild(li);
    
                    }
    
                    mainMenu.replaceChild(addWarp,mainMenu.firstChild);
    
                    mainMenu.style.display = 'block';
                    mainMenu.style.top = event.pageY - 5 + 'px';
                    mainMenu.style.left = event.pageX - 5  + 'px';
    
                    var warpWidth = parseFloat(document.defaultView.getComputedStyle(addWarp, '').width);
                    var bodyWidth = parseFloat(document.defaultView.getComputedStyle(mainMenu.parentNode, '').width);
    
                    if (bodyWidth < (event.pageX + warpWidth + 10)) {
                        mainMenu.style.left = (bodyWidth - warpWidth - 15) + "px";
                    }
    
                } else {
                    mainMenu.style.display = 'none';
                }
    
                event.preventDefault();
                return false;
            };
    
    
            ['(id("mapOverlayMap") | id("map51-content")//div)/*[contains("aAareaAREA",name(.))][@href]','//div[contains(concat(" ",normalize-space(@class)," "), " sideBoxInner ") and contains(concat(" ",normalize-space(@class)," "), " basename ")]//li/a','id("lodgment")/div[contains(concat(" ",normalize-space(@class)," "), " floatInner ")]//li/a[not(contains(concat(" ",normalize-space(@class)," "), " map-basing "))]'].forEach(function(xpath){
                $x(xpath).forEach(function(self){
                    $e(self,'contextmenu',mFunc);
                 });
            });
        },
        evaluate : function (event) {
            for (var n=0;n<this.ruleList.length;n++) {
                if (this.ruleList[n].type != 'cond') {
                    if (eval("event.target." + this.ruleList[n].type) == this.ruleList[n].value) {
                        return this.menu[this.ruleList[n].menu];
                    }
                } else {
                 if(this.ruleList[n].value(event)){
                        return this.menu[this.ruleList[n].menu];
                    }
                }
            }
            return false;
        },
        getValue : function(item,prop,orgArguments) {
            switch (typeof item[prop]) {
                case "function":
                    return item[prop].apply(item,orgArguments);
                case "string":
                    return item[prop];
            }
            return "";
        }
    };
    
    // ***************************メニューオブジェクト*********************
    var mapMenu = {
        items:[
        {
            name:function(e){
                var name = '<b>';
                if (e.target.nodeName.toUpperCase() == 'A') {
                    $x('@onmouseover',e.target).forEach(function(mouseover){
                        var doc = mouseover.value.replace(/^[^']+'|'[^']+$/g,'');
                        name += $s('//dt[contains(concat(" ",normalize-space(@class)," "), " bigmap-caption ")]/text()',doc).data;
                    });
                }
                else {
                    name += e.target.alt;
                }
                return name + "</b>";
            },
            type:"text"
        },
        {
            name: _("Infomation",localeMessages),
            type:"link",
            href:"land.php?"
        },
        {
            name:_("Deploy",localeMessages),
            type:"link",
            href:"facility/castle_send_troop.php?"
        },
        {
            name:_("CenterMap",localeMessages),
            type:"link",
            href:"map.php?"
        },
        {
            name: function(e){
                var isMyTerritory = false;
                if (e.target.nodeName.toUpperCase() == 'A') {
                    $x('@onmouseover',e.target).forEach(function(mouseover){
                        var doc = mouseover.value.replace(/^[^']+'|'[^']+$/g,'');
                        var text = $s('//dt[contains(text(),"'+_('LordName', systemMessages)+'")]/following-sibling::dd[1]/text()',doc);
                        if (text && text.data == userName) {
                            isMyTerritory = true;
                        }
                    });
                }
                else {
                    isMyTerritory = new RegExp("'[^']+'[^']+'"+userName+"'","i").test(e.target.getAttribute("onmouseover"));
                }
                return isMyTerritory ? _("ConvertTerritory",localeMessages) : null;
            },
            type:"link",
            href:"facility/select_type.php?"
        },
        {
            name: function(e){
                var isMyTerritory = false;
                if (e.target.nodeName.toUpperCase() == 'A') {
                    $x('@onmouseover',e.target).forEach(function(mouseover){
                        var doc = mouseover.value.replace(/^[^']+'|'[^']+$/g,'');
                        var text = $s('//dt[contains(text(),"'+_('LordName', systemMessages)+'")]/following-sibling::dd[1]/text()',doc);
                        if (text && text.data == userName) {
                            isMyTerritory = true;
                        }
                    });
                }
                else {
                    isMyTerritory = new RegExp("'[^']+'[^']+'"+userName+"'","i").test(e.target.getAttribute("onmouseover"));
                }
                return isMyTerritory ? _("LvUpTerritory",localeMessages) : null;
            },
            type:"link",
            href:"territory_proc.php?"
        },
        {
            name:function(e){
                var isMyTerritory = false;
                if (e.target.nodeName.toUpperCase() == 'A') {
                    $x('@onmouseover',e.target).forEach(function(mouseover){
                        var doc = mouseover.value.replace(/^[^']+'|'[^']+$/g,'');
                        var text = $s('//dt[contains(text(),"'+_('LordName', systemMessages)+'")]/following-sibling::dd[1]/text()',doc);
                        if (text && text.data == userName) {
                            isMyTerritory = true;
                        }
                    });
                }
                else {
                    isMyTerritory = new RegExp("'[^']+'[^']+'"+userName+"'","i").test(e.target.getAttribute("onmouseover"));
                }
                return isMyTerritory ? _("DiscardTerritory",localeMessages) : null;
            },
            type:"link",
            href:"territory_proc.php?mode=remove&"
        }
        ]
    };
    
    var villageMenu = {
        items:[
        {
            name:function(event){
                return "<b>" + event.target.alt + "</b>";
            },
            type:"text"
        },
        {
            name: _("Infomation",localeMessages),
            type:"link",
            href:"facility/select_facility.php?"
        },
        {
            name:function(event){
                if (event.target.alt == _('Flatland', systemMessages)) {
                    return null;
                }
                return _("LvUp",localeMessages);
            },
            type:"link",
            href:"facility/build.php?",
            events : {
                click : function (event) {
                    subMenu.style.display = "none";
                    mainMenu.style.display = "none";
			event.target.href.match(/^.*[\?\&]x=(-?[0-9]+)&.*y=(-?[0-9]+).*$/);
			x=RegExp.$1;y=RegExp.$2;
			hiro_lvupfacility(x,y,document.evaluate('//*[@id="basepoint"]/span[@class="xy"]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0).innerHTML);
                    event.preventDefault();
                    return false;
		}
            }
        },
        {
            name:function(event){
                if (event.target.alt == _('Flatland', systemMessages)) {
                    return null;
                }
                return _("LvUpx2",localeMessages);
            },
            type:"link",
            href:"facility/build.php?",
            events : {
                click : function (event) {
                    subMenu.style.display = "none";
                    mainMenu.style.display = "none";
			event.target.href.match(/^.*[\?\&]x=(-?[0-9]+)&.*y=(-?[0-9]+).*$/);
			x=RegExp.$1;y=RegExp.$2;
					var c = {};
					c['x']=x;c['y']=y;
					c['village_id']=getVillageID(document.evaluate('//*[@id="basepoint"]/span[@class="xy"]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0).innerHTML);
					c['ssid']=getCookie("SSID");
					j$.post("http://"+HOST+"/facility/build.php",c,function(){});
			hiro_lvupfacility(x,y,document.evaluate('//*[@id="basepoint"]/span[@class="xy"]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0).innerHTML);
//                    GM_xmlhttpRequest({url:event.target.href, method : 'GET'});
//                    GM_xmlhttpRequest({
//                        url:event.target.href,
//                        method : 'GET',
//                        onload:function(res){
//                            location.reload();
//                        }
//                    });
                    event.preventDefault();
                    return false;
                }
            }
        },
        {
            name:function(event){
                if (event.target.alt == _('Flatland', systemMessages)) {
                    return _('Building', localeMessages);
                }
                return "";
            },
            type:"link",
            href:"",
            events : {
                mouseover : function(event) {
                    var enabled = function() {
                        if (subMenu.getAttribute("ready") == "false") {
                            setTimeout(enabled,200);
                            return;
                        };
                        var left = parseFloat(mainMenu.style.left) + ((mainMenu.clientWidth < 75) ? 75 : mainMenu.clientWidth) - 15;
                        subMenu.style.display = 'block';
                        subMenu.style.top = event.pageY + 'px';
                        subMenu.style.left = left + 'px';
                    };
                    enabled();
                },
                mouseout: function(e) {
                    subMenu.style.display = 'none';
                },
                click : function (e) {
                    e.preventDefault();
                    return false;
                }
            }
        }
        ],
        ready : function(event) {
            var baseUrl = location.protocol + "//"+location.hostname+"/";
            subMenu.setAttribute("ready","false");
            GM_xmlhttpRequest({
                url:event.target.href,
                method : 'GET',
                onload:function(respons){
                    subMenu.innerHTML = "";
                    var addWarp = document.createElement("UL");
                    subMenu.appendChild(addWarp);
                    var dom = document.createElement("html");
                    dom.innerHTML = respons.responseText;
                    $x('//table[@summary="object"]',dom).forEach(function(self){
                        var addDocWarp = document.createElement("LI");
                        var addDoc = document.createElement("A");
                        $x('.//th[contains(concat(" ",normalize-space(@class)," "), " mainTtl ")]',self).forEach(function(th){
                            addDoc.innerHTML = th.innerHTML;
                        });
//右クリック
                        $x('.//div[contains(concat(" ",normalize-space(@class)," "), " lvupFacility ")]/p[contains(concat(" ",normalize-space(@class)," "), " main ")]/a',self).forEach(function(a){
                            addDoc.href = baseUrl + "/facility/" + (a.getAttribute('href').replace(baseUrl,""));
                        });
                        $e(addDoc,'click',function(e){subMenu.style.display = "none";mainMenu.style.display = "none";;});
                        addDocWarp.appendChild(addDoc);
                        addWarp.appendChild(addDocWarp);
                    });
                    subMenu.setAttribute("ready","true");
                }
            });
        }
    };
    
    var sidebarVillageMenu = {
        items:[
        {
            name:function(event){
                return "<b>" + event.target.title + "</b>";
            },
            type:"text"
        },
        {
            name: _("CityField",localeMessages),
            type:"link",
            href:function(event){
                var res = null;
                var query = "";
                if((res = event.target.href.match(/village_id=([^&]*)/i)) != null){
                    query = res[1];
                }
                return "http://" + location.host + "/village_change.php?page=%2Fvillage.php&village_id=" + query;
            }
        },
        {
            name:_("MapField",localeMessages),
            type:"link",
            href:function(event){
                var res = null;
                var query = "";
                if((res = event.target.href.match(/village_id=([^&]*)/i)) != null){
                    query = res[1];
                }
                return "http://" + location.host + "/village_change.php?page=%2Fmap.php&village_id=" + query;
            }
        },
        {
            name:_("GovernorField",localeMessages),
            type:"link",
            href:function(event){
                var res = null;
                var query = "";
                if((res = event.target.href.match(/village_id=([^&]*)/i)) != null){
                    query = res[1];
                }
                return "http://" + location.host + "/village_change.php?page=%2Fcard%2Fdomestic_setting.php&village_id=" + query + "&";
            }
        }
        ]
    };
    
    // ***************************メニューオブジェクトここまで***************
    
    // **************************全体*************************
    var rMenu = new rightClickMenu();
    rMenu.setListener();
    
    rMenu.addMenu('sidebarVillageMenu');
    rMenu.addRule("cond",function(event){
        if(event.target.href != "undefined" && event.target.href.match(/village_change.php/i)){
            return true;
        }
    },'sidebarVillageMenu');
    
    // **************************地図画面*************************
    if(document.URL.match(/(?:big_)?map\.php/i)){
        rMenu.addMenu('mapMenu');
        rMenu.addRule('tagName','AREA','mapMenu');
        rMenu.addRule('tagName','A','mapMenu');
    }
    
    // **************************都市画面*************************
    if(document.URL.match(/village.php/i)){
        rMenu.addMenu('villageMenu');
        rMenu.addRule('tagName','AREA','villageMenu');
    }
    GM_addStyle([
                    ".rMenu li b{ color:#FFAAAA;list-style :none outside none;white-space: nowrap;}",
                    ".rMenu li{ color:#FFFFFF;list-style :none outside none;white-space: nowrap;}",
                    ".rMenu a:link{text-decoration:none;padding-right:2px;padding-left:1px}",
                    ".rMenu a:visited {text-decoration:none;padding-right:2px;padding-left:1px}",
                    ".rMenu a:hover {background-color:#DDDDDD;color:#333333;text-decoration:none;}",
                    ".rMenu a:active {background-color:#DDDDDD;color:#333333;text-decoration:none;}",
                    ".rMenu a {display: block;width: 98%;margin-right: 1px;}",
                    "#headerArea{ display:none; }",
                    ].join("\n")
                );
    
    
    /**
    *
    * @param {String} text
    * @returns {Element}
    */
    function createText(text) {
       return document.createTextNode(text);
    }
    
    /**
    * Function createElement
    *
    * @param {String} elementName
    * @param {Object} [option]
    * @param {HTMLDocument} [doc]
    * @returns {Element}
    */
    function createElement(elementName, option, doc) {
       var pageDocument = doc ? doc : document;
       var retElement = elementName == 'img' ? new Image() : pageDocument
               .createElement(elementName);
    
       if (typeof option == 'object') {
           if (typeof option.attribute == 'object') {
               for ( var attrName in option.attribute) {
                   retElement.setAttribute(attrName, option.attribute[attrName]);
               }
           }
           if (typeof option.events == 'object') {
               $e(retElement, option.events);
           }
           if (typeof option.innerText == 'string') {
               retElement.appendChild(pageDocument.createTextNode(option.innerText));
           }
           if (typeof option.css == 'object') {
               var cssString = '';
               for ( var cssProp in option.css) {
                   retElement.style.setProperty(cssProp, option.css[cssProp], '');
               }
           } else if (option.css == 'string') {
               retElement.style.cssText = option.css;
           }
       }
       return retElement;
    }
    
    
    /**
     * initGMFunctions
     * @description GM関数初期化
     */
    function initGMFunctions() {
        var hasGM = (function() {
            var result = {},
                notSupportReg = /not\s*support/i,
                existsAPI = function(func) {
                    return typeof func === 'function' &&
                                    ( Object.prototype.hasOwnProperty.call(func, '__proto__') === false ||
                                            notSupportReg.test(String(func)) === false );
                };
            [
                    'GM_getValue', 'GM_setValue', 'GM_listValues', 'GM_deleteValue', 'GM_addStyle',
                    'GM_log', 'GM_xmlhttpRequest', 'GM_openInTab',
                    'GM_getResourceURL', 'GM_getResourceText', 'GM_registerMenuCommand'
            ].forEach(function(methodName) {
                var resName = methodName.substr(3);
                result[resName] = false;
                
                if (Object.prototype.hasOwnProperty.call(this, methodName) && existsAPI(this[methodName])) {
                    result[resName] = true;
                }
            });
            return result;
        })();
    
        /**
         * GM_addStyle
         * @param {String} css css text
         * @function
         */
        if (hasGM.addStyle === false) {
            GM_addStyle = function(css) {
                var style = document.evaluate('//head/style[not(@src) and last()]', document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null);
                style = style && style.singleNodeValue || document.createElement('style');
                style.type = 'text/css';
                style.appendChild(document.createTextNode(css));
                if (!(style.parentNode || style.parentElement)) {
                    document.getElementsByTagName('head')[0].appendChild(style);
                }
            };
        }
        
        /**
         * GM_setValue
         * @param {String} name storage key
         * @param {String|Number|Boolean} value storage saved object
         * @throws {TypeError}
         * @see localStorage
         * @function
         */
        if (hasGM.setValue === false) {
            GM_setValue = function(name, value) {
                switch (typeof value) {
                    case 'string':
                    case 'number':
                    case 'boolean':
                        break;
                    default:
                        throw new TypeError();
                }
    
                value = (typeof value)[0] + value;
                localStorage.setItem(name, value);
            };
        }
    
        /**
         * GM_getValue
         * @param {String} key storage key
         * @param {Object} [defaultValue] any Object
         * @returns {Object}
         * @see localStorage
         * @function
         */
        if (hasGM.getValue === false) {
            GM_getValue = function(key, defaultValue) {
                var value = localStorage.getItem(key);
                if (!value) {
                    return defaultValue;
                }
                var type = value[0];
                value = value.substring(1);
                switch (type) {
                    case 'b':
                        return value == 'true';
                    case 'n':
                        return Number(value);
                    default:
                        return value;
                }
            };
        }
    
        /**
         * GM_deleteValue
         * @param {String} key storage key
         * @see localStorage
         * @function
         */
        if (hasGM.deleteValue === false) {
            GM_deleteValue = function(key) {
                localStorage.removeItem(key);
            };
        }
    
        /**
         * GM_listValues
         * @returns {Array}
         * @see localStorage
         * @function
         */
        if (hasGM.listValues === false) {
            GM_listValues = function() {
                var len = localStorage.length;
                var res = [];
                var key = '';
                for ( var i = 0; i < len; i++) {
                    key = localStorage.key(i);
                    res[key] = key;
                }
                return res;
            };
        }
    
        /**
         * GM_log
         * @param {Object} message any Object
         * @function
         * @see console
         */
        if (hasGM.log === false) {
            GM_log = function(message) {
                if (typeof console === 'object' && Object.prototype.hasOwnProperty.call(console, 'log')) {
                    console.log(message);
                }
                else if (typeof opera == 'object' && Object.prototype.hasOwnProperty.call(opera, 'postError')) {
                    opera.postError(message);
                }
                else {
                    window.alert(message);
                }
            };
        }
    
        /**
         * function GM_registerMenuCommand
         * @param {String} caption
         * @param {Function} commandFunc
         * @param {String} [accelKey]
         * @param {String} [accelModifiers]
         * @param {String} [accessKey]
         * @function
         */
        if (hasGM.registerMenuCommand === false) {
            GM_registerMenuCommand = function(caption, commandFunc, accelKey, accelModifiers, accessKey) {
                throw new Error('not supported');
            };
        }
    
        /**
         * GM_openInTab
         * @param {String} url uri strings
         * @function
         */
        if (hasGM.openInTab === false) {
            GM_openInTab = function(uri) {
                window.open(uri, '');
            };
        }
    
        /**
         * GM_xmlhttpRequest
         * @param requestParam Object request parameter settings
         * @param requestParam.url request url string
         * @param [requestParam.method="GET"] request method. default is GET
         * @param [requestParam.data] request data
         * @param [requestParam.headers] request headers object
         * @param [requestParam.onload] request complite event handler
         * @param [requestParam.onerror] request error event handler
         * @param [requestParam.onreadystatechange] request readystatechange event handler
         * @returns {XMLHttpRequest}
         */
        if (hasGM.xmlhttpRequest === false) {
            GM_xmlhttpRequest = function(requestParam) {
                var xhr;
                if (typeof XMLHttpRequest == 'function') {
                    xhr = XMLHttpRequest;
                }
                else {
                    return null;
                }
                var req = new xhr();
                [
                        'onload', 'onerror', 'onreadystatechange'
                ].forEach(function(event) {
                    if ((event in requestParam) == false) {
                        return;
                    }
                    req[event] = function() {
                        var isComplete = (req.readyState == 4);
                        var responseState = {
                            responseText : req.responseText,
                            readyState : req.readyState,
                            responseHeaders : isComplete ? req.getAllResponseHeaders() : '',
                            status : isComplete ? req.status : 0,
                            statusText : isComplete ? req.statusText : '',
                            finalUrl : isComplete ? requestParam.url : ''
                        };
                        requestParam[event](responseState);
                    };
                });
        
                try {
                    req.open(requestParam.method ? requestParam.method : 'GET', requestParam.url, true);
                }
                catch (e) {
                    if (requestParam.onerror) {
                        requestParam.onerror({
                            readyState : 4,
                            responseHeaders : '',
                            responseText : '',
                            status : 403,
                            statusText : 'Forbidden',
                            finalUrl : ''
                        });
                    }
                    return null;
                }
        
                if ('headers' in requestParam && typeof requestParam.headers == 'object') {
                    for ( var name in requestParam.headers) {
                        req.setRequestHeader(name, requestParam.headers[name]);
                    }
                }
        
                req.send(('data' in requestParam) ? requestParam.data : null);
                return req;
            };
        }
    
    }
    
    /**
     * initJSON
     * @description JSONがない場合とprototype.jsとJSONオブジェクトの衝突回避用(forOpera)
     * @returns {Object}
     */
    function initJSON() {
        var myJSON = function() {
            if (typeof JSON !== 'object' || typeof Prototype === 'object') {
                this.__proto__ = (function() {
                    // parser and stringify from json.js https://github.com/douglascrockford/JSON-js
                    
                    var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
                        escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
                        gap,
                        indent,
                        meta = {
                            '\b' : '\\b',
                            '\t' : '\\t',
                            '\n' : '\\n',
                            '\f' : '\\f',
                            '\r' : '\\r',
                            '"' : '\\"',
                            '\\' : '\\\\'
                        },
                        rep,result = {};
    
                    function quote(string) {
                        escapable.lastIndex = 0;
                        return escapable.test(string) ? '"' + string.replace(escapable, function(a) {
                            var c = meta[a];
                            return typeof c === 'string' ? c : '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
                        }) + '"' : '"' + string + '"';
                    }
                    
                    function str(key, holder) {
                        var i, k, v, length, mind = gap, partial, value = holder[key];
                        if (value && typeof value === 'object' && typeof value.toJSON === 'function') {
                            value = value.toJSON(key);
                        }
                        if (typeof rep === 'function') {
                            value = rep.call(holder, key, value);
                        }
                        switch (typeof value) {
                            case 'string':
                                return quote(value);
                            case 'number':
                                return isFinite(value) ? String(value) : 'null';
                            case 'boolean':
                            case 'null':
                                return String(value);
                            case 'object':
                                if (!value) {
                                    return 'null';
                                }
                                gap += indent;
                                partial = [];
                                if (Object.prototype.toString.apply(value) === '[object Array]') {
                                    length = value.length;
                                    for (i = 0; i < length; i += 1) {
                                        partial[i] = str(i, value) || 'null';
                                    }
                                    v = partial.length === 0 ? '[]' : gap ? '[\n' + gap + partial.join(',\n' + gap) + '\n' + mind + ']' : '[' + partial.join(',') + ']';
                                    gap = mind;
                                    return v;
                                }
                                if (rep && typeof rep === 'object') {
                                    length = rep.length;
                                    for (i = 0; i < length; i += 1) {
                                        if (typeof rep[i] === 'string') {
                                            k = rep[i];
                                            v = str(k, value);
                                            if (v) {
                                                partial.push(quote(k) + (gap ? ': ' : ':') + v);
                                            }
                                        }
                                    }
                                }
                                else {
                                    for (k in value) {
                                        if (Object.prototype.hasOwnProperty.call(value, k)) {
                                            v = str(k, value);
                                            if (v) {
                                                partial.push(quote(k) + (gap ? ': ' : ':') + v);
                                            }
                                        }
                                    }
                                }
                                v = partial.length === 0 ? '{}' : gap ? '{\n' + gap + partial.join(',\n' + gap) + '\n' + mind + '}' : '{' + partial.join(',') + '}';
                                gap = mind;
                                return v;
                        }
                    }
                    result.stringify = function(value, replacer, space) {
                        var i;
                        gap = '';
                        indent = '';
                        if (typeof space === 'number') {
                            for (i = 0; i < space; i += 1) {
                                indent += ' ';
                            }
                        }
                        else if (typeof space === 'string') {
                            indent = space;
                        }
                        rep = replacer;
                        if (replacer && typeof replacer !== 'function' && (typeof replacer !== 'object' || typeof replacer.length !== 'number')) {
                            throw new Error('JSON.stringify');
                        }
                        return str('', { '' : value });
                    };
                    
                    result.parse = (function() {
                        var at, ch, escapee = {
                                '"' : '"',
                                '\\' : '\\',
                                '/' : '/',
                                b : 'b',
                                f : '\f',
                                n : '\n',
                                r : '\r',
                                t : '\t'
                            }, text, error = function(m) {
                                throw {
                                    name : 'SyntaxError',
                                    message : m,
                                    at : at,
                                    text : text
                                };
                            }, next = function(c) {
                                if (c && c !== ch) {
                                    error("Expected '" + c + "' instead of '" + ch + "'");
                                }
                                ch = text.charAt(at);
                                at += 1;
                                return ch;
                            }, number = function() {
                                var num, str = '';
                                if (ch === '-') {
                                    str = '-';
                                    next('-');
                                }
                                while (ch >= '0' && ch <= '9') {
                                    str += ch;
                                    next();
                                }
                                if (ch === '.') {
                                    str += '.';
                                    while (next() && ch >= '0' && ch <= '9') {
                                        str += ch;
                                    }
                                }
                                if (ch === 'e' || ch === 'E') {
                                    str += ch;
                                    next();
                                    if (ch === '-' || ch === '+') {
                                        str += ch;
                                        next();
                                    }
                                    while (ch >= '0' && ch <= '9') {
                                        str += ch;
                                        next();
                                    }
                                }
                                num = +str;
                                if (isNaN(num)) {
                                    error("Bad number");
                                }
                                else {
                                    return num;
                                }
                            }, string = function() {
                                var hex, i, str = '', uffff;
                                if (ch === '"') {
                                    while (next()) {
                                        if (ch === '"') {
                                            next();
                                            return str;
                                        }
                                        else if (ch === '\\') {
                                            next();
                                            if (ch === 'u') {
                                                uffff = 0;
                                                for (i = 0; i < 4; i += 1) {
                                                    hex = parseInt(next(), 16);
                                                    if (!isFinite(hex)) {
                                                        break;
                                                    }
                                                    uffff = uffff * 16 + hex;
                                                }
                                                str += String.fromCharCode(uffff);
                                            }
                                            else if (typeof escapee[ch] === 'string') {
                                                str += escapee[ch];
                                            }
                                            else {
                                                break;
                                            }
                                        }
                                        else {
                                            str += ch;
                                        }
                                    }
                                }
                                error("Bad string");
                            }, white = function() {
                                while (ch && ch <= ' ') {
                                    next();
                                }
                            }, word = function() {
                                switch (ch) {
                                    case 't':
                                        next('t');
                                        next('r');
                                        next('u');
                                        next('e');
                                        return true;
                                    case 'f':
                                        next('f');
                                        next('a');
                                        next('l');
                                        next('s');
                                        next('e');
                                        return false;
                                    case 'n':
                                        next('n');
                                        next('u');
                                        next('l');
                                        next('l');
                                        return null;
                                }
                                error("Unexpected '" + ch + "'");
                            }, value, array = function() {
                                var ary = [];
                                if (ch === '[') {
                                    next('[');
                                    white();
                                    if (ch === ']') {
                                        next(']');
                                        return ary;
                                    }
                                    while (ch) {
                                        ary.push(value());
                                        white();
                                        if (ch === ']') {
                                            next(']');
                                            return ary;
                                        }
                                        next(',');
                                        white();
                                    }
                                }
                                error("Bad array");
                            }, object = function() {
                                var key, obj = {};
                                if (ch === '{') {
                                    next('{');
                                    white();
                                    if (ch === '}') {
                                        next('}');
                                        return obj;
                                    }
                                    while (ch) {
                                        key = string();
                                        white();
                                        next(':');
                                        obj[key] = value();
                                        white();
                                        if (ch === '}') {
                                            next('}');
                                            return obj;
                                        }
                                        next(',');
                                        white();
                                    }
                                }
                                error("Bad object");
                            };
                            value = function() {
                                white();
                                switch (ch) {
                                    case '{':
                                        return object();
                                    case '[':
                                        return array();
                                    case '"':
                                        return string();
                                    case '-':
                                        return number();
                                    default:
                                        return ch >= '0' && ch <= '9' ? number() : word();
                                }
                            };
                        return function(source, reviver) {
                            var res;
                            text = source;
                            at = 0;
                            ch = ' ';
                            res = value();
                            white();
                            if (ch) {
                                error("Syntax error");
                            }
                            
                            return typeof reviver === 'function' ? function (holder, key) {
                                var k, v, val = holder[key];
                                if (val && typeof val === 'object') {
                                    for (k in val) {
                                        if (Object.hasOwnProperty.call(val, k)) {
                                            v = arguments.callee(val, k);
                                            if (v !== undefined) {
                                                val[k] = v;
                                            }
                                            else {
                                                delete val[k];
                                            }
                                        }
                                    }
                                }
                                return reviver.call(holder, key, val);
                            }({ '' : res }, '') : res;
                        };
                    })();
                    return result;
                })();
            }
        };
        if (typeof JSON == 'object') {
            myJSON.prototype = JSON;
        }
        return new myJSON();
    }
    
    /**
     * initCrossBrowserSupport
     * @returns {Object}
     */
    function initCrossBrowserSupport() {
        var crossBrowserUtility = {'JSON':null}
        // 配列のindexOf対策 from MDC
        if (!Array.prototype.indexOf) {
            Array.prototype.indexOf = function(elt /*, from*/) {
                var len = this.length;
    
                var from = Number(arguments[1]) || 0;
                from = (from < 0) ? Math.ceil(from) : Math.floor(from);
                if (from < 0) {
                    from += len;
                }
    
                for (; from < len; from++) {
                    if (from in this && this[from] === elt) {
                        return from;
                    }
                }
    
                return -1;
            };
        }
        // ArrayのforEach対策 from MDC
        if (!Array.prototype.forEach) {
            Array.prototype.forEach = function(fun /*, thisp*/) {
                var len = this.length;
                if (typeof fun != 'function') {
                    throw new TypeError();
                }
    
                var thisp = arguments[1];
                for (var i = 0; i < len; i++) {
                    if (i in this) {
                        fun.call(thisp, this[i], i, this);
                    }
                }
            };
        }
    
        // JSONのサポート
        crossBrowserUtility.JSON = initJSON();
    
        // GM関数の初期化
        initGMFunctions();
    
        return crossBrowserUtility;
    }
//faraway})();
}	//faraway

//faraway 8.右クリック拡張のソース(b3rclick.user.js)終了

//faraway 9.同盟レベル画面改善ツールのソース(3594union.user.js)開始
//================================================================================
//9.同盟レベル画面改善ツール
//================================================================================
// ==UserScript==
// @name		3594-union
// @namespace		http://www.losttechnology.jp/script/user/3594union.user.js
// @description		ブラウザ三国志の同盟レベルの表示を改善
// @include		http://*.3gokushi.jp/alliance/level.php*
// ==/UserScript==

/*
2010-10-29 ver.1.0.0
	次レベルに必要な寄付額を表示。
	同盟人数の空き枠数を表示。
*/

//faraway(function() {
function disp_alliancelevel() {	//faraway
//window.alert(location.pathname);
//111013window.alert("9.同盟レベル画面改善ツール:" + location.pathname);	//faraway
	if(location.pathname != "/alliance/level.php") return;

/* レベル/人数/寄付総額/最大人数/必要寄付額/次レベル最大人数 */
	cl=document.getElementsByClassName('contents');
	np=parseInt(cl[4].innerHTML)-parseInt(cl[2].innerHTML);
	cl[1].innerHTML+=' <span style="color:red">(空き枠:'+(parseInt(cl[3].innerHTML)-parseInt(cl[1].innerHTML))+')</span>';
	cl[2].innerHTML+=' <br><span style="color:red">(次まで:'+(np)+'／1人あたり:'+Math.round(np/parseInt(cl[1].innerHTML))+')</span>';
	cl[3].innerHTML+=' <span style="color:red">(次で+'+(parseInt(cl[5].innerHTML)-parseInt(cl[3].innerHTML))+')</span>';
//faraway}) ();
}	//faraway

//faraway 9.同盟レベル画面改善ツールのソース(3594union.user.js)終了
//faraway 10.ミス防止補助ツールのソース(3594warning.user.js)開始
//================================================================================
//10.ミス防止補助ツール
//================================================================================
// ==UserScript==
// @name		3gokushi-warning
// @namespace		http://www.losttechnology.jp/script/user/3594warning.user.js
// @description		ブラウザ三国志のミス防止補助ツール
// @include		http://*.3gokushi.jp/*
// ==/UserScript==

/*
// @include		http://*.3gokushi.jp/facility/facility.php*
// @include		http://*.3gokushi.jp/facility/castle_send_troop.php#ptop

2010-7-26 ver.1.0.0
	斥候騎兵と近衛騎兵の生産を間違えないように注意喚起。
2010-8-16 ver.1.0.1
	兵を連れ忘れて出兵ミスをしないように兵が0だと出兵ボタンに単騎と表示。
2010-11-29 ver.1.0.2
	単騎時にはボタンを黄色で表示。
2011-2-27 ver.1.0.3
	援軍時には出兵ボタンを青か緑で表示。
2011-3-6 ver.1.0.4
	タブにワールドを表示するようにしてみた。
*/

//faraway(function() {
function disp_mistakeprevention() {	//faraway
//window.alert("10.ミス防止補助ツール:" + location.pathname);	//faraway
if (location.pathname != "/facility/facility.php" && location.pathname != "/facility/castle_send_troop.php")  return;	//faraway
	var chkScout='unit_value[310]';
	var msgScout='斥候';
	var chkScoutCavalry='unit_value[311]';
	var msgScoutCavalry='斥候騎兵';
	var chkFight='fighting_units';
	var dispatchOfTroops='btn_send';
	var soldierType=Array('infantry_count','spear_count','archer_count','cavalry_count','halbert_count','crossbow_count','cavalry_guards_count','scout_count','cavalry_scout_count','ram_count','catapult_count');
	var StatusTable='status_table';
	// 斥候が作成できるか判定
	sc=document.getElementById(chkScout);
	if (sc) {
		sc.style.backgroundColor='#ecc';
		sc.style.textAlign='center';
		sc.style.width='8em';
		sc.value=msgScout;
		sc.select();
	}
	// 斥候騎兵が作成できるか判定
	sc=document.getElementById(chkScoutCavalry);
	if (sc) {
		sc.style.backgroundColor='#ecc';
		sc.style.textAlign='center';
		sc.style.width='8em';
		sc.value=msgScoutCavalry;
		sc.select();
	}
	// 出兵画面か判定
	if (document.getElementsByClassName(chkFight).length>0) {
		var soldiers='';
		var smodecls='';
		var smodetxt='';
		// suport：援軍
		// fight：賊討伐・殲滅戦
		// forceattack：強襲
		// spy：偵察
		smode=document.getElementsByClassName('suport');
		if (smode.length>0) {
			smodetxt=smode[0].innerHTML.replace(/<sp.*an>/,'');
		}
		smode=document.getElementsByClassName('fight');
		if (smode.length>0) {
			smodetxt=smode[0].innerHTML.replace(/<sp.*an>/,'');
		}
		smode=document.getElementsByClassName('forceattack');
		if (smode.length>0) {
			smodetxt=smode[0].innerHTML.replace(/<sp.*an>/,'');
		}
		smode=document.getElementsByClassName('spy');
		if (smode.length>0) {
			smodetxt=smode[0].innerHTML.replace(/<sp.*an>/,'');
		}
		areaplus=document.getElementsByClassName('controlArea');
		if (areaplus.length>0) {
			areaplus[0].innerHTML+=' <span style="text-align:center;margin-left:1em;padding:3px 5px;font-weight:bold;background-color:#fc0">'+smodetxt+'<\/span>';
		}
		for (lp=0;lp<soldierType.length;lp++) {
			soldierels=document.getElementsByName(soldierType[lp]);
			soldiers+=soldierels[0].value;
		}
		el=document.getElementById(dispatchOfTroops);
		el.title=smodetxt;
		if (soldiers=='') {
			el.value='出兵（武将単騎）';
			el.style.color='#f00';
			el.style.backgroundColor='#ff0';
		}
		//援軍判定
		html=document.getElementsByClassName('fightingpower');
		if (html[0].innerHTML.indexOf('援軍部隊戦力',0)>-1) {
			el.value=(soldiers=='')?'出兵（単騎援軍）':'出兵（援軍）';
			el.style.color='#fff';
			el.style.backgroundColor=(soldiers=='')?'#009':'#363';
		}
	}
	//ステータス強化画面
	st=document.getElementById(StatusTable);
	if (st) {
		st.style.width='500px';
	}
	// 鯖を表示
	sn=document.getElementById('worldtime');
	str=sn.innerHTML;
	pp=str.indexOf('ワールド');
	str=str.substring(0,pp);
	str=str.match('[0-9]*$');
	document.title='['+str+']'+document.title;
//faraway}) ();
}	//faraway

//faraway 10.ミス防止補助ツールのソース(3594warning.user.js)終了

//faraway 11.書簡送信アシスタントのソース(bro3_Send_Mail_Supporter.user.js)開始
//================================================================================
//11.書簡送信アシスタント
//================================================================================
// ==UserScript==
// @name         bro3_Send_Mail_Supporter
// @namespace    http://at-n2.net/
// @description  ブラウザ三国志 書簡送信アシスタントスクリプト By nottisan
// @include      http://*.3gokushi.jp/message/new.php*
// @include      http://*.3gokushi.jp/false/login_sessionout.php*
// @include      http://*.3gokushi.jp/message/outbox.php*
// ==/UserScript==

// 開発にご協力感謝致します。
// irc2_yu 様  mattun 様


//2011.03.30 リンク表示位置の修正。（Autobilderと同じようにコピーライト横に表示）
//2011.04.01 リンク表示位置の修正。（書簡の新規作成画面のメニュー横に表示）

//faraway 11.書簡送信アシスタント変数宣言移動前の場所

//Main
//faraway(function(){
function disp_lettertransmission() {	//faraway
//window.alert("11.書簡送信アシスタント:" + location.pathname);	//faraway
if (location.pathname != "/message/new.php" && location.pathname != "/false/login_sessionout.php"
 && location.pathname != "/message/outbox.php")  return;
//window.alert("11.書簡送信アシスタント:" + location.pathname);	//faraway

	//操作ボックスの表示リンク追加
	addOpenLinkHtml_11();
	//通常の送信時に書簡をバックアップする。
	document.forms[0].elements[5].addEventListener("click", function(){ SubjectSave();BodySave();}, false);
	//送信状況の取得
	var Send_Flg = GM_getValue(HOST + PGNAME + "Send_Flg", SENDTFLG_NEW);
	GM_log("Main() Send_Flg=" + Send_Flg);
	//プレビュー時
	if (Send_Flg == SENDTFLG_PRE) {
		openSupportBox();
		var objtextTo = document.getElementsByName("to");
		if (objtextTo[0].type == "hidden"){
			GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_END);
			//document.forms[0].elements[4].click();
			//var tid=setTimeout(function(){document.forms[0].elements[4].click();},INTERVAL);
			var tid=setTimeout(function(){btn=document.getElementById("btn_send");btn.disabled=true;setHiddenValue(btn);btn.form.submit();},INTERVAL);
		}else{
			GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_NEW);
			alert("送信しようとしましたが、エラーで出来ませんでした。");
			return;
		}
	}
	//送信終了時(送信履歴)
	if (Send_Flg == SENDTFLG_END) {
		//openSupportBox();
		GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_CON);
		var tid=setTimeout(function(){location.href = "/message/new.php#ptop";},INTERVAL);
	}
	//連続送信中(新規作成画面)
	if (Send_Flg == SENDTFLG_CON) {
		OneAddressFlgDel();
		openSupportBox();
		//次の送信があるかチェック
		if(SendConti()){
			GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_PRE);
			var tid=setTimeout(function(){document.forms[0].elements[5].click();},INTERVAL);
		}
	}
	//セッションタイムアウト画面
	if (location.pathname == "/false/login_sessionout.php") {
		if (Send_Flg != SENDTFLG_NEW) {
			alert("送信途中でセッションタイムアウトになりました。\n書簡の送信履歴でどこまで送信されているかチェックし\n再度送信してください。");
			GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_NEW);
		}
	}

//faraway})();
}	//faraway

//送信したアドレスのフラグを消す。
function OneAddressFlgDel(){
	var arrylist = GetSendAddress();
	var arrynewlist ="";
	var SendFLg = true;
	for (var i=0; i < ADDRESSCNT; i++){
		if (arrylist[i] != undefined) {
			if (arrylist[i] != "") {
				GM_log("OneAddressFlgDel() SendFLg=" + SendFLg);
				if (arrylist[i].split(DELIMIT2_11)[2] == 1 && SendFLg == true){
				GM_log("OneAddressFlgDel() if SendFLg=" + SendFLg);
					arrynewlist += arrylist[i].split(DELIMIT2_11)[0] + DELIMIT2_11;
					arrynewlist += arrylist[i].split(DELIMIT2_11)[1] + DELIMIT2_11;
					arrynewlist += "0" + DELIMIT_11;
					SendFLg = false;
				}else{
				GM_log("OneAddressFlgDel() else SendFLg=" + SendFLg);
					arrynewlist += arrylist[i].split(DELIMIT2_11)[0] + DELIMIT2_11;
					arrynewlist += arrylist[i].split(DELIMIT2_11)[1] + DELIMIT2_11;
					arrynewlist += arrylist[i].split(DELIMIT2_11)[2] + DELIMIT_11;
				}
			}
		}
	}
	GM_log("OneAddressFlgDel() arrynewlist=" + arrynewlist);
	GM_setValue(HOST + PGNAME + "addresslist", arrynewlist);
}
//送信開始
function SendConti(){
	//アドレスチェック
	var chkret = AdressCheck();
	if (chkret == false){
		GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_NEW);
		alert("送信が完了しました。\n送信履歴で送信されてるか確認してください。");
		var tid=setTimeout(function(){location.href = "/message/outbox.php";},0);
		return false;
	}

	//送信内容の読込み
	SubjectLoad();
	BodyLoad();
	//送信先のチェック保存
	var arrylist = GetSendAddress();
	var arryflg = new Array();
	for (var i = 0; i < ADDRESSCNT; i++) {
		var objChk = document.getElementById("chk" + i);
		arryflg[i] = false;
		if(objChk.checked == true){
			arryflg[i] = true;
		}
	}
	GM_log("SendConti() arryflg=" + arryflg);
	ChkSendAddress(arryflg);

	var ret = SetSendAddress();
	return true;
}
//リンクHTML追加
function addOpenLinkHtml_11() {
/*
//	var sidebar = d_11.evaluate('//*[@id="statusIcon"]', d_11, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var sidebar = d_11.evaluate('//*[@class="copyright"]',d_11, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	//alert(sidebar.snapshotLength);
//	if (sidebar.snapshotLength == 0) return;
 	if (sidebar.snapshotLength == 0)
        {
//	    sidebar = d_11.evaluate('//*[@id="navi01"]',d_11, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
//	    sidebar = d_11.evaluate('//*[@id="sidebar"]',d_11, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	    sidebar = d_11.evaluate('//*[@id="status_left"]',d_11, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
            if (sidebar.snapshotLength == 0) return;
	    isMixi = false;
	}
	
	//自動移動リンク
	var openLink = document.createElement("a");
	openLink.id = "AutoMoveLink";
	openLink.href = "javascript:void(0);";
	openLink.innerHTML = "  書簡送信サポート  ";
	openLink.style.color = "#000000";
	openLink.addEventListener("click", function() {openSupportBox()}, true);
	sidebar.snapshotItem(0).appendChild(openLink);
*/
	//var lastmenu = d_11.evaluate('//*[@id="statMenu"]/li[@class="last"]',d_11, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	//lastmenu.className = 'test';

	var menu = d_11.evaluate('//*[@id="statMenu"]',d_11, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	//alert(menu.snapshotLength);
	if (menu.snapshotLength == 0){GM_log("bro3_send_mail_supporter: htmlが変わってます。判る人は170行目付近のソースを書き換えてください。");return;}
	
	var newmenu = d_11.createElement("li");
	newmenu.className = "last";
	//メニューリンク
	var openLink = document.createElement("a");
	openLink.id = "AutoMoveLink";
	openLink.href = "javascript:void(0);";
	openLink.innerHTML = "  書簡送信サポート  ";
	openLink.addEventListener("click", function() {openSupportBox()}, true);
	newmenu.appendChild(openLink);
	menu.snapshotItem(0).appendChild(newmenu);
}

//ベースフォームを開く
function openSupportBox() {
	closeSupportBox();
	addSupportHtml();
}
//ベースフォームを閉じる
function closeSupportBox() {
	deleteSupportHtml();
	closeSupportAddressBox();
}
//ベースフォーム表示HTML削除
function deleteSupportHtml() {
	var elem = document.getElementById("SuppContainer");
	if (elem == undefined) return;
	document.body.removeChild(document.getElementById("SuppContainer"));
}

//宛先追加フォームを開く
function openSupportAddressBox() {
	closeSupportAddressBox();
	addSupport_AddressHtml();
}
//宛先追加フォームを閉じる
function closeSupportAddressBox() {
	deleteSupportAddressHtml();
}
//宛先追加HTML削除
function deleteSupportAddressHtml() {
	var elem = document.getElementById("SuppAddresContainer");
	if (elem == undefined) return;
	document.body.removeChild(document.getElementById("SuppAddresContainer"));
}

//ベースフォーム表示HTML追加
function addSupportHtml() {

	var popupLeft = GM_getValue(HOST + "popup_Suppleft", 0);
	var popupTop = GM_getValue(HOST + "popup_Supptop", 0);
	if (popupLeft < 0) popupLeft = 0;
	if (popupTop < 0) popupTop = 0;
	
	//表示コンテナ作成
	var SuppContainer = document.createElement("div");
	SuppContainer.id = "SuppContainer";
	SuppContainer.style.position = "absolute";
	SuppContainer.style.backgroundColor = "darkgray";
	SuppContainer.style.border = "outset 2px darkgray";
	SuppContainer.style.left = popupLeft + "px";
	SuppContainer.style.top = popupTop + "px";
	SuppContainer.style.fontSize = "10px";
	SuppContainer.style.padding = "3px";
	SuppContainer.style.zIndex = 253;
	document.body.appendChild(SuppContainer);
	
	//閉じるリンク
	var closeLink = document.createElement("a");
	closeLink.id = "timerCloseLink";
	closeLink.href = "javascript:void(0);";
	closeLink.style.margin = "3px";
	closeLink.innerHTML = "閉じる";
	closeLink.addEventListener("click", function() {closeSupportBox()}, true);
	SuppContainer.appendChild(closeLink);
	
	//バージョン
	var version = document.createElement("span");
	version.style.fontSize = "9px";
	version.style.margin = "3px";
	version.innerHTML = "Ver." + VERSION_11;
	SuppContainer.appendChild(version);
	
	//入力項目の作成
	var table = document.createElement("div");
	table.innerHTML = <>
	<table width="930" border="1" cellspacing="0" cellpadding="10">
	  <tr>
	    <td colspan='6' style="text-align:center" width="750">宛先</td>
	    <td style="text-align:center" width="180">件名</td>
	  </tr>
	  <tr>
	    <td rowspan="3" width="125">
	      <input id="chk0" type="checkbox" /><span id="chk_name0"></span><br />
	      <input id="chk1" type="checkbox" /><span id="chk_name1"></span><br />
	      <input id="chk2" type="checkbox" /><span id="chk_name2"></span><br />
	      <input id="chk3" type="checkbox" /><span id="chk_name3"></span><br />
	      <input id="chk4" type="checkbox" /><span id="chk_name4"></span><br />
	      <input id="chk5" type="checkbox" /><span id="chk_name5"></span>
	    </td>
	    <td rowspan="3" width="125">
	      <input id="chk6" type="checkbox" /><span id="chk_name6" /><br />
	      <input id="chk7" type="checkbox" /><span id="chk_name7" /><br />
	      <input id="chk8" type="checkbox" /><span id="chk_name8" /><br />
	      <input id="chk9" type="checkbox" /><span id="chk_name9" /><br />
	      <input id="chk10" type="checkbox" /><span id="chk_name10" /><br />
	      <input id="chk11" type="checkbox" /><span id="chk_name11" />
	    </td>
	    <td rowspan="3" width="125">
	      <input id="chk12" type="checkbox" /><span id="chk_name12"></span><br />
	      <input id="chk13" type="checkbox" /><span id="chk_name13"></span><br />
	      <input id="chk14" type="checkbox" /><span id="chk_name14"></span><br />
	      <input id="chk15" type="checkbox" /><span id="chk_name15"></span><br />
	      <input id="chk16" type="checkbox" /><span id="chk_name16"></span><br />
	      <input id="chk17" type="checkbox" /><span id="chk_name17"></span>
	    </td>
	    <td rowspan="3" width="125">
	      <input id="chk18" type="checkbox" /><span id="chk_name18"></span><br />
	      <input id="chk19" type="checkbox" /><span id="chk_name19"></span><br />
	      <input id="chk20" type="checkbox" /><span id="chk_name20"></span><br />
	      <input id="chk21" type="checkbox" /><span id="chk_name21"></span><br />
	      <input id="chk22" type="checkbox" /><span id="chk_name22"></span><br />
	      <input id="chk23" type="checkbox" /><span id="chk_name23"></span>
	    </td>
	    <td rowspan="3" width="125">
	      <input id="chk24" type="checkbox" /><span id="chk_name24"></span><br />
	      <input id="chk25" type="checkbox" /><span id="chk_name25"></span><br />
	      <input id="chk26" type="checkbox" /><span id="chk_name26"></span><br />
	      <input id="chk27" type="checkbox" /><span id="chk_name27"></span><br />
	      <input id="chk28" type="checkbox" /><span id="chk_name28"></span><br />
	      <input id="chk29" type="checkbox" /><span id="chk_name29"></span>
	    </td>
	    <td rowspan="3" width="125">
	      <input id="chk30" type="checkbox" /><span id="chk_name30"></span><br />
	      <input id="chk31" type="checkbox" /><span id="chk_name31"></span><br />
	      <input id="chk32" type="checkbox" /><span id="chk_name32"></span><br />
	      <input id="chk33" type="checkbox" /><span id="chk_name33"></span><br />
	      <input id="chk34" type="checkbox" /><span id="chk_name34"></span><br />
	      <input id="chk35" type="checkbox" /><span id="chk_name35"></span>
	    </td>
	    <td style="text-align:center">
	      <input id='btn_mail_getSubject' type='button' value='件名保存' />
	      <input id='btn_mail_setSubject' type='button' value='件名読込' />
	      <input id='btn_mail_preSubject' type='button' value='保存中の件名表示' />
	    </td>
	  </tr>
	  <tr>
	    <td style="text-align:center">本文(@@@name@@@=正式名称に置換)</td>
	  </tr>
	  <tr>
	    <td style="text-align:center">
	      <input id='btn_mail_getBody' type='button' value='本文保存' />
	      <input id='btn_mail_setBody' type='button' value='本文読込' />
	      <input id='btn_mail_preBody' type='button' value='保存中の本文表示' />
	    </td>
	  </tr>
	    <tr>
	    <td colspan='6' style="text-align:center">
	    <input id='btn_mail_add_list' type='button' value='宛先追加' />
	    <input id='btn_mail_del_list' type='button' value='宛先削除' /> 　　
	    <input id='btn_Adress_checkALL' type='button' value='CheckALL' /> 　　
	    <input id='btn_send_start' type='button' value='送信開始' /></td>
	    <td style="text-align:center"><input id='btn_cls_sub_body' type='button' value='保存件名・本文削除' /></td>
	  </tr>
	</table>
	</>;
	SuppContainer.appendChild(table);

	var arrylist = GetSendAddress();
	var ad = new Array();
	for (var i = 0; i < ADDRESSCNT; i++) {
		if (arrylist[i] !=undefined){
			if (arrylist[i] != "") {
			ad = arrylist[i].split(DELIMIT2_11);
			var chk_name = document.getElementById("chk_name" + i);
			chk_name.innerHTML = ad[0] + chk_name.innerHTML;
			if (ad[2] != 0) {
				var chkbox = document.getElementById("chk" + i);
				chkbox.checked = true;
			}
			}else{
				var chkbox = document.getElementById("chk" + i);
				chkbox.disabled = true;
			}
		}else{
			var chkbox = document.getElementById("chk" + i);
			chkbox.disabled = true;
		}
	}

	//件名○○ボタンへのイベント登録
	document.getElementById('btn_mail_getSubject').addEventListener("click",function() { SubjectSave(); }, true);
	document.getElementById('btn_mail_setSubject').addEventListener("click",function() { SubjectLoad(); }, true);
	document.getElementById('btn_mail_preSubject').addEventListener("click",function() { SubjectPreview(); }, true);

	//本文○○ボタンへのイベント登録
	document.getElementById('btn_mail_getBody').addEventListener("click",function() { BodySave(); }, true);
	document.getElementById('btn_mail_setBody').addEventListener("click",function() { BodyLoad(); }, true);
	document.getElementById('btn_mail_preBody').addEventListener("click",function() { BodyPreview(); }, true);
	//保存件名・本文削除
	document.getElementById('btn_cls_sub_body').addEventListener("click",function() { Cls_Sub_Body(); }, true);

	//宛先○○ボタンへのイベント登録
	document.getElementById('btn_mail_add_list').addEventListener("click",function() { openSupportAddressBox(); }, true);
	document.getElementById('btn_mail_del_list').addEventListener("click",function() { DellSupportAddress(); }, true);

	//アドレス全部へのチェック
	document.getElementById('btn_Adress_checkALL').addEventListener("click",function() { Adress_checkALL(); }, true);
	//送信開始ボタンへのイベント登録
	document.getElementById('btn_send_start').addEventListener("click",function() { SendStert(); }, true);
}

function Adress_checkALL(){
	for (var i = 0; i < ADDRESSCNT; i++) {
		var objChk = document.getElementById("chk" + i);
		if (objChk.disabled != true){
			if (objChk.checked != true){
				objChk.checked = true;
			}else{
				objChk.checked = false;
			}
		}
	}
}

//送信開始
function SendStert(){
	//アドレスチェック
	var chkret = AdressCheck();
	if (chkret == false){
		alert("送信先をチェックしてください。\n下のフォームの送信先に入力されても送信されません。");
		return;
	}
	//入力チェック
	var objtextsub = document.getElementsByName("subject");
	var objtextbody = document.getElementsByName("body");
	if (objtextsub[0].value == "" || objtextbody[0].value == "") {
		alert("件名・本文ともに入力してください。");
		return;
	}
	var ret = confirm("件名＆本文を保存し、送信を開始します。");
	if (ret == true) {
		//送信内容の保存
		SubjectSave();
		BodySave();
		//送信先のチェック保存
		var arrylist = GetSendAddress();
		var arryflg = new Array();
		for (var i = 0; i < ADDRESSCNT; i++) {
			var objChk = document.getElementById("chk" + i);
			arryflg[i] = false;
			if(objChk.checked == true){
				arryflg[i] = true;
			}
		}
		ChkSendAddress(arryflg);
	}
	var ret = SetSendAddress();
	GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_PRE);
	//alert(document.forms[0].elements[5].value);
	document.forms[0].elements[5].click();
}

//宛先アドレスへフラグのセット
function ChkSendAddress(arryflg) {
	var arrylist = GetSendAddress();
	var arrynewlist ="";
	for (var i=0; i < ADDRESSCNT; i++){
		if (arryflg[i] == false){
			if (arrylist[i] != undefined) {
				if (arrylist[i] != "") {
					arrynewlist += arrylist[i].split(DELIMIT2_11)[0] + DELIMIT2_11;
					arrynewlist += arrylist[i].split(DELIMIT2_11)[1] + DELIMIT2_11;
					arrynewlist += "0" + DELIMIT_11;
				}
			}
		}else{
			if (arrylist[i] != undefined) {
				if (arrylist[i] != "") {
					arrynewlist += arrylist[i].split(DELIMIT2_11)[0] + DELIMIT2_11;
					arrynewlist += arrylist[i].split(DELIMIT2_11)[1] + DELIMIT2_11;
					arrynewlist += "1" + DELIMIT_11;	//送信フラグのセット
				}
			}
		}
	}
	GM_setValue(HOST + PGNAME + "addresslist", arrynewlist);
}
//送信先がチェックされているかどうか
function AdressCheck() {
	for (var i = 0; i < ADDRESSCNT; i++) {
		var objChk = document.getElementById("chk" + i);
		if(objChk.checked == true){
			return true;
		}
	}
	return false;
}
//送信アドレスのセット 返値 true=送信可能 false=送信リスト終了
function SetSendAddress(){
	var arrylist = GetSendAddress();
	for (var i = 0; i < ADDRESSCNT; i++){
	GM_log("Main() arrylist[i]=" + arrylist[i]);
		if (arrylist[i] != undefined) {
			if (arrylist[i] != "") {
				if (arrylist[i].split(DELIMIT2_11)[2] == 1){
					var objtextTo = document.getElementsByName("to");
					objtextTo[0].value = arrylist[i].split(DELIMIT2_11)[0];
					var objtextBody = document.getElementsByName("body");
					objtextBody[0].value = objtextBody[0].value.replace("@@@name@@@", arrylist[i].split(DELIMIT2_11)[1]);
					return true;
				}
			}
		}
	}
	return false;
}

//宛先追加フォームHTML追加
function addSupport_AddressHtml() {
	var arrylist = GetSendAddress();

	if (arrylist[0] != undefined){
		if (arrylist.length == ADDRESSCNT+1){
			alert("これ以上追加できません。");
			return;
		}
	}
	var popupLeft = GM_getValue(HOST + "popup_SuppAdleft", 150);
	var popupTop = GM_getValue(HOST + "popup_SuppAdtop", 150);
	if (popupLeft < 0) popupLeft = 0;
	if (popupTop < 0) popupTop = 0;
	
	//表示コンテナ作成
	var SuppContainer = document.createElement("div");
	SuppContainer.id = "SuppAddresContainer";
	SuppContainer.style.position = "absolute";
	SuppContainer.style.backgroundColor = "darkgray";
	SuppContainer.style.border = "outset 2px darkgray";
	SuppContainer.style.left = popupLeft + "px";
	SuppContainer.style.top = popupTop + "px";
	SuppContainer.style.fontSize = "10px";
	SuppContainer.style.padding = "3px";
	SuppContainer.style.zIndex = 253;
	document.body.appendChild(SuppContainer);
	
	
	//入力項目の作成
	var table = document.createElement("div");
	table.innerHTML = <>
	<table border="1" cellspacing="1" cellpadding="10">
	  <tr>
	    <td>
	      宛先の追加 ※@は<font color="red">半角</font>でお願いします。※<br />
	      ※宛先名@@@正式名称(nottisan@@@呉越同舟 支部担当 nottisan様)<br />
	    </td>
	  </tr>
	  <tr>
	    <td>
	      <input id="inAddress" type="text" value="" size="65" /><br />
	    </td>
	  </tr>
	  <tr>
	    <td style="text-align:center">
	      <input id='btn_add_ad' type='button' value='宛先保存' />
	      <input id='btn_add_ad_close' type='button' value='閉じる' />
	    </td>
	  </tr>
	</table>
	</>;
	SuppContainer.appendChild(table);

	//ボタンへのイベント登録
	document.getElementById('btn_add_ad').addEventListener("click",function() { SaveAddress(); }, true);
	document.getElementById('btn_add_ad_close').addEventListener("click",function() { closeSupportAddressBox(); }, true);

}
//宛先の削除＆保存、基本フォームのリフレッシュ
function DellSupportAddress() {
	var arrylist = GetSendAddress();
	var arryflg = new Array();
	for (var i = 0; i < ADDRESSCNT; i++) {
		var objChk = document.getElementById("chk" + i);
		arryflg[i] = false;
		if(objChk.checked == true){
			var ret = confirm(arrylist[i].split(DELIMIT2_11)[0] + "を削除します。");
			if (ret == true) arryflg[i] = true;
		}
	}
	DelSendAddress(arryflg);
	openSupportBox();
}
//宛先アドレスの削除
function DelSendAddress(arryflg) {
	var arrylist = GetSendAddress();
	var arrynewlist =""
	for (var i=0; i < ADDRESSCNT; i++){
		if (arryflg[i] == false){
			if (arrylist[i] != undefined) {
				if (arrylist[i] != "") {
					arrynewlist += arrylist[i] + DELIMIT_11;
				}
			}
		}
	}
	GM_setValue(HOST + PGNAME + "addresslist", arrynewlist);
}

//宛先の保存後、基本フォームのリフレッシュ
function SaveAddress() {
	var inAddress = document.getElementById('inAddress').value;
	if (inAddress.split("@@@").length < 1){
		alert("書式通りに入力してください。");
		return;
	}
	if (inAddress.length == 0){
		alert("宛先を入力してください。");
		return;
	}
	inAddress = inAddress.replace("@@@",DELIMIT2_11) + DELIMIT2_11 + "0";
	var addreslist = GM_getValue(HOST + PGNAME + "addresslist", "");
	addreslist += inAddress + DELIMIT_11;
	GM_setValue(HOST + PGNAME + "addresslist", addreslist);
	openSupportBox();
	openSupportAddressBox();
}
//件名保存
function SubjectSave() {
	var objtextsub = document.getElementsByName("subject");
	var textsub = objtextsub[0].value;
	GM_setValue(HOST + PGNAME + "SendSubject", textsub);
}
//件名読込み
function SubjectLoad() {
	var textsub = GM_getValue(HOST + PGNAME + "SendSubject", "");
	var objtextsub = document.getElementsByName("subject");
	objtextsub[0].value = textsub;
}
//件名プレビュー
function SubjectPreview() {
	var textsub = GM_getValue(HOST + PGNAME + "SendSubject", "");
	alert(textsub);
}


//本文保存
function BodySave() {
	var objtextbody = document.getElementsByName("body");
	var textbody = objtextbody[0].value;
	GM_setValue(HOST + PGNAME + "SendBody", textbody);
}
//本文読込み
function BodyLoad() {
	var textbody = GM_getValue(HOST + PGNAME + "SendBody", "");
	var objtextbody = document.getElementsByName("body");
	objtextbody[0].value = textbody;
}
//本文プレビュー
function BodyPreview() {
	var textbody = GM_getValue(HOST + PGNAME + "SendBody", "");
	alert(textbody);
}

//件名・本文保存の削除
function Cls_Sub_Body() {
	GM_setValue(HOST + PGNAME + "SendSubject", "");
	GM_setValue(HOST + PGNAME + "SendBody", "");
}

//アドレスの取得(名前)
function GetSendAddress(){
	var addreslist = GM_getValue(HOST + PGNAME + "addresslist", "");
	if (addreslist.length < 1 ) return "";
	var ArryList = new Array();
	ArryList = addreslist.split(DELIMIT_11);
	return 	ArryList;
}

//デリミタ区切り文字列生成
function genDelimitString_11(dataArray, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}
//デリミタ区切りアドレス文字列生成（宛先：dataArray,正式名称：dataArray2,チェックフラグ：dataArray3, delimiter
function genDelimitString_Adoress(dataArray,dataArray2,dataArray3, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

function setHiddenValue(a){
if(a.name){hid=document.createElement("input");
hid.type="hidden";
hid.name=a.name;
hid.value=a.value;
a.form.appendChild(hid);
}}
//faraway 11.書簡送信アシスタントのソース(bro3_Send_Mail_Supporter.user.js)終了

//faraway 12.書簡同報リンクのソース(b3ccmail.user.js)開始
//================================================================================
//12.書簡同報リンク
//================================================================================
// ==UserScript==
// @name            b3CCMail
// @namespace       b3cm
// @description     書簡同報リンク
// @include         http://*.3gokushi.jp/message/new.php*
// @version         1.0
// @date            2010/07/30
// ==/UserScript==

//faraway 12.書簡同報リンク変数宣言移動前の場所

//faraway(function(){
function disp_letterbroadcast() {	//faraway
//window.alert("12.書簡同報リンク:" + location.pathname);	//faraway
//window.alert("disp_letterbroadcastです。12");
//window.alert(num);

if (location.pathname != "/message/new.php" ) return;	//faraway
	var sendTd = xpath('//*[@id="gray02Wrapper"]//table[@class="commonTables"]//tr/td', document);

	var ar = GM_getValue(location.hostname + "CCALLY");
	var ALLY = new Array();

	if(ar == undefined){
		for(var i=0;i<num_12;i++){
			ALLY[i] = "";
		}
	}else{
		ALLY = ar.split("#$%")
	}

	var ccLnk = new Array();
	var bar = document.createElement("ul");
	bar.id = "statMenu";
//	var sM = document.getElementById("statMenu");

	for(var i=0;i<num_12;i++){
		
		ccLnk[i] = document.createElement("li");
		ccLnk[i].innerHTML = ALLY[i];
//		ccLnk.innerHTML = ALLY[i];
		(function(){
			var n = i;
			ccLnk[i].addEventListener("click", function(){ccSet_12(n);}, true);
		})();
		bar.appendChild(ccLnk[i]);
	}

	var opt = document.createElement("li");
	opt.className = "last";
	opt.innerHTML = "設定画面";
	opt.addEventListener("click", optMenu, true);
	bar.appendChild(opt);

	sendTd.snapshotItem(0).appendChild(bar);

//faraway})();
}	//faraway

function xpath(query,targetDoc) {return document.evaluate(query, targetDoc, null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);}

function ccSet_12(i){//faraway110606 ccSet()->ccSet_12() 14.トレード検索条件記憶と重複していた為、ユニークな名前に変更
	var input = xpath('//*[@id="gray02Wrapper"]//table[@class="commonTables"]//tr/td/input', document);

	var NAME = GM_getValue(location.hostname + "CCNAME").split("#$%");
	input.snapshotItem(0).value = NAME[i];
}

function optMenu(){
//	(d = document.getElementById ('gray02Wrapper')) && (d.style.display = 'none');
	var wrap = xpath('//*[@id="gray02Wrapper"]',document);

	for(var i=wrap.snapshotItem(0).childNodes.length;i>0;i--){
		wrap.snapshotItem(0).removeChild(wrap.snapshotItem(0).lastChild);
	}

	var table = document.createElement("table");
	table.className = "commonTables";

	var tr = document.createElement("tr");
	var th = document.createElement("th");
	th.className = "ttl3";
	th.innerHTML = "表示名";
	th2 = document.createElement("th");
	th2.className = "ttl4";
	th2.innerHTML = "送信対象者";

	tr.appendChild(th);
	tr.appendChild(th2);
	table.appendChild(tr);

	var ALLY = new Array();
	var NAME = new Array();

	var ar = GM_getValue(location.hostname + "CCALLY");
	if(ar == undefined){
		for(var i=0;i<num_12;i++){
			ALLY[i] = "";
		}
	}else{
		ALLY = ar.split("#$%")
	}

	var ar = GM_getValue(location.hostname + "CCNAME");
	if(ar == undefined){
		for(var i=0;i<num_12;i++){
			NAME[i] = "";
		}
	}else{
		NAME = ar.split("#$%")
	}

	for(var i=0;i<num_12;i++){
		var tr = document.createElement("tr");
		var td = document.createElement("th");
		td.innerHTML = "<input type=\"text\" size=\"15\" name=\"ally" + i + "\" id=\"ally" + i + "\" style=\"border:1px solid;\" value=\"" + ALLY[i] + "\" />";
		td.className = "ttl";
		var td2 = document.createElement("th");
		td2.className = "ttl";
		td2.innerHTML = "<input type=\"text\" size=\"40\" name=\"names" + i + "\" id=\"names" + i + "\" style=\"border:1px solid;\" value=\"" + NAME[i] + "\" />";

		tr.appendChild(td);
		tr.appendChild(td2);
		table.appendChild(tr);
	}

	var tr = document.createElement("tr");
	var td = document.createElement("td");
	td.colSpan = 2;
	td.align = "center";

	var btn = document.createElement("input");
	btn.type = "button";
	btn.value = "保存";
	btn.addEventListener("click", saveData, true);

	var wrlink = document.createElement("span");
	wrlink.innerHTML = " | ";

	var link = document.createElement("a");
	link.href = "javascript:void(0)";
	link.innerHTML = "戻る";
	link.addEventListener("click", 
		function(){
			location.reload();
		},
	true);

	wrlink.appendChild(link);

	td.appendChild(btn);
	td.appendChild(wrlink);
	tr.appendChild(td);
	table.appendChild(tr);

	wrap.snapshotItem(0).appendChild(table);
}

function saveData(){
	var scrALLY = "";	// save用変数
	var scrNAME = "";

	var table = xpath('//*[@id="gray02Wrapper"]/table[@class="commonTables"]',document);

	var n = 0;
	var len = table.snapshotItem(0).rows.length;
	for(var i=1;i<len-1;i++){
		var ally  = xpath('//input[@id="ally' + n + '"]',document);
		var names = xpath('//input[@id="names' + n + '"]',document);
//		ALLY[n] = ally.snapshotItem(0).value;
//		CC[n]   = names.snapshotItem(0).value;
		scrALLY += ally.snapshotItem(0).value;
		scrALLY += "#$%";
		scrNAME += names.snapshotItem(0).value;
		scrNAME += "#$%";
		n++;
	}

	GM_setValue(location.hostname + "CCALLY", scrALLY);
	GM_setValue(location.hostname + "CCNAME", scrNAME);

	alert('保存OK。多分ね。');
}


//faraway 12.書簡同報リンクのソース(b3ccmail.user.js)終了

//faraway 13.書簡保存＆検索ツールのソース(bro3_syokanbox.user.js) 開始
//================================================================================
//13.書簡保存＆検索ツール
//================================================================================
// ==UserScript==
// @name           bro3_syokanBox
// @version        2.01
// @namespace      http://twitter.com/utoutouuto
// @include        http://*.3gokushi.jp/message/*
// @description    
// ==/UserScript==
//----更新履歴----
// ver1.00　2010-08-08：初回作成
// ver1.01　2010-08-09：書簡の自動保存機能付加
// ver1.02　2010-08-10：運営書簡の検索対象外機能付加
// ver1.03　2010-08-14：書簡表示方式変更、簡易再検索機能付加
// ver2.00　2010-09-28：mixiレイアウト変更対応、保存書簡出力機能付加
// ver2.01　2010-11-29：最初にGM変数等のチェック付加、返信マーク対応、指定ワールド情報のリセット対応
//faraway( function(){
function disp_letterpreservation() {	//faraway
//window.alert("13.書簡保存＆検索ツール:" + location.pathname);	//faraway
//faraway 13.変数宣言移動前の場所


////////////////////////////////////////////////////////
// ページ読み込み完了を待たない処理
////////////////////////////////////////////////////////
// 対象ページでない場合処理中断
if (!(location.pathname == location_inboxURL || location.pathname == location_outboxURL)) { return; }
// 各種チェック
if (!pre_check()) {
	// 確認用
	//alert("初期チェックでエラー。要ログ確認")
	return;
}
function pre_check() {
	if (!worldKey) { console.log("ワールドキー取得エラー"); return false; }
	
	var time_checker = new Date().toString();
	GM_setValue(worldKey + "time_checker", time_checker.toSource());
	var res_time_checker = eval(GM_getValue(worldKey + "time_checker", ""));
	if (time_checker != res_time_checker) {
		console.log("GM変数の利用エラー");
		console.log("　：" + time_checker);
		console.log("　：" + res_time_checker);
		return false;
	}
	
	if (!$_13) { console.log("jquery取得エラー"); return false; }
	return true;
}
// GM変数ロード
loadOpValues();
loadCmValue();

// ページ読み込み完了後に本処理開始
window.addEventListener("load", function() { pre_main(); }, false);

////////////////////////////////////////////////////////
// ページ読み込み完了後に起動する処理
// 　1.ボタン付加
// 　2.autoCashオプションが有効な場合、書簡キャッシュ処理を稼働。
////////////////////////////////////////////////////////
function pre_main() {
	addBtnMain();
	if (opValues["autoCash"]) { 
		syokanCashMain();
	}
}

////////////////////////////////////////////////////////
// ボタン付加
////////////////////////////////////////////////////////
function addBtnMain() {
	var targetNode = $xp1('//ul[@id="statMenu"]', d_13);
	
	var cashBtn = d_13.createElement("input");
		cashBtn.type = "button";
		cashBtn.id = "cashBtn";
		cashBtn.value = "【書簡保存】";
		cashBtn.addEventListener("click", function() {
			cashBtn.disabled = true;
			if (confirm("現ページに表示されている書簡情報を保存します。")) {
				syokanCashMain();
			} else {
				cashBtn.disabled = false;
			}
		}, false);
	// 自動キャッシュ有効時はボタン非活性
	if (opValues["autoCash"]) { cashBtn.disabled = true; }
	targetNode.appendChild(cashBtn);
	
	var introBtn = d_13.createElement("input");
		introBtn.type = "button";
		introBtn.id = "introBtn";
		introBtn.value = "【書簡検索】";
		introBtn.addEventListener("click", function() {
			cashBtn.disabled = true;
			introBtn.disabled = true;
			addOpBtn.disabled = true;
			searchModeMain();
		}, false);
	targetNode.appendChild(introBtn);
	
	var addOpBtn = d_13.createElement("input");
		addOpBtn.type = "button";
		addOpBtn.id = "addOpBtn";
		addOpBtn.value = "【設定】";
		addOpBtn.addEventListener("click", function() {
			cashBtn.disabled = true;
			introBtn.disabled = true;
			addOpBtn.disabled = true;
			addOpMain();
		}, false);
	targetNode.appendChild(addOpBtn);
}

////////////////////////////////////////////////////////
// 未キャッシュの書簡情報をキャッシュ
// 自動キャッシュの場合は確認メッセージ非活性
////////////////////////////////////////////////////////
function syokanCashMain() {
	var linkNodes = $xp('//table[@class="commonTables"]/tbody/tr/td[2]/a', d_13);
	
	// 未キャッシュIDのURLを格納
	for (var i = 0, len = linkNodes.snapshotLength; i < len; i++ ) {
		var href = linkNodes.snapshotItem(i).href;
		if (href == null) { continue; }
		var syokanId = href.match("id=[0-9]+")[0].split("=")[1];
		if (syokanId == null) { continue; }
		// 返信済みマークがある場合、保存件名をチェック
		var henshinImg = $xp1('descendant::img[@alt="返信済"]',linkNodes.snapshotItem(i).parentNode);
		if (!!henshinImg) {
			if (!checkKenmeiCash(syokanId)) {
				hrefArray.push([syokanId, href]);
				continue;
			}
		}
		if (checkIdCash(syokanId)) { continue; }
		hrefArray.push([syokanId, href]);
	}
	if (hrefArray.length <= 0) {
		if (!opValues["autoCash"]) { alert("新しい保存対象はありません。"); }
		return; 
	}
	
	// 実行中表示レイヤー
	var layer = d_13.createElement("div");
		layer.id = "cash_layer";
		layer.style.backgroundColor = "#202020";
		layer.style.position = "fixed";
		layer.style.zIndex = 1;
		layer.style.width = "100%";
		layer.style.height = "100%";
		layer.style.opacity = 0.9;
	var explain = d_13.createElement("div");
		explain.id = "cash_explain";
		explain.style.backgroundColor = "white";
		explain.style.marginTop  = "100px";
		explain.style.padding  = "20px";
		explain.style.width = "100%";
		explain.innerHTML = "<b>書簡保存処理実行中</b>　　" + 1 + "/" + hrefArray.length;
		layer.appendChild(explain);
	var targetNode = $xp1('//body', d_13);
		targetNode.insertBefore(layer, targetNode.firstChild);
	loadPage(0);
}
// 該当IDがキャッシュ済みならtrueを返す
function checkIdCash(syokanId) {
	for (var i in syokanIdArray) {
		if (syokanIdArray.hasOwnProperty(i) && syokanIdArray[i] == syokanId){ return true; }
	}
	return false;
}
// 該当IDの保存件名にimgタグが含まれていればtrueを返す
function checkKenmeiCash(syokanId) {
	var fillterEL = d_13.createElement('div');
		fillterEL.innerHTML = kenmeiArray[syokanId];
	var henshinImg = $xp1('descendant::img[@alt="返信済"]', fillterEL);
	if (!!henshinImg) { return true; }
	return false;
}
// loadNoにより同期処理させる
function loadPage(loadNo, res) {
	var opt = {
		method: 'get',
		url: hrefArray[loadNo][1],
		onload: function(res) {
			addSyokanCash(loadNo, res);
		}
	}
	GM_xmlhttpRequest(opt); 
}
function addSyokanCash(loadNo, res) {
	var syokanId = hrefArray[loadNo][0];
	var fillterEL = d_13.createElement('div');
		fillterEL.innerHTML = res.responseText;
	
	var syokanTable = $xp1('descendant::table[@class="commonTables"]', fillterEL);
	var soushinsya = $xp1('descendant::td[1]/div', syokanTable).innerHTML;
	var atesaki = $xp1('descendant::td[2]', syokanTable).innerHTML;
	var nichiji = $xp1('descendant::td[3]', syokanTable).innerHTML;
	var kenmei = $xp1('descendant::td[4]', syokanTable).innerHTML;
	var honbun = $xp1('descendant::td[5]', syokanTable).innerHTML;
	
	// 未登録の書簡IDの場合は追加
	if (!checkIdCash(syokanId)) { syokanIdArray.push(syokanId) }
	
	soushinsyaArray[syokanId] = soushinsya;
	atesakiArray[syokanId] = atesaki;
	kenmeiArray[syokanId] = kenmei;
	nichijiArray[syokanId] = nichiji;
	
	saveHonbunValue(syokanId, honbun);
	
	if (loadNo + 1 >= hrefArray.length) {
		saveCmValue();
		if (!opValues["autoCash"]) { alert("書簡保存が終了しました。"); }
		var layer = $xp1('//div[@id="cash_layer"]', d_13);
			layer.parentNode.removeChild(layer);
		return;
	}
	var layerExplain = $xp1('//div[@id="cash_explain"]', d_13);
		layerExplain.innerHTML = "<b>書簡保存処理実行中</b>　　" + (loadNo + 2) + "/" + hrefArray.length;
	loadPage(loadNo + 1);
}

////////////////////////////////////////////////////////
// 書簡検索＆表示機能
// 共通で使用するCSS定義は最初にセット
////////////////////////////////////////////////////////
function searchModeMain() {
//faraway110601 GM_addStyle()への引数をString()で囲むFirefox4.0対応
	GM_addStyle(String(<><![CDATA[
	table.showTable {
		border: 2px solid black;
		border-collapse: collapse;
		margin: 5px;
	}
	.showTable th {
		border: 2px solid black;
		border-collapse: collapse;
		color: white;
		background-color: gray;
		padding : 2px;
	}
	.showTable td {
		border: 2px solid black;
		border-collapse: collapse;
		color: black;
		background-color: white;
		padding : 2px;
	}
	]]></>));
	
	var targetNode =  $xp1('//div[@id="gray02Wrapper"]', d_13);
		targetNode.innerHTML = null;
	var baseEL = d_13.createElement("div");
		baseEL.id = "bro_view_base";
		targetNode.appendChild(baseEL);
		
	addSearchHTML();
	if (opValues["uneiLimit"]) {
		addShowTable(uneiSyokanLimit(syokanIdArray));
	} else {
		addShowTable(syokanIdArray);
	}
}

// 検索句付加
function addSearchHTML() {
	var baseEL =  $xp1('//div[@id="bro_view_base"]', d_13);
	
		baseEL.appendChild(d_13.createTextNode("【保存書簡の検索】"));
		baseEL.appendChild(d_13.createElement("br"));
		
		var searchBaseEL = d_13.createElement("div");
			searchBaseEL.id = "search_base";
			searchBaseEL.appendChild(d_13.createTextNode("検索条件：　"));
		var inputTxtEL = d_13.createElement("input");
			inputTxtEL.size = 10;
			inputTxtEL.id = "searchTxt";
			searchBaseEL.appendChild(inputTxtEL);
			searchBaseEL.appendChild(d_13.createTextNode("　を　"));
		var selectEL = d_13.createElement("select");
			selectEL.id = "searchSelect";
		var optionEL = d_13.createElement("option");
			optionEL.value = "soushinsya_atesaki";
			optionEL.text = "送信者または宛先に含む";
			selectEL.appendChild(optionEL.cloneNode(true));
			optionEL.value = "soushinsya";
			optionEL.text = "送信者に含む";
			selectEL.appendChild(optionEL.cloneNode(true));
			optionEL.value = "atesaki";
			optionEL.text = "宛先に含む";
			selectEL.appendChild(optionEL.cloneNode(true));
			searchBaseEL.appendChild(selectEL);
			searchBaseEL.appendChild(d_13.createTextNode("　書簡を　"));
			
		var btnEL = d_13.createElement("input");
			btnEL.type = "button"
			btnEL.value = "検索する";
			btnEL.addEventListener("click", searchExe, false);
			searchBaseEL.appendChild(btnEL);
			searchBaseEL.appendChild(d_13.createTextNode("　/　"));
		
		var allBtnEL = d_13.createElement("input");
			allBtnEL.type = "button"
			allBtnEL.value = "全件表示";
			allBtnEL.addEventListener("click", function() {
				inputTxtEL.value = null;
				selectEL.selectedIndex = 0;
				searchExe()
			}, false);
			searchBaseEL.appendChild(allBtnEL);
			
		baseEL.appendChild(searchBaseEL);
		baseEL.appendChild(d_13.createElement("br"));
}

// 検索句の情報を元に検索実行
function searchExe() {
	var searchSelectNode = $xp1('//select[@id="searchSelect"]', d_13);
	var searchMode = searchSelectNode.options[searchSelectNode.selectedIndex].value;
	var searchTxt = $xp1('//input[@id="searchTxt"]', d_13).value;
	
	var show_syokanIdArray = [];
	if (searchMode == "soushinsya_atesaki") {
		show_syokanIdArray = searchSoushinsya(syokanIdArray, searchTxt);
		var addIdArray = searchAtesaki(syokanIdArray, searchTxt);
		for (var i = 0, len = addIdArray.length; i < len; i++) {
			if (show_syokanIdArray.indexOf(addIdArray[i]) == -1) {
				show_syokanIdArray.push(addIdArray[i]);
			}
		}
	} else if (searchMode == "soushinsya") {
		show_syokanIdArray = searchSoushinsya(syokanIdArray, searchTxt);
	} else if (searchMode == "atesaki") {
		show_syokanIdArray = searchAtesaki(syokanIdArray, searchTxt);
	} else {
		return;
	}
	
	if (opValues["uneiLimit"]) {
		addShowTable(uneiSyokanLimit(show_syokanIdArray));
	} else {
		addShowTable(show_syokanIdArray);
	}
}
// 送信者名で検索し、条件に合致するIDを返す
function searchSoushinsya(search_syokanIdArray, searchTxt) {
	var resSyokanIdArray = [];
	for (var i = 0, len = search_syokanIdArray.length; i < len; i++) {
		var syokanId = search_syokanIdArray[i];
		if (soushinsyaArray[syokanId].indexOf(searchTxt) != -1) {
			resSyokanIdArray.push(syokanId);
		}
	}
	return resSyokanIdArray;
}
// 宛先名で検索し、条件に合致するIDを返す
function searchAtesaki(search_syokanIdArray, searchTxt) {
	var resSyokanIdArray = [];
	for (var i = 0, len = search_syokanIdArray.length; i < len; i++) {
		var syokanId = search_syokanIdArray[i];
		if (atesakiArray[syokanId].indexOf(searchTxt) != -1) {
			resSyokanIdArray.push(syokanId);
		}
	}
	return resSyokanIdArray;
}
// 運営名で検索し、条件に合致しないIDを返す
function uneiSyokanLimit(search_syokanIdArray){
	var resSyokanIdArray = [];
	for (var i = 0, len = search_syokanIdArray.length; i < len; i++) {
		var syokanId = search_syokanIdArray[i];
		if (soushinsyaArray[syokanId].indexOf(uneiLimitTxt) == -1) {
			resSyokanIdArray.push(syokanId);
		}
	}
	return resSyokanIdArray;
}

// 引数の書簡ID配列、ページ番号を元に検索結果表示
function addShowTable (show_syokanIdArray, page_index) {
	if (page_index == null) { page_index = 0 };
	var pre_tableEL = $xp1('//table[@id="showTable"]', d_13);
	if (pre_tableEL != null) {
		pre_tableEL.parentNode.removeChild(pre_tableEL);
	}
	var pre_pagerEL = $xp1('//div[@id="search_pager"]', d_13);
	if (pre_pagerEL != null) {
		pre_pagerEL.parentNode.removeChild(pre_pagerEL);
	}
	var tableEL = d_13.createElement("table");
		tableEL.className = "showTable";
		tableEL.id = "showTable";
	var trEL = d_13.createElement("tr");
	var thEL = d_13.createElement("th");
	var tdEL = d_13.createElement("td");
	var pargerEL = d_13.createElement("div");
		pargerEL.id = "search_pager";
		
		thEL.innerHTML = "No";
		thEL.style.width = "20px";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "送信者";
		thEL.style.width = "80px";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "宛先";
		thEL.style.width = "120px";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "件名";
		thEL.style.width = "200px";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "日時";
		thEL.style.width = "80px";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "本文表示";
		thEL.style.width = "200px";
		trEL.appendChild(thEL.cloneNode(true));
	tableEL.appendChild(trEL.cloneNode(true));
	
	var len = show_syokanIdArray.length;
	if (len <= 0 ) {
		var data_trEL = d_13.createElement("tr");
		var data_thEL = d_13.createElement("th");
		var data_tdEL = d_13.createElement("td");
			data_tdEL.colSpan = 5;
			data_tdEL.innerHTML = "※該当書簡は存在しません。";
			data_tdEL.align = "center";
			data_trEL.appendChild(data_thEL);
			data_trEL.appendChild(data_tdEL);
		tableEL.appendChild(data_trEL);
	} else {
		show_syokanIdArray.sort ( function sort(a, b) { return (b - a); } )
		var i_start = page_index * pageUnit;
		var i_end = i_start + pageUnit;
		if (i_end >= len) { i_end = len }
		
		function returnShowSyokan(syokanId) {
			return function() { showSyokan(syokanId); }
		}
		function returnSeachExe(searchTxt) {
			return function() {
				var searchSelectNode = $xp1('//select[@id="searchSelect"]', d_13);
					searchSelectNode.selectedIndex = 0;
				var searchTxtNode = $xp1('//input[@id="searchTxt"]', d_13);
					searchTxtNode.value = searchTxt;
				searchExe();
			}
		}
		
		for (var i = i_start; i < i_end; i++ ) {
			var syokanId = show_syokanIdArray[i];
			var soushinsya = soushinsyaArray[syokanId];
			var kenmei = kenmeiArray[syokanId];
			var atesaki = atesakiArray[syokanId];
			var nichiji = nichijiArray[syokanId];
			var honbun = loadSyokanValue(syokanId);
				honbun = honbun.replace(/<br>/g, "");
			
			var data_trEL = d_13.createElement("tr");
			var data_thEL = d_13.createElement("th");
			var data_tdEL = d_13.createElement("td");
			var data_tdBtnEL1 = d_13.createElement("td");
				data_tdBtnEL1.style.backgroundColor = "#ffffdf";
			var data_tdBtnEL2 = d_13.createElement("td");
				data_tdBtnEL2.style.backgroundColor = "#ffdfff";
			var data_tdBtnEL3 = d_13.createElement("td");
				data_tdBtnEL3.style.backgroundColor = "#dfffff";
			
				data_thEL.innerHTML = i + 1;
				data_trEL.appendChild(data_thEL.cloneNode(true));
				data_tdBtnEL1.innerHTML = soushinsya;
				data_tdBtnEL1.addEventListener("click", returnSeachExe(soushinsya), false);
				data_trEL.appendChild(data_tdBtnEL1);
				data_tdBtnEL2.innerHTML = atesaki;
				data_tdBtnEL2.addEventListener("click", returnSeachExe(atesaki), false);
				data_trEL.appendChild(data_tdBtnEL2);
				data_tdEL.innerHTML = kenmei;
				data_trEL.appendChild(data_tdEL.cloneNode(true));
				data_tdEL.innerHTML = nichiji;
				data_trEL.appendChild(data_tdEL.cloneNode(true));
				data_tdBtnEL3.appendChild(d_13.createTextNode(c_subString(honbun, 30)));
				data_tdBtnEL3.addEventListener("click", returnShowSyokan(syokanId), false);
				data_trEL.appendChild(data_tdBtnEL3);
			tableEL.appendChild(data_trEL);
		}
		
		if (len > pageUnit) {
			var preBtnEL = d_13.createElement("input");
				preBtnEL.type = "button";
				preBtnEL.id = "prePager";
				preBtnEL.value = "前のページへ";
				preBtnEL.addEventListener("click", function() {
					addShowTable(show_syokanIdArray, page_index - 1)
					}, false);
			var nextBtnEL = d_13.createElement("input");
				nextBtnEL.type = "button";
				nextBtnEL.id = "nextPager";
				nextBtnEL.value = "次のページへ";
				nextBtnEL.addEventListener("click", function() {
					addShowTable(show_syokanIdArray, page_index + 1)
				}, false);
				
			if (i_start <= 0 ) { preBtnEL.disabled = true; }
			if (i_end >= len ) { nextBtnEL.disabled = true; }
			pargerEL.appendChild(preBtnEL);
			pargerEL.appendChild(nextBtnEL);
		}
		pargerEL.appendChild(d_13.createTextNode("　該当件数" + len + "件"));
	}
	
	var baseEL = $xp1('//div[@id="bro_view_base"]', d_13);
		baseEL.appendChild(pargerEL);
		baseEL.appendChild(tableEL);
	$_13("#showTable").hide();
	$_13("#showTable").slideDown();
}
function c_subString(txt, num) {
	if (txt.length > num) { txt = txt.substring(0, num - 3) + "..."; }
	return txt;
}

// 書簡文表示
function showSyokan(syokanId) {
	
	var baseLayer = d_13.createElement("div");
		baseLayer.id = "baseLayer";
		baseLayer.style.position = "absolute";
		baseLayer.style.zIndex = 1;
		baseLayer.style.width = "100%";
		baseLayer.style.height = "100%";
		
	var mask = d_13.createElement("div");
		mask.style.backgroundColor = "#202020";
		mask.style.position = "fixed";
		mask.style.width = "100%";
		mask.style.height = "100%";
		mask.style.opacity = 0.90;
		mask.addEventListener("click", function() {
			baseLayer.parentNode.removeChild(baseLayer);
		}, false);
		baseLayer.appendChild(mask);
		
	var explain = d_13.createElement("div");
		explain.id = "gray02Wrapper";
		explain.style.position = "absolute";
		explain.style.marginTop  = "200px";
		explain.style.marginLeft  = "50px";
		explain.style.padding  = "25px";
		explain.style.width = "600px";
		
	baseLayer.appendChild(explain);
	var targetNode = $xp1('//body', d_13);
		targetNode.insertBefore(baseLayer, targetNode.firstChild);

	var tableEL = d_13.createElement("table");
		tableEL.style.width = "100%";
		tableEL.className = "showTable";
	var trEL = d_13.createElement("tr");
	var thEL = d_13.createElement("th");
	var tdEL = d_13.createElement("td");
		tdEL.style.padding = "5px";
		thEL.innerHTML = "送信者";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "宛先";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "件名";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "日時";
		trEL.appendChild(thEL.cloneNode(true));
	tableEL.appendChild(trEL.cloneNode(true));
	
	var soushinsya = soushinsyaArray[syokanId];
	var kenmei = kenmeiArray[syokanId];
	var atesaki = atesakiArray[syokanId];
	var nichiji = nichijiArray[syokanId];
	var honbun = loadSyokanValue(syokanId);
		
		trEL.innerHTML = null;
		tdEL.innerHTML = soushinsya;
		trEL.appendChild(tdEL.cloneNode(true));
		tdEL.innerHTML = atesaki;
		trEL.appendChild(tdEL.cloneNode(true));
		tdEL.innerHTML = kenmei;
		trEL.appendChild(tdEL.cloneNode(true));
		tdEL.innerHTML = nichiji;
		trEL.appendChild(tdEL.cloneNode(true));
	tableEL.appendChild(trEL.cloneNode(true));
	
		trEL.innerHTML = null;
		tdEL.colSpan = 4;
		tdEL.innerHTML = honbun;
		tdEL.appendChild(d_13.createElement("br"));
		tdEL.appendChild(d_13.createElement("br"));
	var aEL = d_13.createElement("a");
		aEL.innerHTML = "返信する";
		aEL.href = "new.php?id=" + syokanId;
		tdEL.appendChild(aEL);
		trEL.appendChild(tdEL);
	tableEL.appendChild(trEL);
	explain.appendChild(tableEL);
	
	$_13("#gray02Wrapper").hide();
	$_13("#gray02Wrapper").slideDown();
}

////////////////////////////////////////////////////////
//オプション画面
////////////////////////////////////////////////////////
function addOpMain() {
	var targetNode = $xp1('//div[@id="gray02Wrapper"]', d_13);
		targetNode.innerHTML = null;
		
	var baseEL = d_13.createElement("div");
		baseEL.id = "bro_op_base";
		
		baseEL.appendChild(d_13.createTextNode("【書簡保存・検索　設定】"));
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createTextNode("　１．書簡画面表示時、未保存書簡の自動保存を"));
		
	var autoCashBtn = d_13.createElement("input");
		autoCashBtn.type = "button";
		autoCashBtn.id = "autoCashBtn";
		if (opValues["autoCash"]) {
			autoCashBtn.value = "【無効化する】";
			autoCashBtn.addEventListener("click", function() {
				opValues["autoCash"] = false;
				saveOpValues();
				addOpMain();
			}, false);
		} else {
			autoCashBtn.value = "【有効化する】";
			autoCashBtn.addEventListener("click", function() {
				opValues["autoCash"] = true;
				saveOpValues();
				addOpMain();
			}, false);
		}
		baseEL.appendChild(autoCashBtn);
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createTextNode("　２．運営からの書簡を検索結果に"));
		
	var UneiLimitBtn = d_13.createElement("input");
		UneiLimitBtn.type = "button";
		UneiLimitBtn.id = "UneiLimitBtn";
		if (opValues["uneiLimit"]) {
			UneiLimitBtn.value = "【表示する】";
			UneiLimitBtn.addEventListener("click", function() {
				opValues["uneiLimit"] = false;
				saveOpValues();
				addOpMain();
			}, false);
		} else {
			UneiLimitBtn.value = "【表示しない】";
			UneiLimitBtn.addEventListener("click", function() {
				opValues["uneiLimit"] = true;
				saveOpValues();
				addOpMain();
			}, false);
		}
		baseEL.appendChild(UneiLimitBtn);
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createTextNode("　３．指定ワールドの保存書簡をだらあああと"));
		
	var outputBtn = d_13.createElement("input");
		outputBtn.type = "button";
		outputBtn.id = "outputBtn";
		outputBtn.value = "【出力する】";
		outputBtn.addEventListener("click", function() {
			outputBtn.disabled = true;
			
			var key = prompt("現ワールド以外の書簡情報を出力したい場合は、\nホスト名を指定してください。\n※現ワールドのホスト名が初期値で表示されています。", worldKey);
			if (!key) { outputBtn.disabled = false; return; }
			key_loadCmValue(key);
			var len = syokanIdArray.length;
			if(len <= 0) { alert("指定ワールドの保存書簡は存在しません。"); outputBtn.disabled = false; return; }
			
			syokanOutput(key);
		}, false);
		baseEL.appendChild(outputBtn);
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createTextNode("　４．指定ワールドの保存情報を"));
		
	var resetBtn = d_13.createElement("input");
		resetBtn.type = "button";
		resetBtn.id = "resetBtn";
		resetBtn.value = "【リセットする】";
		resetBtn.addEventListener("click", function() {
			resetBtn.disabled = true;
			
			var key = prompt("現ワールド以外の書簡情報をリセットしたい場合は、\nホスト名を指定してください。\n※現ワールドのホスト名が初期値で表示されています。", worldKey);
			if (!key) { resetBtn.disabled = false; return; }
			key_loadCmValue(key);
			var len = syokanIdArray.length;
			if(len <= 0) { alert("指定ワールドの保存書簡は存在しません。"); resetBtn.disabled = false; return; }
			
			if (confirm("【再確認】ホスト名：" + key + "ワールドの書簡情報のすべてをクリアします。\n※また、処理には相当な時間を要します。気長に待てる時の実行を推奨します。")) {
				autoCashBtn.disabled = true;
				UneiLimitBtn.disabled = true;
				outputBtn.disabled = true;
				resetCashMain(key);
			} else {
				resetBtn.disabled = false;
			}
		}, false);
		baseEL.appendChild(resetBtn);
	targetNode.appendChild(baseEL);
	
	baseEL.appendChild(d_13.createElement("br"));
	baseEL.appendChild(d_13.createElement("br"));
	baseEL.appendChild(d_13.createTextNode("　５．本スクリプトの最新版などは→をご確認ください　・ｗ・　"));
	var aEL = d_13.createElement("a");
		aEL.innerHTML = "<font color='blue'><u>Project.殺伐</u></font>";
		aEL.href = "http://aoyamayuuto.blog92.fc2.com/";
		aEL.target = "_blank";
	baseEL.appendChild(aEL);
	
	$_13("#bro_op_base").hide();
	$_13("#bro_op_base").slideDown();
}
////////////////////////////////////////////////////////
//書簡出力
////////////////////////////////////////////////////////
function syokanOutput(key, page_index) {
	if (page_index == null) { page_index = 0 };
	var pre_baseEL = $xp1('//div[@id="bro_output_base"]', d_13);
	if (pre_baseEL != null) {
		pre_baseEL.parentNode.removeChild(pre_baseEL);
	}
	
	var targetNode = $xp1('//div[@id="gray02Wrapper"]', d_13);
		targetNode.innerHTML = null;
	var baseEL = d_13.createElement("div");
		baseEL.id = "bro_output_base";
		targetNode.appendChild(baseEL);
	
	var textAreaEL = d_13.createElement("textarea");
		textAreaEL.cols = 95;
		textAreaEL.rows = 25;
		
	var len = syokanIdArray.length;
	pageUnit = 100;
	var i_start = page_index * pageUnit;
	var i_end = i_start + pageUnit;
	if (i_end >= len) { i_end = len }
		
	for (var i = i_start; i < i_end; i++ ) {
		var syokanId = syokanIdArray[i];
		var nichiji = nichijiArray[syokanId];
		var soushinsya = soushinsyaArray[syokanId];
		var atesaki = atesakiArray[syokanId];
		var kenmei = kenmeiArray[syokanId];
		var honbun = key_loadSyokanValue(key, syokanId);
			honbun = honbun.replace(/\r\n/g, "");
			honbun = honbun.replace(/(\n|\r)/g, "");
		
		textAreaEL.defaultValue = textAreaEL.defaultValue +
									syokanId + "\t" +
									nichiji + "\t" +
									soushinsya + "\t" +
									atesaki + "\t" +
									kenmei + "\t" +
									honbun + "\n";
	}
	
	if (len > pageUnit) {
		var preBtnEL = d_13.createElement("input");
			preBtnEL.type = "button";
			preBtnEL.id = "prePager";
			preBtnEL.value = "前のページへ";
			preBtnEL.addEventListener("click", function() {
				syokanOutput(key, page_index - 1)
				}, false);
		var nextBtnEL = d_13.createElement("input");
			nextBtnEL.type = "button";
			nextBtnEL.id = "nextPager";
			nextBtnEL.value = "次のページへ";
			nextBtnEL.addEventListener("click", function() {
				syokanOutput(key, page_index + 1)
			}, false);
			
		if (i_start <= 0 ) { preBtnEL.disabled = true; }
		if (i_end >= len ) { nextBtnEL.disabled = true; }
		baseEL.appendChild(preBtnEL);
		baseEL.appendChild(nextBtnEL);
	}
	baseEL.appendChild(d_13.createTextNode("　総件数" + len + "件　" + (i_start + 1) + "～" + i_end));
	
	baseEL.appendChild(textAreaEL);
}

////////////////////////////////////////////////////////
// GM関連の共通関数
// 保持するGM変数は下記３分類
// 　１．オプション設定情報
// 　２．書簡項目ごとに分類したキャッシュ情報
// 　３．書簡本文のキャッシュ情報
////////////////////////////////////////////////////////
function loadOpValues () {
	opValues = eval(GM_getValue(worldKey + "opValues", {}));
	if (opValues["autoCash"] == null) { opValues["autoCash"] = false; }
	if (opValues["uneiLimit"] == null) { opValues["uneiLimit"] = false; }
}
function saveOpValues () {
	GM_setValue(worldKey + "opValues", opValues.toSource());
}
function loadCmValue () {
	syokanIdArray = eval(GM_getValue(worldKey + "syokanIdArray", []));
	soushinsyaArray = eval(GM_getValue(worldKey + "soushinsyaArray", {}));
	atesakiArray = eval(GM_getValue(worldKey + "atesakiArray", {}));
	kenmeiArray = eval(GM_getValue(worldKey + "kenmeiArray", {}));
	nichijiArray = eval(GM_getValue(worldKey + "nichijiArray", {}));
}
function saveCmValue () {
	GM_setValue(worldKey + "syokanIdArray", syokanIdArray.toSource());
	GM_setValue(worldKey + "soushinsyaArray", soushinsyaArray.toSource());
	GM_setValue(worldKey + "atesakiArray", atesakiArray.toSource());
	GM_setValue(worldKey + "kenmeiArray", kenmeiArray.toSource());
	GM_setValue(worldKey + "nichijiArray", nichijiArray.toSource());
}
function loadSyokanValue (syokanId) {
	var honbun = GM_getValue(worldKey + "syokan:" + syokanId, "");
	if (honbun == null) { return "" }
	return honbun;
}
function saveHonbunValue (syokanId, honbun) {
	GM_setValue(worldKey + "syokan:" + syokanId, honbun);
}
// サーバ指定用
function resetCashMain(key) {
	syokanIdArray = eval(GM_getValue(key + "syokanIdArray", []));
	
	for (var i = 0, len = syokanIdArray.length; i < len; i++) {
		GM_deleteValue(key + "syokan:" + syokanIdArray[i]);
	}
	GM_deleteValue(key + "syokanIdArray");
	GM_deleteValue(key + "soushinsyaArray");
	GM_deleteValue(key + "atesakiArray");
	GM_deleteValue(key + "kenmeiArray");
	GM_deleteValue(key + "nichijiArray");
	GM_deleteValue(key + "opValues");
	GM_deleteValue(key + "time_checker");
	alert("リセット完了しました。");
	location.reload();
}
function key_loadCmValue (key) {
	syokanIdArray = eval(GM_getValue(key + "syokanIdArray", []));
	soushinsyaArray = eval(GM_getValue(key + "soushinsyaArray", {}));
	atesakiArray = eval(GM_getValue(key + "atesakiArray", {}));
	kenmeiArray = eval(GM_getValue(key + "kenmeiArray", {}));
	nichijiArray = eval(GM_getValue(key + "nichijiArray", {}));
}
function key_loadSyokanValue (key, syokanId) {
	var honbun = GM_getValue(key + "syokan:" + syokanId, "");
	if (honbun == null) { return "" }
	return honbun;
}
//faraway}) ();
}	//faraway
//faraway 13.書簡保存＆検索ツールのソース(bro3_syokanbox.user.js)終了

//faraway 14.トレード検索条件記憶のソース(b3tradememory.user.js) 開始
//================================================================================
//14.トレード検索条件記憶
//================================================================================
// ==UserScript==
// @name            b3TradeMemory
// @namespace       b3trmem
// @description     トレード検索条件記憶スクリプト
// @include         http://*.3gokushi.jp/card/trade.php*
// @version         0.1
// @date            2010/08/10
// ==/UserScript==

//faraway 14.トレード検索条件記憶変数宣言移動前の場所

//faraway(function(){
function disp_tradingretrieval() {	//faraway
//window.alert("14.トレード検索条件記憶:" + location.pathname);	//faraway
	if(location.pathname != "/card/trade.php") return;	//faraway
//window.alert("disp_tradingretrievalです。14");
	var sendTd = xpath_14('//*[@id="gray02Wrapper"]//div[@class="ui-tabs-panel"]', document);

	var ar = GM_getValue(location.hostname + "TrdMem");
	var Mem = new Array();

	if(ar == undefined){
		for(var i=0;i<num_14;i++){
			Mem[i] = "";
		}
	}else{
		Mem = ar.split("#$%");
	}

	var conLnk = new Array();
	var bar = document.createElement("ul");
	bar.id = "statMenu";

	for(var i=0;i<num_14;i++){
		
		conLnk[i] = document.createElement("li");
		conLnk[i].innerHTML = Mem[i];
		(function(){
			var n = i;
			conLnk[i].addEventListener("click", function(){ccSet(n);}, true);
		})();
		bar.appendChild(conLnk[i]);
	}

	var opt = document.createElement("li");
	opt.className = "last";
	opt.innerHTML = "設定画面";
	opt.addEventListener("click", optMenu_14, true);
	bar.appendChild(opt);

	sendTd.snapshotItem(0).insertBefore(bar, sendTd.snapshotItem(0).childNodes[2] );

//faraway})();
}	//faraway

function xpath_14(query,targetDoc) {return document.evaluate(query, targetDoc, null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);}

// 呼び出し
function ccSet(i){
	var input  = xpath_14('//input[@id="k"]', document);
	var select = xpath_14('//select[@id="t"]', document);

	var conMem = GM_getValue(location.hostname + "TrdCon").split("#$%");
	select.snapshotItem(0).selectedIndex = conMem[i];
	var keyMem = GM_getValue(location.hostname + "TrdKey").split("#$%");
	input.snapshotItem(0).value = keyMem[i];
}

// 設定画面
function optMenu_14(){
	var wrap = xpath_14('//*[@id="gray02Wrapper"]',document);

	for(var i=wrap.snapshotItem(0).childNodes.length;i>0;i--){
		wrap.snapshotItem(0).removeChild(wrap.snapshotItem(0).lastChild);
	}

	var table = document.createElement("table");
	table.className = "commonTables";

	var tr = document.createElement("tr");
	var th = document.createElement("th");
	th.className = "ttl3";
	th.innerHTML = "表示名";
	th2 = document.createElement("th");
	th2.className = "ttl4";
	th2.innerHTML = "検索条件";
	th3 = document.createElement("th");
	th3.className = "ttl4";
	th3.innerHTML = "検索ワード";

	tr.appendChild(th);
	tr.appendChild(th2);
	tr.appendChild(th3);
	table.appendChild(tr);

	var Mem = new Array();
	var Con = new Array();
	var Key = new Array();

	var ar = GM_getValue(location.hostname + "TrdMem");
	if(ar == undefined){
		for(var i=0;i<num_14;i++){
			Mem[i] = "";
		}
	}else{
		Mem = ar.split("#$%");
	}

	var ar = GM_getValue(location.hostname + "TrdCon");
	if(ar == undefined){
		for(var i=0;i<num_14;i++){
			Con[i] = "";
		}
	}else{
		Con = ar.split("#$%");
	}

	var ar = GM_getValue(location.hostname + "TrdKey");
	if(ar == undefined){
		for(var i=0;i<num_14;i++){
			Key[i] = "";
		}
	}else{
		Key = ar.split("#$%");
	}

	for(var i=0;i<num_14;i++){
		var tr = document.createElement("tr");
		var td = document.createElement("th");
		td.innerHTML = "<input type=\"text\" size=\"15\" name=\"view" + i + "\" id=\"view" + i + "\" style=\"border:1px solid;\" value=\"" + Mem[i] + "\" />";
		td.className = "ttl";

		var td2 = document.createElement("th");
		td2.className = "ttl";

		var selTag = document.createElement("select");
		selTag.className = 'combo';
		selTag.id = 'con' + i;
		selTag.name = 'con' + i;
		var opt0   = document.createElement("option");
		opt0.value = 0;
		opt0.innerHTML = '武将名';
		var opt1   = document.createElement("option");
		opt1.value = 1;
		opt1.innerHTML = 'レベル';
		var opt2   = document.createElement("option");
		opt2.value = 2;
		opt2.innerHTML = 'カードNo';
		var opt3   = document.createElement("option");
		opt3.value = 3;
		opt3.innerHTML = '所持スキル';

		selTag.appendChild(opt0);
		selTag.appendChild(opt1);
		selTag.appendChild(opt2);
		selTag.appendChild(opt3);
		selTag.selectedIndex = Con[i];
		td2.appendChild(selTag);


		var td3 = document.createElement("th");
		td3.className = "ttl";
		td3.innerHTML = "<input type=\"text\" size=\"40\" name=\"key" + i + "\" id=\"key" + i + "\" style=\"border:1px solid;\" value=\"" + Key[i] + "\" />";

		tr.appendChild(td);
		tr.appendChild(td2);
		tr.appendChild(td3);
		table.appendChild(tr);
	}

	var tr = document.createElement("tr");
	var td = document.createElement("td");
	td.colSpan = 3;
	td.align = "center";

	var btn = document.createElement("input");
	btn.type = "button";
	btn.value = "保存";
	btn.addEventListener("click", saveData_14, true);

	var wrlink = document.createElement("span");
	wrlink.innerHTML = " | ";

	var link = document.createElement("a");
	link.href = "javascript:void(0)";
	link.innerHTML = "戻る";
	link.addEventListener("click", 
		function(){
			location.reload();
		},
	true);

	wrlink.appendChild(link);

	td.appendChild(btn);
	td.appendChild(wrlink);
	tr.appendChild(td);
	table.appendChild(tr);

	wrap.snapshotItem(0).appendChild(table);
}

function saveData_14(){
	var scrMem = "";	// save用変数
	var scrCon = "";
	var scrKey = "";

	var table = xpath_14('//*[@id="gray02Wrapper"]/table[@class="commonTables"]',document);

	var n = 0;
	var len = table.snapshotItem(0).rows.length;
	for(var i=1;i<len-1;i++){
		var view = xpath_14('//input[@id="view' + n + '"]',document);
		var con  = xpath_14('//select[@id="con'  + n + '"]',document);
		var key  = xpath_14('//input[@id="key'  + n + '"]',document);
		scrMem += view.snapshotItem(0).value;
		scrMem += "#$%";
		scrCon += con.snapshotItem(0).value;
		scrCon += "#$%";
		scrKey += key.snapshotItem(0).value;
		scrKey += "#$%";
		n++;
	}

	GM_setValue(location.hostname + "TrdMem", scrMem);
	GM_setValue(location.hostname + "TrdCon", scrCon);
	GM_setValue(location.hostname + "TrdKey", scrKey);

	alert('保存OK。多分ね。');
}


//faraway 14.トレード検索条件記憶のソース(b3tradememory.user.js)終了

//faraway 15.トレードその後のソース(b3systemmailopener.user.js) 開始
//================================================================================
//15.トレードその後
//================================================================================
// ==UserScript==
// @name          B3SystemMailOpener
// @namespace     b3sysmail
// @include       http://*.3gokushi.jp/message/inbox.php*
// @date          2010/10/23
// @version       0.1
// ==/UserScript==

//faraway 15.トレードその後変数宣言移動前の場所
var c   = 0;
var url = new Array();

//faraway(function(){
function disp_tradingafter() {	//faraway
//window.alert("15.トレードその後:" + location.pathname);	//faraway
	if(location.pathname != "/message/inbox.php") return;	//faraway
	var tableTitle = xpath_15('//*[@id="gray02Wrapper"]//ul[@id="statMenu"]', document);
	var classRmv = xpath_15('//*[@id="gray02Wrapper"]//ul[@id="statMenu"]/li[@class="last"]', document);

	classRmv.snapshotItem(0).removeAttribute('class');

	var opnNtc = document.createElement("li");
	opnNtc.innerHTML = "<a href=\"javascript:void(0)\">運営書簡開封します</a>";
	var num = tableTitle.snapshotItem(0).childNodes.length;
	tableTitle.snapshotItem(0).insertBefore(opnNtc, tableTitle.snapshotItem(0).childNodes.item(num));
	opnNtc.addEventListener("click", opnNtcF, true);

	var chkSet = document.createElement("li");
	chkSet.className = "last";
	chkSet.innerHTML = "<a href=\"javascript:void(0)\">運営書簡チェックします</a>";
	var num = tableTitle.snapshotItem(0).childNodes.length;
	tableTitle.snapshotItem(0).insertBefore(chkSet, tableTitle.snapshotItem(0).childNodes.item(num));
	chkSet.addEventListener("click", chkSetF, true);

//faraway})();
}	//faraway

//空白除去
function trim_15(str) {
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$|&nbsp;/g, "");
}
function xpath_15(query,targetDoc) {return document.evaluate(query, targetDoc, null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);}

function opnNtcF(){
	var table = xpath_15('//table[@class="commonTables"]', document);

	var len = table.snapshotItem(0).rows.length;

	window.setTimeout(function(){
		for(var i=2;i<len;i++){
			if( (table.snapshotItem(0).rows[i].className == 'unread') && (table.snapshotItem(0).rows[i].cells[2].getElementsByTagName('span')[0].className == 'notice') ) {
				url[++c] = table.snapshotItem(0).rows[i].cells[1].getElementsByTagName('a')[0].href;
			}
		}
	},0);

	window.setTimeout(function(){
		for(var i=1;i<=c;i++){
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.open("GET",url[i]);
				xmlhttp.send(null);
		}
	},0);

}

function chkSetF(){
	var table = xpath_15('//table[@class="commonTables"]', document);

	var len = table.snapshotItem(0).rows.length;

	for(var i=2;i<len;i++){
		if(table.snapshotItem(0).rows[i].cells[2].getElementsByTagName('span')[0]){
			table.snapshotItem(0).rows[i].cells[0].getElementsByTagName('input')[0].checked = true;
		}
	}

}


//faraway 15.トレードその後のソース(b3systemmailopener.user.js) 終了

//faraway 16.ナビゲーションにロールオーバーリンク追加のソース(_-_.user.js) 開始
//================================================================================
//16.ナビゲーションにロールオーバーリンク追加
//================================================================================
function disp_navigationaddition() {
//window.alert("disp_navigationadditionです。16");
//window.alert("16.ナビゲーションにロールオーバーリンク追加:" + location.pathname);	//faraway
// ==UserScript==
// @name           bro3_navilink
// @version        1.0
// @namespace      http://puyomonolith.blog83.fc2.com/
// @description    ナビゲーション（「同盟」「デッキ」など）にマウスを置くとショートカットリンクを表示します。
// @include        http://*.3gokushi.jp/*
// ==/UserScript==


//ショートカット関数
function $(id){ return document.getElementById(id); }
function $c(className){ return document.getElementsByClassName(className); }

initGMWrapper_16();





//サーバー区別するためにドメイン取得
var domain = document.location.hostname;
function addLink(prClass, linkArr){
	var parent = $c(prClass)[0];
	var ul = document.createElement("ul");
	ul.className = "ro";
	parent.appendChild(ul);
	var temp = ul;
	
	for(keys in linkArr){
		if(keys.indexOf("-") != 0){
			temp = ul;
		}
		
		var li = document.createElement("li");
		temp.appendChild(li);
		var a = document.createElement("a");
		
		if(keys.indexOf("+") == 0 || keys.indexOf("-") == 0){
			a.innerHTML = keys.slice(1);
		} else {
			a.innerHTML = keys;
		}
		
		a.href = linkArr[keys];
		li.appendChild(a);
		
		if(keys.indexOf("+") == 0){
			li.className = "pr";
			var roCh = document.createElement("ul");
			roCh.className = "ro_ch";
			temp = roCh;
			li.appendChild(roCh);
		}
	}
}

var villa = {
	"都市トップ": $c("gnavi01")[0].getElementsByTagName("a")[0].href,
	"同盟拠点": "http://" + domain + "/alliance/village.php",
	"+デュエル": "http://" + domain + "/card/duel_redirect.php",
		"-メイン": "http://" + domain + "/card/duel_main.php#ptop",
		"-デッキセット": "http://" + domain + "/card/duel_set.php#ptop",
		"-成績": "http://" + domain + "/card/duel_record.php#ptop",
	"+プロフィール": "http://" + domain + "/user/",
		"-プロフィール編集": "http://" + domain + "/user/change/change.php",
		"-フレンド管理": "http://" + domain + "/user/friend/friend_list.php",
		"-個人掲示板": "http://" + domain + "/bbs/personal_topic_view.php",
		"-ケータイ設定": "http://" + domain + "/user/mobile_setting.php",
		"-獲得武勲": "http://" + domain + "/user/decoration.php",
		"-シリアルコード": "http://" + domain + "/user/serial/serial.php"
};
if($c("gnavi01").length!=0){
	addLink("gnavi01", villa);
}

var al = {
	"同盟トップ": $c("gnavi03")[0].getElementsByTagName("a")[0].href,
	"ランキング詳細": "http://" + domain + "/alliance/ranking.php#ptop",
	"同盟レベル": "http://" + domain + "/alliance/level.php#ptop",
	"勢力リスト": "http://" + domain + "/alliance/dependency.php#ptop",
	"+同盟ログ": "http://" + domain + "/alliance/alliance_log.php#ptop",
		"-全て": "http://" + domain + "/alliance/alliance_log.php",
		"-攻撃": "http://" + domain + "/alliance/alliance_log.php?m=attack",
		"-防御": "http://" + domain + "/alliance/alliance_log.php?m=defense",
		"-偵察": "http://" + domain + "/alliance/alliance_log.php?m=scout",
		"-破壊": "http://" + domain + "/alliance/alliance_log.php?m=fall",
		"-援軍": "http://" + domain + "/alliance/alliance_log.php?m=reinforcement",
		"-同盟": "http://" + domain + "/alliance/alliance_log.php?m=alliance",
	"掲示板": "http://" + domain + "/bbs/topic_view.php#ptop",
	"同盟ひとこと掲示板": "http://" + domain + "/alliance/chat_view.php#ptop",
	"管理": "http://" + domain + "/alliance/manage.php#ptop",
	"配下同盟管理": "http://" + domain + "/alliance/manage_dep.php#ptop",
	"同盟情報変更": "http://" + domain + "/alliance/change.php#ptop",
	"同盟スキル": "http://" + domain + "/alliance/alliance_skill.php#ptop",
	"助力履歴": "http://" + domain + "/alliance/assist_history.php#ptop",
	"同盟募集": "http://" + domain + "/alliance/recruit.php#ptop",
	"同盟希望": "http://" + domain + "/alliance/join_bbs.php#ptop"
};
if($c("gnavi03").length!=0){
	addLink("gnavi03", al);
}
/* faraway 120127 ｺﾒﾝﾄ開始 SetLinkName()に置き換え
var deck = {
	"城・村・砦": "http://" + domain + "/facility/castle.php#ptop",
	"兵士管理": "http://" + domain + "/facility/unit_status.php#ptop",
	"領地管理": "http://" + domain + "/facility/territory_status.php#ptop",
	"出兵": "http://" + domain + "/facility/castle_send_troop.php#ptop",
	"内政設定": "http://" + domain + "/card/domestic_setting.php#ptop",
	"+デッキ": "http://" + domain + "/card/deck.php#ptop",
		"-ファイル": "http://" + domain + "/card/deck.php?p=1#file-1",
		"-分類１": "http://" + domain + "/card/deck.php?l=1",
		"-分類２": "http://" + domain + "/card/deck.php?l=2",
		"-分類３": "http://" + domain + "/card/deck.php?l=3",
		"-最終ページ": "http://" + domain + "/card/deck.php?p=12#file-1",
		"-ラベル名を設定": "http://" + domain + "/card/tab_edit.php#ptop",
	"合成": "http://" + domain + "/union/#ptop",
	"+トレード": "http://" + domain + "/card/trade.php#ptop",
		"-一覧(全て)": "http://" + domain + "/card/trade_card_list.php#ptop",
		"-一覧(蜀)": "http://" + domain + "/card/trade_card_list.php?country=1#ptop",
		"-一覧(魏)": "http://" + domain + "/card/trade_card_list.php?country=2#ptop",
		"-一覧(呉)": "http://" + domain + "/card/trade_card_list.php?country=3#ptop",
		"-一覧(他)": "http://" + domain + "/card/trade_card_list.php?country=4#ptop",
		"-出品中のカード": "http://" + domain + "/card/exhibit_list.php#ptop",
		"-入札中のカード": "http://" + domain + "/card/bid_list.php#ptop",
		"-出品する": "http://" + domain + "/card/trade_card.php#ptop",
	"ブショーダス履歴": "http://" + domain + "/busyodas/busyodas_history.php#ptop",
	"合成履歴": "http://" + domain + "/union/union_history.php#ptop",
	"カード一括破棄": "http://" + domain + "/card/allcard_delete.php#ptop"
};

addLink("gnavi_deck", deck);

 faraway 120127 ｺﾒﾝﾄ終了 */
/////////////////////////////////////////////////120127 faraway start
function SetLinkName(){	//ラベルに合わせてリンク名設定
	var url="http://" + domain + "/card/tab_edit.php#ptop"; // リクエスト先URL
	var request = new XMLHttpRequest();
	request.open('GET', url);
	request.onreadystatechange = function () {

		if (request.readyState != 4) {
        	// リクエスト中
	    } else if (request.status != 200) {
			//window.alert(result);
	    } else {
    	    // 取得成功
        	var result = request.responseText;
			var pos1 = result.indexOf("編集中のラベル名");
			var pos2 = result.indexOf("ラベルの設定を決定する", pos1);
			var result2 = result.substring(pos1, pos2);
			pos1 = 0;
			var labelName = new Array(3);	//faraway120126
			for(i = 0; i < 3; i++){
				pos2 = result2.indexOf("<dt",pos1);
				pos1 = result2.indexOf(">",pos2);
				pos2 = result2.indexOf("</dt>",pos1);
				labelName[i] = "-" + result2.substring(pos1+1, pos2);
				pos1 = pos2;
			}
			var deck = {
				"城・村・砦": "http://" + domain + "/facility/castle.php#ptop",
				"兵士管理": "http://" + domain + "/facility/unit_status.php#ptop",
				"領地管理": "http://" + domain + "/facility/territory_status.php#ptop",
				"出兵": "http://" + domain + "/facility/castle_send_troop.php#ptop",
				"内政設定": "http://" + domain + "/card/domestic_setting.php#ptop",
				"+デッキ": "http://" + domain + "/card/deck.php#ptop",
				"-ファイル": "http://" + domain + "/card/deck.php?p=1#file-1"
			};

			deck[labelName[0]] = "http://" + domain + "/card/deck.php?l=1";
			deck[labelName[1]] = "http://" + domain + "/card/deck.php?l=2";
			deck[labelName[2]] = "http://" + domain + "/card/deck.php?l=3";
			deck["-ラベル名設定"] = "http://" + domain + "/card/tab_edit.php#ptop";
			deck["-ラベル設定"] = "http://" + domain + "/card/labeling.php#ptop";
			deck["-最終ページ"] = "http://" + domain + "/card/deck.php?p=12#file-1";
			deck["合成"] = "http://" + domain + "/union/#ptop";
			deck["+トレード"] = "http://" + domain + "/card/trade.php#ptop";
			deck["-一覧(全て)"] = "http://" + domain + "/card/trade_card_list.php#ptop";
			deck["-一覧(蜀)"] = "http://" + domain + "/card/trade_card_list.php?country=1#ptop";
			deck["-一覧(魏)"] = "http://" + domain + "/card/trade_card_list.php?country=2#ptop";
			deck["-一覧(呉)"] = "http://" + domain + "/card/trade_card_list.php?country=3#ptop";
			deck["-一覧(他)"] = "http://" + domain + "/card/trade_card_list.php?country=4#ptop";
			deck["-出品中のカード"] = "http://" + domain + "/card/exhibit_list.php#ptop";
			deck["-入札中のカード"] = "http://" + domain + "/card/bid_list.php#ptop";
			deck["-出品する"] = "http://" + domain + "/card/trade_card.php#ptop";
			deck["+コレクション"] = "http://" + domain + "/card/collection_list.php#ptop";
			deck["-黄布の乱"] = "http://" + domain + "/card/collection_list.php?filter=3&category=10#ptop";
			deck["-反董卓連合"] = "http://" + domain + "/card/collection_list.php?filter=3&category=20#ptop";
			deck["-曹操の雄飛"] = "http://" + domain + "/card/collection_list.php?filter=3&category=30#ptop";
			deck["-三顧の礼"] = "http://" + domain + "/card/collection_list.php?filter=3&category=40#ptop";
			deck["-三国鼎立"] = "http://" + domain + "/card/collection_list.php?filter=3&category=50#ptop";
			deck["-ブラ三"] = "http://" + domain + "/card/collection_list.php?filter=3&category=60#ptop";
			deck["+武将絵図①"] = "http://" + domain + "/card/busyobook.php#ptop";
			deck["-UR(未収集)"] = "http://" + domain + "/card/busyobook_picture.php?filter=1&status=2#ptop",
			deck["-SR(未収集)"] = "http://" + domain + "/card/busyobook_picture.php?filter=2&status=2#ptop",
			deck["-R(未収集)"] = "http://" + domain + "/card/busyobook_picture.php?filter=3&status=2#ptop",
			deck["-UC(未収集)"] = "http://" + domain + "/card/busyobook_picture.php?filter=4&status=2#ptop",
			deck["-C(未収集)"] = "http://" + domain + "/card/busyobook_picture.php?filter=5&status=2#ptop",
			deck["+武将絵図②"] = "http://" + domain + "/card/busyobook.php#ptop";
			deck["-蜀(未収集)"] = "http://" + domain + "/card/busyobook_picture.php?filter=6&status=2#ptop";
			deck["-魏(未収集)"] = "http://" + domain + "/card/busyobook_picture.php?filter=7&status=2#pto";
			deck["-呉(未収集)"] = "http://" + domain + "/card/busyobook_picture.php?filter=8&status=2#ptop";
			deck["-他(未収集)"] = "http://" + domain + "/card/busyobook_picture.php?filter=9&status=2#ptop";
//			deck[""] = "";
//			deck[""] = "";
//			deck[""] = "";
			deck["ブショーダス履歴"] = "http://" + domain + "/busyodas/busyodas_history.php#ptop";
			deck["合成履歴"] = "http://" + domain + "/union/union_history.php#ptop";
			deck["カード一括破棄"] = "http://" + domain + "/card/allcard_delete.php#ptop";

			if($c("gnavi_deck").length!=0) addLink("gnavi_deck", deck);
    	}
	};
	request.send(null);
}

SetLinkName();
/////////////////////////////////////////////////120127 faraway end


var maplink = {
	"11x11": $c("gnavi02")[0].getElementsByTagName("a")[0].href.replace(/$/,"&type=1"),
	"15x15": $c("gnavi02")[0].getElementsByTagName("a")[0].href.replace(/$/,"&type=2"),
	"20x20": $c("gnavi02")[0].getElementsByTagName("a")[0].href.replace(/$/,"&type=3"),
	"51x51": $c("gnavi02")[0].getElementsByTagName("a")[0].href.replace(/$/,"&type=4")
};
if($c("gnavi02").length!=0){addLink("gnavi02", maplink);}

var rank = {
	"総合": "http://" + domain + "/user/ranking.php#ptop",
	"人口": "http://" + domain + "/user/ranking.php?m=population",
	"攻撃": "http://" + domain + "/user/ranking.php?m=attack",
	"防御": "http://" + domain + "/user/ranking.php?m=defense",
	"撃破スコア": "http://" + domain + "/user/ranking.php?m=attack_score",
	"防衛スコア": "http://" + domain + "/user/ranking.php?m=defense_score",
	"同盟": "http://" + domain + "/alliance/list.php#ptop",
	"制圧": "http://" + domain + "/alliance/npc_mastery_ranking.php#ptop",
	"デュエル": "http://" + domain + "/user/ranking.php?m=duel",
	"週間ランキング": "http://" + domain + "/user/weekly_ranking.php#ptop"
};
if($c("gnavi04").length!=0){
	addLink("gnavi04", rank);
}

var report = {
	"未読": "http://" + domain + "/report/list.php?u=new&p=0&m=",
	"全て": "http://" + domain + "/report/list.php#ptop",
	"攻撃": "http://" + domain + "/report/list.php?m=attack&u=",
	"防御": "http://" + domain + "/report/list.php?m=defence&u=",
	"偵察": "http://" + domain + "/report/list.php?m=scout&u=",
	"破壊": "http://" + domain + "/report/list.php?m=fall&u=",
	"援軍": "http://" + domain + "/report/list.php?m=reinforcement&u=",
	"同盟": "http://" + domain + "/report/list.php?m=alliance&u=",
	"デュエル": "http://" + domain + "/report/list.php?m=pvp&u="
};
if($c("gnavi05").length!=0 ||$c("gnavi05new").length!=0 ){
	addLink("gnavi05" + (!$c("gnavi05").length ? "new" : ""), report);

	var report_ro = $c("gnavi05" + (!$c("gnavi05").length ? "new" : ""))[0].getElementsByClassName("ro")[0];
	var li = document.createElement("li");
	report_ro.appendChild(li);
	var input = document.createElement("input");
	input.type = "button";
	input.value = "全てを既読に";
	li.appendChild(input);
	input.addEventListener("click", allOpenRepo, false);
}

//報告書全てを既読にする関数
function allOpenRepo(){
	if(confirm("全ての報告書を既読にしますか？")) {
		httpRequest = new XMLHttpRequest();
		httpRequest.open("POST", "http://" + domain + "/report/list.php", true);
		httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
		httpRequest.onreadystatechange = function() {
			if(httpRequest.readyState == 4 && httpRequest.status == 200) {
				alert("完了しました");
				if($c("gnavi05new").length){
					//var back_y = parseInt(String(getComputedStyle($c("gnavi05new")[0], '').backgroundPosition).split(" ")[1].split("px")[0]) + 30;
					//$c("gnavi05new")[0].style.backgroundPosition = "0% " + back_y + "px";
					$c("gnavi05new")[0].className = "gnavi05";
				}
				if(String(document.location).indexOf("/report/list.php") != -1){
					document.location.reload();
				}
			}
		}
		//リクエスト送信
		httpRequest.send("all_open=" + escape("全てを既読にする"));
	}
}

var mes = {
	"未読": "http://" + domain + "/message/inbox.php?u=new&p=0",
	"受信箱": "http://" + domain + "/message/inbox.php",
	"送信履歴": "http://" + domain + "/message/outbox.php#ptop",
	"新規作成": "http://" + domain + "/message/new.php#ptop",
	"ブラックリスト": "http://" + domain + "/message/black_list/black_list.php#ptop"
}

if($c("gnavi06").length!=0 || $c("gnavi06new").length!=0 ){
	addLink("gnavi06" + (!$c("gnavi06").length ? "new" : ""), mes);

	var mes_ro = $c("gnavi06" + (!$c("gnavi06").length ? "new" : ""))[0].getElementsByClassName("ro")[0];
	var li = document.createElement("li");
	mes_ro.appendChild(li);
	var input = document.createElement("input");
	input.type = "button";
	input.value = "全てを既読に";
	li.appendChild(input);
	input.addEventListener("click", allOpenMes, false);
}
//書簡全てを既読にする関数
function allOpenMes(){
	if(confirm("全ての書簡を既読にしますか？\n(運営チームからの書簡は既読にできません)")) {
		httpRequest = new XMLHttpRequest();
		httpRequest.open("POST", "http://" + domain + "/message/inbox.php", true);
		httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
		httpRequest.onreadystatechange = function() {
			if(httpRequest.readyState == 4 && httpRequest.status == 200) {
				alert("完了しました");
				if($c("gnavi06new").length){
					$c("gnavi06new")[0].className = "gnavi06";
				}
				if(String(document.location).indexOf("/message/inbox.php") != -1){
					document.location.reload();
				}
			}
		}
		//リクエスト送信
		httpRequest.send("all_open=" + escape("全てを既読にする"));
	}
}

var quest = {
	"未クリア": "http://" + domain + "/quest/?mode=0",
	"クリア済": "http://" + domain + "/quest/?mode=1",
	"全部": "http://" + domain + "/quest/?mode=2",
	"受理中": "http://" + domain + "/quest/?mode=3"
};
if($c("gnavi_quest").length!=0) addLink("gnavi_quest", quest);
if($c("gnavi_questnew").length!=0) addLink("gnavi_questnew", quest);

//宝物庫（アイテム）

if($c("gnavi_item").length!=0 || $c("gnavi_itemnew").length!=0 ){
	addLink("gnavi_item" + (!$c("gnavi_item").length ? "new" : ""), {
			"便利アイテム":"http://" + domain +"/item/index.php",
			"受信箱":"http://" + domain +"/item/inbox.php"
	});
}




//書簡全てを既読にする関数
function aaaaOpenMes(){
	if(confirm("全ての書簡を既読にしますか？\n(運営チームからの書簡は既読にできません)")) {
		httpRequest = new XMLHttpRequest();
		httpRequest.open("POST", "http://" + domain + "/message/inbox.php", true);
		httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
		httpRequest.onreadystatechange = function() {
			if(httpRequest.readyState == 4 && httpRequest.status == 200) {
				alert("完了しました");
				if($c("gnavi06new").length){
					$c("gnavi06new")[0].className = "gnavi06";
				}
				if(String(document.location).indexOf("/message/inbox.php") != -1){
					document.location.reload();
				}
			}
		}
		//リクエスト送信
		httpRequest.send("all_open=" + escape("全てを既読にする"));
	}
}











//スタイル追加
GM_addStyle( (<><![CDATA[
	#gNav > ul > li:hover > ul, #gNav ul.ro > li:hover > ul.ro_ch {
		display: block !important;
	}
	div#gNav ul.ro, div#gNav ul.ro_ch {
		background: #1a1a1a !important;
		border: 2px solid #1a1a1a;
		padding: 3px;
		width: auto;
		min-width: 80px;
		height: auto;
		position: absolute;
		z-index: 9999;
		display: none;
	}
	ul.ro li {
		margin-right: 0 !important;
		float: none !important;
	}
	ul.ro > li {
		position: relative;
	}
	li.pr > a {
		background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAIAAADwlwNsAAAABGdBTUEAALGPC/xhBQAAAEBJREFUKFNj/P//PwN+AFTR0NAAJHEBBogKCMCqCEUFVkXoKjANw64CWR0+FRBLyTUD2VMk+gVfeBAIUzzSQCkAL60+obPpW1IAAAAASUVORK5CYII=") right no-repeat;
	}
	li.pr > a:after {
		content: ">";
		display: #1a1a1a;
		position: absolute;
		top: 3px;
		right: 5px;
	}
	#gNav ul.ro_ch {
		border-left: 1px solid #1a1a1a !important;
		min-width: 90px !important;
		top: -5px;
		left: 80px;
	}
	#gNav ul ul a, #gNav ul ul input[type="button"] {
		font-size: smaller;
	}
	#gNav ul ul a {
		text-indent: 0 !important;
		text-decoration: none;
		color: #ffffff;
		background: #1a1a1a !important;
		border-bottom: 1px solid silver;
		margin-bottom: 2px;
		padding: 4px 2px 0 !important;
		width: auto !important;
		height: 1.6em !important;
	}
	#gNav ul ul a:hover {
		text-decoration: underline;
		background-color: #000000 !important;
	}
	
]]></>).toString() );

///////////////////////////////////////////////
//Google Chrome用GM_*系ラッパー関数

function initGMWrapper_16() {
    // @copyright      2009, James Campos
    // @license        cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
    if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
        GM_addStyle = function (css) {
            var style = document.createElement('style');
            style.textContent = css;
            document.getElementsByTagName('head')[0].appendChild(style);
        };
        GM_deleteValue = function (name) {
            sessionStorage.removeItem(name);
            localStorage.removeItem(name);
        };
        GM_getValue = function (name, defaultValue) {
            var value;
            value = sessionStorage.getItem(name);
            if (!value) {
                value = localStorage.getItem(name);
                if (!value) {
                    return defaultValue;
                }
            }
            var type = value[0];
            value = value.substring(1);
            switch (type) {
            case 'b':
                return value == 'true';
            case 'n':
                return Number(value);
            default:
                return value;
            }
        };
        GM_log = function (message) {
            if (window.opera) {
                opera.postError(message);
                return;
            }
            console.log(message);
        };
        GM_registerMenuCommand = function (name, funk) {
            //todo
        };
        GM_setValue = function (name, value) {
            value = (typeof value)[0] + value;
            try {
                localStorage.setItem(name, value);
            } catch (e) {
                localStorage.removeItem(name);
                sessionStorage.setItem(name, value);
                //				alert("Beyond : localStorageへの保存に失敗 (" + e + ")" + name);
                throw e;
            }
        };
    }
}
///////////////////////////////////////////////


}

//faraway 16.ナビゲーションにロールオーバーリンク追加のソース(_-_.user.js)終了

//faraway 17.bro3_Auto_Bilder_nokin_customのソース(bro3_auto_bilder_nokin_custom.user.js)開始
//================================================================================
//17.bro3_Auto_Bilder_nokin_custom
//================================================================================
// ==UserScript==
// @name         bro3_Auto_Bilder
// @namespace    http://at-n2.net/
// @description  ブラウザ三国志 自動建築スクリプト By nottisan
// @castom       nokin + ceri + kiri
// @include      http://*.3gokushi.jp/*
// ==/UserScript==

//2010.10.25 「研究中」「建物削除中」の時建設されないバグを修正
//2010.10.28 「ALLクリア」機能実装
//2010.10.28 市場糧自動変換機能仮実装
//2010.10.29 城・砦・村がレベルアップされないバグを修正
//2010.10.29 市場糧自動変換機能バグ取り完了
//2010.10.31 糧村化機能実装
//2010.12.24 数箇所調整+放置ミス対策して勝手に本家として公開ｗ by nottisan
//           30分以上拠点画面以外であれば自動で拠点画面へ （自動出兵ツールを使ってる人が居るかもしれないことがあるので、
//           出兵選択画面・出兵寸前の画面(/facility/castle_send_troop.php)では動作しません。）
//2010.12.31 糧の変換パターンを追加
//           平均変換：糧が指定した量になると、3資源で一番少ない物を指定値変換します。
//           一括変換：糧が指定した量になると、各指定値で変換します。
//           自動内政発動機能を追加（x知識、x技術、呉の治世、王佐の才）のみスキル使用します。
//                                  拠点表示時にスキルの使用をチェックします。
//2010.01.02 自動内政発動機能にあった、スキル3つ持ちの武将でないと発動しないバグを修正
//           http://krote.blog21.fc2.com/blog-entry-54.htmlのブログを参考にchromeに対応？
//           ※テストが不十分ですが、FierFox版に問題無いので載せて公開しました。
//2011.01.02 nottisanの許可を得ての～きんカスタム化、拠点巡回30秒に、リンク表示位置修正。
//2011.05.17 霧カスタムと統合させました。
//	・mixi以外でも使用できるように資源表示の右にリンクを配置。
//	・AutoBilder のリンク文字をアイコンに変更。
//	・巡回時間を自由設定できるように変更（ゆきすけ氏の時間選択ソース改造）。
//	・設定資源値以下にならないように資源貯蓄機能を追加。
//	・デザイン変更、これは完全に自己満足。

//faraway 17.bro3_Auto_Bilder_nokin_custom変数宣言移動前の場所

//Main
//faraway(function(){
function disp_bro3auto() {	//faraway
//window.alert("17.bro3_Auto_Bilder_nokin_custom:" + location.pathname);	//faraway
	//君主プロフィール画面なら都市画面URLを取得
	if ((location.pathname == "/user/" || location.pathname == "/user/index.php") &&
		getParameter_17("user_id") == "") {
		getUserProf_17();
	}
	var villages = loadVillages_17(HOST_17+PGNAME_17);
	//拠点画面なら対象建築物の建築チェック
	if (location.pathname == "/village.php" ) {
		setVillageFacility();

		//市場処理
		ichibaChange();

		//自動寄付処理
		autoDonate();

		//自動内政処理 by nottisan
		Auto_Domestic();

		forwardNextVillage();

	}else{

		if(location.pathname != "/facility/castle_send_troop.php"){
			var vURL = villages[0][IDX_URL_17];
			var tid=setTimeout(function(){location.href = vURL;},1800000);
		}
//	 console.log(location.hostname + "指定画面外"+tidMain2);
        clearInterval(tidMain2);
        clearTimeout(tidMain2);


	}
	addOpenLinkHtml_17();

//faraway})();
}	//faraway
function setVillageFacility() {
//console.log("30968");
//return;

	var cnt=0;
	var vID = "";
	//座標を取得
	var xyElem = document.evaluate('//*[@id="basepoint"]/span[@class="xy"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	vId = trim_17(xyElem.snapshotItem(0).innerHTML);
	//alert(vId);
	
	//建設情報を取得
	var actionsElem = document.evaluate('//*[@id="actionLog"]/ul/li',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

	for (var i = 0; i < actionsElem.snapshotLength; i++) {
		var paItem = actionsElem.snapshotItem(i);
		//ステータス
		var buildStatusElem = document.evaluate('./span[@class="buildStatus"]/a',
			paItem, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		//alert(buildStatusElem);
		if (buildStatusElem.snapshotLength > 0) {
			//建物削除等に対応 2010.10.25 byおぜがづ
			for(var j=0; j<buildStatusElem.snapshotLength;j++){
				if(buildStatusElem.snapshotItem(j).parentNode.innerHTML.match(RegExp("(建設中|建設準備中)"))) {
					//施設建設数
					cnt++;
				}
			}
			//施設建設数
			//cnt++;
		}
	}
	//alert(actionsElem.snapshotLength);

	Load_OPT(vId);	//LvUP対象の取得

	//建設予約ができるかどうか
	if(cnt >= 1) return;
	//if(cnt == 2) return;

	if(OPT_KATEMURA == 1) {
		var area_all = new Array();
		area_all = get_area_all();
		var hatake = 0; //畑の総数
		var souko = 0; //倉庫の総数
		var suzume = 0; //雀の総数
		var heichi = 0; //平地の総数
		var suzume_Flag = 0;
		var n = -1;
		for(var i=0;i < area_all.length;i++){
			if(area_all[i].name == "平地"){heichi++;n=i;}
			else if(area_all[i].name.match(/畑\s.*?(\d+)/)){hatake++;if(parseInt(RegExp.$1)>=5){suzume_Flag=1;}}
			else if(area_all[i].name.match(/倉庫/)){souko++;}
			else if(area_all[i].name.match(/銅雀台/)){suzume++;}
		}
		

//		alert("平地:" + heichi + "\n畑:" + hatake + "\n倉庫:" + souko + "\n雀:" + suzume + "\n畑が建てられる平地:" + (tmp - hatake));
		if(heichi>0){ //平地が余っていたら
			var tmp = heichi;
			if(suzume != 1){ //雀がまだ建っていなければ
				tmp -= 1; //平地の数をマイナス1
			}
			if(souko < OPT_SOUKO_MAX){ //倉庫がまだ最大数建っていなければ
				tmp -= (OPT_SOUKO_MAX - souko); //平地の数をマイナス]
			}
//		alert("平地:" + heichi + "\n畑:" + hatake + "\n倉庫:" + souko + "\n雀:" + suzume + "\n畑が建てられる平地:" + (tmp - hatake));
//			if(tmp-hatake > 0){ //それでも平地が余っていれば
			if(tmp > 0){ //それでも平地が余っていれば
				if(Chek_Sigen(new lv_sort("畑",0,"")) != 1){ //資源チェック
					createFacility(HATAKE, area_all); //畑を建てる
					Reload_Flg = 0;
					return;
				};
			} else if(souko < OPT_SOUKO_MAX){ //倉庫が建てられる平地があれば
				if(Chek_Sigen(new lv_sort("倉庫",0,"")) != 1){ //資源チェック
					createFacility(SOUKO, area_all); //倉庫を建てる
					Reload_Flg = 0;
					return;
				}
			} else if(suzume != 1 && suzume_Flag == 1){ //雀がまだ建っていなければ
				if(Chek_Sigen(new lv_sort("銅雀台",0,"")) != 1){ //資源チェック
					createFacility(SUZUME, area_all); //雀を建てる
					Reload_Flg = 0;
					return;
				}
			}
		}
//		alert("平地:" + heichi + "\n畑:" + hatake + "\n倉庫:" + souko + "\n雀:" + suzume);
//		return;
//建てられるスペースがなければ通常の処理を続ける
	}

	var area = new Array();
	area = get_area();

	area.sort(cmp_lv);
	var Reload_Flg = 0;
	for(i=0;i<area.length;i++){
		//alert(area[i].name + ":" + area[i].lv + ":" + area[i].xy);
		//alert(parseInt(area[i].lv) + "::" + parseInt(OPT_MAX_LV));

		
        var tmpName1 = area[i].name;
        switch (tmpName1) { 
            case "村":
            case "城":
            case "砦":
                tmpName1  = "拠点";              //chkFlg = 1;
                break;
        }
		if(parseInt(area[i].lv) >= parseInt(OPT_CHKBOXLV[OPT_FNID[tmpName1]])){continue;} //指定Lv以上ならメインに戻る

//		if(parseInt(area[i].lv) >= parseInt(OPT_MAX_LV)){break;} //指定Lv以上ならメインに戻る
		//建築物名分回す
		//村・城がレベルアップされないバグを修正 2010.10.29 by おぜがづ
		//村・城を追加
		OPT_FUC_NAME.push("村","城","砦");
		if(OPT_CHKBOX[0] == 1) {
			OPT_CHKBOX.push(1,1,1);
		} else {
			OPT_CHKBOX.push(0,0,0);
		}
		OPT_CHKBOX.push
		for(var ii=0;ii<OPT_FUC_NAME.length;ii++){
			//ソートしたLvの低い順に比較する
			if(area[i].name == OPT_FUC_NAME[ii]){
				//建築指示が有るか確認する。
				if(parseInt(OPT_CHKBOX[ii]) == 1){
					//建築に必要な資源が有るかどうかチェック
					var ret = Chek_Sigen(area[i]);
					if(ret == 1){
						//30分後にリロードするかどうか
						Reload_Flg = 1;
						break;
					}
					
					//alert("LvUP開始");
					//alert(parseInt(OPT_CHKBOX[ii]) + "::" + area[i].name + "::" + OPT_FUC_NAME[ii]);
					//var mURL = LVUPLINK;
					//mURL = mURL.replace(URL_SITE,HOST_17);
					//mURL = mURL.replace(URL_X,Temp[0]);
					//mURL = mURL.replace(URL_Y,Temp[1]);
					//mURL = mURL.replace(URL_viID,getVillageID(vId));
					//mURL = mURL.replace(URL_viSSID,j$.cookie('SSID'));							// 2012.04.24 ssid 追加
					////var tid=setTimeout(function(){location.href = mURL;},INTERVAL_17);
					//tidMain=setTimeout(function(){location.href = mURL;},INTERVAL_17);
					Reload_Flg = 0;
//					var Temp = area[i].xy.split(",");
					var Temp = area[i].xy.match(/(-?[0-9]+),(-?[0-9]+)[^0-9]*/);
//					hiro_lvupfacility(Temp[0],Temp[1],vId);
					hiro_lvupfacility(RegExp.$1,RegExp.$2,vId);
					return;
				}
			}
		}
	}
	
	if(Reload_Flg == 1){
		//30分後にリロードし、再度建築できるかチェックする。
		//10分後に短縮 2010.10.25 by おぜがづ
		//var tid=setTimeout(function(){location.reload();},1800000);
		//var tid=setTimeout(function(){location.reload();},600000);
		tidMain =setTimeout(function(){location.reload();},600000);
	}

}

//施設一覧取得
function get_area(){
	var results = document.evaluate('//area', document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	var area = new Array();
	for(var i=0,n=0; i<results.snapshotLength; i++){
		if(results.snapshotItem(i).alt.match(/(.*?)\s.*?(\d+)/)){
			var strURL = results.snapshotItem(i).href;
			area[n] = new lv_sort(RegExp.$1,RegExp.$2,getURLxy(strURL));
			//alert(area[n].xy);
			n++;
		}
	}
	return area;
}

function get_area_all(){
	var results = document.evaluate('//area', document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	var area = new Array();
	for(var i=0,n=0; i<results.snapshotLength; i++){
		var strURL = results.snapshotItem(i).href;
		area[n] = new areas_17(results.snapshotItem(i).alt,getURLxy(strURL));
		//alert(area[n].xy + ":" + area[n].name);
		n++;
	}
	return area;
}

//施設建設
function createFacility(f, area){
//	alert("createFacility");
	area.sort(cmp_areas);
	for(var i=0;i<area.length;i++){
		if(area[i].name == "平地"){ //一番最初に見つかった平地に建設
//			var mURL = CREATELINK;
//			mURL = mURL.replace(URL_SITE,HOST_17);
//			var Temp = area[i].xy.split(",");
//			hiro_buildfacility(f,Temp[0],Temp[1],vId);
			var Temp = area[i].xy.match(/(-?[0-9]+),(-?[0-9]+)[^0-9]*/);
			hiro_buildfacility(f,RegExp.$1,RegExp.$2,vId);

//			mURL = mURL.replace(URL_X,Temp[0]);
//			mURL = mURL.replace(URL_Y,Temp[1]);
//			mURL = mURL.replace(URL_viID,getVillageID(vId));
//			mURL = mURL.replace(URL_fID,f);
//			mURL = mURL.replace(URL_SSID,getCookie("SSID"));	//4.24追加 ひろひろひろ
//			//var tid=setTimeout(function(){location.href = mURL;},INTERVAL_17);
//		    tidMain=setTimeout(function(){location.href = mURL;},INTERVAL_17);
			return;
		}
	}
}

function areas_17(name,xy){
	this.name = name;
	this.xy = xy;
}

//比較する関数
function cmp_areas(a,b){
	if(a.xy > b.xy){return 1;} else {return -1;}
}

// 次拠点移動
function forwardNextVillage() {
	loadAVCBox();

	if(OPT_CHKBOX_AVC) {
		var vcURL = nextVillageURL(getVillageID(vId));

		// 巡回時間→1分×入力値に設定 by 霧
		var RoundTime = OPT_CHKBOX_AVC * 60000;

		console.log(location.hostname + " 移動=" +vcURL);
		if(vcURL!=undefined){
			tidMain2 = setTimeout(mvURL,RoundTime,vcURL);
		}
	}
}
function mvURL(tURL){
    location.href = tURL;
}
// 次拠点URL取得
function nextVillageURL(vId2){
	var villages = loadVillages_17(HOST_17+PGNAME_17);
	var nextIndex = 0;
    //console.log(villages);
    var chkNextVID = new Array();
	for(var i=0; i<villages.length;i++){

        var tChk1 = GM_getValue(HOST_17+PGNAME_17+"OPT_CHKBOX_AVC_"+i, true);

        if(tChk1==true){
            chkNextVID.push(villages[i][IDX_URL_17]);
	    }
	}
    //console.log(location.hostname +" 確認："+chkNextVID);
    
    
    
	// 現在の拠点のインデックスを検索
	for(var i=0; i<chkNextVID.length;i++){
		var url = chkNextVID[i];
        if(vId2 == getParameter2_17(chkNextVID[i], "village_id")){
            if(i+1 < chkNextVID.length){
                nextIndex = i+1;
            }else{
                nextIndex = 0;
            }
            
            break;
        }
	}
    //console.log(location.hostname +" 確認："+chkNextVID[nextIndex]);
    
	return chkNextVID[nextIndex];
/*
	// 現在の拠点のインデックスを検索
	for(var i=0; i<villages.length;i++){
		var url = villages[i][IDX_URL_17];
        if(vId == getParameter2_17(villages[i][IDX_URL_17], "village_id")){
            if(i+1 < villages.length){
                nextIndex = i+1;
            }else{
                nextIndex = 0;
            }
            
            break;
        }
	}

	return villages[nextIndex][IDX_URL_17];
*/
}


// URLパラメタ取得
function getParameter2_17(url, key) {
	var str = url.split("?");
	if (str.length < 2) {
		return "";
	}

	var params = str[1].split("&");
	for (var i = 0; i < params.length; i++) {
		var keyVal = params[i].split("=");
		if (keyVal[0] == key && keyVal.length == 2) {
			return decodeURIComponent(keyVal[1]);
		}
	}
	return "";
}



//建築物の格納用
function lv_sort(name,lv,xy){
	this.name = name;
	this.lv = lv;
	this.xy = xy;
}
//比較する関数
function cmp_lv(a,b){
	return a.lv - b.lv;
}
//拠点IDの取得
function getVillageID(vId){
	//villages
	var villages = loadVillages_17(HOST_17+PGNAME_17);
	for(var i=0; i<villages.length;i++){
		if(villages[i][IDX_XY_17] == vId){
			var vURL = villages[i][IDX_URL_17];
			var temp = vURL.split("?");
			var temp2 = temp[1].split("=");
			return temp2[1];
		}
	}
}
function getURLxy(strURL){
	//alert(strURL);
	if(strURL == ""){ return "";}
	var strTemp = "";
	strTemp = strURL;
	var Temp = strTemp.split("?");
	var Temp2 = Temp[1].split("&");
	var Temp3 = Temp2[0].split("=");
	var Temp4 = Temp2[1].split("=");
	return Temp3[1] + "," +Temp4[1];
}

//リンクHTML追加
function addOpenLinkHtml_17() {
//ﾛｺﾞfaraway1100524	var sidebar = d_17.evaluate('//*[@id="status_left"]', d_17, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var sidebar = d_17.evaluate('//*[@id="supportNavi"]', d_17, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);//ﾛｺﾞfaraway1100524

	if (sidebar.snapshotLength == 0) {
	    sidebar = d_17.evaluate('//*[@class="sideBox"]',d_17, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if (sidebar.snapshotLength == 0) return;
	    isMixi_17 = false;
	    
	}

	var openLink = d_17.createElement("a");
	openLink.id = "Auto_Bilder";
	openLink.href = "javascript:void(0);";
	openLink.innerHTML = "AutoBilder";	//ﾛｺﾞfaraway110524
	openLink.style.color = "#000000";	//ﾛｺﾞfaraway110524

	// mixi鯖判定
//ﾛｺﾞfaraway1100524	var ifmixi = d_17.evaluate('//*[@id="supportNavi"]', d_17, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
//ﾛｺﾞfaraway1100524	if ( ifmixi.snapshotLength ) {
//ﾛｺﾞfaraway1100524		openLink.innerHTML = "<nobr><img src='http://img.mixi.jp/img/basic/favicon.ico' title='Auto Bilder'></nobr>";
//ﾛｺﾞfaraway1100524	} else {
//ﾛｺﾞfaraway1100524		openLink.innerHTML = "<nobr><img src='http://h4.3gokushi.jp/20110302-02/extend_project/w945/favicon.ico' title='Auto Bilder'></nobr>";
//ﾛｺﾞfaraway1100524		// ---- 資源の桁数が増えた時の改行防止 ----
//ﾛｺﾞfaraway1100524		var sidebar2 = d_17.evaluate('//*[@id="status_right"]', d_17, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
//ﾛｺﾞfaraway1100524		sidebar2.snapshotItem(0).style.width = "Auto";
//ﾛｺﾞfaraway1100524	}

//ﾛｺﾞfaraway110524	openLink.style.color = "#3399CC";
//ﾛｺﾞfaraway110524	openLink.style.textDecoration = "none";
	openLink.addEventListener("click", function() {openIniBilderBox()}, true);
	sidebar.snapshotItem(0).appendChild(openLink);

	// ---- 資源の桁数が増えた時の改行防止 ----
	sidebar.snapshotItem(0).style.width = "Auto";
//	sidebar.snapshotItem(0).style.background = "red"; // チェック用

}

//建築設定画面を開く
function openIniBilderBox() {
	closeIniBilderBox();
	addIniBilderHtml();
}

//建築設定画面を閉じる
function closeIniBilderBox() {
	deleteIniBilderHtml();
	deleteIniBilderFrameHtml();
}
//建築対象拠点表示HTML削除
function deleteIniBilderHtml() {
	var elem = d_17.getElementById("ABContainer");
	if (elem == undefined) return;
	d_17.body.removeChild(d_17.getElementById("ABContainer"));
}
//建築対象拠点表示HTML削除
function deleteIniBilderFrameHtml() {
	var elem = d_17.getElementById("ABContainer");
	if (elem == undefined) return;
	d_17.body.removeChild(document.getElementById("ABContainer"));
}

//LvUP対象施設設定画面を開く
function openInifacBox(vId) {
	closeInifacBox();
	addInifacHtml(vId);
}
///LvUP対象施設設定画面を閉じる
function closeInifacBox() {
	deleteInifacHtml();
	deleteInifacFrameHtml();
}

///LvUP対象施設設のチェックボックスをクリアする
function clearInifacBox() {
	var checkbox = $a_17('//input[@type="checkbox"]');
	for(var i= 0;i < checkbox.length; i++) {
		checkbox[i].checked = false;
	}
}

//建築対象施設表示HTML削除
function deleteInifacHtml() {
	var elem = d_17.getElementById("ABfacContainer");
	if (elem == undefined) return;
	d_17.body.removeChild(d_17.getElementById("ABfacContainer"));
}
//建築対象施設表示HTML削除
function deleteInifacFrameHtml() {
	var elem = d_17.getElementById("ABfacContainer");
	if (elem == undefined) return;
	d_17.body.removeChild(document.getElementById("ABfacContainer"));
}

//ステイタス取得HTML追加
function addIniBilderHtml() {

	var popupLeft = 50;
	var popupTop = 160;

	if(!isMixi_17) {
		popupLeft = 50;
		popupTop = 400;
	}

	//表示コンテナ作成
	var ABContainer = d_17.createElement("div");
	ABContainer.id = "ABContainer";
	ABContainer.style.position = "absolute";
	ABContainer.style.color = "white";
	ABContainer.style.backgroundColor = "#333333";
	ABContainer.style.backgroundColor = "#666666";//win風のグレー基調faraway110524
	ABContainer.style.border = "solid 2px black";
	ABContainer.style.border = "outset 2px darkgray";//win風のグレー基調faraway110524
//win風のグレー基調faraway110524	ABContainer.style.MozBorderRadius  = "4px";
	ABContainer.style.left = popupLeft + "px";
	ABContainer.style.top = popupTop + "px";
	ABContainer.style.fontSize = "10px";
	ABContainer.style.padding = "3px";
	ABContainer.style.zIndex = 999;
	d_17.body.appendChild(ABContainer);

    $e_17(ABContainer, "mousedown", function(event){
                if( event.target != $_17("ABContainer")) {return false;}
                g_MD_17="ABContainer";
                g_MX=event.pageX-parseInt(this.style.left,10);
                g_MY=event.pageY-parseInt(this.style.top,10);
                event.preventDefault();});
    $e_17(d_17, "mousemove", function(event){
                if(g_MD_17 != "ABContainer") return true;
                var ABContainer = $_17("ABContainer");
                if( !ABContainer ) return true;
                var x = event.pageX - g_MX;
                var y = event.pageY - g_MY;
                ABContainer.style.left = x + "px";
                ABContainer.style.top = y + "px";
                //csaveData("config_window_x", x);
                //csaveData("config_window_y", y);
                });
    $e_17(d_17, "mouseup", function(event){g_MD_17="";});

	//バージョン
	var version = d_17.createElement("span");
	version.style.color = "white";
	version.style.fontSize = "10px";
	version.style.margin = "3px";
	version.innerHTML = "Auto Bilder v" + VERSION_17;
	ABContainer.appendChild(version);
	
	//拠点設定リンクの作成
	var tbl = d_17.createElement("table");
	tbl.style.border = "solid 1px #FFDE49";
	tbl.style.border ="0px";//win風のグレー基調faraway110524

	//拠点情報のロード
	var villages = loadVillages_17(HOST_17+PGNAME_17);
	var vId2;

	//拠点情報が無い場合
	if(villages.length == 0){
		var tr = d_17.createElement("tr");
		var td = d_17.createElement("td");
		td.style.padding = "3px";
		td.style.verticalAlign = "top";
		td.style.border = "outset 2px black";//win風のグレー基調faraway110524
		tr.appendChild(td);
		tbl.appendChild(tr);
//win風のグレー基調faraway110524		tbl.style.with = "Auto";
		var msg = d_17.createElement("span");
		msg.style.fontSize = "15px";
		msg.style.margin = "3px";//win風のグレー基調faraway110524
		msg.innerHTML = "インストールありがとうございます。<br>" + 
		                "まずは、プロフィール画面を開いて<br>" +
		                "拠点情報を取得してください。";
		td.appendChild(msg);
	} else {
        var landElems = document.evaluate('//li[@class="on"]/span', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
        //console.log(landElems.snapshotItem(0).innerHTML);

		for (var i = 0; i < villages.length; i++) {
			var vname = villages[i][IDX_BASE_NAME_17];
            //console.log(vname);
		    //if(landElems.snapshotItem(0).innerHTML!=vname) continue;
//win風のグレー基調faraway110524		    var fColor = "#FFDE49";
		    var fColor = "aqua";//win風のグレー基調faraway110524
		    if(landElems.snapshotItem(0).innerHTML!=vname) fColor="white";

			var tr = d_17.createElement("tr");
			var td = d_17.createElement("td");
			td.style.padding = "3px";
			td.style.verticalAlign = "top";
			td.style.border = "outset 2px black";//win風のグレー基調faraway110524
			tr.appendChild(td);
			tbl.appendChild(tr);
			tbl.style.width = "140px";

			//各拠点の設定画面リンク
			var vname = villages[i][IDX_BASE_NAME_17];
			vId2 = villages[i][IDX_XY_17];

			var td00 = d_17.createElement("div");

            var tdA = d_17.createElement("td");
            tdA.style.padding = "3px";
            tdA.style.verticalAlign = "top";

            ccreateCheckBox0(td00, "OPT_CHKBOX_AVC_"+i, loadAVCBox2(i), "","5分毎に拠点を巡回する場合はチェックをしてください。",0);

			var opfacLink = d_17.createElement("a");
			opfacLink.id = "vireLink" + villages[i][IDX_XY_17];
			opfacLink.href = "javascript:void(0);";
			opfacLink.style.margin = "3px";
			opfacLink.style.color = fColor;
			opfacLink.innerHTML = villages[i][IDX_BASE_NAME_17];

			opfacLink.setAttribute('vId', villages[i][IDX_XY_17]);
			opfacLink.addEventListener("click", function() { var vId = this.getAttribute('vId'); openInifacBox(vId);}, true);
			td00.appendChild(opfacLink);
			td.appendChild(td00);
			tr.appendChild(td);
		}
	}

	ABContainer.appendChild(tbl);

	var tbl3 = d_17.createElement("table");
	tbl3.style.border ="0px";

	var tr3 = d_17.createElement("tr");
	var td4 = d_17.createElement("td");
	td4.style.padding = "3px";
	td4.style.verticalAlign = "top";

	var trA = d_17.createElement("tr");
	var tdA = d_17.createElement("td");
	tdA.style.verticalAlign = "top";

	// ---- 拠点巡回設定 ---- by 霧
	var rnd = d_17.createElement("div");
	rnd.style.color = "#E86D61";
	tdA.appendChild(rnd);

	loadAVCBox();
	ccreateTextBox_17(rnd, "OPT_CHKBOX_AVC", OPT_CHKBOX_AVC, "拠点巡回/分 ","設定時間×1分で拠点巡回する。", 4, 0);

/*
	if(GM_getValue(HOST_17+PGNAME_17+"AutoFlg", true)==true){
	    ccreateButton_17(tdA, "自動実行中", "自動建築停止", 
	        function() {
	            	GM_setValue(HOST_17+PGNAME_17+"AutoFlg", false);
	            	location.reload();
	        });
	} else {
	    ccreateButton_17(tdA, "自動停止中", "自動建築開始", 
	        function() {
	            	GM_setValue(HOST_17+PGNAME_17+"AutoFlg", true);
	            	location.reload();
	        });
	
	}
*/

	// ---- 資源貯蓄設定 ---- by 霧
	var reso = d_17.createElement("div");
	reso.innerHTML = "資源貯蓄";
	reso.style.padding = "2px";
	tdA.appendChild(reso);

	ccreateTextBox_17(reso, "OPT_CHKBOX_W", OPT_CHKBOX_W, "木 ","自動建築で貯蓄値分は確保しておく。", 8, 3);
	ccreateTextBox_17(reso, "OPT_CHKBOX_S", OPT_CHKBOX_S, "石 ","自動建築で貯蓄値分は確保しておく。", 8, 3);
	ccreateTextBox_17(reso, "OPT_CHKBOX_I", OPT_CHKBOX_I, "鉄 ","自動建築で貯蓄値分は確保しておく。", 8, 3);
	ccreateTextBox_17(reso, "OPT_CHKBOX_R", OPT_CHKBOX_R, "糧 ","自動建築で貯蓄値分は確保しておく。", 8, 3);

	trA.appendChild(tdA);
	tbl3.appendChild(trA);

	var trB = d_17.createElement("tr");
	var tdB = d_17.createElement("td");

	ccreateButton_17(tdB, "保存", "設定内容を保存します", function() {

	    for (var i = 0; i < villages.length; i++) {
			saveAVCBox();
            GM_setValue(HOST_17+PGNAME_17+"OPT_CHKBOX_AVC_" + i, document.getElementById('OPT_CHKBOX_AVC_' + i).checked);
			console.log("巡回時間 " + OPT_CHKBOX_AVC);
            console.log("保存 " + i + " : "  + document.getElementById('OPT_CHKBOX_AVC_' + i).checked);
        }
        tidMain=setTimeout(function(){location.reload();},INTERVAL_17);
	});

	ccreateButton_17(tdB, "閉じる", "ウインドウを閉じます", function() { closeIniBilderBox()} );

	trB.appendChild(tdB);
	tbl3.appendChild(trB);
	ABContainer.appendChild(tbl3);

}

// 拠点巡回読込
function loadAVCBox(){
	OPT_CHKBOX_AVC = parseInt(GM_getValue(HOST_17+PGNAME_17+"AVC", ""));
	if(isNaN(OPT_CHKBOX_AVC)) OPT_CHKBOX_AVC = 0;
	// 資源貯蓄読読込 by 霧
	OPT_CHKBOX_W = parseInt(GM_getValue(HOST_17+PGNAME_17+"AVC_W", ""));
	if(isNaN(OPT_CHKBOX_W)) OPT_CHKBOX_W = 0;
	OPT_CHKBOX_S = parseInt(GM_getValue(HOST_17+PGNAME_17+"AVC_S", ""));
	if(isNaN(OPT_CHKBOX_S)) OPT_CHKBOX_S = 0;
	OPT_CHKBOX_I = parseInt(GM_getValue(HOST_17+PGNAME_17+"AVC_I", ""));
	if(isNaN(OPT_CHKBOX_I)) OPT_CHKBOX_I = 0;
	OPT_CHKBOX_R = parseInt(GM_getValue(HOST_17+PGNAME_17+"AVC_R", ""));
	if(isNaN(OPT_CHKBOX_R)) OPT_CHKBOX_R = 0;
}

function loadAVCBox2(tVID){
	//OPT_CHKBOX_AVC = parseInt(GM_getValue(HOST_17+PGNAME_17+"AVC"+"_"+tVID, ""));
	OPT_CHKBOX_AVC = GM_getValue(HOST_17+PGNAME_17+"OPT_CHKBOX_AVC_" + tVID, true);
	return OPT_CHKBOX_AVC;
}

// 拠点巡回保存
function saveAVCBox(){
	OPT_CHKBOX_AVC = cgetTextBoxValue_17($_17("OPT_CHKBOX_AVC"));
	GM_setValue(HOST_17+PGNAME_17+"AVC", OPT_CHKBOX_AVC);
	// 資源貯蓄保存 by 霧
	OPT_CHKBOX_W = cgetTextBoxValue_17($_17("OPT_CHKBOX_W"));
	GM_setValue(HOST_17+PGNAME_17+"AVC_W", OPT_CHKBOX_W);
	OPT_CHKBOX_S = cgetTextBoxValue_17($_17("OPT_CHKBOX_S"));
	GM_setValue(HOST_17+PGNAME_17+"AVC_S", OPT_CHKBOX_S);
	OPT_CHKBOX_I = cgetTextBoxValue_17($_17("OPT_CHKBOX_I"));
	GM_setValue(HOST_17+PGNAME_17+"AVC_I", OPT_CHKBOX_I);
	OPT_CHKBOX_R = cgetTextBoxValue_17($_17("OPT_CHKBOX_R"));
	GM_setValue(HOST_17+PGNAME_17+"AVC_R", OPT_CHKBOX_R);
	tidMain =setTimeout(function(){location.reload();},INTERVAL_17);
}
function saveAVCBox2(tVID,flg){
	GM_setValue(HOST_17+PGNAME_17+"AVC"+"_"+tVID, flg);
	tidMain=setTimeout(function(){location.reload();},INTERVAL_17);
}

//施設建設必要資源読込
function loadFacility(){
}

//施設建設必要資源保存
function saveFacility(f){
}

//ステイタス取得HTML追加
function addInifacHtml(vId) {

	var popupLeft = 150;
	var popupTop = 190;

	if(!isMixi_17) {
		popupLeft = 150;
		popupTop = 160;
	}
	
	//表示コンテナ作成
	var ABfacContainer = d_17.createElement("div");
	ABfacContainer.id = "ABfacContainer";
	ABfacContainer.style.position = "absolute";
	ABfacContainer.style.color = "white";
	ABfacContainer.style.backgroundColor = "#333333";
	ABfacContainer.style.backgroundColor = "#666666";//win風のグレー基調faraway110524
	ABfacContainer.style.border = "solid 2px black";
	ABfacContainer.style.border = "outset 2px darkgray";//win風のグレー基調faraway110524
//win風のグレー基調faraway110524	ABfacContainer.style.MozBorderRadius  = "4px";
	ABfacContainer.style.left = popupLeft + "px";
	ABfacContainer.style.top = popupTop + "px";
	ABfacContainer.style.fontSize = "10px";
	ABfacContainer.style.padding = "3px";
	ABfacContainer.style.zIndex = 999;

	ABfacContainer.setAttribute('vId', vId);
	d_17.body.appendChild(ABfacContainer);

    $e_17(ABfacContainer, "mousedown", function(event){
                if( event.target != $_17("ABfacContainer")) {return false;}
                g_MD_17="ABfacContainer";
                g_MX=event.pageX-parseInt(this.style.left,10);
                g_MY=event.pageY-parseInt(this.style.top,10);
                event.preventDefault();});
    $e_17(d_17, "mousemove", function(event){
                if(g_MD_17 != "ABfacContainer") return true;
                var ABfacContainer = $_17("ABfacContainer");
                if( !ABfacContainer ) return true;
                var x = event.pageX - g_MX;
                var y = event.pageY - g_MY;
                ABfacContainer.style.left = x + "px";
                ABfacContainer.style.top = y + "px";
                //("config_window_x", x);
                //csaveData("config_window_y", y);
                });
    $e_17(d_17, "mouseup", function(event){g_MD_17="";});

	//入力項目の作成
	var tbl = d_17.createElement("table");
	tbl.style.border ="0px";

	var tr = d_17.createElement("tr");
	var td = d_17.createElement("td");

	td.style.fontSize ="12px";
//win風のグレー基調faraway110524	td.style.color ="#FFDE49";
	td.style.padding = "3px";
	td.style.verticalAlign = "top";
	td.style.border = "outset 2px black";//win風のグレー基調faraway110524

	tr.appendChild(td);
	tbl.appendChild(tr);

	var villages = loadVillages_17(HOST_17+PGNAME_17);
	for (var i = 0; i < villages.length; i++) {
		//表示中の設定対象拠点名の表示
		if(vId == villages[i][IDX_XY_17]){
			td.innerHTML = villages[i][IDX_BASE_NAME_17];
		}
	}
	ABfacContainer.appendChild(tbl);

	Load_OPT(vId);
	var tbl2 = d_17.createElement("table");
	tbl2.style.border ="0px";
	var tr0 = d_17.createElement("tr");
	tr0.style.border = "outset 2px black";
	var td1 = d_17.createElement("td");
	td1.style.padding = "3px";
	td1.style.verticalAlign = "top";
	var td2 = d_17.createElement("td");
	td2.style.padding = "3px";
	td2.style.verticalAlign = "top";
	var td3 = d_17.createElement("td");
	td3.style.padding = "3px";
	td3.style.verticalAlign = "top";
	tr0.appendChild(td1);
	tr0.appendChild(td2);
	tr0.appendChild(td3);
	tbl2.appendChild(tr0);

	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 0, " 拠点　　　　","中央の城・村・砦のLvを上げます。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 1, " 伐採所　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 2, " 石切り場　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 3, " 製鉄所　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 4, " 畑　　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 5, " 倉庫　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 6, " 銅雀台　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 7, " 鍛冶場　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 8, " 防具工場　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 9, " 練兵所　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 10, " 兵舎　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 11, " 弓兵舎　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 12, " 厩舎　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 13, " 宿舎　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 14, " 兵器工房　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 15, " 市場　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 16, " 訓練所　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 17, " 水車　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td3, "OPT_CHKBOX", 18, " 工場　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td3, "OPT_CHKBOX", 19, " 研究所　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td3, "OPT_CHKBOX", 20, " 大宿舎　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td3, "OPT_CHKBOX", 21, " 遠征訓練所　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td3, "OPT_CHKBOX", 22, " 見張り台　　","自動でLv上げをする建築物にチェックをしてください。",0);
//faraway110608	ccreateCheckBoxKai2(td3, "OPT_CHKBOX", 23, " 修行所　　　","自動でLv上げをする建築物にチェックをしてください。",0);

	var tbl4 = d_17.createElement("table");
	tbl4.style.border ="0px";
	var tr01 = d_17.createElement("tr");
	tr0.style.border = "solid 1px #FFDE49";
	tr0.style.border = "outset 2px black";//win風のグレー基調faraway110524
	var td11 = d_17.createElement("td");
	td11.style.padding = "3px";
	td11.style.verticalAlign = "top";
	tr01.appendChild(td11);
	tbl4.appendChild(tr01);

	//糧村化
	ccreateCheckBox_17(td11,"OPT_KATEMURA", OPT_KATEMURA, " 糧村化", "この都市を糧村にする。平地に畑・倉庫×4・銅雀台を建てる。",0);
	ccreateTextBox_17(td11,"OPT_SOUKO_MAX", OPT_SOUKO_MAX,"設置する倉庫の数 ","設置する倉庫の数を指定してください。",1,1);
	
	//市場変換処理用
	ccreateCheckBox_17(td11, "OPT_ICHIBA", OPT_ICHIBA, " 市場自動変換", "この都市で糧の市場自動変換をします。", 0);
	//ccreateComboBox_17(td11, "OPT_ICHIBA_PA" , OPT_ICHIBA_PATS, OPT_ICHIBA_PA, "変換パターン","平均変換：糧が一定量になった際に変換指定している一番少ない資源を変換します。   一括変換：糧が一定量になった際に指定してある資源を指定値変換します。",5);
	ccreateComboBox_17(td11, "OPT_ICHIBA_PA" , OPT_ICHIBA_PATS, OPT_ICHIBA_PA, 
	    "変換パターン ","平均変換：糧が一定量になった際に変換指定している一番少ない資源を変換します。   一括変換：糧が一定量になった際に指定してある資源を指定値変換します。   自動割当：少なめの資源を平滑化",5);
	ccreateTextBox_17(td11, "OPT_RISE_MAX", OPT_RISE_MAX, "糧が右の数量になったら変換する ","自動で糧を他の資源に変換し始める量指定します。", 10, 5);
	ccreateTextBox_17(td11, "OPT_TO_WOOD", OPT_TO_WOOD, "　木に変換する糧の量 ","自動で木に変換する糧の量を指定します。", 10, 5);
	ccreateTextBox_17(td11, "OPT_TO_STONE", OPT_TO_STONE, "　石に変換する糧の量 ","自動で石に変換する糧の量を指定します。", 10, 5);
	ccreateTextBox_17(td11, "OPT_TO_IRON", OPT_TO_IRON, "　鉄に変換する糧の量 ","自動で鉄に変換する糧の量を指定します。", 10, 5);

	//自動寄付用
	ccreateCheckBox_17(td11, "OPT_KIFU", OPT_KIFU, " 自動寄付", "この都市に来たら、自動的に寄付します。", 0);
	ccreateTextBox_17(td11, "OPT_RISE_KIFU_MAX", OPT_RISE_KIFU_MAX, "糧が右の数量になったら寄付する ","自動で糧を寄付し始める量指定します。", 10, 5);
	ccreateTextBox_17(td11, "OPT_RISE_KIFU", OPT_RISE_KIFU, "　自動で糧を寄付する量 ","自動で糧を寄付する量指定します。", 10, 5);
	
	//自動内政用
	ccreateCheckBox_17(td11, "OPT_DOME", OPT_DOME, " 自動内政", "この都市に来たら、自動的に内政スキルを発動します。", 0);

	// Presents
	var Presents = d_17.createElement("div");
	Presents.innerHTML = "Presents by " + credit;
	Presents.style.color = "#3399CC";
//	Presents.style.cssFloat = "right";
	td11.appendChild(Presents);

	var tbl3 = d_17.createElement("table");
	tbl3.style.border ="0px";
	var tr3 = d_17.createElement("tr");
	var td4 = d_17.createElement("td");
	td4.style.padding = "3px";
	td4.style.verticalAlign = "top";
	tr3.appendChild(td4);
	tbl3.appendChild(tr3);

	ccreateButton_17(td4, "保存", "設定内容を保存します", function() {SaveInifacBox(ABfacContainer.getAttribute('vId'))});
	ccreateButton_17(td4, "閉じる", "設定内容を保存せず閉じます", function() {closeInifacBox()});
//	ccreateButton_17(td4, "リセット", "設定内容を消去します。", function() {closeInifacBox()});
	ccreateButton_17(td4, "リセット", "設定内容を消去します。", function() {clearInifacBox()});

	ABfacContainer.appendChild(tbl);
	ABfacContainer.appendChild(tbl2);
	ABfacContainer.appendChild(tbl4);
	ABfacContainer.appendChild(tbl3);

}
//拠点単位の設定の保存（XY MAX_LV CheckData)
function SaveInifacBox(vId){
	var i;
	var opt = $_17("OPT_MAX_LV");
	strSave = cgetTextBoxValue_17(opt) + DELIMIT1_17;
	for(i=0; i<=23;i++){
		var opt = $_17("OPT_CHKBOX"+i);
		strSave += cgetCheckBoxValue_17(opt) + DELIMIT2_17;
	}

	//市場変換処理用
	strSave += cgetCheckBoxValue_17($_17("OPT_ICHIBA")) + DELIMIT2_17; //市場で変換するかどうかのフラグ
	strSave += cgetTextBoxValue_17($_17("OPT_RISE_MAX")) + DELIMIT2_17;
	strSave += cgetTextBoxValue_17($_17("OPT_TO_WOOD")) + DELIMIT2_17;
	strSave += cgetTextBoxValue_17($_17("OPT_TO_STONE")) + DELIMIT2_17;
	strSave += cgetTextBoxValue_17($_17("OPT_TO_IRON")) + DELIMIT2_17;

	//糧村化
	strSave += cgetCheckBoxValue_17($_17("OPT_KATEMURA")) + DELIMIT2_17;
	strSave += cgetTextBoxValue_17($_17("OPT_SOUKO_MAX")) + DELIMIT2_17;

	//自動寄付用
	strSave += cgetCheckBoxValue_17($_17("OPT_KIFU")) + DELIMIT2_17; //寄付するかどうかのフラグ
	strSave += cgetTextBoxValue_17($_17("OPT_RISE_KIFU_MAX")) + DELIMIT2_17;
	//strSave += cgetTextBoxValue_17($_17("OPT_RISE_KIFU"));
	strSave += cgetTextBoxValue_17($_17("OPT_RISE_KIFU")) + DELIMIT2_17; //自動内政用に修正
	
	//自動内政用 by nottisan ここから追加
	strSave += cgetCheckBoxValue_17($_17("OPT_DOME")) + DELIMIT2_17; //内政使用するかのフラグ
	strSave += cgetComboBoxValue($_17("OPT_ICHIBA_PA")); //市場での変換パターンフラグ
	//ここまで
	
	GM_setValue(HOST_17+PGNAME_17+vId, strSave);
	
	var strtSave2  ="";
	for(i=0; i<=23;i++){
		var opt = $_17("OPT_CHKBOXLV"+i);
		strtSave2 += cgetTextBoxValue_17(opt) + DELIMIT2_17;
	}
	//console.log(strtSave2);
	GM_setValue(HOST_17+PGNAME_17+vId+"_LV", strtSave2);	
	
	
}
//拠点単位の設定の読み込み
function Load_OPT(vId){
	
	var src = GM_getValue(HOST_17+PGNAME_17+vId, "");
	var src2 = GM_getValue(HOST_17+PGNAME_17+vId+"_LV", "");

	
	if (src == "") return;

	var Temp = src.split(DELIMIT1_17);
	var Temp3 = src2.split(DELIMIT2_17);
	OPT_MAX_LV = Temp[0];
	var Temp2 = Temp[1].split(DELIMIT2_17);
	
	var i;
//	for(i=0; i<=Temp2.length;i++){
	for(i=0; i<=23;i++){
		if(Temp2[i] == ""){return;}
		OPT_CHKBOX[i] = parseInt(Temp2[i]);
	}
	for(i=0; i<=Temp3.length;i++){
		if(Temp3[i] == ""){continue;}
		//console.log("load OPT_CHKBOXLV[" + i +"] = "  + Temp3[i]);
		OPT_CHKBOXLV[i] = parseInt(Temp3[i]);
	}



	//市場変換処理用
	if(Temp2[24] == ""){return;}
	OPT_ICHIBA = parseInt(Temp2[24]);
	OPT_RISE_MAX = parseInt(Temp2[25]);
	OPT_TO_WOOD = parseInt(Temp2[26]);
	OPT_TO_STONE = parseInt(Temp2[27]);
	OPT_TO_IRON = parseInt(Temp2[28]);

	//糧村化
	if(Temp2[29] == ""){return;}
	OPT_KATEMURA = parseInt(Temp2[29]);
	OPT_SOUKO_MAX = parseInt(Temp2[30]);

	//自動寄付
	if(Temp2[31] == ""){return;}
	OPT_KIFU = parseInt(Temp2[31]);
	OPT_RISE_KIFU_MAX = parseInt(Temp2[32]);
	OPT_RISE_KIFU = parseInt(Temp2[33]);

	//自動内政 by nottisan ここから追加
	if(Temp2[34] == ""){return;}
	OPT_DOME = parseInt(Temp2[34]);
	OPT_ICHIBA_PA = Temp2[35];
	//ここまで
	return;
}
//ユーザプロフィール画面の拠点情報を取得
function getUserProf_17() {
	var oldVillages = loadVillages_17(HOST_17+PGNAME_17);
	var newVillages = new Array();
	//alert(oldVillages);


	var landElems = document.evaluate(
		'//*[@id="gray02Wrapper"]//table',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var src=landElems.snapshotItem(0).innerHTML.replace(/\t/g,"").split("</tr>\n");

	var flag_honkyo=0;
	for(i in src){
		src[i] =src[i].replace(/\n/g,"")
		//本拠地という文字列がでてくるまでスキップ
		if(flag_honkyo==0 && src[i].match(/.*本拠地.*/)){flag_honkyo=1;}
		if(flag_honkyo==0) continue;

		//本拠地以降の行はこっから
		if(src[i].match(/<tr><td[^>]*><a href="([^"]*)">([^<]*)<\/a>[^<]*<\/td><td.*>(-?[0-9]+,-?[0-9]+).*<\/td><td.*>([0-9]*)<\/td>/)) {
//		alert("拠点URL："+RegExp.$1+"\n拠点名："+RegExp.$2+"\n拠点座標："+RegExp.$3+"\n人口："+RegExp.$4+"\n");
			//名前項目を取得
			var name = RegExp.$2;
			var url  = RegExp.$1;
			//座標項目を取得
			var xy = "(" + RegExp.$3 + ")";
			//人口項目を取得
			var popul = RegExp.$4;
			//データマージ
			var newVil = new Array();
			newVil[IDX_ACTIONS_17] = new Array();
			for (var j = 0; j < oldVillages.length; j++) {
				if (xy == oldVillages[j][IDX_XY_17]) {
					newVil = oldVillages[j];
				}
			}
			newVil[IDX_XY_17] = xy;
			newVil[IDX_BASE_NAME_17] = name;
			newVil[IDX_URL_17] = url;
			newVil[IDX_BASE_ID]=getParameter2_17(url, "village_id")
			newVillages.push(newVil);
		}
	}
	//保存
	saveVillages_17(HOST_17+PGNAME_17, newVillages);
}

	

//拠点情報を保存
function saveVillage_17(newData, type) {
	var allData = loadVillages_17(HOST_17+PGNAME_17);
	
	//新旧データをマージ
	var exists = false;
	for (var i = 0; i < allData.length; i++) {
		var villageData = allData[i];
		
		//作業リスト更新
		if (villageData[IDX_XY_17] == newData[IDX_XY_17]) {
			exists = true;
			villageData[IDX_BASE_NAME_17] = newData[IDX_BASE_NAME_17];
			
			var actions = villageData[IDX_ACTIONS_17];
			for (var j = actions.length - 1; j >= 0; j--) {
				if (actions[j][IDX2_TYPE_17] != type) continue;
				var endTime = new Date(actions[j][IDX2_TIME_17]);
				var nowTime = new Date();
				if (isNaN(endTime.valueOf()) || endTime > nowTime) actions.splice(j, 1);
			}
			villageData[IDX_ACTIONS_17] = actions.concat(newData[IDX_ACTIONS_17]);
		}
		
		allData[i] = villageData;
	}
	if (!exists) allData.push(newData);

	//Greasemonkey領域へ永続保存
	saveVillages_17(HOST_17+PGNAME_17, allData);
}
//拠点情報を読み出し
function loadVillages_17(hostname) {
	var ret = new Array();
	
	var src = GM_getValue(hostname, "");
	if (src == "") return ret;
	
	var villages = src.split(DELIMIT1_17);
	for (var i = 0; i < villages.length; i++) {
		var fields = villages[i].split(DELIMIT2_17);
		
		ret[i] = new Array();
		ret[i][IDX_XY_17] = fields[IDX_XY_17];
		ret[i][IDX_BASE_NAME_17] = fields[IDX_BASE_NAME_17];
		ret[i][IDX_URL_17] = fields[IDX_URL_17];
		ret[i][IDX_BASE_ID] = fields[IDX_BASE_ID];
		
		ret[i][IDX_ACTIONS_17] = new Array();
		if (fields[IDX_ACTIONS_17] == "") continue;
		var actions = fields[IDX_ACTIONS_17].split(DELIMIT3_17);
		for (var j = 0; j < actions.length; j++) {
			ret[i][IDX_ACTIONS_17][j] = new Array();
			if (actions[j] == "") continue;
			
			var item = actions[j].split(DELIMIT4_17);
			if (item[IDX2_TYPE_17] == undefined) item[IDX2_TYPE_17] = "C";
			
			ret[i][IDX_ACTIONS_17][j][IDX2_STATUS_17] = item[IDX2_STATUS_17];
			ret[i][IDX_ACTIONS_17][j][IDX2_TIME_17] = item[IDX2_TIME_17];
			ret[i][IDX_ACTIONS_17][j][IDX2_TYPE_17] = item[IDX2_TYPE_17];
			ret[i][IDX_ACTIONS_17][j][IDX2_ALERTED_17] = item[IDX2_ALERTED_17];
		}
	}
	
	return ret;
}
//拠点情報を保存
function saveVillages_17(hostname, newData) {
	
	//配列をデリミタ区切り文字列に変換
	var newDataStr = new Array();
	for (var i = 0; i < newData.length; i++) {
		var villageData = newData[i];
		var actions = villageData[IDX_ACTIONS_17];
		
		//配列をデリミタ区切り文字列に変換
		for (var j = 0; j < actions.length; j++) {
			actions[j] = genDelimitString_17(actions[j], DELIMIT4_17);
		}
		villageData[IDX_ACTIONS_17] = genDelimitString_17(actions, DELIMIT3_17);
		newDataStr[i] = genDelimitString_17(villageData, DELIMIT2_17);
	}
	if(newDataStr.length==0){
		return ;
	}
	//Greasemondey領域へ永続保存
	GM_setValue(hostname, genDelimitString_17(newDataStr, DELIMIT1_17));
	//alert(genDelimitString_17(newDataStr, DELIMIT1_17));


}

//デリミタ区切り文字列生成
function genDelimitString_17(dataArray, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

//URLパラメータ取得
function getParameter_17(key) {
	var str = location.search.split("?");
	if (str.length < 2) {
		return "";
	}
	
	var params = str[1].split("&");
	for (var i = 0; i < params.length; i++) {
		var keyVal = params[i].split("=");
		if (keyVal[0] == key && keyVal.length == 2) {
			return decodeURIComponent(keyVal[1]);
		}
	}
	return "";
}

//先頭ゼロ付加
function padZero_17(num) {
	var result;
	if (num < 10) {
		result = "0" + num;
	} else {
		result = "" + num;
	}
	return result;
}
//先頭ゼロ除去
function trimZero_17(str) {
	var res = str.replace(/^0*/, "");
	if (res == "") res = "0";
	return res;
}

//空白除去
function trim_17(str) {
	if (str == undefined) return "";
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
}

//数値チェック
function isNumeric_17(num) {
	if (num.match(/^-?[0-9]+$/)) {
		return true;
	}
	return false;
}

//子Element取得
function getChildElement_17(parentNode, position) {
	var current = 0;
	for (var i = 0; i < parentNode.childNodes.length; i++){
		var childNode = parentNode.childNodes[i];
		if (childNode.nodeType == 1) {
			if (current == position) {
				return childNode;
			}
			current++;
		}
	}
	
	return undefined;
}


//時刻計算（現在時刻に加算、引数hh:mm:ss）
function computeTime_17(clock) {
	var hour = parseInt(trimZero_17(
		clock.replace(/^([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$1")));
	if (isNaN(hour)) hour = 0;
	var min = parseInt(trimZero_17(
		clock.replace(/^([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$2")));
	if (isNaN(min)) min = 0;
	var sec = parseInt(trimZero_17(
		clock.replace(/^([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$3")));
	if (isNaN(sec)) sec = 0;
	
	var now = new Date();
	var resTime = new Date();
	resTime.setHours(now.getHours() + hour);
	resTime.setMinutes(now.getMinutes() + min);
	resTime.setSeconds(now.getSeconds() + sec);
	
	return resTime;
}

//日時文字列編集（yyyy/mm/dd hh:mm:ss）
function generateDateString_17(date) {
	var res = "" + date.getFullYear() + "/" + padZero_17(date.getMonth() + 1) + 
		"/" + padZero_17(date.getDate()) + " " + padZero_17(date.getHours()) + ":" + 
		padZero_17(date.getMinutes()) + ":" + padZero_17(date.getSeconds());
	return res;
}

//日時文字列編集2（mm/dd hh:mm:ss）
function generateDateString2_17(date) {
	var res = "" + padZero_17(date.getMonth() + 1) + "/" + padZero_17(date.getDate()) + 
		" " + padZero_17(date.getHours()) + ":" + padZero_17(date.getMinutes()) + 
		":" + padZero_17(date.getSeconds());;
	return res;
}

//残時間文字列編集
function generateWaitTimeString_17(time1, time2) {
	var result = "";
	
	var waitTimeSec = Math.ceil((time1.getTime() - time2.getTime()) / 1000);
	result += Math.floor(waitTimeSec / (60*60));
	result += ":";
	result += padZero_17(Math.floor((waitTimeSec % (60*60)) / 60));
	result += ":";
	result += padZero_17(waitTimeSec % 60);
	
	return result;
}

function ccreateCheckBoxKai2(container, id, def, text, title, left )
{
	left += 2;
	var dv = d_17.createElement("div");
	dv.style.padding = "2px";
	dv.style.paddingLeft= left + "px";

	dv.title = title;
	var cb = d_17.createElement("input");
	cb.type = "checkbox";
	cb.id = id + def;
	cb.value = 1;
	var def2 = id  + ""  + "[" + def + "]";
	//console.log(def2 + " = " + eval(def2));
	if( eval(def2) ) cb.checked = true;
	
	var lb = d_17.createElement("label");
	lb.htmlFor = id;
	
	var tx = d_17.createTextNode(text);
	lb.appendChild( tx );
	var tb = d_17.createElement("input");
	tb.type = "text";
	tb.id = id + "LV" + def;
	tb.value = eval(id  + "LV"  + "[" + def + "]");
	//console.log(id  + "LV"  + "[" + def + "] =" + eval(id  + "LV"  + "[" + def + "]"));
	tb.size = 2;
	
	dv.appendChild(cb);
	dv.appendChild(lb);
	dv.appendChild(tb);
	container.appendChild(dv);
	return cb;
}



function ccreateTextBox_17(container, id, def, text, title, size, left )
{
	left += 2;
	var dv = d_17.createElement("div");
	dv.style.padding = "2px";
	dv.style.paddingLeft= left + "px";
	dv.title = title;
	var tb = d_17.createElement("input");
	tb.type = "text";
	tb.id = id;
	tb.value = def;
	tb.size = size;
	
	var tx = d_17.createTextNode(text);
	tx.title = title;
	
	dv.appendChild(tx);
	dv.appendChild(tb);
	container.appendChild(dv);
	return tb;
}
function ccreateCheckBox_17(container, id, def, text, title, left )
{
	left += 2;
	var dv = d_17.createElement("div");
	dv.style.padding = "2px";
	dv.style.paddingLeft= left + "px";
	dv.title = title;
	var cb = d_17.createElement("input");
	cb.type = "checkbox";
	cb.id = id;
	cb.value = 1;
	if( def ) cb.checked = true;
	
	var lb = d_17.createElement("label");
	lb.htmlFor = id;
	
	var tx = d_17.createTextNode(text);
	lb.appendChild( tx );
	
	dv.appendChild(cb);
	dv.appendChild(lb);
	container.appendChild(dv);
	return cb;
}
function ccreateCheckBox0(container, id, def, text, title, left )
{
	left += 2;

	var cb = d_17.createElement("input");
	cb.type = "checkbox";
	cb.id = id;
	//cb.value = 1;
	//if( def ) cb.checked = true;
	cb.checked  = def;
	container.appendChild(cb);
	return cb;
}


function ccreateButton_17(container, text, title, func)
{
	var btn = d_17.createElement("input");
	btn.style.padding = "1px";
	btn.type = "button";
	btn.value = text;
	btn.title = title;
	container.appendChild(d_17.createTextNode(" "));
	container.appendChild(btn);
	container.appendChild(d_17.createTextNode(" "));
	$e_17(btn, "click", func);
	return btn;
}

function cgetCheckBoxValue_17(id)
{
	var c = id;
	if( !c ) return 0;
	if( !c.checked ) return 0;
	return 1;
}

function cgetTextBoxValue_17(id)
{
	var c = id;
	if( !c ) return "";
	return c.value;
}
function ccreateComboBox_17(container, id, sels, def, text, title, left )
{
    left += 2;
    var dv = d_17.createElement("div");
    dv.style.padding = "2px";
    dv.style.paddingLeft= left + "px";
    dv.title = title;
    var sel = d_17.createElement("select");
    sel.id = id;
    for(var i=0; i<sels.length; i++){
        var opt = d_17.createElement("option");
        opt.value = sels[i];
        opt.appendChild(d_17.createTextNode(sels[i]));
        sel.appendChild(opt);
    }
    if( def ) sel.value = def;

    var tx = d_17.createTextNode(text);
    tx.title = title;

    dv.appendChild(tx);
    dv.appendChild(sel);
    container.appendChild(dv);
    return sel;
}
function cgetComboBoxValue(id){
	var c = id;
	if( !c ) return "";
	return c.value;
}
function Chek_Sigen(area){
	//costs
	var cost_wood = [
		[10,35,40,15],
		[25, 88, 100, 38],
		[58, 202, 230, 86],
		[173, 604, 690, 259],
		[431, 1510, 1725, 647],
		[1466, 2847, 3019, 1294],
		[2493, 4839, 5132, 2200],
		[3490, 6775, 7186, 3080],
		[4537, 8807, 9341, 4003],
		[5898, 11450, 12144, 5204],
		[8119, 14434, 15787, 6766],
		[11366, 20207, 22101, 9472],
		[17050, 30311, 33152, 14208],
		[25575, 45467, 49729, 21312],
		[38362, 68199, 74593, 31698]
	];
	var cost_stone= [
		[40, 10, 35, 15],
		[100, 25, 88, 38],
		[230, 58, 202, 86],
		[690, 173, 604, 259],
		[1725, 431, 1510, 647],
		[3019, 1466, 2847, 1294],
		[5132, 2493, 4839, 2200],
		[7186, 3490, 6775, 3080],
		[9341, 4537, 8807, 4003],
		[12144, 5898, 11450, 5204],
		[15787, 8119, 14434, 6766],
		[22101, 11366, 20207, 9472],
		[33152, 17050, 30311, 14208],
		[49729, 25575, 45467, 21312],
		[74593, 38362, 68199, 31968]
	];
	var cost_iron=[
		[35, 40, 10, 15],
		[88, 100, 25, 38],
		[202, 230, 58, 86],
		[604, 690, 173, 259],
		[1510, 1725, 431, 647],
		[2847, 3019, 1466, 1294],
		[4839, 5132, 2493, 2200],
		[6775, 7186, 3490, 3080],
		[8807, 9341, 4537, 4003],
		[11450, 12144, 5898, 5204],
		[14434, 15787, 8119, 6766],
		[20207, 22101, 11366, 9472],
		[30311, 33152, 17050, 14208],
		[45467, 49729, 25575, 21312],
		[68199, 74593, 38362, 31968]
	];
	var cost_rice=[
		[35, 35, 30, 0],
		[88, 88, 75, 0],
		[202, 202, 173, 0],
		[604, 604, 518, 0],
		[1510, 1510, 1294, 0],
		[3019, 3019, 2588, 0],
		[5132, 5132, 4399, 0],
		[7186, 7186, 6159, 0],
		[9341, 9341, 8007, 0],
		[12144, 12144, 10409, 0],
		[15787, 15787, 13532, 0],
		[22101, 22101, 18944, 0],
		[33152, 33152, 28416, 0],
		[49729, 49729, 42625, 0],
		[74593, 74593, 63937, 0]
	];
	var cost_souko=[
		[83, 141, 83, 63],
		[167, 281, 167, 126],
		[300, 506, 300, 226],
		[479, 810, 479, 362],
		[671, 1134, 671, 507],
		[1044, 1253, 1044, 835],
		[1462, 1754, 1462, 1169],
		[1973, 2368, 1973, 1578],
		[2664, 3196, 2664, 2131],
		[3596, 4315, 3596, 2877],
		[4854, 5825, 4854, 3883],
		[6311, 7573, 6311, 5048],
		[8204, 9845, 8204, 6563],
		[10255, 12306, 10255, 8204],
		[12819, 15382, 12819, 10255],
		[15382, 18459, 15382, 12306],
		[18459, 22151, 18459, 14767],
		[21228, 21228, 25473, 16982],
		[24412, 29294, 24412, 19529],
		[28074, 33688, 28074, 22459]
	];
	var cost_syukusya=[
		[35, 20, 35, 80],
		[53, 30, 53, 120],
		[89, 51, 89, 204],
		[147, 84, 147, 337],
		[228, 130, 228, 522],
		[336, 192, 336, 767],
		[476, 272, 476, 1089],
		[653, 373, 653, 1492],
		[868, 496, 868, 1984],
		[1129, 645, 1129, 2580],
		[2032, 1161, 2032, 4644],
		[3658, 2090, 3658, 4644],
		[6951, 3971, 6950, 15882],
		[13205, 7544, 13205, 30177],
		[25090, 14334, 25090, 57336]
	];
	var cost_kojo=[
		[780, 1560, 1560, 3900],
		[1248, 2496, 2496, 6240],
		[1997, 3994, 3994, 9984],
		[4193, 6290, 6290, 11182],
		[5871, 8806, 8806, 15655],
		[10958, 13698, 13698, 16437],
		[15342, 19177, 19177, 23013],
		[19944, 24930, 24930, 29916],
		[25928, 32410, 32410, 38891],
		[33706, 42132, 42132, 50559]
	];
	var cost_suisya=[
		[2940, 980, 980, 4900],
		[4704, 1568, 1568, 7840],
		[7526, 2509, 2509, 12544],
		[10537, 5268, 5268, 14049],
		[14751, 7376, 7376, 19668],
		[20652, 13768, 13768, 20652],
		[28913, 19275, 19275, 28913],
		[37587, 25058, 25058, 37587],
		[48863, 32576, 32576, 48863],
		[63523, 42348, 42348, 63523]
	];
	var cost_ichiba=[
		[100, 100, 50, 50],
		[334, 334, 191, 191],
		[1035, 1035, 592, 592],
		[2795, 2795, 1600, 1600],
		[6328, 6328, 4218, 4218],
		[13288, 13288, 8859, 8859],
		[25248, 25248, 16832, 16832],
		[42921, 42921, 28614, 28614],
		[64381, 64381, 42921, 42921],
		[90134, 90134, 60089, 60089]
	];
	var cost_kenkyu=[
		[275, 110, 110, 55],
		[413, 165, 165, 83],
		[619, 248, 248, 124],
		[1486, 836, 836, 557],
		[2228, 1253, 1253, 836],
		[7521, 6267, 6267, 5015],
		[13538, 11282, 11282, 9025],
		[21436, 17862, 17862, 14290],
		[44675, 37228, 37228, 29784],
		[87725, 73104, 73104, 58483]
	];
	var cost_kunren=[
		[1500, 1600, 2500, 3300],
		[2100, 2240, 3500, 3300],
		[2940, 3136, 4900, 6468],
		[6629, 7326, 13955, 6978],
		[13257, 14653, 27910, 13955],
		[32097, 37679, 55821, 13955],
		[64194, 75358, 111642, 27910],
		[128388, 150716, 223283, 55821],
		[256776, 301432, 446566, 111642],
		[513551, 602865, 893133, 223283]
	];
	var cost_kajiba=[
		[150, 200, 340, 170],
		[400, 300, 680, 340],
		[780, 585, 1326, 663],
		[1482, 1112, 2519, 1260],
		[2742, 2056, 4661, 2330],
		[4935, 3701, 8390, 4195],
		[8636, 6477, 14682, 7341],
		[17640, 14112, 28223, 10584],
		[31566, 25253, 50506, 18940],
		[50506, 40404, 80809, 30303]
	];
	var cost_bougu=[
		[150, 200, 340, 170],
		[300, 400, 680, 340],
		[585, 780, 1326, 663],
		[1112, 1482, 2519, 1260],
		[2056, 2742, 4661, 2330],
		[3701, 4935, 8390, 4195],
		[6477, 8636, 14682, 7341],
		[14112, 17640, 28223, 10584],
		[25253, 31566, 50506, 18940],
		[40404, 50506, 80809, 30303]
	];
	var cost_heiki=[
		[216, 216, 216, 72],
		[432, 432, 432, 144],
		[864, 864, 864, 288],
		[1224, 1224, 1224, 648],
		[1836, 1836, 1836, 972],
		[2662, 2662, 2662, 1409],
		[3860, 3860, 3860, 2044],
		[7357, 7357, 7357, 2452],
		[13242, 13242, 13242, 4414],
		[23836, 23836, 23836, 7945],
		[42905, 42905, 42905, 14302],
		[77229, 77229, 77229, 25743],
		[139013, 139013, 139013, 46338],
		[278026, 278026, 278026, 92675],
		[556051, 556051, 556051, 185350]
	];
	var cost_doujaku=[
		[700, 3500, 2100, 700],
		[1120, 5600, 3360, 1120],
		[1792, 8960, 5376, 1792],
		[3763, 10035, 7526, 3763],
		[5263, 14049, 10537, 5268],
		[9834, 14752, 14752, 9834],
		[13768, 20652, 20652, 13768],
		[17899, 26848, 26848, 17899],
		[23268, 34902, 34902, 23268],
		[30249, 45373, 45373, 30249]
	];
	var cost_renpei=[
		[112, 107, 107, 122],
		[224, 214, 214, 244],
		[448, 428, 428, 488],
		[759, 725, 725, 826],
		[1214, 1160, 1160, 1322],
		[2209, 2110, 2110, 2406],
		[3331, 3182, 3182, 3627],
		[4958, 4736, 4736, 5400],
		[8091, 7729, 7729, 8813],
		[11130, 10632, 10632, 12122]
	];
	var cost_heisya=[
		[72, 360, 72, 216],
		[144, 720, 144, 432],
		[288, 1440, 288, 864],
		[648, 1728, 648, 1296],
		[972, 2592, 972, 1944],
		[1409, 3758, 1409, 2819],
		[2725, 4088, 2725, 4088],
		[6744, 9810, 5518, 2453],
		[12140, 17658, 9933, 4415],
		[21852, 31784, 17879, 7946],
		[39333, 57212, 32182, 14303],
		[70800, 96545, 64364, 25745],
		[127440, 173781, 115854, 46342],
		[254879, 324392, 254879, 92683],
		[509759, 648784, 509759, 185367]
	];
	var cost_yumi=[
		[360, 72, 72, 216],
		[720, 144, 144, 432],
		[1440, 288, 288, 864],
		[1728, 648, 648, 1296],
		[2592, 972, 972, 1944],
		[3758, 1409, 1409, 2819],
		[5450, 2044, 2044, 4087],
		[9810, 6131, 6131, 2453],
		[17658, 12140, 9933, 4415],
		[31784, 21852, 17879, 7946],
		[57212, 39333, 32182, 14303],
		[96545, 70800, 64364, 25745],
		[173781, 127440, 115854, 46342],
		[324392, 254879, 254879, 92683],
		[648784, 509759, 509759, 185367]
	];
	var cost_uma=[
		[72, 72, 360, 216],
		[144, 144, 720, 432],
		[288, 288, 1440, 864],
		[648, 648, 1728, 1296],
		[972, 972, 2592, 1944],
		[1409, 1409, 3758, 2891],
		[2044, 2044, 5450, 4087],
		[5518, 6744, 9810, 2453],
		[9933, 12140, 17658, 4415],
		[17879, 21852, 31784, 7946],
		[32182, 39333, 57212, 14303],
		[64364, 70800, 96545, 25745],
		[115854, 127440, 173781, 46342],
		[254879, 254879, 324392, 92683],
		[509759, 509759, 648784, 185367]
	];

	var cost_shiro=[
		[0, 0, 0, 0],
		[1404, 546, 390, 780],
		[2570, 1000, 714, 1428],
		[4161, 2081, 2081, 2081],
		[7102, 3552, 3552, 3552],
		[9056, 9056, 6037, 6037],
		[14384, 14384, 9589, 9589],
		[22773, 22773, 15183, 15183],
		[33562, 33562, 22374, 22374],
		[44402, 57559, 32890, 29602],
		[65122, 84418, 48239, 43415],
		[95317, 123558, 70605, 63544],
		[113458, 154716, 154716, 92830],
		[150418, 150418, 315878, 135375],
		[219008, 219008, 492770, 164258],
		[294820, 294820, 663345, 221115],
		[488220, 488220, 827854, 318406],
		[839130, 839130, 915414, 457707],
		[1307581, 1307581, 1354280, 700491],
		[1901938, 1901938, 1969864, 1018896]
	];
	var cost_toride=[
		[104, 400, 136, 160],
		[243, 936, 319, 374],
		[438, 1685, 573, 673],
		[1110, 2467, 1357, 1233],
		[1887, 4194, 2307, 2097],
		[3236, 7191, 3954, 3596],
		[5177, 11505, 6327, 5753],
		[10430, 18776, 13560, 9387],
		[18839, 33912, 24492, 16956],
		[33914, 61043, 44087, 30523],
		[66939, 106495, 85196, 45640],
		[119786, 190570, 152456, 81672],
		[213820, 340166, 272133, 145786],
		[423566, 505021, 456148, 244365],
		[708513, 844765, 763014, 408756]
	];
	var cost_mura=[
		[400, 136, 104, 160],
		[936, 319, 243, 374],
		[1685, 573, 438, 673],
		[2467, 1357, 1110, 1233],
		[4194, 2307, 1887, 2097],
		[7191, 3954, 3236, 3596],
		[11505, 6327, 5177, 5753],
		[18776, 13560, 10430, 9387],
		[33912, 24492, 18839, 16956],
		[61043, 44087, 33914, 30523],
		[106495, 85196, 66939, 45640],
		[190570, 152456, 119786, 81672],
		[340166, 272133, 213820, 145786],
		[505021, 456148, 423566, 244365],
		[844765, 763014, 708513, 408756]
	];
	var cost_daisyukusya=[
		[200, 114, 200, 438],
		[320, 183, 320, 701],
		[512, 293, 512, 1121],
		[768, 439, 768, 1682],
		[1152, 658, 1152, 2523],
		[1728, 987, 1728, 3784],
		[2419, 1382, 2419, 5298],
		[3387, 1935, 3387, 7418],
		[4741, 2709, 4741, 10385],
		[6637, 3793, 6637, 14538],
		[8628, 4930, 8628, 18900],
		[11217, 6409, 11217, 24570],
		[14582, 8332, 14582, 31941],
		[18956, 11735, 18956, 40620],
		[25817, 16429, 25817, 49286],
		[32271, 22003, 32271, 60141],
		[42172, 29337, 42172, 69675],
		[52715, 38963, 52715, 84803],
		[66009, 49506, 66009, 93512],
		[79211, 62708, 79211, 108914]
	];
	var cost_ennseikunren=[
		[2884, 4486, 5977, 2723],
		[4614, 7177, 9484, 4357],
		[7382, 11483, 15174, 6972],
		[11811, 18373, 24279, 11155],
		[18898, 29397, 38846, 17848],
		[28347, 44096, 58269, 26772],
		[42521, 66143, 87404, 40158],
		[63781, 99215, 131105, 60238],
		[89294, 138901, 183548, 84333],
		[125011, 194461, 256967, 118066],
		[175015, 272246, 359754, 165292],
		[227520, 353920, 467680, 214880],
		[295776, 460096, 607984, 279344]
	];
	var cost_miharidai=[
		[600, 840, 600, 360 ],
		[960, 1344, 960, 576],
		[1536, 2150, 1536, 922],
		[2458, 3441, 2458, 1475],
		[3932, 5505, 3932, 2359],
		[6291, 8808, 6291, 3775],
		[9437, 13212, 9437, 5662],
		[14156, 19818, 14156, 8493],
		[21233, 29727, 21233, 12740],
		[31850, 44590, 31850, 19110],
		[44590, 62426, 44590, 26754],
		[62426, 87396, 62426, 37456],
		[87397, 122355, 87397, 52438],
		[122355, 171297, 122355, 73413],
		[159062, 222686, 159062, 95437],
		[206780, 289492, 206780, 124068]
	];
	var cost_syugyouzyo=[
		[1600, 1200, 600, 600],
		[2240, 1680, 840, 840],
		[3136, 2352, 1176, 1176],
		[4390, 3293, 1646, 1646],
		[6146, 4610, 2305, 2305],
		[8605, 6454, 3227, 3227],
		[11186, 8390, 4195, 4195],
		[14542, 10907, 5453, 5453],
		[18905, 14179, 7089, 7089],
		[24577, 18433, 9216, 9216],
		[31950, 23963, 11981, 11981],
		[38340, 28755, 14378, 14378],
		[46008, 34506, 17253, 17253],
		[55210, 41407, 20704, 20704],
		[66252, 49689, 24844, 24844],
		[72877, 54658, 27329, 27329],
		[80164, 60123, 30062, 30062],
		[88181, 66136, 33068, 33068],
		[96999, 72749, 36375, 36375],
		[106699, 80024, 40012, 40012]
	];
	var costs = [];

	costs["城"] = cost_shiro;
	costs["伐採所"] = cost_wood;
	costs["石切り場"] = cost_stone;
	costs["製鉄所"] = cost_iron;
	costs["畑"] = cost_rice;
	costs["倉庫"] = cost_souko;
	costs["銅雀台"] = cost_doujaku;
	costs["鍛冶場"] = cost_kajiba;
	costs["防具工場"] = cost_bougu;
	costs["練兵所"] = cost_renpei;
	costs["兵舎"] = cost_heisya;
	costs["弓兵舎"] = cost_yumi;
	costs["厩舎"] = cost_uma;
	costs["宿舎"] = cost_syukusya;
	costs["兵器工房"] = cost_heiki;
	costs["市場"] = cost_ichiba;
	costs["訓練所"] = cost_kunren;
	costs["水車"] = cost_suisya;
	costs["工場"] = cost_kojo;
	costs["研究所"] = cost_kenkyu;
	costs["大宿舎"] = cost_daisyukusya;
	costs["遠征訓練所"] = cost_ennseikunren;
	costs["見張り台"] = cost_miharidai;
	costs["修行所"] = cost_syugyouzyo;
	costs["砦"] = cost_toride;
	costs["村"] = cost_mura;

	// 現時の資源値-貯蓄値処理
	//alert(area.name +":" + area.lv +":" +area.xy );
	var RES_NOW = [];
	RES_NOW["wood"] = parseInt( $_17("wood").innerHTML, 10 );
	RES_NOW["stone"] = parseInt( $_17("stone").innerHTML, 10 );
	RES_NOW["iron"] = parseInt( $_17("iron").innerHTML, 10 );
	RES_NOW["rice"] = parseInt( $_17("rice").innerHTML, 10 );

	loadAVCBox();
	RES_NOW.wood -= OPT_CHKBOX_W;
	RES_NOW.stone -= OPT_CHKBOX_S;
	RES_NOW.iron -= OPT_CHKBOX_I;
	RES_NOW.rice -= OPT_CHKBOX_R;

	try {
		if( costs[area.name].length <= parseInt(area.lv) || // maxinum level reached 
			RES_NOW.wood < costs[area.name][parseInt(area.lv)][0] ||
			RES_NOW.stone< costs[area.name][parseInt(area.lv)][1] ||
			RES_NOW.iron < costs[area.name][parseInt(area.lv)][2] ||
			RES_NOW.rice < costs[area.name][parseInt(area.lv)][3] ) {
				//建築不可 = 1
				return 1;
		}
	}catch(e) {
		console.log("catched");
	}
	return 0;

}

//市場変換処理
function ichibaChange() {
	if(OPT_ICHIBA != 1) {
		//alert("市場自動変換未指定");
		//console.log("市場自動変換未指定");
		return;
	}

	var ichiba_x = -1; //市場のX座標
	var ichiba_y = -1; //市場のY座標
	var ichiba_lv = -1; //市場のレベル

	var area = new Array();
	area = get_area();

	for(i=0;i<area.length;i++){
		//alert(area[i].name + ":" + area[i].lv + ":" + area[i].xy);
		//alert(parseInt(area[i].lv) + "::" + parseInt(OPT_MAX_LV));
		
		//市場の座標を取得
		if(area[i].name == "市場") {
			var Temp = area[i].xy.split(",");
			ichiba_x = Temp[0];
			ichiba_y = Temp[1];
			ichiba_lv = area[i].lv;
			//alert("市場の座標：" + ichiba_x + ", " + ichiba_y);
		}
	}

	if(ichiba_x < 0) {
		//alert("市場がありません");
		console.log("市場がありません");
		return;
	}

	var RES_NOW = [];
	RES_NOW["wood"] = parseInt( $_17("wood").innerHTML, 10 );
	RES_NOW["stone"] = parseInt( $_17("stone").innerHTML, 10 );
	RES_NOW["iron"] = parseInt( $_17("iron").innerHTML, 10 );
	RES_NOW["rice"] = parseInt( $_17("rice").innerHTML, 10 );
	
	//糧が指定量より多いかチェック
	if(RES_NOW["rice"] < OPT_RISE_MAX) {
		//alert("糧が" + OPT_RISE_MAX + "未満");
		console.log("糧が" + OPT_RISE_MAX + "未満");
		return;
	}
	//console.log("市場変換パターン：" + OPT_ICHIBA_PA);
	if(OPT_ICHIBA_PATS[0] == OPT_ICHIBA_PA){
		var min_sigen = RES_NOW["wood"];

		if(RES_NOW["stone"] < min_sigen ) { min_sigen = RES_NOW["stone"]; }
		if(RES_NOW["iron"] < min_sigen ) { min_sigen = RES_NOW["iron"]; }

		//糧から他の資源に返還開始
		if((OPT_TO_WOOD > 0) && ( RES_NOW["wood"] == min_sigen )) {
			changeResorceToResorce(RICE, OPT_TO_WOOD, WOOD, ichiba_x, ichiba_y);
		} else if((OPT_TO_STONE > 0) && ( RES_NOW["stone"] == min_sigen )) {
			changeResorceToResorce(RICE, OPT_TO_STONE, STONE, ichiba_x, ichiba_y);
		} else if((OPT_TO_IRON > 0) && ( RES_NOW["iron"] == min_sigen )) {
			changeResorceToResorce(RICE, OPT_TO_IRON, IRON, ichiba_x, ichiba_y);
		}
		return;
	}else{
        if(OPT_ICHIBA_PATS[1] == OPT_ICHIBA_PA) {
            if(OPT_RISE_MAX < OPT_TO_WOOD+OPT_TO_STONE+OPT_TO_IRON){
                //alert("変換する総合計より糧の値を大きくしてください。");
            }else{
                changeResorceToResorce(RICE, OPT_TO_WOOD, WOOD, ichiba_x, ichiba_y);
                changeResorceToResorce(RICE, OPT_TO_STONE, STONE, ichiba_x, ichiba_y);
                changeResorceToResorce(RICE, OPT_TO_IRON, IRON, ichiba_x, ichiba_y);
            }
            return;
        }else{
            //RES_NOW["wood"] 
            //RES_NOW["stone"]
            //RES_NOW["iron"] 
            //RES_NOW["rice"] 
            
            var tmpIdx;
            var tmpNow;
            var tmpRes1 = new Array();
            var tmpRes2 = new Array();
            tmpRes1[0]=RES_NOW["wood"];
            tmpRes1[1]=RES_NOW["stone"];
            tmpRes1[2]=RES_NOW["iron"];
            tmpRes2[0]="wood";
            tmpRes2[1]="stone";
            tmpRes2[2]="iron";
            tmpNow=0;
            for(i=0; i<tmpRes1.length-1; i++) {
                for(j=tmpRes1.length-1; j>i; j--){
                    if(tmpRes1[j] < tmpRes1[j-1]){
                            tmpIdx = tmpRes2[j];
                            tmpNow = tmpRes1[j];
                            tmpRes1[j] = tmpRes1[j-1];
                            tmpRes1[j-1] = tmpNow;
                            tmpRes2[j] = tmpRes2[j-1];
                            tmpRes2[j-1] = tmpIdx;
                    }
                }
            }
            var ichiba_wariai=[0, 40, 42, 44, 46, 48, 50, 52, 54, 56, 60];

            var wariai = ichiba_wariai[ichiba_lv];

            for(i=0; i<tmpRes1.length - 1; i++) {
                if(i==0){
                    var toRes = parseInt( (tmpRes1[2] - tmpRes1[0] ) / ( tmpRes1[0] + tmpRes1[1]  + tmpRes1[2] ) * OPT_RISE_MAX * (1 + 2 / 3));
                }else{
                    var toRes = parseInt( (tmpRes1[2] - tmpRes1[1] ) / ( tmpRes1[0] + tmpRes1[1] +  tmpRes1[2] ) * OPT_RISE_MAX * (1 + 1 / 3)); 
                }
                //console.log(tmpRes2[i] + " : " + tmpRes1[i] + "：" + toRes + "で " + tmpRes2[i] +  " 変換");
                if(toRes < RES_NOW["rice"] ){
                    //console.log("変換開始" + OPT_TO_CODE[tmpRes2[i]]);
                    changeResorceToResorce(RICE, toRes , OPT_TO_CODE[tmpRes2[i]], ichiba_x, ichiba_y);
                }else{
                    console.log("エラー" + toRes + " > " + RES_NOW["rice"] );
                }

            }
            return;
        }
	}

	// 資源のバランスが悪い場合、少ない資源を優先的に変換する処理
	// 基本的には変換後も現在の最大量を超えない場合に変換を行う。
	// すなわち、量が最大の資源は変換を行わない。
//	var ichiba_wariai=[0, 40, 42, 44, 46, 48, 50, 52, 54, 56, 60];
//
//	var wariai = ichiba_wariai[ichiba_lv];
//	var max_sigen;
//	var change_flg = 0;
//
//	if(RES_NOW["wood"] > RES_NOW["stone"]) { max_sigen = RES_NOW["wood"]; } else { max_sigen = RES_NOW["stone"]; }
//	if(RES_NOW["iron"] > max_sigen ) { max_sigen = RES_NOW["iron"]; }
//
//
	//糧から他の資源に返還開始
//	if((OPT_TO_WOOD > 0) && ( (RES_NOW["wood"] + OPT_TO_WOOD * wariai / 100) < max_sigen )) {
//		changeResorceToResorce(RICE, OPT_TO_WOOD, WOOD, ichiba_x, ichiba_y);
//		change_flg = 1;
//	}
//		if((OPT_TO_STONE > 0) && ( (RES_NOW["stone"] + OPT_TO_STONE * wariai / 100) < max_sigen )) {
//		changeResorceToResorce(RICE, OPT_TO_STONE, STONE, ichiba_x, ichiba_y);
//		change_flg = 1;
//	}
//	if((OPT_TO_IRON > 0) && ( (RES_NOW["iron"] + OPT_TO_IRON * wariai / 100) < max_sigen )) {
//		changeResorceToResorce(RICE, OPT_TO_IRON, IRON, ichiba_x, ichiba_y);
//		change_flg = 1;
//	}
//
//
//	if(change_flg == 0) {
//
//		// alert("市場変換開始");
//		if(OPT_TO_WOOD > 0) {
//			changeResorceToResorce(RICE, OPT_TO_WOOD, WOOD, ichiba_x, ichiba_y);
//		}
//		if(OPT_TO_STONE > 0) {
//			changeResorceToResorce(RICE, OPT_TO_STONE, STONE, ichiba_x, ichiba_y);
//		}
//		if(OPT_TO_IRON > 0) {
//			changeResorceToResorce(RICE, OPT_TO_IRON, IRON, ichiba_x, ichiba_y);
//		}
//		// alert("市場変換終了");
//	}
//	var tid=setTimeout(function(){location.reload();},INTERVAL_17);
}

//実変換処理通信部
function changeResorceToResorce(from, tc, to, x, y) {
	var data = "form2=&x=" + x + "&y=" + y + "&change_btn=" + encodeURIComponent("はい") + "&st=1&tf_id=" + from + "&tc=" + tc + "&tt_id=" + to;
//	var data = "x=" + x + "&y=" + y + "&change_btn=" + encodeURIComponent("はい") + "&st=1&tf_id=" + from + "&tc=" + tc + "&tt_id=" + to;
	//var tid=setTimeout(function(){
	tidMain=setTimeout(function(){
		GM_xmlhttpRequest({
			method:"POST", 
			url:"http://" + HOST_17 + "/facility/facility.php",
			headers:{"Content-type":"application/x-www-form-urlencoded"},
			data: data,
			onload:function(x){
			    //console.log(x.responseText);
			    			    }
		});
	},INTERVAL_17);
}

//自動寄付処理
function autoDonate() {
	if(OPT_KIFU != 1) {
		//alert("自動寄付未指定");
		return;
	}

	//糧が指定量より多いかチェック
	if($_17("rice").innerHTML < OPT_RISE_KIFU_MAX) {
		//alert("糧が" + OPT_RISE_KIFU_MAX + "未満");
		return;
	}


	sendDonate(OPT_RISE_KIFU);
//	var tid=setTimeout(function(){location.reload();},INTERVAL_17);
}

//寄付処理通信部
function sendDonate(rice) {
	var data = "contributionForm=&wood=0&stone=0&iron=0&rice=" + rice + "&contribution=1";
	//var tid=setTimeout(function(){
	tidMain=setTimeout(function(){
		GM_xmlhttpRequest({
			method:"POST", 
			url:"http://" + HOST_17 + "/alliance/level.php",
			headers:{"Content-type":"application/x-www-form-urlencoded"},
			data: data,
			//onload:function(x){//console.log(x.responseText);}
			onload:function(x){ }
		});
	},INTERVAL_17);
}
//内政スキルの使用
function Auto_Domestic() {
	if (!OPT_DOME) {return;} //設定してなければ戻る
	//return;
	//http://m13.3gokushi.jp/card/domestic_setting.php#ptop
	
	//var tid=setTimeout(function(){
	tidMain=setTimeout(function(){
		GM_xmlhttpRequest({
			method:"GET", 
			url:"http://" + HOST_17 + "/card/domestic_setting.php",
			headers:{"Content-type":"text/html"},
			overrideMimeType:'text/html; charset=utf-8',
			onload:function(x){
				
				var htmldoc = document.createElement("html");
			        htmldoc.innerHTML = x.responseText;
			        
		        	var skillElem = document.evaluate('//*[@class="skill"]',htmldoc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
				if(skillElem.snapshotLength < 1){return;}
				
				//alert(skillTag);
				for(i=1;i<skillElem.snapshotLength;i++){
					var skillTag = trim_17(skillElem.snapshotItem(i).innerHTML);
					if(	(skillTag.indexOf("知識",0) > 1 )||
						(skillTag.indexOf("技術",0) > 1 )||
						(skillTag.indexOf("呉の治世",0) > 1 )||
						(skillTag.indexOf("王佐",0) > 1 )||
						(skillTag.indexOf("富国",0) > 1 )||
						(skillTag.indexOf("豊穣",0) > 1 )||
						(skillTag.indexOf("美玉歌舞",0) > 1 )||
						(skillTag.indexOf("王佐",0) > 1 )
					){
						var link = skillTag.substring(skillTag.indexOf("href=",0)+6,skillTag.indexOf("\"",skillTag.indexOf("href=",0)+7));
						do {
							link = link.replace(/&amp;/,"&");
						}while(link.indexOf("&amp;",0) > 1)
						GM_xmlhttpRequest({
								method:"GET", 
								url:"http://" + HOST_17 + link,
								headers:{"Content-type":"text/html"},
								overrideMimeType:'text/html; charset=utf-8',
								onload:function(x){
									//alert(x.responseText);
								}
						});
					}
				}
			}
		});
	},INTERVAL_17);
}

///////////////////////////////////////////////
//Chrome用GM_関数
// @copyright 2009, James Campos
// @license cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
	GM_addStyle = function(css) {
		var style = document.createElement('style');
		style.textContent = css;
		document.getElementsByTagName('head')[0].appendChild(style);
	};

	GM_deleteValue = function(name) {
		localStorage.removeItem(name);
	};

	GM_getValue = function(name, defaultValue) {
		var value = localStorage.getItem(name);
		if (!value)
		return defaultValue;
		var type = value[0];
		value = value.substring(1);
			switch (type) {
				case 'b':
				return value == 'true';
				case 'n':
				return Number(value);
				default:
				return value;
			}
	};

	GM_log = function(message) {
		if (window.opera) {
			opera.postError(message);
		return;
		}
		console.log(message);
	};

	GM_registerMenuCommand = function(name, funk) {
	//todo
	};

	GM_setValue = function(name, value) {
		value = (typeof value)[0] + value;
		localStorage.setItem(name, value);
	};
}
///////////////////////////////////////////////
//faraway 17.bro3_Auto_Bilder_nokin_customのソース(bro3_auto_bilder_nokin_custom.user.js)終了

//faraway 18.全体マップ移動距離カスタムツールのソース(bro3_change_move_size.user.js)開始
//================================================================================
//18.全体マップ移動距離カスタムツール
//================================================================================
// ==UserScript==
// @name           bro3_change_move_size
// @namespace      http://homepage3.nifty.com/Craford
// @include        http://*.3gokushi.jp/map.php*
// @include        http://*.1kibaku.jp/map.php*
// @description    ブラウザ三国志マップ移動距離変更
// @version        1.10
// ==/UserScript==
// version date       author
// ver1.00 2011.01.03 ドワクエ Craford（旧クラフト＋）短距離マップ移動アイコンの移動幅を２マスにする
// ver1.01 2011.01.04 ドワクエ Craford（旧クラフト＋）移動サイズを自由設定できるようにしてみた
// ver1.02 2011.01.05 ドワクエ Craford（旧クラフト＋）上下左右ボタン（斜め移動）を足してみた
// ver1.03 2001.01.06 ドワクエ Craford（旧クラフト＋）起点に戻るボタンを追加、移動距離に全角入れたときにおかしくなる不具合の対応
// ver1.04 2001.01.06 ドワクエ Craford（旧クラフト＋）起点に設定でマップ中央座標を記憶、起点に戻るで登録座標に戻るように仕様変更
// ver1.05 2001.01.06 ドワクエ Craford（旧クラフト＋）起点に設定時に起点に戻るボタンを更新していなかったので対応を追加
// ver1.06 2001.01.06 ドワクエ Craford（旧クラフト＋）起点からマップ中央までの距離を出せるようにしてみた
// ver1.07 2001.03.05 ドワクエ Craford（旧クラフト＋）要望対応。距離1/2、1/3指定等に対応。
// ver1.08 2001.03.07 ドワクエ Craford（旧クラフト＋）不具合修正。1/2の移動距離を変更。
// ver1.09 2001.03.24 ドワクエ Craford（旧クラフト＋）本鯖仕様変更対応
// ver1.10 2001.03.24 ドワクエ Craford（旧クラフト＋）mixi鯖仕様変更対応

//faraway 18.全体マップ移動距離カスタムツール変数宣言移動前の場所

//----------------//
// メインルーチン //
//----------------//
function disp_change_move_size()
{
//	window.alert("18.:" + location.pathname);	//faraway
//faraway(function(){
	//全体画面なら実行中作業を取得
	if ( (location.pathname == "/map.php") || (location.pathname == "/big_map.php") ) {

		//HTML追加
		addHtml_18();

		//HTML更新
		updateHtml();
	}
//faraway})();
}	//faraway

//-----------------------//
// 51x51モードの実装判定 //
//-----------------------//
function check51_51mode(){
	var result;

	var el = $e_18('//*[@id="change-map-scale"]');
	if( el.snapshotLength > 0 ){
		result = 1;
	}
	else{
		result = 0;
	}

	return result;
}

//------------//
// HTMLの追加 //
//------------//
function addHtml_18() {
	//----------------------//
	// 保存された値をロード //
	//----------------------//
	var execflag;
	var basevalue;
	var basepos;
	var basex;
	var basey;
	execflag = loadExecFlag_18(location.hostname, "MOVE");
	basevalue = new String("0");  // 初期値
	if( execflag == "" ){
		basevalue = 0;
	}
	else{
		basevalue = execflag;
	}

	execflag = loadExecFlag_18(location.hostname, "BASEPOS");
	basepos = new String(BASE);  // 初期値
	if( execflag == "" ){
		basepos = BASE;
	}
	else{
		basepos = execflag;
	}
	basex = basepos.substr(0,4);
	basey = basepos.substr(4,4);

	//--------------------------------------------//
	// 移動数切り替えラジオボタン描画エリアの定義 //
	//--------------------------------------------//
	var ckLabel;
	var textbox;
	var dv2;
	var img;
	var target;
	var bigmap;

	if( location.pathname != "/big_map.php" ){
		// 51x51画面ではない
		bigmap = 0;
		target = "datas";
	}
	else{
		// 51x51画面である
		bigmap = 1;
		target = "change-map-scale";
	}

	dv2 = d_18.createElement("div");
	dv2.style.position = "absolute";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "160px";
			dv2.style.left = "10px";
		}
		else{
			dv2.style.top = "132px";
			dv2.style.left = "10px";
		}
	}
	else{
		// 51x51画面である
		dv2.style.top = "60px";
		dv2.style.left = "20px";
	}
	dv2.style.fontSize= "10px";
	dv2.style.width = "120px";
	dv2.style.height = "20px";
	dv2.style.border = "1px black solid";
	dv2.style.backgroundColor = "#FFFFCC";
	dv2.style.zIndex = 500;
	$_18(target).parentNode.appendChild(dv2);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "<font color=\"blue\"><b>最小移動単位</b></font>";
	dv2.appendChild(ckLabel);

	// 1
	textbox = document.createElement("input");
	textbox.type = "input";
	textbox.id = "iMove1";
	textbox.style.fontSize= "10px";
	textbox.style.marginTop = "2px";
	textbox.style.marginLeft = "8px";
	textbox.style.width = "35px";
	textbox.style.height = "12px";
	textbox.value = basevalue;
	textbox.addEventListener("blur", function() {textChanged()}, true);
	dv2.appendChild(textbox);

	if( bigmap == 0 ){
		// 51x51画面ではない

		// 矢印アイコン（左）
		img = 'data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAABEAAAAeCAYAAADKO/UvAAAABnRSTlMAgACAAIDTzS+jAAAAjUlEQVR42sXV3Q2AIAwEYDuMkzlI'+
					'YRAncxiUGBJTKfQQ8F769iX8pEfOuaUlzBzi9N4TtSAJSIERCcBIDoAQDTAjT2Dd73lsAJIDIEQDzEgJMCE1oIpYgCJiBVQEAbII'+
					'CryQcAUFxiBdjtPtYlM+PzEKjf/2VmjeKqhBEKJBMCIhmbmVUYL+qVEJxUI/AUUVoq80rfXnAAAAAElFTkSuQmCC';
		dv2 = d_18.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.top = "265px";
		dv2.style.left = "20px";
		dv2.style.zIndex = 500;
		dv2.id = "icon_arrow_left";
		dv2.innerHTML = '<a href="#"><img src="' + img + '"></a>';
		$_18(target).parentNode.appendChild(dv2);

		// 矢印アイコン（右）
		img = 'data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAABEAAAAeCAYAAADKO/UvAAAABnRSTlMAgACAAIDTzS+jAAAAjElEQVR42sXV0Q2AIAwEUBjGyRwE'+
					'GMTJHAZN/FGk0LszsT8kfLwEKNeYcw4ppRrOKqXEQFSsZ903GOiFMFAXQSETQaAHsmzXuq8Y1EVQyEQQaIh4oSnigVzIDHIjIwhC'+
					'LAhGehCFtNB/iHwc+WLlJ5abTW57+QPKUSCHkhSPbVFBzQAmIg8vaox+MdAP+VTKF6cnH+gAAAAASUVORK5CYII=';
		dv2 = d_18.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.top = "265px";
		dv2.style.left = "720px";
		dv2.style.zIndex = 500;
		dv2.id = "icon_arrow_right";
		dv2.innerHTML = '<a href="#"><img src="' + img + '"></a>';
		$_18(target).parentNode.appendChild(dv2);

		// 矢印アイコン（下）
		img = 'data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAAB4AAAARCAYAAADKZhx3AAAABnRSTlMAgACAAIDTzS+jAAAAhklEQVR42sXQwRGAIAxEUSjGyiwE'+
					'KMTKLAaNMzqoAbIR8N9yepO13nvjnItmYCEEa+PeSPTsP5ibelraIut8v4+pCaZSvCdM6PXxWQ+cQ19wazyHsnArvIRm4a94DS3C'+
					'WlyCVmEUl6IiWIojqBiu4SgKwTlcg8LwE09DUBXM4SiqhlNcg1IbqGBwiqHWlxEAAAAASUVORK5CYII=';
		dv2 = d_18.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.top = "455px";
		dv2.style.left = "365px";
		dv2.style.zIndex = 500;
		dv2.id = "icon_arrow_bottom";
		dv2.innerHTML = '<a href="#"><img src="' + img + '"></a>';
		$_18(target).parentNode.appendChild(dv2);

		// 矢印アイコン（上）
		img = 'data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAAB4AAAARCAYAAADKZhx3AAAABnRSTlMAgACAAIDTzS+jAAAAiElEQVR42sXUwQ2AIAyFYTuMkzkI'+
					'ZRAncxgUTY0iQvuE+F96ar6khxIzD0jOuRCn956QfUJgQSUEN8MpiuIm+IqO8zGXCcPVcA6VEFwFl1AUr8IaFMGLsAW14q8wglrw'+
					'LPwF1eIPuAWqwW9wS7SGn3APtITvcPoGe8KCU9hqy+j6D86dunfx1CtJpXCK46EJ0QAAAABJRU5ErkJggg==';
		dv2 = d_18.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.top = "85px";
		dv2.style.left = "365px";
		dv2.style.zIndex = 500;
		dv2.id = "icon_arrow_top";
		dv2.innerHTML = '<a href="#"><img src="' + img + '"></a>';
		$_18(target).parentNode.appendChild(dv2);
	}

	// 起点に設定ボタン
	img = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAAEsAAAASCAYAAAATzyPVAAAABnRSTlMAAACAAP+ikfOcAAABaElEQVR42u2YTW7CMBCFHQkJrtVF'+
				'b4WUIPVWXXCtIiGZJtTJ2H7zJyOyqN8u47HxfJkZHA9hiqFUHENt/GcaLmGobBRWh1SLQlthlaCGj8ve+9xN8TpmzwnYAouCopDi'+
				'dfqzTQ0/3L4GtybV6fMcfr6/Kpuk5I/8bvdDBm0GlsFKoNBmOGkQuLXoPC/Q4+EuBo9glWPWuBKwBVb81eaQl54UhDVAi1/pI72s'+
				'2ceaWWjMmm0lrMWWYKEetRcsTSizKAxvOSLNZbjtb+RhtZahNr+c44XFZZYmaynOa5lhcUG0ZpPXzknKLA9ErcGbYHkz492wtJ4l'+
				'9SiLTxMsLrO04K2wvRms/Rt6YSHwL4OlBe+VF5bUsygAlDEvySwKjIPlCZzOpcEjEJKtFF1DKj0EwtPXEqzs6IBO8Cg4SZYy1YB5'+
				'JO0JwfHC2/YpnOATrK6nIKxloH9IrxI/pFenfkVTCV7RUHVo+PLvAaJdifjwNfADAAAAAElFTkSuQmCC';
	dv2 = d_18.createElement("div");
	dv2.style.position = "absolute";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "183px";
			dv2.style.left = "10px";
		}
		else{
			dv2.style.top = "155px";
			dv2.style.left = "10px";
		}
	}
	else{
		// 51x51画面である
		dv2.style.top = "60px";
		dv2.style.left = "160px";
	}
	dv2.style.zIndex = 500;
	dv2.id = "icon_base2";
	dv2.innerHTML = '<a href="#"><img src="' + img + '"></a>';
	dv2.addEventListener("click", function() {changeBasePos()}, true);
	$_18(target).parentNode.appendChild(dv2);

	dv2 = d_18.createElement("span");
	dv2.style.position = "absolute";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "184px";
			dv2.style.left = "90px";
		}
		else{
			dv2.style.top = "156px";
			dv2.style.left = "90px";
		}
	}
	else{
		// 51x51画面である
		dv2.style.top = "61px";
		dv2.style.left = "240px";
	}
	dv2.style.fontSize= "10px";
	dv2.style.border = "1px black solid";
	dv2.style.textAlign = "center";
	dv2.style.verticalAlign = "bottom";
	dv2.style.backgroundColor = "#FFFFCC";
	dv2.id = "txBasePos";
	dv2.style.width = "75px";
	dv2.style.height = "14px";
	var texta = "(" + basex + "," + basey + ")";
	texta = texta.replace(/ /g,"&nbsp;");
	dv2.innerHTML = texta;
	$_18(target).parentNode.appendChild(dv2);

	// 起点に戻るボタン
	img = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAAEsAAAASCAYAAAATzyPVAAAABnRSTlMAAACAAP+ikfOcAAABK0lEQVR42u2YURKDIAxE4Wg9mXoy'+
				'j0ZbWmwMCUmIjs6U/SuSsDyIRWKYU8BKU6gb/0xxCbFqg7AGpFoQ2gYLg4qP5Wqflymt0+53AZZhQVAQUlrnb9vsGNifo5VXq57x'+
				'IbQ3sB2sAspiRDLB5YJxZwH1eMLAMqz00q/zQialk+gmqOmH+7QWi4IsyTI2Byv3KbCod9RVsLSSJ+p7joGRsLxlKMXjGC+sIz02'+
				'S9Gys7y7ydquhXVUHN/u2Fl3hnVGaZpgcTtLmjwnCZZ1B2ukXYjDYfUa0RrsLXfOtxQvjV3BgsCsg3IGSiw0oC0daWEkwJZya813'+
				'd3SgTvCtRL0TkIBZRflqvQ60/4gsKHyCL7CGPiJh5QfjQ3pT80N66zSuaCqRVzRQAxp9+fcEj5tg+AMbz+MAAAAASUVORK5CYII=';
	dv2 = d_18.createElement("div");
	dv2.style.position = "absolute";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "203px";
			dv2.style.left = "10px";
		}
		else{
			dv2.style.top = "175px";
			dv2.style.left = "10px";
		}
	}
	else{
		// 51x51画面である
		dv2.style.top = "80px";
		dv2.style.left = "160px";
	}
	dv2.style.zIndex = 500;
	dv2.id = "icon_base";
	dv2.innerHTML = '<a href="#"><img src="' + img + '"></a>';
	$_18(target).parentNode.appendChild(dv2);

	// マップ中央までの距離
	dv2 = d_18.createElement("div");
	dv2.style.position = "absolute";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "226px";
			dv2.style.left = "10px";
		}
		else{
			dv2.style.top = "198px";
			dv2.style.left = "10px";
		}
	}
	else{
		// 51x51画面である
		dv2.style.top = "84px";
		dv2.style.left = "20px";
	}
	dv2.style.fontSize= "11px";
	$_18(target).parentNode.appendChild(dv2);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			ckLabel.innerHTML = "<font color=\"blue\"><b>起点からマップ中央まで</b></font>";
		}
		else{
			ckLabel.innerHTML = "<font color=\"blue\"><b>起点からマップ中央までの距離</b></font>";
		}
	}
	else{
		// 51x51画面である
		ckLabel.innerHTML = "<font color=\"blue\"><b>起点からマップ中央まで</b></font>";
	}
	dv2.appendChild(ckLabel);

	dv2 = d_18.createElement("div");
	dv2.style.position = "absolute";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "242px";
			dv2.style.left = "10px";
		}
		else{
			dv2.style.top = "210px";
			dv2.style.left = "10px";
		}
	}
	else{
		// 51x51画面である
		dv2.style.top = "96px";
		dv2.style.left = "20px";
	}
	dv2.style.fontSize= "11px";
	$_18(target).parentNode.appendChild(dv2);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.id = "lDistCenter";
	ckLabel.innerHTML = "<font color=\"blue\"><b>0.00</b></font>";
	dv2.appendChild(ckLabel);
}

//----------------------//
// テキスト変更イベント //
//----------------------//
function textChanged(){
	//----------------------//
	// 保存された値をロード //
	//----------------------//
	var execflag = loadExecFlag_18(location.hostname, "MOVE");
	var basevalue = new String("1");  // 初期値
	if( execflag == "" ){
		basevalue = 1;
	}
	else{
		basevalue = execflag;
	}

	var text = $e_18('//*[@id="iMove1"]');
	var inp;
	var movesize;

	inp = text.snapshotItem(0).value;
	movesize = parseInt(inp);
	if( (inp == "0") || (inp == "1/2") || (inp == "1/3") || (inp == "1/4") || (inp == "1/5") ){
		//--------------//
		// 変更値を保存 //
		//--------------//
		saveExecFlag_18(location.hostname, "MOVE", inp);

		//------------//
		// 画面を更新 //
		//------------//
		updateHtml();
	}
	else if( isNaN(parseInt(text.snapshotItem(0).value)) || movesize <= 0 ){
		// 数値化できない、または0以下がいれられたら元の値にする
		movesize = basevalue;
		text.snapshotItem(0).value = movesize;
	}
	else{
		//--------------//
		// 変更値を保存 //
		//--------------//
		saveExecFlag_18(location.hostname, "MOVE", movesize);
		text.snapshotItem(0).value = movesize;

		//------------//
		// 画面を更新 //
		//------------//
		updateHtml();
	}
}

//------------//
// HTMLの更新 //
//------------//
function updateHtml() {
	//------------------//
	// 画面サイズの取得 //
	//------------------//
	var viewSize;
	viewSize = getViewSize_18();

	//----------------//
	// 移動単位の取得 //
	//----------------//
	var execflag;
	var movesize;
	var basepos;
	var basex;
	var basey;
	execflag = loadExecFlag_18(location.hostname, "MOVE");
	if( execflag == "" ){
		movesize = 1;
	}
	else{
		if( execflag == "0" ){
			if( viewSize == 11 ){
				movesize = 11;
			}
			else if( viewSize == 15 ){
				movesize = 15;
			}
			else if( viewSize == 51 ){
				movesize = 51;
			}
			else{
				movesize = 20;
			}
		}
		else if( execflag == "1/2" ){
			if( viewSize == 11 ){
				movesize = 5;
			}
			else if( viewSize == 15 ){
				movesize = 7;
			}
			else if( viewSize == 50 ){
				movesize = 25;
			}
			else{
				movesize = 9;
			}
		}
		else if( execflag == "1/3" ){
			if( viewSize == 11 ){
				movesize = 4;
			}
			else if( viewSize == 15 ){
				movesize = 5;
			}
			else if( viewSize == 51 ){
				movesize = 16;
			}
			else{
				movesize = 7;
			}
		}
		else if( execflag == "1/4" ){
			if( viewSize == 11 ){
				movesize = 3;
			}
			else if( viewSize == 15 ){
				movesize = 4;
			}
			else if( viewSize == 51 ){
				movesize = 12;
			}
			else{
				movesize = 5;
			}
		}
		else if( execflag == "1/5" ){
			if( viewSize == 11 ){
				movesize = 2;
			}
			else if( viewSize == 15 ){
				movesize = 3;
			}
			else if( viewSize == 51 ){
				movesize = 10;
			}
			else{
				movesize = 4;
			}
		}
		else{
			movesize = parseInt(execflag);
		}
	}

	//------------------//
	// ベース位置の取得 //
	//------------------//
	execflag = loadExecFlag_18(location.hostname, "BASEPOS");
	basepos = new String(BASE);  // 初期値
	if( execflag == "" ){
		basepos = BASE;
	}
	else{
		basepos = execflag;
	}
	basex = basepos.substr(0,4);
	basey = basepos.substr(4,4);

	//--------------------------------------------//
	// 全体表示画面から、画面中央座標を手に入れる //
	//--------------------------------------------//
	var codx;
	var cody;
	var x;
	var y;
	var bigmap;
	if( location.pathname != "/big_map.php" ){
		// 51x51画面ではない
		codx = $e_18('//div[@id="datas"]/input[@id=\"x\"]');
		cody = $e_18('//div[@id="datas"]/input[@id=\"y\"]');

		x = codx.snapshotItem(0).value;
		y = cody.snapshotItem(0).value;

		bigmap = 0;
	}
	else{
		// 51x51画面である
		var li = $e_18('//*[@id="map51-content"]//li');
		var dt = li.snapshotItem(1300).innerHTML;
		pos = dt.match(/.*x=([-]*\d+)&amp;y=([-]*\d+)#.*/);

		x = pos[1];
		y = pos[2];

		bigmap = 1;
	}

	//------------------------------------------//
	// 画面小移動アイコンを５マス移動に変更する //
	//------------------------------------------//
	// 座標を取得して、補正＆再設定する形で実装する
	{
		var arrow_img = new Array();
		// 右上
		arrow_img[0] = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAACEAAAAUCAYAAAADU1RxAAAABnRSTlMAAACAAIBiK58xAAAAqElEQVR42mNkaGhg+F9f/59hAABj'+
				'YyMjmP4PBAPhABTHDEpHRG1lYDj9gjaWmUpA6GXeaI7AlibmX2FgaDtJW9/fTibgCHo4ZikwNMwkkBwBAvhyCC0cg9URMEAvx+B1'+
				'BL0cQ5QjaO0YkhxBK8eQ5QhqO4YiR1DLMVRxBKWOoaojyHUMTRxBimNAdQhy/UF1RxDjGHRAM0eQ4hiaOwKfY+AtK3o5Ah8AAJN5'+
				'gtGmVHygAAAAAElFTkSuQmCC';
		// 右下
		arrow_img[1] = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAACEAAAAUCAYAAAADU1RxAAAABnRSTlMAAACAAIBiK58xAAAAp0lEQVR42mNkaGhgGGjASC9H/K+v'+
				'/49heWMjI10cgc1yuoUEMZbTzBH4LJ9/hYGh7SQDg6kEA8Mybxo4ghjLkcFSoCPMJKjkCFItp6ojyLWcKo6g1HKKHEEty8lyBLUt'+
				'J8kRtLKcKEfQ2nK8jqCX5TgdgcsBtLCcaEfQ0nIYuJ2MYDP+BwJkyaitDAynX9DGYlOoz5HrDayOGAgwOByBL2HS3HJoywoACHaC'+
				'0ZpxWZMAAAAASUVORK5CYII=';
		// 左下
		arrow_img[2] = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAACEAAAAUCAYAAAADU1RxAAAABnRSTlMAAACAAIBiK58xAAAArElEQVR42mNkaGhgGGjACHPE//r6'+
				'/xiSjY2MdHHEfyAgqIjGjiHKEbR2DIojorYyMJx+wcBQZc7AkKhDP8fAHXEKaHn0VlRJejkGryPo5RiiHEFrx5DkCFo5hixHUNsx'+
				'FDmCWo6hiiModQxVHUGuY2jiCFIdQ1NHEOMYkENQim3VubRxBD7HYDgCBKKgoQGqQ2gBTCUYGJZ5ozmElFqUVmBwOAJfy4ouDgCm'+
				'CQAiII8JcKepBgAAAABJRU5ErkJggg==';
		// 左上
		arrow_img[3] = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAACEAAAAUCAYAAAADU1RxAAAABnRSTlMAAACAAIBiK58xAAAAqElEQVR42mNkaGhgAIH/9fX/GQYA'+
				'MDY2MjL+B4KBsBzFIYPSEVFbIfTpF7Sx0FSCgWGZNx5HqM6lrY+rzBkYEnXQHICcJk4BfR69lX6W080R+CyHOQBM08IRxFoO51PT'+
				'EaRaTlVHkGs5VRxBqeUUOYJalpPlCGpbTpIjaGU5UY6gteUYjgABUL0BqjPoZTlWRxBUTGXLSXIErSyHm4+vZUVryzEcMZAAAHdt'+
				'jwkxygB9AAAAAElFTkSuQmCC';

		var alist = $e_18('//*[@class="fade"]');
		var dv;
		var cx;
		var cy;
		var varpos;
		var classname;
		var hrefText;

		// 画面上にある矢印アイコンの数によりチェック数がかわる（先頭４つは右下の画面切り替え用）
		if( bigmap == 0 ){
			for( var i = 0; i < alist.snapshotLength-4; i++ ){
				varpos = i + 4;
				classname = alist.snapshotItem(varpos).getAttribute("src");
        
				if( classname.indexOf("double_cur") == -1 ){
					if( (classname.indexOf("cur01.gif") != -1) || (classname == arrow_img[0]) ){
						// 右上（Ｙ軸＋）
                
						// 座標値の補正
						cx = x;
						cy = y;
						if( parseInt(cy) + parseInt(movesize) > 600 ){
							cy = 600;
						}
						else{
							cy = parseInt(cy) + parseInt(movesize);
						}
                
						// 値を書き換える
						hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
						alist.snapshotItem(varpos).parentNode.setAttribute("href",hrefText);
						alist.snapshotItem(varpos).setAttribute("src",arrow_img[0]);
					}
					else if( (classname.indexOf("cur02.gif") != -1) || (classname == arrow_img[1]) ){
						// 右下（Ｘ軸＋）
                
						// 座標値の補正
						cx = x;
						cy = y;
						if( parseInt(cx) + parseInt(movesize) > 600 ){
							cx = 600;
						}
						else{
							cx = parseInt(cx) + parseInt(movesize);
						}
						// 値を書き換える
						hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
						alist.snapshotItem(varpos).parentNode.setAttribute("href",hrefText);
						alist.snapshotItem(varpos).setAttribute("src",arrow_img[1]);
					}
					else if( (classname.indexOf("cur03.gif") != -1) || (classname == arrow_img[2]) ){
						// 左下（Ｙ軸－）
                
						// 座標値の補正
						cx = x;
						cy = y;
						if( parseInt(cy) - parseInt(movesize) < -600 ){
							cy = -600;
						}
						else{
							cy = parseInt(cy) - parseInt(movesize);
						}
						// 値を書き換える
						hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
						alist.snapshotItem(varpos).parentNode.setAttribute("href",hrefText);
						alist.snapshotItem(varpos).setAttribute("src",arrow_img[2]);
					}
					else{
						// 左上（Ｘ軸－）
                
						// 座標値の補正
						cx = x;
						cy = y;
						if( parseInt(cx) - parseInt(movesize) < -600 ){
							cx = -600;
						}
						else{
							cx = parseInt(cx) - parseInt(movesize);
						}
						// 値を書き換える
						hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
						alist.snapshotItem(varpos).parentNode.setAttribute("href",hrefText);
						alist.snapshotItem(varpos).setAttribute("src",arrow_img[3]);
					}
				}
			}
		}

		//------------------------//
		// 上下左右アイコンの補正 //
		//------------------------//
		if( bigmap == 0 ){
			var aicon;
			var dflag;

			//-- 左 --//
			dflag = 0;
			aicon = $e_18('//*[@id="icon_arrow_left"]');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) - parseInt(movesize) < -600 ){
				cx = -600;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) - parseInt(movesize);
			}
			if( parseInt(cy) - parseInt(movesize) < -600 ){
				cy = -600;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) - parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).firstChild.setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}

			//-- 右 --//
			dflag = 0;
			aicon = $e_18('//*[@id="icon_arrow_right"]');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) + parseInt(movesize) > 600 ){
				cx = 600;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) + parseInt(movesize);
			}
			if( parseInt(cy) + parseInt(movesize) > 600 ){
				cy = 600;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) + parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).firstChild.setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}

			//-- 下 --//
			dflag = 0;
			aicon = $e_18('//*[@id="icon_arrow_bottom"]');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) + parseInt(movesize) > 600 ){
				cx = 600;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) + parseInt(movesize);
			}
			if( parseInt(cy) - parseInt(movesize) < -600 ){
				cy = -600;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) - parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).firstChild.setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}

			//-- 上 --//
			dflag = 0;
			aicon = $e_18('//*[@id="icon_arrow_top"]');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) - parseInt(movesize) < -600 ){
				cx = -600;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) - parseInt(movesize);
			}
			if( parseInt(cy) + parseInt(movesize) > 600 ){
				cy = 600;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) + parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).firstChild.setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}
		}
		else{
			// 51x51マップ
			var aicon;
			var dflag;

			//-- 左 --//
			dflag = 0;
			aicon = $e_18('//*[@id="single-allow-west"]/a');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) - parseInt(movesize) < -600 ){
				cx = -600;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) - parseInt(movesize);
			}
			if( parseInt(cy) - parseInt(movesize) < -600 ){
				cy = -600;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) - parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "big_map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}

			//-- 右 --//
			dflag = 0;
			aicon = $e_18('//*[@id="single-allow-east"]/a');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) + parseInt(movesize) > 600 ){
				cx = 600;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) + parseInt(movesize);
			}
			if( parseInt(cy) + parseInt(movesize) > 600 ){
				cy = 600;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) + parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "big_map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}

			//-- 下 --//
			dflag = 0;
			aicon = $e_18('//*[@id="single-allow-south"]/a');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) + parseInt(movesize) > 600 ){
				cx = 600;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) + parseInt(movesize);
			}
			if( parseInt(cy) - parseInt(movesize) < -600 ){
				cy = -600;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) - parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "big_map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}

			//-- 上 --//
			dflag = 0;
			aicon = $e_18('//*[@id="single-allow-north"]/a');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) - parseInt(movesize) < -600 ){
				cx = -600;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) - parseInt(movesize);
			}
			if( parseInt(cy) + parseInt(movesize) > 600 ){
				cy = 600;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) + parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "big_map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}
		}

		//----------------------------//
		// 起点に戻るボタンの書き換え //
		//----------------------------//
		// 拠点座標取得
		aicon = $e_18('//*[@id="icon_base"]');
		hrefText = "map.php?x=" + parseInt(basex) + "&y=" + parseInt(basey);
		aicon.snapshotItem(0).firstChild.setAttribute("href",hrefText);

		//----------------//
		// 距離の書き換え //
		//----------------//
		var dx;
		var dy;
		dx = parseInt(basex) - parseInt(x);
		dy = parseInt(basey) - parseInt(y);
		var distance = Math.round(Math.sqrt(Math.pow(parseInt(dx),2) + Math.pow(parseInt(dy),2)) * 100) / 100;
		aicon = $e_18('//*[@id="lDistCenter"]');
		aicon.snapshotItem(0).innerHTML = "<font color=\"blue\"><b>" + roundx(distance,2) + "</b></font>";
	}


}

// 書式整形：他サイトのソースを引用
function roundx(num, n) {
	var str = new String();
	var z = "";
	str = new String(num);
	for (i = 0; i < n; i++) z = z + "0";
	if (str.indexOf(".") < 0) return str + "." + z;
	str = str + z;
	return str.split(".")[0] + "." + str.split(".")[1].substring(0, n);
}


//--------------//
// データロード //
//--------------//
function loadExecFlag_18(hostname, key) {
	var datakey = new String();
	datakey = hostname + VERSION_KEY_18 + key;

	var ret = new String();
	var src = CookieRead_18(datakey);
	if (src == "") return ret;

	return src;
}

//--------------//
// データセーブ //
//--------------//
function saveExecFlag_18(hostname, key, data) {

	var datakey = new String();
	datakey = hostname + VERSION_KEY_18 + key;

	CookieWrite_18(datakey, data, 30);
}

//----------------------//
// クッキーへの書き込み //
//----------------------//
function CookieWrite_18(kword, kdata, kday)
{
	if(!navigator.cookieEnabled){    // クッキーが利用可能かどうか
		alert("クッキーへの書き込みができません");
		return;
	}

	sday = new Date();
	sday.setTime(sday.getTime() + (kday * 1000 * 60 * 60 * 24));
	s2day = sday.toGMTString();
	document.cookie = kword + "=" + escape(kdata) + ";expires=" + s2day;
}

//----------------------//
// クッキーから読み込み //
//----------------------//
function CookieRead_18(kword)
{
	if(typeof(kword) == "undefined"){	// キーワードなし
		return "";	// 何もしないで戻る
	}

	kword = kword + "=";
	kdata = "";
	scookie = document.cookie + ";";	// クッキー情報を読み込む
	start = scookie.indexOf(kword);		// キーワードを検索
	if (start != -1){
		// キーワードと一致するものあり
		end = scookie.indexOf(";", start);	// 情報の末尾位置を検索
		kdata = unescape(scookie.substring(start + kword.length, end));	// データ取り出し
	}

	return kdata;
}

//----------------//
// 起点座標の変更 //
//----------------//
function changeBasePos()
{
	//--------------------------------------------//
	// 全体表示画面から、画面中央座標を手に入れる //
	//--------------------------------------------//
	var codx;
	var cody;
	var x;
	var y;
	if( location.pathname != "/big_map.php" ){
		// 51x51画面ではない
		codx = $e_18('//div[@id="datas"]/input[@id=\"x\"]');
		cody = $e_18('//div[@id="datas"]/input[@id=\"y\"]');

		x = codx.snapshotItem(0).value;
		y = cody.snapshotItem(0).value;
	}
	else{
		// 51x51画面である
		var li = $e_18('//*[@id="map51-content"]//li');
		var dt = li.snapshotItem(1300).innerHTML;
		pos = dt.match(/.*x=([-]*\d+)&amp;y=([-]*\d+)#.*/);

		x = pos[1];
		y = pos[2];
	}

	// 表示更新
	var dv2 = $e_18('//*[@id="txBasePos"]');
	var texta = "(" + formatRightNumber_18(parseInt(x),4) + "," + formatRightNumber_18(parseInt(y),4) + ")";
	var textb = texta;
	texta = texta.replace(/ /g,"&nbsp;");
	dv2.snapshotItem(0).innerHTML = texta;

	//----------------------------//
	// 起点に戻るボタンの書き換え //
	//----------------------------//
	// 拠点座標取得
	var aicon = $e_18('//*[@id="icon_base"]');
	var hrefText = "map.php?x=" + parseInt(x) + "&y=" + parseInt(y);
	aicon.snapshotItem(0).firstChild.setAttribute("href",hrefText);

	//----------------//
	// 距離の書き換え //
	//----------------//
	aicon = $e_18('//*[@id="lDistCenter"]');
	aicon.snapshotItem(0).innerHTML = "<font color=\"blue\"><b>0.00</b></font>";

	//--------------//
	// クッキー更新 //
	//--------------//
	var savedata;
	savedata = formatRightNumber_18(parseInt(x),4) + formatRightNumber_18(parseInt(y),4);

	saveExecFlag_18(location.hostname, "BASEPOS", savedata);
}

//----------//
// 桁数整形 //
//----------//
function formatRightNumber_18( num, length ){
	var fix = '      ';
	var str;
	var result = '';

	str = num.toString(10);
	if( str.length < length ){
		result = fix.substr(0,length - str.length) + str;
	}
	else{
		result = str;
	}

	return result;
}


//------------------//
// 画面サイズの取得 //
//------------------//
function getViewSize_18()
{
	var viewSize;

	if( $x_18("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort15 now\"]") ){
		viewSize = 15;	// 15x15
	}
	else if( $x_18("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort20 now\"]") ){
		viewSize = 20;	// 20x20
	}
	else if( $x_18("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort15 now\"]") ){
		viewSize = 15;	// 15x15
	}
	else if( $x_18("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort20 now\"]") ){
		viewSize = 20;	// 20x20
	}
	else if( $x_18("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort51 now\"]") ){
		viewSize = 51;	// 51x51
	}
	else{
		viewSize = 11;	// 11x11
	}

	return viewSize;
}

//faraway 18.全体マップ移動距離カスタムツールのソース(bro3_change_move_size.user.js)終了

//faraway 19.都市画面内政武将表示ツール(βバージョン)のソース(bro3_display_adm_info.user.js)開始
//================================================================================
//19.都市画面内政武将表示ツール(βバージョン)
//================================================================================
// ==UserScript==
// @name           bro3_display_adm_info
// @namespace      http://homepage3.nifty.com/Craford
// @include        http://*.3gokushi.jp/card/*
// @include        http://*.3gokushi.jp/village.php*
// @include        http://*.1kibaku.jp/card/*
// @include        http://*.1kibaku.jp/village.php*
// @description    ブラウザ三国志都市内政武将表示
// @version        1.02
// ==/UserScript==
// version   date       author
// verβ1.00 2010.12.27 ドワクエ Craford（旧クラフト＋) β版着手
// verβ1.01 2010.12.28 ドワクエ Craford（旧クラフト＋) スキル切れ時、および内政武将交代時の処理に不備があったため修正
// verβ1.02 2010.12.29 ドワクエ Craford（旧クラフト＋) 内政武将存在時クリックで内政画面、なしのときデッキ画面に飛べる機能を追加
// verβ1.03 2010.12.29 ドワクエ Craford（旧クラフト＋) include指定を*から実行phpに変更。
// verβ1.04 2010.12.30 ドワクエ Craford（旧クラフト＋) 内政使用中に武将ソートをかけるとおかしくなる不具合を修正。
// verβ1.05 2010.12.30 ドワクエ Craford（旧クラフト＋) スキル終了時に都市画面のスキル終了時間が「なし」に表示が変わるように修正。
// verβ1.06 2010.12.30 ドワクエ Craford（旧クラフト＋) 討伐ゲージを武将アイコンの下に表示。
// verβ1.07 2010.12.30 ドワクエ Craford（旧クラフト＋) デッキ確認からの討伐ゲージ差分計算を行うよう修正。ゲージをグラフから数字に変更。
// ver  1.00 2011.01.25 ドワクエ Craford（旧クラフト＋) 諸処の問題を解消。タイムアウト発生の要因を排除。
// ver  1.01 2011.01.25 ドワクエ Craford（旧クラフト＋) 討伐ゲージを復活。数字の下に画像バー配置。古いデータの処理のミス修正。
// ver  1.02 2011.02.09 ドワクエ Craford（旧クラフト＋) デッキ参照時のデータ更新ミスを修正（ご指摘感謝！）

//faraway 19.都市画面内政武将表示ツール(βバージョン)変数宣言移動前の場所

//----------------//
// メインルーチン //
//----------------//
function disp_display_adm_info()
{
//	window.alert("19.:" + location.pathname);	//faraway
//faraway(function(){
	// デッキ画面なら使用中内政官を取得
	if (location.pathname == "/card/deck.php") {

		//結果取得
		getDeckInfo();
	}
	// デッキ設定画面なら使用中内政官を取得
	else if (location.pathname == "/card/domestic_setting.php") {

		//結果取得
		getDeckInfo2();
	}
	// 都市画面なら設定情報を表示
	else if (location.pathname == "/village.php") {

		//HTML追加
		addHtml_19();
	}

//faraway})();
}	//faraway

//------------------//
// 内政武将情報取得 //
//------------------//
function getDeckInfo() {
	var w_vname = new Array();
	var w_fname = new Array();
	var w_rare = new Array();
	var w_gage = new Array();
	var w_skill = new Array();
	var w_limit = new Array();

	// データ保持変数初期化
	for( var i = 0; i < 10; i++ ){
		w_vname[i] = "";
		w_fname[i] = "";
		w_rare[i] = "";
		w_gage[i] = "";
		w_skill[i] = "";
		w_limit[i] = "";
		vname[i] = "";
		fname[i] = "";
		rare[i] = "";
		gage[i] = "";
		skill[i] = "";
		limit[i] = "";
	}

	//------------------------//
	// Cookie保存データの取得 //
	//------------------------//
	var loaddata = loadExecFlag_19(location.hostname, "GENE");
	if( loaddata != "" && loaddata != "undefined" ){
		// ロードデータの個別データへの分割
		splitLoadData(loaddata);
	}

	//------------------//
	// サーバ時間の取得 //
	//------------------//
	getServerTime();

	//------------------------------------------//
	// デッキ画面から、内政武将情報を手に入れる //
	//------------------------------------------//
	var p1;
	var p2;
	var p3;
	var s1;
	var text;
	var ct;

	// データ
	var data = document.evaluate('//div[@id="cardListDeck"]//div[@class="cardColmn"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	ct = 0;
	for( var i = 0; i < data.snapshotLength; i++ ){
		text = data.snapshotItem(i).innerHTML;
		if( text.indexOf("内政セット済") != -1){
			
			if( text.indexOf("card rarerity_ur") != -1 ){
				w_rare[ct] = "ur";
			}
			else if( text.indexOf("card rarerity_sr") != -1 ){
				w_rare[ct] = "sr";
			}
			else if( text.indexOf("card rarerity_r") != -1 ){
				w_rare[ct] = "r";
			}
			else if( text.indexOf("card rarerity_uc") != -1 ){
				w_rare[ct] = "uc";
			}
			else if( text.indexOf("card rarerity_c") != -1 ){
				w_rare[ct] = "c";
			}

			// 画像ファイル名
			p1 = text.indexOf("<img src=");
			p2 = text.indexOf(".png");
			w_fname[ct] = text.substr(p1+10,p2-p1-6);

			// 拠点名
			p1 = text.indexOf("village_id=");
			s1 = text.substr(p1);
			p2 = s1.indexOf("\">");
			p3 = s1.indexOf("<");
			w_vname[ct] = s1.substr(p2+2,p3-p2-2);

			// 討伐ゲージ
			p1 = text.indexOf("class=\"para");
			s1 = text.substr(p1);
			p2 = s1.indexOf("\">");
			p3 = s1.indexOf("<");
			w_gage[ct] = s1.substr(p2+2,p3-p2-2);

			ct = ct + 1;
		}
	}

	// 保存情報と拠点名が一致するものについて、ファイル名、レアリティを書き換える
	for( var i = 0; i < 10; i++ ){
		if( vname[i] == "" ){
			continue;
		}
		for( var j = 0; j < ct; j++ ){
			if( w_vname[j] == vname[i] ){
				fname[i] = w_fname[j];	// ファイル名
				rare[i] = w_rare[j];	// レアリティ
				gage[i] = w_gage[j];	// 討伐ゲージ
			}
		}
	}

	// 保存データ内に、画面内にある拠点名が存在しない場合は、保存データを消去
	for( var i = 0; i < 10; i++ ){
		if( vname[i] == "" ){
			continue;
		}

		var found = 0;
		for( var j = 0; j < ct; j++ ){
			if( w_vname[j] == vname[i] ){
				found = 1;
				break;
			}
		}

		if( found == 0 ){
			// データをクリア
			vname[i] = "";	// 拠点名
			fname[i] = "";	// ファイル名
			rare[i] = "";	// レアリティ
			skill[i] = "";	// スキル名
			limit[i] = "";	// 終了時間
			gage[i] = "";	// 討伐ゲージ
		}
	}

	// 画面内にある拠点名が登録されていない場合は、新規登録
	for( var i = 0; i < ct; i++ ){
		if( w_vname[i] == "" ){
			break;
		}

		var found = 0;
		for( var j = 0; j < 10; j++ ){
			if( w_vname[i] == vname[j] ){
				found = 1;
			}
		}

		if( found == 0 ){
			for( var j = 0; j < 10; j++ ){
				if( vname[j] == "" ){
					// データを保存
					vname[j] = w_vname[i];	// 拠点名
					fname[j] = w_fname[i];	// ファイル名
					rare[j] = w_rare[i];	// レアリティ
					skill[j] = "";		// スキル名
					limit[j] = "";		// 終了時間
					gage[j] = w_gage[i];	// 討伐ゲージ
					break;
				}
			}
		}
	}

	//--------------//
	// データの保存 //
	//--------------//
	// セーブデータの作成
	var savedata = makeSaveData(vname,fname,rare,gage,skill,limit);
	// データの保存
	saveExecFlag_19(location.hostname, "GENE", savedata);	// 保存データ
}

//----------------------------//
// 内政武将情報取得(内政画面) //
//----------------------------//
function getDeckInfo2() {
	//------------------------//
	// Cookie保存データの取得 //
	//------------------------//
	var loaddata = loadExecFlag_19(location.hostname, "GENE");
	if( loaddata != "" && loaddata != "undefined" ){
		// ロードデータの個別データへの分割
		splitLoadData(loaddata);
	}

	//--------------------//
	// サーバー時間の取得 //
	//--------------------//
	getServerTime();

	//----------------------------------------//
	// 内政画面から、内政武将情報を手に入れる //
	//----------------------------------------//
	var p1;
	var p2;
	var p3;
	var s1;
	var text;
	var ct;
	var cvillage;
	var data;
	var latetime;
	var w_rare;
	var w_fname;
	var w_gage;
	var w_skill;
	var w_limit;

	// チェックされているラジオボタンの拠点名を取得
	data = document.evaluate('//table[@class="commonTables w174"]//input[@checked]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	cvillage = trim_19(data.snapshotItem(0).nextSibling.textContent);

	// 内政設定済武将がいるかチェック
	data = document.evaluate('//form[@name="input_domestic"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if( data.snapshotLength == 0 ){
		// 内政武将がいる

		// 武将情報の取得
		data = document.evaluate('//div[@class="cardWrapper2col"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

		text = data.snapshotItem(0).innerHTML;
		if( text.indexOf("card rarerity_ur") != -1 ){
			w_rare = "ur";
		}
		else if( text.indexOf("card rarerity_sr") != -1 ){
			w_rare = "sr";
		}
		else if( text.indexOf("card rarerity_r") != -1 ){
			w_rare = "r";
		}
		else if( text.indexOf("card rarerity_uc") != -1 ){
			w_rare = "uc";
		}
		else if( text.indexOf("card rarerity_c") != -1 ){
			w_rare = "c";
		}

		// 画像ファイル名
		p1 = text.indexOf("<img src=");
		p2 = text.indexOf(".png");
		w_fname = text.substr(p1+10,p2-p1-6);

		// 討伐ゲージ
		data = document.evaluate('//table[@class="commonTables"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		text = data.snapshotItem(0).innerHTML;
		p1 = text.indexOf("討:");
		s1 = text.substr(p1);
		p2 = s1.indexOf("</td>");
		w_gage = parseInt(trim_19(s1.substr(2,3)));

		var day = servertime.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
		var now = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

		// 使用中スキルの取得
		data = document.evaluate('//table[@class="general"]//td[@class="status"]/span[@id="area_timer0"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		if( data.snapshotLength >= 1 ){
			// area_timer0がいれば、使用中スキルがある

			// 残時間
			latetime = data.snapshotItem(0).textContent;
			var time = latetime.match(/(\d+):(\d+):(\d+)/);
			// リミットを求める
			now.setHours( now.getHours() + parseInt(time[1],10) );
			now.setMinutes( now.getMinutes() + parseInt(time[2],10) );
			now.setSeconds( now.getSeconds() + parseInt(time[3],10) );

			// 終了時刻
			w_limit = formatRightNumber_19(now.getFullYear(), 4) + "-" +
				formatRightNumber_19(now.getMonth()+1, 2) + "-" +
				formatRightNumber_19(now.getDate(), 2) + " " +
				formatRightNumber_19(now.getHours(), 2) + ":" +
				formatRightNumber_19(now.getMinutes(), 2) + ":" +
				formatRightNumber_19(now.getSeconds(), 2);

			// スキル名
			data = document.evaluate('//table[@class="general"]//a[@class="thickbox"]',
				document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			w_skill = data.snapshotItem(2).textContent;
		}
		else{
			// スキル切れか未使用
			w_limit = "";
			w_skill = "";
		}

		// 内政武将データの更新
		var found;
		found = false;
		var maxpos = 0;
		for( var i = 0; i < 10; i++ ){
			if( vname[i] == "" ){
				maxpos = i;
				break;
			}
			if( vname[i] == cvillage ){
				// 一致した
				found = true;

				// データの更新
				fname[i] = w_fname;	// ファイル名
				rare[i] = w_rare;	// レアリティ
				skill[i] = w_skill;	// スキル名
				limit[i] = w_limit;	// 終了時間
				gage[i] = w_gage;	// 討伐ゲージ

				break;
			}
		}

		if( found == false ){
			// 内政設定されていない拠点だった

			// 取得データを保存
			vname[maxpos] = cvillage;	// 拠点名
			fname[maxpos] = w_fname;	// ファイル名
			rare[maxpos] = w_rare;		// レアリティ
			skill[maxpos] = w_skill;	// スキル名
			limit[maxpos] = w_limit;	// 終了時間
			gage[maxpos] = w_gage;		// 討伐ゲージ
		}
	}
	else{
		// 内政武将がいなくなったかそもそもいない

		// 内政武将データの更新
		var w_vname;;
		found = false;
		for( var i = 0; i < 10; i++ ){
			if( vname[i] == "" ){
				break;
			}
			if( vname[i] == cvillage ){
				// 一致した
				maxpos = i;

				// データをクリア
				vname[maxpos] = "";	// 拠点名
				fname[maxpos] = "";	// ファイル名
				rare[maxpos] = "";	// レアリティ
				skill[maxpos] = "";	// スキル名
				limit[maxpos] = "";	// 終了時間
				gage[maxpos] = "";	// 討伐ゲージ
				break;
			}
		}

	}

	//--------------//
	// データの保存 //
	//--------------//
	// セーブデータの作成
	var savedata = makeSaveData(vname,fname,rare,gage,skill,limit);
	// データの保存
	saveExecFlag_19(location.hostname, "GENE", savedata);	// 保存データ
}

//------------//
// HTMLの生成 //
//------------//
function addHtml_19() {
	//----------------//
	// コンテナの取得 //
	//----------------//
	var container;
	var mapbox = $e_19('//*[@id="mapboxInner"]');
	if (mapbox.snapshotLength == 0) {
		container = document.body;
	} else {
		container = mapbox.snapshotItem(0);
	}

	//----------------------//
	// 武将描画エリアの定義 //
	//----------------------//
	var textArea;

	// データ描画用
	var dv2 = d_19.createElement("div");
	dv2.style.fontSize= "10px";
	textArea = document.createElement("div");
	textArea.id = "generalView";
	textArea.style.width = "66px";
	textArea.style.height = "66px";
	textArea.innerHTML = "";
	textArea.style.color = "black";
	textArea.innerHTML = "";
	textArea.style.marginTop = '12px';
	dv2.appendChild(textArea);
	$_19("basepoint").appendChild(dv2);

	// データ描画用
	dv2 = d_19.createElement("div");
	dv2.style.fontSize= "10px";
	textArea = document.createElement("div");
	textArea.id = "generalView2";
	textArea.innerHTML = "";
	textArea.style.width = "140px";
	textArea.style.color = "black";
	textArea.style.backgroundColor = "white";
	textArea.innerHTML = "";
	textArea.style.marginLeft = '90px';
	textArea.style.marginTop = '-60px';
	dv2.appendChild(textArea);
	$_19("basepoint").appendChild(dv2);

	//------------------------//
	// 内政武将データのロード //
	//------------------------//
	for( var i = 0; i < 10; i++ ){
		vname[i] = "";
		fname[i] = "";
		rare[i] = "";
		skill[i] = "";
		limit[i] = "";
		gage[i] = "";
	}

	//------------------------//
	// Cookie保存データの取得 //
	//------------------------//
	var old_servertime = "";
	var loaddata = loadExecFlag_19(location.hostname, "GENE");
	if( loaddata != "" && loaddata != "undefined" ){
		// ロードデータの個別データへの分割
		splitLoadData(loaddata);
		old_servertime = servertime;
	}
	else{
		return;
	}

	//------------//
	// 拠点名取得 //
	//------------//
	// データ
	var data = document.evaluate('//div[@id="basepoint"]/span[@class="basename"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var pos;
	pos = -1;
	for( var i = 0; i < 10; i++ ){
		if( vname[i] == data.snapshotItem(0).textContent ){
			pos = i;
			break;
		}
	}

	//--------------//
	// 武将画像表示 //
	//--------------//
	if( pos >= 0 ){
		// サーバー時間の取得
		var data = document.evaluate('//span[@id="server_time"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var time_text = data.snapshotItem(0).textContent;

		day = time_text.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
		servertime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

		// 終了時間の取得
		day = old_servertime.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
		var divtime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

		// 討伐ゲージ増分の計算
		var divgage = Math.floor((servertime.getTime() - divtime.getTime()) / 216000);
		var dispgage = parseInt(gage[pos]) + parseInt(divgage);
		if( parseInt(dispgage) > 500 ){
			dispgage = 500;
		}

		// 画像
		var gView = $e_19('//*[@id="generalView"]');
		fname[pos] = fname[pos].replace(/illust/, "deck");
		var gagelen = Math.floor(85 * (parseInt(gage[pos])/500));
		gView.snapshotItem(0).innerHTML = '<div class="illustMini">' +
						  '<a href="/card/domestic_setting.php#ptop">' + 
						  /*'<img src="' + fname[pos] + '"/>' + 画像の大きさが鯖により違うのでサイズを指定したfaraway110530*/
						  '<img src="' + fname[pos] + '" width="85" height="120"/>' + 
						  '</a>' +
						  '</div>' +
						  '<table bgcolor="white" width="85px">' +
						  '<b><font color="black" style="margin-left:2px">討伐: </font><font color="blue">' + dispgage + '</font></b>' +
						  '<p><img src="' + gage_icon + '" style="position:absolute;clip:rect(auto ' + gagelen + 'px 6px auto);" />' +
						  '</table>';

		// スキル使用時間が切れていたら終了時間をクリア
		if( servertime > limit[pos] ){
			skill[pos] = "";
			limit[pos] = "";
		}

		// スキル表示
		var gView2 = $e_19('//*[@id="generalView2"]');
		var text;
		if( (skill[pos] != "") && (skill[pos] != "undefined") ){
			text = '<b>使用中スキル</b><br><b><font color="blue">' + skill[pos] + '<br>(' + limit[pos] + ')</font></b>';
		}
		else{
			text = '<b>使用中スキル</b><br><b><font color="red">なし</font></b>';
		}
		gView2.snapshotItem(0).innerHTML = text;

		// 終了時間があるばあい、サーバー時間との差分をタイムアウト時間に設定する
		if( limit[pos] != "" ){
			var data;
			var time_text;
			var day;
			var limittime;
			var waittime;

			// サーバー時間の取得
			day = time_text.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
			servertime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

			// 終了時間の取得
			time_text = limit[pos];
			day = time_text.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
			limittime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

			// 待ち時間の算出
			waittime = limittime.getTime() - servertime.getTime();

			//--------------------------------------------//
			// 完了時刻まで待ってスキル表示を「なし」する //
			//--------------------------------------------//
			window.setTimeout(function() {
				//------------------------//
				// Cookie保存データの取得 //
				//------------------------//
				var loaddata = loadExecFlag_19(location.hostname, "GENE");
				if( loaddata != "" && loaddata != "undefined" ){
					// ロードデータの個別データへの分割
					splitLoadData(loaddata);
				}

				//------------//
				// 拠点名取得 //
				//------------//
				// データ
				var data = document.evaluate('//div[@id="basepoint"]/span[@class="basename"]',
					document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
				var pos;
				pos = -1;
				for( var i = 0; i < 10; i++ ){
					if( vname[i] == data.snapshotItem(0).textContent ){
						pos = i;
						break;
					}
				}

				//------------//
				// スキル表示 //
				//------------//
				if( pos >= 0 ){	// 念のため拠点名マッチチェック
					// スキル表示
					var gView2 = $e_19('//*[@id="generalView2"]');
					var text;
					text = '<b>使用中スキル</b><br><b><font color="red">なし</font></b>';
					gView2.snapshotItem(0).innerHTML = text;
				}
			}, waittime);
		}

		//----------------------------------//
		// 討伐ゲージをインターバル処理する //
		//----------------------------------//
		window.setInterval(function() {
			//------------------//
			// ゲージ差分の計算 //
			//------------------//
			// サーバー時間の取得
			var data = document.evaluate('//span[@id="server_time"]',
				document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			var time_text = data.snapshotItem(0).textContent;

			day = time_text.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
			servertime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

			// 終了時間の取得
			day = old_servertime.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
			var divtime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

			// 討伐ゲージ増分の計算
			var divgage = Math.floor((servertime.getTime() - divtime.getTime()) / 216000);

			//------------------------//
			// Cookie保存データの取得 //
			//------------------------//
			var loaddata = loadExecFlag_19(location.hostname, "GENE");
			if( loaddata != "" && loaddata != "undefined" ){
				// ロードデータの個別データへの分割
				splitLoadData(loaddata);
			}

			//------------//
			// 拠点名取得 //
			//------------//
			// データ
			var data = document.evaluate('//div[@id="basepoint"]/span[@class="basename"]',
				document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			var pos;
			pos = -1;
			for( var i = 0; i < 10; i++ ){
				if( vname[i] == data.snapshotItem(0).textContent ){
					pos = i;
					break;
				}
			}

			//------------//
			// スキル表示 //
			//------------//
			if( pos >= 0 ){	// 念のため拠点名マッチチェック
				// 討伐ゲージ差分を加算した値を算出
				var dispgage = parseInt(gage[pos]) + parseInt(divgage);
				if( parseInt(dispgage) > 500 ){
					dispgage = 500;
				}

				// 画像
				var gView = $e_19('//*[@id="generalView"]');
				fname[pos] = fname[pos].replace(/illust/, "deck");
				var gagelen = Math.floor(85 * (dispgage/500));
				gView.snapshotItem(0).innerHTML = '<div class="illustMini">' +
								  '<a href="/card/domestic_setting.php#ptop">' + 
								  '<img src="' + fname[pos] + '"/>' + 
								  '</a>' +
								  '</div>' +
								  '<table bgcolor="white" width="85px">' +
								  '<b><font color="black" style="margin-left:2px">討伐: </font><font color="blue">' + dispgage + '</font></b>' +
								  '<p><img src="' + gage_icon + '" style="position:absolute;clip:rect(auto ' + gagelen + 'px 6px auto);" />' +
								  '</table>';
			}
		}, 216000);  // 216秒ごとに1回まわる
	}
	else{
		// 内政武将なし

		// 画像
		var gView = $e_19('//*[@id="generalView"]');
		gView.snapshotItem(0).innerHTML = '<div>' +
						  '<a href="/card/deck.php#ptop">' + 
						  '<img src="' + icon_m_19 + '"/>' + 
						  '</a>' +
						  '</div>';
	}
}

//----------------//
// サーバ時間取得 //
//----------------//
function getServerTime(){
	// デッキ参照時のサーバー時間の取得
	servertime_t = document.evaluate('//span[@id="server_time"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	servertime = servertime_t.snapshotItem(0).textContent;
}

//----------------//
// 保存データ分割 //
//----------------//
function splitLoadData(data){
	//----------------//
	// データの分割１ //
	//----------------//
	var d1 = data.split(DELIMIT1_19);
	servertime = d1[0];

	//----------------//
	// データの分割２ //
	//----------------//
	var ct = 0;
	for( var i = 1; i < d1.length; i++ ){
		var d2 = d1[i].split(DELIMIT2_19);
		vname[ct] = d2[0];
		fname[ct] = d2[1];
		rare[ct] = d2[2];
		gage[ct] = d2[3];
		skill[ct] = d2[4];
		limit[ct] = d2[5];

		ct = ct + 1;
	}

	return;
}

//----------------//
// 保存データ作成 //
//----------------//
function makeSaveData(vname,fname,rare,gage,skill,limit){
	var data;
	var data_d;

	data = "";

	// サーバ時間取得
	getServerTime();
	data = servertime;

	// 武将データ構築
	for( var i = 0; i < vname.length; i++ ){
		data_d = "";
		if( vname[i] != "" ){
			data_d = vname[i] + DELIMIT2_19 + fname[i] + DELIMIT2_19 + rare[i] + DELIMIT2_19 + gage[i] + DELIMIT2_19 + skill[i] + DELIMIT2_19 + limit[i];
			data = data + DELIMIT1_19 + data_d;
		}
	}

	// 作成した保存用データの返却
	return data;
}

//--------------//
// データロード //
//--------------//
function loadExecFlag_19(hostname, key) {
	var datakey = new String();
	datakey = hostname + VERSION_KEY_19 + key;
	var ret = new String();
	var src = CookieRead_19(datakey);
	if (src == "") return ret;

	return src;
}

//--------------//
// データセーブ //
//--------------//
function saveExecFlag_19(hostname, key, data) {

	var datakey = new String();
	datakey = hostname + VERSION_KEY_19 + key;

	CookieWrite_19(datakey, data, 30);
}

//----------------------//
// クッキーへの書き込み //
//----------------------//
function CookieWrite_19(kword, kdata, kday)
{
	if(!navigator.cookieEnabled){    // クッキーが利用可能かどうか
		alert("クッキーへの書き込みができません");
		return;
	}

	sday = new Date();
	sday.setTime(sday.getTime() + (kday * 1000 * 60 * 60 * 24));
	s2day = sday.toGMTString();
	document.cookie = kword + "=" + escape(kdata) + "; path=/;expires=" + s2day;
}

//----------------------//
// クッキーから読み込み //
//----------------------//
function CookieRead_19(kword)
{
	if(typeof(kword) == "undefined"){	// キーワードなし
		return "";	// 何もしないで戻る
	}

	kword = kword + "=";
	kdata = "";
	scookie = document.cookie + ";";	// クッキー情報を読み込む
	start = scookie.indexOf(kword);		// キーワードを検索
	if (start != -1){
		// キーワードと一致するものあり
		end = scookie.indexOf(";", start);	// 情報の末尾位置を検索
		kdata = unescape(scookie.substring(start + kword.length, end));	// データ取り出し
	}

	return kdata;
}

//----------//
// 空白除去 //
//----------//
function trim_19(str) {
	if (str == undefined) return "";
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
}

//----------//
// 桁数整形 //
//----------//
function formatRightNumber_19( num, length ){
	var fix = '000000';
	var str;
	var result = '';

	str = num.toString(10);
	if( str.length < length ){
		result = fix.substr(0,length - str.length) + str;
	}
	else{
		result = str;
	}

	return result;
}
//faraway 19.都市画面内政武将表示ツール(βバージョン)のソース(bro3_display_adm_info.user.js)終了

//faraway 20.書簡を4人以上の君主に送ることができるツールのソース(bro3_mass_shokan_tool.user.js)開始
//================================================================================
//20.書簡を4人以上の君主に送ることができるツール
//================================================================================
// ==UserScript==
// @name           bro3_mass_shokan_tool
// @namespace      puan
// @description    書簡を4人以上の君主に送ることができるツール
// @include        http://*.3gokushi.jp/message/new.php*
// @licence        まずは溥杏同盟内だけでの公開です。
// @version        1.0
// @author         "blank"
// ==/UserScript==

// 【スクリーンショット】
// 書簡作成画面 http://gyazo.com/0bd5607b57401f4adec2a4d25d52a28c.png
// 送信結果 http://gyazo.com/01ccfcbb816b495ee7b03014b032ea0f.png

// 【変更履歴】
// v1.0 公開

///////////////////////////////////////////////////////////////////////

//main
function disp_mass_shokan_tool()
{
	//window.alert("20.:" + location.pathname);	//faraway
//faraway(function(){
  // At user page
  if ( location.href.match(/.*\/message\/new\.php.*/) ) {
    process();
  }
//faraway})();
}	//faraway

//fires on user page
function process() {
  var table = document.getElementsByClassName("commonTables")[0];
  var div = document.createElement('div');
  div.align = 'center';
  div.innerHTML = '<a name="analysis"></a><input '
    +' value="&nbsp;複数宛に今すぐ送信&nbsp;"'
    +' type="button" id="mass_send"><span id="mass_send_help"> （←4人以上の君主に送るときはこちらをクリック！）</span>';

  // add button only once
  table.parentNode.appendChild(div);

  document.getElementById("mass_send").addEventListener("click",
    function() {
      var btn = document.getElementById("mass_send");
      btn.disabled = true;
      btn.value='送信中...';
      // trick to reflect change in UI
      setTimeout(function(){
        var to_obj = document.getElementById('to');
        var tos = to_obj.value.split(",");
        var table = document.getElementsByClassName("commonTables")[0];
        var subject_obj = table.getElementsByTagName('input')[1];
        var body_obj = table.getElementsByTagName('textarea')[0];
        var check_obj = document.getElementById('gray02Wrapper').getElementsByTagName('input')[4];
        sendMessages(tos,subject_obj.value,body_obj.value);
        document.getElementById('mass_send_help').innerHTML = '（送信が完了しました。<a href="/message/outbox.php#ptop">送信履歴</a>をご確認ください。）';
        var btn = document.getElementById("mass_send");
        btn.value='送信済み';
        to_obj.disabled = true;
        subject_obj.disabled = true;
        body_obj.disabled = true;
        check_obj.disabled = true;
      }, 10);
    },true);
}

function sendMessages(tos,subject_text,body_text) {
 for ( var i=0; i<tos.length; i++ ) {
   send_message(tos[i],subject_text,body_text);
 }
}

function send_message(to,subject_text,body_text) {
  var path = "/message/new.php";
  var param = {"to":to,"subject":subject_text,"body":body_text,"reply_flg":"","reply_message_id":"","btn_preview":"確認"};

  var request = new Ajax.Request( path, {
        method: "post",
        asynchronous: true,
        parameters: param, 
        onComplete:  send_message2,
    } );
}

function send_message2(request) {

	var RegRowgray		= new RegExp("");
	var RegRowformstart	= new RegExp("");
	var RegRowformend	= new RegExp("");
	var RegRowinput		= new RegExp("");
	var RegRowsubmit	= new RegExp("");
	var RegRowinputbodystart= new RegExp("");
	var RegRowinputbodyend	= new RegExp("");

	RegRowgray.compile(/^.*<div [^<>]*id=["']gray02Wrapper["'][^>]*>.*$/);
	RegRowformstart.compile(/^.*<form name="message" method="post" action=["']([^"']*)["'][^>]*>.*$/);
	RegRowformend.compile(/^.*<\/form[^>]*>.*$/);
	RegRowinput.compile(/^.*<input [^<>]*name=["']([^"']*)["'][^>]*value=["']([^"']*)["'][^>]*>.*$/);
	RegRowinputbodystart.compile(/^.*<input type=["']hidden["'] name=["']body["'][^>]*value=["']([^"'>]*)$/);
	RegRowinputbodyend.compile(/^(.*)["'] +\/>$/);
	RegRowsubmit.compile(/^.*<input [^<>]*type="submit"[^>]*name=["']([^"']*)["'][^>]*>.*$/);

	var resTexts = request.responseText.split("\n");
	var flag_gray=0;
	var flag_form=0;
	var flag_submit=0;
	var flag_body=0;
	var path="";
	var postdatas = new Object();
	for(i in resTexts){
		if (flag_gray==1 || resTexts[i].match(RegRowgray)){
			flag_gray=1;
			if (flag_form==1 || resTexts[i].match(RegRowformstart)){
				if(flag_form==0){path=RegExp.$1;flag_form=1;}
				else if(resTexts[i].match(RegRowsubmit))        {flag_submit=1;break;}
				else if(resTexts[i].match(RegRowinput))         {postdatas[RegExp.$1]=RegExp.$2;}
				else if(resTexts[i].match(RegRowinputbodystart)){postdatas["body"]  =  RegExp.$1+"\n";flag_body=1;}
				else if(flag_body==1 && resTexts[i].match(RegRowinputbodyend))  {postdatas["body"] += RegExp.$1;flag_body=0;}
				else if(flag_body==1)                           {postdatas["body"] +=  resTexts[i]+"\n";}
				else if(resTexts[i].match(RegRowformend))       {flag_form=0;break;}
			}
		} 
	}
		postdatas['btn_send']="送信";
		  var request = new Ajax.Request( path, {
		        method: "post",
		        asynchronous: false,
		        parameters: postdatas, 
		        onComplete:  function(request){}
		    } );
}

//Prototype below
//faraway110601 同盟のGETが動かなくなる為 Version:"1.6.0.2"->'1.7'にアップ

/*  Prototype JavaScript framework, version 1.7
 *  (c) 2005-2010 Sam Stephenson
 *
 *  Prototype is freely distributable under the terms of an MIT-style license.
 *  For details, see the Prototype web site: http://www.prototypejs.org/
 *
 *--------------------------------------------------------------------------*/

var Prototype = {

  Version: '1.7',

  Browser: (function(){
    var ua = navigator.userAgent;
    var isOpera = Object.prototype.toString.call(window.opera) == '[object Opera]';
    return {
      IE:             !!window.attachEvent && !isOpera,
      Opera:          isOpera,
      WebKit:         ua.indexOf('AppleWebKit/') > -1,
      Gecko:          ua.indexOf('Gecko') > -1 && ua.indexOf('KHTML') === -1,
      MobileSafari:   /Apple.*Mobile/.test(ua)
    }
  })(),

  BrowserFeatures: {
    XPath: !!document.evaluate,

    SelectorsAPI: !!document.querySelector,

    ElementExtensions: (function() {
      var constructor = window.Element || window.HTMLElement;
      return !!(constructor && constructor.prototype);
    })(),
    SpecificElementExtensions: (function() {
      if (typeof window.HTMLDivElement !== 'undefined')
        return true;

      var div = document.createElement('div'),
          form = document.createElement('form'),
          isSupported = false;

      if (div['__proto__'] && (div['__proto__'] !== form['__proto__'])) {
        isSupported = true;
      }

      div = form = null;

      return isSupported;
    })()
  },

  ScriptFragment: '<script[^>]*>([\\S\\s]*?)<\/script>',
  JSONFilter: /^\/\*-secure-([\s\S]*)\*\/\s*$/,

  emptyFunction: function() { },

  K: function(x) { return x }
};

if (Prototype.Browser.MobileSafari)
  Prototype.BrowserFeatures.SpecificElementExtensions = false;


var Abstract = { };


var Try = {
  these: function() {
    var returnValue;

    for (var i = 0, length = arguments.length; i < length; i++) {
      var lambda = arguments[i];
      try {
        returnValue = lambda();
        break;
      } catch (e) { }
    }

    return returnValue;
  }
};

/* Based on Alex Arnell's inheritance implementation. */

var Class = (function() {

  var IS_DONTENUM_BUGGY = (function(){
    for (var p in { toString: 1 }) {
      if (p === 'toString') return false;
    }
    return true;
  })();

  function subclass() {};
  function create() {
    var parent = null, properties = $A(arguments);
    if (Object.isFunction(properties[0]))
      parent = properties.shift();

    function klass() {
      this.initialize.apply(this, arguments);
    }

    Object.extend(klass, Class.Methods);
    klass.superclass = parent;
    klass.subclasses = [];

    if (parent) {
      subclass.prototype = parent.prototype;
      klass.prototype = new subclass;
      parent.subclasses.push(klass);
    }

    for (var i = 0, length = properties.length; i < length; i++)
      klass.addMethods(properties[i]);

    if (!klass.prototype.initialize)
      klass.prototype.initialize = Prototype.emptyFunction;

    klass.prototype.constructor = klass;
    return klass;
  }

  function addMethods(source) {
    var ancestor   = this.superclass && this.superclass.prototype,
        properties = Object.keys(source);

    if (IS_DONTENUM_BUGGY) {
      if (source.toString != Object.prototype.toString)
        properties.push("toString");
      if (source.valueOf != Object.prototype.valueOf)
        properties.push("valueOf");
    }

    for (var i = 0, length = properties.length; i < length; i++) {
      var property = properties[i], value = source[property];
      if (ancestor && Object.isFunction(value) &&
          value.argumentNames()[0] == "$super") {
        var method = value;
        value = (function(m) {
          return function() { return ancestor[m].apply(this, arguments); };
        })(property).wrap(method);

        value.valueOf = method.valueOf.bind(method);
        value.toString = method.toString.bind(method);
      }
      this.prototype[property] = value;
    }

    return this;
  }

  return {
    create: create,
    Methods: {
      addMethods: addMethods
    }
  };
})();
(function() {

  var _toString = Object.prototype.toString,
      NULL_TYPE = 'Null',
      UNDEFINED_TYPE = 'Undefined',
      BOOLEAN_TYPE = 'Boolean',
      NUMBER_TYPE = 'Number',
      STRING_TYPE = 'String',
      OBJECT_TYPE = 'Object',
      FUNCTION_CLASS = '[object Function]',
      BOOLEAN_CLASS = '[object Boolean]',
      NUMBER_CLASS = '[object Number]',
      STRING_CLASS = '[object String]',
      ARRAY_CLASS = '[object Array]',
      DATE_CLASS = '[object Date]',
      NATIVE_JSON_STRINGIFY_SUPPORT = window.JSON &&
        typeof JSON.stringify === 'function' &&
        JSON.stringify(0) === '0' &&
        typeof JSON.stringify(Prototype.K) === 'undefined';

  function Type(o) {
    switch(o) {
      case null: return NULL_TYPE;
      case (void 0): return UNDEFINED_TYPE;
    }
    var type = typeof o;
    switch(type) {
      case 'boolean': return BOOLEAN_TYPE;
      case 'number':  return NUMBER_TYPE;
      case 'string':  return STRING_TYPE;
    }
    return OBJECT_TYPE;
  }

  function extend(destination, source) {
    for (var property in source)
      destination[property] = source[property];
    return destination;
  }

  function inspect(object) {
    try {
      if (isUndefined(object)) return 'undefined';
      if (object === null) return 'null';
      return object.inspect ? object.inspect() : String(object);
    } catch (e) {
      if (e instanceof RangeError) return '...';
      throw e;
    }
  }

  function toJSON(value) {
    return Str('', { '': value }, []);
  }

  function Str(key, holder, stack) {
    var value = holder[key],
        type = typeof value;

    if (Type(value) === OBJECT_TYPE && typeof value.toJSON === 'function') {
      value = value.toJSON(key);
    }

    var _class = _toString.call(value);

    switch (_class) {
      case NUMBER_CLASS:
      case BOOLEAN_CLASS:
      case STRING_CLASS:
        value = value.valueOf();
    }

    switch (value) {
      case null: return 'null';
      case true: return 'true';
      case false: return 'false';
    }

    type = typeof value;
    switch (type) {
      case 'string':
        return value.inspect(true);
      case 'number':
        return isFinite(value) ? String(value) : 'null';
      case 'object':

        for (var i = 0, length = stack.length; i < length; i++) {
          if (stack[i] === value) { throw new TypeError(); }
        }
        stack.push(value);

        var partial = [];
        if (_class === ARRAY_CLASS) {
          for (var i = 0, length = value.length; i < length; i++) {
            var str = Str(i, value, stack);
            partial.push(typeof str === 'undefined' ? 'null' : str);
          }
          partial = '[' + partial.join(',') + ']';
        } else {
          var keys = Object.keys(value);
          for (var i = 0, length = keys.length; i < length; i++) {
            var key = keys[i], str = Str(key, value, stack);
            if (typeof str !== "undefined") {
               partial.push(key.inspect(true)+ ':' + str);
             }
          }
          partial = '{' + partial.join(',') + '}';
        }
        stack.pop();
        return partial;
    }
  }

  function stringify(object) {
    return JSON.stringify(object);
  }

  function toQueryString(object) {
    return $H(object).toQueryString();
  }

  function toHTML(object) {
    return object && object.toHTML ? object.toHTML() : String.interpret(object);
  }

  function keys(object) {
    if (Type(object) !== OBJECT_TYPE) { throw new TypeError(); }
    var results = [];
    for (var property in object) {
      if (object.hasOwnProperty(property)) {
        results.push(property);
      }
    }
    return results;
  }

  function values(object) {
    var results = [];
    for (var property in object)
      results.push(object[property]);
    return results;
  }

  function clone(object) {
    return extend({ }, object);
  }

  function isElement(object) {
    return !!(object && object.nodeType == 1);
  }

  function isArray(object) {
    return _toString.call(object) === ARRAY_CLASS;
  }

  var hasNativeIsArray = (typeof Array.isArray == 'function')
    && Array.isArray([]) && !Array.isArray({});

  if (hasNativeIsArray) {
    isArray = Array.isArray;
  }

  function isHash(object) {
    return object instanceof Hash;
  }

  function isFunction(object) {
    return _toString.call(object) === FUNCTION_CLASS;
  }

  function isString(object) {
    return _toString.call(object) === STRING_CLASS;
  }

  function isNumber(object) {
    return _toString.call(object) === NUMBER_CLASS;
  }

  function isDate(object) {
    return _toString.call(object) === DATE_CLASS;
  }

  function isUndefined(object) {
    return typeof object === "undefined";
  }

  extend(Object, {
    extend:        extend,
    inspect:       inspect,
    toJSON:        NATIVE_JSON_STRINGIFY_SUPPORT ? stringify : toJSON,
    toQueryString: toQueryString,
    toHTML:        toHTML,
    keys:          Object.keys || keys,
    values:        values,
    clone:         clone,
    isElement:     isElement,
    isArray:       isArray,
    isHash:        isHash,
    isFunction:    isFunction,
    isString:      isString,
    isNumber:      isNumber,
    isDate:        isDate,
    isUndefined:   isUndefined
  });
})();
Object.extend(Function.prototype, (function() {
  var slice = Array.prototype.slice;

  function update(array, args) {
    var arrayLength = array.length, length = args.length;
    while (length--) array[arrayLength + length] = args[length];
    return array;
  }

  function merge(array, args) {
    array = slice.call(array, 0);
    return update(array, args);
  }

  function argumentNames() {
    var names = this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1]
      .replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g, '')
      .replace(/\s+/g, '').split(',');
    return names.length == 1 && !names[0] ? [] : names;
  }

  function bind(context) {
    if (arguments.length < 2 && Object.isUndefined(arguments[0])) return this;
    var __method = this, args = slice.call(arguments, 1);
    return function() {
      var a = merge(args, arguments);
      return __method.apply(context, a);
    }
  }

  function bindAsEventListener(context) {
    var __method = this, args = slice.call(arguments, 1);
    return function(event) {
      var a = update([event || window.event], args);
      return __method.apply(context, a);
    }
  }

  function curry() {
    if (!arguments.length) return this;
    var __method = this, args = slice.call(arguments, 0);
    return function() {
      var a = merge(args, arguments);
      return __method.apply(this, a);
    }
  }

  function delay(timeout) {
    var __method = this, args = slice.call(arguments, 1);
    timeout = timeout * 1000;
    return window.setTimeout(function() {
      return __method.apply(__method, args);
    }, timeout);
  }

  function defer() {
    var args = update([0.01], arguments);
    return this.delay.apply(this, args);
  }

  function wrap(wrapper) {
    var __method = this;
    return function() {
      var a = update([__method.bind(this)], arguments);
      return wrapper.apply(this, a);
    }
  }

  function methodize() {
    if (this._methodized) return this._methodized;
    var __method = this;
    return this._methodized = function() {
      var a = update([this], arguments);
      return __method.apply(null, a);
    };
  }

  return {
    argumentNames:       argumentNames,
    bind:                bind,
    bindAsEventListener: bindAsEventListener,
    curry:               curry,
    delay:               delay,
    defer:               defer,
    wrap:                wrap,
    methodize:           methodize
  }
})());



(function(proto) {


  function toISOString() {
    return this.getUTCFullYear() + '-' +
      (this.getUTCMonth() + 1).toPaddedString(2) + '-' +
      this.getUTCDate().toPaddedString(2) + 'T' +
      this.getUTCHours().toPaddedString(2) + ':' +
      this.getUTCMinutes().toPaddedString(2) + ':' +
      this.getUTCSeconds().toPaddedString(2) + 'Z';
  }


  function toJSON() {
    return this.toISOString();
  }

  if (!proto.toISOString) proto.toISOString = toISOString;
  if (!proto.toJSON) proto.toJSON = toJSON;

})(Date.prototype);


RegExp.prototype.match = RegExp.prototype.test;

RegExp.escape = function(str) {
  return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1');
};
var PeriodicalExecuter = Class.create({
  initialize: function(callback, frequency) {
    this.callback = callback;
    this.frequency = frequency;
    this.currentlyExecuting = false;

    this.registerCallback();
  },

  registerCallback: function() {
    this.timer = setInterval(this.onTimerEvent.bind(this), this.frequency * 1000);
  },

  execute: function() {
    this.callback(this);
  },

  stop: function() {
    if (!this.timer) return;
    clearInterval(this.timer);
    this.timer = null;
  },

  onTimerEvent: function() {
    if (!this.currentlyExecuting) {
      try {
        this.currentlyExecuting = true;
        this.execute();
        this.currentlyExecuting = false;
      } catch(e) {
        this.currentlyExecuting = false;
        throw e;
      }
    }
  }
});
Object.extend(String, {
  interpret: function(value) {
    return value == null ? '' : String(value);
  },
  specialChar: {
    '\b': '\\b',
    '\t': '\\t',
    '\n': '\\n',
    '\f': '\\f',
    '\r': '\\r',
    '\\': '\\\\'
  }
});

Object.extend(String.prototype, (function() {
  var NATIVE_JSON_PARSE_SUPPORT = window.JSON &&
    typeof JSON.parse === 'function' &&
    JSON.parse('{"test": true}').test;

  function prepareReplacement(replacement) {
    if (Object.isFunction(replacement)) return replacement;
    var template = new Template(replacement);
    return function(match) { return template.evaluate(match) };
  }

  function gsub(pattern, replacement) {
    var result = '', source = this, match;
    replacement = prepareReplacement(replacement);

    if (Object.isString(pattern))
      pattern = RegExp.escape(pattern);

    if (!(pattern.length || pattern.source)) {
      replacement = replacement('');
      return replacement + source.split('').join(replacement) + replacement;
    }

    while (source.length > 0) {
      if (match = source.match(pattern)) {
        result += source.slice(0, match.index);
        result += String.interpret(replacement(match));
        source  = source.slice(match.index + match[0].length);
      } else {
        result += source, source = '';
      }
    }
    return result;
  }

  function sub(pattern, replacement, count) {
    replacement = prepareReplacement(replacement);
    count = Object.isUndefined(count) ? 1 : count;

    return this.gsub(pattern, function(match) {
      if (--count < 0) return match[0];
      return replacement(match);
    });
  }

  function scan(pattern, iterator) {
    this.gsub(pattern, iterator);
    return String(this);
  }

  function truncate(length, truncation) {
    length = length || 30;
    truncation = Object.isUndefined(truncation) ? '...' : truncation;
    return this.length > length ?
      this.slice(0, length - truncation.length) + truncation : String(this);
  }

  function strip() {
    return this.replace(/^\s+/, '').replace(/\s+$/, '');
  }

  function stripTags() {
    return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi, '');
  }

  function stripScripts() {
    return this.replace(new RegExp(Prototype.ScriptFragment, 'img'), '');
  }

  function extractScripts() {
    var matchAll = new RegExp(Prototype.ScriptFragment, 'img'),
        matchOne = new RegExp(Prototype.ScriptFragment, 'im');
    return (this.match(matchAll) || []).map(function(scriptTag) {
      return (scriptTag.match(matchOne) || ['', ''])[1];
    });
  }

  function evalScripts() {
    return this.extractScripts().map(function(script) { return eval(script) });
  }

  function escapeHTML() {
    return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  function unescapeHTML() {
    return this.stripTags().replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&');
  }


  function toQueryParams(separator) {
    var match = this.strip().match(/([^?#]*)(#.*)?$/);
    if (!match) return { };

    return match[1].split(separator || '&').inject({ }, function(hash, pair) {
      if ((pair = pair.split('='))[0]) {
        var key = decodeURIComponent(pair.shift()),
            value = pair.length > 1 ? pair.join('=') : pair[0];

        if (value != undefined) value = decodeURIComponent(value);

        if (key in hash) {
          if (!Object.isArray(hash[key])) hash[key] = [hash[key]];
          hash[key].push(value);
        }
        else hash[key] = value;
      }
      return hash;
    });
  }

  function toArray() {
    return this.split('');
  }

  function succ() {
    return this.slice(0, this.length - 1) +
      String.fromCharCode(this.charCodeAt(this.length - 1) + 1);
  }

  function times(count) {
    return count < 1 ? '' : new Array(count + 1).join(this);
  }

  function camelize() {
    return this.replace(/-+(.)?/g, function(match, chr) {
      return chr ? chr.toUpperCase() : '';
    });
  }

  function capitalize() {
    return this.charAt(0).toUpperCase() + this.substring(1).toLowerCase();
  }

  function underscore() {
    return this.replace(/::/g, '/')
               .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')
               .replace(/([a-z\d])([A-Z])/g, '$1_$2')
               .replace(/-/g, '_')
               .toLowerCase();
  }

  function dasherize() {
    return this.replace(/_/g, '-');
  }

  function inspect(useDoubleQuotes) {
    var escapedString = this.replace(/[\x00-\x1f\\]/g, function(character) {
      if (character in String.specialChar) {
        return String.specialChar[character];
      }
      return '\\u00' + character.charCodeAt().toPaddedString(2, 16);
    });
    if (useDoubleQuotes) return '"' + escapedString.replace(/"/g, '\\"') + '"';
    return "'" + escapedString.replace(/'/g, '\\\'') + "'";
  }

  function unfilterJSON(filter) {
    return this.replace(filter || Prototype.JSONFilter, '$1');
  }

  function isJSON() {
    var str = this;
    if (str.blank()) return false;
    str = str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@');
    str = str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']');
    str = str.replace(/(?:^|:|,)(?:\s*\[)+/g, '');
    return (/^[\],:{}\s]*$/).test(str);
  }

  function evalJSON(sanitize) {
    var json = this.unfilterJSON(),
        cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
    if (cx.test(json)) {
      json = json.replace(cx, function (a) {
        return '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
      });
    }
    try {
      if (!sanitize || json.isJSON()) return eval('(' + json + ')');
    } catch (e) { }
    throw new SyntaxError('Badly formed JSON string: ' + this.inspect());
  }

  function parseJSON() {
    var json = this.unfilterJSON();
    return JSON.parse(json);
  }

  function include(pattern) {
    return this.indexOf(pattern) > -1;
  }

  function startsWith(pattern) {
    return this.lastIndexOf(pattern, 0) === 0;
  }

  function endsWith(pattern) {
    var d = this.length - pattern.length;
    return d >= 0 && this.indexOf(pattern, d) === d;
  }

  function empty() {
    return this == '';
  }

  function blank() {
    return /^\s*$/.test(this);
  }

  function interpolate(object, pattern) {
    return new Template(this, pattern).evaluate(object);
  }

  return {
    gsub:           gsub,
    sub:            sub,
    scan:           scan,
    truncate:       truncate,
    strip:          String.prototype.trim || strip,
    stripTags:      stripTags,
    stripScripts:   stripScripts,
    extractScripts: extractScripts,
    evalScripts:    evalScripts,
    escapeHTML:     escapeHTML,
    unescapeHTML:   unescapeHTML,
    toQueryParams:  toQueryParams,
    parseQuery:     toQueryParams,
    toArray:        toArray,
    succ:           succ,
    times:          times,
    camelize:       camelize,
    capitalize:     capitalize,
    underscore:     underscore,
    dasherize:      dasherize,
    inspect:        inspect,
    unfilterJSON:   unfilterJSON,
    isJSON:         isJSON,
    evalJSON:       NATIVE_JSON_PARSE_SUPPORT ? parseJSON : evalJSON,
    include:        include,
    startsWith:     startsWith,
    endsWith:       endsWith,
    empty:          empty,
    blank:          blank,
    interpolate:    interpolate
  };
})());

var Template = Class.create({
  initialize: function(template, pattern) {
    this.template = template.toString();
    this.pattern = pattern || Template.Pattern;
  },

  evaluate: function(object) {
    if (object && Object.isFunction(object.toTemplateReplacements))
      object = object.toTemplateReplacements();

    return this.template.gsub(this.pattern, function(match) {
      if (object == null) return (match[1] + '');

      var before = match[1] || '';
      if (before == '\\') return match[2];

      var ctx = object, expr = match[3],
          pattern = /^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;

      match = pattern.exec(expr);
      if (match == null) return before;

      while (match != null) {
        var comp = match[1].startsWith('[') ? match[2].replace(/\\\\]/g, ']') : match[1];
        ctx = ctx[comp];
        if (null == ctx || '' == match[3]) break;
        expr = expr.substring('[' == match[3] ? match[1].length : match[0].length);
        match = pattern.exec(expr);
      }

      return before + String.interpret(ctx);
    });
  }
});
Template.Pattern = /(^|.|\r|\n)(#\{(.*?)\})/;

var $break = { };

var Enumerable = (function() {
  function each(iterator, context) {
    var index = 0;
    try {
      this._each(function(value) {
        iterator.call(context, value, index++);
      });
    } catch (e) {
      if (e != $break) throw e;
    }
    return this;
  }

  function eachSlice(number, iterator, context) {
    var index = -number, slices = [], array = this.toArray();
    if (number < 1) return array;
    while ((index += number) < array.length)
      slices.push(array.slice(index, index+number));
    return slices.collect(iterator, context);
  }

  function all(iterator, context) {
    iterator = iterator || Prototype.K;
    var result = true;
    this.each(function(value, index) {
      result = result && !!iterator.call(context, value, index);
      if (!result) throw $break;
    });
    return result;
  }

  function any(iterator, context) {
    iterator = iterator || Prototype.K;
    var result = false;
    this.each(function(value, index) {
      if (result = !!iterator.call(context, value, index))
        throw $break;
    });
    return result;
  }

  function collect(iterator, context) {
    iterator = iterator || Prototype.K;
    var results = [];
    this.each(function(value, index) {
      results.push(iterator.call(context, value, index));
    });
    return results;
  }

  function detect(iterator, context) {
    var result;
    this.each(function(value, index) {
      if (iterator.call(context, value, index)) {
        result = value;
        throw $break;
      }
    });
    return result;
  }

  function findAll(iterator, context) {
    var results = [];
    this.each(function(value, index) {
      if (iterator.call(context, value, index))
        results.push(value);
    });
    return results;
  }

  function grep(filter, iterator, context) {
    iterator = iterator || Prototype.K;
    var results = [];

    if (Object.isString(filter))
      filter = new RegExp(RegExp.escape(filter));

    this.each(function(value, index) {
      if (filter.match(value))
        results.push(iterator.call(context, value, index));
    });
    return results;
  }

  function include(object) {
    if (Object.isFunction(this.indexOf))
      if (this.indexOf(object) != -1) return true;

    var found = false;
    this.each(function(value) {
      if (value == object) {
        found = true;
        throw $break;
      }
    });
    return found;
  }

  function inGroupsOf(number, fillWith) {
    fillWith = Object.isUndefined(fillWith) ? null : fillWith;
    return this.eachSlice(number, function(slice) {
      while(slice.length < number) slice.push(fillWith);
      return slice;
    });
  }

  function inject(memo, iterator, context) {
    this.each(function(value, index) {
      memo = iterator.call(context, memo, value, index);
    });
    return memo;
  }

  function invoke(method) {
    var args = $A(arguments).slice(1);
    return this.map(function(value) {
      return value[method].apply(value, args);
    });
  }

  function max(iterator, context) {
    iterator = iterator || Prototype.K;
    var result;
    this.each(function(value, index) {
      value = iterator.call(context, value, index);
      if (result == null || value >= result)
        result = value;
    });
    return result;
  }

  function min(iterator, context) {
    iterator = iterator || Prototype.K;
    var result;
    this.each(function(value, index) {
      value = iterator.call(context, value, index);
      if (result == null || value < result)
        result = value;
    });
    return result;
  }

  function partition(iterator, context) {
    iterator = iterator || Prototype.K;
    var trues = [], falses = [];
    this.each(function(value, index) {
      (iterator.call(context, value, index) ?
        trues : falses).push(value);
    });
    return [trues, falses];
  }

  function pluck(property) {
    var results = [];
    this.each(function(value) {
      results.push(value[property]);
    });
    return results;
  }

  function reject(iterator, context) {
    var results = [];
    this.each(function(value, index) {
      if (!iterator.call(context, value, index))
        results.push(value);
    });
    return results;
  }

  function sortBy(iterator, context) {
    return this.map(function(value, index) {
      return {
        value: value,
        criteria: iterator.call(context, value, index)
      };
    }).sort(function(left, right) {
      var a = left.criteria, b = right.criteria;
      return a < b ? -1 : a > b ? 1 : 0;
    }).pluck('value');
  }

  function toArray() {
    return this.map();
  }

  function zip() {
    var iterator = Prototype.K, args = $A(arguments);
    if (Object.isFunction(args.last()))
      iterator = args.pop();

    var collections = [this].concat(args).map($A);
    return this.map(function(value, index) {
      return iterator(collections.pluck(index));
    });
  }

  function size() {
    return this.toArray().length;
  }

  function inspect() {
    return '#<Enumerable:' + this.toArray().inspect() + '>';
  }









  return {
    each:       each,
    eachSlice:  eachSlice,
    all:        all,
    every:      all,
    any:        any,
    some:       any,
    collect:    collect,
    map:        collect,
    detect:     detect,
    findAll:    findAll,
    select:     findAll,
    filter:     findAll,
    grep:       grep,
    include:    include,
    member:     include,
    inGroupsOf: inGroupsOf,
    inject:     inject,
    invoke:     invoke,
    max:        max,
    min:        min,
    partition:  partition,
    pluck:      pluck,
    reject:     reject,
    sortBy:     sortBy,
    toArray:    toArray,
    entries:    toArray,
    zip:        zip,
    size:       size,
    inspect:    inspect,
    find:       detect
  };
})();

function $A(iterable) {
  if (!iterable) return [];
  if ('toArray' in Object(iterable)) return iterable.toArray();
  var length = iterable.length || 0, results = new Array(length);
  while (length--) results[length] = iterable[length];
  return results;
}


function $w(string) {
  if (!Object.isString(string)) return [];
  string = string.strip();
  return string ? string.split(/\s+/) : [];
}

Array.from = $A;


(function() {
  var arrayProto = Array.prototype,
      slice = arrayProto.slice,
      _each = arrayProto.forEach; // use native browser JS 1.6 implementation if available

  function each(iterator, context) {
    for (var i = 0, length = this.length >>> 0; i < length; i++) {
      if (i in this) iterator.call(context, this[i], i, this);
    }
  }
  if (!_each) _each = each;

  function clear() {
    this.length = 0;
    return this;
  }

  function first() {
    return this[0];
  }

  function last() {
    return this[this.length - 1];
  }

  function compact() {
    return this.select(function(value) {
      return value != null;
    });
  }

  function flatten() {
    return this.inject([], function(array, value) {
      if (Object.isArray(value))
        return array.concat(value.flatten());
      array.push(value);
      return array;
    });
  }

  function without() {
    var values = slice.call(arguments, 0);
    return this.select(function(value) {
      return !values.include(value);
    });
  }

  function reverse(inline) {
    return (inline === false ? this.toArray() : this)._reverse();
  }

  function uniq(sorted) {
    return this.inject([], function(array, value, index) {
      if (0 == index || (sorted ? array.last() != value : !array.include(value)))
        array.push(value);
      return array;
    });
  }

  function intersect(array) {
    return this.uniq().findAll(function(item) {
      return array.detect(function(value) { return item === value });
    });
  }


  function clone() {
    return slice.call(this, 0);
  }

  function size() {
    return this.length;
  }

  function inspect() {
    return '[' + this.map(Object.inspect).join(', ') + ']';
  }

  function indexOf(item, i) {
    i || (i = 0);
    var length = this.length;
    if (i < 0) i = length + i;
    for (; i < length; i++)
      if (this[i] === item) return i;
    return -1;
  }

  function lastIndexOf(item, i) {
    i = isNaN(i) ? this.length : (i < 0 ? this.length + i : i) + 1;
    var n = this.slice(0, i).reverse().indexOf(item);
    return (n < 0) ? n : i - n - 1;
  }

  function concat() {
    var array = slice.call(this, 0), item;
    for (var i = 0, length = arguments.length; i < length; i++) {
      item = arguments[i];
      if (Object.isArray(item) && !('callee' in item)) {
        for (var j = 0, arrayLength = item.length; j < arrayLength; j++)
          array.push(item[j]);
      } else {
        array.push(item);
      }
    }
    return array;
  }

  Object.extend(arrayProto, Enumerable);

  if (!arrayProto._reverse)
    arrayProto._reverse = arrayProto.reverse;

  Object.extend(arrayProto, {
    _each:     _each,
    clear:     clear,
    first:     first,
    last:      last,
    compact:   compact,
    flatten:   flatten,
    without:   without,
    reverse:   reverse,
    uniq:      uniq,
    intersect: intersect,
    clone:     clone,
    toArray:   clone,
    size:      size,
    inspect:   inspect
  });

  var CONCAT_ARGUMENTS_BUGGY = (function() {
    return [].concat(arguments)[0][0] !== 1;
  })(1,2)

  if (CONCAT_ARGUMENTS_BUGGY) arrayProto.concat = concat;

  if (!arrayProto.indexOf) arrayProto.indexOf = indexOf;
  if (!arrayProto.lastIndexOf) arrayProto.lastIndexOf = lastIndexOf;
})();
function $H(object) {
  return new Hash(object);
};

var Hash = Class.create(Enumerable, (function() {
  function initialize(object) {
    this._object = Object.isHash(object) ? object.toObject() : Object.clone(object);
  }


  function _each(iterator) {
    for (var key in this._object) {
      var value = this._object[key], pair = [key, value];
      pair.key = key;
      pair.value = value;
      iterator(pair);
    }
  }

  function set(key, value) {
    return this._object[key] = value;
  }

  function get(key) {
    if (this._object[key] !== Object.prototype[key])
      return this._object[key];
  }

  function unset(key) {
    var value = this._object[key];
    delete this._object[key];
    return value;
  }

  function toObject() {
    return Object.clone(this._object);
  }



  function keys() {
    return this.pluck('key');
  }

  function values() {
    return this.pluck('value');
  }

  function index(value) {
    var match = this.detect(function(pair) {
      return pair.value === value;
    });
    return match && match.key;
  }

  function merge(object) {
    return this.clone().update(object);
  }

  function update(object) {
    return new Hash(object).inject(this, function(result, pair) {
      result.set(pair.key, pair.value);
      return result;
    });
  }

  function toQueryPair(key, value) {
    if (Object.isUndefined(value)) return key;
    return key + '=' + encodeURIComponent(String.interpret(value));
  }

  function toQueryString() {
    return this.inject([], function(results, pair) {
      var key = encodeURIComponent(pair.key), values = pair.value;

      if (values && typeof values == 'object') {
        if (Object.isArray(values)) {
          var queryValues = [];
          for (var i = 0, len = values.length, value; i < len; i++) {
            value = values[i];
            queryValues.push(toQueryPair(key, value));
          }
          return results.concat(queryValues);
        }
      } else results.push(toQueryPair(key, values));
      return results;
    }).join('&');
  }

  function inspect() {
    return '#<Hash:{' + this.map(function(pair) {
      return pair.map(Object.inspect).join(': ');
    }).join(', ') + '}>';
  }

  function clone() {
    return new Hash(this);
  }

  return {
    initialize:             initialize,
    _each:                  _each,
    set:                    set,
    get:                    get,
    unset:                  unset,
    toObject:               toObject,
    toTemplateReplacements: toObject,
    keys:                   keys,
    values:                 values,
    index:                  index,
    merge:                  merge,
    update:                 update,
    toQueryString:          toQueryString,
    inspect:                inspect,
    toJSON:                 toObject,
    clone:                  clone
  };
})());

Hash.from = $H;
Object.extend(Number.prototype, (function() {
  function toColorPart() {
    return this.toPaddedString(2, 16);
  }

  function succ() {
    return this + 1;
  }

  function times(iterator, context) {
    $R(0, this, true).each(iterator, context);
    return this;
  }

  function toPaddedString(length, radix) {
    var string = this.toString(radix || 10);
    return '0'.times(length - string.length) + string;
  }

  function abs() {
    return Math.abs(this);
  }

  function round() {
    return Math.round(this);
  }

  function ceil() {
    return Math.ceil(this);
  }

  function floor() {
    return Math.floor(this);
  }

  return {
    toColorPart:    toColorPart,
    succ:           succ,
    times:          times,
    toPaddedString: toPaddedString,
    abs:            abs,
    round:          round,
    ceil:           ceil,
    floor:          floor
  };
})());

function $R(start, end, exclusive) {
  return new ObjectRange(start, end, exclusive);
}

var ObjectRange = Class.create(Enumerable, (function() {
  function initialize(start, end, exclusive) {
    this.start = start;
    this.end = end;
    this.exclusive = exclusive;
  }

  function _each(iterator) {
    var value = this.start;
    while (this.include(value)) {
      iterator(value);
      value = value.succ();
    }
  }

  function include(value) {
    if (value < this.start)
      return false;
    if (this.exclusive)
      return value < this.end;
    return value <= this.end;
  }

  return {
    initialize: initialize,
    _each:      _each,
    include:    include
  };
})());



var Ajax = {
  getTransport: function() {
    return Try.these(
      function() {return new XMLHttpRequest()},
      function() {return new ActiveXObject('Msxml2.XMLHTTP')},
      function() {return new ActiveXObject('Microsoft.XMLHTTP')}
    ) || false;
  },

  activeRequestCount: 0
};

Ajax.Responders = {
  responders: [],

  _each: function(iterator) {
    this.responders._each(iterator);
  },

  register: function(responder) {
    if (!this.include(responder))
      this.responders.push(responder);
  },

  unregister: function(responder) {
    this.responders = this.responders.without(responder);
  },

  dispatch: function(callback, request, transport, json) {
    this.each(function(responder) {
      if (Object.isFunction(responder[callback])) {
        try {
          responder[callback].apply(responder, [request, transport, json]);
        } catch (e) { }
      }
    });
  }
};

Object.extend(Ajax.Responders, Enumerable);

Ajax.Responders.register({
  onCreate:   function() { Ajax.activeRequestCount++ },
  onComplete: function() { Ajax.activeRequestCount-- }
});
Ajax.Base = Class.create({
  initialize: function(options) {
    this.options = {
      method:       'post',
      asynchronous: true,
      contentType:  'application/x-www-form-urlencoded',
      encoding:     'UTF-8',
      parameters:   '',
      evalJSON:     true,
      evalJS:       true
    };
    Object.extend(this.options, options || { });

    this.options.method = this.options.method.toLowerCase();

    if (Object.isHash(this.options.parameters))
      this.options.parameters = this.options.parameters.toObject();
  }
});
Ajax.Request = Class.create(Ajax.Base, {
  _complete: false,

  initialize: function($super, url, options) {
    $super(options);
    this.transport = Ajax.getTransport();
    this.request(url);
  },

  request: function(url) {
    this.url = url;
    this.method = this.options.method;
    var params = Object.isString(this.options.parameters) ?
          this.options.parameters :
          Object.toQueryString(this.options.parameters);

    if (!['get', 'post'].include(this.method)) {
      params += (params ? '&' : '') + "_method=" + this.method;
      this.method = 'post';
    }

    if (params && this.method === 'get') {
      this.url += (this.url.include('?') ? '&' : '?') + params;
    }

    this.parameters = params.toQueryParams();

    try {
      var response = new Ajax.Response(this);
      if (this.options.onCreate) this.options.onCreate(response);
      Ajax.Responders.dispatch('onCreate', this, response);

      this.transport.open(this.method.toUpperCase(), this.url,
        this.options.asynchronous);

      if (this.options.asynchronous) this.respondToReadyState.bind(this).defer(1);

      this.transport.onreadystatechange = this.onStateChange.bind(this);
      this.setRequestHeaders();

      this.body = this.method == 'post' ? (this.options.postBody || params) : null;
      this.transport.send(this.body);

      /* Force Firefox to handle ready state 4 for synchronous requests */
      if (!this.options.asynchronous && this.transport.overrideMimeType)
        this.onStateChange();

    }
    catch (e) {
      this.dispatchException(e);
    }
  },

  onStateChange: function() {
    var readyState = this.transport.readyState;
    if (readyState > 1 && !((readyState == 4) && this._complete))
      this.respondToReadyState(this.transport.readyState);
  },

  setRequestHeaders: function() {
    var headers = {
      'X-Requested-With': 'XMLHttpRequest',
      'X-Prototype-Version': Prototype.Version,
      'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
    };

    if (this.method == 'post') {
      headers['Content-type'] = this.options.contentType +
        (this.options.encoding ? '; charset=' + this.options.encoding : '');

      /* Force "Connection: close" for older Mozilla browsers to work
       * around a bug where XMLHttpRequest sends an incorrect
       * Content-length header. See Mozilla Bugzilla #246651.
       */
      if (this.transport.overrideMimeType &&
          (navigator.userAgent.match(/Gecko\/(\d{4})/) || [0,2005])[1] < 2005)
            headers['Connection'] = 'close';
    }

    if (typeof this.options.requestHeaders == 'object') {
      var extras = this.options.requestHeaders;

      if (Object.isFunction(extras.push))
        for (var i = 0, length = extras.length; i < length; i += 2)
          headers[extras[i]] = extras[i+1];
      else
        $H(extras).each(function(pair) { headers[pair.key] = pair.value });
    }

    for (var name in headers)
      this.transport.setRequestHeader(name, headers[name]);
  },

  success: function() {
    var status = this.getStatus();
    return !status || (status >= 200 && status < 300) || status == 304;
  },

  getStatus: function() {
    try {
      if (this.transport.status === 1223) return 204;
      return this.transport.status || 0;
    } catch (e) { return 0 }
  },

  respondToReadyState: function(readyState) {
    var state = Ajax.Request.Events[readyState], response = new Ajax.Response(this);

    if (state == 'Complete') {
      try {
        this._complete = true;
        (this.options['on' + response.status]
         || this.options['on' + (this.success() ? 'Success' : 'Failure')]
         || Prototype.emptyFunction)(response, response.headerJSON);
      } catch (e) {
        this.dispatchException(e);
      }

      var contentType = response.getHeader('Content-type');
      if (this.options.evalJS == 'force'
          || (this.options.evalJS && this.isSameOrigin() && contentType
          && contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
        this.evalResponse();
    }

    try {
      (this.options['on' + state] || Prototype.emptyFunction)(response, response.headerJSON);
      Ajax.Responders.dispatch('on' + state, this, response, response.headerJSON);
    } catch (e) {
      this.dispatchException(e);
    }

    if (state == 'Complete') {
      this.transport.onreadystatechange = Prototype.emptyFunction;
    }
  },

  isSameOrigin: function() {
    var m = this.url.match(/^\s*https?:\/\/[^\/]*/);
    return !m || (m[0] == '#{protocol}//#{domain}#{port}'.interpolate({
      protocol: location.protocol,
      domain: document.domain,
      port: location.port ? ':' + location.port : ''
    }));
  },

  getHeader: function(name) {
    try {
      return this.transport.getResponseHeader(name) || null;
    } catch (e) { return null; }
  },

  evalResponse: function() {
    try {
      return eval((this.transport.responseText || '').unfilterJSON());
    } catch (e) {
      this.dispatchException(e);
    }
  },

  dispatchException: function(exception) {
    (this.options.onException || Prototype.emptyFunction)(this, exception);
    Ajax.Responders.dispatch('onException', this, exception);
  }
});

Ajax.Request.Events =
  ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete'];








Ajax.Response = Class.create({
  initialize: function(request){
    this.request = request;
    var transport  = this.transport  = request.transport,
        readyState = this.readyState = transport.readyState;

    if ((readyState > 2 && !Prototype.Browser.IE) || readyState == 4) {
      this.status       = this.getStatus();
      this.statusText   = this.getStatusText();
      this.responseText = String.interpret(transport.responseText);
      this.headerJSON   = this._getHeaderJSON();
    }

    if (readyState == 4) {
      var xml = transport.responseXML;
      this.responseXML  = Object.isUndefined(xml) ? null : xml;
      this.responseJSON = this._getResponseJSON();
    }
  },

  status:      0,

  statusText: '',

  getStatus: Ajax.Request.prototype.getStatus,

  getStatusText: function() {
    try {
      return this.transport.statusText || '';
    } catch (e) { return '' }
  },

  getHeader: Ajax.Request.prototype.getHeader,

  getAllHeaders: function() {
    try {
      return this.getAllResponseHeaders();
    } catch (e) { return null }
  },

  getResponseHeader: function(name) {
    return this.transport.getResponseHeader(name);
  },

  getAllResponseHeaders: function() {
    return this.transport.getAllResponseHeaders();
  },

  _getHeaderJSON: function() {
    var json = this.getHeader('X-JSON');
    if (!json) return null;
    json = decodeURIComponent(escape(json));
    try {
      return json.evalJSON(this.request.options.sanitizeJSON ||
        !this.request.isSameOrigin());
    } catch (e) {
      this.request.dispatchException(e);
    }
  },

  _getResponseJSON: function() {
    var options = this.request.options;
    if (!options.evalJSON || (options.evalJSON != 'force' &&
      !(this.getHeader('Content-type') || '').include('application/json')) ||
        this.responseText.blank())
          return null;
    try {
      return this.responseText.evalJSON(options.sanitizeJSON ||
        !this.request.isSameOrigin());
    } catch (e) {
      this.request.dispatchException(e);
    }
  }
});

Ajax.Updater = Class.create(Ajax.Request, {
  initialize: function($super, container, url, options) {
    this.container = {
      success: (container.success || container),
      failure: (container.failure || (container.success ? null : container))
    };

    options = Object.clone(options);
    var onComplete = options.onComplete;
    options.onComplete = (function(response, json) {
      this.updateContent(response.responseText);
      if (Object.isFunction(onComplete)) onComplete(response, json);
    }).bind(this);

    $super(url, options);
  },

  updateContent: function(responseText) {
    var receiver = this.container[this.success() ? 'success' : 'failure'],
        options = this.options;

    if (!options.evalScripts) responseText = responseText.stripScripts();

    if (receiver = $(receiver)) {
      if (options.insertion) {
        if (Object.isString(options.insertion)) {
          var insertion = { }; insertion[options.insertion] = responseText;
          receiver.insert(insertion);
        }
        else options.insertion(receiver, responseText);
      }
      else receiver.update(responseText);
    }
  }
});

Ajax.PeriodicalUpdater = Class.create(Ajax.Base, {
  initialize: function($super, container, url, options) {
    $super(options);
    this.onComplete = this.options.onComplete;

    this.frequency = (this.options.frequency || 2);
    this.decay = (this.options.decay || 1);

    this.updater = { };
    this.container = container;
    this.url = url;

    this.start();
  },

  start: function() {
    this.options.onComplete = this.updateComplete.bind(this);
    this.onTimerEvent();
  },

  stop: function() {
    this.updater.options.onComplete = undefined;
    clearTimeout(this.timer);
    (this.onComplete || Prototype.emptyFunction).apply(this, arguments);
  },

  updateComplete: function(response) {
    if (this.options.decay) {
      this.decay = (response.responseText == this.lastText ?
        this.decay * this.options.decay : 1);

      this.lastText = response.responseText;
    }
    this.timer = this.onTimerEvent.bind(this).delay(this.decay * this.frequency);
  },

  onTimerEvent: function() {
    this.updater = new Ajax.Updater(this.container, this.url, this.options);
  }
});


function $(element) {
  if (arguments.length > 1) {
    for (var i = 0, elements = [], length = arguments.length; i < length; i++)
      elements.push($(arguments[i]));
    return elements;
  }
  if (Object.isString(element))
    element = document.getElementById(element);
  return Element.extend(element);
}

if (Prototype.BrowserFeatures.XPath) {
  document._getElementsByXPath = function(expression, parentElement) {
    var results = [];
    var query = document.evaluate(expression, $(parentElement) || document,
      null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
    for (var i = 0, length = query.snapshotLength; i < length; i++)
      results.push(Element.extend(query.snapshotItem(i)));
    return results;
  };
}

/*--------------------------------------------------------------------------*/

if (!Node) var Node = { };

if (!Node.ELEMENT_NODE) {
  Object.extend(Node, {
    ELEMENT_NODE: 1,
    ATTRIBUTE_NODE: 2,
    TEXT_NODE: 3,
    CDATA_SECTION_NODE: 4,
    ENTITY_REFERENCE_NODE: 5,
    ENTITY_NODE: 6,
    PROCESSING_INSTRUCTION_NODE: 7,
    COMMENT_NODE: 8,
    DOCUMENT_NODE: 9,
    DOCUMENT_TYPE_NODE: 10,
    DOCUMENT_FRAGMENT_NODE: 11,
    NOTATION_NODE: 12
  });
}



(function(global) {
  function shouldUseCache(tagName, attributes) {
    if (tagName === 'select') return false;
    if ('type' in attributes) return false;
    return true;
  }

  var HAS_EXTENDED_CREATE_ELEMENT_SYNTAX = (function(){
    try {
      var el = document.createElement('<input name="x">');
      return el.tagName.toLowerCase() === 'input' && el.name === 'x';
    }
    catch(err) {
      return false;
    }
  })();

  var element = global.Element;

  global.Element = function(tagName, attributes) {
    attributes = attributes || { };
    tagName = tagName.toLowerCase();
    var cache = Element.cache;

    if (HAS_EXTENDED_CREATE_ELEMENT_SYNTAX && attributes.name) {
      tagName = '<' + tagName + ' name="' + attributes.name + '">';
      delete attributes.name;
      return Element.writeAttribute(document.createElement(tagName), attributes);
    }

    if (!cache[tagName]) cache[tagName] = Element.extend(document.createElement(tagName));

    var node = shouldUseCache(tagName, attributes) ?
     cache[tagName].cloneNode(false) : document.createElement(tagName);

    return Element.writeAttribute(node, attributes);
  };

  Object.extend(global.Element, element || { });
  if (element) global.Element.prototype = element.prototype;

})(this);

Element.idCounter = 1;
Element.cache = { };

Element._purgeElement = function(element) {
  var uid = element._prototypeUID;
  if (uid) {
    Element.stopObserving(element);
    element._prototypeUID = void 0;
    delete Element.Storage[uid];
  }
}

Element.Methods = {
  visible: function(element) {
    return $(element).style.display != 'none';
  },

  toggle: function(element) {
    element = $(element);
    Element[Element.visible(element) ? 'hide' : 'show'](element);
    return element;
  },

  hide: function(element) {
    element = $(element);
    element.style.display = 'none';
    return element;
  },

  show: function(element) {
    element = $(element);
    element.style.display = '';
    return element;
  },

  remove: function(element) {
    element = $(element);
    element.parentNode.removeChild(element);
    return element;
  },

  update: (function(){

    var SELECT_ELEMENT_INNERHTML_BUGGY = (function(){
      var el = document.createElement("select"),
          isBuggy = true;
      el.innerHTML = "<option value=\"test\">test</option>";
      if (el.options && el.options[0]) {
        isBuggy = el.options[0].nodeName.toUpperCase() !== "OPTION";
      }
      el = null;
      return isBuggy;
    })();

    var TABLE_ELEMENT_INNERHTML_BUGGY = (function(){
      try {
        var el = document.createElement("table");
        if (el && el.tBodies) {
          el.innerHTML = "<tbody><tr><td>test</td></tr></tbody>";
          var isBuggy = typeof el.tBodies[0] == "undefined";
          el = null;
          return isBuggy;
        }
      } catch (e) {
        return true;
      }
    })();

    var LINK_ELEMENT_INNERHTML_BUGGY = (function() {
      try {
        var el = document.createElement('div');
        el.innerHTML = "<link>";
        var isBuggy = (el.childNodes.length === 0);
        el = null;
        return isBuggy;
      } catch(e) {
        return true;
      }
    })();

    var ANY_INNERHTML_BUGGY = SELECT_ELEMENT_INNERHTML_BUGGY ||
     TABLE_ELEMENT_INNERHTML_BUGGY || LINK_ELEMENT_INNERHTML_BUGGY;

    var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING = (function () {
      var s = document.createElement("script"),
          isBuggy = false;
      try {
        s.appendChild(document.createTextNode(""));
        isBuggy = !s.firstChild ||
          s.firstChild && s.firstChild.nodeType !== 3;
      } catch (e) {
        isBuggy = true;
      }
      s = null;
      return isBuggy;
    })();


    function update(element, content) {
      element = $(element);
      var purgeElement = Element._purgeElement;

      var descendants = element.getElementsByTagName('*'),
       i = descendants.length;
      while (i--) purgeElement(descendants[i]);

      if (content && content.toElement)
        content = content.toElement();

      if (Object.isElement(content))
        return element.update().insert(content);

      content = Object.toHTML(content);

      var tagName = element.tagName.toUpperCase();

      if (tagName === 'SCRIPT' && SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING) {
        element.text = content;
        return element;
      }

      if (ANY_INNERHTML_BUGGY) {
        if (tagName in Element._insertionTranslations.tags) {
          while (element.firstChild) {
            element.removeChild(element.firstChild);
          }
          Element._getContentFromAnonymousElement(tagName, content.stripScripts())
            .each(function(node) {
              element.appendChild(node)
            });
        } else if (LINK_ELEMENT_INNERHTML_BUGGY && Object.isString(content) && content.indexOf('<link') > -1) {
          while (element.firstChild) {
            element.removeChild(element.firstChild);
          }
          var nodes = Element._getContentFromAnonymousElement(tagName, content.stripScripts(), true);
          nodes.each(function(node) { element.appendChild(node) });
        }
        else {
          element.innerHTML = content.stripScripts();
        }
      }
      else {
        element.innerHTML = content.stripScripts();
      }

      content.evalScripts.bind(content).defer();
      return element;
    }

    return update;
  })(),

  replace: function(element, content) {
    element = $(element);
    if (content && content.toElement) content = content.toElement();
    else if (!Object.isElement(content)) {
      content = Object.toHTML(content);
      var range = element.ownerDocument.createRange();
      range.selectNode(element);
      content.evalScripts.bind(content).defer();
      content = range.createContextualFragment(content.stripScripts());
    }
    element.parentNode.replaceChild(content, element);
    return element;
  },

  insert: function(element, insertions) {
    element = $(element);

    if (Object.isString(insertions) || Object.isNumber(insertions) ||
        Object.isElement(insertions) || (insertions && (insertions.toElement || insertions.toHTML)))
          insertions = {bottom:insertions};

    var content, insert, tagName, childNodes;

    for (var position in insertions) {
      content  = insertions[position];
      position = position.toLowerCase();
      insert = Element._insertionTranslations[position];

      if (content && content.toElement) content = content.toElement();
      if (Object.isElement(content)) {
        insert(element, content);
        continue;
      }

      content = Object.toHTML(content);

      tagName = ((position == 'before' || position == 'after')
        ? element.parentNode : element).tagName.toUpperCase();

      childNodes = Element._getContentFromAnonymousElement(tagName, content.stripScripts());

      if (position == 'top' || position == 'after') childNodes.reverse();
      childNodes.each(insert.curry(element));

      content.evalScripts.bind(content).defer();
    }

    return element;
  },

  wrap: function(element, wrapper, attributes) {
    element = $(element);
    if (Object.isElement(wrapper))
      $(wrapper).writeAttribute(attributes || { });
    else if (Object.isString(wrapper)) wrapper = new Element(wrapper, attributes);
    else wrapper = new Element('div', wrapper);
    if (element.parentNode)
      element.parentNode.replaceChild(wrapper, element);
    wrapper.appendChild(element);
    return wrapper;
  },

  inspect: function(element) {
    element = $(element);
    var result = '<' + element.tagName.toLowerCase();
    $H({'id': 'id', 'className': 'class'}).each(function(pair) {
      var property = pair.first(),
          attribute = pair.last(),
          value = (element[property] || '').toString();
      if (value) result += ' ' + attribute + '=' + value.inspect(true);
    });
    return result + '>';
  },

  recursivelyCollect: function(element, property, maximumLength) {
    element = $(element);
    maximumLength = maximumLength || -1;
    var elements = [];

    while (element = element[property]) {
      if (element.nodeType == 1)
        elements.push(Element.extend(element));
      if (elements.length == maximumLength)
        break;
    }

    return elements;
  },

  ancestors: function(element) {
    return Element.recursivelyCollect(element, 'parentNode');
  },

  descendants: function(element) {
    return Element.select(element, "*");
  },

  firstDescendant: function(element) {
    element = $(element).firstChild;
    while (element && element.nodeType != 1) element = element.nextSibling;
    return $(element);
  },

  immediateDescendants: function(element) {
    var results = [], child = $(element).firstChild;
    while (child) {
      if (child.nodeType === 1) {
        results.push(Element.extend(child));
      }
      child = child.nextSibling;
    }
    return results;
  },

  previousSiblings: function(element, maximumLength) {
    return Element.recursivelyCollect(element, 'previousSibling');
  },

  nextSiblings: function(element) {
    return Element.recursivelyCollect(element, 'nextSibling');
  },

  siblings: function(element) {
    element = $(element);
    return Element.previousSiblings(element).reverse()
      .concat(Element.nextSiblings(element));
  },

  match: function(element, selector) {
    element = $(element);
    if (Object.isString(selector))
      return Prototype.Selector.match(element, selector);
    return selector.match(element);
  },

  up: function(element, expression, index) {
    element = $(element);
    if (arguments.length == 1) return $(element.parentNode);
    var ancestors = Element.ancestors(element);
    return Object.isNumber(expression) ? ancestors[expression] :
      Prototype.Selector.find(ancestors, expression, index);
  },

  down: function(element, expression, index) {
    element = $(element);
    if (arguments.length == 1) return Element.firstDescendant(element);
    return Object.isNumber(expression) ? Element.descendants(element)[expression] :
      Element.select(element, expression)[index || 0];
  },

  previous: function(element, expression, index) {
    element = $(element);
    if (Object.isNumber(expression)) index = expression, expression = false;
    if (!Object.isNumber(index)) index = 0;

    if (expression) {
      return Prototype.Selector.find(element.previousSiblings(), expression, index);
    } else {
      return element.recursivelyCollect("previousSibling", index + 1)[index];
    }
  },

  next: function(element, expression, index) {
    element = $(element);
    if (Object.isNumber(expression)) index = expression, expression = false;
    if (!Object.isNumber(index)) index = 0;

    if (expression) {
      return Prototype.Selector.find(element.nextSiblings(), expression, index);
    } else {
      var maximumLength = Object.isNumber(index) ? index + 1 : 1;
      return element.recursivelyCollect("nextSibling", index + 1)[index];
    }
  },


  select: function(element) {
    element = $(element);
    var expressions = Array.prototype.slice.call(arguments, 1).join(', ');
    return Prototype.Selector.select(expressions, element);
  },

  adjacent: function(element) {
    element = $(element);
    var expressions = Array.prototype.slice.call(arguments, 1).join(', ');
    return Prototype.Selector.select(expressions, element.parentNode).without(element);
  },

  identify: function(element) {
    element = $(element);
    var id = Element.readAttribute(element, 'id');
    if (id) return id;
    do { id = 'anonymous_element_' + Element.idCounter++ } while ($(id));
    Element.writeAttribute(element, 'id', id);
    return id;
  },

  readAttribute: function(element, name) {
    element = $(element);
    if (Prototype.Browser.IE) {
      var t = Element._attributeTranslations.read;
      if (t.values[name]) return t.values[name](element, name);
      if (t.names[name]) name = t.names[name];
      if (name.include(':')) {
        return (!element.attributes || !element.attributes[name]) ? null :
         element.attributes[name].value;
      }
    }
    return element.getAttribute(name);
  },

  writeAttribute: function(element, name, value) {
    element = $(element);
    var attributes = { }, t = Element._attributeTranslations.write;

    if (typeof name == 'object') attributes = name;
    else attributes[name] = Object.isUndefined(value) ? true : value;

    for (var attr in attributes) {
      name = t.names[attr] || attr;
      value = attributes[attr];
      if (t.values[attr]) name = t.values[attr](element, value);
      if (value === false || value === null)
        element.removeAttribute(name);
      else if (value === true)
        element.setAttribute(name, name);
      else element.setAttribute(name, value);
    }
    return element;
  },

  getHeight: function(element) {
    return Element.getDimensions(element).height;
  },

  getWidth: function(element) {
    return Element.getDimensions(element).width;
  },

  classNames: function(element) {
    return new Element.ClassNames(element);
  },

  hasClassName: function(element, className) {
    if (!(element = $(element))) return;
    var elementClassName = element.className;
    return (elementClassName.length > 0 && (elementClassName == className ||
      new RegExp("(^|\\s)" + className + "(\\s|$)").test(elementClassName)));
  },

  addClassName: function(element, className) {
    if (!(element = $(element))) return;
    if (!Element.hasClassName(element, className))
      element.className += (element.className ? ' ' : '') + className;
    return element;
  },

  removeClassName: function(element, className) {
    if (!(element = $(element))) return;
    element.className = element.className.replace(
      new RegExp("(^|\\s+)" + className + "(\\s+|$)"), ' ').strip();
    return element;
  },

  toggleClassName: function(element, className) {
    if (!(element = $(element))) return;
    return Element[Element.hasClassName(element, className) ?
      'removeClassName' : 'addClassName'](element, className);
  },

  cleanWhitespace: function(element) {
    element = $(element);
    var node = element.firstChild;
    while (node) {
      var nextNode = node.nextSibling;
      if (node.nodeType == 3 && !/\S/.test(node.nodeValue))
        element.removeChild(node);
      node = nextNode;
    }
    return element;
  },

  empty: function(element) {
    return $(element).innerHTML.blank();
  },

  descendantOf: function(element, ancestor) {
    element = $(element), ancestor = $(ancestor);

    if (element.compareDocumentPosition)
      return (element.compareDocumentPosition(ancestor) & 8) === 8;

    if (ancestor.contains)
      return ancestor.contains(element) && ancestor !== element;

    while (element = element.parentNode)
      if (element == ancestor) return true;

    return false;
  },

  scrollTo: function(element) {
    element = $(element);
    var pos = Element.cumulativeOffset(element);
    window.scrollTo(pos[0], pos[1]);
    return element;
  },

  getStyle: function(element, style) {
    element = $(element);
    style = style == 'float' ? 'cssFloat' : style.camelize();
    var value = element.style[style];
    if (!value || value == 'auto') {
      var css = document.defaultView.getComputedStyle(element, null);
      value = css ? css[style] : null;
    }
    if (style == 'opacity') return value ? parseFloat(value) : 1.0;
    return value == 'auto' ? null : value;
  },

  getOpacity: function(element) {
    return $(element).getStyle('opacity');
  },

  setStyle: function(element, styles) {
    element = $(element);
    var elementStyle = element.style, match;
    if (Object.isString(styles)) {
      element.style.cssText += ';' + styles;
      return styles.include('opacity') ?
        element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]) : element;
    }
    for (var property in styles)
      if (property == 'opacity') element.setOpacity(styles[property]);
      else
        elementStyle[(property == 'float' || property == 'cssFloat') ?
          (Object.isUndefined(elementStyle.styleFloat) ? 'cssFloat' : 'styleFloat') :
            property] = styles[property];

    return element;
  },

  setOpacity: function(element, value) {
    element = $(element);
    element.style.opacity = (value == 1 || value === '') ? '' :
      (value < 0.00001) ? 0 : value;
    return element;
  },

  makePositioned: function(element) {
    element = $(element);
    var pos = Element.getStyle(element, 'position');
    if (pos == 'static' || !pos) {
      element._madePositioned = true;
      element.style.position = 'relative';
      if (Prototype.Browser.Opera) {
        element.style.top = 0;
        element.style.left = 0;
      }
    }
    return element;
  },

  undoPositioned: function(element) {
    element = $(element);
    if (element._madePositioned) {
      element._madePositioned = undefined;
      element.style.position =
        element.style.top =
        element.style.left =
        element.style.bottom =
        element.style.right = '';
    }
    return element;
  },

  makeClipping: function(element) {
    element = $(element);
    if (element._overflow) return element;
    element._overflow = Element.getStyle(element, 'overflow') || 'auto';
    if (element._overflow !== 'hidden')
      element.style.overflow = 'hidden';
    return element;
  },

  undoClipping: function(element) {
    element = $(element);
    if (!element._overflow) return element;
    element.style.overflow = element._overflow == 'auto' ? '' : element._overflow;
    element._overflow = null;
    return element;
  },

  clonePosition: function(element, source) {
    var options = Object.extend({
      setLeft:    true,
      setTop:     true,
      setWidth:   true,
      setHeight:  true,
      offsetTop:  0,
      offsetLeft: 0
    }, arguments[2] || { });

    source = $(source);
    var p = Element.viewportOffset(source), delta = [0, 0], parent = null;

    element = $(element);

    if (Element.getStyle(element, 'position') == 'absolute') {
      parent = Element.getOffsetParent(element);
      delta = Element.viewportOffset(parent);
    }

    if (parent == document.body) {
      delta[0] -= document.body.offsetLeft;
      delta[1] -= document.body.offsetTop;
    }

    if (options.setLeft)   element.style.left  = (p[0] - delta[0] + options.offsetLeft) + 'px';
    if (options.setTop)    element.style.top   = (p[1] - delta[1] + options.offsetTop) + 'px';
    if (options.setWidth)  element.style.width = source.offsetWidth + 'px';
    if (options.setHeight) element.style.height = source.offsetHeight + 'px';
    return element;
  }
};

Object.extend(Element.Methods, {
  getElementsBySelector: Element.Methods.select,

  childElements: Element.Methods.immediateDescendants
});

Element._attributeTranslations = {
  write: {
    names: {
      className: 'class',
      htmlFor:   'for'
    },
    values: { }
  }
};

if (Prototype.Browser.Opera) {
  Element.Methods.getStyle = Element.Methods.getStyle.wrap(
    function(proceed, element, style) {
      switch (style) {
        case 'height': case 'width':
          if (!Element.visible(element)) return null;

          var dim = parseInt(proceed(element, style), 10);

          if (dim !== element['offset' + style.capitalize()])
            return dim + 'px';

          var properties;
          if (style === 'height') {
            properties = ['border-top-width', 'padding-top',
             'padding-bottom', 'border-bottom-width'];
          }
          else {
            properties = ['border-left-width', 'padding-left',
             'padding-right', 'border-right-width'];
          }
          return properties.inject(dim, function(memo, property) {
            var val = proceed(element, property);
            return val === null ? memo : memo - parseInt(val, 10);
          }) + 'px';
        default: return proceed(element, style);
      }
    }
  );

  Element.Methods.readAttribute = Element.Methods.readAttribute.wrap(
    function(proceed, element, attribute) {
      if (attribute === 'title') return element.title;
      return proceed(element, attribute);
    }
  );
}

else if (Prototype.Browser.IE) {
  Element.Methods.getStyle = function(element, style) {
    element = $(element);
    style = (style == 'float' || style == 'cssFloat') ? 'styleFloat' : style.camelize();
    var value = element.style[style];
    if (!value && element.currentStyle) value = element.currentStyle[style];

    if (style == 'opacity') {
      if (value = (element.getStyle('filter') || '').match(/alpha\(opacity=(.*)\)/))
        if (value[1]) return parseFloat(value[1]) / 100;
      return 1.0;
    }

    if (value == 'auto') {
      if ((style == 'width' || style == 'height') && (element.getStyle('display') != 'none'))
        return element['offset' + style.capitalize()] + 'px';
      return null;
    }
    return value;
  };

  Element.Methods.setOpacity = function(element, value) {
    function stripAlpha(filter){
      return filter.replace(/alpha\([^\)]*\)/gi,'');
    }
    element = $(element);
    var currentStyle = element.currentStyle;
    if ((currentStyle && !currentStyle.hasLayout) ||
      (!currentStyle && element.style.zoom == 'normal'))
        element.style.zoom = 1;

    var filter = element.getStyle('filter'), style = element.style;
    if (value == 1 || value === '') {
      (filter = stripAlpha(filter)) ?
        style.filter = filter : style.removeAttribute('filter');
      return element;
    } else if (value < 0.00001) value = 0;
    style.filter = stripAlpha(filter) +
      'alpha(opacity=' + (value * 100) + ')';
    return element;
  };

  Element._attributeTranslations = (function(){

    var classProp = 'className',
        forProp = 'for',
        el = document.createElement('div');

    el.setAttribute(classProp, 'x');

    if (el.className !== 'x') {
      el.setAttribute('class', 'x');
      if (el.className === 'x') {
        classProp = 'class';
      }
    }
    el = null;

    el = document.createElement('label');
    el.setAttribute(forProp, 'x');
    if (el.htmlFor !== 'x') {
      el.setAttribute('htmlFor', 'x');
      if (el.htmlFor === 'x') {
        forProp = 'htmlFor';
      }
    }
    el = null;

    return {
      read: {
        names: {
          'class':      classProp,
          'className':  classProp,
          'for':        forProp,
          'htmlFor':    forProp
        },
        values: {
          _getAttr: function(element, attribute) {
            return element.getAttribute(attribute);
          },
          _getAttr2: function(element, attribute) {
            return element.getAttribute(attribute, 2);
          },
          _getAttrNode: function(element, attribute) {
            var node = element.getAttributeNode(attribute);
            return node ? node.value : "";
          },
          _getEv: (function(){

            var el = document.createElement('div'), f;
            el.onclick = Prototype.emptyFunction;
            var value = el.getAttribute('onclick');

            if (String(value).indexOf('{') > -1) {
              f = function(element, attribute) {
                attribute = element.getAttribute(attribute);
                if (!attribute) return null;
                attribute = attribute.toString();
                attribute = attribute.split('{')[1];
                attribute = attribute.split('}')[0];
                return attribute.strip();
              };
            }
            else if (value === '') {
              f = function(element, attribute) {
                attribute = element.getAttribute(attribute);
                if (!attribute) return null;
                return attribute.strip();
              };
            }
            el = null;
            return f;
          })(),
          _flag: function(element, attribute) {
            return $(element).hasAttribute(attribute) ? attribute : null;
          },
          style: function(element) {
            return element.style.cssText.toLowerCase();
          },
          title: function(element) {
            return element.title;
          }
        }
      }
    }
  })();

  Element._attributeTranslations.write = {
    names: Object.extend({
      cellpadding: 'cellPadding',
      cellspacing: 'cellSpacing'
    }, Element._attributeTranslations.read.names),
    values: {
      checked: function(element, value) {
        element.checked = !!value;
      },

      style: function(element, value) {
        element.style.cssText = value ? value : '';
      }
    }
  };

  Element._attributeTranslations.has = {};

  $w('colSpan rowSpan vAlign dateTime accessKey tabIndex ' +
      'encType maxLength readOnly longDesc frameBorder').each(function(attr) {
    Element._attributeTranslations.write.names[attr.toLowerCase()] = attr;
    Element._attributeTranslations.has[attr.toLowerCase()] = attr;
  });

  (function(v) {
    Object.extend(v, {
      href:        v._getAttr2,
      src:         v._getAttr2,
      type:        v._getAttr,
      action:      v._getAttrNode,
      disabled:    v._flag,
      checked:     v._flag,
      readonly:    v._flag,
      multiple:    v._flag,
      onload:      v._getEv,
      onunload:    v._getEv,
      onclick:     v._getEv,
      ondblclick:  v._getEv,
      onmousedown: v._getEv,
      onmouseup:   v._getEv,
      onmouseover: v._getEv,
      onmousemove: v._getEv,
      onmouseout:  v._getEv,
      onfocus:     v._getEv,
      onblur:      v._getEv,
      onkeypress:  v._getEv,
      onkeydown:   v._getEv,
      onkeyup:     v._getEv,
      onsubmit:    v._getEv,
      onreset:     v._getEv,
      onselect:    v._getEv,
      onchange:    v._getEv
    });
  })(Element._attributeTranslations.read.values);

  if (Prototype.BrowserFeatures.ElementExtensions) {
    (function() {
      function _descendants(element) {
        var nodes = element.getElementsByTagName('*'), results = [];
        for (var i = 0, node; node = nodes[i]; i++)
          if (node.tagName !== "!") // Filter out comment nodes.
            results.push(node);
        return results;
      }

      Element.Methods.down = function(element, expression, index) {
        element = $(element);
        if (arguments.length == 1) return element.firstDescendant();
        return Object.isNumber(expression) ? _descendants(element)[expression] :
          Element.select(element, expression)[index || 0];
      }
    })();
  }

}

else if (Prototype.Browser.Gecko && /rv:1\.8\.0/.test(navigator.userAgent)) {
  Element.Methods.setOpacity = function(element, value) {
    element = $(element);
    element.style.opacity = (value == 1) ? 0.999999 :
      (value === '') ? '' : (value < 0.00001) ? 0 : value;
    return element;
  };
}

else if (Prototype.Browser.WebKit) {
  Element.Methods.setOpacity = function(element, value) {
    element = $(element);
    element.style.opacity = (value == 1 || value === '') ? '' :
      (value < 0.00001) ? 0 : value;

    if (value == 1)
      if (element.tagName.toUpperCase() == 'IMG' && element.width) {
        element.width++; element.width--;
      } else try {
        var n = document.createTextNode(' ');
        element.appendChild(n);
        element.removeChild(n);
      } catch (e) { }

    return element;
  };
}

if ('outerHTML' in document.documentElement) {
  Element.Methods.replace = function(element, content) {
    element = $(element);

    if (content && content.toElement) content = content.toElement();
    if (Object.isElement(content)) {
      element.parentNode.replaceChild(content, element);
      return element;
    }

    content = Object.toHTML(content);
    var parent = element.parentNode, tagName = parent.tagName.toUpperCase();

    if (Element._insertionTranslations.tags[tagName]) {
      var nextSibling = element.next(),
          fragments = Element._getContentFromAnonymousElement(tagName, content.stripScripts());
      parent.removeChild(element);
      if (nextSibling)
        fragments.each(function(node) { parent.insertBefore(node, nextSibling) });
      else
        fragments.each(function(node) { parent.appendChild(node) });
    }
    else element.outerHTML = content.stripScripts();

    content.evalScripts.bind(content).defer();
    return element;
  };
}

Element._returnOffset = function(l, t) {
  var result = [l, t];
  result.left = l;
  result.top = t;
  return result;
};

Element._getContentFromAnonymousElement = function(tagName, html, force) {
  var div = new Element('div'),
      t = Element._insertionTranslations.tags[tagName];

  var workaround = false;
  if (t) workaround = true;
  else if (force) {
    workaround = true;
    t = ['', '', 0];
  }

  if (workaround) {
    div.innerHTML = '&nbsp;' + t[0] + html + t[1];
    div.removeChild(div.firstChild);
    for (var i = t[2]; i--; ) {
      div = div.firstChild;
    }
  }
  else {
    div.innerHTML = html;
  }
  return $A(div.childNodes);
};

Element._insertionTranslations = {
  before: function(element, node) {
    element.parentNode.insertBefore(node, element);
  },
  top: function(element, node) {
    element.insertBefore(node, element.firstChild);
  },
  bottom: function(element, node) {
    element.appendChild(node);
  },
  after: function(element, node) {
    element.parentNode.insertBefore(node, element.nextSibling);
  },
  tags: {
    TABLE:  ['<table>',                '</table>',                   1],
    TBODY:  ['<table><tbody>',         '</tbody></table>',           2],
    TR:     ['<table><tbody><tr>',     '</tr></tbody></table>',      3],
    TD:     ['<table><tbody><tr><td>', '</td></tr></tbody></table>', 4],
    SELECT: ['<select>',               '</select>',                  1]
  }
};

(function() {
  var tags = Element._insertionTranslations.tags;
  Object.extend(tags, {
    THEAD: tags.TBODY,
    TFOOT: tags.TBODY,
    TH:    tags.TD
  });
})();

Element.Methods.Simulated = {
  hasAttribute: function(element, attribute) {
    attribute = Element._attributeTranslations.has[attribute] || attribute;
    var node = $(element).getAttributeNode(attribute);
    return !!(node && node.specified);
  }
};

Element.Methods.ByTag = { };

Object.extend(Element, Element.Methods);

(function(div) {

  if (!Prototype.BrowserFeatures.ElementExtensions && div['__proto__']) {
    window.HTMLElement = { };
    window.HTMLElement.prototype = div['__proto__'];
    Prototype.BrowserFeatures.ElementExtensions = true;
  }

  div = null;

})(document.createElement('div'));

Element.extend = (function() {

  function checkDeficiency(tagName) {
    if (typeof window.Element != 'undefined') {
      var proto = window.Element.prototype;
      if (proto) {
        var id = '_' + (Math.random()+'').slice(2),
            el = document.createElement(tagName);
        proto[id] = 'x';
        var isBuggy = (el[id] !== 'x');
        delete proto[id];
        el = null;
        return isBuggy;
      }
    }
    return false;
  }

  function extendElementWith(element, methods) {
    for (var property in methods) {
      var value = methods[property];
      if (Object.isFunction(value) && !(property in element))
        element[property] = value.methodize();
    }
  }

  var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY = checkDeficiency('object');

  if (Prototype.BrowserFeatures.SpecificElementExtensions) {
    if (HTMLOBJECTELEMENT_PROTOTYPE_BUGGY) {
      return function(element) {
        if (element && typeof element._extendedByPrototype == 'undefined') {
          var t = element.tagName;
          if (t && (/^(?:object|applet|embed)$/i.test(t))) {
            extendElementWith(element, Element.Methods);
            extendElementWith(element, Element.Methods.Simulated);
            extendElementWith(element, Element.Methods.ByTag[t.toUpperCase()]);
          }
        }
        return element;
      }
    }
    return Prototype.K;
  }

  var Methods = { }, ByTag = Element.Methods.ByTag;

  var extend = Object.extend(function(element) {
    if (!element || typeof element._extendedByPrototype != 'undefined' ||
        element.nodeType != 1 || element == window) return element;

    var methods = Object.clone(Methods),
        tagName = element.tagName.toUpperCase();

    if (ByTag[tagName]) Object.extend(methods, ByTag[tagName]);

    extendElementWith(element, methods);

    element._extendedByPrototype = Prototype.emptyFunction;
    return element;

  }, {
    refresh: function() {
      if (!Prototype.BrowserFeatures.ElementExtensions) {
        Object.extend(Methods, Element.Methods);
        Object.extend(Methods, Element.Methods.Simulated);
      }
    }
  });

  extend.refresh();
  return extend;
})();

if (document.documentElement.hasAttribute) {
  Element.hasAttribute = function(element, attribute) {
    return element.hasAttribute(attribute);
  };
}
else {
  Element.hasAttribute = Element.Methods.Simulated.hasAttribute;
}

Element.addMethods = function(methods) {
  var F = Prototype.BrowserFeatures, T = Element.Methods.ByTag;

  if (!methods) {
    Object.extend(Form, Form.Methods);
    Object.extend(Form.Element, Form.Element.Methods);
    Object.extend(Element.Methods.ByTag, {
      "FORM":     Object.clone(Form.Methods),
      "INPUT":    Object.clone(Form.Element.Methods),
      "SELECT":   Object.clone(Form.Element.Methods),
      "TEXTAREA": Object.clone(Form.Element.Methods),
      "BUTTON":   Object.clone(Form.Element.Methods)
    });
  }

  if (arguments.length == 2) {
    var tagName = methods;
    methods = arguments[1];
  }

  if (!tagName) Object.extend(Element.Methods, methods || { });
  else {
    if (Object.isArray(tagName)) tagName.each(extend);
    else extend(tagName);
  }

  function extend(tagName) {
    tagName = tagName.toUpperCase();
    if (!Element.Methods.ByTag[tagName])
      Element.Methods.ByTag[tagName] = { };
    Object.extend(Element.Methods.ByTag[tagName], methods);
  }

  function copy(methods, destination, onlyIfAbsent) {
    onlyIfAbsent = onlyIfAbsent || false;
    for (var property in methods) {
      var value = methods[property];
      if (!Object.isFunction(value)) continue;
      if (!onlyIfAbsent || !(property in destination))
        destination[property] = value.methodize();
    }
  }

  function findDOMClass(tagName) {
    var klass;
    var trans = {
      "OPTGROUP": "OptGroup", "TEXTAREA": "TextArea", "P": "Paragraph",
      "FIELDSET": "FieldSet", "UL": "UList", "OL": "OList", "DL": "DList",
      "DIR": "Directory", "H1": "Heading", "H2": "Heading", "H3": "Heading",
      "H4": "Heading", "H5": "Heading", "H6": "Heading", "Q": "Quote",
      "INS": "Mod", "DEL": "Mod", "A": "Anchor", "IMG": "Image", "CAPTION":
      "TableCaption", "COL": "TableCol", "COLGROUP": "TableCol", "THEAD":
      "TableSection", "TFOOT": "TableSection", "TBODY": "TableSection", "TR":
      "TableRow", "TH": "TableCell", "TD": "TableCell", "FRAMESET":
      "FrameSet", "IFRAME": "IFrame"
    };
    if (trans[tagName]) klass = 'HTML' + trans[tagName] + 'Element';
    if (window[klass]) return window[klass];
    klass = 'HTML' + tagName + 'Element';
    if (window[klass]) return window[klass];
    klass = 'HTML' + tagName.capitalize() + 'Element';
    if (window[klass]) return window[klass];

    var element = document.createElement(tagName),
        proto = element['__proto__'] || element.constructor.prototype;

    element = null;
    return proto;
  }

  var elementPrototype = window.HTMLElement ? HTMLElement.prototype :
   Element.prototype;

  if (F.ElementExtensions) {
    copy(Element.Methods, elementPrototype);
    copy(Element.Methods.Simulated, elementPrototype, true);
  }

  if (F.SpecificElementExtensions) {
    for (var tag in Element.Methods.ByTag) {
      var klass = findDOMClass(tag);
      if (Object.isUndefined(klass)) continue;
      copy(T[tag], klass.prototype);
    }
  }

  Object.extend(Element, Element.Methods);
  delete Element.ByTag;

  if (Element.extend.refresh) Element.extend.refresh();
  Element.cache = { };
};


document.viewport = {

  getDimensions: function() {
    return { width: this.getWidth(), height: this.getHeight() };
  },

  getScrollOffsets: function() {
    return Element._returnOffset(
      window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft,
      window.pageYOffset || document.documentElement.scrollTop  || document.body.scrollTop);
  }
};

(function(viewport) {
  var B = Prototype.Browser, doc = document, element, property = {};

  function getRootElement() {
    if (B.WebKit && !doc.evaluate)
      return document;

    if (B.Opera && window.parseFloat(window.opera.version()) < 9.5)
      return document.body;

    return document.documentElement;
  }

  function define(D) {
    if (!element) element = getRootElement();

    property[D] = 'client' + D;

    viewport['get' + D] = function() { return element[property[D]] };
    return viewport['get' + D]();
  }

  viewport.getWidth  = define.curry('Width');

  viewport.getHeight = define.curry('Height');
})(document.viewport);


Element.Storage = {
  UID: 1
};

Element.addMethods({
  getStorage: function(element) {
    if (!(element = $(element))) return;

    var uid;
    if (element === window) {
      uid = 0;
    } else {
      if (typeof element._prototypeUID === "undefined")
        element._prototypeUID = Element.Storage.UID++;
      uid = element._prototypeUID;
    }

    if (!Element.Storage[uid])
      Element.Storage[uid] = $H();

    return Element.Storage[uid];
  },

  store: function(element, key, value) {
    if (!(element = $(element))) return;

    if (arguments.length === 2) {
      Element.getStorage(element).update(key);
    } else {
      Element.getStorage(element).set(key, value);
    }

    return element;
  },

  retrieve: function(element, key, defaultValue) {
    if (!(element = $(element))) return;
    var hash = Element.getStorage(element), value = hash.get(key);

    if (Object.isUndefined(value)) {
      hash.set(key, defaultValue);
      value = defaultValue;
    }

    return value;
  },

  clone: function(element, deep) {
    if (!(element = $(element))) return;
    var clone = element.cloneNode(deep);
    clone._prototypeUID = void 0;
    if (deep) {
      var descendants = Element.select(clone, '*'),
          i = descendants.length;
      while (i--) {
        descendants[i]._prototypeUID = void 0;
      }
    }
    return Element.extend(clone);
  },

  purge: function(element) {
    if (!(element = $(element))) return;
    var purgeElement = Element._purgeElement;

    purgeElement(element);

    var descendants = element.getElementsByTagName('*'),
     i = descendants.length;

    while (i--) purgeElement(descendants[i]);

    return null;
  }
});

(function() {

  function toDecimal(pctString) {
    var match = pctString.match(/^(\d+)%?$/i);
    if (!match) return null;
    return (Number(match[1]) / 100);
  }

  function getPixelValue(value, property, context) {
    var element = null;
    if (Object.isElement(value)) {
      element = value;
      value = element.getStyle(property);
    }

    if (value === null) {
      return null;
    }

    if ((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(value)) {
      return window.parseFloat(value);
    }

    var isPercentage = value.include('%'), isViewport = (context === document.viewport);

    if (/\d/.test(value) && element && element.runtimeStyle && !(isPercentage && isViewport)) {
      var style = element.style.left, rStyle = element.runtimeStyle.left;
      element.runtimeStyle.left = element.currentStyle.left;
      element.style.left = value || 0;
      value = element.style.pixelLeft;
      element.style.left = style;
      element.runtimeStyle.left = rStyle;

      return value;
    }

    if (element && isPercentage) {
      context = context || element.parentNode;
      var decimal = toDecimal(value);
      var whole = null;
      var position = element.getStyle('position');

      var isHorizontal = property.include('left') || property.include('right') ||
       property.include('width');

      var isVertical =  property.include('top') || property.include('bottom') ||
        property.include('height');

      if (context === document.viewport) {
        if (isHorizontal) {
          whole = document.viewport.getWidth();
        } else if (isVertical) {
          whole = document.viewport.getHeight();
        }
      } else {
        if (isHorizontal) {
          whole = $(context).measure('width');
        } else if (isVertical) {
          whole = $(context).measure('height');
        }
      }

      return (whole === null) ? 0 : whole * decimal;
    }

    return 0;
  }

  function toCSSPixels(number) {
    if (Object.isString(number) && number.endsWith('px')) {
      return number;
    }
    return number + 'px';
  }

  function isDisplayed(element) {
    var originalElement = element;
    while (element && element.parentNode) {
      var display = element.getStyle('display');
      if (display === 'none') {
        return false;
      }
      element = $(element.parentNode);
    }
    return true;
  }

  var hasLayout = Prototype.K;
  if ('currentStyle' in document.documentElement) {
    hasLayout = function(element) {
      if (!element.currentStyle.hasLayout) {
        element.style.zoom = 1;
      }
      return element;
    };
  }

  function cssNameFor(key) {
    if (key.include('border')) key = key + '-width';
    return key.camelize();
  }

  Element.Layout = Class.create(Hash, {
    initialize: function($super, element, preCompute) {
      $super();
      this.element = $(element);

      Element.Layout.PROPERTIES.each( function(property) {
        this._set(property, null);
      }, this);

      if (preCompute) {
        this._preComputing = true;
        this._begin();
        Element.Layout.PROPERTIES.each( this._compute, this );
        this._end();
        this._preComputing = false;
      }
    },

    _set: function(property, value) {
      return Hash.prototype.set.call(this, property, value);
    },

    set: function(property, value) {
      throw "Properties of Element.Layout are read-only.";
    },

    get: function($super, property) {
      var value = $super(property);
      return value === null ? this._compute(property) : value;
    },

    _begin: function() {
      if (this._prepared) return;

      var element = this.element;
      if (isDisplayed(element)) {
        this._prepared = true;
        return;
      }

      var originalStyles = {
        position:   element.style.position   || '',
        width:      element.style.width      || '',
        visibility: element.style.visibility || '',
        display:    element.style.display    || ''
      };

      element.store('prototype_original_styles', originalStyles);

      var position = element.getStyle('position'),
       width = element.getStyle('width');

      if (width === "0px" || width === null) {
        element.style.display = 'block';
        width = element.getStyle('width');
      }

      var context = (position === 'fixed') ? document.viewport :
       element.parentNode;

      element.setStyle({
        position:   'absolute',
        visibility: 'hidden',
        display:    'block'
      });

      var positionedWidth = element.getStyle('width');

      var newWidth;
      if (width && (positionedWidth === width)) {
        newWidth = getPixelValue(element, 'width', context);
      } else if (position === 'absolute' || position === 'fixed') {
        newWidth = getPixelValue(element, 'width', context);
      } else {
        var parent = element.parentNode, pLayout = $(parent).getLayout();

        newWidth = pLayout.get('width') -
         this.get('margin-left') -
         this.get('border-left') -
         this.get('padding-left') -
         this.get('padding-right') -
         this.get('border-right') -
         this.get('margin-right');
      }

      element.setStyle({ width: newWidth + 'px' });

      this._prepared = true;
    },

    _end: function() {
      var element = this.element;
      var originalStyles = element.retrieve('prototype_original_styles');
      element.store('prototype_original_styles', null);
      element.setStyle(originalStyles);
      this._prepared = false;
    },

    _compute: function(property) {
      var COMPUTATIONS = Element.Layout.COMPUTATIONS;
      if (!(property in COMPUTATIONS)) {
        throw "Property not found.";
      }

      return this._set(property, COMPUTATIONS[property].call(this, this.element));
    },

    toObject: function() {
      var args = $A(arguments);
      var keys = (args.length === 0) ? Element.Layout.PROPERTIES :
       args.join(' ').split(' ');
      var obj = {};
      keys.each( function(key) {
        if (!Element.Layout.PROPERTIES.include(key)) return;
        var value = this.get(key);
        if (value != null) obj[key] = value;
      }, this);
      return obj;
    },

    toHash: function() {
      var obj = this.toObject.apply(this, arguments);
      return new Hash(obj);
    },

    toCSS: function() {
      var args = $A(arguments);
      var keys = (args.length === 0) ? Element.Layout.PROPERTIES :
       args.join(' ').split(' ');
      var css = {};

      keys.each( function(key) {
        if (!Element.Layout.PROPERTIES.include(key)) return;
        if (Element.Layout.COMPOSITE_PROPERTIES.include(key)) return;

        var value = this.get(key);
        if (value != null) css[cssNameFor(key)] = value + 'px';
      }, this);
      return css;
    },

    inspect: function() {
      return "#<Element.Layout>";
    }
  });

  Object.extend(Element.Layout, {
    PROPERTIES: $w('height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height'),

    COMPOSITE_PROPERTIES: $w('padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height'),

    COMPUTATIONS: {
      'height': function(element) {
        if (!this._preComputing) this._begin();

        var bHeight = this.get('border-box-height');
        if (bHeight <= 0) {
          if (!this._preComputing) this._end();
          return 0;
        }

        var bTop = this.get('border-top'),
         bBottom = this.get('border-bottom');

        var pTop = this.get('padding-top'),
         pBottom = this.get('padding-bottom');

        if (!this._preComputing) this._end();

        return bHeight - bTop - bBottom - pTop - pBottom;
      },

      'width': function(element) {
        if (!this._preComputing) this._begin();

        var bWidth = this.get('border-box-width');
        if (bWidth <= 0) {
          if (!this._preComputing) this._end();
          return 0;
        }

        var bLeft = this.get('border-left'),
         bRight = this.get('border-right');

        var pLeft = this.get('padding-left'),
         pRight = this.get('padding-right');

        if (!this._preComputing) this._end();

        return bWidth - bLeft - bRight - pLeft - pRight;
      },

      'padding-box-height': function(element) {
        var height = this.get('height'),
         pTop = this.get('padding-top'),
         pBottom = this.get('padding-bottom');

        return height + pTop + pBottom;
      },

      'padding-box-width': function(element) {
        var width = this.get('width'),
         pLeft = this.get('padding-left'),
         pRight = this.get('padding-right');

        return width + pLeft + pRight;
      },

      'border-box-height': function(element) {
        if (!this._preComputing) this._begin();
        var height = element.offsetHeight;
        if (!this._preComputing) this._end();
        return height;
      },

      'border-box-width': function(element) {
        if (!this._preComputing) this._begin();
        var width = element.offsetWidth;
        if (!this._preComputing) this._end();
        return width;
      },

      'margin-box-height': function(element) {
        var bHeight = this.get('border-box-height'),
         mTop = this.get('margin-top'),
         mBottom = this.get('margin-bottom');

        if (bHeight <= 0) return 0;

        return bHeight + mTop + mBottom;
      },

      'margin-box-width': function(element) {
        var bWidth = this.get('border-box-width'),
         mLeft = this.get('margin-left'),
         mRight = this.get('margin-right');

        if (bWidth <= 0) return 0;

        return bWidth + mLeft + mRight;
      },

      'top': function(element) {
        var offset = element.positionedOffset();
        return offset.top;
      },

      'bottom': function(element) {
        var offset = element.positionedOffset(),
         parent = element.getOffsetParent(),
         pHeight = parent.measure('height');

        var mHeight = this.get('border-box-height');

        return pHeight - mHeight - offset.top;
      },

      'left': function(element) {
        var offset = element.positionedOffset();
        return offset.left;
      },

      'right': function(element) {
        var offset = element.positionedOffset(),
         parent = element.getOffsetParent(),
         pWidth = parent.measure('width');

        var mWidth = this.get('border-box-width');

        return pWidth - mWidth - offset.left;
      },

      'padding-top': function(element) {
        return getPixelValue(element, 'paddingTop');
      },

      'padding-bottom': function(element) {
        return getPixelValue(element, 'paddingBottom');
      },

      'padding-left': function(element) {
        return getPixelValue(element, 'paddingLeft');
      },

      'padding-right': function(element) {
        return getPixelValue(element, 'paddingRight');
      },

      'border-top': function(element) {
        return getPixelValue(element, 'borderTopWidth');
      },

      'border-bottom': function(element) {
        return getPixelValue(element, 'borderBottomWidth');
      },

      'border-left': function(element) {
        return getPixelValue(element, 'borderLeftWidth');
      },

      'border-right': function(element) {
        return getPixelValue(element, 'borderRightWidth');
      },

      'margin-top': function(element) {
        return getPixelValue(element, 'marginTop');
      },

      'margin-bottom': function(element) {
        return getPixelValue(element, 'marginBottom');
      },

      'margin-left': function(element) {
        return getPixelValue(element, 'marginLeft');
      },

      'margin-right': function(element) {
        return getPixelValue(element, 'marginRight');
      }
    }
  });

  if ('getBoundingClientRect' in document.documentElement) {
    Object.extend(Element.Layout.COMPUTATIONS, {
      'right': function(element) {
        var parent = hasLayout(element.getOffsetParent());
        var rect = element.getBoundingClientRect(),
         pRect = parent.getBoundingClientRect();

        return (pRect.right - rect.right).round();
      },

      'bottom': function(element) {
        var parent = hasLayout(element.getOffsetParent());
        var rect = element.getBoundingClientRect(),
         pRect = parent.getBoundingClientRect();

        return (pRect.bottom - rect.bottom).round();
      }
    });
  }

  Element.Offset = Class.create({
    initialize: function(left, top) {
      this.left = left.round();
      this.top  = top.round();

      this[0] = this.left;
      this[1] = this.top;
    },

    relativeTo: function(offset) {
      return new Element.Offset(
        this.left - offset.left,
        this.top  - offset.top
      );
    },

    inspect: function() {
      return "#<Element.Offset left: #{left} top: #{top}>".interpolate(this);
    },

    toString: function() {
      return "[#{left}, #{top}]".interpolate(this);
    },

    toArray: function() {
      return [this.left, this.top];
    }
  });

  function getLayout(element, preCompute) {
    return new Element.Layout(element, preCompute);
  }

  function measure(element, property) {
    return $(element).getLayout().get(property);
  }

  function getDimensions(element) {
    element = $(element);
    var display = Element.getStyle(element, 'display');

    if (display && display !== 'none') {
      return { width: element.offsetWidth, height: element.offsetHeight };
    }

    var style = element.style;
    var originalStyles = {
      visibility: style.visibility,
      position:   style.position,
      display:    style.display
    };

    var newStyles = {
      visibility: 'hidden',
      display:    'block'
    };

    if (originalStyles.position !== 'fixed')
      newStyles.position = 'absolute';

    Element.setStyle(element, newStyles);

    var dimensions = {
      width:  element.offsetWidth,
      height: element.offsetHeight
    };

    Element.setStyle(element, originalStyles);

    return dimensions;
  }

  function getOffsetParent(element) {
    element = $(element);

    if (isDocument(element) || isDetached(element) || isBody(element) || isHtml(element))
      return $(document.body);

    var isInline = (Element.getStyle(element, 'display') === 'inline');
    if (!isInline && element.offsetParent) return $(element.offsetParent);

    while ((element = element.parentNode) && element !== document.body) {
      if (Element.getStyle(element, 'position') !== 'static') {
        return isHtml(element) ? $(document.body) : $(element);
      }
    }

    return $(document.body);
  }


  function cumulativeOffset(element) {
    element = $(element);
    var valueT = 0, valueL = 0;
    if (element.parentNode) {
      do {
        valueT += element.offsetTop  || 0;
        valueL += element.offsetLeft || 0;
        element = element.offsetParent;
      } while (element);
    }
    return new Element.Offset(valueL, valueT);
  }

  function positionedOffset(element) {
    element = $(element);

    var layout = element.getLayout();

    var valueT = 0, valueL = 0;
    do {
      valueT += element.offsetTop  || 0;
      valueL += element.offsetLeft || 0;
      element = element.offsetParent;
      if (element) {
        if (isBody(element)) break;
        var p = Element.getStyle(element, 'position');
        if (p !== 'static') break;
      }
    } while (element);

    valueL -= layout.get('margin-top');
    valueT -= layout.get('margin-left');

    return new Element.Offset(valueL, valueT);
  }

  function cumulativeScrollOffset(element) {
    var valueT = 0, valueL = 0;
    do {
      valueT += element.scrollTop  || 0;
      valueL += element.scrollLeft || 0;
      element = element.parentNode;
    } while (element);
    return new Element.Offset(valueL, valueT);
  }

  function viewportOffset(forElement) {
    element = $(element);
    var valueT = 0, valueL = 0, docBody = document.body;

    var element = forElement;
    do {
      valueT += element.offsetTop  || 0;
      valueL += element.offsetLeft || 0;
      if (element.offsetParent == docBody &&
        Element.getStyle(element, 'position') == 'absolute') break;
    } while (element = element.offsetParent);

    element = forElement;
    do {
      if (element != docBody) {
        valueT -= element.scrollTop  || 0;
        valueL -= element.scrollLeft || 0;
      }
    } while (element = element.parentNode);
    return new Element.Offset(valueL, valueT);
  }

  function absolutize(element) {
    element = $(element);

    if (Element.getStyle(element, 'position') === 'absolute') {
      return element;
    }

    var offsetParent = getOffsetParent(element);
    var eOffset = element.viewportOffset(),
     pOffset = offsetParent.viewportOffset();

    var offset = eOffset.relativeTo(pOffset);
    var layout = element.getLayout();

    element.store('prototype_absolutize_original_styles', {
      left:   element.getStyle('left'),
      top:    element.getStyle('top'),
      width:  element.getStyle('width'),
      height: element.getStyle('height')
    });

    element.setStyle({
      position: 'absolute',
      top:    offset.top + 'px',
      left:   offset.left + 'px',
      width:  layout.get('width') + 'px',
      height: layout.get('height') + 'px'
    });

    return element;
  }

  function relativize(element) {
    element = $(element);
    if (Element.getStyle(element, 'position') === 'relative') {
      return element;
    }

    var originalStyles =
     element.retrieve('prototype_absolutize_original_styles');

    if (originalStyles) element.setStyle(originalStyles);
    return element;
  }

  if (Prototype.Browser.IE) {
    getOffsetParent = getOffsetParent.wrap(
      function(proceed, element) {
        element = $(element);

        if (isDocument(element) || isDetached(element) || isBody(element) || isHtml(element))
          return $(document.body);

        var position = element.getStyle('position');
        if (position !== 'static') return proceed(element);

        element.setStyle({ position: 'relative' });
        var value = proceed(element);
        element.setStyle({ position: position });
        return value;
      }
    );

    positionedOffset = positionedOffset.wrap(function(proceed, element) {
      element = $(element);
      if (!element.parentNode) return new Element.Offset(0, 0);
      var position = element.getStyle('position');
      if (position !== 'static') return proceed(element);

      var offsetParent = element.getOffsetParent();
      if (offsetParent && offsetParent.getStyle('position') === 'fixed')
        hasLayout(offsetParent);

      element.setStyle({ position: 'relative' });
      var value = proceed(element);
      element.setStyle({ position: position });
      return value;
    });
  } else if (Prototype.Browser.Webkit) {
    cumulativeOffset = function(element) {
      element = $(element);
      var valueT = 0, valueL = 0;
      do {
        valueT += element.offsetTop  || 0;
        valueL += element.offsetLeft || 0;
        if (element.offsetParent == document.body)
          if (Element.getStyle(element, 'position') == 'absolute') break;

        element = element.offsetParent;
      } while (element);

      return new Element.Offset(valueL, valueT);
    };
  }


  Element.addMethods({
    getLayout:              getLayout,
    measure:                measure,
    getDimensions:          getDimensions,
    getOffsetParent:        getOffsetParent,
    cumulativeOffset:       cumulativeOffset,
    positionedOffset:       positionedOffset,
    cumulativeScrollOffset: cumulativeScrollOffset,
    viewportOffset:         viewportOffset,
    absolutize:             absolutize,
    relativize:             relativize
  });

  function isBody(element) {
    return element.nodeName.toUpperCase() === 'BODY';
  }

  function isHtml(element) {
    return element.nodeName.toUpperCase() === 'HTML';
  }

  function isDocument(element) {
    return element.nodeType === Node.DOCUMENT_NODE;
  }

  function isDetached(element) {
    return element !== document.body &&
     !Element.descendantOf(element, document.body);
  }

  if ('getBoundingClientRect' in document.documentElement) {
    Element.addMethods({
      viewportOffset: function(element) {
        element = $(element);
        if (isDetached(element)) return new Element.Offset(0, 0);

        var rect = element.getBoundingClientRect(),
         docEl = document.documentElement;
        return new Element.Offset(rect.left - docEl.clientLeft,
         rect.top - docEl.clientTop);
      }
    });
  }
})();
window.$$ = function() {
  var expression = $A(arguments).join(', ');
  return Prototype.Selector.select(expression, document);
};

Prototype.Selector = (function() {

  function select() {
    throw new Error('Method "Prototype.Selector.select" must be defined.');
  }

  function match() {
    throw new Error('Method "Prototype.Selector.match" must be defined.');
  }

  function find(elements, expression, index) {
    index = index || 0;
    var match = Prototype.Selector.match, length = elements.length, matchIndex = 0, i;

    for (i = 0; i < length; i++) {
      if (match(elements[i], expression) && index == matchIndex++) {
        return Element.extend(elements[i]);
      }
    }
  }

  function extendElements(elements) {
    for (var i = 0, length = elements.length; i < length; i++) {
      Element.extend(elements[i]);
    }
    return elements;
  }


  var K = Prototype.K;

  return {
    select: select,
    match: match,
    find: find,
    extendElements: (Element.extend === K) ? K : extendElements,
    extendElement: Element.extend
  };
})();
Prototype._original_property = window.Sizzle;
/*!
 * Sizzle CSS Selector Engine - v1.0
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){

var chunker = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,
	done = 0,
	toString = Object.prototype.toString,
	hasDuplicate = false,
	baseHasDuplicate = true;

[0, 0].sort(function(){
	baseHasDuplicate = false;
	return 0;
});

var Sizzle = function(selector, context, results, seed) {
	results = results || [];
	var origContext = context = context || document;

	if ( context.nodeType !== 1 && context.nodeType !== 9 ) {
		return [];
	}

	if ( !selector || typeof selector !== "string" ) {
		return results;
	}

	var parts = [], m, set, checkSet, check, mode, extra, prune = true, contextXML = isXML(context),
		soFar = selector;

	while ( (chunker.exec(""), m = chunker.exec(soFar)) !== null ) {
		soFar = m[3];

		parts.push( m[1] );

		if ( m[2] ) {
			extra = m[3];
			break;
		}
	}

	if ( parts.length > 1 && origPOS.exec( selector ) ) {
		if ( parts.length === 2 && Expr.relative[ parts[0] ] ) {
			set = posProcess( parts[0] + parts[1], context );
		} else {
			set = Expr.relative[ parts[0] ] ?
				[ context ] :
				Sizzle( parts.shift(), context );

			while ( parts.length ) {
				selector = parts.shift();

				if ( Expr.relative[ selector ] )
					selector += parts.shift();

				set = posProcess( selector, set );
			}
		}
	} else {
		if ( !seed && parts.length > 1 && context.nodeType === 9 && !contextXML &&
				Expr.match.ID.test(parts[0]) && !Expr.match.ID.test(parts[parts.length - 1]) ) {
			var ret = Sizzle.find( parts.shift(), context, contextXML );
			context = ret.expr ? Sizzle.filter( ret.expr, ret.set )[0] : ret.set[0];
		}

		if ( context ) {
			var ret = seed ?
				{ expr: parts.pop(), set: makeArray(seed) } :
				Sizzle.find( parts.pop(), parts.length === 1 && (parts[0] === "~" || parts[0] === "+") && context.parentNode ? context.parentNode : context, contextXML );
			set = ret.expr ? Sizzle.filter( ret.expr, ret.set ) : ret.set;

			if ( parts.length > 0 ) {
				checkSet = makeArray(set);
			} else {
				prune = false;
			}

			while ( parts.length ) {
				var cur = parts.pop(), pop = cur;

				if ( !Expr.relative[ cur ] ) {
					cur = "";
				} else {
					pop = parts.pop();
				}

				if ( pop == null ) {
					pop = context;
				}

				Expr.relative[ cur ]( checkSet, pop, contextXML );
			}
		} else {
			checkSet = parts = [];
		}
	}

	if ( !checkSet ) {
		checkSet = set;
	}

	if ( !checkSet ) {
		throw "Syntax error, unrecognized expression: " + (cur || selector);
	}

	if ( toString.call(checkSet) === "[object Array]" ) {
		if ( !prune ) {
			results.push.apply( results, checkSet );
		} else if ( context && context.nodeType === 1 ) {
			for ( var i = 0; checkSet[i] != null; i++ ) {
				if ( checkSet[i] && (checkSet[i] === true || checkSet[i].nodeType === 1 && contains(context, checkSet[i])) ) {
					results.push( set[i] );
				}
			}
		} else {
			for ( var i = 0; checkSet[i] != null; i++ ) {
				if ( checkSet[i] && checkSet[i].nodeType === 1 ) {
					results.push( set[i] );
				}
			}
		}
	} else {
		makeArray( checkSet, results );
	}

	if ( extra ) {
		Sizzle( extra, origContext, results, seed );
		Sizzle.uniqueSort( results );
	}

	return results;
};

Sizzle.uniqueSort = function(results){
	if ( sortOrder ) {
		hasDuplicate = baseHasDuplicate;
		results.sort(sortOrder);

		if ( hasDuplicate ) {
			for ( var i = 1; i < results.length; i++ ) {
				if ( results[i] === results[i-1] ) {
					results.splice(i--, 1);
				}
			}
		}
	}

	return results;
};

Sizzle.matches = function(expr, set){
	return Sizzle(expr, null, null, set);
};

Sizzle.find = function(expr, context, isXML){
	var set, match;

	if ( !expr ) {
		return [];
	}

	for ( var i = 0, l = Expr.order.length; i < l; i++ ) {
		var type = Expr.order[i], match;

		if ( (match = Expr.leftMatch[ type ].exec( expr )) ) {
			var left = match[1];
			match.splice(1,1);

			if ( left.substr( left.length - 1 ) !== "\\" ) {
				match[1] = (match[1] || "").replace(/\\/g, "");
				set = Expr.find[ type ]( match, context, isXML );
				if ( set != null ) {
					expr = expr.replace( Expr.match[ type ], "" );
					break;
				}
			}
		}
	}

	if ( !set ) {
		set = context.getElementsByTagName("*");
	}

	return {set: set, expr: expr};
};

Sizzle.filter = function(expr, set, inplace, not){
	var old = expr, result = [], curLoop = set, match, anyFound,
		isXMLFilter = set && set[0] && isXML(set[0]);

	while ( expr && set.length ) {
		for ( var type in Expr.filter ) {
			if ( (match = Expr.match[ type ].exec( expr )) != null ) {
				var filter = Expr.filter[ type ], found, item;
				anyFound = false;

				if ( curLoop == result ) {
					result = [];
				}

				if ( Expr.preFilter[ type ] ) {
					match = Expr.preFilter[ type ]( match, curLoop, inplace, result, not, isXMLFilter );

					if ( !match ) {
						anyFound = found = true;
					} else if ( match === true ) {
						continue;
					}
				}

				if ( match ) {
					for ( var i = 0; (item = curLoop[i]) != null; i++ ) {
						if ( item ) {
							found = filter( item, match, i, curLoop );
							var pass = not ^ !!found;

							if ( inplace && found != null ) {
								if ( pass ) {
									anyFound = true;
								} else {
									curLoop[i] = false;
								}
							} else if ( pass ) {
								result.push( item );
								anyFound = true;
							}
						}
					}
				}

				if ( found !== undefined ) {
					if ( !inplace ) {
						curLoop = result;
					}

					expr = expr.replace( Expr.match[ type ], "" );

					if ( !anyFound ) {
						return [];
					}

					break;
				}
			}
		}

		if ( expr == old ) {
			if ( anyFound == null ) {
				throw "Syntax error, unrecognized expression: " + expr;
			} else {
				break;
			}
		}

		old = expr;
	}

	return curLoop;
};

var Expr = Sizzle.selectors = {
	order: [ "ID", "NAME", "TAG" ],
	match: {
		ID: /#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,
		CLASS: /\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,
		NAME: /\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,
		ATTR: /\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,
		TAG: /^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,
		CHILD: /:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,
		POS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,
		PSEUDO: /:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/
	},
	leftMatch: {},
	attrMap: {
		"class": "className",
		"for": "htmlFor"
	},
	attrHandle: {
		href: function(elem){
			return elem.getAttribute("href");
		}
	},
	relative: {
		"+": function(checkSet, part, isXML){
			var isPartStr = typeof part === "string",
				isTag = isPartStr && !/\W/.test(part),
				isPartStrNotTag = isPartStr && !isTag;

			if ( isTag && !isXML ) {
				part = part.toUpperCase();
			}

			for ( var i = 0, l = checkSet.length, elem; i < l; i++ ) {
				if ( (elem = checkSet[i]) ) {
					while ( (elem = elem.previousSibling) && elem.nodeType !== 1 ) {}

					checkSet[i] = isPartStrNotTag || elem && elem.nodeName === part ?
						elem || false :
						elem === part;
				}
			}

			if ( isPartStrNotTag ) {
				Sizzle.filter( part, checkSet, true );
			}
		},
		">": function(checkSet, part, isXML){
			var isPartStr = typeof part === "string";

			if ( isPartStr && !/\W/.test(part) ) {
				part = isXML ? part : part.toUpperCase();

				for ( var i = 0, l = checkSet.length; i < l; i++ ) {
					var elem = checkSet[i];
					if ( elem ) {
						var parent = elem.parentNode;
						checkSet[i] = parent.nodeName === part ? parent : false;
					}
				}
			} else {
				for ( var i = 0, l = checkSet.length; i < l; i++ ) {
					var elem = checkSet[i];
					if ( elem ) {
						checkSet[i] = isPartStr ?
							elem.parentNode :
							elem.parentNode === part;
					}
				}

				if ( isPartStr ) {
					Sizzle.filter( part, checkSet, true );
				}
			}
		},
		"": function(checkSet, part, isXML){
			var doneName = done++, checkFn = dirCheck;

			if ( !/\W/.test(part) ) {
				var nodeCheck = part = isXML ? part : part.toUpperCase();
				checkFn = dirNodeCheck;
			}

			checkFn("parentNode", part, doneName, checkSet, nodeCheck, isXML);
		},
		"~": function(checkSet, part, isXML){
			var doneName = done++, checkFn = dirCheck;

			if ( typeof part === "string" && !/\W/.test(part) ) {
				var nodeCheck = part = isXML ? part : part.toUpperCase();
				checkFn = dirNodeCheck;
			}

			checkFn("previousSibling", part, doneName, checkSet, nodeCheck, isXML);
		}
	},
	find: {
		ID: function(match, context, isXML){
			if ( typeof context.getElementById !== "undefined" && !isXML ) {
				var m = context.getElementById(match[1]);
				return m ? [m] : [];
			}
		},
		NAME: function(match, context, isXML){
			if ( typeof context.getElementsByName !== "undefined" ) {
				var ret = [], results = context.getElementsByName(match[1]);

				for ( var i = 0, l = results.length; i < l; i++ ) {
					if ( results[i].getAttribute("name") === match[1] ) {
						ret.push( results[i] );
					}
				}

				return ret.length === 0 ? null : ret;
			}
		},
		TAG: function(match, context){
			return context.getElementsByTagName(match[1]);
		}
	},
	preFilter: {
		CLASS: function(match, curLoop, inplace, result, not, isXML){
			match = " " + match[1].replace(/\\/g, "") + " ";

			if ( isXML ) {
				return match;
			}

			for ( var i = 0, elem; (elem = curLoop[i]) != null; i++ ) {
				if ( elem ) {
					if ( not ^ (elem.className && (" " + elem.className + " ").indexOf(match) >= 0) ) {
						if ( !inplace )
							result.push( elem );
					} else if ( inplace ) {
						curLoop[i] = false;
					}
				}
			}

			return false;
		},
		ID: function(match){
			return match[1].replace(/\\/g, "");
		},
		TAG: function(match, curLoop){
			for ( var i = 0; curLoop[i] === false; i++ ){}
			return curLoop[i] && isXML(curLoop[i]) ? match[1] : match[1].toUpperCase();
		},
		CHILD: function(match){
			if ( match[1] == "nth" ) {
				var test = /(-?)(\d*)n((?:\+|-)?\d*)/.exec(
					match[2] == "even" && "2n" || match[2] == "odd" && "2n+1" ||
					!/\D/.test( match[2] ) && "0n+" + match[2] || match[2]);

				match[2] = (test[1] + (test[2] || 1)) - 0;
				match[3] = test[3] - 0;
			}

			match[0] = done++;

			return match;
		},
		ATTR: function(match, curLoop, inplace, result, not, isXML){
			var name = match[1].replace(/\\/g, "");

			if ( !isXML && Expr.attrMap[name] ) {
				match[1] = Expr.attrMap[name];
			}

			if ( match[2] === "~=" ) {
				match[4] = " " + match[4] + " ";
			}

			return match;
		},
		PSEUDO: function(match, curLoop, inplace, result, not){
			if ( match[1] === "not" ) {
				if ( ( chunker.exec(match[3]) || "" ).length > 1 || /^\w/.test(match[3]) ) {
					match[3] = Sizzle(match[3], null, null, curLoop);
				} else {
					var ret = Sizzle.filter(match[3], curLoop, inplace, true ^ not);
					if ( !inplace ) {
						result.push.apply( result, ret );
					}
					return false;
				}
			} else if ( Expr.match.POS.test( match[0] ) || Expr.match.CHILD.test( match[0] ) ) {
				return true;
			}

			return match;
		},
		POS: function(match){
			match.unshift( true );
			return match;
		}
	},
	filters: {
		enabled: function(elem){
			return elem.disabled === false && elem.type !== "hidden";
		},
		disabled: function(elem){
			return elem.disabled === true;
		},
		checked: function(elem){
			return elem.checked === true;
		},
		selected: function(elem){
			elem.parentNode.selectedIndex;
			return elem.selected === true;
		},
		parent: function(elem){
			return !!elem.firstChild;
		},
		empty: function(elem){
			return !elem.firstChild;
		},
		has: function(elem, i, match){
			return !!Sizzle( match[3], elem ).length;
		},
		header: function(elem){
			return /h\d/i.test( elem.nodeName );
		},
		text: function(elem){
			return "text" === elem.type;
		},
		radio: function(elem){
			return "radio" === elem.type;
		},
		checkbox: function(elem){
			return "checkbox" === elem.type;
		},
		file: function(elem){
			return "file" === elem.type;
		},
		password: function(elem){
			return "password" === elem.type;
		},
		submit: function(elem){
			return "submit" === elem.type;
		},
		image: function(elem){
			return "image" === elem.type;
		},
		reset: function(elem){
			return "reset" === elem.type;
		},
		button: function(elem){
			return "button" === elem.type || elem.nodeName.toUpperCase() === "BUTTON";
		},
		input: function(elem){
			return /input|select|textarea|button/i.test(elem.nodeName);
		}
	},
	setFilters: {
		first: function(elem, i){
			return i === 0;
		},
		last: function(elem, i, match, array){
			return i === array.length - 1;
		},
		even: function(elem, i){
			return i % 2 === 0;
		},
		odd: function(elem, i){
			return i % 2 === 1;
		},
		lt: function(elem, i, match){
			return i < match[3] - 0;
		},
		gt: function(elem, i, match){
			return i > match[3] - 0;
		},
		nth: function(elem, i, match){
			return match[3] - 0 == i;
		},
		eq: function(elem, i, match){
			return match[3] - 0 == i;
		}
	},
	filter: {
		PSEUDO: function(elem, match, i, array){
			var name = match[1], filter = Expr.filters[ name ];

			if ( filter ) {
				return filter( elem, i, match, array );
			} else if ( name === "contains" ) {
				return (elem.textContent || elem.innerText || "").indexOf(match[3]) >= 0;
			} else if ( name === "not" ) {
				var not = match[3];

				for ( var i = 0, l = not.length; i < l; i++ ) {
					if ( not[i] === elem ) {
						return false;
					}
				}

				return true;
			}
		},
		CHILD: function(elem, match){
			var type = match[1], node = elem;
			switch (type) {
				case 'only':
				case 'first':
					while ( (node = node.previousSibling) )  {
						if ( node.nodeType === 1 ) return false;
					}
					if ( type == 'first') return true;
					node = elem;
				case 'last':
					while ( (node = node.nextSibling) )  {
						if ( node.nodeType === 1 ) return false;
					}
					return true;
				case 'nth':
					var first = match[2], last = match[3];

					if ( first == 1 && last == 0 ) {
						return true;
					}

					var doneName = match[0],
						parent = elem.parentNode;

					if ( parent && (parent.sizcache !== doneName || !elem.nodeIndex) ) {
						var count = 0;
						for ( node = parent.firstChild; node; node = node.nextSibling ) {
							if ( node.nodeType === 1 ) {
								node.nodeIndex = ++count;
							}
						}
						parent.sizcache = doneName;
					}

					var diff = elem.nodeIndex - last;
					if ( first == 0 ) {
						return diff == 0;
					} else {
						return ( diff % first == 0 && diff / first >= 0 );
					}
			}
		},
		ID: function(elem, match){
			return elem.nodeType === 1 && elem.getAttribute("id") === match;
		},
		TAG: function(elem, match){
			return (match === "*" && elem.nodeType === 1) || elem.nodeName === match;
		},
		CLASS: function(elem, match){
			return (" " + (elem.className || elem.getAttribute("class")) + " ")
				.indexOf( match ) > -1;
		},
		ATTR: function(elem, match){
			var name = match[1],
				result = Expr.attrHandle[ name ] ?
					Expr.attrHandle[ name ]( elem ) :
					elem[ name ] != null ?
						elem[ name ] :
						elem.getAttribute( name ),
				value = result + "",
				type = match[2],
				check = match[4];

			return result == null ?
				type === "!=" :
				type === "=" ?
				value === check :
				type === "*=" ?
				value.indexOf(check) >= 0 :
				type === "~=" ?
				(" " + value + " ").indexOf(check) >= 0 :
				!check ?
				value && result !== false :
				type === "!=" ?
				value != check :
				type === "^=" ?
				value.indexOf(check) === 0 :
				type === "$=" ?
				value.substr(value.length - check.length) === check :
				type === "|=" ?
				value === check || value.substr(0, check.length + 1) === check + "-" :
				false;
		},
		POS: function(elem, match, i, array){
			var name = match[2], filter = Expr.setFilters[ name ];

			if ( filter ) {
				return filter( elem, i, match, array );
			}
		}
	}
};

var origPOS = Expr.match.POS;

for ( var type in Expr.match ) {
	Expr.match[ type ] = new RegExp( Expr.match[ type ].source + /(?![^\[]*\])(?![^\(]*\))/.source );
	Expr.leftMatch[ type ] = new RegExp( /(^(?:.|\r|\n)*?)/.source + Expr.match[ type ].source );
}

var makeArray = function(array, results) {
	array = Array.prototype.slice.call( array, 0 );

	if ( results ) {
		results.push.apply( results, array );
		return results;
	}

	return array;
};

try {
	Array.prototype.slice.call( document.documentElement.childNodes, 0 );

} catch(e){
	makeArray = function(array, results) {
		var ret = results || [];

		if ( toString.call(array) === "[object Array]" ) {
			Array.prototype.push.apply( ret, array );
		} else {
			if ( typeof array.length === "number" ) {
				for ( var i = 0, l = array.length; i < l; i++ ) {
					ret.push( array[i] );
				}
			} else {
				for ( var i = 0; array[i]; i++ ) {
					ret.push( array[i] );
				}
			}
		}

		return ret;
	};
}

var sortOrder;

if ( document.documentElement.compareDocumentPosition ) {
	sortOrder = function( a, b ) {
		if ( !a.compareDocumentPosition || !b.compareDocumentPosition ) {
			if ( a == b ) {
				hasDuplicate = true;
			}
			return 0;
		}

		var ret = a.compareDocumentPosition(b) & 4 ? -1 : a === b ? 0 : 1;
		if ( ret === 0 ) {
			hasDuplicate = true;
		}
		return ret;
	};
} else if ( "sourceIndex" in document.documentElement ) {
	sortOrder = function( a, b ) {
		if ( !a.sourceIndex || !b.sourceIndex ) {
			if ( a == b ) {
				hasDuplicate = true;
			}
			return 0;
		}

		var ret = a.sourceIndex - b.sourceIndex;
		if ( ret === 0 ) {
			hasDuplicate = true;
		}
		return ret;
	};
} else if ( document.createRange ) {
	sortOrder = function( a, b ) {
		if ( !a.ownerDocument || !b.ownerDocument ) {
			if ( a == b ) {
				hasDuplicate = true;
			}
			return 0;
		}

		var aRange = a.ownerDocument.createRange(), bRange = b.ownerDocument.createRange();
		aRange.setStart(a, 0);
		aRange.setEnd(a, 0);
		bRange.setStart(b, 0);
		bRange.setEnd(b, 0);
		var ret = aRange.compareBoundaryPoints(Range.START_TO_END, bRange);
		if ( ret === 0 ) {
			hasDuplicate = true;
		}
		return ret;
	};
}

(function(){
	var form = document.createElement("div"),
		id = "script" + (new Date).getTime();
	form.innerHTML = "<a name='" + id + "'/>";

	var root = document.documentElement;
	root.insertBefore( form, root.firstChild );

	if ( !!document.getElementById( id ) ) {
		Expr.find.ID = function(match, context, isXML){
			if ( typeof context.getElementById !== "undefined" && !isXML ) {
				var m = context.getElementById(match[1]);
				return m ? m.id === match[1] || typeof m.getAttributeNode !== "undefined" && m.getAttributeNode("id").nodeValue === match[1] ? [m] : undefined : [];
			}
		};

		Expr.filter.ID = function(elem, match){
			var node = typeof elem.getAttributeNode !== "undefined" && elem.getAttributeNode("id");
			return elem.nodeType === 1 && node && node.nodeValue === match;
		};
	}

	root.removeChild( form );
	root = form = null; // release memory in IE
})();

(function(){

	var div = document.createElement("div");
	div.appendChild( document.createComment("") );

	if ( div.getElementsByTagName("*").length > 0 ) {
		Expr.find.TAG = function(match, context){
			var results = context.getElementsByTagName(match[1]);

			if ( match[1] === "*" ) {
				var tmp = [];

				for ( var i = 0; results[i]; i++ ) {
					if ( results[i].nodeType === 1 ) {
						tmp.push( results[i] );
					}
				}

				results = tmp;
			}

			return results;
		};
	}

	div.innerHTML = "<a href='#'></a>";
	if ( div.firstChild && typeof div.firstChild.getAttribute !== "undefined" &&
			div.firstChild.getAttribute("href") !== "#" ) {
		Expr.attrHandle.href = function(elem){
			return elem.getAttribute("href", 2);
		};
	}

	div = null; // release memory in IE
})();

if ( document.querySelectorAll ) (function(){
	var oldSizzle = Sizzle, div = document.createElement("div");
	div.innerHTML = "<p class='TEST'></p>";

	if ( div.querySelectorAll && div.querySelectorAll(".TEST").length === 0 ) {
		return;
	}

	Sizzle = function(query, context, extra, seed){
		context = context || document;

		if ( !seed && context.nodeType === 9 && !isXML(context) ) {
			try {
				return makeArray( context.querySelectorAll(query), extra );
			} catch(e){}
		}

		return oldSizzle(query, context, extra, seed);
	};

	for ( var prop in oldSizzle ) {
		Sizzle[ prop ] = oldSizzle[ prop ];
	}

	div = null; // release memory in IE
})();

if ( document.getElementsByClassName && document.documentElement.getElementsByClassName ) (function(){
	var div = document.createElement("div");
	div.innerHTML = "<div class='test e'></div><div class='test'></div>";

	if ( div.getElementsByClassName("e").length === 0 )
		return;

	div.lastChild.className = "e";

	if ( div.getElementsByClassName("e").length === 1 )
		return;

	Expr.order.splice(1, 0, "CLASS");
	Expr.find.CLASS = function(match, context, isXML) {
		if ( typeof context.getElementsByClassName !== "undefined" && !isXML ) {
			return context.getElementsByClassName(match[1]);
		}
	};

	div = null; // release memory in IE
})();

function dirNodeCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {
	var sibDir = dir == "previousSibling" && !isXML;
	for ( var i = 0, l = checkSet.length; i < l; i++ ) {
		var elem = checkSet[i];
		if ( elem ) {
			if ( sibDir && elem.nodeType === 1 ){
				elem.sizcache = doneName;
				elem.sizset = i;
			}
			elem = elem[dir];
			var match = false;

			while ( elem ) {
				if ( elem.sizcache === doneName ) {
					match = checkSet[elem.sizset];
					break;
				}

				if ( elem.nodeType === 1 && !isXML ){
					elem.sizcache = doneName;
					elem.sizset = i;
				}

				if ( elem.nodeName === cur ) {
					match = elem;
					break;
				}

				elem = elem[dir];
			}

			checkSet[i] = match;
		}
	}
}

function dirCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {
	var sibDir = dir == "previousSibling" && !isXML;
	for ( var i = 0, l = checkSet.length; i < l; i++ ) {
		var elem = checkSet[i];
		if ( elem ) {
			if ( sibDir && elem.nodeType === 1 ) {
				elem.sizcache = doneName;
				elem.sizset = i;
			}
			elem = elem[dir];
			var match = false;

			while ( elem ) {
				if ( elem.sizcache === doneName ) {
					match = checkSet[elem.sizset];
					break;
				}

				if ( elem.nodeType === 1 ) {
					if ( !isXML ) {
						elem.sizcache = doneName;
						elem.sizset = i;
					}
					if ( typeof cur !== "string" ) {
						if ( elem === cur ) {
							match = true;
							break;
						}

					} else if ( Sizzle.filter( cur, [elem] ).length > 0 ) {
						match = elem;
						break;
					}
				}

				elem = elem[dir];
			}

			checkSet[i] = match;
		}
	}
}

var contains = document.compareDocumentPosition ?  function(a, b){
	return a.compareDocumentPosition(b) & 16;
} : function(a, b){
	return a !== b && (a.contains ? a.contains(b) : true);
};

var isXML = function(elem){
	return elem.nodeType === 9 && elem.documentElement.nodeName !== "HTML" ||
		!!elem.ownerDocument && elem.ownerDocument.documentElement.nodeName !== "HTML";
};

var posProcess = function(selector, context){
	var tmpSet = [], later = "", match,
		root = context.nodeType ? [context] : context;

	while ( (match = Expr.match.PSEUDO.exec( selector )) ) {
		later += match[0];
		selector = selector.replace( Expr.match.PSEUDO, "" );
	}

	selector = Expr.relative[selector] ? selector + "*" : selector;

	for ( var i = 0, l = root.length; i < l; i++ ) {
		Sizzle( selector, root[i], tmpSet );
	}

	return Sizzle.filter( later, tmpSet );
};


window.Sizzle = Sizzle;

})();

;(function(engine) {
  var extendElements = Prototype.Selector.extendElements;

  function select(selector, scope) {
    return extendElements(engine(selector, scope || document));
  }

  function match(element, selector) {
    return engine.matches(selector, [element]).length == 1;
  }

  Prototype.Selector.engine = engine;
  Prototype.Selector.select = select;
  Prototype.Selector.match = match;
})(Sizzle);

window.Sizzle = Prototype._original_property;
delete Prototype._original_property;

var Form = {
  reset: function(form) {
    form = $(form);
    form.reset();
    return form;
  },

  serializeElements: function(elements, options) {
    if (typeof options != 'object') options = { hash: !!options };
    else if (Object.isUndefined(options.hash)) options.hash = true;
    var key, value, submitted = false, submit = options.submit, accumulator, initial;

    if (options.hash) {
      initial = {};
      accumulator = function(result, key, value) {
        if (key in result) {
          if (!Object.isArray(result[key])) result[key] = [result[key]];
          result[key].push(value);
        } else result[key] = value;
        return result;
      };
    } else {
      initial = '';
      accumulator = function(result, key, value) {
        return result + (result ? '&' : '') + encodeURIComponent(key) + '=' + encodeURIComponent(value);
      }
    }

    return elements.inject(initial, function(result, element) {
      if (!element.disabled && element.name) {
        key = element.name; value = $(element).getValue();
        if (value != null && element.type != 'file' && (element.type != 'submit' || (!submitted &&
            submit !== false && (!submit || key == submit) && (submitted = true)))) {
          result = accumulator(result, key, value);
        }
      }
      return result;
    });
  }
};

Form.Methods = {
  serialize: function(form, options) {
    return Form.serializeElements(Form.getElements(form), options);
  },

  getElements: function(form) {
    var elements = $(form).getElementsByTagName('*'),
        element,
        arr = [ ],
        serializers = Form.Element.Serializers;
    for (var i = 0; element = elements[i]; i++) {
      arr.push(element);
    }
    return arr.inject([], function(elements, child) {
      if (serializers[child.tagName.toLowerCase()])
        elements.push(Element.extend(child));
      return elements;
    })
  },

  getInputs: function(form, typeName, name) {
    form = $(form);
    var inputs = form.getElementsByTagName('input');

    if (!typeName && !name) return $A(inputs).map(Element.extend);

    for (var i = 0, matchingInputs = [], length = inputs.length; i < length; i++) {
      var input = inputs[i];
      if ((typeName && input.type != typeName) || (name && input.name != name))
        continue;
      matchingInputs.push(Element.extend(input));
    }

    return matchingInputs;
  },

  disable: function(form) {
    form = $(form);
    Form.getElements(form).invoke('disable');
    return form;
  },

  enable: function(form) {
    form = $(form);
    Form.getElements(form).invoke('enable');
    return form;
  },

  findFirstElement: function(form) {
    var elements = $(form).getElements().findAll(function(element) {
      return 'hidden' != element.type && !element.disabled;
    });
    var firstByIndex = elements.findAll(function(element) {
      return element.hasAttribute('tabIndex') && element.tabIndex >= 0;
    }).sortBy(function(element) { return element.tabIndex }).first();

    return firstByIndex ? firstByIndex : elements.find(function(element) {
      return /^(?:input|select|textarea)$/i.test(element.tagName);
    });
  },

  focusFirstElement: function(form) {
    form = $(form);
    var element = form.findFirstElement();
    if (element) element.activate();
    return form;
  },

  request: function(form, options) {
    form = $(form), options = Object.clone(options || { });

    var params = options.parameters, action = form.readAttribute('action') || '';
    if (action.blank()) action = window.location.href;
    options.parameters = form.serialize(true);

    if (params) {
      if (Object.isString(params)) params = params.toQueryParams();
      Object.extend(options.parameters, params);
    }

    if (form.hasAttribute('method') && !options.method)
      options.method = form.method;

    return new Ajax.Request(action, options);
  }
};

/*--------------------------------------------------------------------------*/


Form.Element = {
  focus: function(element) {
    $(element).focus();
    return element;
  },

  select: function(element) {
    $(element).select();
    return element;
  }
};

Form.Element.Methods = {

  serialize: function(element) {
    element = $(element);
    if (!element.disabled && element.name) {
      var value = element.getValue();
      if (value != undefined) {
        var pair = { };
        pair[element.name] = value;
        return Object.toQueryString(pair);
      }
    }
    return '';
  },

  getValue: function(element) {
    element = $(element);
    var method = element.tagName.toLowerCase();
    return Form.Element.Serializers[method](element);
  },

  setValue: function(element, value) {
    element = $(element);
    var method = element.tagName.toLowerCase();
    Form.Element.Serializers[method](element, value);
    return element;
  },

  clear: function(element) {
    $(element).value = '';
    return element;
  },

  present: function(element) {
    return $(element).value != '';
  },

  activate: function(element) {
    element = $(element);
    try {
      element.focus();
      if (element.select && (element.tagName.toLowerCase() != 'input' ||
          !(/^(?:button|reset|submit)$/i.test(element.type))))
        element.select();
    } catch (e) { }
    return element;
  },

  disable: function(element) {
    element = $(element);
    element.disabled = true;
    return element;
  },

  enable: function(element) {
    element = $(element);
    element.disabled = false;
    return element;
  }
};

/*--------------------------------------------------------------------------*/

var Field = Form.Element;

var $F = Form.Element.Methods.getValue;

/*--------------------------------------------------------------------------*/

Form.Element.Serializers = (function() {
  function input(element, value) {
    switch (element.type.toLowerCase()) {
      case 'checkbox':
      case 'radio':
        return inputSelector(element, value);
      default:
        return valueSelector(element, value);
    }
  }

  function inputSelector(element, value) {
    if (Object.isUndefined(value))
      return element.checked ? element.value : null;
    else element.checked = !!value;
  }

  function valueSelector(element, value) {
    if (Object.isUndefined(value)) return element.value;
    else element.value = value;
  }

  function select(element, value) {
    if (Object.isUndefined(value))
      return (element.type === 'select-one' ? selectOne : selectMany)(element);

    var opt, currentValue, single = !Object.isArray(value);
    for (var i = 0, length = element.length; i < length; i++) {
      opt = element.options[i];
      currentValue = this.optionValue(opt);
      if (single) {
        if (currentValue == value) {
          opt.selected = true;
          return;
        }
      }
      else opt.selected = value.include(currentValue);
    }
  }

  function selectOne(element) {
    var index = element.selectedIndex;
    return index >= 0 ? optionValue(element.options[index]) : null;
  }

  function selectMany(element) {
    var values, length = element.length;
    if (!length) return null;

    for (var i = 0, values = []; i < length; i++) {
      var opt = element.options[i];
      if (opt.selected) values.push(optionValue(opt));
    }
    return values;
  }

  function optionValue(opt) {
    return Element.hasAttribute(opt, 'value') ? opt.value : opt.text;
  }

  return {
    input:         input,
    inputSelector: inputSelector,
    textarea:      valueSelector,
    select:        select,
    selectOne:     selectOne,
    selectMany:    selectMany,
    optionValue:   optionValue,
    button:        valueSelector
  };
})();

/*--------------------------------------------------------------------------*/


Abstract.TimedObserver = Class.create(PeriodicalExecuter, {
  initialize: function($super, element, frequency, callback) {
    $super(callback, frequency);
    this.element   = $(element);
    this.lastValue = this.getValue();
  },

  execute: function() {
    var value = this.getValue();
    if (Object.isString(this.lastValue) && Object.isString(value) ?
        this.lastValue != value : String(this.lastValue) != String(value)) {
      this.callback(this.element, value);
      this.lastValue = value;
    }
  }
});

Form.Element.Observer = Class.create(Abstract.TimedObserver, {
  getValue: function() {
    return Form.Element.getValue(this.element);
  }
});

Form.Observer = Class.create(Abstract.TimedObserver, {
  getValue: function() {
    return Form.serialize(this.element);
  }
});

/*--------------------------------------------------------------------------*/

Abstract.EventObserver = Class.create({
  initialize: function(element, callback) {
    this.element  = $(element);
    this.callback = callback;

    this.lastValue = this.getValue();
    if (this.element.tagName.toLowerCase() == 'form')
      this.registerFormCallbacks();
    else
      this.registerCallback(this.element);
  },

  onElementEvent: function() {
    var value = this.getValue();
    if (this.lastValue != value) {
      this.callback(this.element, value);
      this.lastValue = value;
    }
  },

  registerFormCallbacks: function() {
    Form.getElements(this.element).each(this.registerCallback, this);
  },

  registerCallback: function(element) {
    if (element.type) {
      switch (element.type.toLowerCase()) {
        case 'checkbox':
        case 'radio':
          Event.observe(element, 'click', this.onElementEvent.bind(this));
          break;
        default:
          Event.observe(element, 'change', this.onElementEvent.bind(this));
          break;
      }
    }
  }
});

Form.Element.EventObserver = Class.create(Abstract.EventObserver, {
  getValue: function() {
    return Form.Element.getValue(this.element);
  }
});

Form.EventObserver = Class.create(Abstract.EventObserver, {
  getValue: function() {
    return Form.serialize(this.element);
  }
});
(function() {

  var Event = {
    KEY_BACKSPACE: 8,
    KEY_TAB:       9,
    KEY_RETURN:   13,
    KEY_ESC:      27,
    KEY_LEFT:     37,
    KEY_UP:       38,
    KEY_RIGHT:    39,
    KEY_DOWN:     40,
    KEY_DELETE:   46,
    KEY_HOME:     36,
    KEY_END:      35,
    KEY_PAGEUP:   33,
    KEY_PAGEDOWN: 34,
    KEY_INSERT:   45,

    cache: {}
  };

  var docEl = document.documentElement;
  var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED = 'onmouseenter' in docEl
    && 'onmouseleave' in docEl;



  var isIELegacyEvent = function(event) { return false; };

  if (window.attachEvent) {
    if (window.addEventListener) {
      isIELegacyEvent = function(event) {
        return !(event instanceof window.Event);
      };
    } else {
      isIELegacyEvent = function(event) { return true; };
    }
  }

  var _isButton;

  function _isButtonForDOMEvents(event, code) {
    return event.which ? (event.which === code + 1) : (event.button === code);
  }

  var legacyButtonMap = { 0: 1, 1: 4, 2: 2 };
  function _isButtonForLegacyEvents(event, code) {
    return event.button === legacyButtonMap[code];
  }

  function _isButtonForWebKit(event, code) {
    switch (code) {
      case 0: return event.which == 1 && !event.metaKey;
      case 1: return event.which == 2 || (event.which == 1 && event.metaKey);
      case 2: return event.which == 3;
      default: return false;
    }
  }

  if (window.attachEvent) {
    if (!window.addEventListener) {
      _isButton = _isButtonForLegacyEvents;
    } else {
      _isButton = function(event, code) {
        return isIELegacyEvent(event) ? _isButtonForLegacyEvents(event, code) :
         _isButtonForDOMEvents(event, code);
      }
    }
  } else if (Prototype.Browser.WebKit) {
    _isButton = _isButtonForWebKit;
  } else {
    _isButton = _isButtonForDOMEvents;
  }

  function isLeftClick(event)   { return _isButton(event, 0) }

  function isMiddleClick(event) { return _isButton(event, 1) }

  function isRightClick(event)  { return _isButton(event, 2) }

  function element(event) {
    event = Event.extend(event);

    var node = event.target, type = event.type,
     currentTarget = event.currentTarget;

    if (currentTarget && currentTarget.tagName) {
      if (type === 'load' || type === 'error' ||
        (type === 'click' && currentTarget.tagName.toLowerCase() === 'input'
          && currentTarget.type === 'radio'))
            node = currentTarget;
    }

    if (node.nodeType == Node.TEXT_NODE)
      node = node.parentNode;

    return Element.extend(node);
  }

  function findElement(event, expression) {
    var element = Event.element(event);

    if (!expression) return element;
    while (element) {
      if (Object.isElement(element) && Prototype.Selector.match(element, expression)) {
        return Element.extend(element);
      }
      element = element.parentNode;
    }
  }

  function pointer(event) {
    return { x: pointerX(event), y: pointerY(event) };
  }

  function pointerX(event) {
    var docElement = document.documentElement,
     body = document.body || { scrollLeft: 0 };

    return event.pageX || (event.clientX +
      (docElement.scrollLeft || body.scrollLeft) -
      (docElement.clientLeft || 0));
  }

  function pointerY(event) {
    var docElement = document.documentElement,
     body = document.body || { scrollTop: 0 };

    return  event.pageY || (event.clientY +
       (docElement.scrollTop || body.scrollTop) -
       (docElement.clientTop || 0));
  }


  function stop(event) {
    Event.extend(event);
    event.preventDefault();
    event.stopPropagation();

    event.stopped = true;
  }


  Event.Methods = {
    isLeftClick:   isLeftClick,
    isMiddleClick: isMiddleClick,
    isRightClick:  isRightClick,

    element:     element,
    findElement: findElement,

    pointer:  pointer,
    pointerX: pointerX,
    pointerY: pointerY,

    stop: stop
  };

  var methods = Object.keys(Event.Methods).inject({ }, function(m, name) {
    m[name] = Event.Methods[name].methodize();
    return m;
  });

  if (window.attachEvent) {
    function _relatedTarget(event) {
      var element;
      switch (event.type) {
        case 'mouseover':
        case 'mouseenter':
          element = event.fromElement;
          break;
        case 'mouseout':
        case 'mouseleave':
          element = event.toElement;
          break;
        default:
          return null;
      }
      return Element.extend(element);
    }

    var additionalMethods = {
      stopPropagation: function() { this.cancelBubble = true },
      preventDefault:  function() { this.returnValue = false },
      inspect: function() { return '[object Event]' }
    };

    Event.extend = function(event, element) {
      if (!event) return false;

      if (!isIELegacyEvent(event)) return event;

      if (event._extendedByPrototype) return event;
      event._extendedByPrototype = Prototype.emptyFunction;

      var pointer = Event.pointer(event);

      Object.extend(event, {
        target: event.srcElement || element,
        relatedTarget: _relatedTarget(event),
        pageX:  pointer.x,
        pageY:  pointer.y
      });

      Object.extend(event, methods);
      Object.extend(event, additionalMethods);

      return event;
    };
  } else {
    Event.extend = Prototype.K;
  }

  if (window.addEventListener) {
    Event.prototype = window.Event.prototype || document.createEvent('HTMLEvents').__proto__;
    Object.extend(Event.prototype, methods);
  }

  function _createResponder(element, eventName, handler) {
    var registry = Element.retrieve(element, 'prototype_event_registry');

    if (Object.isUndefined(registry)) {
      CACHE.push(element);
      registry = Element.retrieve(element, 'prototype_event_registry', $H());
    }

    var respondersForEvent = registry.get(eventName);
    if (Object.isUndefined(respondersForEvent)) {
      respondersForEvent = [];
      registry.set(eventName, respondersForEvent);
    }

    if (respondersForEvent.pluck('handler').include(handler)) return false;

    var responder;
    if (eventName.include(":")) {
      responder = function(event) {
        if (Object.isUndefined(event.eventName))
          return false;

        if (event.eventName !== eventName)
          return false;

        Event.extend(event, element);
        handler.call(element, event);
      };
    } else {
      if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED &&
       (eventName === "mouseenter" || eventName === "mouseleave")) {
        if (eventName === "mouseenter" || eventName === "mouseleave") {
          responder = function(event) {
            Event.extend(event, element);

            var parent = event.relatedTarget;
            while (parent && parent !== element) {
              try { parent = parent.parentNode; }
              catch(e) { parent = element; }
            }

            if (parent === element) return;

            handler.call(element, event);
          };
        }
      } else {
        responder = function(event) {
          Event.extend(event, element);
          handler.call(element, event);
        };
      }
    }

    responder.handler = handler;
    respondersForEvent.push(responder);
    return responder;
  }

  function _destroyCache() {
    for (var i = 0, length = CACHE.length; i < length; i++) {
      Event.stopObserving(CACHE[i]);
      CACHE[i] = null;
    }
  }

  var CACHE = [];

  if (Prototype.Browser.IE)
    window.attachEvent('onunload', _destroyCache);

  if (Prototype.Browser.WebKit)
    window.addEventListener('unload', Prototype.emptyFunction, false);


  var _getDOMEventName = Prototype.K,
      translations = { mouseenter: "mouseover", mouseleave: "mouseout" };

  if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED) {
    _getDOMEventName = function(eventName) {
      return (translations[eventName] || eventName);
    };
  }

  function observe(element, eventName, handler) {
    element = $(element);

    var responder = _createResponder(element, eventName, handler);

    if (!responder) return element;

    if (eventName.include(':')) {
      if (element.addEventListener)
        element.addEventListener("dataavailable", responder, false);
      else {
        element.attachEvent("ondataavailable", responder);
        element.attachEvent("onlosecapture", responder);
      }
    } else {
      var actualEventName = _getDOMEventName(eventName);

      if (element.addEventListener)
        element.addEventListener(actualEventName, responder, false);
      else
        element.attachEvent("on" + actualEventName, responder);
    }

    return element;
  }

  function stopObserving(element, eventName, handler) {
    element = $(element);

    var registry = Element.retrieve(element, 'prototype_event_registry');
    if (!registry) return element;

    if (!eventName) {
      registry.each( function(pair) {
        var eventName = pair.key;
        stopObserving(element, eventName);
      });
      return element;
    }

    var responders = registry.get(eventName);
    if (!responders) return element;

    if (!handler) {
      responders.each(function(r) {
        stopObserving(element, eventName, r.handler);
      });
      return element;
    }

    var i = responders.length, responder;
    while (i--) {
      if (responders[i].handler === handler) {
        responder = responders[i];
        break;
      }
    }
    if (!responder) return element;

    if (eventName.include(':')) {
      if (element.removeEventListener)
        element.removeEventListener("dataavailable", responder, false);
      else {
        element.detachEvent("ondataavailable", responder);
        element.detachEvent("onlosecapture", responder);
      }
    } else {
      var actualEventName = _getDOMEventName(eventName);
      if (element.removeEventListener)
        element.removeEventListener(actualEventName, responder, false);
      else
        element.detachEvent('on' + actualEventName, responder);
    }

    registry.set(eventName, responders.without(responder));

    return element;
  }

  function fire(element, eventName, memo, bubble) {
    element = $(element);

    if (Object.isUndefined(bubble))
      bubble = true;

    if (element == document && document.createEvent && !element.dispatchEvent)
      element = document.documentElement;

    var event;
    if (document.createEvent) {
      event = document.createEvent('HTMLEvents');
      event.initEvent('dataavailable', bubble, true);
    } else {
      event = document.createEventObject();
      event.eventType = bubble ? 'ondataavailable' : 'onlosecapture';
    }

    event.eventName = eventName;
    event.memo = memo || { };

    if (document.createEvent)
      element.dispatchEvent(event);
    else
      element.fireEvent(event.eventType, event);

    return Event.extend(event);
  }

  Event.Handler = Class.create({
    initialize: function(element, eventName, selector, callback) {
      this.element   = $(element);
      this.eventName = eventName;
      this.selector  = selector;
      this.callback  = callback;
      this.handler   = this.handleEvent.bind(this);
    },

    start: function() {
      Event.observe(this.element, this.eventName, this.handler);
      return this;
    },

    stop: function() {
      Event.stopObserving(this.element, this.eventName, this.handler);
      return this;
    },

    handleEvent: function(event) {
      var element = Event.findElement(event, this.selector);
      if (element) this.callback.call(this.element, event, element);
    }
  });

  function on(element, eventName, selector, callback) {
    element = $(element);
    if (Object.isFunction(selector) && Object.isUndefined(callback)) {
      callback = selector, selector = null;
    }

    return new Event.Handler(element, eventName, selector, callback).start();
  }

  Object.extend(Event, Event.Methods);

  Object.extend(Event, {
    fire:          fire,
    observe:       observe,
    stopObserving: stopObserving,
    on:            on
  });

  Element.addMethods({
    fire:          fire,

    observe:       observe,

    stopObserving: stopObserving,

    on:            on
  });

  Object.extend(document, {
    fire:          fire.methodize(),

    observe:       observe.methodize(),

    stopObserving: stopObserving.methodize(),

    on:            on.methodize(),

    loaded:        false
  });

  if (window.Event) Object.extend(window.Event, Event);
  else window.Event = Event;
})();

(function() {
  /* Support for the DOMContentLoaded event is based on work by Dan Webb,
     Matthias Miller, Dean Edwards, John Resig, and Diego Perini. */

  var timer;

  function fireContentLoadedEvent() {
    if (document.loaded) return;
    if (timer) window.clearTimeout(timer);
    document.loaded = true;
    document.fire('dom:loaded');
  }

  function checkReadyState() {
    if (document.readyState === 'complete') {
      document.stopObserving('readystatechange', checkReadyState);
      fireContentLoadedEvent();
    }
  }

  function pollDoScroll() {
    try { document.documentElement.doScroll('left'); }
    catch(e) {
      timer = pollDoScroll.defer();
      return;
    }
    fireContentLoadedEvent();
  }

  if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', fireContentLoadedEvent, false);
  } else {
    document.observe('readystatechange', checkReadyState);
    if (window == top)
      timer = pollDoScroll.defer();
  }

  Event.observe(window, 'load', fireContentLoadedEvent);
})();

Element.addMethods();

/*------------------------------- DEPRECATED -------------------------------*/

Hash.toQueryString = Object.toQueryString;

var Toggle = { display: Element.toggle };

Element.Methods.childOf = Element.Methods.descendantOf;

var Insertion = {
  Before: function(element, content) {
    return Element.insert(element, {before:content});
  },

  Top: function(element, content) {
    return Element.insert(element, {top:content});
  },

  Bottom: function(element, content) {
    return Element.insert(element, {bottom:content});
  },

  After: function(element, content) {
    return Element.insert(element, {after:content});
  }
};

var $continue = new Error('"throw $continue" is deprecated, use "return" instead');

var Position = {
  includeScrollOffsets: false,

  prepare: function() {
    this.deltaX =  window.pageXOffset
                || document.documentElement.scrollLeft
                || document.body.scrollLeft
                || 0;
    this.deltaY =  window.pageYOffset
                || document.documentElement.scrollTop
                || document.body.scrollTop
                || 0;
  },

  within: function(element, x, y) {
    if (this.includeScrollOffsets)
      return this.withinIncludingScrolloffsets(element, x, y);
    this.xcomp = x;
    this.ycomp = y;
    this.offset = Element.cumulativeOffset(element);

    return (y >= this.offset[1] &&
            y <  this.offset[1] + element.offsetHeight &&
            x >= this.offset[0] &&
            x <  this.offset[0] + element.offsetWidth);
  },

  withinIncludingScrolloffsets: function(element, x, y) {
    var offsetcache = Element.cumulativeScrollOffset(element);

    this.xcomp = x + offsetcache[0] - this.deltaX;
    this.ycomp = y + offsetcache[1] - this.deltaY;
    this.offset = Element.cumulativeOffset(element);

    return (this.ycomp >= this.offset[1] &&
            this.ycomp <  this.offset[1] + element.offsetHeight &&
            this.xcomp >= this.offset[0] &&
            this.xcomp <  this.offset[0] + element.offsetWidth);
  },

  overlap: function(mode, element) {
    if (!mode) return 0;
    if (mode == 'vertical')
      return ((this.offset[1] + element.offsetHeight) - this.ycomp) /
        element.offsetHeight;
    if (mode == 'horizontal')
      return ((this.offset[0] + element.offsetWidth) - this.xcomp) /
        element.offsetWidth;
  },


  cumulativeOffset: Element.Methods.cumulativeOffset,

  positionedOffset: Element.Methods.positionedOffset,

  absolutize: function(element) {
    Position.prepare();
    return Element.absolutize(element);
  },

  relativize: function(element) {
    Position.prepare();
    return Element.relativize(element);
  },

  realOffset: Element.Methods.cumulativeScrollOffset,

  offsetParent: Element.Methods.getOffsetParent,

  page: Element.Methods.viewportOffset,

  clone: function(source, target, options) {
    options = options || { };
    return Element.clonePosition(target, source, options);
  }
};

/*--------------------------------------------------------------------------*/

if (!document.getElementsByClassName) document.getElementsByClassName = function(instanceMethods){
  function iter(name) {
    return name.blank() ? null : "[contains(concat(' ', @class, ' '), ' " + name + " ')]";
  }

  instanceMethods.getElementsByClassName = Prototype.BrowserFeatures.XPath ?
  function(element, className) {
    className = className.toString().strip();
    var cond = /\s/.test(className) ? $w(className).map(iter).join('') : iter(className);
    return cond ? document._getElementsByXPath('.//*' + cond, element) : [];
  } : function(element, className) {
    className = className.toString().strip();
    var elements = [], classNames = (/\s/.test(className) ? $w(className) : null);
    if (!classNames && !className) return elements;

    var nodes = $(element).getElementsByTagName('*');
    className = ' ' + className + ' ';

    for (var i = 0, child, cn; child = nodes[i]; i++) {
      if (child.className && (cn = ' ' + child.className + ' ') && (cn.include(className) ||
          (classNames && classNames.all(function(name) {
            return !name.toString().blank() && cn.include(' ' + name + ' ');
          }))))
        elements.push(Element.extend(child));
    }
    return elements;
  };

  return function(className, parentElement) {
    return $(parentElement || document.body).getElementsByClassName(className);
  };
}(Element.Methods);

/*--------------------------------------------------------------------------*/

Element.ClassNames = Class.create();
Element.ClassNames.prototype = {
  initialize: function(element) {
    this.element = $(element);
  },

  _each: function(iterator) {
    this.element.className.split(/\s+/).select(function(name) {
      return name.length > 0;
    })._each(iterator);
  },

  set: function(className) {
    this.element.className = className;
  },

  add: function(classNameToAdd) {
    if (this.include(classNameToAdd)) return;
    this.set($A(this).concat(classNameToAdd).join(' '));
  },

  remove: function(classNameToRemove) {
    if (!this.include(classNameToRemove)) return;
    this.set($A(this).without(classNameToRemove).join(' '));
  },

  toString: function() {
    return $A(this).join(' ');
  }
};

Object.extend(Element.ClassNames.prototype, Enumerable);

/*--------------------------------------------------------------------------*/

(function() {
  window.Selector = Class.create({
    initialize: function(expression) {
      this.expression = expression.strip();
    },

    findElements: function(rootElement) {
      return Prototype.Selector.select(this.expression, rootElement);
    },

    match: function(element) {
      return Prototype.Selector.match(element, this.expression);
    },

    toString: function() {
      return this.expression;
    },

    inspect: function() {
      return "#<Selector: " + this.expression + ">";
    }
  });

  Object.extend(Selector, {
    matchElements: function(elements, expression) {
      var match = Prototype.Selector.match,
          results = [];

      for (var i = 0, length = elements.length; i < length; i++) {
        var element = elements[i];
        if (match(element, expression)) {
          results.push(Element.extend(element));
        }
      }
      return results;
    },

    findElement: function(elements, expression, index) {
      index = index || 0;
      var matchIndex = 0, element;
      for (var i = 0, length = elements.length; i < length; i++) {
        element = elements[i];
        if (Prototype.Selector.match(element, expression) && index === matchIndex++) {
          return Element.extend(element);
        }
      }
    },

    findChildElements: function(element, expressions) {
      var selector = expressions.toArray().join(', ');
      return Prototype.Selector.select(selector, element || document);
    }
  });
})();

//faraway 20.書簡を4人以上の君主に送ることができるツールのソース(bro3_mass_shokan_tool.user.js)終了

//faraway 21.武将カード分類ツールのソース(bro3_deck_tool.user.js)開始
//================================================================================
//21.武将カード分類ツール
//================================================================================
// ==UserScript==
// @name           bro3_deck_tool
// @version        2.03
// @namespace      http://twitter.com/utoutouuto
// @include        http://*.3gokushi.jp/card/deck.php*
// @include        http://*.3gokushi.jp/card/trade_card.php*
// @include        http://*.3gokushi.jp/union/index.php*
// @include        http://*.3gokushi.jp/union/learn.php*
// @include        http://*.3gokushi.jp/union/lvup.php*
// @include        http://*.3gokushi.jp/union/remove.php*
// @include        http://*.3gokushi.jp/card/duel_set.php*
// @description    
// ==/UserScript==
//----更新履歴----
// ver1.00　2010-07-24：初回作成
// ver1.01　2010-07-31：カード登録・表示機能付加
// ver2.00　2010-08-28：カード分類ツールに改定。ソート機能付加
// ver2.01　2010-11-22：分類項目数上限を5→10に
// ver2.02　2010-11-30：初期チェック付加。未分類対応、一覧情報での絞り込み対応。出品、合成、デュエル画面対応。
// ver2.03　2011-02-08：カードの裏返し処理対応。合成画面はそのまま。ページ読み込み処理変更＆処理実行を１ページ目に限定。
//faraway( function(){
function disp_deck_tool()	//faraway
{
//	window.alert("21.:" + location.pathname);	//faraway
////////////////////////////////////////////////////////
// 変数定義
////////////////////////////////////////////////////////
var d_21 = document;
var $_21 = unsafeWindow.jQuery;
var $xp_21 = function (xp, dc) { return d_21.evaluate(xp, dc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); }
var $xp1_21 = function (xp, dc) { return d_21.evaluate(xp, dc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; }
var location_deckURL = "/card/deck.php";
var location_tradeCardURL = "/card/trade_card.php";
var location_duelURL = "/card/duel_set.php";
var location_unionIndexURL = "/union/index.php";
var location_unionLearnURL = "/union/learn.php";
var location_unionLvupURL = "/union/lvup.php";
var location_unionRemoveURL = "/union/remove.php";
var worldKey_21 = location.hostname;	// GM保存領域ワールドキー
var selectedGroup = "full";			// 分類表示キー
var tableMode = "skill";			// 一覧表示キー
var hrefArray_21 = [];					// ページ読み込みURL
var currentDeckCardList = [];		// デッキ内カードリスト
var fileCardList = [];				// ファイル内カードリスト
var data_index = 1;					// 
// 以下、GM変数
var cardGroupArray = [];
var cardGroup1 = [];
var cardGroup2 = [];
var cardGroup3 = [];
var cardGroup4 = [];
var cardGroup5 = [];
var cardGroup6 = [];
var cardGroup7 = [];
var cardGroup8 = [];
var cardGroup9 = [];
var cardGroup10 = [];

////////////////////////////////////////////////////////
// ページ読み込み完了を待たない処理
////////////////////////////////////////////////////////
// 対象ページでない場合処理中断
if (!(location.pathname == location_deckURL 
	|| location.pathname == location_tradeCardURL
	|| location.pathname == location_duelURL
	|| location.pathname == location_unionIndexURL
	|| location.pathname == location_unionLearnURL
	|| location.pathname == location_unionLvupURL
	|| location.pathname == location_unionRemoveURL)) {
	return;
}
// 各種チェック
if (!pre_check_21()) {
	// 確認用
	//alert("初期チェックでエラー。要ログ確認")
	return;
}
function pre_check_21() {
	if (!worldKey_21) { console.log("ワールドキー取得エラー"); return false; }
	
	var time_checker = new Date().toString();
	GM_setValue(worldKey_21 + "time_checker", time_checker.toSource());
	var res_time_checker = eval(GM_getValue(worldKey_21 + "time_checker", ""));
	if (time_checker != res_time_checker) {
		console.log("GM変数の利用エラー");
		console.log("　：" + time_checker);
		console.log("　：" + res_time_checker);
		return false;
	}
	
	if (!$_21) { console.log("jquery取得エラー"); return false; }
	return true;
}
// GM変数ロード
loadCmValue_21();

// ページ読み込み完了後に本処理開始
window.addEventListener("load", function() { pre_main_21(); }, false);

////////////////////////////////////////////////////////
// デッキ画面、デュエル画面、トレード画面・合成画面で分岐処理
////////////////////////////////////////////////////////
function pre_main_21() {
	// ページリンクがない場合、１ページ目でない場合には処理中断。
	var pagerNode = $xp1_21('//ul[@class="pager"]', d_21);
/*farawayここの3行コメントで1ページでも動作*/
//faraway	if (!pagerNode) { return; }
//faraway	var firstPageNode = $xp1_21('descendant::a[@title="first page"]', pagerNode);
//faraway	if (!!firstPageNode) { return; }
/*faraway*/
	
	addCommonStyle();
	if (location.pathname == location_deckURL) {
		addBtns_deckPage();
	} else if (location.pathname == location_duelURL) {
		addBtns_duelPage();
	} else if (location.pathname == location_tradeCardURL
			|| location.pathname == location_unionIndexURL
			|| location.pathname == location_unionLearnURL
			|| location.pathname == location_unionLvupURL
			|| location.pathname == location_unionRemoveURL){
		addBtns_commonPage();
	}
}

////////////////////////////////////////////////////////
// デッキ画面処理
////////////////////////////////////////////////////////
function addBtns_deckPage() {
	// 上部一覧表示付加
	var targetNode = $xp1_21('//div[@id="gray02Wrapper"]/h2[1]', d_21);
		targetNode.innerHTML = "【" + targetNode.innerHTML + "：一覧表示】";
		targetNode.addEventListener("click", function() {
			createLayout();
			getDeckCardInfo();
		}, false);
	// 下部セレクター付加
	var pagerNode = $xp1_21('//ul[@class="pager"]', d_21);
	var groupViewSelectEL = createGroupSelecter(function() {
		tmp = groupViewSelectEL.options[groupViewSelectEL.selectedIndex].value;
		if (tmp == "") { return; }
		selectedGroup = tmp;
		createLayout();
		$_21("#brotool_baseEL").hide();
		
		if (hrefArray_21.length <= 0) {
			getFileCardInfo();
		} else {
			viewCardGroup();
		}
	});
	pagerNode.appendChild(groupViewSelectEL);
}
// デッキ内カードの一覧情報を作成
function getDeckCardInfo() {
	if (currentDeckCardList.length <= 0) {
		getDeckCardList();
		var tbodyEL = $xp1_21('//table[@id="brotool_deckTableEL"]/tbody', d_21);
		createTableData(tbodyEL, currentDeckCardList);
		$_21("#brotool_deckTableEL").tablesorter( { headers: {
			9: { sorter:"digit"},
			10: { sorter:"digit"},
			11: { sorter:"digit"},
			12: { sorter:"digit"},
			13: { sorter:"digit"},
			14: { sorter:"digit"},
			15: { sorter:"digit"},
		}} );
	}
	$_21("#brotool_baseEL").slideDown();
}
function getDeckCardList() {
	var deckCardListNodes = $xp_21('//div[@id="cardListDeck"]//div[@class="cardColmn"]', d_21);
	
	for (var i = 0, len = deckCardListNodes.snapshotLength; i < len; i++) {
		var cardInfo = getCardInfoNormal(deckCardListNodes.snapshotItem(i));
		currentDeckCardList.push(cardInfo);
	}
}
// ファイル内の全ページ読み込み
function getFileCardInfo(){
	if (hrefArray_21.length > 0) { return; }
	
	// 現ページ
	var tmpFileCardList = getFileCardList();
	var tbodyEL = $xp1_21('//table[@id="brotool_fileTableEL"]/tbody', d_21);
	createTableData(tbodyEL, tmpFileCardList);
	for (var i = 0, len = tmpFileCardList.length; i < len; i++) { fileCardList.push(tmpFileCardList[i]) }
	// 現ページ以降
	var pagerNode = $xp1_21('//ul[@class="pager"]', d_21);
	var lastPageNode = $xp1_21('descendant::a[@title="last page"]', pagerNode);
	if (!lastPageNode) { return; }
	var lastPageHref = lastPageNode.href;
	var lastPageNo = lastPageHref.match(/p=[0-9]+/)[0];
	var len = parseInt(lastPageNo.match(/[0-9]+/)[0]) + 1;
	
	for (var i = 2; i < len; i++) {
		hrefArray_21.push(lastPageHref.replace(/p=[0-9]+/, "p=" + i));
	}
	loadPage_deck(0);
}
////////////////////////////////////////////////////////
// デュエル画面処理
////////////////////////////////////////////////////////
function addBtns_duelPage() {
	var pagerNode = $xp1_21('//ul[@class="pager"]', d_21);
	var groupViewSelectEL = createGroupSelecter(function() {
		tmp = groupViewSelectEL.options[groupViewSelectEL.selectedIndex].value;
		if (tmp == "") { return; }
		selectedGroup = tmp;
		
		if (hrefArray_21.length <= 0) {
			d_getFileCardInfo();
		} else {
			viewCardGroup();
		}
	});
	pagerNode.appendChild(groupViewSelectEL);
}
function d_getFileCardInfo(){
	if (hrefArray_21.length > 0) { return; }
	
	// 現ページ
	d_getFileCardList();
	// 現ページ以降
	var pagerNode = $xp1_21('//ul[@class="pager"]', d_21);
	var lastPageNode = $xp1_21('descendant::a[@title="last page"]', pagerNode);
	if (!lastPageNode) { return; }
	var lastPageHref = lastPageNode.href;
	var lastPageNo = lastPageHref.match(/p=[0-9]+/)[0];
	var len = parseInt(lastPageNo.match(/[0-9]+/)[0]) + 1;
	
	for (var i = 2; i < len; i++) {
		hrefArray_21.push(lastPageHref.replace(/p=[0-9]+/, "p=" + i));
	}
	d_loadPage(0);
}
function d_loadPage (loadNo) {
	var opt = {
		method: 'get',
		url: hrefArray_21[loadNo],
		onload: function(res) {
			d_addPageElement(loadNo, res);
		}
	}
	GM_xmlhttpRequest(opt); 
}
function d_addPageElement(loadNo, res) {
//faraway120126	var targetNode = $xp1_21('//div[@class="rotateInfo bottom clearfix"]', d_21);
//ひろ120516	var targetNode = $xp1_21('//div[@class="rotateInfo clearfix label-all-color-inner"]', d_21);
	var targetNode = $xp1_21('//div[@class="rotateInfo bottom clearfix"]', d_21);//ひろ120516

	var fillterEL = d_21.createElement('html');
		fillterEL.innerHTML = res.responseText;
//faraway120126	var pageBarNode = $xp1_21('descendant::div[@class="rotateInfo bottom clearfix"]', fillterEL);
//faraway120126		targetNode.parentNode.appendChild(pageBarNode);
//ひろ120516	var pageBarNode = $xp1_21('descendant::div[@class="rotateInfo clearfix label-all-color-inner"]', fillterEL);
	var pageBarNode = $xp1_21('descendant::div[@class="rotateInfo bottom clearfix"]', fillterEL);//ひろ120516

		targetNode.parentNode.appendChild(pageBarNode);
	
	d_getFileCardList(fillterEL);
	// つなげて表示
	var cardFileNode = $xp1_21('descendant::div[@id="cardFileList"]', fillterEL);
	if (!!cardFileNode) {
		targetNode.parentNode.appendChild(cardFileNode);
	} else {
//faraway120126		var cardNodes = $xp_21('descendant::div[@class="cardStatusDetail"]', fillterEL);
		var cardNodes = $xp_21('descendant::div[@class="cardStatusDetail label-setting-mode"]', fillterEL);
		for (var i = 0, len = cardNodes.snapshotLength; i < len; i++) {
			targetNode.parentNode.appendChild(cardNodes.snapshotItem(i));
		}
	}
	
	if (loadNo + 1 >= hrefArray_21.length) {
		targetNode.parentNode.appendChild(pageBarNode.cloneNode(true));
		return;
	}
	d_loadPage(loadNo + 1);
}
function d_getFileCardList(targetOp) {
	if (!targetOp) { targetOp = d_21 }
//faraway120126	var cardNodes = $xp_21('descendant::div[@class="cardStatusDetail"]', targetOp);
	var cardNodes = $xp_21('descendant::div[@class="cardStatusDetail label-setting-mode"]', targetOp);
	
	// 通常表示
	var normalFileCardListNodes = $xp_21('descendant::div[@id="cardFileList"]//div[@class="cardColmn"]', targetOp);
	for (var i = 0, len = normalFileCardListNodes.snapshotLength; i < len; i++) {
		d_getCardInfoNormal(normalFileCardListNodes.snapshotItem(i));
	}
	// 縮小表示
//faraway120126	var miniFileCardListNodes = $xp_21('descendant::div[@class="cardStatusDetail"]', targetOp);
	var miniFileCardListNodes = $xp_21('descendant::div[@class="cardStatusDetail label-setting-mode"]', targetOp);
	for (var i = 0, len = miniFileCardListNodes.snapshotLength; i < len; i++) {
		d_getCardInfoMini(miniFileCardListNodes.snapshotItem(i));
	}
}
function d_getCardInfoMini(cardStatusDetail) {
	// 分類識別要素付加
	var spanEL = d_21.createElement("span");
		spanEL.id = "brotool_cardGroup" + checkCardGroup(d_getUqId(cardStatusDetail));
		cardStatusDetail.appendChild(spanEL);
	if (selectedGroup != "full" && spanEL.id != "brotool_" + selectedGroup) {
		cardStatusDetail.style.display = "none";
	}
}
function d_getCardInfoNormal(cardColmn) {
	// 分類識別要素付加
	if (cardColmn.parentNode.id == "cardFileList") {
		var spanEL = d_21.createElement("span");
			spanEL.id = "brotool_cardGroup" + checkCardGroup(d_getUqId(cardColmn));
			cardColmn.appendChild(spanEL);
		if (selectedGroup != "full" && spanEL.id != "brotool_" + selectedGroup) {
			cardColmn.style.display = "none";
		}
	}
	// 裏返し処理差し替え
	var exeA = $_21("a[href^=javascript:executeA(]", cardColmn).get(0);
	var exeB = $_21("a[href^=javascript:executeB(]", cardColmn).get(0);
	if (!!exeA && !!exeB) {
		var num = exeA.href.match(/[0-9]+/)[0];
		
		exeA.href="javascript:void(0)";
		exeA.addEventListener("click", function() {
			$_21("[id=card_frontback" + num + "-front]").hide();
			$_21("[id=card_frontback" + num + "-back]").show();
		}, false);
		exeB.href="javascript:void(0)";
		exeB.addEventListener("click", function() {
			$_21("[id=card_frontback" + num + "-front]").show();
			$_21("[id=card_frontback" + num + "-back]").hide();
		}, false);
	}
}
function d_getUqId (nodes) {
	// ファイル操作イベントからカードIDを取得
	onClickNode = $xp1_21('descendant::img[@class="aboutdeck" and @onClick]', nodes);
	if (!onClickNode) { return null; }
	var splitArray = onClickNode.getAttribute('onClick').split(",");
	var cardId = splitArray[1].replace(/^\s+|\s+$/g, "");
	return cardId;
}
////////////////////////////////////////////////////////
// トレード画面、合成画面での共通処理
////////////////////////////////////////////////////////
function addBtns_commonPage() {
	var naviNode = $xp1_21('//ul[@class="navi"]', d_21);
	if (!naviNode) { return; }
	var groupViewSelectEL = createGroupSelecter(function() {
		tmp = groupViewSelectEL.options[groupViewSelectEL.selectedIndex].value;
		if (tmp == "") { return; }
		selectedGroup = tmp;
		if (hrefArray_21.length <= 0) {
			c_getFullCardView();
		} else {
			viewCardGroup();
		}
	});
	naviNode.appendChild(groupViewSelectEL);
}
function c_getFullCardView(){
	if (hrefArray_21.length > 0) { return; }
	// 現ページ
	c_getFileCardList();
	// 現ページ以降
	var pagerNode = $xp1_21('//ul[@class="pager"]', d_21);
	var lastPageNode = $xp1_21('descendant::a[@title="last page"]', pagerNode);
	if (!lastPageNode) { return; }
	var lastPageHref = lastPageNode.href;
	var lastPageNo = lastPageHref.match(/p=[0-9]+/)[0];
	var len = parseInt(lastPageNo.match(/[0-9]+/)[0]) + 1;
	
	for (var i = 2; i < len; i++) {
		hrefArray_21.push(lastPageHref.replace(/p=[0-9]+/, "p=" + i));
	}
	c_loadPage(0);
}
function c_loadPage (loadNo) {
	var opt = {
		method: 'get',
		url: hrefArray_21[loadNo],
		onload: function(res) {
			c_addPageElement(loadNo, res);
		}
	}
	GM_xmlhttpRequest(opt); 
}
function c_addPageElement(loadNo, res) {
	var targetNode = $xp1_21('//div[@id="cardFileList"]', d_21);
	var fillterEL = d_21.createElement('html');
		fillterEL.innerHTML = res.responseText;
	
	// 一覧情報回収
	c_getFileCardList(fillterEL);
	
	// つなげて表示
	var cardNodes = $xp_21('descendant::div[@id="cardFileList"]//div[@class="cardColmn"]', fillterEL);
	for (var i = 0, len = cardNodes.snapshotLength; i < len; i++) {
		targetNode.appendChild(cardNodes.snapshotItem(i));
	}
	
	if (loadNo + 1 >= hrefArray_21.length) {
		return;
	}
	c_loadPage(loadNo + 1);
}
function c_getFileCardList(targetOp) {
	if (!targetOp) { targetOp = d_21 }
	var normalFileCardListNodes = $xp_21('descendant::div[@id="cardFileList"]//div[@class="cardColmn"]', targetOp);
	for (var i = 0, len = normalFileCardListNodes.snapshotLength; i < len; i++) {
		var cardColmn = normalFileCardListNodes.snapshotItem(i);
		var uqId = c_getUqId(cardColmn);
		// 分類識別要素付加
		var spanEL = d_21.createElement("span");
			spanEL.id = "brotool_cardGroup" + checkCardGroup(uqId);
			cardColmn.appendChild(spanEL);
		if (selectedGroup != "full" && spanEL.id != "brotool_" + selectedGroup) {
			cardColmn.style.display = "none";
		}
		// 裏返し処理差し替え ※トレード画面のみ、合成画面はそのまま
		if(location.pathname == location_tradeCardURL) {
			var exeA = $_21("a[href^=javascript:executeA(]", cardColmn).get(0);
			var exeB = $_21("a[href^=javascript:executeB(]", cardColmn).get(0);
			if (!!exeA && !!exeB) {
				var num = exeA.href.match(/[0-9]+/)[0];
				exeA.href="javascript:void(0)";
				exeA.addEventListener("click", (function(num) {
					return function() {
						$_21("[id=card_frontback" + num + "-front]").hide();
						$_21("[id=card_frontback" + num + "-back]").show();
					}
				})(num), false);
				exeB.href="javascript:void(0)";;
				exeB.addEventListener("click", (function(num) {
					return function() {
						$_21("[id=card_frontback" + num + "-front]").show();
						$_21("[id=card_frontback" + num + "-back]").hide();
					}
				})(num), false);
			}
		}
	}
}
function c_getUqId (nodes) {
	var onClickNode = $xp1_21('descendant::a[@class="setTrade" or @class="useUnion" or @class="deleteSkillTp"]', nodes);
	if (!!onClickNode) { 
		var cardId = onClickNode.getAttribute('onClick').split("(")[1].split(")")[0];
		return cardId;
	}
	var onClickNode = $xp1_21('descendant::a[@class="skillLvUp" or @class="skillLearn" or @class="skillDelete"]', nodes);
	if (!!onClickNode) { 
		var cardId = onClickNode.href.split("=")[1].split("#")[0];
		return cardId;
	}
	return null;
}
////////////////////////////////////////////////////////
// デッキ画面の基底レイアウト作成関数
////////////////////////////////////////////////////////
function createLayout() {
	var baseEL = $xp1_21('//div[@id="brotool_baseEL"]', d_21);
	if (!baseEL) {
			baseEL =  d_21.createElement("div");
			baseEL.id = "brotool_baseEL";
			baseEL.className = "baseDiv";
			baseEL.style.display = "none";
		var targetNode = $xp1_21('//div[@id="whiteWrapper"]', d_21);
			targetNode.insertBefore(baseEL, targetNode.firstChild);
			
		var showBaseEL = d_21.createElement("div");
			showBaseEL.id = "brotool_showBaseEL";
			showBaseEL.className = "baseDiv";
		var showDeckEL = d_21.createElement("div");
			showDeckEL.id = "brotool_showDeckEL";
			showDeckEL.className = "baseDiv";
		var showbtnsEL = d_21.createElement("div");
			showbtnsEL.id = "brotool_showbtnEL";
			showbtnsEL.className = "baseDiv";
		var showFileEL = d_21.createElement("div");
			showFileEL.id = "brotool_showFileEL";
			showFileEL.className = "baseDiv";
		var opBaseEL = d_21.createElement("div");
			opBaseEL.id = "brotool_opBaseEL";
			opBaseEL.className = "baseDiv";
			
		createTopBtnLayout();
		baseEL.appendChild(showBaseEL);
		baseEL.appendChild(opBaseEL);
		showBaseEL.appendChild(showDeckEL);
		showBaseEL.appendChild(showbtnsEL);
		showBaseEL.appendChild(showFileEL);
		createTableLayout();
		createMiddleBtnLayout();
		createOptionLayout();
		
		showFileEL.style.display = "none";
		opBaseEL.style.display = "none";
	}
	// 【先頭ボタン】レイアウト
	function createTopBtnLayout() {
		var infoBtnEL = d_21.createElement("input");
			infoBtnEL.type = "button";
			infoBtnEL.value = "【一覧情報】";
			infoBtnEL.disabled = true;
			infoBtnEL.addEventListener("click", function() {
				infoBtnEL.disabled = true;
				opBtnEL.disabled = false;
				$_21("#brotool_showBaseEL").slideDown();
				$_21("#brotool_opBaseEL").hide();
			}, false);
		var opBtnEL = d_21.createElement("input");
			opBtnEL.type = "button";
			opBtnEL.value = "【設定情報】";
			opBtnEL.addEventListener("click", function() {
				infoBtnEL.disabled = false;
				opBtnEL.disabled = true;
				$_21("#brotool_showBaseEL").hide();
				$_21("#brotool_opBaseEL").slideDown();
			}, false);
		var closeBtnEL = d_21.createElement("input");
			closeBtnEL.type = "button";
			closeBtnEL.value = "【この一覧を閉じる】";
			closeBtnEL.addEventListener("click", function() {
				$_21("#brotool_baseEL").slideUp();
			}, false);
		baseEL.appendChild(infoBtnEL);
		baseEL.appendChild(opBtnEL);
		baseEL.appendChild(closeBtnEL);
	}
	// 【テーブル情報】レイアウト
	function createTableLayout() {
		showDeckEL.appendChild(d_21.createTextNode("【デッキ内カード情報】"))
		var deckTableEL = d_21.createElement("table");
			deckTableEL.id = "brotool_deckTableEL";
			deckTableEL.className = "showTable";
		var theadEL = d_21.createElement("thead");
			deckTableEL.appendChild(theadEL);
		var tbodyEL = d_21.createElement("tbody");
			deckTableEL.appendChild(tbodyEL);
			createTableHead(theadEL);
		showFileEL.appendChild(d_21.createTextNode("【ファイル内カード情報】"))
		var fileTableEL = d_21.createElement("table");
			fileTableEL.id = "brotool_fileTableEL";
			fileTableEL.className = "showTable";
		var theadEL = d_21.createElement("thead");
			fileTableEL.appendChild(theadEL);
		var tbodyEL = d_21.createElement("tbody");
			fileTableEL.appendChild(tbodyEL);
			createTableHead(theadEL);
		
		showDeckEL.appendChild(deckTableEL);
		showFileEL.appendChild(fileTableEL);
	}
	// 【中間ボタン】レイアウト
	function createMiddleBtnLayout() {
		var modeParamBtn = d_21.createElement("input");
			modeParamBtn.type = "button";
			modeParamBtn.id = "brotool_modeParamBtn"
			modeParamBtn.value = "【パラメータ表示】";
			modeParamBtn.addEventListener("click", function() {
				modeParamBtn.disabled = true;
				modeSkillBtn.disabled = false;
				changeTableMode("param");
			}, false);
		var modeSkillBtn = d_21.createElement("input");
			modeSkillBtn.type = "button";
			modeSkillBtn.id = "brotool_modeSkillBtn"
			modeSkillBtn.value = "【スキル表示】";
			modeSkillBtn.addEventListener("click", function() {
				modeParamBtn.disabled = false;
				modeSkillBtn.disabled = true;
				changeTableMode("skill");
			}, false);
		var allShowBtn = d_21.createElement("input");
			allShowBtn.type = "button";
			allShowBtn.id = "brotool_allShowBtn"
			allShowBtn.value = "【ファイル内カード情報表示】";
			allShowBtn.addEventListener("click", function() {
				allShowBtn.disabled = true;
				getFileCardInfo();
				$_21("#brotool_showFileEL").slideDown();
			}, false);
		var setGroupBtn = d_21.createElement("input");
			setGroupBtn.type = "button";
			setGroupBtn.id = "brotool_setGroupBtn"
			setGroupBtn.value = "【カード分類登録】";
			setGroupBtn.addEventListener("click", function() {
				if (confirm("カード分類を登録します。")) {
					saveCmValue_21();
					alert("登録完了。\n新しい分類による絞り込みは次回以降有効化されます。")
				}
			}, false);
		var groupViewSelectEL = createGroupSelecter(function() {
			tmp = groupViewSelectEL.options[groupViewSelectEL.selectedIndex].value;
			if (tmp == "") { return; }
			selectedGroup = tmp;
			viewCardGroup();
		});
		if (tableMode == "param") {
			modeParamBtn.disabled = true;
			modeSkillBtn.disabled = false;
		} else if (tableMode == "skill") {
			modeParamBtn.disabled = false;
			modeSkillBtn.disabled = true;
		} else {
			modeParamBtn.disabled = false;
			modeSkillBtn.disabled = false;
		}
		
		showbtnsEL.appendChild(modeParamBtn);
		showbtnsEL.appendChild(modeSkillBtn);
		showbtnsEL.appendChild(d_21.createTextNode("　／　"));
		showbtnsEL.appendChild(allShowBtn);
		showbtnsEL.appendChild(setGroupBtn);
		showbtnsEL.appendChild(d_21.createTextNode("　／　"));
		showbtnsEL.appendChild(groupViewSelectEL);
	}
	// 【設定情報】レイアウト
	function createOptionLayout() {
		opBaseEL.appendChild(d_21.createTextNode("【設定等々】"));
		opBaseEL.appendChild(d_21.createElement("br"));
		opBaseEL.appendChild(d_21.createTextNode("　１．カード分類名称を下記に"));
		var renameGroupBtn = d_21.createElement("input");
			renameGroupBtn.type = "button";
			renameGroupBtn.id = "brotool_renameGroupBtn"
			renameGroupBtn.value = "【変更する】";
			renameGroupBtn.addEventListener("click", function() {
				if (confirm("カード分類名称を変更します。")) {
					for (var i = 0, len = cardGroupArray.length; i < len; i++) {
						cardGroupArray[i][1] = $_21("#brotool_renameGroup_" + cardGroupArray[i][0]).val();
					}
					saveCmValue_21();
					alert("変更完了。\n新しい分類名称は次回以降有効化されます。")
				}
			}, false);
		opBaseEL.appendChild(renameGroupBtn);
		opBaseEL.appendChild(d_21.createElement("br"));
		for (var i = 0, len = cardGroupArray.length; i < len; i++) {
			opBaseEL.appendChild(d_21.createElement("br"));
			opBaseEL.appendChild(d_21.createTextNode("　　" + (i+1) + ".【新】"));
			var textEL = d_21.createElement("input");
				textEL.type = "text";
				textEL.size = 10;
				textEL.value = cardGroupArray[i][1];
				textEL.id = "brotool_renameGroup_" + cardGroupArray[i][0];
			opBaseEL.appendChild(textEL);
			opBaseEL.appendChild(d_21.createTextNode("　【旧】" + cardGroupArray[i][1]));
		}
		
		opBaseEL.appendChild(d_21.createElement("br"));
		opBaseEL.appendChild(d_21.createElement("br"));
		opBaseEL.appendChild(d_21.createTextNode("　２．現ワールドのカード分類情報を"));
	var resetBtn = d_21.createElement("input");
		resetBtn.type = "button";
		resetBtn.id = "brotool_resetBtn";
		resetBtn.value = "【リセットする】";
		resetBtn.addEventListener("click", function() {
			resetBtn.disabled = true;
			if (confirm("保存してある本ワールドのカード分類情報のすべてをクリアします。")) {
				if (confirm("【再確認】本ワールドのカード分類情報のすべてをクリアします。")) {
					resetCmValue();
					alert("リセット完了しました。");
					location.href= "../card/deck.php";
				} else {
					resetBtn.disabled = false;
				}
			} else {
				resetBtn.disabled = false;
			}
		}, false);
		opBaseEL.appendChild(resetBtn);
		
		opBaseEL.appendChild(d_21.createElement("br"));
		opBaseEL.appendChild(d_21.createElement("br"));
		opBaseEL.appendChild(d_21.createTextNode("　３．本スクリプトの最新版などは→をご確認ください　・ｗ・　"));
		var aEL = d_21.createElement("a");
			aEL.innerHTML = "<font color='blue'><u>Project.殺伐</u></font>";
			aEL.href = "http://aoyamayuuto.blog92.fc2.com/";
			aEL.target = "_blank";
		opBaseEL.appendChild(aEL);
		opBaseEL.appendChild(d_21.createElement("br"));
		opBaseEL.appendChild(d_21.createElement("br"));
	}
}
////////////////////////////////////////////////////////
// ページ読み込み関数
////////////////////////////////////////////////////////
function loadPage_deck (loadNo) {
	var opt = {
		method: 'get',
		url: hrefArray_21[loadNo],
		onload: function(res) {
			addPageElement_deck(loadNo, res);
		}
	}
	GM_xmlhttpRequest(opt); 
}
function addPageElement_deck(loadNo, res) {
//faraway120126	var targetNode = $xp1_21('//div[@class="rotateInfo bottom clearfix"]', d_21);
	var targetNode = $xp1_21('//div[@class="rotateInfo clearfix label-all-color-inner"]', d_21);
	var fillterEL = d_21.createElement('html');
		fillterEL.innerHTML = res.responseText;
//faraway120126	var pageBarNode = $xp1_21('descendant::div[@class="rotateInfo bottom clearfix"]', fillterEL);
	var pageBarNode = $xp1_21('descendant::div[@class="rotateInfo clearfix label-all-color-inner"]', fillterEL);
		targetNode.parentNode.appendChild(pageBarNode);
	
	// 一覧情報回収
	var tmpFileCardList = getFileCardList(fillterEL);
	var tbodyEL = $xp1_21('//table[@id="brotool_fileTableEL"]/tbody', d_21);
	createTableData(tbodyEL, tmpFileCardList);
	for (var i = 0, len = tmpFileCardList.length; i < len; i++) {
		fileCardList.push(tmpFileCardList[i]);
	}
	
	// つなげて表示
	var cardFileNode = $xp1_21('descendant::div[@id="cardFileList"]', fillterEL);
	if (!!cardFileNode) {
		targetNode.parentNode.appendChild(cardFileNode);
	} else {
//faraway120126		var cardNodes = $xp_21('descendant::div[@class="cardStatusDetail"]', fillterEL);
		var cardNodes = $xp_21('descendant::div[@class="cardStatusDetail label-setting-mode"]', fillterEL);
		for (var i = 0, len = cardNodes.snapshotLength; i < len; i++) {
			targetNode.parentNode.appendChild(cardNodes.snapshotItem(i));
		}
	}
	
	if (loadNo + 1 >= hrefArray_21.length) {
		targetNode.parentNode.appendChild(pageBarNode.cloneNode(true));
		$_21("#brotool_fileTableEL").tablesorter( { headers: {
			9: { sorter:"digit"},
			10: { sorter:"digit"},
			11: { sorter:"digit"},
			12: { sorter:"digit"},
			13: { sorter:"digit"},
			14: { sorter:"digit"},
			15: { sorter:"digit"},
		}} );
		return;
	}
	loadPage_deck(loadNo + 1);
}
////////////////////////////////////////////////////////
// カード情報回収関数
////////////////////////////////////////////////////////
function getFileCardList(targetOp) {
	if (!targetOp) { targetOp = d_21 }
//faraway120126	var cardNodes = $xp_21('descendant::div[@class="cardStatusDetail"]', targetOp);
	var cardNodes = $xp_21('descendant::div[@class="cardStatusDetail label-setting-mode"]', targetOp);
	
	var res_FileCardList = [];
	// 通常表示
	var normalFileCardListNodes = $xp_21('descendant::div[@id="cardFileList"]//div[@class="cardColmn"]', targetOp);
	for (var i = 0, len = normalFileCardListNodes.snapshotLength; i < len; i++) {
		var cardInfo = getCardInfoNormal(normalFileCardListNodes.snapshotItem(i));
		res_FileCardList.push(cardInfo);
	}
	// 縮小表示
//faraway120126	var miniFileCardListNodes = $xp_21('descendant::div[@class="cardStatusDetail"]', targetOp);
	var miniFileCardListNodes = $xp_21('descendant::div[@class="cardStatusDetail label-setting-mode"]', targetOp);
	for (var i = 0, len = miniFileCardListNodes.snapshotLength; i < len; i++) {
		var cardInfo = getCardInfoMini(miniFileCardListNodes.snapshotItem(i));
		res_FileCardList.push(cardInfo);
	}
	return res_FileCardList;
}
function getCardInfoMini(cardStatusDetail) {
	var cardInfo = {};
	cardInfo["cardno"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[1]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_att"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[1]/td[2]', cardStatusDetail).innerHTML;
	cardInfo["name"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[2]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_int"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[2]/td[2]', cardStatusDetail).innerHTML;
	cardInfo["level"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[3]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_wdef"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[3]/td[2]', cardStatusDetail).innerHTML;
	cardInfo["cost"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[4]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_sdef"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[4]/td[2]', cardStatusDetail).innerHTML;
	cardInfo["soltype"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[5]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_bdef"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[5]/td[2]', cardStatusDetail).innerHTML;
	cardInfo["status_hp"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[6]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_rdef"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[6]/td[2]', cardStatusDetail).innerHTML;
	cardInfo["para"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[7]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_speed"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[7]/td[2]', cardStatusDetail).innerHTML;
	
	var skillName1 = $xp1_21('descendant::table[@class="statusParameter2"]/tbody/tr[3]/td[1]', cardStatusDetail);
	var skillName2 = $xp1_21('descendant::table[@class="statusParameter2"]/tbody/tr[4]/td[1]', cardStatusDetail);
	var skillName3 = $xp1_21('descendant::table[@class="statusParameter2"]/tbody/tr[5]/td[1]', cardStatusDetail);
	
	if (skillName1.innerHTML == "") {
		cardInfo["skillName1"] = "-";
	} else {
		if (skillName1.parentNode.className == "used") {
			cardInfo["skillName1"] = "<s>" + skillName1.innerHTML + "</s>";
		} else {
			cardInfo["skillName1"] = skillName1.innerHTML;
		}
	}
	if (skillName2.innerHTML == "") {
		cardInfo["skillName2"] = "-";
	} else {
		if (skillName2.parentNode.className == "used") {
			cardInfo["skillName2"] = "<s>" + skillName2.innerHTML + "</s>";
		} else {
			cardInfo["skillName2"] = skillName2.innerHTML;
		}
	}
	if (skillName3.innerHTML == "") {
		cardInfo["skillName3"] = "-";
	} else {
		if (skillName3.parentNode.className == "used") {
			cardInfo["skillName3"] = "<s>" + skillName3.innerHTML + "</s>";
		} else {
			cardInfo["skillName3"] = skillName3.innerHTML;
		}
	}
	cardInfo["uqId"] = getUqId(cardStatusDetail);
	
	// 分類識別要素付加
	var spanEL = d_21.createElement("span");
		spanEL.id = "brotool_cardGroup" + checkCardGroup(cardInfo["uqId"]);
		cardStatusDetail.appendChild(spanEL);
	if (selectedGroup != "full" && spanEL.id != "brotool_" + selectedGroup) {
		cardStatusDetail.style.display = "none";
	}
	
	return cardInfo;
}
function getCardInfoNormal(cardColmn) {
	var cardInfo = {};
	cardInfo["cost"] = $xp1_21('descendant::span[@class="cost"]', cardColmn).innerHTML;
	cardInfo["name"] = $xp1_21('descendant::span[@class="name"]', cardColmn).innerHTML;
	cardInfo["level"] = $xp1_21('descendant::span[starts-with(@class, "level_")]', cardColmn).innerHTML;
	cardInfo["soltype"] = $xp1_21('descendant::span[@class="soltype"]//img', cardColmn).alt;
	cardInfo["cardno"] = $xp1_21('descendant::span[@class="cardno"]', cardColmn).innerHTML;
	cardInfo["status_hp"] = $xp1_21('descendant::span[@class="status_hp"]', cardColmn).innerHTML.split("/")[0];
	cardInfo["status_att"] = $xp1_21('descendant::span[@class="status_att"]', cardColmn).innerHTML;
	cardInfo["status_int"] = $xp1_21('descendant::span[@class="status_int"]', cardColmn).innerHTML;
	cardInfo["status_wdef"] = $xp1_21('descendant::span[@class="status_wdef"]', cardColmn).innerHTML;
	cardInfo["status_sdef"] = $xp1_21('descendant::span[@class="status_sdef"]', cardColmn).innerHTML;
	cardInfo["status_bdef"] = $xp1_21('descendant::span[@class="status_bdef"]', cardColmn).innerHTML;
	cardInfo["status_rdef"] = $xp1_21('descendant::span[@class="status_rdef"]', cardColmn).innerHTML;
	cardInfo["status_speed"] = $xp1_21('descendant::span[@class="status_speed"]', cardColmn).innerHTML;
	cardInfo["para"] = $xp1_21('descendant::div[@class="para"]', cardColmn).innerHTML;
	var skillName1 = $xp1_21('descendant::span[@class="skillName1 "]', cardColmn)
	var skillName2 = $xp1_21('descendant::span[@class="skillName2 "]', cardColmn);
	var skillName3 = $xp1_21('descendant::span[@class="skillName3 "]', cardColmn);
	if (!skillName1) {
		cardInfo["skillName1"] = "-";
	} else {
		if (!!$xp1_21('descendant::span', skillName1)) {
			cardInfo["skillName1"] = "<s>" + skillName1.innerHTML.split(":")[1] + "</s>";
		} else {
			cardInfo["skillName1"] = skillName1.innerHTML.split(":")[1];
		}
	}
	if (!skillName2) {
		cardInfo["skillName2"] = "-";
	} else {
		if (!!$xp1_21('descendant::span', skillName2)) {
			cardInfo["skillName2"] = "<s>" + skillName2.innerHTML.split(":")[1] + "</s>";
		} else {
			cardInfo["skillName2"] = skillName2.innerHTML.split(":")[1];
		}
	}
	if (!skillName3) {
		cardInfo["skillName3"] = "-";
	} else {
		if (!!$xp1_21('descendant::span', skillName3)) {
			cardInfo["skillName3"] = "<s>" + skillName3.innerHTML.split(":")[1] + "</s>";
		} else {
			cardInfo["skillName3"] = skillName3.innerHTML.split(":")[1];
		}
	}
	cardInfo["uqId"] = getUqId(cardColmn);
	
	// 分類識別要素付加
	if (cardColmn.parentNode.id == "cardFileList") {
		var spanEL = d_21.createElement("span");
			spanEL.id = "brotool_cardGroup" + checkCardGroup(cardInfo["uqId"]);
			cardColmn.appendChild(spanEL);
		if (selectedGroup != "full" && spanEL.id != "brotool_" + selectedGroup) {
			cardColmn.style.display = "none";
		}
	}
	
	// 裏返し処理差し替え
	var exeA = $_21("a[href^=javascript:executeA(]", cardColmn).get(0);
	var exeB = $_21("a[href^=javascript:executeB(]", cardColmn).get(0);
	if (!!exeA && !!exeB) {
		var num = exeA.href.match(/[0-9]+/)[0];
		
		exeA.href="javascript:void(0)";
		exeA.addEventListener("click", function() {
			$_21("[id=card_frontback" + num + "-front]").hide();
			$_21("[id=card_frontback" + num + "-back]").show();
		}, false);
		exeB.href="javascript:void(0)";
		exeB.addEventListener("click", function() {
			$_21("[id=card_frontback" + num + "-front]").show();
			$_21("[id=card_frontback" + num + "-back]").hide();
		}, false);
	}
		
	return cardInfo;
}

function getUqId (nodes) {
	// カードIDを取得

	//デッキ外のカード削除ボタンから取得
	var onClickNode = $xp1_21('descendant::a[@class="delete-card-button" and @onClick]', nodes);

	//デッキ内「ファイルに戻す」から取得
	if (!onClickNode) { 
		onClickNode = $xp1_21('descendant::img[@class="aboutdeck" and @onClick]', nodes);
	}
	//デッキ外「カードの保護」から取得
	if (!onClickNode) { 
		onClickNode = $xp1_21('descendant::a[@class="set-protection-button" and @onClick]', nodes);
	}
	 //デッキ外「カードの保護の解除」から取得
	if (!onClickNode) {
		onClickNode = $xp1_21('descendant::a[@class="remove-protection-button" and @onClick]', nodes);
		if (onClickNode) {if(onClickNode.getAttribute('onClick').indexOf("alert")!=-1) onClickNode = null;}	 //デュエル対策。
	}
	 //デッキ外「ポイント振りなおし」から取得
	if (!onClickNode) {
		onClickNode = $xp1_21('descendant::a[@class="useCp" and @onClick]', nodes);
	}

	if (!onClickNode) { return null; }
	var splitArray = onClickNode.getAttribute('onClick').split(",");
	var cardId = splitArray[1].replace(/^\s+|\s+$/g, "");
	return cardId;
}
////////////////////////////////////////////////////////
// 一覧テーブル関連の共通関数
////////////////////////////////////////////////////////
// ヘッダ部
function createTableHead(theadEL) {
	var trEL = d_21.createElement("tr");
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "No";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "兵科";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "武将No";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "名前";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "Lv";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "コスト";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "HP";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "討伐";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "攻撃";
		thEL.id = "mode_param";
		thEL.style.display = "none";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "知力";
		thEL.id = "mode_param";
		thEL.style.display = "none";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "速度";
		thEL.id = "mode_param";
		thEL.style.display = "none";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "歩防";
		thEL.id = "mode_param";
		thEL.style.display = "none";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "槍防";
		thEL.id = "mode_param";
		thEL.style.display = "none";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "弓防";
		thEL.id = "mode_param";
		thEL.style.display = "none";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "騎防";
		thEL.id = "mode_param";
		thEL.style.display = "none";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "skill_1";
		thEL.id = "mode_skill";
		thEL.style.display = "none";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "skill_2";
		thEL.id = "mode_skill";
		thEL.style.display = "none";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "skill_3";
		thEL.id = "mode_skill";
		thEL.style.display = "none";
		trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");
		thEL.innerHTML = "分類";
		trEL.appendChild(thEL);
		theadEL.appendChild(trEL);
}
// ボディ部
function createTableData(tbodyEL, cardList) {
	for (var i = 0, len = cardList.length; i < len; i++ ) {
		var cardInfo = cardList[i];
		var trEL = d_21.createElement("tr");
		var thEL = d_21.createElement("th");
			thEL.innerHTML = data_index++;
			trEL.appendChild(thEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["soltype"];
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["cardno"];
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["name"];
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["level"];
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["cost"];
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["status_hp"];
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["para"];
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["status_att"];
			tdEL.id = "mode_param";
			tdEL.style.display = "none";
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["status_int"];
			tdEL.id = "mode_param";
			tdEL.style.display = "none";
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["status_speed"];
			tdEL.id = "mode_param";
			tdEL.style.display = "none";
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["status_wdef"];
			tdEL.id = "mode_param";
			tdEL.style.display = "none";
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["status_sdef"];
			tdEL.id = "mode_param";
			tdEL.style.display = "none";
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["status_bdef"];
			tdEL.id = "mode_param";
			tdEL.style.display = "none";
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["status_rdef"];
			tdEL.id = "mode_param";
			tdEL.style.display = "none";
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
//alert(cardInfo["status_speed"]&",\n"&cardInfo["status_speed"].innerHtml);
//alert(cardInfo["status_speed"].text);
//alert(cardInfo["skillName1"]);

			tdEL.innerHTML = cardInfo["skillName1"];
			tdEL.id = "mode_skill";
			tdEL.style.display = "none";
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["skillName2"];
			tdEL.id = "mode_skill";
			tdEL.style.display = "none";
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
			tdEL.innerHTML = cardInfo["skillName3"];
			tdEL.id = "mode_skill";
			tdEL.style.display = "none";
			trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
		if (!cardInfo["uqId"]) {
			tdEL.innerHTML = "-";
			tdEL.id = "brotool_cardGroup0";
		} else {
			var selectEL = d_21.createElement("select");
				selectEL.id = "card_group_select";
				selectEL.addEventListener("change", setUqIdToGroups(cardInfo["uqId"], selectEL), false);
			var optionEL = d_21.createElement("option");
				optionEL.value = "cardGroup0";
				optionEL.text = "未分類";
				selectEL.appendChild(optionEL);
			var selopId = checkCardGroup(cardInfo["uqId"]);
			for (var j = 0, jlen = cardGroupArray.length; j < jlen; j++ ) {
				if (cardGroupArray[j][1] != "") {
					var optionEL = d_21.createElement("option");
						optionEL.value = cardGroupArray[j][0];
						optionEL.text = cardGroupArray[j][1];
						selectEL.appendChild(optionEL);
						if (selopId == j + 1) { optionEL.selected = true}
				}
			}
			tdEL.appendChild(selectEL);
			tdEL.id = "brotool_cardGroup" + selopId;
		}
			trEL.appendChild(tdEL);
			if (selectedGroup != "full" && tdEL.id != "brotool_" + selectedGroup) {
				trEL.style.display = "none";
			}
		tbodyEL.appendChild(trEL);
	}
	changeTableMode();
	
	// 分類項目変数への該当IDへのセット、既登録があればそれを削除
	function setUqIdToGroups(uqId, select) {
		return function() {
			for (var i = 0, len = cardGroup1.length; i < len; i++) {
				if (cardGroup1[i] == uqId) { cardGroup1.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup2.length; i < len; i++) {
				if (cardGroup2[i] == uqId) { cardGroup2.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup3.length; i < len; i++) {
				if (cardGroup3[i] == uqId) { cardGroup3.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup4.length; i < len; i++) {
				if (cardGroup4[i] == uqId) { cardGroup4.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup5.length; i < len; i++) {
				if (cardGroup5[i] == uqId) { cardGroup5.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup6.length; i < len; i++) {
				if (cardGroup6[i] == uqId) { cardGroup6.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup7.length; i < len; i++) {
				if (cardGroup7[i] == uqId) { cardGroup7.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup8.length; i < len; i++) {
				if (cardGroup8[i] == uqId) { cardGroup8.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup9.length; i < len; i++) {
				if (cardGroup9[i] == uqId) { cardGroup9.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup10.length; i < len; i++) {
				if (cardGroup10[i] == uqId) { cardGroup10.splice(i,1); i--; }
			}
			
			var setGroup = select.options[select.selectedIndex].value;
			if (setGroup == "cardGroup1") {
				cardGroup1.push(uqId);
			} else if (setGroup == "cardGroup2") {
				cardGroup2.push(uqId);
			} else if (setGroup == "cardGroup3") {
				cardGroup3.push(uqId);
			} else if (setGroup == "cardGroup4") {
				cardGroup4.push(uqId);
			} else if (setGroup == "cardGroup5") {
				cardGroup5.push(uqId);
			} else if (setGroup == "cardGroup6") {
				cardGroup6.push(uqId);
			} else if (setGroup == "cardGroup7") {
				cardGroup7.push(uqId);
			} else if (setGroup == "cardGroup8") {
				cardGroup8.push(uqId);
			} else if (setGroup == "cardGroup9") {
				cardGroup9.push(uqId);
			} else if (setGroup == "cardGroup10") {
				cardGroup10.push(uqId);
			}
		}
	}
}
// 一覧テーブル：パラメータ⇔スキル切替え関数
function changeTableMode(setMode) {
	if (!!setMode) { tableMode = setMode };
	if (tableMode == "param") {
		$_21("[id=mode_param]").show();
		$_21("[id=mode_skill]").hide();
	} else if (tableMode == "skill") {
		$_21("[id=mode_param]").hide();
		$_21("[id=mode_skill]").show();
	}
}
////////////////////////////////////////////////////////
// 分類関連の共通関数
////////////////////////////////////////////////////////
// 項目変更時に引数の関数を呼び出す分類セレクターを返す
function createGroupSelecter(func) {
	var groupViewSelectEL = d_21.createElement("select");
		groupViewSelectEL.id = "brotool_groupViewSelectEL";
		groupViewSelectEL.addEventListener("change", func, false);
	var groupViewOptionEL = d_21.createElement("option");
		groupViewOptionEL.value = "";
		groupViewOptionEL.text = "--表示モード選択--";
		groupViewSelectEL.appendChild(groupViewOptionEL);
	var groupViewOptionEL = d_21.createElement("option");
		groupViewOptionEL.value = "full";
		groupViewOptionEL.text = "【全表示】";
		groupViewSelectEL.appendChild(groupViewOptionEL);
	var groupViewOptionEL = d_21.createElement("option");
		groupViewOptionEL.value = "cardGroup0";
		groupViewOptionEL.text = "【未分類】";
		groupViewSelectEL.appendChild(groupViewOptionEL);
	for (var i = 0, len = cardGroupArray.length; i < len; i++ ) {
		if (cardGroupArray[i][1] != "") {
			var groupViewOptionEL = d_21.createElement("option");
				groupViewOptionEL.value = cardGroupArray[i][0];
				groupViewOptionEL.text = cardGroupArray[i][1];
				groupViewSelectEL.appendChild(groupViewOptionEL);
		}
	}
	return groupViewSelectEL;
}
// 分類表示・非表示実行関数
function viewCardGroup() {
	if (selectedGroup == "full") {
		$_21("[id=brotool_cardGroup0]").parent().show();
		$_21("[id=brotool_cardGroup1]").parent().show();
		$_21("[id=brotool_cardGroup2]").parent().show();
		$_21("[id=brotool_cardGroup3]").parent().show();
		$_21("[id=brotool_cardGroup4]").parent().show();
		$_21("[id=brotool_cardGroup5]").parent().show();
		$_21("[id=brotool_cardGroup6]").parent().show();
		$_21("[id=brotool_cardGroup7]").parent().show();
		$_21("[id=brotool_cardGroup8]").parent().show();
		$_21("[id=brotool_cardGroup9]").parent().show();
		$_21("[id=brotool_cardGroup10]").parent().show();
	} else {
		$_21("[id=brotool_cardGroup0]").parent().hide();
		$_21("[id=brotool_cardGroup1]").parent().hide();
		$_21("[id=brotool_cardGroup2]").parent().hide();
		$_21("[id=brotool_cardGroup3]").parent().hide();
		$_21("[id=brotool_cardGroup4]").parent().hide();
		$_21("[id=brotool_cardGroup5]").parent().hide();
		$_21("[id=brotool_cardGroup6]").parent().hide();
		$_21("[id=brotool_cardGroup7]").parent().hide();
		$_21("[id=brotool_cardGroup8]").parent().hide();
		$_21("[id=brotool_cardGroup9]").parent().hide();
		$_21("[id=brotool_cardGroup10]").parent().hide();
		$_21("[id=brotool_" + selectedGroup + "]").parent().show();
	}
}
// 引数で渡された固有IDが分類に登録されているかをチェック。
// 登録されている場合は、その分類連番を返す。
function checkCardGroup(uqId) {
	if (cardGroup1.indexOf(uqId) != -1) {
		return 1;
	} else if (cardGroup2.indexOf(uqId) != -1) {
		return 2;
	} else if (cardGroup3.indexOf(uqId) != -1) {
		return 3;
	} else if (cardGroup4.indexOf(uqId) != -1) {
		return 4;
	} else if (cardGroup5.indexOf(uqId) != -1) {
		return 5;
	} else if (cardGroup6.indexOf(uqId) != -1) {
		return 6;
	} else if (cardGroup7.indexOf(uqId) != -1) {
		return 7;
	} else if (cardGroup8.indexOf(uqId) != -1) {
		return 8;
	} else if (cardGroup9.indexOf(uqId) != -1) {
		return 9;
	} else if (cardGroup10.indexOf(uqId) != -1) {
		return 10;
	} else {
		return 0;
	}
}
////////////////////////////////////////////////////////
// 共通CSS
////////////////////////////////////////////////////////
function addCommonStyle() {
//faraway110601 GM_addStyle()への引数をString()で囲むFirefox4.0対応
	GM_addStyle(String(<><![CDATA[
		div.baseDiv {
			margin: 5px;
		}
		table.showTable {
			border: 2px solid black;
			border-collapse: collapse;
			margin: 5px;
		}
		.showTable th {
			border: 2px solid black;
			border-collapse: collapse;
			color: white;
			background-color: gray;
			padding : 4px;
		}
		.showTable td {
			border: 2px solid black;
			border-collapse: collapse;
			color: black;
			background-color: white;
			padding : 4px;
		}
	]]></>));
}

////////////////////////////////////////////////////////
// GM関連の共通関数
////////////////////////////////////////////////////////
function loadCmValue_21 () {
	cardGroupArray = eval(GM_getValue(worldKey_21 + "cardGroupArray", [
		["cardGroup1","分類１"],
		["cardGroup2","分類２"],
		["cardGroup3","分類３"],
		["cardGroup4","分類４"],
		["cardGroup5","分類５"],
		["cardGroup6",""],
		["cardGroup7",""],
		["cardGroup8",""],
		["cardGroup9",""],
		["cardGroup10",""],
	]));
	cardGroup1 = eval(GM_getValue(worldKey_21 + "cardGroup1", []));
	cardGroup2 = eval(GM_getValue(worldKey_21 + "cardGroup2", []));
	cardGroup3 = eval(GM_getValue(worldKey_21 + "cardGroup3", []));
	cardGroup4 = eval(GM_getValue(worldKey_21 + "cardGroup4", []));
	cardGroup5 = eval(GM_getValue(worldKey_21 + "cardGroup5", []));
	cardGroup6 = eval(GM_getValue(worldKey_21 + "cardGroup6", []));
	cardGroup7 = eval(GM_getValue(worldKey_21 + "cardGroup7", []));
	cardGroup8 = eval(GM_getValue(worldKey_21 + "cardGroup8", []));
	cardGroup9 = eval(GM_getValue(worldKey_21 + "cardGroup9", []));
	cardGroup10 = eval(GM_getValue(worldKey_21 + "cardGroup10", []));
}
function saveCmValue_21 () {
	GM_setValue(worldKey_21 + "cardGroupArray", cardGroupArray.toSource());
	GM_setValue(worldKey_21 + "cardGroup1", cardGroup1.toSource());
	GM_setValue(worldKey_21 + "cardGroup2", cardGroup2.toSource());
	GM_setValue(worldKey_21 + "cardGroup3", cardGroup3.toSource());
	GM_setValue(worldKey_21 + "cardGroup4", cardGroup4.toSource());
	GM_setValue(worldKey_21 + "cardGroup5", cardGroup5.toSource());
	GM_setValue(worldKey_21 + "cardGroup6", cardGroup6.toSource());
	GM_setValue(worldKey_21 + "cardGroup7", cardGroup7.toSource());
	GM_setValue(worldKey_21 + "cardGroup8", cardGroup8.toSource());
	GM_setValue(worldKey_21 + "cardGroup9", cardGroup9.toSource());
	GM_setValue(worldKey_21 + "cardGroup10", cardGroup10.toSource());
}
function resetCmValue () {
	GM_deleteValue(worldKey_21 + "cardGroupArray");
	GM_deleteValue(worldKey_21 + "cardGroup1");
	GM_deleteValue(worldKey_21 + "cardGroup2");
	GM_deleteValue(worldKey_21 + "cardGroup3");
	GM_deleteValue(worldKey_21 + "cardGroup4");
	GM_deleteValue(worldKey_21 + "cardGroup5");
	GM_deleteValue(worldKey_21 + "cardGroup6");
	GM_deleteValue(worldKey_21 + "cardGroup7");
	GM_deleteValue(worldKey_21 + "cardGroup8");
	GM_deleteValue(worldKey_21 + "cardGroup9");
	GM_deleteValue(worldKey_21 + "cardGroup10");
}

////////////////////////////////////////////////////////
// 下記を使用させていただいております。
// tablesorter
// Author: Christian Bach
// Version: 2.0.3 (changelog)
// Licence: Dual licensed under MIT  or GPL licenses. 
////////////////////////////////////////////////////////
(function($_21){$_21.extend({tablesorter:new function(){var parsers=[],widgets=[];this.defaults={cssHeader:"header",cssAsc:"headerSortUp",cssDesc:"headerSortDown",sortInitialOrder:"asc",sortMultiSortKey:"shiftKey",sortForce:null,sortAppend:null,textExtraction:"simple",parsers:{},widgets:[],widgetZebra:{css:["even","odd"]},headers:{},widthFixed:false,cancelSelection:true,sortList:[],headerList:[],dateFormat:"us",decimal:'.',debug:false};function benchmark(s,d){log(s+","+(new Date().getTime()-d_21.getTime())+"ms");}this.benchmark=benchmark;function log(s){if(typeof console!="undefined"&&typeof console.debug!="undefined"){console.log(s);}else{alert(s);}}function buildParserCache(table,$headers){if(table.config.debug){var parsersDebug="";}var rows=table.tBodies[0].rows;if(table.tBodies[0].rows[0]){var list=[],cells=rows[0].cells,l=cells.length;for(var i=0;i<l;i++){var p=false;if($_21.metadata&&($_21($headers[i]).metadata()&&$_21($headers[i]).metadata().sorter)){p=getParserById($_21($headers[i]).metadata().sorter);}else if((table.config.headers[i]&&table.config.headers[i].sorter)){p=getParserById(table.config.headers[i].sorter);}if(!p){p=detectParserForColumn(table,cells[i]);}if(table.config.debug){parsersDebug+="column:"+i+" parser:"+p.id+"\n";}list.push(p);}}if(table.config.debug){log(parsersDebug);}return list;};function detectParserForColumn(table,node){var l=parsers.length;for(var i=1;i<l;i++){if(parsers[i].is($_21.trim(getElementText(table.config,node)),table,node)){return parsers[i];}}return parsers[0];}function getParserById(name){var l=parsers.length;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==name.toLowerCase()){return parsers[i];}}return false;}function buildCache(table){if(table.config.debug){var cacheTime=new Date();}var totalRows=(table.tBodies[0]&&table.tBodies[0].rows.length)||0,totalCells=(table.tBodies[0].rows[0]&&table.tBodies[0].rows[0].cells.length)||0,parsers=table.config.parsers,cache={row:[],normalized:[]};for(var i=0;i<totalRows;++i){var c=table.tBodies[0].rows[i],cols=[];cache.row.push($_21(c));for(var j=0;j<totalCells;++j){cols.push(parsers[j].format(getElementText(table.config,c.cells[j]),table,c.cells[j]));}cols.push(i);cache.normalized.push(cols);cols=null;};if(table.config.debug){benchmark("Building cache for "+totalRows+" rows:",cacheTime);}return cache;};function getElementText(config,node){if(!node)return"";var t="";if(config.textExtraction=="simple"){if(node.childNodes[0]&&node.childNodes[0].hasChildNodes()){t=node.childNodes[0].innerHTML;}else{t=node.innerHTML;}}else{if(typeof(config.textExtraction)=="function"){t=config.textExtraction(node);}else{t=$_21(node).text();}}return t;}function appendToTable(table,cache){if(table.config.debug){var appendTime=new Date()}var c=cache,r=c.row,n=c.normalized,totalRows=n.length,checkCell=(n[0].length-1),tableBody=$_21(table.tBodies[0]),rows=[];for(var i=0;i<totalRows;i++){rows.push(r[n[i][checkCell]]);if(!table.config.appender){var o=r[n[i][checkCell]];var l=o.length;for(var j=0;j<l;j++){tableBody[0].appendChild(o[j]);}}}if(table.config.appender){table.config.appender(table,rows);}rows=null;if(table.config.debug){benchmark("Rebuilt table:",appendTime);}applyWidget(table);setTimeout(function(){$_21(table).trigger("sortEnd");},0);};function buildHeaders(table){if(table.config.debug){var time=new Date();}var meta=($_21.metadata)?true:false,tableHeadersRows=[];for(var i=0;i<table.tHead.rows.length;i++){tableHeadersRows[i]=0;};$tableHeaders=$_21("thead th",table);$tableHeaders.each(function(index){this.count=0;this.column=index;this.order=formatSortingOrder(table.config.sortInitialOrder);if(checkHeaderMetadata(this)||checkHeaderOptions(table,index))this.sortDisabled=true;if(!this.sortDisabled){$_21(this).addClass(table.config.cssHeader);}table.config.headerList[index]=this;});if(table.config.debug){benchmark("Built headers:",time);log($tableHeaders);}return $tableHeaders;};function checkCellColSpan(table,rows,row){var arr=[],r=table.tHead.rows,c=r[row].cells;for(var i=0;i<c.length;i++){var cell=c[i];if(cell.colSpan>1){arr=arr.concat(checkCellColSpan(table,headerArr,row++));}else{if(table.tHead.length==1||(cell.rowSpan>1||!r[row+1])){arr.push(cell);}}}return arr;};function checkHeaderMetadata(cell){if(($_21.metadata)&&($_21(cell).metadata().sorter===false)){return true;};return false;}function checkHeaderOptions(table,i){if((table.config.headers[i])&&(table.config.headers[i].sorter===false)){return true;};return false;}function applyWidget(table){var c=table.config.widgets;var l=c.length;for(var i=0;i<l;i++){getWidgetById(c[i]).format(table);}}function getWidgetById(name){var l=widgets.length;for(var i=0;i<l;i++){if(widgets[i].id.toLowerCase()==name.toLowerCase()){return widgets[i];}}};function formatSortingOrder(v){if(typeof(v)!="Number"){i=(v.toLowerCase()=="desc")?1:0;}else{i=(v==(0||1))?v:0;}return i;}function isValueInArray(v,a){var l=a.length;for(var i=0;i<l;i++){if(a[i][0]==v){return true;}}return false;}function setHeadersCss(table,$headers,list,css){$headers.removeClass(css[0]).removeClass(css[1]);var h=[];$headers.each(function(offset){if(!this.sortDisabled){h[this.column]=$_21(this);}});var l=list.length;for(var i=0;i<l;i++){h[list[i][0]].addClass(css[list[i][1]]);}}function fixColumnWidth(table,$headers){var c=table.config;if(c.widthFixed){var colgroup=$_21('<colgroup>');$_21("tr:first td",table.tBodies[0]).each(function(){colgroup.append($_21('<col>').css('width',$_21(this).width()));});$_21(table).prepend(colgroup);};}function updateHeaderSortCount(table,sortList){var c=table.config,l=sortList.length;for(var i=0;i<l;i++){var s=sortList[i],o=c.headerList[s[0]];o.count=s[1];o.count++;}}function multisort(table,sortList,cache){if(table.config.debug){var sortTime=new Date();}var dynamicExp="var sortWrapper = function(a,b) {",l=sortList.length;for(var i=0;i<l;i++){var c=sortList[i][0];var order=sortList[i][1];var s=(getCachedSortType(table.config.parsers,c)=="text")?((order==0)?"sortText":"sortTextDesc"):((order==0)?"sortNumeric":"sortNumericDesc");var e="e"+i;dynamicExp+="var "+e+" = "+s+"(a["+c+"],b["+c+"]); ";dynamicExp+="if("+e+") { return "+e+"; } ";dynamicExp+="else { ";}var orgOrderCol=cache.normalized[0].length-1;dynamicExp+="return a["+orgOrderCol+"]-b["+orgOrderCol+"];";for(var i=0;i<l;i++){dynamicExp+="}; ";}dynamicExp+="return 0; ";dynamicExp+="}; ";eval(dynamicExp);cache.normalized.sort(sortWrapper);if(table.config.debug){benchmark("Sorting on "+sortList.toString()+" and dir "+order+" time:",sortTime);}return cache;};function sortText(a,b){return((a<b)?-1:((a>b)?1:0));};function sortTextDesc(a,b){return((b<a)?-1:((b>a)?1:0));};function sortNumeric(a,b){return a-b;};function sortNumericDesc(a,b){return b-a;};function getCachedSortType(parsers,i){return parsers[i].type;};this.construct=function(settings){return this.each(function(){if(!this.tHead||!this.tBodies)return;var $this,$document,$headers,cache,config,shiftDown=0,sortOrder;this.config={};config=$_21.extend(this.config,$_21.tablesorter.defaults,settings);$this=$_21(this);$headers=buildHeaders(this);this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);var sortCSS=[config.cssDesc,config.cssAsc];fixColumnWidth(this);$headers.click(function(e){$this.trigger("sortStart");var totalRows=($this[0].tBodies[0]&&$this[0].tBodies[0].rows.length)||0;if(!this.sortDisabled&&totalRows>0){var $cell=$_21(this);var i=this.column;this.order=this.count++%2;if(!e[config.sortMultiSortKey]){config.sortList=[];if(config.sortForce!=null){var a=config.sortForce;for(var j=0;j<a.length;j++){if(a[j][0]!=i){config.sortList.push(a[j]);}}}config.sortList.push([i,this.order]);}else{if(isValueInArray(i,config.sortList)){for(var j=0;j<config.sortList.length;j++){var s=config.sortList[j],o=config.headerList[s[0]];if(s[0]==i){o.count=s[1];o.count++;s[1]=o.count%2;}}}else{config.sortList.push([i,this.order]);}};setTimeout(function(){setHeadersCss($this[0],$headers,config.sortList,sortCSS);appendToTable($this[0],multisort($this[0],config.sortList,cache));},1);return false;}}).mousedown(function(){if(config.cancelSelection){this.onselectstart=function(){return false};return false;}});$this.bind("update",function(){this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);}).bind("sorton",function(e,list){$_21(this).trigger("sortStart");config.sortList=list;var sortList=config.sortList;updateHeaderSortCount(this,sortList);setHeadersCss(this,$headers,sortList,sortCSS);appendToTable(this,multisort(this,sortList,cache));}).bind("appendCache",function(){appendToTable(this,cache);}).bind("applyWidgetId",function(e,id){getWidgetById(id).format(this);}).bind("applyWidgets",function(){applyWidget(this);});if($_21.metadata&&($_21(this).metadata()&&$_21(this).metadata().sortlist)){config.sortList=$_21(this).metadata().sortlist;}if(config.sortList.length>0){$this.trigger("sorton",[config.sortList]);}applyWidget(this);});};this.addParser=function(parser){var l=parsers.length,a=true;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==parser.id.toLowerCase()){a=false;}}if(a){parsers.push(parser);};};this.addWidget=function(widget){widgets.push(widget);};this.formatFloat=function(s){var i=parseFloat(s);return(isNaN(i))?0:i;};this.formatInt=function(s){var i=parseInt(s);return(isNaN(i))?0:i;};this.isDigit=function(s,config){var DECIMAL='\\'+config.decimal;var exp='/(^[+]?0('+DECIMAL+'0+)?$)|(^([-+]?[1-9][0-9]*)$)|(^([-+]?((0?|[1-9][0-9]*)'+DECIMAL+'(0*[1-9][0-9]*)))$)|(^[-+]?[1-9]+[0-9]*'+DECIMAL+'0+$)/';return RegExp(exp).test($_21.trim(s));};this.clearTableBody=function(table){if($_21.browser.msie){function empty(){while(this.firstChild)this.removeChild(this.firstChild);}empty.apply(table.tBodies[0]);}else{table.tBodies[0].innerHTML="";}};}});$_21.fn.extend({tablesorter:$_21.tablesorter.construct});var ts=$_21.tablesorter;ts.addParser({id:"text",is:function(s){return true;},format:function(s){return $_21.trim(s.toLowerCase());},type:"text"});ts.addParser({id:"digit",is:function(s,table){var c=table.config;return $_21.tablesorter.isDigit(s,c);},format:function(s){return $_21.tablesorter.formatFloat(s);},type:"numeric"});ts.addParser({id:"currency",is:function(s){return/^[￡$ｬ ?.]/.test(s);},format:function(s){return $_21.tablesorter.formatFloat(s.replace(new RegExp(/[^0-9.]/g),""));},type:"numeric"});ts.addParser({id:"ipAddress",is:function(s){return/^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(s);},format:function(s){var a=s.split("."),r="",l=a.length;for(var i=0;i<l;i++){var item=a[i];if(item.length==2){r+="0"+item;}else{r+=item;}}return $_21.tablesorter.formatFloat(r);},type:"numeric"});ts.addParser({id:"url",is:function(s){return/^(https?|ftp|file):\/\/$/.test(s);},format:function(s){return $_21.trim(s.replace(new RegExp(/(https?|ftp|file):\/\//),''));},type:"text"});ts.addParser({id:"isoDate",is:function(s){return/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(s);},format:function(s){return $_21.tablesorter.formatFloat((s!="")?new Date(s.replace(new RegExp(/-/g),"/")).getTime():"0");},type:"numeric"});ts.addParser({id:"percent",is:function(s){return/\%$/.test($_21.trim(s));},format:function(s){return $_21.tablesorter.formatFloat(s.replace(new RegExp(/%/g),""));},type:"numeric"});ts.addParser({id:"usLongDate",is:function(s){return s.match(new RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2}) (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM)))$/));},format:function(s){return $_21.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"shortDate",is:function(s){return/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/.test(s);},format:function(s,table){var c=table.config;s=s.replace(/\-/g,"/");if(c.dateFormat=="us"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$1/$2");}else if(c.dateFormat=="uk"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1");}else if(c.dateFormat=="dd/mm/yy"||c.dateFormat=="dd-mm-yy"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3");}return $_21.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"time",is:function(s){return/^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(s);},format:function(s){return $_21.tablesorter.formatFloat(new Date("2000/01/01 "+s).getTime());},type:"numeric"});ts.addParser({id:"metadata",is:function(s){return false;},format:function(s,table,cell){var c=table.config,p=(!c.parserMetadataName)?'sortValue':c.parserMetadataName;return $_21(cell).metadata()[p];},type:"numeric"});ts.addWidget({id:"zebra",format:function(table){if(table.config.debug){var time=new Date();}$_21("tr:visible",table.tBodies[0]).filter(':even').removeClass(table.config.widgetZebra.css[1]).addClass(table.config.widgetZebra.css[0]).end().filter(':odd').removeClass(table.config.widgetZebra.css[0]).addClass(table.config.widgetZebra.css[1]);if(table.config.debug){$_21.tablesorter.benchmark("Applying Zebra widget",time);}}});})($_21);

//faraway}) ();
}	//faraway
//faraway 21.武将カード分類ツールのソース(bro3_deck_tool.user.js)終了

//faraway 22.討伐・空き地 民兵出現 推定機のソース(bro3_calcn_craford_custom.user.js)開始
//================================================================================
//22.討伐・空き地 民兵出現 推定機
//================================================================================
// ==UserScript==
// @name           bro3_calcn_all
// @namespace      http://chaki.s27.xrea.com/br3/
// @include        http://*.3gokushi.jp/facility/castle_send_troop.php*
// @description    <内蔵版>ブラウザ三国志 領地敵兵算出機（全ワールド対応） by Craford, BSE（原版作者 きょう）（Cal1.3.7）＋賊討伐シミュレータ by きの。 (ver 1.05a)
// @author         Craford,kino.,BSE,base_Kyou
// @version        1.3.7 + 1.05a
// ==/UserScript==
//　2010/04/26　v1.0作成（by きょう）
//　2010/04/28　v1.1作成　剣兵での必要攻撃力数を追加。各兵科の攻撃力の兵士数換算を追加。（by きょう）
//　2010/04/28　v1.1.1作成　上級兵の出現パターン修正。（by きょう）
//　2010/05/02　v1.1.2作成　★2の例外処理を削除(例外無しで出現確認のため。（by きょう）
//　2010/05/21　v1.2作成　タイル数をカウントすることで、自領地の賊討伐にも対応（by きょう）
//　2010/05/22　v1.2.1作成　GoogleChromeで動作しない不具合を修正（by きょう）
//  2010/10/04  v1.3 Beta1 3期専用暫定版(BSE)
//  2010.10.04  v1.3 Beta2 少数点以下の処理修正(BSE)
//  2010.10.05  v1.3 Beta3 MINも付けてみた(BSE)
//  2010.10.05  ver1.3b4 基準数変更。兵数も出してみた（BSE）
// ベースのスクリプトの算出する物とBate4が算出する物が変わったりなんとかして、スクリプト名変更
//  2010.10.05  ver1.3b5 計算方法変更（BSE）
//　2010.10.06  ver1.3b6 Beyond連携中止。単独稼働用。距離。（BSE）
//  2010.10.07  ver1.3 マイナス座標の拠点のマイナスが反映されない不具合修正。3期専用配布版（BSE）
//  2010.10.07  ver1.31 兵数換算を再調整（BSE）
//  2010.10.13  ver1.32 苦情対策（BSE）
//　2010.10.25　ver1.33 苦情対策Ⅱ（BSE）
//　2010.11.15　ver1.3.4 17鯖をいじいじ　名称変更
//  2010.02.09  ver1.3.5 サーバーの判別処理を追加し、1期,2期,3期を自動判別するように修正（Craford）
//  2010.02.22  ver1.3.6 4期のサーバー判定方法に誤作動があったため判定方法を変更（きの。）
//  2011.03.24  ver1.3.7 サーバー自動判定が使えないので、パラメータテーブル化。NEDさんの5期テーブル(3/23版)を反映。
//
//  2010.12.03  賊討伐シミュレータ ver1.03 追加　(きの。)
//  2010.01.16  ver1.04a 100万以上の攻撃力の時にエラーになっていたのを修正。(きの。)
//  2010.02.18  ver1.05a 鍛冶場・課金状況取得をボタンクリックに変更（負荷対策）(きの。)

//faraway ( function(){
function disp_calcn()
{
	//window.alert("22.:" + location.pathname);	//faraway
    if( !location.pathname.match("/facility/castle_send_troop.php") ) return;	//faraway
var serverTable = [ 
	// サーバー情報初期設定
	["m1",7],
	["m9",7],
	["m13",6],
	["m17",6],
	["m21",5],
	["m25",5],
	["m29",4],
	["m31",4],
	["m33",2],
	["m35",2],
	["m37",2],
	["m39",1],
	["m40",1],
	["m41",1],
	["m42",1],
	["m43",1],
	["m44",1],
	["m45",1],
	["",1],
	["",1],
	["",1],
	["",1],
	["",1],
	["",1],
	["",1]
]

//　バージョン配置用
var ver_rack = "ver1.3.7 (Craford_custom)</b>";
var kino_ver = "1.05a";

//　配布URL
var se_rack = "<b><内蔵版>ブラウザ三国志 領地敵兵算出機 by Craford, BSE ";
var url_rack = "http://ned.bar-sui.net/calcn/";
var com_rack = "出現目安です！ 初心者から変態まで御用達の通期版（とりあえず7期までは大丈夫か？）"   // 2011/02/09 Craford修正
var url_rack2 = "http://chaki.s27.xrea.com/br3/";

//　ページタイトル
var title = document.title;

//　出兵距離格納変数
var length;

//　出兵先のタイル数格納変数（平地、木、岩、鉄、穀、荒地）の順。
var tile = new Array(0,0,0,0,0,0);

//　出兵先のパネル構成ごとの兵数計算パラメータ
//　[剣兵、弓、槍、騎、弩、矛、近衛]の順に格納。
//
// 鯖判定用（2011/02/09 Craford）
var sv_seazon = -1;

// 1期用、2期用、3期用テーブルとして作成（2011/02/09 Craford）
var point1ki = {

//1期木岩鉄糧空剣弓槍騎弩矛近
"000116":[5,0,0,0,0,0,0,"☆1※"],//☆1※
"100016":[5,0,0,0,0,0,0,"☆1木"],//☆1木
"010016":[5,0,0,0,0,0,0,"☆1岩"],//☆1岩
"001016":[5,0,0,0,0,0,0,"☆1鉄"],//☆1鉄
"300016":[0,4,0.5,0.5,0,0,0,"☆2(3-0-0-0)"],//☆2(3-0-0-0)
"030016":[0,0.5,4,0.5,0,0,0,"☆2(0-3-0-0)"],//☆2(0-3-0-0)
"003016":[0,0.5,0.5,4,0,0,0,"☆2(0-0-3-0)"],//☆2(0-0-3-0)
"111022":[0,6,6,6,0,0,0,"☆3(1-1-1-0)"],//☆3(1-1-1-0)
"000411":[0,7.5,7.5,7.5,0,0,0,"☆3(0-0-0-4)"],//☆3(0-0-0-4)
"222023":[0,12.5,12.5,12.5,0,0,0,"☆4(2-2-2-0)"],//☆4(2-2-2-0)
"000813":[0,12.5,12.5,12.5,0,0,0,"☆4(0-0-0-8)"],//☆4(0-0-0-8)
"222218":[0,11,11,11,0,0,0,"☆4(2-2-2-2)"],//☆4(2-2-2-2)
"600022":[0,40,10,10,0,0,0,"☆5(6-0-0-0)"],//☆5(6-0-0-0)
"060022":[0,10,40,10,0,0,0,"☆5(0-6-0-0)"],//☆5(0-6-0-0)
"006022":[0,10,10,40,0,0,0,"☆5(0-0-6-0)"],//☆5(0-0-6-0)
"1000014":[0,15,75,15,0,0,0,"☆6(10-0-0-0)"],//☆6(10-0-0-0)
"0100014":[0,75,15,15,0,0,0,"☆6(0-10-0-0)"],//☆6(0-10-0-0)
"0010014":[0,15,15,75,0,0,0,"☆6(0-0-10-0)"],//☆6(0-0-10-0)
"333025":[0,0,0,0,50,50,50,"☆7(3-3-3-0)"],//☆7(3-3-3-0)
"444433":[0,0,0,0,100,100,100,"☆8(4-4-4-4)"],//☆8(4-4-4-4)
"0001817":[0,0,0,0,150,150,150,"☆9(0-0-0-18)"]//☆9(0-0-0-18)
};

var point2ki = {

//2期木岩鉄糧空剣弓槍騎弩矛近
"000116":[5,0,0,0,0,0,0,"☆1※"],//☆1※
"100016":[5,0,0,0,0,0,0,"☆1木"],//☆1木
"010016":[5,0,0,0,0,0,0,"☆1岩"],//☆1岩
"001016":[5,0,0,0,0,0,0,"☆1鉄"],//☆1鉄
"300016":[0,6,0.5,0.5,0,0,0,"☆2(3-0-0-0)"],//☆2(3-0-0-0)
"030016":[0,0.5,6,0.5,0,0,0,"☆2(0-3-0-0)"],//☆2(0-3-0-0)
"003016":[0,0.5,0.5,6,0,0,0,"☆2(0-0-3-0)"],//☆2(0-0-3-0)
"111022":[0,7.5,7.5,7.5,0,0,0,"☆3(1-1-1-0)"],//☆3(1-1-1-0)
"000411":[0,3,17,3,0,0,0,"☆3(0-0-0-4)"],//☆3(0-0-0-4)
"000126":[0,17,3,3,0,0,0,"☆3(0-0-0-1)"],//☆3(0-0-0-1)
"222023":[0,14,14,14,0,0,0,"☆4(2-2-2-0)平地23"],//☆4(2-2-2-0)平地23
"222020":[0,5,5,35,0,0,0,"☆4(2-2-2-0)平地20"],//☆4(2-2-2-0)平地20
"000813":[0,15,15,15,0,0,0,"☆4(0-0-0-8)"],//☆4(0-0-0-8)
"600022":[0,65,12.5,12.5,0,0,0,"☆5(6-0-0-0)"],//☆5(6-0-0-0)
"060022":[0,12.5,65,12.5,0,0,0,"☆5(0-6-0-0)"],//☆5(0-6-0-0)
"006022":[0,12.5,12.5,65,0,0,0,"☆5(0-0-6-0)"],//☆5(0-0-6-0)
"000129":[0,30,30,30,0,0,0,"☆5(0-0-0-1)"],//☆5(0-0-0-1)
"222024":[0,0,0,0,27.5,27.5,27.5,"☆6(2-2-2-0)"],//☆6(2-2-2-0)
"1000020":[0,0,0,0,60,12.5,12.5,"☆6(10-0-0-0)"],//☆6(10-0-0-0)
"0100020":[0,0,0,0,12.5,60,12.5,"☆6(0-10-0-0)"],//☆6(0-10-0-0)
"0010020":[0,0,0,0,12.5,12.5,60,"☆6(0-0-10-0)"],//☆6(0-0-10-0)
"244025":[0,0,0,0,22.5,65,65,"☆7(2-4-4-0)"],//☆7(2-4-4-0)
"000133":[0,0,0,0,65,65,22.5,"☆7(0-0-0-1)"],//☆7(0-0-0-1)
"0001216":[0,0,0,0,65,22.5,65,"☆7(0-0-0-12)"],//☆7(0-0-0-12)
"412028":[0,0,0,0,250,50,25,"☆8(4-1-2-0)"],//☆8(4-1-2-0)
"241027":[0,0,0,0,50,250,25,"☆8(2-4-1-0)"],//☆8(2-4-1-0)
"124027":[0,0,0,0,50,25,250,"☆8(1-2-4-0)"],//☆8(1-2-4-0)
"444429":[0,0,0,0,200,200,200,"☆9(4-4-4-4)"],//☆9(4-4-4-4)
"111240":[0,0,0,0,190,190,190,"☆9(1-1-1-2)"],//☆9(1-1-1-2)
"0001815":[0,0,0,0,175,175,175,"☆9(0-0-0-18)"]//☆9(0-0-0-18)
};

var point3ki = {

//3期木岩鉄糧空き地剣弓槍騎弩矛近
"000116":[5,0,0,0,0,0,0,"☆1※"],//☆1※
"100016":[5,0,0,0,0,0,0,"☆1木"],//☆1木
"010016":[5,0,0,0,0,0,0,"☆1岩"],//☆1岩
"001016":[5,0,0,0,0,0,0,"☆1鉄"],//☆1鉄
"300016":[0,10,0.5,0.5,0,0,0,"☆2(3-0-0-0)"],//☆2(3-0-0-0)
"030016":[0,0.5,10,0.5,0,0,0,"☆2(0-3-0-0)"],//☆2(0-3-0-0)
"003016":[0,0.5,0.5,10,0,0,0,"☆2(0-0-3-0)"],//☆2(0-0-3-0)
"111022":[0,9,9,9,0,0,0,"☆3(1-1-1-0)"],//☆3(1-1-1-0)
"000411":[0,6,20,6,0,0,0,"☆3(0-0-0-4)"],//☆3(0-0-0-4)
"000126":[0,22,7,7,0,0,0,"☆3(0-0-0-1)"],//☆3(0-0-0-1)
"222023":[0,16,16,16,0,0,0,"☆4(2-2-2-0)平地23"],//☆4(2-2-2-0)平地23
"222020":[0,7.5,7.5,35,0,0,0,"☆4(2-2-2-0)平地20"],//☆4(2-2-2-0)平地20
"000813":[0,19,19,19,0,0,0,"☆4(0-0-0-8)"],//☆4(0-0-0-8)
"600022":[0,75,12.5,12.5,0,0,0,"☆5(6-0-0-0)"],//☆5(6-0-0-0)
"060022":[0,12.5,75,12.5,0,0,0,"☆5(0-6-0-0)"],//☆5(0-6-0-0)
"006022":[0,12.5,12.5,75,0,0,0,"☆5(0-0-6-0)"],//☆5(0-0-6-0)
"000129":[0,32.5,32.5,32.5,0,0,0,"☆5(0-0-0-1)"],//☆5(0-0-0-1)
"221025":[0,35,35,35,0,0,0,"☆5(2-2-1-0)"],//☆5(2-2-1-0)
"112025":[0,37.5,37.5,37.5,0,0,0,"☆5(1-1-2-0)"],//☆5(1-1-2-0)
"1000020":[0,0,0,0,90,20,20,"☆6(10-0-0-0)"],//☆6(10-0-0-0)
"0100020":[0,0,0,0,20,90,20,"☆6(0-10-0-0)"],//☆6(0-10-0-0)
"0010020":[0,0,0,0,20,20,90,"☆6(0-0-10-0)"],//☆6(0-0-10-0)
"222024":[0,0,0,0,40,40,40,"☆6(2-2-2-0)"],//☆6(2-2-2-0)
"244025":[0,0,0,0,30,110,30,"☆7(2-4-4-0)"],//☆7(2-4-4-0)
"000133":[0,0,0,0,110,110,30,"☆7(0-0-0-1)"],//☆7(0-0-0-1)
"0001216":[0,0,0,0,110,30,30,"☆7(0-0-0-12)"],//☆7(0-0-0-12)
"1400022":[0,0,0,0,75,250,75,"☆8(14-0-0-0)"],//☆8(14-0-0-0)
"0140022":[0,0,0,0,250,75,75,"☆8(0-14-0-0)"],//☆8(0-14-0-0)
"0014022":[0,0,0,0,75,75,250,"☆8(0-0-14-0)"],//☆8(0-0-14-0)
"412028":[0,0,0,0,250,50,25,"☆8(4-1-2-0)"],//☆8(4-1-2-0)
"241027":[0,0,0,0,50,250,25,"☆8(2-4-1-0)"],//☆8(2-4-1-0)
"124027":[0,0,0,0,50,25,250,"☆8(1-2-4-0)"],//☆8(1-2-4-0)
"10008":[0,0,0,0,300,150,150,"☆9(1-0-0-0)"],//☆9(1-0-0-0)
"01008":[0,0,0,0,150,300,150,"☆9(0-1-0-0)"],//☆9(0-1-0-0)
"00108":[0,0,0,0,150,150,300,"☆9(0-0-1-0)"],//☆9(0-0-1-0)
"444429":[0,0,0,0,300,300,300,"☆9(4-4-4-4)"],//☆9(4-4-4-4)
"111240":[0,0,0,0,250,250,250,"☆9(1-1-1-2)"],//☆9(1-1-1-2)
"0001815":[0,0,0,0,200,200,200,"☆9(0-0-0-18)"],//☆9(0-0-0-18)
};	

var point5ki = {

//木岩鉄糧空き地剣弓槍騎弩矛近
"000116":[5,0,0,0,0,0,0,"☆1※"],//☆1※
"100016":[5,0,0,0,0,0,0,"☆1木"],//☆1木
"010016":[5,0,0,0,0,0,0,"☆1岩"],//☆1岩
"001016":[5,0,0,0,0,0,0,"☆1鉄"],//☆1鉄
"300016":[0,12.5,1,1,0,0,0,"☆2(3-0-0-0)"],//☆2(3-0-0-0)
"030016":[0,1,12.5,1,0,0,0,"☆2(0-3-0-0)"],//☆2(0-3-0-0)
"003016":[0,1,1,12.5,0,0,0,"☆2(0-0-3-0)"],//☆2(0-0-3-0)
"111022":[0,15,15,15,0,0,0,"☆3(1-1-1-0)"],//☆3(1-1-1-0)
"000411":[0,12,25,12,0,0,0,"☆3(0-0-0-4)"],//☆3(0-0-0-4)
"000126":[0,25,13,13,0,0,0,"☆3(0-0-0-1)"],//☆3(0-0-0-1)
"222023":[0,33,33,33,0,0,0,"☆4(2-2-2-0)平地23"],//☆4(2-2-2-0)平地23
"222020":[0,30,30,45,0,0,0,"☆4(2-2-2-0)平地20"],//☆4(2-2-2-0)平地20
"000813":[0,36,36,36,0,0,0,"☆4(0-0-0-8)"],//☆4(0-0-0-8)
"600022":[0,111,33,33,0,0,0,"☆5(6-0-0-0)"],//☆5(6-0-0-0)
"060022":[0,33,111,33,0,0,0,"☆5(0-6-0-0)"],//☆5(0-6-0-0)
"006022":[0,33,33,111,0,0,0,"☆5(0-0-6-0)"],//☆5(0-0-6-0)
"000129":[0,55,55,55,0,0,0,"☆5(0-0-0-1)"],//☆5(0-0-0-1)
"221025":[0,60,60,60,0,0,0,"☆5(2-2-1-0)"],//☆5(2-2-1-0)
"112025":[0,70,70,70,0,0,0,"☆5(1-1-2-0)"],//☆5(1-1-2-0)
"1000020":[0,0,0,0,180,50,50,"☆6(10-0-0-0)"],//☆6(10-0-0-0)
"0100020":[0,0,0,0,50,180,50,"☆6(0-10-0-0)"],//☆6(0-10-0-0)
"0010020":[0,0,0,0,50,50,180,"☆6(0-0-10-0)"],//☆6(0-0-10-0)
"222024":[0,0,0,0,85,85,85,"☆6(2-2-2-0)"],//☆6(2-2-2-0)
"244025":[0,0,0,0,110,220,110,"☆7(2-4-4-0)"],//☆7(2-4-4-0)
"000133":[0,0,0,0,110,110,220,"☆7(0-0-0-1)"],//☆7(0-0-0-1)
"0001216":[0,0,0,0,220,110,110,"☆7(0-0-0-12)"],//☆7(0-0-0-12)
"1400022":[0,0,0,0,175,400,175,"☆8(14-0-0-0)"],//☆8(14-0-0-0)
"0140022":[0,0,0,0,400,175,175,"☆8(0-14-0-0)"],//☆8(0-14-0-0)
"0014022":[0,0,0,0,175,175,400,"☆8(0-0-14-0)"],//☆8(0-0-14-0)
"412028":[0,0,0,0,350,200,100,"☆8(4-1-2-0)"],//☆8(4-1-2-0)
"241027":[0,0,0,0,200,350,100,"☆8(2-4-1-0)"],//☆8(2-4-1-0)
"124027":[0,0,0,0,200,100,350,"☆8(1-2-4-0)"],//☆8(1-2-4-0)
"10008":[0,0,0,0,600,400,400,"☆9(1-0-0-0)"],//☆9(1-0-0-0)
"01008":[0,0,0,0,400,600,400,"☆9(0-1-0-0)"],//☆9(0-1-0-0)
"00108":[0,0,0,0,400,400,600,"☆9(0-0-1-0)"],//☆9(0-0-1-0)
"444429":[0,0,0,0,450,450,450,"☆9(4-4-4-4)"],//☆9(4-4-4-4)
"111240":[0,0,0,0,400,400,400,"☆9(1-1-1-2)"],//☆9(1-1-1-2)
"0001815":[0,0,0,0,350,350,350,"☆9(0-0-0-18)"],//☆9(0-0-0-18)
};

//faraway start 111006 7期対応
var point7ki = {

//木岩鉄糧空き地剣弓槍騎弩矛近
"000116":[5,0,0,0,0,0,0,"☆1※"],//☆1※
"100016":[5,0,0,0,0,0,0,"☆1木"],//☆1木
"010016":[5,0,0,0,0,0,0,"☆1岩"],//☆1岩
"001016":[5,0,0,0,0,0,0,"☆1鉄"],//☆1鉄
"300016":[0,2.5,15,2.5,0,0,0,"☆2(3-0-0-0)"],//☆2(3-0-0-0)
"030016":[0,15,2.5,2.5,0,0,0,"☆2(0-3-0-0)"],//☆2(0-3-0-0)
"003016":[0,2.5,2.5,15,0,0,0,"☆2(0-0-3-0)"],//☆2(0-0-3-0)
"111022":[0,12.5,12.5,12.5,0,0,0,"☆3(1-1-1-0)"],//☆3(1-1-1-0)
"000411":[0,22.5,7.5,7.5,0,0,0 ,"☆3(0-0-0-4)"],//☆3(0-0-0-4)
"000126":[0,7.5,22.5,7.5,0,0,0,"☆3(0-0-0-1)"],//☆3(0-0-0-1)
"222023":[0,0,0,0,10,10,10,"☆4(2-2-2-0)平地23"],//☆4(2-2-2-0)平地23
"222020":[0,0,0,0,5,5,20,"☆4(2-2-2-0)平地20"],//☆4(2-2-2-0)平地20
"000813":[0,0,0,0,15,15,15,"☆4(0-0-0-8)"],//☆4(0-0-0-8)
"600022":[0,0,0,0,20,50,20,"☆5(6-0-0-0)"],//☆5(6-0-0-0)
"060022":[0,0,0,0,50,20,20,"☆5(0-6-0-0)"],//☆5(0-6-0-0)
"006022":[0,0,0,0,20,20,50,"☆5(0-0-6-0)"],//☆5(0-0-6-0)
"000129":[0,0,0,0,30,30,30,"☆5(0-0-0-1)"],//☆5(0-0-0-1)
"221025":[0,0,0,0,20,20,20,"☆5(2-2-1-0)"],//☆5(2-2-1-0)
"112025":[0,0,0,0,25,25,25,"☆5(1-1-2-0)"],//☆5(1-1-2-0)
"1000020":[0,0,0,0,75,300,75,"☆6(10-0-0-0)"],//☆6(10-0-0-0)
"0100020":[0,0,0,0,300,50,50,"☆6(0-10-0-0)"],//☆6(0-10-0-0)
"0010020":[0,0,0,0,50,50,300,"☆6(0-0-10-0)"],//☆6(0-0-10-0)
"222024":[0,0,0,0,150,150,150,"☆6(2-2-2-0)"],//☆6(2-2-2-0)
"244025":[0,0,0,0,400,150,150,"☆7(2-4-4-0)"],//☆7(2-4-4-0)
"000133":[0,0,0,0,150,150,400,"☆7(0-0-0-1)"],//☆7(0-0-0-1)
"0001216":[0,0,0,0,150,400,150,"☆7(0-0-0-12)"],//☆7(0-0-0-12)
"1400022":[0,0,0,0,500,300,300,"☆8(14-0-0-0)"],//☆8(14-0-0-0)
"0140022":[0,0,0,0,300,500,300,"☆8(0-14-0-0)"],//☆8(0-14-0-0)
"0014022":[0,0,0,0,300,300,500,"☆8(0-0-14-0)"],//☆8(0-0-14-0)
"412028":[0,0,0,0,300,500,200,"☆8(4-1-2-0)"],//☆8(4-1-2-0)
"241027":[0,0,0,0,500,300,200,"☆8(2-4-1-0)"],//☆8(2-4-1-0)
"124027":[0,0,0,0,200,300,500,"☆8(1-2-4-0)"],//☆8(1-2-4-0)
"10008":[0,0,0,0,500,750,500,"☆9(1-0-0-0)"],//☆9(1-0-0-0)
"01008":[0,0,0,0,750,500,500,"☆9(0-1-0-0)"],//☆9(0-1-0-0)
"00108":[0,0,0,0,500,500,750,"☆9(0-0-1-0)"],//☆9(0-0-1-0)
"444429":[0,0,0,0,550,550,550,"☆9(4-4-4-4)"],//☆9(4-4-4-4)
"111240":[0,0,0,0,500,500,500,"☆9(1-1-1-2)"],//☆9(1-1-1-2)
"0001815":[0,0,0,0,450,450,450,"☆9(0-0-0-18)"],//☆9(0-0-0-18)
};
//faraway end 111006

// 実処理用の変数はこれに統合（2011/02/09 Craford）
var point;


//　兵科に対する各ユニットの防御値
var def = {
	//剣,弓,槍,騎,弩,矛,近衛
	"ken":[15,52,50,54,208,200,216],//剣兵防御
	"yari":[10,58,40,28,145,100,70],//槍兵防御
	"yumi":[10,42,25,60,105,63,150],//弓兵防御
	"ki":[10,26,55,44,65,137,110]//騎兵防御
};

//　各ユニットの攻撃力
var atk = {
	"ken":15,
	"yari":40,
	"yumi":42,
	"ki":44,
	"hoko":100,
	"do":105,
	"kono":110
};

//　鍛冶場Lv.
var kaji_lv = {
	"0":0,
	"1":0,
	"2":0.015,
	"3":0.03,
	"4":0.045,
	"5":0.06,
	"6":0.075,
	"7":0.09,
	"8":0.105,
	"9":0.12,
	"10":0.15
};

//　武器強化
var buki_lv = {
	"ken":[0,0.1,0.2,0.3,0.4,0.5,0.6,0.75,0.9,1.1,1.35],
	"yari":[0,0.05,0.1,0.16,0.22,0.3,0.38,0.48,0.58,0.68,0.8],
	"yumi":[0,0.05,0.1,0.16,0.22,0.3,0.38,0.48,0.58,0.68,0.8],
	"ki":[0,0.05,0.1,0.16,0.22,0.3,0.38,0.48,0.58,0.68,0.8],
	"hoko":[0,0.04,0.08,0.12,0.16,0.2,0.24,0.28,0.33,0.38,0.45],
	"do":[0,0.04,0.08,0.12,0.16,0.2,0.24,0.28,0.33,0.38,0.45],
	"kono":[0,0.04,0.08,0.12,0.16,0.2,0.24,0.28,0.33,0.38,0.45]
};


(function(){
		// 鯖バージョンの判別（2011/02/09 Craford）
		var svname = location.hostname.substr(0,location.hostname.indexOf("."));
		var season = 0;

		var sv_world = [];
		var sv_season = [];
		for(i=0;i<serverTable.length;i++){
			var BRO3_TOBATSU_SV	= 'bro3_tobatsu_sv' + i;
			var BRO3_TOBATSU_SEASON	= 'bro3_tobatsu_season' + i;
			if(GM_getValue(BRO3_TOBATSU_SV)){
				sv_world[i] = GM_getValue(BRO3_TOBATSU_SV);
				sv_season[i] = GM_getValue(BRO3_TOBATSU_SEASON);
			}else{
				sv_world[i] = serverTable[i][0];
				sv_season[i] = serverTable[i][1];
				GM_setValue(BRO3_TOBATSU_SV, sv_world[i]);
				GM_setValue(BRO3_TOBATSU_SEASON, sv_season[i]);
			}
			if( sv_world[i] == svname ){
				season = sv_season[i];
			}
		}

		//alert("season："+season+"期対応");//faraway111006
		if( season == 1 ){
			// パネルテーブルは1期用を使う
			point = point1ki;
		}
		else if( season == 2 ){
			// パネルテーブルは2期用を使う
			point = point2ki;
		}
		else if( (season == 3 ) || (season == 4) ){
			// パネルテーブルは3期用を使う
			point = point3ki;
		}
		else if( (season == 5 ) || (season == 6) ){
			// パネルテーブルは5期用を使う
			point = point5ki;
		}
//faraway start 111006 7&8期対応
		else if( (season == 7 ) || (season == 8) ){
			// パネルテーブルは7期用を使う
			point = point7ki;
		}
//faraway end 111006

		// 鯖情報を追記（2011/02/09 Craford）
		//var world = document.evaluate('//*[@id="worldtime"]/dl/dt', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		//if(world.snapshotLength == 0){
		//	//本家・ハンゲ鯖対応用。なにこの微妙な仕様変更・・・
		//	world = document.evaluate('//*[@class="world"]/dt', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		//}
		//var world_text = world.snapshotItem(0).textContent + " 第" + season + "期目";
		var world_text = svname + "ワールド 第" + season + "期目";
		com_rack = com_rack + "<br><b><font color='blue'>" + world_text + "</font></b>";

		//　出兵拠点座標の取得
		var areas = document.evaluate('//li[@class="gnavi02"]//a/@href', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		basecord = areas.snapshotItem(0).textContent;
		basecord = basecord.replace(/^.*x=(-?[0-9]+).*y=(-?[0-9]+)/, "$1,$2");
		bcordx = RegExp.$1;
		bcordy = RegExp.$2;

		//　出兵先座標(x)の取得
		areas = document.evaluate('//input[@name="village_x_value"]/@value',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		tocordx = areas.snapshotItem(0).textContent;

		//　出兵先座標(y)の取得
		areas = document.evaluate('//input[@name="village_y_value"]/@value',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		tocordy = areas.snapshotItem(0).textContent;

		//　距離の計算
		length = Math.sqrt(Math.pow(bcordx-tocordx,2)+Math.pow(bcordy-tocordy,2));
		
		if(season>0){

			//　出兵先タイルパターン取得のためのHTTP要求　starに★数、tile[]に各タイル数を格納。
			var url = "http://"+location.hostname+"/land.php?x="+tocordx+"&y="+tocordy;
			GM_xmlhttpRequest({
				method:"GET", 
				url:url,
				onload:function(x){
				//　読み込み後の処理は関数 getFieldType() 内で行う。
				getFieldType(x.responseText);
				}
			});

		}else{
			var msg = "";
	
			//　サーバー情報が見つからない場合。(登録されていないもの)
			msg = msg + "<br><table border=8><tr><td align=left>\n";
			msg = msg + com_rack + "<br>\n";
			msg = msg + "サーバー情報が登録されていません。<a id='svsetting_btn' href='javascript:void(0)'>サーバー情報を設定してください。</a></td>\n";
			msg = msg + "<td align=left rowspan=2>\n";

			msg = msg + "<table id=svsetting align=center style='text-align:center;background:#FFC;color:#C60;display:none;' width=116>\n";
			msg = msg + "<tr><td align=center><b>Server</b></td><td align=center><b>Season</b></td></tr>\n";
			for(var i = 0; i < serverTable.length; i++){
			msg = msg + "<tr><td align=center><input type=text size=2 id=s"+i+"></td><td>第<select id=s"+i+"s><option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8</select>期</td></tr>\n";
			}
			msg = msg + "<tr><td colspan=2>期数はmixi鯖基準</td></tr>\n";
			msg = msg + "<tr><td colspan=2>本家5期→mixi4期<br>本家6期→mixi5期<br>に相当</td></tr>\n";
			msg = msg + "<tr><td colspan=2><input id=svsave_btn type=button value='保存' size=6>&nbsp;<input id=svreset_btn type=button value='初期化' size=8></td></tr>\n";
			msg = msg + "</table>\n";

			msg = msg + "</td></tr>\n";
			msg = msg + "<tr><td align=left>\n";
			msg = msg + se_rack + ver_rack + "<br>\n";
			msg = msg + "<b>　＋　賊討伐シミュレータ by kino. ver"+kino_ver+"</b><br>\n";
			msg = msg + "苦情・文句・情報提供などは 17鯖 <a href="+ url_rack2+" target='_blank'>きの。</a> まで御願いします。<br>\n";
			msg = msg + "元スクリプト作者は→<a href="+ url_rack+" target='_blank'>こちら（配布元）</a><br>\n";
			msg = msg + "</td></tr></table>\n";

			var insertHtml = "<div align=center>" + msg + "</div>";
	
			var insertElem = document.createElement('div');
			insertElem.innerHTML = insertHtml;
			insertElem = insertElem.firstChild;
			var containerElem = document.evaluate('//*[@class=\"controlArea\"]', document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
			containerElem.snapshotItem(0).appendChild(insertElem);

			var svsetting_btn = document.getElementById("svsetting_btn");
		        svsetting_btn.addEventListener("click", function(){view("svsetting");set_season();}, false);
			var svsave_btn = document.getElementById("svsave_btn");
        		svsave_btn.addEventListener("click", function(){sv_save();}, false);
			var svreset_btn = document.getElementById("svreset_btn");
		        svreset_btn.addEventListener("click", function(){reset_season();}, false);

		}

})();

//　タイルパターンの取得 及び 兵力計算・表示用関数
function getFieldType(x){

	//　ページ内のタイル数をカウントするための変数 初期化
	var panel = {
		"平地":0,
		"森林":0,
		"岩山":0,
		"鉄鉱山":0,
		"穀物":0,
		"荒地":0
	};
	
	//　GM_xmlhttpRequestの取得データをxml形式に変換
    var responseXML = document.createElement('div');
    responseXML.innerHTML = x;
	
	//　ソース中のタイルの行からtitleの文字列を取得
	var panels = document.evaluate('.//*[@id="mapOverlayMap"]//area/@title',
	responseXML, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	
	//　1行ずつ対応するタイルの変数を加算していく
	for (var i = 0; i < panels.snapshotLength; i++) {
		panel[panels.snapshotItem(i).textContent]++;
	}

	//　タイル数→キー（"111116"など）の作成
	var key = String(panel["森林"])+String(panel["岩山"])+String(panel["鉄鉱山"])+String(panel["穀物"])+String(panel["平地"]);
	//　兵力パラメータの取得
	var list = point[key];

	var i;
	var tmp = 0;
	var sum = 0;
	var kenk = 0;
	var yarik = 0;
	var yumik = 0;
	var kik = 0;

	var tmp2 = 0;
	var sum2 = 0;
	var kenk2 = 0;
	var yarik2 = 0;
	var yumik2 = 0;
	var kik2 = 0;

	var infantry_count = 0;
	var spear_count = 0;
	var archer_count = 0;
	var cavalry_count = 0;
	var halbert_count = 0;
	var crossbow_count = 0;
	var cavalry_guards_count = 0;

	var soltype = "";


	//表示部分Non
	var msg = "";
	
	if(list==undefined){
		//　キーに対応するデータが見つからない場合。(データがないもの)
		msg = msg + "<br><table border=8><tr><td align=left>\n";
		msg = msg + com_rack + "　<a id='svsetting_btn' href='javascript:void(0)'>設定</a><br>\n";
		msg = msg + "有効なデータはありません。<br>※本拠地やNPC砦、未知の領地で有る可能性が有ります。</td>\n";
		msg = msg + "<td align=left rowspan=2>\n";

		msg = msg + "<table id=svsetting align=center style='text-align:center;background:#FFC;color:#C60;display:none;' width=116>\n";
		msg = msg + "<tr><td align=center><b>Server</b></td><td align=center><b>Season</b></td></tr>\n";
		for(var i = 0; i < serverTable.length; i++){
		msg = msg + "<tr><td align=center><input type=text size=2 id=s"+i+"></td><td>第<select id=s"+i+"s><option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8</select>期</td></tr>\n";
		}
		msg = msg + "<tr><td colspan=2>期数はmixi鯖基準</td></tr>\n";
		msg = msg + "<tr><td colspan=2>本家5期→mixi4期<br>本家6期→mixi5期<br>に相当</td></tr>\n";
		msg = msg + "<tr><td colspan=2><input id=svsave_btn type=button value='保存' size=6>&nbsp;<input id=svreset_btn type=button value='初期化' size=8></td></tr>\n";
		msg = msg + "</table>\n";

		msg = msg + "</td></tr>\n";
		msg = msg + "<tr><td align=left>\n";
		msg = msg + se_rack + ver_rack + "<br>\n";
		msg = msg + "<b>　＋　賊討伐シミュレータ by kino. ver"+kino_ver+"</b><br>\n";
		msg = msg + "苦情・文句・情報提供などは 17鯖 <a href="+ url_rack2+" target='_blank'>きの。</a> まで御願いします。<br>\n";
		msg = msg + "元スクリプト作者は→<a href="+ url_rack+" target='_blank'>こちら（配布元）</a><br>\n";
		msg = msg + "</td></tr></table>\n";


		var insertHtml = "<div align=center>" + msg + "</div>";
	
		var insertElem = document.createElement('div');
		insertElem.innerHTML = insertHtml;
		insertElem = insertElem.firstChild;
		var containerElem = document.evaluate('//*[@class=\"controlArea\"]', document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
		containerElem.snapshotItem(0).appendChild(insertElem);
	}else{
		//MAX計算用
		for(i=0;i<list.length;i++){
	//距離最大時乗数
	var hentai = (1+length/10)*3;
	//最大出現数計算
	var kenmax = Math.floor(list[0]*hentai);
	var yumimax = Math.floor(list[1]*hentai);
	var yarimax = Math.floor(list[2]*hentai);
	var kimax = Math.floor(list[3]*hentai);
	var domax = Math.floor(list[4]*hentai);
	var hokomax = Math.floor(list[5]*hentai);
	var konomax = Math.floor(list[6]*hentai);
	//最大防御力集計
	var sum = kenmax+yumimax+yarimax+kimax+domax+hokomax+konomax;
	var kenk = kenmax*def["ken"][0]+yumimax*def["ken"][1]+yarimax*def["ken"][2]+kimax*def["ken"][3]+domax*def["ken"][4]+hokomax*def["ken"][5]+konomax*def["ken"][6];
	var yumik = kenmax*def["yumi"][0]+yumimax*def["yumi"][1]+yarimax*def["yumi"][2]+kimax*def["yumi"][3]+domax*def["yumi"][4]+hokomax*def["yumi"][5]+konomax*def["yumi"][6];
	var yarik = kenmax*def["yari"][0]+yumimax*def["yari"][1]+yarimax*def["yari"][2]+kimax*def["yari"][3]+domax*def["yari"][4]+hokomax*def["yari"][5]+konomax*def["yari"][6];
	var kik = kenmax*def["ki"][0]+yumimax*def["ki"][1]+yarimax*def["ki"][2]+kimax*def["ki"][3]+domax*def["ki"][4]+hokomax*def["ki"][5]+konomax*def["ki"][6];

	//距離最小時乗数
	var hentai2 = (1+length/10);
	//最小出現数計算
	var kenmin = Math.floor(list[0]*hentai2);
	var yumimin = Math.floor(list[1]*hentai2);
	var yarimin = Math.floor(list[2]*hentai2);
	var kimin = Math.floor(list[3]*hentai2);
	var domin = Math.floor(list[4]*hentai2);
	var hokomin = Math.floor(list[5]*hentai2);
	var konomin = Math.floor(list[6]*hentai2);

	//最小防御力集計
	var kenk2 = kenmin*def["ken"][0]+yumimin*def["ken"][1]+yarimin*def["ken"][2]+kimin*def["ken"][3]+domin*def["ken"][4]+hokomin*def["ken"][5]+konomin*def["ken"][6];
	var yumik2 = kenmin*def["yumi"][0]+yumimin*def["yumi"][1]+yarimin*def["yumi"][2]+kimin*def["yumi"][3]+domin*def["yumi"][4]+hokomin*def["yumi"][5]+konomin*def["yumi"][6];
	var yarik2 = kenmin*def["yari"][0]+yumimin*def["yari"][1]+yarimin*def["yari"][2]+kimin*def["yari"][3]+domin*def["yari"][4]+hokomin*def["yari"][5]+konomin*def["yari"][6];
	var kik2 = kenmin*def["ki"][0]+yumimin*def["ki"][1]+yarimin*def["ki"][2]+kimin*def["ki"][3]+domin*def["ki"][4]+hokomin*def["ki"][5]+konomin*def["ki"][6];

	//表示部分フォント追加分
	var red_f = "</b></font>\n";
	var red_s = "<font color=red><b>";
	var gre_s = "<font color=blue>";

	if (title.indexOf("出兵(入力)") != -1) {
		pos = document.evaluate("//*[@name='input_troop']/table/tbody/tr[2]/td/table/tbody/tr[1]/td[2]/span", document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
		infantry_count = pos.innerHTML.match(/[0-9]+/);

		pos = document.evaluate("//*[@name='input_troop']/table/tbody/tr[2]/td/table/tbody/tr[1]/td[4]/span", document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
		spear_count = pos.innerHTML.match(/[0-9]+/);

		pos = document.evaluate("//*[@name='input_troop']/table/tbody/tr[2]/td/table/tbody/tr[1]/td[6]/span", document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
		archer_count = pos.innerHTML.match(/[0-9]+/);

		pos = document.evaluate("//*[@name='input_troop']/table/tbody/tr[2]/td/table/tbody/tr[1]/td[8]/span", document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
		cavalry_count = pos.innerHTML.match(/[0-9]+/);

		pos = document.evaluate("//*[@name='input_troop']/table/tbody/tr[2]/td/table/tbody/tr[2]/td[2]/span", document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
		halbert_count = pos.innerHTML.match(/[0-9]+/);

		pos = document.evaluate("//*[@name='input_troop']/table/tbody/tr[2]/td/table/tbody/tr[2]/td[4]/span", document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
		crossbow_count = pos.innerHTML.match(/[0-9]+/);

		pos = document.evaluate("//*[@name='input_troop']/table/tbody/tr[2]/td/table/tbody/tr[2]/td[6]/span", document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
		cavalry_guards_count = pos.innerHTML.match(/[0-9]+/);

	} else if (title.indexOf("出兵(確認)") != -1) {

		//　剣兵
		areas = document.evaluate('//input[@name="infantry_count"]/@value', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		infantry_count = areas.snapshotItem(0).textContent;

		//　槍兵
		areas = document.evaluate('//input[@name="spear_count"]/@value', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		spear_count = areas.snapshotItem(0).textContent;

		//　弓兵
		areas = document.evaluate('//input[@name="archer_count"]/@value', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		archer_count = areas.snapshotItem(0).textContent;

		//　騎兵
		areas = document.evaluate('//input[@name="cavalry_count"]/@value', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		cavalry_count = areas.snapshotItem(0).textContent;

		//　矛槍兵
		areas = document.evaluate('//input[@name="halbert_count"]/@value', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		halbert_count = areas.snapshotItem(0).textContent;

		//　弩兵
		areas = document.evaluate('//input[@name="crossbow_count"]/@value', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		crossbow_count = areas.snapshotItem(0).textContent;

		//　近衛騎兵
		areas = document.evaluate('//input[@name="cavalry_guards_count"]/@value', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		cavalry_guards_count = areas.snapshotItem(0).textContent;


		//　総攻撃力
		var power = 0;
		areas = document.evaluate('//strong[@class="size1"]', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		power = areas.snapshotItem(0).textContent;
		power = power.replace(/,/,'');
		power = power.replace(/,/,'');

		//　武将兵科
		areas = document.evaluate('//span[@class="soltype"]//img/@title', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		if(areas.snapshotItem(0)) soltype = areas.snapshotItem(0).textContent;
		}

	function rec(){

		var b_power = document.getElementById("b_power").value;
		var b_skill = document.getElementById("b_skill").value;
		var b_type = document.getElementById("b_type");
		var b_type2 = b_type.options[b_type.selectedIndex].value;
		var kaji = document.getElementById("kaji");
		kaji = kaji.options[kaji.selectedIndex].value;
		kaji = kaji_lv[kaji];
		var cp = document.getElementById("cp");
		cp = cp.options[cp.selectedIndex].value;

		var infantry_count2 = document.getElementById("infantry_count2").value;
		var ken_skill = document.getElementById("ken_skill").value;
		var ken_kaji = document.getElementById("ken_kaji");
		ken_kaji = ken_kaji.options[ken_kaji.selectedIndex].value;

		var spear_count2 = document.getElementById("spear_count2").value;
		var yari_skill = document.getElementById("yari_skill").value;
		var yari_kaji = document.getElementById("yari_kaji");
		yari_kaji = yari_kaji.options[yari_kaji.selectedIndex].value;

		var archer_count2 = document.getElementById("archer_count2").value;
		var yumi_skill = document.getElementById("yumi_skill").value;
		var yumi_kaji = document.getElementById("yumi_kaji");
		yumi_kaji = yumi_kaji.options[yumi_kaji.selectedIndex].value;

		var cavalry_count2 = document.getElementById("cavalry_count2").value;
		var ki_skill = document.getElementById("ki_skill").value;
		var ki_kaji = document.getElementById("ki_kaji");
		ki_kaji = ki_kaji.options[ki_kaji.selectedIndex].value;

		var halbert_count2 = document.getElementById("halbert_count2").value;
		var hoko_skill = document.getElementById("hoko_skill").value;
		var hoko_kaji = document.getElementById("hoko_kaji");
		hoko_kaji = hoko_kaji.options[hoko_kaji.selectedIndex].value;

		var crossbow_count2 = document.getElementById("crossbow_count2").value;
		var do_skill = document.getElementById("do_skill").value;
		var do_kaji = document.getElementById("do_kaji");
		do_kaji = do_kaji.options[do_kaji.selectedIndex].value;

		var cavalry_guards_count2 = document.getElementById("cavalry_guards_count2").value;
		var konoe_skill = document.getElementById("konoe_skill").value;
		var konoe_kaji = document.getElementById("konoe_kaji");
		konoe_kaji = konoe_kaji.options[konoe_kaji.selectedIndex].value;

		//攻撃側総兵数
		attack_count = 1;
		attack_count += Math.floor(infantry_count2) + Math.floor(spear_count2) + Math.floor(archer_count2) + Math.floor(cavalry_count2) + Math.floor(halbert_count2) + Math.floor(crossbow_count2) + Math.floor(cavalry_guards_count2);

		//歩兵科
		aken = Math.floor(infantry_count2);
		if(b_type2=="0") aken+=1;
		aken /= attack_count;

		//槍兵科
		ayari = Math.floor(spear_count2) + Math.floor(halbert_count2);
		if(b_type2=="1") ayari += 1;
		ayari = ayari / attack_count;

		//弓兵科
		ayumi = Math.floor(archer_count2) + Math.floor(crossbow_count2);
		if(b_type2=="2") ayumi+=1;
		ayumi /= attack_count;

		//騎兵科
		aki = Math.floor(cavalry_count2) + Math.floor(cavalry_guards_count2);
		if(b_type2=="3") aki+=1;
		aki /= attack_count;

		//各兵科攻撃力
		b_power = b_power*(1 + b_skill / 100);
		var infantry_power = infantry_count2 * atk["ken"] * ( 1 + ken_skill / 100 + kaji + buki_lv["ken"][ken_kaji]);
		var spear_power = spear_count2 * atk["yari"] * ( 1 + yari_skill / 100 + kaji + buki_lv["yari"][yari_kaji]);
		var archer_power = archer_count2 * atk["yumi"] * ( 1 + yumi_skill / 100 + kaji + buki_lv["yumi"][yumi_kaji]);
		var cavalry_power = cavalry_count2 * atk["ki"] * ( 1 + ki_skill / 100 + kaji + buki_lv["ki"][ki_kaji]);
		var halbert_power = halbert_count2 * atk["hoko"] * ( 1 + hoko_skill / 100 + kaji + buki_lv["hoko"][hoko_kaji]);
		var crossbow_power = crossbow_count2 * atk["do"] * ( 1 + do_skill / 100 + kaji + buki_lv["do"][do_kaji]);
		var cavalry_guards_power = cavalry_guards_count2 * atk["kono"] * ( 1 + konoe_skill / 100 + kaji + buki_lv["kono"][konoe_kaji]);

		//総攻撃力
		if (title.indexOf("出兵(入力)") != -1) {
		power =   Math.floor(( Math.floor(b_power) + Math.floor(infantry_power) + Math.floor(spear_power) + Math.floor(archer_power) + Math.floor(cavalry_power) + Math.floor(halbert_power) + Math.floor(crossbow_power) + Math.floor(cavalry_guards_power) ) * ( 1 + 0.1*cp));
		}

		//相対防御
		var dkenmax = kenmax*(aken*def["ken"][0]+ayari*def["yari"][0]+ayumi*def["yumi"][0]+aki*def["ki"][0]);
		var dyumimax = yumimax*(aken*def["ken"][1]+ayari*def["yari"][1]+ayumi*def["yumi"][1]+aki*def["ki"][1]);
		var dyarimax = yarimax*(aken*def["ken"][2]+ayari*def["yari"][2]+ayumi*def["yumi"][2]+aki*def["ki"][2]);
		var dkimax = kimax*(aken*def["ken"][3]+ayari*def["yari"][3]+ayumi*def["yumi"][3]+aki*def["ki"][3]);
		var ddomax = domax*(aken*def["ken"][4]+ayari*def["yari"][4]+ayumi*def["yumi"][4]+aki*def["ki"][4]);
		var dhokomax = hokomax*(aken*def["ken"][5]+ayari*def["yari"][5]+ayumi*def["yumi"][5]+aki*def["ki"][5]);
		var dkonomax = konomax*(aken*def["ken"][6]+ayari*def["yari"][6]+ayumi*def["yumi"][6]+aki*def["ki"][6]);

		var dkenmin = kenmin*(aken*def["ken"][0]+ayari*def["yari"][0]+ayumi*def["yumi"][0]+aki*def["ki"][0]);
		var dyumimin = yumimin*(aken*def["ken"][1]+ayari*def["yari"][1]+ayumi*def["yumi"][1]+aki*def["ki"][1]);
		var dyarimin = yarimin*(aken*def["ken"][2]+ayari*def["yari"][2]+ayumi*def["yumi"][2]+aki*def["ki"][2]);
		var dkimin = kimin*(aken*def["ken"][3]+ayari*def["yari"][3]+ayumi*def["yumi"][3]+aki*def["ki"][3]);
		var ddomin = domin*(aken*def["ken"][4]+ayari*def["yari"][4]+ayumi*def["yumi"][4]+aki*def["ki"][4]);
		var dhokomin = hokomin*(aken*def["ken"][5]+ayari*def["yari"][5]+ayumi*def["yumi"][5]+aki*def["ki"][5]);
		var dkonomin = konomin*(aken*def["ken"][6]+ayari*def["yari"][6]+ayumi*def["yumi"][6]+aki*def["ki"][6]);

		//総防御力
		var dmax = dkenmax + dyumimax + dyarimax + dkimax + ddomax + dhokomax + dkonomax ;
		var dmin = dkenmin + dyumimin + dyarimin + dkimin + ddomin + dhokomin + dkonomin ;

		//討伐成功率（簡易）
		//　ver1.02までの計算法。攻撃力と防御力の最大・最小値のみで計算。
		//　実際には防御力の分布が一様でない（中央値付近ほど確率が高い）ので誤差が大きい
		//　ver1.03からは不使用
		//var success_rate = ( power - dmin ) / ( dmax - dmin ) * 100;
		//if(success_rate>=100) success_rate=100;
		//else if(success_rate<=0) success_rate=0;
		
		//討伐成功率（詳細）
		//　全乱数パターンについて防御力を計算（11通り×3種で1331パターン）
		//　ver.1.03からはこちらを使用
		var cnt = 0;
		var vcnt = 0;

		if(list[0] == 0){
			//☆1以外
			for( var j=0; j < 11; j++){
			for( var k=0; k < 11; k++){
			for( var l=0; l < 11; l++){
	
			cnt += 1;
			var hentai_j = hentai2*(10+j*2)/10;
			var hentai_k = hentai2*(10+k*2)/10;
			var hentai_l = hentai2*(10+l*2)/10;

			var ken_x = Math.floor(list[0]*hentai_j);
			var yumi_x = Math.floor(list[1]*hentai_j);
			var yari_x = Math.floor(list[2]*hentai_k);
			var ki_x = Math.floor(list[3]*hentai_l);
			var do_x = Math.floor(list[4]*hentai_j);
			var hoko_x = Math.floor(list[5]*hentai_k);
			var kono_x = Math.floor(list[6]*hentai_l);
	
			var dken = ken_x*(aken*def["ken"][0]+ayari*def["yari"][0]+ayumi*def["yumi"][0]+aki*def["ki"][0]);
			var dyumi = yumi_x*(aken*def["ken"][1]+ayari*def["yari"][1]+ayumi*def["yumi"][1]+aki*def["ki"][1]);
			var dyari = yari_x*(aken*def["ken"][2]+ayari*def["yari"][2]+ayumi*def["yumi"][2]+aki*def["ki"][2]);
			var dki = ki_x*(aken*def["ken"][3]+ayari*def["yari"][3]+ayumi*def["yumi"][3]+aki*def["ki"][3]);
			var ddo = do_x*(aken*def["ken"][4]+ayari*def["yari"][4]+ayumi*def["yumi"][4]+aki*def["ki"][4]);
			var dhoko = hoko_x*(aken*def["ken"][5]+ayari*def["yari"][5]+ayumi*def["yumi"][5]+aki*def["ki"][5]);
			var dkono = kono_x*(aken*def["ken"][6]+ayari*def["yari"][6]+ayumi*def["yumi"][6]+aki*def["ki"][6]);

			var d = dken + dyumi + dyari + dki + ddo + dhoko + dkono ;
			if( power > d ) vcnt += 1;

			};
			};
			};
		}else{
			//☆1
			for( var j=0; j < 11; j++){
			cnt += 1;
			var hentai_j = hentai2*(10+j*2)/10;
			var ken_x = Math.floor(list[0]*hentai_j);
			var dken = ken_x*(aken*def["ken"][0]+ayari*def["yari"][0]+ayumi*def["yumi"][0]+aki*def["ki"][0]);
			var d = dken;
			if( power > d ) vcnt += 1;

			};
		}

		var success_rate = vcnt / cnt * 100;
		vcnt2 = document.getElementById("vcnt2");
	        vcnt2.value = vcnt ;
		cnt2 = document.getElementById("cnt2");
	        cnt2.value = cnt ;

		//成功率計算ここまで

		power2 = document.getElementById("power2");
	        power2.value = power;
		dmax2 = document.getElementById("dmax2");
	        dmax2.value = dmax.toFixed(0);
		dmin2 = document.getElementById("dmin2");
	        dmin2.value = dmin.toFixed(0);
		var result = document.getElementById("result");
	        result.value = success_rate.toFixed(1);

	}

		}

		//表示部分
		msg = msg + "<br><table border=8><tr><td align=left colspan=2>\n";
		msg = msg + com_rack + "　<a id='svsetting_btn' href='javascript:void(0)'>設定</a><br>\n";
		msg = msg + "</td>\n";
		msg = msg + "<td align=left rowspan=3>\n";

		msg = msg + "<table id=svsetting align=center style='text-align:center;background:#FFC;color:#C60;display:none;' width=116>\n";
		msg = msg + "<tr><td align=center><b>Server</b></td><td align=center><b>Season</b></td></tr>\n";
		for(var i = 0; i < serverTable.length; i++){
		msg = msg + "<tr><td align=center><input type=text size=2 id=s"+i+"></td><td>第<select id=s"+i+"s><option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8</select>期</td></tr>\n";
		}
		msg = msg + "<tr><td colspan=2>期数はmixi鯖基準</td></tr>\n";
		msg = msg + "<tr><td colspan=2>本家5期→mixi4期<br>本家6期→mixi5期<br>に相当</td></tr>\n";
		msg = msg + "<tr><td colspan=2><input id=svsave_btn type=button value='保存' size=6>&nbsp;<input id=svreset_btn type=button value='初期化' size=8></td></tr>\n";
		msg = msg + "</table>\n";

		msg = msg + "</td></tr><tr><td align=left>\n";
		msg = msg + "<font color=white>最大出現兵数総計：" + String(Math.floor(sum))+ "</font><br>\n";
		msg = msg + "出兵元：<a href='/map.php?x=" + bcordx +"&y=" + bcordy + "'>(" + bcordx +"," + bcordy + ")</a><br>\n";
		msg = msg + "◆　距離：" + String(Math.floor(length*100+0.5)/100) + "　◆<br>\n";
		msg = msg + "目的地：<a href='/map.php?x=" + tocordx +"&y=" + tocordy + "'>(" + tocordx +"," + tocordy + ")</a>　　地形：" + String(list[7]) + "<br>\n";
		msg = msg + "<font color=red>\n";
		msg = msg + "兵種：最大兵数～最小兵数<br>\n";
		msg = msg + "</font>\n";
		msg = msg + "剣兵：\n"+ red_s + String(kenmax) + red_f;
		msg = msg + "～" + gre_s   + String(kenmin) + red_f + "<br>\n";
		msg = msg + "槍兵：\n"+ red_s + String(yarimax) + red_f;
		msg = msg + "～" + gre_s   + String(yarimin) + red_f + "<br>\n";
		msg = msg + "弓兵：\n"+ red_s + String(yumimax) + red_f;
		msg = msg + "～" + gre_s   + String(yumimin) + red_f + "<br>\n";
		msg = msg + "騎兵：\n"+ red_s + String(kimax) + red_f;
		msg = msg + "～" + gre_s   + String(kimin) + red_f + "<br>\n";
		msg = msg + "矛兵：\n"+ red_s + String(hokomax) + red_f;
		msg = msg + "～" + gre_s   + String(hokomin) + red_f + "<br>\n";
		msg = msg + "弩兵：\n"+ red_s + String(domax) + red_f;
		msg = msg + "～" + gre_s   + String(domin) + red_f + "<br>\n";
		msg = msg + "近衛：\n" + red_s  + String(konomax) + red_f;
		msg = msg + "～" + gre_s   + String(konomin) + red_f + "<br>\n";
		msg = msg + "<span id='simple'><font color=red>\n";
		msg = msg + "対兵科：防御力MAX～MIN<br>\n"
		msg = msg + "</font>\n";
		msg = msg + "剣兵科："+ red_s + String(kenk) + red_f + "～"+ gre_s + String(kenk2) + red_f+ "<br>\n";
		msg = msg + "槍兵科："+ red_s + String(yarik) + red_f + "～"+ gre_s + String(yarik2) + red_f+"<br>\n";
		msg = msg + "弓兵科："+ red_s + String(yumik) + red_f + "～"+ gre_s + String(yumik2) + red_f+"<br>\n";
		msg = msg + "騎兵科："+ red_s + String(kik) + red_f + "～"+ gre_s + String(kik2) + red_f+"<br>\n";
		msg = msg + "<font color=red>\n";
		msg = msg + "無強化兵士に単純換算<br>\n";
		msg = msg + "</font>\n";
		msg = msg + "剣兵：\n"+ red_s + Math.ceil(kenk/atk["ken"]) + red_f;
		msg = msg + "～" + gre_s   + Math.ceil(kenk2/atk["ken"]) + red_f + "<br>\n";
		msg = msg + "槍：\n"+ red_s + Math.ceil(yarik/atk["yari"]) + red_f + "～" + gre_s + Math.ceil(yarik2/atk["yari"]) + red_f + "(矛兵：\n"+ red_s + Math.ceil(yarik/atk["hoko"]) + red_f + "～" + gre_s   + Math.ceil(yarik2/atk["hoko"]) + red_f + "）<br>\n";
		msg = msg + "弓：\n"+ red_s + Math.ceil(yumik/atk["yumi"]) + red_f + "～" + gre_s + Math.ceil(yumik2/atk["yumi"]) + red_f + "(弩兵：\n"+ red_s + Math.ceil(yumik/atk["do"]) + red_f + "～" + gre_s   + Math.ceil(yumik2/atk["do"]) + red_f + "）<br>\n";
		msg = msg + "騎：\n"+ red_s + Math.ceil(kik/atk["ki"]) + red_f + "～" + gre_s + Math.ceil(kik2/atk["ki"]) + red_f + "(近衛：\n"+ red_s + Math.ceil(kik/atk["kono"]) + red_f + "～" + gre_s   + Math.ceil(kik2/atk["kono"]) + red_f + "）<br>\n";

		msg = msg + "</td><td align=center style='text-align:center;background:#FFC;color:#C60;'>\n";

		msg = msg + "<br><b><font size='+1'>賊討伐シミュレータ</font> ver "+kino_ver+"</b><br><br>\n";
		msg = msg + "<form>\n";

		msg = msg + "<div align='right'><input type='button' id='get_kajiba' value='鍛冶場・課金状況取得'></div>\n";
		msg = msg + "<table id='power_tab' border='1' align='center' style='background:white;color:gray;'><tr>\n";
		msg = msg + "<td>武将攻撃力：</td><td><input type='text' value=0 id='b_power' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='b_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武将兵科:<select id='b_type'><option value=0>歩<option value=1>槍<option value=2>弓<option value=3>騎</select>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>スキル：</td><td colspan=3 align=right><select id='skill'><option value=0>武将<option value=1>剣兵・歩兵兵科の武将<option value=2>槍兵・矛槍兵・槍兵兵科の武将<option value=3>弓兵・弩兵・弓兵兵科の武将<option value=4>騎兵・近衛騎兵・騎兵兵科の武将<option value=5>全ての兵士・武将<option value=6>近衛騎兵・矛槍兵・弩兵</select><br>の攻撃力が<input type='text' value=0 id='skill_rate' size=4 style='text-align:right;' />%上昇する</td>\n"
		msg = msg + "</tr><tr>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td></td><td>兵士数</td><td>スキル効果</td><td>鍛冶場Lv:<select id='kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n"
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>剣兵：</td><td><input type='text' value='" + infantry_count + "' id='infantry_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='ken_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='ken_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>槍兵：</td><td><input type='text' value='" + spear_count + "' id='spear_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='yari_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='yari_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>弓兵：</td><td><input type='text' value='" + archer_count + "' id='archer_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='yumi_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='yumi_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>騎兵：</td><td><input type='text' value='" + cavalry_count + "' id='cavalry_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='ki_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='ki_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>矛槍兵：</td><td><input type='text' value='" + halbert_count + "' id='halbert_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='hoko_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='hoko_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>弩兵：</td><td><input type='text' value='" + crossbow_count + "' id='crossbow_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='do_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='do_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>近衛騎兵：</td><td><input type='text' value='" + cavalry_guards_count + "' id='cavalry_guards_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='konoe_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='konoe_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td colspan='4'>課金(またはヨロズダス)による攻撃力上昇：<select id='cp'><option value=0>無<option value=1>有</select></td>\n";
		msg = msg + "</tr></table><br>\n";
		msg = msg + "<span title='部隊の総攻撃力'>部隊攻撃力：<input type='text' id='power2' size='8' style='color:red;border-width:0;'/></span><br>\n";
		msg = msg + "<span title='部隊の構成比から計算される民兵の防御力の最大値・最小値（乱数の最大・最小）。他同盟の領地の場合、援軍および領地レベルは考慮しない。'>民兵防御力：<input type='text' id='dmax2' size='8' style='color:blue;border-width:0;'/>～<input type='text' id='dmin2' size='8' style='color:blue;border-width:0;'/></span><br>\n";
		msg = msg + "<span title='賊討伐が成功する確率（武将のHPが100に満たない場合はこの限りではない）'>討伐成功率：<input type='text' id='result' size='3' style='background-color:black;color:red;font-size:24px;border-width:0;text-align:right;'/>%</span><br>\n";
		msg = msg + "<span style='font-size:11px;' title='全乱数パターンに対する討伐成功パターン数'>（WIN <input type='text'id='vcnt2' size='3' style='background:#FFC;color:#C60;border-width:0;text-align:center;'/>/ALL <input type='text'id='cnt2' size='3' style='background:#FFC;color:#C60;border-width:0;text-align:center;'/>）</span><br>\n";
		msg = msg + "<input type='button' value=再計算 id='recalc'><br><br>\n";
		msg = msg + "</form>\n";

		msg = msg + "</td></tr>\n";

		msg = msg + "<tr><td align=left colspan=2>\n";
		msg = msg + se_rack + ver_rack + "<br>\n";
		msg = msg + "<b>　＋　賊討伐シミュレータ by kino. ver"+kino_ver+"</b><br>\n";
		msg = msg + "苦情・文句・情報提供などは 17鯖 <a href="+ url_rack2+" target='_blank'>きの。</a> まで御願いします。<br>\n";
		msg = msg + "領地敵兵算出機作者は<a href="+ url_rack+" target='_blank'>こちら（配布元）</a><br>\n";
		msg = msg + "</td></tr></table>\n";

		if (title.indexOf("出兵(入力)") != -1) {
		msg = msg + "<div id='deck_iframe' align=left><br><a id='deckview' href='javascript:void(0)'>Deckview</a><br></div>";
		msg = msg + "<div align=right id='deck_display' style='display:none;'><a id='close_view' href='javascript:void(0)'>CLOSE</a><br><iframe id='iframe' width='770' height='600' style='position:absolute;left:0px;'></iframe></div>";
		}

	var insertHtml = "<div align=center>" + msg + "</div>";
	
	var insertElem = document.createElement('div');
	insertElem.innerHTML = insertHtml;
	insertElem = insertElem.firstChild;
	var containerElem = document.evaluate('//*[@class=\"controlArea\"]', document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	containerElem.snapshotItem(0).appendChild(insertElem);
	
	if (title.indexOf("出兵(確認)") != -1) {
		sol_index();
		close("simple");
		close("power_tab");
		close("recalc");
		close("get_kajiba");
		rec();
	}


	if (title.indexOf("出兵(入力)") != -1) {
		var get_kajiba = document.getElementById("get_kajiba");
	        get_kajiba.addEventListener("click", function(){get_kaji_lv();}, false);
	}

	function get_kaji_lv(){
		
		//鍛冶場Lv・武器強化Lvを自動入力
		var url2 = "http://"+location.hostname+"/village.php";
		GM_xmlhttpRequest({
			method:"GET", 
			url:url2,
			onload:function(x){
			var responseXML = document.createElement('div');
				responseXML.innerHTML = x.responseText;
			
				var panels2 = document.evaluate('.//*[@id="mapOverlayMap"]//area/@title',
				responseXML, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			
				for (var i = 0; i < panels2.snapshotLength; i++) {
					panels3 = panels2.snapshotItem(i).textContent;
					if(panels3.indexOf("鍛冶場") != -1) {
					var kajiba_panel = ".//*[@title='" + panels3+ "']/@href";
					var url3 = document.evaluate(kajiba_panel,responseXML, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
					url3 = url3.snapshotItem(0).textContent;
					kajiba(url3);
					};
				}
			}
		});
	
		function kajiba(x){
		var url3 = "http://"+location.hostname+"/"+x;
			GM_xmlhttpRequest({
				method:"GET", 
				url:url3,
				onload:function(x){
					var responseXML = document.createElement('div');
					responseXML.innerHTML = x.responseText;
					var kajiba = document.evaluate("//*[@class='mainTtl']/div", responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
					kajiba = kajiba.innerHTML.match(/[0-9]+/);
					var sel_kaji = document.getElementById("kaji").getElementsByTagName("option")[kajiba];
					sel_kaji.selected = 1;
	
					var num = 1;
					var sysmes = document.evaluate("//*[@id='gray02Wrapper']", responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML;
					if (sysmes.indexOf("現在は下記兵種の武器を強化しています") != -1) num += 1;
	
					var buki_ken = document.evaluate("//*[@id='gray02Wrapper']/table["+num+"]/tbody/tr[2]/td[2]/b", responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
					buki_ken = buki_ken.innerHTML.match(/[0-9]+/);
					var sel_ken = document.getElementById("ken_kaji").getElementsByTagName("option")[buki_ken];
					sel_ken.selected = 1;
					var trs = document.evaluate('.//*[@id="gray02Wrapper"]//table["+num+"]/tbody/tr', responseXML, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	
					for (var i = 1; i < trs.snapshotLength; i++) {
						var xxx_tr = "//*[@id='gray02Wrapper']/table["+num+"]/tbody/tr["+i+"]";
						xxx_tr = document.evaluate(xxx_tr, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML;
	
						if(xxx_tr.indexOf("槍兵") != -1 && xxx_tr.indexOf("矛槍兵") == -1) {
							var tr_yari = i+1;
							tr_yari = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_yari + "]/td[2]/b";
							var buki_yari = document.evaluate(tr_yari, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_yari = document.getElementById("yari_kaji").getElementsByTagName("option")[buki_yari];
							sel_yari.selected = 1;
							}
	
						else if(xxx_tr.indexOf("弓兵") != -1) {
							var tr_yumi = i+1;
							tr_yumi = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_yumi + "]/td[2]/b";
							var buki_yumi = document.evaluate(tr_yumi, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_yumi = document.getElementById("yumi_kaji").getElementsByTagName("option")[buki_yumi];
							sel_yumi.selected = 1;
							}

						else if(xxx_tr.indexOf("騎兵") != -1 && xxx_tr.indexOf("近衛騎兵") == -1 && xxx_tr.indexOf("斥候騎兵") == -1) {
							var tr_ki = i+1;
							tr_ki = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_ki + "]/td[2]/b";
							var buki_ki = document.evaluate(tr_ki, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_ki = document.getElementById("ki_kaji").getElementsByTagName("option")[buki_ki];
							sel_ki.selected = 1;
							}

						if(xxx_tr.indexOf("矛槍兵") != -1) {
							var tr_hoko = i+1;
							tr_hoko = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_hoko + "]/td[2]/b";
							var buki_hoko = document.evaluate(tr_hoko, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_hoko = document.getElementById("hoko_kaji").getElementsByTagName("option")[buki_hoko];
							sel_hoko.selected = 1;
							}

						if(xxx_tr.indexOf("弩兵") != -1) {
							var tr_do = i+1;
							tr_do = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_do + "]/td[2]/b";
							var buki_do = document.evaluate(tr_do, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_do = document.getElementById("do_kaji").getElementsByTagName("option")[buki_do];
							sel_do.selected = 1;
							}

						if(xxx_tr.indexOf("近衛騎兵") != -1) {
							var tr_konoe = i+1;
							tr_konoe = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_konoe + "]/td[2]/b";
							var buki_konoe = document.evaluate(tr_konoe, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_konoe = document.getElementById("konoe_kaji").getElementsByTagName("option")[buki_konoe];
							sel_konoe.selected = 1;
							}
					}				
				}
			});
		}

		var url4 = "http://"+location.hostname+"/cp/item_list.php";
		GM_xmlhttpRequest({
			method:"GET", 
			url:url4,
			onload:function(x){
			var responseXML = document.createElement('div');
				responseXML.innerHTML = x.responseText;

//faraway120126				var tr_cp = "//*[@id='gray02Wrapper']/form/table/tbody/tr[29]/td[4]/p/a";
				var tr_cp = "//*[@id='gray02Wrapper']/form/table/tbody/tr[33]/td[4]/p/a";
				var now_cp = document.evaluate(tr_cp, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML;
				if(now_cp.indexOf("延長する") != -1){
					var sel_cp = document.getElementById("cp").getElementsByTagName("option")[1];
					sel_cp.selected = 1;
				}
			}
		});

	}

	function changeskill(){
		var skill_type = document.getElementById("skill");
		skill_type = skill_type.options[skill_type.selectedIndex].value;
		var skill_rate = document.getElementById("skill_rate").value;
		var busho = document.getElementById("b_skill");
		var kenpei = document.getElementById("ken_skill");
		var yarihei = document.getElementById("yari_skill");
		var yumihei = document.getElementById("yumi_skill");
		var kihei = document.getElementById("ki_skill");
		var hokoyarihei = document.getElementById("hoko_skill");
		var dohei = document.getElementById("do_skill");
		var konoekihei = document.getElementById("konoe_skill");
		var b_type = document.getElementById("b_type");
		var b_type2 = b_type.options[b_type.selectedIndex].value;

		if(skill_type == "0"){
			busho.value = skill_rate;
			kenpei.value = 0;
			yarihei.value = 0;
			yumihei.value = 0;
			kihei.value = 0;
			hokoyarihei.value = 0;
			dohei.value = 0;
			konoekihei.value = 0;
		}
		if(skill_type == "1"){
			if(b_type2 == "0"){busho.value = skill_rate;} else {busho.value = 0;};
			kenpei.value = skill_rate;
			yarihei.value = 0;
			yumihei.value = 0;
			kihei.value = 0;
			hokoyarihei.value = 0;
			dohei.value = 0;
			konoekihei.value = 0;
		}
		if(skill_type == "2"){
			if(b_type2 == "1"){busho.value = skill_rate;} else {busho.value = 0;};
			kenpei.value = 0;
			yarihei.value = skill_rate;
			yumihei.value = 0;
			kihei.value = 0;
			hokoyarihei.value = skill_rate;
			dohei.value = 0;
			konoekihei.value = 0;
		}
		if(skill_type == "3"){
			if(b_type2 == "2"){busho.value = skill_rate;} else {busho.value = 0;};
			kenpei.value = 0;
			yarihei.value = 0;
			yumihei.value = skill_rate;
			kihei.value = 0;
			hokoyarihei.value = 0;
			dohei.value = skill_rate;
			konoekihei.value = 0;
		}
		if(skill_type == "4"){
			if(b_type2 == "3"){busho.value = skill_rate;} else {busho.value = 0;};
			kenpei.value = 0;
			yarihei.value = 0;
			yumihei.value = 0;
			kihei.value = skill_rate;
			hokoyarihei.value = 0;
			dohei.value = 0;
			konoekihei.value = skill_rate;
		}
		if(skill_type == "5"){
			busho.value = skill_rate;
			kenpei.value = skill_rate;
			yarihei.value = skill_rate;
			yumihei.value = skill_rate;
			kihei.value = skill_rate;
			hokoyarihei.value = skill_rate;
			dohei.value = skill_rate;
			konoekihei.value = skill_rate;
		}
		if(skill_type == "6"){
			busho.value = 0;
			kenpei.value = 0;
			yarihei.value = 0;
			yumihei.value = 0;
			kihei.value = 0;
			hokoyarihei.value = skill_rate;
			dohei.value = skill_rate;
			konoekihei.value = skill_rate;
		}

	}

	var skill_sel = document.getElementById("skill");
        skill_sel.addEventListener("change", function(){changeskill();}, false);
	var skill_rate = document.getElementById("skill_rate");
        skill_rate.addEventListener("change", function(){changeskill();}, false);
	var b_type = document.getElementById("b_type");
        b_type.addEventListener("change", function(){changeskill();}, false);

	var recalc = document.getElementById("recalc");
        recalc.addEventListener("click", function(){rec();}, false);
	
	var deckview = document.getElementById("deckview");

        if(deckview) deckview.addEventListener("click", function(){view("deck_display");chansrc("iframe");}, false);
	var close_view = document.getElementById("close_view");
        if(close_view) close_view.addEventListener("click", function(){close("deck_display");}, false);

	}

	function sol_index(){
		var index = 0;
		if(soltype == "歩兵") index = 0;
		else if(soltype == "槍兵") index = 1;
		else if(soltype == "弓兵") index = 2;
		else if(soltype == "騎兵") index = 3;
		var sel_soltype = document.getElementById("b_type").getElementsByTagName("option")[index];
		sel_soltype.selected = 1;
	}

	var svsetting_btn = document.getElementById("svsetting_btn");
        svsetting_btn.addEventListener("click", function(){view("svsetting");set_season();}, false);
	var svsave_btn = document.getElementById("svsave_btn");
        svsave_btn.addEventListener("click", function(){sv_save();}, false);
	var svreset_btn = document.getElementById("svreset_btn");
        svreset_btn.addEventListener("click", function(){reset_season();}, false);

}

function view(id){
	document.getElementById(id).style.display = "block";
};

function close(id){
	document.getElementById(id).style.display = "none";
}

function chansrc(id){
	document.getElementById(id).src = "../card/deck.php#filetop"
};

var sv_world = [];
var sv_season = [];
function set_season(){
	for(i=0;i<serverTable.length;i++){
		var BRO3_TOBATSU_SV	= 'bro3_tobatsu_sv' + i;
		var BRO3_TOBATSU_SEASON	= 'bro3_tobatsu_season' + i;
		sv_world[i] = document.getElementById("s"+i);
		sv_season[i] = document.getElementById("s"+i+"s");

			sv_world[i].value = GM_getValue(BRO3_TOBATSU_SV);
		if(GM_getValue(BRO3_TOBATSU_SV)=="NN") sv_world[i].value = "";
		var season = GM_getValue(BRO3_TOBATSU_SEASON) -1;
		sv_season[i].getElementsByTagName("option")[season].selected = 1;
	}
}

function sv_save(){
	for(i=0;i<serverTable.length;i++){
		sv_world[i] = document.getElementById("s"+i).value;
		if(sv_world[i]=="") sv_world[i] = "NN";
		sv_season[i] = document.getElementById("s"+i+"s");
		sv_season[i] = sv_season[i].options[sv_season[i].selectedIndex].value;
		var BRO3_TOBATSU_SV	= 'bro3_tobatsu_sv' + i;
		var BRO3_TOBATSU_SEASON	= 'bro3_tobatsu_season' + i;
		GM_setValue(BRO3_TOBATSU_SV, sv_world[i]);
		GM_setValue(BRO3_TOBATSU_SEASON, sv_season[i]);
	}
	alert("保存しました");
}

function reset_season(){
	for(i=0;i<serverTable.length;i++){
		sv_world[i] = document.getElementById("s"+i);
		sv_season[i] = document.getElementById("s"+i+"s");

		sv_world[i].value = serverTable[i][0];
		var season = serverTable[i][1] - 1;
		sv_season[i].getElementsByTagName("option")[season].selected = 1;
	}
}

//faraway}) ();
}	//faraway

//faraway 22.討伐・空き地 民兵出現 推定機のソース(bro3_calcn_craford_custom.user.js)終了

//faraway110929 start
//faraway 23.自動出兵のソース(autoxxx.user.js)開始
//================================================================================
//23.自動出兵
//================================================================================
//faraway 23.自動出兵ツールのソース(autoxxx.user.js)終了


//faraway 23."自動出兵"
function AutoTroops(){
//	alert("23.自動出兵");	//faraway
}
//faraway 24.武将ダス履歴抽出分析 Ver1.09のソース(bro3_put_busyodas_textuserjs.user.js)開始
//================================================================================
//24.武将ダス履歴抽出分析 Ver1.09
//================================================================================
// ==UserScript==
// @name           bro3_put_busyodas_text.user.js
// @namespace      http://homepage3.nifty.com/Craford
// @include        http://*.3gokushi.jp/busyodas/busyodas_history.php*
// @include        http://*.1kibaku.jp/busyodas/busyodas_history.php*
// @description    ブラウザ三国志ブショーダス履歴テキスト生成
// @version        1.09
// ==/UserScript==
// version date       author
// ver0.01 2011.03.21 Craford 実装テスト
// ver0.02 2011.03.22 Craford ブショーダス履歴が最終ページでもうごくように修正
// ver0.03 2011.03.22 Craford ブショーダス履歴が1ページでもうごくように修正。一騎当千に対応。
// ver0.04 2011.03.22 Craford 出力結果に分析結果を出すようにしてみた。
// ver1.00 2011.03.22 Craford ブショーダス別分析を追加
// ver1.01 2011.03.22 Craford ブショーダスEXの枚数を追加
// ver1.02 2011.03.22 Craford カードをひいていないとき、結果に%NaN%がでる問題に対応。
// ver1.03 2011.03.22 Craford レイアウト変更、その他各種修正、機能追加。
// ver1.04 2011.03.23 Craford パーセンテージ表示の整形、カード取得枚数を降順ソート
// ver1.05 2011.03.23 Craford カード取得枚数にブショーダス別枚数の表示を追加
// ver1.06 2011.03.24 Craford レアカード出力時間に、レア「Ｒ」を追加
// ver1.07 2011.11.12 Craford 集計対象に「SP」を追加
// ver1.08 2011.11.23 Craford 集計対象に「小麗」を追加
// ver1.09 2012.01.31 hasekun 集計対象に「大鳳」を追加して組込


//----------------//
// メインルーチン //
//----------------//
function HistAnalysis(){
//faraway(function(){

	if (location.pathname == "/busyodas/busyodas_history.php") {
		// ブショーダス履歴画面のみ動作

		//HTML追加
		addHtml_24();
	}
//faraway})();
}//faraway
//------------//
// HTMLの生成 //
//------------//
function addHtml_24() {

	//--------------------------------------//
	// 画面生成                             //
	//--------------------------------------//

	//----------------//
	// コンテナの取得 //
	//----------------//
	var container;
	var pager = $e_24('//*[@class="pager"]');
	var bbs = $e_24('//*[@id="gray02Wrapper"]');
	if (pager.snapshotLength == 0) {
		container = bbs.snapshotItem(0);
	} else {
		container = pager.snapshotItem(0);
	}
	

	//----------------//
	//-- ヘッダー部 --//
	//----------------//
	//-- コントロール配置DIV --//
	var linksDiv = document.createElement("div");
	container.appendChild(linksDiv);

	//-- ツール名称ラベル --//
	var textLabel = document.createElement("span");
	textLabel.id = "toolLabel";
	textLabel.style.fontSize = "16px";
	textLabel.innerHTML = "<br><b>ブショーダス履歴抽出 Ver." + VERSION_24 + "</b>";
	textLabel.style.color = "black";
	textLabel.style.width = "725px";
	linksDiv.appendChild(textLabel);

	//-- (改行) --//
	textLabel = document.createElement("span");
	textLabel.innerHTML = "<br>";
	linksDiv.appendChild(textLabel);

	//-- ページ数表示 --//
	var ckLabel = document.createElement("span");
	ckLabel.style.fontSize = "14px";
	ckLabel.style.marginLeft = "16px";
	ckLabel.innerHTML = "履歴ページ数";
	linksDiv.appendChild(ckLabel);

	ckLabel = document.createElement("span");
	ckLabel.style.fontSize = "14px";
	ckLabel.id = "pageNo";
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "0";
	linksDiv.appendChild(ckLabel);

	ckLabel = document.createElement("span");
	ckLabel.style.fontSize = "14px";
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "/";
	linksDiv.appendChild(ckLabel);

	var data = $e_24('//ul[@class="pager"]/li[@class="last"]//a[@title="last page"]');
	if( data.snapshotLength > 0 ){
		var ref = data.snapshotItem(0).getAttribute("href");
		maxpage = ref.replace(/^.*\?p=/,"");
		urlpath = ref.replace(/\?p=.*$/,"");
	}
	else{
		var data = $e_24('//ul[@class="pager"]/li/b');
		if( data.snapshotLength > 0 ){
			maxpage = data.snapshotItem(0).textContent;

			var data = $e_24('//ul[@class="pager"]/li//a[@title="first page"]');
			var ref = data.snapshotItem(0).getAttribute("href");
			urlpath = ref.replace(/\?p=.*$/,"");
		}
		else{
			maxpage = 1;
		}
	}

	ckLabel = document.createElement("span");
	ckLabel.style.fontSize = "14px";
	ckLabel.id = "lastPageNo";
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = maxpage;
	linksDiv.appendChild(ckLabel);

	//-- 詳細は出さないチェック --//
	var check1 = document.createElement("input");
	check1.type = "checkbox";
	check1.id = "ckcheck1";
	check1.style.marginLeft = "16px";
	linksDiv.appendChild(check1);
	var label2 = document.createElement("span");
	label2.style.fontSize = "12px";
	label2.style.marginLeft = "2px";
	label2.innerHTML = "履歴出力";
	linksDiv.appendChild(label2);

	//-- 情報取得ボタン --//
	var button1 = document.createElement("input");
	button1.type = "button";
	button1.id = "ckButton1";
	button1.style.fontSize = "12px";
	button1.style.marginLeft = "16px";
	button1.value = "ブショーダス履歴を抽出";
	button1.addEventListener("click", function() {getButtonClicked()}, true);
	linksDiv.appendChild(button1);

	//-- 結果全選択ボタン --//
	var button2 = document.createElement("input");
	button2.type = "button";
	button2.id = "ckButton2";
	button2.style.fontSize = "12px";
	button2.style.marginLeft = "16px";
	button2.value = "結果全選択";
	button2.addEventListener("click", function() {selectButtonClicked()}, true);
	linksDiv.appendChild(button2);

	//-- (改行) --//
	textLabel = document.createElement("span");
	textLabel.innerHTML = "<br>";
	linksDiv.appendChild(textLabel);

	// （ギャップ埋め）
	ckLabel = document.createElement("pre");
	ckLabel.style.height = "6px";
	linksDiv.appendChild(ckLabel);

	//----------------------------//
	// 検索結果のテキスト表示領域 //
	//----------------------------//
	textArea = document.createElement("div");
	textArea.innerHTML = "";
	textArea.style.fontSize = "14px";
	textArea.style.color = "black";
	textArea.style.backgroundColor = "#FFDEAD";
	textArea.style.width = "725px";
	textArea.style.height = "200px";
	textArea.style.overflow = "auto";
	textArea.style.border = "solid 2px";
	textArea.style.padding = "2px";
	textArea.style.marginTop = "-2px";
	textArea.style.textAlign = "left";
	linksDiv.appendChild(textArea);

	ckLabel = document.createElement("pre");
	ckLabel.id = "resultText";
	ckLabel.innerHTML = "";
	textArea.appendChild(ckLabel);

	//--------------------------//
	// 他ページ取得情報の設定域 //
	//--------------------------//
	var linksDiv2 = document.createElement("html");
	linksDiv2.id = "hiddenData";
	linksDiv2.style.display = "none";
	container.appendChild(linksDiv2);
}


//------------------------//
// 取得ボタン押下処理処理 //
//------------------------//
function getButtonClicked() {
	// ハッシュテーブル初期化
	card = new Array();
	rare_count = {}; // ランク別カード数

	// レア枚数の初期化
	t_rare_count['C'] = 0;
	t_rare_count['UC'] = 0;
	t_rare_count['R'] = 0;
	t_rare_count['SR'] = 0;
	t_rare_count['UR'] = 0;

	g_rare_count['C'] = 0;
	g_rare_count['UC'] = 0;
	g_rare_count['R'] = 0;
	g_rare_count['SR'] = 0;
	g_rare_count['UR'] = 0;

	s_rare_count['C'] = 0;
	s_rare_count['UC'] = 0;
	s_rare_count['R'] = 0;
	s_rare_count['SR'] = 0;
	s_rare_count['UR'] = 0;

	sp_rare_count['C'] = 0;
	sp_rare_count['UC'] = 0;
	sp_rare_count['R'] = 0;
	sp_rare_count['SR'] = 0;
	sp_rare_count['UR'] = 0;

	sho_rare_count['C'] = 0;
	sho_rare_count['UC'] = 0;
	sho_rare_count['R'] = 0;
	sho_rare_count['SR'] = 0;
	sho_rare_count['UR'] = 0;

	l_rare_count['C'] = 0;
	l_rare_count['UC'] = 0;
	l_rare_count['R'] = 0;
	l_rare_count['SR'] = 0;
	l_rare_count['UR'] = 0;

	xg_rare_count['C'] = 0;
	xg_rare_count['UC'] = 0;
	xg_rare_count['R'] = 0;
	xg_rare_count['SR'] = 0;
	xg_rare_count['UR'] = 0;

	xs_rare_count['C'] = 0;
	xs_rare_count['UC'] = 0;
	xs_rare_count['R'] = 0;
	xs_rare_count['SR'] = 0;
	xs_rare_count['UR'] = 0;

	total_cards = 0; // 総カード数
	g_total_cards = 0; // 総カード数
	s_total_cards = 0; // 総カード数
	l_total_cards = 0; // 総カード数
	sp_total_cards = 0; // 総カード数
	sho_total_cards = 0; // 総カード数
	tai_total_cards = 0; // 総カード数

	g_ex_cards = 0;
	s_ex_cards = 0;

	srup_text = "";

	var textBox = $e_24('//*[@id="resultText"]');
	textBox.snapshotItem(0).innerHTML = "データ取得中・・・「終了しました」のダイアログが出るまでお待ち下さい";

	var button = $e_24('//*[@id="ckButton1"]');
	button.snapshotItem(0).disabled = true;
	button = $e_24('//*[@id="ckButton2"]');
	button.snapshotItem(0).disabled = true;

	// 見出し
	putText_24 = "カードNo.\tレアリティ\t名前\tレベル\tカード取得日時\tブショーダスタイプ<br>";

	if( maxpage > 1 ){
		loadPage_24(1);
	}
	else{
		// 2ページ目以降
		var data = $e_24('//table[@class="commonTables"]//td');
		var text = "";
		for( var i = 0; i < data.snapshotLength/6; i++ ){
			var res = "";
			for( var j = 0; j < 6; j++ ){
				res = res + data.snapshotItem(i*6+j).textContent;
				if( j < 5 ){
					res = res + "\t";
				}
			}
			text = text + res + "<br>";

			var no = data.snapshotItem(i*6+0).textContent;
			var rare = data.snapshotItem(i*6+1).textContent;
			if( (rare == "UR") || (rare == "SR") || (rare == "R") ){
				srup_text = srup_text + res + "<BR>";
			}

			if( card[no] == undefined ){
				card[no] = new Array();
				card[no]['no'] = data.snapshotItem(i*6+0).textContent;
				card[no]['rare'] = data.snapshotItem(i*6+1).textContent;
				card[no]['name'] = data.snapshotItem(i*6+2).textContent;
				card[no]['ct'] = 1;
				card[no]['gld'] = 0;
				card[no]['slv'] = 0;
				card[no]['sho'] = 0;
				card[no]['lgt'] = 0;
			}
			else{
				card[no]['ct'] = card[no]['ct'] + 1;
			}

			t_rare_count[rare] = t_rare_count[rare] + 1;
			total_cards = total_cards + 1;
			if( data.snapshotItem(i*6+5).textContent.indexOf("ゴールド") >= 0 ){
				g_rare_count[rare] = g_rare_count[rare] + 1;
				g_total_cards = g_total_cards + 1;
				card[no]['gld'] = card[no]['gld'] + 1;

				if( data.snapshotItem(i*6+5).textContent.indexOf("EX") >= 0 ){
					xg_rare_count[rare] = xg_rare_count[rare] + 1;
					g_ex_cards = g_ex_cards + 1;
				}
			}
			else if( data.snapshotItem(i*6+5).textContent.indexOf("シルバー") >= 0 ){
				s_rare_count[rare] = s_rare_count[rare] + 1;
				s_total_cards = s_total_cards + 1;
				card[no]['slv'] = card[no]['slv'] + 1;

				if( data.snapshotItem(i*6+5).textContent.indexOf("EX") >= 0 ){
					xs_rare_count[rare] = xs_rare_count[rare] + 1;
					s_ex_cards = s_ex_cards + 1;
				}
			}
			else if( data.snapshotItem(i*6+5).textContent.indexOf("SP") >= 0 ){
				sp_rare_count[rare] = sp_rare_count[rare] + 1;
				sp_total_cards = sp_total_cards + 1;
				card[no]['sp'] = card[no]['sp'] + 1;
			}
			else if( data.snapshotItem(i*6+5).textContent.indexOf("小麗") >= 0 ){
				sho_rare_count[rare] = sho_rare_count[rare] + 1;
				sho_total_cards = sho_total_cards + 1;
				card[no]['sho'] = card[no]['sho'] + 1;
			}
			else if( data.snapshotItem(i*6+5).textContent.indexOf("大鳳") >= 0 ){
				tai_rare_count[rare] = tai_rare_count[rare] + 1;
				tai_total_cards = tai_total_cards + 1;
				card[no]['tai'] = card[no]['tai'] + 1;
			}
			else{
				l_rare_count[rare] = l_rare_count[rare] + 1;
				l_total_cards = l_total_cards + 1;
				card[no]['lgt'] = card[no]['lgt'] + 1;
			}
		}

		var analyze = makeAnalyzeText();

		var checkBox = $e_24('//*[@id="ckcheck1"]');
		var textBox = $e_24('//*[@id="resultText"]');
		textBox.snapshotItem(0).innerHTML = analyze + '<BR>ブショーダス履歴<BR>' + putText_24 + text;

		var button = $e_24('//*[@id="ckButton1"]');
		button.snapshotItem(0).disabled = false;
		button = $e_24('//*[@id="ckButton2"]');
		button.snapshotItem(0).disabled = false;

		alert("終了しました");
	}
}

//----------------------//
// ページのローディング //
//----------------------//
function loadPage_24(targetPageNo) {
	var opt = {
		method: 'get',
		url: urlpath + "?p=" + targetPageNo,
		onload: function(res) {
			addResult(targetPageNo, res);
		}
	}
	GM_xmlhttpRequest(opt); 
}

//--------------//
// 取得結果加算 //
//--------------//
function addResult(targetPageNo,res) {
	var pageNo = $e_24('//*[@id="pageNo"]');
	pageNo.snapshotItem(0).textContent = targetPageNo;

	var hidden = $e_24('//*[@id="hiddenData"]');
	hidden.snapshotItem(0).innerHTML = res.responseText;

	// 2ページ目以降
	var data = $e_24('//*[@id="hiddenData"]//table[@class="commonTables"]//td');
	var text = "";
	for( var i = 0; i < data.snapshotLength/6; i++ ){
		var res = "";
		var res2 = "";
		for( var j = 0; j < 6; j++ ){
			res = res + data.snapshotItem(i*6+j).textContent;
			if( j != 3 ){
				res2 = res2 + data.snapshotItem(i*6+j).textContent;
			}
			if( j < 5 ){
				res = res + "\t";
				res2 = res2 + "\t";
			}
		}
		text = text + res + "<br>";

		var no = data.snapshotItem(i*6+0).textContent;
		var rare = data.snapshotItem(i*6+1).textContent;
		if( (rare == "UR") || (rare == "SR") || (rare == "R") ){
			srup_text = srup_text + res2 + "<BR>";
		}

		if( card[no] == undefined ){
			card[no] = new Array();
			card[no]['no'] = data.snapshotItem(i*6+0).textContent;
			card[no]['rare'] = data.snapshotItem(i*6+1).textContent;
			card[no]['name'] = data.snapshotItem(i*6+2).textContent;
			card[no]['ct'] = 1;
			card[no]['gld'] = 0;
			card[no]['slv'] = 0;
			card[no]['sp'] = 0;
			card[no]['sho'] = 0;
			card[no]['tai'] = 0;
			card[no]['lgt'] = 0;
		}
		else{
			card[no]['ct'] = card[no]['ct'] + 1;
		}

		t_rare_count[rare] = t_rare_count[rare] + 1;
		total_cards = total_cards + 1;
		if( data.snapshotItem(i*6+5).textContent.indexOf("ゴールド") >= 0 ){
			g_rare_count[rare] = g_rare_count[rare] + 1;
			g_total_cards = g_total_cards + 1;
			card[no]['gld'] = card[no]['gld'] + 1;

			if( data.snapshotItem(i*6+5).textContent.indexOf("EX") >= 0 ){
				xg_rare_count[rare] = xg_rare_count[rare] + 1;
				g_ex_cards = g_ex_cards + 1;
			}
		}
		else if( data.snapshotItem(i*6+5).textContent.indexOf("シルバー") >= 0 ){
			s_rare_count[rare] = s_rare_count[rare] + 1;
			s_total_cards = s_total_cards + 1;
			card[no]['slv'] = card[no]['slv'] + 1;

			if( data.snapshotItem(i*6+5).textContent.indexOf("EX") >= 0 ){
				xs_rare_count[rare] = xs_rare_count[rare] + 1;
				s_ex_cards = s_ex_cards + 1;
			}
		}
		else if( data.snapshotItem(i*6+5).textContent.indexOf("SP") >= 0 ){
			sp_rare_count[rare] = sp_rare_count[rare] + 1;
			sp_total_cards = sp_total_cards + 1;
			card[no]['sp'] = card[no]['sp'] + 1;
		}
		else if( data.snapshotItem(i*6+5).textContent.indexOf("小麗") >= 0 ){
			sho_rare_count[rare] = sho_rare_count[rare] + 1;
			sho_total_cards = sho_total_cards + 1;
			card[no]['sho'] = card[no]['sho'] + 1;
		}
		else if( data.snapshotItem(i*6+5).textContent.indexOf("大鳳") >= 0 ){
			tai_rare_count[rare] = tai_rare_count[rare] + 1;
			tai_total_cards = tai_total_cards + 1;
			card[no]['tai'] = card[no]['tai'] + 1;
		}
		else{
			l_rare_count[rare] = l_rare_count[rare] + 1;
			l_total_cards = l_total_cards + 1;
			card[no]['lgt'] = card[no]['lgt'] + 1;
		}	}


	if(maxpage > targetPageNo ){
		putText_24 = putText_24 + text;
		loadPage_24(parseInt(targetPageNo)+1);
	}
	else{
		var analyze = makeAnalyzeText();

		var checkBox = $e_24('//*[@id="ckcheck1"]');
		var textBox = $e_24('//*[@id="resultText"]');
		if( checkBox.checked == true ){
			textBox.snapshotItem(0).innerHTML = analyze +
							    '<BR>ブショーダス履歴<BR>' +
							    '----------------------------------------------------------<BR>' +
							    putText_24 + text;
		}
		else{
			textBox.snapshotItem(0).innerHTML = analyze;
		}

		var button = $e_24('//*[@id="ckButton1"]');
		button.snapshotItem(0).disabled = false;
		button = $e_24('//*[@id="ckButton2"]');
		button.snapshotItem(0).disabled = false;

		alert("終了しました");
	}
}

//--------------//
// 全選択ボタン //
//-------------//
function selectButtonClicked() {
	// 構築ルート情報の選択
	var textBox = $x_24('//*[@id="resultText"]');

	var objs = textBox.firstChild;
	var obje = textBox.lastChild;

	var range = document.createRange();
	range.setStart(objs,0);
	range.setEnd(obje,obje.textContent.length);
	var sel = getSelection();
	sel.removeAllRanges();
	sel.addRange(range);
}


//--------------//
// 分析テキスト //
//-------------//
function makeAnalyzeText(){
	var text = "";

	text = text + "ブショーダス履歴分析結果<BR>";
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【累計】<BR>";
	if( total_cards > 0 ){
		text = text + "　カード枚数：" + total_cards + "枚<BR>";
		text = text + "　　UR・・" + formatRightNumber_24(t_rare_count["UR"],4) + "枚\t" + calc_per(t_rare_count["UR"],total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber_24(t_rare_count["SR"],4) + "枚\t" + calc_per(t_rare_count["SR"],total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber_24(t_rare_count["R"],4) + "枚\t" + calc_per(t_rare_count["R"],total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber_24(t_rare_count["UC"],4) + "枚\t" + calc_per(t_rare_count["UC"],total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber_24(t_rare_count["C"],4) + "枚\t" + calc_per(t_rare_count["C"],total_cards) + "<BR>";
	}
	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダスゴールド】<BR>";
	if( g_total_cards > 0 ){
		text = text + "　カード枚数：" + g_total_cards + "枚（EX：" + g_ex_cards + "枚）<BR>";
		text = text + "　　UR・・" + formatRightNumber_24(g_rare_count["UR"],4) + "枚\t" + calc_per(g_rare_count["UR"],g_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber_24(g_rare_count["SR"],4) + "枚\t" + calc_per(g_rare_count["SR"],g_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber_24(g_rare_count["R"],4) + "枚\t" + calc_per(g_rare_count["R"],g_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber_24(g_rare_count["UC"],4) + "枚\t" + calc_per(g_rare_count["UC"],g_total_cards) + "<BR>";
	}
	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダスシルバー】<BR>";
	if( s_total_cards > 0 ){
		text = text + "　カード枚数：" + s_total_cards + "枚（EX：" + s_ex_cards + "枚）<BR>";
		text = text + "　　UR・・" + formatRightNumber_24(s_rare_count["UR"],4) + "枚\t" + calc_per(s_rare_count["UR"],s_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber_24(s_rare_count["SR"],4) + "枚\t" + calc_per(s_rare_count["SR"],s_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber_24(s_rare_count["R"],4) + "枚\t" + calc_per(s_rare_count["R"],s_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber_24(s_rare_count["UC"],4) + "枚\t" + calc_per(s_rare_count["UC"],s_total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber_24(s_rare_count["C"],4) + "枚\t" + calc_per(s_rare_count["C"],s_total_cards) + "<BR>";
	}
	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダスSP】<BR>";
	if( sp_total_cards > 0 ){
		text = text + "　カード枚数：" + sp_total_cards + "枚<BR>";
		text = text + "　　UR・・" + formatRightNumber(sp_rare_count["UR"],5) + "枚\t" + calc_per(sp_rare_count["UR"],sp_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber(sp_rare_count["SR"],5) + "枚\t" + calc_per(sp_rare_count["SR"],sp_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber(sp_rare_count["R"],5) + "枚\t" + calc_per(sp_rare_count["R"],sp_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber(sp_rare_count["UC"],5) + "枚\t" + calc_per(sp_rare_count["UC"],sp_total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber(sp_rare_count["C"],5) + "枚\t" + calc_per(sp_rare_count["C"],sp_total_cards) + "<BR>";
	}
	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダス小麗】<BR>";
	if( sho_total_cards > 0 ){
		text = text + "　カード枚数：" + sho_total_cards + "枚<BR>";
		text = text + "　　UR・・" + formatRightNumber(sho_rare_count["UR"],5) + "枚\t" + calc_per(sho_rare_count["UR"],sho_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber(sho_rare_count["SR"],5) + "枚\t" + calc_per(sho_rare_count["SR"],sho_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber(sho_rare_count["R"],5) + "枚\t" + calc_per(sho_rare_count["R"],sho_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber(sho_rare_count["UC"],5) + "枚\t" + calc_per(sho_rare_count["UC"],sho_total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber(sho_rare_count["C"],5) + "枚\t" + calc_per(sho_rare_count["C"],sho_total_cards) + "<BR>";
	}	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダス大鳳】<BR>";
	if( tai_total_cards > 0 ){
		text = text + "　カード枚数：" + tai_total_cards + "枚<BR>";
		text = text + "　　UR・・" + formatRightNumber(tai_rare_count["UR"],5) + "枚\t" + calc_per(tai_rare_count["UR"],tai_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber(tai_rare_count["SR"],5) + "枚\t" + calc_per(tai_rare_count["SR"],tai_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber(tai_rare_count["R"],5) + "枚\t" + calc_per(tai_rare_count["R"],tai_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber(tai_rare_count["UC"],5) + "枚\t" + calc_per(tai_rare_count["UC"],tai_total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber(tai_rare_count["C"],5) + "枚\t" + calc_per(tai_rare_count["C"],tai_total_cards) + "<BR>";
	}	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダスライト】<BR>";
	if( l_total_cards > 0 ){
		text = text + "　カード枚数：" + l_total_cards + "枚<BR>";
		text = text + "　　SR・・" + formatRightNumber_24(l_rare_count["SR"],4) + "枚\t" + calc_per(l_rare_count["SR"],l_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber_24(l_rare_count["R"],4) + "枚\t" + calc_per(l_rare_count["R"],l_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber_24(l_rare_count["UC"],4) + "枚\t" + calc_per(l_rare_count["UC"],l_total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber_24(l_rare_count["C"],4) + "枚\t" + calc_per(l_rare_count["C"],l_total_cards) + "<BR>";
	}
	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "<BR>";
	text = text + "UR、SR、R取得詳細<BR>";
	text = text + "----------------------------------------------------------<BR>";
	if( srup_text != "" ){
		text = text + srup_text;
	}
	else{
		text = text + "UR、SR、Rは取得していません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "<BR>";
	text = text + "武将カード別取得枚数<BR>";
	text = text + "----------------------------------------------------------<BR>";

	// カードを枚数順でソートする(逆順ソート)
	card.sort(
		function(b1, b2){
			var result = -1;

			if( b1['ct'] < b2['ct'] ){
				// 枚数が小→大の順なので交換
				result = 1;
			}
			else{
				result = -1;
			}

			return result;
		}
	);

	for( var i in card ){
		if(i == "each") break;	//なぜか最後に"each"が入るのでこのときfor()を抜けるようにした(ｽｸﾘﾌﾟﾄ単体では起きない) faraway111005
		text = text + "　" + card[i]['no'] + "." + card[i]['rare'] + card[i]['name'] + "\t" + formatRightNumber_24(card[i]['ct'],4) + "枚\t("
			+ calc_per(card[i]['ct'],total_cards) + ")\t"
			+ "GL:" + formatRightNumber(card[i]['gld'],4) + "枚"
			+ "　SL:" + formatRightNumber(card[i]['slv'],4) + "枚"
			+ "　SP:" + formatRightNumber(card[i]['sp'],4) + "枚"
			+ "　小:" + formatRightNumber(card[i]['sho'],4) + "枚"
			+ "　大:" + formatRightNumber(card[i]['tai'],4) + "枚"
			+ "　LT:" + formatRightNumber(card[i]['lgt'],4) + "枚<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";

	return text;
}

// 小数桁数フォーマッタ
function fm_num(str){
	var temp;
	temp = String(str);

	if( temp.indexOf(".") < 0 ){
		temp = temp + ".00";
	}
	if( temp.indexOf(".") == 1 ){
		temp = "  " + temp;
	}
	if( temp.indexOf(".") == 2 ){
		temp = " " + temp;
	}
	if( temp.length != 6 ){
		temp = temp + "0";
	}

	return temp;
}

// カード枚数から比率を求める
function calc_per(num,base){
	return fm_num(Math.floor(num/base*10000)/100) + "%";
}

// 桁数整形
function formatRightNumber_24( num, length ){
	var fix = '    ';
	var str;
	var result = '';

	str = num.toString(10);
	if( str.length < length ){
		result = fix.substr(0,length - str.length) + str;
	}
	else{
		result = str;
	}

	return result;
}

//faraway 24.武将ダス履歴抽出分析 Ver1.09のソース(bro3_put_busyodas_textuserjs.user.js)終了

//faraway 25.クエスト補助のソース(bro3_quest_display.user.js)開始
//================================================================================
//25.クエスト補助
//================================================================================
function QuestAssist(){
	//alert("25.クエスト補助");	//faraway

// ==UserScript==
// @name		bro3_quest_display
// @namespace	http://ortg.6.ql.bz/files/3gokushi_quest_display.user.js
// @description		ブラウザ三国志のクエスト補助
// @include		http://*.3gokushi.jp/quest/*
// ==/UserScript==

//faraway(function() {
  // クエスト画面でのみ動作させる
  if( document.title.indexOf('クエスト') == -1 ) {
    return;
  }
  // クエストリスト
  var questlist = [
		['ともだちを招待しよう','ともだちをブラウザ三国志に招待しよう','CP+150'], // mixi
		['友達をブラウザ三国志に招待しよう','ともだちをブラウザ三国志に招待しよう','CP+150'], // Y!モバゲー
		['書簡の使い方','誰かに書簡を送り、返事をもらう','全資源+300'],
		['ケータイ設定','ケータイのメールアドレスを登録','BP+50'],
		['チャージポイント','CPを使って便利機能を使う','CP+100'],
		['倉庫の上限を増やそう　其一','容量5k','全資源+500'],
		['倉庫の上限を増やそう　其二','容量10k','TP+100'],
		['倉庫の上限を増やそう　其三','容量100k','小麗チケット1枚'],
		['倉庫の上限を増やそう　其四','容量300k','小麗チケット2枚'],
		['倉庫の上限を増やそう　其五','容量500k','大鳳チケット1枚'],
		['週間ランキングを確認しよう','週間ランキングを確認する','BP+50'],
		['個人ランク','自分の個人ランキング順位を入力しよう','BP+50'],
		['同盟ランク','自分の同盟の順位を入力する','全資源+200'],
		['城のレベルアップ','城をLv5にする','木石糧+1000、鉄+3000'],
		['城のレベルアップ　其二','城をLv8にする','木石+5000、鉄糧+3000'],
		['同盟を組む','5人以上の同盟に所属する','BP+100'],
		['同盟員の領地を討伐しよう','同盟員の領地を討伐する','全資源+500'],
		['同盟掲示板に書き込み','同盟掲示板に書き込む','全資源+800'],
		['不可侵条約を活用しよう','不可侵条約を結ぶ','全資源+500'],
		['同盟のレベルアップ','同盟レベルを2にする','全資源+800'],
		['同盟レベルを5まで上げよう','同盟レベルを5にする','全資源+8000'],
		['役職者を任命しよう','役職者の任命','BP+100'],
		['寄付をしよう　其一','「同盟」に3,000の寄付をする','全資源+700'],
		['寄付をしよう　其二','「同盟」に10,000の寄付をする','全資源+1500'],
		['寄付をしよう　其三','「同盟」に50,000の寄付をする','全資源+10000'],
		['同盟に貢献しよう　其一','同盟貢献ポイント1000','TP+10'],
		['同盟に貢献しよう　其二','同盟貢献ポイント3000','TP+20'],
		['同盟に貢献しよう　其三','同盟貢献ポイント6000','TP+50'],
		['同盟に貢献しよう　其四','同盟貢献ポイント1万','TP+100'],
		['同盟に貢献しよう　其五','同盟貢献ポイント3万','TP+150'],
		['同盟に貢献しよう　其六','同盟貢献ポイント6万','TP+200'],
		['同盟に貢献しよう　其七','同盟貢献ポイント10万','シルバーチケット1枚'],
		['同盟に貢献しよう　其八','同盟貢献ポイント30万','TP+500'],
		['同盟上位への道　其一','同盟ポイント4万','BP+300'],
		['同盟上位への道　其二','同盟ポイント8万','BP+500'],
		['同盟上位への道　其三','同盟ポイント16万','BP+700'],
		['同盟上位への道　其四','同盟ポイント40万','BP+1000'],
		['同盟上位への道　其五','同盟ポイント80万','BP+1500'],
		['同盟上位への道　其六','同盟ポイント160万','BP+2000'],
		['同盟上位への道　其七','同盟ポイント400万','BP+2500'],
		['同盟上位への道　其八','同盟ポイント800万','シルバーチケット1枚'],
		['鉄材研究所を建設しよう','鉄材研究所の建設','全資源+1000'],
		['大練兵所を建設しよう','大練兵所の建設','全資源+1000'],
		['石材研究所を建設しよう','石材研究所の建設','全資源+3000'],
		['大兵舎を建設しよう','大兵舎の建設','全資源+3000'],
		['木材研究所を建設しよう','木材研究所の建設','全資源+5000'],
		['大弓兵舎を建設しよう','大弓兵舎の建設','全資源+5000'],
		['食糧研究所を建設しよう','食糧研究所の建設','全資源+7000'],
		['大厩舎を建設しよう','大厩舎の建設','全資源+7000'],
		['大兵器工房を建設しよう','大兵器工房の建設','全資源+10000'],
		['生産力の強化','本拠地に「畑」「伐採所」「石切り場」「製鉄所」のLv3を3つずつ建設','全資源+1000'],
		['生産施設を増やそう','本拠地に「畑」「伐採所」「石切り場」「製鉄所」を3つずつ建設','全資源+300'],
		['生産力の強化　其の二','本拠地に「畑」「伐採所」「石切り場」「製鉄所」のLv4を建設','名声+1'],
		['木収入強化','木の生産量（基本値）を500以上にする','石鉄糧+1500'],
		['石収入強化','石の生産量（基本値）を500以上にする','木鉄糧+1500'],
		['鉄収入強化','鉄の生産量（基本値）を500以上にする','木石糧+1500'],
		['木収入強化　其二','木の生産量（基本値)を1000以上にする','石鉄糧+3000'],
		['石収入強化　其二','石の生産量（基本値)を1000以上にする','木鉄糧+3000'],
		['鉄収入強化　其二','鉄の生産量（基本値)を1000以上にする','木石糧+3000'],
		['武将のレベルアップ　其二','武将をLv3にする','全資源+800'],
		['武将のレベルアップ　其三','2人の武将をLv4にする','BP+100'],
		['武将のレベルアップ　其四','3人の武将をLv5にする','BP+150'],
		['武将のレベルアップ　其五','武将をLv10にする','名声+1'],　//ac22
		['武将のレベルアップ　其六','武将をレベルを20にする','BP+160'],　//ac22
		['武将のレベルアップ　其七','武将のLVを30にする','BP+200'],
		['武将のレベルアップ　其八','武将のLVを40にする','BP+250'],
		['防御武将を鍛えよう　其一','防御に50ポイント振る','BP+50'],
		['内政武将を鍛えよう　其一','武将の知力に50ポイント振る','BP+50'],
		['移動速度を鍛えよう　其一','武将の移動速度を50ポイント上げる','BP+50'],
		['武将デュエルにエントリーしよう','ブショーデュエルにエントリーする','BP+20'],
		['カード合成','武将カード合成','TP+10'],
		['修行合成してみよう','修行合成','TP+50'],
		['同一スキルでレベルアップ合成しよう','同一スキル所持カード2枚でスキルレベルアップ合成をする','TP+40'],
		['スキルの習得','武将にスキルを2つ持たせよう','TP+40'],
		['スキルの習得　其二','武将にスキルを3つ持たせよう','TP+100'],
		['トレードに出品しよう','トレードで出品する','TP+20'],
		['スキルレベル','武将にLV4以上のスキルを持たせよう','全資源+1500'],
		['スキルレベル　其二','武将にLV6以上のスキルを持たせよう','TP+100'],
		['スキルレベル　其三','一人の武将に二つ以上の「スキル」を持たせて、二つの「スキル」をそれぞれレベル５に上げる','TP+26'],
		['幻のスキルを探せ','奇計百出を持つ武将を配下に加えよう','全資源+2000'],
		['幻のスキルを探せ　其二','八卦の陣を持つ武将を配下に加えよう','名声+1'],
		['幻のスキルを探せ　其三','一騎当千を持つ武将を配下に加えよう','名声+1'],
		['幻のスキルを探せ　其四','神速を持つ武将を配下に加えよう','名声+1'],
		['領地のレベルアップ','領地のレベルを上げよう','名声+1'],
		['領地の取得　其一','☆☆以上の空き地を領地にする','全資源+1000'],
		['領地の取得　其二','☆☆☆以上の空き地を領地にする','全資源+1500'],　//ac22
		['領地の取得　其三','☆☆☆☆以上の空き地を領地にする','全資源+2500'],　//ac22
		['領地の取得　其四','☆☆☆☆☆以上の空き地を領地にする','全資源+4000'],//ac22
		['領地の取得　其伍','☆☆☆☆☆☆以上の空き地を領地にする','全資源+5000'],//ac22
//		['領地の取得　其六','☆☆☆☆☆☆☆以上の土地を領地にする','全資源+5000'],//ac22
		['槍兵の研究','槍兵の研究を開始する','木鉄糧+1000、石+2500'],
		['弓兵の研究','弓兵の研究を開始する','石鉄糧+1000、木+2500'],
		['騎兵の研究','騎兵の研究を開始する','木石糧+1000、鉄+2500'],
		['斥候の研究','斥候の研究を開始する','木石鉄+2000、糧+1000'],
		['衝車の研究','衝車の研究を開始する','木石鉄+8000、糧+4000'],
		['斥候騎兵の研究','研究所で斥候騎兵を研究する','BP+180'],
		['矛槍兵の研究','研究所で矛槍兵の研究をする','名声+1'],
		['弩兵の研究','研究所で弩兵の研究をする','名声+1'],
		['近衛騎兵の研究','研究所で近衛騎兵の研究をする','名声+1'],
		['投石機の研究','研究所で投石機の研究をする','名声+1'],
		['人口を増やそう','人口を50以上にする','BP+50'],
		['人口を増やそう　其二','人口を100以上にする','全資源+1000'],
		['人口を増やそう　其三','人口を250以上にする','全資源+2000'],
		['人口を増やそう　其四','人口を600以上にする','全資源+3000'],
		['人口を増やそう　其五','人口を1000以上にする','全資源+5000'],
		['人口を増やそう　其六','人口を2000以上にする','名声+1'],
		['人口を増やそう　其七','人口を3000以上にする','全資源+10000'],
		['人口を増やそう　其八','人口を5000以上にする','全資源+25000'],
		['人口を増やそう　其九','人口を8000以上にする','全資源+40000'],
		['一戦入魂（新米）','撃破スコアを100以上にしよう','BP+80'],
		['一戦入魂（隊士）','撃破スコアを500以上にしよう','TP+50'],
		['一戦入魂（隊長）','撃破スコアを1000以上にしよう','全資源+4000'],
		['一戦入魂（大将）','撃破スコアを3000以上にしよう','全資源+10000'],
		['一戦入魂（名将）','撃破スコアを10000以上にしよう','全資源+30000'],
		['一戦入魂（覇王）','撃破スコアを30000以上にしよう','名声+3'],
		['鍛冶場で強化','鍛冶場で武器を強化する','全資源+1000'],
		['防具工場で強化','防具工場で防具を強化する','全資源+1200'],
		['拠点をつくれ！','拠点をつくる','木石鉄+1500、糧+1000'],
		['拠点をつくれ！　其二','3つ目の拠点をつくる','TP+250'],　//ac22
		['拠点をつくれ！　其三','5つ目の拠点をつくる','TP+300'],　//ac22
		['拠点をつくれ！　其四','7つ目の拠点をつくる','TP+500'],　//ac22
		['拠点をつくれ！　其五','9つ目の拠点をつくる','TP+700'],　//ac22
		['拠点に名前を付けよう','拠点の名前を変更しよう','TP+33'],
		['拠点に武将をセットしよう','武将を拠点にセットする','BP+50'],
		['施設のいろは','拠点に施設を建設する','CP+100'],
		['同盟員とNPC砦を落とせ','NPC砦を占領する','名声+2'],
		['世界の覇権','敵対勢力がいる座標を報告','名声+1'],
		['難関砦を攻略せよ','★６つ以上のNPC砦を攻略しよう','全資源+30000'],
		['天下統一の足がかり','★８つ以上のNPC城を攻略しよう','全資源+50000'] ];

/*faraway120126 start
  var questlist = [
		['ともだちを招待しよう','ともだちをブラウザ三国志に招待しよう','CP+150'], // mixi
		['友達をブラウザ三国志に招待しよう','ともだちをブラウザ三国志に招待しよう','CP+150'], // Y!モバゲー
		['同盟を組む','5人以上の同盟に所属する','BP+100'],
		['人口を増やそう','人口を50以上にする','BP+50'],
		['生産力の強化','本拠地に「畑」「伐採所」「石切り場」「製鉄所」のLv3を3つずつ建設','全資源+1000'],
		['生産施設を増やそう','本拠地に「畑」「伐採所」「石切り場」「製鉄所」を3つずつ建設','全資源+300'],
		['書簡の使い方','誰かに書簡を送り、返事をもらう','全資源+300'],
		['ケータイ設定','ケータイのメールアドレスを登録','BP+50'],
		['武将のレベルアップ　其二','武将をLv3にする','全資源+800'],
		['領地の取得　其一','空き地を領地にする','全資源+1000'],
		['領地の取得　其二','☆☆以上の空き地を領地にする','全資源+1000'],
		['槍兵の研究','槍兵の研究を開始する','木鉄糧+1000、石+2500'],
		['弓兵の研究','弓兵の研究を開始する','石鉄糧+1000、木+2500'],
		['騎兵の研究','騎兵の研究を開始する','木石糧+1000、鉄+2500'],
		['生産力の強化　其の二','本拠地に「畑」「伐採所」「石切り場」「製鉄所」のLv4を建設','名声+1'],
		['カード合成','武将カード合成','TP+10'],
		['人口を増やそう　其二','人口を100以上にする','全資源+1000'],
		['一戦入魂（新米）','撃破スコアを100以上にしよう','BP+80'],
		['寄付をしよう　其一','「同盟」に3,000の寄付をする','全資源+700'],
		['鍛冶場で強化','鍛冶場で武器を強化する','全資源+1000'],
		['防具工場で強化','防具工場で防具を強化する','全資源+1200'],
		['武将のレベルアップ　其三','2人の武将をLv4にする','BP+100'],
		['領地のレベルアップ','領地のレベルを上げよう','名声+1'],
		['武将デュエルにエントリーしよう','ブショーデュエルにエントリーする','BP+20'],
		['スキルの習得','武将にスキルを2つ持たせよう','TP+40'],
		['同盟員の領地を討伐しよう','同盟員の領地を討伐する','全資源+500'],
		['同盟掲示板に書き込み','同盟掲示板に書き込む','全資源+800'],
		['同一スキルでレベルアップ合成しよう','同一スキル所持カード2枚でスキルレベルアップ合成をする','TP+40'],
		['不可侵条約を活用しよう','不可侵条約を結ぶ','全資源+500'],
		['領地の取得　其三','☆☆☆以上の空き地を領地にする','全資源+1500'],
		['木収入強化','木の生産量（基本値）を500以上にする','石鉄糧+1500'],
		['石収入強化','石の生産量（基本値）を500以上にする','木鉄糧+1500'],
		['鉄収入強化','鉄の生産量（基本値）を500以上にする','木石糧+1500'],
		['トレードに出品しよう','トレードで出品する','TP+20'],
		['人口を増やそう　其三','人口を250以上にする','全資源+2000'],
		['寄付をしよう　其二','「同盟」に10,000の寄付をする','全資源+1500'],
		['週間ランキングを確認しよう','週間ランキングを確認する','BP+50'],
		['拠点をつくれ！','拠点をつくる','木石鉄+1500、糧+1000'],
		['拠点に名前を付けよう','拠点の名前を変更しよう','TP+33'],
		['拠点に武将をセットしよう','武将を拠点にセットする','BP+50'],
		['武将のレベルアップ　其四','3人の武将をLv5にする','BP+150'],
		['施設のいろは','拠点に施設を建設する','CP+100'],
		['スキルレベル','武将にLV4以上のスキルを持たせよう','全資源+1500'],
		['一戦入魂（隊士）','撃破スコアを500以上にしよう','TP+50'],
		['人口を増やそう　其四','人口を600以上にする','全資源+3000'],
		['個人ランク','自分の個人ランキング順位を入力しよう','BP+50'],
		['同盟ランク','自分の同盟の順位を入力する','全資源+200'],
		['領地の取得　其四','☆☆☆☆以上の空き地を領地にする','全資源+2500'],
		['チャージポイント','CPを使って便利機能を使う','CP+100'],
		['城のレベルアップ','城をLv5にする','木石糧+1000、鉄+3000'],
		['武将レベルアップ　其五','武将をLv10にする','名声+1'],
		['同盟員とNPC砦を落とせ','NPC砦を占領する','名声+2'],
		['寄付をしよう　其三','「同盟」に50,000の寄付をする','全資源+10000'],
		['人口を増やそう　其五','人口を1000以上にする','全資源+5000'],
		['城のレベルアップ　其二','城をLv8にする','木石+5000、鉄糧+3000'],
		['世界の覇権','敵対勢力がいる座標を報告','名声+1'],
		['幻のスキルを探せ','奇計百出を持つ武将を配下に加えよう','全資源+2000'],
		['防御武将を鍛えよう　其一','防御に50ポイント振る','BP+50'],
		['内政武将を鍛えよう　其一','武将の知力に50ポイント振る','BP+50'],
		['移動速度を鍛えよう　其一','武将の移動速度を50ポイント上げる','BP+50'],
		['斥候の研究','斥候の研究を開始する','木石鉄+2000、糧+1000'],
		['木収入強化　其二','木の生産量（基本値)を1000以上にする','石鉄糧+3000'],
		['石収入強化　其二','石の生産量（基本値)を1000以上にする','木鉄糧+3000'],
		['鉄収入強化　其二','鉄の生産量（基本値)を1000以上にする','木石糧+3000'],
		['同盟のレベルアップ','同盟レベルを2にする','全資源+800'],
		['一戦入魂（隊長）','撃破スコアを1000以上にしよう','全資源+4000'],
		['衝車の研究','衝車の研究を開始する','木石鉄+8000、糧+4000'],
		['領地の取得　其伍','☆☆☆☆☆以上の空き地を領地にする','全資源+4000'],
		['武将レベルアップ　其六','武将をレベルを20にする','BP+160'],
		['スキルの習得　其二','武将にスキルを3つ持たせよう','TP+100'],
		['スキルレベル　其二','武将にLV6以上のスキルを持たせよう','TP+100'],
		['人口を増やそう　其六','人口を2000以上にする','名声+1'],
		['斥候騎兵の研究','研究所で斥候騎兵を研究する','BP+180'],
		['一戦入魂（大将）','撃破スコアを3000以上にしよう','全資源+10000'],
		['矛槍兵の研究','研究所で矛槍兵の研究をする','名声+1'],
		['弩兵の研究','研究所で弩兵の研究をする','名声+1'],
		['近衛騎兵の研究','研究所で近衛騎兵の研究をする','名声+1'],
		['領地の取得　其六','☆☆☆☆☆☆以上の土地を領地にする','全資源+5000'],
		['幻のスキルを探せ　其二','八卦の陣を持つ武将を配下に加えよう','名声+1'],
		['スキルレベル　其三','一人の武将に二つ以上の「スキル」を持たせて、二つの「スキル」をそれぞれレベル５に上げる','TP+26'],
		['修行合成してみよう','修行合成をしてみよう','TP+50'],
		['人口を増やそう　其七','人口を3000以上にする','全資源+10000'],
		['幻のスキルを探せ　其三','一騎当千を持つ武将を配下に加えよう','名声+1'],
		['武将のレベルアップ　其七','武将のLVを30にする','BP+200'],
		['幻のスキルを探せ　其四','神速を持つ武将を配下に加えよう','名声+1'],
		['一戦入魂（名将）','撃破スコアを10000以上にしよう','全資源+30000'],
		['人口を増やそう　其八','人口を5000以上にする','全資源+25000'],
		['一戦入魂（覇王）','撃破スコアを30000以上にしよう','名声+3'],
		['投石機の研究','研究所で投石機の研究をする','名声+1'],
		['難関砦を攻略せよ','★６つ以上のNPC砦を攻略しよう','全資源+30000'],
		['武将のレベルアップ　其八','武将のLVを40にする','BP+250'],
		['人口を増やそう　其九','人口を8000以上にする','全資源+40000'],
		['天下統一の足がかり','★８つ以上のNPC城を攻略しよう','全資源+50000'],
		['役職者を任命しよう','「役職者」になるか任命されるかです','BP+100'],
		['同盟に貢献しよう　其一','同盟貢献ポイントを1000に','TP+50'],
		['同盟上位への道　其一','同盟ポイントを4万にしよう','BP+300'],
		['同盟レベルを5まで上げよう','同盟レベルを5まで上げよう','全資源+8000'],
		['同盟に貢献しよう　其二','同盟貢献ポイントを3000に','TP+20'],
		['同盟上位への道　其二','同盟ポイントを8万にしよう','BP+500'],
		['鉄材研究所を建設しよう','鉄材研究所の建設','全資源+1000'],
		['大練兵所を建設しよう','大練兵所の建設','全資源+1000'],
		['同盟に貢献しよう　其三','同盟貢献ポイントを6000に','TP+50'],
		['同盟上位への道　其三','同盟ポイントを8万にしよう','BP+700'],
		['石材研究所を建設しよう','	石材研究所の建設','全資源+3000'],
		['大兵舎を建設しよう','大兵舎の建設','全資源+3000'],
		['同盟に貢献しよう　其四','同盟貢献ポイントを1万に','TP+100'],
		['木材研究所を建設しよう','木材研究所の建設','全資源+5000'],
		['同盟上位への道　其四','同盟ポイントを40万にしよう','BP+1000'],
		['大弓兵舎を建設しよう','大弓兵舎の建設','全資源+5000'],
		['同盟に貢献しよう　其五','同盟貢献ポイントを3万に','TP+150'],
		['同盟上位への道　其五','同盟ポイントを80万にしよう','BP+1500'],
		['食糧研究所を建設しよう','食糧研究所の建設','全資源+7000'],
		['大厩舎を建設しよう','大厩舎の建設','全資源+7000'],
		['同盟に貢献しよう　其六','同盟貢献ポイントを6万に','TP+200'],
		['同盟上位への道　其六','同盟ポイントを160万にしよう','BP+2000'],
		['大兵器工房を建設しよう','大兵器工房の建設','全資源+10000'],
		['同盟に貢献しよう　其七','同盟貢献ポイントを10万に','シルバーチケット'],
		['同盟上位への道　其七','同盟ポイントを400万にしよう','BP+2500'],
		['同盟に貢献しよう　其八','同盟貢献ポイントを30万に','TP+500'],
		['同盟上位への道　其八','同盟ポイントを800万にしよう','シルバーチケット'],
		['','',''],
		['','',''],
		['役職者を任命しよう','「役職者」になるか任命されるかです','BP+100' ]]; // mixi
faraway 120126 End*/

    var quests = document.getElementsByTagName('a');
    for (var l=0; l<quests.length; l++) {
      for (var q=0;q<questlist.length; q++) {
        //if (quests[l].innerHTML.indexOf(questlist[q][0])!=-1) {
        if (quests[l].innerHTML == questlist[q][0]) {
//console.log(quests[l].innerHTML +'=='+ questlist[q][0]);
          quests[l].title=questlist[q][1] + '【報酬】' + questlist[q][2];
          var item = houshu(questlist[q]);
          quests[l].innerHTML += '<br />' + item;
          break;
        }
      }
    }

  // 報酬をHTMLに変換する
  // '<img src="http://3gokushi.jp/img/common/ico_stone.gif" />+3000' = this(['xxx','xxx','石+3000']);
  function houshu(list) {
    //return list[2]; // 安定するまでなにもしない
    // 報酬
    var present = [
      {id:'fame',    key:'名声',  icon:'/img/common/ico_fame.gif'},
      {id:'bp',      key:'BP',    icon:'/img/common/icon_bp.gif'},
      {id:'stone',   key:'石',    icon:'/img/common/ico_stone.gif'},
      {id:'wood',    key:'木',    icon:'/img/common/ico_wood.gif'},
      {id:'ingot',   key:'鉄',    icon:'/img/common/ico_ingot.gif'},
      {id:'grain',   key:'糧',    icon:'/img/common/ico_grain.gif'},
      //{id:'all',     key:'全資源',icon:''},
      {id:'tp',      key:'TP',    icon:'/img/common/icon_tp.gif'},
      {id:'cp',      key:'CP',    icon:'/img/common/icon_cp.gif'},
      {id:'st',      key:'シルバーチケット1枚', icon:'/img/busyodas/img_rate_silver_ex.jpg', w:80, h:41},
      {id:'gt',      key:'ゴールドチケット1枚', icon:'/img/busyodas/img_rate_gold_ex.jpg',   w:80, h:41},
      {id:'kt',      key:'小麗チケット1枚',     icon:'/extend_project/ybga/img/busyodas/img_rate_syourei_no.jpg', w:80, h:41},
      {id:'kt2',     key:'小麗チケット2枚',     icon:'/extend_project/ybga/img/busyodas/img_rate_syourei_no.jpg', w:80, h:41},
      {id:'tt',      key:'大鳳チケット1枚',     icon:'/extend_project/ybga/img/busyodas/img_rate_taihoh_no.jpg',   w:80, h:41}
    ];
    var houshutext = list[2];
    houshutext = houshutext.replace('全資源','木石鉄糧');
    for( var i=0; i < present.length; i++ ) {
//      var sv='img.3gokushi.jp';  if(present[i]['id'].match(/kt|dt|tt/)){sv='m33.3gokushi.jp';};//faraway120126
//      var sv='m1.3gokushi.jp';  if(present[i]['id'].match(/kt|dt|tt/)){sv='m1.3gokushi.jp';};//faraway120126 ac22
      if( houshutext.indexOf( present[i]['key'] ) != -1 ) {
        var is; //シルチケ画像が巨大すぎるのでサイズ指定で縮小表示
        if(present[i]['w']){is += ' width="' + present[i]['w'] + '"'};
        if(present[i]['h']){is += ' height="' + present[i]['h'] +'"'};
//faraway120126        var txt = '<img src="http://m1.3gokushi.jp' + present[i]['icon'] + '" />';
//        var txt = '<img src="http://' + sv + present[i]['icon'] + '" ' + is + '/>';
        var txt = '<img src="'+ present[i]['icon'] + '" ' + is + '/>';
        //if( ! present[i]['icon'] ) {
        //  txt = '全資源';
        //}
        houshutext = houshutext.replace(present[i]['key'],txt);
      }
    }
    houshutext = houshutext.replace('、','<br />');
    return houshutext;
  }
//faraway}) ();
}//faraway
//faraway 25.クエスト補助のソース(bro3_quest_display.user.js)終了

//faraway 26.トレードサポートのソース(bro3_trading_support.user.js)開始
//================================================================================
//26.トレードサポート
//================================================================================
function TradeSupport(){
	//alert("26.トレードサポート:"+location.pathname);
    if( location.pathname != "/card/trade_card.php" ) {	//出品する　トレード
        return ;
    }
// ==UserScript==
// @name           bro3_Trading_support
// @namespace      3gokushi-elmore
// @include        http://*.3gokushi.jp/card/trade_card.php*
// ==/UserScript==

/*
 * http://www.otchy.net/20091104/use-jquery-on-greasemonkey/
 * によるjQuery読み込みスニペットを使用しています
 */

(function(d, func) {
   var check = function() {
       if (typeof unsafeWindow.jQuery == 'undefined') return false;
       func(unsafeWindow.jQuery); return true;
   }
   if (check()) return;
   var s = d.createElement('script');
   s.type = 'text/javascript';
   s.src = 'http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js';
   d.getElementsByTagName('head')[0].appendChild(s);
   (function() {
       if (check()) return;
       setTimeout(arguments.callee, 100);
   })();
})(document, function($){
       GM_log("a");
       $("#cardFileList .cardColmn").each(function(index,elem){
               var cardNo = $(".cardno",this).text();
               var controlObj = $(".control",this);
               var cardPriceGetButton = $(document.createElement("span"));
               $(cardPriceGetButton).html("<input type='button' value='即落札調査' />");
               $(controlObj).after(cardPriceGetButton);
               var cardPriceSetText = $(document.createElement("span"));
               cardPriceSetText.text("未調査");
               $(controlObj).after(cardPriceSetText);
               var gourl = "http://" + location.hostname + "/card/trade.php?s=price&o=a&t=no&k="+cardNo+"&p=1";
               cardPriceGetButton.click(function(){
                       $(cardPriceSetText).text("調査中");
                       $.ajax({
                               url: gourl,
                               success: function(msg,textStatus){

                                       lastPageStr=$(".pager .last a:last",msg).attr("href");
                                       if(lastPageStr != null){
                                               var lastpage = lastPageStr.match("p=([0-9]+)")
                                               //GM_log(lastpage[1]);
                                               var maxpage = lastpage[1];
                                       }else{
                                               var maxpage = 1;
                                       }
                                       var nowpage =0;
                                       //$(cardPriceSetText).text("取得中…" + nowpage + "ページ／"+maxpage+"ページ");
                                       setTimeout(getCardTrade,0);

                                       function getCardTrade(){

                                               if (nowpage < 0) {
                                                       return;
                                               }
                                               nowpage++;
                                               var geturl = "http://" + location.hostname + "/card/trade.php?s=price&o=a&t=no&k="+cardNo+"&p=" + nowpage;
                                               $(cardPriceSetText).text("取得中…" + nowpage + "ページ／"+maxpage+"ページ");
                                               $.ajax({
                                                       url: geturl,
                                                   success: function(msg, textStatus){
                                                       var findJustCard = 0;
                                                       var minTP = 999999;
                                                       var strTP = "";
                                                       var TP = -1;
                                                               $(".tradeTables tr:nth-child(n+2)",msg).each(function(index,elem){
                                                                       GM_log("index=" + index);
                                                                       limit = $(".limit",this).text();
                                                                       strTP = $("strong",this).text();
                                                                       strTP=strTP.replace(",","");
                                                                       TP = Number(strTP);

                                                                       if(limit === "---"){
                                                                               GM_log("index=" +index+ " TP=" +TP);
                                                                               if(TP < minTP){
                                                                                       minTP = TP;
                                                                               }
                                                                               $(cardPriceSetText).text("完了：" + minTP +"TP");
                                                                               $(cardPriceSetText).attr("style","color:#0000CC");

                                                                               findJustCard = 1;

                                                                       }else{

                                                                       }
                                                               });
                                                               if(findJustCard === 1){
                                                                       return 0;
                                                               }
                                                               if(nowpage < maxpage){
                                                                       window.setTimeout(getCardTrade, 0);
                                                               }else{
                                                                       $(cardPriceSetText).text("即落札なし");
                                                               }
                                                       }
                                               });

                                       }
                               }
                       });
               });
               //cardPriceGetButton.click(function(){の終わり

               var cardPutOnShowinp = $("<input>").val("999998").attr("size","10");
               var cardPutOnShowButton = $(document.createElement("span"));
               $(cardPutOnShowButton).html("<input type='button' value='出品する' />");
               $(cardPriceGetButton).after(cardPutOnShowinp);
               $(cardPriceGetButton).after(cardPutOnShowButton);
               $(cardPriceGetButton).after($(document.createElement("div")));
               var cardColmnObj = this;

               cardPutOnShowButton.click(function(){
                       var uniqCardIDStr=$(".control",cardColmnObj).html();
                       GM_log("uniqCardIDStr=" + uniqCardIDStr);
                       var uniqCardIDrex = uniqCardIDStr.match(/go_exhibit_confirm\((\d+)[,\)]/);
                       GM_log(uniqCardIDrex[1]);
                       var uniqCardID = uniqCardIDrex[1];
                       var ssidval = getCookie("SSID");
                       var gourl = "http://" + location.hostname + "/card/exhibit_confirm.php#ptop";
                       var CardPutOnShowPrice = $(cardPutOnShowinp).val();
                       GM_log("出品価格="+CardPutOnShowPrice);
                       cardPutOnShowinp.remove();
                       var cardPutOnShowStatsText = $(document.createElement("span")).text("出品中");
                       $(cardPutOnShowButton).after(cardPutOnShowStatsText);
                       $.post(gourl, {
                               ssid: ssidval,
                               exhibit_cid: uniqCardID,
                               exhibit_price: CardPutOnShowPrice,
                               exhibit_btn: "出品する"
                       }, function(data,textStatus){
                               //GM_log("出品成功");
                               //GM_log(data);
                               PutOnShowStr = $('.notice',data).text();
                               GM_log(PutOnShowStr);
                               if(PutOnShowStr.indexOf("カードを出品しました") > 0){
                                       $(cardPutOnShowStatsText).text("出品成功").attr("style","color:#0000CC");
                               }else{
                                       $(cardPutOnShowStatsText).text("出品満杯").attr("style","color:#CC0000");
                               }
                       });
               });
       });
       //$("#cardFileList .cardColmn").each(function(index,elem){の終わり
});
}//faraway
//faraway 26.トレードサポートのソース(bro3_trading_support.user.js)終了

//faraway 27.トレードスコア単価計算のソース(bro3_score_price.user.js)開始
//================================================================================
//27.トレードスコア単価計算
//================================================================================
function TradeScore(){
	//alert("27.トレードスコア単価計算:"+location.pathname);
// ==UserScript==
// @name           bro3_score_price
// @namespace      http://359.blog-sim.com/
// @include        http://*.3gokushi.jp/*
// @description    ブラウザ三国志　スコア単価計算
// ==/UserScript==

//faraway(function() {
	BRO3_SCORE_init();
//faraway})();
}//faraway
function BRO3_SCORE_init() {
	//拠点座標の登録
	if (location.pathname.match("/card/trade.php")) {
		BRO3_SCORE_view();
	}
}

function BRO3_SCORE_view() {
	var txt = document.body.innerHTML;
	var matched = txt.match(/<td class="right">[0-9]*<\/td>\r?\n?[\t\s]*?<td class="right"><strong>[0-9,]*?<\/strong><\/td>/g);

	if (!matched) {
		return;
	}

	var len = matched.length;


	if (len) {
		for (var i = 0; i < len; i++) {
			matched[i].match(/<td class="right">([0-9]*)<\/td>\r?\n?[\t\s]*?<td class="right"><strong>([0-9,]*?)<\/strong><\/td>/);
			var score = parseInt(RegExp.$1);
			var price = parseInt(RegExp.$2.replace(",", ""));


			var a = parseInt(score / price);

			var change_txt = '<td class="right"><strong>' + RegExp.$2 + '<\/strong><\/td>';
			var reg = new RegExp(change_txt);

			txt = txt.replace(reg, '<td class="right"><strong>' + RegExp.$2 + '</strong><br /><strong>' + a + '</strong><\/td>');

		}
		document.body.innerHTML = txt;
	}
}
//faraway 27.トレードスコア単価計算のソース(bro3_score_price.user.js)終了

//faraway 28.トレードカードＩＤ表示のソース(bro3_tradecardidview.user.js)開始
//================================================================================
//28.トレードカードＩＤ表示
//================================================================================
function TradeCardID(){
	//alert("28.トレードカードＩＤ表示:"+location.pathname);
    if( location.pathname != "/card/trade.php" ) {				//トレード
	    if( location.pathname != "/card/exhibit_list.php" ) {	//出品中のカード
    		if( location.pathname != "/card/bid_list.php" ) {	//入札中のカード
        		return ;
	    	}
    	}
    }


// ==UserScript==
// @name           bro3_tradecardidview
// @version        1.00
// @namespace      http://twitter.com/utoutouuto
// @include        http://*.3gokushi.jp/card/trade.php*
// @include        http://*.3gokushi.jp/card/exhibit_list.php*
// @include        http://*.3gokushi.jp/card/bid_list.php*
// @description    ブラウザ三国志：トレード画面でカードＩＤを表示させる
// ==/UserScript==
//----更新履歴----
// ver1.00　2010-08-08：初回作成
//faraway( function(){

// ページ読み込み完了後に本処理開始
window.addEventListener("load", function() { pre_main_28(); }, false);

////////////////////////////////////////////////////////
// ページ読み込み完了後に起動する処理
// トレード一覧画面
// 出品中のカード画面
// 入札中のカード画面
////////////////////////////////////////////////////////
function pre_main_28() {
	showCardIdMain();
}

function showCardIdMain() {
	var IdNodes = $xp_28('//div[starts-with(@id, "cardWindow_")]', d_28);
	
	for (var i = 0, len = IdNodes.snapshotLength; i < len; i++ ) {
		var targetNode = IdNodes.snapshotItem(i);
		var cardId = targetNode.id.match(/[0-9]+/);
		var cardIdEL = d_28.createElement("div");
			cardIdEL.style.paddingTop = "5px";
			cardIdEL.style.fontSize = "12px";
			cardIdEL.innerHTML = "ID:" + cardId;
		targetNode.parentNode.appendChild(cardIdEL);
	}
}
//faraway}) ();
}//faraway
//faraway 28.トレードカードＩＤ表示のソース(bro3_calc_trade_income.user.js)終了

//faraway 29.トレード収入計算のソース(bro3_calc_trade_income.user.js)開始
//================================================================================
//29.トレード収入計算
//================================================================================
function TradeIncome(){
	//faraway alert("29.トレード収入計算:"+location.pathname);

// ==UserScript==
// @name         bro3_calc_trade_income
// @namespace    http://homepage3.nifty.com/Craford/
// @description  ブラウザ三国志 トレード収入計算
// @include      http://*.3gokushi.jp/card/exhibit_list.php*
// ==/UserScript==

// 2011.05.16 create Craford とりあえず実装

// メイン
//faraway(function(){
	// トレード出品画面なら実行
	if (location.pathname == "/card/exhibit_list.php") {
		// 
		calcTradeIncome();
	}

//faraway})();
}	//faraway

// 入札額チェック
function calcTradeIncome() {
	var income = 0;
	var total = 0;
	var count = 0;
	var sum = 0;

	//----------------------//
	// 結果描画エリアの定義 //
	//----------------------//
	var target = "tradeTables";

	// データ描画用
	textArea = document.createElement("td");
	textArea.style.backgroundColor = "lightYellow";
	textArea.style.textAlign = "center";
	textArea.innerHTML = "収入";
	textArea.style.color = "red";

	var obj = $v_29('//tr[@class="tradeSell"]');
	obj.snapshotItem(0).appendChild(textArea);

	var notice = $v_29('//span[@class="notice"]');
	if( notice.snapshotLength > 0 ){
		count = notice.snapshotLength - 1;
		for( var i = 0; i < count; i++ ){
			income = -1;
			if( !isNaN(parseInt(notice.snapshotItem(i).textContent)) ){;
				income = parseInt(notice.snapshotItem(i).textContent);
				sum = sum + parseInt(income);

				if ( isNaN(income) ) {
					income = 0
				}

				var income2 = Math.floor(income*0.1);
				if ( income > 500 ) {
					income2 += Math.floor((income-500)*0.1);
				}
				if ( income > 1000 ) {
					income2 += Math.floor((income-1000)*0.1);
				}
				total = total + (income - income2);
			}

			if( income >= 0 ){
				textArea = document.createElement("td");
				textArea.id = "smallmap";
				textArea.className = "trade";
				textArea.innerHTML = income - income2;
				textArea.style.color = "red";
				textArea.style.fontWeight = "bold";
				notice.snapshotItem(i).parentNode.parentNode.appendChild(textArea);
			}
		}
	}

	var notice = $v_29('//td/a/img[@alt="取消"]');
	if( notice.snapshotLength > 0 ){
		for( var i = 0; i < notice.snapshotLength; i++ ){
			textArea = document.createElement("td");
			textArea.id = "smallmap";
			textArea.className = "trade";
			textArea.innerHTML = "-";
			textArea.style.color = "red";
			textArea.style.fontWeight = "bold";
			notice.snapshotItem(i).parentNode.parentNode.parentNode.appendChild(textArea);
		}
	}

	// データ描画用
	textArea = document.createElement("tr");
	textArea.style.backgroundColor = "lightYellow";
	textArea.style.textAlign = "right";
	textArea.style.border = "solid 1px";
	textArea.className = "trade"
	textArea.style.fontWeight = "bold";
	textArea.innerHTML = "<td colspan='10'/><font color='red'>" + count + "</font>件 収入<font color='red'>" + total + "</font>TP 手数料<font color='red'>" + (sum - total) + "</font>TP";

	var obj = $v_29('//tr[@class="tradeSell"]');
	obj.snapshotItem(0).parentNode.appendChild(textArea);


	return;
}



//faraway 29.トレード収入計算のソース(bro3_calc_trade_income.user.js)終了

//faraway 30.出兵予約のソース(.user.js)開始
//================================================================================
//30.出兵予約
//================================================================================
function Reservation(){
	//alert("30.出兵予約:"+location.pathname);
	if (!location.pathname.match("/facility/")) {	//faraway
   		return ;
    }

// ブラウザ三国志　自動出兵ツール
// 出兵確認画面で、指定時間に「出兵」ボタンを自動クリックする。
//
// 出兵時間を指定する枠を表示　[HH]時[MM]分
// 指定時間になったら出兵ボタンが押される（マウスでクリックしたのと同じ動作をする）。
// そのため、確認画面を開っぱなしにしておく。
// アクセス時間があきすぎるとセッションタイムアウトになってしまう可能性あり。
// 予約時間はサーバー時間ではなくマシン時間
//
// ver0.4　2010-06-05 三国志Byondの競合回避＆出発時刻をコピー出来るように
// ver0.3  2010-05-24 本拠地以外から出兵できるように修正,Google Chromeでも動作を確認
// ver0.2  2010-05-22 秒までの指定に対応
// ver0.1  2010-05-22 新規作成
//
// Released under the GPL license
// 
// --------------------------------------------------------------------
//
// This is a Greasemonkey user script.
//
// To install, you need Greasemonkey: https://addons.mozilla.org/en-US/firefox/addon/748
// Then restart Firefox and revisit this script.
// Under Tools, there will be a new menu item to "Install User Script".
// Accept the default configuration and install.
//
// To uninstall, go to Tools/Manage User Scripts,
// select "Hello World", and click Uninstall.
//
// --------------------------------------------------------------------
// ==UserScript==
// @name          3gokushi autoTroop
// @namespace     3gokushi
// @description   出兵時間を予約・Beyond共存バージョン＠ゆきすけ
// @include       http://*.3gokushi.jp/facility/*
// ==/UserScript==



function delate2(){
   if(document.getElementById){
      var obj = document.getElementById("test");
      obj.innerHTML = "";
}}



function addOpenLinkHtml() {
	var container;
	var sidebar = document.evaluate('//*[@id="test"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if (sidebar.snapshotLength == 0) {
		container = document.body;
	} else {
		container = sidebar.snapshotItem(0);
	}

	var linksDiv = document.createElement("div");
	container.appendChild(linksDiv);
	var openLink = document.createElement("a");
	openLink.id = "timerOpenLink";
	openLink.href = "javascript:void(0);";
	openLink.innerHTML = "<span style=\"color: #0099CC;\">出発時刻をコピー</span><img src=\"/20091126-01/img/common/icon_link.gif\" id=\"test2\" style=\"cursor:pointer;\">";
	openLink.addEventListener("click", function() {displayTroop()}, true);
	linksDiv.appendChild(openLink);
	
}

executeTroop = function()
{
    var btn = window.document.getElementById("btn_send");
    btn.click();
}



displayTroop = function()
{
delate2();
    var obj = window.document.getElementById("test");
    var num = null;
    
    if(document.getElementById("beyond_send_time").firstChild){
var tt 	= document.getElementById("beyond_send_time").firstChild.nodeValue;
	
	var day2 = eval(tt.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/));
	if( !day2 ) return ;


    var html = "";

    html += '<strong>【出兵予約】</strong> ';
    html += '<select id="autoTroop_HH"><option value="">' + day2[4];
    html += '</option>';
   for ( var i=0; i < 24; i++) {
        html += '<option value="' + i + '">' + i +'</option>';
    }
    html += '</select>';
    html += '時';
    html += '<select id="autoTroop_MM"><option value="">' + day2[5];
    html += '</option>';
    for ( var i=0; i < 60; i++) {
        html += '<option value="' + i + '">' + i +'</option>';
    }
    html += '</select>';
    html += '分';
    // 秒の指定
    html += '<select id="autoTroop_SS"><option value="">' + day2[6];
    html += '</option>';
    for ( var i=0; i < 60; i++) {
        html += '<option value="' + i + '">' + i +'</option>';
    }
    html += '</select>';
    html += '秒';
    html += '<span id="autoTroop_hms" style="">に自動的に出兵ボタンを押します(最終チェック--時--分)</span>';
    obj.innerHTML +=  ''+ html;
    
    	addOpenLinkHtml();

    // 0.5秒間隔でチェックする
    window.setInterval(function(){ checkTroopTime() } , 0.5 * 1000);


    }
    else{
        var html = "";

    html += '<strong>【出兵予約】</strong> ';
    html += '<select id="autoTroop_HH"><option value="">--</option>';
   for ( var i=0; i < 24; i++) {
        html += '<option value="' + i + '">' + i +'</option>';
    }
    html += '</select>';
    html += '時';
    html += '<select id="autoTroop_MM"><option value="">--</option>';
    for ( var i=0; i < 60; i++) {
        html += '<option value="' + i + '">' + i +'</option>';
    }
    html += '</select>';
    html += '分';
    // 秒の指定
    html += '<select id="autoTroop_SS"><option value="">--</option>';
    for ( var i=0; i < 60; i++) {
        html += '<option value="' + i + '">' + i +'</option>';
    }
    html += '</select>';
    html += '秒';
    html += '<span id="autoTroop_hms" style="">に自動的に出兵ボタンを押します(最終チェック--時--分)</span>';
    obj.innerHTML +=  ''+ html;
    
        	addOpenLinkHtml();

        // 0.5秒間隔でチェックする
    window.setInterval(function(){ checkTroopTime() } , 0.5 * 1000);

    

}
}





checkTroopTime = function()
{
var tetete = window.document.getElementById("autoTroop_HH").value;

if(document.getElementById("beyond_send_time").firstChild && tetete >= -1){
var tt 	= document.getElementById("beyond_send_time").firstChild.nodeValue;
	
	var day2 = eval(tt.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/));
	if( !day2 ) return ;
    var h = eval(day2[4]);
    var m = eval(day2[5]);
    var s = eval(day2[6]);
    
    var h2 = (h+100).toString().substr(-2);
    var m2 = (m+100).toString().substr(-2);
    var s2 = (s+100).toString().substr(-2);

    
    // 現在時刻取得
    var now = new Date();
    now_h = now.getHours();
    now_m = now.getMinutes();
    now_s = now.getSeconds();
    now_h2 = (now_h+100).toString().substr(-2);
    now_m2 = (now_m+100).toString().substr(-2);
    now_s2 = (now_s+100).toString().substr(-2);
    if ( h == now_h && m == now_m && s <= now_s ) {
        executeTroop();
    }





	}




    var h = eval(window.document.getElementById("autoTroop_HH").value);
    var m = eval(window.document.getElementById("autoTroop_MM").value);
    var s = eval(window.document.getElementById("autoTroop_SS").value);
    
    var h2 = (h+100).toString().substr(-2);
    var m2 = (m+100).toString().substr(-2);
    var s2 = (s+100).toString().substr(-2);

    
    // 現在時刻取得
    var now = new Date();
    now_h = now.getHours();
    now_m = now.getMinutes();
    now_s = now.getSeconds();
    now_h2 = (now_h+100).toString().substr(-2);
    now_m2 = (now_m+100).toString().substr(-2);
    now_s2 = (now_s+100).toString().substr(-2);
    if ( h == now_h && m == now_m && s <= now_s ) {
        executeTroop();
    }
    
    
    
     if(document.getElementById("beyond_send_time").firstChild){
var tt 	= document.getElementById("beyond_send_time").firstChild.nodeValue;
	
	var day2 = tt.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
	if( !day2 ) return ;
	
	    var toh = (day2[4] * 60 * 60) + (day2[5] * 60) + (day2[6]*1);
    var nowh = (now_h * 60 * 60) + (now_m * 60) + now_s; 
	var sasihiki = (toh - nowh);
		if((toh - nowh)>10800){
		var html3 = "3jigann"
    	if ( h != "--" && m != "--" && s != "--") {

		    var obj = window.document.getElementById("autoTroop_hms");
        obj.innerHTML = "に自動的に出兵ボタンを押します(最終チェック" + now_h + "時" + now_m + "分)<br><span style=\"color: #CC0000;\">注意!!3時間を越えています</span>";
}
		}



    else{
    var obj = window.document.getElementById("autoTroop_hms");
    	if ( h != "--" && m != "--" && s != "--") {
        obj.innerHTML = "に自動的に出兵ボタンを押します(最終チェック" + now_h + "時" + now_m + "分)";
    	}
			}


	}
    
    
    
    
    
}

var title = window.document.title;
    var obj2 = window.document.getElementById("gray02Wrapper");

if ( title.indexOf("出兵(確認) - ブラウザ三国志") != -1 ) 
{

    var html2 = "";
    html2 += "<div id=\"test\" style=\"text-align:center;  border:3px #000 solid;padding:6px;-moz-border-radius: 10px;-webkit-border-radius: 10px;border-radius: 10px;\">";
   html2 += "</div>";
var newObj = document.createElement("p");
newObj.innerHTML = html2;
obj2.parentNode.insertBefore(newObj, obj2.nextSibling); 



    	addOpenLinkHtml();
    
	// 表示切り替え



	window.setTimeout(function() { displayTroop();}, 3000);
	


  
} 


else {
  // 出兵確認画面でなければ何もしない
}



}
//faraway 30.出兵予約のソース(.user.js)終了

//faraway 31.自動巡回のソース(bro3_auto_map_move.user.js)開始
//================================================================================
//31.自動巡回
//================================================================================
function AutoRound(){
	//faraway alert("31.自動巡回:"+location.pathname);
    if( location.pathname != "/map.php" ) {	//全体地図 //faraway
   		return ;
    }

// ==UserScript==
// @name         bro3_Auto_Map_Move
// @namespace    http://at-n2.net/
// @description  ブラウザ三国志自動マップ移動 By nottisan
// @include      http://*.3gokushi.jp/map.php*
// @include      http://*.1kibaku.jp/*
// ==/UserScript==

// 浮浪プログラマ 様のスクリプトを参考に作成させて頂きました。
// http://blog.livedoor.jp/froo/
// 使い方: 開始＆終了に数値を入れて開始を押すだけ。

//Main
//faraway(function(){
	addOpenLinkHtml_31();
	var host = location.hostname;
	var Move_Flg = GM_getValue(host + "Move_Flg", false);
	if (Move_Flg) {
		openMoveBox();
		MoveCheck();
	}
//faraway})();
}	//faraway
function MoveCheck() {
	var host = location.hostname;
	var Move_Flg = GM_getValue(host + "Move_Flg", false);
	st_x = document.getElementById("st_x").value;
	st_y = document.getElementById("st_y").value;
	en_x = document.getElementById("en_x").value;
	en_y = document.getElementById("en_y").value;
	//alert(Move_Flg);
	GM_log("MoveCheck() MoveFlg = " + Move_Flg);
	GM_log("MoveCheck() x = " + document.getElementById("x").value);
	GM_log("MoveCheck() y = " + document.getElementById("y").value);
	if (Move_Flg) {
		var cntdown=0;
		CENTER_X_31 = parseInt(document.getElementById("x").value) -MOVE_CNT;
		if (isNaN(CENTER_X_31)) CENTER_X_31 = 0;
		var temp_x = CENTER_X_31;
		if (CENTER_X_31 < en_x) {
			CENTER_X_31 = st_x;
			cntdown=MOVE_CNT;
		}
		CENTER_Y_31 = parseInt(document.getElementById("y").value) -cntdown;
		if (isNaN(CENTER_Y_31)) CENTER_Y_31 = 0;
		if (temp_x < en_x) {
		if (CENTER_Y_31 < en_y) {
			GM_setValue(host + "Move_Flg", false);
			deleteMoveHtml();
			GM_log("MoveCheck() END x=" + temp_x + "  y=" + CENTER_Y_31);
			
			//移動開始位置に戻る
			CENTER_X_31 = GM_getValue(host + "now_x", "0");
			CENTER_Y_31 = GM_getValue(host + "now_y", "0");
			var tid=setTimeout(function(){location.href = getMapUrl_31(CENTER_X_31,CENTER_Y_31);},INTERVAL_31);
			return;
		}}

		GM_log("MoveCheck() x = " + document.getElementById("x").value);
		GM_log("MoveCheck() y = " + document.getElementById("y").value);
		var tid=setTimeout(function(){location.href = getMapUrl_31(CENTER_X_31,CENTER_Y_31);},INTERVAL_31);
	}
}

//リンクHTML追加
function addOpenLinkHtml_31() {
	var sidebar = document.evaluate('//*[@id="status"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if (sidebar.snapshotLength == 0) return;
	
	//自動移動リンク
	var openLink = document.createElement("a");
	openLink.id = "AutoMoveLink";
	openLink.href = "javascript:void(0);";
	openLink.innerHTML = "自動移動<br>";
	openLink.addEventListener("click", function() {openMoveBox()}, true);
	sidebar.snapshotItem(0).appendChild(openLink);
}
//移動開始
function MoveStart() {
	var host = location.hostname;

	//移動フラグの設定
	GM_setValue(host + "Move_Flg", true);
	
	//移動開始位置の設定
	GM_setValue(host + "Start_x", document.getElementById("st_x").value);
	GM_setValue(host + "Start_y", document.getElementById("st_y").value);
	GM_setValue(host + "End_x", document.getElementById("en_x").value);
	GM_setValue(host + "End_y", document.getElementById("en_y").value);
	GM_setValue(host + "now_x", document.getElementById("x").value);
	GM_setValue(host + "now_y", document.getElementById("y").value);
	
	location.href = getMapUrl_31(document.getElementById("st_x").value, document.getElementById("st_y").value);
}

//地図画面URL取得
function getMapUrl_31(x, y) {
	return "/map.php?x=" + x + "&y=" + y + "&type=" + MAPSIZE;
}

//移動表示を開く
function openMoveBox() {
	closeMoveBox();
	addMoveHtml(false);
}
//移動終了
function MoveEnd() {
	var host = location.hostname;
	GM_setValue(host + "Move_Flg", false);
}
//移動表示を閉じる
function closeMoveBox() {
	deleteMoveHtml();
}

//移動表示HTML削除
function deleteMoveHtml() {
	var elem = document.getElementById("MoveContainer");
	if (elem == undefined) return;
	document.body.removeChild(document.getElementById("MoveContainer"));
}

//お気に入りの表示＆非表示
function FavoriteLink(Favorite_Flg){
	if (Favorite_Flg == true){
		closeMoveBox();
		addMoveHtml(true);
	}else{
		closeMoveBox();
		addMoveHtml(false);
	}
}

//お気に入りの保存
function FavoriteSave(btn_cnt){
	var host = location.hostname;
	st_x = document.getElementById("st_x").value;
	st_y = document.getElementById("st_y").value;
	en_x = document.getElementById("en_x").value;
	en_y = document.getElementById("en_y").value;
	var name = prompt("7文字以内で名前を入力してください。\n空白は登録されません。\n半角コンマ「,」は入力しないでください。","");
	if (name == "" ||name == undefined) return;
	var saveData = st_x + "," + st_y + "," + en_x + "," + en_y + "," + name;
	GM_setValue(host + "Favorite" + btn_cnt, saveData);
	closeMoveBox();
	addMoveHtml(true);
	alert("保存しました。");
}

//お気に入りの読込み
function FavoriteLoad(btn_cnt){
	var host = location.hostname;
	var LoadData = GM_getValue(host + "Favorite"+ btn_cnt, "0,0,0,0,0");
	var st_x = parseInt(LoadData.split(",")[0]);
	var st_y = parseInt(LoadData.split(",")[1]);
	var en_x = parseInt(LoadData.split(",")[2]);
	var en_y = parseInt(LoadData.split(",")[3]);
	document.getElementById("st_x").value = st_x;
	document.getElementById("st_y").value = st_y;
	document.getElementById("en_x").value = en_x;
	document.getElementById("en_y").value = en_y;

}

//地点お気に入りの保存
function FavoriteMoveSave(btn_cnt){
	var host = location.hostname;
	var st_x = document.getElementById("x").value;
	var st_y = document.getElementById("y").value;
	var name ="";
	name = prompt("7文字以内で名前を入力してください。\n空白は登録されません。","");
	if (name == "" || name == null) return;
	var saveData = name + "@@@" + st_x + "@@@" + st_y;
	GM_setValue(host + "FavoriteMove" + btn_cnt, saveData);
	closeMoveBox();
	addMoveHtml(true);
	alert(name + "の座標を保存しました。")
}

//地点お気に入りの読込み
function FavoriteMoveLoad(btn_cnt){
	var host = location.hostname;
	var LoadData = GM_getValue(host + "FavoriteMove"+ btn_cnt, "Move@@@0@@@0");
	//var st_x = parseInt(LoadData.split("@@@")[0]);　名前
	var x = parseInt(LoadData.split("@@@")[1]);	//ｘ
	var y = parseInt(LoadData.split("@@@")[2]);	//ｙ
	location.href = getMapUrl_31(x, y);
}

//中心からの画面数座標の計算
function map_Calc(){
	//中心位置の取得
	CENTER_X_31 = parseInt(document.getElementById("x").value);
	if (isNaN(CENTER_X_31)) CENTER_X_31 = 0;
	CENTER_Y_31 = parseInt(document.getElementById("y").value);
	if (isNaN(CENTER_Y_31)) CENTER_Y_31 = 0;
	//画面数取得
	var mapCnt = parseInt(document.getElementById("mapCnt").value);
	//移動量の算出
	var moveCnt = parseInt(MOVE_CNT * mapCnt);
	//値のセット
	document.getElementById("st_x").value = CENTER_X_31 + moveCnt;
	document.getElementById("st_y").value = CENTER_Y_31 + moveCnt;
	document.getElementById("en_x").value = CENTER_X_31 - moveCnt;
	document.getElementById("en_y").value = CENTER_Y_31 - moveCnt;
	//画面数の保存
	var host = location.hostname;
	GM_setValue(host + "mapCnt", document.getElementById("mapCnt").value);
}

//移動表示HTML追加
function addMoveHtml(Favorite_Flg) {

	var host = location.hostname;
	var mapCnt = GM_getValue(host + "mapCnt", 1);

	var popupLeft = GM_getValue("popup_leftm", 550);
	var popupTop = GM_getValue("popup_topm", 150);
	if (popupLeft < 0) popupLeft = 0;
	if (popupTop < 0) popupTop = 0;
	
	//表示コンテナ作成
	var MoveContainer = document.createElement("div");
	MoveContainer.id = "MoveContainer";
	MoveContainer.style.position = "absolute";
	MoveContainer.style.backgroundColor = "darkgray";
	MoveContainer.style.border = "outset 2px darkgray";
	MoveContainer.style.left = popupLeft + "px";
	MoveContainer.style.top = popupTop + "px";
	MoveContainer.style.fontSize = "10px";
	MoveContainer.style.padding = "3px";
	MoveContainer.style.zIndex = 999;
	document.body.appendChild(MoveContainer);
	
	//開始リンク
	var confirmLink = document.createElement("a");
	confirmLink.id = "MoveStartLink";
	confirmLink.href = "javascript:void(0);";
	confirmLink.style.margin = "3px";
	confirmLink.innerHTML = "移動開始";
	confirmLink.addEventListener("click", function() {MoveStart()}, true);
	MoveContainer.appendChild(confirmLink);
	
	//移動終了リンク
	var endLink = document.createElement("a");
	endLink.id = "MoveEndLink";
	endLink.href = "javascript:void(0);";
	endLink.style.margin = "3px";
	endLink.innerHTML = "移動終了";
	endLink.addEventListener("click", function() {MoveEnd()}, true);
	MoveContainer.appendChild(endLink);

	//閉じるリンク
	var closeLink = document.createElement("a");
	closeLink.id = "timerCloseLink";
	closeLink.href = "javascript:void(0);";
	closeLink.style.margin = "3px";
	closeLink.innerHTML = "閉じる";
	closeLink.addEventListener("click", function() {closeMoveBox()}, true);
	MoveContainer.appendChild(closeLink);
	
	//バージョン
	var version = document.createElement("span");
	version.style.fontSize = "9px";
	version.style.margin = "3px";
	version.innerHTML = "Ver." + VERSION_31;
	MoveContainer.appendChild(version);
	
	//入力項目の作成
	var table = document.createElement("div");
	table.innerHTML = <>
	<table style="font-size:11px;border: 2px solid #ff8622;margin-top:5px;">
	  <tr>
	    <td id='fld_start' style='padding:3px 4px;'>
	      開始
	    </td>
	    <td id='fld_st_x' style='padding:3px 4px;'>
	      X=<input id='st_x' type='text' style='width:40px' />
	    </td>
	    <td id='fld_st_y' style='padding:3px 4px;'>
	      Y=<input id='st_y' type='text' style='width:40px' />
	    </td>
	  </tr>
	  <tr>
	    <td id='fld_end' style='padding:3px 4px;'>
	      終了
	    </td>
	    <td id='fld_en_x' style='padding:3px 4px;'>
	      X=<input id='en_x' type='text' style='width:40px' />
	    </td>
	    <td id='fld_en_y' style='padding:3px 4px;'>
	      Y=<input id='en_y' type='text' style='width:40px' />
	    </td>
	  </tr>
	</table>
	<table id='tbl_mapCnt' style="font-size:11px;margin-bottom:5px;">
	  <tr>
    	    <td id='fld_mapCnt' style='padding:3px 4px;border: 2px solid #ff8622;'>
    	      画面数=<input id='mapCnt' type='text' style='width:20px' />
	    </td>
   	    <td id='fld_calc_' style='padding:3px 4px;border: 2px solid #ff8622;'>
    	      <input id='btn_Calc' type='button' style='width:40px' value='計算' />
	    </td>
	  </tr>
	</table>
	</>;
	MoveContainer.appendChild(table);

	//お気に入りリンク
	var Favorite = document.createElement("a");
	Favorite.id = "FavoriteLink";
	Favorite.href = "javascript:void(0);";
	Favorite.style.margin = "3px";
	Favorite.innerHTML = "座標のお気に入り";
	if (Favorite_Flg == true){
		Favorite.addEventListener("click", function() {FavoriteLink(false);}, true);
	}else{
		Favorite.addEventListener("click", function() {FavoriteLink(true);}, true);
	}
	MoveContainer.appendChild(Favorite);

	document.getElementById("mapCnt").value = mapCnt;
	//計算ボタンのイベント登録
	document.getElementById('btn_Calc').addEventListener("click",function() { map_Calc(); }, true);

	if (Favorite_Flg == true){
		var table = document.createElement("div");
		table.innerHTML = <>
		<table id='tbl_Favorite' style="font-size:11px;">
		  <tr>
		    <td id='fld_Save1' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_Save1' type='button' style='width:40px' value='Save' /><input id='btn_Load1' type='button' style='width:80px' value='Load'/>
		    </td>
		    <td id='fld_Save2' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_Save2' type='button' style='width:40px' value='Save' /><input id='btn_Load2' type='button' style='width:80px' value='Load'/>
		    </td>
		  </tr>
		  <tr>
		    <td id='fld_Save3' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_Save3' type='button' style='width:40px' value='Save' /><input id='btn_Load3' type='button' style='width:80px' value='Load'/>
		    </td>
		    <td id='fld_Save4' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_Save4' type='button' style='width:40px' value='Save' /><input id='btn_Load4' type='button' style='width:80px' value='Load'/>
		    </td>
		  </tr>
		  <tr>
		    <td id='fld_Save5' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_Save5' type='button' style='width:40px' value='Save' /><input id='btn_Load5' type='button' style='width:80px' value='Load'/>
		    </td>
		    <td id='fld_Save6' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_Save6' type='button' style='width:40px' value='Save' /><input id='btn_Load6' type='button' style='width:80px' value='Load'/>
		    </td>
		  </tr>
		  <tr>
		    <td id='fld_Save7' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_Save7' type='button' style='width:40px' value='Save' /><input id='btn_Load7' type='button' style='width:80px' value='Load'/>
		    </td>
		    <td id='fld_Save8' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_Save8' type='button' style='width:40px' value='Save' /><input id='btn_Load8' type='button' style='width:80px' value='Load'/>
		    </td>
		  </tr>
		</table><br />
		<font Color="blue">お気に入り地点♪</font>
		<table id='tbl_MoveFavorite' style="font-size:11px;">
		  <tr>
		    <td id='fld_MoveSave1' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave1' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad1' type='button' style='width:80px' value='Move'/>
		    </td>
		    <td id='fld_MoveSave2' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave2' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad2' type='button' style='width:80px' value='Move'/>
		    </td>
		  </tr>
		  <tr>
		    <td id='fld_MoveSave3' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave3' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad3' type='button' style='width:80px' value='Move'/>
		    </td>
		    <td id='fld_MoveSave4' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave4' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad4' type='button' style='width:80px' value='Move'/>
		    </td>
		  </tr>
		  <tr>
		    <td id='fld_MoveSave5' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave5' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad5' type='button' style='width:80px' value='Move'/>
		    </td>
		    <td id='fld_MoveSave6' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave6' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad6' type='button' style='width:80px' value='Move'/>
		    </td>
		  </tr>
		  <tr>
		    <td id='fld_MoveSave7' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave7' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad7' type='button' style='width:80px' value='Move'/>
		    </td>
		    <td id='fld_MoveSave8' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave8' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad8' type='button' style='width:80px' value='Move'/>
		    </td>
		  </tr>
		  <tr>
		    <td id='fld_MoveSave9' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave9' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad9' type='button' style='width:80px' value='Move'/>
		    </td>
		    <td id='fld_MoveSave10' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave10' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad10' type='button' style='width:80px' value='Move'/>
		    </td>
		  </tr>
		  <tr>
		    <td id='fld_MoveSave11' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave11' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad11' type='button' style='width:80px' value='Move'/>
		    </td>
		    <td id='fld_MoveSave12' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave12' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad12' type='button' style='width:80px' value='Move'/>
		    </td>
		  </tr>
		  <tr>
		    <td id='fld_MoveSave13' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave13' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad13' type='button' style='width:80px' value='Move'/>
		    </td>
		    <td id='fld_MoveSave14' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave14' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad14' type='button' style='width:80px' value='Move'/>
		    </td>
		  </tr>
		  <tr>
		    <td id='fld_MoveSave15' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave15' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad15' type='button' style='width:80px' value='Move'/>
		    </td>
		    <td id='fld_MoveSave16' style='padding:3px 4px;border: 2px solid #ff8622;'>
		      <input id='btn_MoveSave16' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad16' type='button' style='width:80px' value='Move'/>
		    </td>
		  </tr>
		</table>
		</>;
		MoveContainer.appendChild(table);
		
		//保存ボタンへのイベント登録
		document.getElementById('btn_Save' + 1).addEventListener("click",function() { FavoriteSave(1); }, true);
		document.getElementById('btn_Save' + 2).addEventListener("click",function() { FavoriteSave(2); }, true);
		document.getElementById('btn_Save' + 3).addEventListener("click",function() { FavoriteSave(3); }, true);
		document.getElementById('btn_Save' + 4).addEventListener("click",function() { FavoriteSave(4); }, true);
		document.getElementById('btn_Save' + 5).addEventListener("click",function() { FavoriteSave(5); }, true);
		document.getElementById('btn_Save' + 6).addEventListener("click",function() { FavoriteSave(6); }, true);
		document.getElementById('btn_Save' + 7).addEventListener("click",function() { FavoriteSave(7); }, true);
		document.getElementById('btn_Save' + 8).addEventListener("click",function() { FavoriteSave(8); }, true);
		
		//読込みボタンへのイベント登録
		document.getElementById('btn_Load' + 1).addEventListener("click",function() { FavoriteLoad(1); }, true);
		document.getElementById('btn_Load' + 2).addEventListener("click",function() { FavoriteLoad(2); }, true);
		document.getElementById('btn_Load' + 3).addEventListener("click",function() { FavoriteLoad(3); }, true);
		document.getElementById('btn_Load' + 4).addEventListener("click",function() { FavoriteLoad(4); }, true);
		document.getElementById('btn_Load' + 5).addEventListener("click",function() { FavoriteLoad(5); }, true);
		document.getElementById('btn_Load' + 6).addEventListener("click",function() { FavoriteLoad(6); }, true);
		document.getElementById('btn_Load' + 7).addEventListener("click",function() { FavoriteLoad(7); }, true);
		document.getElementById('btn_Load' + 8).addEventListener("click",function() { FavoriteLoad(8); }, true);
		
		//保存ボタンへのイベント登録
		document.getElementById('btn_MoveSave' + 1).addEventListener("click",function() { FavoriteMoveSave(1); }, true);
		document.getElementById('btn_MoveSave' + 2).addEventListener("click",function() { FavoriteMoveSave(2); }, true);
		document.getElementById('btn_MoveSave' + 3).addEventListener("click",function() { FavoriteMoveSave(3); }, true);
		document.getElementById('btn_MoveSave' + 4).addEventListener("click",function() { FavoriteMoveSave(4); }, true);
		document.getElementById('btn_MoveSave' + 5).addEventListener("click",function() { FavoriteMoveSave(5); }, true);
		document.getElementById('btn_MoveSave' + 6).addEventListener("click",function() { FavoriteMoveSave(6); }, true);
		document.getElementById('btn_MoveSave' + 7).addEventListener("click",function() { FavoriteMoveSave(7); }, true);
		document.getElementById('btn_MoveSave' + 8).addEventListener("click",function() { FavoriteMoveSave(8); }, true);
		document.getElementById('btn_MoveSave' + 9).addEventListener("click",function() { FavoriteMoveSave(9); }, true);
		document.getElementById('btn_MoveSave' + 10).addEventListener("click",function() { FavoriteMoveSave(10); }, true);
		document.getElementById('btn_MoveSave' + 11).addEventListener("click",function() { FavoriteMoveSave(11); }, true);
		document.getElementById('btn_MoveSave' + 12).addEventListener("click",function() { FavoriteMoveSave(12); }, true);
		document.getElementById('btn_MoveSave' + 13).addEventListener("click",function() { FavoriteMoveSave(13); }, true);
		document.getElementById('btn_MoveSave' + 14).addEventListener("click",function() { FavoriteMoveSave(14); }, true);
		document.getElementById('btn_MoveSave' + 15).addEventListener("click",function() { FavoriteMoveSave(15); }, true);
		document.getElementById('btn_MoveSave' + 16).addEventListener("click",function() { FavoriteMoveSave(16); }, true);

		//読込みボタンへのイベント登録
		document.getElementById('btn_MoveLoad' + 1).addEventListener("click",function() { FavoriteMoveLoad(1); }, true);
		document.getElementById('btn_MoveLoad' + 2).addEventListener("click",function() { FavoriteMoveLoad(2); }, true);
		document.getElementById('btn_MoveLoad' + 3).addEventListener("click",function() { FavoriteMoveLoad(3); }, true);
		document.getElementById('btn_MoveLoad' + 4).addEventListener("click",function() { FavoriteMoveLoad(4); }, true);
		document.getElementById('btn_MoveLoad' + 5).addEventListener("click",function() { FavoriteMoveLoad(5); }, true);
		document.getElementById('btn_MoveLoad' + 6).addEventListener("click",function() { FavoriteMoveLoad(6); }, true);
		document.getElementById('btn_MoveLoad' + 7).addEventListener("click",function() { FavoriteMoveLoad(7); }, true);
		document.getElementById('btn_MoveLoad' + 8).addEventListener("click",function() { FavoriteMoveLoad(8); }, true);
		document.getElementById('btn_MoveLoad' + 9).addEventListener("click",function() { FavoriteMoveLoad(9); }, true);
		document.getElementById('btn_MoveLoad' + 10).addEventListener("click",function() { FavoriteMoveLoad(10); }, true);
		document.getElementById('btn_MoveLoad' + 11).addEventListener("click",function() { FavoriteMoveLoad(11); }, true);
		document.getElementById('btn_MoveLoad' + 12).addEventListener("click",function() { FavoriteMoveLoad(12); }, true);
		document.getElementById('btn_MoveLoad' + 13).addEventListener("click",function() { FavoriteMoveLoad(13); }, true);
		document.getElementById('btn_MoveLoad' + 14).addEventListener("click",function() { FavoriteMoveLoad(14); }, true);
		document.getElementById('btn_MoveLoad' + 15).addEventListener("click",function() { FavoriteMoveLoad(15); }, true);
		document.getElementById('btn_MoveLoad' + 16).addEventListener("click",function() { FavoriteMoveLoad(16); }, true);

		for (var i=1; i<=8; i++){
			var LoadData = GM_getValue(host + "Favorite"+ i, "0,0,0,0,Load");
			var name = LoadData.split(",")[4];
			if (name == undefined) name = "Load";
			document.getElementById('btn_Load' + i).value = name;
		}

		for (var i=1; i<=16; i++){
			var LoadData = GM_getValue(host + "FavoriteMove"+ i, "Move@@@0@@@0");
			var name = LoadData.split("@@@")[0];
			document.getElementById('btn_MoveLoad' + i).value = name;
		}


		
	}//Endif

	var host = location.hostname;
	document.getElementById("st_x").value = GM_getValue(host + "Start_x",600);
	document.getElementById("st_y").value = GM_getValue(host + "Start_y",600);
	document.getElementById("en_x").value = GM_getValue(host + "End_x",-600);
	document.getElementById("en_y").value = GM_getValue(host + "End_y",-600);

}

//faraway 31.自動巡回のソース(bro3_auto_map_move.user.js)終了

//faraway 32.報告書・同盟ログCSV出力のソース(.user.js)開始
//================================================================================
//32.報告書・同盟ログCSV出力
//================================================================================
function ReportLog(){
	//alert("32.報告書・同盟ログCSV出力:"+location.pathname);
    if( location.pathname != "/alliance/alliance_log.php" ) {	//faraway111005 範囲指定
	    if( location.pathname != "/report/list.php" ) {
        	return ;
    	}
    }


// ==UserScript==
// @name           bro3_getcsv_for_log
// @version        1.01
// @namespace      http://twitter.com/utoutouuto
// @include        http://*.3gokushi.jp/alliance/alliance_log.php*
// @include        http://*.3gokushi.jp/report/list.php*
// @description    ブラウザ三国志：報告書・同盟ログCSV出力ツール
// ==/UserScript==
//----更新履歴----
// ver1.00　2011-05-12：初回作成
// ver1.01　2011-07-04：座標出力、同一出力回避機能
//faraway( function(){

////////////////////////////////////////////////////////
// 変数定義
////////////////////////////////////////////////////////
var d_32 = document;
var $_32 = unsafeWindow.jQuery;
var $xp_32 = function (xp, dc) { return d_32.evaluate(xp, dc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };
var $xp1_32 = function (xp, dc) { return d_32.evaluate(xp, dc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var location_allianceURL = "/alliance/alliance_log.php";
var location_reportURL = "/report/list.php";
var worldKey_32 = location.hostname;
// 以下、GM変数
var reportIdArray = [];			// キャッシュ済みの報告書ログIDの配列
var allianceIdArray = [];		// キャッシュ済みのログIDの配列

// 各種チェック
if (!pre_check_32()) {
	// 確認用
	//alert("初期チェックでエラー。要ログ確認")
	return;
}
function pre_check_32() {
	if (!worldKey_32) { console.log("ワールドキー取得エラー"); return false; }
	
	var time_checker = new Date().toString();
	GM_setValue(worldKey_32 + "time_checker", time_checker.toSource());
	var res_time_checker = eval(GM_getValue(worldKey_32 + "time_checker", ""));
	if (time_checker != res_time_checker) {
		console.log("GM変数の利用エラー");
		console.log("　：" + time_checker);
		console.log("　：" + res_time_checker);
		return false;
	}
	
	if (!$_32) { console.log("jquery取得エラー"); return false; }
	return true;
}
// GM変数ロード
loadOpValues_32();

// ページ読み込み完了後に本処理開始
window.addEventListener("load", function() { pre_main_32(); }, false);

////////////////////////////////////////////////////////
// ページ読み込み完了後に起動する処理
////////////////////////////////////////////////////////
function pre_main_32() {
	addBtn_32();
}
function addBtn_32() {
	var targetNode = $xp1_32('//ul[@id="statMenu"]', d_32);
	var getInfoBtn = d_32.createElement("input");
		getInfoBtn.type = "button";
		getInfoBtn.id = "getInfoBtn";
		getInfoBtn.value = "【CSV出力】";
		getInfoBtn.addEventListener("click", function() {
			getInfoBtn.disabled = true;
			if (!confirm("ログ情報のCSVデータを出力します。")) { getInfoBtn.disabled = false; return; }
			getLogInfoMain();
		}, false);
	targetNode.appendChild(getInfoBtn);
	var resetLogBtn = d_32.createElement("input");
		resetLogBtn.type = "button";
		resetLogBtn.id = "resetLogBtn";
		resetLogBtn.value = "【リセット】";
		resetLogBtn.addEventListener("click", function() {
			resetLogBtn.disabled = true;
			if (!confirm("既出力情報をリセットします")) { resetLogBtn.disabled = false; return; }
			resetIdCash();
			alert("リセット完了しました。")
		}, false);
	targetNode.appendChild(resetLogBtn);
}

var hrefArray_32 = []; // [[ログID,URL,日時,x座標,y座標,見出し文字列]...]
function getLogInfoMain() {
	var linkNodes = $xp_32('//td[@class="brno"]/a', d_32);
	for (var i = 0, len = linkNodes.snapshotLength; i < len; i++ ) {
		// ログURL
		var href = linkNodes.snapshotItem(i).href;
		if (href == null) { continue; }
		// ログID
		var brno = href.match("id=[0-9]+")[0].split("=")[1];
		if (brno == null) { continue; }
		// すでに出力済みならスキップ
		if (checkIdCash_32(brno)) { continue; }
		// 見出しテキスト
		var text = linkNodes.snapshotItem(i).innerHTML;
		if (text == null) { continue; }
			text = text.replace(/<[^>]*>/g, "");
			text = text.replace(/\t/g, "");
			
		// 親ノード
		var trNode = linkNodes.snapshotItem(i).parentNode.parentNode;
		// 出兵先
		console.log(111);
		var iconNode = $xp1_32('descendant::td[@class="subinfo"]//a', trNode);
		if (iconNode == null) { continue; }
		console.log(222);
		var iconText = iconNode.href;
		var x = iconText.match("x=[0-9]+|x=-[0-9]+")[0].split("=")[1];
		var y = iconText.match("y=[0-9]+|y=-[0-9]+")[0].split("=")[1];
		// 日時
		console.log(333);
		var dateNode = $xp1_32('descendant::td[@class="fs77" or @class="contents center w120 fs85"]', trNode);
		if (dateNode == null) { continue; }
		console.log(444);
		var date = dateNode.innerHTML;
			date = date.replace(/\n/g, "");
		hrefArray_32.push([brno, href, date, x, y, text]);
	}
	if (hrefArray_32.length <= 0) {
		alert("出力対象はありません。");
		return; 
	}
	
	// 実行中表示レイヤー
	var layer = d_32.createElement("div");
		layer.id = "cash_layer";
		layer.style.backgroundColor = "#202020";
		layer.style.position = "fixed";
		layer.style.zIndex = 1;
		layer.style.width = "100%";
		layer.style.height = "100%";
		layer.style.opacity = 0.9;
	var explain = d_32.createElement("div");
		explain.id = "cash_explain";
		explain.style.backgroundColor = "white";
		explain.style.marginTop  = "100px";
		explain.style.padding  = "20px";
		explain.style.width = "100%";
		explain.innerHTML = "<b>ログ出力実行中</b>　　" + 1 + "/" + hrefArray_32.length;
		layer.appendChild(explain);
	var targetNode = $xp1_32('//body', d_32);
		targetNode.insertBefore(layer, targetNode.firstChild);
	loadPage_32(0);
}
// loadNoにより同期処理させる
function loadPage_32(loadNo) {
	var opt = {
		method: 'get',
		url: hrefArray_32[loadNo][1],
		onload: function(res) {
			getLogInfo(loadNo, res);
		}
	};
	GM_xmlhttpRequest(opt); 
}
var copyTxt = "";
function getLogInfo(loadNo, res) {
	var brno = hrefArray_32[loadNo][0];
	var date = hrefArray_32[loadNo][2];
	var x = hrefArray_32[loadNo][3];
	var y = hrefArray_32[loadNo][4];
	var text = hrefArray_32[loadNo][5];
	
	var fillterEL = d_32.createElement('div');
		fillterEL.innerHTML = res.responseText;
	
	var tableNodes = $xp_32('//table[@class="tables"]/tbody/tr', fillterEL);
	var resTxt = "\t";
	// 上のテーブルはスキップ
	for (var i = 2, len = tableNodes.snapshotLength; i < len; i++ ) {
		resTxt = resTxt + tableNodes.snapshotItem(i).innerHTML;
	}
	resTxt = resTxt.replace(/\n/g, "");
	resTxt = resTxt.replace(/<[^>]*>/g, "\t");
	resTxt = resTxt.replace(/【|】|&nbsp;| \t|剣兵\t\t槍兵\t\t弓兵\t\t騎兵\t\t矛槍兵\t\t弩兵\t\t近衛騎兵\t\t斥候\t\t斥候騎兵\t\t衝車\t\t投石機\t\t武将/g, "");
	
	while (resTxt.indexOf("\t\t") != -1) {
		resTxt = resTxt.replace(/\t\t/g, "\t");
	}
	var tmp = brno + "\t";
		tmp = tmp + date + "\t";
		tmp = tmp + x + "\t";
		tmp = tmp + y + "\t";
		tmp = tmp + text;
	copyTxt = copyTxt + tmp + resTxt + "\n";
	addIdCash(brno);
	
	if (loadNo + 1 >= hrefArray_32.length) {
		var targetNode = $xp1_32('//ul[@id="statMenu"]', d_32);
		var textAreaEL = d_32.createElement("textarea");
			textAreaEL.cols = 95;
			textAreaEL.rows = 25;
			textAreaEL.defaultValue = copyTxt;
		targetNode.appendChild(textAreaEL);
		
		var layer = $xp1_32('//div[@id="cash_layer"]', d_32);
			layer.parentNode.removeChild(layer);
		
		saveOpValues_32();
		alert("ログ情報を出力しました。");
		return;
	}
	var layerExplain = $xp1_32('//div[@id="cash_explain"]', d_32);
		layerExplain.innerHTML = "<b>ログ出力実行中</b>　　" + (loadNo + 2) + "/" + hrefArray_32.length;
	loadPage_32(loadNo + 1);
}

// 該当IDがキャッシュ済みならtrueを返す
function checkIdCash_32(logId) {
	if(location.pathname == location_allianceURL) {
		for (var i in allianceIdArray) {
			if (allianceIdArray.hasOwnProperty(i) && allianceIdArray[i] == logId){ return true; }
		}
	} else if (location.pathname == location_reportURL) {
		for (var i in reportIdArray) {
			if (reportIdArray.hasOwnProperty(i) && reportIdArray[i] == logId){ return true; }
		}
	}
	return false;
}
// 該当IDをキャッシュに加える
function addIdCash(logId) {
	if(location.pathname == location_allianceURL) {
		allianceIdArray.push(logId);
	} else if (location.pathname == location_reportURL) {
		reportIdArray.push(logId);
	}
}
// キャッシュIDを削除
function resetIdCash() {
	if(location.pathname == location_allianceURL) {
		allianceIdArray = [];
		GM_deleteValue(worldKey_32 + "allianceIdArray");
	} else if (location.pathname == location_reportURL) {
		reportIdArray = [];
		GM_deleteValue(worldKey_32 + "reportIdArray");
	}
}

////////////////////////////////////////////////////////
// GM関連の共通関数
////////////////////////////////////////////////////////
function loadOpValues_32 () {
	reportIdArray = eval(GM_getValue(worldKey_32 + "reportIdArray", []));
	allianceIdArray = eval(GM_getValue(worldKey_32 + "allianceIdArray", []));
}
function saveOpValues_32 () {
	GM_setValue(worldKey_32 + "reportIdArray", reportIdArray.toSource());
	GM_setValue(worldKey_32 + "allianceIdArray", allianceIdArray.toSource());
}

//faraway}) ();
}	//faraway


//faraway 32.報告書・同盟ログCSV出力のソース(.user.js)終了

//faraway 33.トレードのカードのソース(user.js)開始
//================================================================================
//33.トレードのカード
//================================================================================
function TradeDispMore(){
	//alert("33.トレードのカード:"+location.pathname);
    if( location.pathname != "/card/trade.php" ) {				//トレード
   		return ;
    }
// ==UserScript==
// @name           ブラウザ三国志 - トレードのカードをもっと表示
// @namespace      http://puyomonolith.blog83.fc2.com/
// @description    10:15にカード落としまくる廃人用
// @include        http://*.3gokushi.jp/card/trade.php*
// ==/UserScript==

//ページへのリンクを含むul取得
var pager_33 = document.getElementsByTagName("form")[0].getElementsByTagName("ul")[0];
pager_33.innerHTML += "<br><br>";


//1ページ継ぎ足すボタン
var pageAddInput01 = document.createElement("input");
pageAddInput01.type = "button";
pageAddInput01.value = "1ページ継ぎ足す";
pageAddInput01.style.marginRight = "5px";
pageAddInput01.addEventListener("click", function(){pageAdd(1);}, false);
pager_33.appendChild(pageAddInput01);

//5ページ継ぎ足すボタン
/*
var pageAddInput05 = document.createElement("input");
pageAddInput05.type = "button";
pageAddInput05.value = "5ページ継ぎ足す";
pageAddInput05.addEventListener("click", function(){pageAdd(5);}, false);
pager_33.appendChild(pageAddInput05);
*/

//10ページ継ぎ足すボタン
/*
var pageAddInput10 = document.createElement("input");
pageAddInput10.type = "button";
pageAddInput10.value = "10ページ継ぎ足す";
pageAdInputd01.addEventListener("click", pageAdd(10));
pager_33.appendChild(pageAddInput10);
*/

//ベースになるURLと現在のページ番号抽出
if(document.URL.indexOf("#") != -1) {						//「トレード」をクリックして開いた１ページ目の場合の処理
	lastAddedPageNum = 1;
	baseURL = document.URL.split("#")[0] + "?p=";
} else if(document.URL.indexOf("p=") != -1) {				//ページのリンクをクリックして開いたページの場合の処理
	lastAddedPageNum = eval(document.URL.split("p=")[1]);
	baseURL = document.URL.split("p=")[0] + "p=";
} else {													//パラメータを与えて表示される最初のページの処理
	lastAddedPageNum = 1;
	baseURL = document.URL.split("#")[0] + "&p=";
}

//テキストボックスの生成
var textBox_33 = document.createElement("input");
textBox_33.type = "text";
textBox_33.id = "textBox";	//120125 "textBox_33"->"textBox"
textBox_33.style.marginRight = "5px";
textBox_33.style.width = "450px";
pager_33.appendChild(textBox_33);


//ボタンの設置
var input = document.createElement("input");
input.type = "button";
input.value = "ページを継ぎ足す";
input.id = "pageAddButton";
input.addEventListener("click", function(){pageAdd(textBox_33.value);}, false);
pager_33.appendChild(input);

//追加ページの存在フラグ
//exist = true;

function pageAdd(numOrUrl) {

slastAddedPageNum=lastAddedPageNum;	//120125

	if(!isNaN(numOrUrl)) {								//引数が数値の場合の処理
		for(var i = 0; i < numOrUrl; i++) {
			httpRequest = new XMLHttpRequest();
			httpRequest.open("GET", baseURL + ++lastAddedPageNum, true);
			httpRequest.onreadystatechange = function() {
				if(httpRequest.readyState == 4) {
					if(httpRequest.status == 200) {
						//取得したページのDOMツリー構成用の入れ物用意
						var newPage = document.createElement("div");
						newPage.innerHTML = httpRequest.responseText;
						newPage.id = "newPage";
						newPage.style.display = "none";
						
						//documentに突っ込んでDOMで利用可能に
						document.getElementsByTagName("body")[0].appendChild(newPage);
						
						//取得したページの使う部分だけ抽出
						var newTbody = document.getElementById("newPage").getElementsByTagName("tbody")[0];	//[1]->[0] faraway111017
						
						//追加できるページがないとき
						if(eval(document.getElementById("newPage").getElementsByClassName("pager_33")[0].getElementsByTagName("b")[0].innerHTML) == lastAddedPageNum - 1) {
							alert("追加できるページがありません");
							lastAddedPageNum--;
							//faraway111017 pageAddInput01.disabled = "disabled";	//ボタン３つを使用不可に
							//faraway111017 pageAddInput05.disabled = "disabled";
							//faraway111017 pageAddInput10.disabled = "disabled";
						} else {
							//余分な一行目を削除
							newTbody.removeChild(newTbody.firstChild);
							
							//取得したページの必要部分をテーブルに追加
							document.getElementById("gray02Wrapper").getElementsByTagName("tbody")[0].innerHTML += newTbody.innerHTML;
						}
						//documentに突っ込んだページの削除
						newPage.parentNode.removeChild(newPage);
					}
				}
			}
			//リクエスト送信
			httpRequest.send(null);
		}										//for文の終わり
	} else {									//引数が文字列（URL）の場合の処理
		httpRequest = new XMLHttpRequest();
		httpRequest.open("GET", textBox_33.value, true);
		httpRequest.onreadystatechange = function() {
			if(httpRequest.readyState == 4) {
				if(httpRequest.status == 200) {
					//取得したページのDOMツリー構成用の入れ物用意
					var newPage = document.createElement("div");
					newPage.innerHTML = httpRequest.responseText;
					newPage.id = "newPage";
					newPage.style.display = "none";
					
					//documentに突っ込んでDOMで利用可能に
					document.getElementsByTagName("body")[0].appendChild(newPage);
					
					//取得したページの使う部分だけ抽出
					var newTbody = document.getElementById("newPage").getElementsByTagName("tbody")[1];
					newTbody.removeChild(newTbody.firstChild);
					
					//documentに突っ込んだページの削除
					newPage.parentNode.removeChild(newPage);
					
					//取得したページの必要部分をテーブルに追加
					document.getElementById("gray02Wrapper").getElementsByTagName("tbody")[0].innerHTML += newTbody.innerHTML;
				}
			}
		}
		
		//リクエスト送信
		httpRequest.send(null);
	}

//111017 start
//GM_log("OPT_TRADESTATUS="+OPT_TRADESTATUS+" OPT_TRADESCORE="+OPT_TRADESCORE+" OPT_TRADECARDID="+OPT_TRADECARDID);
//if( OPT_TRADESTATUS  ) 		TradeStatus();		//34."トレードステータス表示"
//if( OPT_TRADESCORE  ) 		TradeScore();		//27."トレードスコア単価計算"
//if( OPT_TRADECARDID  )		TradeCardID();		//28."トレードカードＩＤ表示"
//111017 end
//window.open(baseURL + slastAddedPageNum , "_blank");	//faraway111018

}


}//faraway
//faraway 33.トレードのカードのソース(.user.js)終了

//faraway 34.トレードステータス表示のソース(.user.js)開始
//================================================================================
//34.トレードステータス表示
//================================================================================
function TradeStatus(){
	//alert("34.トレードステータス表示:"+location.pathname);
    //111011faraway	if( !location.pathname.match(/^(\/card\/|\/trade)/) ) return;	//faraway
	if (!location.pathname.match("/card/trade.php")) return;	//faraway111011

// ==UserScript==
// @name           bro3-StatLook
// @version        0.91
// @namespace      http://m21.3gokushi.jp/village.php
// @description    トレード画面で武将のステータスを表示します。
// @include        http://m*.3gokushi.jp/card/trade**
// ==/UserScript==
// ver 0.90 公開
// ver 0.91 ステ振り判断に、下一桁が０または５でない条件を追加
// ステ振りしていると推測される部分が赤色で表示されます。推測は完全ではありません。
//faraway (function () {
	function addGlovalStyle(css) {
		var head, style;
		head = document.getElementsByTagName('head')[0];
		if (!head) {
			return;
		}
		style = document.createElement('style');
		style.type = 'text/css';
		style.innerHTML = css;
		head.appendChild(style);
	}

	var allCard = document.getElementsByClassName('thickbox');
	var allAtt = document.getElementsByClassName('status_att');
	var allInt = document.getElementsByClassName('status_int');
	var allWdef = document.getElementsByClassName('status_wdef');
	var allSdef = document.getElementsByClassName('status_sdef');
	var allBdef = document.getElementsByClassName('status_bdef');
	var allRdef = document.getElementsByClassName('status_rdef');
	var allSpeed = document.getElementsByClassName('status_speed');

	for (var i = 0; i < allCard.length; i++) {
		re = new RegExp("\.00");
		var colInt = "black";
		if (!allInt[i].innerHTML.match(re)) {
			colInt = "red";
		}
		if (Number(allInt[i].innerHTML) >= 30) {
			colInt = "red";
		}

		re = new RegExp("\.0");
		var colSpeed = "black";
		if (!allSpeed[i].innerHTML.match(re)) {
			colSpeed = "red";
		}
		if (Number(allSpeed[i].innerHTML) >= 15.1) {
			colSpeed = "red";
		}
		re = RegExp("[05]$");
		var colAtt = "black";
		if (!allAtt[i].innerHTML.match(re)) {
			colAtt = "red";
		}
		if (Number(allAtt[i].innerHTML) >= 1000) {
			colAtt = "red";
		}
		re = RegExp("[05]$");
		var colDef = "black";
		if ((!allWdef[i].innerHTML.match(re))|| (!allSdef[i].innerHTML.match(re))||(!allBdef[i].innerHTML.match(re))||(!allRdef[i].innerHTML.match(re))){
			colDef = "red";
		}
		if (Number(allWdef[i].innerHTML) >= 1000 || Number(allSdef[i].innerHTML) >= 1000 || Number(allBdef[i].innerHTML) >= 1000 || Number(allRdef[i].innerHTML) >= 1000) {
			colDef = "red";
		}
		tmpStr = '<br>' + '<font color=\"' + colAtt + '\">' + '攻撃: ' + allAtt[i].innerHTML + '</font>' + '\n' + 
		'<font color=\"' + colInt + '\">' + '知力: ' + allInt[i].innerHTML + '</font>' + '<br>' + 
		'<font color=\"' + colDef + '\">' + '歩防: ' + allWdef[i].innerHTML + '\n' + '槍防: ' + allSdef[i].innerHTML + '<br>' + 
		'弓防: ' + allBdef[i].innerHTML + '\n' + '騎防: ' + allRdef[i].innerHTML + '</font>' + '<br>' + 
		'<font color=\"' + colSpeed + '\">' + '移速: ' + allSpeed[i].innerHTML + '</font>';
		newElement = document.createElement('span');
		newElement.setAttribute('style', 'font-size:8pt');
		newElement.innerHTML = tmpStr;
		allCard[i].appendChild(newElement);
	}
//faraway})();
}//faraway
//faraway 34.トレードステータス表示のソース(.user.js)終了
//faraway 35.トレードトレードＩＤ表示のソース(bro3_tradecardidview.user.js)開始
//================================================================================
//35.トレードトレードＩＤ表示
//================================================================================
function TradetradeID(){
	//alert("35.トレードトレードＩＤ表示:"+location.pathname);
    if( location.pathname != "/card/exhibit_list.php" ) {	//出品中のカード
   		return ;
    }

// ==UserScript==
// @name           bro3_tradeid
// @version        1.00
// @namespace      
// @include        http://*.3gokushi.jp/card/exhibit_list.php*
// @description    ブラウザ三国志、入札に必要なURLを表示。by tkc
// ==/UserScript==
//----更新履歴----
// ver1.00　2011-07-29：初回作成
// ver1.01　2011-08-05：入札済みに対する処理を追加
//faraway( function(){

var d = document;
var $xp = function (xp, dc) { return d.evaluate(xp, dc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };
var tradeUrl = "http://" + location.hostname + "/card/trade_bid.php?id=";

// ページ読み込み完了後に本処理開始
window.addEventListener("load", function() { pre_main(); }, false);

function pre_main() {
	showTradeIdMain();
}

function showTradeIdMain() {
	var IdNodes = $xp('//td[starts-with(@class, "trade")]', d);
	var tradeIdList = "";
	for (var i = 0, len = IdNodes.snapshotLength; i < len; i++ ) {
		var targetNode = IdNodes.snapshotItem(i);
		
		var tradeId = "";
		
		if(0 < targetNode.innerHTML.indexOf("取消"))
		{
			tradeId = targetNode.innerHTML.match(/[0-9]+/);
			tradeIdList += tradeUrl + tradeId + "<br>";
		}
		
		//出品カード列にID表示
		var cardIdEL = d.createElement("div");
			cardIdEL.style.paddingTop = "5px";
			cardIdEL.style.fontSize = "12px";
			if(tradeId != "")
			{
				cardIdEL.innerHTML = "ID:" + tradeId;
			}
		
		targetNode.appendChild(cardIdEL);
		
	}
	
	var tradeListNodes = $xp('//table[starts-with(@class, "tradeTables")]', d);
	var tradeNodes = tradeListNodes.snapshotItem(0);
	var listTitle = d.createElement("div");
			listTitle.style.paddingTop = "5px";
			listTitle.style.fontSize = "12px";
			listTitle.style.backgroundColor = "#E7651A";
			listTitle.innerHTML = "URL出品カードリスト(下部コピーで取引できます)";
			tradeNodes.parentNode.appendChild(listTitle);
	var cardIdList = d.createElement("div");
			cardIdList.style.paddingTop = "5px";
			cardIdList.style.fontSize = "12px";
			cardIdList.style.backgroundColor = "#FFFFFF";
			cardIdList.innerHTML = tradeIdList;
			tradeNodes.parentNode.appendChild(cardIdList);
}

//faraway}) ();
}//faraway
//faraway 35.トレードトレードＩＤ表示のソース(bro3_score_price.user.js)終了

//faraway110929 end

//faraway end
//ひろひろひろ 20120424 SSID取得のためにクッキー取得関数
function getCookie(key) {
	var tmp1 = " " + document.cookie + ";";
	var tmp2;
	var xx1 = 0;
	var xx2 = 0;
	var xx3;
	var len = tmp1.length;
	while (xx1 < len) {
		xx2 = tmp1.indexOf(";", xx1);
		tmp2 = tmp1.substring(xx1 + 1, xx2);
		xx3 = tmp2.indexOf("=");
		if (tmp2.substring(0, xx3) == key) {
			return(unescape(tmp2.substring(xx3 + 1, xx2 - xx1 - 1)));
		}
		xx1 = xx2 + 1;
	}
	return("");
}
function hiro_buildfacility(f,x,y,vId){
			var bilderForm_ssid       = document.createElement("input");bilderForm_ssid.type      ="hidden";bilderForm_ssid.name       ="ssid";      bilderForm_ssid.value      = getCookie("SSID");
			var bilderForm_id         = document.createElement("input");bilderForm_id.type        ="hidden";bilderForm_id.name         ="id";        bilderForm_id.value        = f;
			var bilderForm_x          = document.createElement("input");bilderForm_x.type         ="hidden";bilderForm_x.name          ="x";         bilderForm_x.value         = x;
			var bilderForm_y          = document.createElement("input");bilderForm_y.type         ="hidden";bilderForm_y.name          ="y";         bilderForm_y.value         = y;
			var bilderForm_village_id = document.createElement("input");bilderForm_village_id.type="hidden";bilderForm_village_id.name ="village_id";bilderForm_village_id.value= getVillageID(vId);
			var bilderForm            = document.createElement("form");bilderForm.id="bilderForm";bilderForm.method="post";bilderForm.name="facilityCreateForm1";bilderForm.action="/facility/build.php";
			bilderForm.appendChild(bilderForm_ssid);
			bilderForm.appendChild(bilderForm_id);
			bilderForm.appendChild(bilderForm_x);
			bilderForm.appendChild(bilderForm_y);
			bilderForm.appendChild(bilderForm_village_id);
			var objBody = document.getElementsByTagName("body").item(0); 
				objBody.appendChild(bilderForm);
			document.getElementById("bilderForm").submit();
}
function hiro_lvupfacility(x,y,vId){
			var bilderForm_ssid       = document.createElement("input");bilderForm_ssid.type      ="hidden";bilderForm_ssid.name       ="ssid";      bilderForm_ssid.value      = getCookie("SSID");
			var bilderForm_x          = document.createElement("input");bilderForm_x.type         ="hidden";bilderForm_x.name          ="x";         bilderForm_x.value         = x;
			var bilderForm_y          = document.createElement("input");bilderForm_y.type         ="hidden";bilderForm_y.name          ="y";         bilderForm_y.value         = y;
			var bilderForm_village_id = document.createElement("input");bilderForm_village_id.type="hidden";bilderForm_village_id.name ="village_id";bilderForm_village_id.value= getVillageID(vId);
			var bilderForm            = document.createElement("form");bilderForm.id="bilderForm";bilderForm.method="post";bilderForm.name="facilityCreateForm1";bilderForm.action="/facility/build.php";
			bilderForm.appendChild(bilderForm_ssid);
			bilderForm.appendChild(bilderForm_x);
			bilderForm.appendChild(bilderForm_y);
			bilderForm.appendChild(bilderForm_village_id);
			var objBody = document.getElementsByTagName("body").item(0); 
				objBody.appendChild(bilderForm);
			document.getElementById("bilderForm").submit();
}
