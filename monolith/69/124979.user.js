// ==UserScript==
// @name           Soundcloude Downloader
// @namespace      recommender
// @include        http://soundcloud.com/*
// @Copyright      Philipp S.
// @Homepage       www.ps-anarchie.de.vu
// ==/UserScript==




function contentEval(source) {
  // Check for function input.
  if ('function' == typeof source) {
    // Execute this function with no arguments, by adding parentheses.
    // One set around the function, required for valid syntax, and a
    // second empty set calls the surrounded function.
    source = '(' + source + ')();'
  }

  // Create a script node holding this  source code.
  var script = document.createElement('script');
  script.setAttribute("type", "application/javascript");
  script.textContent = source;

  // Insert the script node into the page, so it will run, and immediately
  // remove it to clean up.
  document.body.appendChild(script);
  document.body.removeChild(script);
}


contentEval('var apiKey="3d66b20f7cbf176bf182946a15a5378e";var tenantId="Soundcloud";var playerButtons=$(".play");var favButtons = $(".favorite");var userName=$("#user-status")[0].getElementsByTagName("a")[1].innerHTML;if(userName=="Log In" || userName=="stranger"){userName=null}function drawRecommendationListWithPicturesRightSide(json){drawRecommendationListWithPicturesToDiv(json,"recommendations")}function drawSimilarTracksRightSide(json){drawSimilarTracks(json,"#recommendations","other users also viewed")}function drawAlsoBoughtRightSide(json) {drawSimilarTracks(json, "#recommendations", "other users also favorited")}function drawPersonalTracksRightSide(json){createDiv(\'recommendations-personal\',\'side-content\');drawSimilarTracks(json,"#recommendations-personal","you might like")}function drawSimilarTracks(json,recommenderDiv,title){if("undefined"==typeof(json.error)){try{var items=json.recommendeditems.item}catch(e){return}if("undefined"==typeof(items.length)){items=new Array(items)}if(items.length>0){listString="<div class=\'context-box\'>";listString+="<a href=\'http://easyrec.org/\' style=\'display:block;\'><img style=\'float:left;padding-top:5px;padding-left:2px;padding-right:10px;\' src=\'http://easyrec.org//img/favicon.ico\'></a><h3>"+title+"</h3>";for(x=0;x<15&&x<items.length;x++){listString+=createplayer(items[x].url)}$(recommenderDiv)[0].innerHTML=listString+"</div>"}}}function createplayer(itemurl){return\'<div class="widget tiny"><object width="100%" height="18"> <param value="http://player.soundcloud.com/player.swf?url=\'+escape(itemurl)+\'&auto_play=false&player_type=tiny&font=Arial&color=0066cc" name="movie"> <param value="always" name="allowscriptaccess"> <embed width="100%" height="18" type="application/x-shockwave-flash" src="http://player.soundcloud.com/player.swf?url=\'+escape(itemurl)+\'&auto_play=false&player_type=tiny&amp;font=Arial&color=0066cc" allowscriptaccess="always"> </object></div>\'}function includeEasyrec(jsAdr){var newJs=document.createElement(\'script\');newJs.type=\'text/javascript\';newJs.src=jsAdr;newJs.onload=easyrecLoaded;document.getElementsByTagName(\'head\')[0].appendChild(newJs)}function createDiv(divId,parentDiv){var newDiv=document.createElement(\'div\');newDiv.id=divId;document.getElementById(parentDiv).appendChild(newDiv)}function createRecommenderDiv(){if($(\'#side-content\').size()!=0){createDiv(\'recommendations\',\'side-content\')}else{createDiv(\'recommendations\',\'main-wrapper-inner\')}}includeEasyrec("http://demo.easyrec.org:8080/api-js/easyrec.js");createRecommenderDiv();function easyrecLoaded(){if(location.href=="http://soundcloud.com/dashboard"){easyrec_getRecommendations("recommendationsforuser",{userId:userName,drawingCallback:"drawSimilarTracksRightSide"});}playerButtons.click(function(){if(this.className.indexOf(\'playing\')==-1){var trackid=this.parentNode.parentNode.parentNode.getAttribute("data-sc-track");           if (typeof this.parentNode.parentNode.parentNode.firstChild.getElementsByTagName("h3")[0] == "undefined"){               var itemUrl = location.href;               var itemName = this.parentNode.parentNode.parentNode.firstChild.getElementsByTagName("h1")[0].lastChild.innerHTML;        var itemPic = $(\'meta[property=og:image]\').attr("content");           }else{               var itemUrl = this.parentNode.parentNode.parentNode.firstChild.getElementsByTagName("h3")[0].lastChild.getAttribute("href");               var itemName = this.parentNode.parentNode.parentNode.firstChild.getElementsByTagName("h3")[0].lastChild.innerHTML;               var itemPic = this.parentNode.parentNode.parentNode.firstChild.firstChild.getAttribute("href");           }easyrec_sendAction("view",{userId:userName,itemId:trackid,itemUrl:itemUrl,itemDescription:itemName,itemImageUrl:itemPic});easyrec_getRecommendations("otherusersalsoviewed",{itemId:trackid,drawingCallback:"drawSimilarTracksRightSide"});}});  favButtons.click(function() {           var trackid = this.parentNode.parentNode.parentNode.parentNode.getAttribute("data-sc-track");           if (typeof this.parentNode.parentNode.parentNode.parentNode.firstChild.getElementsByTagName("h3")[0] == "undefined"){               var itemUrl = location.href;               var itemName = this.parentNode.parentNode.parentNode.parentNode.firstChild.getElementsByTagName("h1")[0].lastChild.innerHTML;               var itemPic = $(\'meta[property=og:image]\').attr("content");           }else{               var itemUrl = this.parentNode.parentNode.parentNode.parentNode.firstChild.getElementsByTagName("h3")[0].lastChild.getAttribute("href");               var itemName = this.parentNode.parentNode.parentNode.parentNode.firstChild.getElementsByTagName("h3")[0].lastChild.innerHTML;               var itemPic = this.parentNode.parentNode.parentNode.parentNode.firstChild.firstChild.getAttribute("href");           }            easyrec_sendAction("buy", {userId:userName,itemId:trackid,itemUrl:itemUrl,itemDescription:itemName,itemImageUrl:itemPic});            easyrec_getRecommendations("otherusersalsobought", {itemId:trackid,drawingCallback:"drawAlsoBoughtRightSide"});        });}');
contentEval('$("a.pl-button.favorite").each(function(){var audio_info,link,next,script_content;script_content=$(this).parents("div.actionbar:first").nextAll("script:first").text();script_content=script_content.match(/push\((.+)\);/)[1];audio_info=eval("("+script_content+")");link=document.createElement("a");link.className="pl-button";link.title="Download provided by SoundCloud Infinity Download Greasemonkey plugin";link.href=audio_info.streamUrl;link.style.backgroundPosition="-77px -236px";link.style.paddingLeft="18px";link.innerHTML="<span>Klicke hier zum Download</span>";$(this).after(link);});');
contentEval('var newButton = $("<li/>").attr("id","menu-button-charts").addClass("no-submenu").addClass("nav").addClass("logged-in").css("margin-left" ,"0px").css("display","block");newButton.append($("<a/>").attr("href","http://soundcloudcharts.blogspot.com/").text("Charts"));newButton.append($("<div/>").addClass("open-submenu"));newButton.mouseover(function(){$(this).addClass("hover");});newButton.mouseout(function(){$(this).removeClass("hover");});$("#menu-button-groups").after(newButton);');

