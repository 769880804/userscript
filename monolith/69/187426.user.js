// ==UserScript==
// @name eSim BattleList Premium
// @namespace eSim BattleList Premium
// @version 0.2
// @author calin
// @description This script add simple battle scan, show battle hero and remaining time.
// @include http://*.e-sim.org/battle.html?id=*
// @icon http://e-sim.home.pl/eworld/img/favicon.png
// ==/UserScript==
var main=function(){$(document).ready(function(){function e(){var a=$("#defenderScore").text().replace(/[,]+/g,""),b=$("#attackerScore").text().replace(/[,]+/g,""),a=Math.abs(b-a),a=(a+"").split("."),a=a[0].replace(/(\d{1,3})(?=(\d{3})+$)/g,"$1,")+(2==a.length?"."+a[1]:"");$("#bMtWall").text()!=a&&$("#bMtWall").text(a);hasFocus=!0;setTimeout(e,nextmission)}function m(a,b,c,d){$("#attackerScore").text()!=a&&$("#attackerScore").text(a);$("#defenderScore").text()!=b&&$("#defenderScore").text(b);var g=
Math.round(100*(100-d))/100;a=parseInt(g/100*450);$("#defenderBar").animate({width:a});$("#defenderPercent").text()!=g+"%"&&($("#defenderPercent").fadeOut("fast",function(){$("#defenderPercent").text(g+"%");$("#defenderPercent").fadeIn("fast")}),$("#attackerPercent").fadeOut("fast",function(){$("#attackerPercent").text(d+"%");$("#attackerPercent").fadeIn("fast")}))}function f(a){$.ajax({url:"battleScore.html?id="+a+"&premium=1",type:"GET",dataType:"json",success:function(b){null!=b?(updateBattleMonitor(b),
m(b.attackerScore,b.defenderScore,b.remainingTimeInSeconds,b.percentAttackers),setTimeout(function(){f($("#battleRoundId")[0].value)},25*nextmission)):setTimeout(function(){f(a)},5*nextmission)},error:function(b,c,d){setTimeout(function(){f(a)},5*nextmission)}})}function l(a,b){return $.grep(n,function(c){return c[a].toLowerCase()===b.toLowerCase()})}var p=parent.document.location.pathname.toString(),h=!1;initL=0;nextmission=200;running=!1;battleList=[];var n=[{id:0,name:"Gold",shortName:"Gold"},
{id:1,name:"Poland",shortName:"PL"},{id:2,name:"Russia",shortName:"RU"},{id:3,name:"Germany",shortName:"GER"},{id:4,name:"France",shortName:"FR"},{id:5,name:"Spain",shortName:"ES"},{id:6,name:"United Kingdom",shortName:"GB"},{id:7,name:"Italy",shortName:"IT"},{id:8,name:"Hungary",shortName:"HU"},{id:9,name:"Romania",shortName:"RO"},{id:10,name:"Bulgaria",shortName:"BG"},{id:11,name:"Serbia",shortName:"RS"},{id:12,name:"Croatia",shortName:"HR"},{id:13,name:"Bosnia and Herzegovina",shortName:"BA"},
{id:14,name:"Greece",shortName:"GR"},{id:15,name:"Republic of Macedonia",shortName:"MK"},{id:16,name:"Ukraine",shortName:"UA"},{id:17,name:"Sweden",shortName:"SE"},{id:18,name:"Portugal",shortName:"PT"},{id:19,name:"Lithuania",shortName:"LT"},{id:20,name:"Latvia",shortName:"LV"},{id:21,name:"Slovenia",shortName:"SI"},{id:22,name:"Turkey",shortName:"TR"},{id:23,name:"Brazil",shortName:"BR"},{id:24,name:"Argentina",shortName:"AR"},{id:25,name:"Mexico",shortName:"MX"},{id:26,name:"USA",shortName:"US"},
{id:27,name:"Canada",shortName:"CA"},{id:28,name:"China",shortName:"CN"},{id:29,name:"Indonesia",shortName:"ID"},{id:30,name:"Iran",shortName:"IR"},{id:31,name:"South Korea",shortName:"KR"},{id:32,name:"Taiwan",shortName:"TW"},{id:33,name:"Israel",shortName:"IL"},{id:34,name:"India",shortName:"IN"},{id:35,name:"Australia",shortName:"AU"},{id:36,name:"Netherlands",shortName:"NL"},{id:37,name:"Finland",shortName:"FI"},{id:38,name:"Ireland",shortName:"I"},{id:39,name:"Switzerland",shortName:"CH"},{id:40,
name:"Belgium",shortName:"BE"},{id:41,name:"Pakistan",shortName:"PK"},{id:42,name:"Malaysia",shortName:"MY"},{id:43,name:"Norway",shortName:"NO"},{id:44,name:"Peru",shortName:"PE"},{id:45,name:"Chile",shortName:"CL"},{id:46,name:"Colombia",shortName:"CO"},{id:47,name:"Montenegro",shortName:"ME"},{id:48,name:"Austria",shortName:"A"},{id:49,name:"Slovakia",shortName:"SK"},{id:50,name:"Denmark",shortName:"DK"},{id:51,name:"Czech Republic",shortName:"CZ"},{id:52,name:"Belarus",shortName:"BY"},{id:53,
name:"Estonia",shortName:"EE"},{id:54,name:"Philippines",shortName:"PH"},{id:55,name:"Albania",shortName:"AL"},{id:57,name:"Egypt",shortName:"EG"},{id:59,name:"Bangladesh",shortName:"BD"},{id:61,name:"Yemen",shortName:"YE"},{id:62,name:"Saudi Arabia",shortName:"SA"},{id:63,name:"Thailand",shortName:"TH"},{id:64,name:"Algeria",shortName:"DZ"},{id:65,name:"Angola",shortName:"AO"},{id:66,name:"Cameroon",shortName:"CM"},{id:67,name:"Ivory Coast",shortName:"CI"},{id:68,name:"Ethiopia",shortName:"ET"},
{id:69,name:"Ghana",shortName:"GH"},{id:70,name:"Kenya",shortName:"KE"},{id:71,name:"Libya",shortName:"LY"},{id:72,name:"Morocco",shortName:"MA"},{id:73,name:"Mozambique",shortName:"MZ"},{id:74,name:"Nigeria",shortName:"NG"},{id:75,name:"Senegal",shortName:"SN"},{id:76,name:"South Africa",shortName:"ZA"},{id:77,name:"Sudan",shortName:"SD"},{id:78,name:"Tanzania",shortName:"TZ"},{id:79,name:"Togo",shortName:"TG"},{id:80,name:"Tunisia",shortName:"TN"},{id:81,name:"Uganda",shortName:"UG"},{id:82,name:"Zambia",
shortName:"ZM"},{id:83,name:"Zimbabwe",shortName:"ZW"},{id:84,name:"Botswana",shortName:"BW"},{id:85,name:"Benin",shortName:"BJ"},{id:86,name:"Burkina Faso",shortName:"BF"},{id:87,name:"Congo",shortName:"CG"},{id:88,name:"Central African Republic",shortName:"CF"},{id:89,name:"DR of the Congo",shortName:"CD"},{id:90,name:"Eritrea",shortName:"ER"},{id:91,name:"Gabon",shortName:"GA"},{id:92,name:"Chad",shortName:"TD"},{id:93,name:"Niger",shortName:"NE"},{id:94,name:"Mali",shortName:"ML"},{id:95,name:"Mauritania",
shortName:"MR"},{id:96,name:"Guinea",shortName:"GN"},{id:97,name:"Guinea Bissau",shortName:"GW"},{id:98,name:"Sierra Leone",shortName:"SL"},{id:99,name:"Liberia",shortName:"LR"},{id:100,name:"Equatorial Guinea",shortName:"GQ"},{id:101,name:"Namibia",shortName:"NA"},{id:102,name:"Lesotho",shortName:"LS"},{id:103,name:"Swaziland",shortName:"SZ"},{id:104,name:"Madagascar",shortName:"MG"},{id:105,name:"Malawi",shortName:"MW"},{id:106,name:"Somalia",shortName:"SO"},{id:107,name:"Djibouti",shortName:"DJ"},
{id:108,name:"Rwanda",shortName:"RW"},{id:109,name:"Burundi",shortName:"BI"},{id:110,name:"United Arab Emirates",shortName:"AE"},{id:111,name:"Syria",shortName:"SY"},{id:112,name:"Iraq",shortName:"IQ"},{id:113,name:"Oman",shortName:"OM"},{id:114,name:"Qatar",shortName:"QA"},{id:115,name:"Jordan",shortName:"JO"},{id:116,name:"Western Sahara",shortName:"EH"},{id:117,name:"The Gambia",shortName:"GM"},{id:118,name:"South Sudan",shortName:"SS"}];if(/battle.html/g.test(p)){if(0!=$("#totaldefenders").length||
0!=$("#totalattackers").length||0!=$("#totalattackers").length)h=!0;0==$("#totaldefenders").length&&$(".foundation-style.column-margin-vertical.column.small-4:eq(1)").append('<br><b>Total defenders online:</b><i id="totaldefenders" style="display: inline; margin-right:5px; margin-left:3px;">0</i> <a style="font-size: 11px; display: inline;" href="" id="defendersLink">Show</a><a style="font-size: 11px; display: none;" href="" id="defendersLinkHide">Hide</a><br><div align="center" id="defendersMenu" style="font-size: 11px; text-align: left; width: 200px; margin: auto; display: none;"></div>');
0==$("#totalattackers").length&&$(".foundation-style.column-margin-vertical.column.small-4:eq(2)").append('<br><b>Total attackers online:</b><i id="totalattackers" style="display: inline; margin-right:5px; margin-left:3px;">0</i><a style="font-size: 11px; display: inline;" href="" id="attackersLink">Show</a><a style="font-size: 11px; display: none;" href="" id="attackersLinkHide">Hide</a><br><div align="center" id="attackersMenu" style="font-size: 11px; text-align: left; width: 200px; margin: auto; display: none;"></div>');
0==$("#totalspectators").length&&$(".foundation-style.column-margin-vertical.column.small-10.foundation-text-center:first").append('<b>Total spectators online:</b><i id="totalspectators" style="display: inline; margin-right:5px; margin-left:3px;">0</i><a style="font-size: 11px; display: inline;" href="" id="spectatorsLink">Show</a><a style="font-size: 11px; display: none;" href="" id="spectatorsLinkHide">Hide</a><br><div align="center" id="spectatorsMenu" style="font-size: 11px; text-align: left; width: 200px; margin: auto; display: none;"></div><script type="text/javascript">$(document).ready(function() {$("#spectatorsLink").click(function(){$("#spectatorsLink").fadeOut("fast",function(){$("#spectatorsLinkHide").fadeIn("fast");$("#spectatorsMenu").fadeIn("fast")});return!1});$("#spectatorsLinkHide").click(function(){$("#spectatorsLinkHide").fadeOut("fast",function(){$("#spectatorsLink").fadeIn("fast");$("#spectatorsMenu").fadeOut("fast")});return!1});$("#attackersLink").click(function(){$("#attackersLink").fadeOut("fast",function(){$("#attackersLinkHide").fadeIn("fast");$("#attackersMenu").fadeIn("fast")});return!1});$("#attackersLinkHide").click(function(){$("#attackersLinkHide").fadeOut("fast",function(){$("#attackersLink").fadeIn("fast");$("#attackersMenu").fadeOut("fast")});return!1});$("#defendersLink").click(function(){$("#defendersLink").fadeOut("fast",function(){$("#defendersLinkHide").fadeIn("fast");$("#defendersMenu").fadeIn("fast")});return!1});$("#defendersLinkHide").click(function(){$("#defendersLinkHide").fadeOut("fast",function(){$("#defendersLink").fadeIn("fast");$("#defendersMenu").fadeOut("fast")});return!1});});\x3c/script>');
0==$("#bMtWall").length&&($(".foundation-style.column-margin-vertical.column.small-2:first").append('<font id="bMtInfo" style="font-size:12px; font-weight:bold; display:inline;">Buffer WALL</font><div class="hitInfl" style="color:white; width:70px; text-shadow:black 1px 1px 2px; background:#F39814; margin-top:3px; display:block;"><font id="bMtWall"></font></div>'),$("#bMtInfo").click(function(){var a=parent.document.location.toString(),b=$('.testDivwhite.column.small-8 h2 a[href^="region.html?id="]')[0].textContent,
c=$(".testDivwhite.column.small-8 img.biggerFlag:first").attr("src").split("/").pop().replace("_","").split(".")[0],d=$(".testDivwhite.column.small-8 img.biggerFlag:last").attr("src").split("/").pop().replace("_","").split(".")[0],g=$("#roundCountdown")[0].textContent,f=$("#bMtWall")[0].textContent,e=$("#defenderPercent")[0].textContent,h=$("#attackerPercent")[0].textContent,c=l("name",c)[0].shortName,d=l("name",d)[0].shortName,k=">>>";e.split("%")[0]<h.split("%")[0]&&(k="<<<");window.prompt("Press CTRL+C, ENTER",
"*Battle* :: "+b+" :: "+c+" "+e+" "+k+" "+g+" "+k+" "+h+" "+d+" :: "+f+" dmg :: "+a)}));0==$("bMtEAT").length&&0==$("#bMtUSE").length&&($("#battleRoundId").after('<br><input class="small button foundation-style" id="bMtEAT" type="button" value="Eat Food"><input class="small button foundation-style" id="bMtUSE" type="button" value="Use Gift">'),$("#bMtEAT").click(function(){$("#eatButton").trigger("click")}),$("#bMtUSE").click(function(){$("#useGiftButton").trigger("click")}));h?setTimeout(function(){e()},
nextmission):setTimeout(function(){e();f($("#battleRoundId")[0].value)},nextmission)}})},script=document.createElement("script");script.type="text/javascript";script.textContent="("+main.toString()+")();";document.body.appendChild(script);

