// ==UserScript==
// @name           Travian Stockwatcher
// @namespace      jjura.travian.stockwatcher
// @description    Simple add-on to travian website that shows time before your stocks are full
// @include        http://*.travian.cz/dorf1.php
// @require        http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js
// ==/UserScript==

initialize();function createDiv(className){var insertedDiv=document.createElement("div");insertedDiv.className=className;return insertedDiv;}
function convertToTime(ticks,prod){var temp=ticks/prod;var hours=Math.floor(temp);temp=(temp-hours)*60;var minutes=Math.floor(temp);temp=(temp-minutes)*60;var seconds=Math.floor(temp);return hours+":"+(minutes<=9?"0"+minutes:minutes)+":"+(seconds<=9?"0"+seconds:seconds);}
function getValues(){var stock_drevo=document.getElementById("l1").innerHTML;var stock_hlina=document.getElementById("l2").innerHTML;var stock_zelezo=document.getElementById("l3").innerHTML;var stock_obili=document.getElementById("l4").innerHTML;var productions=document.getElementById("production").getElementsByClassName("num");var prod_drevo=productions[0].innerHTML;var prod_hlina=productions[1].innerHTML;var prod_zelezo=productions[2].innerHTML;var prod_obili=productions[3].innerHTML;var drevo_act=stock_drevo.split("/")[0];var drevo_max=stock_drevo.split("/")[1];var hlina_act=stock_hlina.split("/")[0];var hlina_max=stock_hlina.split("/")[1];var zelezo_act=stock_zelezo.split("/")[0];var zelezo_max=stock_zelezo.split("/")[1];var obili_act=stock_obili.split("/")[0];var obili_max=stock_obili.split("/")[1];var drevo_ticks=drevo_max-drevo_act;var hlina_ticks=hlina_max-hlina_act;var zelezo_ticks=zelezo_max-zelezo_act;var obili_ticks=obili_max-obili_act;var drevo_left=convertToTime(drevo_ticks,prod_drevo);var hlina_left=convertToTime(hlina_ticks,prod_hlina);var zelezo_left=convertToTime(zelezo_ticks,prod_zelezo);var obili_left=convertToTime(obili_ticks,prod_obili);return{drevo:drevo_left,hlina:hlina_left,zelezo:zelezo_left,obili:obili_left};}
function initialize(){var myDiv=document.createElement("div");myDiv.className="boxes-contents";var resources=getValues();myDiv.innerHTML="<table cellspacing=\"1\" cellpadding=\"1\" id=\"stockwatcher\">  "+"<thead>                                                                      "+" <tr>                                                                      "+"  <th colspan=\"4\">                                                    "+"   Do naplnění skladů:   </th>                                 "+" </tr>                                                                     "+"</thead>                                                                     "+"<tbody>                                                                      "+"   <tr>                                                              "+"  <td class=\"ico\">                                                    "+"   <img alt=\"Dřevo\" src=\"img/x.gif\" class=\"r1\">                "+"  </td>                                                                 "+"  <td class=\"res\">                                                    "+"   Dřevo:                                                            "+"  </td>                                                                 "+"  <td class=\"num\" id=\"sw_drevo\">                                                    "+"   "+resources.drevo+"   </td>                                         "+" </tr>                                                                     "+"   <tr>                                                              "+"  <td class=\"ico\">                                                    "+"   <img alt=\"Hlína\" src=\"img/x.gif\" class=\"r2\">                "+"  </td>                                                                 "+"  <td class=\"res\">                                                    "+"   Hlína:                                                            "+"  </td>                                                                 "+"  <td class=\"num\" id=\"sw_hlina\">                                                    "+"   "+resources.hlina+"   </td>                                         "+" </tr>                                                                     "+"   <tr>                                                              "+"  <td class=\"ico\">                                                    "+"   <img alt=\"Železo\" src=\"img/x.gif\" class=\"r3\">               "+"  </td>                                                                 "+"  <td class=\"res\">                                                    "+"   Železo:                                                           "+"  </td>                                                                 "+"  <td class=\"num\" id=\"sw_zelezo\">                                                    "+"   "+resources.zelezo+"   </td>                                         "+" </tr>                                                                     "+"   <tr>                                                              "+"  <td class=\"ico\">                                                    "+"   <img alt=\"Obilí\" src=\"img/x.gif\" class=\"r4\">                "+"  </td>                                                                 "+"  <td class=\"res\">                                                    "+"   Obilí:                                                            "+"  </td>                                                                 "+"  <td class=\"num\" id=\"sw_obili\">                                                    "+"  "+resources.obili+"   </td>                                             "+" </tr>                                                                     "+" </tr>                                                                     "+"   <tr>                                                              "+"  <td colspan=\"4\">"+"  <a href=\"#\" id=\"sw_refreshbutton\">Refresh</a>   </td>                                             "+" </tr>                                                                     "+"  </tbody>                                                              "+"</table>";var boxesDiv=document.createElement("div");boxesDiv.className="boxes";boxesDiv=XPCNativeWrapper.unwrap(boxesDiv);boxesDiv.style.height="145px";boxesDiv.style.width="207px";boxesDiv.insert(createDiv("boxes-tl"));boxesDiv.insert(createDiv("boxes-tr"));boxesDiv.insert(createDiv("boxes-tc"));boxesDiv.insert(createDiv("boxes-ml"));boxesDiv.insert(createDiv("boxes-mr"));boxesDiv.insert(createDiv("boxes-mc"));boxesDiv.insert(createDiv("boxes-bl"));boxesDiv.insert(createDiv("boxes-br"));boxesDiv.insert(createDiv("boxes-bc"));boxesDiv.insert(myDiv);var target=document.getElementById("map_details");XPCNativeWrapper.unwrap(target).insert(boxesDiv);var refreshLink=document.getElementById("sw_refreshbutton");refreshLink.addEventListener("click",fillValues,true);}
function fillValues(){var resources=getValues();XPCNativeWrapper.unwrap(document.getElementById("sw_drevo")).innerHTML=resources.drevo;XPCNativeWrapper.unwrap(document.getElementById("sw_hlina")).innerHTML=resources.hlina;XPCNativeWrapper.unwrap(document.getElementById("sw_zelezo")).innerHTML=resources.zelezo;XPCNativeWrapper.unwrap(document.getElementById("sw_obili")).innerHTML=resources.obili;}