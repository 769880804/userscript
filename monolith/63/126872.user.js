// ==UserScript==
// @name       Tangan Kosong
// @namespace   Games by Zynga
// @description Hajar Blehh...!!!
// @include     http://facebook.mafiawars.zynga.com/mwfb/remote/html_server.php*
// @include     http://mwfb.zynga.com/mwfb/remote/html_server.php*
// @include     http://facebook.mafiawars.zynga.com/mwfb/xd_receiver.htm
// @include     http://apps.facebook.com/inthemafia/*
// @include     http://apps.new.facebook.com/inthemafia/*
// @include     http://www.facebook.com/connect/uiserver*
// @include     https://www.facebook.com/dialog/feed*
// @exclude     http://mwfb.zynga.com/mwfb/*#*
// @exclude     http://facebook.mafiawars.zynga.com/mwfb/*#*
// @exclude     http://apps.facebook.com/inthemafia/sk_updater.php*
// @exclude	    http://facebook.mafiawars.zynga.com/mwfb/iframe_proxy.php*
// @include     https://facebook.mafiawars.zynga.com/mwfb/remote/html_server.php*
// @include     https://mwfb.zynga.com/mwfb/remote/html_server.php*
// @include     https://facebook.mafiawars.zynga.com/mwfb/xd_receiver.htm
// @include     https://apps.facebook.com/inthemafia/*
// @include     https://apps.new.facebook.com/inthemafia/*
// @include     https://www.facebook.com/connect/uiserver*
// @exclude     https://mwfb.zynga.com/mwfb/*#*
// @exclude     https://facebook.mafiawars.zynga.com/mwfb/*#*
// @exclude     https://apps.facebook.com/inthemafia/sk_updater.php*
// @exclude	    https://facebook.mafiawars.zynga.com/mwfb/iframe_proxy.php*
// @version     3.4.4
// ==/UserScript==


function injectScript(source) {
    // Utilities
    var isFunction = function (arg) {
            return (Object.prototype.toString.call(arg) == "[object Function]");
        };
    var jsEscape = function (str) {
            // Replaces quotes with numerical escape sequences to
            // avoid single-quote-double-quote-hell, also helps by escaping HTML special chars.
            if (!str || !str.length) return str;
            // use \W in the square brackets if you have trouble with any values.
            var r = /['"<>\/]/g,
                result = "",
                l = 0,
                c;
            do {
                c = r.exec(str);
                result += (c ? (str.substring(l, r.lastIndex - 1) + "\\x" + c[0].charCodeAt(0).toString(16)) : (str.substring(l)));
            } while (c && ((l = r.lastIndex) > 0))
            return (result.length ? result : str);
        };
    var bFunction = isFunction(source);
    var elem = document.createElement("script"); // create the new script element.
    var script, ret, id = "";
    if (bFunction) {
        // We're dealing with a function, prepare the arguments.
        var args = [];
        for (var i = 1; i < arguments.length; i++) {
            var raw = arguments[i];
            var arg;
            if (isFunction(raw)) // argument is a function.
            arg = "eval(\"" + jsEscape("(" + raw.toString() + ")") + "\")";
            else if (Object.prototype.toString.call(raw) == '[object Date]') // Date
            arg = "(new Date(" + raw.getTime().toString() + "))";
            else if (Object.prototype.toString.call(raw) == '[object RegExp]') // RegExp
            arg = "(new RegExp(" + raw.toString() + "))";
            else if (typeof raw === 'string' || typeof raw === 'object') // String or another object
            arg = "JSON.parse(\"" + jsEscape(JSON.stringify(raw)) + "\")";
            else arg = raw.toString(); // Anything else number/boolean
            args.push(arg); // push the new argument on the list
        }
        // generate a random id string for the script block
        while (id.length < 16) id += String.fromCharCode(((!id.length || Math.random() > 0.5) ? 0x61 + Math.floor(Math.random() * 0x19) : 0x30 + Math.floor(Math.random() * 0x9)));
        // build the final script string, wrapping the original in a boot-strapper/proxy:
        script = "(function(){var value={callResult: null, throwValue: false};try{value.callResult=((" + source.toString() + ")(" + args.join() + "));}catch(e){value.throwValue=true;value.callResult=e;};" + "document.getElementById('" + id + "').innerText=JSON.stringify(value);})();";
        elem.id = id;
    } else // plain string, just copy it over.
    {
        script = source;
    }
    elem.type = "text/javascript";
    elem.innerHTML = script;
    // insert the element into the DOM (it starts to execute instantly)
    document.head.appendChild(elem);
    if (bFunction) {
        // get the return value from our function:
        ret = JSON.parse(elem.innerText);
        // remove the now-useless clutter.
        elem.parentNode.removeChild(elem);
        // make sure the garbage collector picks it instantly. (and hope it does)
        delete(elem);
        // see if our returned value was thrown or not
        if (ret.throwValue) throw (ret.callResult);
        else return (ret.callResult);
    } else // plain text insertion, return the new script element.
    return (elem);
}
var myscript = function(){var is_chrome=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;if(document.getElementById("pagelet_ticker")){var ticker=document.getElementById("pagelet_ticker");var ego_pane=document.getElementById("pagelet_ego_pane");ticker.parentNode.removeChild(ticker);ego_pane.parentNode.removeChild(ego_pane);return}function x$(selector,context){context=context||document;return document.evaluate(selector,context,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}function topshelfstuff(){if($("#popup_fodder_zmc").css("display")=="block"){$("#popup_fodder_zmc").css("display","none")}if($("#LoadingOverlay")){$("#LoadingOverlay").remove();$("#LoadingBackground").remove();$("#ErrorOverlay1").remove();$("#ErrorOverlay2").remove();$("#mw_like_button").remove();$("#zbar").parent().remove()}var c=document.getElementsByTagName("a");var d="MW.WorstItemsModule.toggle();";for(var i=0;i<c.length;i++){if(c[i].innerHTML==="i"){c[i].setAttribute("title"," ");c[i].parentNode.setAttribute("title","Click me to close.");c[i].parentNode.setAttribute("onclick",d);c[i].innerHTML='<div onclick="'+d+'" style="width:50px;position:relative;left:-40px;top:58px;" title="Lowest Item Scores"><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_mafia_attack_22x16_01.gif" width="19" height="16" align="absmiddle"><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_mafia_defense_22x16_01.gif" width="19" height="16" align="absmiddle"></div>';c[i].parentNode.parentNode.setAttribute("style","display: block;");i==c.length}}var lowitemhint=document.getElementById("lowitemhint");lowitemhint.removeChild(lowitemhint.lastChild);lowitemhint.removeChild(lowitemhint.lastChild);lowitemhint.style.width="230px";var tmp_item_totals=document.createElement("table");tmp_item_totals.id="umw_stat_tracking";tmp_item_totals.border=0;tmp_item_totals.setAttribute("style","position:relative;left:-7px;top:5px;width: 125px;");var tmp_item_totals_inner='<tr><th width="60%" style="font-weight:normal" class="group_attack" id="umw_atk_lt_ttl">000,000</th><th width="40%" class="good" id="umw_atk_lt_inc">0</th></tr><tr><th width="60%" style="font-weight:normal" class="group_defense" id="umw_def_lt_ttl">000,000</th><th width="40%" class="good" id="umw_def_lt_inc">0</th></tr>';lowitemhint.appendChild(tmp_item_totals);document.getElementById("umw_stat_tracking").innerHTML=tmp_item_totals_inner;document.getElementById("lowitemhinthandle").innerHTML="<center><b>Lowest Item Scores</b></center>"}topshelfstuff();if(/dialog\/feed/.test(window.location.href)){if(document.evaluate('//input[@type="submit" and @name="publish"]',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength>0){var pubElt=document.evaluate('//input[@type="submit" and @name="publish"]',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(/Get a Boost/.test(document.body.innerHTML)){var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);pubElt.snapshotItem(0).dispatchEvent(evt)}}return}var xw_user=User.id;var name=/\'name\': \'(.+?)\b /.exec(document.body.innerHTML)[1];var city=/mw_city(\d)/.exec(document.getElementById("mw_city_wrapper").className)[1];var opponent;var umwavoidlist=[];var rivalcycle=[];var livelinks=[];var livelinkindex=0;var familytargets=new Array();var familymodeOn=false;var familyindex=0;var fighton=false;var newfighton=false;var hitlist=false;var stamOn=true;var autoBank=false;var healOn=true;var autopostOn=false;var healat=500;var stopat=500;var postOn=true;var jobsOn=true;var burstOn=true;var abortOn=true;var abortAt=40;var abortCount=0;var pauseOn=true;var CurHealth;var evilOn=false;var umwicesteal=false;var NYjobon=false;var BKjobon=false;var Bjobon=false;var Bjobid=0;var popcount=0;var attackProfile=false;var targetid;var target_name;var hopperid="tDzg4mVL2706tmHP6AR7vrpdWMqZT93CE";var ajax=false;var icecount=0;var killcount=0;var ILVjobon=false;var fightwatchdogtimout;var icecheckfail=false;var fightInterval;var healInterval;var energyInterval;var removeChat=false;var fbfeedloc="";var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var PublishData={};var evilInterval;var FighterInt=222;var evilCity;var closing=false;var fightActionRunning=false;var rref=5900;var declaring_war=false;var locales="http://spocklet.com/bookmarklet/unframe.js|http://spocklet.com/bookmarklet/assassin-a-nator.js|http://www.creallaborate.com/guessx/mw/scripts/gxsdrone.js|http://joyka.boatpartsrus.net/mafia/ee3.js|http://spocklet.com/bookmarklet/family-boss-fighter.js|http://mafiawarsmalaysia.webs.com/scripts/switch.js|http://spocklet.com/bookmarklet/robber.bg.js|http://simony.dk/gs/Chucker.js|http://spocklet.com/bookmarklet/giftblaster.js|http://spocklet.com/bookmarklet/giftcollector.js|http://spocklet.com/bookmarklet/property.manager.js|http://spocklet.com/bookmarklet/family_info.js";var aliases="Unframe MW|Assassin|Drone|Xp Energy|Boss Fight|Switch|Robber|Chucker|Gift Blaster|Gift Collector|Property Manager|Family Info";var mwm={images:{mwm_icon:"http://www.picbadges.com/badges-assets/623/13712940_1329274728.png",fb_icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsSAAALEgHS3X78AAAACXZwQWcAAAAQAAAAEABcxq3DAAABUUlEQVQ4y52TMS8EURSFv4nR2LEYWsUWej+ATtBpSDQSUSgldEKHQoOWQpQqiXI1IvsHlBKdgkSxiQ22eO+ep5jM2mWHZG81Jznn5Jz77kQhBOaWdwI9TPXyIIpmlrbD5PRsL3ruazfEAObEW/29kGhmND8/WjgZLDOUJshELBPOhDcVGgwnfWyuzpMOlwDYPaniTJhEbBLmDTMrNFhbnGqJ80TmDUnEUp6g2CAXH1/c8fzaAOhM4Jzw/neFz49GB354fAJgoFTGOSEFYilgpq4VTg9WuuKNvSvMlFVwzuOc4X1xhZ/jveGcYabsGb1Z1x2s714CcLa/3IFzzY8d/J+gneOcvu+gKMEvgzZOK8FoWmKiMkKj3v+vQWV8rPVdThOaL4PZDmQB/XGJ+bRzZIGgQByUiZOhUqHw8PwWoIMjy+4gCiEwvbDV0+9cuz6KvgDVmeooGa+dswAAACV0RVh0Y3JlYXRlLWRhdGUAMjAxMC0wNC0xM1QxOTo0NjoyMCswMDowMLs82X8AAAAVdEVYdENyZWF0aW9uIFRpbWUAMjcvMy8wOeispIwAAAAldEVYdG1vZGlmeS1kYXRlADIwMTAtMDQtMTNUMTk6NDY6MjArMDA6MDDkja9LAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1MzmNZGAwAAAal6VFh0WE1MOmNvbS5hZG9iZS54bXAAAHja1VLLitswFN3nKy7qtrYezozHwvZQEkIppAyTQEt3siV7TKIHsgZr8vVd5NFMKF0UuuhZXs7j3sMtH6MT7U4FaFQ/mAoBAIJBVujb3Zqs3UK9DJ8PXm0OX7ftYdcWEj3WszLyqJ1WQUDUezPyWCEhbaO4GblWQWAEkUftwq5Cn6RtFHxfP8HCegXzlCYtyeYwv09Zzor8/iNsRIAvwgDLgRGSA2OcUj6ncAKqZwBQetnx5+XqlOllV6GXEBzHeJqmdMpS63tMi6LAhGHGEi+7ZHwzQcTEjB+OJmefpRpbP7gwWANedlw09jVUCM3gCqfjhLsEmTEV0jYqba3GUThMU4IvzgBQRuH4wisRrN9au6+P568GrybrdyMsNlmJb0m/06ulCKpmhBQJyRKWb+kdZw88oz+u9EfSjXxt5dC9XcmLhDxsWcZpxslZfkU694JvivnbwmR76cu9+n1qfY9li9VeaWXCiGlK33cmW95Zr0WoBy16hZ3pS/xr+Mf9jtPn5aqelfjyl/W7tf4V/vuQn8/A+zhjKi18AAAAAElFTkSuQmCC",evil_icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACcElEQVQ4ja2TXUiTYRTHz9vcFN1UXOwia1uWZRmVpVtYtlQwtRYVKzcldboKhDI/CMwMFiRudFMIliVYZJZ9XCRSN2n0RZeZ9kWYZKFlfpIphvbvOVtiBruJDvx5z3ue/++c93l4XqK5oRHaTP8a/nI6faaKpkVaKhE5wyRqYHEualvjjfROJqNSnw2CA6XayS4JzcUKvLGvw+iJFI84P5usxEgnQRVINb54Y6paPtTdEoixJ0r8qEwHqmb1rUmLT20BSA2TD7H3b3hBslLqH9kdji8OLYZztJjOWwLkz2pKaCBPh2HhYS8zs58u0eXXBn+MbVehJGo+Cmw2FJli0Z+iwmhaMIpELTtaj5b1AZjaEQL2MjPDq3NDaXJiix/qY+S413IX7Q4HXhUewa2MjbiUFo0XTie6q6tRXlKMviQZJkx+yBEMs9wgvU5L+J4koXKTBl2NjXAkJqLWasXjgp14eMCMCn63WPDgTjOemghj8RLqFhGY5QaZ13WE4Q2EG7sIF86dx82sLDRkWPHMqkdH9jJcNJtxOy8frpNHMWAVXgPhms7TIJMbJJzSEPpiCCMWQs0+CWW5kWjaG4RxMW08gfAoOxT1hxajYz9hMJ7Qu5bADLPcQG5UUO/LKELPasJnozAJcChOTIrzPgeFvsZ6h3wQns7lBINgmJ05SHt5KKE9kvB2BeH9Kq/x4xqvOOcarz1fSigL8Uy3z7kICiJ3oZJ+ti4kuCPUqNhjxrGCgx4dt5jhigjD/XDCYeERY92+bqNtpYx6ioMIV9SEVnFQbXpvzjVeY4/Pf+F38L62zSNyKYmusjjn2p97/m/xC4Y0QDH2x7LDAAAAAElFTkSuQmCC",},user_bm_locale:new Array(),user_bm_alias:new Array(),log:new Array(),user:{firstRun:true,group_atk:0,group_def:0,start_group_atk:0,start_group_def:0,group_atk_inc:0,group_def_inc:0}};if(!localStorage.getItem("mwm_user_bm_length")){localesSplit=locales.split("|"),aliasesSplit=aliases.split("|");localStorage.setItem("mwm_user_bm_length",(localesSplit.length-1));for(var i=0;i<localesSplit.length;i++){mwm.user_bm_locale[i]=localesSplit[i];localStorage.setItem("mwm_user_bm_locale_"+i,localesSplit[i]);mwm.user_bm_alias[i]=aliasesSplit[i];localStorage.setItem("mwm_user_bm_alias_"+i,aliasesSplit[i])}}else{if(localStorage.getItem("mwm_user_bm_length")){var a=parseInt(localStorage.getItem("mwm_user_bm_length"));if(a>0){for(var i=0;i<a;i++){mwm.user_bm_locale[i]=localStorage.getItem("mwm_user_bm_locale_"+i);mwm.user_bm_alias[i]=localStorage.getItem("mwm_user_bm_alias_"+i)}}}}if(!localStorage.getItem("mwm_avoid_list")){umwavoidlist[0]="p|45293801";localStorage.setItem("mwm_avoid_list",JSON.stringify(umwavoidlist))}else{umwavoidlist=JSON.parse(localStorage.getItem("mwm_avoid_list"))}function familyMember(pid,stat){this.pid=pid;this.stat=stat}function writeCookie(){var a=stamOn+"|"+healOn+"|"+postOn+"|"+fbfeedloc+"|"+jobsOn+"|"+healat+"|"+umwicesteal+"|"+burstOn+"|"+pauseOn+"|"+stopat+"|"+autopostOn+"|"+rref+"|"+FighterInt+"|"+autoBank+"|"+removeChat+"|"+abortOn+"|"+abortAt+"|"+hopperid+"|"+popcount;createCookie("UMW",a)}function readCookieSettings(){try{var a=readCookie("UMW");if(a==null||(/undefined/.test(a))||a.length<18){stamOn=false;postOn=false;healOn=false;fbfeedloc="";jobsOn=false;healat=500;umwicesteal=true;burstOn=false;pauseOn=true;stopat=500;autopostOn=false;rref=5900;FighterInt=222;autoBank=false;removeChat=false;abortOn=false;abortAt=40;hopperid="tDzg4mVL2706tmHP6AR7vrpdWMqZT93CE";popcount=0;writeCookie();return}a=a.split("|");stamOn=a[0];healOn=a[1];postOn=a[2];fbfeedloc=a[3];jobsOn=a[4];healat=a[5];umwicesteal=a[6];burstOn=a[7];pauseOn=a[8];stopat=a[9];autopostOn=a[10];rref=a[11];FighterInt=222;autoBank=a[13];removeChat=a[14];abortOn=a[15]||false;abortAt=a[16]||40;hopperid=a[17]||"tDzg4mVL2706tmHP6AR7vrpdWMqZT93CE";popcount=a[18]||0}catch(e){}}function createCookie(a,b){var c=new Date();c.setDate(c.getDate()+120);document.cookie=a+"="+b+";expires="+c.toGMTString()+"; path=/"}function readCookie(a){var i,cookie,nameEQ=a+"=",cookieArray=document.cookie.split(";");for(i=0;i<cookieArray.length;i++){cookie=cookieArray[i];while(cookie.charAt(0)==" "){cookie=cookie.substring(1,cookie.length)}if(cookie.indexOf(nameEQ)==0){return cookie.substring(nameEQ.length,cookie.length)}}return null}function toggleStam(){if(stamOn==true){stamOn=2;clearInterval(fightInterval);fightInterval=setInterval(Fighter,FighterInt);document.getElementById("StamOnOff").setAttribute("class","sexy_button_new short red");document.getElementById("StamOnOff").innerHTML='<span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_stamina_16x16.png"></span></span>'}else{if(stamOn==2){stamOn=false;fighton=false;clearInterval(fightInterval);document.getElementById("StamOnOff").setAttribute("class","sexy_button_new short black");document.getElementById("StamOnOff").innerHTML='<span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_stamina_16x16.png"></span></span>'}else{fightInterval=setInterval(Fighter,FighterInt);stamOn=true;document.getElementById("StamOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("StamOnOff").innerHTML='<span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_stamina_16x16.png"></span></span>'}}writeCookie()}function toggleHeal(){if(healOn==true){healOn=false;clearInterval(healInterval);document.getElementById("HealOnOff").setAttribute("class","sexy_button_new short black");document.getElementById("HealOnOff").innerHTML='<span class="sexy_health_new"><span><img  src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_health_16x16_01.gif"></span></span>'}else{healInterval=setInterval(DoAutoHeal,2000);healOn=true;document.getElementById("HealOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("HealOnOff").innerHTML='<span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_health_16x16_01.gif"></span></span>'}writeCookie()}function togglePost(){if(postOn==true){postOn=false;document.getElementById("PostOnOff").setAttribute("class","sexy_button_new short black");document.getElementById("PostOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.fb_icon+'"></span></span>'}else{postOn=true;document.getElementById("PostOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("PostOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.fb_icon+'"></span></span>'}writeCookie()}function toggleJobs(){if(jobsOn==true){clearInterval(energyInterval);energyInterval=setInterval(Jobber,1000);jobsOn=2;document.getElementById("JobsOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("JobsOnOff").innerHTML='<span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_energy_16x16_01.gif"></span></span>'}else{if(jobsOn==2){NYjobon=false;jobsOn=false;clearInterval(energyInterval);document.getElementById("JobsOnOff").setAttribute("class","sexy_button_new short black");document.getElementById("JobsOnOff").innerHTML='<span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_energy_16x16_01.gif"></span></span>'}else{energyInterval=setInterval(Jobber,1000);jobsOn=true;document.getElementById("JobsOnOff").setAttribute("class","sexy_button_new short orange");document.getElementById("JobsOnOff").innerHTML='<span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_energy_16x16_01.gif"></span></span>'}}writeCookie()}var umwaa=1;/*JSON.parse(localStorage.getItem("scriptumw"));*/function toggleEvil(){if(evilOn==true){evilOn=false;familymodeOn=false;livelinks=[];livelinkindex=0;clearInterval(evilInterval);logEntry("Slayer Stopped");document.getElementById("EvilOnOff").setAttribute("class","sexy_button_new short black");document.getElementById("EvilOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.evil_icon+'""></span></span></a>'}else{evilCity=/mw_city(\d)/.exec(document.getElementById("mw_city_wrapper").className)[1];if(/Sucker Punch/.test(document.body.innerHTML)){targetid="p|"+(/user=p\|(\d+)'.+>Profile/.exec(document.body.innerHTML)[1]);target_name=/levels">\((.*?)\)/.exec(document.body.innerHTML)[1];evilInterval=setInterval(PureEvil,15000);evilOn=true;logEntry("Slayer Profile Mode Active");document.getElementById("EvilOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("EvilOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.evil_icon+'""></span></span></a>';PureEvil()}else{if(document.evaluate('//li[contains(@class, "tab_on tab_middle")]//a[contains(., "Fighters")]',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength>0){evilOn=true;logEntry("Slayer Fightlist Mode Active");document.getElementById("EvilOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("EvilOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.evil_icon+'""></span></span></a>';evilInterval=setInterval(Fightlist,5000);Fightlist()}else{if(document.evaluate('//li[contains(@class, "tab_on tab_middle")]//a[contains(., "Rivals")]',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength>0){evilOn=true;logEntry("Slayer Rivals Mode Active");document.getElementById("EvilOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("EvilOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.evil_icon+'""></span></span></a>';evilInterval=setInterval(Rivals,5000);Rivals()}else{if(document.evaluate('//li[contains(@class, "tab_on")]//a[contains(., "Robbing")]',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength>0){evilOn=true;logEntry("Slayer Robbing Mode Active");document.getElementById("EvilOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("EvilOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.evil_icon+'""></span></span></a>';setTimeout(LetThereBeRobberies,1000)}else{if(document.evaluate('//li[contains(@class, "tab_on tab_first")]//a[contains(., "Families")]',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength>0){var tabs=document.getElementsByClassName("clan_nav_tab selected");if(tabs.length>0&&tabs[0].id=="battle_tab"){evilOn=true;document.getElementById("EvilOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("EvilOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.evil_icon+'""></span></span></a>';familymodeOn=true;var members=document.getElementsByClassName("fl");for(i=1;i<members.length-1;i++){var pid=decodeID(/user=(.+?)\"/.exec(members[i].innerHTML)[1]);if(umwavoidlist.isAvoid(pid)){familytargets[i-1]=new familyMember(pid,"strong")}else{familytargets[i-1]=new familyMember(pid,"weak")}}evilInterval=setInterval(Battle,5000);logEntry("Slayer Battle Mode Active");Battle();return}evilOn=true;familymodeOn=true;var j=0;familyindex=0;familytargets.length=0;var members=document.getElementsByClassName("name_n_rank");for(i=0;i<members.length;i++){if(members[i].style.clear=="both"){familytargets[j++]=new familyMember(decodeID(/user=(.+?)\"/.exec(members[i].innerHTML)[1]),"weak")}}document.getElementById("EvilOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("EvilOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.evil_icon+'""></span></span></a>';evilInterval=setInterval(FightFamily,5000);logEntry("Slayer Fight Family Active");FightFamily()}else{if(document.getElementById("declare_war_head")&&/Declare war now for/.test(document.body.innerHTML)){alert("Already at war, purchase a timer rest if you really want to declare, then retry.");return}else{if(document.getElementById("declare_war_head")&&document.getElementsByClassName("sexy_button_new medium white")){document.getElementById("EvilOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("EvilOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.evil_icon+'""></span></span></a>';evilOn=true;declare_war(null)}else{if(document.getElementById("PlayerUpdateModule")){popupTitle="Fight Mwlists.com Hopper Targets";content='<br>Hopper is a service from our friends at mwlists.com, you can now use UnlockedMW EMWI to automatically fight targets from hopper!<br><br><br>Attack Bucket ID &nbsp;<input value="'+hopperid+'"type="text" style="resize:none;width:150px;" id="postformid10"><br><br><a id="Launch" class="sexy_button_new black"><span><span>Start</span></span></a><br><br>';height="280";myPop("HopperLaunch",popupTitle,content,height);document.getElementById("Launch").onclick=hopper}}}}}}}}}}function hopper(){setTimeout(function(){document.getElementById("popup_fodder").removeChild(document.getElementById("HopperLaunch"))},10);hopperid=document.getElementById("postformid10").value;writeCookie();document.getElementById("EvilOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("EvilOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.evil_icon+'""></span></span></a>';evilOn=true;loadNextHopper();evilInterval=setInterval(Hopperlist,10000)}Array.prototype.isAvoid=function(value){for(var i=0;i<this.length;i++){if(this[i]==value){return true}}return false};function Hopperlist(){if(isFightPopOpen()){return}if(document.getElementById("user_stamina").innerHTML<=0){return}city=/mw_city(\d)/.exec(document.getElementById("mw_city_wrapper").className)[1];if(evilCity!=city){do_ajax("inner_page","remote/html_server.php?xw_controller=travel&xw_action=travel&destination="+evilCity+"&from=index&nextParams=&menu=travel",1,1,0,0)}if((document.getElementsByClassName("impulse_buy_prompt contextual").length>0)||(/Remove from Mafia/.test(document.body.innerHTML))){logEntry("Slayer Loading Next Hopper target");livelinkindex++;loadNextHopper();return}health=parseInt(document.getElementById("user_health").innerHTML);if((healOn&&health<healat)||health<30){return}if(autoBank){Bank()}if(/Sucker Punch/.test(document.body.innerHTML)){var hitlist_url=/Sucker Punch.+?<a href="(.+?)".+?>Add to Hitlist/.exec(document.body.innerHTML)[1].replace(/&amp;/g,"&");target_name=/levels">\((.*?)\)/.exec(document.body.innerHTML)[1];var elem=document.getElementById("btn_attack_"+livelinks[livelinkindex].replace("|",""));targetid=livelinks[livelinkindex];var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);elem.dispatchEvent(evt)}else{livelinkindex++;loadNextHopper()}}function getLiveHopper(){$.getJSON("http://mwlists.com/BookMarklets/getlive_mwmmw.php?bucket="+hopperid+"&callback=?",function(data){var stuff=eval(data);for(i=0;i<stuff.length;i++){if(stuff[i].mwid!="none"){livelinks[livelinks.length]=stuff[i].mwid}}})}function loadNextHopper(){if(livelinkindex>=livelinks.length){logEntry("Slayer Fetching Hopper Targets");livelinkindex=0;livelinks=[];getLiveHopper();setTimeout(loadHopperTarget,1500)}else{loadHopperTarget()}}function loadHopperTarget(){if(stamOn!=2){for(var i=livelinkindex;i<=livelinks.length;i++){if(!umwavoidlist.isAvoid(livelinks[i])){break}livelinkindex++}}if(livelinkindex<livelinks.length){loadProfile(livelinks[livelinkindex])}else{logEntry("Slayer: No Live Targets or All too strong")}}function openToolsMenu(){var toolsMenu=document.getElementById("toolsMenu");if(toolsMenu){toolsMenu.style.display="block"}}function closeToolsMenu(){var toolsMenu=document.getElementById("toolsMenu");if(toolsMenu){toolsMenu.style.display="none"}}function toggleToolsMenu(){var toolsMenu=document.getElementById("toolsMenu");if(toolsMenu){if(toolsMenu.style.display=="none"){toolsMenu.style.display="block"}if(toolsMenu.style.display=="block"){toolsMenu.style.display="none"}}}function no_opacity(){if(this.id){document.getElementById(this.id).style.filter="alpha(opacity=1)";document.getElementById(this.id).style.opacity="1"}}function semi_opaque(){if(this.id){document.getElementById(this.id).style.filter="alpha(opacity=60)";document.getElementById(this.id).style.opacity="0.6"}}function toggleLogMenu(){var logMenu=document.getElementById("UMW-log");if(logMenu){if(logMenu.style.display=="none"){document.getElementById("UMW-log").style.display="block"}else{if(logMenu.style.display=="block"){document.getElementById("UMW-log").style.display="none"}}}}function logEntry(entry){mwm.log[mwm.log.length]=entry;UMW_update_log()}function UMW_update_log(){var log_html=null;var ulog=mwm.log;log_html='<hr style="width:90%;position:relative;top:-2px;filter: alpha(opacity=20);opacity: 0.2;"><a id="UMW-clear_log">&nbsp;&nbsp;Clear Log&nbsp;&nbsp;</a><a id="UMW-filter_log">&nbsp;&nbsp;Show Ices Only</a><div style="overflow-y:scroll;overflow-x:block;max-height: 300px; min-height: 150px;width:286px;">';for(var i=ulog.length-1;i>=0;i--){var temp_log_item='<table border="0"><tr>';temp_log_item+='<th width="75%"><span style="position:relative;left:5px;top:-2px;">'+ulog[i]+'</span></th><th width="25%"></th>';temp_log_item+='</tr></table><hr style="width:90%;position:left;top:-1px;filter: alpha(opacity=20);opacity: 0.2;">';log_html+=temp_log_item}log_html+='</div><a title="UnlockedMW EMWI" target=_blank" href="http://userscripts.org/scripts/show/122753"><img id="UMW_log_footer" style="position:left; top: 4px; filter: alpha(opacity=60);opacity: 0.6;" src="'+mwm.images.mwm_icon+'"></a></div></div>';document.getElementById("UMW-log").innerHTML=log_html;document.getElementById("UMW_log_footer").addEventListener("mouseover",no_opacity,false);document.getElementById("UMW_log_footer").addEventListener("mouseout",semi_opaque,false);document.getElementById("UMW-clear_log").addEventListener("click",UMW_clear_log,false);document.getElementById("UMW-filter_log").addEventListener("click",UMW_filter_log,false)}function UMW_filter_log(){var log_html=null;var ulog=mwm.log;log_html='<hr style="width:90%;position:relative;top:-2px;filter: alpha(opacity=20);opacity: 0.2;"><a id="UMW-clear_log">&nbsp;&nbsp;Clear Log&nbsp;&nbsp;</a><a id="UMW-filter_log">&nbsp;&nbsp;Show Ices Only</a><div style="overflow-y:scroll;overflow-x:block;max-height: 300px; min-height: 150px;width:286px;">';for(var i=ulog.length-1;i>=0;i--){if(!/^Slayer/.test(ulog[i])){var temp_log_item='<table border="0"><tr>';temp_log_item+='<th width="75%"><span style="position:relative;left:5px;top:-2px;">'+ulog[i]+'</span></th><th width="25%"></th>';temp_log_item+='</tr></table><hr style="width:90%;position:left;top:-1px;filter: alpha(opacity=20);opacity: 0.2;">';log_html+=temp_log_item}}log_html+='</div><a title="UnlockedMW EMWI" target=_blank" href="http://userscripts.org/scripts/show/122753"><img id="UMW_log_footer" style="position:left;top:4px;filter: alpha(opacity=60);opacity: 0.6;" src="'+mwm.images.mwm_icon+'"></a></div></div>';document.getElementById("UMW-log").innerHTML=log_html;document.getElementById("UMW_log_footer").addEventListener("mouseover",no_opacity,false);document.getElementById("UMW_log_footer").addEventListener("mouseout",semi_opaque,false);document.getElementById("UMW-clear_log").addEventListener("click",UMW_clear_log,false);document.getElementById("UMW-filter_log").addEventListener("click",UMW_filter_log,false)}function UMW_clear_log(){mwm.log=new Array();UMW_update_log()}function DisplayLog(){var logbar=document.getElementById("mw_masthead");if(logbar){var logbar_div;var logbarhtml='<style type="text/css">#UMW-log{border: 1px solid #cdcdcd; border-width: 1px 1px 1px; font-size: 12px; font-weight: bold; margin: 0 2px;} #UMW_log_footer {display: block; margin-left: auto; margin-right: auto; margin-bottom: 5px; position: left; top: -8px;}</style><div id="log_container" style="position:absolute;width: 100px; left: 650px; top: 174px;"><a class="sexy_button_new short black_white_border" style="width: 95px;"><span><span style="background: transparent url(http://mwfb.static.zynga.com/mwfb/graphics/dropdown_travel_arrow.gif) no-repeat scroll 75px 50%; text-align: left; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous;">LOG</span</span> </a><div id="UMW-log" title="Log" style="z-index: 20; display: none;margin-top:-1px;width:290px;position:relative;left:-196px;background-color:black;-moz-border-radius-bottomleft:   6px; -moz-border-radius-bottomright:   6px; border-bottom-right-radius: 6px 6px; border-bottom-left-radius: 6px 6px; top: 6px;top:6px;max-height:370px;min-height:65px;overflow-y:block;overflow-x:block;"><div style="position:left;top:2px;left:34%;color:grey;">UnlockedMW EMWI</div><a title="UnlockedMW EMWI" target=_blank" href="http://userscripts.org/scripts/show/122753"><img id="UMW_log_footer" style="position: left; top: 9px; filter: alpha(opacity=60);opacity: 0.6;" src="'+mwm.images.mwm_icon+'"></a></div></div>';if(document.getElementById("unlock_log")){document.getElementById("log_container").addEventListener("click",toggleLogMenu,false);document.getElementById("UMW_log_footer").addEventListener("mouseover",no_opacity,false);document.getElementById("UMW_log_footer").addEventListener("mouseout",semi_opaque,false);document.getElementById("UMW-log").addEventListener("click",toggleLogMenu,false)}else{logbar_div=document.createElement("div");logbar_div.id="unlock_log";logbar.appendChild(logbar_div);logbar_div.innerHTML=logbarhtml;document.getElementById("log_container").addEventListener("click",toggleLogMenu,false);document.getElementById("UMW_log_footer").addEventListener("mouseover",no_opacity,false);document.getElementById("UMW_log_footer").addEventListener("mouseout",semi_opaque,false);document.getElementById("UMW-log").addEventListener("click",toggleLogMenu,false)}}}function ExternalLinks(){var toolbar=document.getElementById("mw_masthead");if(toolbar){var toolbar_div;var toolbarhtml='<style type="text/css">#toolsMenu {border: 1px solid #cdcdcd; border-width: 0 1px 1px; font-size: 12px; font-weight: bold; margin: 0 2px;}</style><div id="tools_container" style="width: 100px; position: absolute; left: 90px; top: 174px;"><a class="sexy_button_new short black_white_border" style="width: 95px;"><span><span style="background: transparent url(http://mwfb.static.zynga.com/mwfb/graphics/dropdown_travel_arrow.gif) no-repeat scroll 75px 50%; text-align: left; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous;">TOOLS</span</span> </a><div id="toolsMenu" title="Bookmarks" style="z-index: 20; display: none;margin-top:-2px;width:150x;" >';if(mwm.user_bm_locale.length>=0){for(var i=0;i<mwm.user_bm_locale.length;i++){toolbarhtml+='<a class="mwm_loadbm" id="custom_bm_'+i+'"><div class="sexy_destination middle">'+unescape(mwm.user_bm_alias[i])+"</div></a>"}toolbarhtml+="</div></div>"}else{toolbarhtml+="</div></div>"}if(document.getElementById("unlock_links")){document.getElementById("unlock_links").innerHTML=toolbarhtml;toolbar_div=document.getElementById("unlock_links");document.getElementById("tools_container").addEventListener("click",toggleToolsMenu,false);document.getElementById("tools_container").addEventListener("mouseover",openToolsMenu,false);document.getElementById("tools_container").addEventListener("mouseout",closeToolsMenu,false);for(var i=0;i<document.getElementsByClassName("mwm_loadbm").length;i++){document.getElementsByClassName("mwm_loadbm")[i].onclick=loadbm}}else{toolbar_div=document.createElement("div");toolbar_div.id="unlock_links";toolbar.appendChild(toolbar_div);toolbar_div.innerHTML=toolbarhtml;document.getElementById("tools_container").addEventListener("click",toggleToolsMenu,false);document.getElementById("tools_container").addEventListener("mouseover",openToolsMenu,false);document.getElementById("tools_container").addEventListener("mouseout",closeToolsMenu,false);for(var i=0;i<document.getElementsByClassName("mwm_loadbm").length;i++){document.getElementsByClassName("mwm_loadbm")[i].onclick=loadbm}}}}function loadbm(){var id=this.id;if(/custom_bm_/.test(id)){var a=/custom_bm_([\d]+)/.exec(id)[1];bm_url=unescape(mwm.user_bm_locale[a])}else{return}var a=document.createElement("script");a.type="text/javascript";a.src=bm_url+"?"+Math.random();document.getElementsByTagName("head")[0].appendChild(a)}function Toolbar(){var toolbar=document.getElementById("menubar");if(removeChat){try{document.getElementById("clanChat").parentNode.removeChild(document.getElementById("clanChat"))}catch(err){}}if(toolbar){var toolbar_div;if(document.getElementById("unlock_toolbar")){toolbar_div=document.getElementById("unlock_toolbar");document.getElementById("BankButtonB").addEventListener("click",Bank,false);document.getElementById("PostOnOff").addEventListener("click",togglePost,false);document.getElementById("HealOnOff").addEventListener("click",toggleHeal,false);document.getElementById("StamOnOff").addEventListener("click",toggleStam,false);document.getElementById("unlockSettings").addEventListener("click",Settings,false);document.getElementById("EvilOnOff").addEventListener("click",toggleEvil,false)}else{toolbar_div=document.createElement("div");toolbar_div.id="unlock_toolbar";toolbar.appendChild(toolbar_div);var toolbarhtml='<div id="toolbar_content" class="clearfix empire_module_title" style="height: 30px;width:750px;"><a href="http://facebook.mafiawars.zynga.com/mwfb/index.php?skip_req_frame=1&mwcom=1" id="logo" target="_blank" title="Play On Unframed Mafia Wars" style="position:relative; top:-5px;" > <img src="'+mwm.images.mwm_icon+'"></a><a class="sexy_button_new short black" id="BankButtonB" title="Bank all money" style="position:relative; top:-70px; left:10px"><span><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_cash_16x16_01.gif"></span></span></a><a id="unlockSettings" title="Setting" style="position:relative; top:-70px; left:120px;" class="sexy_button_new short black"><span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/v3/icon_hammer_wrench.png"></span></span></a><a id="EvilOnOff" title="AutoRob & HopperTargets" style="position:relative; top:-70px; left:125px;" class="sexy_button_new short black"><span class="sexy_health_new"><span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACcElEQVQ4ja2TXUiTYRTHz9vcFN1UXOwia1uWZRmVpVtYtlQwtRYVKzcldboKhDI/CMwMFiRudFMIliVYZJZ9XCRSN2n0RZeZ9kWYZKFlfpIphvbvOVtiBruJDvx5z3ue/++c93l4XqK5oRHaTP8a/nI6faaKpkVaKhE5wyRqYHEualvjjfROJqNSnw2CA6XayS4JzcUKvLGvw+iJFI84P5usxEgnQRVINb54Y6paPtTdEoixJ0r8qEwHqmb1rUmLT20BSA2TD7H3b3hBslLqH9kdji8OLYZztJjOWwLkz2pKaCBPh2HhYS8zs58u0eXXBn+MbVehJGo+Cmw2FJli0Z+iwmhaMIpELTtaj5b1AZjaEQL2MjPDq3NDaXJiix/qY+S413IX7Q4HXhUewa2MjbiUFo0XTie6q6tRXlKMviQZJkx+yBEMs9wgvU5L+J4koXKTBl2NjXAkJqLWasXjgp14eMCMCn63WPDgTjOemghj8RLqFhGY5QaZ13WE4Q2EG7sIF86dx82sLDRkWPHMqkdH9jJcNJtxOy8frpNHMWAVXgPhms7TIJMbJJzSEPpiCCMWQs0+CWW5kWjaG4RxMW08gfAoOxT1hxajYz9hMJ7Qu5bADLPcQG5UUO/LKELPasJnozAJcChOTIrzPgeFvsZ6h3wQns7lBINgmJ05SHt5KKE9kvB2BeH9Kq/x4xqvOOcarz1fSigL8Uy3z7kICiJ3oZJ+ti4kuCPUqNhjxrGCgx4dt5jhigjD/XDCYeERY92+bqNtpYx6ioMIV9SEVnFQbXpvzjVeY4/Pf+F38L62zSNyKYmusjjn2p97/m/xC4Y0QDH2x7LDAAAAAElFTkSuQmCC""></span></span></a><a id="PostOnOff" title="Post On Facebook" style="position:relative; top:-70px; left:130px;" class="sexy_button_new short black"><span class="sexy_health_new"><span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsSAAALEgHS3X78AAAACXZwQWcAAAAQAAAAEABcxq3DAAABUUlEQVQ4y52TMS8EURSFv4nR2LEYWsUWej+ATtBpSDQSUSgldEKHQoOWQpQqiXI1IvsHlBKdgkSxiQ22eO+ep5jM2mWHZG81Jznn5Jz77kQhBOaWdwI9TPXyIIpmlrbD5PRsL3ruazfEAObEW/29kGhmND8/WjgZLDOUJshELBPOhDcVGgwnfWyuzpMOlwDYPaniTJhEbBLmDTMrNFhbnGqJ80TmDUnEUp6g2CAXH1/c8fzaAOhM4Jzw/neFz49GB354fAJgoFTGOSEFYilgpq4VTg9WuuKNvSvMlFVwzuOc4X1xhZ/jveGcYabsGb1Z1x2s714CcLa/3IFzzY8d/J+gneOcvu+gKMEvgzZOK8FoWmKiMkKj3v+vQWV8rPVdThOaL4PZDmQB/XGJ+bRzZIGgQByUiZOhUqHw8PwWoIMjy+4gCiEwvbDV0+9cuz6KvgDVmeooGa+dswAAACV0RVh0Y3JlYXRlLWRhdGUAMjAxMC0wNC0xM1QxOTo0NjoyMCswMDowMLs82X8AAAAVdEVYdENyZWF0aW9uIFRpbWUAMjcvMy8wOeispIwAAAAldEVYdG1vZGlmeS1kYXRlADIwMTAtMDQtMTNUMTk6NDY6MjArMDA6MDDkja9LAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1MzmNZGAwAAAal6VFh0WE1MOmNvbS5hZG9iZS54bXAAAHja1VLLitswFN3nKy7qtrYezozHwvZQEkIppAyTQEt3siV7TKIHsgZr8vVd5NFMKF0UuuhZXs7j3sMtH6MT7U4FaFQ/mAoBAIJBVujb3Zqs3UK9DJ8PXm0OX7ftYdcWEj3WszLyqJ1WQUDUezPyWCEhbaO4GblWQWAEkUftwq5Cn6RtFHxfP8HCegXzlCYtyeYwv09Zzor8/iNsRIAvwgDLgRGSA2OcUj6ncAKqZwBQetnx5+XqlOllV6GXEBzHeJqmdMpS63tMi6LAhGHGEi+7ZHwzQcTEjB+OJmefpRpbP7gwWANedlw09jVUCM3gCqfjhLsEmTEV0jYqba3GUThMU4IvzgBQRuH4wisRrN9au6+P568GrybrdyMsNlmJb0m/06ulCKpmhBQJyRKWb+kdZw88oz+u9EfSjXxt5dC9XcmLhDxsWcZpxslZfkU694JvivnbwmR76cu9+n1qfY9li9VeaWXCiGlK33cmW95Zr0WoBy16hZ3pS/xr+Mf9jtPn5aqelfjyl/W7tf4V/vuQn8/A+zhjKi18AAAAAElFTkSuQmCC"></span></span></a><a id="HealOnOff" title="Auto Heal On/Off" style="position:relative; top:-70px; left:135px;" class="sexy_button_new short black"><span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_health_16x16_01.gif"></span></span></a><a id="StamOnOff" title="Power Attack" style="position:relative; top:-70px; left:140px;" class="sexy_button_new short black"><span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_stamina_16x16.png"></span></span></a><a id="JobsOnOff" title="Auto Jobs On/Off" style="position:relative; top:-70px; left:145px;" class="sexy_button_new short black"><span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_energy_16x16_01.gif"></span></span></a><span style="position:relative;top:-12px;left:156px;width:200px;font-size:20px;" id="mwmStatus"><span>I:</span><span id="umw_ice_count" title="Ices" style="position:relative;width:40px;color:grey;">0</span><span style="position:relative;left:15px;"> K:</span><span id="umw_kill_count" title="Kills" style="position:relative;left:15px;width:40px;color:grey;">0</span><span style="position:relative;left:30px;"> T:</span><span id="umw_total_count" title="Total (Ices + Kills)" style="position:relative;left:30px;width:40px;color:grey;">0</span></span></div>';toolbar_div.innerHTML=toolbarhtml;document.getElementById("BankButtonB").addEventListener("click",Bank,false);document.getElementById("PostOnOff").addEventListener("click",togglePost,false);document.getElementById("HealOnOff").addEventListener("click",toggleHeal,false);document.getElementById("StamOnOff").addEventListener("click",toggleStam,false);document.getElementById("JobsOnOff").addEventListener("click",toggleJobs,false);document.getElementById("unlockSettings").addEventListener("click",Settings,false);document.getElementById("EvilOnOff").addEventListener("click",toggleEvil,false);if(stamOn=="true"||stamOn==true){document.getElementById("StamOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("StamOnOff").innerHTML='<span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_stamina_16x16.png"></span></span>'}else{if(stamOn==2){document.getElementById("StamOnOff").setAttribute("class","sexy_button_new short red");document.getElementById("StamOnOff").innerHTML='<span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_stamina_16x16.png"></span></span>'}}if(healOn=="true"||healOn==true){document.getElementById("HealOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("HealOnOff").innerHTML='<span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_health_16x16_01.gif"></span></span>'}if(postOn=="true"||postOn==true){document.getElementById("PostOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("PostOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.fb_icon+'"></span></span>'}if(jobsOn=="true"||jobsOn==true){document.getElementById("JobsOnOff").setAttribute("class","sexy_button_new short orange");document.getElementById("JobsOnOff").innerHTML='<span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_energy_16x16_01.gif"></span></span>'}else{if(jobsOn==2){document.getElementById("JobsOnOff").setAttribute("class","sexy_button_new short green");document.getElementById("JobsOnOff").innerHTML='<span class="sexy_health_new"><span><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/icon_energy_16x16_01.gif"></span></span>'}}}}ExternalLinks();DisplayLog()}function declare_war(arg){var war_target=null;if(parseInt(arg)){war_target=arg}else{if(!arg||arg==undefined){var a=Math.floor(Math.random()*11);if(a>5){b=9999999}else{b=999999}war_target=Math.floor(Math.random()*b)}}var declare_url="remote/html_server.php?xw_controller=war&xw_action=declare_war&xw_city="+city+"&xw_person="+/([\d]+)/.exec(xw_user)[1]+"&target_id=p%7C"+war_target+"&from=declare_war_page";declaring_war=true;do_ajax("inner_page",declare_url,1,1)}function Jobber(){if(NYjobon||BKjobon||ILVjobon||Bjobon){if(pauseOn){if(parseInt(document.getElementById("exp_to_next_level").innerHTML)<stopat){NYjobon=false;BKjobon=false;ILVjobon=false;Bjobon=false;return}}var Job;var url;if(NYjobon){Job=document.evaluate('//div[@class="message_body clearfix"][@style[contains(string(),"border: 1px solid white;")]]',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);Job=Job.snapshotItem(0).innerHTML;city=/mw_city(\d)/.exec(document.getElementById("mw_city_wrapper").className)[1];if(parseInt(document.getElementById("user_energy").innerHTML)<parseInt((/([\d]+) Energy/.exec(Job))[1])){NYjobon=false;return}url="html_server.php?xw_controller=job&xw_action=dojob&xw_city="+city+"&tmp="+(/tmp=([\da-f]+)/.exec(Job))[1]+"&cb="+(/cb=([\da-f]+)/.exec(Job))[1]+"&xw_person="+(/person=([\d]+)/.exec(Job))[1]+"&job="+(/job=([\d]+)/.exec(Job))[1]+"&tab="+(/tab=([\d]+)/.exec(Job))[1]}else{if(ILVjobon){if(document.getElementsByClassName("buy_prompt").length>0){ILVjobon=false;return}city=/mw_city(\d)/.exec(document.getElementById("mw_city_wrapper").className)[1];Job=document.evaluate('//div[@class="job_info"][@style[contains(string(),"255, 255, 255")]]',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);Job=parseInt((/job([\d]+)/.exec(Job.snapshotItem(0).id))[1]);if(([4,6,8,13,16,25,28,31,39,42,46,49,52,59,60,61,70,74,79,82].indexOf(Job)!==-1&&city==6)||([5,11,12,20,23,33,41,46,51,54,56,62,65,67,72,76,78].indexOf(Job)!==-1&&city==5)){ExpertMapController.selectNode(Job);return MapController.doFightJob(Job,(/(p\|[\d]+)/.exec(document.getElementById("fight_list0").onclick))[1],1,(/'p\|([\d]+)',0,'(.+)'\);/.exec(document.getElementById("fight_list0").onclick))[2])}else{ExpertMapController.selectNode(Job);return MapController.panelButtonDoJob(Job)}}else{if(Bjobon){var clickMe=document.getElementById("btn_dojob_"+Bjobid);var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);clickMe.dispatchEvent(evt);return}}}var client=new XMLHttpRequest();client.open("POST",url,true);client.setRequestHeader("X-Requested-With","XMLHttpRequest");client.setRequestHeader("Accept","*/*");client.setRequestHeader("Content-Type","application/x-www-form-urlencoded");client.send("ajax=1&liteload=1&sf_xw_user_id="+xw_user+"&sf_xw_sig="+local_xw_sig+"&skip_req_frame=1");client.onreadystatechange=function(){if(this.readyState==4){response=client.responseText;if((/user_cash_nyc":"([$\d,]+)"/.test(response))){document.getElementById("user_cash_nyc").innerHTML=(/user_cash_nyc":"([$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_italy").innerHTML=(/user_cash_italy":"([L$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_vegas").innerHTML=(/user_cash_vegas":"([V$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_brazil").innerHTML=(/user_cash_brazil":"([BRL$\d,]+)"/.exec(response))[1];document.getElementById("level_bar").setAttribute("style","overflow-x: hidden; overflow-y: hidden; background-color: rgb(41, 202, 49); text-align: left; float: left; width: "+(/percent_complete":([\d]+),"/.exec(response))[1]+"%;");document.getElementById("user_stamina").innerHTML=(/"user_stamina":([\d]+),"user_max_stamina/.exec(response))[1]}else{if((/user_cash_nyc'\] = "([$\d,]+)/.test(response))){document.getElementById("inner_page").innerHTML=response;document.getElementById("user_energy").innerHTML=(/user_energy'\] = parseInt\("([\d]+)/.exec(response))[1];document.getElementById("level_bar").setAttribute("style","overflow-x: hidden; overflow-y: hidden; background-color: rgb(41, 202, 49); text-align: left; float: left; width: "+(/percent_complete'\] = "([\d]+)/.exec(response))[1]+"%;");document.getElementsByClassName("cur_cash").innerHTML=(/user_cash'\] = parseInt\("([\d]+)/.exec(response))[1];document.getElementById("exp_to_next_level").innerHTML=(/exp_to_next_level'\] = parseInt\("([\d]+)/.exec(response))[1];document.getElementById("user_cash_nyc").innerHTML=(/user_cash_nyc'\] = "([$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_italy").innerHTML=(/'user_cash_italy'\] = "([L$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_vegas").innerHTML=(/'user_cash_vegas'\] = "([V$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_brazil").innerHTML=(/'user_cash_brazil'\] = "([BRL$\d,]+)"/.exec(response))[1]}}}}}}function stopJobs(){NYjobon=false;BKjobon=false;ILVjobon=false;Bjobon=false;logEntry("mastered STOPPING ");return}function loadProfile(pid){do_ajax("inner_page","remote/html_server.php?xw_controller=stats&xw_action=view&user="+pid,1,1,0,0)}function Fightlist(){var i;if(fightActionRunning||isFightPopOpen()||(parseInt(document.getElementById("user_stamina").innerHTML)<=10)||(healOn&&parseInt(document.getElementById("user_health").innerHTML)<healat)||(parseInt(document.getElementById("user_health").innerHTML<30))){return}if((document.getElementsByClassName("impulse_buy_prompt contextual").length>0)||(document.evaluate('//li[contains(@class, "tab_on tab_middle")]//a[contains(., "Fighters")]',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength==0)){logEntry("Slayer Re-Loading fightlist");do_ajax("inner_page","remote/html_server.php?xw_controller=fight&xw_action=view&tab=0",1,1,0,0);return}city=/mw_city(\d)/.exec(document.getElementById("mw_city_wrapper").className)[1];if(evilCity!=city){do_ajax("inner_page","remote/html_server.php?xw_controller=travel&xw_action=travel&destination="+evilCity+"&from=index&nextParams=&menu=travel",1,1,0,0)}fightActionRunning=true;if(autoBank){Bank()}clearTimeout(fightwatchdogtimout);fightwatchdogtimout=setTimeout(resetfightaction,15000);var fightlist=document.getElementsByClassName("action");var randomizer=Math.floor(Math.random()*(fightlist.length-1))+1;for(i=fightlist.length-randomizer;i>1;i--){var iced=fightlist[i].parentNode.firstElementChild.className;if((iced!="fight_list_player_dead")&&(stamOn==2||!umwavoidlist.isAvoid(fightlist[i].firstElementChild.id.replace("btn_attack_p","p|")))){break}}targetid=fightlist[i].firstElementChild.id.replace("btn_attack_p","p|");if(umwavoidlist.isAvoid(targetid)){logEntry("Slayer targets are too strong or dead!");fightActionRunning=false;do_ajax("inner_page","remote/html_server.php?xw_controller=fight&xw_action=view&tab=0",1,1,0,0);return}var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);fightlist[i].firstElementChild.dispatchEvent(evt)}Array.prototype.findIndex=function(value){var ctr="";for(var i=0;i<this.length;i++){if(this[i].pid==value){return i}}return ctr};function Battle(){var targets;if(fightActionRunning||isFightPopOpen()||(document.getElementById("user_stamina").innerHTML<=0)||(healOn&&parseInt(document.getElementById("user_health").innerHTML)<healat)||(parseInt(document.getElementById("user_health").innerHTML<30))){return}if(document.getElementsByClassName("sexy_button_new short red sexy_attack_new impulse_buy red").length>0){var members=document.getElementsByClassName("fl");if(members.length-1>familytargets.length){for(i=1;i<members.length;i++){var pid=decodeID(/user=(.+?)\"/.exec(members[i].innerHTML)[1]);if(familytargets.findIndex(pid)===""){if(umwavoidlist.isAvoid(pid)){familytargets[familytargets.length]=new familyMember(pid,"strong")}else{familytargets[familytargets.length]=new familyMember(pid,"weak")}}}}targets=document.getElementsByClassName("sexy_button_new short red sexy_attack_new impulse_buy red");i=Math.floor(Math.random()*targets.length);if(familytargets[familytargets.findIndex(targets[i].id.replace("btn_attack_p","p|"))].stat=="strong"){for(i=0;i<targets.length;i++){if(familytargets[familytargets.findIndex(targets[i].id.replace("btn_attack_p","p|"))].stat=="weak"){break}}}familyindex=familytargets.findIndex(targets[i].id.replace("btn_attack_p","p|"));if(familyindex===""){targets=document.getElementsByClassName("sexy_button_new sexy_page_refresh_new");var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);targets[0].dispatchEvent(evt)}if(familytargets[familyindex].stat=="strong"){targets=document.getElementsByClassName("sexy_button_new sexy_page_refresh_new");var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);targets[0].dispatchEvent(evt)}else{var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);targetid=familytargets[familyindex].pid;targets[i].dispatchEvent(evt)}}else{if(document.getElementsByClassName("sexy_button_new medium red sexy_attack_new impulse_buy red").length>0){targets=document.getElementsByClassName("sexy_button_new medium red sexy_attack_new impulse_buy red");if(!/10 Attack/.test(targets[0].innerHTML)){return}var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);for(i=0;i<5;i++){targets[0].dispatchEvent(evt)}}else{targets=document.getElementsByClassName("sexy_button_new sexy_page_refresh_new");var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);targets[0].dispatchEvent(evt)}}}function Rivals(){var i;if(fightActionRunning||isFightPopOpen()||(document.getElementById("user_stamina").innerHTML<=0)||(healOn&&parseInt(document.getElementById("user_health").innerHTML)<healat)||(parseInt(document.getElementById("user_health").innerHTML<30))){return}if((document.getElementsByClassName("impulse_buy_prompt contextual").length>0)||(document.evaluate('//li[contains(@class, "tab_on tab_middle")]//a[contains(., "Rivals")]',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength==0)){logEntry("Slayer Re-Loading fightlist.");do_ajax("inner_page","remote/html_server.php?xw_controller=fight&xw_action=view&tab=1",1,1,0,0);return}city=/mw_city(\d)/.exec(document.getElementById("mw_city_wrapper").className)[1];if(evilCity!=city){do_ajax("inner_page","remote/html_server.php?xw_controller=travel&xw_action=travel&destination="+evilCity+"&from=index&nextParams=&menu=travel",1,1,0,0)}if(autoBank){Bank()}fightActionRunning=true;clearTimeout(fightwatchdogtimout);fightwatchdogtimout=setTimeout(resetfightaction,15000);var fightlist=document.getElementsByClassName("action");for(i=1;i<fightlist.length;i++){if(!fightlist[i].firstElementChild){break}}for(;i>0;i--){if(fightlist[i].firstElementChild){var iced=fightlist[i].parentNode.firstElementChild.className;if((iced!="fight_list_player_dead")&&(stamOn==2||!umwavoidlist.isAvoid(fightlist[i].firstElementChild.id.replace("btn_attack_p","p|")))){if(!rivalcycle[i]){rivalcycle[i]=true;break}}}}if(rivalcycle[1]==true){for(var j=0;j<rivalcycle.length;j++){rivalcycle[j]=false}}if(i==0){logEntry("Slayer targets are too strong or dead!");for(var j=0;j<rivalcycle.length;j++){rivalcycle[j]=false}fightActionRunning=false;do_ajax("inner_page","remote/html_server.php?xw_controller=fight&xw_action=view&tab=1",1,1,0,0);return}targetid=fightlist[i].firstElementChild.id.replace("btn_attack_p","p|");var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);fightlist[i].firstElementChild.dispatchEvent(evt)}function clearicecheckfail(){icecheckfail=false}function FightFamily(){if(isFightPopOpen()){return}if(document.getElementById("user_stamina").innerHTML<=0){return}city=/mw_city(\d)/.exec(document.getElementById("mw_city_wrapper").className)[1];if(evilCity!=city){do_ajax("inner_page","remote/html_server.php?xw_controller=travel&xw_action=travel&destination="+evilCity+"&from=index&nextParams=&menu=travel",1,1,0,0)}if((document.getElementsByClassName("impulse_buy_prompt contextual").length>0)||(/Remove from Mafia/.test(document.body.innerHTML))||familytargets[familyindex].stat=="strong"){familyindex++;if(familyindex>=familytargets.length){familyindex=0}if(stamOn!=2){for(i=familyindex;i<familytargets.length;i++){if(!umwavoidlist.isAvoid(familytargets[familyindex].pid)){break}familyindex++}}loadProfile(familytargets[familyindex].pid);return}health=parseInt(document.getElementById("user_health").innerHTML);if((healOn&&health<healat)||health<30){return}if(autoBank){Bank()}if(/Sucker Punch/.test(document.body.innerHTML)){var hitlist_url=/Sucker Punch.+?<a href="(.+?)".+?>Add to Hitlist/.exec(document.body.innerHTML)[1].replace(/&amp;/g,"&");target_name=/levels">\((.*?)\)/.exec(document.body.innerHTML)[1];if(icecheckfail){var elem=document.getElementById("btn_attack_"+familytargets[familyindex].pid.replace("|",""));var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);elem.dispatchEvent(evt)}else{var params={ajax:1,liteload:1,sf_xw_user_id:xw_user,sf_xw_sig:local_xw_sig};$.ajax({type:"POST",url:hitlist_url,timeout:30000,data:params,success:function(msg){if(/is already dead or too weak!/.test(msg)){logEntry("Slayer "+target_name+" is dead.");familyindex++;if(familyindex>=familytargets.length){familyindex=0}if(stamOn!=2){for(i=familyindex;i<familytargets.length;i++){if(!umwavoidlist.isAvoid(familytargets[familyindex].pid)){break}familyindex++}}loadProfile(familytargets[familyindex].pid);return}else{if(/The action was not able to be completed/.test(msg)){icecheckfail=true;setTimeout(clearicecheckfail,45000);logEntry("Slayer: Zynga icecheck sucks.");return}else{if(/Sucker Punch/.test(document.body.innerHTML)){var elem=document.getElementById("btn_attack_"+familytargets[familyindex].pid.replace("|",""));var evt=document.createEvent("MouseEvents");targetid=familytargets[familyindex].pid;evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);elem.dispatchEvent(evt)}}}},error:function(req,status,err){return}})}}else{familyindex++;if(familyindex>=familytargets.length){familyindex=0}if(stamOn!=2){for(i=familyindex;i<familytargets.length;i++){if(!umwavoidlist.isAvoid(familytargets[familyindex].pid)){break}familyindex++}}loadProfile(familytargets[familyindex].pid)}}function decodeID(strID){strID=unescape(strID);if(isNaN(strID)){strID=decode64(strID)}return strID}function decode64(input){var output="";var chr1,chr2,chr3="";var enc1,enc2,enc3,enc4="";var i=0;var base64test=/[^A-Za-z0-9\+\/\=]/g;if(base64test.exec(input)){}input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{enc1=keyStr.indexOf(input.charAt(i++));enc2=keyStr.indexOf(input.charAt(i++));enc3=keyStr.indexOf(input.charAt(i++));enc4=keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2)}if(enc4!=64){output=output+String.fromCharCode(chr3)}chr1=chr2=chr3="";enc1=enc2=enc3=enc4=""}while(i<input.length);return output}function PureEvil(){if(isFightPopOpen()){return}if(document.getElementById("user_stamina").innerHTML<=0){return}city=/mw_city(\d)/.exec(document.getElementById("mw_city_wrapper").className)[1];if(evilCity!=city){do_ajax("inner_page","remote/html_server.php?xw_controller=travel&xw_action=travel&destination="+evilCity+"&from=index&nextParams=&menu=travel",1,1,0,0)}if(document.getElementsByClassName("impulse_buy_prompt contextual").length>0){setTimeout(PureEvil,1500);loadProfile(targetid);return}health=parseInt(document.getElementById("user_health").innerHTML);if((healOn&&health<healat)||health<30){return}if(autoBank){Bank()}if(/Sucker Punch/.test(document.body.innerHTML)){var hitlist_url=/Sucker Punch.+?<a href="(.+?)".+?>Add to Hitlist/.exec(document.body.innerHTML)[1].replace(/&amp;/g,"&");var params={ajax:1,liteload:1,sf_xw_user_id:xw_user,sf_xw_sig:local_xw_sig};$.ajax({type:"POST",url:hitlist_url,timeout:30000,data:params,success:function(msg){if(/is already dead or too weak!/.test(msg)){logEntry("Slayer "+target_name+" is dead");return}else{if(/The action was not able to be completed/.test(msg)){logEntry("Slayer: Zynga icecheck sucks.");return}else{if(/Sucker Punch/.test(document.body.innerHTML)){var elem=document.getElementById("btn_attack_"+targetid.replace("|",""));var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);elem.dispatchEvent(evt)}}}},error:function(req,status,err){return}})}else{setTimeout(PureEvil,1500);loadProfile(targetid)}}function Fighter(){var times;var i;var health;var url;if(newfighton){if(pauseOn){if(parseInt(document.getElementById("exp_to_next_level").innerHTML)<stopat){newfighton=false;return}}if(isFightPopOpen()){var elem=document.getElementById("attacker_fight_status");if(!/Lost/.test(elem.innerHTML)||stamOn==2){elem=document.getElementsByClassName("sexy_button_new short red impulse_buy fightV2AttackBtn");if(document.getElementsByClassName("sexy_button_new short red impulse_batch_buy fightV2AttackBtn").length>0){elem[3]=document.getElementsByClassName("sexy_button_new short red impulse_batch_buy fightV2AttackBtn")[1]}if(document.getElementById("fightv2_poweratkbtn_boost_on").style.display=="block"||document.getElementById("fightv2_poweratkbtn_boost_off").style.display=="block"){health=parseInt(document.getElementById("user_health").innerHTML);if((healOn&&health<healat)||health<30){return}url=elem[3].href.replace("remote/","");if(abortOn&&abortCount>abortAt){newfighton=false;abortCount=0;if(!closing){setTimeout(closeFightPop,2500)}closing=true;return}abortCount++;if(burstOn){url=url.replace("click_amt=1","click_amt=7")}var client=new XMLHttpRequest();client.open("POST",url,true);client.setRequestHeader("X-Requested-With","XMLHttpRequest");client.setRequestHeader("Accept","*/*");client.setRequestHeader("Content-Type","application/x-www-form-urlencoded");client.send("ajax=1&liteload=1&sf_xw_user_id="+xw_user+"&sf_xw_sig="+local_xw_sig+"&skip_req_frame=1");client.onreadystatechange=function(){if(this.readyState==4){response=client.responseText;try{var msg=JSON.parse(response)}catch(err){return}msg.user_fields.user_health=CurHealth;FightV2.powerAttack(msg,this);parseNewFightResults(response);var PercentComplete=(/percent_complete":([\d]+),"/.exec(response))[1];document.getElementById("level_bar").setAttribute("style","overflow-x: hidden; overflow-y: hidden; background-color: rgb(41, 202, 49); text-align: left; float: left; width: "+PercentComplete+"%;");document.getElementById("exp_to_next_level").innerHTML=(/exp_to_next_level":([\d]+),/.exec(response))[1];document.getElementById("user_cash_nyc").innerHTML=(/user_cash_nyc":"([$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_italy").innerHTML=(/user_cash_italy":"([L$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_vegas").innerHTML=(/user_cash_vegas":"([V$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_brazil").innerHTML=(/user_cash_brazil":"([BRL$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_chicago").innerHTML=(/user_cash_chicago":"([\\u00a2\d,]+)"/.exec(response))[1];document.getElementById("user_stamina").innerHTML=(/user_stamina":([\d]+)/.exec(response))[1]}};return}}newfighton=false;abortCount=0;if(umwicesteal){if(document.getElementById("fv2_defender_overlay_stolen").style.display=="block"){if(document.getElementsByClassName("sexy_button_new medium red sexy_attack_new impulse_buy").length>0){elem=document.getElementsByClassName("sexy_button_new medium red sexy_attack_new impulse_buy");var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);elem[0].dispatchEvent(evt);return}}}if(!closing){setTimeout(closeFightPop,2500)}closing=true}}if(hitlist){if(pauseOn){if(parseInt(document.getElementById("exp_to_next_level").innerHTML)<stopat){hitlist=false;return}}element=document.evaluate("//a[@class='sexy_button_new short red sexy_attack_new'][contains(string(),'Attack Again')]",document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(element.snapshotLength>0){element=element.snapshotItem(0).href;var HLResult=document.getElementById("content_row").innerHTML;if(!(/message_body">You <strong>LOST<\/strong> the fight/.test(HLResult))){url="html_server.php?"+(/xw_controller=hitlist&xw_action=attack([&\w\d=]+)/.exec(element))[0]}else{hitlist=false;return}}health=parseInt(document.getElementById("user_health").innerHTML);if((healOn&&health<healat)||health<30){return}var client=new XMLHttpRequest();client.open("POST",url,true);client.setRequestHeader("X-Requested-With","XMLHttpRequest");client.setRequestHeader("Accept","*/*");client.setRequestHeader("Content-Type","application/x-www-form-urlencoded");client.send("ajax=1&liteload=1&sf_xw_user_id="+xw_user+"&sf_xw_sig="+local_xw_sig+"&skip_req_frame=1");client.onreadystatechange=function(){if(this.readyState==4){response=client.responseText;document.getElementById("exp_to_next_level").innerHTML=(/user_fields\['exp_to_next_level'\] = parseInt\("([\d]+)/.exec(response))[1];document.getElementById("user_cash_nyc").innerHTML=(/user_cash_nyc'\] = "([$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_bangkok").innerHTML=(/user_cash_bangkok'\] = "([B$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_italy").innerHTML=(/'user_cash_italy'\] = "([L$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_vegas").innerHTML=(/'user_cash_vegas'\] = "([V$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_brazil").innerHTML=(/'user_cash_brazil'\] = "([BRL$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_chicago").innerHTML=(/'user_cash_chicago'\] = "([\\u00a2\d,]+)"/.exec(response))[1];document.getElementById("user_stamina").innerHTML=(/user_fields\['user_stamina'\] = parseInt\("([\d]+)/.exec(response))[1];document.getElementById("inner_page").innerHTML=response}}}}function parseNewFightResults(response){var elem=document.getElementById("attacker_fight_status");var lost=/Lost/.test(elem.innerHTML);if(lost){if(!umwavoidlist.isAvoid(targetid)){umwavoidlist[umwavoidlist.length]=targetid;localStorage.setItem("mwm_avoid_list",JSON.stringify(umwavoidlist))}}if(familymodeOn&&lost){familytargets[familyindex].stat="strong"}if(!lost||(stamOn==2)){if(!newfighton){newfighton=true}}else{newfighton=false;if(!umwaa){return}abortCount=0;if(stamOn&&isFightPopOpen()){if(umwicesteal){if(document.getElementById("fv2_defender_overlay_stolen").style.display=="block"){if(document.getElementsByClassName("sexy_button_new medium red sexy_attack_new impulse_buy").length>0){elem=document.getElementsByClassName("sexy_button_new medium red sexy_attack_new impulse_buy");var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);elem[0].dispatchEvent(evt);return}}}setTimeout(closeFightPop,2500)}}if(document.getElementById("fv2_defender_overlay_iced").style.display=="block"){if((/Get a boost', 'link': '(.+?)'/.test(response))){document.getElementById("umw_ice_count").innerHTML=++icecount;document.getElementById("umw_kill_count").innerHTML=killcount;document.getElementById("umw_total_count").innerHTML=icecount+killcount*2;publishIce(response)}}if(document.getElementById("fv2_defender_overlay_killed").style.display=="block"){if((/Get a boost', 'link': '(.+?)'/.test(response))){document.getElementById("umw_ice_count").innerHTML=icecount;document.getElementById("umw_kill_count").innerHTML=++killcount;document.getElementById("umw_total_count").innerHTML=icecount+killcount*2;publishIce(response)}}}function publishIce(response){var feed;if(/msg.fight_result =/.test(response)){feed=/'feed_js': '(.+?)'/.exec(response)[0]}else{try{var msg=JSON.parse(response);feed=msg.fight_result.feed_js}catch(err){return}}var needseval=/var feed = (.+?); MW\.Feed/.exec(feed)[1];needseval="("+needseval+")";var mwfeed=eval(needseval);mwfeed.description=mwfeed.description.replace("Get a free fight boost to ice your rivals.","");logEntry(mwfeed.description.replace("Get your free fight boost to ice your rivals.",""));if(autopostOn){mwfeed.actionLinks[0].name=mwfeed.actionLinks[0].name.replace("Get a boost","Get a Boost")}if(fbfeedloc!=""){mwfeed.targetId=fbfeedloc}if(postOn){MW.Feed(mwfeed)}}function DoAutoHeal(){var url="html_server.php?xw_controller=survey&xw_action=show_nps_survey&xw_client_id=8";var maxHealth=parseInt(document.getElementById("user_max_health").innerHTML);var CurHealth=parseInt(document.getElementById("user_health").innerHTML);var client=new XMLHttpRequest();client.open("POST",url,true);client.setRequestHeader("X-Requested-With","XMLHttpRequest");client.setRequestHeader("Accept","*/*");client.setRequestHeader("Content-Type","application/x-www-form-urlencoded");client.send("ajax=1&liteload=1&sf_xw_user_id="+xw_user+"&sf_xw_sig="+local_xw_sig+"&skip_req_frame=1");client.onreadystatechange=function(){if(this.readyState==4){response=client.responseText;try{CurHealth=User.health=document.getElementById("user_health").innerHTML=b.user_fields.user_health;mwm.user.group_atk=b.fightbar.group_atk;mwm.user.group_def=b.fightbar.group_def;if(mwm.user.firstRun==true){mwm.user.start_group_atk=b.fightbar.group_atk.replace(/,/,"");mwm.user.start_group_def=b.fightbar.group_def.replace(/,/,"");mwm.user.firstRun=false}update_user_scores()}catch(err){}}};if(parseInt(CurHealth)<healat){HealNY()}}function Bank(){if(!umwaa){return}city=/mw_city(\d)/.exec(document.getElementById("mw_city_wrapper").className)[1];if(city==5){vegascash=/V\$([\d,]+)/.exec(document.getElementById("user_cash_vegas").innerHTML)[1];vegascash=parseInt(vegascash.replace(/\,/g,""));url="html_server.php?xw_controller=propertyV2&xw_action=doaction&xw_city=5&doaction=ActionBankDeposit&amount="+vegascash+"&building_type=6&city=5&xw_client_id=8"}else{url="html_server.php?xw_controller=bank&xw_action=deposit_all&xw_city="+city+"&amount=1000000000"}var params={ajax:1,liteload:1,sf_xw_user_id:xw_user,sf_xw_sig:local_xw_sig};$.ajax({type:"POST",url:url,timeout:30000,data:params,success:function(response){if((/user_cash_nyc":"([$\d,]+)"/.test(response))){document.getElementById("user_cash_nyc").innerHTML=(/user_cash_nyc":"([$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_bangkok").innerHTML=(/user_cash_bangkok":"([B$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_italy").innerHTML=(/user_cash_italy":"([L$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_vegas").innerHTML=(/user_cash_vegas":"([V$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_brazil").innerHTML=(/user_cash_brazil":"([BRL$\d,]+)"/.exec(response))[1];document.getElementById("user_cash_chicago").innerHTML="¢"+(/user_cash_chicago":"\\u00a2([\d,]+)"/.exec(response))[1]}}})}function HealNY(){if(!umwaa){return}url="html_server.php?xw_controller=hospital&xw_action=heal&xcity=1";send="ajax=1&liteload=1&sf_xw_user_id="+xw_user+"&sf_xw_sig="+local_xw_sig;var client=new XMLHttpRequest();client.open("POST",url,true);client.setRequestHeader("X-Requested-With","XMLHttpRequest");client.setRequestHeader("Content-Type","application/x-www-form-urlencoded");client.send(send);client.onreadystatechange=function(){if(this.readyState==4){response=client.responseText;var b=eval("("+response+")");try{CurHealth=User.health=document.getElementById("user_health").innerHTML=b.user_fields.user_health;mwm.user.group_atk=b.fightbar.group_atk;mwm.user.group_def=b.fightbar.group_def;if(mwm.user.firstRun==true){mwm.user.start_group_atk=b.fightbar.group_atk.replace(/,/,"");mwm.user.start_group_def=b.fightbar.group_def.replace(/,/,"");mwm.user.firstRun=false}update_user_scores()}catch(err){}}}}function Settings(){var version=343;var postsetting=fbfeedloc;if(!umwaa){return}popupTitle="UnlockedMW EMWI";content='<br>Post ices to &nbsp;<input value="'+postsetting+'" type="text" style="resize:none;width:90px;" id="postformid"><br><br><input type="checkbox" id="autopost" name="autopost" value="Checked"> Autopost Ices<br><br><input type="checkbox" id="followstolen" name="followstolen" value="Checked"> Attack Ice Stealers<br><br><input type="checkbox" id="burst" name="burst" value="Checked"> Burst Attacks<br><br><input type="checkbox" id="autobank" name="bankit" value="Checked"> Autobank when slayer running<br><br><input type="checkbox" id="remchat" name="removechat" value="Checked"> Remove Clan Chat<br><br><input type="checkbox" id="pausecheck" name="pausecheck" value="Checked">Pause at XP remaining&nbsp;<input value="'+stopat+'" type="integer" style= "resize:none;width:50px;" id="postformid3"><br><br><input type="checkbox" id="stopcheck" name="stopcheck" value="Checked">Maximum attacks per target&nbsp;<input value="'+abortAt+'" type="integer" style= "resize:none;width:50px;" id="postformid7"><br><br>Heal Threshold&nbsp;<input value="'+healat+'" type="integer" style= "resize:none;width:50px;" id="postformid2"><br><br>Robbing Refresh Rate&nbsp;<input value="'+(rref/1000)+'" type="integer" style= "resize:none;width:35px;" id="postformid5"><br><br><a id="SaveSettings" class="sexy_button_new black"><span><span>Save</span></span></a><br><br><a id="CustomBM" class="sexy_button_new black"><span><span>Customize Tools</span></span></a><br><br><a id="ForceUpDate" class="sexy_button_new black"><span><span>Force Update</span></span></a></div>';height="630";myPop("mwmSettings",popupTitle,content,height);document.getElementById("SaveSettings").onclick=saveSettings;document.getElementById("CustomBM").onclick=display_custom_bm_array;document.getElementById("ForceUpDate").onclick=forceupDate;if(umwicesteal){document.getElementById("followstolen").checked=true}if(burstOn){document.getElementById("burst").checked=true}if(pauseOn){document.getElementById("pausecheck").checked=true}if(abortOn){document.getElementById("stopcheck").checked=true}if(autopostOn){document.getElementById("autopost").checked=true}if(autoBank){document.getElementById("autobank").checked=true}if(removeChat){document.getElementById("remchat").checked=true}}function myPop(popupId,popupTitle,content,height,width,shouldClose){if(!height||height==undefined){height="600"}if(!width||width==undefined){width="330"}var popup='<div id="'+popupId+'" class="pop_box " style="position:absolute;top:100px;left:'+(375-(width/2))+"px;display: block;width: "+width+"px;height:"+height+'px;z-index:999999;"><a id="myPop_Close" href="#" class="pop_close" onclick="document.getElementById(\'popup_fodder\').removeChild(document.getElementById(this.parentNode.id))"></a><div style="z-index:99999" class="mini_EP_info_pop"><img src="http://mwfb.static.zgncdn.com/mwfb/graphics/empire/bg_gradient_760x200.gif" width="'+width+'" height="75" style="transform:rotate(180deg);-moz-transform:rotate(180deg);-webkit-transform:rotate(180deg);position:absolute;top:0px;left:0px;"><center><img style="position:relative;" src="http://www.picbadges.com/badges-assets/623/13712940_1329274728.png"><br><div style="position:relative;top:-5px;width:'+(width-10)+'px;height:20px" class="empire_module_title"><span id="myPopup_title" style="position:relative;top:-5px">'+popupTitle+'</span></div><span style="position:relative;top:5px">'+content+"</span></center></div></div>";document.getElementById("popup_fodder").innerHTML+=popup;if(shouldClose){setTimeout(function(){document.getElementById("popup_fodder").removeChild(document.getElementById(popupId))},shouldClose)}}function saveSettings(){if(!umwaa){return}setTimeout(function(){document.getElementById("popup_fodder").removeChild(document.getElementById("mwmSettings"))},10);rref=parseInt(document.getElementById("postformid5").value)*1000;fbfeedloc=document.getElementById("postformid").value;if(document.getElementById("autopost").checked==true){autopostOn=true}else{autopostOn=false}healat=parseInt(document.getElementById("postformid2").value);stopat=parseInt(document.getElementById("postformid3").value);abortAt=parseInt(document.getElementById("postformid7").value);if(document.getElementById("followstolen").checked==true){umwicesteal=true}else{umwicesteal=false}if(document.getElementById("burst").checked==true){burstOn=true}else{burstOn=false}if(document.getElementById("pausecheck").checked==true){pauseOn=true}else{pauseOn=false}if(document.getElementById("stopcheck").checked==true){abortOn=true}else{abortOn=false}if(document.getElementById("autobank").checked==true){autoBank=true}else{autoBank=false}if(document.getElementById("remchat").checked==true){removeChat=true}else{removeChat=false}writeCookie()}function forceupDate(){if(confirm("Do you really want to force update UnlockedMW EMWI")){localStorage.removeItem("scriptumw");window.location.reload()}}function getRadioValue(radioObject){var value=null;var i;for(i=0;i<radioObject.length;i++){if(radioObject[i].checked){value=radioObject[i].value;break}}return value}function myPopupClose(){document.getElementById("popup_fodder").removeChild(document.getElementById("myPopup"))}function startup(){readCookieSettings();if(!umwaa){return}if(removeChat=="true"||removeChat==true){removeChat=true}else{removeChat=false}Toolbar();if(stamOn=="true"||stamOn==true){stamOn=true;fightInterval=setInterval(Fighter,FighterInt)}else{if(stamOn==2){fightInterval=setInterval(Fighter,FighterInt)}else{stamOn=false}}if(healOn=="true"||healOn==true){healOn=true;healInterval=setInterval(DoAutoHeal,2000)}else{healOn=false}if(postOn=="true"||postOn==true){postOn=true}else{postOn=false}if(jobsOn=="true"||jobsOn==true){jobsOn=true;energyInterval=setInterval(Jobber,1000)}else{if(jobsOn==2){jobsOn=true;energyInterval=setInterval(Jobber,1000)}else{jobsOn=false}}if(umwicesteal=="true"||umwicesteal==true){umwicesteal=true}else{umwicesteal=false}if(pauseOn=="true"||pauseOn==true){pauseOn=true}else{pauseOn=false}if(abortOn=="true"||abortOn==true){abortOn=true}else{abortOn=false}if(burstOn=="true"||burstOn==true){burstOn=true}else{burstOn=false}if(autopostOn=="true"||autopostOn==true){autopostOn=true}else{autopostOn=false}if(autoBank=="true"||autoBank==true){autoBank=true}else{autoBank=false}setInterval(Toolbar,10000);display_popup_message()}if(document.getElementById("unlock_toolbar")){return}else{startup()}function isFightPopOpen(){if(document.getElementById("fv2_widget_wrapper")){if(document.getElementById("fv2_widget_wrapper").style.display!="none"){return true}else{return false}}else{return false}}function closeFightPop(){ajax=true;closing=false;CloseJS()}function CloseDoopidPopup(){if($(".pop_bg").length>0){$(".pop_bg").each(function(){var id=this.id;MW.Popup.hide(id.substr(id.lastIndexOf("_")+1))})}}function LetThereBeRobberies(){var DoesIHaveStam=parseInt(document.getElementById("user_stamina").innerHTML);if(!evilOn){return}if(pauseOn){if(parseInt(document.getElementById("exp_to_next_level").innerHTML)<stopat){evilOn=false;logEntry("Slayer Stopped");document.getElementById("EvilOnOff").setAttribute("class","sexy_button_new short black");document.getElementById("EvilOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.evil_icon+'""></span></span></a>';return}}var robSquad=parseInt(/RobbingController.robAllHelper\((\d+),/.exec(document.getElementById("oneClickRobAll").onclick)[1]);if(DoesIHaveStam<50){var anystam=parseInt(document.getElementById("user_stamina").innerHTML);var anyexp=parseInt(document.getElementById("exp_to_next_level").innerHTML);var XPratio=(currexp-anyexp)/(currstam-anystam);alert("Sorry you need more stamina to clear the board!\n\nResults : \n\n Start Stamina : "+currstam+" \n\n End Stamina : "+anystam+"\n\n Stamina Spent : "+(currstam-anystam)+"\n\n Experience Gained : "+(currexp-anyexp)+"\n\n Exp Ratio achieved : "+XPratio+" \n\n***Please note if the stats above look wack its because you leveled halfwaythru and threw the hardcoded calculators outta wack***")}else{if(robSquad>0){var roball=document.getElementById("oneClickRobAll");var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);roball.dispatchEvent(evt);setTimeout(RefreshMeRS,(rref))}else{for(var i=0;i<10;i++){do_ajax("","remote/html_server.php?xw_controller=robbing&xw_action=rob&xw_city="+evilCity+"&slot="+i,1,0,RobbingController.preRob(i),RobbingController.rob)}setTimeout(RefreshMe,(rref))}}}function RefreshMeRS(){var clkRefresh=document.getElementById("rob_refresh_cost");var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);clkRefresh.dispatchEvent(evt);setTimeout(KickMeBackToThirdGrade,3000)}function RefreshMe(){try{var IsEveryoneDeadYet=document.evaluate("//a[@id=\"rob_refresh_cost\"]//span//span[contains(string(),'Refresh: 0')]",document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(IsEveryoneDeadYet.snapshotLength>=1){do_ajax("","remote/html_server.php?xw_controller=robbing&xw_action=refresh");setTimeout(KickMeBackToThirdGrade,3000)}else{LetThereBeRobberies()}}catch(err){}}function KickMeBackToThirdGrade(){CloseDoopidPopup();LetThereBeRobberies()}function resetfightaction(){fightActionRunning=false;closeFightPop()}$("body").ajaxComplete(function(e,xhr,settings){var response=xhr.responseText;if(/local_xw_sig = '([\da-f]+)';/.test(response)){local_xw_sig=/local_xw_sig = '([\da-f]+)';/.exec(response)[1]}if(ajax){ajax=false;return}if(fightActionRunning){fightActionRunning=false;clearTimeout(fightwatchdogtimout)}if(document.getElementById("attacker_fight_status")){parseNewFightResults(response)}if(document.evaluate("//a[@class='sexy_button_new short red sexy_attack_new'][contains(string(),'Attack Again')]",document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength>0){hitlist=true}else{if(hitlist){hitlist=false}}var jobMtot=0;if(jobsOn!=false){if(document.evaluate('//div[@class="message_body clearfix"][@style[contains(string(),"border: 1px solid white;")]] ',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength>0){NYjobon=true}else{if(NYjobon){NYjobon=false}}if((/Do This Job Again/.test(document.getElementById("inner_page").innerHTML))){BKjobon=true}else{if(BKjobon){BKjobon=false}}if(document.evaluate('//div[@class="job_info"][@style[contains(string(),"255, 255, 255")]]',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength>0&&document.getElementsByClassName("buy_prompt").length==0){ILVjobon=true}else{if(ILVjobon){ILVjobon=false}}var sndTxt=response.replace(/\\/g,"");if(/"job_mastery_percentage":/.test(sndTxt)){jobMtot=/"job_mastery_percentage":(\d+),/.exec(sndTxt)[1];if(jobMtot==100&&jobsOn!=2){stopJobs()}}if(/jobResult":{"city":7/.test(response)||/jobResult":{"city":8/.test(response)){if(/jobResult":{"city":7/.test(response)){Bjobid=/jobResult":{"city":7,"id":(\d+),/.exec(response)[1]}if(/jobResult":{"city":8/.test(response)){Bjobid=/jobResult":{"city":8,"id":(\d+),/.exec(response)[1]}Bjobon=true}else{if(Bjobon){Bjobon=false}}if(/"masteryTotal":/.test(response)){jobMtot=/"masteryTotal":(\d+),/.exec(response)[1];if(jobMtot==100&&jobsOn!=2){stopJobs()}}}if(declaring_war==true&&/<!-- Current Page: war_controller ([\d]+) -->/.test(response)){if(/their war status/.test(response)){setTimeout(function(){declare_war(null)},0)}else{if(/too low of a level to declare war/.test(response)){setTimeout(function(){declare_war(null)},0)}else{if(/are already at war/.test(response)){declaring_war=false}else{if(/user not found/i.test(response)||/does not exist/i.test(response)){setTimeout(function(){declare_war(null)},0)}else{setTimeout(function(){var pop_id=/([\d]+)/.exec(document.getElementsByClassName("sexy_button_new short white sexy_call_new")[0].getAttribute("onclick"))[1];MW.Feed(postFeedAndSendCallForHelpNew);$("#declare_war .sexy_call_new").css("display","none");MW.Popup.hideAndRemove(pop_id);declaring_war=false},1500);document.getElementById("EvilOnOff").setAttribute("class","sexy_button_new short black");document.getElementById("EvilOnOff").innerHTML='<span class="sexy_health_new"><span><img src="'+mwm.images.evil_icon+'""></span></span></a>';evilOn=false}}}}return}if((/"group_atk"/.test(response))){var b=eval("("+response+")");mwm.user.group_atk=b.fightbar.group_atk;mwm.user.group_def=b.fightbar.group_def;if(mwm.user.firstRun==true){mwm.user.start_group_atk=b.fightbar.group_atk.replace(/,/,"");mwm.user.start_group_def=b.fightbar.group_def.replace(/,/,"");mwm.user.firstRun=false}update_user_scores()}});function isArray(o){return Object.prototype.toString.call(o)==="[object Array]"}function add_bm_to_array(){if(document.getElementById("mwm_User_BM_locale").value.length<1){alert("Locale is empty!");mwmAddBM();return}if(!/http(.+)js/.test(document.getElementById("mwm_User_BM_locale").value)){alert("Locale is not valid!");mwmAddBM();return}if(document.getElementById("mwm_User_BM_alias").value.length<1){alert("Alias is empty!");mwmAddBM();return}locale=/http(.+)js/.exec(document.getElementById("mwm_User_BM_locale").value)[0];alias=escape(document.getElementById("mwm_User_BM_alias").value);try{if(document.getElementById("mwmAddCustomBM")){document.getElementById("popup_fodder").removeChild(document.getElementById("mwmAddCustomBM"))}}catch(e){}var testArray=isArray(mwm.user_bm_locale);if(testArray==false){mwm.user_bm_locale=new Array()}testArray=isArray(mwm.user_bm_alias);if(testArray==false){mwm.user_bm_alias=new Array()}var a=mwm.user_bm_locale.length;mwm.user_bm_locale[a]=locale;mwm.user_bm_alias[a]=alias;save_bm_array_to_localstorage()}function save_bm_array_to_localstorage(){localStorage.setItem("mwm_user_bm_length",mwm.user_bm_locale.length);for(var i=0;i<mwm.user_bm_locale.length;i++){localStorage.setItem("mwm_user_bm_locale_"+i,mwm.user_bm_locale[i]);localStorage.setItem("mwm_user_bm_alias_"+i,mwm.user_bm_alias[i])}display_custom_bm_array()}function remove_user_bm(){item_value=parseInt(this.id);try{if(document.getElementById("mwmCustomBM")){document.getElementById("popup_fodder").removeChild(document.getElementById("mwmCustomBM"))}}catch(e){}localStorage.removeItem("mwm_user_bm_locale_"+a);localStorage.removeItem("mwm_user_bm_alias_"+a);var a=parseInt(localStorage.getItem("mwm_user_bm_length"));for(var i=item_value;i<a;i++){mwm.user_bm_alias[item_value]=mwm.user_bm_alias[(item_value+1)];mwm.user_bm_locale[item_value]=mwm.user_bm_locale[(item_value+1)];localStorage.setItem("mwm_user_bm_alias_"+i,localStorage.getItem("mwm_user_bm_alias_"+(i+1)));localStorage.setItem("mwm_user_bm_locale_"+i,localStorage.getItem("mwm_user_bm_locale_"+(i+1)))}localStorage.setItem("mwm_user_bm_length",(a-1));display_custom_bm_array()}function edit_user_bm(){item_value=parseInt(/save_custom_bm_([\d]+)/.exec(this.id)[1]);mwm.user_bm_alias[item_value]=escape(document.getElementById("mwm_User_BM_alias").value);mwm.user_bm_locale[item_value]=escape(document.getElementById("mwm_User_BM_locale").value);localStorage.setItem("mwm_user_bm_alias_"+item_value,mwm.user_bm_alias[item_value]);localStorage.setItem("mwm_user_bm_locale_"+item_value,mwm.user_bm_locale[item_value]);display_custom_bm_array()}function edit_user_bm_pop(){try{if(document.getElementById("mwmCustomBM")){document.getElementById("popup_fodder").removeChild(document.getElementById("mwmCustomBM"))}}catch(e){}item_value=parseInt(this.id);var a="document.getElementById('popup_fodder').removeChild(document.getElementById(this.parentNode.parentNode.parentNode.parentNode.id))";myPop("mwmAddCustomBM","Edit Custom BM",'Here, you can edit your custom bookmarklet for UnlockedMW EMWI!<br>You may paste either the bookmarklet code or a path that starts with <b>http</b> & ends with <b>js</b>.<br><br><table border="0" onKeyUp="if(window.event.keyCode == 13){edit_user_bm('+item_value+");"+a+'}"><tr title="The name that UnlockedMW EMWI uses to refer to this script."><td width="50" style="text-align:right">Alias:&nbsp;</td><td><input id="mwm_User_BM_alias" type="text" value="'+unescape(localStorage.getItem("mwm_user_bm_alias_"+item_value))+'"></td></tr><tr title="The location of the script. This needs to be hosted somewhere, that is accessible via the internet, not locally."><td width="50" style="text-align:right">Locale:&nbsp;</td><td><input id="mwm_User_BM_locale" type="text" value="'+unescape(localStorage.getItem("mwm_user_bm_locale_"+item_value))+'"></td></tr></table><a class="sexy_button_new black" id="save_custom_bm_'+item_value+'"><span><span>Save</span></span></a>',"275","330");document.getElementById("save_custom_bm_"+item_value).onclick=edit_user_bm;document.getElementById("mwm_User_BM_alias").focus()}function mwmAddBM(){try{if(document.getElementById("mwmCustomBM")){document.getElementById("popup_fodder").removeChild(document.getElementById("mwmCustomBM"))}}catch(e){}myPop("mwmAddCustomBM","Add Custom BM",'Here, you can add your own bookmarklets to the UnlockedMW EMWI!<br>You may paste either the bookmarklet code or a path that starts with <b>http</b> & ends with <b>js</b>.<br><br><table border="0" onKeyUp="if(window.event.keyCode == 13) add_bm_to_array()"><tr title="The name that UnlockedMW EMWI uses to refer to this script."><td width="50" style="text-align:right">Alias:&nbsp;</td><td><input id="mwm_User_BM_alias" type="text"></td></tr><tr title="The location of the script. This needs to be hosted somewhere, that is accessible via the internet, not locally."><td width="50" style="text-align:right">Locale:&nbsp;</td><td><input id="mwm_User_BM_locale" type="text"></td></tr></table><a id="add_bm" class="sexy_button_new black"><span><span>Save</span></span></a>',"275","330");document.getElementById("add_bm").onclick=add_bm_to_array;document.getElementById("mwm_User_BM_alias").focus()}function display_custom_bm_array(){try{if(document.getElementById("mwmSettings")){document.getElementById("popup_fodder").removeChild(document.getElementById("mwmSettings"))}}catch(e){}try{if(document.getElementById("mwmAddCustomBM")){document.getElementById("popup_fodder").removeChild(document.getElementById("mwmAddCustomBM"))}}catch(e){}var a=parseInt(localStorage.getItem("mwm_user_bm_length"));var style;if(a>=6){style="max-height:150px;overflow-y:scroll;"}else{style=" "}var b='<br><div style="width:400px;max-width:400px;overflow-y:none;'+style+'"><table border="1">';var c="document.getElementById('popup_fodder').removeChild(document.getElementById(this.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.id));";var d=550;var i;for(i=0;i<a;i++){b+="<tr><td>&nbsp;"+(i+1)+':&nbsp;</td><td title="'+unescape(localStorage.getItem("mwm_user_bm_locale_"+i))+'">&nbsp;'+unescape(localStorage.getItem("mwm_user_bm_alias_"+i))+'&nbsp;</td><td width="40">&nbsp;<a class="edit_user_bm_pop" id="'+i+'" onclick="'+c+'">edit?</a></td><td width="60">&nbsp;<a class="remove_user_bm" id="'+i+'" onclick="'+c+'">remove?</a></td></tr>'}b+="</table></div>";b+='<a class="sexy_button_new black" id="addBM"><span><span>Add Bookmarklets</span></span></a><a class="sexy_button_new black" id="restoreBM"><span><span>Restore Originals</span></span></a><br><br>Copy this to a text file to save a backup:<br><textarea rows="8" cols="40" id="backupBMtext">'+mwm.user_bm_alias.join("|")+"##"+mwm.user_bm_locale.join("|")+'</textarea><br><a class="sexy_button_new black" id="backupBM"><span><span>Restore Backup</span></span></a>';myPop("mwmCustomBM","Current custom bookmarklets",b,d,"600");for(var r=0;r<i;r++){document.getElementsByClassName("edit_user_bm_pop")[r].onclick=edit_user_bm_pop;document.getElementsByClassName("remove_user_bm")[r].onclick=remove_user_bm}document.getElementById("addBM").onclick=mwmAddBM;document.getElementById("backupBM").onclick=restore_custom_bms;document.getElementById("restoreBM").onclick=restore_stock_bms}function restore_custom_bms(){var count=parseInt(localStorage.getItem("mwm_user_bm_length"));for(var i=0;i<count;i++){localStorage.removeItem("mwm_user_bm_locale_"+i);localStorage.removeItem("mwm_user_bm_alias_"+i)}var stuff=document.getElementById("backupBMtext").value;var useraliases=stuff.split("##")[0];var userlocales=stuff.split("##")[1];try{if(document.getElementById("mwmCustomBM")){document.getElementById("popup_fodder").removeChild(document.getElementById("mwmCustomBM"))}}catch(e){}localesSplit=userlocales.split("|"),aliasesSplit=useraliases.split("|");localStorage.setItem("mwm_user_bm_length",(localesSplit.length-1));for(var i=0;i<localesSplit.length;i++){mwm.user_bm_locale[i]=localesSplit[i];localStorage.setItem("mwm_user_bm_locale_"+i,localesSplit[i]);mwm.user_bm_alias[i]=aliasesSplit[i];localStorage.setItem("mwm_user_bm_alias_"+i,aliasesSplit[i])}display_custom_bm_array()}function restore_stock_bms(){try{if(document.getElementById("mwmCustomBM")){document.getElementById("popup_fodder").removeChild(document.getElementById("mwmCustomBM"))}}catch(e){}var count=parseInt(localStorage.getItem("mwm_user_bm_length"));for(var i=0;i<count;i++){localStorage.removeItem("mwm_user_bm_locale_"+i);localStorage.removeItem("mwm_user_bm_alias_"+i)}localesSplit=locales.split("|"),aliasesSplit=aliases.split("|");localStorage.setItem("mwm_user_bm_length",(localesSplit.length-1));for(var i=0;i<localesSplit.length;i++){mwm.user_bm_locale[i]=localesSplit[i];localStorage.setItem("mwm_user_bm_locale_"+i,localesSplit[i]);mwm.user_bm_alias[i]=aliasesSplit[i];localStorage.setItem("mwm_user_bm_alias_"+i,aliasesSplit[i])}display_custom_bm_array()}function display_popup_message(){}function update_user_scores(){if(document.getElementById("umw_stat_tracking")){var u_user=mwm.user;document.getElementById("umw_atk_lt_ttl").innerHTML=u_user.group_atk;document.getElementById("umw_def_lt_ttl").innerHTML=u_user.group_def;var attack_change=parseInt(parseInt(u_user.group_atk.replace(/,/,""))-parseInt(u_user.start_group_atk.replace(/,/,"")));var ac_elt=document.getElementById("umw_atk_lt_inc");if(attack_change>=0){ac_elt.innerHTML="+"+attack_change;ac_elt.className="good"}else{if(attack_change<0){ac_elt.innerHTML=attack_change;ac_elt.className="bad"}}var defense_change=parseInt(parseInt(u_user.group_def.replace(/,/,""))-parseInt(u_user.start_group_def.replace(/,/,"")));var dc_elt=document.getElementById("umw_def_lt_inc");if(defense_change>=0){dc_elt.innerHTML="+"+defense_change;dc_elt.className="good"}else{if(defense_change<0){dc_elt.innerHTML=defense_change;dc_elt.className="bad"}}}}};

//====================================================================
// spockholm_toolbar
//====================================================================

(function(){
	if (/html_server/.test(document.location.href)) {
		var div = document.createElement("div");
		div.id = 'spockholm_toolbar';
		var game = document.getElementById('mw_city_wrapper');
		game.insertBefore(div,game.firstChild);
		if (typeof $ == 'undefined') {
			$ = unsafeWindow.$;
		}
		window.smtool_loader = unsafeWindow.smtool_loader = 1;
		loadContent('http://cdn.spocklet.com/spockholm_toolbar_lite.user.js?'+Math.random());
	}
	else {
		document.getElementsByClassName('fixedAux')[0].parentNode.removeChild(document.getElementsByClassName('fixedAux')[0])
	}

	function ping_server(server) {
		if (server == 'primary') {
			server = 'spocklet.com';
		}
		if (server == 'secondary') {
			server = 'backup.spocklet.com';
		}
		var img = new Image();
		img.onload = function() {
			return true;
		}
		img.src = 'http://'+server+'/ping.gif';
	}
	
	function loadContent(file){
		var head = document.getElementsByTagName('head').item(0);
		var scriptTag = document.getElementById('loadScript');
		if (scriptTag) {
			head.removeChild(scriptTag);
		}
		script = document.createElement('script');
		script.src = file;
		script.type = 'text/javascript';
		script.id = 'loadScript';
		head.appendChild(script);
	}
})();
injectScript(myscript);