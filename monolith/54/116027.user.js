// ==UserScript==
// @name	Search Assist
// @version	1.04
// @namespace	http://ictinus.com/sa/
// @description	Within Google Search, double click on a word and you will be presented options to explicitly add or remove the word from the search.
// @match	http://*.google.com/*
// @match	https://*.google.com/*
// @match	http://*.google.ad/*
// @match	http://*.google.ae/*
// @match	http://*.google.com.af/*
// @match	http://*.google.com.ag/*
// @match	http://*.google.com.ai/*
// @match	http://*.google.am/*
// @match	http://*.google.co.ao/*
// @match	http://*.google.com.ar/*
// @match	http://*.google.as/*
// @match	http://*.google.at/*
// @match	http://*.google.com.au/*
// @match	http://*.google.az/*
// @match	http://*.google.ba/*
// @match	http://*.google.com.bd/*
// @match	http://*.google.be/*
// @match	http://*.google.bf/*
// @match	http://*.google.bg/*
// @match	http://*.google.com.bh/*
// @match	http://*.google.bi/*
// @match	http://*.google.bj/*
// @match	http://*.google.com.bn/*
// @match	http://*.google.com.bo/*
// @match	http://*.google.com.br/*
// @match	http://*.google.bs/*
// @match	http://*.google.co.bw/*
// @match	http://*.google.by/*
// @match	http://*.google.com.bz/*
// @match	http://*.google.ca/*
// @match	http://*.google.cd/*
// @match	http://*.google.cf/*
// @match	http://*.google.cg/*
// @match	http://*.google.ch/*
// @match	http://*.google.ci/*
// @match	http://*.google.co.ck/*
// @match	http://*.google.cl/*
// @match	http://*.google.cm/*
// @match	http://*.google.cn/*
// @match	http://*.google.com.co/*
// @match	http://*.google.co.cr/*
// @match	http://*.google.com.cu/*
// @match	http://*.google.cz/*
// @match	http://*.google.de/*
// @match	http://*.google.dj/*
// @match	http://*.google.dk/*
// @match	http://*.google.dm/*
// @match	http://*.google.com.do/*
// @match	http://*.google.dz/*
// @match	http://*.google.com.ec/*
// @match	http://*.google.ee/*
// @match	http://*.google.com.eg/*
// @match	http://*.google.es/*
// @match	http://*.google.com.et/*
// @match	http://*.google.fi/*
// @match	http://*.google.com.fj/*
// @match	http://*.google.fm/*
// @match	http://*.google.fr/*
// @match	http://*.google.ga/*
// @match	http://*.google.ge/*
// @match	http://*.google.gg/*
// @match	http://*.google.com.gh/*
// @match	http://*.google.com.gi/*
// @match	http://*.google.gl/*
// @match	http://*.google.gm/*
// @match	http://*.google.gp/*
// @match	http://*.google.gr/*
// @match	http://*.google.com.gt/*
// @match	http://*.google.gy/*
// @match	http://*.google.com.hk/*
// @match	http://*.google.hn/*
// @match	http://*.google.hr/*
// @match	http://*.google.ht/*
// @match	http://*.google.hu/*
// @match	http://*.google.co.id/*
// @match	http://*.google.ie/*
// @match	http://*.google.co.il/*
// @match	http://*.google.im/*
// @match	http://*.google.co.in/*
// @match	http://*.google.iq/*
// @match	http://*.google.is/*
// @match	http://*.google.it/*
// @match	http://*.google.je/*
// @match	http://*.google.com.jm/*
// @match	http://*.google.jo/*
// @match	http://*.google.co.jp/*
// @match	http://*.google.co.ke/*
// @match	http://*.google.com.kh/*
// @match	http://*.google.ki/*
// @match	http://*.google.kg/*
// @match	http://*.google.co.kr/*
// @match	http://*.google.com.kw/*
// @match	http://*.google.kz/*
// @match	http://*.google.la/*
// @match	http://*.google.com.lb/*
// @match	http://*.google.li/*
// @match	http://*.google.lk/*
// @match	http://*.google.co.ls/*
// @match	http://*.google.lt/*
// @match	http://*.google.lu/*
// @match	http://*.google.lv/*
// @match	http://*.google.com.ly/*
// @match	http://*.google.co.ma/*
// @match	http://*.google.md/*
// @match	http://*.google.me/*
// @match	http://*.google.mg/*
// @match	http://*.google.mk/*
// @match	http://*.google.ml/*
// @match	http://*.google.mn/*
// @match	http://*.google.ms/*
// @match	http://*.google.com.mt/*
// @match	http://*.google.mu/*
// @match	http://*.google.mv/*
// @match	http://*.google.mw/*
// @match	http://*.google.com.mx/*
// @match	http://*.google.com.my/*
// @match	http://*.google.co.mz/*
// @match	http://*.google.com.na/*
// @match	http://*.google.com.nf/*
// @match	http://*.google.com.ng/*
// @match	http://*.google.com.ni/*
// @match	http://*.google.ne/*
// @match	http://*.google.nl/*
// @match	http://*.google.no/*
// @match	http://*.google.com.np/*
// @match	http://*.google.nr/*
// @match	http://*.google.nu/*
// @match	http://*.google.co.nz/*
// @match	http://*.google.com.om/*
// @match	http://*.google.com.pa/*
// @match	http://*.google.com.pe/*
// @match	http://*.google.com.ph/*
// @match	http://*.google.com.pk/*
// @match	http://*.google.pl/*
// @match	http://*.google.pn/*
// @match	http://*.google.com.pr/*
// @match	http://*.google.ps/*
// @match	http://*.google.pt/*
// @match	http://*.google.com.py/*
// @match	http://*.google.com.qa/*
// @match	http://*.google.ro/*
// @match	http://*.google.ru/*
// @match	http://*.google.rw/*
// @match	http://*.google.com.sa/*
// @match	http://*.google.com.sb/*
// @match	http://*.google.sc/*
// @match	http://*.google.se/*
// @match	http://*.google.com.sg/*
// @match	http://*.google.sh/*
// @match	http://*.google.si/*
// @match	http://*.google.sk/*
// @match	http://*.google.com.sl/*
// @match	http://*.google.sn/*
// @match	http://*.google.so/*
// @match	http://*.google.sm/*
// @match	http://*.google.st/*
// @match	http://*.google.com.sv/*
// @match	http://*.google.td/*
// @match	http://*.google.tg/*
// @match	http://*.google.co.th/*
// @match	http://*.google.com.tj/*
// @match	http://*.google.tk/*
// @match	http://*.google.tl/*
// @match	http://*.google.tm/*
// @match	http://*.google.tn/*
// @match	http://*.google.to/*
// @match	http://*.google.com.tr/*
// @match	http://*.google.tt/*
// @match	http://*.google.com.tw/*
// @match	http://*.google.co.tz/*
// @match	http://*.google.com.ua/*
// @match	http://*.google.co.ug/*
// @match	http://*.google.co.uk/*
// @match	http://*.google.com.uy/*
// @match	http://*.google.co.uz/*
// @match	http://*.google.com.vc/*
// @match	http://*.google.co.ve/*
// @match	http://*.google.vg/*
// @match	http://*.google.co.vi/*
// @match	http://*.google.com.vn/*
// @match	http://*.google.vu/*
// @match	http://*.google.ws/*
// @match	http://*.google.rs/*
// @match	http://*.google.co.za/*
// @match	http://*.google.co.zm/*
// @match	http://*.google.co.zw/*
// @match	https://*.google.ad/*
// @match	https://*.google.ae/*
// @match	https://*.google.com.af/*
// @match	https://*.google.com.ag/*
// @match	https://*.google.com.ai/*
// @match	https://*.google.am/*
// @match	https://*.google.co.ao/*
// @match	https://*.google.com.ar/*
// @match	https://*.google.as/*
// @match	https://*.google.at/*
// @match	https://*.google.com.au/*
// @match	https://*.google.az/*
// @match	https://*.google.ba/*
// @match	https://*.google.com.bd/*
// @match	https://*.google.be/*
// @match	https://*.google.bf/*
// @match	https://*.google.bg/*
// @match	https://*.google.com.bh/*
// @match	https://*.google.bi/*
// @match	https://*.google.bj/*
// @match	https://*.google.com.bn/*
// @match	https://*.google.com.bo/*
// @match	https://*.google.com.br/*
// @match	https://*.google.bs/*
// @match	https://*.google.co.bw/*
// @match	https://*.google.by/*
// @match	https://*.google.com.bz/*
// @match	https://*.google.ca/*
// @match	https://*.google.cd/*
// @match	https://*.google.cf/*
// @match	https://*.google.cg/*
// @match	https://*.google.ch/*
// @match	https://*.google.ci/*
// @match	https://*.google.co.ck/*
// @match	https://*.google.cl/*
// @match	https://*.google.cm/*
// @match	https://*.google.cn/*
// @match	https://*.google.com.co/*
// @match	https://*.google.co.cr/*
// @match	https://*.google.com.cu/*
// @match	https://*.google.cz/*
// @match	https://*.google.de/*
// @match	https://*.google.dj/*
// @match	https://*.google.dk/*
// @match	https://*.google.dm/*
// @match	https://*.google.com.do/*
// @match	https://*.google.dz/*
// @match	https://*.google.com.ec/*
// @match	https://*.google.ee/*
// @match	https://*.google.com.eg/*
// @match	https://*.google.es/*
// @match	https://*.google.com.et/*
// @match	https://*.google.fi/*
// @match	https://*.google.com.fj/*
// @match	https://*.google.fm/*
// @match	https://*.google.fr/*
// @match	https://*.google.ga/*
// @match	https://*.google.ge/*
// @match	https://*.google.gg/*
// @match	https://*.google.com.gh/*
// @match	https://*.google.com.gi/*
// @match	https://*.google.gl/*
// @match	https://*.google.gm/*
// @match	https://*.google.gp/*
// @match	https://*.google.gr/*
// @match	https://*.google.com.gt/*
// @match	https://*.google.gy/*
// @match	https://*.google.com.hk/*
// @match	https://*.google.hn/*
// @match	https://*.google.hr/*
// @match	https://*.google.ht/*
// @match	https://*.google.hu/*
// @match	https://*.google.co.id/*
// @match	https://*.google.ie/*
// @match	https://*.google.co.il/*
// @match	https://*.google.im/*
// @match	https://*.google.co.in/*
// @match	https://*.google.iq/*
// @match	https://*.google.is/*
// @match	https://*.google.it/*
// @match	https://*.google.je/*
// @match	https://*.google.com.jm/*
// @match	https://*.google.jo/*
// @match	https://*.google.co.jp/*
// @match	https://*.google.co.ke/*
// @match	https://*.google.com.kh/*
// @match	https://*.google.ki/*
// @match	https://*.google.kg/*
// @match	https://*.google.co.kr/*
// @match	https://*.google.com.kw/*
// @match	https://*.google.kz/*
// @match	https://*.google.la/*
// @match	https://*.google.com.lb/*
// @match	https://*.google.li/*
// @match	https://*.google.lk/*
// @match	https://*.google.co.ls/*
// @match	https://*.google.lt/*
// @match	https://*.google.lu/*
// @match	https://*.google.lv/*
// @match	https://*.google.com.ly/*
// @match	https://*.google.co.ma/*
// @match	https://*.google.md/*
// @match	https://*.google.me/*
// @match	https://*.google.mg/*
// @match	https://*.google.mk/*
// @match	https://*.google.ml/*
// @match	https://*.google.mn/*
// @match	https://*.google.ms/*
// @match	https://*.google.com.mt/*
// @match	https://*.google.mu/*
// @match	https://*.google.mv/*
// @match	https://*.google.mw/*
// @match	https://*.google.com.mx/*
// @match	https://*.google.com.my/*
// @match	https://*.google.co.mz/*
// @match	https://*.google.com.na/*
// @match	https://*.google.com.nf/*
// @match	https://*.google.com.ng/*
// @match	https://*.google.com.ni/*
// @match	https://*.google.ne/*
// @match	https://*.google.nl/*
// @match	https://*.google.no/*
// @match	https://*.google.com.np/*
// @match	https://*.google.nr/*
// @match	https://*.google.nu/*
// @match	https://*.google.co.nz/*
// @match	https://*.google.com.om/*
// @match	https://*.google.com.pa/*
// @match	https://*.google.com.pe/*
// @match	https://*.google.com.ph/*
// @match	https://*.google.com.pk/*
// @match	https://*.google.pl/*
// @match	https://*.google.pn/*
// @match	https://*.google.com.pr/*
// @match	https://*.google.ps/*
// @match	https://*.google.pt/*
// @match	https://*.google.com.py/*
// @match	https://*.google.com.qa/*
// @match	https://*.google.ro/*
// @match	https://*.google.ru/*
// @match	https://*.google.rw/*
// @match	https://*.google.com.sa/*
// @match	https://*.google.com.sb/*
// @match	https://*.google.sc/*
// @match	https://*.google.se/*
// @match	https://*.google.com.sg/*
// @match	https://*.google.sh/*
// @match	https://*.google.si/*
// @match	https://*.google.sk/*
// @match	https://*.google.com.sl/*
// @match	https://*.google.sn/*
// @match	https://*.google.so/*
// @match	https://*.google.sm/*
// @match	https://*.google.st/*
// @match	https://*.google.com.sv/*
// @match	https://*.google.td/*
// @match	https://*.google.tg/*
// @match	https://*.google.co.th/*
// @match	https://*.google.com.tj/*
// @match	https://*.google.tk/*
// @match	https://*.google.tl/*
// @match	https://*.google.tm/*
// @match	https://*.google.tn/*
// @match	https://*.google.to/*
// @match	https://*.google.com.tr/*
// @match	https://*.google.tt/*
// @match	https://*.google.com.tw/*
// @match	https://*.google.co.tz/*
// @match	https://*.google.com.ua/*
// @match	https://*.google.co.ug/*
// @match	https://*.google.co.uk/*
// @match	https://*.google.com.uy/*
// @match	https://*.google.co.uz/*
// @match	https://*.google.com.vc/*
// @match	https://*.google.co.ve/*
// @match	https://*.google.vg/*
// @match	https://*.google.co.vi/*
// @match	https://*.google.com.vn/*
// @match	https://*.google.vu/*
// @match	https://*.google.ws/*
// @match	https://*.google.rs/*
// @match	https://*.google.co.za/*
// @match	https://*.google.co.zm/*
// @match	https://*.google.co.zw/*
// ==/UserScript==

// Author: Ictinus
// Released: v1.00 21 October 2011
// Updated: 28 October 2011, v1.01 CTRL-z (or other unused CTRL-key) will disable links so the text may be double clicked. CTRL-z again to enable links.
// Updated: 01 November 2011, v1.02 Set popup to have higher display index.
// Updated: 01 November 2011, v1.03	Added functionality for all Google country search sites.
// Updated: 12 December 2011, v1.04 Prevent double click action from occuring in search edit box so that you may dblclick to highlight/remove.

var searchAssist = {
	urlOn: true,	
	addGlobalStyle : function(css) {
		var head, style;
		head = document.getElementsByTagName('head')[0];
		if (!head) {
			return;
		}
		style = document.createElement('style');
		style.type = 'text/css';
		style.innerHTML = css;
		head.appendChild(style);
	},
	toggleLinks: function(bEnableLinks) {
		var arrLinks = document.getElementsByClassName('l');
		var aLink;
		var aSpan;
		for (var idx = 0, len = arrLinks.length; idx < len; idx++) {
			aLink = arrLinks[idx];
			aSpan = aLink.nextSibling; 
			if (!aSpan) {
				aLink.style.display = "none";
				aSpan = document.createElement('span');
				aSpan.innerHTML = aLink.innerHTML;
				aLink.parentNode.appendChild(aSpan);
			} else {
				aSpan.parentNode.removeChild(aSpan);
				aLink.style.display = "block";
			}
		}
	},
	init: function () {
		var theDiv = document.createElement('div');
		theDiv.className = "saMenu";
		theDiv.id = "saMenu";
		var theLink = document.createElement('a');
		theLink.href = "#";
		theLink.className = "saLink";
		theLink.id = "saLinkAdd";
		theDiv.appendChild(theLink);
	
		theLink = document.createElement('a');
		theLink.href = "#";
		theLink.className = "saLink";
		theLink.id = "saLinkMin";
		theDiv.appendChild(theLink);

 		document.body.appendChild(theDiv);
 		document.body.addEventListener('keypress', function (e) {
				if (e.ctrlKey) {
					searchAssist.urlOn = !searchAssist.urlOn;
					searchAssist.toggleLinks(searchAssist.urlOn);
				}
 			}, false);
		document.body.addEventListener('click', function () {
				document.getElementById('saMenu').style.display = "none";
			}, false);
			
		document.body.addEventListener('dblclick', function (e) {
			if (e.target.id != 'lst-ib' && e.target.id != 'gbqfq') {
				e.stopPropagation();
				var elmSearchInput = document.getElementById("lst-ib") || document.getElementById("gbqfq");
				var strSearch = elmSearchInput.value;
				var strSelectedText = document.getSelection();
				var strURL = location.protocol + "//" + location.host + "/search?q=" + strSearch + " -"+strSelectedText;
				var theDiv = document.getElementById('saMenu');
				var theLink = theDiv.firstChild;
				theLink.href = strURL;
				theLink.innerHTML = "-" + strSelectedText;
	
				theLink = theLink.nextSibling;
				strURL = location.protocol + "//" + location.host + "/search?q=" + strSearch + " \""+strSelectedText+"\"";
				theLink.href = strURL;
				theLink.innerHTML = "+" + strSelectedText;
	
				theDiv.style.top = e.pageY + "px";
				theDiv.style.left = e.pageX + "px";
				theDiv.style.display = "block";
			}
		}, false);
	}
}	
if (document.body) {
	searchAssist.addGlobalStyle(' \
		div.saMenu {display:none; position: absolute; background: white; zpadding:0 0 0 4px; border:1px solid orangeRed; \
			-moz-box-shadow: 1px 3px 12px #888; -webkit-box-shadow: 1px 3px 12px #888; box-shadow: 1px 3px 12px #888; \
			-webkit-border-radius: 4px; -moz-border-radius: 4px; border-radius: 4px; \
			z-index:999; \
	 	} \
		a.saLink {display:block; padding:3px; margin:3px; background: #DDD; \
			-webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; text-decoration: none;} \
		a.saLink:hover {text-decoration: underline; }')
	searchAssist.init();
}
