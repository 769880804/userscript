// ==UserScript==
// @name				مسمي الهجمات
// @version    			الاجدد
// @description  		يعمل من غير ماتضغط ع البار السريع 
// @author				My skype: maystrokhalid
// @include	  			http://ae*.tribalwars.ae/game.php*screen=info_command*
// ==/UserScript==

	function V() { return 1; } window.onerror = V; function Z() { c = '{unit}  [{coords}] [{player}] [Id Attack {attack_id}]'; p = ['كشافة', 'خفيف', 'ثقيل', 'فاس', 'سيف', 'محطمة', 'نبيـــل']; d = document; aid = d.getElementById('editInput').parentNode.innerHTML.match(/id\=(\d+)/)[1]; function J(e) { return /\s\(((\d+)\|(\d+))\)\sK/i.exec(e); } function K(e) { f = parseInt(e, 10); return (f > 9 ? f : '0' + f); } function L(g, e) { return g.getElementsByTagName(e); } function N(g) { return g.innerHTML; } function M(g) { return N(L(g, 'a')[0]); } function O() { return k.insertRow(E++); } function W(f) { return B.insertCell(f); } function P(g, e) { g.innerHTML = e; return g; } function X(e) { C = B.appendChild(d.createElement('th')); return P(C, e); } function Y(f) { return K(f / U) + ':' + K(f % (U) / T) + ':' + K(f % T); } U = 3600; T = 60; R = 'table'; S = 'width'; s = L(document, R); for (j = 0; j < s.length; j++) { s[j].removeAttribute(S); if (s[j].className == 'main') { s = L(L(s[j], 'tbody')[0], R); break; } } D = 0; for (j = 0; j < s.length; j++) { s[j].removeAttribute(S); if (s[j].className = 'vis') { k = s[j]; if (t = k.rows) D = t.length; break; } } for (E = 0; E < D; E++) { l = t[E]; m = (u = l.cells) ? u.length : 0; if (m) { u[m - 1].colSpan = 5 - m; if (N(u[0]) == 'وقت الوصول:') Q = new Date(N(u[1]).replace(/<.*/i, '')); else { if (N(u[0]) == 'وصول في:') v = N(u[1]).match(/\d+/ig); } if (E == 1) G = M(u[2]); if (E == 2) w = J(M(u[1])); if (E == 4) x = J(M(u[1])); } } y = v[0] * U + v[1] * T + v[2] * 1; n = w[2] - x[2]; o = w[3] - x[3]; F = Math.sqrt(n * n + o * o); H = F.toFixed(2); E = D - 2; s = L(k, 'input'); i = s[1]; h = s[0]; h.size = T; B = O(); P(W(0), 'المسافة').colSpan = 2; P(W(1), H + ' حقل').colSpan = 2; B = O(); X('الوحدة'); X('التحرك قبل'); X('المسافة'); X('اعادة التسمية <td align="right"><a href="http://forum.tribalwars.ae/member.php?23593-axen" target="_blank">وحش الكهوف</a></td> '); c = c.replace(/\{coords\}/i, w[1]).replace(/\{distance\}/i, H).replace(/\{player\}/i, G); for (j in p) { z = Math.round([8.99999999928,9.999999998,11.0000000011,18.000000000504,21.999999999296,29.9999999976,34.9999999993][j] * T * F); A = z - y; if (A > 0) { I = Y(z); B = O(); P(W(0), p[j]); P(W(1), A < T && 'الان' || A < U && Math.floor(A / T) + ' قبل دقيقة' || Y(A) + 'قبل '); P(W(2), I); C = W(3); q = C.appendChild(i.cloneNode(1)); r = C.appendChild(h.cloneNode(1)); r.id = 'I' + j; r.value = c.replace(/\{duration\}/i, I).replace(/\{sent\}/i, new Date(Q.valueOf() - z * 1000).toLocaleString().replace(/.\d{4}/i, '').replace(/(\w{3})\w*/i, '$1')).replace(/\{return\}/i, new Date(Q.valueOf() + z * 1000).toLocaleString().replace(/.\d{4}/i, '').replace(/(\w{3})\w*/i, '$1')).replace(/\{unit\}/i, p[j]).replace(/\{attack_id\}/i, aid); q.onmousedown = new Function('h.value=d.getElementById(\'I' + j + '\').value;'); } } } Z();