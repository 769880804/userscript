// ==UserScript==
// @name       TF2Outpost Toolbox Donator Version
// @namespace  http://www.vaicine.com/tf2outpost
// @version    1.4.5
// @description  Lots of tools for tf2outpost
// @match      http://www.tf2outpost.com/*
// @copyright  http://steamcommunity.com/id/vaicine
// ==/UserScript==


function addJQuery(a){var b=document.createElement("script");b.setAttribute("src","http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"),b.addEventListener("load",function(){var b=document.createElement("script");b.textContent="("+(""+a)+")();",document.body.appendChild(b)},!1),document.body.appendChild(b)}function main(){var a=document.cookie.split(";"),b="1.4.5";if(donatorCookie=$.grep(a,function(a){return a.match("TF2OutpostToolboxDonatorID")}),0==donatorCookie.length)var c=prompt("Please enter your toolbox key","");else var c=donatorCookie[0].split("=")[1];pricesCacheLastUpdated=localStorage.getItem("TF2pricesCacheLastUpdate"),null==pricesCacheLastUpdated?(today=new Date,localStorage.setItem("TF2pricesCacheLastUpdate",""+today),$.ajax({url:"http://backpack.tf/api/IGetPrices/v2/?format=jsonp&cy=metal",type:"GET",dataType:"jsonp",success:function(a){localStorage.setItem("TF2PricesCache",JSON.stringify(a.response))}})):(pricesCacheLastUpdated=new Date(pricesCacheLastUpdated),nextUpdateDate=new Date(pricesCacheLastUpdated),nextUpdateDate.setHours(pricesCacheLastUpdated.getHours()+3),today=new Date,nextUpdateDate.getTime()<today.getTime()&&(localStorage.setItem("TF2pricesCacheLastUpdate",""+today),$.ajax({url:"http://backpack.tf/api/IGetPrices/v2/?format=jsonp&cy=metal",type:"GET",dataType:"jsonp",success:function(a){localStorage.setItem("TF2PricesCache",JSON.stringify(a.response))}}))),cleanupitems=[190,191,192,193,194,195,196,197,198,199,199,199,199,200,201,202,203,204,205,206,207,208,209,209,210,737,212,211,294,736,600],pricesCache=JSON.parse(localStorage.getItem("TF2PricesCache")),keyprice=pricesCache.prices[5021][6][0].value,budprice=pricesCache.prices[143][6][0].value,null!=pricesCache&&$.each($(".item"),function(a,b){itemNumber=$(b).attr("data-hash").split(","),9e4>itemNumber[1]&&(35>itemNumber[1]&&(itemNumber[1]=cleanupitems[itemNumber[1]]),void 0!=pricesCache.prices[itemNumber[1]]&&void 0!=pricesCache.prices[itemNumber[1]][itemNumber[2]]&&void 0!=pricesCache.prices[itemNumber[1]][itemNumber[2]][0]&&(price=pricesCache.prices[itemNumber[1]][itemNumber[2]][0].value,price>budprice?price=parseFloat((price/budprice).toFixed(1))+" buds":price>keyprice?price=parseFloat((price/keyprice).toFixed(1))+" keys":price+=" ref",$(b).find(".details").append('<br/><span class="label">Price: '+price+"</span>")))}),$("body").prepend("<style>             #navigation ul#savedSearches, #navigation ul#togglesList, #navigation ul#toolboxList {padding: 10px;background: #161514;position: absolute;top: 33px;left: 0;max-height: 200px; overflow-y:auto;width: 300px; border-radius: 0 0 6px 6px;z-index:9000;}             #navigation ul#savedSearches li .deleteSearch, #header #navigation li a.deleteFilter {color:red; font-weight:bold;cursor:pointer;float:right;}             #header #navigation li .filterString {float:right;width:126px;overflow:hidden;height:18px;text-align:right;}             #navigation ul#savedSearches li, #navigation ul#togglesList li, #navigation ul#toolboxList li {float:none; margin:0;}            #navigation ul#toolboxList li .selected { font-weight:bold;}            #navigation ul#savedSearches li.action {margin-top:10px; border-top:1px solid #3B342F; padding-top:10px;}             #header #navigation li .newVersionNoti a {font-size:12px; color:red;margin-left:5px;}             #navigation .on {color:green;}             #navigation .off {color:red;}             #header #navigation li, #header #logo {margin-right:20px;}             select#unusualEffects {width: auto; border: 0; height: auto; margin-bottom: 10px; margin-left: 0;}             #wrapper .main {width:auto;}           </style>"),hiddenTradesCookie=$.grep(a,function(a){return a.match("TF2hiddenTrades")}),hiddenTradesCookie.length>0?(hiddenTrades=hiddenTradesCookie[0].replace("TF2hiddenTrades=",""),localStorage.setItem("TF2hiddenTrades",hiddenTrades.replace(/ /g,"")),newHiddenTrades=localStorage.getItem("TF2hiddenTrades"),newHiddenTrades.split(",").length>0&&(removalExpiryDate=new Date("1970","01","01"),document.cookie="TF2hiddenTrades=;expires="+removalExpiryDate+";path=/"),hiddenTradeCount=newHiddenTrades.split(",").length):(hiddenTrades=localStorage.getItem("TF2hiddenTrades"),null!=hiddenTrades?hiddenTradeCount=hiddenTrades.split(",").length:(localStorage.setItem("TF2hiddenTrades",[]),hiddenTradeCount=0)),notesOnTradeListings=localStorage.getItem("TF2notesOnTradeListings"),null==notesOnTradeListings||"show"==notesOnTradeListings?($(".notes_toggle").remove(),notesStyling=notesOnTradeListingsText="Hide notes on trade listings"):(notesStyling="",notesOnTradeListingsText="Show notes on trade listings"),$("#navigation li:nth-child(6)").after('<li style="color:#887B6F;">|</li><li><a href="" id="showSavedSearch">Saved searches</a><ul id="savedSearches" style="display:none;"></ul></li>                                             <li><a href="" id="showToggles">Toggles</a><ul id="togglesList" style="display:none;">                                                 <li><a href="" id="toggleByItemLevel">Show by item level</a></li>                                                 <li><a href="" id="toggleByCraftNumber">Show by craft number</a></li>                                                 <li><a href="" id="toggleByUnusualEffect">Show by unusual effect</a>                                                     <select id="unusualEffects" style="display:none;">                                                     <option value="">Please choose an effect</option>                                                     <option value="30">Blizzardy Storm</option>                                                     <option value="34">Bubbling</option>                                                     <option value="13">Burning Flames</option>                                                     <option value="39">Cauldron Bubbles</option>                                                     <option value="19">Circling Heart</option>                                                     <option value="18">Circling Peace Sign</option>                                                     <option value="11">Circling TF Logo</option>                                                     <option value="38">Cloudy Moon</option>                                                     <option value="4">Community Sparkle</option>                                                     <option value="40">Eerie Orbiting Fire</option>                                                     <option value="37">Flaming Lantern</option>                                                     <option value="2">Flying Bits</option>                                                     <option value="28">Genteel Smoke</option>                                                     <option value="6">Green Confetti</option>                                                     <option value="9">Green Energy</option>                                                     <option value="8">Haunted Ghosts</option>                                                     <option value="5">Holy Glow</option>                                                     <option value="20">Map Stamps</option>                                                     <option value="12">Massed Flies</option>                                                     <option value="3">Nemesis Burst</option>                                                     <option value="31">Nuts n Bolts</option>                                                     <option value="33">Orbiting Fire</option>                                                     <option value="32">Orbiting Planets</option>                                                     <option value="1">Particle 1</option>                                                     <option value="7">Purple Confetti</option>                                                     <option value="10">Purple Energy</option>                                                     <option value="14">Scorching Flames</option>                                                     <option value="15">Searing Plasma</option>                                                     <option value="35">Smoking</option>                                                     <option value="36">Steaming</option>                                                     <option value="29">Stormy Storm</option>                                                     <option value="17">Sunbeams</option>                                                     <option value="16">Vivid Plasma</option>                                                     </select>                                                 </li>                                                 <li><a href="" id="showByKeyword">Show by keyword</a></li>                                                 <li><a href="" id="hideByKeyword">Hide by keyword</a></li>                                                 <li><a href="" id=""></a></li>                                             </ul>                                             </li>                                             <li><a href="" id="showToolbox">Toolbox</a><span class="newVersionNoti" style="display:none;"><a href="http://www.vaicine.com/tf2outpost/redirect/" target="_blank">(New version available)</a></span>                                                 <ul id="toolboxList" style="display:none;">                                                     <li>Hidden trade count: <span id="hiddenTradeCount">'+hiddenTradeCount+'</span></li>                                                     <li><a href="" id="removeAllHiddenTrades">Clear all hidden trades</a></li>                                                     <li><a href="" id="removeLast10Trades">Clear last 10 hidden trades</a></li>                                                     <li><a href="" id="removeFirst10Trades">Clear first 10 hidden trades</a></li>                                                     <li><a href="" id="clearSavedSearches">Clear saved searches</a></li>                                                     <li><a href="" id="toggleNotesOnTradeListing">'+notesOnTradeListingsText+"</a></li>                                             </li>"),newVersionChecked=$.grep(a,function(a){return a.match("TF2OutpostToolboxVersion")}),0==newVersionChecked.length?$.ajax({url:"http://www.vaicine.com/tf2outpost/v.json",type:"GET",dataType:"jsonp",data:"id="+c,success:function(a){expiryDate=new Date("3012","01","01"),document.cookie="TF2OutpostToolboxDonatorID="+c+";expires="+expiryDate+";path=/",document.cookie="TF2OutpostToolboxVersion="+a.version+";path=/",console.log(b),a.version!=b&&$(".newVersionNoti").show()}}):newVersionChecked[0].split("=")[1]!=b&&$(".newVersionNoti").show(),HideKeywordFilter=localStorage.getItem("TF2HideKeywordFilter"),ShowKeywordFilter=localStorage.getItem("TF2ShowKeywordFilter"),ItemLevelKeywordFilter=localStorage.getItem("TF2ItemLevelFilter"),CraftNumberKeywordFilter=localStorage.getItem("TF2CraftNumberFilter"),null!=HideKeywordFilter&&""!=HideKeywordFilter&&$("#hideByKeyword").after('<a href="" class="deleteFilter" id="TF2HideKeywordFilter">X</a><span class="filterString">'+HideKeywordFilter+"</span>"),null!=ShowKeywordFilter&&""!=ShowKeywordFilter&&$("#showByKeyword").after('<a href="" class="deleteFilter" id="TF2ShowKeywordFilter">X</a><span class="filterString">'+ShowKeywordFilter+"</span>"),null!=ItemLevelKeywordFilter&&""!=ItemLevelKeywordFilter&&$("#toggleByItemLevel").after('<a href="" class="deleteFilter" id="TF2ItemLevelFilter">X</a><span class="filterString">'+ItemLevelKeywordFilter+"</span>"),null!=CraftNumberKeywordFilter&&""!=CraftNumberKeywordFilter&&$("#toggleByCraftNumber").after('<a href="" class="deleteFilter" id="TF2CraftNumberFilter">X</a><span class="filterString">'+CraftNumberKeywordFilter+"</span>"),$(".deleteFilter").bind("click",function(a){return a.preventDefault(),localStorage.setItem($(a.currentTarget).attr("id"),""),$(a.currentTarget).next(".filterString").remove(),$(a.currentTarget).remove(),$(".trade").show(),!1}),savedSearches=$.grep(a,function(a){return a.match("TF2SavedSearches")}),savedSearches.length>0&&(savedSearches=savedSearches[0].replace("TF2SavedSearches=",""),localStorage.setItem("TF2SavedSearches",savedSearches),newSavedSearches=localStorage.getItem("TF2SavedSearches"),newSavedSearches.split(",").length>0&&(removalExpiryDate=new Date("1970","01","01"),document.cookie="TF2SavedSearches=;expires="+removalExpiryDate+";path=/")),savedSearchList=localStorage.getItem("TF2SavedSearches"),savedSearchList=null!=savedSearchList?savedSearchList.split(","):[],$.each(savedSearchList,function(a,b){""!=b&&(searchItem=b.split("-"),void 0!=searchItem[1]&&$("#savedSearches").append('<li><a href="/search/'+searchItem[1]+'">'+searchItem[0]+'</a> <span class="deleteSearch">X</span></li>'))}),$("#clearSavedSearches").bind("click",function(a){return a.preventDefault(),clearSavedSearches=confirm("This will remove all your saved searches. This is helpful if you input a strange character into the name."),1==clearSavedSearches&&(localStorage.setItem("TF2SavedSearches",""),$.each($("#savedSearches li"),function(a,b){$(b).hasClass("action")||$(b).remove()})),!1}),$("#toggleNotesOnTradeListing").bind("click",function(a){return a.preventDefault(),"Hide notes on trade listings"==$(a.currentTarget).html()?(alert("Refresh the page for this to take effect"),localStorage.setItem("TF2notesOnTradeListings","hide"),$(a.currentTarget).html("Show notes on trade listings")):(alert("Refresh the page for this to take effect"),localStorage.setItem("TF2notesOnTradeListings","show"),$(a.currentTarget).html("Hide notes on trade listings")),!1}),$("#removeAllHiddenTrades").bind("click",function(a){return a.preventDefault(),removeAllTrades=confirm("This will show ALL the trades you have hidden previously! Are you sure you want to do this?"),1==removeAllTrades&&(localStorage.setItem("TF2hiddenTrades",""),$("#hiddenTradeCount").html("0"),alert("All previously hidden trades will now show again")),!1}),$("#removeLast10Trades").bind("click",function(a){return a.preventDefault(),hiddenTrades=localStorage.getItem("TF2hiddenTrades"),hiddenTradeList=hiddenTrades.split(","),hiddenTradeList.splice(0,10),localStorage.setItem("TF2hiddenTrades",hiddenTradeList),$("#hiddenTradeCount").html(parseInt($("#hiddenTradeCount").html())-10),!1}),$("#removeFirst10Trades").bind("click",function(a){return a.preventDefault(),hiddenTrades=localStorage.getItem("TF2hiddenTrades"),hiddenTradeList=hiddenTrades.split(","),hiddenTradeList.splice(parseInt(hiddenTradeList.length)-10,10),localStorage.setItem("TF2hiddenTrades",hiddenTradeList),$("#hiddenTradeCount").html(parseInt($("#hiddenTradeCount").html())-10),!1}),$(".deleteSearch").bind("click",function(a){return a.preventDefault(),searchIDToDelete=$(a.currentTarget).siblings("a").attr("href").replace("/search/",""),searchNameToDelete=$(a.currentTarget).siblings("a").html(),searchToDelete=searchNameToDelete+"-"+searchIDToDelete,savedSearches=localStorage.getItem("TF2SavedSearches"),newSavedSearches=savedSearches.split(","),newSavedSearches.splice(newSavedSearches.indexOf(searchToDelete),1),localStorage.setItem("TF2SavedSearches",newSavedSearches),$(a.currentTarget).parent().remove(),!1}),$("#showSavedSearch").bind("click",function(a){return a.preventDefault(),$("#savedSearches").toggle(),$("#togglesList").hide(),$("#toolboxList").hide(),!1}),$("#showToggles").bind("click",function(a){return a.preventDefault(),$("#togglesList").toggle(),$("#savedSearches").hide(),$("#toolboxList").hide(),!1}),$("#showToolbox").bind("click",function(a){return a.preventDefault(),$("#toolboxList").toggle(),$("#togglesList").hide(),$("#savedSearches").hide(),!1}),$("#toggleByUnusualEffect").bind("click",function(a){return a.preventDefault(),$("#unusualEffects").toggle(),!1}),$("#wrapper .main").bind("click",function(){$("#toolboxList").hide(),$("#togglesList").hide(),$("#savedSearches").hide()}),$("#hideByKeyword").bind("click",function(a){return a.preventDefault(),$(".trade").show(),keyword=prompt("Please enter the keyword you would like to hide trades with",""),null==keyword?!1:($(a.currentTarget).parent().find(".filterString").length>0?($(a.currentTarget).parent().find(".filterString").remove(),$(a.currentTarget).parent().find(".deleteFilter").after('<span class="filterString">'+keyword+"</span>")):$(a.currentTarget).after('<span class="filterString">'+keyword+"</span>"),$("#togglesList").toggle(),localStorage.setItem("TF2HideKeywordFilter",keyword),$.each($(".trade"),function(a,b){null!=$(b).find(".notes.expandable").html()&&$(b).find(".notes.expandable").html().match(keyword)&&$(b).hide()}),0==$(".trade:visible").length&&($("#wrapper .main").prepend("<h2>No trades! Moving to next page...</h2>"),window.location=$("#pagination .selected").next().attr("href")),!1)}),$("#showByKeyword").bind("click",function(a){return a.preventDefault(),$(".trade").show(),keyword=prompt("Please enter the keyword you would like to show trades with",""),null==keyword?!1:($(a.currentTarget).parent().find(".filterString").length>0?($(a.currentTarget).parent().find(".filterString").remove(),$(a.currentTarget).parent().find(".deleteFilter").after('<span class="filterString">'+keyword+"</span>")):$(a.currentTarget).after('<span class="filterString">'+keyword+"</span>"),$("#togglesList").toggle(),localStorage.setItem("TF2ShowKeywordFilter",keyword),$.each($(".trade"),function(a,b){(null==$(b).find(".notes.expandable").html()||null==$(b).find(".notes.expandable").html().match(keyword))&&$(b).hide()}),0==$(".trade:visible").length&&($("#wrapper .main").prepend("<h2>No trades! Moving to next page...</h2>"),window.location=$("#pagination .selected").next().attr("href")),!1)}),$("#toggleByItemLevel").bind("click",function(a){return a.preventDefault(),level=prompt("Please enter the item level you would like to show trades with",""),null==level?!1:($(a.currentTarget).parent().find(".filterString").length>0?($(a.currentTarget).parent().find(".filterString").remove(),$(a.currentTarget).parent().find(".deleteFilter").after('<span class="filterString">'+level+"</span>")):$(a.currentTarget).after('<span class="filterString">'+level+"</span>"),$("#togglesList").toggle(),localStorage.setItem("TF2ItemLevelFilter",level),levelString="level:"+level+";",tradesToKeep=[],$.each($(".item"),function(a,b){$(b).attr("search").match(levelString)&&tradesToKeep.push($(b).closest(".trade"))}),$(".trade").hide(),$.each(tradesToKeep,function(a,b){$(b).show()}),0==$(".trade:visible").length&&($("#wrapper .main").prepend("<h2>No trades! Moving to next page...</h2>"),window.location=$("#pagination .selected").next().attr("href")),!1)}),$("#toggleByCraftNumber").bind("click",function(a){return a.preventDefault(),$(".trade").show(),craftNumber=prompt("Please enter the craft number you would like to show trades with",""),null==craftNumber?!1:($(a.currentTarget).parent().find(".filterString").length>0?($(a.currentTarget).parent().find(".filterString").remove(),$(a.currentTarget).parent().find(".deleteFilter").after('<span class="filterString">'+craftNumber+"</span>")):$(a.currentTarget).after('<span class="filterString">'+craftNumber+"</span>"),$("#togglesList").toggle(),localStorage.setItem("TF2CraftNumberFilter",craftNumber),craftNumberString="series:"+craftNumber+";",tradesToKeep=[],$.each($(".item"),function(a,b){$(b).attr("search").match(craftNumberString)&&tradesToKeep.push($(b).closest(".trade"))}),$(".trade").hide(),$.each(tradesToKeep,function(a,b){$(b).show()}),0==$(".trade:visible").length&&($("#wrapper .main").prepend("<h2>No trades! Moving to next page...</h2>"),window.location=$("#pagination .selected").next().attr("href")),!1)}),$("#unusualEffects").bind("change",function(){return console.log("hello"),$(".trade").show(),unusualEffect=$("#unusualEffects").val(),""==unusualEffect?!1:($("#togglesList").toggle(),localStorage.setItem("TF2UnusualEffectFilter",unusualEffect),unusualEffectString="effect:"+unusualEffect+";",tradesToKeep=[],$.each($(".item"),function(a,b){$(b).attr("search").match(unusualEffectString)&&tradesToKeep.push($(b).closest(".trade"))}),$(".trade").hide(),$.each(tradesToKeep,function(a,b){$(b).show()}),void 0)}),$(".trade").length>1&&null==window.location.href.match(/http\:\/\/www\.tf2outpost\.com\/trade\/[0-9]*/)&&(null==notesOnTradeListings||"show"==notesOnTradeListings?($(".notes_toggle").remove(),$(window).width()>=1500?(notesStyling="float:right;display:block;opacity:1;margin-top:-34px;margin-right:191px;height:195px;overflow:hidden;width:340px;background:transparent;border:0;position:relative;",moreInfoStyling="top: 192px;"):(notesStyling="float:none;clear:both;display:block;opacity:1;margin-top:0;margin-right:191px;height:55px;overflow:hidden;width:"+(parseInt($(window).width())-280)+"px;background:transparent;border:0;position:relative;",moreInfoStyling="top:53px;"),notesOnTradeListingsText="Hide notes on trade listings"):(notesStyling="",moreInfoStyling="",notesOnTradeListingsText="Show notes on trade listings"),1366>$(window).width()&&($("#settings li").css({"margin-right":"8px"}),$("#navigation li a").css({"font-size":"9pt"}),$("#more").css({"margin-right":"0"})),$(".trade hr.clear").length>1&&$.each($(".trade"),function(a,b){$(b).find("hr").remove(),$(b).find(".notes").after('<hr class="clear" />')}),$("body").prepend("<style>                     #wrapper .main {padding:20px;}                     #wrapper .main .trade .caption a.hidetrade {color:#FF8000; font-size:9pt;}                     #wrapper .main .trade .notes.expandable{"+notesStyling+"}                     #wrapper .main .trade .moreInfo {position: absolute; background: #2A2725;width: 100%;left: 0;padding: 0 8px;}                     #wrapper .main .trade.odd .moreInfo {background: #3B342F;}                     #wrapper .main .trade .moreInfo.showing {bottom:0;}                     #wrapper .main .trade .moreInfo.hiding {"+moreInfoStyling+"}                     #wrapper .main .trade {width:100%;padding:10px;border-radius:6px;}                     #wrapper .main .trade.odd {background:#3b342f;}                     .offered {margin-left:5px;font-size:9pt;color:green;}                  </style>"),hiddenTrades=localStorage.getItem("TF2hiddenTrades"),tradesWithOffers=null!=hiddenTrades?localStorage.getItem("TF2tradesWithOffers"):[],hiddenTradeList=hiddenTrades.length>0?hiddenTrades.split(","):[],null==window.location.href.match("trades")&&($.each($(".trade"),function(a,b){tradeId=$(b).closest(".trade").find(".bookmark_toggle").attr("tradeid"),-1!=$.inArray(tradeId,hiddenTradeList)?$(b).remove():(0==a%2&&$(b).addClass("odd"),$(b).find("hr").remove(),$(b).append('<hr class="clear" />'),null!=tradesWithOffers&&-1!=$.inArray(tradeId,tradesWithOffers.split(","))&&$(b).find(".caption").append('<span class="offered">(Offered)</span'),$(b).find(".caption").append(' <a class="hidetrade" href="">Hide trade?</a>')),tradeNotes=$(b).find(".notes.expandable"),$(tradeNotes).length>0&&$(tradeNotes)[0].scrollHeight>$(tradeNotes).outerHeight()&&$(tradeNotes).append('<a href="" class="moreInfo hiding">Show full notes</a>')}),$(".moreInfo").bind("click",function(a){return a.preventDefault(),"Show full notes"==$(a.currentTarget).html()?($(a.currentTarget).parent().css({height:"100%","padding-bottom":"25px"}),$(a.currentTarget).addClass("showing"),$(a.currentTarget).removeClass("hiding"),$(a.currentTarget).html("Hide full notes")):($(window).width()>=1500?$(a.currentTarget).parent().css({height:"195px","padding-bottom":"8px"}):$(a.currentTarget).parent().css({height:"55px","padding-bottom":"8px"}),$(a.currentTarget).removeClass("showing"),$(a.currentTarget).addClass("hiding"),$(a.currentTarget).html("Show full notes")),!1}),0==$(".trade").length&&($("#wrapper .main").prepend("<h2>No trades! Moving to next page...</h2>"),window.location=$("#pagination .selected").next().attr("href")),$(".hidetrade").bind("click",function(a){return a.preventDefault(),tradeToRemove=$(a.currentTarget).closest(".trade").find(".bookmark_toggle").attr("tradeid"),hiddenTrades=localStorage.getItem("TF2hiddenTrades"),localStorage.setItem("TF2hiddenTrades",tradeToRemove+","+hiddenTrades),$(a.currentTarget).closest(".trade").slideUp("normal",function(){$(this).remove()}),$("#hiddenTradeCount").html(parseInt($("#hiddenTradeCount").html())+1),!1}),HideKeywordFilter=localStorage.getItem("TF2HideKeywordFilter"),ShowKeywordFilter=localStorage.getItem("TF2ShowKeywordFilter"),ItemLevelKeywordFilter=localStorage.getItem("TF2ItemLevelFilter"),CraftNumberKeywordFilter=localStorage.getItem("TF2CraftNumberFilter"),null!=HideKeywordFilter&&""!=HideKeywordFilter&&(keyword=HideKeywordFilter,$.each($(".trade"),function(a,b){null!=$(b).find(".notes.expandable").html()&&$(b).find(".notes.expandable").html().match(keyword)&&$(b).hide()}),0==$(".trade:visible").length&&($("#wrapper .main").prepend("<h2>No trades! Moving to next page...</h2>"),window.location=$("#pagination .selected").next().attr("href"))),null!=ShowKeywordFilter&&""!=ShowKeywordFilter&&(keyword=ShowKeywordFilter,$.each($(".trade"),function(a,b){(null==$(b).find(".notes.expandable").html()||null==$(b).find(".notes.expandable").html().match(keyword))&&$(b).hide()}),0==$(".trade:visible").length&&($("#wrapper .main").prepend("<h2>No trades! Moving to next page...</h2>"),window.location=$("#pagination .selected").next().attr("href"))),null!=ItemLevelKeywordFilter&&""!=ItemLevelKeywordFilter&&(level=ItemLevelKeywordFilter,levelString="level:"+level+";",tradesToKeep=[],$.each($(".item"),function(a,b){$(b).attr("search").match(levelString)&&tradesToKeep.push($(b).closest(".trade"))}),$(".trade").hide(),$.each(tradesToKeep,function(a,b){$(b).show()}),0==$(".trade:visible").length&&($("#wrapper .main").prepend("<h2>No trades! Moving to next page...</h2>"),window.location=$("#pagination .selected").next().attr("href"))),null!=CraftNumberKeywordFilter&&""!=CraftNumberKeywordFilter&&(craftNumber=CraftNumberKeywordFilter,craftNumberString="series:"+craftNumber+";",tradesToKeep=[],$.each($(".item"),function(a,b){$(b).attr("search").match(craftNumberString)&&tradesToKeep.push($(b).closest(".trade"))}),$(".trade").hide(),$.each(tradesToKeep,function(a,b){$(b).show()}),0==$(".trade:visible").length&&($("#wrapper .main").prepend("<h2>No trades! Moving to next page...</h2>"),window.location=$("#pagination .selected").next().attr("href"))))),null!=window.location.href.match(/http\:\/\/www\.tf2outpost\.com\/search\/[0-9]*/)&&($("#savedSearches").append('<li class="action"><a href="" id="addCurrentSearch">Add current search</a></li>'),$("#addCurrentSearch").bind("click",function(a){return a.preventDefault(),searchName=prompt("Please input search name (Please don't use characters like !\"\u00a3$%^&*()_+ as it'll probably fuck up the script :)",""),searchToSave=window.location.href.replace("http://www.tf2outpost.com/search/",""),savedSearches=localStorage.getItem("TF2SavedSearches"),localStorage.setItem("TF2SavedSearches",searchName+"-"+searchToSave+","+savedSearches),$("#savedSearches").prepend('<li><a href="" class="loadSave" saveid="'+searchToSave+'">'+searchName+"</a></li>"),!1})),null!=window.location.href.match(/http\:\/\/www\.tf2outpost\.com\/trade\/[0-9]*/)&&window.location.href.match("trade").length>0&&($("body").prepend("<style>                             #wrapper .main .trade .caption a.hidetrade {color:#FF8000; font-size:9pt;}                             .offered {margin-left:5px;font-size:9pt;color:green;}                          </style>"),$(".notes_edit").bind("click",function(a){return a.preventDefault,$("#notes_edit_modal textarea").val($(a.currentTarget).attr("data-bbcode")),$("#notes_edit_modal form").attr("action","/trade/"+$(a.currentTarget).attr("data-tradeid")+"/edit"),!1}),tradesWithOffers=localStorage.getItem("TF2tradesWithOffers"),currentTrade=window.location.href.replace("http://www.tf2outpost.com/trade/",""),null==tradesWithOffers||-1==$.inArray(currentTrade,tradesWithOffers.split(","))?(yourId=$("#user a").attr("href").replace("/user/",""),$.each($(".notes"),function(a,b){return void 0!=$(b).find(".avatar a").attr("href")&&$(b).find(".avatar a").attr("href").replace("/user/","")==yourId?(null==tradesWithOffers?localStorage.setItem("TF2tradesWithOffers",currentTrade):localStorage.setItem("TF2tradesWithOffers",tradesWithOffers+","+currentTrade),$(".trade .hidetrade").before('<span class="offered">(Offered)</span'),!1):void 0})):$(".trade .caption").append('<span class="offered">(Offered)</span'),hiddenTrades=localStorage.getItem("TF2hiddenTrades"),hiddenTradeList=hiddenTrades.split(","),$.each($(".trade"),function(a,b){tradeId=$(b).closest(".trade").find(".bookmark_toggle").attr("tradeid"),-1!=$.inArray(tradeId,hiddenTradeList)?($("#wrapper .main").css({opacity:"0.4"}),$("#wrapper .main").before("<h2 style='margin:20px 0 0 30px;'>You have hidden this trade!</h2>")):$(b).find(".caption").append(' <a class="hidetrade" href="">Hide trade?</a>')}),steamID=$(".profile").attr("href").replace("http://steamcommunity.com/profiles/",""),$(".tools").prepend('<a href="steam://friends/add/'+steamID+'" style="margin: 0px 12px 0px 0px; opacity: 0.6;"><img src="/images/icons/users/addfriend.png" width="24" height="24" alt="Add on Steam"></a><a id="block_toggle" style="margin: 0px 12px 0px 0px; opacity: 0.6; "><img src="/images/icons/users/block.png" width="24" height="24" alt="Block User"></a>'),$("#block_toggle").bind("click",function(){var b=$(".trade .notes .text. h3 span a").attr("href").replace("/user/","");return tf2op.api.send_request(API_URL+"/user?action=block.toggle",{userid:b},function(a){console.log(a.block),"added"==a.block?$("#block_toggle img").attr("src","/images/icons/users/block-active.png"):"removed"==a.block&&$("#block_toggle img").attr("src","/images/icons/users/block.png")},function(){}),!1}),$(".hidetrade").bind("click",function(a){return a.preventDefault(),tradeToRemove=$(a.currentTarget).closest(".trade").find(".bookmark_toggle").attr("tradeid"),hiddenTrades=localStorage.getItem("TF2hiddenTrades"),localStorage.setItem("TF2hiddenTrades",tradeToRemove+","+hiddenTrades),$(a.currentTarget).closest(".trade").slideUp(),!1}))}addJQuery(main);