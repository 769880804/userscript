// ==UserScript==
// @name			TWLeoTools
// @namespace		TWLT
// @author			Leotas [The-West DE W13-16]
// @description		Tools rund um und f√ºr The West
// @include			http://*.the-west.*/game.php*
// @include			http://*.the-west.*/index.php*
// @version			1.09
// @history			none
// @grant			none
// ==/UserScript==
/////////////////////////////////////////////////////////////////////////////////////////////
if(location.href.indexOf("index.php?page=logout")!=-1)location.href="index.php"; if(location.href.indexOf("game.php")!=-1)(function(fn){var script=document.createElement("script");script.setAttribute("type","text/javascript");script.textContent="("+fn.toString()+")();";document.head.appendChild(script)})(function(){TWLT={};TWLT.Skript={Author:"Leotas [TW DE W13-16]",Webseite:"http://userscripts.org/scripts/show/169774",MinGameVersion:"2.04",MaxGameVersion:"2.04",Name:"TWLeoTools",Version:1.09};TWLT.Images={Settings:"data:image/png;base64,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", Logout:"data:image/png;base64,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"}; TWLT.Updater={ShowMessage:false,update:function(version){var dialog=new west.gui.Dialog("TWLeoTools - Update","<span>F\u00fcr die TWLeoTools ist ein Update verf\u00fcgbar.<br /><b>Neue Version : "+version+".</b><br />Soll das Update jetzt durchgef\u00fchrt werden ?</span>",west.gui.Dialog.SYS_QUESTION);dialog.addButton("Ja",function(){dialog.hide();location.href="https://googledrive.com/host/0B7sQ5ku6LWcFWnExTkh5T0cwbVE/TWLTmin.user.js"}).addButton("Nein",function(){});dialog.show()},init:function(message){if(message)TWLT.Updater.ShowMessage= message;var script=$('<script id="TWLTUpdater" src="https://googledrive.com/host/0B7sQ5ku6LWcFWnExTkh5T0cwbVE/TWLTUpdater.js" type="text/javascript">\x3c/script>');$("head").append(script)},check:function(version){$("#TWLTUpdater").remove();if(version>TWLT.Skript.Version){TWLT.Updater.update(version);return}if(TWLT.Updater.ShowMessage)(new UserMessage("Das Skript ist auf der aktuellen Version "+TWLT.Skript.Version+".",UserMessage.TYPE_SUCCESS)).show()}};TWLT.Settings={init:function(){TWLT.Updater.init(); var WestAPI=TheWestApi.register(TWLT.Skript.Name,TWLT.Skript.Name,TWLT.Skript.MinGameVersion,TWLT.Skript.MaxGameVersion,TWLT.Skript.Author,TWLT.Skript.Webseite);WestAPI.setGui(TWLT.Skript.Name+' - Skript<br /><br />n\u00e4here Informationen:<br /><a href="javascript:TWLT.GUI.open();">Skriptfenster \u00f6ffnen</a>');var menuContainer=$('<div class="ui_menucontainer" />');menuContainer.append($('<div id="TWLTmenulink" class="menulink" onclick="TWLT.Settings.open();" title="TWLT Einstellungen" style="background:url('+ TWLT.Images.Settings+');" /><div class="menucontainer_bottom" />'));$("#ui_menubar").append(menuContainer);for(var k in TWLT.Settings.Features)TWLT.Settings.Features[k][1]=TWLT.Settings.getLS(k,TWLT.Settings.Features[k][1]);for(var k in TWLT.Settings.Features)try{if(TWLT.Settings.Features[k][1])TWLT[k].init()}catch(e){}},open:function(){var selectbox=new west.gui.Selectbox;selectbox.setHeader("TWLT");selectbox.setWidth(300);selectbox.addItem(0,"Einstellungen \u00f6ffnen","\u00d6ffnet das Informations- und Einstellungsfenster"); if(TWLT.Settings.get("GoToGhosttown"))selectbox.addItem(1,"Gehe zur Geisterstadt "+window.Map.calcWayTime(TWLT.ShowDuellMap.getLastQueuePosition(),{x:1728,y:2081}).formatDuration(),"Geht zur Geisterstadt");if(TWLT.Settings.get("GoToGhosttown"))selectbox.addItem(2,"\u00d6ffne Geisterstaft","\u00d6ffnet das Fenster der Geisterstadt und zentriert es auf der Map");if(TWLT.Settings.get("GoToIndianerdorf"))selectbox.addItem(3,"Gehe zum Indianerdorf "+window.Map.calcWayTime(TWLT.ShowDuellMap.getLastQueuePosition(), {x:28002,y:16658}).formatDuration(),"Geht zum Indianerdorf");if(TWLT.Settings.get("GoToIndianerdorf"))selectbox.addItem(4,"\u00d6ffne Indianerdorf","\u00d6ffnet das Fenster des Indianerdorfes und zentriert es auf der Map");if(TWLT.Settings.get("OpenMarkt"))selectbox.addItem(5,"\u00d6ffne Marktfenster","\u00d6ffnet das Marktfenster");if(TWLT.Settings.get("OpenForum"))selectbox.addItem(6,"\u00d6ffne Stadtforum","\u00d6ffnet das Stadtforum");selectbox.addListener(function(e){switch(e){case 0:TWLT.GUI.open(); break;case 1:QuestEmployerWindow.startWalk({key:"ghosttown",x:"1728",y:"2081"});break;case 2:Map.center(1728,2081);QuestEmployerWindow.showEmployer("ghosttown","1728","2081");break;case 3:QuestEmployerWindow.startWalk({key:"indianvillage",x:"28002",y:"16658"});break;case 4:Map.center(28002,16658);QuestEmployerWindow.showEmployer("indianvillage","28002","16658");break;case 5:if(Character.homeTown.town_id!=0)MarketWindow.open(Character.homeTown.town_id);else(new UserMessage("Du musst erst einer Stadt beitreten !", UserMessage.TYPE_ERROR)).show();break;case 6:ForumWindow.open();break}});var position=$("div#TWLTmenulink").offset();selectbox.setPosition(position.left-325,position.top-20);selectbox.show()},getLS:function(key,value){var item=localStorage.getItem("TWLT-"+key)||value;if(item==="true")item=true;if(item==="false")item=false;return item},setLS:function(key,value){localStorage.setItem("TWLT-"+key,value)},set:function(key,bool){TWLT.Settings.Features[key][1]=bool;TWLT.Settings.setLS(key,bool)},get:function(key){return TWLT.Settings.Features[key][1]}}; TWLT.GUI={window:{},checkbox:{},open:function(){TWLT.GUI.window=wman.open("TWLT").setMiniTitle("TWLeoTools").setTitle("TheWest - LeoTools");TWLT.GUI.window.addTab("Info & Kontakt","TWLTKontakt",TWLT.GUI.openKontakt);TWLT.GUI.window.addTab("Features","TWLTFeatures",TWLT.GUI.openFeatures);TWLT.GUI.window.addTab("Update","TWLTUpdate",TWLT.GUI.openUpdate);TWLT.GUI.openKontakt()},openKontakt:function(){TWLT.GUI.window.clearContentPane();TWLT.GUI.window.activateTab("TWLTKontakt");var content=$('<br/><h1>Infos</h1><br /><ul style="list-style-type:none;line-height:18px;margin-left:5px;"><li>Name : '+ TWLT.Skript.Name+"</li><li>Author : "+TWLT.Skript.Author+"</li><li>Version : "+TWLT.Skript.Version+"</li><li>Minimale Gameversion : "+TWLT.Skript.MinGameVersion+"</li><li>Maximale Gameversion : "+TWLT.Skript.MaxGameVersion+"</li><li>Webseite : "+TWLT.Skript.Webseite+'</li></ul><br /><br /><h1>Kontakt</h1><br /><ul style="margin-left:15px;line-height:18px;"><li>Per Telegramm auf den deutschen Welten 13-16</li><li>Per Telegramm auf der Beta</li><li>Per PN im offiziellen TheWest-Forum</li></ul>');TWLT.GUI.window.appendToContentPane(content)}, openFeatures:function(){TWLT.GUI.window.clearContentPane();TWLT.GUI.window.activateTab("TWLTFeatures");var content=$("<br/><h1>Features</h1><br /><br />");var scrollpane=(new west.gui.Scrollpane).appendTo(TWLT.GUI.window.getContentPane());scrollpane.appendContent(content);for(var k in TWLT.Settings.Features){TWLT.GUI.checkbox[k]=new west.gui.Checkbox;checkbox=TWLT.GUI.checkbox[k];checkbox.setLabel(TWLT.Settings.Features[k][0]);checkbox.setSelected(TWLT.Settings.Features[k][1]);checkbox.appendTo(scrollpane.getContentPane()); scrollpane.appendContent('<br /><div style="height:5px;" />')}scrollpane.appendContent('<div style="height: 15px;" />');var button=new west.gui.Button("Speichern",TWLT.GUI.saveFeatures);button.setWidth(181);button.appendTo(scrollpane.getContentPane())},openUpdate:function(){TWLT.Updater.init(true)},saveFeatures:function(){for(var k in TWLT.GUI.checkbox)TWLT.Settings.set(k,TWLT.GUI.checkbox[k].isSelected());(new UserMessage("Einstellungen wurden gespeichert. Neu laden/einloggen, um \u00c4nderungen zu aktualisieren", UserMessage.TYPE_SUCCESS)).show()}};TWLT.Settings.Features={Logout:["Erstellt einen Logout-Button rechts in der Men\u00fcleiste",true],Statusbar:["Entfernt die Fensterleiste der Fenster im unteren Teil",false],GoToIndianerdorf:["F\u00fcgt im Men\u00fc rechts einen Eintrag ein, um zum Indianerdorf zu gelangen",true],GoToGhosttown:["F\u00fcgt im Men\u00fc rechts einen Eintrag ein, um zur Geisterstadt zu gelangen",true],OpenForum:["F\u00fcgt im Men\u00fc rechts einen Eintrag ein, um das Marktfenster zu \u00f6ffnen", true],OpenMarkt:["F\u00fcgt im Men\u00fc rechts einen Eintrag ein, um das Stadtforum zu \u00f6ffnen",true],ShowAP:["Zeige die Arbeitspunkte im Job-Fenster",true],ChangeCityhall:["Tausche Titel und Spielername in der Stadthalle",true],ShowDuellMap:["Erg\u00e4nze im Duellfenster einen Tab, der eine Duellkarte zeigt",true],MarkDaily5:["Markiere Daily-Login-Bonus 5 besonders, um ihn nicht zu \u00fcbersehen",true],DeleteChatMessages:['Blende im Chat die "Letzte Nachricht war um xx:xx" Meldungen aus',true], MarketTownName:["Zeige im Marktfenster, zu welcher Stadt es geh\u00f6rt",true],MarketMessage:["Wenn du an einem Markt stehst, wo etwas abgeholt werden kann, erscheint eine Meldung",true],AchievementHide:["Verstecke abgeschlossene Erfolge im Erfolgsfenster f\u00fcr eine bessere \u00dcbersicht",false]};TWLT.AchievementHide={init:function(){var hideUnErfolge=function(){var erfolge=$(".achievement");erfolge.hide();var unerfolge=$(".achievement .achievement_unachieved");unerfolge.parent().show()};var oldUpdateContent= AchievementExplorer.prototype.updateContent;AchievementExplorer.prototype.updateContent=function(data){var tmp=oldUpdateContent.call(this,data);hideUnErfolge();return tmp}}};TWLT.MarketMessage={init:function(){Ajax.get("map","get_minimap",{},function(json){if(json.error)return(new UserMessage(json.msg)).show();TWLT.MarketMessage.Towns=json.towns;EventHandler.listen("position_change",function(){TWLT.MarketMessage.check()});TWLT.MarketMessage.check()})},check:function(){var town_id;var x=Character.position.x; var y=Character.position.y;var offers=[];var bids;var fetch=function(offer_id){Ajax.remoteCall("building_market","fetch",{market_offer_id:offer_id},function(){})};var fetchAll=function(){for(var i=0;i<bids.length;i++)if(bids[i].market_town_id==town_id&&(bids[i].auction_ends_in<0||bids[i].current_bid==bids[i].max_price)&&bids[i].current_bid!=null)fetch(bids[i].market_offer_id);for(var i=0;i<offers.length;i++)if(offers[i].market_town_id==town_id&&(offers[i].auction_ends_in<0||offers[i].current_bid== offers[i].max_price)&&offers[i].current_bid!=null)fetch(offers[i].market_offer_id)};var showDialog=function(){var dialog=new west.gui.Dialog("Gegenst\u00e4de auf dem Markt","Es sind noch Gegenst\u00e4nde/Geld auf diesem Markt. Sollen diese abgeholt werden ?",west.gui.Dialog.SYS_QUESTION);dialog.addButton("Ja",fetchAll).addButton("Nein",function(){});dialog.show()};var checkItems=function(){for(var i=0;i<bids.length;i++)if(bids[i].market_town_id==town_id&&(bids[i].auction_ends_in<0||bids[i].current_bid== bids[i].max_price)&&bids[i].current_bid!=null){console.log(bids[i]);showDialog();return}for(var i=0;i<offers.length;i++)if(offers[i].market_town_id==town_id&&(offers[i].auction_ends_in<0||offers[i].current_bid==offers[i].max_price)&&offers[i].current_bid!=null){console.log(offers[i]);showDialog();return}};var get_offers=function(page){Ajax.remoteCall("building_market","fetch_offers",{page:page},function(json){offers=offers.concat(json.msg.search_result);if(json.msg.next){get_offers(++page);return}checkItems()})}; var get_bids=function(){Ajax.remoteCall("building_market","fetch_bids",{},function(json){bids=json.msg.search_result;get_offers(0)})};for(var k in TWLT.MarketMessage.Towns)if(TWLT.MarketMessage.Towns[k].x==x&&TWLT.MarketMessage.Towns[k].y==y){town_id=TWLT.MarketMessage.Towns[k].town_id;get_bids()}}};TWLT.MarketTownName={Towns:{},init:function(){Ajax.get("map","get_minimap",{},function(json){if(json.error)return(new UserMessage(json.msg)).show();TWLT.MarketTownName.Towns=json.towns});var addTownName= function(){var townName=TWLT.MarketTownName.Towns[MarketWindow.townId].name;MarketWindow.window.setTitle(MarketWindow.window.titler.text+" - "+townName)};var sShowTab=MarketWindow.showTab.toString();sShowTab=sShowTab.substr(0,sShowTab.length-1);sShowTab+='MarketWindow.window.setTitle(MarketWindow.window.titler.text+" - "+TWLT.MarketTownName.Towns[MarketWindow.townId].name);';eval("MarketWindow.showTab = "+sShowTab+"};")}};TWLT.DeleteChatMessages={init:function(){var style=$('<style type="text/css">div.tw2gui_window.chat .from_notice { display:none; }</style>'); style.appendTo("head")}};TWLT.MarkDaily5={init:function(){var addBorder=function(){var rows=$(".reward-row");var row=$(rows[4]);if(row.hasClass("today"))row.css("border","20px solid red")};var oldLoginbonusShow=west.player.LoginBonus.prototype.show;west.player.LoginBonus.prototype.show=function(){var tmp=oldLoginbonusShow.call(this);if(tmp!==undefined)return tmp;addBorder()}}};TWLT.ShowDuellMap={Player:{},getLastQueuePosition:function(){var posx=Character.position.x;var posy=Character.position.y; if(TaskQueue.queue.length>=1){var data=TaskQueue.queue[TaskQueue.queue.length-1].wayData;if(data.x){posx=data.x;posy=data.y}}return{x:posx,y:posy}},init:function(){Ajax.remoteCallMode("character","get_info",{},function(resp){Character.setDuelLevel(resp.duelLevel)});var fillPage=function(){$("#TWLTDuellMapTable").empty();$("#TWLTDuellMapPlayers").empty();$("#TWLTDuellMapTable").append("<tr><th>Name</th><th>Stadt</th><th>Stufe</th><th>Duellstufe</th><th>EP</th><th>Distanz</th><th>Starte Duell</th><th>Zentriere Map</th></tr>"); for(var k in TWLT.ShowDuellMap.Player){var data=TWLT.ShowDuellMap.Player[k];var content=$("<tr></tr>");content.append('<td><a href="#" onclick="PlayerProfileWindow.open('+data.player_id+');">'+data.player_name+"</a></td>");content.append('<td><a href="#" onclick="TownWindow.open('+data.town_x+","+data.town_y+');">'+data.town_name+"</a></td>");content.append("<td>"+data.level+"</td>");content.append("<td>"+data.duellevel+"</td>");content.append("<td>"+Math.round((7*data.duellevel-5*Character.duelLevel+ 5)*Character.duelMotivation*3)+"</td>");content.append("<td>"+window.Map.calcWayTime(TWLT.ShowDuellMap.getLastQueuePosition(),{x:data.character_x,y:data.character_y}).formatDuration()+"</td>");content.append('<td><a href="#" onclick="SaloonWindow.startDuel('+data.player_id+", "+data.alliance_id+', false, DuelsWindow);">Starte Duell</a></td>');content.append('<td><a href="#" onclick="Map.center('+data.character_x+", "+data.character_y+');">Zentriere Map</a></td>');$("#TWLTDuellMapTable").append(content); content=$('<div style="position:absolute;border:1px solid black;background:#FF0000;width:4px;height:4px;left:'+(data.character_x/46592*770-2)+"px;top:"+(data.character_y/20480*338-2)+'px;" />');eval("content.click(function () { SaloonWindow.startDuel("+data.player_id+", "+data.alliance_id+", false, DuelsWindow); });");content.addMousePopup("<b>"+data.player_name+"</b> "+window.Map.calcWayTime(TWLT.ShowDuellMap.getLastQueuePosition(),{x:data.character_x,y:data.character_y}).formatDuration());$("#TWLTDuellMapPlayers").append(content)}$('<div style="position:absolute;border:1px solid black;background:#00CCFF;width:4px;height:4px;left:'+ (Character.position.x/46592*770-2)+"px;top:"+(Character.position.y/20480*338-2)+'px;" />').addMousePopup("Deine Position").appendTo("#TWLTDuellMapPlayers")};var getPlayer=function(i,distance){if(i==-1){TWLT.ShowDuellMap.Player={};i++}Ajax.remoteCall("duel","search_op",{next:true,order_by:"ASC",sort:"range",page:i,distance:distance*60},function(json){for(var j=0;j<json.oplist.pclist.length;j++)TWLT.ShowDuellMap.Player[json.oplist.pclist[j].player_name]=json.oplist.pclist[j];if(json.oplist.next){getPlayer(++i, distance);return}fillPage()})};var showTab=function(win,id){DuelsWindow.window.setSize(840,655).addClass("premium-buy");DuelsWindow.window.activateTab(id).$("div.tw2gui_window_content_pane > *").each(function(i,e){if($(e).hasClass("duels-"+id)){$(e).children().fadeIn();$(e).show()}else{$(e).children().fadeOut();$(e).hide()}});DuelsWindow.window.setTitle("Duellmap")};var initDuellmap=function(){DuelsWindow.window.addTab("Duellmap","TWLTDuellmap",showTab);var area=$('<div class="duels-TWLTDuellmap" style="display:none;"></div>').appendTo(DuelsWindow.window.getContentPane()); var content=$('<div style="height:350px;top:10px;position:relative"></div>');var left=0;var top=0;for(var i=1;i<=15;i++){var img=$('<img style="position:absolute;border:1px solid #000;width:110px;height:169px;left:'+left+"px;top:"+top+'px;" src="'+Game.cdnURL+"/images/map/minimap/county_"+i+'.jpg" />');left+=110;if(i===7){left=0;top=169}if(i===4||i===11)img.css("height","114px");if(i===11)img.css("top",top+55+"px");if(i===15)img.css({height:"110px",left:"330px",top:"114px"});content.append(img)}content.append('<div id="TWLTDuellMapPlayers"></div>'); content.appendTo(area);var scrollpane=(new west.gui.Scrollpane).appendTo(area);$(scrollpane.getMainDiv()).css("height","200px");scrollpane.appendContent("Duellradius ");var combobox=(new west.gui.Combobox).setWidth(120).addItem("10","10 Minuten").addItem("30","30 Minuten").addItem("60","1 Stunde").select("10").appendTo(scrollpane.getContentPane());var button=(new west.gui.Button("Duellgegner suchen")).appendTo(scrollpane.getContentPane()).click(function(){getPlayer(-1,combobox.getValue())});scrollpane.appendContent('<table border="1" id="TWLTDuellMapTable"></table>'); getPlayer(-1,10)};var oldOpen=DuelsWindow.open;DuelsWindow.open=function(){var tmp=oldOpen.call(this);if(tmp!==undefined)return tmp;initDuellmap()};var oldShowTab=DuelsWindow.showTab;DuelsWindow.showTab=function(id){var tmp=oldShowTab.call(this,id);if(tmp!==undefined)return tmp;DuelsWindow.window.removeClass("premium-buy").setSize(748,472)}}};TWLT.ChangeCityhall={init:function(){var swap=function(that){var rows=$("."+that.window.id+" .row .cell.cell_2.name,."+that.window.id+" .row .cell.cell_2.name_foreign"); rows.empty();for(var i=0;i<=that.data.length;i++){var player=that.data[i];$(rows[i]).append("<span>&nbsp;"+(player.title!=null?player.title:"")+'</span><a href="#" onClick="PlayerProfileWindow.open('+player.player_id+')">'+player.name+"</a>")}};var oldFillContent=CityhallWindow.Residents.fillContent;CityhallWindow.Residents.fillContent=function(){var tmp=oldFillContent.call(this);if(tmp!==undefined)return tmp;swap(this)}}};TWLT.ShowAP={init:function(){var addAP=function(that){job=that.job;var getJobFeaturedCls= function(){if(LinearQuestHandler.hasTutorialQuest())return"";if(job.is_gold)return"gold";if(job.is_silver)return"silver";return""};var aps=that.currSkillpoints-that.job.workpoints;var jobicon='<div class="job" title="'+job.get("description").escapeHTML().cutIt(150)+'"><div class="featured '+getJobFeaturedCls()+'"></div>'+'<img src="http://www.the-west.de/images/jobs/'+job.get("shortname")+'.png" class="job_icon" /></div>';that.window.setTitle(jobicon+"&nbsp;&nbsp;"+job.get("name").escapeHTML()+" ("+ aps+" AP)")};var oldInitView=JobWindow.initView;JobWindow.initView=function(){var tmp=oldInitView.call(this);if(tmp!==undefined)return tmp;addAP(this)}}};TWLT.ShowDuellEP={init:function(){var registerClick=function(){};var oldShowTab=DuelsWindow.showTab;DuelsWindow.showTab=function(id){var tmp=oldShowTab(id);if(tmp!==undefined)return tmp;if(id==="playerduel")registerClick();TWLT.ShowDuellEP.addEP()}},addEP:function(){}};TWLT.Statusbar={init:function(){$("div#ui_windowbar").hide();$("div#ui_windowbar_state").hide()}}; TWLT.Logout={init:function(){var menuContainer=$('<div class="ui_menucontainer" />');menuContainer.append($('<div class="menulink" onclick="TWLT.Logout.logout();" title="Logout" style="background:url('+TWLT.Images.Logout+');" /><div class="menucontainer_bottom" />'));$("#ui_menubar").append(menuContainer)},logout:function(){location.href="game.php?window=logout&action=logout&h="+Player.h}};TWLT.Settings.init()}); if(location.href.indexOf("forum.php")!=-1)(function(fn){var script=document.createElement("script");script.setAttribute("type","text/javascript");script.textContent="("+fn.toString()+")();";document.head.appendChild(script)})(function(){TWLT={};TWLT.init=function(){if(location.href.indexOf("&edit_post_id=")!=-1)TWLT.addBBCodes()};TWLT.addBBCodes=function(){}});